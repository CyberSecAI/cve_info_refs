=== Content from www.trendmicro.com_e1f869f1_20250119_110648.html ===


[![](/content/dam/trendmicro/global/en/core/images/logos/tm-logo-red-white-t.svg)

Business](/en_us/business.html)

search
close

* Solutions
  + [By Challenge](/en_us/business/solutions/challenges.html)
    - [By Challenge](/en_us/business/solutions/challenges.html)
      * By Challenge
        [Learn more](/en_us/business/solutions/challenges.html)
    - [Understand, Prioritize & Mitigate Risks](/en_us/business/solutions/challenges/cyber-risk.html)
      * Understand, Prioritize & Mitigate Risks

        Improve your risk posture with attack surface management

        [Learn more](/en_us/business/solutions/challenges/cyber-risk.html)
    - [Protect Cloud-Native Apps](/en_us/business/solutions/challenges/cloud-native-applications.html)
      * Protect Cloud-Native Apps

        Security that enables business outcomes

        [Learn more](/en_us/business/solutions/challenges/cloud-native-applications.html)
    - [Protect Your Hybrid World](/en_us/business/solutions/challenges/hybrid-cloud.html)
      * Protect Your Hybrid, Multi-Cloud World

        Gain visibility and meet business needs with security

        [Learn more](/en_us/business/solutions/challenges/hybrid-cloud.html)
    - [Securing Your Borderless Workforce](/en_us/business/solutions/challenges/infrastructure-security.html)
      * Securing Your Borderless Workforce

        Connect with confidence from anywhere, on any device

        [Learn more](/en_us/business/solutions/challenges/infrastructure-security.html)
    - [Eliminate Network Blind Spots](/en_us/business/solutions/challenges/network-security.html)
      * Eliminate Network Blind Spots

        Secure users and key operations throughout your environment

        [Learn more](/en_us/business/solutions/challenges/network-security.html)
    - [See More. Respond Faster.](/en_us/business/solutions/challenges/detection-response.html)
      * See More. Respond Faster.

        Move faster than your adversaries with powerful purpose-built XDR, attack surface risk management, and zero trust capabilities

        [Learn more](/en_us/business/solutions/challenges/detection-response.html)
    - [Extend Your Team](/en_us/business/solutions/challenges/managed-services.html)
      * Extend Your Team. Respond to Threats Agilely

        Maximize effectiveness with proactive risk reduction and managed services

        [Learn more](/en_us/business/solutions/challenges/managed-services.html)
    - [Operationalizing Zero Trust](/en_us/business/solutions/challenges/zero-trust.html)
      * Operationalizing Zero Trust

        Understand your attack surface, assess your risk in real time, and adjust policies across network, workloads, and devices from a single console

        [Learn more](/en_us/business/solutions/challenges/zero-trust.html)
  + [By Role](/en_us/business/solutions/role.html)
    - [By Role](/en_us/business/solutions/role.html)
      * By Role
        [Learn more](/en_us/business/solutions/role.html)
    - [CISO](/en_us/business/solutions/role/ciso.html)
      * CISO

        Drive business value with measurable cybersecurity outcomes

        [Learn more](/en_us/business/solutions/role/ciso.html)
    - [SOC Manager](/en_us/business/solutions/role/soc.html)
      * SOC Manager

        See more, act faster

        [Learn more](/en_us/business/solutions/role/soc.html)
    - [Infrastructure Manager](/en_us/business/solutions/role/it-infrastructure-operations.html)
      * Infrastructure Manager

        Evolve your security to mitigate threats quickly and effectively

        [Learn more](/en_us/business/solutions/role/it-infrastructure-operations.html)
    - [Cloud Builder and Developer](/en_us/business/solutions/role/cloud-developer.html)
      * Cloud Builder and Developer

        Ensure code runs only as intended

        [Learn more](/en_us/business/solutions/role/cloud-developer.html)
    - [Cloud Security Ops](/en_us/business/solutions/role/cloud-operations.html)
      * Cloud Security Ops

        Gain visibility and control with security designed for cloud environments

        [Learn more](/en_us/business/solutions/role/cloud-operations.html)
  + [By Industry](/en_us/business/capabilities/solutions-for.html)
    - [By Industry](/en_us/business/capabilities/solutions-for.html)
      * By Industry
        [Learn more](/en_us/business/capabilities/solutions-for.html)
    - [Healthcare](/en_us/business/capabilities/solutions-for/healthcare.html)
      * Healthcare

        Protect patient data, devices, and networks while meeting regulations

        [Learn more](/en_us/business/capabilities/solutions-for/healthcare.html)
    - [Manufacturing](/en_us/business/solutions/iot/ics-ot.html)
      * Manufacturing

        Protecting your factory environments – from traditional devices to state-of-the-art infrastructures

        [Learn more](/en_us/business/solutions/iot/ics-ot.html)
    - [Oil & Gas](/en_us/business/solutions/iot/ics-ot.html)
      * Oil & Gas

        ICS/OT Security for the oil and gas utility industry

        [Learn more](/en_us/business/solutions/iot/ics-ot.html)
    - [Electric Utility](/en_us/business/solutions/iot/ics-ot.html)
      * Electric Utility

        ICS/OT Security for the electric utility

        [Learn more](/en_us/business/solutions/iot/ics-ot.html)
    - [Federal](/en_us/business/capabilities/solutions-for/federal-government.html)
      * Federal
        [Learn more](/en_us/business/capabilities/solutions-for/federal-government.html)
    - [Automotive](https://vicone.com/en)
      * Automotive
        [Learn more](https://vicone.com/en)
    - [5G Networks](/en_us/business/solutions/iot/enterprise-5g-iot.html)
      * 5G Networks
        [Learn more](/en_us/business/solutions/iot/enterprise-5g-iot.html)
  + [Small & Midsized Business Security](/en_us/small-business/platform.html)
    - Small & Midsized Business Security

      Stop threats with easy-to-use solutions designed for your growing business

      [Learn more](/en_us/small-business/platform.html)
* Platform
  + [Vision One Platform](/en_us/business/products/one-platform.html)
    - [Vision One Platform](/en_us/business/products/one-platform.html)
      * Trend Vision One
        Our Unified Platform

        Bridge threat protection and cyber risk management

        [Learn more](/en_us/business/products/one-platform.html)

        ![](/content/dam/trendmicro/global/en/core/images/console-images/navigation/trend-vision-one-laptop-console-nav.svg)
    - [AI Companion](/en_us/business/technologies/ai-companion.html)
      * Trend Vision One Companion

        Your generative AI cybersecurity assistant

        [Learn more](/en_us/business/technologies/ai-companion.html)
  + [Attack Surface Management](/en_us/business/products/attack-surface-management.html)
    - Attack Surface Management

      Stop breaches before they happen

      [Learn more](/en_us/business/products/attack-surface-management.html)

      ![](https://trendmicro.scene7.com/is/image/trendmicro/asrm-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
  + [XDR (Extended Detection & Response)](/en_us/business/products/detection-response/xdr.html)
    - XDR (Extended Detection & Response)

      Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform

      [Learn more](/en_us/business/products/detection-response/xdr.html)

      ![](https://trendmicro.scene7.com/is/image/trendmicro/xdr-product-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
  + [Cloud Security](/en_us/business/products/hybrid-cloud.html)
    - [Cloud Security](/en_us/business/products/hybrid-cloud.html)
      * Trend Vision One™
        Cloud Security Overview

        The most trusted cloud security platform for developers, security teams, and businesses

        [Learn more](/en_us/business/products/hybrid-cloud.html)
    - [Attack Surface Risk Management for Cloud](/en_us/business/products/attack-surface-management.html)
      * Attack Surface Risk Management for Cloud

        Cloud asset discovery, vulnerability prioritization, Cloud Security Posture Management, and Attack Surface Management all in one

        [Learn more](/en_us/business/products/attack-surface-management.html)
    - [XDR for Cloud](/en_us/business/products/detection-response/xdr.html)
      * XDR for Cloud

        Extend visibility to the cloud and streamline SOC investigations

        [Learn more](/en_us/business/products/detection-response/xdr.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/xdr-product-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [Workload Security](/en_us/business/products/endpoint-security/workload-security.html)
      * Workload Security

        Secure your data center, cloud, and containers without compromising performance by leveraging a cloud security platform with CNAPP capabilities

        [Learn more](/en_us/business/products/endpoint-security/workload-security.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/cloud-one-workload-security-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [Container Security](/en_us/business/products/hybrid-cloud/cloud-one-container-image-security.html)
      * Container Security

        Simplify security for your cloud-native applications with advanced container image scanning, policy-based admission control, and container runtime protection

        [Learn more](/en_us/business/products/hybrid-cloud/cloud-one-container-image-security.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/cloud-one-container-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [File Security](/en_us/business/products/hybrid-cloud/cloud-one-file-storage-security.html)
      * File Security

        Protect application workflow and cloud storage against advanced threats

        [Learn more](/en_us/business/products/hybrid-cloud/cloud-one-file-storage-security.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/cloud-one-file-storage-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
  + [Endpoint Security](/en_us/business/products/endpoint-security.html)
    - [Endpoint Security](/en_us/business/products/endpoint-security.html)
      * Endpoint Security Overview

        Defend the endpoint through every stage of an attack

        [Learn more](/en_us/business/products/endpoint-security.html)
    - [XDR for Endpoint](/en_us/business/products/detection-response/xdr.html)
      * XDR for Endpoint

        Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform

        [Learn more](/en_us/business/products/detection-response/xdr.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/xdr-product-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [Workload Security](/en_us/business/products/endpoint-security/workload-security.html)
      * Workload Security

        Optimized prevention, detection, and response for endpoints, servers, and cloud workloads

        [Learn more](/en_us/business/products/endpoint-security/workload-security.html)
    - [Industrial Endpoint Security](/en_us/business/products/iot/industrial-endpoint-security.html)
      * Industrial Endpoint Security
        [Learn more](/en_us/business/products/iot/industrial-endpoint-security.html)
    - [Mobile Security](/en_us/business/products/user-protection/sps/mobile-security-enterprise.html)
      * Mobile Security

        On-premises and cloud protection against malware, malicious applications, and other mobile threats

        [Learn more](/en_us/business/products/user-protection/sps/mobile-security-enterprise.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/sps-mobile-security-enterprise-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
  + [Network Security](/en_us/business/products/network.html)
    - [Network Security](/en_us/business/products/network.html)
      * Network Security Overview

        Expand the power of XDR with network detection and response

        [Learn more](/en_us/business/products/network.html)
    - [XDR for Network](/en_us/business/products/detection-response/xdr.html)
      * XDR for Network

        Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform

        [Learn more](/en_us/business/products/detection-response/xdr.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/xdr-product-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [Network Intrusion Prevention (IPS)](/en_us/business/products/network/intrusion-prevention.html)
      * Network Intrusion Prevention (IPS)

        Protect against known, unknown, and undisclosed vulnerabilities in your network

        [Learn more](/en_us/business/products/network/intrusion-prevention.html)
    - [Breach Detection System (BDS)](/en_us/business/products/network/advanced-threat-protection.html)
      * Breach Detection System (BDS)

        Detect and respond to targeted attacks moving inbound, outbound, and laterally

        [Learn more](/en_us/business/products/network/advanced-threat-protection.html)
    - [Secure Service Edge (SSE)](/en_us/business/products/network/zero-trust-secure-access.html)
      * Secure Service Edge (SSE)

        Redefine trust and secure digital transformation with continuous risk assessments

        [Learn more](/en_us/business/products/network/zero-trust-secure-access.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/zero-trust-access-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [5G Network Security](/en_us/business/solutions/iot/enterprise-5g-iot.html)
      * 5G Network Security
        [Learn more](/en_us/business/solutions/iot/enterprise-5g-iot.html)
    - [Industrial Network Security](/en_us/business/products/iot/industrial-network-security.html)
      * Industrial Network Security
        [Learn more](/en_us/business/products/iot/industrial-network-security.html)
  + [Email Security](/en_us/business/products/email-security.html)
    - [Email Security](/en_us/business/products/email-security.html)
      * Email Security

        Stop phishing, malware, ransomware, fraud, and targeted attacks from infiltrating your enterprise

        [Learn more](/en_us/business/products/email-security.html)
    - [Email and Collaboration Security](/en_us/business/products/user-protection/sps/email-and-collaboration.html)
      * Trend Vision One™
        Email and Collaboration Security

        Stop phishing, ransomware, and targeted attacks on any email service including Microsoft 365 and Google Workspace

        [Learn more](/en_us/business/products/user-protection/sps/email-and-collaboration.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/email-security-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
  + [OT Security](/en_us/business/solutions/iot/ics-ot.html)
    - [OT Security](/en_us/business/solutions/iot/ics-ot.html)
      * OT Security

        Learn about solutions for ICS / OT security.

        [Learn more](/en_us/business/solutions/iot/ics-ot.html)
    - [XDR for OT](/en_us/business/products/detection-response/xdr.html)
      * XDR for OT

        Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform

        [Learn more](/en_us/business/products/detection-response/xdr.html)

        ![](https://trendmicro.scene7.com/is/image/trendmicro/xdr-product-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
    - [Industrial Network Security](/en_us/business/products/iot/industrial-network-security.html)
      * Industrial Network Security
        [Industrial Network Security](/en_us/business/products/iot/industrial-network-security.html)
    - [Industrial Endpoint Security](/content/trendmicro/en_us/business/products/iot/industrial-endpoint-security)
      * Industrial Endpoint Security
        [Learn more](/content/trendmicro/en_us/business/products/iot/industrial-endpoint-security)
  + [Threat Insights](/en_us/business/products/one-platform/threat-insights.html)
    - Threat Insights

      See threats coming from miles away

      [Learn more](/en_us/business/products/one-platform/threat-insights.html)
  + [Identity Security](/en_us/business/products/identity.html)
    - Identity Security

      End-to-end identity security from identity posture management to detection and response

      [Learn more](/en_us/business/products/identity.html)
  + [On-Premises Data Sovereignty](/en_us/business/products/sovereign-private-cloud.html)
    - On-Premises Data Sovereignty

      Prevent, detect, respond and protect without compromising data sovereignty

      [Learn more](/en_us/business/products/sovereign-private-cloud.html)
  + [All Products, Services, and Trials](/en_us/business/products.html)
    - All Products, Services, and Trials
      [Learn more](/en_us/business/products.html)

      ![](https://trendmicro.scene7.com/is/image/trendmicro/all-products-console-shot?scl=1.0&qlt=95&fmt=webp-alpha)
* Research
  + [Research](/en_us/about/threat-research.html)
    - [Research](/en_us/about/threat-research.html)
      * Research
        [Learn more](/en_us/about/threat-research.html)
    - [Research, News, and Perspectives](/en_us/research.html)
      * Research, News, and Perspectives
        [Learn more](/en_us/research.html)
    - [Research and Analysis](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/)
      * Research and Analysis
        [Learn more](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/)
    - [Security News](https://www.trendmicro.com/vinfo/us/security/news/)
      * Security News
        [Learn more](https://www.trendmicro.com/vinfo/us/security/news/)
    - [Zero Day Initiatives (ZDI)](https://www.zerodayinitiative.com/about/)
      * Zero Day Initiatives (ZDI)
        [Learn more](https://www.zerodayinitiative.com/about/)
* Services
  + [Our Services](/en_us/business/services/service-one.html)
    - [Our Services](/en_us/business/services/service-one.html)
      * Our Services
        [Learn more](/en_us/business/services/service-one.html)
    - [Service Packages](/en_us/business/services/service-one.html)
      * Service Packages

        Augment security teams with 24/7/365 managed detection, response, and support

        [Learn more](/en_us/business/services/service-one.html)
    - [Managed XDR](/en_us/business/services/managed-xdr.html)
      * Managed XDR

        Augment threat detection with expertly managed detection and response (MDR) for email, endpoints, servers, cloud workloads, and networks

        [Learn more](/en_us/business/services/managed-xdr.html)
    - [Incident Response](/en_us/business/services/incident-response.html)
      * [Incident Response](/en_us/business/services/incident-response.html)
        + Incident Response

          Our trusted experts are on call whether you're experiencing a breach or looking to proactively improve your IR plans

          [Learn more](/en_us/business/services/incident-response.html)
      * [Insurance Carriers and Law Firms](/en_us/business/services/incident-response/insurance-law.html)
        + Insurance Carriers and Law Firms

          Stop breaches with the best response and detection technology on the market and reduce clients’ downtime and claim costs

          [Learn more](/en_us/business/services/incident-response/insurance-law.html)
    - [Support Services](/en_us/business/services/support-services.html)
      * Support Services
        [Learn more](/en_us/business/services/support-services.html)
* Partners
  + [Partner Program](/en_us/partners/program.html)
    - [Partner Program](/en_us/partners/program.html)
      * Partner Program Overview

        Grow your business and protect your customers with the best-in-class complete, multilayered security

        [Learn more](/en_us/partners/program.html)
    - [Partner Competencies](/en_us/partners/competencies.html)
      * Partner Competencies

        Stand out to customers with competency endorsements that showcase your expertise

        [Learn more](/en_us/partners/competencies.html)
    - [Partner Successes](/en_us/partners/partner-stories.html)
      * Partner Successes
        [Learn more](/en_us/partners/partner-stories.html)
    - [Managed Security Service Provider](/en_us/partners/program/managed-security-service-provider.html)
      * Managed Security Service Provider

        Deliver modern security operations services with our industry-leading XDR

        [Learn more](/en_us/partners/program/managed-security-service-provider.html)
    - [Managed Service Provider](/en_us/partners/program/managed-service-provider.html)
      * Managed Service Provider

        Partner with a leading expert in cybersecurity, leverage proven solutions designed for MSPs

        [Learn more](/en_us/partners/program/managed-service-provider.html)
  + [Alliance Partners](/en_us/partners/alliance-partners.html)
    - [Alliance Partners](/en_us/partners/alliance-partners.html)
      * Alliance Partners

        We work with the best to help you optimize performance and value

        [Learn more](/en_us/partners/alliance-partners.html)
    - [Technology Alliance Partners](/en_us/partners/alliance-partners/technology.html)
      * Technology Alliance Partners
        [Learn more](/en_us/partners/alliance-partners/technology.html)
    - [Find Alliance Partners](/en_us/partners/alliance-partners/explore-alliance-partners.html)
      * Find Alliance Partners
        [Learn more](/en_us/partners/alliance-partners/explore-alliance-partners.html)
  + [Partner Resources](/en_us/partners/resources.html)
    - [Partner Resources](/en_us/partners/resources.html)
      * Partner Resources

        Discover resources designed to accelerate your business’s growth and enhance your capabilities as a Trend Micro partner

        [Learn more](/en_us/partners/resources.html)
    - [Partner Portal Login](https://partner.trendmicro.com/)
      * Partner Portal Login
        [Login](https://partner.trendmicro.com/)
    - [Trend Campus](/en_us/partners/campus.html)
      * Trend Campus

        Accelerate your learning with Trend Campus, an easy-to-use education platform that offers personalized technical guidance

        [Learn more](/en_us/partners/campus.html)
    - [Co-Selling](/en_us/partners/co-selling.html)
      * Co-Selling

        Access collaborative services designed to help you showcase the value of Trend Vision One™ and grow your business

        [Learn more](/en_us/partners/co-selling.html)
    - [Become a Partner](https://partner.trendmicro.com/pr-register-home/)
      * Become a Partner
        [Learn more](https://partner.trendmicro.com/pr-register-home/)
    - [Distributors](/en_us/partners/distributors.html)
      * Distributors
        [Learn more](/en_us/partners/distributors.html)
  + [Find Partners](https://partner.trendmicro.com/partner-locator-home/)
    - Find Partners

      Locate a partner from whom you can purchase Trend Micro solutions

      [Learn more](https://partner.trendmicro.com/partner-locator-home/)
* Company
  + [Why Trend Micro](/en_us/about/why-trend-micro.html)
    - [Why Trend Micro](/en_us/about/why-trend-micro.html)
      * Why Trend Micro
        [Learn more](/en_us/about/why-trend-micro.html)
    - [Customer Success Stories](/en_us/about/customer-stories.html)
      * Customer Success Stories
        [Learn more](/en_us/about/customer-stories.html)
    - [The Human Connection](/content/trendmicro/en_us/about/human-connections)
      * The Human Connection
        [Learn more](/content/trendmicro/en_us/about/human-connections)
    - [Industry Accolades](/en_us/about/industry-recognition.html)
      * Industry Accolades
        [Learn more](/en_us/about/industry-recognition.html)
    - [Strategic Alliances](/en_us/partners/alliance-partners.html)
      * Strategic Alliances
        [Learn more](/en_us/partners/alliance-partners.html)
  + [Compare Trend Micro](/en_us/about/compare.html)
    - [Compare Trend Micro](/en_us/about/compare.html)
      * Compare Trend Micro

        See how Trend outperforms the competition

        [Let's go](/en_us/about/compare.html)
    - [vs. Crowdstrike](/en_us/about/compare/trend-vs-crowdstrike.html)
      * Trend Micro vs. Crowdstrike

        Crowdstrike provides effective cybersecurity through its cloud-native platform, but its pricing may stretch budgets, especially for organizations seeking cost-effective scalability through a true single platform

        [Let's go](/en_us/about/compare/trend-vs-crowdstrike.html)
    - [vs. Microsoft](/en_us/about/compare/trend-vs-microsoft.html)
      * Trend Micro vs. Microsoft

        Microsoft offers a foundational layer of protection, yet it often requires supplemental solutions to fully address customers' security problems

        [Let's go](/en_us/about/compare/trend-vs-microsoft.html)
    - [vs. Palo Alto Networks](/en_us/about/compare/trend-vs-palo-alto-networks.html)
      * Trend Micro vs. Palo Alto Networks

        Palo Alto Networks delivers advanced cybersecurity solutions, but navigating its comprehensive suite can be complex and unlocking all capabilities requires significant investment

        [Let's go](/en_us/about/compare/trend-vs-palo-alto-networks.html)
  + [About Us](/en_us/about.html)
    - [About Us](/en_us/about.html)
      * About Us
        [Learn more](/en_us/about.html)
    - [Trust Center](/en_us/about/trust-center.html)
      * Trust Center
        [Learn more](/en_us/about/trust-center.html)
    - [History](/en_us/about/history-vision-values.html)
      * History
        [Learn more](/en_us/about/history-vision-values.html)
    - [Diversity, Equity and Inclusion](/en_us/about/diversity-inclusion.html)
      * Diversity, Equity and Inclusion
        [Learn more](/en_us/about/diversity-inclusion.html)
    - [Corporate Social Responsibility](/en_us/about/corporate-social-responsibility.html)
      * Corporate Social Responsibility
        [Learn more](/en_us/about/corporate-social-responsibility.html)
    - [Leadership](/en_us/about/leaders.html)
      * Leadership
        [Learn more](/en_us/about/leaders.html)
    - [Security Experts](/en_us/about/leading-experts.html)
      * Security Experts
        [Learn more](/en_us/about/leading-experts.html)
    - [Internet Safety and Cybersecurity Education](/en_us/initiative-education.html)
      * Internet Safety and Cybersecurity Education
        [Learn more](/en_us/initiative-education.html)
    - [Legal](/en_us/about/legal.html)
      * Legal
        [Learn more](/en_us/about/legal.html)
    - [Investors](/en_us/about/investor-relations.html)
      * Investors
        [Learn more](/en_us/about/investor-relations.html)
    - [Formula E Racing](/en_us/business/campaigns/formula-e.html)
      * Formula E Racing
        [Learn more](/en_us/business/campaigns/formula-e.html)
  + [Connect With Us](https://newsroom.trendmicro.com/)
    - [Connect With Us](https://newsroom.trendmicro.com/)
      * Connect With Us
        [Learn more](https://newsroom.trendmicro.com/)
    - [Newsroom](https://newsroom.trendmicro.com/)
      * Newsroom
        [Learn more](https://newsroom.trendmicro.com/)
    - [Events](/en_us/about/events.html)
      * Events
        [Learn more](/en_us/about/events.html)
    - [Careers](/en_us/about/careers.html)
      * Careers
        [Learn more](/en_us/about/careers.html)
    - [Webinars](/en_us/about/webinars.html)
      * Webinars
        [Learn more](/en_us/about/webinars.html)
    - [Executive Briefing Center](/en_us/business/campaigns/executive-briefing-center.html)
      * Executive Briefing Center

        Experience Trend's culture of innovation and world class threat intelligence

        [Learn more](/en_us/business/campaigns/executive-briefing-center.html)

Back

Back

Back

Back

* [Free Trials](/en_us/business/products/trials.html)
* [Contact Us](/en_us/business/get-info-form.html)

[Looking for home solutions?](/en_us/forHome.html)

[Under Attack?](https://resources.trendmicro.com/GLB-Under-Attack-Form.html)
3 Alerts

Back

Unread
All

* [AI Pulse: Reflecting on 2024’s defining AI trends](/en_us/research/25/a/top-ai-trends-from-2024-review.html)
  close

  [Read more >](/en_us/research/25/a/top-ai-trends-from-2024-review.html)
* [Redefining Defense: Mapping container security to MITRE ATT&CK](/en_us/research/25/a/mitre-attack-container-security-detection.html)
  close

  [Learn more >](/en_us/research/25/a/mitre-attack-container-security-detection.html)
* [How the English cybercriminal underground is evolving amid new tech and increased scrutiny](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/bridging-divides-transcending-borders-the-current-state-of-the-english-underground)
  close

  [Read report >](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/bridging-divides-transcending-borders-the-current-state-of-the-english-underground)

Support

* [Business Support Portal](https://success.trendmicro.com/en-US/)
* [Education and Certification](/en_us/business/services/support-services/education.html)
* [Contact Support](https://success.trendmicro.com/en-US/contactus/)
* [Find a Support Partner](https://partner.trendmicro.com/partner-locator-home/)

Resources

* [AI Security](/en_us/business/ai.html)
* [Trend Micro vs. Competition](/en_us/about/compare.html)
* [Cyber Risk Assessments](https://resources.trendmicro.com/security-assessment-service-us.html?_ga=2.66788462.1559035223.1729522833-1050444116.1727452407)
* [What Is?](/en_us/what-is.html)
* [Threat Encyclopedia](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/)
* [Cyber Insurance](/en_us/business/cyber-insurance.html)
* [Glossary of Terms](https://www.trendmicro.com/vinfo/us/security/definition/a)
* [Webinars](/en_us/about/webinars.html)

Log In

* [Vision One](https://signin.v1.trendmicro.com/)
* [Support](https://success.trendmicro.com/en-US/)
* [Partner Portal](https://partner.trendmicro.com/)
* [Cloud One](https://cloudone.trendmicro.com/)
* [Product Activation and Management](https://tm.login.trendmicro.com/simplesaml/saml2/idp/SSOService.php)
* [Referral Affiliate](https://signup.cj.com/member/signup/publisher/?cid=1867119#/branded?_k=xaeu3t)

Back

arrow\_back
search

|  |
| --- |

close

Content has been added to your Folio

Go to Folio (0)

close

Ransomware

# Ransomware Actor Abuses Genshin Impact Anti-Cheat Driver to Kill Antivirus

We investigate mhyprot2.sys, a vulnerable anti-cheat driver for the popular role-playing game Genshin Impact. The driver is currently being abused by a ransomware actor to kill antivirus processes and services for mass-deploying ransomware.

By: Ryan Soliven, Hitomi Kimura
August 24, 2022
Read time:  ( words)

[![Share](/etc.clientlibs/trendresearch/clientlibs/clientlib-trendresearch/resources/img/share-more.svg)](https://www.addtoany.com/share)
![Print](/etc.clientlibs/trendresearch/clientlibs/clientlib-trendresearch/resources/img/printer.svg)

Save to Folio

---

There have already been reports on code-signed rootkits like [Netfilter](https://www.gdatasoftware.com/blog/microsoft-signed-a-malicious-netfilter-rootkit), [FiveSys](https://www.bitdefender.com/blog/hotforsecurity/the-emergence-of-the-fivesys-rootkit-a-malicious-driver-signed-by-microsoft/), and [Fire Chili](https://www.fortinet.com/blog/threat-research/deep-panda-log4shell-fire-chili-rootkits). These rootkits are usually signed with stolen certificates or are falsely validated. However, when a legitimate driver is used as a rootkit, that’s a different story. Such is the case of *mhyprot2.sys*, a vulnerable anti-cheat driver for the popular role-playing game Genshin Impact. The driver is currently being abused by a [ransomware](https://www.trendmicro.com/vinfo/tmr/?/tmr/?/us/security/definition/ransomware) actor to kill antivirus processes and services for mass-deploying ransomware. Security teams and defenders should note that *mhyprot2.sys* can be integrated into any malware.

What we found

During the last week of July 2022, a ransomware infection was triggered in a user environment that had endpoint protection properly configured. Analyzing the sequence, we found that a code-signed driver called “*mhyprot2.sys*”, which provides the anti-cheat functions for Genshin Impact as a device driver, was being abused to bypass privileges. As a result, commands from kernel mode killed the endpoint protection processes.

As of this writing, the code signing for *mhyprot2.sys* is still valid. Genshin Impact does not need to be installed on a victim’s device for this to work; the use of this driver is independent of the game.

This ransomware was simply the first instance of malicious activity we noted. The threat actor aimed to deploy ransomware within the victim’s device and then spread the infection. Since *mhyprot2.sys* can be integrated into any malware, we are continuing investigations to determine the scope of the driver.

Organizations and security teams should be careful because of several factors: the ease of obtaining the *mhyprot2.sys* module, the versatility of the driver in terms of bypassing privileges, and the existence of well-made proofs of concept (PoCs). All these factors mean that the usage of this driver is likely higher than those of previously discovered rootkits (such as the ones mentioned in the preceding section).

Meanwhile, the timeline and attack sequence of the threat actor’s activities that we present here are noteworthy for security teams. A list of the techniques used in this operation can be found in the MITRE ATT&CK analysis at the end of this article.

Timeline of activities

![Figure 1. Attack overview](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%201.png)

Figure 1. Attack overview

The earliest evidence of compromise was a *[secretsdump](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)* from an unidentified endpoint of the targeted organization to one of the domain controllers. It was followed by the execution of discovery commands using *[wmiexec](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_10_0/examples/wmiexec.py)* in the context of the built-in domain administrator account. Both *secretsdump* — which dumps secrets from the remote machine without executing any agent there — and *wmiexec* — which executes commands remotely through Windows Management Instrumentation (WMI) — are tools from [Impacket](https://www.secureauth.com/labs/open-source-tools/impacket/), a free collection of Python classes for working with network protocols.

![Figure 2. Early evidence of compromise](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%202.png)

Figure 2. Early evidence of compromise

Shortly afterward, the threat actor connected to the domain controller via RDP using another compromised administrator account. From there, everything was executed in the context of that user account.

![Figure 3. The threat actor connecting to the domain controller via RDP](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%203.png)

Figure 3. The threat actor connecting to the domain controller via RDP

*Note: The process rdpclip.exe running under the context of the compromised administrator account was the only destination system artifact supporting the use of RDP toward the domain controller. It facilitates clipboard sharing between RDP sessions.*

A malicious file, *kill\_svc.exe (C:\users\{compromised user}\kill\_svc.exe)*, and *mhyprot2.sys (C:\users\{compromised user}\mhyprot2.sys)* were transferred to the desktop. This was the first time that the vulnerable driver was seen. The file *kill\_svc.exe* installed the *mhyprot2* service and killed antivirus services.

![Figure 4. The suspicious kill_svc.exe file executed](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%204.png)

Figure 4. The suspicious kill\_svc.exe file executed

![Figure 5. The vulnerable device installed](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%205.png)

Figure 5. The vulnerable device installed

Another malicious file, avg.msi, was transferred to the *netlogon* share *\\{domaincontroller}\NETLOGON\avg.msi*. This Windows installer contains *avg.exe*, a malicious file masquerading as AVG Internet Security, and is responsible for dropping and executing the following:

* *logon.bat* – A batch file that executes *HelpPane.exe*, kills antivirus and other services, and executes svchost.exe.
* *HelpPane.exe* – A malicious file masquerading as Microsoft Help and Support executable; similar to *kill\_svc.exe*, it installs *mhyprot2.sys* and kills antivirus services.
* *mhyprot2.sys* – A vulnerable Genshin Impact anti-cheat driver.
* *svchost.exe* – The ransomware payload.

This also shows that the threat actor intended to mass-deploy the ransomware using the domain controller via startup/logon script.

The Windows installer avg.msi hosted on the netlogon share was deployed to one workstation endpoint via Group Policy Object (GPO). We suspect that this was to test whether deployment via GPO would be successful, but this case resulted in a failure.

![Figure 6. The Windows installer avg.msi deployed via GPO](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%206.png)

Figure 6. The Windows installer avg.msi deployed via GPO

Afterward, the threat actor logged in to the workstation from the unidentified endpoint. Both Logon Type 3 (Network Logon) and Logon Type 10 (RemoteInteractive) were observed. The Windows installer *avg.msi* was manually installed three times, which also resulted in a failure — no encryption. However, it was successful in killing the antivirus services.

![Figure 7. Manual installation of avg.msi failing](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%207.png)

Figure 7. Manual installation of avg.msi failing

*Note: The installation of avg.msi might have failed but the product was also no longer working.*

The file *avg.exe*, extracted from *avg.msi*, was also transferred to the desktop and executed three times. However, in our analysis, we found that this step also did not work even though the antivirus was no longer working. Apparently, using the the .msi or .exe file resulted in the applications’ being stuck.

![Figure 8. The malicious file avg.exe transferred to the desktop and executed three times](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%208.png)

Figure 8. The malicious file avg.exe transferred to the desktop and executed three times

In an attempt to make things work, the threat actor transferred *logon.bat* to the desktop and executed it manually. The file *logon.bat*, supposedly dropped and executed by *avg.exe*, was used as a standalone.

![Figure 9. Section 1 of logon.bat, used for starting HelpPane.exe](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%209.png)

Figure 9. Section 1 of logon.bat, used for starting HelpPane.exe

![Figure 10. Section 2 of logon.bat, used for killing antivirus solutions and other services](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2010.jpg)

Figure 10. Section 2 of logon.bat, used for killing antivirus solutions and other services

![Figure 11. Section 3 of logon.bat, used for disabling the boot loader from loading the Windows recovery environment, disabling the Windows recovery environment, clearing Windows event logs, killing the mhyprot2 service and deleting it, and lastly, starting the ransomware svchost.exe.](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2011.png)

Figure 11. Section 3 of logon.bat, used for disabling the boot loader from loading the Windows recovery environment, disabling the Windows recovery environment, clearing Windows event logs, killing the mhyprot2 service and deleting it, and lastly, starting the ransomware svchost.exe.

Surprisingly, executing *logon.bat* worked and the ransomware *svchost.exe* began dropping ransom notes and encrypting files. Knowing this, the threat actor hosted three files necessary for mass deployment on a shared folder named “lol”: *mhyprot2.sys*, *kill\_svc.exe* (for killing antivirus services), and *svchost.exe* (the ransomware).

![Figure 12. The share folder containing the necessary component files for mass deployment](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2012.png)

Figure 12. The share folder containing the necessary component files for mass deployment

A batch file named *“b.bat” (C:\Users\{compromised user}\Desktop\b.bat)*, responsible for copying and executing the files mentioned above, was deployed via PsExec using the credentials of the built-in domain administrator account. It listed target workstations in the *file ip.txt*.

![Figure 13. Partial contents of b.bat (modified multiple times by the threat actor)](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2013.png)

Figure 13. Partial contents of b.bat (modified multiple times by the threat actor)

![Figure 14. The threat actor deploying b.bat to other workstations](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2014.png)

Figure 14. The threat actor deploying b.bat to other workstations

A closer look at mhyprot2.sys

The driver *mhyprot2.sys* is loaded by *kill\_svc.exe/HelpPane.exe* using the *NtOpenFile* function.

![Figure 15. The driver mhyprot2.sys loaded by kill_svc.exe/HelpPane.exe](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2015.png)

Figure 15. The driver mhyprot2.sys loaded by kill\_svc.exe/HelpPane.exe

After loading *mhyprot2.sys, kill\_svc.exe/HelpPane.exe* checks a list of processes to be terminated.

![Figure 16. A list of processes to be terminated as checked by kill_svc.exe/HelpPane.exe](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2016.png)

Figure 16. A list of processes to be terminated as checked by kill\_svc.exe/HelpPane.exe

Afterward, it passes this information to the driver using the *DeviceIoControl* function.

![Figure 17. The DeviceIoControl function](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2017.png)

Figure 17. The DeviceIoControl function

The control code *0x81034000* is sent to the driver, instructing it to terminate the processes in the list.

![Figure 18. The mhyprot2.sys case function](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2018.png)

Figure 18. The mhyprot2.sys case function

![Figure 19. ZwTerminateProcess inside 0x81034000, which terminates a process and all of its threads](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2019.png)

Figure 19. ZwTerminateProcess inside 0x81034000, which terminates a process and all of its threads

The *mhyprot2.sys* driver that was found in this sequence was the one built in August 2020. Going back to social media streams, we can see that shortly after Genshin Impact was released in September 2020, this module was discussed in the gaming community because it was [not removed even after the game was uninstalled](https://www.gamepur.com/guides/does-genshin-impact-have-spyware) and because it [allowed bypassing of privileges](https://www.unknowncheats.me/forum/anti-cheat-bypass/419457-mhyprot2-read-process-kernel-memory-valid-signature-driver-2.html).

[A PoC](https://github.com/kagurazakasanae/Mhyprot2DrvControl), provided by user [kagurazakasanae](https://github.com/kagurazakasanae/Mhyprot2DrvControl), showed that a library terminated 360 Total Security. A more comprehensive [PoC](https://github.com/kkent030315/evil-mhyprot-cli), provided by [Kento Oki](https://github.com/kkent030315), had the following capabilities:

* Read/Write any kernel memory with privilege of kernel from user mode.
* Read/Write any user memory with privilege of kernel from user mode.
* Enumerate a number of modules by specific process id.
* Get system uptime.
* Enumerate threads in a specific process, allowing reading of the PETHREAD structure in the kernel directly from the command-line interface (CLI).
* Terminate a specific process by process id with *ZwTerminateProcess*, which calls in the vulnerable driver context (*ring-0*).

The issue was also reported by Kento Oki to miHoYo, the developer of Genshin Impact, as a vulnerability. Kento Oki’s PoC led to more discussions, but the provider did not acknowledge the issue as a vulnerability and did not provide a fix. Of course, the code-signing certificate is still valid and has not been revoked until now and the digital signature for code signing as a device driver is still valid at this time.

Complications of code signing as a device driver

It is still rare to find a module with code signing as a device driver that can be abused. The point of this case is that a legitimate device driver module with valid code signing has the capability to bypass privileges from user mode to kernel mode. Even if a vendor acknowledges a privilege bypass as a vulnerability and provides a fix, the module cannot be erased once distributed. This file has a code signature for the driver, which allows this module to be loaded in kernel mode. If the signature was signed for a malicious module through private key theft, the certificate can be revoked to invalidate the signature. However, in this case, it is an abuse of a legitimate module. It seems that there is no compromise of the private key, so it is still not known if the certificate will be revoked. It remains valid, at least for now.

As mentioned above, this module is very easy to obtain and will be available to everyone until it is erased from existence. It could remain for a long time as a useful utility for bypassing privileges. Certificate revocation and antivirus detection might help to discourage the abuse, but there are no solutions at this time because it is a legitimate module.

How to counter abuse: monitoring and detection

There are only a limited number of driver files with valid signatures that are expected to have behavior comparable to the privilege bypassing we report here. We recommend that security teams and network defenders monitor the presence of the hash values within their organizations. We have confirmed that privilege bypassing is possible in at least this file:

* *mhyprot2.sys* (0466e90bf0e83b776ca8716e01d35a8a2e5f96d3)

In addition, we recommend monitoring Windows event logs for the installation of the service corresponding to the driver. If the installation of the service was not intended, compromise is strongly suspected:

* Windows Event Log (System) – 7045: A new service was installed in the system. Service name: *mhyprot2*.

![Figure 20. The properties of Windows Event Log (System) – 7045](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2020.png)

Figure 20. The properties of Windows Event Log (System) – 7045

Recommendations and solutions

Ransomware operators are continuously looking for ways to covertly deploy their malware onto users’ devices. Using popular games or other sources of entertainment is an effective way of baiting victims into downloading dangerous files. It is important for enterprises and organizations to monitor what software is being deployed onto their machines or have the proper solutions in place that can prevent an infection from happening.

Users and organizations can also benefit from security solutions that offer multilayered detection and response such as [Trend Micro Vision One™](/en_us/business/products/detection-response.html), which has multilayered protection and behavior detection capabilities that help block suspicious behavior and tools before ransomware can do any damage. [Trend Micro Apex One™](/en_us/business/products/user-protection/sps/endpoint.html) also provides next-level automated threat detection and response to protect endpoints against advanced issues, like human-operated ransomware.

For more information on the indicators of compromise, download this [document](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/IOCs-blog-Ransomware%20Actor%20Abuses%20Genshin%20Impact%20Anti-Cheat%20Driver%20to%20Kill%20Antivirus.txt).

***With additional insights from Nathaniel Gregory Ragasa and Eleazar Valles***

MITRE ATT&CK tactics and techniques

![Mitre Attack Tactics and Techniques](/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20-%20Mitre_1.png)

Tags
[Endpoints](/en_us/research.html?category=trend-micro-research:environments/endpoints)
|
[Exploits & Vulnerabilities](/en_us/research.html?category=trend-micro-research:threats/exploits-and-vulnerabilities)
|
[Research](/en_us/research.html?category=trend-micro-research:article-type/research)
|
[Ransomware](/en_us/research.html?category=trend-micro-research:threats/ransomware)
|
[Articles, News, Reports](/en_us/research.html?category=trend-micro-research:medium/article)

### Authors

* Ryan Soliven

  Incident Response Analyst
* Hitomi Kimura

  Incident Response Analyst

Contact Us

### Related Articles

* [IoT Botnet Linked to Large-scale DDoS Attacks Since the End of 2024](/en_us/research/25/a/iot-botnet-linked-to-ddos-attacks.html)
* [Investigating A Web Shell Intrusion With Trend Micro™ Managed XDR](/en_us/research/25/a/investigating-a-web-shell-intrusion-with-trend-micro--managed-xd.html)
* [How Cracks and Installers Bring Malware to Your Device](/en_us/research/25/a/how-cracks-and-installers-bring-malware-to-your-device.html)

[See all articles](/en_us/research.html)

### Resources

* [Blog](/en_us/research.html)
* [Newsroom](https://newsroom.trendmicro.com/)
* [Threat Reports](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/threat-reports)
* [Find a Partner](https://partner.trendmicro.com/partner-locator-home/)

### Support

* [Business Support Portal](https://success.trendmicro.com/en-US/)
* [Contact Us](/en_us/business/get-info-form.html)
* [Downloads](/en_us/business/products/downloads.html)
* [Free Trials](/en_us/business/products/trials.html)

### About Trend

* [About Us](/en_us/about.html)
* [Careers](/en_us/about/careers.html)
* [Locations](/en_us/contact.html)
* [Upcoming Events](/en_us/about/events.html)
* [Trust Center](/en_us/about/trust-center.html)

### Country Headquarters

* Trend Micro - United States (US)
* 225 East John Carpenter Freeway

  Suite 1500

  Irving,
  Texas 75062
* Phone:: +1 (817) 569-8900

Select a country / region

expand\_more

close
#### The Americas

* [United States](/en_us.html)
* [Brasil](/pt_br.html)
* [Canada](/en_ca.html)
* [México](/es_mx.html)

#### Middle East & Africa

* [South Africa](/en_za.html)
* [Middle East and North Africa](/en_ae.html)

#### Europe

* [België (Belgium)](/en_be.html)
* [Česká Republika](http://www.trendmicro.cz/)
* [Danmark](/en_dk.html)
* [Deutschland, Österreich Schweiz](/de_de.html)
* [España](/es_es.html)
* [France](/fr_fr.html)
* [Ireland](/en_ie.html)
* [Italia](/it_it.html)
* [Nederland](/en_nl.html)
* [Norge (Norway)](/en_no.html)
* [Polska (Poland)](/pl_pl.html)
* [Suomi (Finland)](/en_fi.html)
* [Sverige (Sweden)](/en_se.html)
* [Türkiye (Turkey)](/tr_tr.html)
* [United Kingdom](/en_gb.html)

#### Asia & Pacific

* [Australia](/en_au.html)
* [Центральная Азия (Central Asia)](/ru_ru.html)
* [Hong Kong (English)](/en_hk.html)
* [香港 (中文) (Hong Kong)](/zh_hk.html)
* [भारत गणराज्य (India)](/en_in.html)
* [Indonesia](/in_id.html)
* [日本 (Japan)](/ja_jp.html)
* [대한민국 (South Korea)](/ko_kr/business.html)
* [Malaysia](/en_my.html)
* [Монголия (Mongolia) and рузия (Georgia)](/en_us.html)
* [New Zealand](/en_nz.html)
* [Philippines](/en_ph.html)
* [Singapore](/en_sg.html)
* [台灣 (Taiwan)](/zh_tw.html)
* [ประเทศไทย (Thailand)](/th_th.html)
* [Việt Nam](/vi_vn.html)

Experience our unified platform for free

* [Claim your 30-day trial](/en_us/business/products/trials.html)

* [Privacy](/en_us/about/trust-center/privacy.html)
* [Legal](/en_us/about/legal.html)
* [Accessibility](/en_us/about/legal/accessibility-policy.html)
* [Terms of Use](/en_us/about/legal/terms-of-use.html)
* [Sitemap](/en_us/business/sitemap.html)

Copyright ©2025 Trend Micro Incorporated. All rights reserved.

sXpIBdPeKzI9PC2p0SWMpUSM2NSxWzPyXTMLlbXmYa0R20xk



=== Content from github.com_a062eb8b_20250119_110645.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkagurazakasanae%2FMhyprot2DrvControl)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkagurazakasanae%2FMhyprot2DrvControl)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=kagurazakasanae%2FMhyprot2DrvControl)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kagurazakasanae](/kagurazakasanae)
/
**[Mhyprot2DrvControl](/kagurazakasanae/Mhyprot2DrvControl)**
Public

* [Notifications](/login?return_to=%2Fkagurazakasanae%2FMhyprot2DrvControl) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fkagurazakasanae%2FMhyprot2DrvControl)
* [Star
   344](/login?return_to=%2Fkagurazakasanae%2FMhyprot2DrvControl)

A lib that allows using mhyprot2 driver for enum process modules, r/w process memory and kill process.

### License

[MIT license](/kagurazakasanae/Mhyprot2DrvControl/blob/main/LICENSE)

[344
stars](/kagurazakasanae/Mhyprot2DrvControl/stargazers) [84
forks](/kagurazakasanae/Mhyprot2DrvControl/forks) [Branches](/kagurazakasanae/Mhyprot2DrvControl/branches) [Tags](/kagurazakasanae/Mhyprot2DrvControl/tags) [Activity](/kagurazakasanae/Mhyprot2DrvControl/activity)
 [Star](/login?return_to=%2Fkagurazakasanae%2FMhyprot2DrvControl)

 [Notifications](/login?return_to=%2Fkagurazakasanae%2FMhyprot2DrvControl) You must be signed in to change notification settings

* [Code](/kagurazakasanae/Mhyprot2DrvControl)
* [Issues
  1](/kagurazakasanae/Mhyprot2DrvControl/issues)
* [Pull requests
  0](/kagurazakasanae/Mhyprot2DrvControl/pulls)
* [Actions](/kagurazakasanae/Mhyprot2DrvControl/actions)
* [Projects
  0](/kagurazakasanae/Mhyprot2DrvControl/projects)
* [Security](/kagurazakasanae/Mhyprot2DrvControl/security)
* [Insights](/kagurazakasanae/Mhyprot2DrvControl/pulse)

Additional navigation options

* [Code](/kagurazakasanae/Mhyprot2DrvControl)
* [Issues](/kagurazakasanae/Mhyprot2DrvControl/issues)
* [Pull requests](/kagurazakasanae/Mhyprot2DrvControl/pulls)
* [Actions](/kagurazakasanae/Mhyprot2DrvControl/actions)
* [Projects](/kagurazakasanae/Mhyprot2DrvControl/projects)
* [Security](/kagurazakasanae/Mhyprot2DrvControl/security)
* [Insights](/kagurazakasanae/Mhyprot2DrvControl/pulse)

# kagurazakasanae/Mhyprot2DrvControl

    main[Branches](/kagurazakasanae/Mhyprot2DrvControl/branches)[Tags](/kagurazakasanae/Mhyprot2DrvControl/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[7 Commits](/kagurazakasanae/Mhyprot2DrvControl/commits/main/) | | |
| [Driver](/kagurazakasanae/Mhyprot2DrvControl/tree/main/Driver "Driver") | | [Driver](/kagurazakasanae/Mhyprot2DrvControl/tree/main/Driver "Driver") |  |  |
| [Properties](/kagurazakasanae/Mhyprot2DrvControl/tree/main/Properties "Properties") | | [Properties](/kagurazakasanae/Mhyprot2DrvControl/tree/main/Properties "Properties") |  |  |
| [Utils](/kagurazakasanae/Mhyprot2DrvControl/tree/main/Utils "Utils") | | [Utils](/kagurazakasanae/Mhyprot2DrvControl/tree/main/Utils "Utils") |  |  |
| [.gitignore](/kagurazakasanae/Mhyprot2DrvControl/blob/main/.gitignore ".gitignore") | | [.gitignore](/kagurazakasanae/Mhyprot2DrvControl/blob/main/.gitignore ".gitignore") |  |  |
| [App.config](/kagurazakasanae/Mhyprot2DrvControl/blob/main/App.config "App.config") | | [App.config](/kagurazakasanae/Mhyprot2DrvControl/blob/main/App.config "App.config") |  |  |
| [LICENSE](/kagurazakasanae/Mhyprot2DrvControl/blob/main/LICENSE "LICENSE") | | [LICENSE](/kagurazakasanae/Mhyprot2DrvControl/blob/main/LICENSE "LICENSE") |  |  |
| [MhyProt2Drv.csproj](/kagurazakasanae/Mhyprot2DrvControl/blob/main/MhyProt2Drv.csproj "MhyProt2Drv.csproj") | | [MhyProt2Drv.csproj](/kagurazakasanae/Mhyprot2DrvControl/blob/main/MhyProt2Drv.csproj "MhyProt2Drv.csproj") |  |  |
| [MhyProt2Drv.sln](/kagurazakasanae/Mhyprot2DrvControl/blob/main/MhyProt2Drv.sln "MhyProt2Drv.sln") | | [MhyProt2Drv.sln](/kagurazakasanae/Mhyprot2DrvControl/blob/main/MhyProt2Drv.sln "MhyProt2Drv.sln") |  |  |
| [Program.cs](/kagurazakasanae/Mhyprot2DrvControl/blob/main/Program.cs "Program.cs") | | [Program.cs](/kagurazakasanae/Mhyprot2DrvControl/blob/main/Program.cs "Program.cs") |  |  |
| [README.md](/kagurazakasanae/Mhyprot2DrvControl/blob/main/README.md "README.md") | | [README.md](/kagurazakasanae/Mhyprot2DrvControl/blob/main/README.md "README.md") |  |  |
| [demo.png](/kagurazakasanae/Mhyprot2DrvControl/blob/main/demo.png "demo.png") | | [demo.png](/kagurazakasanae/Mhyprot2DrvControl/blob/main/demo.png "demo.png") |  |  |
| [killprocessdemo.gif](/kagurazakasanae/Mhyprot2DrvControl/blob/main/killprocessdemo.gif "killprocessdemo.gif") | | [killprocessdemo.gif](/kagurazakasanae/Mhyprot2DrvControl/blob/main/killprocessdemo.gif "killprocessdemo.gif") |  |  |
| [mhyprot2.Sys](/kagurazakasanae/Mhyprot2DrvControl/blob/main/mhyprot2.Sys "mhyprot2.Sys") | | [mhyprot2.Sys](/kagurazakasanae/Mhyprot2DrvControl/blob/main/mhyprot2.Sys "mhyprot2.Sys") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# Mhyprot2DrvControl

A lib that allows using mhyprot2 driver for enum process modules, r/w process memory and kill process.

# Usage

Build and run, see Driver\MhyProt2.cs for available function and usage.

# Demo

[![Demo](https://raw.githubusercontent.com/kagurazakasanae/Mhyprot2DrvControl/main/demo.png)](https://raw.githubusercontent.com/kagurazakasanae/Mhyprot2DrvControl/main/demo.png)
[![KillProcessDemo](https://raw.githubusercontent.com/kagurazakasanae/Mhyprot2DrvControl/main/killprocessdemo.gif)](https://raw.githubusercontent.com/kagurazakasanae/Mhyprot2DrvControl/main/killprocessdemo.gif)

## About

A lib that allows using mhyprot2 driver for enum process modules, r/w process memory and kill process.

### Topics

[windows](/topics/windows "Topic: windows")
[kernel](/topics/kernel "Topic: kernel")
[driver](/topics/driver "Topic: driver")
[vulnerable](/topics/vulnerable "Topic: vulnerable")
[mhyprot2](/topics/mhyprot2 "Topic: mhyprot2")

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/kagurazakasanae/Mhyprot2DrvControl/activity)
### Stars

[**344**
stars](/kagurazakasanae/Mhyprot2DrvControl/stargazers)
### Watchers

[**7**
watching](/kagurazakasanae/Mhyprot2DrvControl/watchers)
### Forks

[**84**
forks](/kagurazakasanae/Mhyprot2DrvControl/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fkagurazakasanae%2FMhyprot2DrvControl&report=kagurazakasanae+%28user%29)

## [Releases](/kagurazakasanae/Mhyprot2DrvControl/releases)

No releases published

## [Packages 0](/users/kagurazakasanae/packages?repo_name=Mhyprot2DrvControl)

No packages published

## Languages

* [C#
  100.0%](/kagurazakasanae/Mhyprot2DrvControl/search?l=c%23)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from web.archive.org_6c24e00e_20250119_110647.html ===


[![Wayback Machine](/_static/images/toolbar/wayback-toolbar-logo-200.png)](/web/ "Wayback Machine home page")

[9 captures](/web/20211204031301%2A/https%3A//www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "See a list of every capture for this URL")
29 May 2021 - 16 Mar 2022

| [**Oct**](https://web.archive.org/web/20211022132830/https%3A//www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "22 Oct 2021") | DEC | [**Mar**](https://web.archive.org/web/20220316071424/https%3A//www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "16 Mar 2022") |
| [Previous capture](https://web.archive.org/web/20211022132830/https%3A//www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "13:28:30 Oct 22, 2021") | 04 | [Next capture](https://web.archive.org/web/20220316071424/https%3A//www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "07:14:24 Mar 16, 2022") |
| 2020 | 2021 | 2022 |

success
fail

 [About this capture](#expand)

COLLECTED BY

Collection: [Save Page Now Outlinks](https://archive.org/details/save-page-now-outlinks)

TIMESTAMPS

![loading](/_static/images/loading.gif)

The Wayback Machine - https://web.archive.org/web/20211204031301/https://www.godeye.club/2021/05/20/001-disclosure-mhyprot.html

![og-image](/web/20211204031301im_/https://www.godeye.club/assets/images/post/091730ece4fbf78beba3d5785d7cd960.png)

[Members](/web/20211204031301/https%3A//www.godeye.club/members/)[Disclaimer](/web/20211204031301/https%3A//www.godeye.club/disclaimer.html)

![](/web/20211204031301im_/https://www.godeye.club/assets/images/thumbnails/genshin.jpg)
# Disclosure: The Mhyprot Vulnerability - Genshin Impact

May 20, 2021

* windows
* mhyprot

[![](https://web.archive.org/web/20211204031301im_/https://avatars.githubusercontent.com/kkent030315)](/web/20211204031301/https%3A//www.godeye.club/members/kento-oki.html)
[Kento Oki](/web/20211204031301/https%3A//www.godeye.club/members/kento-oki.html)

hrn832@protonmail.com

# The Mhyprot Vulnerability - Genshin Impact

Almost over a year ago, I found a vulnerability during analysis of the driver, in `mhyprot2.sys`, windows kernel-mode driver, who responsive for protecting game-process, the [`Genshin Impact`](https://web.archive.org/web/20211204031301/https%3A//genshin.mihoyo.com/) by [Mihoyo](https://web.archive.org/web/20211204031301/https%3A//genshin.mihoyo.com/en/company/about).

`mhyprot` is a part of components of the client-sided anti-cheat approach.

As the `kernel-mode` drivers have *system-level privilege*, it’s often provoke controversy about user’s privacy and its mainly called `rootkit` as Riot’s `Vanguard`, `BattlEye` and `EasyAntiCheat` does.

To clarify: I personally **do not think** these are *”Rootkit”* since I am one of the anti-cheat developer who knows what he is doing. It is necessary to have *system-level privilege* to prevent from cheating. but in other hand, it is clear it also necessary to protect user’s privacy aswell.

# Why

After a while, I submitted this vulnerability to the vendor, Mihoyo. And I thought that this vulnerability will be fixed very early.

Let me get straight to the point, **the vendor does not respond** or even acknowledge it.

## PoC - Proof of Concept

Then I published it to the my github repository, as

* `PoC` `evil-mhyprot-cli` - ([https://github.com/kkent030315/evil-mhyprot-cli](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli))
* `PoC` `libmhyprot` - ([https://github.com/kkent030315/libmhyprot](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/libmhyprot))

repositories were published at *Oct 2020*. after a while, I decided to took down it, for personal reasons.

Also were popular and made a lot of duscussions.

* [MiHoYo’s anticheat software (mhyprot) used in Genshin Impact has been proven vulnerable, but I do not see it addressed anywhere.](https://web.archive.org/web/20211204031301/https%3A//www.reddit.com/r/Genshin_Impact/comments/jhv4qk/mihoyos_anticheat_software_mhyprot_used_in/)

> Some days ago, a couple of PoC (proof of concept) code was shared on GitHub that takes advantage of the kernel-level anticheat Genshin Impact uses to be able to (edit: further, see this comment, my bad) compromise the system.

* [HackerNews Discussion](https://web.archive.org/web/20211204031301/https%3A//news.ycombinator.com/item?id=26762170)

> Genshin Impact’s anti-cheat is not completely secure: you can use it to read/write umode memory / read kmode memory with kernel privileges: https://github.com/ScHaTTeNLiLiE/libmhyprot
> Mirror repo after the original author took the repo down, but still exploitable AFAIK.

But now, the vendor company still not respond or acknowledge it, I’ve decided to publish it again (`May 2021`).

(BTW, those were popular from the beginning and there were many forks)

# Responsible Disclosure

I, Kento Oki, am not the researcher who expect to be financially compensated.

This vulnerability is being published because the vendor does not respond or fixed it after I noticed them.

Contact: [hrn832@protonmail.com](https://web.archive.org/web/20211204031301/mailto%3Ahrn832%40protonmail.com)

# The Vulnerability

The `mhyprot` driver exposes a bunch of IOCTLs that must not be exposed to the user-mode.

For example, the driver could copy kernel virtual memory which could lead to *information-disclosure* (`CWE-200`), *privilege-escalation* (`CWE-269`) and *denial of service* since it could trigger bugcheck intentionally.

As I declared in my PoC repo ([https://github.com/kkent030315/libmhyprot#features](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/libmhyprot#features)),

* Read Arbitrary Kernel Memory
* Read Arbitrary Process Memory
* Write Arbitrary Process Memory
* Get Arbitrary Process Modules
* Get Arbitrary Process Threads
* Get System Uptime
* Terminate Arbitrary Process

are possible with **user-privilege**.

Please note that these features is not the all. I belive there are more vulnerable commands.

And the possible impacts:

* Arbitrary Process Information Disclosure - may lead to `CWE-200`
* Arbitrary Process Virtual Memory R/W - may lead to `CWE-200`, `CWE-269`, `CWE-94`
* Arbitrary Kernel Memory R/W - may lead to `CWE-200`, `CWE-269`, `CWE-94`

Does that really makes you think product that take **user privacy** into consideration?

Also it scored as `8.6` by CVSS calculation.

![CVSS](/web/20211204031301im_/https://www.godeye.club/assets/images/post/abae062b35668a751b3f76495753b558.png)

It feel like the biggest *backdoor* I’ve ever seen before.

## Introduction To The Vulnerable Driver

The `mhyprot` is an anti-cheat kernel mode driver used in [`Genshin Impact`](https://web.archive.org/web/20211204031301/https%3A//genshin.mihoyo.com/ja).

The driver has vulnerable `IOCTL` commands that allows attackers to execute improperly from ring-3 (usermode),

without privileges that usually needed to be granted by OS system.

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/mhyprot.png)

### Usermode Module

Driver’s device handle is opened by the game process `GenshinImpact.exe`.

![IMAGE](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image15.png)

## Driver Initialization

The `MHYPROT_IOCTL_INITIALIZE` what I defined in [mhyprot.hpp](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli/blob/main/src/mhyprot.hpp) can be found as follows:

```
PAGE:FFFFF800188CD8FD loc_FFFFF800188CD8FD:                   ; CODE XREF: sub_FFFFF800188CD6E0+213↑j
PAGE:FFFFF800188CD8FD                 cmp     ecx, 80034000h  ; MHYPROT_IOCTL_INITIALIZE
PAGE:FFFFF800188CD903                 jnz     short loc_FFFFF800188CD984
PAGE:FFFFF800188CD905                 cmp     r8d, 10h
PAGE:FFFFF800188CD909                 jnz     loc_FFFFF800188CDA4F
PAGE:FFFFF800188CD90F                 mov     rax, 0EBBAAEF4FFF89042h // <- _m_002
PAGE:FFFFF800188CD919                 xor     [rdi+8], rax
PAGE:FFFFF800188CD91D                 mov     rax, [rdi+8]
PAGE:FFFFF800188CD921                 xor     [rdi], rax
PAGE:FFFFF800188CD924                 cmp     dword ptr [rdi+4], 0BAEBAEECh // <- _m_001
PAGE:FFFFF800188CD92B                 jnz     loc_FFFFF800188CDA4F
PAGE:FFFFF800188CD931                 mov     ecx, [rdi]
PAGE:FFFFF800188CD933                 call    sub_FFFFF800188C51A8
PAGE:FFFFF800188CD938                 cmp     dword ptr cs:qword_FFFFF800188CA108, 0
PAGE:FFFFF800188CD93F                 jnz     short loc_FFFFF800188CD97D
PAGE:FFFFF800188CD941                 mov     rdx, [rdi+8]
PAGE:FFFFF800188CD945                 lea     rcx, xmmword_FFFFF800188CA0E8
PAGE:FFFFF800188CD94C                 call    sub_FFFFF800188C301C // <-
PAGE:FFFFF800188CD951                 mov     ebx, 7

```

and the `sub_FFFFF800188C301C` is look like:

```
.text:FFFFF800188C301C ; =============== S U B R O U T I N E =======================================
.text:FFFFF800188C301C
.text:FFFFF800188C301C
.text:FFFFF800188C301C sub_FFFFF800188C301C proc near          ; CODE XREF: sub_FFFFF800188CD6E0+26C↓p
.text:FFFFF800188C301C                                         ; DATA XREF: .upx0:FFFFF800189F2BA8↓o
.text:FFFFF800188C301C
.text:FFFFF800188C301C arg_0           = qword ptr  8
.text:FFFFF800188C301C
.text:FFFFF800188C301C                 test    rcx, rcx
.text:FFFFF800188C301F                 jz      locret_FFFFF800188C30B4
.text:FFFFF800188C3025                 mov     [rsp+arg_0], rbx
.text:FFFFF800188C302A                 push    rdi
.text:FFFFF800188C302B                 sub     rsp, 20h
.text:FFFFF800188C302F                 xor     eax, eax
.text:FFFFF800188C3031                 mov     rdi, rdx
.text:FFFFF800188C3034                 mov     [rcx], rax
.text:FFFFF800188C3037                 mov     rbx, rcx
.text:FFFFF800188C303A                 mov     [rcx+8], rax
.text:FFFFF800188C303E                 mov     edx, 9C0h       ; NumberOfBytes
.text:FFFFF800188C3043                 xor     ecx, ecx        ; PoolType
.text:FFFFF800188C3045                 call    cs:ExAllocatePool
.text:FFFFF800188C304B                 xor     edx, edx
.text:FFFFF800188C304D                 mov     r8d, 9C0h
.text:FFFFF800188C3053                 mov     rcx, rax
.text:FFFFF800188C3056                 mov     [rbx], rax
.text:FFFFF800188C3059                 call    sub_FFFFF800188C7900
.text:FFFFF800188C305E                 mov     rax, [rbx]
.text:FFFFF800188C3061                 mov     r9d, 1
.text:FFFFF800188C3067                 mov     [rbx+0Ch], r9d
.text:FFFFF800188C306B                 mov     [rax], rdi
.text:FFFFF800188C306E                 mov     [rbx+8], r9d
.text:FFFFF800188C3072
.text:FFFFF800188C3072 loc_FFFFF800188C3072:                   ; CODE XREF: sub_FFFFF800188C301C+8C↓j
.text:FFFFF800188C3072                 movsxd  r8, dword ptr [rbx+8]
.text:FFFFF800188C3076                 mov     rdx, [rbx]
.text:FFFFF800188C3079                 mov     rax, [rdx+r8*8-8]
.text:FFFFF800188C307E                 mov     rcx, rax
.text:FFFFF800188C3081                 shr     rcx, 3Eh
.text:FFFFF800188C3085                 xor     rcx, rax
.text:FFFFF800188C3088                 mov     rax, 5851F42D4C957F2Dh
.text:FFFFF800188C3092                 imul    rcx, rax
.text:FFFFF800188C3096                 add     rcx, r8
.text:FFFFF800188C3099                 mov     [rdx+r8*8], rcx
.text:FFFFF800188C309D                 add     [rbx+8], r9d
.text:FFFFF800188C30A1                 cmp     dword ptr [rbx+8], 138h
.text:FFFFF800188C30A8                 jl      short loc_FFFFF800188C3072
.text:FFFFF800188C30AA                 mov     rbx, [rsp+28h+arg_0]
.text:FFFFF800188C30AF                 add     rsp, 20h
.text:FFFFF800188C30B3                 pop     rdi
.text:FFFFF800188C30B4
.text:FFFFF800188C30B4 locret_FFFFF800188C30B4:                ; CODE XREF: sub_FFFFF800188C301C+3↑j
.text:FFFFF800188C30B4                 retn
.text:FFFFF800188C30B4 sub_FFFFF800188C301C endp

```
## Copy Arbitrary Kernel Memory

There are so many IOCTL commands and the `MHYPROT_IOCTL_READ_KERNEL_MEMORY` what I defined in [mhyprot.hpp](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli/blob/main/src/mhyprot.hpp) can be found as follows:

```
PAGE:FFFFF800188CD7A9 loc_FFFFF800188CD7A9:                   ; CODE XREF: sub_FFFFF800188CD6E0+BA↑j
PAGE:FFFFF800188CD7A9                 cmp     ecx, 83064000h  ; MHYPROT_IOCTL_READ_KERNEL_MEMORY
PAGE:FFFFF800188CD7AF                 jnz     short loc_FFFFF800188CD7C8
PAGE:FFFFF800188CD7B1                 mov     rdx, [rdi]
PAGE:FFFFF800188CD7B4                 lea     rcx, [rdi+4]
PAGE:FFFFF800188CD7B8                 mov     r8d, [rdi+8]
PAGE:FFFFF800188CD7BC                 call    sub_FFFFF800188C63A8 // <-

```

And the `sub_FFFFF800188C63A8` is like:

```
.text:FFFFF800188C63A8 sub_FFFFF800188C63A8 proc near          ; CODE XREF: sub_FFFFF800188CD6E0+DC↓p
.text:FFFFF800188C63A8                                         ; DATA XREF: .upx0:FFFFF800189F2EE4↓o
.text:FFFFF800188C63A8
.text:FFFFF800188C63A8 arg_0           = qword ptr  8
.text:FFFFF800188C63A8 arg_8           = qword ptr  10h
.text:FFFFF800188C63A8
.text:FFFFF800188C63A8                 mov     [rsp+arg_0], rbx
.text:FFFFF800188C63AD                 mov     [rsp+arg_8], rsi
.text:FFFFF800188C63B2                 push    rdi
.text:FFFFF800188C63B3                 sub     rsp, 20h
.text:FFFFF800188C63B7                 mov     edi, r8d
.text:FFFFF800188C63BA                 mov     rbx, rdx
.text:FFFFF800188C63BD                 mov     rsi, rcx
.text:FFFFF800188C63C0                 test    rdx, rdx
.text:FFFFF800188C63C3                 jz      short loc_FFFFF800188C63F2
.text:FFFFF800188C63C5                 test    r8d, r8d
.text:FFFFF800188C63C8                 jz      short loc_FFFFF800188C63F2
.text:FFFFF800188C63CA                 mov     rax, cs:MmHighestUserAddress
.text:FFFFF800188C63D1                 cmp     rdx, [rax]
.text:FFFFF800188C63D4                 jb      short loc_FFFFF800188C63F2
.text:FFFFF800188C63D6                 mov     r8d, edi
.text:FFFFF800188C63D9                 xor     edx, edx
.text:FFFFF800188C63DB                 call    sub_FFFFF800188C7900
.text:FFFFF800188C63E0                 mov     r8d, edi
.text:FFFFF800188C63E3                 mov     rdx, rsi
.text:FFFFF800188C63E6                 mov     rcx, rbx
.text:FFFFF800188C63E9                 call    sub_FFFFF800188C3DD8
.text:FFFFF800188C63EE                 xor     eax, eax
.text:FFFFF800188C63F0                 jmp     short loc_FFFFF800188C63F5

```

Here is the ioctl handlers, found the `0x83064000`(`MHYPROT_IOCTL_READ_KERNEL_MEMORY`) as `cmp ecx, 83064000h` and some another ioctl codes as follows:

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image02.png)

### Call map

As I defined as `DWORD result` in [mhyprot.hpp](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli/blob/main/src/mhyprot.hpp) the first 4bytes is result.

I can guess it’s a `NTSTATUS` as it typedef’ed as `typedef LONG NTSTATUS` natively and the dispathers return types are `NTSTATUS` and the result will directly be got stored from it.

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image07.png)

## Copy Arbitrary Process Memory

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image16.png)

The mhyprot calls `MmCopyVirtualMemory` eventually as wrapper defined as follows:

```
__int64 __fastcall sub_FFFFF800188C3EB8(struct _EPROCESS *a1, _DWORD *a2, __int64 a3)
{
  __int64 v3; // rbp
  _DWORD *v4; // rdi
  struct _EPROCESS *v5; // rbx
  PEPROCESS v6; // rsi
  char v8; // [rsp+28h] [rbp-20h]

  v3 = a3;
  v4 = a2;
  v5 = a1;
  if ( *a2 == 1 )
  {
    v6 = IoGetCurrentProcess();
  }
  else
  {
    v6 = a1;
    v5 = IoGetCurrentProcess();
  }
  v8 = 0;
  return MmCopyVirtualMemory(v6, *((_QWORD *)v4 + 3), v5, *((_QWORD *)v4 + 2), (unsigned int)v4[8], v8, v3);
}

```

Called by:

```
__int64 __fastcall sub_FFFFF800188C3F2C(_DWORD *a1_rw_request, __int64 a2_returnsize, __int64 a3)
{
  __int64 v3_returnsize; // rsi
  _DWORD *v4_rw_request; // rbx
  __int64 v5_processid; // rcx
  bool v6_ntstatus_lookup_success_bool; // di
  unsigned int v8_ntstatus; // ebx
  PVOID Object; // [rsp+40h] [rbp+8h]

  v3_returnsize = a2_returnsize;
  v4_rw_request = a1_rw_request;
  v5_processid = (unsigned int)a1_rw_request[2];
  Object = 0i64;
  v6_ntstatus_lookup_success_bool = (int)PsLookupProcessByProcessId(v5_processid, &Object, a3) >= 0;// NT_SUCCESS
  if ( !Object )
    return 3221225473i64;
  v8_ntstatus = sub_FFFFF800188C3EB8((struct _EPROCESS *)Object, v4_rw_request, v3_returnsize);
  if ( v6_ntstatus_lookup_success_bool )
    ObfDereferenceObject(Object);
  return v8_ntstatus;
}

```

Called by:

```
bool __fastcall sub_FFFFF800188C4214(_DWORD *a1_rw_request, _DWORD *a2_returnsize, __int64 a3)
{
  _DWORD *v3_returnsize; // rbx
  int v5_ntstatus; // [rsp+20h] [rbp-18h]
  __int64 v6_returnsize; // [rsp+50h] [rbp+18h]

  v3_returnsize = a2_returnsize;
  v6_returnsize = 0i64;
  v5_ntstatus = sub_FFFFF800188C3F2C(a1_rw_request, (__int64)&v6_returnsize, a3);
  *v3_returnsize = v6_returnsize;
  return v5_ntstatus == 0;                      // NT_SUCCESS(v5_ntstatus)
}

```

Finally we are at the root of the tree, this is in the packed segment and is in encryption-dedicated IOCTL handler function:

```
PAGE:FFFFF800188CD303 loc_FFFFF800188CD303:                   ; CODE XREF: sub_FFFFF800188CD000+2C7↑j
PAGE:FFFFF800188CD303                 and     dword ptr [rbp+1D0h+arg_20], 0
PAGE:FFFFF800188CD30A                 lea     rdx, [rbp+1D0h+arg_20]
PAGE:FFFFF800188CD311                 mov     rcx, [rsp+30h]
PAGE:FFFFF800188CD316                 call    sub_FFFFF800188C4214 // <- Here
PAGE:FFFFF800188CD31B                 jmp     loc_FFFFF800188CD21C

```
### Call map

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image06.png)

### Proof

I have confirmed that by simply hooking mhyprot kernel module:

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image08.png)

## Enumerate Process Modules

The driver has a lots of commands that make us advantage.

In this case, we are able to enumerate modules that loaded in the target process by process id and a number which specifies we want to get.

I’ll explain herewith below how I made it managed to work it with reverse engineering.

The implementation can be found at [mhyprot.cpp#L343](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli/blob/main/src/mhyprot.cpp#L343).

First of all, As you can see there is `cmp ecx, 82054000h` as I defined in [mhyprot.hpp](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli/blob/main/src/mhyprot.hpp) as `MHYPROT_IOCTL_ENUM_PROCESS_MODULES`.

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/IDA/imgs/image10.png)

And it calls:

```
__int64 __fastcall sub_FFFFF800188C26D0(unsigned int a1, __int64 a2, __int64 a3)
{
  __int64 v3; // rsi
  unsigned int v4; // ebx
  bool v5; // di
  unsigned int v7; // ebx
  PVOID Object; // [rsp+58h] [rbp+20h]

  v3 = a2;
  Object = 0i64;
  v4 = a3;
  v5 = (int)PsLookupProcessByProcessId(a1, &Object, a3) >= 0;
  if ( !Object )
    return 0i64;
  v7 = sub_FFFFF800188C27D4(Object, v3, v4);
  if ( Object )
  {
    if ( v5 )
      ObfDereferenceObject(Object);
  }
  return v7;
}

```

As you can see, the function checks is process `32-bit` or `64-bit` by `PsGetProcessWow64Process()` since `PEB` is different between 32 and 64-bit processes.

In this case, I only talk about for 64-bit process.

After that, the function attaches from kernel using `KeStackAttachProcess`. the second parameter is `PKAPC_STATE`.

Then, call `PsGetProcessPeb` and get the [PEB](https://web.archive.org/web/20211204031301/https%3A//docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb) belongs to the target process.

`LDR_MODULE` is undocumented structure.

```
typedef struct _LDR_MODULE {
  LIST_ENTRY              InLoadOrderModuleList;
  LIST_ENTRY              InMemoryOrderModuleList;
  LIST_ENTRY              InInitializationOrderModuleList;
  PVOID                   BaseAddress;
  PVOID                   EntryPoint;
  ULONG                   SizeOfImage;
  UNICODE_STRING          FullDllName;
  UNICODE_STRING          BaseDllName;
  ULONG                   Flags;
  SHORT                   LoadCount;
  SHORT                   TlsIndex;
  LIST_ENTRY              HashTableEntry;
  ULONG                   TimeDateStamp;
} LDR_MODULE, *PLDR_MODULE;

```

And the function pseudocode for `sub_FFFFF800188C27D4` is like:

```
__int64 __fastcall sub_FFFFF800188C27D4(
  __int64 a1,       // pEPROCESS
  __int64 a2,       // pointer to the buffer that sent from usermode
  unsigned int a3   // max count to get
)
{
  ...

  if ( !a1 )
    return 0i64;

  v9 = ((__int64 (*)(void))PsGetProcessWow64Process)() != 0;
  KeStackAttachProcess(v5, &v30);

  if ( !v9 ) // the process is 64-bit
  {
    v17 = PsGetProcessPeb(v5); // Lookup PEB
    v18 = v17;
    if ( v17 )
    {
      v19 = *(_QWORD *)(v17 + 24); // PEB->Ldr
      if ( v19 )
      {
        for ( j = *(__int64 **)(v19 + 16);
              j != (__int64 *)(*(_QWORD *)(v18 + 24) + 16i64); // PEB->Ldr->InMemoryOrderModuleList.Flink
              j = (__int64 *)*j )
        {
          if ( v7 < v3 ) // if the counter less than a number what we want to get
          {
            v21 = 928i64 * v7; // [IMPORTANT] we can see output structure is 0x3A0 alignment
            sub_FFFFF800188C7900(v21 + v4 + 12, 0i64, 256i64); // fill memory by 0 sizeof 0x100
            sub_FFFFF800188C7900(v21 + v4 + 268, 0i64, 520i64); // fill memory by 0 sizeof 0x208
            *(_QWORD *)(v21 + v4) = j[6];
            *(_DWORD *)(v21 + v4 + 8) = *((_DWORD *)j + 16);
            v22 = *((_WORD *)j + 44);
            v23 = 127i64;
            if ( v22 <= 0x7Fu )
              v23 = v22;
            sub_FFFFF800188C75C0(v21 + v4 + 12, j[12], v23); // copy BaseDllName to the buffer
            v24 = *((_WORD *)j + 36);
            v25 = v24;
            if ( v24 > 0x103u )
              v25 = 259i64;
            sub_FFFFF800188C75C0(v21 + v4 + 268, j[10], v25); // copy FullDllName to the buffer
            *(_QWORD *)(v21 + v4 + 792) = *((unsigned int *)j + 32);
            v3 = v32;
          }
          ++v6; // counter
          ++v7; // counter
        }
      }
    }
  } else { ... /* 32-bit PEB (Redacted) */ }
  KeUnstackDetachProcess(&v30); // detach
  return v6;
}

```

We got a much information from it as follows:

* We can get `BaseDllName` and `FullDllName` using this ioctl command
* What we need is only `ProcessId` and `MaxCount`
* The output buffer will overrided in the request buffer
* The output buffer also must have `0x3A0` size alignment per module

Definition of structure for the payload be like:
(This is defined in [mhyprot.hpp](https://web.archive.org/web/20211204031301/https%3A//github.com/kkent030315/evil-mhyprot-cli/blob/main/src/mhyprot.hpp) as well.)

```
typedef struct _MHYPROT_ENUM_PROCESS_MODULES_REQUEST
{
	uint32_t process_id;
	uint32_t max_count;
} MHYPROT_ENUM_PROCESS_MODULES_REQUEST, * PMHYPROT_ENUM_PROCESS_MODULES_REQUEST;

```

By:

```
if (uVar1_ControlCode == 0x82054000) {
	uVar6 = GetModuleListByProcessId_FUN_000126d0
                // process id
		(*(uint *)puVar3_RequestContext,

                // out buffer, the output will be stored with overriding max count...
		(longlong)(uint *)((longlong)puVar3_RequestContext + 4),

                // max count
		*(uint *)((longlong)puVar3_RequestContext + 4)
		);
	iVar3 = (int)uVar6;
}
...
// mhyprot overrides first 4byte of the payload buffer to identify success or fail
*(int *)puVar3_RequestContext = iVar3;

```

What we need is:

* 1. Allocate memory for payload and its result, `0x3A0` \* `MaxCount`
* 1. Send the payload with the ioctl code `0x82054000`
* 1. Check for the first 4byte

### Proof

I’ve hooked some part of mhyprot kernel module, especially `PsGetProcessPEB` and `PsLookupProcessByProcessId` and confirmed.

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/IDA/imgs/image11.png)

### Call map

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/IDA/imgs/image12.png)

## Enumerate Process Threads

The driver has a vulnerable ioctl that allows us to enumerate threads in specific process as ring-0 privilege.

it also make us able to read kernel structure `PETHREAD` because the ioctl result contains a pointer to it.

to read kernel memory, we are already able to do it through this vulnerable driver as well.

I’ll explain how I made managed to work it with reverse engineering.

First of all, the driver has a function that executes `ZwQuerySystemInformation`.

Here is a block found on ioctl handler subroutine (is in the encryption-dedicated IOCTL handler function):

```
PAGE:FFFFF800188CD77E loc_FFFFF800188CD77E:                   ; CODE XREF: sub_FFFFF800188CD6E0+8C↑j
PAGE:FFFFF800188CD77E                 cmp     ecx, 83024000h
PAGE:FFFFF800188CD784                 jnz     short loc_FFFFF800188CD794
PAGE:FFFFF800188CD786                 lea     rcx, [rdi+4]
PAGE:FFFFF800188CD78A                 mov     rdx, rdi
PAGE:FFFFF800188CD78D                 call    sub_FFFFF800188C62EC
PAGE:FFFFF800188CD792                 jmp     short loc_FFFFF800188CD7C1

```

`sub_FFFFF800188C62EC` is:

```
__int64 __fastcall sub_FFFFF800188C62EC(__int64 a1, _DWORD *a2)
{
  __int64 result; // rax

  if ( *a2 == 136 ) // *a2 == 0x88
    result = sub_FFFFF800188C6488(a2[2], a1, a2[1]);
  else
    result = 0xFFFFFFFFi64;
  return result;
}

```

We are seeing an if statement `if ( *a2 == 136 )`, `136` is `0x88`, if the a2(given by context) is not `0x88`, the driver will returns `0xFFFFFFFF`.

I have no idea what is this validation is even I finished looking around it for a while…

Also `sub_FFFFF800188C6488` is:

```
__int64 __fastcall sub_FFFFF800188C6488(int a1, __int64 a2_OutBuffer, unsigned int a3_ProcessId)
{
  v3_OutBuffer = a2_OutBuffer;
  v4 = a1;
  v5 = a3_ProcessId;
  v6 = -1;
  RtlInitUnicodeString(&SystemRoutineName, L"ZwQuerySystemInformation");
  v7_pZwQuerySystemInformation = (int (__fastcall *)(__int64, __m128 *, _QWORD, SIZE_T *))MmGetSystemRoutineAddress(&SystemRoutineName);
  v8_pZwQuerySystemInformation = v7_pZwQuerySystemInformation;
  if ( v7_pZwQuerySystemInformation )
  {
    LODWORD(NumberOfBytes) = 0;
    if ( v7_pZwQuerySystemInformation(5i64, 0i64, 0i64, &NumberOfBytes) == -1073741820 )// SystemProcessInformation
    {
      if ( (_DWORD)NumberOfBytes )
      {
        v9 = (__m128 *)ExAllocatePool(NonPagedPool, (unsigned int)NumberOfBytes);
        v10_ProcInfo = v9;
        if ( v9 )
        {
          RKM_sub_FFFFF800188C7900(v9, 0, (unsigned int)NumberOfBytes);// fill the memory by 0
          if ( v8_pZwQuerySystemInformation(5i64, v10_ProcInfo, (unsigned int)NumberOfBytes, &NumberOfBytes) >= 0 )// SystemProcessInformation
          {
            v11_ProcInfo = v10_ProcInfo;
            while ( (unsigned __int8)MmIsAddressValid(v11_ProcInfo) )
            {
              if ( v11_ProcInfo[5].m128_i32[0] == v4 )
              {
                v6 = HIDWORD(v11_ProcInfo->m128_u64[0]);
                if ( v6 <= v5 )                 // == ProcessId
                {
                  v13 = 0i64;
                  if ( v6 )
                  {
                    v14 = v3_OutBuffer + 8;     // data offset per item
                    v15 = v11_ProcInfo + 19;
                    do
                    {
                      v16 = v15->m128_u64[0];
                      Object_PETHREAD = 0i64;
                      PsLookupThreadByThreadId(v16, &Object_PETHREAD);
                      v17_PETHREAD = Object_PETHREAD;
                      v18_PETHREAD = Object_PETHREAD;
                      *(_DWORD *)(v14 - 8) = v11_ProcInfo[5].m128_i32[0];
                      *(_DWORD *)(v14 - 4) = v16;
                      *(_QWORD *)v14 = v18_PETHREAD;// set a pointer to the this PETHREAD
                      *(_QWORD *)(v14 + 8) = GetThreadStartAddress_sub_FFFFF800188C68C8((__int64)v18_PETHREAD);// set thread start address
                      *(_QWORD *)(v14 + 16) = sub_FFFFF800188C687C((__int64)v17_PETHREAD);// this actually return PETHREAD+0x400
                      *(_DWORD *)(v14 + 24) = sub_FFFFF800188C67F4((__int64)v17_PETHREAD) != 0;// unknown, bool
                      if ( v17_PETHREAD )
                        ObfDereferenceObject(v17_PETHREAD);
                      ++v13;
                      v15 += 5;
                      v14 += 168i64;            // 0xA8 alignment
                    }
                    while ( v13 < HIDWORD(v11_ProcInfo->m128_u64[0]) ); SYSTEM_PROCESS_INFORMATION->Threads
                  }
                }
                break;
              }
              v12 = LODWORD(v11_ProcInfo->m128_u64[0]);
              if ( (_DWORD)v12 )
              {
                v11_ProcInfo = (__m128 *)((char *)v11_ProcInfo + v12);
                if ( v11_ProcInfo )
                  continue;
              }
              break;
            }
            ExFreePoolWithTag(v10_ProcInfo, 0);
          }
        }
      }
    }
  }
  return v6;
}

```

As the pseudocode says, subroutine does:

* 1. Get the pointer to the `ZwQuerySystemInformation` by `MmGetSystemRoutineAddress`
* 1. Call `ZwQuerySystemInformation` with `SystemProcessInformation` to get pool size what we have to allocate. (bad implementation)
* 1. Allocate memory using `ExAllocatePool` with the size
* 1. Call `ZwQuerySystemInformation` again to enumerate processes
* 1. Enumerate for every single processes and making sure the address is valid by `MmIsAddressValid`
     + If the process id is match, call `PsLookupThreadByThreadId` to get `PETHREAD` by thread id, then write information into the payload buffer, every single threads.

Also:

* The output data structure is `0xA8` alignment
* We can get its thread’s start address by `sub_FFFFF800188C68C8`
* We can get its thread’s `PETHREAD` address in the kernel

So I don’t know what `sub_FFFFF800188C687C` and `sub_FFFFF800188C67F4` does.

only one thing I know is that the first one references `PETHREAD+0x400` as follows:

```
__int64 __fastcall sub_FFFFF800188C687C(__int64 a1_PETHREAD)
{
  __int64 v1; // rbx
  __int64 v2_PETHREAD; // rdi
  __int64 *v4; // rdi

  v1 = 0i64;
  v2_PETHREAD = a1_PETHREAD;
  if ( !qword_FFFFF800188CA728 )
    return 0i64;
  if ( (unsigned __int8)MmIsAddressValid(a1_PETHREAD) == 1 )
  {
    v4 = (__int64 *)(qword_FFFFF800188CA728 + v2_PETHREAD);// 1048i64 + v2_PETHREAD, winver depends
    if ( (unsigned __int8)MmIsAddressValid(v4) == 1 )
      v1 = *v4;
  }
  return v1;
}

```

`qword_FFFFF800188CA728` is an static variable which has a winver-depends offset for the struct member.

Confirmed by this subroutine:

As you can see the switch-case is winver.

```
bool __fastcall sub_FFFFF800188C70CC(__int64 a1, __int64 a2, __int64 a3)
{
  char v4; // [rsp+20h] [rbp-128h]
  unsigned int v5; // [rsp+2Ch] [rbp-11Ch]
  __int64 v6; // [rsp+150h] [rbp+8h]

  switch ( dword_FFFFF800188CA748 )
  {
    case 61:
      qword_FFFFF800188CA700 = 384i64;
      qword_FFFFF800188CA708 = 360i64;
      qword_FFFFF800188CA710 = 496i64;
      qword_FFFFF800188CA720 = 512i64;
      qword_FFFFF800188CA718 = 616i64;
      qword_FFFFF800188CA728 = 872i64;
      qword_FFFFF800188CA730 = 1048i64; // <-
      qword_FFFFF800188CA738 = 1104i64;
      qword_FFFFF800188CA740 = 736i64;
      break;
    case 62:
      qword_FFFFF800188CA730 = 1008i64; // <-
      qword_FFFFF800188CA738 = 1068i64;
      goto LABEL_15;
    case 63:
      qword_FFFFF800188CA730 = 1656i64; // <-
      qword_FFFFF800188CA738 = 1716i64;
LABEL_15:
      qword_FFFFF800188CA718 = 936i64;
      qword_FFFFF800188CA720 = 1032i64;
      qword_FFFFF800188CA710 = 1040i64;
      qword_FFFFF800188CA700 = 736i64;
      qword_FFFFF800188CA740 = 768i64;
      break;
    case 100:
      RtlGetVersion(&v4);
      if ( v5 >= 0x4A61 )
      {
        qword_FFFFF800188CA730 = 0i64; // <-
        qword_FFFFF800188CA700 = 1088i64;
        qword_FFFFF800188CA710 = 1400i64;
        qword_FFFFF800188CA718 = 1304i64;
        qword_FFFFF800188CA720 = 1392i64;
        qword_FFFFF800188CA708 = 1128i64;
        qword_FFFFF800188CA738 = 1296i64;
LABEL_9:
        qword_FFFFF800188CA740 = 912i64;
        break;
      }
      qword_FFFFF800188CA710 = 1056i64;
      qword_FFFFF800188CA720 = 1048i64;
      if ( v5 >= 0x47BA )
      {
        qword_FFFFF800188CA700 = 744i64;
        qword_FFFFF800188CA718 = 960i64;
        qword_FFFFF800188CA708 = 784i64;
        qword_FFFFF800188CA730 = 1696i64; // <-
        qword_FFFFF800188CA738 = 1760i64;
        goto LABEL_9;
      }
      qword_FFFFF800188CA718 = 952i64;
      qword_FFFFF800188CA740 = 904i64;
      if ( v5 < 0x3AD7 )
      {
        qword_FFFFF800188CA700 = 744i64;
        qword_FFFFF800188CA730 = 1672i64; // <-
        qword_FFFFF800188CA738 = 1728i64;
      }
      else
      {
        qword_FFFFF800188CA700 = 736i64;
        qword_FFFFF800188CA708 = 776i64;
        qword_FFFFF800188CA730 = 1680i64; // <-
        qword_FFFFF800188CA738 = 1744i64;
      }
      break;
  }
  v6 = 0i64;
  PsLookupProcessByProcessId(4i64, &v6, a3);
  return sub_FFFFF800188C3D08(v6) == 4;
}

```
### Call map

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image14.png)

### Proof

Confirmed by hooking mhyprot kernel module.

System-calls are properly called exactly same as the pseudocode:

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image11.png)

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image12.png)

Data is set by the driver, this is the memory view of payload buffer:

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/images/image13.png)

## Getting System Uptime

The driver ioctl implements getting system uptime as follows:

It eventually calls `KeQueryTimeIncrement` which could get system uptime in nanoseconds.

```
PAGE:FFFFF800188CD737 loc_FFFFF800188CD737:                   ; CODE XREF: sub_FFFFF800188CD6E0+38↑j
PAGE:FFFFF800188CD737                 lea     eax, [rcx+7FEEC000h]
PAGE:FFFFF800188CD73D                 mov     edx, 80134000h
PAGE:FFFFF800188CD742                 test    eax, 0FFFCFFFFh
PAGE:FFFFF800188CD747                 jnz     short loc_FFFFF800188CD751
PAGE:FFFFF800188CD749                 cmp     ecx, edx
PAGE:FFFFF800188CD74B                 jnz     loc_FFFFF800188CDA4F
PAGE:FFFFF800188CD751
PAGE:FFFFF800188CD751 loc_FFFFF800188CD751:                   ; CODE XREF: sub_FFFFF800188CD6E0+67↑j
PAGE:FFFFF800188CD751                 cmp     ecx, edx // if (ioctl_code == 0x80134000)
PAGE:FFFFF800188CD753                 jnz     short loc_FFFFF800188CD766
PAGE:FFFFF800188CD755                 call    sub_FFFFF800188C2314 // <-
PAGE:FFFFF800188CD75A                 mov     [rdi], eax // *(unsigned int*)req_ctx = (unsigned int)result

```

and the `sub_FFFFF800188C2314` is:

```
.text:FFFFF800188C2314 sub_FFFFF800188C2314 proc near          ; CODE XREF: sub_FFFFF800188C141C+C↑p
.text:FFFFF800188C2314                                         ; sub_FFFFF800188C5C0C+38↓p ...
.text:FFFFF800188C2314                 sub     rsp, 28h
.text:FFFFF800188C2318                 call    cs:KeQueryTimeIncrement // <-
.text:FFFFF800188C231E                 mov     eax, eax
.text:FFFFF800188C2320                 mov     rcx, 0FFFFF78000000320h
.text:FFFFF800188C232A                 mov     rcx, [rcx]
.text:FFFFF800188C232D                 imul    rcx, rax
.text:FFFFF800188C2331                 mov     rax, 346DC5D63886594Bh
.text:FFFFF800188C233B                 imul    rcx
.text:FFFFF800188C233E                 sar     rdx, 0Bh
.text:FFFFF800188C2342                 mov     rax, rdx
.text:FFFFF800188C2345                 shr     rax, 3Fh
.text:FFFFF800188C2349                 add     rax, rdx
.text:FFFFF800188C234C                 add     rsp, 28h
.text:FFFFF800188C2350                 retn // (unsigned integer) miliseconds
.text:FFFFF800188C2350 sub_FFFFF800188C2314 endp

```
### Call map

![](https://web.archive.org/web/20211204031301im_/https://github.com/kkent030315/evil-mhyprot-cli/raw/main/IDA/imgs/image13.png)

## Terminate Process

The driver has a vulnerable ioctl code for terminating process, with a specific process id.

It eventually calls `ZwTerminateProcess` in the vulnerable driver context (ring-0).

The ioctl code is `0x81034000` as you can see:

```
PAGE:FFFFF800188CD0F9                 cmp     ebx, 81034000h
PAGE:FFFFF800188CD0FF                 jz      short loc_FFFFF800188CD16C

```

```
PAGE:FFFFF800188CD16C loc_FFFFF800188CD16C:                   ; CODE XREF: sub_FFFFF800188CD000+FF↑j
PAGE:FFFFF800188CD16C                 mov     rax, [rsp+30h]
PAGE:FFFFF800188CD171                 mov     ecx, [rax]
PAGE:FFFFF800188CD173                 call    sub_FFFFF800188C36A8
PAGE:FFFFF800188CD178                 and     dword ptr [rbp+1D0h+arg_20], 0

```

and the `sub_FFFFF800188C36A8` is in `.text` segment:

```
.text:FFFFF800188C36B0 sub_FFFFF800188C36B0 proc near          ; CODE XREF: sub_FFFFF800188C36A8↑j
.text:FFFFF800188C36B0                                         ; sub_FFFFF800188C4600+27↓p
.text:FFFFF800188C36B0                                         ; DATA XREF: ...
.text:FFFFF800188C36B0
.text:FFFFF800188C36B0 var_38          = qword ptr -38h
.text:FFFFF800188C36B0 var_30          = byte ptr -30h
.text:FFFFF800188C36B0 var_28          = qword ptr -28h
.text:FFFFF800188C36B0 var_18          = byte ptr -18h
.text:FFFFF800188C36B0 arg_0           = qword ptr  8
.text:FFFFF800188C36B0 Object          = qword ptr  10h
.text:FFFFF800188C36B0 Handle          = qword ptr  18h
.text:FFFFF800188C36B0 arg_18          = qword ptr  20h
.text:FFFFF800188C36B0
.text:FFFFF800188C36B0 ; __unwind { // __C_specific_handler
.text:FFFFF800188C36B0                 test    ecx, ecx // if (param1_processid != NULL)
.text:FFFFF800188C36B2                 jz      locret_FFFFF800188C3779
.text:FFFFF800188C36B8                 mov     rax, rsp
.text:FFFFF800188C36BB                 mov     [rax+8], rbx
.text:FFFFF800188C36BF                 mov     [rax+20h], rsi
.text:FFFFF800188C36C3                 push    rdi
.text:FFFFF800188C36C4                 sub     rsp, 50h
.text:FFFFF800188C36C8                 xor     ebx, ebx
.text:FFFFF800188C36CA                 mov     dil, 1
.text:FFFFF800188C36CD                 mov     [rax-18h], dil
.text:FFFFF800188C36D1                 mov     [rax+18h], rbx
.text:FFFFF800188C36D5                 mov     [rax+10h], rbx
.text:FFFFF800188C36D9                 mov     ecx, ecx
.text:FFFFF800188C36DB                 lea     rdx, [rax+10h]
.text:FFFFF800188C36DF                 call    PsLookupProcessByProcessId // <- Lookup _EPROCESS
.text:FFFFF800188C36E4                 movzx   esi, dil
.text:FFFFF800188C36E8                 test    eax, eax // if (_EPROCESS != NULL)
.text:FFFFF800188C36EA                 cmovs   esi, ebx
.text:FFFFF800188C36ED                 mov     [rsp+58h+var_18], sil
.text:FFFFF800188C36F2                 mov     rcx, [rsp+58h+Object]
.text:FFFFF800188C36F7                 test    rcx, rcx
.text:FFFFF800188C36FA                 jz      short loc_FFFFF800188C376A
.text:FFFFF800188C36FC                 lea     rax, [rsp+58h+Handle]
.text:FFFFF800188C3701                 mov     [rsp+58h+var_28], rax
.text:FFFFF800188C3706                 mov     [rsp+58h+var_30], bl
.text:FFFFF800188C370A                 mov     [rsp+58h+var_38], rbx
.text:FFFFF800188C370F                 xor     r9d, r9d
.text:FFFFF800188C3712                 xor     r8d, r8d
.text:FFFFF800188C3715                 xor     edx, edx
.text:FFFFF800188C3717                 call    cs:ObOpenObjectByPointer
.text:FFFFF800188C371D                 test    eax, eax
.text:FFFFF800188C371F                 jz      short loc_FFFFF800188C3733
.text:FFFFF800188C3721                 cmp     sil, dil
.text:FFFFF800188C3724                 jnz     short loc_FFFFF800188C3731
.text:FFFFF800188C3726                 mov     rcx, [rsp+58h+Object] ; Object
.text:FFFFF800188C372B                 call    cs:ObfDereferenceObject
.text:FFFFF800188C3731
.text:FFFFF800188C3731 loc_FFFFF800188C3731:                   ; CODE XREF: sub_FFFFF800188C36B0+74↑j
.text:FFFFF800188C3731                 jmp     short loc_FFFFF800188C376A
.text:FFFFF800188C3733 ; ---------------------------------------------------------------------------
.text:FFFFF800188C3733
.text:FFFFF800188C3733 loc_FFFFF800188C3733:                   ; CODE XREF: sub_FFFFF800188C36B0+6F↑j
.text:FFFFF800188C3733                 xor     edx, edx
.text:FFFFF800188C3735                 mov     rcx, [rsp+58h+Handle]
.text:FFFFF800188C373A                 call    cs:ZwTerminateProcess // <- terminate the process
.text:FFFFF800188C3740                 mov     rcx, [rsp+58h+Handle] ; Handle
.text:FFFFF800188C3745                 call    cs:ZwClose // <- close the handle
.text:FFFFF800188C374B                 jmp     short loc_FFFFF800188C3755
.text:FFFFF800188C374D ; ---------------------------------------------------------------------------
.text:FFFFF800188C374D                 mov     dil, 1
.text:FFFFF800188C3750                 mov     sil, [rsp+58h+var_18]
.text:FFFFF800188C3755
.text:FFFFF800188C3755 loc_FFFFF800188C3755:                   ; CODE XREF: sub_FFFFF800188C36B0+9B↑j
.text:FFFFF800188C3755                 cmp     sil, dil
.text:FFFFF800188C3758                 jnz     short loc_FFFFF800188C376A
.text:FFFFF800188C375A                 mov     rcx, [rsp+58h+Object] ; Object
.text:FFFFF800188C375F                 test    rcx, rcx
.text:FFFFF800188C3762                 jz      short loc_FFFFF800188C376A
.text:FFFFF800188C3764                 call    cs:ObfDereferenceObject
.text:FFFFF800188C376A
.text:FFFFF800188C376A loc_FFFFF800188C376A:                   ; CODE XREF: sub_FFFFF800188C36B0+4A↑j
.text:FFFFF800188C376A                                         ; sub_FFFFF800188C36B0:loc_FFFFF800188C3731↑j ...
.text:FFFFF800188C376A                 mov     rbx, [rsp+58h+arg_0]
.text:FFFFF800188C376F                 mov     rsi, [rsp+58h+arg_18]
.text:FFFFF800188C3774                 add     rsp, 50h
.text:FFFFF800188C3778                 pop     rdi
.text:FFFFF800188C3779
.text:FFFFF800188C3779 locret_FFFFF800188C3779:                ; CODE XREF: sub_FFFFF800188C36B0+2↑j
.text:FFFFF800188C3779                 retn
.text:FFFFF800188C3779 ; } // starts at FFFFF800188C36B0
.text:FFFFF800188C3779 sub_FFFFF800188C36B0 endp

```

Since this IOCTL handler has payload encryption measure, we have to encrypt the payload.

And the structure for the request will be like:

```
typedef struct _MHYPROT_TERMINATE_PROCESS_REQUEST
{
	uint64_t response;
	uint32_t process_id;
} MHYPROT_TERMINATE_PROCESS_REQUEST, * PMHYPROT_TERMINATE_PROCESS_REQUEST;

```
### Call Map

![](https://web.archive.org/web/20211204031301im_/https://raw.githubusercontent.com/kkent030315/evil-mhyprot-cli/main/images/image17.png)

[NEXT

Analysis of PsSetCreateProcessNotifyRoutine](/web/20211204031301/https%3A//www.godeye.club/2021/05/20/002-pssetcreateprocessnotifyroutine-analysis.html)
[PREV

Windows x64 ユーザーモードから任意のカーネルコードを実行する](/web/20211204031301/https%3A//www.godeye.club/2021/05/14/001-x64-windows-kernel-code-execution-via-user.html)

[GodEye.club](/web/20211204031301/https%3A//www.godeye.club/%20/)Security research, exploit, vulnerability explanation and exposures in the cybersecurity industry.



=== Content from www.vice.com_e637942a_20250119_110650.html ===


+ English
Close
## VICEEditions

* [English](https://www.vice.com/en)
* [Bahasa Indonesia](https://www.vice.com/id)
* [Czech](https://www.vice.com/cs)
* [Danish](https://www.vice.com/da)
* [Deutsch](https://www.vice.com/de)
* [Español](https://www.vice.com/es)
* [Français](https://www.vice.com/fr)
* [Italiano](https://www.vice.com/it)
* [Nederlands](https://www.vice.com/nl)
* [Polish](https://www.vice.com/pl)
* [Portuguese](https://www.vice.com/pt)
* [Română](https://www.vice.com/ro)
* [Russian](https://www.vice.com/ru)
* [Srpski](https://www.vice.com/sr)
* [Swedish](https://www.vice.com/sv)
* [Ελληνικά](https://www.vice.com/el)
* [عربي](https://www.vice.com/ar)
* [日本語](https://www.vice.com/ja)
* [한국어](https://www.vice.com/ko)

Open Menu

Close Menu

[![VICE](https://www.vice.com/wp-content/uploads/sites/2/2024/06/vice-logo_white@2x.png)](https://www.vice.com/en)

* [Magazine](https://www.vice.com/en/article/vice-magazine-is-coming-back/)
* [TV](https://www.vicetv.com/en_us)
* [News](/en/section/news/)
* [Culture](/en/section/life)
* [Tech](/en/section/tech/)
* [Munchies](/en/section/munchies/)
* [Music](/en/section/music)
* [Waypoint](/en/section/waypoint/)
* [Shop](https://vice-shop.com/)

[Newsletters](https://vice.beehiiv.com/subscribe)

* [Instagram](https://www.instagram.com/vice)
* [TikTok](https://www.tiktok.com/%40vice)
* [YouTube](https://www.youtube.com/user/vice)

* [Video](https://video.vice.com)
* [TV](https://www.vicetv.com/en_us)
* [Shop](https://vice-shop.com/)

* [Facebook](https://www.facebook.com/vice)
* [Instagram](https://www.instagram.com/vice)
* [TikTok](https://www.tiktok.com/%40vice)
* [Reddit](https://www.reddit.com/user/vice)
* [YouTube](https://www.youtube.com/user/vice)

Search

* [Culture](/en/section/life/)
* [News](/en/section/news/)
* [Tech](/en/section/tech/)
* [Munchies](/en/section/munchies/)
* [Drugs](/en/tag/drugs/)
* [Entertainment](/en/tag/entertainment/)
* [Environment](/en/tag/environment/)
* [Extremism](/en/tag/extremism)
* [Identity](/en/tag/identity)
* [Investigations](/en/tag/investigations)
* [Music](/en/section/music/)
* [Waypoint](/en/section/waypoint/)
* [Photography](/en/tag/photography)
* [Sex](/en/tag/sex)
* [Travel](/en/tag/travel)

[Tech](https://www.vice.com/en/category/tech/)
# Hackers Are Using Anti-Cheat in ‘Genshin Impact’ to Ransom Victims

By [Lorenzo Franceschi-Bicchierai](https://www.vice.com/en/contributor/lorenzo-franceschi-bicchierai/ "Posts by Lorenzo  Franceschi-Bicchierai")

August 26, 2022, 9:00am

![A screenshot from the video game Genshin Impact.](https://www.vice.com/wp-content/uploads/sites/2/2022/08/1661454770778-genshin-impact.png?w=1024)

Share:

* [X](https://www.vice.com/en/article/hackers-are-using-anti-cheat-in-genshin-impact-to-ransom-victims/?share=x&nb=1)
* [Facebook](https://www.vice.com/en/article/hackers-are-using-anti-cheat-in-genshin-impact-to-ransom-victims/?share=facebook&nb=1)
* [ShareCopied to clipboard](https://www.vice.com/en/article/hackers-are-using-anti-cheat-in-genshin-impact-to-ransom-victims/)

A ransomware gang is allegedly hacking victims by abusing the anti-cheat system of the massively popular free-to-play game *[Genshin Impact](https://www.vice.com/en/topic/genshin-impact)*.

The cybersecurity firm [Trend Micro published a report](https://www.trendmicro.com/en_us/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus.html) on Wednesday with details about the attack, highlighting how anti-cheat systems, which are installed by default as part of many online games, can be abused to hack players. The unnamed hackers are taking advantage of the fact that *Genshin Impact’s* anti-cheat system has known vulnerabilities, that it’s signed by a legitimate company—meaning Windows will run it—and because it has high privileges, meaning it has access to sensitive parts of the operating system.

## Videos by VICE

“I’ve been expecting to see ransomware abuse an anti-cheat driver for a while. We’ve seen cheats abuse anti-cheat drivers for years,” an employee of a games company, who asked to remain anonymous because they weren’t allowed to speak to the press, told Motherboard. “It was just a matter of time before a ransomware group noticed and started co-opting exploits that are openly shared.”

The hackers’ goal is to “mass-deploying ransomware,” according to Trend Micro. *Genshin Impact* was released in 2020 by Chinese developer HoYoverse ([miHoYo in China](https://kotaku.com/genshin-impact-mihoyo-hoyoverse-brand-honkai-impact-3rd-1848532266)) and has millions of players, who log into its game world via mobile devices, consoles, or on PC.

From Trend Micro’s report, it’s unclear how the hackers gain the initial foothold into a targeted computer. But once they are in, the hackers are exploiting *Genshin Impact*’s anti-cheat system to get access to the computer’s kernel, a core part of the operating system that controls and has access to most of the computer’s functions. At that point the hackers have the ability to turn off antivirus and install ransomware on the victims’ computers.

In other words, they are abusing the anti-cheat system as a way to get access to more sensitive parts of the operating system and avoid getting caught by an antivirus before deploying the ransomware.

Trend Micro researchers note that the game “does not need to be installed on a victim’s device for this to work,” meaning hackers can just install the anti-cheat system as a preliminary step to then deploy the ransomware.

***Do you have information about these attacks? Or other ransomware incidents? We’d love to hear from you. Using a non-work phone or computer, you can contact Lorenzo Franceschi-Bicchierai securely on Signal at +1 917 257 1382, Wickr/Telegram/Wire @lorenzofb, or email lorenzofb@vice.com***

Genshin Impact’s anti-cheat system is called mhyprot2. For years, security researchers have warned about the anti-cheat’s flaws. In 2020, a researcher [showed](https://github.com/kagurazakasanae/Mhyprot2DrvControl) that the system could be abused to read the computer’s memory and processes. Then in July of last year, a researcher who goes by Kento Oki [published a proof-of-concept](https://github.com/kkent030315/evil-mhyprot-cli) that turned the anti-cheat system into malicious software that could access the kernel.

These concerns have been publicly discussed outside security circles as well. The website [Pro Game Guides reported](https://progameguides.com/genshin-impact/genshin-impact-does-it-have-spyware/) after the game’s launch that users were concerned about the anti-cheat system because it had kernel-level privileges and was running in the background even when the game was closed, going as far as wondering if it was spyware. The company [responded to these concerns](https://genshin.mihoyo.com/en/news/detail/5818) by updating the anti-cheat system so that it would turn off when users were not playing the game.

In other words, HoYoverse, the company that develops Genshin Impact, has known that this version of the game’s anti-cheat system is vulnerable and can be exploited for a couple of years.

“We’re currently working on this case, and will find a solution as soon as possible to safeguard players’ safety and stop potential abuse of the anti-cheat function,” a HoYoverse spokesperson told Motherboard in an email.

Despite the long-running concerns, the vulnerable anti-cheat system is still getting installed on players’ computers, and has not been patched. And, according to Trend Micro researchers, “there are no solutions at this time” because the anti-cheat system is a legitimate program signed by a real company, and thus it’s not flagged by antivirus or Windows.

There are other anti-cheat systems that run in the kernel, giving them access and visibility into what’s running on the operating system with the goal of spotting cheat programs. The first one that gathered attention and [led some to ask whether it was going too far](https://arstechnica.com/gaming/2020/04/ring-0-of-fire-does-riot-games-new-anti-cheat-measure-go-too-far/) was Vanguard, the anti-cheat system for Riot Games’ online first person shooter *Valorant*. [Activision followed suit with RICOCHET](https://www.vice.com/en/article/z3xjqa/cheat-maker-is-so-far-not-afraid-of-call-of-dutys-new-kernel-level-anti-cheat), a kernel-level anti-cheat system for its uber popular *Call of Duty* games.

When making anti-cheat systems like these, developers have to be aware that the system could be turned against users if there are vulnerabilities, according to Paul Chamberlain, who was Riot’s anti-cheat lead when the company developed Vanguard.

“It was one of the primary worries we had when making Vanguard at Riot, we put a lot of resources into security audits to try and ensure something like this couldn’t happen,” Chamberlain told Motherboard.

Abusing drivers and other programs to push ransomware is [a tried and true tactic](https://www.youtube.com/watch?v=ViWLMfSwGVA) for cybercriminals, according to Allan Liska, a researcher at cybersecurity firm RecordedFuture who focuses on ransomware.

“Signed drivers are usually going to slip pass endpoint detection systems [such as antivirus] unnoticed,” he said.

***UPDATE, Friday Aug. 26, 10:31 a.m. ET**: This story was updated to include the comment from a HoYoverse spokesperson.*

***Subscribe to our podcast, [CYBER](https://itunes.apple.com/gb/podcast/cyber/id1441708044?mt=2). Subscribe to [our new Twitch channel](https://www.twitch.tv/motherboardtv).***

---

Tagged:
[anti-cheat](https://www.vice.com/en/tag/anti-cheat/), [cheating](https://www.vice.com/en/tag/cheating/), [CYBER](https://www.vice.com/en/tag/cyber/), [cybercrime](https://www.vice.com/en/tag/cybercrime/), [cybersecurity](https://www.vice.com/en/tag/cybersecurity/), [Game Hacking](https://www.vice.com/en/tag/game-hacking/), [genshin impact](https://www.vice.com/en/tag/genshin-impact/), [Hacking](https://www.vice.com/en/tag/hacking/), [ransomware](https://www.vice.com/en/tag/ransomware/), [Video Games](https://www.vice.com/en/tag/video-games/), [worldnews](https://www.vice.com/en/tag/worldnews/)
Share:

* [X](https://www.vice.com/en/article/hackers-are-using-anti-cheat-in-genshin-impact-to-ransom-victims/?share=x&nb=1)
* [Facebook](https://www.vice.com/en/article/hackers-are-using-anti-cheat-in-genshin-impact-to-ransom-victims/?share=facebook&nb=1)
* [ShareCopied to clipboard](https://www.vice.com/en/article/hackers-are-using-anti-cheat-in-genshin-impact-to-ransom-victims/)

## One email. One story. Every week. Sign up for the VICE newsletter.

By signing up, you agree to the [Terms of Use](https://vice-web-statics-cdn.vice.com/privacy-policy/en_us/page/terms-of-use.html) and [Privacy Policy](https://vice-web-statics-cdn.vice.com/privacy-policy/en_us/page/privacy-policy.html) & to receive electronic communications from VICE Media Group, which may include marketing promotions, advertisements and sponsored content.

## MoreLike This

* !['Genshin Impact' Releases a Major, Enticing Update](https://www.vice.com/wp-content/uploads/sites/2/2024/11/Genshin-Impact-Releases-a-Major-Enticing-Update.jpg?w=300)

  Screenshot: HoYoverse

  ### [‘Genshin Impact’ Releases a Major, Enticing Update](https://www.vice.com/en/article/genshin-impact-releases-a-major-enticing-update/)

  11.26.24

  By [Dwayne Jenkins](https://www.vice.com/en/contributor/dwayne-jenkins/ "Posts by Dwayne Jenkins")
* ![Modern Warfare 2 cheating](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1664222080250-mw2-beta-cheating.png?w=300)
  ### [Cheat Devs Are Ready for Modern Warfare 2](https://www.vice.com/en/article/call-of-duty-modern-warfare-2-cheats-aimbot-wallhacks-esp/)

  09.27.22

  By [Joseph Cox](https://www.vice.com/en/contributor/joseph-cox/ "Posts by Joseph Cox")
* ![A titan from Destiny 2 slams through a wall of energy shoulder first.](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1664201935514-bungie-hed.jpeg?w=300)
  ### [Cheat Maker Sues Bungie for Hacking Its ‘Destiny 2’ Hacks](https://www.vice.com/en/article/cheat-maker-sues-bungie-for-hacking-its-destiny-2-hacks/)

  09.26.22

  By [Renata Price](https://www.vice.com/en/contributor/renata-price/ "Posts by Renata Price") and [Lorenzo Franceschi-Bicchierai](https://www.vice.com/en/contributor/lorenzo-franceschi-bicchierai/ "Posts by Lorenzo  Franceschi-Bicchierai")
* ![Detail view of a PS5 controller during the FIFAe World Cup 2022 group stage as part of the FIFAe Finals 2022 on July 15, 2022 in Copenhagen, Denmark.](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1663867569640-playstation-5.jpeg?w=300)
  ### [Sony Reintroduced a PS4 Bug on PS5 Which Could Have Led to a Jailbreak](https://www.vice.com/en/article/sony-reintroduced-a-ps4-bug-on-ps5-which-could-have-led-to-a-jailbreak/)

  09.22.22

  By [Lorenzo Franceschi-Bicchierai](https://www.vice.com/en/contributor/lorenzo-franceschi-bicchierai/ "Posts by Lorenzo  Franceschi-Bicchierai")
* ![upporters of Irans Supreme Leader Ayatollah Ali Khamenei wave Iranian flags as one of them holds a portrait of former commander of IRGC Quds Force, General Qasem Soleimani, during a gathering to chant the Hymn Hello Commander at the one hundred thousand s](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1663171585411-iran-flag-hackers.jpeg?w=300)
  ### [Iranian Hackers Used Victims’ Printers to Issue Ransom Demands, DOJ Says](https://www.vice.com/en/article/iranian-hackers-used-victims-printers-to-issue-ransom-demands-doj-says/)

  09.14.22

  By [Lorenzo Franceschi-Bicchierai](https://www.vice.com/en/contributor/lorenzo-franceschi-bicchierai/ "Posts by Lorenzo  Franceschi-Bicchierai")
* ![Google Deepmind Researcher Co-Authors Paper Saying AI Will Eliminate Humanity](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1663088344933-gettyimages-1240596010.jpeg?w=300)
  ### [Google Deepmind Researcher Co-Authors Paper Saying AI Will Eliminate Humanity](https://www.vice.com/en/article/google-deepmind-researcher-co-authors-paper-saying-ai-will-eliminate-humanity/)

  09.13.22

  By [Edward Ongweso Jr](https://www.vice.com/en/contributor/edward-ongweso-jr/ "Posts by Edward Ongweso Jr")

## One email. One story. Every week. Sign up for the VICE newsletter.

By signing up, you agree to the [Terms of Use](https://vice-web-statics-cdn.vice.com/privacy-policy/en_us/page/terms-of-use.html) and [Privacy Policy](https://vice-web-statics-cdn.vice.com/privacy-policy/en_us/page/privacy-policy.html) & to receive electronic communications from VICE Media Group, which may include marketing promotions, advertisements and sponsored content.

## MoreFrom VICE

* ![GettyImages-1339030411 (1)](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1662649047910-gettyimages-1339030411-1.jpeg?w=1024)
  ### [Scientists Asked Students to Try to Fool Anti-Cheating Software. They Did.](https://www.vice.com/en/article/scientists-asked-students-to-try-to-fool-anti-cheating-software-they-did/)

  09.08.22

  By [Aaron Gordon](https://www.vice.com/en/contributor/aaron-gordon/ "Posts by Aaron Gordon")
* ![Two boys playing with theGame Boy Color.](https://www.vice.com/wp-content/uploads/sites/2/2022/09/1661957432290-game-boy-color.jpeg?w=1024)
  ### [Hacker Discovers How to Remotely Pwn a Game Boy Using ‘Pokémon Crystal’ After 22 Years](https://www.vice.com/en/article/hacker-discovers-how-to-remotely-pwn-a-game-boy-using-pokemon-crystal-after-22-years/)

  09.01.22

  By [Lorenzo Franceschi-Bicchierai](https://www.vice.com/en/contributor/lorenzo-franceschi-bicchierai/ "Posts by Lorenzo  Franceschi-Bicchierai")
* ![mods](https://www.vice.com/wp-content/uploads/sites/2/2022/07/1658849793738-mods.png?w=1024)
  ### [VRChat Security Update Throws the Metaverse Into Chaos](https://www.vice.com/en/article/vrchat-security-update-throws-the-metaverse-into-chaos/)

  07.26.22

  By [Matthew Gault](https://www.vice.com/en/contributor/matthew-gault/ "Posts by Matthew Gault") and [Emanuel Maiberg](https://www.vice.com/en/contributor/emanuel-maiberg/ "Posts by Emanuel Maiberg")
* ![tornado-cash](https://www.vice.com/wp-content/uploads/sites/2/2022/06/1655397808223-tornado-cash.jpeg?w=1024)
  ### [Tornado Cash Is Crypto Hackers’ Favorite Way to Cash Out, But Experts Say It Can Be Traced](https://www.vice.com/en/article/tornado-cash-is-crypto-hackers-favorite-way-to-cash-out-but-experts-say-it-can-be-traced/)

  06.21.22

  By [Lorenzo Franceschi-Bicchierai](https://www.vice.com/en/contributor/lorenzo-franceschi-bicchierai/ "Posts by Lorenzo  Franceschi-Bicchierai")

[VICE Media](https://www.vice.com)

* [Instagram](https://www.instagram.com/vice)
* [TikTok](https://www.tiktok.com/%40vice)
* [YouTube](https://www.youtube.com/user/vice)

* [About](https://www.vice.com/en/about-vice-digital-publishing/)
* [Accessibility](https://www.vice.com/en/vice-media-accessibility-statement/)
* [Privacy Policy](https://www.vice.com/en/privacy-policy/)
* [Terms of Use](https://www.vice.com/en/terms-of-use/)
* [Security Policy](https://www.vice.com/en/vice-responsible-disclosure-policy/)
* [Fulfillment Policy](https://www.vice.com/en/fulfillment-policy/)
* [Your Privacy Choices](http://CMP_CONSENT_LINK)

© 2025 VICE Media

![Quantcast](//pixel.quantserve.com/pixel/p-RxPFZR-mKeJrq.gif)



=== Content from github.com_96a08d69_20250119_110646.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkkent030315%2Fevil-mhyprot-cli)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkkent030315%2Fevil-mhyprot-cli)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=kkent030315%2Fevil-mhyprot-cli)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kkent030315](/kkent030315)
/
**[evil-mhyprot-cli](/kkent030315/evil-mhyprot-cli)**
Public

* [Notifications](/login?return_to=%2Fkkent030315%2Fevil-mhyprot-cli) You must be signed in to change notification settings
* [Fork
  68](/login?return_to=%2Fkkent030315%2Fevil-mhyprot-cli)
* [Star
   322](/login?return_to=%2Fkkent030315%2Fevil-mhyprot-cli)

A PoC for Mhyprot2.sys vulnerable driver that allowing read/write memory in kernel/user via unprivileged user process.

[www.godeye.club/2021/05/20/001-disclosure-mhyprot.html](https://www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "https://www.godeye.club/2021/05/20/001-disclosure-mhyprot.html")

### License

[MIT license](/kkent030315/evil-mhyprot-cli/blob/main/LICENSE)

[322
stars](/kkent030315/evil-mhyprot-cli/stargazers) [68
forks](/kkent030315/evil-mhyprot-cli/forks) [Branches](/kkent030315/evil-mhyprot-cli/branches) [Tags](/kkent030315/evil-mhyprot-cli/tags) [Activity](/kkent030315/evil-mhyprot-cli/activity)
 [Star](/login?return_to=%2Fkkent030315%2Fevil-mhyprot-cli)

 [Notifications](/login?return_to=%2Fkkent030315%2Fevil-mhyprot-cli) You must be signed in to change notification settings

* [Code](/kkent030315/evil-mhyprot-cli)
* [Issues
  3](/kkent030315/evil-mhyprot-cli/issues)
* [Pull requests
  0](/kkent030315/evil-mhyprot-cli/pulls)
* [Actions](/kkent030315/evil-mhyprot-cli/actions)
* [Projects
  0](/kkent030315/evil-mhyprot-cli/projects)
* [Wiki](/kkent030315/evil-mhyprot-cli/wiki)
* [Security](/kkent030315/evil-mhyprot-cli/security)
* [Insights](/kkent030315/evil-mhyprot-cli/pulse)

Additional navigation options

* [Code](/kkent030315/evil-mhyprot-cli)
* [Issues](/kkent030315/evil-mhyprot-cli/issues)
* [Pull requests](/kkent030315/evil-mhyprot-cli/pulls)
* [Actions](/kkent030315/evil-mhyprot-cli/actions)
* [Projects](/kkent030315/evil-mhyprot-cli/projects)
* [Wiki](/kkent030315/evil-mhyprot-cli/wiki)
* [Security](/kkent030315/evil-mhyprot-cli/security)
* [Insights](/kkent030315/evil-mhyprot-cli/pulse)

# kkent030315/evil-mhyprot-cli

    main[Branches](/kkent030315/evil-mhyprot-cli/branches)[Tags](/kkent030315/evil-mhyprot-cli/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[185 Commits](/kkent030315/evil-mhyprot-cli/commits/main/) | | |
| [IDA](/kkent030315/evil-mhyprot-cli/tree/main/IDA "IDA") | | [IDA](/kkent030315/evil-mhyprot-cli/tree/main/IDA "IDA") |  |  |
| [images](/kkent030315/evil-mhyprot-cli/tree/main/images "images") | | [images](/kkent030315/evil-mhyprot-cli/tree/main/images "images") |  |  |
| [libmhyprot @ bca5a16](/kkent030315/libmhyprot/tree/bca5a16a52371aec19e362d5038595ccd9ebd50c "libmhyprot") | | [libmhyprot @ bca5a16](/kkent030315/libmhyprot/tree/bca5a16a52371aec19e362d5038595ccd9ebd50c "libmhyprot") |  |  |
| [src](/kkent030315/evil-mhyprot-cli/tree/main/src "src") | | [src](/kkent030315/evil-mhyprot-cli/tree/main/src "src") |  |  |
| [.gitignore](/kkent030315/evil-mhyprot-cli/blob/main/.gitignore ".gitignore") | | [.gitignore](/kkent030315/evil-mhyprot-cli/blob/main/.gitignore ".gitignore") |  |  |
| [.gitmodules](/kkent030315/evil-mhyprot-cli/blob/main/.gitmodules ".gitmodules") | | [.gitmodules](/kkent030315/evil-mhyprot-cli/blob/main/.gitmodules ".gitmodules") |  |  |
| [LICENSE](/kkent030315/evil-mhyprot-cli/blob/main/LICENSE "LICENSE") | | [LICENSE](/kkent030315/evil-mhyprot-cli/blob/main/LICENSE "LICENSE") |  |  |
| [README.md](/kkent030315/evil-mhyprot-cli/blob/main/README.md "README.md") | | [README.md](/kkent030315/evil-mhyprot-cli/blob/main/README.md "README.md") |  |  |
| [evil-mhyprot-cli.sln](/kkent030315/evil-mhyprot-cli/blob/main/evil-mhyprot-cli.sln "evil-mhyprot-cli.sln") | | [evil-mhyprot-cli.sln](/kkent030315/evil-mhyprot-cli/blob/main/evil-mhyprot-cli.sln "evil-mhyprot-cli.sln") |  |  |
| [mhyprot.png](/kkent030315/evil-mhyprot-cli/blob/main/mhyprot.png "mhyprot.png") | | [mhyprot.png](/kkent030315/evil-mhyprot-cli/blob/main/mhyprot.png "mhyprot.png") |  |  |
| [seedmap.txt](/kkent030315/evil-mhyprot-cli/blob/main/seedmap.txt "seedmap.txt") | | [seedmap.txt](/kkent030315/evil-mhyprot-cli/blob/main/seedmap.txt "seedmap.txt") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license

[![](/kkent030315/evil-mhyprot-cli/raw/main/images/logo_min.png)](/kkent030315/evil-mhyprot-cli/blob/main/images/logo_min.png)

[![](https://camo.githubusercontent.com/287a7d722db825f8c9a33c206788a861ff4bfac386b5dc1203690cfd825106f7/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6b6b656e743033303331352f6576696c2d6d687970726f742d636c693f7374796c653d666f722d7468652d6261646765)](https://camo.githubusercontent.com/287a7d722db825f8c9a33c206788a861ff4bfac386b5dc1203690cfd825106f7/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6b6b656e743033303331352f6576696c2d6d687970726f742d636c693f7374796c653d666f722d7468652d6261646765)
[![](https://camo.githubusercontent.com/1ed215155f5fcd49f9669b9476c2448b081b7589a223d0f7d0a924019513375d/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6173742d636f6d6d69742f6b6b656e743033303331352f6576696c2d6d687970726f742d636c693f7374796c653d666f722d7468652d6261646765)](https://camo.githubusercontent.com/1ed215155f5fcd49f9669b9476c2448b081b7589a223d0f7d0a924019513375d/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6173742d636f6d6d69742f6b6b656e743033303331352f6576696c2d6d687970726f742d636c693f7374796c653d666f722d7468652d6261646765)
[![](https://camo.githubusercontent.com/d95811ec4a808e761792efd3c1c9d04f0404bb850823491e7eb24a747144fc12/68747470733a2f2f696d672e736869656c64732e696f2f636f6465666163746f722f67726164652f6769746875622f6b6b656e743033303331352f6576696c2d6d687970726f742d636c693f7374796c653d666f722d7468652d6261646765)](https://camo.githubusercontent.com/d95811ec4a808e761792efd3c1c9d04f0404bb850823491e7eb24a747144fc12/68747470733a2f2f696d672e736869656c64732e696f2f636f6465666163746f722f67726164652f6769746875622f6b6b656e743033303331352f6576696c2d6d687970726f742d636c693f7374796c653d666f722d7468652d6261646765)

[![IMAGE](/kkent030315/evil-mhyprot-cli/raw/main/images/image01.png)](/kkent030315/evil-mhyprot-cli/blob/main/images/image01.png)
[![IMAGE](/kkent030315/evil-mhyprot-cli/raw/main/images/image04.png)](/kkent030315/evil-mhyprot-cli/blob/main/images/image04.png)
[![IMAGE](/kkent030315/evil-mhyprot-cli/raw/main/images/image05.png)](/kkent030315/evil-mhyprot-cli/blob/main/images/image05.png)

# evil-mhyprot-cli

A PoC for Mhyprot2.sys vulnerable driver that allowing read/write memory in kernel/user via unprivileged user process.

* [libmhyprot](https://github.com/kkent030315/libmhyprot)
* [Wiki](https://github.com/kkent030315/evil-mhyprot-cli/wiki)

# Overview

What we can do with this CLI is as follows:

* Read/Write any kernel memory with privilege of kernel from usermode
* Read/Write any user memory with privilege of kernel from usermode
* Enumerate a number of modules by specific process id
* Get system uptime
* Enumerate threads in specific process, result in allows us to reading `PETHREAD` structure in the kernel directly from CLI as well.
* Terminate specific process by process id with `ZwTerminateProcess` which called in the vulnerable driver context (ring-0).
* All operations are executed as kernel level privilege (ring-0) by the vulnerable driver

Also:

* Administrator privilege only needed if the service is not yet running
* Therefore we can execute commands above as the normal user (w/o administrator privilege)

# Requirements

* Any version of Windows x64 that the driver works on
* Administrator privilege **does not required** if the service already running

Tested on:

* Windows10 x64 1903
* Windows7 x64 6.1
* Windows8.1 x64 6.3

# Usage

```
*.exe <target_process_name> -<options>

```

following options are available as of now:

* `t`
  + Perform Tests
* `d`
  + Print debug infos
* `s`
  + Print seedmap

# Latest

[![IMAGE](/kkent030315/evil-mhyprot-cli/raw/main/images/image10.png)](/kkent030315/evil-mhyprot-cli/blob/main/images/image10.png)

## About

A PoC for Mhyprot2.sys vulnerable driver that allowing read/write memory in kernel/user via unprivileged user process.

[www.godeye.club/2021/05/20/001-disclosure-mhyprot.html](https://www.godeye.club/2021/05/20/001-disclosure-mhyprot.html "https://www.godeye.club/2021/05/20/001-disclosure-mhyprot.html")

### Topics

[windows](/topics/windows "Topic: windows")
[kernel](/topics/kernel "Topic: kernel")
[exploit](/topics/exploit "Topic: exploit")
[driver](/topics/driver "Topic: driver")
[kernel-exploit](/topics/kernel-exploit "Topic: kernel-exploit")
[kernel-exploits](/topics/kernel-exploits "Topic: kernel-exploits")
[mhyprot2](/topics/mhyprot2 "Topic: mhyprot2")
[mhyprot](/topics/mhyprot "Topic: mhyprot")

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/kkent030315/evil-mhyprot-cli/activity)
### Stars

[**322**
stars](/kkent030315/evil-mhyprot-cli/stargazers)
### Watchers

[**11**
watching](/kkent030315/evil-mhyprot-cli/watchers)
### Forks

[**68**
forks](/kkent030315/evil-mhyprot-cli/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fkkent030315%2Fevil-mhyprot-cli&report=kkent030315+%28user%29)

## [Releases](/kkent030315/evil-mhyprot-cli/releases)

No releases published

## [Packages 0](/users/kkent030315/packages?repo_name=evil-mhyprot-cli)

No packages published

## Languages

* [C++
  100.0%](/kkent030315/evil-mhyprot-cli/search?l=c%2B%2B)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


