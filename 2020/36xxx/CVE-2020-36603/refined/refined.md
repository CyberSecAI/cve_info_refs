```
RELATED: CVE-2020-36603
```

Based on the provided documents, here's a breakdown of the vulnerability associated with the `mhyprot2.sys` driver:

**Root Cause of Vulnerability:**

The `mhyprot2.sys` driver, a legitimate anti-cheat driver for the game Genshin Impact, exposes several IOCTLs (Input/Output Control codes) that should not be accessible from user mode. These IOCTLs allow for operations that bypass standard privilege restrictions, enabling unauthorized access to sensitive parts of the operating system.

**Weaknesses/Vulnerabilities Present:**

*   **Unrestricted IOCTL Access:** The driver does not properly validate the caller's privileges before executing sensitive operations, allowing user-mode applications to send IOCTLs that should only be accessible to the kernel.
*   **Kernel Memory Read/Write:**  Vulnerable IOCTLs enable reading and writing arbitrary kernel memory. This can lead to information disclosure, privilege escalation, and denial of service.
*   **Process Memory Read/Write:**  The driver allows user-mode code to read and write arbitrary process memory, violating process isolation. This can be used to inject code or steal sensitive data.
*  **Arbitrary Process Termination:** The driver allows a user mode application to terminate arbitrary processes, including security software.

**Impact of Exploitation:**

*   **Privilege Escalation:** Attackers can use the driver to gain kernel-level privileges, bypassing user-mode restrictions.
*   **Antivirus Evasion:** By using the driver to disable or terminate antivirus software, attackers can avoid detection and carry out malicious activities.
*   **Arbitrary Code Execution:** With kernel-level access, attackers can execute arbitrary code on the victim's system, enabling them to install malware, steal data, or take control of the machine.
*   **Ransomware Deployment:** As observed in the Trend Micro report, ransomware actors can abuse the driver to disable endpoint protection and deploy ransomware across a network.
*   **Information Disclosure:** Reading kernel or process memory allows attackers to steal sensitive information such as credentials, encryption keys or other private data.
*   **Denial of Service:** The ability to write to arbitrary kernel memory can be used to trigger system crashes and blue-screens of death (BSODs)

**Attack Vectors:**

*   **Malware Integration:** The vulnerable driver can be integrated into malicious software, including ransomware.
*   **Direct Exploitation:** Attackers can directly interact with the driver through malicious code in user mode.
*   **Supply Chain Attacks:** The driver can be bundled with other software, thereby compromising systems during a seemingly legitimate install.

**Required Attacker Capabilities/Position:**

*   **Initial Access:** The attacker needs to achieve initial access to the targeted system through methods not explicitly related to this specific vulnerability (e.g. phishing, software exploit, etc).
*   **User-Mode Execution:** Once they've gained initial access, they need to be able to execute code in user-mode.
*   **Knowledge of IOCTLs:** The attacker needs knowledge of the specific IOCTLs exposed by the driver to trigger the vulnerabilities.
* **Ability to load the driver**: The attacker needs to be able to load the vulnerable driver, which is signed and therefore trusted by the operating system

**Additional Details (from the provided content):**

*   The vulnerability was discovered in 2020 and was reported to the vendor (miHoYo), who did not initially acknowledge or fix it.
*   The driver can be abused even without the game being installed by installing the `mhyprot2.sys` driver independently.
*   Proof-of-concept exploits were publicly released demonstrating the potential for abuse.
*   The driver's code-signing certificate is still valid, which makes the driver trusted by the Windows OS, which further complicates the issue since the driver is a legitimate module, not a malicious one.
*   The specific IOCTL code `0x81034000`  can be used to terminate processes.
*   The vulnerability has been actively exploited in the wild by ransomware operators.
*   The exposed functions are similar to rootkit functionality but are done with a legitimate, signed driver.

This vulnerability allows for significant system compromise, which is why itâ€™s important that security teams are aware of it and implement monitoring and detection as mitigation as mentioned in the Trend Micro article.