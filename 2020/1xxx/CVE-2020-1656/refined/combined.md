=== Content from www.juniper.net_aa7ed787_20250119_122521.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [Understanding DHCP Relay Agent Operation](#id-understanding-dhcp-relay-agent-operation)
* [Minimum DHCP Relay Agent Configuration](#id-example-minimum-dhcp-relay-agent-configuration)
* [Configuring DHCP Relay Agent](#id-configuring-dhcp-relay-agent)
* [Configuring a DHCP Relay Agent on EX Series Switches](#id-configuring-a-dhcp-relay-agent-on-ex-series-switches)
* [Configuring DHCP Smart Relay (Legacy DHCP Relay)](#id-configuring-dhcp-smart-relay)
* [Disabling Automatic Binding of Stray DHCP Requests](#id-disabling-automatic-binding-of-stray-dhcp-requests)
* [Using Layer 2 Unicast Transmission instead of Broadcast for
  DHCP Packets](#id-using-layer-2-unicast-transmission-instead-of-broadcast-for-dhcp-packets)
* [Changing the Gateway IP Address (giaddr) Field to the giaddr
  of the DHCP Relay Agent](#id-changing-the-gateway-ip-address-giaddr-field-to-the-giaddr-of-the-dhcp-relay-agent)
* [Configure DHCP Relay Agent to Replace Request and Release Packets
  with Gateway IP address](#id-replacing-the-dhcp-relay-request-and-release-packet-source-address)
* [Overriding the Default DHCP Relay Configuration Settings](#id-overriding-the-default-dhcp-relay-configuration-settings)
* [Disabling DHCP Relay Agent for Interfaces, for Groups, or Globally](#id-disabling-dhcp-relay-for-interfaces-for-groups-or-globally)
* [Example: Configuring DHCP Relay Agent Selective Traffic Processing
  Based on DHCP Option Strings](#id-example-configuring-dhcp-relay-agent-selective-traffic-processing-based-on-dhcp-option-strings)
* [Verifying and Managing DHCP Relay Configuration](#id-verifying-and-managing-dhcp-relay-configuration)
* [Extended DHCP Relay Agent Overview](#id-extended-dhcp-relay-agent-overview)
Â
# DHCP Relay Agent

The DHCP relay agent operates as the interface
between DHCP clients and the server. The DHCP Relay Agent relays DHCP
messages between DHCP clients and DHCP servers on different IP networks.
For more information, read this topic.

## Understanding DHCP Relay Agent Operation

A Juniper Networks device operating as a DHCP relay agent forwards
incoming requests from BOOTP and DHCP clients to a specified BOOTP
or DHCP server. Client requests can pass through virtual private network
(VPN) tunnels.

You cannot configure a single device interface to operate as
both a DHCP client and a DHCP relay.

Note:

The DHCP requests received on an interface are associated
to a DHCP pool that is in the same subnet as the primary IP address/subnet
on an interface. If an interface is associated with multiple IP addresses/subnets,
the device uses the lowest numerically assigned IP address as the
primary IP address/subnet for the interface. To change the IP address/subnet
that is listed as the primary address on an interface, use the `set interfaces < interface name > unit 0 family inet xxx.xxx.xxx.xxx/yy
primary`  command and commit the change.

Note:

All DHCP packets passing through a DHCP unconfigured interface might be dropped.

Enabling the DHCP relay or DHCP server feature also enables the DHCP snooping feature, which
analyzes all DHCP packets received through any interface of the device (both DHCP configured
and unconfigured interfaces) .

Interfaces not listed under DHCP settings are considered as `unconfigured`
interfaces. Depending on the configuration, DHCP packets received on DHCP unconfigured
interfaces are dropped.

### Interaction Among the DHCP Relay Agent, DHCP Client, and DHCP Servers

The pattern of interaction among the DHCP Relay agent, DHCP client, and DHCP servers is the same
regardless of whether the software installation is on a router or a switch. However, there
are some differences in the details of usage.

On routersâIn a typical carrier edge network configuration,
the DHCP client is on the subscriberâs computer, and the DHCP
relay agent is configured on the router between the DHCP client and
one or more DHCP servers.

On switchesâIn a typical network configuration, the DHCP
client is on an access device such as a personal computer and the
DHCP relay agent is configured on the switch between the DHCP client
and one or more DHCP servers.

The following steps describe, at a high level, how the DHCP
client, DHCP relay agent, and DHCP server interact in a configuration
that includes two DHCP servers.

1. The DHCP client sends a discover packet to find a DHCP
   server in the network from which to obtain configuration parameters
   for the subscriber (or DHCP client), including an IP address.
2. The DHCP relay agent receives the discover packet and
   forwards copies to each of the two DHCP servers. The DHCP relay agent
   then creates an entry in its internal client table to keep track of
   the clientâs state.
3. In response to receiving the discover packet, each DHCP
   server sends an offer packet to the client. The DHCP relay agent receives
   the offer packets and forwards them to the DHCP client.
4. On receipt of the offer packets, the DHCP client selects
   the DHCP server from which to obtain configuration information. Typically,
   the client selects the server that offers the longest lease time on
   the IP address.
5. The DHCP client sends a request packet that specifies
   the DHCP server from which to obtain configuration information.
6. The DHCP relay agent receives the request packet and forwards
   copies to each of the two DHCP servers.
7. The DHCP server requested by the client sends an acknowledgement
   (ACK) packet that contains the clientâs configuration parameters.
8. The DHCP relay agent receives the ACK packet and forwards
   it to the client.
9. The DHCP client receives the ACK packet and stores the
   configuration information.
10. If configured to do so, the DHCP relay agent installs
    a host route and Address Resolution Protocol (ARP) entry for this
    client.
11. After establishing the initial lease on the IP address,
    the DHCP client and the DHCP server use unicast transmission to negotiate
    lease renewal or release. The DHCP relay agent âsnoopsâ
    on all of the packets unicast between the client and the server that
    pass through the router (or switch) to determine when the lease for
    this client has expired or been released. This process is referred
    to as *lease shadowing* or *passive snooping*.

On all Junos
OS devices, when the DHCP relay is configured with `forward-only` option, and the DHCP client is terminated on logical tunnel interface
if the logical tunnel interface

* Includes multiple logical interfaces
* Use same VLAN on multiple logical interfaces of the same `lt` interface

In such cases, the DHCP relay might fail to send the *OFFER* messages.

This issue applies in Junos OS Releases 19.3R3, 19.4R2, 18.4R3,
19.4R1, 19.3R2, 18.4R3-S1, 17.4R3 releases.

## Minimum DHCP Relay Agent Configuration

This example shows the minimum configuration you need to use the extended DHCP relay
agent on your Junos OS device. Ensure that the device can connect to the DHCP
server.

In this example, you direct certain DHCP client traffic to a DHCP server. You specify an
active server group to which each client groups traffic is forwarded. Add server IP
addresses to the active server group, You can configure an interface group and
specifying the DHCP relay interface for the group. The interface used as the DHCP relay
agent can forward messages to specific servers.

Configure DHCP Option 82 and [forward-only](https://www.juniper.net/documentation/us/en/software/junos/subscriber-mgmt-sessions/topics/ref/statement/forward-only-edit-forwarding-options-default-action.html) feature.

This example creates active server group named `my-dhcp-servers-group`
with IP address 203.0.113.21. The DHCP relay agent configuration is applied to a
interfaces group named `my-dhcp-interfaces`. Within this group, the DHCP
relay agent is enabled on interface ge-0/0/1.0.

1. Configure the option to forward the traffic, without creating a new subscriber
   session.

   ```
   user@host# set forwarding-options dhcp-relay forward-only
   ```
2. Enable DHCP relay agent information option (option 82) in DHCP packets destined
   for a DHCP server.

   ```
   user@host# set forwarding-options dhcp-relay relay-option-82 circuit-id use-interface-description device
   ```

   Use
   the textual interface description instead of the interface identifier in the
   DHCP base option 82 Agent Circuit ID in DHCP packets that the DHCP relay agent
   sends to a DHCP server.
3. Configure DHCP server group and add the IP addresses of the DHCP server belonging
   to the
   group.

   ```
   user@host# set forwarding-options dhcp-relay server-group my-dhcp-servers-group 203.0.113.2
   ```
4. Set the DHCP server group as active server
   group.

   ```
   user@host# set forwarding-options dhcp-relay active-server-group my-dhcp-servers-group
   ```

   The
   DHCP relay agent relays DHCP client requests to the DHCP servers defined in the
   active server group.
5. Configure an interface group and specify the DHCP relay interface for the
   group.

   ```
   user@host# set forwarding-options dhcp-relay group my-dhcp-interf-group interface ge-0/0/1.0

   ```

   DHCP relay runs on the interfaces defined in the group.

Note:

To configure a switch with DHCP relay in `forward-only` mode, check
whether your DHCP server supports DHCP Option 82. See [Verify support of Option-82 in DHCP Server](https://www.juniper.net/documentation/us/en/software/junos/dhcp/topics/topic-map/dhcp-relay-agent-information-option82.html#id-check-if-your-device-support-dhcp-option82)
for details.

The `forward-only` option in DHCP relay configurations do not require the
S-SA-FP license to be installed.

From configuration mode, confirm your configuration by entering the `show
forwarding-options` command and verify your configuration.

```
user@srx-01# show forwarding-options
dhcp-relay {
    relay-option-82 {
        circuit-id {
            use-interface-description device;
        }
    }
    forward-only;
    server-group {
        my-dhcp-servers-group {
            203.0.113.21;
        }
    }
    active-server-group my-dhcp-servers-group;
    group my-dhcp-interf-group {
        interface ge-0/0/1.0;
    }
}

```

### Configuring IPv4 and IPv6 Addresses on the Loopback Interface

When you have configured a DHCP server in a different service VRFs, you must
configure IPv4 and IPv6 addresses on the loopback interface in the server VRF
configuration for DCHP-relay function to work in all other VRFs.

Configure the dhcp-relay forward-only-replies option to enable DHCP response packets
forwarded to the DHCP clients in the other VRF.

```
[edit routing-instances]
Svr-1 {
        instance-type vrf;
        routing-options {
            auto-export;
        }
        protocols {
            evpn {
                ip-prefix-routes {
                    advertise direct-nexthop;
                    encapsulation vxlan;
                    vni 11000;
                    export type5-export;
                }
            }
        }
        forwarding-options {
            dhcp-relay {
                dhcpv6 {
                    forward-only-replies;
                }
                forward-only-replies;
            }
        }
        interface lo0.2;
        route-distinguisher 103.0.0.1:5000;
        vrf-import import-tenant;
        vrf-target target:5000:1;
        vrf-table-label;
}

    lo0 {
        unit 0 {
            family inet {
                address 103.0.0.1/32;
            }
            family inet6 {
                address 1003::1/128;
            }
        }
        unit 1 {
            family inet {
                address 103.0.0.1/32;
            }
            family inet6 {
                address 1003::1/128;
            }
        }
        unit 2 {
            family inet {
                address 103.0.0.2/32;
            }
            family inet6 {
                address 1003::2/128;
            }
        }

```

## Configuring DHCP Relay Agent

The DHCP relay agent operates as the interface
between DHCP clients and the server. The DHCP Relay Agent relays DHCP
messages between DHCP clients and DHCP servers on different IP networks.

This example describes how to configure the DHCP relay agent on the SRX Series Firewall. SRX
Series Firewall acting as DHCP relay agent is responsible for forwarding the requests
and responses between the DHCP clients and the server which are part of different
routing instances.

* [Requirements](#d18e23)
* [Overview](#d18e33)
* [Configuration](#d18e118)
* [Verification](#d18e512)

### Requirements

This example uses the following hardware and software
components:

* SRX Series Firewalls with Junos OS 15.1X49-D10 or later.

### Overview

You can configure DHCP relay agent to provide additional security
when exchanging DHCP messages between a DHCP server and DHCP clients
that reside in different virtual routing instances. This type of configuration
is for DHCP relay connection between a DHCP server and a DHCP client,
when the DHCP server resides in a network that is isolated from the
client network.

#### Topology

To exchange DHCP messages between different routing instances,
you must enable both the server-facing interface and the client-facing
interface of the DHCP relay agent to recognize and forward DHCP packets.

The following [Figure 1](#d18e33__d18e48) shows
DHCP performance as DHCP local server, DHCP client, and DHCP relay
agent

Figure 1: Understanding DHCP Services
in a Routing Instance![Understanding DHCP Services in a Routing Instance](../example/../../images/g200278.png)

The following list provides an overview of the tasks required
to create the DHCP message exchange between the different routing
instances:

* Configure the client-facing side of the DHCP relay agent.
* Configure the server-facing side of the DHCP relay agent.
* Configure the Security Zone to Allow the DHCP protocol.

  Table1: DHCP Relay Parameters:

  | Parameters | Client-Side-Details | Server-Side-Details |
  | --- | --- | --- |
  | interface | ge-0/0/3.0 | ge-0/0/4.0 |
  | routing interface | trust-vr | untrust-vr |
  | ip address | 10.1.1.2/24 | 20.1.1.1/24 |

  Note:

  In order to make this setup work, the DHCP server connecting
  route and relay agent interface route must be in both routing-instances.
  For example, in the above topology, the server route 30.1.1.0/24 needs
  to be shared with the dhcp-relay VR, and the dhcp-relay interface
  route 10.1.1.0/24 exact needs to be shared with the default routing
  instance.

  Also, a dummy dhcp-relay config must be added in the routing
  instance with the DHCP server. If this is not configured, dhcp-relay
  will not be able to receive packets from the DHCP server.

### Configuration

* [CLI Quick Configuration](#d18e118__d13079e386)
* [Procedure](#d18e118__d13079e495)
* [Procedure](#d18e118__d13079e536)
* [Procedure](#d18e118__d13079e577)
* [Procedure](#d18e118__d13079e655)
* [Results](#d18e118__d13079e694)

#### CLI Quick Configuration

The following procedures describe the configuration
tasks for creating the DHCP message exchange between the DHCP server
and clients in different routing instances. To quickly configure this
example, copy the following commands, paste them into a text file,
remove any line breaks, change any details necessary to match your
network configuration, copy and paste the commands into the CLI at
the `[edit]` hierarchy level, and then enter `commit` from configuration mode.

Quick configuration for Client-Facing Support:

```
set routing-instances trust-vr instance-type virtual-router
set routing-instances trust-vr interface ge-0/0/3.0
set interfaces ge-0/0/3 unit 0 family inet address 10.1.1.2/24

```

Quick configuration for Server-Facing Support:

```
set routing-instances untrust-vr instance-type virtual-router
set routing-instances untrust-vr interface ge-0/0/4.0
set routing-instances untrust-vr forwarding-options dhcp-relay forward-only-replies
set interfaces ge-0/0/4 unit 0 family inet address 20.1.1.1/24

```

Quick configuration for DHCP Relay Support:

```
set routing-instances untrust-vr forwarding-options dhcp-relay server-group dummy-config
set routing-instances untrust-vr routing-options instance-import import_relay_route_to_server_vr
set routing-instances untrust-vr routing-options static route 30.1.1.0/24 next-hop 20.1.1.2
set routing-instances trust-vr forwarding-options dhcp-relay server-group server-1 30.1.1.2
set routing-instances trust-vr forwarding-options dhcp-relay active-server-group server-1
set routing-instances trust-vr forwarding-options dhcp-relay group relay-in-vr interface ge-0/0/3.0
set routing-instances trust-vr routing-options instance-import export_dhcp_server_route
set policy-options policy-statement export_dhcp_server_route term 1 from instance untrust-vr
set policy-options policy-statement export_dhcp_server_route term 1 from route-filter 30.1.1.0/24 exact
set policy-options policy-statement export_dhcp_server_route term 1 then accept
set policy-options policy-statement export_dhcp_server_route term 2 then reject
set policy-options policy-statement import_relay_route_to_server_vr term 1 from instance trust-vr
set policy-options policy-statement import_relay_route_to_server_vr term 1 from route-filter 10.1.1.0/24 exact
set policy-options policy-statement import_relay_route_to_server_vr term 1 then accept
set policy-options policy-statement import_relay_route_to_server_vr term 2 then reject
set routing-options static route 30.1.1.2/32 next-table untrust-vr.inet.0

```

Quick configuration for Security Zone to Allow the DHCP Protocol:

```
set security policies default-policy permit-all
set security zones security-zone untrust interfaces ge-0/0/4.0 host-inbound-traffic system-services all
set security zones security-zone untrust interfaces ge-0/0/4.0 host-inbound-traffic protocols all
set security zones security-zone trust interfaces ge-0/0/3.0 host-inbound-traffic system-services all
set security zones security-zone trust interfaces ge-0/0/3.0 host-inbound-traffic protocols all

```

#### Procedure

##### Step-by-Step Procedure

The following example requires you to navigate various
levels in the configuration hierarchy. For instructions on how to
do that, see Using the CLI Editor in Configuration Mode in the CLI User Guide.

To configure support on the client-facing side of the DHCP relay
agent:

1. Set a routing instance type as virtual router.

   ```
   [edit]
   user@host# set routing-instances trust-vr instance-type virtual-router

   ```
2. Set an interface to the virtual router

   ```
   [edit]
   user@host# set routing-instances trust-vr interface ge-0/0/3.0

   ```
3. Set the IP address to the interface.

   ```
   [edit]
   user@host# set interfaces ge-0/0/3 unit 0 family inet address 10.1.1.2/24

   ```

#### Procedure

##### Step-by-Step Procedure

To configure support on the server-facing side of the
DHCP relay agent:

1. Set a virtual router.

   ```
   [edit]
   user@host# set routing-instances untrust-vr instance-type virtual-router

   ```
2. Set an interface to the virtual router.

   ```
   [edit]
   user@host# set routing-instances untrust-vr interface ge-0/0/4.0

   ```
3. Set the forward-only-replies option.

   ```
   [edit]
   user@host# set routing-instances untrust-vr forwarding-options dhcp-relay forward-only-replies

   ```
4. Set the IP address to the interface.

   ```
   [edit]
   user@host# set interfaces ge-0/0/4 unit 0 family inet address 20.1.1.1/24

   ```

#### Procedure

##### Step-by-Step Procedure

To configure the DHCP local server to support:

1. Set the configuration in dhcp-relay for untrust-vr routing
   instance

   ```
   [edit ]
   user@host# set routing-instances untrust-vr forwarding-options dhcp-relay server-group dummy-config
   user@host# set routing-instances untrust-vr routing-options instance-import import_relay_route_to_server_vr
   user@host# set routing-instances untrust-vr routing-options static route 30.1.1.0/24 next-hop 20.1.1.2

   ```
2. Set the configuration in dhcp-relay for trust-vr routing
   instance

   ```
   [edit ]
   user@host# set routing-instances trust-vr forwarding-options dhcp-relay server-group server-1 30.1.1.2
   user@host# set routing-instances trust-vr forwarding-options dhcp-relay active-server-group server-1
   user@host# set routing-instances trust-vr forwarding-options dhcp-relay group relay-in-vr interface ge-0/0/3.0
   user@host# set routing-instances trust-vr routing-options instance-import export_dhcp_server_route

   ```
3. Set the configuration to share routes between routing
   instances.

   ```
   [edit ]
   user@host# set policy-options policy-statement export_dhcp_server_route term 1 from instance untrust-vr
   user@host# set policy-options policy-statement export_dhcp_server_route term 1 from route-filter 30.1.1.0/24 exact
   user@host# set policy-options policy-statement export_dhcp_server_route term 1 then accept
   user@host# set policy-options policy-statement export_dhcp_server_route term 2 then reject
   user@host# set policy-options policy-statement import_relay_route_to_server_vr term 1 from instance trust-vr
   user@host# set policy-options policy-statement import_relay_route_to_server_vr term 1 from route-filter 10.1.1.0/24 exact
   user@host# set policy-options policy-statement import_relay_route_to_server_vr term 1 then accept
   user@host# set policy-options policy-statement import_relay_route_to_server_vr term 2 then reject
   user@host# set routing-options static route 30.1.1.2/32 next-table untrust-vr.inet.0

   ```
   Note:

   You can enable an SRX Series Firewall to function as a DHCP local
   server. The DHCP local server provides an IP address and other
   configuration information in response to a client request.

#### Procedure

##### Step-by-Step Procedure

To configure the security zone to allow the DHCP Protocol:

1. Set the default security policy to permit all traffic.

   ```
   [edit ]
   user@host# set security policies default-policy permit-all

   ```
2. Set all system services and protocols on interface ge-0/0/4.0.

   ```
   [edit ]
   user@host# set security zones security-zone untrust interfaces ge-0/0/4.0 host-inbound-traffic system-services all
   user@host# set security zones security-zone untrust interfaces ge-0/0/4.0 host-inbound-traffic protocols all

   ```
3. Set all system services and protocols on interface ge-0/0/3.0.

   ```
   [edit ]
   user@host# set security zones security-zone trust interfaces ge-0/0/3.0 host-inbound-traffic system-services all
   user@host# set security zones security-zone trust interfaces ge-0/0/3.0 host-inbound-traffic protocols all

   ```

#### Results

* Result for Client-facing Support:

From configuration mode, confirm your configuration by entering
the `show routing-instances` command. If the output does
not display the intended configuration, repeat the configuration instructions
in this example to correct it.

```
[edit]
user@host# show routing-instances
trust-vr {
    instance-type virtual-router;
    interface ge-0/0/3.0;
}

```

* Result for Server-Facing Support:

  From configuration mode, confirm your configuration by entering
  the `show routing-instances` command. If the output does
  not display the intended configuration, repeat the configuration instructions
  in this example to correct it.

```
[edit]
user@host# show routing-instances
untrust-vr {
    instance-type virtual-router;
    interface ge-0/0/4.0;
    forwarding-options {
        dhcp-relay {
            forward-only-replies;
        }
    }
}

```

* Result for DHCP Local Server Support:

  From configuration mode, confirm your configuration by entering
  the `show routing-instances`, `show policy-options` and `show routing-options` commands. If the output does
  not display the intended configuration, repeat the configuration instructions
  in this example to correct it.

```
[edit]
user@host# show routing-instances
trust-vr {
    routing-options {
        instance-import export_dhcp_server_route;
    }
    forwarding-options {
        dhcp-relay {
            server-group {
                server-1 {
                    30.1.1.2;
                }
            }
            active-server-group server-1;
            group relay-in-vr {
                interface ge-0/0/3.0;
            }
        }
    }
}
untrust-vr {
    routing-options {
        static {
            route 30.1.1.0/24 next-hop 20.1.1.2;
        }
        instance-import import_relay_route_to_server_vr;
    }
    forwarding-options {
        dhcp-relay {
            server-group {
                dummy-config;
            }
        }
    }
}
[edit]
user@host# show policy-options
policy-statement export_dhcp_server_route {
    term 1 {
        from {
            instance untrust-vr;
            route-filter 30.1.1.0/24 exact;
        }
        then accept;
    }
    term 2 {
        then reject;
    }
}
policy-statement import_relay_route_to_server_vr {
    term 1 {
        from {
            instance trust-vr;
            route-filter 10.1.1.0/24 exact;
        }
        then accept;
    }
    term 2 {
        then reject;
    }
}
[edit]
user@host#  show routing-options
    static {
        route 30.1.1.2/32 next-table untrust-vr.inet.0;
    }

```

* Result for Security Zone to Allow the DHCP Protocol:

  From configuration mode, confirm your configuration by entering
  the `show security policies` and `show security zones` commands. If the output does not display the intended configuration,
  repeat the configuration instructions in this example to correct it.

```
[edit]
user@host# show security policies
default-policy {
    permit-all;
}
[edit]
user@host# show security zones
    security-zone HOST {
        interfaces {
            all;
        }
    }
    security-zone untrust {
        interfaces {
            ge-0/0/4.0 {
                host-inbound-traffic {
                    system-services {
                        all;
                    }
                    protocols {
                        all;
                    }
                }
            }
        }
    }
    security-zone trust {
        interfaces {
            ge-0/0/3.0 {
                host-inbound-traffic {
                    system-services {
                        all;
                    }
                    protocols {
                        all;
                    }
                }
            }
        }
    }

```

If you are done configuring the device, enter `commit` from configuration mode.

### Verification

* [Verifying the DHCP Relay Statistics Configuration:](#d18e512__d18e516)
* [Verifying DHCP client bindings in the routing instance.](#d18e512__d18e536)

#### Verifying the DHCP Relay Statistics Configuration:

* [Purpose](#d18e512__d13079e783)
* [Action](#d18e512__d13079e788)

##### Purpose

Verify that the DHCP Relay Statistics has been configured.

##### Action

* From operational mode, enter the `show dhcp relay
  statistics routing-instance dhcp-relay` command.

  ```
  Packets dropped:
  Total 0

  Messages received:
  BOOTREQUEST 1
  DHCPDECLINE 0
  DHCPDISCOVER 0
  DHCPINFORM 0
  DHCPRELEASE 0
  DHCPREQUEST 1

  Messages sent:
  BOOTREPLY 1
  DHCPOFFER 0
  DHCPACK 1
  DHCPNAK 0
  DHCPFORCERENEW 0
  ```

#### Verifying DHCP client bindings in the routing instance.

* [Purpose](#d18e512__d13079e803)
* [Action](#d18e512__d13079e808)

##### Purpose

Verify that the DHCP client bindings in the routing
instances has been configured.

##### Action

* From operational mode, enter the `show dhcp relay
  binding routing-instance dhcp-relay` command.

  ```
  IP address   Session Id  Hardware address   Expires   State     Interface
  10.10.10.2   14          00:0c:29:e9:6d:00  86381     BOUND     ge-0/0/1.0
  ```

## Configuring a DHCP Relay Agent on EX Series Switches

You can configure an EX Series switch to act as an extended
DHCP relay agent. This means that a locally attached host can issue
a DHCP request as a broadcast message and the switch configured for
DHCP relay relays the message to a specified DHCP server. Configure
a switch to be a DHCP relay agent if you have locally attached hosts
and a remote DHCP server.

Before you begin:

* Ensure that the switch can connect to the DHCP server.

To configure a switch to act as an extended DHCP relay
agent server:

1. Create at least one DHCP server group, which is a group
   of 1 through 5 DHCP server IP addresses:
   ```
   [edit forwarding-options dhcp-relay]
   user@switch# set server-group server-group-name  ip-address

   ```
2. Set the global active DHCP server group. The DHCP relay
   agent relays DHCP client requests to the DHCP servers defined in the
   active server group:
   ```
   [edit forwarding-options dhcp-relay]
   user@switch# set active-server-group  server-group-name

   ```
3. Create a DHCP relay group that includes at least one interface.
   DHCP relay runs on the interfaces defined in DHCP groups:
   ```
   [edit forwarding-options dhcp-relay]
   user@switch# set group group-name interface  interface-name

   ```

## Configuring DHCP Smart Relay (Legacy DHCP Relay)

You can use DHCP smart relay to provide redundancy and resiliency
to your DHCP relay configuration. Smart relay provides additional
relay functionality and requires all of the configuration settings
required by DHCP relay. To use DHCP smart relay, you also need an
interface with multiple IP addresses assigned to it. You can achieve
this by doing either of the following tasks:

* Create a routed VLAN interface and assign at least two
  IP addresses to it. See [Configuring IRB Interfaces on Switches](https://www.juniper.net/documentation/en_US/junos/topics/topic-map/irb-and-bridging.html) and [Example: Configuring Routing Between VLANs on One
  Switch Using an IRB Interface](https://www.juniper.net/documentation/en_US/junos/topics/topic-map/irb-and-bridging.html) for information about this
  approach.
* Create a Layer 3 logical interface (by using VLAN tagging)
  and assign at least two IP addresses to it. See [Understanding Layer 3 Logical Interfaces](https://www.juniper.net/documentation/en_US/junos/topics/concept/interfaces-layer3-subinterfaces-qfx-series.html) and [Configuring a Layer 3 Logical Interface](https://www.juniper.net/documentation/en_US/junos/topics/task/configuration/interfaces-layer3-subinterfaces-qfx-series-cli.html) for information about this approach.

Once you have created an interface with multiple IP addresses,
complete the smart relay configuration by entering one of the following
statements:

* `set forwarding-options helpers bootp smart-relay-global`: Use this statement to enable smart relay on all the interfaces
  that are configured as relay agents.
* `set forwarding-options helpers bootp interface interface-name smart-relay-agent`: Use this statement
  to enable smart relay on a specific interface.

When smart relay is configured for an interface, the switch
initially sends DHCP request (discover) messages out of that interface
using the primary address of the interface as the gateway IP address
(in the giaddr field) for the DHCP message. If no DHCP offer message
is received from a server in reply, the switch allows the client to
send as many as three more discover messages using the same gateway
IP address. If no DHCP offer message is received after three retries,
the switch resends the discover message using the alternate IP address
as the gateway IP address. If you configure more than two IP addresses
on the relay agent interface, the switch repeats this process until
a DHCP offer message is received or all of the IP addresses have been
used without success.

### See Also

* [bootp](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/bootp-edit-forwarding-options-qfx-series.html)

## Disabling Automatic Binding of Stray DHCP Requests

DHCP requests that are received but have no entry in the database
are known as stray requests. By default, DHCP relay, DHCP relay proxy,
and DHCPv6 relay agent attempt to bind the requesting client by creating
a database entry and forwarding the request to the DHCP server. If
the server responds with an ACK, the client is bound and the ACK is
forwarded to the client. If the server responds with a NAK, the database
entry is deleted and the NAK is forwarded to the client. This behavior
occurs regardless of whether authentication is configured.

You can override the default configuration at the global level,
for a named group of interfaces, or for a specific interface within
a named group. Overriding the default causes DHCP relay, DHCP relay
proxy, and DHCPv6 relay agent to drop all stray requests instead of
attempting to bind the clients.

Note:

Automatic binding of stray requests is enabled by default.

* To disable automatic binding behavior, include the `no-bind-on-request` statement when you configure DHCP overrides
  at the global, group, or interface level.

  ```
  [edit forwarding-options dhcp-relay overrides]
  user@host# set no-bind-on-request

  ```
* To override the default behavior for DHCPv6 relay agent,
  configure the override at the `[edit forwarding-options dhcp-relay
  dhcpv6]` hierarchy level.

  ```
  [edit forwarding-options dhcp-relay dhcpv6 overrides]
  user@host# set no-bind-on-request

  ```

The following two examples show a configuration that disables
automatic binding of stray requests for a group of interfaces and
a configuration that disables automatic binding on a specific interface.

To disable automatic binding of stray requests on a group
of interfaces:

1. Specify the named group.
   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit group boston

   ```
2. Specify that you want to configure overrides.
   ```
   [edit forwarding-options dhcp-relay group boston]
   user@host# edit overrides

   ```
3. Disable automatic binding for the group.
   ```
   [edit forwarding-options dhcp-relay group boston overrides]
   user@host# set no-bind-on-request

   ```

To disable automatic binding of stray requests on a specific
interface:

1. Specify the named group of which the interface is a member.

   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit group boston

   ```
2. Specify the interface on which you want to disable automatic
   binding.

   ```
   [edit forwarding-options dhcp-relay group boston]
   user@host# edit interface fe-1/0/1.2

   ```
3. Specify that you want to configure overrides.

   ```
   [edit forwarding-options dhcp-relay group boston interface fe-1/0/1.2]
   user@host# edit overrides

   ```
4. Disable automatic binding on the interface.

   ```
   [edit forwarding-options dhcp-relay group boston interface fe-1/0/1.2 overrides]
   user@host# set no-bind-on-request

   ```

## Using Layer 2 Unicast Transmission instead of Broadcast for DHCP Packets

You can configure the DHCP relay agent to override the setting
of the broadcast bit in DHCP request packets. DHCP relay agent then
instead uses the Layer 2 unicast transmission method to send DHCP
Offer reply packets and DHCP ACK reply packets from the DHCP server
to DHCP clients during the discovery process.

To override the default setting of the broadcast bit
in DHCP request packets:

1. Specify that you want to configure override options.
   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit overrides

   ```
2. Specify that the DHCP relay agent uses the Layer 2 unicast
   transmission method.
   ```
   [edit forwarding-options dhcp-relay overrides]
   user@host# set layer2-unicast-replies

   ```

## Changing the Gateway IP Address (giaddr) Field to the giaddr of the DHCP Relay Agent

You can configure the DHCP relay agent to change the gateway
IP address (giaddr) field in packets that it forwards between a DHCP
client and a DHCP server.

To overwrite the giaddr of every DHCP packet with the
giaddr of the DHCP relay agent before forwarding the packet to the
DHCP server:

1. Specify that you want to configure override options.
   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit overrides

   ```
2. Specify that the giaddr of DHCP packets is overwritten.
   ```
   [edit forwarding-options dhcp-relay overrides]
   user@host# set always-write-giaddr

   ```

## Configure DHCP Relay Agent to Replace Request and Release Packets with Gateway IP address

You can configure the DHCP relay agent to replace request and
release packets with the gateway IP address (giaddr) before forwarding
the packet to the DHCP server.

To replace the source address with giaddr:

1. Specify that you want to configure override options.
   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit overrides

   ```
2. Specify that you want to replace the IP source address
   in DHCP relay request and release packets with the gateway IP address
   (giaddr).
   ```
   [edit forwarding-options dhcp-relay overrides]
   user@host# set replace-ip-source-with giaddr

   ```

## Overriding the Default DHCP Relay Configuration Settings

You can override the default DHCP relay configuration
settings at the global level, for a named group of interfaces, or
for a specific interface within a named group.

* To override global default DHCP relay agent configuration
  options, include the `overrides` statement and its subordinate
  statements at the `[edit forwarding-options dhcp-relay]` hierarchy
  level.
* To override DHCP relay configuration options for a named
  group of interfaces, include the statements at the `[edit forwarding-options
  dhcp-relay group group-name]` hierarchy
  level.
* To override DHCP relay configuration options for a specific
  interface within a named group of interfaces, include the statements
  at the `[edit forwarding-options dhcp-relay group group-name interface interface-name]` hierarchy level.
* To configure overrides for DHCPv6 relay at the global
  level, group level, or per-interface, use the corresponding statements
  at the `[edit forwarding-options dhcp-relay dhcpv6]` hierarchy
  level.

To override default DHCP relay agent configuration settings:

1. (DHCPv4 and DHCPv6) Specify that you want to configure
   override options.
   * DHCPv4 overrides.

     Global override:

     ```
     [edit forwarding-options [dhcp-relay](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/dhcp-relay-edit-forwarding-options.html)]
     user@host# edit overrides

     ```

     Group-level override:

     ```
     [edit forwarding-options [dhcp-relay](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/dhcp-relay-edit-forwarding-options.html)]
     user@host# edit group group-name overrides

     ```

     Per-interface override:

     ```
     [edit forwarding-options [dhcp-relay](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/dhcp-relay-edit-forwarding-options.html)]
     user@host# edit group group-name interface interface-name overrides

     ```
   * DHCPv6 overrides.

     Global override:

     ```
     [edit forwarding-options dhcp-relay [dhcpv6](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/dhcpv6-edit-forwarding-options.html)]
     user@host# edit overrides

     ```

     Group-level override:

     ```
     [edit forwarding-options dhcp-relay [dhcpv6](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/dhcpv6-edit-forwarding-options.html)]
     user@host# edit group group-name overrides

     ```

     Per-interface override:

     ```
     [edit forwarding-options dhcp-relay [dhcpv6](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/dhcpv6-edit-forwarding-options.html)]
     user@host# edit group group-name interface interface-name overrides

     ```
2. (DHCPv4 only) Enable DHCP relay proxy mode.

   See [Enabling DHCP Relay Proxy Mode](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-enabling-dhcp-relay-proxy-mode).
3. (DHCPv4 only) Overwrite the giaddr in DHCP packets that
   the DHCP relay agent forwards.

   See [Changing the Gateway IP Address
   (giaddr) Field to the giaddr of the DHCP Relay Agent](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-changing-the-gateway-ip-address-giaddr-field-to-the-giaddr-of-the-dhcp-relay-agent).
4. (DHCPv4 only) Replace the IP source address in DHCP relay
   request and release packets with the gateway IP address (giaddr).

   See [Configure DHCP Relay Agent to
   Replace Request and Release Packets with Gateway IP address](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-replacing-the-dhcp-relay-request-and-release-packet-source-address).
5. (DHCPv4 only) Override the DHCP relay agent information
   option (option 82) in DHCP packets.

   See [Overriding Option 82 Information](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-option-82-using.html#id-using-dhcp-relay-agent-option-82-information).
6. (DHCPv4 only) Override the setting of the broadcast bit
   in DHCP request packets and use the Layer 2 unicast transmission method.

   See [Using Layer 2 Unicast Transmission
   instead of Broadcast for DHCP Packets](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-using-layer-2-unicast-transmission-instead-of-broadcast-for-dhcp-packets).
7. (DHCPv4 only) Trust DHCP client packets that have a giaddr
   of 0 and that contain option 82 information.

   See [Enable Processing of Untrusted
   Packets So Option 82 Information Can Be Used](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-option-82-using.html#id-enable-processing-of-untrusted-packets-so-option-82-information-can-be-used).
8. (DHCPv4 and DHCPv6) Override the maximum number of DHCP
   clients allowed per interface.

   See [Specifying the Maximum Number
   of DHCP Clients Per Interface](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-client-number-interface.html#id-specifying-the-maximum-number-of-dhcp-clients-per-interface).
9. (DHCPv4 only) Configure client auto logout.

   See [DHCP Auto Logout Overview](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-auto-logout.html#id-dhcp-auto-logout-overview).
10. (DHCPv4 and DHCPv6) Enable or disable support for DHCP
    snooped clients on interfaces.

    See [Enabling and Disabling DHCP Snooped Packets Support
    for DHCP Relay Agent](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-access/topics/topic-map/dhcp-snooping-network-security.html#id-enabling-and-disabling-dhcp-snooped-packets-support-for-dhcp-relay-agent).
11. (DHCPv4 and DHCPv6) Delay authentication of subscribers
    until the DHCP client sends a Request packet.

    See the [delay-authentication](../../subscriber-mgmt-sessions/topics/task/../../../../cli-reference/topics/ref/statement/delay-authentication-edit-forwarding-options.html).
12. (DHCPv4 and DHCPv6) Send release messages to the DHCP
    server when clients are deleted.

    See [Sending Release Messages When
    Clients Are Deleted](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-sending-release-messages-when-clients-are-deleted).
13. (Optional) Specify that when the DHCP or DHCPv6 relay agent
    receives a Discover or Solicit message that has a client ID that matches
    the existing client entry, the relay agent deletes the existing client
    entry.

    See [DHCP Behavior When Renegotiating While in Bound
    State](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-dhcp-behavior-when-renegotiating-while-in-bound-state).
14. (DHCPv6 only) Automatically log out existing client when
    new client solicits on same interface.

    See [Automatically Logging Out DHCPv6 Clients](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-auto-logout.html#id-automatically-logging-out-dhcpv6-clients).
15. (DHCPv4 only) Disable the DHCP relay agent on specific
    interfaces.

    See [Disabling DHCP Relay Agent for
    Interfaces, for Groups, or Globally](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-disabling-dhcp-relay-for-interfaces-for-groups-or-globally).
16. (DHCPv4 and DHCPv6) Disable automatic binding of stray
    DHCP requests.

    See [Disabling Automatic Binding
    of Stray DHCP Requests](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-local-server-relay-overrides.html#id-disabling-automatic-binding-of-stray-dhcp-requests).
17. (DHCPv4 and DHCPv6) Assign a single-session DHCP dual-stack
    group to a specified group of subscribers. You must assign the group
    to both legs of the DHCP dual stack.

    See [Configuring Single-Session DHCP Dual-Stack Support](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dual-stack-dhcp-access.html#id-configuring-single-session-dhcp-dual-stack-support).
18. (Optional, DHCPv4 and DHCPv6l) Specify that a short lease be
    sent to the client.

    See [Configuring DHCP Asymmetric Leasing](../../subscriber-mgmt-sessions/topics/task/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-lease-times.html#id-configuring-dhcp-asymmetric-leasing).

## Disabling DHCP Relay Agent for Interfaces, for Groups, or Globally

You can disable DHCP relay on all interfaces or a group of interfaces.

To disable DHCP relay agent:

1. Specify that you want to configure override options.
   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit overrides

   ```
2. Disable the DHCP relay agent.
   ```
   [edit forwarding-options dhcp-relay overrides]
   user@host# set disable-relay

   ```

## Example: Configuring DHCP Relay Agent Selective Traffic Processing Based on DHCP Option Strings

This example shows how to configure DHCP relay
agent to use DHCP option strings to selectively identify, filter,
and process client traffic.

* [Requirements](#d26e25)
* [Overview](#d26e54)
* [Configuration](#d26e70)
* [Verification](#d26e207)

### Requirements

This example uses the following hardware and software
components:

* MX Series 5G Universal Routing Platforms or EX Series
  Switches

Before you configure DHCP relay agent selective processing
support, be sure you:

* Configure DHCP relay agent.

  See [Extended
  DHCP Relay Agent Overview](../../subscriber-mgmt-sessions/topics/example/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcpv4-overview.html#id-extended-dhcp-relay-agent-overview).
* (Optional) Configure a named DHCP local server group if
  you want to forward client traffic to a server group.

  See [Grouping Interfaces with Common
  DHCP Configurations](../../subscriber-mgmt-sessions/topics/example/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcp-common-config-interface-group.html#id-grouping-interfaces-with-common-dhcp-configurations).

### Overview

In this example, you configure DHCP relay agent to use DHCP
option strings in client packets to selectively identify, filter,
and process client traffic. To configure selective processing, you
perform the following procedures:

1. Identify the client trafficâSpecify the DHCP option
   that DHCP relay agent uses to identify the client traffic you want
   to process. The option you specify matches the option in the client
   traffic.
2. Configure a default actionâSpecify the default processing
   action, which DHCP relay uses for identified client traffic that does
   not satisfy any configured match criteria.
3. Create match filters and associate an action with each
   filterâSpecify match criteria that filter the client traffic.
   The criteria can be an exact match or a partial match with the option
   string in the client traffic. Associate a processing action with each
   match criterion.

### Configuration

To configure DHCP relay agent selective processing
based on DHCP option information, perform these tasks:

* [CLI Quick Configuration](#d26e70__d13079e1592)
* [Configuring DHCP Relay Agent To Selectively Process Client
  Traffic Based on DHCP Option Strings](#d26e70__d13079e1602)
* [Results](#d26e70__d13079e1702)

#### CLI Quick Configuration

To quickly configure this example, copy the
following commands, paste them in a text file, remove any line breaks,
change any details necessary to match your network configuration,
and then copy and paste the command into the CLI at the `[edit]` hierarchy level.

```
set forwarding-options dhcp-relay relay-option option-number 60
set forwarding-options dhcp-relay relay-option equals ascii video-gold forward-only
set forwarding-options dhcp-relay relay-option equals ascii video-bronze local-server-group servergroup-15
set forwarding-options dhcp-relay relay-option starts-with hexadecimal fffff local-server-group servergroup-east
set forwarding-options dhcp-relay relay-option default-action drop

```

#### Configuring DHCP Relay Agent To Selectively Process Client Traffic Based on DHCP Option Strings

##### Step-by-Step Procedure

To configure DHCP relay selective processing:

1. Specify that you want to configure DHCP relay agent support.

   ```
   [edit forwarding-options]
   user@host# edit [dhcp-relay](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/dhcp-relay-edit-forwarding-options.html)

   ```
2. Specify the DHCP option that DHCP relay agent uses to
   identify incoming client traffic.

   ```
   [edit forwarding-options dhcp-relay]
   user@host# set [relay-option](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/relay-option-edit-forwarding-options.html) [option-number](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/option-number-edit-forwarding-options.html) 60

   ```
3. Configure a default action, which DHCP relay agent uses
   when the incoming client traffic does not satisfy any configured match
   criteria.

   ```
   [edit forwarding-options dhcp-relay]
   user@host# set [relay-option](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/relay-option-edit-forwarding-options.html) [default-action](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/default-action-edit-forwarding-options.html) [drop](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/drop-edit-forwarding-options-default-action.html)

   ```
4. Configure an exact match condition and associated action
   that DHCP relay uses to process the identified client traffic.

   ```
   [edit forwarding-options dhcp-relay]
   user@host# set [relay-option](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/relay-option-edit-forwarding-options.html) [equals](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/equals-edit-forwarding-options.html) ascii video-gold [forward-only](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/forward-only-edit-forwarding-options-default-action.html)

   ```
5. Configure a second exact match condition and associated
   action that DHCP relay uses to process client traffic.

   ```
   [edit forwarding-options dhcp-relay]
   user@host# set [relay-option](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/relay-option-edit-forwarding-options.html) [equals](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/equals-edit-forwarding-options.html) ascii video-bronze [local-server-group](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/local-server-group-edit-forwarding-options-default-action.html) servergroup-15

   ```
6. Configure a partial match criteria and associated action
   that DHCP relay uses to process client traffic.

   ```
   [edit forwarding-options dhcp-relay]
   user@host# set [relay-option](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/relay-option-edit-forwarding-options.html) [starts-with](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/starts-with-edit-forwarding-options.html) hexadecimal fffff [local-server-group](https://www.juniper.net/documentation/en_US/junos/topics/reference/configuration-statement/local-server-group-edit-forwarding-options-default-action.html) servergroup-east

   ```

#### Results

From configuration mode, confirm the results of your
configuration by issuing the `show` statement at the `[edit forwarding-options]` hierarchy level. If the output does
not display the intended configuration, repeat the configuration instructions
in this example to correct it.

```
[edit forwarding-options]
user@host# show
dhcp-relay {
    relay-option {
        option-number 60;
        equals {
            ascii video-gold {
                forward-only;
            }
        }
        equals {
            ascii video-bronze {
                local-server-group servergroup-15;
            }
        }
        default-action {
            drop;
        }
        starts-with {
            hexadecimal fffff {
                local-server-group servergroup-east;
            }
        }
    }
}

```

If you are done configuring the device, enter `commit` from configuration mode.

### Verification

To verify the status of DHCP relay agent selective
traffic processing, perform this task:

#### Verifying the Status of DHCP Relay Agent Selective Traffic Processing

* [Purpose](#d26e207__d13079e1732)
* [Action](#d26e207__d13079e1737)
* [Meaning](#d26e207__d13079e1747)

##### Purpose

Verify the DHCP relay agent selective traffic processing
status.

##### Action

Display statistics for DHCP relay agent.

```
user@host> show dhcp relay statistics
Packets dropped:
    Total                      30
    Bad hardware address       1
    Bad opcode                 1
    Bad options                3
    Invalid server address     5
    No available addresses     1
    No interface match         2
    No routing instance match  9
    No valid local address     4
    Packet too short           2
    Read error                 1
    Send error                 1
    Option 60                  1
    Option 82                  2

Messages received:
    BOOTREQUEST                116
    DHCPDECLINE                0
    DHCPDISCOVER               11
    DHCPINFORM                 0
    DHCPRELEASE                0
    DHCPREQUEST                105

Messages sent:
    BOOTREPLY                  0
    DHCPOFFER                  2
    DHCPACK                    1
    DHCPNAK                    0
    DHCPFORCERENEW             0

Packets forwarded:
    Total                      4
    BOOTREQUEST                2
    BOOTREPLY                  2

```
##### Meaning

The `Packets forwarded` field in the `show dhcp relay statistics` command output displays the number
of client packets that have been forwarded as a result of the selective
traffic processing configuration. In this example, the output indicates
the total number of packets that DHCP relay agent has forwarded, as
well as a breakdown for the number of `BOOTREQUEST` and `BOOTREPLY` packets forwarded.

## Verifying and Managing DHCP Relay Configuration

* [Purpose](#id-verifying-and-managing-dhcp-relay-configuration__d13079e1777)
* [Action](#id-verifying-and-managing-dhcp-relay-configuration__d13079e1782)

### Purpose

View or clear address bindings or statistics for DHCP
relay agent clients.

### Action

* To display the address bindings for DHCP relay agent clients:

  ```
  user@host> show dhcp relay binding

  ```
* To display DHCP relay agent statistics:

  ```
  user@host> show dhcp relay statistics

  ```
* To clear the binding state of DHCP relay agent clients:

  ```
  user@host> clear dhcp relay binding

  ```
* To clear all DHCP relay agent statistics:

  ```
  user@host> clear dhcp relay statistics

  ```

To clear or view information about client bindings and statistics
in a routing instance, run the following commands:

* `show dhcp relay binding routing instance <routing-instance name>`
* `show dhcp relay statistics routing instance <routing-instance name>`
* `clear dhcp relay binding routing instance <routing-instance name>`
* `clear dhcp relay statistics routing instance <routing-instance name>`

Note:

On all SRX Series Firewalls, DHCP relay is unable to update the binding status based on
DHCP\_RENEW and DHCP\_RELEASE messages.

### See Also

* [Minimum DHCP Relay Agent Configuration](https://www.juniper.net/documentation/en_US/junos/topics/task/configuration/security-dhcp-relay-agent-minimum-configuration.html)

## Extended DHCP Relay Agent Overview

You can configure extended DHCP relay options on the router
or on the switch and enable the router (or switch) to function as
a DHCP relay agent. A DHCP relay agent forwards DHCP request and reply
packets between a DHCP client and a DHCP server.

DHCP relay supports the attachment of dynamic profiles and also
interacts with the local AAA Service Framework to use back-end authentication
servers, such as RADIUS, to provide subscriber authentication or DHCP
client authentication. You can attach dynamic profiles and configure
authentication support on a global basis or for a specific group of
interfaces.

Note:

The PTX Series Packet Transport Routers do not support
authentication for DHCP relay agents.

On the routers, you can use DHCP relay in carrier edge applications
such as video/IPTV to obtain configuration parameters, including an
IP address, for your subscribers.

On the switches, you can use DHCP relay to obtain configuration
parameters including an IP address for DHCP clients.

Note:

The extended DHCP relay agent options configured with
the `dhcp-relay` statement are incompatible with the DHCP/BOOTP
relay agent options configured with the `bootp` statement.
As a result, you cannot enable both the extended DHCP relay agent
and the DHCP/BOOTP relay agent on the router at the same time.

For information about the DHCP/BOOTP relay agent, see [Configuring Routers, Switches, and Interfaces as
DHCP and BOOTP Relay Agents](https://www.juniper.net/documentation/en_US/junos/topics/usage-guidelines/policy-configuring-routers-or-interfaces-as-dhcp-and-bootp-relay-agents.html).

You can also configure the extended DHCP relay agent to support
IPv6 clients. See[DHCPv6 Relay Agent Overview](../../subscriber-mgmt-sessions/topics/concept/../../../../subscriber-mgmt-sessions/topics/topic-map/dhcpv6-relay-agent-overview.html#id-dhcpv6-relay-agent-overview) for information about the DHCPv6 relay agent feature.

To configure the extended DHCP relay agent on the router (or
switch), include the `[dhcp-relay](../../subscriber-mgmt-sessions/topics/concept/../../../../cli-reference/topics/ref/statement/dhcp-relay-edit-forwarding-options.html)` statement at the `[edit forwarding-options]` hierarchy level.

You can also include the `dhcp-relay` statement
at the following hierarchy levels:

* `[edit logical-systems logical-system-name forwarding-options]`
* `[edit logical-systems logical-system-name routing-instances routing-instance-name forwarding-options]`
* `[edit routing-instances routing-instance-name forwarding-options]`

* [Interaction Among the DHCP Relay Agent, DHCP Client, and DHCP
  Servers](#id-extended-dhcp-relay-agent-overview__d13079e1938)
* [DHCP Liveness Detection](#id-extended-dhcp-relay-agent-overview__d13079e1990)

### Interaction Among the DHCP Relay Agent, DHCP Client, and DHCP Servers

The pattern of interaction among the DHCP Relay agent, DHCP client, and DHCP servers is the same
regardless of whether the software installation is on a router or a switch. However,
there are some differences in the details of usage.

On routersâIn a typical carrier edge network configuration,
the DHCP client is on the subscriberâs computer, and the DHCP
relay agent is configured on the router between the DHCP client and
one or more DHCP servers.

On switchesâIn a typical network configuration, the DHCP
client is on an access device such as a personal computer and the
DHCP relay agent is configured on the switch between the DHCP client
and one or more DHCP servers.

The following steps describe, at a high level, how the DHCP
client, DHCP relay agent, and DHCP server interact in a configuration
that includes two DHCP servers.

1. The DHCP client sends a discover packet to find a DHCP
   server in the network from which to obtain configuration parameters
   for the subscriber (or DHCP client), including an IP address.
2. The DHCP relay agent receives the discover packet and
   forwards copies to each of the two DHCP servers. The DHCP relay agent
   then creates an entry in its internal client table to keep track of
   the clientâs state.
3. In response to receiving the discover packet, each DHCP
   server sends an offer packet to the client. The DHCP relay agent receives
   the offer packets and forwards them to the DHCP client.
4. On receipt of the offer packets, the DHCP client selects
   the DHCP server from which to obtain configuration information. Typically,
   the client selects the server that offers the longest lease time on
   the IP address.
5. The DHCP client sends a request packet that specifies
   the DHCP server from which to obtain configuration information.
6. The DHCP relay agent receives the request packet and forwards
   copies to each of the two DHCP servers.
7. The DHCP server requested by the client sends an acknowledgement
   (ACK) packet that contains the clientâs configuration parameters.
8. The DHCP relay agent receives the ACK packet and forwards
   it to the client.
9. The DHCP client receives the ACK packet and stores the
   configuration information.
10. If configured to do so, the DHCP relay agent installs
    a host route and Address Resolution Protocol (ARP) entry for this
    client.
11. After establishing the initial lease on the IP address,
    the DHCP client and the DHCP server use unicast transmission to negotiate
    lease renewal or release. The DHCP relay agent âsnoopsâ
    on all of the packets unicast between the client and the server that
    pass through the router (or switch) to determine when the lease for
    this client has expired or been released. This process is referred
    to as *lease shadowing* or *passive snooping*.

### DHCP Liveness Detection

Liveness detection for DHCP subscriber or DHCP client IP sessions
utilizes an active liveness detection protocol to institute liveness
detection checks for relevant clients. Clients are expected to respond
to liveness detection requests within a specified amount of time.
If the responses are not received within that time for a given number
of consecutive attempts, then the liveness detection check fails and
a failure action is implemented.

Note:

DHCP liveness detection either globally or per DHCP group.

### Related Documentation

* [DHCP Overview](dhcp-overview.html "Learn about Dynamic Host Configuration Protocol (DHCP), a network management protocol where a DHCP server dynamically assigns an IP address and other network configuration parameters to end hosts in the network to facilitate communication among the endpoints.")
* [Secure DHCP Message Exchange](dhcp-message-exchange-in-different-vrfs.html)
* [DHCP Client](dhcp-client-security-devices.html)
* [Suppressing DHCP Routes](dhcp-access-supressing.html)
Â Â

=== Content from www.juniper.net_97cbaa99_20250119_122520.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [Syntax](#id-show-dhcpv6-relay-statistics__d131992e23)
* [Description](#id-show-dhcpv6-relay-statistics__d131992e48)
* [Options](#id-show-dhcpv6-relay-statistics__d131992e53)
* [Required Privilege Level](#id-show-dhcpv6-relay-statistics__d131992e85)
* [Output Fields](#id-show-dhcpv6-relay-statistics__d131992e90)
* [Sample Output](#id-show-dhcpv6-relay-statistics__d131992e381)
* [Release Information](#id-show-dhcpv6-relay-statistics__d131992e400)
Â
# show dhcpv6 relay statistics

## Syntax

```
show dhcpv6 relay statistics
<bulk-leasequery-connections>
<leasequery>
<logical-system logical-system-name>
<routing-instance routing-instance-name>

```

## Description

Display Dynamic Host Configuration Protocol for
IPv6 (DHCPv6) relay statistics.

## Options

| bulk-leasequery-connections | (Optional) Display DHCPv6 relay bulk leasequery statistics. |
| --- | --- |
| leasequery | (Optional) Display information about DHCPv6 relay individual leasequery statistics. |
| logical-system logical-system-name | (Optional) Perform this operation on the specified logical system. If you do not specify a logical system name, statistics are displayed for the default logical system. |
| routing-instance routing-instance-name | (Optional) Perform this operation on the specified routing instance. If you do not specify a routing instance name, statistics are displayed for the default routing instance. |

## Required Privilege Level

view

## Output Fields

[Table 1](#id-show-dhcpv6-relay-statistics__show-dhcpv6-relay-statistics-table) lists the output fields for the `show dhcpv6 relay statistics`  command. Output fields are listed in the approximate order in which
they appear.

Table 1: show dhcpv6 relay statistics
Output Fields
| Field Name | Field Description |
| --- | --- |
| `DHCPv6 Packets dropped` | Number of packets discarded by the extended DHCPv6 relay agent application due to errors. Only nonzero statistics appear in the `Packets dropped` output. When all of the Packets dropped statistics are 0 (zero), only the `Total` field appears.   * `Total`âTotal number of packets discarded   by the DHCPV6 relay agent application. * `Bad options`âNumber of packets discarded   because invalid options were specified. * `Bad send`âNumber of packets that the extended   DHCP relay application could not send. * `Bad src address`âNumber of packets discarded   because the family type was not AF\_INET6. * `Client MAC validation`âNumber of packets   discarded because validation of the client MAC address failed. * `No client id`âNumber of packets discarded   because they could not be matched to a client. * `Lease Time Violation`âNumber of packets   discarded because of a lease time violation * `No safd`âNumber of packets discarded because   they arrived on an unconfigured interface. * `Short packet`âNumber of packets discarded   because they were too short. * `Relay hop count`âNumber of packets discarded   because the hop count in the packet exceeded 32. |
| `Messages received` | Number of DHCPv6 messages received.   * `DHCPv6_DECLINE`âNumber of DHCPv6 PDUs   of type DECLINE received * `DHCPV6_SOLICIT`âNumber of DHCPv6 PDUs   of type SOLICIT received * `DHCPV6_INFORMATION_REQUEST`âNumber of   DHCPv6 PDUs of type INFORMATION-REQUEST received * `DHCPV6_RELEASE`âNumber of DHCPv6 PDUs   of type RELEASE received * `DHCPV6_REQUEST`âNumber of DHCPv6 PDUs   of type REQUEST received * `DHCPV6_CONFIRM`âNumber of DHCPv6 PDUs   of type CONFIRM received  `DHCPV6_RENEW`âNumber of DHCPv6 PDUs of type   RENEW received  `DHCPV6_REBIND`âNumber of DHCPv6 PDUs of type   REBIND received  `DHCPV6_RELAY_REPL`âNumber of DHCPv6 PDUs of   type RELAY-REPL received * `DHCPV6_RELAY_FORW`âNumber of DHCPv6 RELAY-FORW   PDUs received. * `DHCPV6_LEASEQUERY_REPLY`âNumber of DHCPv6   replies received from the DHCPv6 sever * `DHCPV6_LEASEQUERY_DATA`âxxxx * `DHCPV6_LEASEQUERY_DONE`âThe leasequery   is complete |
| `Messages sent` | Number of DHCPv6 messages sent.   * `DHCPV6_ADVERTISE`âNumber of DHCPv6 ADVERTISE   PDUs transmitted * `DHCP_REPLY`âNumber of DHCPv6 REPLY PDUs   transmitted * `DHCP_RECONFIGURE`âNumber of DHCPv6 RECONFIGURE   PDUs transmitted * `DHCP_RELAY_FORW`âNumber of DHCPv6 RELAY-FORW   PDUs transmitted * `DHCPV6_RELAY_REPL`âNumber of DHCPv6 RELAY-REPL   PDUs transmitted. * `DHCP6_LEASEQUERY`âNumber of DHCP leasequery   messages transmitted |
| `Packets forwarded` | Number of packets forwarded by the extended DHCPv6 relay agent application.   * `FWD REQUEST`âNumber of DHCPv6 REQUEST   packets forwarded * `FWD REPLY`âNumber of DHCPv6 REPLY packets   forwarded |
| `External Server Response` | State of the external DHCP server responsiveness. |
| `Total Requested Servers` | Total number of servers with which the DHCP relay agent has requested a bulk leasequery connection. |
| `Total Attempted Servers` | Total number of servers with which the DHCP relay agent has attempted to create a bulk leasequery connection. |
| `Total Connected` | Total number of servers that have formed a bulk leasequery connection with the DHCP relay agent. |
| `Total Terminated by Server` | Total number of servers that have terminated a bulk leasequery connection with the DHCP relay agent. |
| `Total Max Attempted` | Total number of servers where the DHCP relay agent reached the maximum retry limit when it attempted to create a bulk leasequery connection. |
| `Total Closed due to Errors` | Total number of bulk leasequery connections that closed due to an internal error on the DHCP relay agent. |
| `In-Flight Connected` | Number of current bulk leasequery connections on the DHCP relay agent. |
| `Bulk Leaasequery Reply Packet Retries` | Number of bulk leasequery reply packets that the DHCP relay agent has retried. |

## Sample Output

* [show dhcpv6 relay statistics](#id-show-dhcpv6-relay-statistics__d131992e384)
* [show dhcpv6 relay statistics bulk-leasequery-connections](#id-show-dhcpv6-relay-statistics__d131992e392)

### show dhcpv6 relay statistics

```
user@host> show dhcpv6 relay statistics
DHCPv6 Packets dropped:
    Total                       2
    Lease Time Violation        1
    Client MAC validation       1

Messages received:
    DHCPV6_DECLINE              0
    DHCPV6_SOLICIT              10
    DHCPV6_INFORMATION_REQUEST  0
    DHCPV6_RELEASE              0
    DHCPV6_REQUEST              10
    DHCPV6_CONFIRM              0
    DHCPV6_RENEW                0
    DHCPV6_REBIND               0
    DHCPV6_RELAY_FORW           0
    DHCPV6_LEASEQUERY_REPLY     0
    DHCPV6_LEASEQUERY_DATA      0
    DHCPV6_LEASEQUERY_DONE      0

Messages sent:
    DHCPV6_ADVERTISE            0
    DHCPV6_REPLY                0
    DHCPV6_RECONFIGURE          0
    DHCPV6_RELAY_REPL           0
    DHCPV6_LEASEQUERY           0

Packets forwarded:
    Total                       4
    FWD REQUEST                 2
    FWD REPLY                   2

External Server Response:
    State                      Responding

```
### show dhcpv6 relay statistics bulk-leasequery-connections

```
user@host> show dhcpv6 relay statistics bulk-leasequery-connections

Total Requested Servers:    0
Total Attempted Servers:    0
Total Connected:            0
Total Terminated by Server: 0
Total Max Attempted:        0
Total Closed due to Errors: 0
In-Flight Connected:        0
Bulk Leasequery Reply Packet Retries:   0
```

## Release Information

Command introduced in Junos OS Release
11.4.

`bulk-leasequery-connections` option introduced in
Junos OS Release 16.1.

### Related Documentation

* [clear dhcpv6 relay statistics](clear-dhcpv6-relay-statistics.html)
* [DHCPv6 Client MAC Address Validation to Prevent Session Hijacking](../../../../subscriber-mgmt-sessions/topics/concept/dhcpv6-link-layer-address-validation.html)
Â Â

=== Content from kb.juniper.net_a678e68c_20250119_122518.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from www.juniper.net_20cb73b8_20250119_122523.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [DHCPv6 Relay Agent Overview](#id-dhcpv6-relay-agent-overview)
* [DHCPv6 Relay Agent Options](#id-dhcpv6-relay-agent-options)
* [Configuring DHCPv6 Relay Agent Options](#id-configuring-dhcpv6-relay-agent-options)
* [Inserting DHCPv6 Interface-ID Option (Option 18) In DHCPv6
  Packets](#id-inserting-dhcpv6-interfaceid-option-option-18-in-dhcpv6-packets)
* [Inserting DHCPv6 Remote-ID Option (Option 37) In DHCPv6 Packets](#id-inserting-dhcpv6-remote-id-option-option-37-in-dhcpv6-packets)
Â
# DHCPv6 Relay Agent

## DHCPv6 Relay Agent Overview

When a DHCPv6 client logs in, the DHCPv6 relay agent uses the
AAA service framework to interact with the RADIUS server to provide
authentication and accounting. The RADIUS server, which is configured
independently of DHCP, authenticates the client and supplies the IPv6
prefix and client configuration parameters, such as session timeout
and the maximum number of clients allowed per interface.

Note:

The PTX Series Packet Transport Routers do not support
authentication for DHCPv6 relay agents.

Note:

The following DHCPv6 functionalities are not supported
on ACX Series routers:

* Subscriber authentication for DHCPv6 relay agents
* DHCP snooping
* DHCPv6 client
* Liveness detection
* Dynamic profiles
* Option 37 support for remote ID insertion
* Bidirectional Forwarding Detection (BFD) for DHCPv6 relay

The DHCPv6 relay agent is compatible with the DHCP local server
and the DHCP relay agent, and can be enabled on the same interface
as either the DHCP local server or DHCP relay agent.

To configure the DHCPv6 relay agent on the router (or switch),
you include the `dhcpv6` statement at the `[edit forwarding-options
dhcp-relay]` hierarchy level.

You can also include the `dhcpv6` statement
at the following hierarchy levels:

* `[edit logical-systems logical-system-name forwarding-options dhcp-relay]`
* `[edit logical-systems logical-system-name routing-instances routing-instance-name forwarding-options
  dhcp-relay]`
* `[edit routing-instances routing-instance-name forwarding-options dhcp-relay]`

See [DHCPv6 Monitoring and Management](dhcpv6-monitoring-and-management.html) for commands specific to viewing and clearing DHCPv6 bindings and
statistics.

## DHCPv6 Relay Agent Options

You can configure DHCPv6 relay agent to include additional
information in the client-originated DHCP packets that the relay agent
forwards to a DHCPv6 server. This support is equivalent to the option
82 support provided by the DHCPv4 relay agent. The DHCPv6 server uses
the additional information in the packets to determine the IPv6 address
to assign to the client. The server might also use the information
for other purposes; for example, to determine which services to grant
the client, or to provide additional security against threats such
as address spoofing. The DHCPv6 server sends its reply back to the
DHCPv6 relay agent, and the agent removes the option information from
the message, and then forwards the packet to the client.

You can configure the DHCPv6 relay agent to include the following
options in the packet the relay agent sends to the DHCPv6 server:

* Relay Agent Interface-ID (option 18)âAn ASCII string
  that identifies the interface on which the client DHCPv6 packet is
  received. This is the equivalent of the DHCPv4 relay agent option
  82 Agent Circuit ID suboption (suboption 1).
* Relay Agent Remote-ID (option 37)âAn ASCII string
  assigned by the DHCPv6 relay agent that securely identifies the client.
  This is the equivalent of the DHCPv4 relay agent option 82 Agent Remote
  ID suboption (suboption 2).

## Configuring DHCPv6 Relay Agent Options

You can configure DHCPv6 relay agent to insert optional information
in the DHCPv6 packets that the relay receives from clients and forwards
to a DHCPv6 server. To configure the optional information, you specify
the type of information you want to include in the packets. You use
the `relay-agent-interface-id` statement to include Relay
Agent Interface-ID (option 18) in the packets, or the `relay-agent-remote-id` statement to include Relay Agent Remote-ID (option 37).

When you enable the DHCPv6 options support, you can optionally
configure DHCPv6 relay agent to include a prefix or the interface
description as part of the option information. For dual-stack environments,
you can also specify that the DHCPv6 relay agent use the DHCPv4 option
82 information to populate DHCPv6 option 18 or option 37.

To enable insertion of DHCPv6 options:

1. Specify that you want to configure DHCPv6 relay agent
   support.
   ```
   [edit forwarding-options dhcp-relay]
   user@host# edit [dhcpv6](../task/../../../cli-reference/topics/ref/statement/dhcpv6-edit-forwarding-options.html)

   ```
2. Configure DHCPv6 relay agent to insert the Relay Agent
   Interface-ID option, the Relay Agent Remote-ID option, or both.
   * To insert Relay Agent Interface-ID (option 18):

     ```
     [edit forwarding-options dhcp-relay dhcpv6]
     user@host# set [relay-agent-interface-id](../task/../../../cli-reference/topics/ref/statement/relay-agent-interface-id-edit-forwarding-options.html)

     ```
   * To insert Relay Agent Remote-ID (option 37):

     ```
     [edit forwarding-options dhcp-relay dhcpv6]
     user@host# set [relay-agent-remote-id](../task/../../../cli-reference/topics/ref/statement/relay-agent-remote-id-edit-forwarding-options.html)

     ```
3. (Optional) Specify additional information that you want
   to include in option 18 or option 37. The `relay-agent-interface-id` and `relay-agent-remote-id` statements both support inclusion
   of a prefix, interface description, or the DHCPv4 option 82 information.
   For example:
   * To prepend prefix informationâThis example prepends
     a prefix that consists of the hostname and logical system name to
     option 18. You use the `relay-agent-remote-id` statement
     to add the prefix to option 37.

     ```
     [edit forwarding-options dhcp-relay dhcpv6]
     user@host# set [relay-agent-interface-id](../task/../../../cli-reference/topics/ref/statement/relay-agent-interface-id-edit-forwarding-options.html) [prefix](../task/../../../cli-reference/topics/ref/statement/prefix-edit-forwarding-options.html) host-name logical-system-name

     ```
   * To include the textual interface descriptionâThis
     example uses the description for the device interface instead of the
     interface identifier in option 18. You use the `relay-agent-remote-id` statement to add the interface description to option 37.

     ```
     [edit forwarding-options dhcp-relay dhcpv6]
     user@host# set [relay-agent-interface-id](../task/../../../cli-reference/topics/ref/statement/relay-agent-interface-id-edit-forwarding-options.html) [use-interface-description](../task/../../../cli-reference/topics/ref/statement/use-interface-description-edit-forwarding-options.html) device

     ```
   * To use the DHCPv4 option-82 valueâThis example uses
     the DHCPv4 option-82 (suboption 2) value for the DHCPv6 option 37
     value. You use the `relay-agent-interface-id` statement to
     use DHCPv4 option 82 (suboption 1) in DHCPv6 option 18.

     This example also includes the optional `strict` keyword
     to specify that the router drops Solicit packets if the packets do
     not include an option 82 value. If you do not include the `strict` keyword, the router sends the RELAY-FORW message without adding
     option 37. The `strict` keyword is not supported for the [relay-agent-interface-id](../task/../../../cli-reference/topics/ref/statement/relay-agent-interface-id-edit-forwarding-options.html) statement.

     ```
     [edit forwarding-options dhcp-relay dhcpv6]
     user@host# set [relay-agent-remote-id](../task/../../../cli-reference/topics/ref/statement/relay-agent-remote-id-edit-forwarding-options.html) [use-option-82](../task/../../../cli-reference/topics/ref/statement/use-option-82-edit-forwarding-options-dhcpv6.html) strict

     ```

### See Also

* [Including a Prefix in DHCP Options](dhcp-option-82-using.html#id-using-dhcp-relay-agent-option-82-information)
* [Including a Textual Description in DHCP Options](dhcp-option-82-using.html#id-using-dhcp-relay-agent-option-82-information)

## Inserting DHCPv6 Interface-ID Option (Option 18) In DHCPv6 Packets

You can configure DHCPv6 relay agent to insert the DHCPv6 Interface-ID
(option 18) in the packets that the relay sends to a DHCPv6 server.
You can configure the option 18 support at either the DHCPv6 global
or group level.

When you configure option 18 support, you can optionally
include the following additional information:

* PrefixâSpecify the `prefix` option to add
  a prefix to the interface identifier. The prefix can be any combination
  of hostname, logical system name, and routing instance name.
* Interface descriptionâSpecify the `use-interface-description` option to include the textual interface description instead of the
  interface identifier. You can include either the device interface
  description or the logical interface description.
* Option 82 Agent Circuit ID suboption (suboption 1)âSpecify
  the `use-option-82` option to include the DHCPv4 Option 82
  Agent Circuit ID suboption (suboption 1). This configuration is useful
  in a dual-stack environment, which has both DHCPv4 and DHCPv6 subscribers
  that reside over the same underlying logical interface. The router
  checks for the option 82 suboption 1 value and inserts it into the
  outgoing packets. If no DHCPv4 binding exists or if the binding does
  not have an option 82 suboption 1 value, the router sends the packets
  without adding an option 18.

Note:

If you specify one of the optional configurations, and
the specified information does not exist (for example, there is no
interface description), DHCPv6 relay ignores the optional configuration
and inserts the default interface identifier in the packets.

To insert the DHCPv6 Interface-ID option (option 18)
in DHCPv6 packets:

1. Configure the DHCPv6 relay to include option 18.
   ```
   [edit forwarding-options dhcp-relay dhcpv6]
   user@host# edit relay-agent-interface-id

   ```
2. (Optional) Specify the prefix to include in option 18.
   ```
   [edit forwarding-options dhcp-relay dhcpv6 relay-agent-interface-id]
   user@host# set prefix prefix

   ```
3. (Optional) Specify that option 18 include the textual
   description of the interface. You can specify either the `logical` interface description or the `device` interface description.
   ```
   [edit forwarding-options dhcp-relay dhcpv6 relay-agent-interface-id]
   user@host# set use-interface-description (logical | device)

   ```
4. (Optional) Specify that option 18 use the DHCPv4 Option
   82 Agent Circuit ID suboption (suboption 1) value.
   ```
   [edit forwarding-options dhcp-relay dhcpv6 relay-agent-interface-id]
   user@host# set use-option-82

   ```

### See Also

* [Including a Prefix in DHCP Options](dhcp-option-82-using.html#id-using-dhcp-relay-agent-option-82-information)
* [Including a Textual Description in DHCP Options](dhcp-option-82-using.html#id-using-dhcp-relay-agent-option-82-information)

## Inserting DHCPv6 Remote-ID Option (Option 37) In DHCPv6 Packets

Starting in Junos OS Release
14.1, you can configure DHCPv6 relay agent to insert DHCPv6 Remote-ID
(option 37) in the packets that the relay sends to a DHCPv6 server. You can configure option 37 support at either the DHCPv6 global
or group level.

When you configure option 37 support, you can optionally
include the following information:

* PrefixâSpecify the `prefix` option to add
  a prefix to the interface identifier. The prefix can be any combination
  of hostname, logical system name, and routing instance name.
* Interface descriptionâSpecify the `use-interface-description` option to include the textual interface description instead of the
  interface identifier. You can include either the device interface
  description or the logical interface description.
* Option 82 Agent Remote-ID suboption (suboption 2)âSpecify
  the `use-option-82` option to use the value of the DHCPv4
  option 82 Remote-ID suboption (suboption 2). This configuration is
  useful in a dual-stack environment, which has both DHCPv4 and DHCPv6
  subscribers that reside over the same underlying logical interface.
  The router checks for the option 82 suboption 2 value and inserts
  it into the outgoing packets.

Note:

If you specify one of the optional configurations, and
the specified information does not exist (for example, there is no
interface description), DHCPv6 relay ignores the optional configuration
and inserts the default interface identifier in the packets.

To insert the DHCPv6 Remote-ID option (option 37) in
DHCPv6 packets:

1. Configure the DHCPv6 relay to include option 37.
   ```
   [edit forwarding-options dhcp-relay dhcpv6]
   user@host# edit relay-agent-remote-id

   ```
2. (Optional) Specify the prefix to include with the option
   37 information.
   ```
   [edit forwarding-options dhcp-relay dhcpv6 relay-agent-remote-id]
   user@host# set prefix prefix

   ```
3. (Optional) Specify that option 37 include the textual
   description of the interface. You can specify either the `logical` interface description or the `device` interface description.
   ```
   [edit forwarding-options dhcp-relay dhcpv6 relay-agent-remote-id]
   user@host# set use-interface-description (logical | device)

   ```
4. (Optional) Specify that option 37 use the DHCPv4 option
   82 Remote-ID suboption (suboption 2) value.

   If no DHCPv4 binding exists, or if the binding does not include
   an option 82 suboption 2 value, by default the router sends the packets
   without adding option 37. However, you can use the optional `strict` keyword to specify that the router drop packets that do not have
   a suboption 2 value.

   ```
   [edit forwarding-options dhcp-relay dhcpv6 relay-agent-remote-id]
   user@host# set use-option-82 strict

   ```

### See Also

* [Extracting an Option 82 or Option 37 Substring to
  Create an Interface Set](dhcp-option-82-using.html#id-extracting-an-option-82-or-option-37-substring-to-create-an-interface-set)

### Related Documentation

* [DHCPv6 Local Server](dhcpv6-local-server-overview.html)
* [DHCP Overview](dhcpv4-overview.html)
## Change History Table

Feature support is determined by the platform and release you are using. Use [Feature Explorer](https://apps.juniper.net/feature-explorer/) to determine if a feature is supported on your platform.

ReleaseDescription14.1Starting in Junos OS Release
14.1, you can configure DHCPv6 relay agent to insert DHCPv6 Remote-ID
(option 37) in the packets that the relay sends to a DHCPv6 server.Â Â
