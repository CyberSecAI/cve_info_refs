=== Content from bugzilla.redhat.com_9763477b_20250119_125422.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3DCVE-2020-1714)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3DCVE-2020-1714)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3DCVE-2020-1714)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1705975

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1705975**](show_bug.cgi?id=1705975)
(CVE-2020-1714)
- [CVE-2020-1714](https://access.redhat.com/security/cve/CVE-2020-1714) keycloak: Lack of checks in ObjectInputStream leading to Remote Code Execution

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2020-1714 keycloak: Lack of checks in ObjectInputStream leading to Remote...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-1714 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1705976](show_bug.cgi?id=1705976) | | TreeView+ | [depends on](buglist.cgi?bug_id=1705975&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1705975&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2019-05-03 10:27 UTC by Marian Rehak | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-16 21:59 UTC ([History](show_activity.cgi?id=1705975)) | | [CC List:](page.cgi?id=fields.html#cclist) | 55 users (show)  aboyko aileenc akoufoud alazarot almorale anstephe avibelli bgeorges cbyrne chazlett clement.escoffier cmacedo cmoulliard dandread dffrench dkreling drieden drusso etirelli ggaughan gmalinko gsmet ibek ikanello janstey jbalunas jmadigan jochrist jpallich jshepherd jstastny jwon krathod kverlaen lthon mnovotny mszynkie ngough paradhya pdrozd pgallagh pjindal probinso pwright rfreire rrajasek rruss rsvoboda rsynek sbiarozk sdaley sdouglas security-response-team sthorger trepel | | Fixed In Version: | keycloak 11.0.0 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A flaw was found in Keycloak, where the code base contains usages of ObjectInputStream without type checks. This flaw allows an attacker to inject arbitrarily serialized Java Objects, which would then get deserialized in a privileged context and potentially lead to remote code execution. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2020-07-02 13:27:39 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2020:2813](https://access.redhat.com/errata/RHSA-2020%3A2813) | 0 | None | None | None | 2020-07-02 13:21:28 UTC | | Red Hat Product Errata | [RHSA-2020:2814](https://access.redhat.com/errata/RHSA-2020%3A2814) | 0 | None | None | None | 2020-07-02 13:37:35 UTC | | Red Hat Product Errata | [RHSA-2020:2816](https://access.redhat.com/errata/RHSA-2020%3A2816) | 0 | None | None | None | 2020-07-02 14:29:21 UTC | | Red Hat Product Errata | [RHSA-2020:2905](https://access.redhat.com/errata/RHSA-2020%3A2905) | 0 | None | None | None | 2020-07-23 07:04:03 UTC | | Red Hat Product Errata | [RHSA-2020:3017](https://access.redhat.com/errata/RHSA-2020%3A3017) | 0 | None | None | None | 2020-07-27 13:09:03 UTC | | Red Hat Product Errata | [RHSA-2020:3675](https://access.redhat.com/errata/RHSA-2020%3A3675) | 0 | None | None | None | 2020-09-08 09:33:07 UTC | | Red Hat Product Errata | [RHSA-2020:3678](https://access.redhat.com/errata/RHSA-2020%3A3678) | 0 | None | None | None | 2020-09-08 09:45:06 UTC | | Red Hat Product Errata | [RHSA-2020:4252](https://access.redhat.com/errata/RHSA-2020%3A4252) | 0 | None | None | None | 2020-10-14 11:17:18 UTC | | Red Hat Product Errata | [RHSA-2020:5568](https://access.redhat.com/errata/RHSA-2020%3A5568) | 0 | None | None | None | 2020-12-16 12:12:08 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1705975#c0)  Marian Rehak    2019-05-03 10:27:21 UTC  ``` The Keycloak code base contains some usages of ObjectInputStream without any type checks. This could be exploited by attackers being able to inject arbitrarily serialized Java Objects which would then get deserialized in a priviliged context potentially leading to Remote Code Execution.  References:  <https://github.com/keycloak/keycloak/pull/7053> <https://issues.jboss.org/browse/KEYCLOAK-10162>   ```  [Comment 1](show_bug.cgi?id=1705975#c1)  Jason Shepherd    2019-08-12 02:02:53 UTC  ``` Red Hat Mobile application platform (RHMAP) does not make use of the Keycloak Kerberos 5 Delegated Authorization feature, which does the unsafe deserialization. The other usage of ObjectInputStream pointed out in KEYCLOAK-10162 is used for reading the KeycloakSecurityContext out of the HTTP cache in the application server, which doesn't pose a threat to RHMAP because it's not accepting user input to be deserialized.   ```  [Comment 2](show_bug.cgi?id=1705975#c2)  Joshua Padman    2019-08-12 02:17:31 UTC  ``` This vulnerability is out of security support scope for the following product:  * Red Hat Mobile Application Platform  Please refer to <https://access.redhat.com/support/policy/updates/jboss_notes> for more details.   ```  [Comment 11](show_bug.cgi?id=1705975#c11)  Paramvir jindal    2020-05-11 15:10:20 UTC  ``` Acknowledgments:  Name: Thomas Darimont   ```  [Comment 15](show_bug.cgi?id=1705975#c15)  Chess Hazlett    2020-07-01 15:27:13 UTC  ``` Mitigation:  There is currently no known mitigation for this issue.   ```  [Comment 16](show_bug.cgi?id=1705975#c16)  errata-xmlrpc    2020-07-02 13:21:24 UTC  ``` This issue has been addressed in the following products:    Red Hat Single Sign-On 7.4.1  Via RHSA-2020:2813 [https://access.redhat.com/errata/RHSA-2020:2813](https://access.redhat.com/errata/RHSA-2020%3A2813)   ```  [Comment 17](show_bug.cgi?id=1705975#c17)  Product Security DevOps Team    2020-07-02 13:27:39 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2020-1714>   ```  [Comment 18](show_bug.cgi?id=1705975#c18)  errata-xmlrpc    2020-07-02 13:37:32 UTC  ``` This issue has been addressed in the following products:    Red Hat JBoss Enterprise Application Platform 7.3 for RHEL 6   Red Hat JBoss Enterprise Application Platform 7.3 for RHEL 7   Red Hat JBoss Enterprise Application Platform 7.3 for RHEL 8  Via RHSA-2020:2814 [https://access.redhat.com/errata/RHSA-2020:2814](https://access.redhat.com/errata/RHSA-2020%3A2814)   ```  [Comment 19](show_bug.cgi?id=1705975#c19)  errata-xmlrpc    2020-07-02 14:29:18 UTC  ``` This issue has been addressed in the following products:    Red Hat JBoss Enterprise Application Platform 6.4 for RHEL 6   Red Hat JBoss Enterprise Application Platform 6.4 for RHEL 7  Via RHSA-2020:2816 [https://access.redhat.com/errata/RHSA-2020:2816](https://access.redhat.com/errata/RHSA-2020%3A2816)   ```  [Comment 20](show_bug.cgi?id=1705975#c20)  errata-xmlrpc    2020-07-23 07:04:01 UTC  ``` This issue has been addressed in the following products:    Red Hat Openshift Application Runtimes  Via RHSA-2020:2905 [https://access.redhat.com/errata/RHSA-2020:2905](https://access.redhat.com/errata/RHSA-2020%3A2905)   ```  [Comment 21](show_bug.cgi?id=1705975#c21)  errata-xmlrpc    2020-07-27 13:08:59 UTC  ``` This issue has been addressed in the following products:    Red Hat Runtimes Spring Boot 2.1.15  Via RHSA-2020:3017 [https://access.redhat.com/errata/RHSA-2020:3017](https://access.redhat.com/errata/RHSA-2020%3A3017)   ```  [Comment 24](show_bug.cgi?id=1705975#c24)  errata-xmlrpc    2020-09-08 09:33:03 UTC  ``` This issue has been addressed in the following products:    Red Hat Decision Manager  Via RHSA-2020:3675 [https://access.redhat.com/errata/RHSA-2020:3675](https://access.redhat.com/errata/RHSA-2020%3A3675)   ```  [Comment 25](show_bug.cgi?id=1705975#c25)  errata-xmlrpc    2020-09-08 09:45:00 UTC  ``` This issue has been addressed in the following products:    Red Hat Process Automation  Via RHSA-2020:3678 [https://access.redhat.com/errata/RHSA-2020:3678](https://access.redhat.com/errata/RHSA-2020%3A3678)   ```  [Comment 27](show_bug.cgi?id=1705975#c27)  errata-xmlrpc    2020-10-14 11:17:13 UTC  ``` This issue has been addressed in the following products:    Red Hat build of Quarkus 1.7.5  Via RHSA-2020:4252 [https://access.redhat.com/errata/RHSA-2020:4252](https://access.redhat.com/errata/RHSA-2020%3A4252)   ```  [Comment 28](show_bug.cgi?id=1705975#c28)  errata-xmlrpc    2020-12-16 12:12:01 UTC  ``` This issue has been addressed in the following products:    Red Hat Fuse 7.8.0  Via RHSA-2020:5568 [https://access.redhat.com/errata/RHSA-2020:5568](https://access.redhat.com/errata/RHSA-2020%3A5568)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1705975&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from github.com_1a8678c1_20250119_125426.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeycloak%2Fkeycloak%2Fpull%2F7053)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeycloak%2Fkeycloak%2Fpull%2F7053)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=keycloak%2Fkeycloak)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[keycloak](/keycloak)
/
**[keycloak](/keycloak/keycloak)**
Public

* [Notifications](/login?return_to=%2Fkeycloak%2Fkeycloak) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2Fkeycloak%2Fkeycloak)
* [Star
   24.8k](/login?return_to=%2Fkeycloak%2Fkeycloak)

* [Code](/keycloak/keycloak)
* [Issues
  1.7k](/keycloak/keycloak/issues)
* [Pull requests
  201](/keycloak/keycloak/pulls)
* [Discussions](/keycloak/keycloak/discussions)
* [Actions](/keycloak/keycloak/actions)
* [Projects
  1](/keycloak/keycloak/projects)
* [Security](/keycloak/keycloak/security)
* [Insights](/keycloak/keycloak/pulse)

Additional navigation options

* [Code](/keycloak/keycloak)
* [Issues](/keycloak/keycloak/issues)
* [Pull requests](/keycloak/keycloak/pulls)
* [Discussions](/keycloak/keycloak/discussions)
* [Actions](/keycloak/keycloak/actions)
* [Projects](/keycloak/keycloak/projects)
* [Security](/keycloak/keycloak/security)
* [Insights](/keycloak/keycloak/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fkeycloak%2Fkeycloak%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fkeycloak%2Fkeycloak%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [Keycloak-10162] Usage of ObjectInputStream without checking the object types #7053

 Closed

[douglaspalmer](/douglaspalmer)
wants to merge
3
commits into
[keycloak:master](/keycloak/keycloak/tree/master "keycloak/keycloak:master")
from
[douglaspalmer:KEYCLOAK-10162](/douglaspalmer/keycloak/tree/KEYCLOAK-10162 "douglaspalmer/keycloak:KEYCLOAK-10162")

 Closed

# [[Keycloak-10162] Usage of ObjectInputStream without checking the object types](#top) #7053

[douglaspalmer](/douglaspalmer)
wants to merge
3
commits into
[keycloak:master](/keycloak/keycloak/tree/master "keycloak/keycloak:master")
from
[douglaspalmer:KEYCLOAK-10162](/douglaspalmer/keycloak/tree/KEYCLOAK-10162 "douglaspalmer/keycloak:KEYCLOAK-10162")

[Conversation
34](/keycloak/keycloak/pull/7053)
[Commits
3](/keycloak/keycloak/pull/7053/commits)
[Checks
0](/keycloak/keycloak/pull/7053/checks)
[Files changed](/keycloak/keycloak/pull/7053/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=60&v=4)](/douglaspalmer)

Copy link

Contributor

### @douglaspalmer **[douglaspalmer](/douglaspalmer)** commented [May 9, 2020](#issue-615066291)

I have an issue with this PR which is why it is currently a draft PR.

This code is JDK 8 specific. JDK 9 introduced java.io.ObjectInputFilter. The filter was then backported to JDK 8 as sun.misc.ObjectInputFilter. How can we maintain JDK compatibility when the package name is different between versions?

Sorry, something went wrong.

All reactions

[![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=80&v=4)](/douglaspalmer)

Copy link

Contributor

Author

### **[douglaspalmer](/douglaspalmer)** commented [May 9, 2020](#issuecomment-626100919)

| With newer JDKs we would also need to swap calls to `ObjectInputFilter.Config.setObjectInputFilter(in, filter)` with `in.setObjectInputFilter(filter)` and `ObjectInputFilter.Config.getObjectInputFilter(in)` with `in.getObjectInputFilter()` |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [May 9, 2020](#issuecomment-626136792) • edited Loading

| [@douglaspalmer](https://github.com/douglaspalmer) how about this:  ``` package demo;  import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.util.logging.Level; import java.util.logging.Logger;  public class SerialFilterDemo {      public static void main(String[] args) throws Exception {          Logger.getLogger(DelegatingSerializationFilter.class.getName()).setLevel(Level.FINEST);          ByteArrayOutputStream out = new ByteArrayOutputStream();         ObjectOutputStream oos = new ObjectOutputStream(out);          oos.writeObject("hello");          ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(out.toByteArray()));          JavaSerializationFilter serializationFilter = new DelegatingSerializationFilter();         serializationFilter.setFilter(ois, "org.keycloak.KeycloakSecurityContext;!*");          // Java 8         // System.out.println(sun.misc.ObjectInputFilter.Config.getObjectInputFilter(ois));          // Java 9+         // System.out.println(ois.getObjectInputFilter());     }      interface JavaSerializationFilter {         void setFilter(ObjectInputStream ois, String filterPattern);     }      static class DelegatingSerializationFilter implements JavaSerializationFilter {          private static final Logger LOG = Logger.getLogger(DelegatingSerializationFilter.class.getName());          private static final SerializationFilterAdapter serializationFilterAdapter = isJava8() ? new OnJava8() : new OnJavaAfter8();          private static boolean isJava8() {             return "1.8".equals(System.getProperty("java.specification.version"));         }          @Override         public void setFilter(ObjectInputStream ois, String filterPattern) {              LOG.info("Using: " + serializationFilterAdapter.getClass().getSimpleName());              if (serializationFilterAdapter.getObjectInputFilter(ois) == null) {                 serializationFilterAdapter.setObjectInputFilter(ois, filterPattern);             }         }          interface SerializationFilterAdapter {              Object getObjectInputFilter(ObjectInputStream ois);              void setObjectInputFilter(ObjectInputStream ois, String filterPattern);         }          // If codebase stays on Java 8 for a while you could use Java 8 classes directly without reflection         static class OnJava8 implements SerializationFilterAdapter {              private static final Method getObjectInputFilterMethod;             private static final Method setObjectInputFilterMethod;             private static final Method createFilterMethod;              static {                  Method getObjectInputFilter;                 Method setObjectInputFilter;                 Method createFilter;                  try {                     ClassLoader cl = Thread.currentThread().getContextClassLoader();                     Class<?> objectInputFilterClass = cl.loadClass("sun.misc.ObjectInputFilter");                     Class<?> objectInputFilterConfigClass = cl.loadClass("sun.misc.ObjectInputFilter$Config");                     getObjectInputFilter = objectInputFilterConfigClass.getDeclaredMethod("getObjectInputFilter", ObjectInputStream.class);                     setObjectInputFilter = objectInputFilterConfigClass.getDeclaredMethod("setObjectInputFilter", ObjectInputStream.class, objectInputFilterClass);                     createFilter = objectInputFilterConfigClass.getDeclaredMethod("createFilter", String.class);                 } catch (ClassNotFoundException | NoSuchMethodException e) {                     LOG.warning("Could not configure SerializationFilterAdapter: " + e.getMessage());                     getObjectInputFilter = null;                     setObjectInputFilter = null;                     createFilter = null;                 }                  getObjectInputFilterMethod = getObjectInputFilter;                 setObjectInputFilterMethod = setObjectInputFilter;                 createFilterMethod = createFilter;             }              public Object getObjectInputFilter(ObjectInputStream ois) {                 try {                     return getObjectInputFilterMethod.invoke(null, ois);                 } catch (IllegalAccessException | InvocationTargetException e) {                     LOG.warning("Could not read ObjectFilter from ObjectInputStream: " + e.getMessage());                     return null;                 }             }              public void setObjectInputFilter(ObjectInputStream ois, String filterPattern) {                 try {                     Object objectFilter = createFilterMethod.invoke(null, filterPattern);                     setObjectInputFilterMethod.invoke(null, ois, objectFilter);                 } catch (IllegalAccessException | InvocationTargetException e) {                     LOG.warning("Could not set ObjectFilter: " + e.getMessage());                 }             }         }          // If codebase moves to Java 9+ could use Java 9+ classes directly without reflection and keep the old variant with reflection         static class OnJavaAfter8 implements SerializationFilterAdapter {              private static final Method getObjectInputFilterMethod;             private static final Method setObjectInputFilterMethod;             private static final Method createFilterMethod;              static {                  Method getObjectInputFilter;                 Method setObjectInputFilter;                 Method createFilter;                  try {                     ClassLoader cl = Thread.currentThread().getContextClassLoader();                     Class<?> objectInputFilterClass = cl.loadClass("java.io.ObjectInputFilter");                     Class<?> objectInputFilterConfigClass = cl.loadClass("java.io.ObjectInputFilter$Config");                     Class<?> objectInputStreamClass = cl.loadClass("java.io.ObjectInputStream");                     getObjectInputFilter = objectInputStreamClass.getDeclaredMethod("getObjectInputFilter");                     setObjectInputFilter = objectInputStreamClass.getDeclaredMethod("setObjectInputFilter", objectInputFilterClass);                     createFilter = objectInputFilterConfigClass.getDeclaredMethod("createFilter", String.class);                 } catch (ClassNotFoundException | NoSuchMethodException e) {                     LOG.warning("Could not configure SerializationFilterAdapter: " + e.getMessage());                     getObjectInputFilter = null;                     setObjectInputFilter = null;                     createFilter = null;                 }                  getObjectInputFilterMethod = getObjectInputFilter;                 setObjectInputFilterMethod = setObjectInputFilter;                 createFilterMethod = createFilter;             }              public Object getObjectInputFilter(ObjectInputStream ois) {                 try {                     return getObjectInputFilterMethod.invoke(ois);                 } catch (IllegalAccessException | InvocationTargetException e) {                     LOG.warning("Could not read ObjectFilter from ObjectInputStream: " + e.getMessage());                     return null;                 }             }              public void setObjectInputFilter(ObjectInputStream ois, String filterPattern) {                 try {                     Object objectFilter = createFilterMethod.invoke(ois, filterPattern);                     setObjectInputFilterMethod.invoke(ois, objectFilter);                 } catch (IllegalAccessException | InvocationTargetException e) {                     LOG.warning("Could not set ObjectFilter: " + e.getMessage());                 }             }         }     } } ``` |
| --- |

All reactions

Sorry, something went wrong.

 [![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)
[douglaspalmer](/douglaspalmer)
[force-pushed](/keycloak/keycloak/compare/2e34cd474b14e115d8df57718b135398848f0c0c..bcbf3da6707c9f7a24bba42078c06b3078f10e2c)
the
KEYCLOAK-10162

branch
from
[`2e34cd4`](/keycloak/keycloak/commit/2e34cd474b14e115d8df57718b135398848f0c0c) to
[`bcbf3da`](/keycloak/keycloak/commit/bcbf3da6707c9f7a24bba42078c06b3078f10e2c)  [Compare](/keycloak/keycloak/compare/2e34cd474b14e115d8df57718b135398848f0c0c..bcbf3da6707c9f7a24bba42078c06b3078f10e2c)
[May 12, 2020 15:56](#event-3328187821)

[![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=80&v=4)](/douglaspalmer)

Copy link

Contributor

Author

### **[douglaspalmer](/douglaspalmer)** commented [May 12, 2020](#issuecomment-627438828)

| Thanks [@thomasdarimont](https://github.com/thomasdarimont), I've incorporated your code into my PR. |
| --- |

 👍
1
 thomasdarimont reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)
[douglaspalmer](/douglaspalmer)
marked this pull request as ready for review
[May 12, 2020 16:05](#event-3328225604)

 [![@abstractj](https://avatars.githubusercontent.com/u/21758?s=40&u=8d8e077b197bf625775072151bd269a2bafc8b69&v=4)](/abstractj)
[abstractj](/abstractj)
requested review from
[mposolda](/mposolda) and
[tkyjovsk](/tkyjovsk)
[May 12, 2020 16:41](#event-3328376350)

[![@abstractj](https://avatars.githubusercontent.com/u/21758?s=40&u=8d8e077b197bf625775072151bd269a2bafc8b69&v=4)](/abstractj)
[abstractj](/abstractj)
self-assigned this
[May 12, 2020](#event-3328376798)

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=80&u=16fbb5bf654c0098dc788adcde82aed0b3dad3c1&v=4)](/mposolda)

Copy link

Contributor

### **[mposolda](/mposolda)** commented [May 13, 2020](#issuecomment-627788915)

| [@douglaspalmer](https://github.com/douglaspalmer) Thanks for the PR. I am fine with the codebase itself. However as I pointed, it will be good to run the pipeline to make sure there are not regressions. I have some concerns especially about:   * Various adapter tests, with various JDK versions (EG. EAP6 and JBoss7 tests which use JDK 7 etc) * Server and adapter tests with IBM JDK. I have some fear about IBM JDK due the usage of the internal classes "sun.misc.ObjectInputFilter" etc. |
| --- |

All reactions

Sorry, something went wrong.

[![@abstractj](https://avatars.githubusercontent.com/u/21758?s=80&u=8d8e077b197bf625775072151bd269a2bafc8b69&v=4)](/abstractj)

Copy link

Contributor

### **[abstractj](/abstractj)** commented [May 15, 2020](#issuecomment-629535930)

| [@douglaspalmer](https://github.com/douglaspalmer) did you manage to talk with [@tkyjovsk](https://github.com/tkyjovsk)? As we approach the next release, I believe we need to wrap this up next week. |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [May 18, 2020](#issuecomment-630005277)

| In case this is not fixable for ancient JDKs, one could print a big warning on startup, with a hint for upgrading the used Java Version, if an old JVM is detected. |
| --- |

All reactions

Sorry, something went wrong.

[![@tkyjovsk](https://avatars.githubusercontent.com/u/1867605?s=80&u=e91a0b4eca81e83b754da9126daa803210ddbbd4&v=4)](/tkyjovsk)

Copy link

Contributor

### **[tkyjovsk](/tkyjovsk)** commented [May 27, 2020](#issuecomment-634868049) • edited Loading

| [@douglaspalmer](https://github.com/douglaspalmer) Hi, I've finished testing the PR. I didn't find any problem with the server but there is an issue with EAP6 client adapter and JDK 7 and 8 (independent on OS and JDK vendor). See details in the JIRA.  The POMs in this PR are still on `9.0.4-SNAPSHOT`. Should be updated to `11.0.0` to match the fix version. |
| --- |

All reactions

Sorry, something went wrong.

[![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)

`[[Keycloak-10162] Usage of ObjectInputStream without checking the obje…](/keycloak/keycloak/pull/7053/commits/d5483d884de797e2ef6e69f92085bc10bf87e864 "[Keycloak-10162] Usage of ObjectInputStream without checking the object types")`
 …

`[d5483d8](/keycloak/keycloak/pull/7053/commits/d5483d884de797e2ef6e69f92085bc10bf87e864)`

```
…ct types
```

 [![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)
[douglaspalmer](/douglaspalmer)
[force-pushed](/keycloak/keycloak/compare/bcbf3da6707c9f7a24bba42078c06b3078f10e2c..1cbfce666b8049d19a4aab52c42bd8587d66601c)
the
KEYCLOAK-10162

branch
from
[`bcbf3da`](/keycloak/keycloak/commit/bcbf3da6707c9f7a24bba42078c06b3078f10e2c) to
[`1cbfce6`](/keycloak/keycloak/commit/1cbfce666b8049d19a4aab52c42bd8587d66601c)  [Compare](/keycloak/keycloak/compare/bcbf3da6707c9f7a24bba42078c06b3078f10e2c..1cbfce666b8049d19a4aab52c42bd8587d66601c)
[June 2, 2020 21:50](#event-3399614629)

 [mposolda](/mposolda)
and others
added 2 commits
[June 3, 2020 10:13](#commits-pushed-d962a42)

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=40&v=4)](/mposolda) [![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)

`[KEYCLOAK-10162 Fix OIDCAdapterClusterTest with JDK 1.7.0_79](/keycloak/keycloak/pull/7053/commits/d962a42f561acf3cb9b0734ae56cfbb4a696bdf4 "KEYCLOAK-10162 Fix OIDCAdapterClusterTest with JDK 1.7.0_79")`

`[d962a42](/keycloak/keycloak/pull/7053/commits/d962a42f561acf3cb9b0734ae56cfbb4a696bdf4)`

[![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)

`[Fix InvalidClassException in OIDCAdapterClusterTest](/keycloak/keycloak/pull/7053/commits/5821e37eb63ff3ef45c0c0cd2ae2b54a8a242724 "Fix InvalidClassException in OIDCAdapterClusterTest")`

`[5821e37](/keycloak/keycloak/pull/7053/commits/5821e37eb63ff3ef45c0c0cd2ae2b54a8a242724)`

 [![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)
[douglaspalmer](/douglaspalmer)
[force-pushed](/keycloak/keycloak/compare/1cbfce666b8049d19a4aab52c42bd8587d66601c..5821e37eb63ff3ef45c0c0cd2ae2b54a8a242724)
the
KEYCLOAK-10162

branch
from
[`1cbfce6`](/keycloak/keycloak/commit/1cbfce666b8049d19a4aab52c42bd8587d66601c) to
[`5821e37`](/keycloak/keycloak/commit/5821e37eb63ff3ef45c0c0cd2ae2b54a8a242724)  [Compare](/keycloak/keycloak/compare/1cbfce666b8049d19a4aab52c42bd8587d66601c..5821e37eb63ff3ef45c0c0cd2ae2b54a8a242724)
[June 3, 2020 18:22](#event-3403482797)

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=80&u=16fbb5bf654c0098dc788adcde82aed0b3dad3c1&v=4)](/mposolda)

Copy link

Contributor

### **[mposolda](/mposolda)** commented [Jun 3, 2020](#issuecomment-638401421)

| FYI. I've sent another PR from this branch [#7138](https://github.com/keycloak/keycloak/pull/7138) , which adds some more test fixes ( OIDCAdapterClusterTest with various JDKs) |
| --- |

All reactions

Sorry, something went wrong.

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=40&u=16fbb5bf654c0098dc788adcde82aed0b3dad3c1&v=4)](/mposolda)
[mposolda](/mposolda)
mentioned this pull request
[Jun 3, 2020](#ref-pullrequest-630248989)

[Keycloak 10162 Usage of ObjectInputStream fix
#7138](/keycloak/keycloak/pull/7138)
 Merged

[![@abstractj](https://avatars.githubusercontent.com/u/21758?s=80&u=8d8e077b197bf625775072151bd269a2bafc8b69&v=4)](/abstractj)

Copy link

Contributor

### **[abstractj](/abstractj)** commented [Jun 8, 2020](#issuecomment-640554904)

| [@douglaspalmer](https://github.com/douglaspalmer) I believe this needs a rebase. |
| --- |

All reactions

Sorry, something went wrong.

[![@abstractj](https://avatars.githubusercontent.com/u/21758?s=80&u=8d8e077b197bf625775072151bd269a2bafc8b69&v=4)](/abstractj)

Copy link

Contributor

### **[abstractj](/abstractj)** commented [Jun 8, 2020](#issuecomment-640555444)

| [@douglaspalmer](https://github.com/douglaspalmer) it needs a rebase. |
| --- |

All reactions

Sorry, something went wrong.

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=80&u=16fbb5bf654c0098dc788adcde82aed0b3dad3c1&v=4)](/mposolda)

Copy link

Contributor

### **[mposolda](/mposolda)** commented [Jun 8, 2020](#issuecomment-640566176)

| [@abstractj](https://github.com/abstractj) Closing as this was super-seded by other PR [#7138](https://github.com/keycloak/keycloak/pull/7138) . See the email for more details |
| --- |

All reactions

Sorry, something went wrong.

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=40&u=16fbb5bf654c0098dc788adcde82aed0b3dad3c1&v=4)](/mposolda)
[mposolda](/mposolda)
closed this
[Jun 8, 2020](#event-3419755068)

This was referenced Aug 20, 2020

[Remote Code Execution (RCE)
thehyve/transmart-lib#16](/thehyve/transmart-lib/issues/16)

Closed

[Remote Code Execution (RCE) SNYK-JAVA-ORGKEYCLOAK-568921
thehyve/transmart-lib#18](/thehyve/transmart-lib/issues/18)

Closed

[Remote Code Execution (RCE) SNYK-JAVA-ORGKEYCLOAK-568921
thehyve/transmart-lib#20](/thehyve/transmart-lib/issues/20)

Closed

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Sep 30, 2020](#issuecomment-701193325) • edited Loading

| [@douglaspalmer](https://github.com/douglaspalmer) I'm using Spring Session to store the keycloak session. But reporting many `WARN` messages. Each request are slower than before using Spring Session. After I degrading the keycloak dependency version from `11.0.2` to `10.0.2`, everything is ok.  ``` 2020-09-30 14:40:34.900  INFO 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Using OnJavaAfter8 serialization filter adapter 2020-09-30 14:40:34.901  WARN 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:34.903  WARN 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.288  WARN 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.288  WARN 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.295  WARN 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.295  WARN 13212 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.322  WARN 13212 --- [nio-8007-exec-3] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.322  WARN 13212 --- [nio-8007-exec-2] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.322  WARN 13212 --- [nio-8007-exec-3] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.322  WARN 13212 --- [nio-8007-exec-4] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null 2020-09-30 14:40:35.322  WARN 13212 --- [nio-8007-exec-2] o.k.c.u.DelegatingSerializationFilter    : Could not set ObjectFilter: null    ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Sep 30, 2020](#issuecomment-701199698)

| [@zywj](https://github.com/zywj) which JDK / version are you using? |
| --- |

All reactions

Sorry, something went wrong.

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Sep 30, 2020](#issuecomment-701200641) • edited Loading

| [@thomasdarimont](https://github.com/thomasdarimont) I have tried OracleJDK 8/11 and OpenJDK 8-hotspot , OpenJDK 8-openj9. |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Sep 30, 2020](#issuecomment-701494305)

| [@zywj](https://github.com/zywj) can you check with a debugger which exception is thrown in `org.keycloak.common.util.DelegatingSerializationFilter.OnJavaAfter8#setObjectInputFilter` ? |
| --- |

All reactions

Sorry, something went wrong.

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Oct 2, 2020](#issuecomment-702552134) • edited Loading

| [@thomasdarimont](https://github.com/thomasdarimont) result of jdk 11: [image](https://user-images.githubusercontent.com/5554211/94894148-62ec9780-04bb-11eb-8df4-064c86a07519.png)  result of jdk 8: [image](https://user-images.githubusercontent.com/5554211/94894449-f756fa00-04bb-11eb-873d-b1083038dc88.png) |
| --- |

All reactions

Sorry, something went wrong.

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=80&u=16fbb5bf654c0098dc788adcde82aed0b3dad3c1&v=4)](/mposolda)

Copy link

Contributor

### **[mposolda](/mposolda)** commented [Oct 2, 2020](#issuecomment-702581421)

| [@zywj](https://github.com/zywj) There is some work in progress on the issue related to this. We may have more updates regarding this next week... |
| --- |

All reactions

Sorry, something went wrong.

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Oct 2, 2020](#issuecomment-702612450)

| [@mposolda](https://github.com/mposolda) thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 2, 2020](#issuecomment-702661274)

| [@zywj](https://github.com/zywj) it seems that the line with the `totalObjectRefs` check in `ObjectInputStream.setObjectFilter` (on Java 9 - 11) respective `ObjectInputStream.setInternalObjectInputFilter` (in Java 8) causes the exception: This is check is not present in JDK12+.  ```     public final void setObjectInputFilter(ObjectInputFilter filter) {         SecurityManager sm = System.getSecurityManager();         if (sm != null) {             sm.checkPermission(ObjectStreamConstants.SERIAL_FILTER_PERMISSION);         }         // Allow replacement of the process-wide filter if not already set         if (serialFilter != null &&                 serialFilter != ObjectInputFilter.Config.getSerialFilter()) {             throw new IllegalStateException("filter can not be set more than once");         }         if (totalObjectRefs > 0 && !Caches.SET_FILTER_AFTER_READ) {             throw new IllegalStateException(                     "filter can not be set after an object has been read");         }         this.serialFilter = filter;     }  ```  Could you try running your app with a JDK greater than 11? |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 2, 2020](#issuecomment-702668513)

| Close but no cigar... the check was present in Java 11, then gone in 12,13,14 and was reintroduced in 15. |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 2, 2020](#issuecomment-702673569) • edited Loading

| There is the System property `jdk.serialSetFilterAfterRead` that you can set to `true` to explicitly allow setting the ObjectFilter after the Object has been read.  ``` -Djdk.serialSetFilterAfterRead=true  ```  A potential workaround for the problem could be checking the internal state of the `ObjectInputStream` for preceding reads and avoid setting the filter in that case that would trigger the exception. See below.  ``` import org.jboss.logging.Logger;  import java.io.ObjectInputStream; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.lang.reflect.Modifier; import java.util.Arrays; import java.util.HashSet; import java.util.List; import java.util.Set;  public class DelegatingSerializationFilter {     private static final Logger LOG = Logger.getLogger(DelegatingSerializationFilter.class.getName());      private static final boolean JDK_SERIAL_SET_FILTER_AFTER_READ_ALLOWED = Boolean.getBoolean("jdk.serialSetFilterAfterRead");      private static final SerializationFilterAdapter serializationFilterAdapter = isJava6To8() ? createOnJava6To8Adapter() : createOnJavaAfter8Adapter();      private static boolean isJava6To8() {         List<String> olderVersions = Arrays.asList("1.6", "1.7", "1.8");         return olderVersions.contains(System.getProperty("java.specification.version"));     }      private DelegatingSerializationFilter() {     }      public static DelegatingSerializationFilter.FilterPatternBuilder builder() {         return new DelegatingSerializationFilter.FilterPatternBuilder();     }      private void setFilter(ObjectInputStream ois, String filterPattern) {         LOG.debugf("Using: %s", serializationFilterAdapter.getClass().getSimpleName());          if (serializationFilterAdapter.getObjectInputFilter(ois) == null) {             serializationFilterAdapter.setObjectInputFilter(ois, filterPattern);         }     }      interface SerializationFilterAdapter {          Object getObjectInputFilter(ObjectInputStream ois);          void setObjectInputFilter(ObjectInputStream ois, String filterPattern);     }      private static SerializationFilterAdapter createOnJava6To8Adapter() {         try {             ClassLoader cl = Thread.currentThread().getContextClassLoader();             Class<?> objectInputFilterClass = cl.loadClass("sun.misc.ObjectInputFilter");             Class<?> objectInputFilterConfigClass = cl.loadClass("sun.misc.ObjectInputFilter$Config");             Method getObjectInputFilter = objectInputFilterConfigClass.getDeclaredMethod("getObjectInputFilter", ObjectInputStream.class);             Method setObjectInputFilter = objectInputFilterConfigClass.getDeclaredMethod("setObjectInputFilter", ObjectInputStream.class, objectInputFilterClass);             Method createFilter = objectInputFilterConfigClass.getDeclaredMethod("createFilter", String.class);              LOG.info("Using OnJava6To8 serialization filter adapter");             if (JDK_SERIAL_SET_FILTER_AFTER_READ_ALLOWED) {                 return new OnJava6To8(getObjectInputFilter, setObjectInputFilter, createFilter, null);             } else {                 // Before setting the ObjectInputFilter, we need to check the internal state of the ObjectInputStream to avoid exceptions if the stream was already used before.                 Field totalObjectRefsField = null;                 try {                     // this field is checked in the setInternalObjectFilterMethod                     // lookup totalObjectRefsField to guard ObjectInputFilter configuration                     totalObjectRefsField = ObjectInputStream.class.getDeclaredField("totalObjectRefs");                     makeAccessible(totalObjectRefsField);                 } catch (NoSuchFieldException e) {                     LOG.debug("Could not find totalObjectRefs field in ObjectInputStream", e);                 }                 return new OnJava6To8(getObjectInputFilter, setObjectInputFilter, createFilter, totalObjectRefsField);             }         } catch (ClassNotFoundException | NoSuchMethodException e) {             // This can happen for older JDK updates.             LOG.warn("Could not configure SerializationFilterAdapter. For better security, it is highly recommended to upgrade to newer JDK version update!");             LOG.warn("For the Java 7, the recommended update is at least 131 (1.7.0_131 or newer). For the Java 8, the recommended update is at least 121 (1.8.0_121 or newer).");             LOG.warn("Error details", e);             return new EmptyFilterAdapter();         }     }      private static SerializationFilterAdapter createOnJavaAfter8Adapter() {         try {             ClassLoader cl = Thread.currentThread().getContextClassLoader();             Class<?> objectInputFilterClass = cl.loadClass("java.io.ObjectInputFilter");             Class<?> objectInputFilterConfigClass = cl.loadClass("java.io.ObjectInputFilter$Config");             Class<?> objectInputStreamClass = cl.loadClass("java.io.ObjectInputStream");             Method getObjectInputFilter = objectInputStreamClass.getDeclaredMethod("getObjectInputFilter");             Method setObjectInputFilter = objectInputStreamClass.getDeclaredMethod("setObjectInputFilter", objectInputFilterClass);             Method createFilter = objectInputFilterConfigClass.getDeclaredMethod("createFilter", String.class);              LOG.info("Using OnJavaAfter8 serialization filter adapter");             if (JDK_SERIAL_SET_FILTER_AFTER_READ_ALLOWED) {                 return new OnJavaAfter8(getObjectInputFilter, setObjectInputFilter, createFilter, null);             } else {                 // Before setting the ObjectInputFilter, we need to check the internal state of the ObjectInputStream to avoid exceptions if the stream was already used before.                 Field totalObjectRefsField = null;                 try {                     // this field is checked in the setObjectFilterMethod in JDK 9-11 and 15-16+? but not in 12-14                     // lookup totalObjectRefsField to guard ObjectInputFilter configuration                     totalObjectRefsField = ObjectInputStream.class.getDeclaredField("totalObjectRefs");                     makeAccessible(totalObjectRefsField);                 } catch (NoSuchFieldException e) {                     LOG.debug("Could not find totalObjectRefs field in ObjectInputStream", e);                 }                 return new OnJavaAfter8(getObjectInputFilter, setObjectInputFilter, createFilter, totalObjectRefsField);             }         } catch (ClassNotFoundException | NoSuchMethodException e) {             // This can happen for older JDK updates.             LOG.warn("Could not configure SerializationFilterAdapter. For better security, it is highly recommended to upgrade to newer JDK version update!");             LOG.warn("Error details", e);             return new EmptyFilterAdapter();         }     }      private static void makeAccessible(Field field) {         if ((!Modifier.isPublic(field.getModifiers()) ||                 !Modifier.isPublic(field.getDeclaringClass().getModifiers()) ||                 Modifier.isFinal(field.getModifiers())) && !field.isAccessible()) {             field.setAccessible(true);         }     }      static class EmptyFilterAdapter implements SerializationFilterAdapter {          @Override         public Object getObjectInputFilter(ObjectInputStream ois) {             return null;         }          @Override         public void setObjectInputFilter(ObjectInputStream ois, String filterPattern) {             // NOOP         }     }      // If codebase stays on Java 8 for a while you could use Java 8 classes directly without reflection     static class OnJava6To8 implements SerializationFilterAdapter {          private final Method getObjectInputFilterMethod;         private final Method setObjectInputFilterMethod;         private final Method createFilterMethod;         private final Field totalObjectRefsField;          private OnJava6To8(Method getObjectInputFilterMethod, Method setObjectInputFilterMethod, Method createFilterMethod, Field totalObjectRefsField) {             this.getObjectInputFilterMethod = getObjectInputFilterMethod;             this.setObjectInputFilterMethod = setObjectInputFilterMethod;             this.createFilterMethod = createFilterMethod;             this.totalObjectRefsField = totalObjectRefsField;         }          public Object getObjectInputFilter(ObjectInputStream ois) {             try {                 return getObjectInputFilterMethod.invoke(null, ois);             } catch (IllegalAccessException | InvocationTargetException e) {                 LOG.warnf("Could not read ObjectFilter from ObjectInputStream: %s", e.getMessage());                 return null;             }         }          public void setObjectInputFilter(ObjectInputStream ois, String filterPattern) {             try {                 // Avoid causing an exception when setting the filter to an ObjectInputStream which has already been read from.                 // workaround for bug "filter cannot be set after an object has been read"                 // https://github.com/keycloak/keycloak/pull/7053#issuecomment-701193325                 if (totalObjectRefsField != null) {                     Long totalObjectRefs = (Long) totalObjectRefsField.get(ois);                     if (totalObjectRefs != null && totalObjectRefs > 0L) {                         LOG.debugf("Skip configuring ObjectInputFilter for ObjectInputStream to avoid Exception after object has been read");                         return;                     }                 }                  Object objectFilter = createFilterMethod.invoke(null, filterPattern);                 setObjectInputFilterMethod.invoke(null, ois, objectFilter);             } catch (IllegalAccessException | InvocationTargetException e) {                 LOG.warnf("Could not set ObjectFilter: %s", e.getMessage());             }         }     }      // If codebase moves to Java 9+ could use Java 9+ classes directly without reflection and keep the old variant with reflection     static class OnJavaAfter8 implements SerializationFilterAdapter {          private final Method getObjectInputFilterMethod;         private final Method setObjectInputFilterMethod;         private final Method createFilterMethod;         private final Field totalObjectRefsField;          private OnJavaAfter8(Method getObjectInputFilterMethod, Method setObjectInputFilterMethod, Method createFilterMethod, Field totalObjectRefsField) {             this.getObjectInputFilterMethod = getObjectInputFilterMethod;             this.setObjectInputFilterMethod = setObjectInputFilterMethod;             this.createFilterMethod = createFilterMethod;             this.totalObjectRefsField = totalObjectRefsField;         }          public Object getObjectInputFilter(ObjectInputStream ois) {             try {                 return getObjectInputFilterMethod.invoke(ois);             } catch (IllegalAccessException | InvocationTargetException e) {                 LOG.warnf("Could not read ObjectFilter from ObjectInputStream: %s", e.getMessage());                 return null;             }         }          public void setObjectInputFilter(ObjectInputStream ois, String filterPattern) {             try {                 // Avoid causing an exception when setting the filter to an ObjectInputStream which has already been read from.                 // workaround for bug "filter cannot be set after an object has been read"                 // This happens in Java 9-11 and from 15-16                 // https://github.com/keycloak/keycloak/pull/7053#issuecomment-701193325                 if (totalObjectRefsField != null) {                     Long totalObjectRefs = (Long) totalObjectRefsField.get(ois);                     if (totalObjectRefs != null && totalObjectRefs > 0L) {                         LOG.debugf("Skip configuring ObjectInputFilter for ObjectInputStream to avoid Exception after object has been read");                         return;                     }                 }                  Object objectFilter = createFilterMethod.invoke(ois, filterPattern);                 setObjectInputFilterMethod.invoke(ois, objectFilter);             } catch (IllegalAccessException | InvocationTargetException e) {                 LOG.warnf("Could not set ObjectFilter: %s", e.getMessage());             }         }     }      public static class FilterPatternBuilder {          private Set<Class> classes = new HashSet<>();         private Set<String> patterns = new HashSet<>();          public FilterPatternBuilder() {             // Add "java.util" package by default (contains all the basic collections)             addAllowedPattern("java.util.*");         }          /**          * This is used when the caller of this method can't use the {@link #addAllowedClass(Class)}. For example because the          * particular is private or it is not available at the compile time. Or when adding the whole package like "java.util.*"          *          * @param pattern          * @return          */         public FilterPatternBuilder addAllowedPattern(String pattern) {             this.patterns.add(pattern);             return this;         }          public FilterPatternBuilder addAllowedClass(Class javaClass) {             this.classes.add(javaClass);             return this;         }          @Override         public String toString() {             StringBuilder builder = new StringBuilder();              for (Class javaClass : classes) {                 builder.append(javaClass.getName()).append(";");             }             for (String pattern : patterns) {                 builder.append(pattern).append(";");             }              builder.append("!*");              return builder.toString();         }          public void setFilter(ObjectInputStream ois) {             DelegatingSerializationFilter filter = new DelegatingSerializationFilter();             String filterPattern = this.toString();             filter.setFilter(ois, filterPattern);         }     } } ```  This can be tested with the following program which works for JDK 8 - JDK 16:  ``` import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.IOException; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.io.Serializable;  public class KeycloakDelegatingSerializationBug {      public static void main(String[] args) throws Exception{  //        System.setSecurityManager(new SecurityManager());          transport();         transport();     }      private static void transport() throws IOException, ClassNotFoundException {         ByteArrayOutputStream baos = new ByteArrayOutputStream();         ObjectOutputStream oos = new ObjectOutputStream(baos);          oos.writeObject(new Data());         oos.writeObject(new Data());           ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(baos.toByteArray()));          Object result = ois.readObject();         System.out.println(result);          DelegatingSerializationFilter.builder().addAllowedPattern("*").setFilter(ois);          result = ois.readObject();         System.out.println(result);     }      public static class Data implements Serializable {         String s = "foo";         int i = 42;          public Data() {         }          @Override         public String toString() {             return "Data{" +                     "s='" + s + '\'' +                     ", i=" + i +                     '}';         }     } } ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 2, 2020](#issuecomment-702676621)

| [@zywj](https://github.com/zywj) could you try to run your app with:  ``` -Djdk.serialSetFilterAfterRead=true  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Oct 2, 2020](#issuecomment-702685502)

| [@thomasdarimont](https://github.com/thomasdarimont) thanks. i'll try it tomorrow |
| --- |

All reactions

Sorry, something went wrong.

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Oct 3, 2020](#issuecomment-703098982) • edited Loading

| [@thomasdarimont](https://github.com/thomasdarimont) After setting up the `jdk.serialSetFilterAfterRead=true`, it reports the spring session data redis error. My JDK/Version is OracleJDK 11  ``` 2020-10-03 20:50:12.943  INFO 23012 --- [nio-8007-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet' 2020-10-03 20:50:12.943  INFO 23012 --- [nio-8007-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet' 2020-10-03 20:50:12.966  INFO 23012 --- [nio-8007-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 23 ms 2020-10-03 20:50:12.994  INFO 23012 --- [nio-8007-exec-1] o.k.c.u.DelegatingSerializationFilter    : Using OnJavaAfter8 serialization filter adapter 2020-10-03 20:50:13.001 ERROR 23012 --- [nio-8007-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception  org.springframework.data.redis.serializer.SerializationException: Cannot deserialize; nested exception is org.springframework.core.serializer.support.SerializationFailedException: Failed to deserialize payload. Is the byte array a result of corresponding serialization for DefaultDeserializer?; nested exception is java.io.InvalidClassException: filter status: REJECTED 	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.deserialize(JdkSerializationRedisSerializer.java:84) ~[spring-data-redis-2.3.4.RELEASE.jar:2.3.4.RELEASE] 	at org.springframework.data.redis.core.AbstractOperations.deserializeHashValue(AbstractOperations.java:355) ~[spring-data-redis-2.3.4.RELEASE.jar:2.3.4.RELEASE] 	at org.springframework.data.redis.core.AbstractOperations.deserializeHashMap(AbstractOperations.java:299) ~[spring-data-redis-2.3.4.RELEASE.jar:2.3.4.RELEASE] 	at org.springframework.data.redis.core.DefaultHashOperations.entries(DefaultHashOperations.java:247) ~[spring-data-redis-2.3.4.RELEASE.jar:2.3.4.RELEASE] 	at org.springframework.data.redis.core.DefaultBoundHashOperations.entries(DefaultBoundHashOperations.java:183) ~[spring-data-redis-2.3.4.RELEASE.jar:2.3.4.RELEASE] 	at org.springframework.session.data.redis.RedisIndexedSessionRepository.getSession(RedisIndexedSessionRepository.java:440) ~[spring-session-data-redis-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.springframework.session.data.redis.RedisIndexedSessionRepository.findById(RedisIndexedSessionRepository.java:412) ~[spring-session-data-redis-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.springframework.session.data.redis.RedisIndexedSessionRepository.findById(RedisIndexedSessionRepository.java:249) ~[spring-session-data-redis-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.springframework.session.web.http.SessionRepositoryFilter$SessionRepositoryRequestWrapper.getRequestedSession(SessionRepositoryFilter.java:351) ~[spring-session-core-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.springframework.session.web.http.SessionRepositoryFilter$SessionRepositoryRequestWrapper.getSession(SessionRepositoryFilter.java:289) ~[spring-session-core-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.springframework.session.web.http.SessionRepositoryFilter$SessionRepositoryRequestWrapper.getSession(SessionRepositoryFilter.java:192) ~[spring-session-core-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at javax.servlet.http.HttpServletRequestWrapper.getSession(HttpServletRequestWrapper.java:244) ~[tomcat-embed-core-9.0.38.jar:4.0.FR] 	at org.springframework.security.web.context.HttpSessionSecurityContextRepository.loadContext(HttpSessionSecurityContextRepository.java:111) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:100) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:56) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:334) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:215) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:178) ~[spring-security-web-5.3.4.RELEASE.jar:5.3.4.RELEASE] 	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:358) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:271) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.springframework.session.web.http.SessionRepositoryFilter.doFilterInternal(SessionRepositoryFilter.java:141) ~[spring-session-core-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.springframework.session.web.http.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:82) ~[spring-session-core-2.3.1.RELEASE.jar:2.3.1.RELEASE] 	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.7.RELEASE.jar:5.2.7.RELEASE] 	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.keycloak.adapters.tomcat.AbstractAuthenticatedActionsValve.invoke(AbstractAuthenticatedActionsValve.java:67) ~[spring-boot-container-bundle-11.0.0.jar:11.0.0] 	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.keycloak.adapters.tomcat.AbstractKeycloakAuthenticatorValve.invoke(AbstractKeycloakAuthenticatorValve.java:181) ~[spring-boot-container-bundle-11.0.0.jar:11.0.0] 	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:143) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:374) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[na:na] 	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[na:na] 	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-9.0.38.jar:9.0.38] 	at java.base/java.lang.Thread.run(Thread.java:834) ~[na:na] Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to deserialize payload. Is the byte array a result of corresponding serialization for DefaultDeserializer?; nested exception is java.io.InvalidClassException: filter status: REJECTED 	at org.springframework.core.serializer.support.DeserializingConverter.convert(DeserializingConverter.java:78) ~[spring-core-5.2.9.RELEASE.jar:5.2.9.RELEASE] 	at org.springframework.core.serializer.support.DeserializingConverter.convert(DeserializingConverter.java:36) ~[spring-core-5.2.9.RELEASE.jar:5.2.9.RELEASE] 	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.deserialize(JdkSerializationRedisSerializer.java:82) ~[spring-data-redis-2.3.4.RELEASE.jar:2.3.4.RELEASE] 	... 57 common frames omitted Caused by: java.io.InvalidClassException: filter status: REJECTED 	at java.base/java.io.ObjectInputStream.filterCheck(ObjectInputStream.java:1343) ~[na:na] 	at java.base/java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1975) ~[na:na] 	at java.base/java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1851) ~[na:na] 	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2139) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1668) ~[na:na] 	at java.base/java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2434) ~[na:na] 	at java.base/java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:618) ~[na:na] 	at org.keycloak.KeycloakPrincipal.readObject(KeycloakPrincipal.java:77) ~[keycloak-core-11.0.0.jar:11.0.0] 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na] 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na] 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na] 	at java.base/java.lang.reflect.Method.invoke(Method.java:566) ~[na:na] 	at java.base/java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1175) ~[na:na] 	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2295) ~[na:na] 	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2166) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1668) ~[na:na] 	at java.base/java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2434) ~[na:na] 	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2328) ~[na:na] 	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2166) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1668) ~[na:na] 	at java.base/java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2434) ~[na:na] 	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2328) ~[na:na] 	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2166) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1668) ~[na:na] 	at java.base/java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2434) ~[na:na] 	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2328) ~[na:na] 	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2166) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1668) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:482) ~[na:na] 	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:440) ~[na:na] 	at org.springframework.core.serializer.DefaultDeserializer.deserialize(DefaultDeserializer.java:72) ~[spring-core-5.2.9.RELEASE.jar:5.2.9.RELEASE] 	at org.springframework.core.serializer.support.DeserializingConverter.convert(DeserializingConverter.java:73) ~[spring-core-5.2.9.RELEASE.jar:5.2.9.RELEASE] 	... 59 common frames omitted   ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 4, 2020](#issuecomment-703232452) • edited Loading

| This exception indicates that you are trying to deserialize types, which are not allowed by the class / package patterns configured in the `FilterPatternBuilder`. I think the problem is triggered here: <https://github.com/keycloak/keycloak/blob/master/core/src/main/java/org/keycloak/KeycloakPrincipal.java#L77>  Could you find out what is missing from the allowed classes, package patterns and tell us? To do that you can set a breakpoint here: `java.io.ObjectInputStream#filterCheck` after `serialFilter.checkInput(...)`).  If you find the missing class you could try to shadow the class `org.keycloak.KeycloakPrincipal` with an appropriate `readObject` method by compiling it along your `src/main/java` source folder.  I think we need a way to configure the DelegatingSerializationFilter via a system property |
| --- |

All reactions

Sorry, something went wrong.

[![@mhajas](https://avatars.githubusercontent.com/u/13901995?s=80&u=b13bcd994bf4da4052f50a797881c2d0a2f43319&v=4)](/mhajas)

Copy link

Contributor

### **[mhajas](/mhajas)** commented [Oct 6, 2020](#issuecomment-704263066)

| [@zywj](https://github.com/zywj) [@thomasdarimont](https://github.com/thomasdarimont) It seems the later issue is already reported here: <https://issues.redhat.com/browse/KEYCLOAK-14871>.  [@zywj](https://github.com/zywj) Could you please check this: [#7471](https://github.com/keycloak/keycloak/pull/7471) solved the `InvalidClassException: filter status: REJECTED` issue? |
| --- |

All reactions

Sorry, something went wrong.

[![@mhajas](https://avatars.githubusercontent.com/u/13901995?s=80&u=b13bcd994bf4da4052f50a797881c2d0a2f43319&v=4)](/mhajas)

Copy link

Contributor

### **[mhajas](/mhajas)** commented [Oct 6, 2020](#issuecomment-704271193)

| [@thomasdarimont](https://github.com/thomasdarimont) Could you please open a new PR with your solution for the `Could not set ObjectFilter: null` issue? We can continue with the discussion there. This way it is hard for us to see what you have changed. |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 6, 2020](#issuecomment-704552012)

| [@mhajas](https://github.com/mhajas) I could create a new PR, but I think my solution is more of a hack than a real solution... One of the problems mentioned above was, that the `ObjectInputStream` implementations across various JDKs throw an `IllegalStateException("filter can not be set after an object has been read")` if one tries to configure an `ObjectInputFilter` on an `ObjectInputStream` which was already used, e.g. read from. In my example, I avoid the `IllegalStateException` by peeking into the internal state of `ObjectInputStream` to detect whether the `ObjectInputStream` was already used. In that case, I simply skip setting the filter and log a debug message - which leaves the `ObjectInputStream` vulnerable without a filter.  I think the following "fix" would be better:   * Add a note to the documentation for consumers of the Keycloak API about how to avoid the `IllegalStateException("filter can not be set after an object has been read")` when deserializing Keycloak data structures:   Either ensure that the ObjectInputStreams used to deserialize Keycloak data structures are "unused" or set the system property `jdk.serialSetFilterAfterRead=true`.   For the record here are the changes I did to the `DelegatingSerilizationFilter`: [https://github.com/keycloak/keycloak/compare/master...thomasdarimont:issue/KEYCLOAK-XXX-More-Robust-ObjectInputFilterConfig?expand=1](https://github.com/keycloak/keycloak/compare/master...thomasdarimont%3Aissue/KEYCLOAK-XXX-More-Robust-ObjectInputFilterConfig?expand=1) Apart from my hack I think some elements from the branch could be used, e.g. the revised logging parameters. |
| --- |

All reactions

Sorry, something went wrong.

[![@zywj](https://avatars.githubusercontent.com/u/5554211?s=80&u=52d891d69f3f4767905e9b66c13a82e4f9d25064&v=4)](/zywj)

Copy link

Contributor

### **[zywj](/zywj)** commented [Oct 7, 2020](#issuecomment-704639480)

| [@mhajas](https://github.com/mhajas) Sorry, I don't know how to test your code. Do I need to compile keycloak source code?  Close but no cigar... the check was present in Java 11, then gone in 12,13,14 and was reintroduced in 15.  [@thomasdarimont](https://github.com/thomasdarimont) Yes. It can be reproduced in 15. So I think the keycloak might has a bug. |
| --- |

All reactions

Sorry, something went wrong.

[![@mhajas](https://avatars.githubusercontent.com/u/13901995?s=80&u=b13bcd994bf4da4052f50a797881c2d0a2f43319&v=4)](/mhajas)

Copy link

Contributor

### **[mhajas](/mhajas)** commented [Oct 7, 2020](#issuecomment-704768082)

| [@mhajas](https://github.com/mhajas) I could create a new PR, but I think my solution is more of a hack than a real solution... One of the problems mentioned above was, that the `ObjectInputStream` implementations across various JDKs throw an `IllegalStateException("filter can not be set after an object has been read")` if one tries to configure an `ObjectInputFilter` on an `ObjectInputStream` which was already used, e.g. read from. In my example, I avoid the `IllegalStateException` by peeking into the internal state of `ObjectInputStream` to detect whether the `ObjectInputStream` was already used. In that case, I simply skip setting the filter and log a debug message - which leaves the `ObjectInputStream` vulnerable without a filter.  I think the following "fix" would be better:   * Add a note to the documentation for consumers of the Keycloak API about how to avoid the `IllegalStateException("filter can not be set after an object has been read")` when deserializing Keycloak data structures:   Either ensure that the ObjectInputStreams used to deserialize Keycloak data structures are "unused" or set the system property `jdk.serialSetFilterAfterRead=true`.   For the record here are the changes I did to the `DelegatingSerilizationFilter`: [https://github.com/keycloak/keycloak/compare/master...thomasdarimont:issue/KEYCLOAK-XXX-More-Robust-ObjectInputFilterConfig?expand=1](https://github.com/keycloak/keycloak/compare/master...thomasdarimont%3Aissue/KEYCLOAK-XXX-More-Robust-ObjectInputFilterConfig?expand=1) Apart from my hack I think some elements from the branch could be used, e.g. the revised logging parameters.  [@thomasdarimont](https://github.com/thomasdarimont) I think we could do both. Add the note to the documentation. And add your workaround to the DelegatingSerilizationFilter, however, I would change the debug log to warning for the `Skip configuring ObjectInputFilter...` message, so that from the log it can be seen that `jdk.serialSetFilterAfterRead` should be set to true. [@mposolda](https://github.com/mposolda) WDYT?  [@mhajas](https://github.com/mhajas) Sorry, I don't know how to test your code. Do I need to compile keycloak source code?  Sorry, it is my fault. Can you try with [this keycloak-core jar file](https://issues.redhat.com/secure/attachment/12497901/keycloak-core-11.0.2.jar)? I uploaded updated jar file here: <https://issues.redhat.com/browse/KEYCLOAK-14871>. |
| --- |

All reactions

Sorry, something went wrong.

[![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=80&u=8a8aa2edf3fcc55b2fcb7daf88a77b666204c46a&v=4)](/thomasdarimont)

Copy link

Contributor

### **[thomasdarimont](/thomasdarimont)** commented [Oct 8, 2020](#issuecomment-705767814)

| [@mhajas](https://github.com/mhajas) I think documenting this and mentioning the option with the System property is the only sensible thing we can do. Peeking into the internals of `ObjectInputStream` to avoid an exception is quite nasty especially if a consequence of this is that "no" `ObjectInputFilter` is applied at all.  I recommend to "fix" this with a section in the Keycloak documentation (and perhaps a reference in the release notes). |
| --- |

All reactions

Sorry, something went wrong.

[![@mhajas](https://avatars.githubusercontent.com/u/13901995?s=80&u=b13bcd994bf4da4052f50a797881c2d0a2f43319&v=4)](/mhajas)

Copy link

Contributor

### **[mhajas](/mhajas)** commented [Oct 9, 2020](#issuecomment-706058115)

| [@thomasdarimont](https://github.com/thomasdarimont) If I understand correctly, currently the exception is ignored as well right? There is just this message `Could not set ObjectFilter: null`. So I just wanted to make the message meaningful, so that when it pops out, everybody knows what is the problem, and what they should do to avoid it. I created a Jira for this issue: <https://issues.redhat.com/browse/KEYCLOAK-15901>. If you have something more to add to this issue, please add a comment there. |
| --- |

All reactions

Sorry, something went wrong.

[![@hoangdinhnarvar](https://avatars.githubusercontent.com/u/60675209?s=80&v=4)](/hoangdinhnarvar)

Copy link

### **[hoangdinhnarvar](/hoangdinhnarvar)** commented [Oct 16, 2020](#issuecomment-709916185)

| Adding `weblogic.oif.serialFilter=sun.misc.ObjectInputFilter` also works for me. |
| --- |

All reactions

Sorry, something went wrong.

[![@Dretch](https://avatars.githubusercontent.com/u/1428731?s=40&v=4)](/Dretch)
[Dretch](/Dretch)
mentioned this pull request
[Jan 6, 2022](#ref-issue-1095383846)

[KeycloakPrincipal and KeycloakSecurityContext break ObjectInputStream serialization by modifying the stream's filterPattern
#9408](/keycloak/keycloak/issues/9408)

Closed

[![@JayAhn2](https://avatars.githubusercontent.com/u/25868002?s=80&u=1fcd5fce101e3ff88c5cb3d5f69b159d50b0083d&v=4)](/JayAhn2)

Copy link

### **[JayAhn2](/JayAhn2)** commented [Aug 31, 2022](#issuecomment-1233236134)

| It happens after introducing spring-session. Using Keycloak 18.0.2 |
| --- |

All reactions

Sorry, something went wrong.

 [![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=40&v=4)](/douglaspalmer)
[douglaspalmer](/douglaspalmer)
deleted the
KEYCLOAK-10162

branch
[July 4, 2023 16:36](#event-9723627927)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeycloak%2Fkeycloak%2Fpull%2F7053)

Reviewers

[![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=40&v=4)](/mposolda) [mposolda](/mposolda)

 Awaiting requested review from mposolda

[![@tkyjovsk](https://avatars.githubusercontent.com/u/1867605?s=40&v=4)](/tkyjovsk) [tkyjovsk](/tkyjovsk)

 Awaiting requested review from tkyjovsk

Assignees

[![@abstractj](https://avatars.githubusercontent.com/u/21758?s=40&v=4)](/abstractj) [abstractj](/abstractj)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

9 participants

[![@douglaspalmer](https://avatars.githubusercontent.com/u/642289?s=52&v=4)](/douglaspalmer) [![@thomasdarimont](https://avatars.githubusercontent.com/u/314690?s=52&v=4)](/thomasdarimont) [![@mposolda](https://avatars.githubusercontent.com/u/1223965?s=52&v=4)](/mposolda) [![@abstractj](https://avatars.githubusercontent.com/u/21758?s=52&v=4)](/abstractj) [![@tkyjovsk](https://avatars.githubusercontent.com/u/1867605?s=52&v=4)](/tkyjovsk) [![@zywj](https://avatars.githubusercontent.com/u/5554211?s=52&v=4)](/zywj) [![@mhajas](https://avatars.githubusercontent.com/u/13901995?s=52&v=4)](/mhajas) [![@hoangdinhnarvar](https://avatars.githubusercontent.com/u/60675209?s=52&v=4)](/hoangdinhnarvar) [![@JayAhn2](https://avatars.githubusercontent.com/u/25868002?s=52&v=4)](/JayAhn2)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_4327ce8d_20250119_142305.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


