=== Content from www.juniper.net_eaacc10c_20250119_112011.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [Overview of Active Directory as Identity Source](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_yfk_1q1_3cc)
* [Windows Management Instrumentation Client (WMIC)](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_upp_n41_3cc)
* [Domain PC Probing](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_mwp_1p1_3cc)
* [LDAP for Active Directory as Identity Source](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_gsv_jp1_3cc)
* [Active Directory as Identity Source Authentication Table](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_pmj_pp1_3cc)
* [Active Directory as Identity Source Timeout Setting](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_ccr_5r1_3cc)
Â
# Active Directory as Identity Source

Learn about Active Directory as an identity source, its benefits, and how an Active
Directory works as an identity source.

An identity source stores user information in a database. You can use this information for
user authentication. Active Directory as an identity source defines integration of
*firewall* with Microsoft Windows Active Directory.

Tip:

Active Directory as identity source was previously known as Integrated User Firewall.

## Overview of Active Directory as Identity Source

[Figure 1](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__fig_kml_wjg_fcc) illustrates a typical scenario where the Active Directory as identity source is deployed.
Users inside and outside the Active Directory domain need to access the Internet through a
device.

* [Benefits](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_vty_1q1_3cc)
* [How does Active Directory as Identity Source Work?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_l5d_cq1_3cc)

### Benefits

* Simplifies configuration steps and provides best-effort security to access the
  device.
* Ideal for medium businesses and up to medium-scale deployments.
* Supports high availability (HA).
* Configuration of captive portal is optional for users who do not authenticate.

### How does Active Directory as Identity Source Work?

Figure 1: Active Directory as Identity Source Deployment
![Active Directory as Identity Source Deployment](../../images/jn-000796.png)

Table 1: Components of Active Directory as Identity Source
| Components | Description |
| --- | --- |
| Domain Controller | Domain controller helps to apply security policies for request access to user authentication resources. The domain controller might also act as the LDAP server. |
| Domain PC | Connected windows computers group that share user account information and a security policy. |
| Non-domain PC | Users can access Windows desktop enviroment from any location using a device with internet connectivity. |
| LDAP authentication server for non-domain user | LDAP protocol helps identify the groups to which users belong. The username and group information are queried from the LDAP service in the Active Directory controller. |

1. The device reads and analyzes the Windows event log of the active directory
   controller and generates an authentication table.
2. The Active Directory as identity source is aware of any domain user via the
   authentication table.
3. The device configures a policy that enforces the required user-based or group-based
   access control.
4. For any non-domain user or domain user on a non-domain machine, the administrator
   specifies a captive portal to force the user to authenticate (if the device supports
   captive portal for the traffic type).
5. After users enter their names and passwords and authenticate, the device gets
   user/group information and enforces the policy.
6. In addition to captive portal, if the IP address or user information is not available
   from the event log, users can again log in to the Windows PC to generate an event log
   entry. Then, the system generates the user authentication entry.

## Windows Management Instrumentation Client (WMIC)

* [What is Windows Management Instrumentation Client (WMIC)?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_kf3_q41_3cc)
* [How WMIC reads the Event Log on the Domain Controller?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_sw1_t41_3cc)
* [Specify IP Filters to Limit IP-to-User Mapping](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_zn4_541_3cc)
* [Windows Event Log Verification and Statistics](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_elw_w41_3cc)
* [Firewall Authentication as backup to WMIC](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_hct_y41_3cc)

### What is Windows Management Instrumentation Client (WMIC)?

When you configure the Active Directory as identity source, the device establishes a
Windows Management Instrumentation (WMI)/Distributed Component Object Module (DCOM)
connection with the domain controller. The device acts as a WMI client (WMIC). The device
reads and monitors the security event log on the domain controller. The device analyzes
the event messages to generate IP address-to-user mapping information.

### How WMIC reads the Event Log on the Domain Controller?

WMIC reads the event log on the domain controller in following manner:

1. The device monitors the event log at a configurable interval, which defaults to 10
   seconds.
2. The device reads the event log for a certain timespan, which you can configure. The
   default timespan is one hour.
3. Each time at WMIC starts up, the device checks the last timestamp and the current
   timespan. If the last timestamp is older than the current timespan, then the current
   timespan takes effect.
4. The device can read the event log to obtain both IPv4 and IPv6 addresses.
5. When WMIC starts up, the device has a maximum count of events that it can read from
   the event log. You cannot configure the maximum count of events.

   * On the SRX300, Juniper NetworksÂ® SRX320 Firewall, Juniper NetworksÂ® SRX340
     Firewall, Juniper NetworksÂ® SRX345 Firewall, and Juniper NetworksÂ® SRX380
     Firewall, the maximum count is 100,000.
   * On the Juniper NetworksÂ® SRX5400 Firewall, Juniper NetworksÂ® SRX5600 Firewall,
     and Juniper NetworksÂ® SRX5800 Firewall, the maximum count is 200,000.

   When WMIC starts up, the WMIC uses the maximum count with the timespan setting.
   When the limit is reached, the WMIC stops reading the event log.
6. After a failover, the device reads the event log from the latest event log
   timestamp.

### Specify IP Filters to Limit IP-to-User Mapping

You can specify the IP filters to limit the IP address-to-user mapping information that
the device generates from the event log.

To understand when a filter is useful for such mapping, consider the following scenario.
A customer deploys 10 devices in one domain, and each device controls a branch. All 10
devices read all 10 branch user login event logs in the domain controller. However, the
device is configured to detect only whether the user is authenticated on the branch it
controls. By configuring an IP filter on the device, the device reads only the IP event
log under its control.

You can configure a filter to include or exclude IP addresses or prefixes. You can
specify a maximum of 20 addresses for each filter.

### Windows Event Log Verification and Statistics

You can verify that the authentication table is getting IP address and user information
by issuing the `show services user-identification active-directory-access
active-directory-authentication-table all` command. A list of IP address-to-user
mappings is displayed for each domain. The table contains no group information until LDAP
is running.

You can see statistics about reading the event log by issuing the `show services
user-identification active-directory-access ip-user-mapping statistics domain`
command.

### Firewall Authentication as backup to WMIC

The primary method for the Active Directory as identity source to get IP address-to-user
mapping information is for the device to act as a WMI client (WMIC). However, the
event-log-reading and PC probe functions both use WMI, and using a global policy to
disable the WMI-to-PC probe affects event log reading. These might result in the failure
of the PC probe, and a backup method for getting IP address-to-user mappings is needed.
That method is to use firewall authentication to identify users.

See [Domain PC Probing](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__section_mwp_1p1_3cc).

If a domain is configured in that statement, `fwauth` recognizes that the
domain is for a domain authentication entry, and will send the domain name to the
`fwauth` process along with the authentication request. After it receives
the authentication response, `fwauth` deletes that domain authentication
entry. The `fwauth` process sends the source IP address, username, domain,
and other information to the UserID process, which verifies that it is a valid domain user
entry. The subsequent traffic will hit this user firewall entry.

## Domain PC Probing

* [What is Domain PC Probing?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_hjb_bp1_3cc)
* [Domain PC Probing User Information](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_vm5_cp1_3cc)
* [How to Configure Probe?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_unc_hp1_3cc)
* [Probe Rate and Statistics](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_mhg_3p1_3cc)

### What is Domain PC Probing?

Domain PC probing acts as a supplement of event log reading. When a user logs in to the
domain, the event log contains that information. The PC probe is triggered only when there
is no IP-to-address mapping from the event log.

Domain information constantly changes as users log in and out of domain PCs. The Active
Directory as identity source probe functionality provides a mechanism for tracking and
verifying information in the authentication tables by directly probing domain PCs for IP
address-to-user mapping information. New and changed information identified by the probe
serves to update Active Directory authentication table entries, which is critical to
maintaining firewall integrity.

The IP address filter also impacts the PC probe. Once you configure the IP address
filter, only the IP address specified in the filter is probed.

### Domain PC Probing User Information

The Active Directory as identity source tracks the online status of users by probing
domain PCs. If a user is not online or is not an expected user, the Active Directory
authentication table is updated as appropriate. The following probe behaviors apply:

| On-demand probing | On-demand probing occurs when a packet is dropped due to a missing entry in the Active Directory authentication table. In this case, an entry is added in pending state to the authentication table, and the domain PC identified by the source IP field of the dropped packet is probed for IP address and user information. The entry remains in pending state until a response is received from the probe. |
| --- | --- |
| Manual probing | Manual probing is used to verify and troubleshoot the online status of a user or a range of users, and is at the discretion of the system administrator. Note: Manual probing can cause entries to be removed from the Active Directory authentication table. For example, if there is no response from your PC due to a network issue, such as when the PC is too busy, the IP address entry of the PC is marked as invalid and your access is blocked. |

Based on the domain PC probe response, updates are made to the Active Directory
authentication table, and associated firewall policies take effect. If no response is
received from the probe after 90 seconds, the authentication entry times out. The
timed-out authentication entry is the pending state authentication entry, which is
generated when you start the PC probe.

If the probe is successful, the state of the authentication entry is updated from pending
to valid. If the probe is unsuccessful, the state of the authentication entry is marked as
invalid. The invalid entry has the same lifetime as a valid entry and is overwritten by
upcoming fwauth (firewall authentication process) authentication results or by the event
log.

If the device cannot access a domain PC for some reason, such as a network configuration
or Windows firewall issue, the probe fails.

For more probe responses and corresponding authentication table actions, see [Table 2](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__probe-response).

Table 2: Probe Responses and Associated Active Directory Authentication Table Actions
| Probe Response from Domain PC | Active Directory Authentication Table Action |
| --- | --- |
| Valid IP address and username | Add IP-related entry. |
| Logged on user changed | Update IP-related entry. |
| Connection timeout | Update IP-related entry as invalid. |
| Access denied | Update IP-related entry as invalid. |
| Connection refused | Update IP-related entry as invalid. |
| Authentication failed  (The configured username and password have no privilege to probe the domain PC.) | Update IP-related entry as invalid. |

### How to Configure Probe?

On-demand probing is enabled by default. To disable on-demand probing, you can use the
`set services user-identification active-directory-access
no-on-demand-probe` statement. Delete this statement to reenable probing. When
on-demand probing is disabled, manual probing is available.

To initiate a manual probe, you can use the `request services user-identification
active-directory-access ip-user-probe address ip-address address
domain domain-name` command. If a domain name is not
specified, the probe looks at the first configured domain for the IP address. To specify a
range, use the appropriate network address.

The probe timeout value is configurable. If no response is received from the domain PC
within the `wmi-timeout` interval, the probe fails and the system either
creates an invalid authentication entry or updates the existing authentication entry as
invalid. If an authentication table entry already exists for the probed IP address, and no
response is received from the domain PC within the `wmi-timeout` interval,
the probe fails and that entry is deleted from the table.

See [Configure Active Directory as Identity Source on SRX Series Firewall](../topic-map/config-examples-active-directory-identity-source.html#task_cyp_xlg_tdc).

### Probe Rate and Statistics

The maximum probe rate for the Active Directory as identity source is set by default and
cannot be changed. For SRX 5400, SRX 5600, and SRX 5800 Series Firewalls, the probe rate
is 600 times per minute. For branch SRX Series Firewalls, the probe rate is 100 times per
minute. Probe functionality supports 5000 users, or up to 10 percent of the total
supported authentication entries, whichever is smaller. Supporting 10 percent means that
at any time, the number of IP addresses waiting to be probed cannot exceed 10 percent.

## LDAP for Active Directory as Identity Source

* [What is the use of LDAP for Active Directory as Identity Source?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_hbj_mp1_3cc)
* [How LDAP for Active Directory as Identity Source Work?](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__subsection_jjl_np1_3cc)

### What is the use of LDAP for Active Directory as Identity Source?

The use of LDAP in this section applies specifically to LDAP functionality within the
Active Directory as identity source.

In order to get the user and group information necessary to implement the Active
Directory as identity source, the device uses the Lightweight Directory Access Protocol
(LDAP). The device acts as an LDAP client communicating with an LDAP server. In a common
implementation scenario of the Active Directory as identity source, the domain controller
acts as the LDAP server. The LDAP module in the device, by default, queries the Active
Directory in the domain controller.

The device downloads user and group lists from the LDAP server. The device also queries
the LDAP server for user and group updates. The device downloads a first-level,
user-to-group mapping relationship and then calculates a full user-to-group mapping.

### How LDAP for Active Directory as Identity Source Work?

The LDAP serverâs username, password, IP address, and port are all optional, but they can
be configured.

* If the username and password are not configured, the system uses the configured
  domain controllerâs username and password.
* If the LDAP serverâs IP address is not configured, the system uses the address of one
  of the configured Active Directory domain controllers.
* If the port is not configured, the system uses port 389 for plaintext or port 636 for
  encrypted text.

By default, the LDAP authentication method uses simple authentication. The clientâs
username and password are sent to the LDAP server in plaintext. Keep in mind that the
password is clear and can be read from the network.

To avoid exposing the password, you can use simple authentication within an encrypted
channel [namely Secure Sockets layer (SSL)], as long as the LDAP server supports LDAP over
SSL (LDAPS). After enabling SSL, the data sent from the LDAP server to the device is
encrypted. To enable SSL, see the `user-group-mapping` statement.

## Active Directory as Identity Source Authentication Table

The Active Directory as identity source will manage up to 2048 sessions for each user for
whom there is a user identity and authentication entry in the authentication table. There
might be additional sessions associated with a user beyond the 2048 supported sessions, but
they are not managed by Active Directory as identity source. When an authentication entry in
an authentication table is deleted, Active Directory as identity source only closes sessions
that are associated with that entry. It will not close sessions that it does not manage.

[Table 3](#xd_5b02e8e867e34a58-1f3df671-1912b649765--7f06__table_acw_y2f_ccc) lists Active Directory as identity source authentication table device
support that depends on the Junos OS release in your installation.

Table 3:  Active Directory as Identity Source Authentication Table Device Support
| Devices | Identity Source Authentication Table Entries | Domains | Controllers |
| --- | --- | --- | --- |
| SRX300, SRX320 | 500 | 1 | 5 |
| SRX340, SRX345, SRX380 | 1000 | 1 | 5 |
| SRX1500, SRX1600, SRX2300 | 20,000 | 2 | 10 |
| SRX4000 line | 50,000 | 2 | 10 |
| SRX5000 line | The user entries are as follows:   * 100000âFor users without JIMS * 256000âFor users with JIMS | 2 | 10 |
| vSRX Virtual Firewall (2 vCPUs and 4 GB vRAM, 5 vCPUs and 8 GB vRAM ) | 5000 | 2 | 10 |
| vSRX Virtual Firewall (9 vCPUs and 16 GB vRAM, 17 vCPUs and 32 GB vRAM ) | 10,000 | 2 | 10 |
| NFX150 | 500 | 1 | 5 |

## Active Directory as Identity Source Timeout Setting

Here timeout setting refers to firewall authentication forced timeout as it applies to
active directory authentication entries for users who authenticate through captive
portal.

When a user authenticates through captive portal, an authentication table entry is
generated for that user based on the information that the *firewall* obtains from the
firewall authentication module. At that point, the default traffic-based authentication
timeout logic is applied to the entry.

As an administrator, it is important for you to have control over how long non-domain users
who authenticate through captive portal remain authenticated. The timeout feature gives you
that control. Use of it ensures that non-domain users do not remain authenticated
indefinitely. For example, assume that the flow of traffic is continuous to and from the
device of a non-domain user authenticated through captive portal. Given the behavior of the
default traffic-based authentication timeout, the non-domain user would remain authenticated
indefinitely.

When the timeout value is configured, it is used in conjunction with the traffic-based
timeout logic. Here is how timeout settings affect active directory authentication entries
for users authenticated through captive portal. In all of the following instances, an
authentication entry was generated for a user based on firewall authentication information
after the user authenticated through captive portal.

* The timeout is set for 3 hours.

  Traffic continues to be received and generated by a device associated with an
  authentication entry for a user. After 3 hours the authentication entry expires,
  although at that time there are sessions anchored in Packet Forwarding Engine for the
  authentication entry.
* If set, the timeout has no effect.

  An authentication entry does not have sessions anchored to it. It expires after the
  time set for the authentication entry timeout, for example, 30 minutes.
* The timeout configuration is deleted.

  Timeout has no effect on new authentication entries. Timeout remains enforced for
  existing authentication entries to which it applied before it was deleted. That is, for
  those authentication entries, the original timeout setting remains in effect.
* The timeout configuration setting is changed.

  The new time-out setting is applied to new incoming authentication entries. Existing
  entries keep the original, former setting.
* The timeout is set to 0, disabling it.

  If the timeout is set to a new value, that value is assigned to all incoming
  authentication entries. There is no timeout setting for existing authentication
  entries.
* The timeout value is not configured.

  + The *firewall* generates an authentication entry for a user. The default
    traffic-based timeout logic is applied to the authentication entry.
  + The active directory timeout value is configured for 50 minutes. A traffic-based
    timeout of 50 minutes is applied to an authentication entry.
  + The active directory timeout is not configured. The default traffic-based timeout
    of 30 minutes is applied to an authentication entry.

Â Â

=== Content from www.juniper.net_82466791_20250119_112009.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [Understanding Advanced Query Feature for Obtaining User Identity
  Information from JIMS](#id-understanding-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims)
* [Understanding User Principal Name as User Identity in SRX Series
  Devices](#understanding-user-principal-name-as-user-identity-in-srx-series-devices)
* [Configuring Advanced Query Feature for Obtaining User Identity
  Information from JIMS](#id-configuring-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims)
* [Example: Configuring the Advanced Query Feature for Obtaining
  User Identity Information from JIMS](#id-example-configuring-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims)
* [Example: Configuring Filter for Advanced Query Feature](#id-example-configuring-filter-for-advanced-query-feature)
Â
# Configure Juniper Identity Management Service to Obtain User Identity Information

Juniper Identity Management Service (JIMS) is
a standalone Windows service application that collects and maintains
a large database of user, device, and group information from Active
Directory domains. JIMS enables the device to rapidly identify thousands
of users in a large, distributed enterprise.

## Understanding Advanced Query Feature for Obtaining User Identity Information from JIMS

* [Overview](#id-understanding-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims__d27871e58)
* [Establishing a Connection to JIMS to Obtain User Identity Information](#id-understanding-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims__d27871e102)
* [Querying JIMS for User Identity Information](#id-understanding-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims__d27871e132)
* [Filters](#id-understanding-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims__d27871e161)
* [Caveats and Limitations](#id-understanding-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims__d27871e192)

### Overview

Juniper Identity Management Service (JIMS) is a software agent
and repository that collects user name, device identity, and group
information from various sources. JIMS supports Microsoft active directory
and Microsoft Exchange Server.

The SRX Series Firewalls or NFX Series device relies on JIMS to obtain user identity information
much in the same way that it does LDAP.

If you configure the advanced user query feature, the device:

* Can query JIMS for identity information.
* Populate identity management authentication table with
  the information that is obtained from JIMS.
* Use the populated identity management authentication table
  to authenticate a user or a device requesting access to a protected
  resource.

If JIMS does not contain information for a user, you can push
that information to the device. The user must first authenticate to
the device through captive portal.

The advanced query feature also allows you to push authentication
entries to the JIMS server for users for whom there are no entries
in JIMS but who have successfully authenticated to the device through
captive portal.

User identity information that JIMS sends in response to the
device queries includes:

* IP address of the userâs device.
* User name.
* Domain that the userâs device belongs to.
* Roles that the user belongs to, such mycompany-pc. CEO.
  user-authenticated.
* If the device is online and the state of the device, such
  as âHealthyâ.
* End-user-attributes, such as device-identity, value (device
  name), and groups that the device belongs to.

### Establishing a Connection to JIMS to Obtain User Identity Information

The device obtains user identity information by querying JIMS
either in batch mode to obtain information for groups of users or
through queries for individual users. For the device to query JIMS,
you must establish an HTTPS connection between the device and the
JIMS server.

HTTP connections are used only for debugging purposes.

Defining the connection entails configuring the following information:

* Connection parameters.
* Authentication information that allows the device to authenticate
  to JIMS.

  The device obtains an access token after it authenticates to
  the JIMS server. The device must use this token to query JIMS for
  user information.
* You can also configure this information for connection
  to a *secondary*, backup server.

Starting in Junos OS
Release 18.3R1, IPv6 addresses are supported to connect JIMS primary
server and secondary server, in addition to existing IPv4 address
support.

The device attempts to connect to the primary server first and
in case of failed attempt, it switches to the secondary server. Even
after connecting to the secondary server, the device periodically
probes the failed primary server and reverts to the primary server
when it is available again.

Starting with Junos
OS Release 18.1R1, you can configure an IPv6 address for Web API function
to allow the JIMS to initiate and establish a secure connection. The
Web API supports the IPv6 user or device entries obtained from JIMS.
Prior to Junos OS Release 18.1R1, only IPv4 addresses were supported.

### Querying JIMS for User Identity Information

There are three ways to obtain user identity information from
JIMS:

* Initial batch query at startupâWhen the device is
  started, it sends a batch query message to JIMS to obtain all available
  user identity information for active directory users that it expects
  at that time, if you have configured the device connection to the
  JIMS server.
* Follow-on batch queriesâFollowing its initial receipt
  of user identity information, the device queries JIMS periodically
  for batches of newly generated user identity information. For this
  to occur, you configure an interval for the periodic queries and specify
  the number of user identity records to be sent in return per batch. Starting with Junos OS Release 18.1R1, the device
  can query JIMS for IPv6 user or device information. Prior to Junos
  OS Release 18.1R1, only IPv4 addresses were supported.
* Query for individual user informationâYou can configure
  the advanced query feature to allow you to query the JIMS server for
  identity information for an individual user based on the IP address
  of the userâs device, if that information is missing from a
  batch response. Starting with Junos OS Release 18.1R1, the device
  can query JIMS for IPv6 user or device information when IPv6 traffic
  arrives on the device.

  If an entry for the specified IP address does not exist, JIMS
  returns an HTTP 404 âNot Foundâ message.

When the device requests user information from JIMS initially,
it specifies a timestamp. JIMS sends user information in response
going back to the timestamp specification, and it includes a cookie
to the device in the response to indicate the context. The device
sends that cookie with its next query instead of a timestamp.

You can refresh the user identity information in your identity
management authentication table obtained from JIMS. You can obtain
everything that was received automatically when you started the device
and from subsequent batch queries and individual IP queries up to
the present.

For this purpose, you clear the authentication table by disabling
the advanced query feature configuration. Afterward, you can reconfigure
the advanced query feature to retrieve all available user identities.

Starting with Junos
OS Release 18.1R1, devices can search the identity management authentication
table for information based on IPv6 addresses. Prior to Junos OS Release
18.1R1, the devices read only IPv4 addresses. The device supports
the use of IPv6 addresses associated with source identities in security
policies. If an IPv4 or IPv6 entry exists, policies matching that
entry are applied to the traffic and access is either allowed or denied.

Starting in Junos OS Release 20.2R1, you can search and view user identity information such as
logged users, connected devices and group list from Juniper Identity Management
Service (JIMS) and Active Directory (AD) domain. The SRX Series Firewall relies on
JIMS to obtain user identity information.

You can search the user identity information and validate the
authentication source to provide access to the device. You can request
JIMS to retrieve the group list for the Active Directory domain for
identity information of an individual user.

### Filters

The advanced query feature provides an optional filter function
that you can use to control at a granular level the user information
records that you want to receive in response to queries. You can configure
filters based on IP addresses and domains. Filters allow you to define
specifically users whose information you want JIMS to return to you
in response to queries.

You can configure filters composed of:

* A range of IP addresses. You can specify a range of IP
  addresses for:

  + Users whose information you want to receive.
  + Users for whom you do not want information.

  Starting in Junos OS Release 18.3R1, SRX Series Firewalls support IPv6 addresses to configure the
  filters based on IP addresses, in addition to existing IPv4 addresses.

  You use address books to create the IP address filters. You
  configure address sets, each of which must not contain more than twenty
  IP addresses to be included in the address book.
* Domain names.

  You can specify the names of up to twenty-five active directory
  domains.

You can configure a filter that includes all three specifications:
a range of IP addresses to include, a range of IP addresses to be
excluded, and the names of one or more domains.

Filters are contextual. That is, you can use a different filter
configuration for different requests. If you change the filter configuration,
the new filter applies to subsequent queries exclusively. It has no
bearing on prior query requests

### Caveats and Limitations

The following warnings and caveats apply to the advanced query
feature:

* Before you use this feature, you must disable `active-directory-access` and `authentication-source` options under the `user-identification` hierarchy. You cannot commit this configuration if active directory
  authentication or the ClearPass query and Web API functions are configured
  and committed.
* The CPU usage and resource consumption is affected by
  the deviceâs reading and processing of user identity records.
  The impact might last several minutes.
* If user identity information is cleared from JIMS or it
  is missing for other reasons or delayed, the device could receive
  inaccurate IP address and user mapping information.
* When the device firewall authentication function pushes
  to JIMS entries for users successfully authenticated through captive
  portal, it does not update the authentication entry time-out state
  for the Juniper Identity Management Service server.

The following limitations apply to the advanced query feature:

* Generation of authentication entries in the identity management
  authentication table can be affected by a delay in the JIMS serverâs
  response time or the number of user identity records to be retrieved.
* As noted, if configuration of a filter is changed, the
  new filter is used only in subsequent retrievals of user identities.
* You can configure only IPv4 addresses for configuring
  the address ranges.

### See Also

* batch-query
* filter
* primary
* secondary
* push-to-identity-management

## Understanding User Principal Name as User Identity in SRX Series Devices

Starting in Junos OS Release 20.1R1, you can use User Principal
Name (UPN) as logon name in firewall-authentication, which is working
as a captive portal for JIMS or user-firewall.

You can use UPN as logon name along with cn or sAMAccountName at the same time. UPN can
be used instead of sAMAccountName to authenticate
a user.

Even if user uses UPN as logon name, firewall authentication
pushes sAMAccountName (mapping to the UPN) to
user ID rather than pushing the UPN.

Firewall-authentication pushes both UPN and sAMAccountName (mapping to the UPN) to JIMS.

User Principal Name (UPN) attribute is the logon name from Windows
Active Directory to log on to a domain. A UPN consists of a UPN prefix
(the user account name) and a UPN suffix (a DNS domain name). UPN
is an indexed string that is single-valued. UPN is used as a logon
name in firewall-authentication when LDAP type access profile is being
used.

A UPN is an Internet-style login name for a user based on the
Internet standard. UPN is the name of a system user in an e-mail address
format, for example, mailto:username@domainname.com. UPN is shorter than a distinguished name and easier to remember.
A UPN is a unique among all security principal objects with a directory
forest.

The sAMAccountName attribute is a logon
name used to support clients and servers from previous versions of
Windows, such as Windows NT 4.0, Windows 95, Windows 98, and LAN Manager.
The logon name should be lesser than 20 characters and unique among
all security principal objects within the domain. You will have access
when the firewall-authentication retrieves sAMAccountName from the Active Directory.

UPN is one of the identities of an Active Directory user in
a domain. In organizations, most users use UPN as logon name along
with cn or sAMAccountName attribute at the same time. The UPN attribute configuration access
profile cannot handle UPN and cn or sAMAccountName at the same time. See [Configure Integrated User Firewall](https://www.juniper.net/documentation/en_US/junos/topics/topic-map/security-user-auth-configure-integrated-userfw.html).

User firewall-authentication by captive portal has two ways,
such as Active Directory and JIMS.

* If source is Active Directory, Active Directory must be configured on SRX Series Firewalls, when
  user uses UPN as logon name. Firewall-authentication pushes
  sAMAccountName to SRX Series Firewalls, the user
  authentication entry is sAMAccountName, but not UPN.

* If source is JIMS, JIMS must be configured on SRX Series Firewalls, when user uses UPN as logon
  name. Firewall-authentication pushes both UPN and
  sAMAccountName to JIMS. When you configure the SRX
  Series Firewall to the JIMS server, SRX Series Firewalls sends the batch
  query to JIMS to obtain the available user information.

### Caveats and Limitations

The following warnings and caveats apply to the UPN support
feature:

* sAMAccountName should be configured
  in search-filter option for access profile. This option can avoid
  name conflict between cn and UPN of another user.
* UPN suffix might be different from the domain name that
  the user belongs to. In this case, additional security policy source-identity
  must be added in domain name. For example, there is a user with sAMAccountName as ndu123 in domain ad03.net, and UPN is mailto:bob@ad03-upn.net.
* UPN supports only when LDAP access profile is configured
  for firewall-authentication.

## Configuring Advanced Query Feature for Obtaining User Identity Information from JIMS

This configuration shows how to configure the advanced
query feature for obtaining user identity information from Juniper
Identity Management Service (JIMS) and to configure security policy
to match the source identity.

This topic describes:

* [Configuring the Advanced Query Feature for Obtaining User Identity
  Information from JIMS](#d23e24)
* [Configuring Device Identity Authentication Source, and Security
  Policy to Match the User Identity Information Obtained from JIMS](#d23e201)

### Configuring the Advanced Query Feature for Obtaining User Identity Information from JIMS

By configuring the advanced user query feature, the device can
query JIMS and add identity information in the local active directory
authentication table.

Use the following steps to configure the advanced query
feature:

1. Configure the IP address of the primary JIMS server.
   ```
   [edit services user-identification]
   user@host# set identity-management connection primary address ip-address

   ```
2. Configure the client ID that the SRX Series Firewall provides to the JIMS
   primary server as part of its authentication.
   ```
   [edit services user-identification]
   user@host# set identity-management connection primary client-id  client-id

   ```
3. Configure the client secret that the device provides to
   the JIMS primary server as part of its authentication.
   ```
   [edit services user-identification]
   user@host# set identity-management connection primary client-secret   client-secret

   ```
4. Configure the IP address for the secondary JIMS server.
   ```
   [edit services user-identification]
   user@host# set identity-management connection secondary address  ip-address

   ```
5. Configure the client ID that the device provides to the
   JIMS secondary server as part of its authentication to it.
   ```
   [edit services user-identification]
   user@host# set identity-management connection secondary client-id  client-id

   ```
6. Configure the client secret that the device provides to
   the JIMS secondary server as part of its authentication to it.
   ```
   [edit services user-identification]
   user@host# set identity-management connection primary client-secret   client-secret

   ```
7. Configure the maximum number of user identity items that
   the device accepts in one batch in response to the query.
   ```
   [edit services user-identification]
   user@host# set identity-management batch-query  items-per-batch items-per-batch

   ```
8. Configure the interval in seconds after which the device
   issues a query request for newly generated user identities.
   ```
   [edit services user-identification]
   user@host# set identity-management batch-query  query-interval  query-interval

   ```
9. Configure active directory domains of interest to the SRX Series Firewall.
   You can specify up to twenty domain names for the filter.
   ```
   [edit services user-identification]
   user@host# set identity-management filter domain  domain

   ```
10. Configure the address book name to include the IP filter.
    ```
    [edit services user-identification]
    user@host# set identity-management filter include-ip address-book  address-book

    ```
11. Configure the referenced address set.
    ```
    [edit services user-identification]
    user@host# set identity-management filter include-ip address-set   address-set

    ```
12. Configure the trace option file name.
    ```
    [edit services user-identification]
    user@host# set identity-management traceoptions file file name

    ```
13. Configure trace file size.
    ```
    [edit services user-identification]
    user@host# set identity-management traceoptions file file size

    ```
14. Configure the level of debugging output.
    ```
    [edit services user-identification]
    user@host# set identity-management traceoptions level all

    ```
15. Configure the trace identity management for all modules.
    ```
    [edit services user-identification]
    user@host# set identity-management traceoptions flag all

    ```

### Configuring Device Identity Authentication Source, and Security Policy to Match the User Identity Information Obtained from JIMS

Specify the device identity authentication source and the security
policy. The device obtains the device identity information for authenticated
devices from the authentication source. The device searches the device
identity authentication table for a device match when traffic issuing
from a userâs device arrives at the device. If it finds a match,
the device searches for a matching security policy. If it finds a
matching security policy, the security policyâs action is applied
to the traffic.

Use the following steps to configure device identity
authentication source:

1. Specify the device identity authentication source.
   ```
   [edit services user-identification  ]
   user@host# set device-information authentication-source network-access-controller

   ```
2. Configure the device identity profile.
   ```
   [edit services user-identification  ]
   user@host# set device-information end-user-profile profile-name profile-name domain-name domain-name

   ```
3. Configure the domain name to which the device belongs.
   ```
   [edit services user-identification  ]
   user@host# set device-information end-user-profile profile-name profile-name attribute device-identity string  string-value

   ```

Use the following steps to configure the security policy:

1. Create a source address for a security policy.

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name match source-address any

   ```
2. Create a destination address for a security policy.

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name match destination-address any

   ```
3. Configure the port-based application to match the policy.

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name match application any

   ```
4. Define a username or a role (group) name that the JIMS
   sends to the device. Example: "jims-dom1.local\user1".

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name match source-identity  username or group

   ```
5. Permit the packet if policy matches.

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name then permit

   ```
6. Configure the session initiation time.

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name then log session-init

   ```
7. Configure the session close time.

   ```
   [edit security  ]
   user@host# set policies from-zone untrust to-zone trust policy  name then log session-close

   ```

## Example: Configuring the Advanced Query Feature for Obtaining User Identity Information from JIMS

This example shows how to configure the advanced query feature on the SRX Series Firewall
to connect automatically to Juniper Identity Management Service (JIMS). You can make
requests using advanced query to obtain the authentication information through batch
query.

JIMS provides a robust and scalable user identification and IP address mapping implementation
that includes endpoint context and machine ID. JIMS collects user identity information
from different authentication sources, for SRX Series
Firewalls.
With advanced query feature, the SRX Series Firewall works as the HTTPS client and sends
HTTPS requests to JIMS on port 591.

* [Requirements](#d24e23)
* [Overview](#d24e29)
* [Configuration](#d24e57)
* [Verification](#d24e282)

### Requirements

No special configuration beyond device initialization is required
before configuring this feature.

### Overview

This example uses the following hardware and software components:

* Junos Software Release 15.1x49-D100 and JIMS Software
  Release v1.1 and v1.2.

Before you begin, you need the following information:

* The IP address of the JIMS server.
* The port number on the JIMS server for receiving HTTPS
  requests.
* The client ID from the JIMS server for advanced queries.
* The client secret from the JIMS server for advanced queries.
* The traceoptions from the JIMS server for advanced queries.

### Configuration

* [CLI Quick Configuration](#d24e57__d27871e733)
* [Procedure](#d24e57__d27871e792)
* [Results](#d24e57__d27871e932)

#### CLI Quick Configuration

To quickly configure this example, copy the
following commands, paste them into a text file, remove any line breaks,
change any details necessary to match your network configuration,
copy and paste the commands into the CLI at the `[edit]` hierarchy
level, and then enter `commit` from configuration mode.

```
set services user-identification identity-management connection connect-method https
set services user-identification identity-management connection port 443
set services user-identification identity-management connection primary address 192.0.2.15
set services user-identification identity-management connection primary client-id client1
set services user-identification identity-management connection primary client-secret "$ABC123"
set services user-identification identity-management connection secondary address 192.0.2.2
set services user-identification identity-management connection secondary client-id client2
set services user-identification identity-management connection secondary client-secret "$ABC123"
set services user-identification identity-management batch-query query-interval 60
set services user-identification identity-management ip-query query-delay-time 0
set services user-identification identity-management traceoptions file jimslog
set services user-identification identity-management traceoptions file size 10m
set services user-identification identity-management traceoptions level all
set services user-identification identity-management traceoptions flag all
set services user-identification identity-management traceoptions flag jims-validator-query

```

#### Procedure

##### Step-by-Step Procedure

To configure the advanced query feature on SRX Series Firewall:

1. Configure JIMS as the authentication source for advanced query
   requests. The SRX Series Firewall requires this information to
   contact the server.

   ```
   [edit services user-identification]
   user@host# set identity-management connection connect-method https

   ```
2. Configure the port number of the JIMS server to which the SRX Series
   Firewall sends HTTPS requests.

   ```
   [edit services user-identification]
   user@host# set identity-management connection port 443

   ```
3. Configure the primary address of the JIMS server.

   ```
   [edit services user-identification]
   user@host# set identity-management connection primary address 192.0.2.15

   ```
4. Configure the client ID and client secret to obtain access
   token.

   ```
   [edit services user-identification]
   user@host# set identity-management connection primary client-id client1
   user@host# set identity-management connection primary client-secret "$ABC123"

   ```
5. Configure the secondary address of the JIMS server.

   ```
   [edit services user-identification]
   user@host# set identity-management connection secondary address 192.0.2.2

   ```
6. Configure the client ID and client secret to obtain access
   token.

   ```
   [edit services user-identification]
   user@host# set identity-management connection secondary client-id client2
   user@host# set identity-management connection secondary client-secret "$ABC123"

   ```
7. Configure the batch query interval to periodically query
   JIMS for user identity information.

   ```
   [edit services user-identification]
   user@host# set identity-management batch-query query-interval 60

   ```
8. Configure the delay time in seconds before the SRX Series Firewall
   sends the individual user query. In this example, there is no
   delay.

   ```
   [edit services user-identification]
   user@host# set identity-management ip-query query-delay-time 0

   ```
9. Configure the traceoptions for debugging and trimming
   output.

   ```
   [edit services user-identification]
   user@host# set identity-management traceoptions file jimslog
   user@host# set identity-management traceoptions file size 10m
   user@host# set identity-management traceoptions level all
   user@host# set identity-management traceoptions flag all
   user@host# set services user-identification identity-management traceoptions flag jims-validator-query

   ```
10. Configure the device to connect with JIMS server. If you donât
    specify a port number, the default port 591 is used for JIMS. SRX
    Series Firewall uses the same JIMS configuration to connect with
    both JIMS port 443 and JIMS server (validator) port
    591.

    ```
    set services user-identification identity-management jims-validator port 591

    ```

#### Results

From configuration mode, confirm your configuration
by entering the `show services user-identification` command.
If the output does not display the intended configuration, repeat
the configuration instructions in this example to correct it. To disable
the ip-query use configuration `set services user-identification
identity-management ip-query no-ip-query`.

```
[edit]
user@host# show services user-identification
    identity-management {
     connection {
        connect-method https;
            port 443;
        primary {
            address 192.0.2.15;
                client-id client1;
                client-secret "$ABC123";
                }
                secondary {
                    address 192.0.2.2;
                        client-id client2;
                    client-secret "$ABC123";
                }
            }
     jims-validator {
      port 591;
    }
batch-query {
    query-interval 60;
    }
    ip-query {
        query-delay-time 0;
        }
        traceoptions {
            file jimslog size 10m;
            level all;
            flag all;
            flag jims-validator-query;
        }
    }
}

```

If you are done configuring the device, enter `commit` from configuration mode.

### Verification

Confirm that the configuration is working properly.

* [Verifying the user-identification identity-management status](#d24e282__d24e288)
* [Verifying the user-identification identity-management counters](#d24e282__d24e311)

#### Verifying the user-identification identity-management status

* [Purpose](#d24e282__d27871e963)
* [Action](#d24e282__d27871e968)
* [Meaning](#d24e282__d27871e978)

##### Purpose

Verify that the JIMS server is online and which server is responding to queries from the SRX
Series Firewall.

##### Action

From operational mode, enter the `show services
user-identification identity-management status` command.

```
Primary server :
    Address                      : 192.0.2.15
    Port                         : 443
    Connection method            : HTTPS
    Connection status            : Online
    Last received status message : OK (200)
    Access token                 : jjrOS4unS5d6KOTAvN8VlTsflhZBQmOm9jVsrwS
    Token expire time            : 2017-12-22 08:51:38
Secondary server :
    Address                      : 192.0.2.2
    Port                         : 443
    Connection method            : HTTPS
    Connection status            : Online
    Last received status message : OK (200)
    Access token                 : MLefNf00jG503D7H95neF1ip59JOC3jPgcl4oWQ
    Token expire time            : 2017-12-22 08:51:28
```
##### Meaning

The output provides data about the JIMS server status.

#### Verifying the user-identification identity-management counters

* [Purpose](#d24e282__d27871e986)
* [Action](#d24e282__d27871e991)
* [Meaning](#d24e282__d27871e1006)

##### Purpose

Display counters for batch and IP queries sent to the
JIMS device and responses received from the JIMS server. The batch
query is displayed separately for the primary server and the secondary
server, if more than one is configured.

##### Action

From operational mode, enter the `show services
user-identification identity-management counters` command.

From operational mode, enter the `clear services user-identification
identity-management counters` command to clear the counter.

```
Primary server :
    Address                           : 192.0.2.15
    Batch query sent number           : 8
    Batch query total response number : 8
    Batch query error response number : 0
    Batch query last response time    : 2017-12-22 01:04:34
    IP query sent number              : 4
    IP query total response number    : 4
    IP query error response number    : 0
    IP query last response time       : 2017-12-22 01:02:25
Secondary server :
    Address                           : 192.0.2.2
    Batch query sent number           : 0
    Batch query total response number : 0
    Batch query error response number : 0
    Batch query last response time    : 0
    IP query sent number              : 0
    IP query total response number    : 0
    IP query error response number    : 0
    IP query last response time       : 0
```
##### Meaning

The output provides the batch and IP queries data from
JIMS server.

## Example: Configuring Filter for Advanced Query Feature

An SRX Series Firewall supports IP filters and domain filters when querying Juniper Identity
Management Service (JIMS). The advanced query feature provides an optional filter
function to receive the user information in response to queries.

This example shows how to configure the filters for obtaining
the user information.

* [Requirements](#d25e23)
* [Overview](#d25e36)
* [Configuration](#d25e46)
* [Verification](#d25e182)

### Requirements

Before you begin:

* Configure the advanced query feature. See [Configuring Advanced Query Feature for Obtaining
  User Identity Information from JIMS](security-user-auth-configure-jims.html#id-configuring-the-srx-series-advanced-query-feature-for-obtaining-user-identity-information-from-jims).

### Overview

You can configure filters to query JIMS server at a more granular level to obtain user identity
information based on IP addresses. You can set filters to include the IP address
ranges, which SRX Series Firewalls require or exclude the IP address ranges that
they do not require when collecting the user identity information. You can also
filter domains.

A filter can include and exclude up to twenty IP address ranges.
Therefore, an address set that contains more than twenty address ranges
causes the filter configuration to fail. To specify the ranges, specify
the name of a predefined address set which includes them, and also
which is included in an existing address book.

A domain can include up to 20 domain names for a filter.

### Configuration

* [CLI Quick Configuration](#d25e46__d27871e1054)
* [Procedure](#d25e46__d27871e1096)
* [Results](#d25e46__d27871e1165)

#### CLI Quick Configuration

To quickly configure this example, copy the
following commands, paste them into a text file, remove any line breaks,
change any details necessary to match your network configuration,
copy and paste the commands into the CLI at the `[edit]` hierarchy
level, and then enter `commit` from configuration mode.

In this example, define an address book, and specify the security
address for the address book. Specify an IP address with a prefix.
Define an address set name and specify the address. Include and exclude
the IP addresses in the address book. Add the address set to include
and exclude the IP addresses. Add a domain name to filter the domain.

```
set security address-book mybook address addr1 192.0.2.0/24
set security address-book mybook address-set myset address addr1
set services user-identification identity-management filter include-ip address-book mybook
set services user-identification identity-management filter  include-ip address-set myset
set security address-book mybook2 address addr2 198.51.100.0/24
set security address-book mybook2 address-set myset2 address addr2
set services user-identification identity-management filter exclude-ip address-book mybook2
set services user-identification identity-management filter  exclude-ip address-set myset2
set services user-identification identity-management filter domain host.example.com

```

#### Procedure

##### Step-by-Step Procedure

The following example requires you to navigate various
levels in the configuration hierarchy. For information about navigating
the CLI, see [Using the CLI Editor in Configuration
Mode](../example/../../../cli/topics/topic-map/getting-started.html#id-using-the-cli-editor-in-configuration-mode) in the [CLI User Guide](https://www.juniper.net/documentation/en_US/junos/information-products/pathway-pages/junos-cli/junos-cli.html).

To configure a filter for advanced query feature:

1. Define an address book name, specify security address
   for the address book, and add an IPv4 address with a prefix.

   ```
   [edit ]
   user@host# set security address-book  mybook address addr1 192.0.2.0/24
   user@host# set security address-book  mybook2 address addr2 198.51.100.0/24

   ```
2. Specify an address set name and specify the address.

   ```
   [edit ]
   user@host# set security address-book mybook address-set myset address addr1
   user@host# set security address-book mybook2 address-set myset2 address addr2

   ```
3. Configure the address book to include and exclude the
   IP address.

   ```
   [edit ]
   user@host# set services user-identification identity-management filter include-ip address-book mybook
   user@host# set services user-identification identity-management filter exclude-ip address-book mybook2

   ```
4. Define the address set to include or exclude the IP address.

   ```
   [edit ]
   user@host# set services user-identification identity-management filter include-ip address-set myset
   user@host# set services user-identification identity-management filter exclude-ip address-set myset2

   ```
5. Specify a domain name to filter the domain.

   ```
   [edit ]
   user@host# set services user-identification identity-management filter domain  host.example.com

   ```

#### Results

From configuration mode, confirm your configuration
by entering the `show services user-identification` and `show security address-book` commands. If the output does not
display the intended configuration, repeat the configuration instructions
in this example to correct it.

```
[edit]
user@host# show services user-identification
identity-management {
    filter {
        domain {
            host.example.com;
        }
        include-ip {
            address-book mybook;
            address-set myset;
        }
        exclude-ip {
            address-book mybook2;
            address-set myset2;
        }
    }
}

```
```
[edit]
user@host# show security address-book
mybook {
    address addr1 192.0.2.0/24;
    address-set myset {
        address addr1;
    }
}
mybook2 {
    address addr2 198.51.100.0/24;
    address-set myset2 {
        address addr2;
    }
}

```

### Verification

#### Verifying Filter for Advanced Query Feature

* [Purpose](#d25e182__d27871e1194)
* [Action](#d25e182__d27871e1199)
* [Meaning](#d25e182__d27871e1209)

##### Purpose

Verify that the authentication table displays the user
information that you want to receive in response to queries.

##### Action

From operational mode, enter `show services user-identification
authentication-table authentication-source all` command.

```
show services user-identification authentication-table authentication-source all
node0:
--------------------------------------------------------------------------
Logical System: root-logical-system

Domain: host.example.com
Total entries: 10
Source IP       Username       groups(Ref by policy)          state
192.0.2.10      jasonlee                                      Valid
192.0.2.9       jasonlee                                      Valid
192.0.2.8       jasonlee                                      Valid
192.0.2.7       jasonlee                                      Valid
192.0.2.6       jasonlee                                      Valid
192.0.2.5       jasonlee                                      Valid
192.0.2.4       jasonlee                                      Valid
192.0.2.3       jasonlee                                      Valid
192.0.2.2       jasonlee                                      Valid
192.0.2.1       jasonlee                                      Valid

node1:
--------------------------------------------------------------------------
Logical System: root-logical-system

Domain: host.example.com
Total entries: 10
Source IP       Username       groups(Ref by policy)          state
192.0.2.10      jasonlee                                      Valid
192.0.2.9       jasonlee                                      Valid
192.0.2.8       jasonlee                                      Valid
192.0.2.7       jasonlee                                      Valid
192.0.2.6       jasonlee                                      Valid
192.0.2.5       jasonlee                                      Valid
192.0.2.4       jasonlee                                      Valid
192.0.2.3       jasonlee                                      Valid
192.0.2.2       jasonlee                                      Valid
192.0.2.1       jasonlee                                      Valid

```
##### Meaning

The output displays the user information in response
to queries.

## Change History Table

Feature support is determined by the platform and release you are using. Use [Feature Explorer](https://apps.juniper.net/feature-explorer/) to determine if a feature is supported on your platform.

ReleaseDescription18.3R1Starting in Junos OS
Release 18.3R1, IPv6 addresses are supported to connect JIMS primary
server and secondary server, in addition to existing IPv4 address
support.18.3R1Starting in Junos OS Release 18.3R1, SRX Series Firewalls support IPv6 addresses to
configure the filters based on IP addresses, in addition to existing IPv4
addresses.18.1R1Starting with Junos
OS Release 18.1R1, you can configure an IPv6 address for Web API function
to allow the JIMS to initiate and establish a secure connection. The
Web API supports the IPv6 user or device entries obtained from JIMS.
Prior to Junos OS Release 18.1R1, only IPv4 addresses were supported.18.1R1Starting with Junos OS Release 18.1R1, the device
can query JIMS for IPv6 user or device information. Prior to Junos
OS Release 18.1R1, only IPv4 addresses were supported.18.1R1Starting with Junos
OS Release 18.1R1, devices can search the identity management authentication
table for information based on IPv6 addresses. Prior to Junos OS Release
18.1R1, the devices read only IPv4 addresses. The device supports
the use of IPv6 addresses associated with source identities in security
policies. If an IPv4 or IPv6 entry exists, policies matching that
entry are applied to the traffic and access is either allowed or denied.Â Â

=== Content from kb.juniper.net_4f22f6e0_20250119_112003.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from kb.juniper.net_5fbcc84b_20250119_112004.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from www.juniper.net_81f5823b_20250119_112006.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [Syntax](#webapi-system-services__d817249e27)
* [Hierarchy Level](#webapi-system-services__d817249e79)
* [Description](#webapi-system-services__d817249e84)
* [Options](#webapi-system-services__d817249e94)
* [Required Privilege Level](#webapi-system-services__d817249e170)
* [Release Information](#webapi-system-services__d817249e177)
Â
# webapi (System Services)

## Syntax

```
webapi {
    [client (System Services)](client-webapi-cli.html) name;
    [debug-level (System Services)](debug-level-webapi-cli.html) (alert | crit | emerg | error | info | notice | warn);
    [debug-log (System Services)](services-debug-aruba-cli.html) file;
    [http (System Services)](security-http-webapi-cli.html) {
        port port;
    }
    [https (System Services)](security-https-webapi-cli.html) {
        certificate certificate;
        certificate-key certificate-key;
        default-certificate;
        pki-local-certificate pki-local-certificate;
        port port;
    }
    [user (System Services)](user-webapi-cli.html){
        user-name;
        password password;
    }
}

```

## Hierarchy Level

```
[edit system services]

```

## Description

Configure Web API (webapi) to facilitate efficient transmission of user authentication and
identity information from the CPPM to the SRX Series Firewall. The CPPM, which is
the client in this relationship, initiates a session with the SRX Series Firewall
Web API process, which is the server in this relationship. However, the CPPM can do
this only if you have configured the Web API function on the SRX Series Firewall.
For security reasons, the Web API process is not enabled by default.

The configuring statements are explained separately. See [CLI Explorer](https://www.juniper.net/documentation/content-applications/cli-explorer/junos/).

## Options

| client | Address of permitted HTTP/HTTPS request originator. |
| --- | --- |

| debug-level | Debug level for webapi process.   * Values:    + alertâMatch alert messages   + critâMatch critical messages   + emergâMatch emergence messages   + errorâMatch error messages   + infoâMatch informational messages   + noticeâMatch notice messages   + warnâMatch warning messages |
| --- | --- |

| debug-log | Debug log for webapi process. |
| --- | --- |

| http | Unencrypted HTTP connection settings. |
| --- | --- |

| https | Encrypted HTTPS connection settings. |
| --- | --- |

| user | Specify the User name. |
| --- | --- |

The remaining statements are explained separately. See [CLI Explorer](https://apps.juniper.net/cli-explorer/).

## Required Privilege Level

securityâTo view this statement in the
configuration.

security-controlâTo add this statement to the configuration.

## Release Information

Statement introduced in Junos OS Release
12.3X48-D30.

Â Â
