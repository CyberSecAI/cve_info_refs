=== Content from github.com_192e3851_20250119_112627.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibRaw%2FLibRaw%2Fcommit%2Fc243f4539233053466c1309bde606815351bee81)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibRaw%2FLibRaw%2Fcommit%2Fc243f4539233053466c1309bde606815351bee81)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=LibRaw%2FLibRaw)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[LibRaw](/LibRaw)
/
**[LibRaw](/LibRaw/LibRaw)**
Public

* [Notifications](/login?return_to=%2FLibRaw%2FLibRaw) You must be signed in to change notification settings
* [Fork
  289](/login?return_to=%2FLibRaw%2FLibRaw)
* [Star
   1.2k](/login?return_to=%2FLibRaw%2FLibRaw)

* [Code](/LibRaw/LibRaw)
* [Issues
  2](/LibRaw/LibRaw/issues)
* [Pull requests
  0](/LibRaw/LibRaw/pulls)
* [Actions](/LibRaw/LibRaw/actions)
* [Projects
  0](/LibRaw/LibRaw/projects)
* [Wiki](/LibRaw/LibRaw/wiki)
* [Security](/LibRaw/LibRaw/security)
* [Insights](/LibRaw/LibRaw/pulse)

Additional navigation options

* [Code](/LibRaw/LibRaw)
* [Issues](/LibRaw/LibRaw/issues)
* [Pull requests](/LibRaw/LibRaw/pulls)
* [Actions](/LibRaw/LibRaw/actions)
* [Projects](/LibRaw/LibRaw/projects)
* [Wiki](/LibRaw/LibRaw/wiki)
* [Security](/LibRaw/LibRaw/security)
* [Insights](/LibRaw/LibRaw/pulse)

## Commit

[Permalink](/LibRaw/LibRaw/commit/c243f4539233053466c1309bde606815351bee81)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

additional checks in parseSonySRF

[Browse files](/LibRaw/LibRaw/tree/c243f4539233053466c1309bde606815351bee81)
Browse the repository at this point in the history

```
parseSonySR2: buffer size check
```

* Loading branch information

[![@alextutubalin](https://avatars.githubusercontent.com/u/443031?s=40&v=4)](/alextutubalin)

[alextutubalin](/LibRaw/LibRaw/commits?author=alextutubalin "View all commits by alextutubalin")
committed
May 10, 2020

1 parent
[1f60a9e](/LibRaw/LibRaw/commit/1f60a9ec6133094cfc5f9ca284873f4723ca0127)

commit c243f45

Showing
**1 changed file**
with
**62 additions**
and
**28 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

90 changes: 62 additions & 28 deletions

90
[src/metadata/sony.cpp](#diff-580fc5afe4ffb8174c9b2a1e61bac91226a27352cd2b4d403e11a0ae4614d4c6 "src/metadata/sony.cpp")

Show comments

[View file](/LibRaw/LibRaw/blob/c243f4539233053466c1309bde606815351bee81/src/metadata/sony.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1799,6 +1799,14 @@ void LibRaw::parseSonySR2(uchar \*cbuf\_SR2, unsigned SR2SubIFDOffset, |
|  |  | float num; |
|  |  | int i; |
|  |  | int WBCTC\_count; |
|  |  | #define CHECKBUFFER\_N(offset,N) \ |
|  |  | do \ |
|  |  | { \ |
|  |  | if ((((offset) + (N)) > SR2SubIFDLength) || ((offset) < 0)) \ |
|  |  | return; \ |
|  |  | } while (0) |
|  |  |  |
|  |  | CHECKBUFFER\_N(0, 2); |
|  |  | entries = sget2(cbuf\_SR2); |
|  |  | if (entries > 1000) |
|  |  | return; |
| Expand All | | @@ -1812,43 +1820,52 @@ void LibRaw::parseSonySR2(uchar \*cbuf\_SR2, unsigned SR2SubIFDOffset, |
|  |  | if (dng\_writer == nonDNG) { |
|  |  | switch (tag\_id) { |
|  |  | case 0x7300: |
|  |  | FORC4 cblack[c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 4,0); |
|  |  | FORC4 cblack[c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x7303: |
|  |  | FORC4 cam\_mul[GRBG\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 4, 0); |
|  |  | FORC4 cam\_mul[GRBG\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x7310: |
|  |  | FORC4 cblack[RGGB\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 4, 0); |
|  |  | FORC4 cblack[RGGB\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | i = cblack[3]; |
|  |  | FORC3 if (i > cblack[c]) i = cblack[c]; |
|  |  | FORC4 cblack[c] -= i; |
|  |  | black = i; |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x7313: |
|  |  | FORC4 cam\_mul[RGGB\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 4, 0); |
|  |  | FORC4 cam\_mul[RGGB\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x74a0: |
|  |  | ilm.MaxAp4MaxFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset, 4); |
|  |  | ilm.MaxAp4MaxFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x74a1: |
|  |  | ilm.MaxAp4MinFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset, 4); |
|  |  | ilm.MaxAp4MinFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x74a2: |
|  |  | ilm.MaxFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset, 4); |
|  |  | ilm.MaxFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x74a3: |
|  |  | ilm.MinFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset, 4); |
|  |  | ilm.MinFocal = sgetreal(tag\_type, cbuf\_SR2 + tag\_dataoffset); |
|  |  | TagProcessed = 1; |
|  |  | break; |
|  |  | case 0x7800: |
|  |  | for (i = 0; i < 3; i++) |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 8, 2); |
|  |  | for (i = 0; i < 3; i++) |
|  |  | { |
|  |  | num = 0.0; |
|  |  | for (c = 0; c < 3; c++) |
| Expand All | | @@ -1865,12 +1882,14 @@ void LibRaw::parseSonySR2(uchar \*cbuf\_SR2, unsigned SR2SubIFDOffset, |
|  |  | case 0x787f: |
|  |  | if (tag\_datalen == 3) |
|  |  | { |
|  |  | FORC3 imgdata.color.linear\_max[c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 2, 2); |
|  |  | FORC3 imgdata.color.linear\_max[c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | imgdata.color.linear\_max[3] = imgdata.color.linear\_max[1]; |
|  |  | } |
|  |  | else if (tag\_datalen == 1) |
|  |  | { |
|  |  | imgdata.color.linear\_max[0] = imgdata.color.linear\_max[1] = |
|  |  | CHECKBUFFER\_N(tag\_dataoffset, 2); |
|  |  | imgdata.color.linear\_max[0] = imgdata.color.linear\_max[1] = |
|  |  | imgdata.color.linear\_max[2] = imgdata.color.linear\_max[3] = |
|  |  | sget2(cbuf\_SR2 + tag\_dataoffset); |
|  |  | } |
| Expand All | | @@ -1884,37 +1903,44 @@ void LibRaw::parseSonySR2(uchar \*cbuf\_SR2, unsigned SR2SubIFDOffset, |
|  |  | i = tag\_id - 0x7480; |
|  |  | if (Sony\_SR2\_wb\_list[i] > 255) { |
|  |  | icWBCCTC[WBCTC\_count][0] = Sony\_SR2\_wb\_list[i]; |
|  |  | FORC3 icWBCCTC[WBCTC\_count][c + 1] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 2, 2); |
|  |  | FORC3 icWBCCTC[WBCTC\_count][c + 1] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | icWBCCTC[WBCTC\_count][4] = icWBCCTC[WBCTC\_count][2]; |
|  |  | WBCTC\_count++; |
|  |  | } else { |
|  |  | FORC3 icWBC[Sony\_SR2\_wb\_list[i]][c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 2, 2); |
|  |  | FORC3 icWBC[Sony\_SR2\_wb\_list[i]][c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | icWBC[Sony\_SR2\_wb\_list[i]][3] = icWBC[Sony\_SR2\_wb\_list[i]][1]; |
|  |  | } |
|  |  | } else if ((tag\_id >= 0x7820) && (tag\_id <= 0x782d)) { |
|  |  | i = tag\_id - 0x7820; |
|  |  | if (Sony\_SR2\_wb\_list1[i] > 255) { |
|  |  | icWBCCTC[WBCTC\_count][0] = Sony\_SR2\_wb\_list1[i]; |
|  |  | FORC3 icWBCCTC[WBCTC\_count][c + 1] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 2, 2); |
|  |  | FORC3 icWBCCTC[WBCTC\_count][c + 1] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | icWBCCTC[WBCTC\_count][4] = icWBCCTC[WBCTC\_count][2]; |
|  |  | if (Sony\_SR2\_wb\_list1[i] == 3200) { |
|  |  | FORC3 icWBC[LIBRAW\_WBI\_StudioTungsten][c] = icWBCCTC[WBCTC\_count][c + 1]; |
|  |  | icWBC[LIBRAW\_WBI\_StudioTungsten][3] = icWBC[LIBRAW\_WBI\_StudioTungsten][1]; |
|  |  | } |
|  |  | WBCTC\_count++; |
|  |  | } else { |
|  |  | FORC3 icWBC[Sony\_SR2\_wb\_list1[i]][c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 2, 2); |
|  |  | FORC3 icWBC[Sony\_SR2\_wb\_list1[i]][c] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | icWBC[Sony\_SR2\_wb\_list1[i]][3] = icWBC[Sony\_SR2\_wb\_list1[i]][1]; |
|  |  | } |
|  |  | } else if (tag\_id == 0x7302) { |
|  |  | FORC4 icWBC[LIBRAW\_WBI\_Auto][GRBG\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 3, 2); |
|  |  | FORC4 icWBC[LIBRAW\_WBI\_Auto][GRBG\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | } else if (tag\_id == 0x7312) { |
|  |  | FORC4 icWBC[LIBRAW\_WBI\_Auto][RGGB\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | CHECKBUFFER\_N(tag\_dataoffset + tag\_dataunitlen \* 3, 2); |
|  |  | FORC4 icWBC[LIBRAW\_WBI\_Auto][RGGB\_2\_RGBG(c)] = sget2(cbuf\_SR2 + tag\_dataoffset + tag\_dataunitlen \* c); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | #undef CHECKBUFFER\_N |
|  |  |  |
|  |  | void LibRaw::parseSonySRF(unsigned len) |
|  |  | { |
| Expand All | | @@ -1935,10 +1961,10 @@ void LibRaw::parseSonySRF(unsigned len) |
|  |  | INT64 srf\_offset, tag\_offset, tag\_data, tag\_dataoffset; |
|  |  | int tag\_dataunitlen; |
|  |  | uchar \*srf\_buf; |
|  |  | short entries; |
|  |  | ushort entries; |
|  |  | unsigned tag\_id, tag\_type, tag\_datalen; |
|  |  |  |
|  |  | srf\_buf = (uchar \*)malloc(len); |
|  |  | srf\_buf = (uchar \*)malloc(len+64); |
|  |  | fread(srf\_buf, len, 1, ifp); |
|  |  |  |
|  |  | offset += srf\_buf[offset] << 2; |
| Expand Down  Expand Up | | @@ -1995,9 +2021,11 @@ void LibRaw::parseSonySRF(unsigned len) |
|  |  | &tag\_offset, &tag\_id, &tag\_type, &tag\_dataoffset, |
|  |  | &tag\_datalen, &tag\_dataunitlen) == 0) { |
|  |  | if (tag\_id == 0x0000) { |
|  |  | SRF2Key = sget4(srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | SRF2Key = sget4(srf\_buf + tag\_dataoffset); |
|  |  | } else if (tag\_id == 0x0001) { |
|  |  | RawDataKey = sget4(srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | RawDataKey = sget4(srf\_buf + tag\_dataoffset); |
|  |  | } |
|  |  | } else goto restore\_after\_parseSonySRF; |
|  |  | } |
| Expand All | | @@ -2019,20 +2047,22 @@ void LibRaw::parseSonySRF(unsigned len) |
|  |  | tag\_offset = offset; |
|  |  |  |
|  |  | while (entries--) { |
|  |  | if (tiff\_sget (save, srf\_buf, len, |
|  |  | if (tiff\_sget(save, srf\_buf, len, |
|  |  | &tag\_offset, &tag\_id, &tag\_type, &tag\_dataoffset, |
|  |  | &tag\_datalen, &tag\_dataunitlen) == 0) { |
|  |  | if ((tag\_id >= 0x00c0) && (tag\_id <= 0x00ce)) { |
|  |  | i = (tag\_id - 0x00c0) % 3; |
|  |  | nWB = (tag\_id - 0x00c0) / 3; |
|  |  | icWBC[Sony\_SRF\_wb\_list[nWB]][i] = sget4(srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | icWBC[Sony\_SRF\_wb\_list[nWB]][i] = sget4(srf\_buf + tag\_dataoffset); |
|  |  | if (i == 1) { |
|  |  | icWBC[Sony\_SRF\_wb\_list[nWB]][3] = |
|  |  | icWBC[Sony\_SRF\_wb\_list[nWB]][i]; |
|  |  | } |
|  |  | } else if ((tag\_id >= 0x00d0) && (tag\_id <= 0x00d2)) { |
|  |  | i = (tag\_id - 0x00d0) % 3; |
|  |  | cam\_mul[i] = sget4(srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | cam\_mul[i] = sget4(srf\_buf + tag\_dataoffset); |
|  |  | if (i == 1) { |
|  |  | cam\_mul[3] = cam\_mul[i]; |
|  |  | } |
| Expand All | | @@ -2044,16 +2074,20 @@ void LibRaw::parseSonySRF(unsigned len) |
|  |  | 0x0005 RawDataLength |
|  |  | \*/ |
|  |  | case 0x0043: |
|  |  | ilm.MaxAp4MaxFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); // need to add extra space |
|  |  | ilm.MaxAp4MaxFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | break; |
|  |  | case 0x0044: |
|  |  | ilm.MaxAp4MinFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | ilm.MaxAp4MinFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | break; |
|  |  | case 0x0045: |
|  |  | ilm.MinFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | ilm.MinFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | break; |
|  |  | case 0x0046: |
|  |  | ilm.MaxFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | CHECKBUFFER\_SGET4(tag\_dataoffset); |
|  |  | ilm.MaxFocal = sgetreal(tag\_type, srf\_buf + tag\_dataoffset); |
|  |  | break; |
|  |  | } |
|  |  | } else goto restore\_after\_parseSonySRF; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c243f45`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibRaw%2FLibRaw%2Fcommit%2Fc243f4539233053466c1309bde606815351bee81) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5d691940_20250119_112628.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibRaw%2FLibRaw%2Fissues%2F283)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibRaw%2FLibRaw%2Fissues%2F283)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=LibRaw%2FLibRaw)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[LibRaw](/LibRaw)
/
**[LibRaw](/LibRaw/LibRaw)**
Public

* [Notifications](/login?return_to=%2FLibRaw%2FLibRaw) You must be signed in to change notification settings
* [Fork
  289](/login?return_to=%2FLibRaw%2FLibRaw)
* [Star
   1.2k](/login?return_to=%2FLibRaw%2FLibRaw)

* [Code](/LibRaw/LibRaw)
* [Issues
  2](/LibRaw/LibRaw/issues)
* [Pull requests
  0](/LibRaw/LibRaw/pulls)
* [Actions](/LibRaw/LibRaw/actions)
* [Projects
  0](/LibRaw/LibRaw/projects)
* [Wiki](/LibRaw/LibRaw/wiki)
* [Security](/LibRaw/LibRaw/security)
* [Insights](/LibRaw/LibRaw/pulse)

Additional navigation options

* [Code](/LibRaw/LibRaw)
* [Issues](/LibRaw/LibRaw/issues)
* [Pull requests](/LibRaw/LibRaw/pulls)
* [Actions](/LibRaw/LibRaw/actions)
* [Projects](/LibRaw/LibRaw/projects)
* [Wiki](/LibRaw/LibRaw/wiki)
* [Security](/LibRaw/LibRaw/security)
* [Insights](/LibRaw/LibRaw/pulse)

# Libraw "LibRaw::parseSonySRF()" Out-of-bounds Read Vulnerability #283

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Libraw "LibRaw::parseSonySRF()" Out-of-bounds Read Vulnerability](#top)#283Copy link![@0xfoxone](https://avatars.githubusercontent.com/u/62952100?u=0fceb961a2c44862ece4158434061cc973531c8f&v=4&size=80)
## Description

![@0xfoxone](https://avatars.githubusercontent.com/u/62952100?u=0fceb961a2c44862ece4158434061cc973531c8f&v=4&size=48)[0xfoxone](https://github.com/0xfoxone)opened [on May 10, 2020](https://github.com/LibRaw/LibRaw/issues/283#issue-615438367)

**Description:**

There is an out-of-bounds read vulnerability within the "LibRaw::parseSonySRF()" function (libraw\src\metadata\sony.cpp) when processing srf files.

**Steps to Reproduce:**

poc (password: 0xfoxone):

<https://drive.google.com/open?id=1r0wig5pSGUFhP3mDycIUcKMvnHamYaGJ>

cmd:

magick.exe convert poc.srf new.bmp

Upon running this, following crash happens (Note: I enabled page heap on magick.exe):

Microsoft (R) Windows Debugger Version 10.0.18362.1 AMD64

Copyright (c) Microsoft Corporation. All rights reserved.

CommandLine: C:\ImageMagick-7.0.10-7\VisualMagick\bin\magick.exe convert c:\poc.srf c:\new.bmp

Symbol search path is: srv\*

Executable search path is:

ModLoad: 00007ff7`79300000 00007ff7`79312000 magick.exe

ModLoad: 00007ffd`b0d20000 00007ffd`b0f10000 ntdll.dll

ModLoad: 00007ffd`99d60000 00007ffd`99dd1000 C:\WINDOWS\System32\verifier.dll

Page heap: pid 0x1ED0: page heap enabled with flags 0x3.

ModLoad: 00007ffd`af870000 00007ffd`af922000 C:\WINDOWS\System32\KERNEL32.DLL

ModLoad: 00007ffd`add60000 00007ffd`ae004000 C:\WINDOWS\System32\KERNELBASE.dll

ModLoad: 00007ffd`87cf0000 00007ffd`87fe1000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_MagickCore\_.dll

ModLoad: 00007ffd`886a0000 00007ffd`8886b000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_MagickWand\_.dll

ModLoad: 00007ffd`b01a0000 00007ffd`b0334000 C:\WINDOWS\System32\USER32.dll

ModLoad: 00007ffd`aea40000 00007ffd`aea61000 C:\WINDOWS\System32\win32u.dll

ModLoad: 00007ffd`af270000 00007ffd`af296000 C:\WINDOWS\System32\GDI32.dll

ModLoad: 00007ffd`ae010000 00007ffd`ae1a4000 C:\WINDOWS\System32\gdi32full.dll

ModLoad: 00007ffd`aea70000 00007ffd`aeb0e000 C:\WINDOWS\System32\msvcp\_win.dll

ModLoad: 00007ffd`aeb30000 00007ffd`aec2a000 C:\WINDOWS\System32\ucrtbase.dll

ModLoad: 00007ffd`b04c0000 00007ffd`b0563000 C:\WINDOWS\System32\ADVAPI32.dll

ModLoad: 00007ffd`afdf0000 00007ffd`afe8e000 C:\WINDOWS\System32\msvcrt.dll

ModLoad: 00007ffd`b0420000 00007ffd`b04b7000 C:\WINDOWS\System32\sechost.dll

ModLoad: 00007ffd`af5b0000 00007ffd`af6d0000 C:\WINDOWS\System32\RPCRT4.dll

ModLoad: 00007ffd`afd80000 00007ffd`afdef000 C:\WINDOWS\System32\WS2\_32.dll

ModLoad: 00007ffd`a1d20000 00007ffd`a1d42000 C:\WINDOWS\SYSTEM32\VCRUNTIME140D.dll

ModLoad: 00007ffd`86800000 00007ffd`869bb000 C:\WINDOWS\SYSTEM32\ucrtbased.dll

ModLoad: 00007ffd`8d900000 00007ffd`8da1f000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_freetype\_.dll

ModLoad: 00007ffd`8e600000 00007ffd`8e686000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_lcms\_.dll

ModLoad: 00007ffd`a1b50000 00007ffd`a1b77000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_bzlib\_.dll

ModLoad: 00007ffd`8e1c0000 00007ffd`8e260000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_libxml\_.dll

ModLoad: 00007ffd`9dbe0000 00007ffd`9dc03000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_lqr\_.dll

ModLoad: 00007ffd`9d610000 00007ffd`9d63a000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_zlib\_.dll

ModLoad: 00007ffd`9a400000 00007ffd`9a435000 C:\WINDOWS\SYSTEM32\VCOMP140D.DLL

ModLoad: 00007ffd`85150000 00007ffd`8548b000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE\_DB\_glib\_.dll

ModLoad: 00007ffd`b05f0000 00007ffd`b0cd4000 C:\WINDOWS\System32\SHELL32.dll

ModLoad: 00007ffd`aed80000 00007ffd`aedca000 C:\WINDOWS\System32\cfgmgr32.dll

ModLoad: 00007ffd`afc70000 00007ffd`afd19000 C:\WINDOWS\System32\shcore.dll

ModLoad: 00007ffd`af930000 00007ffd`afc66000 C:\WINDOWS\System32\combase.dll

ModLoad: 00007ffd`ae1b0000 00007ffd`ae230000 C:\WINDOWS\System32\bcryptPrimitives.dll

ModLoad: 00007ffd`ae260000 00007ffd`ae9dd000 C:\WINDOWS\System32\windows.storage.dll

ModLoad: 00007ffd`adc80000 00007ffd`adca3000 C:\WINDOWS\System32\profapi.dll

ModLoad: 00007ffd`adbf0000 00007ffd`adc3a000 C:\WINDOWS\System32\powrprof.dll

ModLoad: 00007ffd`adbe0000 00007ffd`adbf0000 C:\WINDOWS\System32\UMPDC.dll

ModLoad: 00007ffd`b03c0000 00007ffd`b0412000 C:\WINDOWS\System32\shlwapi.dll

ModLoad: 00007ffd`adc40000 00007ffd`adc51000 C:\WINDOWS\System32\kernel.appcore.dll

ModLoad: 00007ffd`aeb10000 00007ffd`aeb27000 C:\WINDOWS\System32\cryptsp.dll

ModLoad: 00007ffd`b0040000 00007ffd`b0197000 C:\WINDOWS\System32\ole32.dll

ModLoad: 00007ffd`ad1b0000 00007ffd`ad27b000 C:\WINDOWS\SYSTEM32\DNSAPI.dll

ModLoad: 00007ffd`af370000 00007ffd`af378000 C:\WINDOWS\System32\NSI.dll

ModLoad: 00007ffd`ad160000 00007ffd`ad19a000 C:\WINDOWS\SYSTEM32\IPHLPAPI.DLL

(1ed0.1214): Break instruction exception - code 80000003 (first chance)

ntdll!LdrpDoDebuggerBreak+0x30:

00007ffd`b0df119c cc int 3 0:000> g ModLoad: 00007ffd`af4b0000 00007ffd`af4de000 C:\WINDOWS\System32\IMM32.DLL ModLoad: 00007ffd`a93a0000 00007ffd`a93af000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\IM_MOD_DB_DNG_.dll ModLoad: 00007ffd`86310000 00007ffd`864bc000 C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE_DB_libraw_.dll ModLoad: 00007ffd`88e10000 00007ffd`88f06000 C:\WINDOWS\SYSTEM32\MSVCP140D.dll (1ed0.1214): Access violation - code c0000005 (first chance) First chance exceptions are reported before any exception handling. This exception may be expected and handled. *** WARNING: Unable to verify checksum for C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE_DB_libraw_.dll CORE_DB_libraw_!LibRaw::sget2+0x2c: 00007ffd`86396d9c 0fb60401 movzx eax,byte ptr [rcx+rax] ds:0000019e`5bb50000=?? 0:000> k Child-SP RetAddr Call Site 00 00000093`9ecee890 00007ffd`8636bf5d CORE_DB_libraw_!LibRaw::sget2+0x2c [c:\imagemagick-7.0.10-7\libraw\src\utils\utils_dcraw.cpp @ 84] 01 00000093`9ecee8a0 00007ffd`8636fe7a CORE_DB_libraw_!LibRaw::parseSonySRF+0x42d [c:\imagemagick-7.0.10-7\libraw\src\metadata\sony.cpp @ 1952] 02 00000093`9ecee950 00007ffd`8638071a CORE_DB_libraw_!LibRaw::parse_exif+0x155a [c:\imagemagick-7.0.10-7\libraw\src\metadata\exif_gps.cpp @ 229] 03 00000093`9eceef50 00007ffd`8637bebb CORE_DB_libraw_!LibRaw::parse_tiff_ifd+0x484a [c:\imagemagick-7.0.10-7\libraw\src\metadata\tiff.cpp @ 717] 04 00000093`9ecefdd0 00007ffd`8632f89f CORE_DB_libraw_!LibRaw::parse_tiff+0x11b [c:\imagemagick-7.0.10-7\libraw\src\metadata\tiff.cpp @ 1468] 05 00000093`9ecefe30 00007ffd`864079de CORE_DB_libraw_!LibRaw::identify+0xd2f [c:\imagemagick-7.0.10-7\libraw\src\metadata\identify.cpp @ 537] 06 00000093`9ecf3350 00007ffd`8640b149 CORE_DB_libraw_!LibRaw::open_datastream+0x10e [c:\imagemagick-7.0.10-7\libraw\src\utils\open.cpp @ 377] 07 00000093`9ecf35f0 00007ffd`8641dfc8 CORE_DB_libraw_!LibRaw::open_file+0x269 [c:\imagemagick-7.0.10-7\libraw\src\utils\open.cpp @ 99] *** WARNING: Unable to verify checksum for C:\ImageMagick-7.0.10-7\VisualMagick\bin\IM_MOD_DB_DNG_.dll 08 00000093`9ecf3720 00007ffd`a93a191c CORE_DB_libraw_!libraw_open_wfile+0x58 [c:\imagemagick-7.0.10-7\libraw\src\libraw_c_api.cpp @ 113] *** WARNING: Unable to verify checksum for C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE_DB_MagickCore_.dll 09 00000093`9ecf3760 00007ffd`87d671e7 IM_MOD_DB_DNG_!ReadDNGImage+0x2fc [c:\imagemagick-7.0.10-7\imagemagick\coders\dng.c @ 379] 0a 00000093`9ecf5870 00007ffd`87d68963 CORE_DB_MagickCore_!ReadImage+0x5e7 [c:\imagemagick-7.0.10-7\imagemagick\magickcore\constitute.c @ 553] *** WARNING: Unable to verify checksum for C:\ImageMagick-7.0.10-7\VisualMagick\bin\CORE_DB_MagickWand_.dll 0b 00000093`9ecfaa90 00007ffd`886daac3 CORE_DB_MagickCore_!ReadImages+0x393 [c:\imagemagick-7.0.10-7\imagemagick\magickcore\constitute.c @ 941] 0c 00000093`9ecfbb40 00007ffd`887744ae CORE_DB_MagickWand_!ConvertImageCommand+0x1523 [c:\imagemagick-7.0.10-7\imagemagick\magickwand\convert.c @ 606] *** WARNING: Unable to verify checksum for magick.exe 0d 00000093`9ecfd690 00007ff7`793014ea CORE_DB_MagickWand_!MagickCommandGenesis+0x33e [c:\imagemagick-7.0.10-7\imagemagick\magickwand\mogrify.c @ 186] 0e 00000093`9ecfe800 00007ff7`79301693 magick!MagickMain+0x4ea [c:\imagemagick-7.0.10-7\imagemagick\utilities\magick.c @ 149] 0f 00000093`9ecffa70 00007ff7`79301f24 magick!wmain+0x43 [c:\imagemagick-7.0.10-7\imagemagick\utilities\magick.c @ 195] 10 00000093`9ecffab0 00007ff7`79301e37 magick!invoke_main+0x34 [f:\dd\vctools\crt\vcstartup\src\startup\exe_common.inl @ 80] 11 00000093`9ecffaf0 00007ff7`79301cfe magick!__scrt_common_main_seh+0x127 [f:\dd\vctools\crt\vcstartup\src\startup\exe_common.inl @ 253] 12 00000093`9ecffb50 00007ff7`79301f39 magick!__scrt_common_main+0xe [f:\dd\vctools\crt\vcstartup\src\startup\exe_common.inl @ 296] 13 00000093`9ecffb80 00007ffd`af887bd4 magick!wmainCRTStartup+0x9 [f:\dd\vctools\crt\vcstartup\src\startup\exe_wmain.cpp @ 17] 14 00000093`9ecffbb0 00007ffd`b0d8ce51 KERNEL32!BaseThreadInitThunk+0x14 15 00000093`9ecffbe0 00000000`00000000 ntdll!RtlUserThreadStart+0x21

**System Configuration:**

* ImageMagick:

  Version: ImageMagick-7.0.10-Q16 <https://imagemagick.org>

  License: <https://imagemagick.org/script/license.php>
* Environment (Operating system, version and so on):

  Distributor ID: Microsoft Windows

  Description: Windows 10
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


