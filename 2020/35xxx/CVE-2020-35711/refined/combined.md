=== Content from github.com_beb46204_20250119_142733.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-9pqx-g3jh-qpqq)

**CVE-2020-35711**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-9pqx-g3jh-qpqq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2020-35711](/advisories/GHSA-9pqx-g3jh-qpqq)

## Dangling reference in `access::Map` with Constant

High severity

GitHub Reviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 27, 2023

[Vulnerability details](/advisories/GHSA-9pqx-g3jh-qpqq)
[Dependabot alerts
0](/advisories/GHSA-9pqx-g3jh-qpqq/dependabot)

## Package

cargo

arc-swap
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

>= 0.4.2, < 0.4.8
>= 1.0.0, < 1.1.0

## Patched versions

0.4.8
1.1.0

## Description

An issue has been discovered in the arc-swap crate before 0.4.8 (and 1.x before 1.1.0) for Rust. Use of arc\_swap::access::Map with the Constant test helper (or with a user-supplied implementation of the Access trait) could sometimes lead to dangling references being returned by the map.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-35711>
* [vorner/arc-swap#45](https://github.com/vorner/arc-swap/issues/45)
* <https://rustsec.org/advisories/RUSTSEC-2020-0091.html>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-35711)
Dec 25, 2020

Published to the GitHub Advisory Database
May 24, 2022

Reviewed
Jun 16, 2022

Last updated
Jan 27, 2023

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.139%
 (50th percentile)

### Weaknesses

No CWEs

### CVE ID

CVE-2020-35711

### GHSA ID

GHSA-9pqx-g3jh-qpqq

### Source code

[vorner/arc-swap](https://github.com/vorner/arc-swap)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-9pqx-g3jh-qpqq/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from rustsec.org_5bd39156_20250119_130044.html ===


RUSTSEC-2020-0091: arc-swap: Dangling reference in `access::Map` with Constant › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/arc-swap/RUSTSEC-2020-0091.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/arc-swap/RUSTSEC-2020-0091.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2020-0091)

# RUSTSEC-2020-0091

Dangling reference in `access::Map` with Constant

Reported
December 10, 2020

Issued
December 11, 2020

(last modified: June 13, 2023)

Package
[arc-swap](/packages/arc-swap.html)
([crates.io](https://crates.io/crates/arc-swap))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#dangling-reference](/keywords/dangling-reference.html)

Aliases

* [CVE-2020-35711](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-35711)
* [GHSA-9pqx-g3jh-qpqq](https://github.com/advisories/GHSA-9pqx-g3jh-qpqq)

References

* <https://github.com/vorner/arc-swap/issues/45>

CVSS Score
7.5
HIGH

CVSS Details
Attack vectorNetwork
Attack complexityLow
Privileges requiredNone
User interactionNone
ScopeUnchanged
ConfidentialityNone
IntegrityNone
AvailabilityHigh

CVSS Vector
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H)
Patched

* `>=0.4.8, <1.0.0-0`
* `>=1.1.0`

Unaffected

* `<0.4.2`

Affected Functions
Version
`arc_swap::access::MapGuard::deref`

* `<1.1.0`

### Description

Using the `arc_swap::access::Map` with the `Constant` test helper (or with
user-provided implementation of the `Access` trait) could sometimes lead to the
map returning dangling references.

Replaced by implementation without `unsafe`, at the cost of added `Clone` bound
on the closure and small penalty on performance.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.



=== Content from github.com_ecf1cb53_20250119_142734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvorner%2Farc-swap%2Fissues%2F45)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvorner%2Farc-swap%2Fissues%2F45)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=vorner%2Farc-swap)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vorner](/vorner)
/
**[arc-swap](/vorner/arc-swap)**
Public

* [Notifications](/login?return_to=%2Fvorner%2Farc-swap) You must be signed in to change notification settings
* [Fork
  31](/login?return_to=%2Fvorner%2Farc-swap)
* [Star
   853](/login?return_to=%2Fvorner%2Farc-swap)

* [Code](/vorner/arc-swap)
* [Issues
  8](/vorner/arc-swap/issues)
* [Pull requests
  9](/vorner/arc-swap/pulls)
* [Actions](/vorner/arc-swap/actions)
* [Security](/vorner/arc-swap/security)
* [Insights](/vorner/arc-swap/pulse)

Additional navigation options

* [Code](/vorner/arc-swap)
* [Issues](/vorner/arc-swap/issues)
* [Pull requests](/vorner/arc-swap/pulls)
* [Actions](/vorner/arc-swap/actions)
* [Security](/vorner/arc-swap/security)
* [Insights](/vorner/arc-swap/pulse)

# MapGuard dereferences to a dangling pointer #45

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[MapGuard dereferences to a dangling pointer](#top)#45Copy link![@Qwaz](https://avatars.githubusercontent.com/u/5073807?u=2ce3c5e94d4fa1db409878d8812e2dfe6cb164bf&v=4&size=80)
## Description

![@Qwaz](https://avatars.githubusercontent.com/u/5073807?u=2ce3c5e94d4fa1db409878d8812e2dfe6cb164bf&v=4&size=48)[Qwaz](https://github.com/Qwaz)opened [on Dec 10, 2020](https://github.com/vorner/arc-swap/issues/45#issue-760845391)

Hello fellow Rustacean,

we (Rust group [@sslab-gatech](https://github.com/sslab-gatech)) are scanning Rust code on crates.io for potential memory safety and soundness bugs and found an issue in this crate which allows safe Rust code to exhibit an undefined behavior.

## Issue Description

[arc-swap/src/access.rs](https://github.com/vorner/arc-swap/blob/b5ec44cd5d9b4b4a491cf85c1cbb2b1d5cdae061/src/access.rs#L279-L293)

Lines 279 to 293
in
[b5ec44c](/vorner/arc-swap/commit/b5ec44cd5d9b4b4a491cf85c1cbb2b1d5cdae061)

|  | impl<A, T, F, R> Access<R> for Map<A, T, F> |
| --- | --- |
|  | where |
|  | A: Access<T>, |
|  | F: Fn(&T) -> &R, |
|  | { |
|  | type Guard = MapGuard<A::Guard, R>; |
|  | fn load(&self) -> Self::Guard { |
|  | let guard = self.access.load(); |
|  | let value: \*const \_ = (self.projection)(&guard); |
|  | MapGuard { |
|  | \_guard: guard, |
|  | value, |
|  | } |
|  | } |
|  | } |

[arc-swap/src/access.rs](https://github.com/vorner/arc-swap/blob/b5ec44cd5d9b4b4a491cf85c1cbb2b1d5cdae061/src/access.rs#L230-L242)

Lines 230 to 242
in
[b5ec44c](/vorner/arc-swap/commit/b5ec44cd5d9b4b4a491cf85c1cbb2b1d5cdae061)

|  | impl<G, T> Deref for MapGuard<G, T> { |
| --- | --- |
|  | type Target = T; |
|  | fn deref(&self) -> &T { |
|  | // Why this is safe: |
|  | // \* The pointer is originally converted from a reference. It's not null, it's aligned, |
|  | // it's the right type, etc. |
|  | // \* The pointee couldn't have gone away ‒ the guard keeps the original reference alive, so |
|  | // must the new one still be alive too. Moving the guard is fine, we assume the RefCnt is |
|  | // Pin (because it's Arc or Rc or something like that ‒ when that one moves, the data it |
|  | // points to stay at the same place). |
|  | unsafe { &\*self.value } |
|  | } |
|  | } |

As noted in the comment, unsafe code in `MapGuard` expects the underlying guard type to dereferences to the same value even when the guard object is moved. However, `Map` uses `Access` as a trait bound which does not guarantee this property. As a result, `Map` accesses a dangling pointer when it is used with an `Access` implementation that does not dereferences to the same value when moved.

[arc-swap/src/access.rs](https://github.com/vorner/arc-swap/blob/b5ec44cd5d9b4b4a491cf85c1cbb2b1d5cdae061/src/access.rs#L295-L322)

Lines 295 to 322
in
[b5ec44c](/vorner/arc-swap/commit/b5ec44cd5d9b4b4a491cf85c1cbb2b1d5cdae061)

|  | #[doc(hidden)] |
| --- | --- |
|  | #[derive(Copy, Clone, Debug, Eq, PartialEq, Ord, PartialOrd, Hash)] |
|  | pub struct ConstantDeref<T>(T); |
|  |  |
|  | impl<T> Deref for ConstantDeref<T> { |
|  | type Target = T; |
|  | fn deref(&self) -> &T { |
|  | &self.0 |
|  | } |
|  | } |
|  |  |
|  | /// Access to an constant. |
|  | /// |
|  | /// This wraps a constant value to provide [`Access`] to it. It is constant in the sense that, |
|  | /// unlike [`ArcSwapAny`] and [`Map`], the loaded value will always stay the same (there's no |
|  | /// remote `store`). |
|  | /// |
|  | /// The purpose is mostly testing and plugging a parameter that works generically from code that |
|  | /// doesn't need the updating functionality. |
|  | #[derive(Copy, Clone, Debug, Eq, PartialEq, Ord, PartialOrd, Hash)] |
|  | pub struct Constant<T>(pub T); |
|  |  |
|  | impl<T: Clone> Access<T> for Constant<T> { |
|  | type Guard = ConstantDeref<T>; |
|  | fn load(&self) -> Self::Guard { |
|  | ConstantDeref(self.0.clone()) |
|  | } |
|  | } |

`Constant` seems to be the only type in this crate that implements `Access` in this way, but there can be other user types that implements `Access` on their own.

## Reproduction

Below is an example program that segfaults, written only with safe APIs of `arc-swap`.

Show Detail
```
#![forbid(unsafe_code)]

use arc_swap::access::Map;
use arc_swap::access::{Access, Constant};

static CORRECT_ADDR: &str = "I'm pointing to the correct location!";

#[derive(Clone)]
struct MemoryChecker {
    // should be always CORRECT_ADDR
    message: &'static str,
}

impl MemoryChecker {
    pub fn new() -> Self {
        MemoryChecker {
            message: CORRECT_ADDR,
        }
    }

    pub fn validate(&self) {
        println!(
            "Pointing to {:?}, len {}",
            self.message as *const _,
            self.message.len()
        );
        println!("Message: {}", self.message);
    }
}

fn overwrite() {
    let a = 123;
    let b = 456;
    println!("Overwriting stack content {} {}", a, b);
}

fn main() {
    let constant = Constant(MemoryChecker::new());
    constant.0.validate();

    // Create a map with identity mapping
    let map = Map::new(constant, |checker: &MemoryChecker| checker);

    // After calling this, `value` pointer of `MapGuard` points to a dangling stack address
    let loaded = map.load();

    overwrite();

    loaded.validate();
}
```

Output:

```
Pointing to 0x55dcc9269000, len 37
Message: I'm pointing to the correct location!
Overwriting stack content 123 456
Pointing to 0x55dcc9267530, len 140726361573556

Terminated with signal 11 (SIGSEGV)

```
### Tested Environment

* Crate: arc-swap
* Version: 1.0.0
* OS: Ubuntu 20.04.1 LTS
* Rustc version: rustc 1.48.0 (7eac88abb 2020-11-16)

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


