=== Content from github.com_2ccdc365_20250119_123334.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjpeg-turbo%2Flibjpeg-turbo%2Fcommit%2F9120a247436e84c0b4eea828cb11e8f665fcde30)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjpeg-turbo%2Flibjpeg-turbo%2Fcommit%2F9120a247436e84c0b4eea828cb11e8f665fcde30)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=libjpeg-turbo%2Flibjpeg-turbo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libjpeg-turbo](/libjpeg-turbo)
/
**[libjpeg-turbo](/libjpeg-turbo/libjpeg-turbo)**
Public

* [Notifications](/login?return_to=%2Flibjpeg-turbo%2Flibjpeg-turbo) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Flibjpeg-turbo%2Flibjpeg-turbo)
* [Star
   3.8k](/login?return_to=%2Flibjpeg-turbo%2Flibjpeg-turbo)

* [Code](/libjpeg-turbo/libjpeg-turbo)
* [Issues
  18](/libjpeg-turbo/libjpeg-turbo/issues)
* [Pull requests
  2](/libjpeg-turbo/libjpeg-turbo/pulls)
* [Discussions](/libjpeg-turbo/libjpeg-turbo/discussions)
* [Actions](/libjpeg-turbo/libjpeg-turbo/actions)
* [Projects
  0](/libjpeg-turbo/libjpeg-turbo/projects)
* [Security](/libjpeg-turbo/libjpeg-turbo/security)
* [Insights](/libjpeg-turbo/libjpeg-turbo/pulse)

Additional navigation options

* [Code](/libjpeg-turbo/libjpeg-turbo)
* [Issues](/libjpeg-turbo/libjpeg-turbo/issues)
* [Pull requests](/libjpeg-turbo/libjpeg-turbo/pulls)
* [Discussions](/libjpeg-turbo/libjpeg-turbo/discussions)
* [Actions](/libjpeg-turbo/libjpeg-turbo/actions)
* [Projects](/libjpeg-turbo/libjpeg-turbo/projects)
* [Security](/libjpeg-turbo/libjpeg-turbo/security)
* [Insights](/libjpeg-turbo/libjpeg-turbo/pulse)

## Commit

[Permalink](/libjpeg-turbo/libjpeg-turbo/commit/9120a247436e84c0b4eea828cb11e8f665fcde30)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix jpeg\_skip\_scanlines() segfault w/merged upsamp

[Browse files](/libjpeg-turbo/libjpeg-turbo/tree/9120a247436e84c0b4eea828cb11e8f665fcde30)
Browse the repository at this point in the history

```
The additional segfault mentioned in [#244](https://github.com/libjpeg-turbo/libjpeg-turbo/pull/244) was due to the fact that
the merged upsamplers use a different private structure than the
non-merged upsamplers.  jpeg_skip_scanlines() was assuming the latter, so
when merged upsampling was enabled, jpeg_skip_scanlines() clobbered one
of the IDCT method pointers in the merged upsampler's private structure.

For reasons unknown, the test image in [#441](https://github.com/libjpeg-turbo/libjpeg-turbo/issues/441) did not encounter this
segfault (too small?), but it encountered an issue similar to the one
fixed in [5bc43c7](https://github.com/libjpeg-turbo/libjpeg-turbo/commit/5bc43c7821df982f65aa1c738f67fbf7cba8bd69), whereby it was
necessary to set up a dummy postprocessing function in
read_and_discard_scanlines() when merged upsampling was enabled.
Failing to do so caused either a segfault in merged_2v_upsample() (due
to a NULL pointer being passed to jcopy_sample_rows()) or an error
("Corrupt JPEG data: premature end of data segment"), depending on the
number of scanlines skipped and whether the first scanline skipped was
an odd- or even-numbered row.

Fixes [#441](https://github.com/libjpeg-turbo/libjpeg-turbo/issues/441)
Fixes [#244](https://github.com/libjpeg-turbo/libjpeg-turbo/pull/244) (for real this time)
```

* Loading branch information

[![@dcommander](https://avatars.githubusercontent.com/u/651941?s=40&v=4)](/dcommander)

[dcommander](/libjpeg-turbo/libjpeg-turbo/commits?author=dcommander "View all commits by dcommander")
committed
Jul 24, 2020

1 parent
[c965dc7](/libjpeg-turbo/libjpeg-turbo/commit/c965dc7a79e42974a2b70fc59a13b40392ae7ccb)

commit 9120a24

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**134 additions**
and
**53 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ChangeLog.md
  [ChangeLog.md](#diff-874f33563125619a7a5cb567ebe523c59258662d69858d78d24d947b275f9c6c)
* jdapistd.c
  [jdapistd.c](#diff-59bc8cca4615fd377cf24e65094bcec79e849054f014ef48cbb5ae62fff66028)
* jdmerge.c
  [jdmerge.c](#diff-4dd2425a0b6b4f86f774c48a757646b34c703fe3ab534509738f599d41f59569)
* jdmerge.h
  [jdmerge.h](#diff-bf0baf3bb3929bf6b62921bc3fb53a5d649db527a952bae772a78659f3732437)
* jdmrg565.c
  [jdmrg565.c](#diff-ff43b2df1a3b7634e7ed7569b2f56703a7a88ed8d2333b8bfe08babcfd92fc7d)
* jdmrgext.c
  [jdmrgext.c](#diff-e01916ebd11b835df5a7e260fcc99624a6cbeac85540e5af81d93e41b8ec6998)

## There are no files selected for viewing

6 changes: 6 additions & 0 deletions

6
[ChangeLog.md](#diff-874f33563125619a7a5cb567ebe523c59258662d69858d78d24d947b275f9c6c "ChangeLog.md")

Show comments

[View file](/libjpeg-turbo/libjpeg-turbo/blob/9120a247436e84c0b4eea828cb11e8f665fcde30/ChangeLog.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -7,6 +7,12 @@ |
|  |  | platforms when using any of the YUV encoding/compression/decompression/decoding |
|  |  | methods in the TurboJPEG Java API. |
|  |  |  |
|  |  | 2. Fixed segfaults or "Corrupt JPEG data: premature end of data segment" errors |
|  |  | in `jpeg\_skip\_scanlines()` that occurred when decompressing 4:2:2 or 4:2:0 JPEG |
|  |  | images using the merged (non-fancy) upsampling algorithms (that is, when |
|  |  | setting `cinfo.do\_fancy\_upsampling` to `FALSE`.) 2.0.0[6] was a similar fix, |
|  |  | but it did not cover all cases. |
|  |  |  |
|  |  |  |
|  |  | 2.0.5 |
|  |  | ===== |
| Expand Down | |  |

72 changes: 64 additions & 8 deletions

72
[jdapistd.c](#diff-59bc8cca4615fd377cf24e65094bcec79e849054f014ef48cbb5ae62fff66028 "jdapistd.c")

Show comments

[View file](/libjpeg-turbo/libjpeg-turbo/blob/9120a247436e84c0b4eea828cb11e8f665fcde30/jdapistd.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | \* This file was part of the Independent JPEG Group's software: |
|  |  | \* Copyright (C) 1994-1996, Thomas G. Lane. |
|  |  | \* libjpeg-turbo Modifications: |
|  |  | \* Copyright (C) 2010, 2015-2018, D. R. Commander. |
|  |  | \* Copyright (C) 2010, 2015-2018, 2020, D. R. Commander. |
|  |  | \* Copyright (C) 2015, Google, Inc. |
|  |  | \* For conditions of distribution and use, see the accompanying README.ijg |
|  |  | \* file. |
| Expand All | | @@ -21,6 +21,8 @@ |
|  |  | #include "jinclude.h" |
|  |  | #include "jdmainct.h" |
|  |  | #include "jdcoefct.h" |
|  |  | #include "jdmaster.h" |
|  |  | #include "jdmerge.h" |
|  |  | #include "jdsample.h" |
|  |  | #include "jmemsys.h" |
|  |  |  |
| Expand Down  Expand Up | | @@ -304,6 +306,16 @@ noop\_quantize(j\_decompress\_ptr cinfo, JSAMPARRAY input\_buf, |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | /\* Dummy postprocessing function used by jpeg\_skip\_scanlines() \*/ |
|  |  | LOCAL(void) |
|  |  | noop\_post\_process (j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION \*in\_row\_group\_ctr, |
|  |  | JDIMENSION in\_row\_groups\_avail, JSAMPARRAY output\_buf, |
|  |  | JDIMENSION \*out\_row\_ctr, JDIMENSION out\_rows\_avail) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | /\* |
|  |  | \* In some cases, it is best to call jpeg\_read\_scanlines() and discard the |
|  |  | \* output, rather than skipping the scanlines, because this allows us to |
| Expand All | | @@ -316,11 +328,17 @@ LOCAL(void) |
|  |  | read\_and\_discard\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | { |
|  |  | JDIMENSION n; |
|  |  | my\_master\_ptr master = (my\_master\_ptr)cinfo->master; |
|  |  | void (\*color\_convert) (j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION input\_row, JSAMPARRAY output\_buf, |
|  |  | int num\_rows) = NULL; |
|  |  | void (\*color\_quantize) (j\_decompress\_ptr cinfo, JSAMPARRAY input\_buf, |
|  |  | JSAMPARRAY output\_buf, int num\_rows) = NULL; |
|  |  | void (\*post\_process\_data) (j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION \*in\_row\_group\_ctr, |
|  |  | JDIMENSION in\_row\_groups\_avail, |
|  |  | JSAMPARRAY output\_buf, JDIMENSION \*out\_row\_ctr, |
|  |  | JDIMENSION out\_rows\_avail) = NULL; |
|  |  |  |
|  |  | if (cinfo->cconvert && cinfo->cconvert->color\_convert) { |
|  |  | color\_convert = cinfo->cconvert->color\_convert; |
| Expand All | | @@ -332,6 +350,12 @@ read\_and\_discard\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | cinfo->cquantize->color\_quantize = noop\_quantize; |
|  |  | } |
|  |  |  |
|  |  | if (master->using\_merged\_upsample && cinfo->post && |
|  |  | cinfo->post->post\_process\_data) { |
|  |  | post\_process\_data = cinfo->post->post\_process\_data; |
|  |  | cinfo->post->post\_process\_data = noop\_post\_process; |
|  |  | } |
|  |  |  |
|  |  | for (n = 0; n < num\_lines; n++) |
|  |  | jpeg\_read\_scanlines(cinfo, NULL, 1); |
|  |  |  |
| Expand All | | @@ -340,6 +364,9 @@ read\_and\_discard\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  |  |
|  |  | if (color\_quantize) |
|  |  | cinfo->cquantize->color\_quantize = color\_quantize; |
|  |  |  |
|  |  | if (post\_process\_data) |
|  |  | cinfo->post->post\_process\_data = post\_process\_data; |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -382,7 +409,7 @@ jpeg\_skip\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | { |
|  |  | my\_main\_ptr main\_ptr = (my\_main\_ptr)cinfo->main; |
|  |  | my\_coef\_ptr coef = (my\_coef\_ptr)cinfo->coef; |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_master\_ptr master = (my\_master\_ptr)cinfo->master; |
|  |  | JDIMENSION i, x; |
|  |  | int y; |
|  |  | JDIMENSION lines\_per\_iMCU\_row, lines\_left\_in\_iMCU\_row, lines\_after\_iMCU\_row; |
| Expand Down  Expand Up | | @@ -445,8 +472,16 @@ jpeg\_skip\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | main\_ptr->buffer\_full = FALSE; |
|  |  | main\_ptr->rowgroup\_ctr = 0; |
|  |  | main\_ptr->context\_state = CTX\_PREPARE\_FOR\_IMCU; |
|  |  | upsample->next\_row\_out = cinfo->max\_v\_samp\_factor; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | if (master->using\_merged\_upsample) { |
|  |  | my\_merged\_upsample\_ptr upsample = |
|  |  | (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->spare\_full = FALSE; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } else { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->next\_row\_out = cinfo->max\_v\_samp\_factor; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* Skipping is much simpler when context rows are not required. \*/ |
| Expand All | | @@ -458,8 +493,16 @@ jpeg\_skip\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | cinfo->output\_scanline += lines\_left\_in\_iMCU\_row; |
|  |  | main\_ptr->buffer\_full = FALSE; |
|  |  | main\_ptr->rowgroup\_ctr = 0; |
|  |  | upsample->next\_row\_out = cinfo->max\_v\_samp\_factor; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | if (master->using\_merged\_upsample) { |
|  |  | my\_merged\_upsample\_ptr upsample = |
|  |  | (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->spare\_full = FALSE; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } else { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->next\_row\_out = cinfo->max\_v\_samp\_factor; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -494,7 +537,14 @@ jpeg\_skip\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | cinfo->output\_iMCU\_row += lines\_to\_skip / lines\_per\_iMCU\_row; |
|  |  | increment\_simple\_rowgroup\_ctr(cinfo, lines\_to\_read); |
|  |  | } |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | if (master->using\_merged\_upsample) { |
|  |  | my\_merged\_upsample\_ptr upsample = |
|  |  | (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } else { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } |
|  |  | return num\_lines; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -535,7 +585,13 @@ jpeg\_skip\_scanlines(j\_decompress\_ptr cinfo, JDIMENSION num\_lines) |
|  |  | \* bit odd, since "rows\_to\_go" seems to be redundantly keeping track of |
|  |  | \* output\_scanline. |
|  |  | \*/ |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | if (master->using\_merged\_upsample) { |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } else { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | upsample->rows\_to\_go = cinfo->output\_height - cinfo->output\_scanline; |
|  |  | } |
|  |  |  |
|  |  | /\* Always skip the requested number of lines. \*/ |
|  |  | return num\_lines; |
| Expand Down | |  |

46 changes: 9 additions & 37 deletions

46
[jdmerge.c](#diff-4dd2425a0b6b4f86f774c48a757646b34c703fe3ab534509738f599d41f59569 "jdmerge.c")

Show comments

[View file](/libjpeg-turbo/libjpeg-turbo/blob/9120a247436e84c0b4eea828cb11e8f665fcde30/jdmerge.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ |
|  |  | \* Copyright (C) 1994-1996, Thomas G. Lane. |
|  |  | \* libjpeg-turbo Modifications: |
|  |  | \* Copyright 2009 Pierre Ossman <ossman@cendio.se> for Cendio AB |
|  |  | \* Copyright (C) 2009, 2011, 2014-2015, D. R. Commander. |
|  |  | \* Copyright (C) 2009, 2011, 2014-2015, 2020, D. R. Commander. |
|  |  | \* Copyright (C) 2013, Linaro Limited. |
|  |  | \* For conditions of distribution and use, see the accompanying README.ijg |
|  |  | \* file. |
| Expand Down  Expand Up | | @@ -40,41 +40,13 @@ |
|  |  | #define JPEG\_INTERNALS |
|  |  | #include "jinclude.h" |
|  |  | #include "jpeglib.h" |
|  |  | #include "jdmerge.h" |
|  |  | #include "jsimd.h" |
|  |  | #include "jconfigint.h" |
|  |  |  |
|  |  | #ifdef UPSAMPLE\_MERGING\_SUPPORTED |
|  |  |  |
|  |  |  |
|  |  | /\* Private subobject \*/ |
|  |  |  |
|  |  | typedef struct { |
|  |  | struct jpeg\_upsampler pub; /\* public fields \*/ |
|  |  |  |
|  |  | /\* Pointer to routine to do actual upsampling/conversion of one row group \*/ |
|  |  | void (\*upmethod) (j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION in\_row\_group\_ctr, JSAMPARRAY output\_buf); |
|  |  |  |
|  |  | /\* Private state for YCC->RGB conversion \*/ |
|  |  | int \*Cr\_r\_tab; /\* => table for Cr to R conversion \*/ |
|  |  | int \*Cb\_b\_tab; /\* => table for Cb to B conversion \*/ |
|  |  | JLONG \*Cr\_g\_tab; /\* => table for Cr to G conversion \*/ |
|  |  | JLONG \*Cb\_g\_tab; /\* => table for Cb to G conversion \*/ |
|  |  |  |
|  |  | /\* For 2:1 vertical sampling, we produce two output rows at a time. |
|  |  | \* We need a "spare" row buffer to hold the second output row if the |
|  |  | \* application provides just a one-row buffer; we also use the spare |
|  |  | \* to discard the dummy last row if the image height is odd. |
|  |  | \*/ |
|  |  | JSAMPROW spare\_row; |
|  |  | boolean spare\_full; /\* T if spare buffer is occupied \*/ |
|  |  |  |
|  |  | JDIMENSION out\_row\_width; /\* samples per output row \*/ |
|  |  | JDIMENSION rows\_to\_go; /\* counts rows remaining in image \*/ |
|  |  | } my\_upsampler; |
|  |  |  |
|  |  | typedef my\_upsampler \*my\_upsample\_ptr; |
|  |  |  |
|  |  | #define SCALEBITS 16 /\* speediest right-shift on some machines \*/ |
|  |  | #define ONE\_HALF ((JLONG)1 << (SCALEBITS - 1)) |
|  |  | #define FIX(x) ((JLONG)((x) \* (1L << SCALEBITS) + 0.5)) |
| Expand Down  Expand Up | | @@ -189,7 +161,7 @@ typedef my\_upsampler \*my\_upsample\_ptr; |
|  |  | LOCAL(void) |
|  |  | build\_ycc\_rgb\_table(j\_decompress\_ptr cinfo) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | int i; |
|  |  | JLONG x; |
|  |  | SHIFT\_TEMPS |
| Expand Down  Expand Up | | @@ -232,7 +204,7 @@ build\_ycc\_rgb\_table(j\_decompress\_ptr cinfo) |
|  |  | METHODDEF(void) |
|  |  | start\_pass\_merged\_upsample(j\_decompress\_ptr cinfo) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  |  |
|  |  | /\* Mark the spare buffer empty \*/ |
|  |  | upsample->spare\_full = FALSE; |
| Expand All | | @@ -254,7 +226,7 @@ merged\_2v\_upsample(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION \*out\_row\_ctr, JDIMENSION out\_rows\_avail) |
|  |  | /\* 2:1 vertical sampling case: may need a spare row. \*/ |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | JSAMPROW work\_ptrs[2]; |
|  |  | JDIMENSION num\_rows; /\* number of rows returned to caller \*/ |
|  |  |  |
| Expand Down  Expand Up | | @@ -305,7 +277,7 @@ merged\_1v\_upsample(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION \*out\_row\_ctr, JDIMENSION out\_rows\_avail) |
|  |  | /\* 1:1 vertical sampling case: much easier, never need a spare row. \*/ |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  |  |
|  |  | /\* Just do the upsampling. \*/ |
|  |  | (\*upsample->upmethod) (cinfo, input\_buf, \*in\_row\_group\_ctr, |
| Expand Down  Expand Up | | @@ -566,11 +538,11 @@ h2v2\_merged\_upsample\_565D(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | GLOBAL(void) |
|  |  | jinit\_merged\_upsampler(j\_decompress\_ptr cinfo) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample; |
|  |  | my\_merged\_upsample\_ptr upsample; |
|  |  |  |
|  |  | upsample = (my\_upsample\_ptr) |
|  |  | upsample = (my\_merged\_upsample\_ptr) |
|  |  | (\*cinfo->mem->alloc\_small) ((j\_common\_ptr)cinfo, JPOOL\_IMAGE, |
|  |  | sizeof(my\_upsampler)); |
|  |  | sizeof(my\_merged\_upsampler)); |
|  |  | cinfo->upsample = (struct jpeg\_upsampler \*)upsample; |
|  |  | upsample->pub.start\_pass = start\_pass\_merged\_upsample; |
|  |  | upsample->pub.need\_context\_rows = FALSE; |
| Expand Down | |  |

47 changes: 47 additions & 0 deletions

47
[jdmerge.h](#diff-bf0baf3bb3929bf6b62921bc3fb53a5d649db527a952bae772a78659f3732437 "jdmerge.h")

Show comments

[View file](/libjpeg-turbo/libjpeg-turbo/blob/9120a247436e84c0b4eea828cb11e8f665fcde30/jdmerge.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,47 @@ |
|  |  | /\* |
|  |  | \* jdmerge.h |
|  |  | \* |
|  |  | \* This file was part of the Independent JPEG Group's software: |
|  |  | \* Copyright (C) 1994-1996, Thomas G. Lane. |
|  |  | \* libjpeg-turbo Modifications: |
|  |  | \* Copyright (C) 2020, D. R. Commander. |
|  |  | \* For conditions of distribution and use, see the accompanying README.ijg |
|  |  | \* file. |
|  |  | \*/ |
|  |  |  |
|  |  | #define JPEG\_INTERNALS |
|  |  | #include "jpeglib.h" |
|  |  |  |
|  |  | #ifdef UPSAMPLE\_MERGING\_SUPPORTED |
|  |  |  |
|  |  |  |
|  |  | /\* Private subobject \*/ |
|  |  |  |
|  |  | typedef struct { |
|  |  | struct jpeg\_upsampler pub; /\* public fields \*/ |
|  |  |  |
|  |  | /\* Pointer to routine to do actual upsampling/conversion of one row group \*/ |
|  |  | void (\*upmethod) (j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION in\_row\_group\_ctr, JSAMPARRAY output\_buf); |
|  |  |  |
|  |  | /\* Private state for YCC->RGB conversion \*/ |
|  |  | int \*Cr\_r\_tab; /\* => table for Cr to R conversion \*/ |
|  |  | int \*Cb\_b\_tab; /\* => table for Cb to B conversion \*/ |
|  |  | JLONG \*Cr\_g\_tab; /\* => table for Cr to G conversion \*/ |
|  |  | JLONG \*Cb\_g\_tab; /\* => table for Cb to G conversion \*/ |
|  |  |  |
|  |  | /\* For 2:1 vertical sampling, we produce two output rows at a time. |
|  |  | \* We need a "spare" row buffer to hold the second output row if the |
|  |  | \* application provides just a one-row buffer; we also use the spare |
|  |  | \* to discard the dummy last row if the image height is odd. |
|  |  | \*/ |
|  |  | JSAMPROW spare\_row; |
|  |  | boolean spare\_full; /\* T if spare buffer is occupied \*/ |
|  |  |  |
|  |  | JDIMENSION out\_row\_width; /\* samples per output row \*/ |
|  |  | JDIMENSION rows\_to\_go; /\* counts rows remaining in image \*/ |
|  |  | } my\_merged\_upsampler; |
|  |  |  |
|  |  | typedef my\_merged\_upsampler \*my\_merged\_upsample\_ptr; |
|  |  |  |
|  |  | #endif /\* UPSAMPLE\_MERGING\_SUPPORTED \*/ |

10 changes: 5 additions & 5 deletions

10
[jdmrg565.c](#diff-ff43b2df1a3b7634e7ed7569b2f56703a7a88ed8d2333b8bfe08babcfd92fc7d "jdmrg565.c")

Show comments

[View file](/libjpeg-turbo/libjpeg-turbo/blob/9120a247436e84c0b4eea828cb11e8f665fcde30/jdmrg565.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ |
|  |  | \* Copyright (C) 1994-1996, Thomas G. Lane. |
|  |  | \* libjpeg-turbo Modifications: |
|  |  | \* Copyright (C) 2013, Linaro Limited. |
|  |  | \* Copyright (C) 2014-2015, 2018, D. R. Commander. |
|  |  | \* Copyright (C) 2014-2015, 2018, 2020, D. R. Commander. |
|  |  | \* For conditions of distribution and use, see the accompanying README.ijg |
|  |  | \* file. |
|  |  | \* |
| Expand All | | @@ -19,7 +19,7 @@ h2v1\_merged\_upsample\_565\_internal(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION in\_row\_group\_ctr, |
|  |  | JSAMPARRAY output\_buf) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | register int y, cred, cgreen, cblue; |
|  |  | int cb, cr; |
|  |  | register JSAMPROW outptr; |
| Expand Down  Expand Up | | @@ -90,7 +90,7 @@ h2v1\_merged\_upsample\_565D\_internal(j\_decompress\_ptr cinfo, |
|  |  | JDIMENSION in\_row\_group\_ctr, |
|  |  | JSAMPARRAY output\_buf) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | register int y, cred, cgreen, cblue; |
|  |  | int cb, cr; |
|  |  | register JSAMPROW outptr; |
| Expand Down  Expand Up | | @@ -163,7 +163,7 @@ h2v2\_merged\_upsample\_565\_internal(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION in\_row\_group\_ctr, |
|  |  | JSAMPARRAY output\_buf) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | register int y, cred, cgreen, cblue; |
|  |  | int cb, cr; |
|  |  | register JSAMPROW outptr0, outptr1; |
| Expand Down  Expand Up | | @@ -259,7 +259,7 @@ h2v2\_merged\_upsample\_565D\_internal(j\_decompress\_ptr cinfo, |
|  |  | JDIMENSION in\_row\_group\_ctr, |
|  |  | JSAMPARRAY output\_buf) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | register int y, cred, cgreen, cblue; |
|  |  | int cb, cr; |
|  |  | register JSAMPROW outptr0, outptr1; |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[jdmrgext.c](#diff-e01916ebd11b835df5a7e260fcc99624a6cbeac85540e5af81d93e41b8ec6998 "jdmrgext.c")

Show comments

[View file](/libjpeg-turbo/libjpeg-turbo/blob/9120a247436e84c0b4eea828cb11e8f665fcde30/jdmrgext.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | \* This file was part of the Independent JPEG Group's software: |
|  |  | \* Copyright (C) 1994-1996, Thomas G. Lane. |
|  |  | \* libjpeg-turbo Modifications: |
|  |  | \* Copyright (C) 2011, 2015, D. R. Commander. |
|  |  | \* Copyright (C) 2011, 2015, 2020, D. R. Commander. |
|  |  | \* For conditions of distribution and use, see the accompanying README.ijg |
|  |  | \* file. |
|  |  | \* |
| Expand All | | @@ -25,7 +25,7 @@ h2v1\_merged\_upsample\_internal(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION in\_row\_group\_ctr, |
|  |  | JSAMPARRAY output\_buf) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | register int y, cred, cgreen, cblue; |
|  |  | int cb, cr; |
|  |  | register JSAMPROW outptr; |
| Expand Down  Expand Up | | @@ -97,7 +97,7 @@ h2v2\_merged\_upsample\_internal(j\_decompress\_ptr cinfo, JSAMPIMAGE input\_buf, |
|  |  | JDIMENSION in\_row\_group\_ctr, |
|  |  | JSAMPARRAY output\_buf) |
|  |  | { |
|  |  | my\_upsample\_ptr upsample = (my\_upsample\_ptr)cinfo->upsample; |
|  |  | my\_merged\_upsample\_ptr upsample = (my\_merged\_upsample\_ptr)cinfo->upsample; |
|  |  | register int y, cred, cgreen, cblue; |
|  |  | int cb, cr; |
|  |  | register JSAMPROW outptr0, outptr1; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9120a24`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjpeg-turbo%2Flibjpeg-turbo%2Fcommit%2F9120a247436e84c0b4eea828cb11e8f665fcde30) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9350573d_20250119_123335.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjpeg-turbo%2Flibjpeg-turbo%2Fissues%2F441)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjpeg-turbo%2Flibjpeg-turbo%2Fissues%2F441)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libjpeg-turbo%2Flibjpeg-turbo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libjpeg-turbo](/libjpeg-turbo)
/
**[libjpeg-turbo](/libjpeg-turbo/libjpeg-turbo)**
Public

* [Notifications](/login?return_to=%2Flibjpeg-turbo%2Flibjpeg-turbo) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Flibjpeg-turbo%2Flibjpeg-turbo)
* [Star
   3.8k](/login?return_to=%2Flibjpeg-turbo%2Flibjpeg-turbo)

* [Code](/libjpeg-turbo/libjpeg-turbo)
* [Issues
  18](/libjpeg-turbo/libjpeg-turbo/issues)
* [Pull requests
  2](/libjpeg-turbo/libjpeg-turbo/pulls)
* [Discussions](/libjpeg-turbo/libjpeg-turbo/discussions)
* [Actions](/libjpeg-turbo/libjpeg-turbo/actions)
* [Projects
  0](/libjpeg-turbo/libjpeg-turbo/projects)
* [Security](/libjpeg-turbo/libjpeg-turbo/security)
* [Insights](/libjpeg-turbo/libjpeg-turbo/pulse)

Additional navigation options

* [Code](/libjpeg-turbo/libjpeg-turbo)
* [Issues](/libjpeg-turbo/libjpeg-turbo/issues)
* [Pull requests](/libjpeg-turbo/libjpeg-turbo/pulls)
* [Discussions](/libjpeg-turbo/libjpeg-turbo/discussions)
* [Actions](/libjpeg-turbo/libjpeg-turbo/actions)
* [Projects](/libjpeg-turbo/libjpeg-turbo/projects)
* [Security](/libjpeg-turbo/libjpeg-turbo/security)
* [Insights](/libjpeg-turbo/libjpeg-turbo/pulse)

# jcopy\_sample\_rows() causes SIGSEGV #441

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[jcopy\_sample\_rows() causes SIGSEGV](#top)#441Copy linkAssignees [![dcommander](https://avatars.githubusercontent.com/u/651941?s=64&u=2eb3f0d8b217946bfb7b43fb02676b1d8e817f5b&v=4)](/dcommander)Labels[bug](https://github.com/libjpeg-turbo/libjpeg-turbo/issues?q=state%3Aopen%20label%3A%22bug%22)[fixed](https://github.com/libjpeg-turbo/libjpeg-turbo/issues?q=state%3Aopen%20label%3A%22fixed%22)![@zodf0055980](https://avatars.githubusercontent.com/u/25863161?u=fe6ac8eae5f32e33804aebdc7cc0ac53a3a8d35a&v=4&size=80)
## Description

![@zodf0055980](https://avatars.githubusercontent.com/u/25863161?u=fe6ac8eae5f32e33804aebdc7cc0ac53a3a8d35a&v=4&size=48)[zodf0055980](https://github.com/zodf0055980)opened [on Jul 6, 2020](https://github.com/libjpeg-turbo/libjpeg-turbo/issues/441#issue-651322599)

**Have you searched the existing issues (both open and closed) in the libjpeg-turbo issue tracker to ensure that this bug report is not a duplicate?**

Yes

**Does this bug report describe one of the [two known and unsolvable issues with the JPEG format](https://libjpeg-turbo.org/pmwiki/uploads/About/TwoIssueswiththeJPEGStandard.pdf)?**

No

**Clear and concise description of the bug:**

jcopy\_sample\_rows try to read \*0x8 causes SIGSEGV

0x00007ffff7b7d48a in jcopy\_sample\_rows (input\_array=0x555555764728, source\_row=0x0, output\_array=0x8, dest\_row=0x0, num\_rows=0x1, num\_cols=0x60) at /home/yuan/libjpeg-turbo/jutils.c:112

112 outptr = \*output\_array++;

**Steps to reproduce the bug (using *only* libjpeg-turbo):**

in read\_and\_discard\_scanlines() , it calls jpeg\_read\_scanlines(cinfo, NULL, 1);

However NULL will be output array address in jcopy\_sample\_rows().

**Image(s) needed in order to reproduce the bug (if applicable):**

[![sample](https://user-images.githubusercontent.com/25863161/86568115-f7b82580-bf9e-11ea-95bf-a36bfd43e649.jpg)](https://user-images.githubusercontent.com/25863161/86568115-f7b82580-bf9e-11ea-95bf-a36bfd43e649.jpg)

**Expected behavior:**

**Observed behavior:**

```
./djpeg -fast -skip 1,20 -outfile ./outt ./sample.jpg

gdb-peda$ bt
#0  0x00007ffff7b7d48a in jcopy_sample_rows (input_array=0x555555764728, source_row=0x0, output_array=0x8, dest_row=0x0, num_rows=0x1, num_cols=0x60) at /home/yuan/libjpeg-turbo/jutils.c:112
#1  0x00007ffff7b61454 in merged_2v_upsample (cinfo=0x7fffffffd970, input_buf=0x555555766610, in_row_group_ctr=0x555555766664, in_row_groups_avail=0x8, output_buf=0x0, out_row_ctr=0x7fffffffd764,
    out_rows_avail=0x1) at /home/yuan/libjpeg-turbo/jdmerge.c:266
#2  0x00007ffff7b5b5a1 in process_data_simple_main (cinfo=0x7fffffffd970, output_buf=0x0, out_row_ctr=0x7fffffffd764, out_rows_avail=0x1) at /home/yuan/libjpeg-turbo/jdmainct.c:313
#3  0x00007ffff7b4dcc1 in jpeg_read_scanlines (cinfo=0x7fffffffd970, scanlines=0x0, max_lines=0x1) at /home/yuan/libjpeg-turbo/jdapistd.c:285
#4  0x00007ffff7b4ddfb in read_and_discard_scanlines (cinfo=0x7fffffffd970, num_lines=0x1) at /home/yuan/libjpeg-turbo/jdapistd.c:336
#5  0x00007ffff7b4dec9 in increment_simple_rowgroup_ctr (cinfo=0x7fffffffd970, rows=0x5) at /home/yuan/libjpeg-turbo/jdapistd.c:366
#6  0x00007ffff7b4e46d in jpeg_skip_scanlines (cinfo=0x7fffffffd970, num_lines=0x14) at /home/yuan/libjpeg-turbo/jdapistd.c:530
#7  0x0000555555557638 in main (argc=0x7, argv=0x7fffffffdcd8) at /home/yuan/libjpeg-turbo/djpeg.c:711
#8  0x00007ffff7754b97 in __libc_start_main (main=0x555555556f8c <main>, argc=0x7, argv=0x7fffffffdcd8, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, stack_end=0x7fffffffdcc8)
    at ../csu/libc-start.c:310
#9  0x0000555555555c6a in _start ()

```

**Platform(s) (compiler version, operating system version, CPU) on which the bug was observed:**

gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0 , Linux version 5.3.0-61-generic

**libjpeg-turbo release(s), commit(s), or branch(es) in which the bug was observed (always test the tip of the master branch or the latest [stable pre-release](https://libjpeg-turbo.org/DeveloperInfo/PreReleases) to verify that the bug hasn't already been fixed):**

commit [ae87a95](https://github.com/libjpeg-turbo/libjpeg-turbo/commit/ae87a958613b69628b92088b313ded0d4f59a716) in master

**If the bug is a regression, the specific commit that introduced the regression (use `git bisect` to determine this):**

**Additional information:**

## Metadata

### Assignees

* [![@dcommander](https://avatars.githubusercontent.com/u/651941?s=64&u=2eb3f0d8b217946bfb7b43fb02676b1d8e817f5b&v=4)dcommander](/dcommander)
### Labels

[bug](https://github.com/libjpeg-turbo/libjpeg-turbo/issues?q=state%3Aopen%20label%3A%22bug%22)[fixed](https://github.com/libjpeg-turbo/libjpeg-turbo/issues?q=state%3Aopen%20label%3A%22fixed%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


