=== Content from gitlab.com_1416114e_20250119_125842.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Add <a href=> into our name and bypass "//" being used in URL to create a valid URL + custom image on snippets

**[HackerOne report #460224](https://hackerone.com/reports/460224)** by zseano on 2018-12-11:

**Summary:** For some reason GitLab allow for certain HTML tags in our name which renders when we visit a snippet. Using this we can actually trick the user into visiting our URL when they click our username.

**Description:** When setting your name, using <a href=x> will render a valid link, except using <a href=[https://www.evilsite.com/>hi](https://www.evilsite.com/%3Ehi)</a> will not work. However if we use <a href=https:\evilsite.com>notsean</a>, it allows it through and we get this result. The use of `\` is important since `/` is filtered.

[![gitlab-href.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/a05885a674ef8e2f3c10f2ad07df1966d25db3f3/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f3436303232342f3338383533332f6769746c61622d687265662e706e67)

If a user is to click onto my name to visit my profile, they will actually be redirected to my site instead. To see it in action, visit `https://gitlab.com/snippets/1788795` and check out my comment from my account [@notsean](/notsean "<a href=http:\\evilsite.com>notsean <img src=\"https:\\www.bugbountynotes.com\assets\img\vip.png\" title=\"VIP User\"></a>"), hover over my profile and you'll see it redirects to evilsite.com

We can then be a bit more clever and add an image icon, add the "title" attribute, and we can build a perfect phisher to either harvest their credentials, OR redirect to a GitLab Oauth application and gain access via that (users are more likely to just click ALLOW, especially if they think they will get some VIP upgrade.. :D)

## Steps To Reproduce:

(Add details for how we can reproduce the issue)

1. Visit your GitLab account settings and set your name to `&lt;a href=http:\\evilsite.com&gt;notsean &lt;img src="https:\\www.bugbountynotes.com\assets\img\vip.png" title="VIP User"&gt;&lt;/a&gt;` - Replace notsean with your username to look real.
2. Go comment on a snippet and people will see a 'VIP' badge next to your name, hover over it will show 'VIP User', and clicking it will redirect to our site. The perfect scenario for an attacker! :)

[![gitlab-bugg.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/38051d9c1663727a7f72d394fc77aea42cbaf390/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f3436303232342f3338383534332f6769746c61622d627567672e706e67)

## Impact

Add custom HTML to our name and trick user into handing over their credentials or giving us access to their gitlab account via a rogue application designed to look like it will get them a "VIP" upgrade (this is jsut an example)

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [gitlab-bugg.png](https://h1.sec.gitlab.net/a/460224/388543/gitlab-bugg.png)
* [gitlab-href.png](https://h1.sec.gitlab.net/a/460224/388533/gitlab-href.png)

---

## Testing Activity

[@fjsanpedro](/fjsanpedro "Francisco Javier L籀pez (ex-Gitlab)")

* Test that the user name is rendering the html name but as text and not as html

## Security Testing Activity

[@vij](/vij "Vijay Hawoldar")

* Test that names are rendered safely

## MR Breakdown

[@fjsanpedro](/fjsanpedro "Francisco Javier L籀pez (ex-Gitlab)")

* In <https://gitlab.com/gitlab-org/gitlab/blob/master/app/views/shared/notes/_note.html.haml#L35> we call the method `sanitize` to clean the user name. Nevertheless, that method ends up calling `html_safe`. Therefore, if the `a` attribute is allowed, the user name will be rendered as html.

We can easily fix by replacing the method `sanitize` with `simple_sanitize`. Nevertheless, this method removes all html tags from the name. To be compliant with other parts of the platform, we shouldn't do this. In other features, we just render the user name without removing any data, just showing it as text instead of as HTML.

* The fix will pass by removing the call to `sanitize` in that line, and just show the user name directly as text.

[@vij](/vij "Vijay Hawoldar")

* The rendering of the user's name can be modified to not call html\_safe, which will fix the rendering of any existing malicious user names

Edited Jun 10, 2020 by [Darva Satcher](/dsatcher)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_b02f8337_20250119_125840.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2020](/gitlab-org/cves/-/tree/master/2020)
* [**CVE-2020-13321.json**](/gitlab-org/cves/-/blob/master/2020/CVE-2020-13321.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2020/CVE-2020-13321.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2020/CVE-2020-13321.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Sep 29, 2020

  [eb020aa6](/gitlab-org/cves/-/commit/eb020aa6bb1d9a8b09df04ba479a66097aa5b0f6)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/eb020aa6bb1d9a8b09df04ba479a66097aa5b0f6)
  繚
  eb020aa6

  [ GitLab Bot ](/gitlab-bot) authored Sep 29, 2020

  eb020aa6

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/eb020aa6bb1d9a8b09df04ba479a66097aa5b0f6)
  [ GitLab Bot ](/gitlab-bot) authored Sep 29, 2020

Loading


