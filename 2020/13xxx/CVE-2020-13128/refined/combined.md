=== Content from github.com_6b6cb900_20250119_125021.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanolo%2Fgwtupload%2Fissues%2F33)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanolo%2Fgwtupload%2Fissues%2F33)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=manolo%2Fgwtupload)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[manolo](/manolo)
/
**[gwtupload](/manolo/gwtupload)**
Public

* [Notifications](/login?return_to=%2Fmanolo%2Fgwtupload) You must be signed in to change notification settings
* [Fork
  62](/login?return_to=%2Fmanolo%2Fgwtupload)
* [Star
   49](/login?return_to=%2Fmanolo%2Fgwtupload)

* [Code](/manolo/gwtupload)
* [Issues
  20](/manolo/gwtupload/issues)
* [Pull requests
  3](/manolo/gwtupload/pulls)
* [Actions](/manolo/gwtupload/actions)
* [Projects
  0](/manolo/gwtupload/projects)
* [Wiki](/manolo/gwtupload/wiki)
* [Security](/manolo/gwtupload/security)
* [Insights](/manolo/gwtupload/pulse)

Additional navigation options

* [Code](/manolo/gwtupload)
* [Issues](/manolo/gwtupload/issues)
* [Pull requests](/manolo/gwtupload/pulls)
* [Actions](/manolo/gwtupload/actions)
* [Projects](/manolo/gwtupload/projects)
* [Wiki](/manolo/gwtupload/wiki)
* [Security](/manolo/gwtupload/security)
* [Insights](/manolo/gwtupload/pulse)

# Upload delay resulting in DoS #33

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkOpenOpen[Upload delay resulting in DoS](#top)#33Copy link![@mmmds](https://avatars.githubusercontent.com/u/4034742?v=4&size=80)
## Description

![@mmmds](https://avatars.githubusercontent.com/u/4034742?v=4&size=48)[mmmds](https://github.com/mmmds)opened [on Feb 17, 2020](https://github.com/manolo/gwtupload/issues/33#issue-566521167)

There is a vulnerability which allows to perform DoS attack against the application

server. The problem lies in handling `delay` parameter when upload is

initiated (`gwtupload.server.UploadServlet#parsePostRequest`). Value from

this parameter is used as an argument for `Thread.sleep` invocation.

Malicious user can specify even max integer value 2147483647, which

would cause a thread to sleep for almost 25 days

(`gwtupload.server.AbstractUploadListener#update`). Additionally, the

value from `delay` parameter is assigned the field which in case of

servlets behaves as a global variable. It means every further request

will use this value and also will be put to sleep. Putting a thread to

sleep excludes it from a limited set of available threads, so after a

suitable number of upload requests (Tomcat by default has limit of 200

threads) the whole application will become unresponsive and will not

accept any new requests.

<https://github.com/manolo/gwtupload/blob/master/core/src/main/java/gwtupload/server/UploadServlet.java>

```
protected String parsePostRequest(HttpServletRequest request, HttpServletResponse response) {

    try {
      String delay = request.getParameter(PARAM_DELAY);
      String maxFilesize = request.getParameter(PARAM_MAX_FILE_SIZE);
      maxSize = maxFilesize != null && maxFilesize.matches("[0-9]*") ? Long.parseLong(maxFilesize) : maxSize;
      uploadDelay = Integer.parseInt(delay);
    } catch (Exception e) { }
[...]
  protected AbstractUploadListener createNewListener(HttpServletRequest request) {
    int delay = request.getParameter("nodelay") != null ? 0 : uploadDelay;
    if (isAppEngine()) {
      return new MemoryUploadListener(delay, getContentLength(request));
    } else {
      return new UploadListener(delay, getContentLength(request));
    }
  }

```

<https://github.com/manolo/gwtupload/blob/master/core/src/main/java/gwtupload/server/AbstractUploadListener.java>

```
    // Just a way to slow down the upload process and see the progress bar in fast networks.
    if (slowUploads > 0 && done < total) {
      try {
        Thread.sleep(slowUploads);
      } catch (Exception e) {
        exception = new RuntimeException(e);
      }

```

The same way the servlet accepts `maxFileSize` parameter, but its abuse will only prevent from uploading files; the server won't suffer.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from logicaltrust.net_8bc0b863_20250119_125021.html ===

Menu

[![](/images/logo.svg)](/en/)

* [Home](/en/)
* [Services](/en/#services)
* [Blog](/blog.html)
* [About us](/about.html)
* [Contact](#contact)

* [**EN**](/en/)
* [PL](/)

# [EN] A-Z: GWTUpload - DoS

GWT is a Java web framework and GWTUpload is a library extending it with easier file upload.
We found a vulnerability allowing to abuse the upload process and cause a denial-of-service of a web application.

GWTUpload is used by adding the library to our GWT project and using its classes directly or by extending them. The class which is responsible for handling file upload request is [UploadServlet](https://github.com/manolo/gwtupload/blob/master/core/src/main/java/gwtupload/server/UploadServlet.java). There’s also [UploadAction](https://github.com/manolo/gwtupload/blob/master/core/src/main/java/gwtupload/server/UploadAction.java) which is built on top of `UploadServlet`, so both of them are interesting for us.

When the servlet receives a `POST` request it invokes a `parsePostRequest` method.

```
709:  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
710:    perThreadRequest.set(request);
711:    String error;
712:    try {
713:      error = parsePostRequest(request, response);
714:      Map<String, String> stat = new HashMap<String, String>();
715:      if (error != null && error.length() > 0 ) {
716:        stat.put(TAG_ERROR, error);
717:      } else {
718:        getFileItemsSummary(request, stat);
719:      }
720:      String postResponse = statusToString(stat);
721:      finish(request, postResponse);
722:      renderXmlResponse(request, response, postResponse, true);
```

According to the [JavaDoc](https://github.com/manolo/gwtupload/blob/master/core/src/main/java/gwtupload/server/UploadServlet.java#L904): `This method parses the submit action, puts in session a listener where the progress status is updated, and eventually stores the received data in the user session`. Seems unharmful.

GWTUpload uses [ServletFileUpload](https://commons.apache.org/proper/commons-fileupload/apidocs/org/apache/commons/fileupload/servlet/ServletFileUpload.html) from Apache Commons which is directly responsible for reading files from an HTTP request. It allows us to set a progress listener, an implementation of the (ProgressListener) interface, which is invoked during the upload to track its process, for example, to implement a dynamic progress bar.

```
904:  protected String parsePostRequest(HttpServletRequest request, HttpServletResponse response) {
[...]
930:    listener = createNewListener(request);
[...]
940:      ServletFileUpload uploader = new ServletFileUpload(factory);
941:      uploader.setSizeMax(maxSize);
942:      uploader.setFileSizeMax(maxFileSize);
943:      uploader.setProgressListener(listener);
944:
945:      // Receive the files
946:      logger.error("UPLOAD-SERVLET (" + session.getId() + ") parsing HTTP POST request ");
947:      uploadedItems = uploader.parseRequest(request);
```

We can notice that GWTUpload creates own listener. To be exact, `createNewListener` can create an instance of one of two classes, but both of them extend [AbstractUploadListener](https://github.com/manolo/gwtupload/blob/master/core/src/main/java/gwtupload/server/AbstractUploadListener.java).

So let’s see what this listener does when Apache’s `ServletFileUpload` updates progress status.

```
 37:  public abstract class AbstractUploadListener implements ProgressListener, Serializable {
[...]
175:    public void update(long done, long total, int item) {
[...]
196:      // Just a way to slow down the upload process and see the progress bar in fast networks.
197:      if (slowUploads > 0 && done < total) {
198:        try {
199:          Thread.sleep(slowUploads);
200:        } catch (Exception e) {
201:          exception = new RuntimeException(e);
202:        }
203:      }
204:    }
```

That’s weird. Usually, we want to process requests as fast as we can, but here we can intentionally slow it down by sleeping the thread whenever the update is invoked. The question that should arise now - who controls the `slowUploads`?

Its value is passed through the constructor.

```
37: public abstract class AbstractUploadListener implements ProgressListener, Serializable {
[...]
68:  public AbstractUploadListener(int sleepMilliseconds, long requestSize) {
69:    this();
70:    slowUploads = sleepMilliseconds;
```

But, if we look back at the `parsePostRequest` method and how listeners are created, we will notice…

```
626:  protected AbstractUploadListener createNewListener(HttpServletRequest request) {
627:    int delay = request.getParameter("nodelay") != null ? 0 : uploadDelay;
628:    if (isAppEngine()) {
629:      return new MemoryUploadListener(delay, getContentLength(request));
630:    } else {
631:      return new UploadListener(delay, getContentLength(request));
632:    }
633:  }
[...]
904:  protected String parsePostRequest(HttpServletRequest request, HttpServletResponse response) {
905:
906:    try {
907:      String delay = request.getParameter(PARAM_DELAY);
908:      String maxFilesize = request.getParameter(PARAM_MAX_FILE_SIZE);
909:      maxSize = maxFilesize != null && maxFilesize.matches("[0-9]*") ? Long.parseLong(maxFilesize) : maxSize;
910:      uploadDelay = Integer.parseInt(delay);
```

…that value for `uploadDelay` comes from the request.

So any user who is able to upload files can sleep its own upload thread for any time they want in the range between 0 and 2147483647 (`Integer.MAX`). So, any user can sleep one thread for almost 25 days (2147483647 milliseconds is equal to 596 hours).

Why is that a problem? Java servers do not have the unlimited capability of creating new threads. For example, Tomcat in [default configuration](https://tomcat.apache.org/tomcat-8.5-doc/config/http.html) allows to run up to 200 threads. When this limit is reached new threads cannot be created. If a thread is sleeping it also counts to this limit. So, as we can sleep the upload process, we take out one thread from the pool. What if we sent 200 requests? We would exhaust the server’s thread pool and no new (any, not only upload) requests will be accepted until sleep ends (reminder: 25 days). In effect, the server would not serve anymore.

But there’s one more interesting thing. `uploadDelay` is a field in the servlet. Values of fields in servlets are preserved between requests. So, a malicious user can send just one request with the delay value and it will be also applied to further requests, even those sent by other users (unless someone overwrites it).

The last thing to consider is the size of uploaded files, because if a file is too small `update` method won’t be executed at all. The buffer size is hardcoded in `MultipartStream` class in Apache Commons Fileupload

```
    protected static final int DEFAULT_BUFSIZE = 4096;
```

The whole upload request should have at least 4097 bytes.

## Demo

So let’s try to exploit it in some real application.
One of the publicly available (however, not developed anymore) web applications based on GWT and utilizing GWTUpload is [Hupa](http://james.apache.org/hupa/), which is part of Apache James project. According to the website:

```
Hupa is an Rich IMAP-based Webmail application written in GWT (Google Web Toolkit).

Hupa has been entirely written in java to be coherent with the language used in the James project. And It has been a reference of a devloping using GWT good practices (MVP pattern and Unit testing)

Hupa is a functional and well designed email client, ready for reading, sending and managing messages, but it still lacks of many features email clients nowadays have.
```

I downloaded and ran on my server the last available [build] hupa-0.0.5-SNAPSHOT.war. I went through the application to find the file upload functionality, then I tracked the specific request in Burp. I reused the URL and session cookie to build a malicious request that I had been repeating until the server stopped responding.

```
curl --data="@file.txt" "http://10.1.1.102:8080/hupa-0.0.5-SNAPSHOT/hupa/uploadAttachmentServlet?delay=2147483647"
```

Also, to confirm what happened, I generated a thread dump (with the command `kill -3 PID`) to be sure that all threads were sleeping.

## Who’s affected?

Every application utilizing GWTUpload to handle file uploads may be susceptible to the denial of service.

There are a lot of projects on GitHub including GWTUpload library. However, most of them seem to be amateur or abandoned projects.

## What now?

GWTUpload itself seems to be not developed anymore (the last commit is dated April 13, 2016). We tried to contact the developer using email address he left on his GitHub profile, however, we haven’t received any response. So we submitted the [issue](https://github.com/manolo/gwtupload/issues/33) publicly on the GitHub repository.

As we don’t expect the vulnerability to be fixed, we would like to show not so elegant solution that everyone can implement.

## Fix DIY

The idea is to modify the code so the `Thread.sleep` method won’t be executed. It can be done in many ways but it seems that the easiest one is to remove line 70 in AbstractUploadListener class, so that `slowUpload` will always have default `0` value and because of that threads won’t be ever put to sleep.

```
68:  public AbstractUploadListener(int sleepMilliseconds, long requestSize) {
69:    this();
70:    slowUploads = sleepMilliseconds;
```

If we use in our project GWTUpload source code, then the problem is already solved. It’s more problematic if we use jar and we don’t want to recompile the library. In this case, we need to do some bytecode modification.

There’s a tool called [Recaf](https://col-e.github.io/Recaf/) which is a Java bytecode editor. What we need to do:

1. Load the jar into the tool
2. Find constructor of AbstractUploadListener
3. Find bytecode corresponding to line 70.
4. Remove bytecode
5. Export jar and replace it in our project.

![](/images/gwt/gwt1.png)
![](/images/gwt/gwt2.png)

## Bonus

If you looked closely you could see a `PARAM_MAX_FILE_SIZE` parameter that is also truthfully processed by the library. It can be abused to prevent other users from uploading files but without hanging up the whole application. We’ll leave to the reader to find out the exact way. ;)

## Summary

Some vulnerabilities may exist in third party code which we do not control. However, the implications are the same as with the code we write ourselves. In the case of this library, any user with the possibility to upload files is able to completely neutralize our application. However, vulnerabilities in included third party code are not the only kind of problem. There is also a problem who is responsible for fixing such bugs. If a library is not supported anymore by developers we are left to our own devices. We can try to fix a vulnerability if it is simply as in that case, but when bugs are more complicated we may need to be forced to get rid of the vulnerable library.

Written on February 24, 2020 by
Michał Dardas

## We invite you to contact us

through the following form:

**I agree to the processing of my personal data and sending the offer.**
Rules for the processing of personal data.

send

LogicalTrust sp. z o.o.
sp. k.

Stanisławowska 47
54-611 Wrocław, Poland, EU

NIP: 8952177980
KRS: 0000713515

**T.: +48 797 772 743**

**office@logicaltrust.net**
Key:   [PGP/GPG](/logicaltrust.gpg)

![LogicalTrust](/images/logo.svg)

copyright © 2007 - 2024 LogicalTrust

We support:
![las na zawsze - logo](/images/foundationlogo-lasnazawsze_a.png)
![unicef - logo](/images/foundationlogo-unicef_a.png)

×
## Rules for the processing of personal data.

According to art. 13 of the General Regulation on the Protection of Personal Data of 27 April 2016 (Official Journal EU L 119 of 04.05.2016) I inform that:

* **Data Administrator:** The administrator of your personal data is Logicaltrust sp. z o.o. sp. k., with its registered office at ul. Stanisławowska 47, 54-611 Wrocław, Tax Identification Number (NIP): 8952177980, National Business Registry Number (REGON): 369271084, National Court Register Number (KRS): 0000713515.
* **Contact with the Data Administrator:** You can contact the data administrator via email at: ado@logicaltrust.net or by traditional mail by sending a letter to the administrator's registered office address.
* **Purpose and Legal Basis for Processing Personal Data:** Your personal data will be processed by the data administrator for the purpose of responding to your inquiries, executing requested contact, taking actions prior to entering into a contract, performing the contract, establishing business relationships, presenting offers upon potential client's request (based on Art. 6(1)(a), (b), and (f) of the General Data Protection Regulation).
* **Data Processing Period:** Your personal data will be processed for the time necessary to clarify your matter and provide a comprehensive response. They will also be processed for the duration of cooperation and the contract (in this case, the data is processed as client data). In the event of non-cooperation, the data will be promptly deleted unless there is a need for further retention for the purpose of defense and protection against claims. In cases where the processing of personal data is based on voluntarily given consent according to Art. 6(1)(a) of the General Data Protection Regulation, you have the right to withdraw your consent at any time. The withdrawal of consent does not affect the lawfulness of processing based on consent before its withdrawal, in accordance with the applicable law.
* **Scope of Processed Data:** The scope of processed data includes: first name, last name, email, and phone number.
* **Recipients of Personal Data:** In specific situations, your personal data may be disclosed, for example, to fulfill a legal obligation or to exercise legally justified interests pursued by the data administrator or by a third party. The categories of recipients to whom the data administrator may disclose your personal data are entities or authorities authorized by law and service providers processing personal data on behalf of the data administrator based on data processing agreements (e.g., hosting company).
* **Data Transfers:** Your personal data will not be transferred outside the European Economic Area.
* **Rights and Entitlements:** You have the right to request access to your personal data, their correction, deletion, or processing limitations, as well as the right to object to data processing. You also have the right to file a complaint with the President of the Personal Data Protection Office (ul. Stawki 2, 00-193 Warsaw) if you believe that the processing of personal data violates data protection regulations.
* **Additional Information:** Providing data is voluntary, but failure to provide data necessary for correspondence may hinder the execution and maintenance of contact.

×
## Cookie policy

* 1. **About cookies** - Cookies are small data files, especially text files, which are stored by a server on your computer. With these files, your device will be recognized and, in consequence, the way a given website is presented will be adjusted to your personal preferences. Cookies usually contain the name of the website from which they originate, information on how long they have been stored on the device and a unique number.
* 2. **Which type of cookies do we use** - Session cookies – temporary files which are stored on your device until you log out from a given website or close the Internet browser. Persistent cookies – permanent files that remain on your device for a fixed period (specified in the parameters of the file) or until they are deleted manually. Third-party cookies – files that adjust the way a given website is presented to your personal preferences.
* 3. **Why do we use cookies?** - Cookies are used for the purpose of statistics, marketing and in order to adjust the contents of websites to the user's personal preferences. Cookies store information about geolocation, the visitor's language and random data about session identifiers. With the collected data, we are able to understand how exactly the visitor uses websites and, consequently, to improve their structure and content. The information received helps us to prepare statistics related to the number of new and regular users as well as enables us to analyze which pages are visited.
* 4. **How to use and how to disable cookies** - You can change the settings of your Internet browser at any time, so that it would block cookies or inform you when they are being sent. However, please note that if you do not accept the cookie policy, you may encounter some problems while using the website. The software used for searching websites accepts the cookies by default. The settings of an Internet browser can be changed, so that it would block cookies or inform the user each time when cookies are being sent onto his/her device. For more information on how to disable automatic saving of cookies, please check the settings of your Internet browser (the software used for searching Internet websites).

This page uses cookies. Click here to learn more. Accept Reject


