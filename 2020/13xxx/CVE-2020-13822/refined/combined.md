=== Content from github.com_a793cf05_20250119_121404.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Findutny%2Felliptic%2Fissues%2F226)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Findutny%2Felliptic%2Fissues%2F226)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=indutny%2Felliptic)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[indutny](/indutny)
/
**[elliptic](/indutny/elliptic)**
Public

* [Notifications](/login?return_to=%2Findutny%2Felliptic) You must be signed in to change notification settings
* [Fork
  457](/login?return_to=%2Findutny%2Felliptic)
* [Star
   1.7k](/login?return_to=%2Findutny%2Felliptic)

* [Code](/indutny/elliptic)
* [Issues
  113](/indutny/elliptic/issues)
* [Pull requests
  29](/indutny/elliptic/pulls)
* [Actions](/indutny/elliptic/actions)
* [Projects
  0](/indutny/elliptic/projects)
* [Wiki](/indutny/elliptic/wiki)
* [Security](/indutny/elliptic/security)
* [Insights](/indutny/elliptic/pulse)

Additional navigation options

* [Code](/indutny/elliptic)
* [Issues](/indutny/elliptic/issues)
* [Pull requests](/indutny/elliptic/pulls)
* [Actions](/indutny/elliptic/actions)
* [Projects](/indutny/elliptic/projects)
* [Wiki](/indutny/elliptic/wiki)
* [Security](/indutny/elliptic/security)
* [Insights](/indutny/elliptic/pulse)

# Lack of encoding checks allows a certain degree of signature malleability in ECDSA signatures  #226

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Lack of encoding checks allows a certain degree of signature malleability in ECDSA signatures](#top) #226Copy link![@adelapie](https://avatars.githubusercontent.com/u/5389419?u=21537aef301daa3ad515b0fb38aed9d89a654897&v=4&size=80)
## Description

![@adelapie](https://avatars.githubusercontent.com/u/5389419?u=21537aef301daa3ad515b0fb38aed9d89a654897&v=4&size=48)[adelapie](https://github.com/adelapie)opened [on Jun 1, 2020](https://github.com/indutny/elliptic/issues/226#issue-628302319)

Hello,

Using elliptic 6.5.2 I've found that the ECDSA verification functionality validates signatures as 'true' when the encoding is incorrect i.e. it has been modified / altered against the standard, allowing a certain degree of malleability in the signatures. Based on the Google Wycheproof test vectors, the following changes on an ECDSA signature are not detected:

* "long form encoding of length of sequence",
* "length of sequence contains leading 0",
* "length of integer contains leading 0",
* "uint32 overflow in length of integer",
* "uint64 overflow in length of integer",
* "prepending 0's to integer",
* "long form encoding of length of integer"

See the proof of concept and test vectors below:

```

// ECDSA test

var crypto = require('crypto')
var EC = require('elliptic').ec;
var ec = new EC('secp256k1');

var obj = require("./poc_ecdsa_secp256k1_sha256_test.json");

for (let testGroup of obj.testGroups) {

    var key = ec.keyFromPublic(testGroup.key.uncompressed, 'hex');

    for(let test of testGroup.tests) {
     console.log("[*] Test " + test.tcId + " result: " + test.result)

     msgHash = crypto.createHash('sha256').update(Buffer.from(test.msg, 'hex')).digest();

     try {
      result = key.verify(msgHash, Buffer.from(test.sig, 'hex'));

     if (result == true) {
      if (test.result == "valid" || test.result == "acceptable")
       console.log("Result: PASS");
      else
       console.log("Result: FAIL")
     }

     if (result == false) {
      if (test.result == "valid" || test.result == "acceptable")
       console.log("Result: FAIL");
      else
       console.log("Result: PASS")
     }

     } catch (e) {
      console.log("ERROR - VERIFY: " + e)

      if (test.result == "valid" || test.result == "acceptable")
       console.log("Result: FAIL");
      else
       console.log("Result: PASS")

     }

    }

}

```

Test vectors:

```
{
  "algorithm" : "ECDSA",
  "generatorVersion" : "0.8r12",
  "numberOfTests" : 380,
  "header" : [
    "Test vectors of type EcdsaVerify are meant for the verification",
    "of ASN encoded ECDSA signatures."
  ],
  "notes" : {
    "BER" : "This is a signature with correct values for (r, s) but using some alternative BER encoding instead of DER encoding. Implementations should not accept such signatures to limit signature malleability.",
    "EdgeCase" : "Edge case values such as r=1 and s=0 can lead to forgeries if the ECDSA implementation does not check boundaries and computes s^(-1)==0.",
    "MissingZero" : "Some implementations of ECDSA and DSA incorrectly encode r and s by not including leading zeros in the ASN encoding of integers when necessary. Hence, some implementations (e.g. jdk) allow signatures with incorrect ASN encodings assuming that the signature is otherwise valid.",
    "PointDuplication" : "Some implementations of ECDSA do not handle duplication and points at infinity correctly. This is a test vector that has been specially crafted to check for such an omission."
  },
  "schema" : "ecdsa_verify_schema.json",
  "testGroups" : [
    {
      "key" : {
        "curve" : "secp256k1",
        "keySize" : 256,
        "type" : "EcPublicKey",
        "uncompressed" : "04b838ff44e5bc177bf21189d0766082fc9d843226887fc9760371100b7ee20a6ff0c9d75bfba7b31a6bca1974496eeb56de357071955d83c4b1badaa0b21832e9",
        "wx" : "00b838ff44e5bc177bf21189d0766082fc9d843226887fc9760371100b7ee20a6f",
        "wy" : "00f0c9d75bfba7b31a6bca1974496eeb56de357071955d83c4b1badaa0b21832e9"
      },
      "keyDer" : "3056301006072a8648ce3d020106052b8104000a03420004b838ff44e5bc177bf21189d0766082fc9d843226887fc9760371100b7ee20a6ff0c9d75bfba7b31a6bca1974496eeb56de357071955d83c4b1badaa0b21832e9",
      "keyPem" : "-----BEGIN PUBLIC KEY-----\nMFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEuDj/ROW8F3vyEYnQdmCC/J2EMiaIf8l2\nA3EQC37iCm/wyddb+6ezGmvKGXRJbutW3jVwcZVdg8Sxutqgshgy6Q==\n-----END PUBLIC KEY-----",
      "sha" : "SHA-256",
      "type" : "EcdsaVerify",
      "tests" : [
        {
          "tcId" : 4,
          "comment" : "long form encoding of length of sequence",
          "msg" : "313233343030",
          "sig" : "308145022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 5,
          "comment" : "length of sequence contains leading 0",
          "msg" : "313233343030",
          "sig" : "30820045022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 8,
          "comment" : "uint32 overflow in length of sequence",
          "msg" : "313233343030",
          "sig" : "30850100000045022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : []
        },
        {
          "tcId" : 9,
          "comment" : "uint64 overflow in length of sequence",
          "msg" : "313233343030",
          "sig" : "3089010000000000000045022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : []
        },
        {
          "tcId" : 68,
          "comment" : "long form encoding of length of integer",
          "msg" : "313233343030",
          "sig" : "304602812100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 69,
          "comment" : "long form encoding of length of integer",
          "msg" : "313233343030",
          "sig" : "3046022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc98323650281206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 70,
          "comment" : "length of integer contains leading 0",
          "msg" : "313233343030",
          "sig" : "30470282002100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 71,
          "comment" : "length of integer contains leading 0",
          "msg" : "313233343030",
          "sig" : "3047022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc9832365028200206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 76,
          "comment" : "uint32 overflow in length of integer",
          "msg" : "313233343030",
          "sig" : "304a0285010000002100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : []
        },
        {
          "tcId" : 77,
          "comment" : "uint32 overflow in length of integer",
          "msg" : "313233343030",
          "sig" : "304a022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc9832365028501000000206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : []
        },
        {
          "tcId" : 78,
          "comment" : "uint64 overflow in length of integer",
          "msg" : "313233343030",
          "sig" : "304e028901000000000000002100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : []
        },
        {
          "tcId" : 79,
          "comment" : "uint64 overflow in length of integer",
          "msg" : "313233343030",
          "sig" : "304e022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502890100000000000000206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : []
        },
        {
          "tcId" : 95,
          "comment" : "prepending 0's to integer",
          "msg" : "313233343030",
          "sig" : "30470223000000813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc983236502206ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        },
        {
          "tcId" : 96,
          "comment" : "prepending 0's to integer",
          "msg" : "313233343030",
          "sig" : "3047022100813ef79ccefa9a56f7ba805f0e478584fe5f0dd5f567bc09b5123ccbc9832365022200006ff18a52dcc0336f7af62400a6dd9b810732baf1ff758000d6f613a556eb31ba",
          "result" : "invalid",
          "flags" : [
            "BER"
          ]
        }
      ]
    }
  ]
}

```
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from yondon.blog_433624ae_20250119_121407.html ===

[Skip to content](#content)

[Learning Words](https://yondon.blog/)

Menu

* [Home](/)
* [About](https://yondon.blog/about/)
* [Newsletter](https://yondon.blog/newsletter/)
* [Work](https://yondon.blog/talks/)

# How Not to Use ECDSA

[yondonfu](https://yondon.blog/author/yondonfu/ "Posts by yondonfu")
[cryptography](https://yondon.blog/category/cryptography/)
January 1, 2019January 2, 2019
6 Minutes

For many developers, digital signatures (and most cryptographic primitives for that matter) are black boxes that “just work”. Developers can usually expect to be able to leverage open source implementations for signature generation and verification either in a programming language’s [standard library](https://golang.org/pkg/crypto/ecdsa/) or in a [third party library](https://github.com/indutny/elliptic/). Oftentimes, all it takes is a quick skim through the API documentation and within minutes a developers can drop signature generation and verification into their systems.

While easier to use digital signatures can be a blessing, it is not necessarily always the case that digital signatures are easy to *securely*use. Furthermore, not all documentation is created equal and in some cases documentation might lack the proper guidance to ensure developers can use digital signatures in a secure manner. As a result, understanding how digital signatures can be incorrectly used is valuable knowledge for developers.

In this post, we will explore incorrect usage of the Elliptic Curve Digital Signature Algorithm (ECDSA). If you are unfamiliar with ECDSA, Andrea Corbellini has written a great introductory [primer](https://andrea.corbellini.name/2015/05/30/elliptic-curve-cryptography-ecdh-and-ecdsa/).

### Pitfall #1: Signature Malleability

Recall that a ECDSA signature ![(r, s)](https://s0.wp.com/latex.php?latex=%28r%2C+s%29&bg=ffffff&fg=000000&s=0&c=20201002) is valid for a public key ![H](https://s0.wp.com/latex.php?latex=H&bg=ffffff&fg=000000&s=0&c=20201002) and hash ![z](https://s0.wp.com/latex.php?latex=z&bg=ffffff&fg=000000&s=0&c=20201002) if ![r](https://s0.wp.com/latex.php?latex=r&bg=ffffff&fg=000000&s=0&c=20201002) is the x coordinate of the following point calculated by the verifier:

![P = s^{-1}zG + s^{-1}rH](https://s0.wp.com/latex.php?latex=P+%3D+s%5E%7B-1%7DzG+%2B+s%5E%7B-1%7DrH&bg=ffffff&fg=000000&s=0&c=20201002)

Notice that signature verification will pass as long as ![r](https://s0.wp.com/latex.php?latex=r&bg=ffffff&fg=000000&s=0&c=20201002) is correct – ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) is used in the calculation of point ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002), but as long as the x coordinate of ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002) is equal to ![r](https://s0.wp.com/latex.php?latex=r&bg=ffffff&fg=000000&s=0&c=20201002), the actual value for ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) does not matter. Thus, if there is more than one value for ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) that can result in a point ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002) with an x coordinate equal to ![r](https://s0.wp.com/latex.php?latex=r&bg=ffffff&fg=000000&s=0&c=20201002) then there can be more than one valid signature for a given public key and hash. In fact, since ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002) is a point on an elliptic curve, there is also a point ![-P](https://s0.wp.com/latex.php?latex=-P&bg=ffffff&fg=000000&s=0&c=20201002) on the curve with the same x coordinate as ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002), but a negated y coordinate [1]. Since ![P = kG](https://s0.wp.com/latex.php?latex=P+%3D+kG&bg=ffffff&fg=000000&s=0&c=20201002) [7] and ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) is an input into the calculation of ![k](https://s0.wp.com/latex.php?latex=k&bg=ffffff&fg=000000&s=0&c=20201002), a negated ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) results in ![-P](https://s0.wp.com/latex.php?latex=-P&bg=ffffff&fg=000000&s=0&c=20201002) which has the same x coordinate as ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002). As a result, both ![(r, s)](https://s0.wp.com/latex.php?latex=%28r%2C+s%29&bg=ffffff&fg=000000&s=0&c=20201002) and ![(r, -s \mod n)](https://s0.wp.com/latex.php?latex=%28r%2C+-s+%5Cmod+n%29&bg=ffffff&fg=000000&s=0&c=20201002) are valid signatures for the public key ![H](https://s0.wp.com/latex.php?latex=H&bg=ffffff&fg=000000&s=0&c=20201002) and hash ![z](https://s0.wp.com/latex.php?latex=z&bg=ffffff&fg=000000&s=0&c=20201002). We refer to ![(r, s)](https://s0.wp.com/latex.php?latex=%28r%2C+s%29&bg=ffffff&fg=000000&s=0&c=20201002) as a “malleable” signature because a third party can use it to compute another valid signature for a public key and hash without access to the signing private key.

This malleability property of ECDSA signatures can introduce security vulnerabilities into systems if:

* Replay defense mechanisms use the signatures themselves as unique identifiers (i.e. a verifier should only allow a signature to be used once).
* Software relies on signatures as identifiers to query for additional information. See Bitcoin transaction malleability [2].

### Avoiding Pitfall #1

One solution to defend against signature malleability based attacks is to enforce a single canonical signature for a given public key and hash which is the approach taken by Bitcoin. More specifically, the Bitcoin core client software will only accept “low s-value” ECDSA signatures where a signature has a low s-value if ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) is less or equal to half the curve order [3]. The secp256k1 curve library used by the client will always generate signatures in low s-value form and the verifier expects provided signatures to also be in low s-value form [4].

Another solution is to avoid using signatures in identifiers or at the very least making sure to use unique values in the identifier creation process i.e. a nonce in the signed message. Unless there is a single canonical signature for a given public key and hash, signatures cannot be relied upon as unique identifiers.

### Example Code for Pitfall #1

Example code for creating malleable signatures can be found [here](https://github.com/yondonfu/how-not-to-use-ecdsa/blob/master/main.go#L17).

The program first generates the original signature and then **TrickSig1()** is used to create another valid signature. In the first attempt, the signature generated by **TrickSig1()** passes verification. However, in the second attempt, the ECDSA verification implementation from [go-ethereum is used which implements the low s-value requirement](https://github.com/ethereum/go-ethereum/blob/master/crypto/signature_nocgo.go#L91) thus causing verification to fail.

```
 original sig: (0xe742ff452d41413616a5bf43fe15dd88294e983d3d36206c2712f39083d638bd, 0xe0a0fc89be718fbc1033e1d30d78be1c68081562ed2e97af876f286f3453231d)
 original sig verification with message hash 0xb94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9: SUCCESS

 trick sig 1: (0xe742ff452d41413616a5bf43fe15dd88294e983d3d36206c2712f39083d638bd, 0x1f5f0376418e7043efcc1e2cf28741e252a6c783c21a088c3863361d9be31e24)
 NO MALLEABILITY CHECK
 trick sig 1 verification with message hash 0xb94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9: SUCCESS

 WITH MALLEABILITY CHECK
 HALF CURVE ORDER = 7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0
 trick sig 1 s-value <= half curve order!
 normalizing sig by negating s-value
 trick sig 1 verification with message hash 0xb94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9: FAILED
```
### Pitfall #2: Verification Without Hash Pre-Image

Many ECDSA verification implementations [expect the hash of the signed message as input](https://golang.org/pkg/crypto/ecdsa/#Verify), but the the verifier should always be the one to hash the message and should never accept a hash without knowledge of its pre-image [5]. Otherwise, an attacker is able to pick the hash that will used for verification. If the attacker does not need to know the pre-image of the hash, he/she can pick a hash that he/she can always produce valid signatures for [6].

The point ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002) calculated during verification can be expressed as ![P = aG + bH](https://s0.wp.com/latex.php?latex=P+%3D+aG+%2B+bH&bg=ffffff&fg=000000&s=0&c=20201002) where ![a = s^{-1}z](https://s0.wp.com/latex.php?latex=a+%3D+s%5E%7B-1%7Dz&bg=ffffff&fg=000000&s=0&c=20201002) and ![b = s^{-1}r](https://s0.wp.com/latex.php?latex=b+%3D+s%5E%7B-1%7Dr&bg=ffffff&fg=000000&s=0&c=20201002).

We can express ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002) in terms of ![b](https://s0.wp.com/latex.php?latex=b&bg=ffffff&fg=000000&s=0&c=20201002) and ![P](https://s0.wp.com/latex.php?latex=P&bg=ffffff&fg=000000&s=0&c=20201002):

![s = b^{-1}r = b^{-1}P_{x}](https://s0.wp.com/latex.php?latex=s+%3D+b%5E%7B-1%7Dr+%3D+b%5E%7B-1%7DP_%7Bx%7D&bg=ffffff&fg=000000&s=0&c=20201002)

We can express ![z](https://s0.wp.com/latex.php?latex=z&bg=ffffff&fg=000000&s=0&c=20201002) in terms of ![a](https://s0.wp.com/latex.php?latex=a&bg=ffffff&fg=000000&s=0&c=20201002), ![b](https://s0.wp.com/latex.php?latex=b&bg=ffffff&fg=000000&s=0&c=20201002) and ![s](https://s0.wp.com/latex.php?latex=s&bg=ffffff&fg=000000&s=0&c=20201002):

![z = as = ab^{-1}r = ab^{-1}P_{x}](https://s0.wp.com/latex.php?latex=z+%3D+as+%3D+ab%5E%7B-1%7Dr+%3D+ab%5E%7B-1%7DP_%7Bx%7D&bg=ffffff&fg=000000&s=0&c=20201002)

We can express a valid signature ![(r, s)](https://s0.wp.com/latex.php?latex=%28r%2C+s%29&bg=ffffff&fg=000000&s=0&c=20201002) as:

![(r, s) = (P_{x}, P_{x}b^{-1})](https://s0.wp.com/latex.php?latex=%28r%2C+s%29+%3D+%28P_%7Bx%7D%2C+P_%7Bx%7Db%5E%7B-1%7D%29&bg=ffffff&fg=000000&s=0&c=20201002)

Thus, if an attacker has the freedom to choose the value for hash ![z](https://s0.wp.com/latex.php?latex=z&bg=ffffff&fg=000000&s=0&c=20201002), then it can set ![a](https://s0.wp.com/latex.php?latex=a&bg=ffffff&fg=000000&s=0&c=20201002) and ![b](https://s0.wp.com/latex.php?latex=b&bg=ffffff&fg=000000&s=0&c=20201002) to arbitrary non-zero values and then derive values for hash ![z](https://s0.wp.com/latex.php?latex=z&bg=ffffff&fg=000000&s=0&c=20201002) and signature ![(r, s)](https://s0.wp.com/latex.php?latex=%28r%2C+s%29&bg=ffffff&fg=000000&s=0&c=20201002) that would always pass verification for a public key ![H](https://s0.wp.com/latex.php?latex=H&bg=ffffff&fg=000000&s=0&c=20201002).

### Avoiding Pitfall #2

The solution to defend against this type of attack is to implement verifiers to always use the result of hashing a received message (that another party is claiming to have signed) for ECDSA verification.

### Example Code for Pitfall #2

Example code for exploiting ECDSA verifiers that do not know the pre-image of a hash can be found [here](https://github.com/yondonfu/how-not-to-use-ecdsa/blob/master/main.go#L34).

The program uses **TrickSig2()** to create a valid signature and hash pair given a public key. The verifier just accepts the hash so it has no knowledge of the pre-image (in contrast to if the verifier instead hashed the input before running the verification algorithm).

```
 trick sig 2: (0x41b5201d06acaafb67785a8e8aa89626e79c2117acce468196c1c5074ec9c274, 0x4f28c5a75abedce19cacba086282632f175abb635bd633465f6763a250eea629)
 trick sig 2 verification with message hash 0x8bcbdc44c5ba50680f5fa229ec8befecba16cc0a1be660241d32939ec472fd8c: SUCCESS
```
### Conclusion

Both of the described pitfalls are examples of instances where a developer that has access to an easy to use cryptographic primitive library (both code examples import widely used open source implementations either from a standard or third party library) could still incorrectly use the library thereby losing some of the security properties of the primitive. Especially when creating systems that require cryptographic guarantees, developers stand to benefit a lot from not only a larger breadth of tools, but also a better understanding of what correct (or incorrect) usage of those tools looks like.

### References

[1] <https://crypto.stackexchange.com/questions/54416/how-to-compute-negative-point-in-ec-dsa>

[2] <https://eklitzke.org/bitcoin-transaction-malleability>

[3] <https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki>

[4] <https://github.com/bitcoin-core/secp256k1/blob/master/include/secp256k1.h>

[5] <https://twitter.com/pwuille/status/1063582706288586752>

[6] [https://medium.com/@jimmysong/faketoshis-nonsense-signature-8700a44536b5](https://medium.com/%40jimmysong/faketoshis-nonsense-signature-8700a44536b5)

[7] <https://andrea.corbellini.name/2015/05/30/elliptic-curve-cryptography-ecdh-and-ecdsa/>

### Share this:

* [Twitter](https://yondon.blog/2019/01/01/how-not-to-use-ecdsa/?share=twitter "Click to share on Twitter")
* [Facebook](https://yondon.blog/2019/01/01/how-not-to-use-ecdsa/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

* Tagged
* [cryptography](https://yondon.blog/tag/cryptography/)

![](https://0.gravatar.com/avatar/0db64f6261739ae2505a9403b35a7e55334bd9d07bff7a9d7bab9dd12913dbb5?s=80&d=identicon&r=G)
## Published by yondonfu

[View all posts by yondonfu](https://yondon.blog/author/yondonfu/)

**Published**
January 1, 2019January 2, 2019

## Post navigation

[Next Post U2F/True2F Cryptographic Protocols Under the Hood](https://yondon.blog/2019/01/21/u2f-true2f-cryptographic-protocols-under-the-hood/)

## 5 thoughts on “How Not to Use ECDSA”

1. Pingback: [U2F/True2F Cryptographic Protocols Under the Hood – Learning Words](https://yondon.blog/2019/01/21/u2f-true2f-cryptographic-protocols-under-the-hood/)
3. Pingback: [PROPS Token Contracts Audit – OpenZeppelin blog](https://blog.openzeppelin.com/props-token-contracts-audit-2/)
5. Pingback: [Zwei ziemlich esoterische Bugs in Lightning-Software LND – BitcoinBlog.de – das Blog für Bitcoin und andere virtuelle Währungen](http://bitcoinblog.de/2020/10/23/zwei-ziemlich-esoterische-bugs-in-lightning-software-lnd/)
7. Pingback: [Designing a duress PIN: covert channels for SSH (part V) – Random Oracle](https://randomoracle.wordpress.com/2021/07/05/designing-a-duress-pin-covert-channels-for-ssh-part-v/)
9. Pingback: [Two fairly puzzling bugs in Lightning software LND](https://cryptonoyz.com/two-fairly-puzzling-bugs-in-lightning-software-lnd/)

### Leave a comment [Cancel reply](/2019/01/01/how-not-to-use-ecdsa/#respond)

Δ

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* [Comment](https://yondon.blog/2019/01/01/how-not-to-use-ecdsa/#comments)
* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Learning Words](https://yondon.blog)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fyondon.blog%252F2019%252F01%252F01%252Fhow-not-to-use-ecdsa%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Learning Words](https://yondon.blog)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fyondon.blog%252F2019%252F01%252F01%252Fhow-not-to-use-ecdsa%252F)
  + [Copy shortlink](https://wp.me/paxzOZ-M)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://yondon.blog/2019/01/01/how-not-to-use-ecdsa/)
  + [View post in Reader](https://wordpress.com/read/blogs/155765885/posts/48)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

%d

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from www.npmjs.com_ae7c4f4e_20250119_121407.html ===

skip to:[content](#main)[package search](#search)[sign in](#signin)â¤

* [Pro](/products/pro)
* [Teams](/products/teams)
* [Pricing](/products)
* [Documentation](https://docs.npmjs.com)
npmSearch[Sign Up](/signup)[Sign In](/login)
## elliptic[DefinitelyTyped icon, indicating that this package has TypeScript declarations provided by the separate @types/elliptic package](/package/%40types/elliptic)

6.6.1Â â¢Â PublicÂ â¢Â Published 2 months ago

* [Readme](?activeTab=readme)
* [Code Beta](?activeTab=code)
* [7 Dependencies](?activeTab=dependencies)
* [3,038 Dependents](?activeTab=dependents)
* [86 Versions](?activeTab=versions)

# Elliptic [Build Status](http://travis-ci.org/indutny/elliptic) [Coverage Status](https://coveralls.io/github/indutny/elliptic?branch=master) [Code Climate](https://codeclimate.com/github/indutny/elliptic)

[![Saucelabs Test Status](https://camo.githubusercontent.com/1d92dcd81ff2e7e605a90b6792c0202b1ce36a618e85045e78acfa552035acee/68747470733a2f2f73617563656c6162732e636f6d2f62726f777365722d6d61747269782f67682d696e6475746e792d656c6c69707469632e737667)](https://saucelabs.com/u/gh-indutny-elliptic)

Fast elliptic-curve cryptography in a plain javascript implementation.

NOTE: Please take a look at <http://safecurves.cr.yp.to/> before choosing a curve
for your cryptography operations.

## Incentive

ECC is much slower than regular RSA cryptography, the JS implementations are
even more slower.

## Benchmarks

```
$ node benchmarks/index.js
Benchmarking: sign
elliptic#sign x 262 ops/sec Â±0.51% (177 runs sampled)
eccjs#sign x 55.91 ops/sec Â±0.90% (144 runs sampled)
------------------------
Fastest is elliptic#sign
========================
Benchmarking: verify
elliptic#verify x 113 ops/sec Â±0.50% (166 runs sampled)
eccjs#verify x 48.56 ops/sec Â±0.36% (125 runs sampled)
------------------------
Fastest is elliptic#verify
========================
Benchmarking: gen
elliptic#gen x 294 ops/sec Â±0.43% (176 runs sampled)
eccjs#gen x 62.25 ops/sec Â±0.63% (129 runs sampled)
------------------------
Fastest is elliptic#gen
========================
Benchmarking: ecdh
elliptic#ecdh x 136 ops/sec Â±0.85% (156 runs sampled)
------------------------
Fastest is elliptic#ecdh
========================
```

## API

### ECDSA

```
var EC = require('elliptic').ec;

// Create and initialize EC context
// (better do it once and reuse it)
var ec = new EC('secp256k1');

// Generate keys
var key = ec.genKeyPair();

// Sign the message's hash (input must be an array, or a hex-string)
var msgHash = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ];
var signature = key.sign(msgHash);

// Export DER encoded signature in Array
var derSign = signature.toDER();

// Verify signature
console.log(key.verify(msgHash, derSign));

// CHECK WITH NO PRIVATE KEY

var pubPoint = key.getPublic();
var x = pubPoint.getX();
var y = pubPoint.getY();

// Public Key MUST be either:
// 1) '04' + hex string of x + hex string of y; or
// 2) object with two hex string properties (x and y); or
// 3) object with two buffer properties (x and y)
var pub = pubPoint.encode('hex');                                 // case 1
var pub = { x: x.toString('hex'), y: y.toString('hex') };         // case 2
var pub = { x: x.toBuffer(), y: y.toBuffer() };                   // case 3
var pub = { x: x.toArrayLike(Buffer), y: y.toArrayLike(Buffer) }; // case 3

// Import public key
var key = ec.keyFromPublic(pub, 'hex');

// Signature MUST be either:
// 1) DER-encoded signature as hex-string; or
// 2) DER-encoded signature as buffer; or
// 3) object with two hex-string properties (r and s); or
// 4) object with two buffer properties (r and s)

var signature = '3046022100...'; // case 1
var signature = new Buffer('...'); // case 2
var signature = { r: 'b1fc...', s: '9c42...' }; // case 3

// Verify signature
console.log(key.verify(msgHash, signature));
```

### EdDSA

```
var EdDSA = require('elliptic').eddsa;

// Create and initialize EdDSA context
// (better do it once and reuse it)
var ec = new EdDSA('ed25519');

// Create key pair from secret
var key = ec.keyFromSecret('693e3c...'); // hex string, array or Buffer

// Sign the message's hash (input must be an array, or a hex-string)
var msgHash = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ];
var signature = key.sign(msgHash).toHex();

// Verify signature
console.log(key.verify(msgHash, signature));

// CHECK WITH NO PRIVATE KEY

// Import public key
var pub = '0a1af638...';
var key = ec.keyFromPublic(pub, 'hex');

// Verify signature
var signature = '70bed1...';
console.log(key.verify(msgHash, signature));
```

### ECDH

```
var EC = require('elliptic').ec;
var ec = new EC('curve25519');

// Generate keys
var key1 = ec.genKeyPair();
var key2 = ec.genKeyPair();

var shared1 = key1.derive(key2.getPublic());
var shared2 = key2.derive(key1.getPublic());

console.log('Both shared secrets are BN instances');
console.log(shared1.toString(16));
console.log(shared2.toString(16));
```

three and more members:

```
var EC = require('elliptic').ec;
var ec = new EC('curve25519');

var A = ec.genKeyPair();
var B = ec.genKeyPair();
var C = ec.genKeyPair();

var AB = A.getPublic().mul(B.getPrivate())
var BC = B.getPublic().mul(C.getPrivate())
var CA = C.getPublic().mul(A.getPrivate())

var ABC = AB.mul(C.getPrivate())
var BCA = BC.mul(A.getPrivate())
var CAB = CA.mul(B.getPrivate())

console.log(ABC.getX().toString(16))
console.log(BCA.getX().toString(16))
console.log(CAB.getX().toString(16))
```

NOTE: `.derive()` returns a [BN](https://github.com/indutny/bn.js) instance.

## Supported curves

Elliptic.js support following curve types:

* Short Weierstrass
* Montgomery
* Edwards
* Twisted Edwards

Following curve 'presets' are embedded into the library:

* `secp256k1`
* `p192`
* `p224`
* `p256`
* `p384`
* `p521`
* `curve25519`
* `ed25519`

NOTE: That `curve25519` could not be used for ECDSA, use `ed25519` instead.

### Implementation details

ECDSA is using deterministic `k` value generation as per [RFC6979](http://tools.ietf.org/html/rfc6979). Most of
the curve operations are performed on non-affine coordinates (either projective
or extended), various windowing techniques are used for different cases.

All operations are performed in reduction context using [bn.js](https://github.com/indutny/bn.js), hashing is
provided by [hash.js](https://github.com/indutny/hash.js)

### Related projects

* [eccrypto](https://github.com/bitchan/eccrypto): isomorphic implementation of ECDSA, ECDH and ECIES for both
  browserify and node (uses `elliptic` for browser and [secp256k1-node](https://github.com/wanderer/secp256k1-node) for
  node)

#### LICENSE

This software is licensed under the MIT License.

Copyright Fedor Indutny, 2014.

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to permit
persons to whom the Software is furnished to do so, subject to the
following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
USE OR OTHER DEALINGS IN THE SOFTWARE.

## Readme

### Keywords

* [EC](/search?q=keywords:EC)
* [Elliptic](/search?q=keywords:Elliptic)
* [curve](/search?q=keywords:curve)
* [Cryptography](/search?q=keywords:Cryptography)
## Package Sidebar

### Install

`npm i elliptic`

### Repository

[Gitgithub.com/indutny/elliptic](https://github.com/indutny/elliptic)

### Homepage

[github.com/indutny/elliptic](https://github.com/indutny/elliptic)

### DownloadsWeekly Downloads

10,800,405

### Version

6.6.1

### License

MIT

### Unpacked Size

120 kB

### Total Files

17

### Last publish

2 months ago

### Collaborators

* [![indutny](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8yOTNmYjA2ZjE3YmJkNDVhNzBhOTJlMDg3MDJjNTY4Nj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.kOOImjVEG-lLcTSmMLM2KWYSmb7tHacsEVGnt7Fq35M "indutny")](/~indutny)
[**Try** on RunKit](https://runkit.com/npm/elliptic)[**Report** malware](/support?inquire=security&security-inquire=malware&package=elliptic&version=6.6.1)
## Footer

### Support

* [Help](https://docs.npmjs.com)
* [Advisories](https://github.com/advisories)
* [Status](http://status.npmjs.org/)
* [Contact npm](/support)
### Company

* [About](/about)
* [Blog](https://github.blog/tag/npm/)
* [Press](/press)
### Terms & Policies

* [Policies](/policies/)
* [Terms of Use](/policies/terms)
* [Code of Conduct](/policies/conduct)
* [Privacy](/policies/privacy)



=== Content from medium.com_a829fbb7_20250119_121405.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7b5f59fb99a4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fherman-10687.medium.com%2Fmalleability-attack-why-it-matters-7b5f59fb99a4&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fherman-10687.medium.com%2Fmalleability-attack-why-it-matters-7b5f59fb99a4&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Malleability-Attack: Why It Matters

[![Herman Schoenfeld](https://miro.medium.com/v2/resize:fill:88:88/1*VnA9-kv1HDK9v4XgOJ0Cdw.jpeg)](/?source=post_page---byline--7b5f59fb99a4--------------------------------)

[Herman Schoenfeld](/?source=post_page---byline--7b5f59fb99a4--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F18887b5dd51d&operation=register&redirect=https%3A%2F%2Fherman-10687.medium.com%2Fmalleability-attack-why-it-matters-7b5f59fb99a4&user=Herman+Schoenfeld&userId=18887b5dd51d&source=post_page-18887b5dd51d--byline--7b5f59fb99a4---------------------post_header-----------)

4 min read·Apr 6, 2019

--

5

Listen

Share

[Read Original Article](https://sphere10.com/articles/blockchain/security/malleability-attack-why-it-matters)

Many in the crypto-sphere have heard of “transaction malleability” and that it’s “bad”. But, what is “transaction malleability” and why is it bad? Let’s dive into it quickly.

[Fingers hurt from clicking all day? Try Auto Mouse.](https://sphere10.com/products/automouse)

[Want to use Notion as a CMS for your website? Try Local Notion.](https://sphere10.com/products/localnotion)

In a cryptocurrency such as Bitcoin, transactions are the atomic operations that transfer value between users. Users create transactions and publish them to the network. Those transactions propagate the network and are eventually mined into the blockchain. The blockchain is used by the recipients to determine if a transaction is confirmed or not.

Now, with millions of transactions flying around, how do users quickly identify them so as to be able to distinguish between them? How can a bunch of disconnected users across the globe quickly and uniquely identify transactions in the same way but without using some slow, global registry system? The answer is simple, you use the cryptographic hash of the transaction as the identifier.

> A cryptographic hash allows anyone to derive a fingerprint of any data using only the data itself. The fingerprint is unique and the same every time it is calculated. Even if you change 1 bit of the data, the fingerprint hash is completely changed.

In Bitcoin, the hash of a transaction is called its TXID, and serves as the universally unique identifier for that transaction.

Great, so what is malleability?

## Transaction Malleability

Malleability is the ability to change the identifier of a transaction (the TXID) but without invalidating that transaction. Depending on the cryptocurrency, there are many ways this can be done. A common way across all cryptocurrencies is through [**signature malleability**](https://en.bitcoin.it/wiki/Transaction_malleability#Signature_Malleability), which is the focus of this article.

Due to how the math of how ECDSA digital signatures work, it’s possible to change a signature but without invalidating it. Whilst this doesn’t permit forgeries of those signatures, it does permit an attacker to alter the TXID of a transaction containing those signatures, and this can lead to severe consequences.

## Malleability-Attack

Suppose Bob pays Alice some Bitcoin via a transaction with identifier X. Suppose that before being mined, X is malleated to have a new identifier X’. Alice received the payment, but Bob doesn’t know. Since Alice knows Bob doesn’t know, she tricks Bob into re-issuing the payment again. She repeats this until Bob eventually realizes what’s going on, but it could be too late. In the real-world, this attack has been performed on exchanges as follows:

![]()

In this scenario, an attacker:
1. Spins up a bunch of Sybil nodes (red)
2. Surrounds an exchange node (yellow) with his Sybil nodes.
3. Performs a withdrawal from the exchange.
4. As soon as the withdrawal X leaves the exchange, the Sybil nodes malleate the withdrawal into X’.
5. The malleated X’ is propagated to the rest of the network.

When X’ is mined into the next block, the attacker has received the withdrawal X’ but the exchanges back-end hasn’t acknowledged receipt of the withdrawal since it’s looking for X in the blockchain. Knowing this, the attacker proceeds to:

6. Ask the exchange to repeat the withdrawal, since it “hasn’t gone through”.
7. Rinse & repeat.

Depending on the size of the exchange, the attacker can employ a “parasite strategy” whereby the exchange is drained with small withdrawals and infrequently. This allows the attacker to fly under the radar to maximize their long-term heist. Alternatively, an attacker can employ a “vampire strategy” whereby the exchange is drained with high-frequency large withdrawals before system administrators can respond.

Whatever the strategy, it’s a problem and cryptocurrency designers need to address the malleability issue.

**NOTE:** In practice for step (2), the attacker doesn’t need to fully surround the exchange node. Only a few connections are required to perform the attack, albeit with lower probability of success. The more surrounded, the higher the probability.

# Solving Malleability

Bitcoin (BTC) has “solved” malleability with the introduction of Segwit which segregates the signature from the TXID calculation and replaces it with a non-malleable hash commitment to that signature. This hash serves as a pointer to the signature which is stored in another data-structure. In order to verify the transaction signature, the verifier uses the hash to lookup the signature in the other data-structure, and then performs the usual ECDSA verification. This eliminates signatures as source of malleability from the transaction since they are stored outside of the transaction and the hash pointer to the signature cannot be malleated. Neat, but it introduces a dependency to the other data-structure that contains the signatures. A small trade-off in Bitcoin, but significant nonetheless.

Whilst Segwit in it of itself was not a bad idea, the deployment and resulting politics of the deployment caused a rift within the Bitcoin community. This led to the split of the community into Bitcoin (BTC) and Bitcoin Cash (BCH). Whilst Segwit was touted as a major reason for the split, the underlying issues were more about the deployment of Segwit than the technicals. Also, the politics of *“always soft-fork never hard-fork”* implied that the 1mb blocksize was essentially locked in, and this was unacceptable to many.

The technical arguments against Segwit were more to do with it’s gratuitous complexity as a soft-fork and unrelated to its soundness as a hard-fork. Segwit as a soft-fork was the straw that broke Bitcoins back, in the opinion of the author. However, Segwit as a hard-fork was (and remains) a technically sound solution-approach for malleability.

Love it or hate it, it’s done and dusted now. However, the problem of malleability remains in Bitcoin Cash.

[Bitcoin](https://medium.com/tag/bitcoin?source=post_page-----7b5f59fb99a4--------------------------------)[Bitcoin Cash](https://medium.com/tag/bitcoin-cash?source=post_page-----7b5f59fb99a4--------------------------------)[Transaction Malleability](https://medium.com/tag/transaction-malleability?source=post_page-----7b5f59fb99a4--------------------------------)[Crypto](https://medium.com/tag/crypto?source=post_page-----7b5f59fb99a4--------------------------------)[Cryptocurrency](https://medium.com/tag/cryptocurrency?source=post_page-----7b5f59fb99a4--------------------------------)

--

--

5

[![Herman Schoenfeld](https://miro.medium.com/v2/resize:fill:96:96/1*VnA9-kv1HDK9v4XgOJ0Cdw.jpeg)](/?source=post_page---post_author_info--7b5f59fb99a4--------------------------------)[![Herman Schoenfeld](https://miro.medium.com/v2/resize:fill:128:128/1*VnA9-kv1HDK9v4XgOJ0Cdw.jpeg)](/?source=post_page---post_author_info--7b5f59fb99a4--------------------------------)Follow[## Written by Herman Schoenfeld](/?source=post_page---post_author_info--7b5f59fb99a4--------------------------------)[64 Followers](/followers?source=post_page---post_author_info--7b5f59fb99a4--------------------------------)·[8 Following](/following?source=post_page---post_author_info--7b5f59fb99a4--------------------------------)

Developer at PascalCoin, Inventor of RandomHash, Developer of [BlockchainSQL.io](http://BlockchainSQL.io), Founder & CEO of PascalCoin Foundation, Director of Sphere 10 Software.

Follow
## Responses (5)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----7b5f59fb99a4--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----7b5f59fb99a4--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----7b5f59fb99a4--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----7b5f59fb99a4--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----7b5f59fb99a4--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----7b5f59fb99a4--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7b5f59fb99a4--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7b5f59fb99a4--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----7b5f59fb99a4--------------------------------)[Teams](https://medium.com/business?source=post_page-----7b5f59fb99a4--------------------------------)


