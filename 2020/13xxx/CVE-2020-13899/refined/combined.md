=== Content from github.com_75c49bbe_20250119_140033.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-6743-fx46-j8w6)

**CVE-2020-13900**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-6743-fx46-j8w6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-13900](/advisories/GHSA-6743-fx46-j8w6)

## An issue was discovered in janus-gateway (aka Janus...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-6743-fx46-j8w6/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

An issue was discovered in janus-gateway (aka Janus WebRTC Server) through 0.10.0. janus\_sdp\_preparse in sdp.c has a NULL pointer dereference.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-13900>
* [meetecho/janus-gateway#2214](https://github.com/meetecho/janus-gateway/pull/2214)
* <https://github.com/meetecho/janus-gateway/blob/v0.10.0/sdp.c#L64>
* <https://github.com/meetecho/janus-gateway/blob/v0.10.0/sdp.c#L74>
* <https://github.com/merrychap/CVEs/tree/master/CVE-2020-13900>
* <https://github.com/merrychap/poc_exploits/tree/master/janus-webrtc/CVE-2020-13900>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-13900)
Jun 10, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### [EPSS score](https://www.first.org/epss/user-guide)

0.474%
 (76th percentile)

### Weaknesses

[CWE-476](/advisories?query=cwe%3A476)

### CVE ID

CVE-2020-13900

### GHSA ID

GHSA-6743-fx46-j8w6

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-6743-fx46-j8w6/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ac1630f4_20250119_122156.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmeetecho%2Fjanus-gateway%2Fpull%2F2214)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmeetecho%2Fjanus-gateway%2Fpull%2F2214)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=meetecho%2Fjanus-gateway)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[meetecho](/meetecho)
/
**[janus-gateway](/meetecho/janus-gateway)**
Public

* [Notifications](/login?return_to=%2Fmeetecho%2Fjanus-gateway) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fmeetecho%2Fjanus-gateway)
* [Star
   8.4k](/login?return_to=%2Fmeetecho%2Fjanus-gateway)

* [Code](/meetecho/janus-gateway)
* [Issues
  15](/meetecho/janus-gateway/issues)
* [Pull requests
  14](/meetecho/janus-gateway/pulls)
* [Actions](/meetecho/janus-gateway/actions)
* [Security](/meetecho/janus-gateway/security)
* [Insights](/meetecho/janus-gateway/pulse)

Additional navigation options

* [Code](/meetecho/janus-gateway)
* [Issues](/meetecho/janus-gateway/issues)
* [Pull requests](/meetecho/janus-gateway/pulls)
* [Actions](/meetecho/janus-gateway/actions)
* [Security](/meetecho/janus-gateway/security)
* [Insights](/meetecho/janus-gateway/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmeetecho%2Fjanus-gateway%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmeetecho%2Fjanus-gateway%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Security fixes in SDP code #2214

 Merged

[lminiero](/lminiero)
merged 4 commits into
[master](/meetecho/janus-gateway/tree/master "meetecho/janus-gateway:master")
from
[sec-fixes](/meetecho/janus-gateway/tree/sec-fixes "meetecho/janus-gateway:sec-fixes")

Jun 9, 2020

 Merged

# [Security fixes in SDP code](#top) #2214

[lminiero](/lminiero)
merged 4 commits into
[master](/meetecho/janus-gateway/tree/master "meetecho/janus-gateway:master")
from
[sec-fixes](/meetecho/janus-gateway/tree/sec-fixes "meetecho/janus-gateway:sec-fixes")

Jun 9, 2020

[Conversation
0](/meetecho/janus-gateway/pull/2214)
[Commits
4](/meetecho/janus-gateway/pull/2214/commits)
[Checks
0](/meetecho/janus-gateway/pull/2214/checks)
[Files changed](/meetecho/janus-gateway/pull/2214/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![lminiero](https://avatars.githubusercontent.com/u/3684796?s=60&v=4)](/lminiero)

Copy link

Member

### @lminiero **[lminiero](/lminiero)** commented [Jun 9, 2020](#issue-635318880) • edited Loading

We've been notified about a series of security issues related to SDP (see relevant CVE IDs below, vulnerabilities discovered by Mikhail Evdokimov at Digital Security dsec.ru). Specifically, each commit in this PR solves a different issue that could happen:

1. a NULL pointer dereference when parsing some SDP attributes (see [CVE-2020-13898](https://github.com/advisories/GHSA-35h6-3hm3-w4f8 "CVE-2020-13898"));
2. a stack memory leak (and a "regular" one) when pre-parsing an SDP (see [CVE-2020-13899](https://github.com/advisories/GHSA-x6c3-mvjq-f4mg "CVE-2020-13899"));
3. a different NULL pointer dereference when pre-parsing an SDP (see [CVE-2020-13900](https://github.com/advisories/GHSA-6743-fx46-j8w6 "CVE-2020-13900"));
4. a buffer overflow when merging SDPs (see [CVE-2020-13901](https://github.com/advisories/GHSA-vqrr-qhj8-882q "CVE-2020-13901")).

I plan to merge this almost immediately, as I can't replicate the issues anymore.

Sorry, something went wrong.

All reactions

 [lminiero](/lminiero)
added 4 commits
[June 9, 2020 11:42](#commits-pushed-2ed485d)

[![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=40&v=4)](/lminiero)

`[Fixed NULL pointer dereference in sdp.c](/meetecho/janus-gateway/pull/2214/commits/2ed485d04630b9ee9de7c96517135654b7f32120 "Fixed NULL pointer dereference in sdp.c")`

`[2ed485d](/meetecho/janus-gateway/pull/2214/commits/2ed485d04630b9ee9de7c96517135654b7f32120)`

[![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=40&v=4)](/lminiero)

`[Fixed stack memory leak in janus.c (and regular memory leak in sdp.c)](/meetecho/janus-gateway/pull/2214/commits/f46f27fb129fd1b3744830b4fc6e75ab78794636 "Fixed stack memory leak in janus.c (and regular memory leak in sdp.c)")`

`[f46f27f](/meetecho/janus-gateway/pull/2214/commits/f46f27fb129fd1b3744830b4fc6e75ab78794636)`

[![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=40&v=4)](/lminiero)

`[Fixed NULL pointer dereference in sdp.c (preparse mid)](/meetecho/janus-gateway/pull/2214/commits/5f33d5e1073207f7275a726b7bb4cd7dbb08d13a "Fixed NULL pointer dereference in sdp.c (preparse mid)")`

`[5f33d5e](/meetecho/janus-gateway/pull/2214/commits/5f33d5e1073207f7275a726b7bb4cd7dbb08d13a)`

[![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=40&v=4)](/lminiero)

`[Fixed buffer overflow when merging SDPs in sdp.c](/meetecho/janus-gateway/pull/2214/commits/90cc2ada775c4d4d8f6ae66f96b4ec7588e4bc86 "Fixed buffer overflow when merging SDPs in sdp.c")`

`[90cc2ad](/meetecho/janus-gateway/pull/2214/commits/90cc2ada775c4d4d8f6ae66f96b4ec7588e4bc86)`

[![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=40&v=4)](/lminiero)
[lminiero](/lminiero)
merged commit [`5b15ded`](/meetecho/janus-gateway/commit/5b15ded4c3542ccef097da5088d01d977652fe9d)
into
master

[Jun 9, 2020](https://github.com/meetecho/janus-gateway/pull/2214#event-3424276728)

 [![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=40&v=4)](/lminiero)
[lminiero](/lminiero)
deleted the
sec-fixes

branch
[June 9, 2020 10:51](#event-3424276977)

[![@vincentfretin](https://avatars.githubusercontent.com/u/112249?s=40&v=4)](/vincentfretin)
[vincentfretin](/vincentfretin)
mentioned this pull request
[Aug 29, 2020](#ref-issue-627438503)

[Plugin no longer loads with latest libnice and janus-gateway
mozilla/janus-plugin-sfu#58](/mozilla/janus-plugin-sfu/issues/58)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmeetecho%2Fjanus-gateway%2Fpull%2F2214)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@lminiero](https://avatars.githubusercontent.com/u/3684796?s=52&v=4)](/lminiero)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b9da649e_20250119_140034.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-x6c3-mvjq-f4mg)

**CVE-2020-13899**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-x6c3-mvjq-f4mg)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-13899](/advisories/GHSA-x6c3-mvjq-f4mg)

## An issue was discovered in janus-gateway (aka Janus...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-x6c3-mvjq-f4mg/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

An issue was discovered in janus-gateway (aka Janus WebRTC Server) through 0.10.0. janus\_process\_incoming\_request in janus.c discloses information from uninitialized stack memory.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-13899>
* [meetecho/janus-gateway#2214](https://github.com/meetecho/janus-gateway/pull/2214)
* <https://github.com/meetecho/janus-gateway/blob/v0.10.0/janus.c#L1326>
* <https://github.com/merrychap/CVEs/tree/master/CVE-2020-13899>
* <https://github.com/merrychap/poc_exploits/tree/master/janus-webrtc/CVE-2020-13899>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-13899)
Jun 10, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### [EPSS score](https://www.first.org/epss/user-guide)

0.509%
 (77th percentile)

### Weaknesses

[CWE-909](/advisories?query=cwe%3A909)

### CVE ID

CVE-2020-13899

### GHSA ID

GHSA-x6c3-mvjq-f4mg

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-x6c3-mvjq-f4mg/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2bff3f91_20250119_140031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-35h6-3hm3-w4f8)

**CVE-2020-13898**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-35h6-3hm3-w4f8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-13898](/advisories/GHSA-35h6-3hm3-w4f8)

## An issue was discovered in janus-gateway (aka Janus...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-35h6-3hm3-w4f8/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

An issue was discovered in janus-gateway (aka Janus WebRTC Server) through 0.10.0. janus\_sdp\_process in sdp.c has a NULL pointer dereference.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-13898>
* [meetecho/janus-gateway#2214](https://github.com/meetecho/janus-gateway/pull/2214)
* <https://github.com/meetecho/janus-gateway/blob/v0.10.0/sdp.c#L120>
* <https://github.com/meetecho/janus-gateway/blob/v0.10.0/sdp.c#L123>
* <https://github.com/merrychap/CVEs/tree/master/CVE-2020-13898>
* <https://github.com/merrychap/CVEs/tree/master/janus-webrtc/CVE-2020-13898>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-13898)
Jun 10, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### [EPSS score](https://www.first.org/epss/user-guide)

0.474%
 (76th percentile)

### Weaknesses

[CWE-476](/advisories?query=cwe%3A476)

### CVE ID

CVE-2020-13898

### GHSA ID

GHSA-35h6-3hm3-w4f8

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-35h6-3hm3-w4f8/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c8fade1f_20250119_122155.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmeetecho%2Fjanus-gateway%2Fblob%2Fv0.10.0%2Fjanus.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmeetecho%2Fjanus-gateway%2Fblob%2Fv0.10.0%2Fjanus.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=meetecho%2Fjanus-gateway)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[meetecho](/meetecho)
/
**[janus-gateway](/meetecho/janus-gateway)**
Public

* [Notifications](/login?return_to=%2Fmeetecho%2Fjanus-gateway) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fmeetecho%2Fjanus-gateway)
* [Star
   8.4k](/login?return_to=%2Fmeetecho%2Fjanus-gateway)

* [Code](/meetecho/janus-gateway/tree/v0.10.0)
* [Issues
  15](/meetecho/janus-gateway/issues)
* [Pull requests
  14](/meetecho/janus-gateway/pulls)
* [Actions](/meetecho/janus-gateway/actions)
* [Security](/meetecho/janus-gateway/security)
* [Insights](/meetecho/janus-gateway/pulse)

Additional navigation options

* [Code](/meetecho/janus-gateway/tree/v0.10.0)
* [Issues](/meetecho/janus-gateway/issues)
* [Pull requests](/meetecho/janus-gateway/pulls)
* [Actions](/meetecho/janus-gateway/actions)
* [Security](/meetecho/janus-gateway/security)
* [Insights](/meetecho/janus-gateway/pulse)

## Files

 v0.10.0
## Breadcrumbs

1. [janus-gateway](/meetecho/janus-gateway/tree/v0.10.0)
/
# janus.c

Copy path Blame  Blame
## Latest commit

## History

[History](/meetecho/janus-gateway/commits/v0.10.0/janus.c)5341 lines (5129 loc) · 230 KB v0.10.0
## Breadcrumbs

1. [janus-gateway](/meetecho/janus-gateway/tree/v0.10.0)
/
# janus.c

Top
## File metadata and controls

* Code
* Blame

5341 lines (5129 loc) · 230 KB[Raw](https://github.com/meetecho/janus-gateway/raw/refs/tags/v0.10.0/janus.c)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000/\*! \file janus.c \* \author Lorenzo Miniero <lorenzo@meetecho.com> \* \copyright GNU General Public License v3 \* \brief Janus core \* \details Implementation of the Janus core. This code takes care of \* the server initialization (command line/configuration) and setup, \* and makes use of the available transport plugins (by default HTTP, \* WebSockets, RabbitMQ, if compiled) and Janus protocol (a JSON-based \* protocol) to interact with the applications, whether they're web based \* or not. The core also takes care of bridging peers and plugins \* accordingly, in terms of both messaging and real-time media transfer \* via WebRTC. \* \* \ingroup core \* \ref core \*/
#include <dlfcn.h>#include <dirent.h>#include <net/if.h>#include <netdb.h>#include <signal.h>#include <getopt.h>#include <sys/resource.h>#include <sys/stat.h>#include <fcntl.h>#include <poll.h>#ifdef HAVE\_TURNRESTAPI#include <curl/curl.h>#endif
#include "janus.h"#include "version.h"#include "cmdline.h"#include "config.h"#include "apierror.h"#include "debug.h"#include "ip-utils.h"#include "rtcp.h"#include "auth.h"#include "record.h"#include "events.h"
#define JANUS\_NAME "Janus WebRTC Server"#define JANUS\_AUTHOR "Meetecho s.r.l."#define JANUS\_SERVER\_NAME "MyJanusInstance"
#ifdef \_\_MACH\_\_#define SHLIB\_EXT "0.dylib"#else#define SHLIB\_EXT ".so"#endif
static janus\_config \*config = NULL;static char \*config\_file = NULL;static char \*configs\_folder = NULL;
static GHashTable \*transports = NULL;static GHashTable \*transports\_so = NULL;
static GHashTable \*eventhandlers = NULL;static GHashTable \*eventhandlers\_so = NULL;
static GHashTable \*loggers = NULL;static GHashTable \*loggers\_so = NULL;
static GHashTable \*plugins = NULL;static GHashTable \*plugins\_so = NULL;
/\* Daemonization \*/static gboolean daemonize = FALSE;static int pipefd[2];
#ifdef REFCOUNT\_DEBUG/\* Reference counters debugging \*/GHashTable \*counters = NULL;janus\_mutex counters\_mutex;#endif
/\* API secrets \*/static char \*api\_secret = NULL, \*admin\_api\_secret = NULL;
/\* JSON parameters \*/static int janus\_process\_error\_string(janus\_request \*request, uint64\_t session\_id, const char \*transaction, gint error, gchar \*error\_string);
static struct janus\_json\_parameter incoming\_request\_parameters[] = { {"transaction", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"janus", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"id", JSON\_INTEGER, JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter attach\_parameters[] = { {"plugin", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"opaque\_id", JSON\_STRING, 0},};static struct janus\_json\_parameter body\_parameters[] = { {"body", JSON\_OBJECT, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter jsep\_parameters[] = { {"type", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"trickle", JANUS\_JSON\_BOOL, 0}, {"sdp", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter add\_token\_parameters[] = { {"token", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"plugins", JSON\_ARRAY, 0}};static struct janus\_json\_parameter token\_parameters[] = { {"token", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter admin\_parameters[] = { {"transaction", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"janus", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter debug\_parameters[] = { {"debug", JANUS\_JSON\_BOOL, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter timeout\_parameters[] = { {"timeout", JSON\_INTEGER, JANUS\_JSON\_PARAM\_REQUIRED | JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter level\_parameters[] = { {"level", JSON\_INTEGER, JANUS\_JSON\_PARAM\_REQUIRED | JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter timestamps\_parameters[] = { {"timestamps", JANUS\_JSON\_BOOL, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter colors\_parameters[] = { {"colors", JANUS\_JSON\_BOOL, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter mnq\_parameters[] = { {"min\_nack\_queue", JSON\_INTEGER, JANUS\_JSON\_PARAM\_REQUIRED | JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter nmt\_parameters[] = { {"no\_media\_timer", JSON\_INTEGER, JANUS\_JSON\_PARAM\_REQUIRED | JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter st\_parameters[] = { {"slowlink\_threshold", JSON\_INTEGER, JANUS\_JSON\_PARAM\_REQUIRED | JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter ans\_parameters[] = { {"accept", JANUS\_JSON\_BOOL, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter queryhandler\_parameters[] = { {"handler", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"request", JSON\_OBJECT, 0}};static struct janus\_json\_parameter querylogger\_parameters[] = { {"logger", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"request", JSON\_OBJECT, 0}};static struct janus\_json\_parameter messageplugin\_parameters[] = { {"plugin", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"request", JSON\_OBJECT, 0}};static struct janus\_json\_parameter customevent\_parameters[] = { {"schema", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"data", JSON\_OBJECT, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter customlogline\_parameters[] = { {"line", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"level", JSON\_INTEGER, JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter text2pcap\_parameters[] = { {"folder", JSON\_STRING, 0}, {"filename", JSON\_STRING, 0}, {"truncate", JSON\_INTEGER, JANUS\_JSON\_PARAM\_POSITIVE}};static struct janus\_json\_parameter handleinfo\_parameters[] = { {"plugin\_only", JANUS\_JSON\_BOOL, 0}};static struct janus\_json\_parameter resaddr\_parameters[] = { {"address", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}};static struct janus\_json\_parameter teststun\_parameters[] = { {"address", JSON\_STRING, JANUS\_JSON\_PARAM\_REQUIRED}, {"port", JSON\_INTEGER, JANUS\_JSON\_PARAM\_REQUIRED | JANUS\_JSON\_PARAM\_POSITIVE}, {"localport", JSON\_INTEGER, JANUS\_JSON\_PARAM\_POSITIVE}};
/\* Admin/Monitor helpers \*/json\_t \*janus\_admin\_stream\_summary(janus\_ice\_stream \*stream);json\_t \*janus\_admin\_component\_summary(janus\_ice\_component \*component);
/\* IP addresses \*/static gchar \*local\_ip = NULL;gchar \*janus\_get\_local\_ip(void) { return local\_ip;}static gchar \*public\_ip = NULL;gchar \*janus\_get\_public\_ip(void) { /\* Fallback to the local IP, if we have no public one \*/ return public\_ip ? public\_ip : local\_ip;}void janus\_set\_public\_ip(const char \*ip) { /\* once set do not override \*/ if(ip == NULL || public\_ip != NULL) return; public\_ip = g\_strdup(ip);}static volatile gint stop = 0;static gint stop\_signal = 0;gint janus\_is\_stopping(void) { return g\_atomic\_int\_get(&stop);}static GMainLoop \*mainloop = NULL;
/\* Public instance name \*/static gchar \*server\_name = NULL;
static json\_t \*janus\_create\_message(const char \*status, uint64\_t session\_id, const char \*transaction) { json\_t \*msg = json\_object(); json\_object\_set\_new(msg, "janus", json\_string(status)); if(session\_id > 0) json\_object\_set\_new(msg, "session\_id", json\_integer(session\_id)); if(transaction != NULL) json\_object\_set\_new(msg, "transaction", json\_string(transaction)); return msg;}
/\* The default timeout for sessions is 60 seconds: this means that, if \* we don't get any activity (i.e., no request) on this session for more \* than 60 seconds, then it's considered expired and we destroy it. That's \* why we have a keep-alive method in the API. This can be overridden in \* either janus.cfg/.jcfg or from the command line. Setting this to 0 will \* disable the timeout mechanism, which is NOT suggested as it may risk \* having orphaned sessions (sessions not controlled by any transport \* and never freed). Besides, notice that if you make this shorter than \* 30s, you'll have to update the timers in janus.js when the long \* polling mechanism is used and shorten them as well, or you'll risk \* incurring in unexpected timeouts (when HTTP is used in janus.js, the \* long poll is used as a keepalive mechanism). \*/#define DEFAULT\_SESSION\_TIMEOUT 60static uint session\_timeout = DEFAULT\_SESSION\_TIMEOUT;
#define DEFAULT\_RECLAIM\_SESSION\_TIMEOUT 0static uint reclaim\_session\_timeout = DEFAULT\_RECLAIM\_SESSION\_TIMEOUT;
/\* We can programmatically change whether we want to accept new sessions \* or not: the default is of course TRUE, but we may want to temporarily \* change that in some cases, e.g., if we don't want the load on this \* server to grow too much, or because we're draining the server. \*/static gboolean accept\_new\_sessions = TRUE;
/\* We don't hold (trickle) candidates indefinitely either: by default, we \* only store them for 45 seconds. After that, they're discarded, in order \* to avoid leaks or orphaned media details. This means that, if for instance \* you're trying to set up a call with someone, and that someone only answers \* a minute later, the candidates you sent initially will be discarded and \* the call will fail. You can modify the default value in janus.jcfg \*/#define DEFAULT\_CANDIDATES\_TIMEOUT 45static uint candidates\_timeout = DEFAULT\_CANDIDATES\_TIMEOUT;
/\* By default we list dependencies details, but some may prefer not to \*/static gboolean hide\_dependencies = FALSE;
/\* WebRTC encryption is obviously enabled by default. In the rare cases \* you want to disable it for debugging purposes, though, you can do \* that either via command line (-w) or in the main configuration file \*/static gboolean webrtc\_encryption = TRUE;gboolean janus\_is\_webrtc\_encryption\_enabled(void) { return webrtc\_encryption;}
/\* Information \*/static json\_t \*janus\_info(const char \*transaction) { /\* Prepare a summary on the Janus instance \*/ json\_t \*info = janus\_create\_message("server\_info", 0, transaction); json\_object\_set\_new(info, "name", json\_string(JANUS\_NAME)); json\_object\_set\_new(info, "version", json\_integer(janus\_version)); json\_object\_set\_new(info, "version\_string", json\_string(janus\_version\_string)); json\_object\_set\_new(info, "author", json\_string(JANUS\_AUTHOR)); json\_object\_set\_new(info, "commit-hash", json\_string(janus\_build\_git\_sha)); json\_object\_set\_new(info, "compile-time", json\_string(janus\_build\_git\_time)); json\_object\_set\_new(info, "log-to-stdout", janus\_log\_is\_stdout\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "log-to-file", janus\_log\_is\_logfile\_enabled() ? json\_true() : json\_false()); if(janus\_log\_is\_logfile\_enabled()) json\_object\_set\_new(info, "log-path", json\_string(janus\_log\_get\_logfile\_path()));#ifdef HAVE\_SCTP json\_object\_set\_new(info, "data\_channels", json\_true());#else json\_object\_set\_new(info, "data\_channels", json\_false());#endif json\_object\_set\_new(info, "accepting-new-sessions", accept\_new\_sessions ? json\_true() : json\_false()); json\_object\_set\_new(info, "session-timeout", json\_integer(session\_timeout)); json\_object\_set\_new(info, "reclaim-session-timeout", json\_integer(reclaim\_session\_timeout)); json\_object\_set\_new(info, "candidates-timeout", json\_integer(candidates\_timeout)); json\_object\_set\_new(info, "server-name", json\_string(server\_name ? server\_name : JANUS\_SERVER\_NAME)); json\_object\_set\_new(info, "local-ip", json\_string(local\_ip)); if(public\_ip != NULL) json\_object\_set\_new(info, "public-ip", json\_string(public\_ip)); json\_object\_set\_new(info, "ipv6", janus\_ice\_is\_ipv6\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "ice-lite", janus\_ice\_is\_ice\_lite\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "ice-tcp", janus\_ice\_is\_ice\_tcp\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "full-trickle", janus\_ice\_is\_full\_trickle\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "mdns-enabled", janus\_ice\_is\_mdns\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "min-nack-queue", json\_integer(janus\_get\_min\_nack\_queue())); json\_object\_set\_new(info, "twcc-period", json\_integer(janus\_get\_twcc\_period())); if(janus\_get\_dscp() > 0) json\_object\_set\_new(info, "dscp", json\_integer(janus\_get\_dscp())); if(janus\_ice\_get\_stun\_server() != NULL) { char server[255]; g\_snprintf(server, 255, "%s:%"SCNu16, janus\_ice\_get\_stun\_server(), janus\_ice\_get\_stun\_port()); json\_object\_set\_new(info, "stun-server", json\_string(server)); } if(janus\_ice\_get\_turn\_server() != NULL) { char server[255]; g\_snprintf(server, 255, "%s:%"SCNu16, janus\_ice\_get\_turn\_server(), janus\_ice\_get\_turn\_port()); json\_object\_set\_new(info, "turn-server", json\_string(server)); } json\_object\_set\_new(info, "static-event-loops", json\_integer(janus\_ice\_get\_static\_event\_loops())); json\_object\_set\_new(info, "api\_secret", api\_secret ? json\_true() : json\_false()); json\_object\_set\_new(info, "auth\_token", janus\_auth\_is\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "event\_handlers", janus\_events\_is\_enabled() ? json\_true() : json\_false()); json\_object\_set\_new(info, "opaqueid\_in\_api", janus\_is\_opaqueid\_in\_api\_enabled() ? json\_true() : json\_false()); if(!webrtc\_encryption) json\_object\_set\_new(info, "webrtc\_encryption", json\_false()); /\* Dependencies \*/ if(!hide\_dependencies) { json\_t \*deps = json\_object(); char glib2\_version[20]; g\_snprintf(glib2\_version, sizeof(glib2\_version), "%d.%d.%d", glib\_major\_version, glib\_minor\_version, glib\_micro\_version); json\_object\_set\_new(deps, "glib2", json\_string(glib2\_version)); json\_object\_set\_new(deps, "jansson", json\_string(JANSSON\_VERSION)); json\_object\_set\_new(deps, "libnice", json\_string(libnice\_version\_string)); json\_object\_set\_new(deps, "libsrtp", json\_string(srtp\_get\_version\_string())); #ifdef HAVE\_TURNRESTAPI curl\_version\_info\_data \*curl\_version = curl\_version\_info(CURLVERSION\_NOW); if(curl\_version && curl\_version->version) json\_object\_set\_new(deps, "libcurl", json\_string(curl\_version->version)); #endif json\_object\_set\_new(deps, "crypto", json\_string(janus\_get\_ssl\_version())); json\_object\_set\_new(info, "dependencies", deps); } /\* Available transports \*/ json\_t \*t\_data = json\_object(); if(transports && g\_hash\_table\_size(transports) > 0) { GHashTableIter iter; gpointer value; g\_hash\_table\_iter\_init(&iter, transports); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_transport \*t = value; if(t == NULL) { continue; } json\_t \*transport = json\_object(); json\_object\_set\_new(transport, "name", json\_string(t->get\_name())); json\_object\_set\_new(transport, "author", json\_string(t->get\_author())); json\_object\_set\_new(transport, "description", json\_string(t->get\_description())); json\_object\_set\_new(transport, "version\_string", json\_string(t->get\_version\_string())); json\_object\_set\_new(transport, "version", json\_integer(t->get\_version())); json\_object\_set\_new(t\_data, t->get\_package(), transport); } } json\_object\_set\_new(info, "transports", t\_data); /\* Available event handlers \*/ json\_t \*e\_data = json\_object(); if(eventhandlers && g\_hash\_table\_size(eventhandlers) > 0) { GHashTableIter iter; gpointer value; g\_hash\_table\_iter\_init(&iter, eventhandlers); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_eventhandler \*e = value; if(e == NULL) { continue; } json\_t \*eventhandler = json\_object(); json\_object\_set\_new(eventhandler, "name", json\_string(e->get\_name())); json\_object\_set\_new(eventhandler, "author", json\_string(e->get\_author())); json\_object\_set\_new(eventhandler, "description", json\_string(e->get\_description())); json\_object\_set\_new(eventhandler, "version\_string", json\_string(e->get\_version\_string())); json\_object\_set\_new(eventhandler, "version", json\_integer(e->get\_version())); json\_object\_set\_new(e\_data, e->get\_package(), eventhandler); } } json\_object\_set\_new(info, "events", e\_data); /\* Available external loggers \*/ json\_t \*l\_data = json\_object(); if(loggers && g\_hash\_table\_size(loggers) > 0) { GHashTableIter iter; gpointer value; g\_hash\_table\_iter\_init(&iter, loggers); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_logger \*l = value; if(l == NULL) { continue; } json\_t \*logger = json\_object(); json\_object\_set\_new(logger, "name", json\_string(l->get\_name())); json\_object\_set\_new(logger, "author", json\_string(l->get\_author())); json\_object\_set\_new(logger, "description", json\_string(l->get\_description())); json\_object\_set\_new(logger, "version\_string", json\_string(l->get\_version\_string())); json\_object\_set\_new(logger, "version", json\_integer(l->get\_version())); json\_object\_set\_new(l\_data, l->get\_package(), logger); } } json\_object\_set\_new(info, "loggers", l\_data); /\* Available plugins \*/ json\_t \*p\_data = json\_object(); if(plugins && g\_hash\_table\_size(plugins) > 0) { GHashTableIter iter; gpointer value; g\_hash\_table\_iter\_init(&iter, plugins); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_plugin \*p = value; if(p == NULL) { continue; } json\_t \*plugin = json\_object(); json\_object\_set\_new(plugin, "name", json\_string(p->get\_name())); json\_object\_set\_new(plugin, "author", json\_string(p->get\_author())); json\_object\_set\_new(plugin, "description", json\_string(p->get\_description())); json\_object\_set\_new(plugin, "version\_string", json\_string(p->get\_version\_string())); json\_object\_set\_new(plugin, "version", json\_integer(p->get\_version())); json\_object\_set\_new(p\_data, p->get\_package(), plugin); } } json\_object\_set\_new(info, "plugins", p\_data);
 return info;}
/\* Logging \*/int janus\_log\_level = LOG\_INFO;gboolean janus\_log\_timestamps = FALSE;gboolean janus\_log\_colors = FALSE;char \*janus\_log\_global\_prefix = NULL;int lock\_debug = 0;#ifdef REFCOUNT\_DEBUGint refcount\_debug = 1;#elseint refcount\_debug = 0;#endif
/\*! \brief Signal handler (just used to intercept CTRL+C and SIGTERM) \*/static void janus\_handle\_signal(int signum) { stop\_signal = signum; switch(g\_atomic\_int\_get(&stop)) { case 0: JANUS\_PRINT("Stopping server, please wait...\n"); break; case 1: JANUS\_PRINT("In a hurry? I'm trying to free resources cleanly, here!\n"); break; default: JANUS\_PRINT("Ok, leaving immediately...\n"); break; } g\_atomic\_int\_inc(&stop); if(g\_atomic\_int\_get(&stop) > 2) exit(1); if(mainloop && g\_main\_loop\_is\_running(mainloop)) g\_main\_loop\_quit(mainloop);}
/\*! \brief Termination handler (atexit) \*/static void janus\_termination\_handler(void) { /\* Free the instance name, if provided \*/ g\_free(server\_name); /\* Remove the PID file if we created it \*/ janus\_pidfile\_remove(); /\* Close the logger \*/ janus\_log\_destroy(); /\* Get rid of external loggers too, if any \*/ if(loggers != NULL && g\_hash\_table\_size(loggers) > 0) { g\_hash\_table\_foreach(loggers, janus\_logger\_close, NULL); g\_hash\_table\_destroy(loggers); } if(loggers\_so != NULL && g\_hash\_table\_size(loggers\_so) > 0) { g\_hash\_table\_foreach(loggers\_so, janus\_loggerso\_close, NULL); g\_hash\_table\_destroy(loggers\_so); } /\* If we're daemonizing, we send an error code to the parent \*/ if(daemonize) { int code = 1; ssize\_t res = 0; do { res = write(pipefd[1], &code, sizeof(int)); } while(res == -1 && errno == EINTR); }}
/\*\* @name Transport plugin callback interface \* These are the callbacks implemented by the Janus core, as part of \* the janus\_transport\_callbacks interface. Everything the transport \* plugins send the core is handled here. \*////@{void janus\_transport\_incoming\_request(janus\_transport \*plugin, janus\_transport\_session \*transport, void \*request\_id, gboolean admin, json\_t \*message, json\_error\_t \*error);void janus\_transport\_gone(janus\_transport \*plugin, janus\_transport\_session \*transport);gboolean janus\_transport\_is\_api\_secret\_needed(janus\_transport \*plugin);gboolean janus\_transport\_is\_api\_secret\_valid(janus\_transport \*plugin, const char \*apisecret);gboolean janus\_transport\_is\_auth\_token\_needed(janus\_transport \*plugin);gboolean janus\_transport\_is\_auth\_token\_valid(janus\_transport \*plugin, const char \*token);void janus\_transport\_notify\_event(janus\_transport \*plugin, void \*transport, json\_t \*event);
static janus\_transport\_callbacks janus\_handler\_transport = { .incoming\_request = janus\_transport\_incoming\_request, .transport\_gone = janus\_transport\_gone, .is\_api\_secret\_needed = janus\_transport\_is\_api\_secret\_needed, .is\_api\_secret\_valid = janus\_transport\_is\_api\_secret\_valid, .is\_auth\_token\_needed = janus\_transport\_is\_auth\_token\_needed, .is\_auth\_token\_valid = janus\_transport\_is\_auth\_token\_valid, .events\_is\_enabled = janus\_events\_is\_enabled, .notify\_event = janus\_transport\_notify\_event, };static GAsyncQueue \*requests = NULL;static janus\_request exit\_message;static GThreadPool \*tasks = NULL;void janus\_transport\_task(gpointer data, gpointer user\_data);///@}
/\*\* @name Plugin callback interface \* These are the callbacks implemented by the Janus core, as part of \* the janus\_callbacks interface. Everything the plugins send the \* core is handled here. \*////@{int janus\_plugin\_push\_event(janus\_plugin\_session \*plugin\_session, janus\_plugin \*plugin, const char \*transaction, json\_t \*message, json\_t \*jsep);json\_t \*janus\_plugin\_handle\_sdp(janus\_plugin\_session \*plugin\_session, janus\_plugin \*plugin, const char \*sdp\_type, const char \*sdp, gboolean restart);void janus\_plugin\_relay\_rtp(janus\_plugin\_session \*plugin\_session, janus\_plugin\_rtp \*packet);void janus\_plugin\_relay\_rtcp(janus\_plugin\_session \*plugin\_session, janus\_plugin\_rtcp \*packet);void janus\_plugin\_relay\_data(janus\_plugin\_session \*plugin\_session, janus\_plugin\_data \*message);void janus\_plugin\_send\_pli(janus\_plugin\_session \*plugin\_session);void janus\_plugin\_send\_remb(janus\_plugin\_session \*plugin\_session, uint32\_t bitrate);void janus\_plugin\_close\_pc(janus\_plugin\_session \*plugin\_session);void janus\_plugin\_end\_session(janus\_plugin\_session \*plugin\_session);void janus\_plugin\_notify\_event(janus\_plugin \*plugin, janus\_plugin\_session \*plugin\_session, json\_t \*event);gboolean janus\_plugin\_auth\_is\_signature\_valid(janus\_plugin \*plugin, const char \*token);gboolean janus\_plugin\_auth\_signature\_contains(janus\_plugin \*plugin, const char \*token, const char \*desc);static janus\_callbacks janus\_handler\_plugin = { .push\_event = janus\_plugin\_push\_event, .relay\_rtp = janus\_plugin\_relay\_rtp, .relay\_rtcp = janus\_plugin\_relay\_rtcp, .relay\_data = janus\_plugin\_relay\_data, .send\_pli = janus\_plugin\_send\_pli, .send\_remb = janus\_plugin\_send\_remb, .close\_pc = janus\_plugin\_close\_pc, .end\_session = janus\_plugin\_end\_session, .events\_is\_enabled = janus\_events\_is\_enabled, .notify\_event = janus\_plugin\_notify\_event, .auth\_is\_signature\_valid = janus\_plugin\_auth\_is\_signature\_valid, .auth\_signature\_contains = janus\_plugin\_auth\_signature\_contains, };///@}
/\* Core Sessions \*/static janus\_mutex sessions\_mutex;static GHashTable \*sessions = NULL;static GMainContext \*sessions\_watchdog\_context = NULL;
static void janus\_ice\_handle\_dereference(janus\_ice\_handle \*handle) { if(handle) janus\_refcount\_decrease(&handle->ref);}
static void janus\_session\_free(const janus\_refcount \*session\_ref) { janus\_session \*session = janus\_refcount\_containerof(session\_ref, janus\_session, ref); /\* This session can be destroyed, free all the resources \*/ if(session->ice\_handles != NULL) { g\_hash\_table\_destroy(session->ice\_handles); session->ice\_handles = NULL; } if(session->source != NULL) { janus\_request\_destroy(session->source); session->source = NULL; } g\_free(session);}
static janus\_request \*janus\_session\_get\_request(janus\_session \*session) { if(session == NULL) return NULL; janus\_mutex\_lock(&session->mutex); janus\_request \*source = session->source; if(source != NULL && !g\_atomic\_int\_get(&source->destroyed)) { janus\_refcount\_increase(&source->ref); } else { source = NULL; } janus\_mutex\_unlock(&session->mutex); return source;}static void janus\_request\_unref(janus\_request \*request) { if(request) janus\_refcount\_decrease(&request->ref);}
static gboolean janus\_check\_sessions(gpointer user\_data) { if(session\_timeout < 1 && reclaim\_session\_timeout < 1) /\* Session timeouts are disabled \*/ return G\_SOURCE\_CONTINUE; janus\_mutex\_lock(&sessions\_mutex); if(sessions && g\_hash\_table\_size(sessions) > 0) { GHashTableIter iter; gpointer value; g\_hash\_table\_iter\_init(&iter, sessions); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_session \*session = (janus\_session \*) value; if (!session || g\_atomic\_int\_get(&session->destroyed)) { continue; } gint64 now = janus\_get\_monotonic\_time(); if ((session\_timeout > 0 && (now - session->last\_activity >= (gint64)session\_timeout \* G\_USEC\_PER\_SEC) && !g\_atomic\_int\_compare\_and\_exchange(&session->timeout, 0, 1)) || ((g\_atomic\_int\_get(&session->transport\_gone) && now - session->last\_activity >= (gint64)reclaim\_session\_timeout \* G\_USEC\_PER\_SEC) && !g\_atomic\_int\_compare\_and\_exchange(&session->timeout, 0, 1))) { JANUS\_LOG(LOG\_INFO, "Timeout expired for session %"SCNu64"...\n", session->session\_id); /\* Mark the session as over, we'll deal with it later \*/ janus\_session\_handles\_clear(session); /\* Notify the transport \*/ janus\_request \*source = janus\_session\_get\_request(session); if(source) { json\_t \*event = janus\_create\_message("timeout", session->session\_id, NULL); /\* Send this to the transport client and notify the session's over \*/ source->transport->send\_message(source->instance, NULL, FALSE, event); source->transport->session\_over(source->instance, session->session\_id, TRUE, FALSE); } janus\_request\_unref(source); /\* Notify event handlers as well \*/ if(janus\_events\_is\_enabled()) janus\_events\_notify\_handlers(JANUS\_EVENT\_TYPE\_SESSION, JANUS\_EVENT\_SUBTYPE\_NONE, session->session\_id, "timeout", NULL);
 /\* FIXME Is this safe? apparently it causes hash table errors on the console \*/ g\_hash\_table\_iter\_remove(&iter);
 janus\_session\_destroy(session); } } } janus\_mutex\_unlock(&sessions\_mutex);
 return G\_SOURCE\_CONTINUE;}
static gpointer janus\_sessions\_watchdog(gpointer user\_data) { GMainLoop \*loop = (GMainLoop \*) user\_data; GMainContext \*watchdog\_context = g\_main\_loop\_get\_context(loop); GSource \*timeout\_source;
 timeout\_source = g\_timeout\_source\_new\_seconds(2); g\_source\_set\_callback(timeout\_source, janus\_check\_sessions, watchdog\_context, NULL); g\_source\_attach(timeout\_source, watchdog\_context); g\_source\_unref(timeout\_source);
 JANUS\_LOG(LOG\_INFO, "Sessions watchdog started\n");
 g\_main\_loop\_run(loop);
 JANUS\_LOG(LOG\_INFO, "Sessions watchdog stopped\n");
 return NULL;}
janus\_session \*janus\_session\_create(guint64 session\_id) { janus\_session \*session = NULL; if(session\_id == 0) { while(session\_id == 0) { session\_id = janus\_random\_uint64(); session = janus\_session\_find(session\_id); if(session != NULL) { /\* Session ID already taken, try another one \*/ janus\_refcount\_decrease(&session->ref); session\_id = 0; } } } session = (janus\_session \*)g\_malloc(sizeof(janus\_session)); JANUS\_LOG(LOG\_INFO, "Creating new session: %"SCNu64"; %p\n", session\_id, session); session->session\_id = session\_id; janus\_refcount\_init(&session->ref, janus\_session\_free); session->source = NULL; g\_atomic\_int\_set(&session->destroyed, 0); g\_atomic\_int\_set(&session->timeout, 0); g\_atomic\_int\_set(&session->transport\_gone, 0); session->last\_activity = janus\_get\_monotonic\_time(); session->ice\_handles = NULL; janus\_mutex\_init(&session->mutex); janus\_mutex\_lock(&sessions\_mutex); g\_hash\_table\_insert(sessions, janus\_uint64\_dup(session->session\_id), session); janus\_mutex\_unlock(&sessions\_mutex); return session;}
janus\_session \*janus\_session\_find(guint64 session\_id) { janus\_mutex\_lock(&sessions\_mutex); janus\_session \*session = g\_hash\_table\_lookup(sessions, &session\_id); if(session != NULL) { /\* A successful find automatically increases the reference counter: \* it's up to the caller to decrease it again when done \*/ janus\_refcount\_increase(&session->ref); } janus\_mutex\_unlock(&sessions\_mutex); return session;}
void janus\_session\_notify\_event(janus\_session \*session, json\_t \*event) { if(session != NULL && !g\_atomic\_int\_get(&session->destroyed)) { janus\_request \*source = janus\_session\_get\_request(session); if(source != NULL && source->transport != NULL) { /\* Send this to the transport client \*/ JANUS\_LOG(LOG\_HUGE, "Sending event to %s (%p)\n", source->transport->get\_package(), source->instance); source->transport->send\_message(source->instance, NULL, FALSE, event); } else { /\* No transport, free the event \*/ json\_decref(event); } janus\_request\_unref(source); } else { /\* No session, free the event \*/ json\_decref(event); }}
/\* Destroys a session but does not remove it from the sessions hash table. \*/gint janus\_session\_destroy(janus\_session \*session) { guint64 session\_id = session->session\_id; JANUS\_LOG(LOG\_INFO, "Destroying session %"SCNu64"; %p\n", session\_id, session); if(!g\_atomic\_int\_compare\_and\_exchange(&session->destroyed, 0, 1)) return 0; janus\_session\_handles\_clear(session); /\* The session will actually be destroyed when the counter gets to 0 \*/ janus\_refcount\_decrease(&session->ref);
 return 0;}
janus\_ice\_handle \*janus\_session\_handles\_find(janus\_session \*session, guint64 handle\_id) { if(session == NULL) return NULL; janus\_mutex\_lock(&session->mutex); janus\_ice\_handle \*handle = session->ice\_handles ? g\_hash\_table\_lookup(session->ice\_handles, &handle\_id) : NULL; if(handle != NULL) { /\* A successful find automatically increases the reference counter: \* it's up to the caller to decrease it again when done \*/ janus\_refcount\_increase(&handle->ref); } janus\_mutex\_unlock(&session->mutex); return handle;}
void janus\_session\_handles\_insert(janus\_session \*session, janus\_ice\_handle \*handle) { janus\_mutex\_lock(&session->mutex); if(session->ice\_handles == NULL) session->ice\_handles = g\_hash\_table\_new\_full(g\_int64\_hash, g\_int64\_equal, (GDestroyNotify)g\_free, (GDestroyNotify)janus\_ice\_handle\_dereference); janus\_refcount\_increase(&handle->ref); g\_hash\_table\_insert(session->ice\_handles, janus\_uint64\_dup(handle->handle\_id), handle); janus\_mutex\_unlock(&session->mutex);}
gint janus\_session\_handles\_remove(janus\_session \*session, janus\_ice\_handle \*handle) { janus\_mutex\_lock(&session->mutex); gint error = janus\_ice\_handle\_destroy(session, handle); g\_hash\_table\_remove(session->ice\_handles, &handle->handle\_id); janus\_mutex\_unlock(&session->mutex); return error;}
void janus\_session\_handles\_clear(janus\_session \*session) { janus\_mutex\_lock(&session->mutex); if(session->ice\_handles != NULL && g\_hash\_table\_size(session->ice\_handles) > 0) { GHashTableIter iter; gpointer value; /\* Remove all handles \*/ g\_hash\_table\_iter\_init(&iter, session->ice\_handles); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_ice\_handle \*handle = value; if(!handle) continue; janus\_ice\_handle\_destroy(session, handle); g\_hash\_table\_iter\_remove(&iter); } } janus\_mutex\_unlock(&session->mutex);}
json\_t \*janus\_session\_handles\_list\_json(janus\_session \*session) { json\_t \*list = json\_array(); janus\_mutex\_lock(&session->mutex); if(session->ice\_handles != NULL && g\_hash\_table\_size(session->ice\_handles) > 0) { GHashTableIter iter; gpointer value; g\_hash\_table\_iter\_init(&iter, session->ice\_handles); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { janus\_ice\_handle \*handle = value; if(!handle) continue; json\_array\_append\_new(list, json\_integer(handle->handle\_id)); } } janus\_mutex\_unlock(&session->mutex); return list;}
/\* Requests management \*/static void janus\_request\_free(const janus\_refcount \*request\_ref) { janus\_request \*request = janus\_refcount\_containerof(request\_ref, janus\_request, ref); /\* This request can be destroyed, free all the resources \*/ request->transport = NULL; if(request->instance) janus\_refcount\_decrease(&request->instance->ref); request->instance = NULL; request->request\_id = NULL; if(request->message) json\_decref(request->message); request->message = NULL; g\_free(request);}
janus\_request \*janus\_request\_new(janus\_transport \*transport, janus\_transport\_session \*instance, void \*request\_id, gboolean admin, json\_t \*message) { janus\_request \*request = g\_malloc(sizeof(janus\_request)); request->transport = transport; request->instance = instance; janus\_refcount\_increase(&instance->ref); request->request\_id = request\_id; request->admin = admin; request->message = message; g\_atomic\_int\_set(&request->destroyed, 0); janus\_refcount\_init(&request->ref, janus\_request\_free); return request;}
void janus\_request\_destroy(janus\_request \*request) { if(request == NULL || request == &exit\_message || !g\_atomic\_int\_compare\_and\_exchange(&request->destroyed, 0, 1)) return; janus\_refcount\_decrease(&request->ref);}
static int janus\_request\_check\_secret(janus\_request \*request, guint64 session\_id, const gchar \*transaction\_text) { gboolean secret\_authorized = FALSE, token\_authorized = FALSE; if(api\_secret == NULL && !janus\_auth\_is\_enabled()) { /\* Nothing to check \*/ secret\_authorized = TRUE; token\_authorized = TRUE; } else { json\_t \*root = request->message; if(api\_secret != NULL) { /\* There's an API secret, check that the client provided it \*/ json\_t \*secret = json\_object\_get(root, "apisecret"); if(secret && json\_is\_string(secret) && janus\_strcmp\_const\_time(json\_string\_value(secret), api\_secret)) { secret\_authorized = TRUE; } } if(janus\_auth\_is\_enabled()) { /\* The token based authentication mechanism is enabled, check that the client provided it \*/ json\_t \*token = json\_object\_get(root, "token"); if(token && json\_is\_string(token) && janus\_auth\_check\_token(json\_string\_value(token))) { token\_authorized = TRUE; } } /\* We consider a request authorized if either the proper API secret or a valid token has been provided \*/ if(!secret\_authorized && !token\_authorized) return JANUS\_ERROR\_UNAUTHORIZED; } return 0;}
static void janus\_request\_ice\_handle\_answer(janus\_ice\_handle \*handle, int audio, int video, int data, char \*jsep\_sdp) { /\* We got our answer \*/ janus\_flags\_clear(&handle->webrtc\_flags, JANUS\_ICE\_HANDLE\_WEBRTC\_PROCESSING\_OFFER); /\* Any pending trickles? \*/ if(handle->pending\_trickles) { JANUS\_LOG(LOG\_VERB, "[%"SCNu64"] -- Processing %d pending trickle candidates\n", handle->handle\_id, g\_list\_length(handle->pending\_trickles)); GList \*temp = NULL; while(handle->pending\_trickles) { temp = g\_list\_first(handle->pending\_trickles); handle->pending\_trickles = g\_list\_remove\_link(handle->pending\_trickles, temp); janus\_ice\_trickle \*trickle = (janus\_ice\_trickle \*)temp->data; g\_list\_free(temp); if(trickle == NULL) continue; if((janus\_get\_monotonic\_time() - trickle->received) > candidates\_timeout\*G\_USEC\_PER\_SEC) { /\* FIXME Candidate is too old, discard it \*/ JANUS\_LOG(LOG\_WARN, "[%"SCNu64"] Discarding candidate (too old)\n", handle->handle\_id); janus\_ice\_trickle\_destroy(trickle); /\* FIXME We should report that \*/ continue; } json\_t \*candidate = trickle->candidate; if(candidate == NULL) { janus\_ice\_trickle\_destroy(trickle); continue; } if(json\_is\_object(candidate)) { /\* We got a single candidate \*/ int error = 0; const char \*error\_string = NULL; if((error = janus\_ice\_trickle\_parse(handle, candidate, &error\_string)) != 0) { /\* FIXME We should report the error parsing the trickle candidate \*/ } } else if(json\_is\_array(candidate)) { /\* We got multiple candidates in an array \*/ JANUS\_LOG(LOG\_VERB, "[%"SCNu64"] Got multiple candidates (%zu)\n", handle->handle\_id, json\_array\_size(candidate)); if(json\_array\_size(candidate) > 0) { /\* Handle remote candidates \*/ size\_t i = 0; for(i=0; i<json\_array\_size(candidate); i++) { json\_t \*c = json\_array\_get(candidate, i); /\* FIXME We don't care if any trickle fails to parse \*/ janus\_ice\_trickle\_parse(handle, c, NULL); } } } /\* Done, free candidate \*/ janus\_ice\_trickle\_destroy(trickle); } }
 gboolean candidates\_found = (handle->stream && handle->stream->component && g\_slist\_length(handle->stream->component->candidates) > 0); /\* This was an answer, check if it's time to start ICE \*/ if(janus\_flags\_is\_set(&handle->webrtc\_flags, JANUS\_ICE\_HANDLE\_WEBRTC\_TRICKLE) && !candidates\_found) { JANUS\_LOG(LOG\_VERB, "[%"SCNu64"] -- ICE Trickling is supported by the browser, waiting for remote candidates...\n", handle->handle\_id); janus\_flags\_set(&handle->webrtc\_flags, JANUS\_ICE\_HANDLE\_WEBRTC\_START); } else { JANUS\_LOG(LOG\_VERB, "[%"SCNu64"] Done! Sending connectivity checks...\n", handle->handle\_id); janus\_ice\_setup\_remote\_candidates(handle, handle->stream\_id, 1); }}
int janus\_process\_incoming\_request(janus\_request \*request) { int ret = -1; if(request == NULL) { JANUS\_LOG(LOG\_ERR, "Missing request or payload to process, giving up...\n"); return ret; } int error\_code = 0; char error\_cause[100]; json\_t \*root = request->message; /\* Ok, let's start with the ids \*/ guint64 session\_id = 0, handle\_id = 0; json\_t \*s = json\_object\_get(root, "session\_id"); if(s && json\_is\_integer(s)) session\_id = json\_integer\_value(s); json\_t \*h = json\_object\_get(root, "handle\_id"); if(h && json\_is\_integer(h)) handle\_id = json\_integer\_value(h);
 janus\_session \*session = NULL; janus\_ice\_handle \*handle = NULL;
 /\* Get transaction and message request \*/ JANUS\_VALIDATE\_JSON\_OBJECT(root, incoming\_request\_parameters, error\_code, error\_cause, FALSE, JANUS\_ERROR\_MISSING\_MANDATORY\_ELEMENT, JANUS\_ERROR\_INVALID\_ELEMENT\_TYPE); if(error\_code != 0) { ret = janus\_process\_error\_string(request, session\_id, NULL, error\_code, error\_cause); goto jsondone; } json\_t \*transaction = json\_object\_get(root, "transaction"); const gchar \*transaction\_text = json\_string\_value(transaction); json\_t \*message = json\_object\_get(root, "janus"); const gchar \*message\_text = json\_string\_value(message);
 if(session\_id == 0 && handle\_id == 0) { /\* Can only be a 'Create new session', a 'Get info' or a 'Ping/Pong' request \*/ if(!strcasecmp(message\_text, "info")) { ret = janus\_process\_success(request, janus\_info(transaction\_text)); goto jsondone; } if(!strcasecmp(message\_text, "ping")) { /\* Prepare JSON reply \*/ json\_t \*reply = janus\_create\_message("pong", 0, transaction\_text); ret = janus\_process\_success(request, reply); goto jsondone; } if(strcasecmp(message\_text, "create")) { ret = janus\_process\_error(request, session\_id, transaction\_text, JANUS\_ERROR\_INVALID\_REQUEST\_PATH, "Unhandled request '%s' at this path", message\_text); goto jsondone; } /\* Make sure we're accepting new sessions \*/ if(!accept\_new\_sessions) { ret = janus\_process\_error(request, session\_id, transaction\_text, JANUS\_ERROR\_NOT\_ACCEPTING\_SESSIONS, NULL); goto jsondone; } /\* Any secret/token to check? \*/ ret = janus\_request\_check\_secret(request, session\_id, transaction\_text); if(ret != 0) { ret = janus\_process\_error(request, session\_id, transaction\_text, JANUS\_ERROR\_UNAUTHORIZED, NULL); goto jsondone; } session\_id = 0; json\_t \*id = json\_object\_get(root, "id"); if(id != NULL) { /\* The application provided the session ID to use \*/ session\_id = json\_integer\_value(id); if(session\_id > 0 && (session = janus\_session\_find(session\_id)) != NULL) {[View remainder of file in raw view](https://github.com/meetecho/janus-gateway/raw/refs/tags/v0.10.0/janus.c)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


