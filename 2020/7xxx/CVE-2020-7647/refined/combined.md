=== Content from github.com_67f38579_20250119_113736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjooby-project%2Fjooby%2Fcommit%2F34f526028e6cd0652125baa33936ffb6a8a4a009)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjooby-project%2Fjooby%2Fcommit%2F34f526028e6cd0652125baa33936ffb6a8a4a009)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jooby-project%2Fjooby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jooby-project](/jooby-project)
/
**[jooby](/jooby-project/jooby)**
Public

* [Notifications](/login?return_to=%2Fjooby-project%2Fjooby) You must be signed in to change notification settings
* [Fork
  197](/login?return_to=%2Fjooby-project%2Fjooby)
* [Star
   1.7k](/login?return_to=%2Fjooby-project%2Fjooby)

* [Code](/jooby-project/jooby)
* [Issues
  11](/jooby-project/jooby/issues)
* [Pull requests
  1](/jooby-project/jooby/pulls)
* [Discussions](/jooby-project/jooby/discussions)
* [Actions](/jooby-project/jooby/actions)
* [Security](/jooby-project/jooby/security)
* [Insights](/jooby-project/jooby/pulse)

Additional navigation options

* [Code](/jooby-project/jooby)
* [Issues](/jooby-project/jooby/issues)
* [Pull requests](/jooby-project/jooby/pulls)
* [Discussions](/jooby-project/jooby/discussions)
* [Actions](/jooby-project/jooby/actions)
* [Security](/jooby-project/jooby/security)
* [Insights](/jooby-project/jooby/pulse)

## Commit

[Permalink](/jooby-project/jooby/commit/34f526028e6cd0652125baa33936ffb6a8a4a009)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

asset: path traversal fix [#1639](https://github.com/jooby-project/jooby/issues/1639)

[Browse files](/jooby-project/jooby/tree/34f526028e6cd0652125baa33936ffb6a8a4a009)
Browse the repository at this point in the history

* Loading branch information

[![@jknack](https://avatars.githubusercontent.com/u/1301129?s=40&v=4)](/jknack)

[jknack](/jooby-project/jooby/commits?author=jknack "View all commits by jknack")
committed
May 10, 2020

1 parent
[8909924](/jooby-project/jooby/commit/89099246fcc08949e41a7c5465aadeea325ea12a)

commit 34f5260

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**272 additions**
and
**32 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* jooby/src

  + main/java/org/jooby

    - jooby/src/main/java/org/jooby/Jooby.java
      [Jooby.java](#diff-502c27e827e52480ad1fc242217e16ae3705b70d9e95dc2b957bfd33387d8e74)
    - jooby/src/main/java/org/jooby/Route.java
      [Route.java](#diff-db79150febde9051cceeee4d0eba189343d92d7e212aaae573c7626b689d5adc)
    - handlers

      * jooby/src/main/java/org/jooby/handlers/AssetHandler.java
        [AssetHandler.java](#diff-ac0a46c8fc571e7d113edccecb8b534b4d0c132b4ddb566533ff2942ca867c0a)
    - internal

      * jooby/src/main/java/org/jooby/internal/AssetSource.java
        [AssetSource.java](#diff-cab121a5f4d48a34cbc0c29b2204d27c6b011392075a2fdc9e9031127ba605e3)
  + test/java/org/jooby/handlers

    - jooby/src/test/java/org/jooby/handlers/AssetHandlerTest.java
      [AssetHandlerTest.java](#diff-55593a7176a67eb6127c74910f7e240be00940de44aeaf2d543b664080d00eed)
* modules

  + coverage-report/src/test

    - java/org/jooby/issues

      * modules/coverage-report/src/test/java/org/jooby/issues/Issue1639.java
        [Issue1639.java](#diff-a523b06d1a0c8f5418353d88e4fdbfc76ef528a2e50c38e17fb9f95cdb4468ae)
      * modules/coverage-report/src/test/java/org/jooby/issues/Issue1639b.java
        [Issue1639b.java](#diff-0075152c85f3099f3421636cf32c3f53f900558bf9a44cb118d01dcc24b8c319)
      * modules/coverage-report/src/test/java/org/jooby/issues/Issue1639c.java
        [Issue1639c.java](#diff-817964934d1b34c0dc545960de02e09d830fd652b78120eceed1b8cb5032c1ae)
    - resources/WEB-INF

      * modules/coverage-report/src/test/resources/WEB-INF/web2.xml
        [web2.xml](#diff-97ad8106d3226e2977614f6263004693afadd9f3a2328c4a684e793099b5b8a7)
  + jooby-assets/src/main/java/org/jooby/assets

    - modules/jooby-assets/src/main/java/org/jooby/assets/Assets.java
      [Assets.java](#diff-99d07f9f16e9386af3ebd897dd46a1769569be5554c0fcd9d4f098ae1e7b5a15)

## There are no files selected for viewing

6 changes: 5 additions & 1 deletion

6
[jooby/src/main/java/org/jooby/Jooby.java](#diff-502c27e827e52480ad1fc242217e16ae3705b70d9e95dc2b957bfd33387d8e74 "jooby/src/main/java/org/jooby/Jooby.java")

Show comments

[View file](/jooby-project/jooby/blob/34f526028e6cd0652125baa33936ffb6a8a4a009/jooby/src/main/java/org/jooby/Jooby.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1363,7 +1363,11 @@ public Route.Definition use(final String path, final Route.OneArgHandler handler |
|  |  |  |
|  |  | @Override |
|  |  | public Route.Definition get(final String path, final Route.Handler handler) { |
|  |  | return appendDefinition(GET, path, handler); |
|  |  | if (handler instanceof AssetHandler) { |
|  |  | return assets(path, (AssetHandler) handler); |
|  |  | } else { |
|  |  | return appendDefinition(GET, path, handler); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | @Override |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[jooby/src/main/java/org/jooby/Route.java](#diff-db79150febde9051cceeee4d0eba189343d92d7e212aaae573c7626b689d5adc "jooby/src/main/java/org/jooby/Route.java")

Show comments

[View file](/jooby-project/jooby/blob/34f526028e6cd0652125baa33936ffb6a8a4a009/jooby/src/main/java/org/jooby/Route.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1636,6 +1636,7 @@ class AssetDefinition extends Definition { |
|  |  | public AssetDefinition(final String method, final String pattern, |
|  |  | final Route.Filter handler, boolean caseSensitiveRouting) { |
|  |  | super(method, pattern, handler, caseSensitiveRouting); |
|  |  | filter().setRoute(this); |
|  |  | } |
|  |  |  |
|  |  | @Nonnull |
| Expand Down | |  |

113 changes: 100 additions & 13 deletions

113
[jooby/src/main/java/org/jooby/handlers/AssetHandler.java](#diff-ac0a46c8fc571e7d113edccecb8b534b4d0c132b4ddb566533ff2942ca867c0a "jooby/src/main/java/org/jooby/handlers/AssetHandler.java")

Show comments

[View file](/jooby-project/jooby/blob/34f526028e6cd0652125baa33936ffb6a8a4a009/jooby/src/main/java/org/jooby/handlers/AssetHandler.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -206,7 +206,6 @@ |
|  |  | import com.google.common.base.Strings; |
|  |  | import com.typesafe.config.ConfigFactory; |
|  |  | import com.typesafe.config.ConfigValueFactory; |
|  |  | import static java.util.Objects.requireNonNull; |
|  |  | import org.jooby.Asset; |
|  |  | import org.jooby.Err; |
|  |  | import org.jooby.Jooby; |
| Expand All | | @@ -229,6 +228,8 @@ |
|  |  | import java.util.Date; |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | import static java.util.Objects.requireNonNull; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Serve static resources, via {@link Jooby#assets(String)} or variants. |
|  |  | \* |
| Expand Down  Expand Up | | @@ -287,6 +288,12 @@ private interface Loader { |
|  |  |  |
|  |  | private int statusCode = 404; |
|  |  |  |
|  |  | private String location; |
|  |  |  |
|  |  | private Path basedir; |
|  |  |  |
|  |  | private ClassLoader classLoader; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* <p> |
|  |  | \* Creates a new {@link AssetHandler}. The handler accepts a location pattern, that serve for |
| Expand Down  Expand Up | | @@ -315,7 +322,9 @@ private interface Loader { |
|  |  | \* @param loader The one who load the static resources. |
|  |  | \*/ |
|  |  | public AssetHandler(final String pattern, final ClassLoader loader) { |
|  |  | init(Route.normalize(pattern), Paths.get("public"), loader); |
|  |  | this.location = Route.normalize(pattern); |
|  |  | this.basedir = Paths.get("public"); |
|  |  | this.classLoader = loader; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -345,7 +354,9 @@ public AssetHandler(final String pattern, final ClassLoader loader) { |
|  |  | \* @param basedir Base directory. |
|  |  | \*/ |
|  |  | public AssetHandler(final Path basedir) { |
|  |  | init("/{0}", basedir, getClass().getClassLoader()); |
|  |  | this.location = "/{0}"; |
|  |  | this.basedir = basedir; |
|  |  | this.classLoader = getClass().getClassLoader(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -375,7 +386,9 @@ public AssetHandler(final Path basedir) { |
|  |  | \* @param pattern Pattern to locate static resources. |
|  |  | \*/ |
|  |  | public AssetHandler(final String pattern) { |
|  |  | init(Route.normalize(pattern), Paths.get("public"), getClass().getClassLoader()); |
|  |  | this.location = Route.normalize(pattern); |
|  |  | this.basedir = Paths.get("public"); |
|  |  | this.classLoader = getClass().getClassLoader(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -422,6 +435,45 @@ public AssetHandler maxAge(final long maxAge) { |
|  |  | return this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set the route definition and initialize the handler. |
|  |  | \* |
|  |  | \* @param route Route definition. |
|  |  | \* @return This handler. |
|  |  | \*/ |
|  |  | public AssetHandler setRoute(final Route.AssetDefinition route) { |
|  |  | String prefix; |
|  |  | boolean rootLocation = location.equals("/") || location.equals("/{0}"); |
|  |  | if (rootLocation) { |
|  |  | String pattern = route.pattern(); |
|  |  | int i = pattern.indexOf("/\*"); |
|  |  | if (i > 0) { |
|  |  | prefix = pattern.substring(0, i + 1); |
|  |  | } else { |
|  |  | prefix = pattern; |
|  |  | } |
|  |  | } else { |
|  |  | int i = location.indexOf("{"); |
|  |  | if (i > 0) { |
|  |  | prefix = location.substring(0, i); |
|  |  | } else { |
|  |  | /// TODO: review what we have here |
|  |  | prefix = location; |
|  |  | } |
|  |  | } |
|  |  | if (prefix.startsWith("/")) { |
|  |  | prefix = prefix.substring(1); |
|  |  | } |
|  |  | if (prefix.isEmpty() && rootLocation) { |
|  |  | throw new IllegalArgumentException( |
|  |  | "For security reasons root classpath access is not allowed. Map your static resources " |
|  |  | + "using a prefix like: assets(static/\*\*); or use a location classpath prefix like: " |
|  |  | + "assets(/, /static/{0})"); |
|  |  | } |
|  |  | init(prefix, location, basedir, classLoader); |
|  |  | return this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Parse value as {@link Duration}. If the value is already a number then it uses as seconds. |
|  |  | \* Otherwise, it parse expressions like: 8m, 1h, 365d, etc... |
| Expand Down  Expand Up | | @@ -485,7 +537,6 @@ public void handle(final Request req, final Response rsp) throws Throwable { |
|  |  | } |
|  |  |  |
|  |  | private void doHandle(final Request req, final Response rsp, final Asset asset) throws Throwable { |
|  |  |  |
|  |  | // handle etag |
|  |  | if (this.etag) { |
|  |  | String etag = asset.etag(); |
| Expand Down  Expand Up | | @@ -551,21 +602,22 @@ protected URL resolve(final String path) throws Exception { |
|  |  | return loader.getResource(path); |
|  |  | } |
|  |  |  |
|  |  | private void init(final String pattern, final Path basedir, final ClassLoader loader) { |
|  |  | private void init(final String classPathPrefix, final String location, final Path basedir, |
|  |  | final ClassLoader loader) { |
|  |  | requireNonNull(loader, "Resource loader is required."); |
|  |  | this.fn = pattern.equals("/") |
|  |  | this.fn = location.equals("/") |
|  |  | ? (req, p) -> prefix.apply(p) |
|  |  | : (req, p) -> MessageFormat.format(prefix.apply(pattern), vars(req)); |
|  |  | this.loader = loader(basedir, loader); |
|  |  | : (req, p) -> MessageFormat.format(prefix.apply(location), vars(req)); |
|  |  | this.loader = loader(basedir, classpathLoader(classPathPrefix, classLoader)); |
|  |  | } |
|  |  |  |
|  |  | private static Object[] vars(final Request req) { |
|  |  | Map<Object, String> vars = req.route().vars(); |
|  |  | return vars.values().toArray(new Object[vars.size()]); |
|  |  | } |
|  |  |  |
|  |  | private static Loader loader(final Path basedir, final ClassLoader classloader) { |
|  |  | if (Files.exists(basedir)) { |
|  |  | private static Loader loader(final Path basedir, Loader classpath) { |
|  |  | if (basedir != null && Files.exists(basedir)) { |
|  |  | return name -> { |
|  |  | Path path = basedir.resolve(name).normalize(); |
|  |  | if (Files.exists(path) && path.startsWith(basedir)) { |
| Expand All | | @@ -575,10 +627,45 @@ private static Loader loader(final Path basedir, final ClassLoader classloader) |
|  |  | // shh |
|  |  | } |
|  |  | } |
|  |  | return classloader.getResource(name); |
|  |  | return classpath.getResource(name); |
|  |  | }; |
|  |  | } |
|  |  | return classloader::getResource; |
|  |  | return classpath; |
|  |  | } |
|  |  |  |
|  |  | private static Loader classpathLoader(String prefix, ClassLoader classloader) { |
|  |  | return name -> { |
|  |  | String safePath = safePath(name); |
|  |  | if (safePath.startsWith(prefix)) { |
|  |  | URL resource = classloader.getResource(safePath); |
|  |  | return resource; |
|  |  | } |
|  |  | return null; |
|  |  | }; |
|  |  | } |
|  |  |  |
|  |  | private static String safePath(String name) { |
|  |  | if (name.indexOf("./") > 0) { |
|  |  | Path path = toPath(name.split("/")).normalize(); |
|  |  | return toStringPath(path); |
|  |  | } |
|  |  | return name; |
|  |  | } |
|  |  |  |
|  |  | private static String toStringPath(Path path) { |
|  |  | StringBuilder buffer = new StringBuilder(); |
|  |  | for (Path segment : path) { |
|  |  | buffer.append("/").append(segment); |
|  |  | } |
|  |  | return buffer.substring(1); |
|  |  | } |
|  |  |  |
|  |  | private static Path toPath(String[] segments) { |
|  |  | Path path = Paths.get(segments[0]); |
|  |  | for (int i = 1; i < segments.length; i++) { |
|  |  | path = path.resolve(segments[i]); |
|  |  | } |
|  |  | return path; |
|  |  | } |
|  |  |  |
|  |  | private static Throwing.Function<String, String> prefix() { |
| Expand Down | |  |

44 changes: 44 additions & 0 deletions

44
[jooby/src/main/java/org/jooby/internal/AssetSource.java](#diff-cab121a5f4d48a34cbc0c29b2204d27c6b011392075a2fdc9e9031127ba605e3 "jooby/src/main/java/org/jooby/internal/AssetSource.java")

Show comments

[View file](/jooby-project/jooby/blob/34f526028e6cd0652125baa33936ffb6a8a4a009/jooby/src/main/java/org/jooby/internal/AssetSource.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,44 @@ |
|  |  | package org.jooby.internal; |
|  |  |  |
|  |  | import com.google.common.base.Strings; |
|  |  |  |
|  |  | import java.net.MalformedURLException; |
|  |  | import java.net.URL; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  |  |
|  |  | public interface AssetSource { |
|  |  | URL getResource(String name); |
|  |  |  |
|  |  | static AssetSource fromClassPath(ClassLoader loader, String source) { |
|  |  | if (Strings.isNullOrEmpty(source) || "/".equals(source.trim())) { |
|  |  | throw new IllegalArgumentException( |
|  |  | "For security reasons root classpath access is not allowed: " + source); |
|  |  | } |
|  |  | return path -> { |
|  |  | URL resource = loader.getResource(path); |
|  |  | if (resource == null) { |
|  |  | return null; |
|  |  | } |
|  |  | String realPath = resource.getPath(); |
|  |  | if (realPath.startsWith(source)) { |
|  |  | return resource; |
|  |  | } |
|  |  | return null; |
|  |  | }; |
|  |  | } |
|  |  |  |
|  |  | static AssetSource fromFileSystem(Path basedir) { |
|  |  | return name -> { |
|  |  | Path path = basedir.resolve(name).normalize(); |
|  |  | if (Files.exists(path) && path.startsWith(basedir)) { |
|  |  | try { |
|  |  | return path.toUri().toURL(); |
|  |  | } catch (MalformedURLException x) { |
|  |  | // shh |
|  |  | } |
|  |  | } |
|  |  | return null; |
|  |  | }; |
|  |  | } |
|  |  | } |

43 changes: 25 additions & 18 deletions

43
[jooby/src/test/java/org/jooby/handlers/AssetHandlerTest.java](#diff-55593a7176a67eb6127c74910f7e240be00940de44aeaf2d543b664080d00eed "jooby/src/test/java/org/jooby/handlers/AssetHandlerTest.java")

Show comments

[View file](/jooby-project/jooby/blob/34f526028e6cd0652125baa33936ffb6a8a4a009/jooby/src/test/java/org/jooby/handlers/AssetHandlerTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,12 @@ |
|  |  | package org.jooby.handlers; |
|  |  |  |
|  |  | import static org.easymock.EasyMock.expect; |
|  |  | import static org.junit.Assert.assertNotNull; |
|  |  | import org.jooby.Route; |
|  |  | import org.jooby.test.MockUnit; |
|  |  | import org.jooby.test.MockUnit.Block; |
|  |  | import org.junit.Test; |
|  |  | import org.junit.runner.RunWith; |
|  |  | import org.powermock.core.classloader.annotations.PrepareForTest; |
|  |  | import org.powermock.modules.junit4.PowerMockRunner; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.net.MalformedURLException; |
| Expand All | | @@ -11,15 +16,11 @@ |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.Paths; |
|  |  |  |
|  |  | import org.jooby.test.MockUnit; |
|  |  | import org.jooby.test.MockUnit.Block; |
|  |  | import org.junit.Test; |
|  |  | import org.junit.runner.RunWith; |
|  |  | import org.powermock.core.classloader.annotations.PrepareForTest; |
|  |  | import org.powermock.modules.junit4.PowerMockRunner; |
|  |  | import static org.easymock.EasyMock.expect; |
|  |  | import static org.junit.Assert.assertNotNull; |
|  |  |  |
|  |  | @RunWith(PowerMockRunner.class) |
|  |  | @PrepareForTest({AssetHandler.class, File.class, Paths.class, Files.class }) |
|  |  | @PrepareForTest({AssetHandler.class, File.class, Paths.class, Files.class}) |
|  |  | public class AssetHandlerTest { |
|  |  |  |
|  |  | @Test |
| Expand All | | @@ -28,24 +29,30 @@ public void customClassloader() throws Exception { |
|  |  | new MockUnit(ClassLoader.class) |
|  |  | .expect(publicDir(uri, "JoobyTest.js")) |
|  |  | .run(unit -> { |
|  |  | URL value = new AssetHandler("/", unit.get(ClassLoader.class)) |
|  |  | URL value = newHandler(unit, "/") |
|  |  | .resolve("JoobyTest.js"); |
|  |  | assertNotNull(value); |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | private AssetHandler newHandler(MockUnit unit, String location) { |
|  |  | AssetHandler handler = new AssetHandler(location, unit.get(ClassLoader.class)); |
|  |  | new Route.AssetDefinition("GET", "/assets/\*\*", handler, false); |
|  |  | return handler; |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void shouldCallParentOnMissing() throws Exception { |
|  |  | URI uri = Paths.get("src", "test", "resources", "org", "jooby").toUri(); |
|  |  | new MockUnit(ClassLoader.class) |
|  |  | .expect(publicDir(uri, "index.js", false)) |
|  |  | .expect(publicDir(uri, "assets/index.js", false)) |
|  |  | .expect(unit -> { |
|  |  | ClassLoader loader = unit.get(ClassLoader.class); |
|  |  | expect(loader.getResource("index.js")).andReturn(uri.toURL()); |
|  |  | expect(loader.getResource("assets/index.js")).andReturn(uri.toURL()); |
|  |  | }) |
|  |  | .run(unit -> { |
|  |  | URL value = new AssetHandler("/", unit.get(ClassLoader.class)) |
|  |  | .resolve("index.js"); |
|  |  | URL value = newHandler(unit, "/") |
|  |  | .resolve("assets/index.js"); |
|  |  | assertNotNull(value); |
|  |  | }); |
|  |  | } |
| Expand All | | @@ -54,18 +61,18 @@ public void shouldCallParentOnMissing() throws Exception { |
|  |  | public void ignoreMalformedURL() throws Exception { |
|  |  | Path path = Paths.get("src", "test", "resources", "org", "jooby"); |
|  |  | new MockUnit(ClassLoader.class, URI.class) |
|  |  | .expect(publicDir(null, "index.js")) |
|  |  | .expect(publicDir(null, "assets/index.js")) |
|  |  | .expect(unit -> { |
|  |  | URI uri = unit.get(URI.class); |
|  |  | expect(uri.toURL()).andThrow(new MalformedURLException()); |
|  |  | }) |
|  |  | .expect(unit -> { |
|  |  | ClassLoader loader = unit.get(ClassLoader.class); |
|  |  | expect(loader.getResource("index.js")).andReturn(path.toUri().toURL()); |
|  |  | expect(loader.getResource("assets/index.js")).andReturn(path.toUri().toURL()); |
|  |  | }) |
|  |  | .run(unit -> { |
|  |  | URL value = new AssetHandler("/", unit.get(ClassLoader.class)) |
|  |  | .resolve("index.js"); |
|  |  | URL value = newHandler(unit, "/") |
|  |  | .resolve("assets/index.js"); |
|  |  | assertNotNull(value); |
|  |  | }); |
|  |  | } |
| Expand Down | |  |

31 changes: 31 additions & 0 deletions

31
[modules/coverage-report/src/test/java/org/jooby/issues/Issue1639.java](#diff-a523b06d1a0c8f5418353d88e4fdbfc76ef528a2e50c38e17fb9f95cdb4468ae "modules/coverage-report/src/test/java/org/jooby/issues/Issue1639.java")

Show comments

[View file](/jooby-project/jooby/blob/34f526028e6cd0652125baa33936ffb6a8a4a009/modules/coverage-report/src/test/java/org/jooby/issues/Issue1639.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,31 @@ |
|  |  | package org.jooby.issues; |
|  |  |  |
|  |  | import org.jooby.test.ServerFeature; |
|  |  | import org.junit.Test; |
|  |  |  |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.Paths; |
|  |  |  |
|  |  | import static org.junit.Assert.assertTrue; |
|  |  |  |
|  |  | public class Issue1639 extends ServerFeature { |
|  |  |  |
|  |  | { |
|  |  | Path dir = Paths.get(System.getProperty("user.dir"), "src", "test", "resources", "assets"); |
|  |  | assertTrue(Files.exists(dir)); |
|  |  | assets("/static/\*\*", dir); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void shouldNotFallbackToArbitraryClasspathResources() throws Exception { |
|  |  | request() |
|  |  | .get("/static/WEB-INF/web2.xml") |
|  |  | .expect(404); |
|  |  |  |
|  |  | request() |
|  |  | .get("/static/../WEB-INF/web2.xml") |
|  |  | .expect(404); |
|  |  | } |
|  |  |  |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `34f5260`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjooby-project%2Fjooby%2Fcommit%2F34f526028e6cd0652125baa33936ffb6a8a4a009) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


