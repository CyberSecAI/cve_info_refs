=== Content from tools.ietf.org_e5970a66_20250119_131650.html ===


* Light
* Dark
* Auto

[RFC 7009

Proposed Standard](/doc/rfc7009/)

|  | Title |  | OAuth 2.0 Token Revocation |
| --- | --- | --- | --- |
| Document | Document type |  | RFC - Proposed Standard  August 2013  [View errata](https://www.rfc-editor.org/errata_search.php?rfc=7009 "Click to view errata.") [Report errata](https://www.rfc-editor.org/errata.php#reportnew "Click to report an error in the document.") Was [draft-ietf-oauth-revocation](/doc/draft-ietf-oauth-revocation/11/) ([oauth WG](/wg/oauth/about/)) |
| --- | --- | --- | --- |
|  | Select version |  | * [00](/doc/html/draft-ietf-oauth-revocation-00) * [01](/doc/html/draft-ietf-oauth-revocation-01) * [02](/doc/html/draft-ietf-oauth-revocation-02) * [03](/doc/html/draft-ietf-oauth-revocation-03) * [04](/doc/html/draft-ietf-oauth-revocation-04) * [05](/doc/html/draft-ietf-oauth-revocation-05) * [06](/doc/html/draft-ietf-oauth-revocation-06) * [07](/doc/html/draft-ietf-oauth-revocation-07) * [08](/doc/html/draft-ietf-oauth-revocation-08) * [09](/doc/html/draft-ietf-oauth-revocation-09) * [10](/doc/html/draft-ietf-oauth-revocation-10) * [11](/doc/html/draft-ietf-oauth-revocation-11) * [RFC 7009](/doc/html/rfc7009) |
|  | Compare versions |  | RFC 7009  draft-ietf-oauth-revocation-11  draft-ietf-oauth-revocation-10  draft-ietf-oauth-revocation-09  draft-ietf-oauth-revocation-08  draft-ietf-oauth-revocation-07  draft-ietf-oauth-revocation-06  draft-ietf-oauth-revocation-05  draft-ietf-oauth-revocation-04  draft-ietf-oauth-revocation-03  draft-ietf-oauth-revocation-02  draft-ietf-oauth-revocation-01  draft-ietf-oauth-revocation-00   RFC 7009  draft-ietf-oauth-revocation-11  draft-ietf-oauth-revocation-10  draft-ietf-oauth-revocation-09  draft-ietf-oauth-revocation-08  draft-ietf-oauth-revocation-07  draft-ietf-oauth-revocation-06  draft-ietf-oauth-revocation-05  draft-ietf-oauth-revocation-04  draft-ietf-oauth-revocation-03  draft-ietf-oauth-revocation-02  draft-ietf-oauth-revocation-01  draft-ietf-oauth-revocation-00   Side-by-side  Inline |
|  | Authors |  | [Torsten Lodderstedt](/person/torsten%40lodderstedt.net "Datatracker profile of Torsten Lodderstedt") , [Stefanie Dronia](/person/sdronia%40gmx.de "Datatracker profile of Stefanie Dronia") , [Marius Scurtescu](/person/mscurtescu%40google.com "Datatracker profile of Marius Scurtescu")   Email authors |
|  | RFC stream |  | IETF Logo IETF Logo |
|  | Other formats |  | [txt](https://www.rfc-editor.org/rfc/rfc7009.txt) [html](https://www.rfc-editor.org/rfc/rfc7009.html) [pdf](https://www.rfc-editor.org/rfc/pdfrfc/rfc7009.txt.pdf) [bibtex](/doc/rfc7009/bibtex/) |
|  | Additional resources |  | [Mailing list discussion](https://mailarchive.ietf.org/arch/browse/oauth/?q=rfc7009 OR %22draft-ietf-oauth-revocation%22) |
|  |  |  | [Report a bug](https://github.com/ietf-tools/datatracker/issues/new/choose) |

```
Internet Engineering Task Force (IETF)               T. Lodderstedt, Ed.
Request for Comments: 7009                           Deutsche Telekom AG
Category: Standards Track                                      S. Dronia
ISSN: 2070-1721
                                                            M. Scurtescu
                                                                  Google
                                                             August 2013

                       OAuth 2.0 Token Revocation

Abstract

   This document proposes an additional endpoint for OAuth authorization
   servers, which allows clients to notify the authorization server that
   a previously obtained refresh or access token is no longer needed.
   This allows the authorization server to clean up security
   credentials.  A revocation request will invalidate the actual token
   and, if applicable, other tokens based on the same authorization
   grant.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in [Section 2 of RFC 5741](/doc/html/rfc5741#section-2).

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <http://www.rfc-editor.org/info/rfc7009>.

Lodderstedt, et al.          Standards Track                    [Page 1]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to [BCP 78](/doc/html/bcp78) and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<http://trustee.ietf.org/license-info>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   [1](#section-1).  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   [3](#page-3)
     [1.1](#section-1.1).  Requirements Language . . . . . . . . . . . . . . . . . .   [3](#page-3)
   [2](#section-2).  Token Revocation  . . . . . . . . . . . . . . . . . . . . . .   [3](#page-3)
     [2.1](#section-2.1).  Revocation Request  . . . . . . . . . . . . . . . . . . .   [4](#page-4)
     [2.2](#section-2.2).  Revocation Response . . . . . . . . . . . . . . . . . . .   [5](#page-5)
       [2.2.1](#section-2.2.1).  Error Response  . . . . . . . . . . . . . . . . . . .   [6](#page-6)
     [2.3](#section-2.3).  Cross-Origin Support  . . . . . . . . . . . . . . . . . .   [6](#page-6)
   [3](#section-3).  Implementation Note . . . . . . . . . . . . . . . . . . . . .   [7](#page-7)
   [4](#section-4).  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   [8](#page-8)
     [4.1](#section-4.1).  OAuth Extensions Error Registration . . . . . . . . . . .   [8](#page-8)
       [4.1.1](#section-4.1.1).  The "unsupported_token_type" Error Value  . . . . . .   [8](#page-8)
       [4.1.2](#section-4.1.2).  OAuth Token Type Hints Registry . . . . . . . . . . .   [8](#page-8)
         [4.1.2.1](#section-4.1.2.1).  Registration Template . . . . . . . . . . . . . .   [9](#page-9)
         [4.1.2.2](#section-4.1.2.2).  Initial Registry Contents . . . . . . . . . . . .   [9](#page-9)
   [5](#section-5).  Security Considerations . . . . . . . . . . . . . . . . . . .   [9](#page-9)
   [6](#section-6).  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  [10](#page-10)
   [7](#section-7).  References  . . . . . . . . . . . . . . . . . . . . . . . . .  [10](#page-10)
     [7.1](#section-7.1).  Normative References  . . . . . . . . . . . . . . . . . .  [10](#page-10)
     [7.2](#section-7.2).  Informative References  . . . . . . . . . . . . . . . . .  [11](#page-11)

Lodderstedt, et al.          Standards Track                    [Page 2]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

[1](#section-1).  Introduction

   The OAuth 2.0 core specification [[RFC6749](/doc/html/rfc6749 "\"The OAuth 2.0 Authorization Framework\"")] defines several ways for a
   client to obtain refresh and access tokens.  This specification
   supplements the core specification with a mechanism to revoke both
   types of tokens.  A token is a string representing an authorization
   grant issued by the resource owner to the client.  A revocation
   request will invalidate the actual token and, if applicable, other
   tokens based on the same authorization grant and the authorization
   grant itself.

   From an end-user's perspective, OAuth is often used to log into a
   certain site or application.  This revocation mechanism allows a
   client to invalidate its tokens if the end-user logs out, changes
   identity, or uninstalls the respective application.  Notifying the
   authorization server that the token is no longer needed allows the
   authorization server to clean up data associated with that token
   (e.g., session data) and the underlying authorization grant.  This
   behavior prevents a situation in which there is still a valid
   authorization grant for a particular client of which the end-user is
   not aware.  This way, token revocation prevents abuse of abandoned
   tokens and facilitates a better end-user experience since invalidated
   authorization grants will no longer turn up in a list of
   authorization grants the authorization server might present to the
   end-user.

[1.1](#section-1.1).  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC 2119](/doc/html/rfc2119) [[RFC2119](/doc/html/rfc2119 "\"Key words for use in RFCs to Indicate Requirement Levels\"")].

[2](#section-2).  Token Revocation

   Implementations MUST support the revocation of refresh tokens and
   SHOULD support the revocation of access tokens (see Implementation
   Note).

   The client requests the revocation of a particular token by making an
   HTTP POST request to the token revocation endpoint URL.  This URL
   MUST conform to the rules given in [[RFC6749], Section 3.1](/doc/html/rfc6749#section-3.1).  Clients
   MUST verify that the URL is an HTTPS URL.

   The means to obtain the location of the revocation endpoint is out of
   the scope of this specification.  For example, the client developer
   may consult the server's documentation or automatic discovery may be
   used.  As this endpoint is handling security credentials, the
   endpoint location needs to be obtained from a trustworthy source.

Lodderstedt, et al.          Standards Track                    [Page 3]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

   Since requests to the token revocation endpoint result in the
   transmission of plaintext credentials in the HTTP request, URLs for
   token revocation endpoints MUST be HTTPS URLs.  The authorization
   server MUST use Transport Layer Security (TLS) [[RFC5246](/doc/html/rfc5246 "\"The Transport Layer Security (TLS) Protocol Version 1.2\"")] in a version
   compliant with [[RFC6749], Section 1.6](/doc/html/rfc6749#section-1.6).  Implementations MAY also
   support additional transport-layer security mechanisms that meet
   their security requirements.

   If the host of the token revocation endpoint can also be reached over
   HTTP, then the server SHOULD also offer a revocation service at the
   corresponding HTTP URI, but it MUST NOT publish this URI as a token
   revocation endpoint.  This ensures that tokens accidentally sent over
   HTTP will be revoked.

[2.1](#section-2.1).  Revocation Request

   The client constructs the request by including the following
   parameters using the "application/x-www-form-urlencoded" format in
   the HTTP request entity-body:

   token   REQUIRED.  The token that the client wants to get revoked.

   token_type_hint  OPTIONAL.  A hint about the type of the token
           submitted for revocation.  Clients MAY pass this parameter in
           order to help the authorization server to optimize the token
           lookup.  If the server is unable to locate the token using
           the given hint, it MUST extend its search across all of its
           supported token types.  An authorization server MAY ignore
           this parameter, particularly if it is able to detect the
           token type automatically.  This specification defines two
           such values:

           * access_token: An access token as defined in [[RFC6749],
             Section 1.4](/doc/html/rfc6749#section-1.4)

           * refresh_token: A refresh token as defined in [[RFC6749],
             Section 1.5](/doc/html/rfc6749#section-1.5)

           Specific implementations, profiles, and extensions of this
           specification MAY define other values for this parameter
           using the registry defined in [Section 4.1.2](#section-4.1.2).

   The client also includes its authentication credentials as described
   in [Section 2.3. of [RFC6749]](/doc/html/rfc6749#section-2.3).

Lodderstedt, et al.          Standards Track                    [Page 4]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

   For example, a client may request the revocation of a refresh token
   with the following request:

     POST /revoke HTTP/1.1
     Host: server.example.com
     Content-Type: application/x-www-form-urlencoded
     Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

     token=45ghiukldjahdnhzdauz&token_type_hint=refresh_token

   The authorization server first validates the client credentials (in
   case of a confidential client) and then verifies whether the token
   was issued to the client making the revocation request.  If this
   validation fails, the request is refused and the client is informed
   of the error by the authorization server as described below.

   In the next step, the authorization server invalidates the token.
   The invalidation takes place immediately, and the token cannot be
   used again after the revocation.  In practice, there could be a
   propagation delay, for example, in which some servers know about the
   invalidation while others do not.  Implementations should minimize
   that window, and clients must not try to use the token after receipt
   of an HTTP 200 response from the server.

   Depending on the authorization server's revocation policy, the
   revocation of a particular token may cause the revocation of related
   tokens and the underlying authorization grant.  If the particular
   token is a refresh token and the authorization server supports the
   revocation of access tokens, then the authorization server SHOULD
   also invalidate all access tokens based on the same authorization
   grant (see Implementation Note).  If the token passed to the request
   is an access token, the server MAY revoke the respective refresh
   token as well.

   Note: A client compliant with [[RFC6749](/doc/html/rfc6749 "\"The OAuth 2.0 Authorization Framework\"")] must be prepared to handle
   unexpected token invalidation at any time.  Independent of the
   revocation mechanism specified in this document, resource owners may
   revoke authorization grants, or the authorization server may
   invalidate tokens in order to mitigate security threats.  Thus,
   having different server policies with respect to cascading the
   revocation of tokens should not pose interoperability problems.

[2.2](#section-2.2).  Revocation Response

   The authorization server responds with HTTP status code 200 if the
   token has been revoked successfully or if the client submitted an
   invalid token.

Lodderstedt, et al.          Standards Track                    [Page 5]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

   Note: invalid tokens do not cause an error response since the client
   cannot handle such an error in a reasonable way.  Moreover, the
   purpose of the revocation request, invalidating the particular token,
   is already achieved.

   The content of the response body is ignored by the client as all
   necessary information is conveyed in the response code.

   An invalid token type hint value is ignored by the authorization
   server and does not influence the revocation response.

[2.2.1](#section-2.2.1).  Error Response

   The error presentation conforms to the definition in [Section 5.2 of
   [RFC6749]](/doc/html/rfc6749#section-5.2).  The following additional error code is defined for the
   token revocation endpoint:

   unsupported_token_type:  The authorization server does not support
           the revocation of the presented token type.  That is, the
           client tried to revoke an access token on a server not
           supporting this feature.

   If the server responds with HTTP status code 503, the client must
   assume the token still exists and may retry after a reasonable delay.
   The server may include a "Retry-After" header in the response to
   indicate how long the service is expected to be unavailable to the
   requesting client.

[2.3](#section-2.3).  Cross-Origin Support

   The revocation endpoint MAY support Cross-Origin Resource Sharing
   (CORS) [[W3C.WD-cors-20120403](#ref-W3C.WD-cors-20120403)] if it is aimed at use in combination
   with user-agent-based applications.

   In addition, for interoperability with legacy user-agents, it MAY
   also offer JSONP (Remote JSON - JSONP) [[jsonp](#ref-jsonp "\"Remote JSON - JSONP\"")] by allowing GET
   requests with an additional parameter:

   callback  OPTIONAL.  The qualified name of a JavaScript function.

   For example, a client may request the revocation of an access token
   with the following request (line breaks are for display purposes
   only):

     https://example.com/revoke?token=agabcdefddddafdd&
     callback=package.myCallback

Lodderstedt, et al.          Standards Track                    [Page 6]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

   Successful response:

     package.myCallback();

   Error response:

     package.myCallback({"error":"unsupported_token_type"});

   Clients should be aware that when relying on JSONP, a malicious
   revocation endpoint may attempt to inject malicious code into the
   client.

[3](#section-3).  Implementation Note

   OAuth 2.0 allows deployment flexibility with respect to the style of
   access tokens.  The access tokens may be self-contained so that a
   resource server needs no further interaction with an authorization
   server issuing these tokens to perform an authorization decision of
   the client requesting access to a protected resource.  A system
   design may, however, instead use access tokens that are handles
   referring to authorization data stored at the authorization server.
   This consequently requires a resource server to issue a request to
   the respective authorization server to retrieve the content of the
   access token every time a client presents an access token.

   While these are not the only options, they illustrate the
   implications for revocation.  In the latter case, the authorization
   server is able to revoke an access token previously issued to a
   client when the resource server relays a received access token.  In
   the former case, some (currently non-standardized) backend
   interaction between the authorization server and the resource server
   may be used when immediate access token revocation is desired.
   Another design alternative is to issue short-lived access tokens,
   which can be refreshed at any time using the corresponding refresh
   tokens.  This allows the authorization server to impose a limit on
   the time revoked when access tokens are in use.

   Which approach of token revocation is chosen will depend on the
   overall system design and on the application service provider's risk
   analysis.  The cost of revocation in terms of required state and
   communication overhead is ultimately the result of the desired
   security properties.

Lodderstedt, et al.          Standards Track                    [Page 7]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

[4](#section-4).  IANA Considerations

   This specification registers an error value in the "OAuth Extensions
   Error Registry" and establishes the "OAuth Token Type Hints"
   registry.

[4.1](#section-4.1).  OAuth Extensions Error Registration

   This specification registers the following error value in the "OAuth
   Extensions Error Registry" defined in [[RFC6749](/doc/html/rfc6749 "\"The OAuth 2.0 Authorization Framework\"")].

[4.1.1](#section-4.1.1).  The "unsupported_token_type" Error Value

   Error name:  unsupported_token_type

   Error Usage Location:  Revocation endpoint error response

   Related Protocol Extension:  Token Revocation Endpoint

   Change controller:  IETF

   Specification document(s):  [[RFC7009](/doc/html/rfc7009)]

[4.1.2](#section-4.1.2).  OAuth Token Type Hints Registry

   This specification establishes the "OAuth Token Type Hints" registry.
   Possible values of the parameter "token_type_hint" (see [Section 2.1](#section-2.1))
   are registered with a Specification Required ([[RFC5226](/doc/html/rfc5226)]) after a two-
   week review period on the oauth-ext-review@ietf.org mailing list, on
   the advice of one or more Designated Experts.  However, to allow for
   the allocation of values prior to publication, the Designated
   Expert(s) may approve registration once they are satisfied that such
   a specification will be published.  Registration requests must be
   sent to the oauth-ext-review@ietf.org mailing list for review and
   comment, with an appropriate subject (e.g., "Request for parameter:
   example").  Within the review period, the Designated Expert(s) will
   either approve or deny the registration request, communicating this
   decision to the review list and IANA.  Denials should include an
   explanation and, if applicable, suggestions as to how to make the
   request successful.  IANA must only accept registry updates from the
   Designated Expert(s) and should direct all requests for registration
   to the review mailing list.

Lodderstedt, et al.          Standards Track                    [Page 8]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

[4.1.2.1](#section-4.1.2.1).  Registration Template

   Hint Value:  The additional value, which can be used to indicate a
      certain token type to the authorization server.

   Change controller:  For Standards Track RFCs, state "IETF".  For
      others, give the name of the responsible party.  Other details
      (e.g., postal address, email address, and home page URI) may also
      be included.

   Specification document(s):  Reference to the document(s) that
      specifies the type, preferably including a URI that can be used to
      retrieve a copy of the document(s).  An indication of the relevant
      sections may also be included but is not required.

[4.1.2.2](#section-4.1.2.2).  Initial Registry Contents

   The OAuth Token Type Hint registry's initial contents are as follows.

             +---------------+-------------------+-----------+
             |   Hint Value  | Change Controller | Reference |
             +---------------+-------------------+-----------+
             |  access_token |        IETF       | [[RFC7009](/doc/html/rfc7009)] |
             | refresh_token |        IETF       | [[RFC7009](/doc/html/rfc7009)] |
             +---------------+-------------------+-----------+

         Table 1: OAuth Token Type Hints initial registry contents

[5](#section-5).  Security Considerations

   If the authorization server does not support access token revocation,
   access tokens will not be immediately invalidated when the
   corresponding refresh token is revoked.  Deployments must take this
   into account when conducting their security risk analysis.

   Cleaning up tokens using revocation contributes to overall security
   and privacy since it reduces the likelihood for abuse of abandoned
   tokens.  This specification in general does not intend to provide
   countermeasures against token theft and abuse.  For a discussion of
   respective threats and countermeasures, consult the security
   considerations given in [Section 10](#section-10) of the OAuth core specification
   [[RFC6749](/doc/html/rfc6749 "\"The OAuth 2.0 Authorization Framework\"")] and the OAuth threat model document [[RFC6819](/doc/html/rfc6819 "\"OAuth 2.0 Threat Model and Security Considerations\"")].

   Malicious clients could attempt to use the new endpoint to launch
   denial-of-service attacks on the authorization server.  Appropriate
   countermeasures, which should be in place for the token endpoint as
   well, MUST be applied to the revocation endpoint (see [[RFC6819],
   Section 4.4.1.11](/doc/html/rfc6819#section-4.4.1.11)).  Specifically, invalid token type hints may

Lodderstedt, et al.          Standards Track                    [Page 9]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

   misguide the authorization server and cause additional database
   lookups.  Care MUST be taken to prevent malicious clients from
   exploiting this feature to launch denial-of-service attacks.

   A malicious client may attempt to guess valid tokens on this endpoint
   by making revocation requests against potential token strings.
   According to this specification, a client's request must contain a
   valid client_id, in the case of a public client, or valid client
   credentials, in the case of a confidential client.  The token being
   revoked must also belong to the requesting client.  If an attacker is
   able to successfully guess a public client's client_id and one of
   their tokens, or a private client's credentials and one of their
   tokens, they could do much worse damage by using the token elsewhere
   than by revoking it.  If they chose to revoke the token, the
   legitimate client will lose its authorization grant and will need to
   prompt the user again.  No further damage is done and the guessed
   token is now worthless.

   Since the revocation endpoint is handling security credentials,
   clients need to obtain its location from a trustworthy source only.
   Otherwise, an attacker could capture valid security tokens by
   utilizing a counterfeit revocation endpoint.  Moreover, in order to
   detect counterfeit revocation endpoints, clients MUST authenticate
   the revocation endpoint (certificate validation, etc.).

[6](#section-6).  Acknowledgements

   We would like to thank Peter Mauritius, Amanda Anganes, Mark Wubben,
   Hannes Tschofenig, Michiel de Jong, Doug Foiles, Paul Madsen, George
   Fletcher, Sebastian Ebling, Christian Stuebner, Brian Campbell, Igor
   Faynberg, Lukas Rosenstock, and Justin Richer for their valuable
   feedback.

[7](#section-7).  References

[7.1](#section-7.1).  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", [BCP 14](/doc/html/bcp14), [RFC 2119](/doc/html/rfc2119), March 1997.

   [RFC5226]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", [BCP 26](/doc/html/bcp26), [RFC 5226](/doc/html/rfc5226),
              May 2008.

   [RFC5246]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", [RFC 5246](/doc/html/rfc5246), August 2008.

Lodderstedt, et al.          Standards Track                   [Page 10]
```

---

```

[RFC 7009](/doc/html/rfc7009)                    Token Revocation                 August 2013

   [RFC6749]  Hardt, D., "The OAuth 2.0 Authorization Framework",
              [RFC 6749](/doc/html/rfc6749), October 2012.

[7.2](#section-7.2).  Informative References

   [RFC6819]  Lodderstedt, T., McGloin, M., and P. Hunt, "OAuth 2.0
              Threat Model and Security Considerations", [RFC 6819](/doc/html/rfc6819),
              January 2013.

   [W3C.WD-cors-20120403]
              Kesteren, A., "Cross-Origin Resource Sharing", World Wide
              Web Consortium LastCall WD-cors-20120403, April 2012,
              <<http://www.w3.org/TR/2012/WD-cors-20120403>>.

   [jsonp]    Ippolito, B., "Remote JSON - JSONP", December 2005,
              <[http://bob.pythonmac.org/archives/2005/12/05/](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp)
              [remote-json-jsonp](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp)>.

Authors' Addresses

   Torsten Lodderstedt (editor)
   Deutsche Telekom AG

   EMail: torsten@lodderstedt.net

   Stefanie Dronia

   EMail: sdronia@gmx.de

   Marius Scurtescu
   Google

   EMail: mscurtescu@google.com

Lodderstedt, et al.          Standards Track                   [Page 11]

```

[Datatracker](/doc/rfc7009/)

RFC 7009

RFC
- Proposed Standard

* Info
* Contents
* Prefs

| Document | Document type |  | RFC - Proposed Standard  August 2013  [View errata](https://www.rfc-editor.org/errata_search.php?rfc=7009 "Click to view errata.") [Report errata](https://www.rfc-editor.org/errata.php#reportnew "Click to report an error in the document.") Was [draft-ietf-oauth-revocation](/doc/draft-ietf-oauth-revocation/11/) ([oauth WG](/wg/oauth/about/)) |
| --- | --- | --- | --- |
|  | Select version |  | * [00](/doc/html/draft-ietf-oauth-revocation-00) * [01](/doc/html/draft-ietf-oauth-revocation-01) * [02](/doc/html/draft-ietf-oauth-revocation-02) * [03](/doc/html/draft-ietf-oauth-revocation-03) * [04](/doc/html/draft-ietf-oauth-revocation-04) * [05](/doc/html/draft-ietf-oauth-revocation-05) * [06](/doc/html/draft-ietf-oauth-revocation-06) * [07](/doc/html/draft-ietf-oauth-revocation-07) * [08](/doc/html/draft-ietf-oauth-revocation-08) * [09](/doc/html/draft-ietf-oauth-revocation-09) * [10](/doc/html/draft-ietf-oauth-revocation-10) * [11](/doc/html/draft-ietf-oauth-revocation-11) * [RFC 7009](/doc/html/rfc7009) |
|  | Compare versions |  | RFC 7009  draft-ietf-oauth-revocation-11  draft-ietf-oauth-revocation-10  draft-ietf-oauth-revocation-09  draft-ietf-oauth-revocation-08  draft-ietf-oauth-revocation-07  draft-ietf-oauth-revocation-06  draft-ietf-oauth-revocation-05  draft-ietf-oauth-revocation-04  draft-ietf-oauth-revocation-03  draft-ietf-oauth-revocation-02  draft-ietf-oauth-revocation-01  draft-ietf-oauth-revocation-00   RFC 7009  draft-ietf-oauth-revocation-11  draft-ietf-oauth-revocation-10  draft-ietf-oauth-revocation-09  draft-ietf-oauth-revocation-08  draft-ietf-oauth-revocation-07  draft-ietf-oauth-revocation-06  draft-ietf-oauth-revocation-05  draft-ietf-oauth-revocation-04  draft-ietf-oauth-revocation-03  draft-ietf-oauth-revocation-02  draft-ietf-oauth-revocation-01  draft-ietf-oauth-revocation-00   Side-by-side  Inline |
|  | Authors |  | [Torsten Lodderstedt](/person/torsten%40lodderstedt.net "Datatracker profile of Torsten Lodderstedt") , [Stefanie Dronia](/person/sdronia%40gmx.de "Datatracker profile of Stefanie Dronia") , [Marius Scurtescu](/person/mscurtescu%40google.com "Datatracker profile of Marius Scurtescu")   Email authors |
|  | RFC stream |  | IETF Logo IETF Logo |
|  | Other formats |  | [txt](https://www.rfc-editor.org/rfc/rfc7009.txt) [html](https://www.rfc-editor.org/rfc/rfc7009.html) [pdf](https://www.rfc-editor.org/rfc/pdfrfc/rfc7009.txt.pdf) [bibtex](/doc/rfc7009/bibtex/) |
|  | Additional resources |  | [Mailing list discussion](https://mailarchive.ietf.org/arch/browse/oauth/?q=rfc7009 OR %22draft-ietf-oauth-revocation%22) |

[Report a datatracker bug](https://github.com/ietf-tools/datatracker/issues/new/choose)

Show sidebar by default

Yes

No

Tab to show by default

Info

Contents

HTMLization configuration

HTMLize the plaintext

Plaintextify the HTML

Maximum font size

Page dependencies

Inline

Reference

Citation links

 Go to reference section

Go to linked document

![](//analytics.ietf.org/piwik.php?idsite=7)



=== Content from github.com_549acfab_20250119_112329.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fory%2Ffosite%2Fsecurity%2Fadvisories%2FGHSA-7mqr-2v3q-v2wm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fory%2Ffosite%2Fsecurity%2Fadvisories%2FGHSA-7mqr-2v3q-v2wm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=ory%2Ffosite)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ory](/ory)
/
**[fosite](/ory/fosite)**
Public

* [Notifications](/login?return_to=%2Fory%2Ffosite) You must be signed in to change notification settings
* [Fork
  368](/login?return_to=%2Fory%2Ffosite)
* [Star
   2.3k](/login?return_to=%2Fory%2Ffosite)

* [Code](/ory/fosite)
* [Issues
  25](/ory/fosite/issues)
* [Pull requests
  19](/ory/fosite/pulls)
* [Actions](/ory/fosite/actions)
* [Security](/ory/fosite/security)
* [Insights](/ory/fosite/pulse)

Additional navigation options

* [Code](/ory/fosite)
* [Issues](/ory/fosite/issues)
* [Pull requests](/ory/fosite/pulls)
* [Actions](/ory/fosite/actions)
* [Security](/ory/fosite/security)
* [Insights](/ory/fosite/pulse)

# Token revokation incorrectly ignores storage errors

Low

[aeneasr](/aeneasr)
published
GHSA-7mqr-2v3q-v2wm
Sep 24, 2020

## Package

No package listed

## Affected versions

<=v0.33.0

## Patched versions

v0.34.0

## Description

### Impact

The `TokenRevocationHandler` ignores errors coming from the storage. This can lead to unexpected 200 status codes indicating successful revocation while the token is still valid. Whether an attacker can use this for her advantage depends on the ability to trigger errors in the store.

### Patches

The next release will patch this.

### Workarounds

None.

### References

[RFC 7009](https://tools.ietf.org/html/rfc7009#section-2.2.1) states that a 503 HTTP code must be returned when the server has a problem.

### Severity

Low

### CVE ID

CVE-2020-15223

### Weaknesses

No CWEs

### Credits

* [![@jclebreton](https://avatars.githubusercontent.com/u/6444525?s=40&v=4)](/jclebreton)
  [jclebreton](/jclebreton)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f0560197_20250119_112328.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fory%2Ffosite%2Fcommit%2F03dd55813f5521985f7dd64277b7ba0cf1441319)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fory%2Ffosite%2Fcommit%2F03dd55813f5521985f7dd64277b7ba0cf1441319)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ory%2Ffosite)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ory](/ory)
/
**[fosite](/ory/fosite)**
Public

* [Notifications](/login?return_to=%2Fory%2Ffosite) You must be signed in to change notification settings
* [Fork
  368](/login?return_to=%2Fory%2Ffosite)
* [Star
   2.3k](/login?return_to=%2Fory%2Ffosite)

* [Code](/ory/fosite)
* [Issues
  25](/ory/fosite/issues)
* [Pull requests
  19](/ory/fosite/pulls)
* [Actions](/ory/fosite/actions)
* [Security](/ory/fosite/security)
* [Insights](/ory/fosite/pulse)

Additional navigation options

* [Code](/ory/fosite)
* [Issues](/ory/fosite/issues)
* [Pull requests](/ory/fosite/pulls)
* [Actions](/ory/fosite/actions)
* [Security](/ory/fosite/security)
* [Insights](/ory/fosite/pulse)

## Commit

[Permalink](/ory/fosite/commit/03dd55813f5521985f7dd64277b7ba0cf1441319)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-7mqr-2v3q-v2wm](https://github.com/advisories/GHSA-7mqr-2v3q-v2wm "GHSA-7mqr-2v3q-v2wm")

[Browse files](/ory/fosite/tree/03dd55813f5521985f7dd64277b7ba0cf1441319)
Browse the repository at this point in the history

```
BREAKING CHANGE: `fosite.ErrRevocationClientMismatch` was removed because it is not part of [RFC 6749](<https://tools.ietf.org/html/rfc6749#section-5.2>). Instead, `fosite.ErrUnauthorizedClient` will be returned when calling `RevokeToken` with an OAuth2 Client which does not match the Access or Refresh Token to be revoked.
```

* Loading branch information

[![@zepatrik](https://avatars.githubusercontent.com/u/5354445?s=40&v=4)](/zepatrik)

[zepatrik](/ory/fosite/commits?author=zepatrik "View all commits by zepatrik")
authored
Sep 24, 2020

1 parent
[6f28055](/ory/fosite/commit/6f280551a3b1361bad1b4a73aa5637a23ca65b52)

commit 03dd558

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**103 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .golangci.yml
  [.golangci.yml](#diff-6179837f7df53a6f05c522b6b7bb566d484d5465d9894fb04910dd08bb40dcc9)
* access\_error.go
  [access\_error.go](#diff-29f73e9fd3710eaa75d61a03853946f6d22a48d4db21bc9c8e8e6e77199fcbd4)
* access\_write.go
  [access\_write.go](#diff-ecd43c3a6365408ff3b557a9e82cf36ddf6b49371bb044b47b289101924d4566)
* authorize\_error.go
  [authorize\_error.go](#diff-9805546fcddd9a654d6c7acf80e8a0861491d38a91374297b4b179e93e348022)
* errors.go
  [errors.go](#diff-76a7e0e299c7417bae32d3098e71370980157fe29e68a366671491d147d40572)
* errors\_test.go
  [errors\_test.go](#diff-5c4d3e0fb6348a54d285f0812da0b323800e6e8c5d30b93e92a40677a267810f)
* go\_mod\_indirect\_pins.go
  [go\_mod\_indirect\_pins.go](#diff-5a1dba9575b60980fca9fa45b839e2575519f53ab136075d14673198e79a50fb)
* handler

  + oauth2

    - handler/oauth2/revocation.go
      [revocation.go](#diff-91ab80a56e140fe7525a5e7d7dc2cac29a2647e7f12138a4de03519bfa607042)
    - handler/oauth2/revocation\_test.go
      [revocation\_test.go](#diff-5e87683bb6baef376099d54a01b2645464ca39fdbbacc9eb52ac9a94f1bdfc25)
  + openid

    - handler/openid/helper.go
      [helper.go](#diff-af7a06667ee6a65adcff19610eadf98ba25d04c1f5f7a3bf148489613d74b62f)
* revoke\_handler.go
  [revoke\_handler.go](#diff-539c9cbad1056e9e46f1cf88ef81698d4871a30485e1cd824a16b3d089d868e1)
* token/hmac

  + token/hmac/hmacsha.go
    [hmacsha.go](#diff-b92270a81f4021a9cdf52dfcfaeac9b66254471b85fd5ef4101acdbad02e4296)

## There are no files selected for viewing

1 change: 0 additions & 1 deletion

1
[.golangci.yml](#diff-6179837f7df53a6f05c522b6b7bb566d484d5465d9894fb04910dd08bb40dcc9 ".golangci.yml")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/.golangci.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,6 @@ linters: |
|  |  | - deadcode |
|  |  | - unused |
|  |  | - structcheck |
|  |  | - errcheck |
|  |  | - gosimple |
|  |  | - bodyclose |
|  |  | - staticcheck |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[access\_error.go](#diff-29f73e9fd3710eaa75d61a03853946f6d22a48d4db21bc9c8e8e6e77199fcbd4 "access_error.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/access_error.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,5 +53,6 @@ func (f \*Fosite) writeJsonError(rw http.ResponseWriter, err error) { |
|  |  | } |
|  |  |  |
|  |  | rw.WriteHeader(rfcerr.Code) |
|  |  | rw.Write(js) |
|  |  | // ignoring the error because the connection is broken when it happens |
|  |  | \_, \_ = rw.Write(js) |
|  |  | } |

2 changes: 1 addition & 1 deletion

2
[access\_write.go](#diff-ecd43c3a6365408ff3b557a9e82cf36ddf6b49371bb044b47b289101924d4566 "access_write.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/access_write.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,5 +39,5 @@ func (f \*Fosite) WriteAccessResponse(rw http.ResponseWriter, requester AccessReq |
|  |  | rw.Header().Set("Content-Type", "application/json;charset=UTF-8") |
|  |  |  |
|  |  | rw.WriteHeader(http.StatusOK) |
|  |  | rw.Write(js) |
|  |  | \_, \_ = rw.Write(js) |
|  |  | } |

2 changes: 1 addition & 1 deletion

2
[authorize\_error.go](#diff-9805546fcddd9a654d6c7acf80e8a0861491d38a91374297b4b179e93e348022 "authorize_error.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/authorize_error.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,7 +53,7 @@ func (f \*Fosite) WriteAuthorizeError(rw http.ResponseWriter, ar AuthorizeRequest |
|  |  | } |
|  |  |  |
|  |  | rw.WriteHeader(rfcerr.Code) |
|  |  | rw.Write(js) |
|  |  | \_, \_ = rw.Write(js) |
|  |  | return |
|  |  | } |
|  |  |  |
| Expand Down | |  |

5 changes: 0 additions & 5 deletions

5
[errors.go](#diff-76a7e0e299c7417bae32d3098e71370980157fe29e68a366671491d147d40572 "errors.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/errors.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -163,11 +163,6 @@ var ( |
|  |  | Hint: "Token validation failed.", |
|  |  | Code: http.StatusUnauthorized, |
|  |  | } |
|  |  | ErrRevocationClientMismatch = &RFC6749Error{ |
|  |  | Name: errRevocationClientMismatchName, |
|  |  | Description: "Token was not issued to the client making the revocation request", |
|  |  | Code: http.StatusBadRequest, |
|  |  | } |
|  |  | ErrLoginRequired = &RFC6749Error{ |
|  |  | Name: errLoginRequired, |
|  |  | Description: "The Authorization Server requires End-User authentication", |
| Expand Down | |  |

7 changes: 0 additions & 7 deletions

7
[errors\_test.go](#diff-5c4d3e0fb6348a54d285f0812da0b323800e6e8c5d30b93e92a40677a267810f "errors_test.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/errors_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -28,13 +28,6 @@ import ( |
|  |  | "github.com/stretchr/testify/assert" |
|  |  | ) |
|  |  |  |
|  |  | func TestAddDebug(t \*testing.T) { |
|  |  | err := ErrRevocationClientMismatch.WithDebug("debug") |
|  |  | assert.NotEqual(t, err, ErrRevocationClientMismatch) |
|  |  | assert.Empty(t, ErrRevocationClientMismatch.Debug) |
|  |  | assert.NotEmpty(t, err.Debug) |
|  |  | } |
|  |  |  |
|  |  | func TestIs(t \*testing.T) { |
|  |  | assert.True(t, errors.Is(ErrUnknownRequest, ErrUnknownRequest)) |
|  |  | assert.True(t, errors.Is(ErrUnknownRequest, &RFC6749Error{ |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[go\_mod\_indirect\_pins.go](#diff-5a1dba9575b60980fca9fa45b839e2575519f53ab136075d14673198e79a50fb "go_mod_indirect_pins.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/go_mod_indirect_pins.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,5 +5,6 @@ package fosite |
|  |  | import ( |
|  |  | \_ "github.com/gorilla/websocket" |
|  |  | \_ "github.com/mattn/goveralls" |
|  |  |  |
|  |  | \_ "github.com/ory/go-acc" |
|  |  | ) |

29 changes: 20 additions & 9 deletions

29
[handler/oauth2/revocation.go](#diff-91ab80a56e140fe7525a5e7d7dc2cac29a2647e7f12138a4de03519bfa607042 "handler/oauth2/revocation.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/handler/oauth2/revocation.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,21 +57,32 @@ func (r \*TokenRevocationHandler) RevokeToken(ctx context.Context, token string, |
|  |  | } |
|  |  |  |
|  |  | var ar fosite.Requester |
|  |  | var err error |
|  |  | if ar, err = discoveryFuncs[0](); err != nil { |
|  |  | ar, err = discoveryFuncs[1]() |
|  |  | var err1, err2 error |
|  |  | if ar, err1 = discoveryFuncs[0](); err1 != nil { |
|  |  | ar, err2 = discoveryFuncs[1]() |
|  |  | } |
|  |  | if err != nil { |
|  |  | return err |
|  |  | // err2 can only be not nil if first err1 was not nil |
|  |  | if err2 != nil { |
|  |  | return storeErrorsToRevocationError(err1, err2) |
|  |  | } |
|  |  |  |
|  |  | if ar.GetClient().GetID() != client.GetID() { |
|  |  | return errors.WithStack(fosite.ErrRevocationClientMismatch) |
|  |  | return errors.WithStack(fosite.ErrUnauthorizedClient) |
|  |  | } |
|  |  |  |
|  |  | requestID := ar.GetID() |
|  |  | r.TokenRevocationStorage.RevokeRefreshToken(ctx, requestID) |
|  |  | r.TokenRevocationStorage.RevokeAccessToken(ctx, requestID) |
|  |  | err1 = r.TokenRevocationStorage.RevokeRefreshToken(ctx, requestID) |
|  |  | err2 = r.TokenRevocationStorage.RevokeAccessToken(ctx, requestID) |
|  |  |  |
|  |  | return nil |
|  |  | return storeErrorsToRevocationError(err1, err2) |
|  |  | } |
|  |  |  |
|  |  | func storeErrorsToRevocationError(err1, err2 error) error { |
|  |  | // both errors are 404 or nil <=> the token is revoked |
|  |  | if (errors.Is(err1, fosite.ErrNotFound) || err1 == nil) && (errors.Is(err2, fosite.ErrNotFound) || err2 == nil) { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // there was an unexpected error => the token may still exist and the client should retry later |
|  |  | return errors.WithStack(fosite.ErrTemporarilyUnavailable) |
|  |  | } |

72 changes: 66 additions & 6 deletions

72
[handler/oauth2/revocation\_test.go](#diff-5e87683bb6baef376099d54a01b2645464ca39fdbbacc9eb52ac9a94f1bdfc25 "handler/oauth2/revocation_test.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/handler/oauth2/revocation_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,7 +57,7 @@ func TestRevokeToken(t \*testing.T) { |
|  |  | }{ |
|  |  | { |
|  |  | description: "should fail - token was issued to another client", |
|  |  | expectErr: fosite.ErrRevocationClientMismatch, |
|  |  | expectErr: fosite.ErrUnauthorizedClient, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
| Expand Down  Expand Up | | @@ -134,8 +134,8 @@ func TestRevokeToken(t \*testing.T) { |
|  |  | }, |
|  |  | }, |
|  |  | { |
|  |  | description: "should fail - refresh token discovery first; both tokens not found", |
|  |  | expectErr: fosite.ErrNotFound, |
|  |  | description: "should pass - refresh token discovery first; both tokens not found", |
|  |  | expectErr: nil, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
| Expand All | | @@ -148,8 +148,8 @@ func TestRevokeToken(t \*testing.T) { |
|  |  | }, |
|  |  | }, |
|  |  | { |
|  |  | description: "should fail - access token discovery first; both tokens not found", |
|  |  | expectErr: fosite.ErrNotFound, |
|  |  | description: "should pass - access token discovery first; both tokens not found", |
|  |  | expectErr: nil, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
| Expand All | | @@ -161,8 +161,68 @@ func TestRevokeToken(t \*testing.T) { |
|  |  | store.EXPECT().GetRefreshTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(nil, fosite.ErrNotFound) |
|  |  | }, |
|  |  | }, |
|  |  | { |
|  |  | description: "should fail - store error for access token get", |
|  |  | expectErr: fosite.ErrTemporarilyUnavailable, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
|  |  | tokenType = fosite.AccessToken |
|  |  | atStrat.EXPECT().AccessTokenSignature(token) |
|  |  | store.EXPECT().GetAccessTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(nil, fmt.Errorf("random error")) |
|  |  |  |
|  |  | rtStrat.EXPECT().RefreshTokenSignature(token) |
|  |  | store.EXPECT().GetRefreshTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(nil, fosite.ErrNotFound) |
|  |  | }, |
|  |  | }, |
|  |  | { |
|  |  | description: "should fail - store error for refresh token get", |
|  |  | expectErr: fosite.ErrTemporarilyUnavailable, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
|  |  | tokenType = fosite.RefreshToken |
|  |  | atStrat.EXPECT().AccessTokenSignature(token) |
|  |  | store.EXPECT().GetAccessTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(nil, fosite.ErrNotFound) |
|  |  |  |
|  |  | rtStrat.EXPECT().RefreshTokenSignature(token) |
|  |  | store.EXPECT().GetRefreshTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(nil, fmt.Errorf("random error")) |
|  |  | }, |
|  |  | }, |
|  |  | { |
|  |  | description: "should fail - store error for access token revoke", |
|  |  | expectErr: fosite.ErrTemporarilyUnavailable, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
|  |  | tokenType = fosite.AccessToken |
|  |  | atStrat.EXPECT().AccessTokenSignature(token) |
|  |  | store.EXPECT().GetAccessTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(ar, nil) |
|  |  |  |
|  |  | ar.EXPECT().GetID() |
|  |  | ar.EXPECT().GetClient().Return(&fosite.DefaultClient{ID: "bar"}) |
|  |  | store.EXPECT().RevokeRefreshToken(gomock.Any(), gomock.Any()).Return(fosite.ErrNotFound) |
|  |  | store.EXPECT().RevokeAccessToken(gomock.Any(), gomock.Any()).Return(fmt.Errorf("random error")) |
|  |  | }, |
|  |  | }, |
|  |  | { |
|  |  | description: "should fail - store error for refresh token revoke", |
|  |  | expectErr: fosite.ErrTemporarilyUnavailable, |
|  |  | client: &fosite.DefaultClient{ID: "bar"}, |
|  |  | mock: func() { |
|  |  | token = "foo" |
|  |  | tokenType = fosite.RefreshToken |
|  |  | rtStrat.EXPECT().RefreshTokenSignature(token) |
|  |  | store.EXPECT().GetRefreshTokenSession(gomock.Any(), gomock.Any(), gomock.Any()).Return(ar, nil) |
|  |  |  |
|  |  | ar.EXPECT().GetID() |
|  |  | ar.EXPECT().GetClient().Return(&fosite.DefaultClient{ID: "bar"}) |
|  |  | store.EXPECT().RevokeRefreshToken(gomock.Any(), gomock.Any()).Return(fmt.Errorf("random error")) |
|  |  | store.EXPECT().RevokeAccessToken(gomock.Any(), gomock.Any()).Return(fosite.ErrNotFound) |
|  |  | }, |
|  |  | }, |
|  |  | } { |
|  |  | t.Run(fmt.Sprintf("case=%d", k), func(t \*testing.T) { |
|  |  | t.Run(fmt.Sprintf("case=%d/description=%s", k, c.description), func(t \*testing.T) { |
|  |  | c.mock() |
|  |  | err := h.RevokeToken(nil, token, tokenType, c.client) |
|  |  |  |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[handler/openid/helper.go](#diff-af7a06667ee6a65adcff19610eadf98ba25d04c1f5f7a3bf148489613d74b62f "handler/openid/helper.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/handler/openid/helper.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,7 +39,11 @@ func (i \*IDTokenHandleHelper) GetAccessTokenHash(ctx context.Context, requester |
|  |  |  |
|  |  | buffer := bytes.NewBufferString(token) |
|  |  | hash := sha256.New() |
|  |  | hash.Write(buffer.Bytes()) |
|  |  | // sha256.digest.Write() always returns nil for err, the panic should never happen |
|  |  | \_, err := hash.Write(buffer.Bytes()) |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
|  |  | hashBuf := bytes.NewBuffer(hash.Sum([]byte{})) |
|  |  | len := hashBuf.Len() |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[revoke\_handler.go](#diff-539c9cbad1056e9e46f1cf88ef81698d4871a30485e1cd824a16b3d089d868e1 "revoke_handler.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/revoke_handler.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -112,7 +112,7 @@ func (f \*Fosite) WriteRevocationResponse(rw http.ResponseWriter, err error) { |
|  |  | } |
|  |  |  |
|  |  | rw.WriteHeader(ErrInvalidRequest.Code) |
|  |  | rw.Write(js) |
|  |  | \_, \_ = rw.Write(js) |
|  |  | } else if errors.Is(err, ErrInvalidClient) { |
|  |  | rw.Header().Set("Content-Type", "application/json;charset=UTF-8") |
|  |  |  |
| Expand All | | @@ -123,7 +123,7 @@ func (f \*Fosite) WriteRevocationResponse(rw http.ResponseWriter, err error) { |
|  |  | } |
|  |  |  |
|  |  | rw.WriteHeader(ErrInvalidClient.Code) |
|  |  | rw.Write(js) |
|  |  | \_, \_ = rw.Write(js) |
|  |  | } else { |
|  |  | // 200 OK |
|  |  | rw.WriteHeader(http.StatusOK) |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[token/hmac/hmacsha.go](#diff-b92270a81f4021a9cdf52dfcfaeac9b66254471b85fd5ef4101acdbad02e4296 "token/hmac/hmacsha.go")

Show comments

[View file](/ory/fosite/blob/03dd55813f5521985f7dd64277b7ba0cf1441319/token/hmac/hmacsha.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -169,6 +169,10 @@ func (c \*HMACStrategy) Signature(token string) string { |
|  |  |  |
|  |  | func generateHMAC(data []byte, key \*[32]byte) []byte { |
|  |  | h := hmac.New(sha512.New512\_256, key[:]) |
|  |  | h.Write(data) |
|  |  | // sha512.digest.Write() always returns nil for err, the panic should never happen |
|  |  | \_, err := h.Write(data) |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
|  |  | return h.Sum(nil) |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `03dd558`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fory%2Ffosite%2Fcommit%2F03dd55813f5521985f7dd64277b7ba0cf1441319) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_0ac8f02f_20250119_131649.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  ( (" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? �t� �%�i-�~VB�.Ҵu�hW���K�p��YT�dc��ך��ԳL�0��m �g�N�����lm/V��h�c�~ӌ�9�u"����I���h�������k���k,W\*�#�.
p=��^���Zi�� s#L�{��G�/��O�G��p ?Z�6�\1�G�a�s�W^�cQJ�ߩ�'7H=Y�k����}�He�?t�SV�w� ?~u� �7P�;0�h9$g�je�猟���k
F��ME$������Zrn�}ŭ�α�8aiX��(�ݿ�?ɮ��~m>#wy.�ۂY���s�W����ZR^Io!�K���On������g����
R̨��r� �H��)(��{5j�(�z��V�R�V���,ʇ���Ң��[sd�"N2��� �tv�n'������KmJ��H���2�PZ�P�b�(՛�g�����$��M'��6�S��FI�`�O�j��-������ �B��MS���k� u�G�doL�ҹO�A4���7���\�}K�M�=L��o2���c�s��ǯ�Q��%�P��)|�R@�碐r3Y��~&�u���1�75�S����nͧ�<�cr�P���Mk�I�6��m5��{`�`u`>`q��^k�.>��
����|��tZ�I�jW\*S�;(Zx�!4e��=}� R� h?��o���P�[�sS��
