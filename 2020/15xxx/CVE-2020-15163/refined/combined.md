=== Content from pypi.org_4765aea8_20250119_122009.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldn‚Äôt load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from github.com_952d2685_20250119_122007.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fpull%2F885)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fpull%2F885)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftheupdateframework%2Fpython-tuf%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftheupdateframework%2Fpython-tuf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Do not immediately verify latest root when rotating #885

 Closed

[trishankatdatadog](/trishankatdatadog)
wants to merge
13
commits into
[theupdateframework:develop](/theupdateframework/python-tuf/tree/develop "theupdateframework/python-tuf:develop")
from
[trishankatdatadog:trishankatdatadog/correctly-rotate-root](/trishankatdatadog/tuf/tree/trishankatdatadog/correctly-rotate-root "trishankatdatadog/tuf:trishankatdatadog/correctly-rotate-root")

 Closed

# [Do not immediately verify latest root when rotating](#top) #885

[trishankatdatadog](/trishankatdatadog)
wants to merge
13
commits into
[theupdateframework:develop](/theupdateframework/python-tuf/tree/develop "theupdateframework/python-tuf:develop")
from
[trishankatdatadog:trishankatdatadog/correctly-rotate-root](/trishankatdatadog/tuf/tree/trishankatdatadog/correctly-rotate-root "trishankatdatadog/tuf:trishankatdatadog/correctly-rotate-root")

[Conversation
44](/theupdateframework/python-tuf/pull/885)
[Commits
13](/theupdateframework/python-tuf/pull/885/commits)
[Checks
0](/theupdateframework/python-tuf/pull/885/checks)
[Files changed](/theupdateframework/python-tuf/pull/885/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=60&v=4)](/trishankatdatadog)

Copy link

Member

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** commented [Jun 4, 2019](#issue-452155121)

**Fixes issue #**:

N/A

**Description of the changes being introduced by the pull request**:

When rotating the root (say from v2 to v3, then v3 to v4), the reference implementation currently immediately *verifies* signatures on the latest root (say, v4). This will fail when v4 is signed using v3's but not v2's keys. This PR changes the implementation so that signatures on the latest root is *not* immediately verified.

**Please verify and check that the pull request fulfills the following

requirements**:

* The code follows the [Code Style Guidelines](https://github.com/secure-systems-lab/code-style-guidelines#code-style-guidelines)
* Tests have been added for the bug fix or new feature
* Docs have been added for the bug fix or new feature

Sorry, something went wrong.

All reactions

 [![@JustinCappos](https://avatars.githubusercontent.com/u/857871?s=40&u=65bcabd0fa4c6b656d7bf116c324c011f8d66261&v=4)](/JustinCappos)
[JustinCappos](/JustinCappos)
requested a review
from [lukpueh](/lukpueh)
[June 4, 2019 21:03](#event-2389459759)

[![@JustinCappos](https://avatars.githubusercontent.com/u/857871?s=80&u=65bcabd0fa4c6b656d7bf116c324c011f8d66261&v=4)](/JustinCappos)

Copy link

Member

### **[JustinCappos](/JustinCappos)** commented [Jun 4, 2019](#issuecomment-498843446)

| [@tanishqjasoria](https://github.com/tanishqjasoria) Can you also take a look? |
| --- |

All reactions

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Jun 4, 2019](#issuecomment-498845784)

| Yeah, I should say that someone should triple-check this to make we are not skipping some important security check. But at that point, all we are trying to do is get the latest version number of the root.  Cc [@lukpueh](https://github.com/lukpueh) |
| --- |

All reactions

Sorry, something went wrong.

[![@tanishqjasoria](https://avatars.githubusercontent.com/u/11698398?s=80&u=c7967ac67c0dbce06d589c6b75e98c9371f00745&v=4)](/tanishqjasoria)

Copy link

### **[tanishqjasoria](/tanishqjasoria)** commented [Jun 5, 2019](#issuecomment-499206461)

| I guess there might be a problem. Form switching to \_get\_file() from \_get\_metadata\_file(), the root.json we get is not verified. Then, we are checking if the root metadata is changed or not by comparing the next\_version and latest\_version and the latest\_version is extracted from the unverified root.json file. So if the unverified root.json file points that the latest\_version is same as the current\_version, then the root metadata would not be updated even if there is an update available and we would continue using the old root metadata. |
| --- |

All reactions

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Jun 5, 2019](#issuecomment-499207873) ‚Ä¢ edited Loading

| [@tanishqjasoria](https://github.com/tanishqjasoria) Good observation, but this would be true even if with a signed and verified "latest" root metadata file: attackers who control the repository can always perform a freeze attack (limited by the expiration of the previous root, which could be as long as years). |
| --- |

All reactions

Sorry, something went wrong.

[![@tanishqjasoria](https://avatars.githubusercontent.com/u/11698398?s=80&u=c7967ac67c0dbce06d589c6b75e98c9371f00745&v=4)](/tanishqjasoria)

Copy link

### **[tanishqjasoria](/tanishqjasoria)** commented [Jun 5, 2019](#issuecomment-499230472)

| [@trishankatdatadog](https://github.com/trishankatdatadog) I missed that! |
| --- |

 üëç
1
 trishankatdatadog reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=60&v=4)](/trishankatdatadog)

**[trishankatdatadog](/trishankatdatadog)**
commented
[Jun 6, 2019](#pullrequestreview-246333283)

 [View reviewed changes](/theupdateframework/python-tuf/pull/885/files)

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[![lukpueh](https://avatars.githubusercontent.com/u/589324?s=60&v=4)](/lukpueh)

**[lukpueh](/lukpueh)**
reviewed
[Jun 10, 2019](#pullrequestreview-246546372)

 [View reviewed changes](/theupdateframework/python-tuf/pull/885/files)

Copy link

Member

### @lukpueh **[lukpueh](/lukpueh)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for the patch, [@trishankatdatadog](https://github.com/trishankatdatadog)! I am not sure I understand the full consequences of your changes. Could you provide answers to my questions below?

Sorry, something went wrong.

 üëç
1
 trishankatdatadog reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

|  |  | # should refresh them here as a protective measure. See Issue #736. |
| --- | --- | --- |
|  |  | self.\_rebuild\_key\_and\_role\_db() |
|  |  | self.consistent\_snapshot = \ |
|  |  | self.metadata['current']['root']['consistent\_snapshot'] |

Copy link

Member

### @lukpueh **[lukpueh](/lukpueh)** [Jun 10, 2019](#discussion_r292031609)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Comment in L1152-1154 claims that `self.consistent_snapshot` is set with `_update_metadata()`.

<https://github.com/theupdateframework/tuf/blob/c75a2b7fe1eaabc88f82a5f0bdfc8bd25cab7ab1/tuf/client/updater.py#L1152-L1154>

Why set it here explicitly? Is the comment above inaccurate?

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** [Jun 10, 2019](#discussion_r292145513)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

IDK, it's possible.

Sorry, something went wrong.

All reactions

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[![lukpueh](https://avatars.githubusercontent.com/u/589324?s=60&v=4)](/lukpueh)

**[lukpueh](/lukpueh)**
reviewed
[Jun 13, 2019](#pullrequestreview-249332612)

 [View reviewed changes](/theupdateframework/python-tuf/pull/885/files)

Copy link

Member

### @lukpueh **[lukpueh](/lukpueh)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I somehow missed the call to `_update_metadata` in the top line of below for-loop. It downloads all the root files again using `_get_metadata_file` exactly how it used to fetch `latest_root_metadata_file`, before your patch. That means, all the checks that I listed in my last review are performed eventually.

So I'd say, LGTM! :)

Do you have capacities to add a test that has at least one intermediate root and where the latest root is signed with keys that are not available in the beginning?

On a side-note, I re-read the [relevant part of the spec](https://github.com/theupdateframework/specification/blob/master/tuf-spec.md#the-client-application) and it seems a bit different from what we do here. As per the spec the client downloads root files with incrementing version numbers until the server *404*s. So in the spec there is no initial download of the latest root.

And on another side-note, did you see [@vladimir-v-diaz](https://github.com/vladimir-v-diaz)'s TODO comment in the `refresh`, where \_update\_root\_metadata is called?

<https://github.com/theupdateframework/tuf/blob/cf6fdec5101fec5e2402dc8d073fa17ace1fc25f/tuf/client/updater.py#L1079-L1082>

Sorry, something went wrong.

 üëç
1
 trishankatdatadog reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Jun 13, 2019](#issuecomment-501885940)

| [@lukpueh](https://github.com/lukpueh) Following our discussion, I have adjusted the code to [follow the spec](https://github.com/theupdateframework/specification/blame/bc97d9660bb6b9234fa3d41140978344ce698b84/tuf-spec.md#L1008). Please review.  To answer your questions:   1. Could someone else please help add the tests? Maybe an intern... 2. That TODO requires a wider discussion on our mailing list. [@JustinCappos](https://github.com/JustinCappos) |
| --- |

All reactions

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Jun 13, 2019](#issuecomment-501887244) ‚Ä¢ edited Loading

| Our spec should also be updated to say: once you have turned on consistent snapshots, you should always also write versioned besides unversioned root metadata files so that outdated clients can updated to your latest root. [@JustinCappos](https://github.com/JustinCappos)  Update: [theupdateframework/specification#52](https://github.com/theupdateframework/specification/pull/52) |
| --- |

All reactions

Sorry, something went wrong.

[![lukpueh](https://avatars.githubusercontent.com/u/589324?s=60&v=4)](/lukpueh)

**[lukpueh](/lukpueh)**
requested changes
[Jun 17, 2019](#pullrequestreview-250565961)

 [View reviewed changes](/theupdateframework/python-tuf/pull/885/files)

Copy link

Member

### @lukpueh **[lukpueh](/lukpueh)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for your update, [@trishankatdatadog](https://github.com/trishankatdatadog). It does look more like the spec now. However, the code does not work yet. [@JustinCappos](https://github.com/JustinCappos), do we have an intern who can take over, i.e. fix the things I noted below and add some tests?

Sorry, something went wrong.

All reactions

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Jun 18, 2019](#issuecomment-503200644)

| [@lukpueh](https://github.com/lukpueh) Sorry, I wrote on one machine, and tested on another, so there were some mistakes in translation.  Does this work better for you? |
| --- |

All reactions

Sorry, something went wrong.

 [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
[force-pushed](/theupdateframework/python-tuf/compare/d6359e178c91eccaa5812205be6d4208c24eb9ba..eb812469324a64a56d231cb0cdeda8a243cb387b)
the
trishankatdatadog/correctly-rotate-root

branch
2 times, most recently
from
[`d6359e1`](/theupdateframework/python-tuf/commit/d6359e178c91eccaa5812205be6d4208c24eb9ba) to
[`eb81246`](/theupdateframework/python-tuf/commit/eb812469324a64a56d231cb0cdeda8a243cb387b)  [Compare](/theupdateframework/python-tuf/compare/d6359e178c91eccaa5812205be6d4208c24eb9ba..eb812469324a64a56d231cb0cdeda8a243cb387b)
[June 18, 2019 19:56](#event-2422068316)

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
mentioned this pull request
[Jun 18, 2019](#ref-pullrequest-457730767)

[Limit on the # of root metadata files downloaded
theupdateframework/specification#45](/theupdateframework/specification/pull/45)
 Merged

[![lukpueh](https://avatars.githubusercontent.com/u/589324?s=60&v=4)](/lukpueh)

**[lukpueh](/lukpueh)**
reviewed
[Jun 19, 2019](#pullrequestreview-251609747)

 [View reviewed changes](/theupdateframework/python-tuf/pull/885/files)

Copy link

Member

### @lukpueh **[lukpueh](/lukpueh)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for the updates! I'm unsure whether you need `request.exceptions`. Otherwise it looks good.

Sorry, something went wrong.

All reactions

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

 [trishankatdatadog](/trishankatdatadog)
added 9 commits
[July 1, 2019 13:13](#commits-pushed-92ae4eb)

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[do not immediately verify latest root when rotating](/theupdateframework/python-tuf/pull/885/commits/92ae4eb8a61caf7eeaefa00c025f76fa50f04d3d "do not immediately verify latest root when rotating

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[92ae4eb](/theupdateframework/python-tuf/pull/885/commits/92ae4eb8a61caf7eeaefa00c025f76fa50f04d3d)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[after verification, next root key is loaded as current](/theupdateframework/python-tuf/pull/885/commits/851913b235217d91cc5ff491cc3d7edabe7662fa "after verification, next root key is loaded as current

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[851913b](/theupdateframework/python-tuf/pull/885/commits/851913b235217d91cc5ff491cc3d7edabe7662fa)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[some minor updates](/theupdateframework/python-tuf/pull/885/commits/d8c66805a95309e683f833cdc190c369d22bfddc "some minor updates

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[d8c6680](/theupdateframework/python-tuf/pull/885/commits/d8c66805a95309e683f833cdc190c369d22bfddc)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[follow the spec](/theupdateframework/python-tuf/pull/885/commits/b0be9a29d10eed25d268831c1fd32863e31b76db "follow the spec

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[b0be9a2](/theupdateframework/python-tuf/pull/885/commits/b0be9a29d10eed25d268831c1fd32863e31b76db)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[address](/theupdateframework/python-tuf/pull/885/commits/704b90c4e407f8a5d3e5c0c6cda2bcc6764c78fc "address @lukpueh comments

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>") [@lukpueh](https://github.com/lukpueh) [comments](/theupdateframework/python-tuf/pull/885/commits/704b90c4e407f8a5d3e5c0c6cda2bcc6764c78fc "address @lukpueh comments

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[704b90c](/theupdateframework/python-tuf/pull/885/commits/704b90c4e407f8a5d3e5c0c6cda2bcc6764c78fc)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[safely ignore only HTTP 403 / 404 errors when updating root](/theupdateframework/python-tuf/pull/885/commits/7e77327ba1dd581fff87ae7e12302ce985c1827a "safely ignore only HTTP 403 / 404 errors when updating root

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[7e77327](/theupdateframework/python-tuf/pull/885/commits/7e77327ba1dd581fff87ae7e12302ce985c1827a)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[better handling of HTTP errors](/theupdateframework/python-tuf/pull/885/commits/4839f2066e803cbdc82edc958766d35f70544dfa "better handling of HTTP errors

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[4839f20](/theupdateframework/python-tuf/pull/885/commits/4839f2066e803cbdc82edc958766d35f70544dfa)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[fix a bug where we return incorrectly](/theupdateframework/python-tuf/pull/885/commits/3e05cfbb0f35d6ffb7e327c2b931f9ecad6e2ab2 "fix a bug where we return incorrectly

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[3e05cfb](/theupdateframework/python-tuf/pull/885/commits/3e05cfbb0f35d6ffb7e327c2b931f9ecad6e2ab2)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[remove unnecessary conditional check](/theupdateframework/python-tuf/pull/885/commits/5fc3d90bd46e5c734cfc37c18d52b9e69529e466 "remove unnecessary conditional check

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[5fc3d90](/theupdateframework/python-tuf/pull/885/commits/5fc3d90bd46e5c734cfc37c18d52b9e69529e466)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

 [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
[force-pushed](/theupdateframework/python-tuf/compare/fbff603c61f0467207c73ee5d885df90b13b50b7..5fc3d90bd46e5c734cfc37c18d52b9e69529e466)
the
trishankatdatadog/correctly-rotate-root

branch
from
[`fbff603`](/theupdateframework/python-tuf/commit/fbff603c61f0467207c73ee5d885df90b13b50b7) to
[`5fc3d90`](/theupdateframework/python-tuf/commit/5fc3d90bd46e5c734cfc37c18d52b9e69529e466)  [Compare](/theupdateframework/python-tuf/compare/fbff603c61f0467207c73ee5d885df90b13b50b7..5fc3d90bd46e5c734cfc37c18d52b9e69529e466)
[July 1, 2019 17:21](#event-2451922950)

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=80&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

Copy link

Member

### **[lukpueh](/lukpueh)** commented [Jul 2, 2019](#issuecomment-507572998)

| Thanks for the update, [@trishankatdatadog](https://github.com/trishankatdatadog)! This looks sound now. I'd still like to see tests before we merge. [@JustinCappos](https://github.com/JustinCappos), do we have a student you might want to volunteer? If not, I'll add some tests. |
| --- |

 üëç
1
 trishankatdatadog reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[reduce the excessive # of rotation checks](/theupdateframework/python-tuf/pull/885/commits/3bb4f73950917a140417963e6be1112e34b84de7 "reduce the excessive # of rotation checks

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[3bb4f73](/theupdateframework/python-tuf/pull/885/commits/3bb4f73950917a140417963e6be1112e34b84de7)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

 [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
[force-pushed](/theupdateframework/python-tuf/compare/54a101b990c127fbcd5e1fae32e156444d93cb73..3bb4f73950917a140417963e6be1112e34b84de7)
the
trishankatdatadog/correctly-rotate-root

branch
from
[`54a101b`](/theupdateframework/python-tuf/commit/54a101b990c127fbcd5e1fae32e156444d93cb73) to
[`3bb4f73`](/theupdateframework/python-tuf/commit/3bb4f73950917a140417963e6be1112e34b84de7)  [Compare](/theupdateframework/python-tuf/compare/54a101b990c127fbcd5e1fae32e156444d93cb73..3bb4f73950917a140417963e6be1112e34b84de7)
[July 2, 2019 14:50](#event-2454649983)

[![@JustinCappos](https://avatars.githubusercontent.com/u/857871?s=40&u=65bcabd0fa4c6b656d7bf116c324c011f8d66261&v=4)](/JustinCappos)
[JustinCappos](/JustinCappos)
assigned [tanishqjasoria](/tanishqjasoria)
[Jul 3, 2019](#event-2457511297)

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Oct 2, 2019](#issuecomment-537648703)

| This is very important to Datadog for our next update. Could we get this fixed ASAP? Thanks. |
| --- |

 üëç
1
 lukpueh reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
added this to the [0.12.0](/theupdateframework/python-tuf/milestone/2) milestone
[Oct 2, 2019](#event-2681821798)

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
assigned [lukpueh](/lukpueh) and unassigned [tanishqjasoria](/tanishqjasoria)
[Oct 3, 2019](#event-2683929143)

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=80&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

Copy link

Member

### **[lukpueh](/lukpueh)** commented [Oct 3, 2019](#issuecomment-537931323)

| FYI. I am working on tests... |
| --- |

 ‚ù§Ô∏è
1
 trishankatdatadog reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
mentioned this pull request
[Oct 3, 2019](#ref-pullrequest-496432419)

[Bump version 0.12.0
#921](/theupdateframework/python-tuf/pull/921)
 Merged

[![trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=60&v=4)](/trishankatdatadog)

**[trishankatdatadog](/trishankatdatadog)**
commented
[Oct 3, 2019](#pullrequestreview-297036762)

 [View reviewed changes](/theupdateframework/python-tuf/pull/885/files/3bb4f73950917a140417963e6be1112e34b84de7)

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/files/3bb4f73950917a140417963e6be1112e34b84de7#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[Update tuf/client/updater.py](/theupdateframework/python-tuf/pull/885/commits/e34bdccc0082c0b306a6486e2c15bc27d40514be "Update tuf/client/updater.py")`

`[e34bdcc](/theupdateframework/python-tuf/pull/885/commits/e34bdccc0082c0b306a6486e2c15bc27d40514be)`

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Oct 3, 2019](#issuecomment-538050004)

| Thanks for helping to write the tests, [@lukpueh](https://github.com/lukpueh)... |
| --- |

All reactions

Sorry, something went wrong.

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=80&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

Copy link

Member

### **[lukpueh](/lukpueh)** commented [Oct 4, 2019](#issuecomment-538426788)

| And here they are: [trishankatdatadog/tuf@b170601...lukpueh:correctly-rotate-root-test](https://github.com/trishankatdatadog/tuf/compare/b170601...lukpueh%3Acorrectly-rotate-root-test)  [@trishankatdatadog](https://github.com/trishankatdatadog), could you please sign off your most recent commit? And would you mind adding my three tests-adding commits linked above on top of your branch? Then we can review the tests here on the same PR. |
| --- |

All reactions

Sorry, something went wrong.

 [trishankatdatadog](/trishankatdatadog)
added 2 commits
[October 4, 2019 17:40](#commits-pushed-224bba7)

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[reduce the excessive # of rotation checks](/theupdateframework/python-tuf/pull/885/commits/224bba73b41af205f0f63642bd44019bfdfa7d1a "reduce the excessive # of rotation checks

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[224bba7](/theupdateframework/python-tuf/pull/885/commits/224bba73b41af205f0f63642bd44019bfdfa7d1a)`

```
Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog)

`[Merge branch 'trishankatdatadog/correctly-rotate-root' of github.com:‚Ä¶](/theupdateframework/python-tuf/pull/885/commits/cd2a3615ed8dffff6c2ea564c7a27eb0917ce7fe "Merge branch 'trishankatdatadog/correctly-rotate-root' of github.com:trishankatdatadog/tuf into trishankatdatadog/correctly-rotate-root

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>")`
 ‚Ä¶

`[cd2a361](/theupdateframework/python-tuf/pull/885/commits/cd2a3615ed8dffff6c2ea564c7a27eb0917ce7fe)`

```
‚Ä¶trishankatdatadog/tuf into trishankatdatadog/correctly-rotate-root

Signed-off-by: Trishank K Kuppusamy <trishank.kuppusamy@datadoghq.com>
```

 [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
[force-pushed](/theupdateframework/python-tuf/compare/7f32a1e3d134cb235fac7434bc9b960127673161..cd2a3615ed8dffff6c2ea564c7a27eb0917ce7fe)
the
trishankatdatadog/correctly-rotate-root

branch
from
[`7f32a1e`](/theupdateframework/python-tuf/commit/7f32a1e3d134cb235fac7434bc9b960127673161) to
[`cd2a361`](/theupdateframework/python-tuf/commit/cd2a3615ed8dffff6c2ea564c7a27eb0917ce7fe)  [Compare](/theupdateframework/python-tuf/compare/7f32a1e3d134cb235fac7434bc9b960127673161..cd2a3615ed8dffff6c2ea564c7a27eb0917ce7fe)
[October 4, 2019 21:42](#event-2688762383)

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

Author

### **[trishankatdatadog](/trishankatdatadog)** commented [Oct 4, 2019](#issuecomment-538570343)

| [@lukpueh](https://github.com/lukpueh) I had to manually set DCO to pass, should be OK (only one commit done directly from GitHub didn't have sign off). Great test, BTW. Let me know if you need anything else! |
| --- |

All reactions

Sorry, something went wrong.

[lukpueh](/lukpueh)
added a commit
that referenced
this pull request
[Oct 7, 2019](#ref-commit-3d342e6)
[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

`[Merge pull request](/theupdateframework/python-tuf/commit/3d342e648fbacdf43a13d7ba8886aaaf07334af7 "Merge pull request #885 from trishankatdatadog:trishankatdatadog/correctly-rotate-root

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>") [#885](https://github.com/theupdateframework/python-tuf/pull/885) [from trishankatdatadog:trishankatdatadog/corr‚Ä¶](/theupdateframework/python-tuf/commit/3d342e648fbacdf43a13d7ba8886aaaf07334af7 "Merge pull request #885 from trishankatdatadog:trishankatdatadog/correctly-rotate-root

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>")`
‚Ä¶

`[3d342e6](/theupdateframework/python-tuf/commit/3d342e648fbacdf43a13d7ba8886aaaf07334af7)`

```
‚Ä¶ectly-rotate-root

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>
```

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
mentioned this pull request
[Oct 7, 2019](#ref-pullrequest-503351429)

[Add tests for multiple root key rotation
#930](/theupdateframework/python-tuf/pull/930)
 Merged

3 tasks

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=80&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

Copy link

Member

### **[lukpueh](/lukpueh)** commented [Oct 7, 2019](#issuecomment-538930817)

| Merged manually via [3d342e6](https://github.com/theupdateframework/python-tuf/commit/3d342e648fbacdf43a13d7ba8886aaaf07334af7). Tests will be added with [#930](https://github.com/theupdateframework/python-tuf/pull/930). |
| --- |

All reactions

Sorry, something went wrong.

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
closed this
[Oct 7, 2019](#event-2691230730)

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=80&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

Copy link

Member

### **[lukpueh](/lukpueh)** commented [Oct 7, 2019](#issuecomment-538931296)

| Thanks for the fix, [@trishankatdatadog](https://github.com/trishankatdatadog)!! üíØ |
| --- |

All reactions

Sorry, something went wrong.

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
mentioned this pull request
[Oct 14, 2019](#ref-pullrequest-506573594)

[Update securesystemslib to 0.12.0
#934](/theupdateframework/python-tuf/pull/934)
 Merged

3 tasks

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
mentioned this pull request
[Oct 24, 2019](#ref-issue-510947877)

[Ambiguity between section 5.1.3 and 6.1 regarding updating root keys
theupdateframework/specification#56](/theupdateframework/specification/issues/56)

Closed

[lukpueh](/lukpueh)
added a commit
to lukpueh/tuf
that referenced
this pull request
[Feb 24, 2020](#ref-commit-4b2c05b)
[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

`[Fix failing AppVeyor Python2.7 tests](/lukpueh/tuf/commit/4b2c05b681d452ec0f64470b3b8c6ed0d4a7427b "Fix failing AppVeyor Python2.7 tests

Since #885 the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in #885.

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g.

```
127.0.0.1 - - [24/Feb/2020 12:01:23] \"GET / HTTP/1.1\" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.")`
‚Ä¶

`[4b2c05b](/lukpueh/tuf/commit/4b2c05b681d452ec0f64470b3b8c6ed0d4a7427b)`

```
Since [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885) the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885).

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g.

```
127.0.0.1 - - [24/Feb/2020 12:01:23] "GET / HTTP/1.1" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.
```

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)
[lukpueh](/lukpueh)
mentioned this pull request
[Feb 24, 2020](#ref-pullrequest-569871650)

[Fix failing AppVeyor Python2.7 tests
#985](/theupdateframework/python-tuf/pull/985)
 Merged

3 tasks

[lukpueh](/lukpueh)
added a commit
to lukpueh/tuf
that referenced
this pull request
[Feb 24, 2020](#ref-commit-a94060e)
[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

`[Fix failing AppVeyor Python2.7 tests](/lukpueh/tuf/commit/a94060e0e6b53a0908210843e3743761f182b6de "Fix failing AppVeyor Python2.7 tests

Since #885 the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in #885.

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g.

```
127.0.0.1 - - [24/Feb/2020 12:01:23] \"GET / HTTP/1.1\" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>")`
‚Ä¶

`[a94060e](/lukpueh/tuf/commit/a94060e0e6b53a0908210843e3743761f182b6de)`

```
Since [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885) the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885).

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g.

```
127.0.0.1 - - [24/Feb/2020 12:01:23] "GET / HTTP/1.1" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>
```

[lukpueh](/lukpueh)
added a commit
to lukpueh/tuf
that referenced
this pull request
[Feb 24, 2020](#ref-commit-0fccc1f)
[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

`[Fix failing AppVeyor Python2.7 tests](/lukpueh/tuf/commit/0fccc1f95c549cc603b45ce11a3d3da829038a7c "Fix failing AppVeyor Python2.7 tests

Since #885 the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in #885.

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g.

```
127.0.0.1 - - [24/Feb/2020 12:01:23] \"GET / HTTP/1.1\" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>")`
‚Ä¶

`[0fccc1f](/lukpueh/tuf/commit/0fccc1f95c549cc603b45ce11a3d3da829038a7c)`

```
Since [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885) the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885).

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g.

```
127.0.0.1 - - [24/Feb/2020 12:01:23] "GET / HTTP/1.1" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>
```

[lukpueh](/lukpueh)
added a commit
to lukpueh/tuf
that referenced
this pull request
[Feb 24, 2020](#ref-commit-d721cf0)
[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

`[Fix failing AppVeyor Python2.7 tests](/lukpueh/tuf/commit/d721cf07ac31850609153744d6574e7121662a1e "Fix failing AppVeyor Python2.7 tests

Since #885 the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in #885.

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g. ...
```
127.0.0.1 - - [24/Feb/2020 12:01:23] \"GET / HTTP/1.1\" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>")`
‚Ä¶

`[d721cf0](/lukpueh/tuf/commit/d721cf07ac31850609153744d6574e7121662a1e)`

```
Since [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885) the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885).

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g. ...
```
127.0.0.1 - - [24/Feb/2020 12:01:23] "GET / HTTP/1.1" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>
```

[lukpueh](/lukpueh)
added a commit
to lukpueh/tuf
that referenced
this pull request
[Feb 24, 2020](#ref-commit-7dbb30a)
[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&u=ecdb40aa286bbcfa8f24b63ff4fee2cdc35a1c93&v=4)](/lukpueh)

`[Fix failing AppVeyor Python2.7 tests](/lukpueh/tuf/commit/7dbb30ae1006d0b5f506bba19d4b53398c44f139 "Fix failing AppVeyor Python2.7 tests

Since #885 the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in #885.

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g. ...
```
127.0.0.1 - - [24/Feb/2020 12:01:23] \"GET / HTTP/1.1\" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>")`
‚Ä¶

`[7dbb30a](/lukpueh/tuf/commit/7dbb30ae1006d0b5f506bba19d4b53398c44f139)`

```
Since [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885) the tests in TestUpdater and TestKeyRevocation fail on
Appveyor Python 2.7 builds. After some live debugging, it turns out
that the tests fail due to the extra amount of http requests to
the simple http server (see tests/simple_server.py) that were
added in [theupdateframework#885](https://github.com/theupdateframework/python-tuf/pull/885).

The simple server runs in a subprocess and is re-used for the
entire TestCase. After a certain amount of requests it becomes
unresponsive. Note that neither the subprocess exits (ps -W), nor
does the port get closed (netstat -a). It just doesn't serve the
request, making it time out and fail the test.

The following script can be used to reproduce the issue (run in
tests directory):

```python
import subprocess
import requests
import random

counter = 0

port = random.randint(30000, 45000)
command = ['python', 'simple_server.py', str(port)]
server_process = subprocess.Popen(command, stderr=subprocess.PIPE)
url = 'http://localhost:'+str(port) + '/'

sess = requests.Session()

try:
  while True:
    sess.get(url, timeout=3)
    counter +=1

finally:
  print(counter)
  server_process.kill()
```

It fails repeatedly on the 69th request, but only if
`stderr=subprocess.PIPE` is passed to Popen. Given that for each
request the simple server writes about ~60 characters to stderr,
e.g. ...
```
127.0.0.1 - - [24/Feb/2020 12:01:23] "GET / HTTP/1.1" 200 -
```
... it looks a lot like a full pipe buffer of size 4096. Note that the
`bufsize` argument to Popen does not change anything.

As a simple work around we silence the test server on
Windows/Python2 to not fill the buffer.

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>
```

 [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)
[trishankatdatadog](/trishankatdatadog)
deleted the
trishankatdatadog/correctly-rotate-root

branch
[July 13, 2020 17:08](#event-3540487518)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fpull%2F885)

Reviewers

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&v=4)](/lukpueh) [lukpueh](/lukpueh)

lukpueh requested changes

Assignees

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&v=4)](/lukpueh) [lukpueh](/lukpueh)

Labels

None yet

Projects

None yet

Milestone

 [**0.12.0**](/theupdateframework/python-tuf/milestone/2 "0.12.0")

Development

Successfully merging this pull request may close these issues.

4 participants

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=52&v=4)](/trishankatdatadog) [![@JustinCappos](https://avatars.githubusercontent.com/u/857871?s=52&v=4)](/JustinCappos) [![@tanishqjasoria](https://avatars.githubusercontent.com/u/11698398?s=52&v=4)](/tanishqjasoria) [![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=52&v=4)](/lukpueh)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_af317a66_20250119_122009.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fsecurity%2Fadvisories%2FGHSA-f8mr-jv2c-v8mg)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fsecurity%2Fadvisories%2FGHSA-f8mr-jv2c-v8mg)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

# Invalid root may become trusted root

Moderate

[joshuagl](/joshuagl)
published
GHSA-f8mr-jv2c-v8mg
Sep 9, 2020

## Package

pip

tuf
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 0.12

## Patched versions

0.12

## Description

### Impact

The Python TUF reference implementation `tuf<0.12` will incorrectly trust a previously downloaded root metadata file which failed verification at download time. This allows an attacker who is able to serve multiple new versions of root metadata (i.e. by a man-in-the-middle attack) culminating in a version which has not been correctly signed to control the trust chain for future updates.

While investigating the reported vulnerability, we discovered that the detailed client workflow was not fully implemented. Specifically, for step 1.3 the newly downloaded root metadata was not being verified with a threshold of keys specified in the new root metadata file.

This missing step of the client workflow has been implemented in [PR #1101](https://github.com/theupdateframework/tuf/pull/1101), which is included in [v0.14.0](https://github.com/theupdateframework/tuf/releases/tag/v0.14.0) of tuf.

### Patches

A [fix](https://github.com/theupdateframework/tuf/pull/885), is available in version [0.12](https://github.com/theupdateframework/tuf/releases/tag/v0.12.0) and newer.

### Workarounds

No workarounds are known for this issue.

### References

* Pull request resolving the invalid root becoming trusted issue [PR 885](https://github.com/theupdateframework/tuf/pull/885)
* Pull request implementing self verification of newly downloaded root metadata [PR 1101](https://github.com/theupdateframework/tuf/pull/1101)

### Severity

Moderate

### CVE ID

CVE-2020-15163

### Weaknesses

No CWEs

### Credits

* [![@FlorianVeaux](https://avatars.githubusercontent.com/u/22912273?s=40&v=4)](/FlorianVeaux)
  [FlorianVeaux](/FlorianVeaux)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from avatars.githubusercontent.com_ddc9e647_20250119_135859.html ===
ÔøΩÔøΩÔøΩÔøΩ ÔøΩ  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222ÔøΩÔøΩ  ( (" ÔøΩÔøΩÔøΩ          
   } !1AQa"q2ÔøΩÔøΩÔøΩ#BÔøΩÔøΩRÔøΩÔøΩ$3brÔøΩ
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ       
  w !1AQaq"2ÔøΩBÔøΩÔøΩÔøΩÔøΩ #3RÔøΩbrÔøΩ
$4ÔøΩ%ÔøΩ&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ   ? ÔøΩ◊úcÔøΩk;QÔøΩmÔøΩÔøΩGÔøΩÔøΩÔøΩaÔøΩzÔøΩtÔøΩ.>^ÔøΩÔøΩ|HÔøΩÔøΩÔøΩtÔøΩ.9ÔøΩÔøΩÔøΩsÔøΩ«ÖDRN1\ÔøΩJWvEÔøΩÔøΩÔøΩo7ÔøΩÔøΩÔøΩÔøΩ ÔøΩlÔøΩÔøΩkÔøΩ{ÔøΩ{yÔøΩÔøΩ&ÔøΩZ6ÔøΩÔøΩ+≈µÔøΩÔøΩNÔøΩÔøΩOEÔøΩÔøΩ\1ÔøΩÔøΩ\_
5[ÔøΩ/ÔøΩ2ÔøΩ2ÔøΩÔøΩyÔøΩÔøΩ0@`3ÔøΩ} íÂí∫.pÔøΩ>#ÔøΩKÔøΩS7ÔøΩ\*ÔøΩMÔøΩÔøΩÔøΩÔøΩÔøΩƒõÔøΩ7ÔøΩÔøΩÔøΩÔøΩFÔøΩ÷íÔøΩ.I ÔøΩÔøΩÔøΩ2ÔøΩ2+qÔøΩ ÔøΩÔøΩOGÔøΩnCMÔøΩ’êEÔøΩ$ÔøΩÔøΩZÔøΩÔøΩÔøΩFÔøΩz ÔøΩÔøΩÔøΩKÔøΩÔøΩÔøΩ¬´xgEÔøΩÔøΩÕæÔøΩÔøΩRÔøΩÔøΩ9ÔøΩÔøΩ?ZnÔøΩ5ÔøΩÔøΩvÔøΩÔøΩÔøΩÔøΩ#f}GÔøΩÔøΩ^ÔøΩ!ÔøΩ(ÔøΩÔøΩÔøΩ`ÔøΩoÔøΩLÔøΩ(ÔøΩDtAÔøΩLÔøΩ<ÔøΩ\*?0ÔøΩ’úÔøΩÔøΩƒû\,ÔøΩsÔøΩYzÔøΩÔøΩCÔøΩÔøΩ.ÔøΩ3vÔøΩ,lÔøΩ'ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩ!Q]ÔøΩ ÔøΩ/ÔøΩŒªi”äÔøΩ1ÔøΩÔøΩ<ÔøΩ,'6ÔøΩÔøΩÔøΩÔøΩÔøΩ#ÀºÔøΩÔøΩÔøΩ‹üRÔøΩgÔøΩÔøΩÔøΩXÔøΩOÔøΩ-Õ≥ÔøΩ(ÔøΩ)cÔøΩ2{ÔøΩÔøΩKÔøΩÔøΩÔøΩÔøΩ \ÔøΩÔøΩeÔøΩÔøΩ}ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩJÔøΩÔøΩTNÔøΩ9ÔøΩ YHÔøΩÔøΩTÔøΩhÔøΩ dÔøΩmÔøΩÔøΩiÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ3ÔøΩÔøΩ

=== Content from github.com_0fdffc63_20250119_122004.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fcommit%2F3d342e648fbacdf43a13d7ba8886aaaf07334af7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fcommit%2F3d342e648fbacdf43a13d7ba8886aaaf07334af7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

## Commit

[Permalink](/theupdateframework/python-tuf/commit/3d342e648fbacdf43a13d7ba8886aaaf07334af7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#885](https://github.com/theupdateframework/python-tuf/pull/885) from trishankatdatadog:trishankatdatadog/corr‚Ä¶

[Browse files](/theupdateframework/python-tuf/tree/3d342e648fbacdf43a13d7ba8886aaaf07334af7)
Browse the repository at this point in the history

```
‚Ä¶ectly-rotate-root

Signed-off-by: Lukas Puehringer <lukas.puehringer@nyu.edu>
```

* Loading branch information

[![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&v=4)](/lukpueh)

[lukpueh](/theupdateframework/python-tuf/commits?author=lukpueh "View all commits by lukpueh")
committed
Oct 7, 2019

2 parents
[be601bb](/theupdateframework/python-tuf/commit/be601bbcd55b89b609d266090fbbc5b1cae38762)
+
[fce6fa5](/theupdateframework/python-tuf/commit/fce6fa5b195c7bbbd8aa1183b278f723842df3f8)

commit 3d342e6

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**53 additions**
and
**18 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tuf

  + client

    - tuf/client/updater.py
      [updater.py](#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
  + tuf/settings.py
    [settings.py](#diff-38e0a26c4a7f268b7199d6a17136fcb715c75cdb35f6415cb2ee667f96e74eb9)

## There are no files selected for viewing

67 changes: 49 additions & 18 deletions

67
[tuf/client/updater.py](#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046 "tuf/client/updater.py")

Show comments

[View file](/theupdateframework/python-tuf/blob/3d342e648fbacdf43a13d7ba8886aaaf07334af7/tuf/client/updater.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -145,6 +145,7 @@ |
|  |  | import securesystemslib.util |
|  |  | import six |
|  |  | import iso8601 |
|  |  | import requests.exceptions |
|  |  |  |
|  |  | # The Timestamp role does not have signed metadata about it; otherwise we |
|  |  | # would need an infinite regress of metadata. Therefore, we use some |
| Expand Down  Expand Up | | @@ -1125,28 +1126,58 @@ def \_update\_root\_metadata(self, current\_root\_metadata): |
|  |  | None. |
|  |  | """ |
|  |  |  |
|  |  | # Retrieve the latest, remote root.json. |
|  |  | latest\_root\_metadata\_file = self.\_get\_metadata\_file( |
|  |  | 'root', 'root.json', DEFAULT\_ROOT\_UPPERLENGTH, None) |
|  |  | def neither\_403\_nor\_404(mirror\_error): |
|  |  | if isinstance(mirror\_error, requests.exceptions.HTTPError): |
|  |  | if mirror\_error.response.status\_code in {403, 404}: |
|  |  | return False |
|  |  | return True |
|  |  |  |
|  |  | latest\_root\_metadata = securesystemslib.util.load\_json\_string( |
|  |  | latest\_root\_metadata\_file.read().decode('utf-8')) |
|  |  | # Temporarily set consistent snapshot. Will be updated to whatever is set |
|  |  | # in the latest root.json after running through the intermediates with |
|  |  | # \_update\_metadata(). |
|  |  | self.consistent\_snapshot = True |
|  |  |  |
|  |  | # Following the spec, try downloading the N+1th root for a certain maximum |
|  |  | # number of times. |
|  |  | lower\_bound = current\_root\_metadata['version'] + 1 |
|  |  | upper\_bound = lower\_bound + tuf.settings.MAX\_NUMBER\_ROOT\_ROTATIONS |
|  |  |  |
|  |  | # Try downloading the next root. |
|  |  | for next\_version in range(lower\_bound, upper\_bound): |
|  |  | try: |
|  |  | # Thoroughly verify it. |
|  |  | self.\_update\_metadata('root', DEFAULT\_ROOT\_UPPERLENGTH, |
|  |  | version=next\_version) |
|  |  | # When we run into HTTP 403/404 error from ALL mirrors, break out of |
|  |  | # loop, because the next root metadata file is most likely missing. |
|  |  | except tuf.exceptions.NoWorkingMirrorError as exception: |
|  |  | for mirror\_error in exception.mirror\_errors.values(): |
|  |  | # Otherwise, reraise the error, because it is not a simple HTTP |
|  |  | # error. |
|  |  | if neither\_403\_nor\_404(mirror\_error): |
|  |  | logging.exception('Misc error for root version '+str(next\_version)) |
|  |  | raise |
|  |  | else: |
|  |  | # Calling this function should give us a detailed stack trace |
|  |  | # including an HTTP error code, if any. |
|  |  | logging.exception('HTTP error for root version '+str(next\_version)) |
|  |  | # If we are here, then we ran into only 403 / 404 errors, which are |
|  |  | # good reasons to suspect that the next root metadata file does not |
|  |  | # exist. |
|  |  | break |
|  |  |  |
|  |  | next\_version = current\_root\_metadata['version'] + 1 |
|  |  | latest\_version = latest\_root\_metadata['signed']['version'] |
|  |  | # Ensure that the role and key information of the top-level roles is the |
|  |  | # latest. We do this whether or not Root needed to be updated, in order |
|  |  | # to ensure that, e.g., the entries in roledb for top-level roles are |
|  |  | # populated with expected keyid info so that roles can be validated. In |
|  |  | # certain circumstances, top-level metadata might be missing because it |
|  |  | # was marked obsolete and deleted after a failed attempt, and thus we |
|  |  | # should refresh them here as a protective measure. See Issue #736. |
|  |  | self.\_rebuild\_key\_and\_role\_db() |
|  |  |  |
|  |  | # update from the next version of root up to (and including) the latest |
|  |  | # version. For example: |
|  |  | # current = version 1 |
|  |  | # latest = version 3 |
|  |  | # update from 1.root.json to 3.root.json. |
|  |  | for version in range(next\_version, latest\_version + 1): |
|  |  | # Temporarily set consistent snapshot. Will be updated to whatever is set |
|  |  | # in the latest root.json after running through the intermediates with |
|  |  | # \_update\_metadata(). |
|  |  | self.consistent\_snapshot = True |
|  |  | self.\_update\_metadata('root', DEFAULT\_ROOT\_UPPERLENGTH, version=version) |
|  |  | # Set our consistent snapshot property to what the latest root has said. |
|  |  | self.consistent\_snapshot = \ |
|  |  | self.metadata['current']['root']['consistent\_snapshot'] |
|  |  |  |
|  |  |  |
|  |  |  |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[tuf/settings.py](#diff-38e0a26c4a7f268b7199d6a17136fcb715c75cdb35f6415cb2ee667f96e74eb9 "tuf/settings.py")

Show comments

[View file](/theupdateframework/python-tuf/blob/3d342e648fbacdf43a13d7ba8886aaaf07334af7/tuf/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -107,3 +107,7 @@ |
|  |  | # to suspend execution for a specified amount of time. See |
|  |  | # theupdateframework/tuf/issue#338. |
|  |  | SLEEP\_BEFORE\_ROUND = None |
|  |  |  |
|  |  | # Maximum number of root metadata file rotations we should perform in order to |
|  |  | # prevent a denial-of-service (DoS) attack. |
|  |  | MAX\_NUMBER\_ROOT\_ROTATIONS = 2\*\*5 |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3d342e6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fcommit%2F3d342e648fbacdf43a13d7ba8886aaaf07334af7) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_e5ed13d9_20250119_122008.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Freleases%2Ftag%2Fv0.12.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Freleases%2Ftag%2Fv0.12.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf/tree/v0.12.0)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf/tree/v0.12.0)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

1. [Releases](/theupdateframework/python-tuf/releases)
2. [v0.12.0](/theupdateframework/python-tuf/releases/tag/v0.12.0)

# tuf v0.12.0

Pre-release

Pre-release

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/theupdateframework/python-tuf/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.12.0)

 Loading

[View all tags](/theupdateframework/python-tuf/tags)

![@lukpueh](https://avatars.githubusercontent.com/u/589324?s=40&v=4)
[lukpueh](/lukpueh)
released this
15 Oct 08:36

¬∑
[2911 commits](/theupdateframework/python-tuf/compare/v0.12.0...develop)
to develop
since this release

[v0.12.0](/theupdateframework/python-tuf/tree/v0.12.0)

This tag was signed with the committer‚Äôs **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/589324?s=64&v=4)](/lukpueh)
[lukpueh](/lukpueh)
Lukas P√ºhringer

GPG key ID: 89A2AD3C07D962E8
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`6138395`](/theupdateframework/python-tuf/commit/61383951147df1dc352bdc95644f8a51c94cd12c)

This commit was created on GitHub.com and signed with GitHub‚Äôs **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

* Add backwards incompatible TUF spec version checks ([#842](https://github.com/theupdateframework/python-tuf/pull/842), [#844](https://github.com/theupdateframework/python-tuf/pull/844), [#854](https://github.com/theupdateframework/python-tuf/pull/854), [#914](https://github.com/theupdateframework/python-tuf/pull/914))
* Adopt securesystemslib v0.12.0 update ([#909](https://github.com/theupdateframework/python-tuf/pull/909), [#910](https://github.com/theupdateframework/python-tuf/pull/910), [#855](https://github.com/theupdateframework/python-tuf/pull/855), [#912](https://github.com/theupdateframework/python-tuf/pull/912), [#934](https://github.com/theupdateframework/python-tuf/pull/934))
* Fix multi-root rotation ([#885](https://github.com/theupdateframework/python-tuf/pull/885), [#930](https://github.com/theupdateframework/python-tuf/pull/930))
* Fix duplicate schema definitions ([#929](https://github.com/theupdateframework/python-tuf/pull/929))
* Refactor metadata generation ([#836](https://github.com/theupdateframework/python-tuf/pull/836))
* Refactor securesystemslib interface ([#919](https://github.com/theupdateframework/python-tuf/pull/919))
* Update implementation roadmap ([#833](https://github.com/theupdateframework/python-tuf/pull/833))
* Improve tests and testing infrastructure ([#825](https://github.com/theupdateframework/python-tuf/pull/825), [#839](https://github.com/theupdateframework/python-tuf/pull/839), [#890](https://github.com/theupdateframework/python-tuf/pull/890), [#915](https://github.com/theupdateframework/python-tuf/pull/915), [#892](https://github.com/theupdateframework/python-tuf/pull/892), [#923](https://github.com/theupdateframework/python-tuf/pull/923))
* Improve documentation ([#824](https://github.com/theupdateframework/python-tuf/pull/824), [#849](https://github.com/theupdateframework/python-tuf/pull/849), [#852](https://github.com/theupdateframework/python-tuf/pull/852), [#853](https://github.com/theupdateframework/python-tuf/pull/853), [#893](https://github.com/theupdateframework/python-tuf/pull/893), [#924](https://github.com/theupdateframework/python-tuf/pull/924), [#928](https://github.com/theupdateframework/python-tuf/pull/928), et al.)
* Update misc dependencies ([#850](https://github.com/theupdateframework/python-tuf/pull/850), [#851](https://github.com/theupdateframework/python-tuf/pull/851), [#916](https://github.com/theupdateframework/python-tuf/pull/916), [#922](https://github.com/theupdateframework/python-tuf/pull/922), [#926](https://github.com/theupdateframework/python-tuf/pull/926), [#931](https://github.com/theupdateframework/python-tuf/pull/931))

 Assets
5

 Loading

All reactions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_b8690852_20250119_135903.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fpull%2F1101)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fpull%2F1101)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftheupdateframework%2Fpython-tuf%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftheupdateframework%2Fpython-tuf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix updater workflow #1101

 Merged

[joshuagl](/joshuagl)
merged 4 commits into
[theupdateframework:develop](/theupdateframework/python-tuf/tree/develop "theupdateframework/python-tuf:develop")
from
[joshuagl:joshuagl/updater-verify-root](/joshuagl/tuf/tree/joshuagl/updater-verify-root "joshuagl/tuf:joshuagl/updater-verify-root")

Aug 18, 2020

 Merged

# [Fix updater workflow](#top) #1101

[joshuagl](/joshuagl)
merged 4 commits into
[theupdateframework:develop](/theupdateframework/python-tuf/tree/develop "theupdateframework/python-tuf:develop")
from
[joshuagl:joshuagl/updater-verify-root](/joshuagl/tuf/tree/joshuagl/updater-verify-root "joshuagl/tuf:joshuagl/updater-verify-root")

Aug 18, 2020

[Conversation
24](/theupdateframework/python-tuf/pull/1101)
[Commits
4](/theupdateframework/python-tuf/pull/1101/commits)
[Checks
0](/theupdateframework/python-tuf/pull/1101/checks)
[Files changed](/theupdateframework/python-tuf/pull/1101/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![joshuagl](https://avatars.githubusercontent.com/u/13888612?s=60&v=4)](/joshuagl)

Copy link

Member

### @joshuagl **[joshuagl](/joshuagl)** commented [Aug 6, 2020](#issue-674220347)

**Fixes issue #**: N/A

**Description of the changes being introduced by the pull request**:

The updater was not adhering to the detailed client workflow. Specifically newly downloaded root metadata was not being verified with a threshold of signatures from itself.

Per the detailed client workflow in the specification step 1.2

> Version N+1 of the root metadata file MUST have been signed by:
>
> (1) a threshold of keys specified in the trusted root metadata file (version N), and
>
> (2) a threshold of keys specified in the new root metadata file being validated (version N+1)."

This PR ensures that point two is verified by the updater.

**Please verify and check that the pull request fulfills the following

requirements**:

* The code follows the [Code Style Guidelines](https://github.com/secure-systems-lab/code-style-guidelines#code-style-guidelines)
* Tests have been added for the bug fix or new feature
* Docs have been added for the bug fix or new feature

Sorry, something went wrong.

All reactions

[![@sechkova](https://avatars.githubusercontent.com/u/44640795?s=40&v=4)](/sechkova)
[sechkova](/sechkova)
mentioned this pull request
[Aug 6, 2020](#ref-pullrequest-674168934)

[Raise an error on loading/writing unsigned metadata
#1100](/theupdateframework/python-tuf/pull/1100)
 Merged

3 tasks

[![trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=60&v=4)](/trishankatdatadog)

**[trishankatdatadog](/trishankatdatadog)**
suggested changes
[Aug 6, 2020](#pullrequestreview-462831693)

 [View reviewed changes](/theupdateframework/python-tuf/pull/1101/files)

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/1101/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)

|  |  | # The ANYKEY\_SCHEMA check in verify\_signature expects the keydict to |
| --- | --- | --- |
|  |  | # include a keyid |
|  |  | key['keyid'] = keyid |
|  |  | valid\_sig = securesystemslib.keys.verify\_signature(key, signature, signed) |

Copy link

Member

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** [Aug 6, 2020](#discussion_r466651446)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should we bail on a single exception here? Feels like we need a try-catch...

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @joshuagl **[joshuagl](/joshuagl)** [Aug 7, 2020](#discussion_r466969735)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`_get_metadata_file` has some logic to collect all exceptions and pack them into `NoWorkingMirrorError`, so I *think* this just continues the existing pattern?

Sorry, something went wrong.

All reactions

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/1101/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

Show resolved

Hide resolved

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/1101/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
Outdated

|  |  | # new threshold of new signatures contained within the downloaded root |
| --- | --- | --- |
|  |  | # metadata object |
|  |  | if valid and metadata\_role == 'root': |
|  |  | valid = self.\_verify\_root\_sigs(metadata\_signable) |

Copy link

Member

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** [Aug 6, 2020](#discussion_r466655609)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I also wouldn't call this function inside \_verify\_metadata\_file(), because there is too much magic. Best to call it explicitly in the \_update\_root\_metadata() code IMHO.

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @joshuagl **[joshuagl](/joshuagl)** [Aug 7, 2020](#discussion_r466851393)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Agreed, this does make `_verify_metadata_file()` much more magical. I opted to call it inside `_verify_metadata_file()` because this enable us to perform the check before the tempfile is persisted, and makes it easier to perform the check per download mirror.

If we do the check in `_update_root_metadata()` we need to clean up a file from the clients metadata directory and, perhaps less importantly, can only perform the check on a single file returned by `_update_root_metadata()`

Sorry, something went wrong.

 üëç
1
 trishankatdatadog reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Copy link

Member

### @jku **[jku](/jku)** [Aug 7, 2020](#discussion_r466880361)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

+1. I think the point of never writing unverified files is *critical* and should probably be encoded in comments or docs... If we do not adhere to that it's almost impossible to ensure that our state of metadata stays valid.

Sorry, something went wrong.

 üëç
1
 trishankatdatadog reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Copy link

Member

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** [Aug 7, 2020](#discussion_r467110295)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Also, we want to make sure that other functions that depend on this function do the same thing. Let's leave the magic alone for now, but document clearly why it is there, and not somewhere else.

Sorry, something went wrong.

 üëç
1
 joshuagl reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[tuf/client/updater.py](/theupdateframework/python-tuf/pull/1101/files#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)

Show resolved

Hide resolved

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)
Outdated

Show resolved

Hide resolved

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)

Show resolved

Hide resolved

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)

|  |  |  |
| --- | --- | --- |
|  |  |  |
|  |  |  |
|  |  | def test\_root\_rotation\_unmet\_new\_threshold(self): |

Copy link

Member

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** [Aug 6, 2020](#discussion_r466662640)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Lovely test, but there's some overlap between this test and the next. Maybe clarify that there is at least one successful intermediate rotation involved or something.

Sorry, something went wrong.

 üëç
1
 joshuagl reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)

Show resolved

Hide resolved

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
reviewed
[Aug 7, 2020](#pullrequestreview-463125319)

 [View reviewed changes](/theupdateframework/python-tuf/pull/1101/files)

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)
Outdated

Show resolved

Hide resolved

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
reviewed
[Aug 7, 2020](#pullrequestreview-463275919)

 [View reviewed changes](/theupdateframework/python-tuf/pull/1101/files)

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)
Outdated

Show resolved

Hide resolved

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
reviewed
[Aug 7, 2020](#pullrequestreview-463276478)

 [View reviewed changes](/theupdateframework/python-tuf/pull/1101/files)

[tests/test\_updater\_root\_rotation\_integration.py](/theupdateframework/python-tuf/pull/1101/files#diff-5767203c19381b7e9c4584ec2236b2cf06d30ca66bb30aacb910a9a3d5cc8565)
Outdated

Show resolved

Hide resolved

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
approved these changes
[Aug 8, 2020](#pullrequestreview-463804253)

 [View reviewed changes](/theupdateframework/python-tuf/pull/1101/files)

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=80&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)

Copy link

Member

Author

### **[joshuagl](/joshuagl)** commented [Aug 11, 2020](#issuecomment-671848880)

| I believe I've addressed all review comments. Once the PR is approved I'd like to squash some of the changes addressing review comments into the patches that introduced the changes. |
| --- |

All reactions

Sorry, something went wrong.

[![trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=60&v=4)](/trishankatdatadog)

**[trishankatdatadog](/trishankatdatadog)**
approved these changes
[Aug 18, 2020](#pullrequestreview-469542657)

 [View reviewed changes](/theupdateframework/python-tuf/pull/1101/files)

Copy link

Member

### @trishankatdatadog **[trishankatdatadog](/trishankatdatadog)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM

Sorry, something went wrong.

 üöÄ
1
 joshuagl reacted with rocket emoji

All reactions

* üöÄ
  1 reaction

 [sechkova](/sechkova)
and others
added 4 commits
[August 18, 2020 21:48](#commits-pushed-efea88e)

[![@sechkova](https://avatars.githubusercontent.com/u/44640795?s=40&v=4)](/sechkova) [![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&v=4)](/joshuagl)

`[Add updater tests for root signed with current keys](/theupdateframework/python-tuf/pull/1101/commits/efea88e33762b42fb298d961acc9fb2c1acab621 "Add updater tests for root signed with current keys

Co-authored-by: Joshua Lock <jlock@vmware.com>
Signed-off-by: Teodora Sechkova <tsechkova@vmware.com>
Signed-off-by: Joshua Lock <jlock@vmware.com>")`
 ‚Ä¶

`[efea88e](/theupdateframework/python-tuf/pull/1101/commits/efea88e33762b42fb298d961acc9fb2c1acab621)`

```
Co-authored-by: Joshua Lock <jlock@vmware.com>
Signed-off-by: Teodora Sechkova <tsechkova@vmware.com>
Signed-off-by: Joshua Lock <jlock@vmware.com>
```

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&v=4)](/joshuagl)

`[updater: rename _verify_uncompressed_metadata_file](/theupdateframework/python-tuf/pull/1101/commits/9332e8209c8add9afd8a85e9b77bcea5c9e4c999 "updater: rename _verify_uncompressed_metadata_file

We no longer handle compressed metadata files, so rename this method to be
shorter and less confusing:
_verify_uncompressed_metadata_file -> _verify_metadata_file

Signed-off-by: Joshua Lock <jlock@vmware.com>")`
 ‚Ä¶

`[9332e82](/theupdateframework/python-tuf/pull/1101/commits/9332e8209c8add9afd8a85e9b77bcea5c9e4c999)`

```
We no longer handle compressed metadata files, so rename this method to be
shorter and less confusing:
_verify_uncompressed_metadata_file -> _verify_metadata_file

Signed-off-by: Joshua Lock <jlock@vmware.com>
```

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&v=4)](/joshuagl)

`[updater: remove redundant __verify_root_chain_link method](/theupdateframework/python-tuf/pull/1101/commits/902a025918430aa9d7f8de71a58cc928c128301d "updater: remove redundant __verify_root_chain_link method

This method is duplicating verification steps which have already been
completed before the file was written to disk.

Signed-off-by: Joshua Lock <jlock@vmware.com>")`
 ‚Ä¶

`[902a025](/theupdateframework/python-tuf/pull/1101/commits/902a025918430aa9d7f8de71a58cc928c128301d)`

```
This method is duplicating verification steps which have already been
completed before the file was written to disk.

Signed-off-by: Joshua Lock <jlock@vmware.com>
```

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&v=4)](/joshuagl)

`[updater: verify newly downloaded root metadata with its signatures](/theupdateframework/python-tuf/pull/1101/commits/2fc25adfadc04df0bfad520f2f4f2a6b6f0d28fe "updater: verify newly downloaded root metadata with its signatures

Per the detailed client workflow in the specification step 1.2

\"Version N+1 of the root metadata file MUST have been signed by:
(1) a threshold of keys specified in the trusted root metadata file
(version N), and
(2) a threshold of keys specified in the new root metadata file being
validated (version N+1).\"

Number 2 is implemented here as this step was not being performed by the
Updater. Unfortunately we can't use existing signature verification
methods in tuf.sig, because tuf.sig.signature_status() does not verify
signatures for keys which are not listed in keydb (and tuf.sig.verify
uses tuf.sig.signature_status)

Therefore this patch introduces a method for verifying signatures with
root keys listed in the signable being verified.

Signed-off-by: Joshua Lock <jlock@vmware.com>")`
 ‚Ä¶

`[2fc25ad](/theupdateframework/python-tuf/pull/1101/commits/2fc25adfadc04df0bfad520f2f4f2a6b6f0d28fe)`

```
Per the detailed client workflow in the specification step 1.2

"Version N+1 of the root metadata file MUST have been signed by:
(1) a threshold of keys specified in the trusted root metadata file
(version N), and
(2) a threshold of keys specified in the new root metadata file being
validated (version N+1)."

Number 2 is implemented here as this step was not being performed by the
Updater. Unfortunately we can't use existing signature verification
methods in tuf.sig, because tuf.sig.signature_status() does not verify
signatures for keys which are not listed in keydb (and tuf.sig.verify
uses tuf.sig.signature_status)

Therefore this patch introduces a method for verifying signatures with
root keys listed in the signable being verified.

Signed-off-by: Joshua Lock <jlock@vmware.com>
```

 [![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)
[joshuagl](/joshuagl)
[force-pushed](/theupdateframework/python-tuf/compare/eab64ac944158eac5753a7898492b8d6fd9c53a9..2fc25adfadc04df0bfad520f2f4f2a6b6f0d28fe)
the
joshuagl/updater-verify-root

branch
from
[`eab64ac`](/theupdateframework/python-tuf/commit/eab64ac944158eac5753a7898492b8d6fd9c53a9) to
[`2fc25ad`](/theupdateframework/python-tuf/commit/2fc25adfadc04df0bfad520f2f4f2a6b6f0d28fe)  [Compare](/theupdateframework/python-tuf/compare/eab64ac944158eac5753a7898492b8d6fd9c53a9..2fc25adfadc04df0bfad520f2f4f2a6b6f0d28fe)
[August 18, 2020 20:52](#event-3668086248)

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)
[joshuagl](/joshuagl)
merged commit [`e3ff011`](/theupdateframework/python-tuf/commit/e3ff01157511aa133e060542b4f16a9b091633d1)
into
theupdateframework:develop

[Aug 18, 2020](https://github.com/theupdateframework/python-tuf/pull/1101#event-3668287520)

 [![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)
[joshuagl](/joshuagl)
deleted the
joshuagl/updater-verify-root

branch
[August 18, 2020 22:02](#event-3668287651)

[joshuagl](/joshuagl)
added a commit
to joshuagl/tuf
that referenced
this pull request
[Nov 23, 2020](#ref-commit-ab30113)
[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)

`[client: new root sigs only counted once per keyid](/joshuagl/tuf/commit/ab3011338d1770992935a548b5adf9b8abd1ef07 "client: new root sigs only counted once per keyid

When verifying newly downloaded root metadata with the keys listed in the
root metadata being verified, multiple signatures with the same keyid
should not be counted towards the threshold. A keyid should only count
once towards the threshold.

This fixes the _verify_root_self_signed() method introduced in PR #1101 to
ensure that keyids are only counted once when verifying a threshold of new
root signatures.

Signed-off-by: Joshua Lock <jlock@vmware.com>")`
‚Ä¶

`[ab30113](/joshuagl/tuf/commit/ab3011338d1770992935a548b5adf9b8abd1ef07)`

```
When verifying newly downloaded root metadata with the keys listed in the
root metadata being verified, multiple signatures with the same keyid
should not be counted towards the threshold. A keyid should only count
once towards the threshold.

This fixes the _verify_root_self_signed() method introduced in PR [theupdateframework#1101](https://github.com/theupdateframework/python-tuf/pull/1101) to
ensure that keyids are only counted once when verifying a threshold of new
root signatures.

Signed-off-by: Joshua Lock <jlock@vmware.com>
```

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)
[joshuagl](/joshuagl)
mentioned this pull request
[Nov 23, 2020](#ref-pullrequest-748973173)

[Fix root self verification to only count a keyid once towards the threshold
#1218](/theupdateframework/python-tuf/pull/1218)
 Merged

3 tasks

[joshuagl](/joshuagl)
added a commit
to joshuagl/tuf
that referenced
this pull request
[Nov 24, 2020](#ref-commit-83ac7be)
[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&u=204ad712929a54a45d12cb8021718fa71185a344&v=4)](/joshuagl)

`[client: new root sigs only counted once per keyid](/joshuagl/tuf/commit/83ac7be525b733f79a7e9bc573ec580ec835f179 "client: new root sigs only counted once per keyid

When verifying newly downloaded root metadata with the keys listed in the
root metadata being verified, multiple signatures with the same keyid
should not be counted towards the threshold. A keyid should only count
once towards the threshold.

This fixes the _verify_root_self_signed() method introduced in PR #1101 to
ensure that keyids are only counted once when verifying a threshold of new
root signatures.

Signed-off-by: Joshua Lock <jlock@vmware.com>")`
‚Ä¶

`[83ac7be](/joshuagl/tuf/commit/83ac7be525b733f79a7e9bc573ec580ec835f179)`

```
When verifying newly downloaded root metadata with the keys listed in the
root metadata being verified, multiple signatures with the same keyid
should not be counted towards the threshold. A keyid should only count
once towards the threshold.

This fixes the _verify_root_self_signed() method introduced in PR [theupdateframework#1101](https://github.com/theupdateframework/python-tuf/pull/1101) to
ensure that keyids are only counted once when verifying a threshold of new
root signatures.

Signed-off-by: Joshua Lock <jlock@vmware.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fpull%2F1101)

Reviewers

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=40&v=4)](/trishankatdatadog) [trishankatdatadog](/trishankatdatadog)

trishankatdatadog approved these changes

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&v=4)](/jku) [jku](/jku)

jku approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=52&v=4)](/joshuagl) [![@jku](https://avatars.githubusercontent.com/u/31889?s=52&v=4)](/jku) [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=52&v=4)](/trishankatdatadog) [![@sechkova](https://avatars.githubusercontent.com/u/44640795?s=52&v=4)](/sechkova)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


