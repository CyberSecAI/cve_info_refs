=== Content from github.com_2799fffd_20250119_121913.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Flibrary%2Fcommit%2F80aab47f044a2660aa352450f55137598f362aa4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Flibrary%2Fcommit%2F80aab47f044a2660aa352450f55137598f362aa4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=octobercms%2Flibrary)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[octobercms](/octobercms)
/
**[library](/octobercms/library)**
Public

* [Notifications](/login?return_to=%2Foctobercms%2Flibrary) You must be signed in to change notification settings
* [Fork
  170](/login?return_to=%2Foctobercms%2Flibrary)
* [Star
   157](/login?return_to=%2Foctobercms%2Flibrary)

* [Code](/octobercms/library)
* [Pull requests
  0](/octobercms/library/pulls)
* [Actions](/octobercms/library/actions)
* [Security](/octobercms/library/security)
* [Insights](/octobercms/library/pulse)

Additional navigation options

* [Code](/octobercms/library)
* [Pull requests](/octobercms/library/pulls)
* [Actions](/octobercms/library/actions)
* [Security](/octobercms/library/security)
* [Insights](/octobercms/library/pulse)

## Commit

[Permalink](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security fixes for v1.0.469

[Browse files](/octobercms/library/tree/80aab47f044a2660aa352450f55137598f362aa4)
Browse the repository at this point in the history

```
Temporarily disables SVG uploads
Improves path validation in FileDatasource & reorgs / cleans up Halcyon Builder
Adds XSS filtering to SystemException messages (related [c16fefd#diff-4915b631d3234e0c5232490be34effe4](https://github.com/octobercms/library/commit/c16fefde03080fe2b3937e565d9cdf7b70291384#diff-4915b631d3234e0c5232490be34effe4))
```

* Loading branch information

Luke Towers
committed
Sep 4, 2020

1 parent
[0989697](/octobercms/library/commit/09896978bd8b09aac20a8da70ac93c2617afa03c)

commit 80aab47

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**113 additions**
and
**98 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + Exception

    - src/Exception/SystemException.php
      [SystemException.php](#diff-0f4c9a7b240821a524bbebc9e14fe02d89b73bdca2477575a568ceaaa8b72a70)
  + Filesystem

    - src/Filesystem/Definitions.php
      [Definitions.php](#diff-b4b12717c7092dd02d8cf5aa9c16ef64c3b4778a42ee036449b75edb2c4ac023)
  + Halcyon

    - src/Halcyon/Builder.php
      [Builder.php](#diff-7007078f5fce8fd60e22c81848fa40524e2a747d16cac995d3d0c62d3af2ccef)

## There are no files selected for viewing

19 changes: 18 additions & 1 deletion

19
[src/Exception/SystemException.php](#diff-0f4c9a7b240821a524bbebc9e14fe02d89b73bdca2477575a568ceaaa8b72a70 "src/Exception/SystemException.php")

Show comments

[View file](/octobercms/library/blob/80aab47f044a2660aa352450f55137598f362aa4/src/Exception/SystemException.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,12 +1,29 @@ |
|  |  | <?php namespace October\Rain\Exception; |
|  |  |  |
|  |  | use Exception; |
|  |  | use October\Rain\Html\HtmlBuilder; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* This class represents a critical system exception. |
|  |  | \* System exceptions are logged in the error log. |
|  |  | \* |
|  |  | \* @package october\exception |
|  |  | \* @author Alexey Bobkov, Samuel Georges |
|  |  | \* @author Alexey Bobkov, Samuel Georges, Luke Towers |
|  |  | \*/ |
|  |  | class SystemException extends ExceptionBase |
|  |  | { |
|  |  | /\*\* |
|  |  | \* Override the constructor to escape all messages to protect against potential XSS |
|  |  | \* from user provided inputs being included in the exception message |
|  |  | \* |
|  |  | \* @param string $message Error message. |
|  |  | \* @param int $code Error code. |
|  |  | \* @param Exception $previous Previous exception. |
|  |  | \*/ |
|  |  | public function \_\_construct($message = "", $code = 0, Exception $previous = null) |
|  |  | { |
|  |  | $message = HtmlBuilder::clean($message); |
|  |  |  |
|  |  | parent::\_\_construct($message, $code, $previous); |
|  |  | } |
|  |  | } |

2 changes: 0 additions & 2 deletions

2
[src/Filesystem/Definitions.php](#diff-b4b12717c7092dd02d8cf5aa9c16ef64c3b4778a42ee036449b75edb2c4ac023 "src/Filesystem/Definitions.php")

Show comments

[View file](/octobercms/library/blob/80aab47f044a2660aa352450f55137598f362aa4/src/Filesystem/Definitions.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -103,7 +103,6 @@ protected function defaultExtensions() |
|  |  | 'png', |
|  |  | 'webp', |
|  |  | 'gif', |
|  |  | 'svg', |
|  |  | 'js', |
|  |  | 'map', |
|  |  | 'ico', |
| Expand Down  Expand Up | | @@ -163,7 +162,6 @@ protected function assetExtensions() |
|  |  | 'js', |
|  |  | 'woff', |
|  |  | 'woff2', |
|  |  | 'svg', |
|  |  | 'ttf', |
|  |  | 'eot', |
|  |  | 'json', |
| Expand Down | |  |

190 changes: 95 additions & 95 deletions

190
[src/Halcyon/Builder.php](#diff-7007078f5fce8fd60e22c81848fa40524e2a747d16cac995d3d0c62d3af2ccef "src/Halcyon/Builder.php")

Show comments

[View file](/octobercms/library/blob/80aab47f044a2660aa352450f55137598f362aa4/src/Halcyon/Builder.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -142,79 +142,99 @@ public function \_\_construct(DatasourceInterface $datasource, Processor $processo |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Switches mode to select a single template by its name. |
|  |  | \* Get the compiled file content representation of the query. |
|  |  | \* |
|  |  | \* @param string $fileName |
|  |  | \* @return $this |
|  |  | \* @return string |
|  |  | \*/ |
|  |  | public function whereFileName($fileName) |
|  |  | public function toCompiled() |
|  |  | { |
|  |  | $this->selectSingle = $this->model->getFileNameParts($fileName); |
|  |  |  |
|  |  | return $this; |
|  |  | return $this->processor->processUpdate($this, []); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set the directory name which the query is targeting. |
|  |  | \* Get an array with the values of a given column. |
|  |  | \* |
|  |  | \* @param string $dirName |
|  |  | \* @return $this |
|  |  | \* @param string $column |
|  |  | \* @param string $key |
|  |  | \* @return array |
|  |  | \*/ |
|  |  | public function from($dirName) |
|  |  | public function lists($column, $key = null) |
|  |  | { |
|  |  | $this->from = $dirName; |
|  |  | $select = is\_null($key) ? [$column] : [$column, $key]; |
|  |  |  |
|  |  | return $this; |
|  |  | if (!is\_null($this->cacheMinutes)) { |
|  |  | $results = $this->getCached($select); |
|  |  | } |
|  |  | else { |
|  |  | $results = $this->getFresh($select); |
|  |  | } |
|  |  |  |
|  |  | $collection = new Collection($results); |
|  |  |  |
|  |  | return $collection->lists($column, $key); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set the "offset" value of the query. |
|  |  | \* Set the "limit" value of the query. |
|  |  | \* |
|  |  | \* @param int $value |
|  |  | \* @return $this |
|  |  | \*/ |
|  |  | public function offset($value) |
|  |  | public function limit($value) |
|  |  | { |
|  |  | $this->offset = max(0, $value); |
|  |  | if ($value >= 0) { |
|  |  | $this->limit = $value; |
|  |  | } |
|  |  |  |
|  |  | return $this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Alias to set the "offset" value of the query. |
|  |  | \* Alias to set the "limit" value of the query. |
|  |  | \* |
|  |  | \* @param int $value |
|  |  | \* @return \October\Rain\Halcyon\Builder|static |
|  |  | \*/ |
|  |  | public function skip($value) |
|  |  | public function take($value) |
|  |  | { |
|  |  | return $this->offset($value); |
|  |  | return $this->limit($value); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set the "limit" value of the query. |
|  |  | \* Set the "offset" value of the query. |
|  |  | \* |
|  |  | \* @param int $value |
|  |  | \* @return $this |
|  |  | \*/ |
|  |  | public function limit($value) |
|  |  | public function offset($value) |
|  |  | { |
|  |  | if ($value >= 0) { |
|  |  | $this->limit = $value; |
|  |  | } |
|  |  | $this->offset = max(0, $value); |
|  |  |  |
|  |  | return $this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Alias to set the "limit" value of the query. |
|  |  | \* Alias to set the "offset" value of the query. |
|  |  | \* |
|  |  | \* @param int $value |
|  |  | \* @return \October\Rain\Halcyon\Builder|static |
|  |  | \*/ |
|  |  | public function take($value) |
|  |  | public function skip($value) |
|  |  | { |
|  |  | return $this->limit($value); |
|  |  | return $this->offset($value); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set the directory name which the query is targeting. |
|  |  | \* |
|  |  | \* @param string $dirName |
|  |  | \* @return $this |
|  |  | \*/ |
|  |  | public function from($dirName) |
|  |  | { |
|  |  | $this->from = $dirName; |
|  |  |  |
|  |  | return $this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -239,46 +259,18 @@ public function first() |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Execute the query as a "select" statement. |
|  |  | \* |
|  |  | \* @param array $columns |
|  |  | \* @return \October\Rain\Halcyon\Collection|static[] |
|  |  | \*/ |
|  |  | public function get($columns = ['\*']) |
|  |  | { |
|  |  | if (!is\_null($this->cacheMinutes)) { |
|  |  | $results = $this->getCached($columns); |
|  |  | } |
|  |  | else { |
|  |  | $results = $this->getFresh($columns); |
|  |  | } |
|  |  |  |
|  |  | $models = $this->getModels($results ?: []); |
|  |  |  |
|  |  | return $this->model->newCollection($models); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get an array with the values of a given column. |
|  |  | \* Switches mode to select a single template by its name. |
|  |  | \* |
|  |  | \* @param string $column |
|  |  | \* @param string $key |
|  |  | \* @return array |
|  |  | \* @param string $fileName |
|  |  | \* @return $this |
|  |  | \*/ |
|  |  | public function lists($column, $key = null) |
|  |  | public function whereFileName($fileName) |
|  |  | { |
|  |  | $select = is\_null($key) ? [$column] : [$column, $key]; |
|  |  |  |
|  |  | if (!is\_null($this->cacheMinutes)) { |
|  |  | $results = $this->getCached($select); |
|  |  | } |
|  |  | else { |
|  |  | $results = $this->getFresh($select); |
|  |  | } |
|  |  | $this->validateFileName($fileName); |
|  |  |  |
|  |  | $collection = new Collection($results); |
|  |  | $this->selectSingle = $this->model->getFileNameParts($fileName); |
|  |  |  |
|  |  | return $collection->lists($column, $key); |
|  |  | return $this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -321,30 +313,23 @@ protected function runSelect() |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set a model instance for the model being queried. |
|  |  | \* Execute the query as a "select" statement. |
|  |  | \* |
|  |  | \* @param \October\Rain\Halcyon\Model $model |
|  |  | \* @return $this |
|  |  | \* @param array $columns |
|  |  | \* @return \October\Rain\Halcyon\Collection|static[] |
|  |  | \*/ |
|  |  | public function setModel(Model $model) |
|  |  | public function get($columns = ['\*']) |
|  |  | { |
|  |  | $this->model = $model; |
|  |  |  |
|  |  | $this->extensions = $this->model->getAllowedExtensions(); |
|  |  |  |
|  |  | $this->from($this->model->getObjectTypeDirName()); |
|  |  | if (!is\_null($this->cacheMinutes)) { |
|  |  | $results = $this->getCached($columns); |
|  |  | } |
|  |  | else { |
|  |  | $results = $this->getFresh($columns); |
|  |  | } |
|  |  |  |
|  |  | return $this; |
|  |  | } |
|  |  | $models = $this->getModels($results ?: []); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the compiled file content representation of the query. |
|  |  | \* |
|  |  | \* @return string |
|  |  | \*/ |
|  |  | public function toCompiled() |
|  |  | { |
|  |  | return $this->processor->processUpdate($this, []); |
|  |  | return $this->model->newCollection($models); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -408,10 +393,9 @@ public function update(array $values) |
|  |  | /\*\* |
|  |  | \* Delete a record from the database. |
|  |  | \* |
|  |  | \* @param string $fileName |
|  |  | \* @return int |
|  |  | \*/ |
|  |  | public function delete($fileName = null) |
|  |  | public function delete() |
|  |  | { |
|  |  | $this->validateFileName(); |
|  |  |  |
| Expand Down  Expand Up | | @@ -442,6 +426,33 @@ public function lastModified() |
|  |  | ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set a model instance for the model being queried. |
|  |  | \* |
|  |  | \* @param \October\Rain\Halcyon\Model $model |
|  |  | \* @return $this |
|  |  | \*/ |
|  |  | public function setModel(Model $model) |
|  |  | { |
|  |  | $this->model = $model; |
|  |  |  |
|  |  | $this->extensions = $this->model->getAllowedExtensions(); |
|  |  |  |
|  |  | $this->from($this->model->getObjectTypeDirName()); |
|  |  |  |
|  |  | return $this; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the model instance being queried. |
|  |  | \* |
|  |  | \* @return \October\Rain\Halcyon\Model |
|  |  | \*/ |
|  |  | public function getModel() |
|  |  | { |
|  |  | return $this->model; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the hydrated models. |
|  |  | \* |
| Expand All | | @@ -468,16 +479,6 @@ public function getModels(array $results) |
|  |  | return $models->all(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the model instance being queried. |
|  |  | \* |
|  |  | \* @return \October\Rain\Halcyon\Model |
|  |  | \*/ |
|  |  | public function getModel() |
|  |  | { |
|  |  | return $this->model; |
|  |  | } |
|  |  |  |
|  |  | // |
|  |  | // Validation (Hard) |
|  |  | // |
| Expand Down  Expand Up | | @@ -778,9 +779,8 @@ public static function clearInternalCache() |
|  |  | \* |
|  |  | \* @param string $method |
|  |  | \* @param array $parameters |
|  |  | \* @return mixed |
|  |  | \* |
|  |  | \* @throws \BadMethodCallException |
|  |  | \* @return void |
|  |  | \*/ |
|  |  | public function \_\_call($method, $parameters) |
|  |  | { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 13 comments on commit `80aab47`

[![@acasar](https://avatars.githubusercontent.com/u/6329543?s=80&v=4)](/acasar)

Copy link

Contributor

### @acasar **[acasar](/acasar)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42223643)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@LukeTowers](https://github.com/LukeTowers) Not sure why, but this change seems to be the reason, a lot of my code broke.

Previously it was possible to load a template using base path:

```
$twig = Controller::getController()->getTwig();
$template = $twig->load(base_path('template/somewhere/in/the/project.htm'));
$template->render($data);
```

Now trying to so this, I get an error:

```
The specified file name [/var/www/project/template/somewhere/in/the/project.htm] is invalid.

```

Seems like it's connected to some maxNesting level changes. Is there any workaround?

Sorry, something went wrong.

All reactions

[![@LukeTowers](https://avatars.githubusercontent.com/u/7253840?s=80&v=4)](/LukeTowers)

Copy link

Contributor

Author

### @LukeTowers **[LukeTowers](/LukeTowers)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42223891)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@acasar](https://github.com/acasar) use the System Twig environment instead of the CMS one. CMS partials should not be loading from anywhere but the theme itself.

Sorry, something went wrong.

All reactions

[![@LukeTowers](https://avatars.githubusercontent.com/u/7253840?s=80&v=4)](/LukeTowers)

Copy link

Contributor

Author

### @LukeTowers **[LukeTowers](/LukeTowers)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42223909)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

And possible !== actually supported.

Sorry, something went wrong.

All reactions

[![@acasar](https://avatars.githubusercontent.com/u/6329543?s=80&v=4)](/acasar)

Copy link

Contributor

### @acasar **[acasar](/acasar)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42224197)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> use the System Twig environment instead of the CMS one

Is there any documentation on how to do that? Do I need to write the entire Twig initialization logic myself?

Sorry, something went wrong.

All reactions

[![@LukeTowers](https://avatars.githubusercontent.com/u/7253840?s=80&v=4)](/LukeTowers)

Copy link

Contributor

Author

### @LukeTowers **[LukeTowers](/LukeTowers)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42224405) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@acasar](https://github.com/acasar) nope, just do the following:

```
use Twig;

Twig::parse($templateContents, $templateVars);

```

Sorry, something went wrong.

All reactions

[![@acasar](https://avatars.githubusercontent.com/u/6329543?s=80&v=4)](/acasar)

Copy link

Contributor

### @acasar **[acasar](/acasar)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42224814) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@LukeTowers](https://github.com/LukeTowers) Sadly that's not suitable for me, since I still need support for tags like {% patrial '...' %} etc.

I know the "correct" solution would be to structure the project a bit differently, but I'd have to do that on 170+ websites, which is not really an option. I guess I'll need to find some other workaround....

Sorry, something went wrong.

All reactions

[![@acasar](https://avatars.githubusercontent.com/u/6329543?s=80&v=4)](/acasar)

Copy link

Contributor

### @acasar **[acasar](/acasar)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42225860)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I ended up extending Halcyon Builder to re-add support for absolute paths:

```
protected function validateFileNamePath($filePath, $maxNesting = 2)
{
     if(file_exists($filePath)) {
        return true;
    }

    return parent::validateFileNamePath($filePath, $maxNesting);
}
```

Sorry, something went wrong.

All reactions

[![@LukeTowers](https://avatars.githubusercontent.com/u/7253840?s=80&v=4)](/LukeTowers)

Copy link

Contributor

Author

### @LukeTowers **[LukeTowers](/LukeTowers)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42236843)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@acasar](https://github.com/acasar) message me on Slack or Discord and I'll help you come up with a better solution, we can have a video call too if you'd like.

Sorry, something went wrong.

All reactions

[![@LukeTowers](https://avatars.githubusercontent.com/u/7253840?s=80&v=4)](/LukeTowers)

Copy link

Contributor

Author

### @LukeTowers **[LukeTowers](/LukeTowers)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42242497)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@acasar](https://github.com/acasar) I've come up with a possible fix for your use case so you don't have to change any code at all, as long as you aren't expecting `base_path('template/somewhere/in/the/project.htm')` to be treated as a Partial object (i.e. with support for a PHP code section and an INI configuration section)

Sorry, something went wrong.

 👍
1
 acasar reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![@LukeTowers](https://avatars.githubusercontent.com/u/7253840?s=80&v=4)](/LukeTowers)

Copy link

Contributor

Author

### @LukeTowers **[LukeTowers](/LukeTowers)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 11, 2020](#commitcomment-42242728)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@acasar](https://github.com/acasar) try applying [octobercms/october@dca6128](https://github.com/octobercms/october/commit/dca6128501890473043cbe2bfd3016b4f48d39d6) locally. Please let me know if that resolves your issue.

Sorry, something went wrong.

 👍
1
 Eoler reacted with thumbs up emoji
 ❤️
1
 acasar reacted with heart emoji

All reactions

* 👍
  1 reaction
* ❤️
  1 reaction

[![@acasar](https://avatars.githubusercontent.com/u/6329543?s=80&v=4)](/acasar)

Copy link

Contributor

### @acasar **[acasar](/acasar)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 14, 2020](#commitcomment-42284713)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@LukeTowers](https://github.com/LukeTowers) Yes, the [octobercms/october@dca6128](https://github.com/octobercms/october/commit/dca6128501890473043cbe2bfd3016b4f48d39d6) works great and solves my issue. Thanks a lot! 👍

And sorry for late reply, was unavailable during the weekend.

Sorry, something went wrong.

 👍
1
 LukeTowers reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![@daftspunk](https://avatars.githubusercontent.com/u/1392869?s=80&v=4)](/daftspunk)

Copy link

Member

### @daftspunk **[daftspunk](/daftspunk)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 30, 2020](#commitcomment-42836685) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@acasar](https://github.com/acasar) Upon further review from myself, this change will likely continue to break your implementation ([octobercms/october@f9e14b0](https://github.com/octobercms/october/commit/f9e14b02f586d509499b292ea9b8017208f02ce3))

The approach you've taken is not (and will not ever be) supported natively by the system, that is the direct inclusion of external files in the theme engine outside the theme path, or in the Twig engine.

Try placing your reusable files in a views directory, using Laravel's engine. `View::make('vendor.plugin::someview.htm')` => `{% include 'vendor.plugin::someview.htm' %}`

However, Luke may have further input on this, so watch this space, I suppose

Sorry, something went wrong.

All reactions

[![@acasar](https://avatars.githubusercontent.com/u/6329543?s=80&v=4)](/acasar)

Copy link

Contributor

### @acasar **[acasar](/acasar)** commented on `[80aab47](/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4)` [Sep 30, 2020](#commitcomment-42847849)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@daftspunk](https://github.com/daftspunk) ok, thanks for notifying me. Will keep my workaround in place for all existing projects all I'll structure new projects differently.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Flibrary%2Fcommit%2F80aab47f044a2660aa352450f55137598f362aa4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_bb0118f1_20250119_135841.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  ( (" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? ʂ����� �99����RM�{w1CJR� N���U�,4����a��W��<0$v�!��𜲴�)�TWG��~6��S4�I�
����xʻ��}�+��r9�=k®�Z�g�x���# ���oL��d�}4�^�iP7������?
�0�Q�L�4�f�B �Π�j�c5K��܋���Ñ�G3�1�1܌�}?�e� ���~F�j�97���3����A����h����?c�6�Ú�}\_is�"�N�BP����#���a��j2�뉆��4�ǩ� [ז�\_��o8'
����ZV���N�0qZ�7���?�z���}X� ��\�t���,�ă�� צ��o�꿑� ��Z\*D��

=== Content from github.com_c666f0fe_20250119_121914.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fsecurity%2Fadvisories%2FGHSA-xwjr-6fj7-fc6h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fsecurity%2Fadvisories%2FGHSA-xwjr-6fj7-fc6h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=octobercms%2Foctober)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[octobercms](/octobercms)
/
**[october](/octobercms/october)**
Public

* [Notifications](/login?return_to=%2Foctobercms%2Foctober) You must be signed in to change notification settings
* [Fork
  2.2k](/login?return_to=%2Foctobercms%2Foctober)
* [Star
   11.1k](/login?return_to=%2Foctobercms%2Foctober)

* [Code](/octobercms/october)
* [Issues
  4](/octobercms/october/issues)
* [Pull requests
  0](/octobercms/october/pulls)
* [Actions](/octobercms/october/actions)
* [Security](/octobercms/october/security)
* [Insights](/octobercms/october/pulse)

Additional navigation options

* [Code](/octobercms/october)
* [Issues](/octobercms/october/issues)
* [Pull requests](/octobercms/october/pulls)
* [Actions](/octobercms/october/actions)
* [Security](/octobercms/october/security)
* [Insights](/octobercms/october/pulse)

# Local File Inclusion by unauthenticated users

High

[LukeTowers](/LukeTowers)
published
GHSA-xwjr-6fj7-fc6h
Nov 22, 2020

## Package

composer

october/cms
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

>= 1.0.421, < 1.0.469

## Patched versions

1.0.469

## Description

### Impact

An attacker can exploit this vulnerability to read local files on an October CMS server. The vulnerability is exploitable by unauthenticated users via a specially crafted request.

### Patches

Issue has been patched in Build 469 (v1.0.469) and v1.1.0.

### Workarounds

Apply [octobercms/library@80aab47](https://github.com/octobercms/library/commit/80aab47f044a2660aa352450f55137598f362aa4) to your installation manually if unable to upgrade to Build 469.

### References

Reported by [ka1n4t](https://github.com/ka1n4t)

### For more information

If you have any questions or comments about this advisory:

* Email us at hello@octobercms.com

### Threat assessment:

[![Screen Shot 2020-10-10 at 1 05 19 PM](https://user-images.githubusercontent.com/7253840/95663086-4ffc4780-0af9-11eb-9bb6-fd40cf11c033.png)](https://user-images.githubusercontent.com/7253840/95663086-4ffc4780-0af9-11eb-9bb6-fd40cf11c033.png)

### Severity

High

### CVE ID

CVE-2020-15246

### Weaknesses

No CWEs

### Credits

* [![@ka1n4t](https://avatars.githubusercontent.com/u/22983012?s=40&v=4)](/ka1n4t)
  [ka1n4t](/ka1n4t)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


