=== Content from bugzilla.mozilla.org_27c39c1b_20250119_121627.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1654211)
* [XML](/show_bug.cgi?ctype=xml&id=1654211)

Closed
[Bug 1654211](/show_bug.cgi?id=1654211)
(CVE-2020-15678)

Opened 4 years ago
Closed 4 years ago

# AddressSanitizer: heap-use-after-free [@ ~BorrowedSourceSurface] with READ of size 8

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

AddressSanitizer: heap-use-after-free [@ ~BorrowedSourceSurface] with READ of size 8

## Categories

### (Core :: Graphics, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

82 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=unaffected) |
| firefox-esr78 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected) |
| firefox78 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox78&o1=equals&v1=unaffected) |
| firefox79 | [+](/buglist.cgi?f1=cf_tracking_firefox79&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=wontfix) |
| firefox80 | [+](/buglist.cgi?f1=cf_tracking_firefox80&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox80&o1=equals&v1=wontfix) |
| firefox81 | [+](/buglist.cgi?f1=cf_tracking_firefox81&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=fixed) |
| firefox82 | [+](/buglist.cgi?f1=cf_tracking_firefox82&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox82&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | unaffected |
| firefox-esr78 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox78 |  | unaffected |
| firefox79 | + | wontfix |
| firefox80 | + | wontfix |
| firefox81 | + | fixed |
| firefox82 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: jgilbert)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1664257](/show_bug.cgi?id=1664257 "RESOLVED FIXED - Crash in [@ mozilla::WeakPtr<T>::operator=]")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1632249](/show_bug.cgi?id=1632249 "RESOLVED FIXED - WebGL compositing refactor (for out-of-process)")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1646408](/show_bug.cgi?id=1646408 "RESOLVED FIXED - Crash in [@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface]")

## Details

### (5 keywords, Whiteboard: [sec-survey][post-critsmash-triage][adv-main81+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-15678

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sec-survey][post-critsmash-triage][adv-main81+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a3664102_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | [qe-verify](#a4499934_458186 "4 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Alayers%3A%3ABorrowedSourceSurface%3A%3A~BorrowedSourceSurface)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [Detailed Crash Information](/attachment.cgi?id=9164969)  [4 years ago](#c1)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   22.60 KB, text/plain |  | [Details](/attachment.cgi?id=9164969&action=edit) |
| --- | --- | --- |
| [Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.](/attachment.cgi?id=9171792)  [4 years ago](#c9)  [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)   47 bytes, text/x-phabricator-request | tjr : [approval-mozilla-beta+](#c11 "4 years ago")  tjr : [sec-approval+](#c11 "4 years ago") | [Details](/attachment.cgi?id=9171792&action=edit) | [Review](/attachment.cgi?id=9171792) |
| [advisory.txt](/attachment.cgi?id=9176106)  [4 years ago](#c19)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   180 bytes, text/plain |  | [Details](/attachment.cgi?id=9176106&action=edit) |
| [advisory.txt](/attachment.cgi?id=9176801)  [4 years ago](#c20)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   209 bytes, text/plain |  | [Details](/attachment.cgi?id=9176801&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1654211#c0)• 4 years ago |
|  | |

The attached crash information was submitted via the ASan Nightly Reporter on mozilla-central-asan-nightly revision 80.0a1-20200719090414-<https://hg.mozilla.org/mozilla-central/rev/e785ebabf7e142898e31a6c81a4d43d44eff39e3>.

For detailed crash information, see attachment.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1654211#c1)• 4 years ago |
|  | |

Attached file
[Detailed Crash Information](attachment.cgi?id=9164969)
— [Details](attachment.cgi?id=9164969&action=edit)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a71_395101)• 4 years ago |

Flags: sec-bounty?

|  | [Brian Carpenter [:geeknik]](/user_profile?user_id=31466) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1654211#c3)• 4 years ago |
|  | |

This was discovered on Fedora 31, this box has an Nvidia RTX 2070 with the official 440.100 drivers. Window manager is xfce4. The following extra configuration options are set if it makes a difference:

```
gfx.webrender.all = true
fission.autostart = true
image.avif.enabled = true

```

No other information to share as this seems to have been found while randomly browsing the web. If I can trigger this again, I'll keep notes.

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a43987_486634)• 4 years ago |

Group: core-security → gfx-core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1654211#c4)• 4 years ago |
|  | |

[This crash](https://hg.mozilla.org/mozilla-central/annotate/e785ebabf7e142898e31a6c81a4d43d44eff39e3/gfx/layers/CanvasRenderer.cpp#l32) appears to be in code added in a WebGL refactor for out-of-process ([bug 1632249](/show_bug.cgi?id=1632249 "RESOLVED FIXED - WebGL compositing refactor (for out-of-process)")), so that puts a lower limit on affected versions at 79, though this could be a more recent regression. `mReturnTo` is a raw pointer so apparently the borrowed surface is outliving the "persistent" buffer somehow.

[status-firefox79](/buglist.cgi?f1=cf_status_firefox79&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=%3F)Flags: needinfo?(jgilbert)Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1654211#c5)• 4 years ago |
|  | |

Crashes start in the 20200611093454 build which would be consistent to when [bug 1632249](/show_bug.cgi?id=1632249 "RESOLVED FIXED - WebGL compositing refactor (for out-of-process)") was checked in. [bug 1646408](/show_bug.cgi?id=1646408 "RESOLVED FIXED - Crash in [@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface]") was filed on the regressing signature but not tagged as a security bug. Although Linux crashes look like null derefs, Windows ones are clearly UAF -- rax is `0xe5e5e5e5e5e5e5e5`. for example [bp-e922e421-30e8-49dc-9a5a-ee5230200703](https://crash-stats.mozilla.org/report/index/e922e421-30e8-49dc-9a5a-ee5230200703)

[Tracking Requested - why for this release]:

I'm sure this is way too late for 79--haven't even started looking at a fix--but wanted to flag it for visibility since it's a security regression in that release.

Crash Signature: [@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface ]
[status-firefox78](/buglist.cgi?f1=cf_status_firefox78&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox78&o1=equals&v1=unaffected)
[status-firefox79](/buglist.cgi?f1=cf_status_firefox79&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=unaffected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected)
[tracking-firefox79](/buglist.cgi?f1=cf_tracking_firefox79&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox79&o1=equals&v1=%3F)
[tracking-firefox80](/buglist.cgi?f1=cf_tracking_firefox80&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox80&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a53418_1689)• 4 years ago |

See Also: → [1646408](/show_bug.cgi?id=1646408 "RESOLVED FIXED - Crash in [@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface]")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a53501_1689)• 4 years ago |

Regressed by: [1632249](/show_bug.cgi?id=1632249 "RESOLVED FIXED - WebGL compositing refactor (for out-of-process)")

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a53501_546015)• 4 years ago |

Has Regression Range: --- → yes

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1654211#c6)• 4 years ago |
|  | |

Thanks, I'll look.

Flags: needinfo?(jgilbert)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a56271_419431)• 4 years ago |

Assignee: nobody → jgilbertSeverity: critical → S2Priority: -- → P1

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1654211#c7)• 4 years ago |
|  | |

tracking+ for 79, but yeah, probably too late to get it fixed except maaaaybe in a dot release :(

[status-firefox79](/buglist.cgi?f1=cf_status_firefox79&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=fix-optional)
[tracking-firefox79](/buglist.cgi?f1=cf_tracking_firefox79&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox79&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox79&o1=equals&v1=%2B)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a1472668_580382)• 4 years ago |

[status-firefox79](/buglist.cgi?f1=cf_status_firefox79&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=wontfix)
[status-firefox81](/buglist.cgi?f1=cf_status_firefox81&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=affected)
[tracking-firefox81](/buglist.cgi?f1=cf_tracking_firefox81&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox81&o1=equals&v1=%2B)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1654211#c8)• 4 years ago |
|  | |

Any updates Jeff? We're about to build the last beta for 80.

Flags: needinfo?(jgilbert)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a2090052_580382)• 4 years ago |

[status-firefox80](/buglist.cgi?f1=cf_status_firefox80&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox80&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox80&o1=equals&v1=wontfix)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1654211#c9)• 4 years ago |
|  | |

Attached file
[Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.](attachment.cgi?id=9171792)
— [Details](attachment.cgi?id=9171792&action=edit)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1654211#c10)• 4 years ago |
|  | |

Comment on [attachment 9171792](/attachment.cgi?id=9171792 "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.") [[details]](/attachment.cgi?id=9171792&action=edit "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.")

[Bug 1654211](/show_bug.cgi?id=1654211 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free [@ ~BorrowedSourceSurface] with READ of size 8") - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Hard: An attacker would need to construct a situation that replaced the PresistentBufferProvider's memory with something else, such that this call to `PresistentBufferProvider->ReturnSnapshot(surf)` causes an issue.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: 79+
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1632249](/show_bug.cgi?id=1632249 "RESOLVED FIXED - WebGL compositing refactor (for out-of-process)")
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Should be trivial.
* **How likely is this patch to cause regressions; how much testing does it need?**: Low chance for regressions for this very targeted fix.
Flags: needinfo?(jgilbert)
[Attachment #9171792](/attachment.cgi?id=9171792&action=edit "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.") -
Flags: sec-approval?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a3104800_580382)• 4 years ago |

[status-firefox82](/buglist.cgi?f1=cf_status_firefox82&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox82&o1=equals&v1=affected)
[tracking-firefox82](/buglist.cgi?f1=cf_tracking_firefox82&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox82&o1=equals&v1=%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1654211#c11)• 4 years ago |
|  | |

Comment on [attachment 9171792](/attachment.cgi?id=9171792 "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.") [[details]](/attachment.cgi?id=9171792&action=edit "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.")

[Bug 1654211](/show_bug.cgi?id=1654211 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free [@ ~BorrowedSourceSurface] with READ of size 8") - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.

Approved to land and uplift

[Attachment #9171792](/attachment.cgi?id=9171792&action=edit "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.") -
Flags: sec-approval?
[Attachment #9171792](/attachment.cgi?id=9171792&action=edit "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.") -
Flags: sec-approval+
[Attachment #9171792](/attachment.cgi?id=9171792&action=edit "Bug 1654211 - Hold WeakPtr to PresistentBufferProvider in BorrowedSourceSurface.") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1654211#c12)• 4 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/0ec8df5bd92b7847098a2d5e1c784e7baf381a24>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1654211#c13)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/4b90dac4c40b>

[status-firefox81](/buglist.cgi?f1=cf_status_firefox81&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=fixed)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1654211#c14)• 4 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/0ec8df5bd92b>

Group: gfx-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 4 years ago
[status-firefox82](/buglist.cgi?f1=cf_status_firefox82&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox82&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox82&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 82 Branch

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a3664102_1689)• 4 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1654211#c15)• 4 years ago |
|  | |

Jeff, can we resolve [bug 1646408](/show_bug.cgi?id=1646408 "RESOLVED FIXED - Crash in [@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface]") with this one fixed?

Flags: needinfo?(jgilbert)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1654211#c16)• 4 years ago |
|  | |

(In reply to Frederik Braun [:freddy] from [comment #15](/show_bug.cgi?id=1654211#c15 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free [@ ~BorrowedSourceSurface] with READ of size 8"))

> Jeff, can we resolve [bug 1646408](/show_bug.cgi?id=1646408 "RESOLVED FIXED - Crash in [@ mozilla::layers::BorrowedSourceSurface::~BorrowedSourceSurface]") with this one fixed?

Yes, but how and when? (given that this is a sec bug not fixed in all versions)

Flags: needinfo?(jgilbert) → needinfo?(fbraun)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1654211#c17)• 4 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1654211) to reply.

Flags: needinfo?(jgilbert)Whiteboard: [sec-survey]

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1654211#c18)• 4 years ago |
|  | |

Survey submitted!

Flags: needinfo?(jgilbert)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a4451739_419431)• 4 years ago |

Regressions: [1664257](/show_bug.cgi?id=1664257 "RESOLVED FIXED - Crash in [@ mozilla::WeakPtr<T>::operator=]")

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a4499934_458186)• 4 years ago |

Flags: qe-verify-Whiteboard: [sec-survey] → [sec-survey][post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a4884769_578488)• 4 years ago |

Whiteboard: [sec-survey][post-critsmash-triage] → [sec-survey][post-critsmash-triage][adv-main81+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a4926001_428608)• 4 years ago |

Flags: needinfo?(fbraun)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1654211#c19)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9176106) (obsolete)
— [Details](attachment.cgi?id=9176106&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1654211#c20)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9176801)
— [Details](attachment.cgi?id=9176801&action=edit)

[Attachment #9176106](/attachment.cgi?id=9176106&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a5342860_578488)• 4 years ago |

Alias: CVE-2020-15678

|  | [Brian Carpenter [:geeknik]](/user_profile?user_id=31466) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1654211#c21)• 4 years ago |
|  | |

Can you update the alias of this bug to [CVE-2020-15675](https://www.cve.org/CVERecord?id=CVE-2020-15675) and update the alias of [bug 1660211](/show_bug.cgi?id=1660211 "RESOLVED FIXED - Iterator invalidation potentially causing memory corruption") to [CVE-2020-15678](https://www.cve.org/CVERecord?id=CVE-2020-15678)? I think they got flipped around. Thanks!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a13021360_1689)• 4 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1654211#a121769929_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1654211&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_9aa49ca3_20250119_121627.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2020-42

## Security Vulnerabilities fixed in Firefox 81

Announced
September 22, 2020
Impact
high
Products
Firefox
Fixed in

* Firefox 81

#### [#CVE-2020-15675: Use-After-Free in WebGL](#CVE-2020-15675)

Reporter
Brian Carpenter via the ASAN Nightly project
Impact
high
##### Description

When processing surfaces, the lifetime may outlive a persistent buffer leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1654211](https://bugzilla.mozilla.org/show_bug.cgi?id=1654211)

#### [#CVE-2020-15677: Download origin spoofing via redirect](#CVE-2020-15677)

Reporter
Richard Thomas and Tom Chothia of University of Birmingham
Impact
moderate
##### Description

By exploiting an Open Redirect vulnerability on a website, an attacker could have spoofed the site displayed in the download file dialog to show the original site (the one suffering from the open redirect) rather than the site the file was actually downloaded from.

##### References

* [Bug 1641487](https://bugzilla.mozilla.org/show_bug.cgi?id=1641487)

#### [#CVE-2020-15676: XSS when pasting attacker-controlled data into a contenteditable element](#CVE-2020-15676)

Reporter
Daniel Fröjdendahl
Impact
moderate
##### Description

Firefox sometimes ran the onload handler for SVG elements that the DOM sanitizer decided to remove, resulting in JavaScript being executed after pasting attacker-controlled data into a contenteditable element.

##### References

* [Bug 1646140](https://bugzilla.mozilla.org/show_bug.cgi?id=1646140)

#### [#CVE-2020-15678: When recursing through layers while scrolling, an iterator may have become invalid, resulting in a potential use-after-free scenario](#CVE-2020-15678)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

When recursing through graphical layers while scrolling, an iterator may have become invalid, resulting in a potential use-after-free. This occurs because the function `APZCTreeManager::ComputeClippedCompositionBounds` did not follow iterator invalidation rules.

##### References

* [Bug 1660211](https://bugzilla.mozilla.org/show_bug.cgi?id=1660211)

#### [#CVE-2020-15673: Memory safety bugs fixed in Firefox 81 and Firefox ESR 78.3](#CVE-2020-15673)

Reporter
Jason Kratzer
Impact
high
##### Description

Mozilla developer Jason Kratzer reported memory safety bugs present in Firefox 80 and Firefox ESR 78.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 81 and Firefox ESR 78.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1648493%2C1660800)

#### [#CVE-2020-15674: Memory safety bugs fixed in Firefox 81](#CVE-2020-15674)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Byron Campen and Christian Holler reported memory safety bugs present in Firefox 80. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 81](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1656063%2C1656064%2C1656067%2C1660293)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


