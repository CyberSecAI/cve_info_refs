=== Content from daniels-it-blog.blogspot.com_0660d846_20250119_115249.html ===

[Skip to main content](#main)

Search

### Search This Blog

# [Another IT Security Blog](http://daniels-it-blog.blogspot.com/)

IT Security, Hacking and More

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

[June 29, 2020](http://daniels-it-blog.blogspot.com/2020/06/when-your-anti-virus-turns-against-you.html "permanent link")

### When your Anti Virus turns against you...

**Product:** IOBit Malware Fighter Pro**Version:** 8.0.2.547**Tested on:** Windows 10 Pro 2004 x64**Vendor informed:** Yes**PoC:**https://github.com/Daniel-itsec/Malwarefighter/blob/master/config.ini**CVE:** 2020-15401[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjtm6M3co4zp6-C4X6POwgx7zhjChQMSo2yx-6BGpsKvT2Pq4PVA6cruPHkTJKiZq_0nS0szQ8UqhK4OKCLvPmBpiyLnWA-hpYzbAGzR_XyQuEgGx3Thyphenhyphenvy5GQwFM8VY6dn1rNd42KKxXI/w500-h256/2020-06-22+20_33_39-Temp.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjtm6M3co4zp6-C4X6POwgx7zhjChQMSo2yx-6BGpsKvT2Pq4PVA6cruPHkTJKiZq_0nS0szQ8UqhK4OKCLvPmBpiyLnWA-hpYzbAGzR_XyQuEgGx3Thyphenhyphenvy5GQwFM8VY6dn1rNd42KKxXI/s1045/2020-06-22%2B20_33_39-Temp.png)

After IOBit explained that they have a "great test team which fill all the bugs in our products" I thought it is a good idea to take a look at more products from IOBit and I found "IOBit Malware Fighter Pro". I spend only one evening in finding the bugs and playing around with Malware Fighter. I already thought that Malware Fighter Pro (or free) is full of bugs due to my last analysis of "IOBit Advanced System Care". The bugs I found can lead to a deactivation of **all** AV features incl. Windows Defender or simply just damage to the system. I created a real world scenario as a PoC.
As every other AV solution also Malware Fighter (MF) uses a scan engine to detect malicious file and to remove/quarantine them after detection. Of course files/folders can also be added to a whitelist to exclude them from scanning and allow execution. In this example my goal is deactivate all Virus Scanner Features of Malware Fighter to allow eicar download and handling. Additionally I will lock MF for further usage and remove Microsoft Windows Defender to avoid having a AV solution on the system if MF is uninstalled.
MF runs under the highest possible level in Windows OS which is "NT AUTHORITY\SYSTEM". This is needed to remove malware which require higher access rights. When MF detects a malicious file it will
1. Automatically delete it/move to quarantine2. Ask the user what to do with this file
It doesn´t matter which method will be used it is still allowed for regular users to delete the file! This is possible because MF does set an delete oplock on the file and when set to "delete automatically" it will not delete the file when it is detected rather after over one second. I guess this is because MD does some additionally checks but I haven´t investigated this further. This brings an attacker into an interesting situation where the attacker can delete a file with SYSTEM rights. Also called arbitrary file deletion.
Malware Fighter uses the folder "C:\ProgramData\IObit\IObit Malware Fighter" to store configuration files. This folder is writable for regular users but they can not delete or write to existing files
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgddIad7CtmRQxOJ9GXGlkQhcZ0P3y-OSzhtYhpF5Sxj91D4NLyGjCQykab8ozvbejQff30sSugf1VYA9-Sksk6MBQKw7OJ1ybqm0R8W4-2vGaus8XSMjB8OTiDUpOqxtxloqyB8nKXu8s/w625-h361/2020-06-23+20_34_10-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgddIad7CtmRQxOJ9GXGlkQhcZ0P3y-OSzhtYhpF5Sxj91D4NLyGjCQykab8ozvbejQff30sSugf1VYA9-Sksk6MBQKw7OJ1ybqm0R8W4-2vGaus8XSMjB8OTiDUpOqxtxloqyB8nKXu8s/s961/2020-06-23%2B20_34_10-Window.png)
Malware Fighter uses the "C:\ProgramData\IObit\IObit Malware Fighter\config.ini" file to store its configuration. Some settings are presented just by a "1" others are presented by a numerical code. In config.ini the entry "ConfigType" holds the value which represents the actual configuration of MF.
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhjaYr0PsybOcryhc81B6NiSaTdXHZfoB4IhXPweg3JNWCv1q05EE2pqyapo_VMW1Gw966w5m94uN0oeQPGAsd0-BzS8uZ0io69asWKcRTtRlEteGXrYdl9jy3Pz-9ENK8rKZ1lv7bmqxM/w400-h70/2020-06-23+20_40_04-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhjaYr0PsybOcryhc81B6NiSaTdXHZfoB4IhXPweg3JNWCv1q05EE2pqyapo_VMW1Gw966w5m94uN0oeQPGAsd0-BzS8uZ0io69asWKcRTtRlEteGXrYdl9jy3Pz-9ENK8rKZ1lv7bmqxM/s725/2020-06-23%2B20_40_04-Window.png)
A value of "2047" means that all protection features are activated.
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg2q8Q5PzjcUV078tEy2r3RGyazqe3KnWwkPGM-tF9KSenti89QtmMYnvFIthM-Gv6ztWooGwBwUijzETidmlEU6gcuhIETf8DonPMVE1s9Pk64Oxl36SzgHGxO2PZu1kDnmNHfVUB8SZ0/w500-h306/2020-06-23+20_41_10-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg2q8Q5PzjcUV078tEy2r3RGyazqe3KnWwkPGM-tF9KSenti89QtmMYnvFIthM-Gv6ztWooGwBwUijzETidmlEU6gcuhIETf8DonPMVE1s9Pk64Oxl36SzgHGxO2PZu1kDnmNHfVUB8SZ0/s1403/2020-06-23%2B20_41_10-Window.png)
A value of "560" means settings are deactivated.
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgfLV0MZId3Qy2h9AMrIEWNoN9YluYvnrYW4IR2gHNiCfNpsZ0qul-3c3MxGzmAPzyPEOxt-GVvCtQIoL5JBcE-iakL5zD23t3zZosYeM2wC9rC9lJChA_x1fM4VKs4QY6QFVtNkeG6zMQ/w400-h98/2020-06-23+20_43_29-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgfLV0MZId3Qy2h9AMrIEWNoN9YluYvnrYW4IR2gHNiCfNpsZ0qul-3c3MxGzmAPzyPEOxt-GVvCtQIoL5JBcE-iakL5zD23t3zZosYeM2wC9rC9lJChA_x1fM4VKs4QY6QFVtNkeG6zMQ/s871/2020-06-23%2B20_43_29-Window.png)
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjGIv5lbDCoIIcq0cc7DFKpkTgjtmXETW5r30mHuhmUF-vIlEefueRwkOwXpQcari7vMnO5h8hHIZa3Y4LDOqSfWGtL2aPytWDS7fP8rZME21kxSZO4t6xfxGNq9MEy9O-jCZ4yPk2tW2k/w500-h339/2020-06-23+20_46_46-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjGIv5lbDCoIIcq0cc7DFKpkTgjtmXETW5r30mHuhmUF-vIlEefueRwkOwXpQcari7vMnO5h8hHIZa3Y4LDOqSfWGtL2aPytWDS7fP8rZME21kxSZO4t6xfxGNq9MEy9O-jCZ4yPk2tW2k/s1406/2020-06-23%2B20_46_46-Window.png)
When all settings are deactivated users will also see this notification
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi12k9MPUPeALVyLhwoTsiDVO4qZJEeLt1Q1BE_IcqDhdEViPstZHYGy_KY7l0bdtHTBxuRSx40LrDieeUxZRMCLGrEAhE89cPsDl0IoiyXbxd1PK0gq2ZZl82ESrh7hkzfSaeTjstA6vM/s320/2020-06-23+20_42_44-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi12k9MPUPeALVyLhwoTsiDVO4qZJEeLt1Q1BE_IcqDhdEViPstZHYGy_KY7l0bdtHTBxuRSx40LrDieeUxZRMCLGrEAhE89cPsDl0IoiyXbxd1PK0gq2ZZl82ESrh7hkzfSaeTjstA6vM/s369/2020-06-23%2B20_42_44-Window.png)
\*A sample of a configuration file which turns off all settings can be found in the PoC link at the beginning of this article.

**So how does the attack actual look like?** Pretty easy:

1. Create a malicious file (like eicar test file) \*The file can be named keylogger.exe to scar users
2. Trigger the detection. This can be automatically or by just reading the file.
3. Remove the file
4. Create a NTFS folder junction and RPC link (pseudo-symlink). Good explanation about symlinks can be found here: <https://offsec.almond.consulting/intro-to-file-operation-abuse-on-Windows.html>
5. Wait until the file gets removed / moved to quarantine

Usually this is bad enough because it allows an attacker to delete system protected files like the hosts file. But we can extend this attack like this

1. Create a malicious file (like eicar test file)
2. Trigger the detection. This can be done automatically or by just reading the file
3. Remove the file
4. Create a NTFS folder junction and RPC link (pseudo-symlink) to Windows Defender executable ("C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2006.8-0\MsMpEng.exe")
5. Wait until the file is removed. The filename will be saved and the selected operation (delete(move to quarantine) will be automatically executed without notifying the user
6. Repeat step 4 with "C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2006.8-0\MsMpEng.exe" as target (version umber can be different)
7. Repeat step 4 with "C:\ProgramData\IObit\IObit Malware Fighter\config.ini" as target
8. Write a new config file. Malware Fighter will read the new settings shortly (few seconds)
9. \*Additionally you can also replace the config files holding the whitelist entries ("C:\ProgramData\IObit\IObit Malware Fighter\sswlist.ini")

What will happen after following the above steps: Malware Fighter will first delete the Microsoft Windows Defender executables. After that MF will delete its own config file. And finally the new config file will be written. MF will shortly apply the settings stored in the (self written) config file.
It is also possible to delete "C:\Program Files (x86)\IObit\IObit Malware Fighter\IMF.exe". In this case MF Service will run as usual but it will do nothing. You can download the eicar file, run malware etc. the system is not protected. Due to the fact that MF main executable is missing it not possible to open MF anymore. Additionally Windows Defender will present this Window (because the Malware Fighter Service is still running)
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiSAk15w4U2P00pXjskh0zG71NGkPhHq4xmamMnIlza4bx1gqxvOKhH0QfQQ3_FihVjBnN35cGc0XbJwUK66l1wSpaZJYAOiRrwsWWPrSXqsl1aw-sw-JiGEK2iHHY6JTh-zl6ZaRBH6Ss/w331-h400/2020-06-23+22_36_26-Windows+Security.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiSAk15w4U2P00pXjskh0zG71NGkPhHq4xmamMnIlza4bx1gqxvOKhH0QfQQ3_FihVjBnN35cGc0XbJwUK66l1wSpaZJYAOiRrwsWWPrSXqsl1aw-sw-JiGEK2iHHY6JTh-zl6ZaRBH6Ss/s617/2020-06-23%2B22_36_26-Windows%2BSecurity.png)
When also the uninstaller files are deleted the user will have a system with no working malware protection showing that the system is fully protected. When the user tries to uninstall this glorious software he or she will see this window

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJp6He38Lc27UggYTxY9bxhzdww27TUelVoFdg5Tp3yrxDs3IVQ-pNtBlETHjvKMfLI0yicnSp0FESMvQemHdPQG3HxDBpo2u1RppFs99PqPoNoJBvex2WnhwW5WmL4E8iA0AVuaDnZlA/s320/2020-06-23+22_39_29-Programs+and+Features.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJp6He38Lc27UggYTxY9bxhzdww27TUelVoFdg5Tp3yrxDs3IVQ-pNtBlETHjvKMfLI0yicnSp0FESMvQemHdPQG3HxDBpo2u1RppFs99PqPoNoJBvex2WnhwW5WmL4E8iA0AVuaDnZlA/s351/2020-06-23%2B22_39_29-Programs%2Band%2BFeatures.png)

If Microsoft Defender and IOBit Malware Fighter executables are deleted Windows Security will end up like this
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg7fvXfHHy9gmbglH5D8PDNkZK08siThgg6hyxOx-zaVRaY4s7OitY5oS0tIReonj-9IDAMNoZe9dFuq_TJ_rgoXiT11Tiyf46CvSHhSv_KVht5mT0cwSWNEWqMXvpQbwhoZdKAPEuIJCE/w625-h250/2020-06-23+22_53_01-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg7fvXfHHy9gmbglH5D8PDNkZK08siThgg6hyxOx-zaVRaY4s7OitY5oS0tIReonj-9IDAMNoZe9dFuq_TJ_rgoXiT11Tiyf46CvSHhSv_KVht5mT0cwSWNEWqMXvpQbwhoZdKAPEuIJCE/s1219/2020-06-23%2B22_53_01-Window.png)
Of course the service cannot be restarted because there is no executable to run and therefore there is no Virus protection
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhuBDCwJZd92iulbh2jj050K1GnEtpF8bpwsXzZZTlDrN9kQN62hFZFDFWl-5-xze-ATMYz0JKFCUIzrbWHPVmN_VduDi0Yyf8gCF_d8l7mV4wNf20Zr5ek3LtrnKhcQkE8F_Qh-Kf5hK4/w625-h306/2020-06-23+22_55_17-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhuBDCwJZd92iulbh2jj050K1GnEtpF8bpwsXzZZTlDrN9kQN62hFZFDFWl-5-xze-ATMYz0JKFCUIzrbWHPVmN_VduDi0Yyf8gCF_d8l7mV4wNf20Zr5ek3LtrnKhcQkE8F_Qh-Kf5hK4/s1056/2020-06-23%2B22_55_17-Window.png)
So I tried to run the Malware Fighter Updater; maybe this would repair the system?!? Instead I got congratulations from IOBit
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1IL6ixwH64Edt3vnnv6P5GY6zcdL3j-6xuROXK6pQ77Ck7WhWrIpv-VfvWHEEzFQP1GtBkGI6c7DXqYUZKEf1wuPmGmuEGgi3N6vnWdQGJLf0J9g7LbckLO7U_K5_MV2qV6KlzTAVeuc/w500-h270/2020-06-23+23_00_37-Window.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1IL6ixwH64Edt3vnnv6P5GY6zcdL3j-6xuROXK6pQ77Ck7WhWrIpv-VfvWHEEzFQP1GtBkGI6c7DXqYUZKEf1wuPmGmuEGgi3N6vnWdQGJLf0J9g7LbckLO7U_K5_MV2qV6KlzTAVeuc/s468/2020-06-23%2B23_00_37-Window.png)

**Personal note:** **Epic Fail**
If Anti Virus software only needs a few lines of PowerShell to delete system files and **its own executables**this is really hard! It is easy to deactivate all features and leave the system vulnerable with Malware Fighter shwoing that everything is "Fully Protected". It is also easy to stay under the radar with a whitelist entry.

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

### Popular Posts

[![Image](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOxu8ebE1R6863Whvsj3YgoAO8YGHDoRHt38_d4FyZ4VPhEJGSESmvLzf8UisJ2ojENVJaEytbQYtx6DFZ-KK8pfjvxS92cKISOL6iCK4GJdjwUAP7W0hyphenhyphen7WJ61Md-CMKWJ2DQ7VIGM80/w625-h368/2020-07-02+18_39_31-Window.png)](http://daniels-it-blog.blogspot.com/2020/07/gog-galaxy-escalation-of-privileges.html)

[July 02, 2020](http://daniels-it-blog.blogspot.com/2020/07/gog-galaxy-escalation-of-privileges.html "permanent link")

### [GOG Galaxy - Escalation of Privileges incl. Code Execution](http://daniels-it-blog.blogspot.com/2020/07/gog-galaxy-escalation-of-privileges.html)

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

[![Image](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj0STecxFl9XczUVcqwLC2XB1MqaIJP6NhsLSrwr1QnG-8K2C_b1t8qywi1Q4nMx03gLu_Y1ou8Ocd4rg50c1QgIciMFI7xG4npnOhAzHMGWaBgjyWM_RXUgJTFDJyW4OPrYhyphenhyphen7iMnJ8ck/w625-h319/2020-07-02+13_42_45-Windows+PowerShell.png)](http://daniels-it-blog.blogspot.com/2020/07/steam-arbitrary-code-execution-part-2.html)

[July 02, 2020](http://daniels-it-blog.blogspot.com/2020/07/steam-arbitrary-code-execution-part-2.html "permanent link")

### [Steam - Escalation of Privileges](http://daniels-it-blog.blogspot.com/2020/07/steam-arbitrary-code-execution-part-2.html)

Share

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

[Powered by Blogger](https://www.blogger.com)

Theme images by [enot-poloskun](http://www.istockphoto.com/portfolio/enot-poloskun?platform=blogger)

[![My photo](//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgeK_SG7N7IIvgs2eb-q-Pc3uN8LN78oNxZfiQPKL-1UMy130NvDDcqkSP30jV1cJZrW-uDPcglrt4RM_sfX9rEzO-909OEtkljjuGpnJLMzvAO9kVfUbLsvJDA0dS8/s113/anonymous.jpg)](https://www.blogger.com/profile/12332761312556315624)
[Daniel Gebert](https://www.blogger.com/profile/12332761312556315624)

[Visit profile](https://www.blogger.com/profile/12332761312556315624)

### Archive

* [2020
  11](http://daniels-it-blog.blogspot.com/2020/)

  + [August
    1](http://daniels-it-blog.blogspot.com/2020/08/)
  + [July
    6](http://daniels-it-blog.blogspot.com/2020/07/)
  + [June
    3](http://daniels-it-blog.blogspot.com/2020/06/)

    - [Abusing Steam for privileged code execution](http://daniels-it-blog.blogspot.com/2020/06/abusing-steam-for-privileged-code.html)
    - [When your Anti Virus turns against you...](http://daniels-it-blog.blogspot.com/2020/06/when-your-anti-virus-turns-against-you.html)
    - [Arbitrary File Deletion in IOBit Advanced System C...](http://daniels-it-blog.blogspot.com/2020/06/arbitrary-file-deletion-in-iobit.html)
  + [May
    1](http://daniels-it-blog.blogspot.com/2020/05/)

### [Report Abuse](https://www.blogger.com/go/report-abuse)


