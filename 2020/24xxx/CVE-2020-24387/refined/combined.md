=== Content from blog.inhq.net_43c00147_20250119_110558.html ===
![](https://mato.inhq.net/m?rec=1&bots=1&idsite=1)[invd blog](/)

[Archive](/archive/)[CVEs](/cve/)[Consulting](/consulting/)[About](/about/)

# Yubico libyubihsmâVulnerabilities

Oct 19, 2020
â¢
Christian Reitter
ID:
CVE-2020-24387,
CVE-2020-24388

Related articles:
[Yubico YubiHSM PKCS#11 Library Vulnerability (CVE-2023-39908)](/posts/yubico-yubihsm-pkcs-vuln/)
â¢ [Yubico libykpiv Vulnerabilities II](/posts/yubico-libykpiv-vuln2/)
â¢ [Yubico yubihsm-shell Vulnerability (CVE-2021-43399)](/posts/yubico-yubihsm-shell-vuln3/)

After my previous research had uncovered security issues in other [Yubico smartcard libraries](/posts/yubico-libykpiv-vuln/),
I decided in July to take a closer look at the Yubico libyubihsm library.
Libyubihsm is responsible for interacting with the [YubiHSM2](https://www.yubico.com/products/hardware-security-module/) Hardware Security Module that is used in enterprise systems with advanced cryptography requirements.
After applying a few days of my private research time & fuzzing experience to it, I discovered multiple memory issues in the library code.

At least two of the issues are practical security vulnerabilities: a malicious HSM device or Man-In-The-Middle network attacker can trigger out of bounds write and read operations ([CVE-2020-24387](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24387)) and
out of bounds read operations ([CVE-2020-24388](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24388)) that ultimately both lead to segmentation faults of the process which embeds libyubihsm.
Notably, the built-in encryption and authentication of the regular HSM messages do not mitigate this attack since the issues are triggered before any effective cryptography.

This article will describe the issues and give some background information on how they were found.

## Contents

* [Fuzzing Methodology](#fuzzing-methodology)
* [Technical Background](#technical-background)
* [The Vulnerabilities](#the-vulnerabilities)
  + [CVE-2020-24387](#cve-2020-24387)
  + [CVE-2020-24388](#cve-2020-24388)
  + [Out of Bounds Read in hex\_decode()](#out-of-bounds-read-in-hex_decode)
  + [Undefined Behavior in send\_secure\_msg()](#undefined-behavior-in-send_secure_msg)
  + [Out of Bounds Read in yh\_util\_get\_log\_entries()](#out-of-bounds-read-in-yh_util_get_log_entries)
  + [Attack Scenario and Security Implications](#attack-scenario-and-security-implications)
  + [Proof Of Concept](#proof-of-concept)
* [Coordinated Disclosure](#coordinated-disclosure)
  + [Relevant yubihsm-shell Sources](#relevant-yubihsm-shell-sources)
  + [Other Relevant Software](#other-relevant-software)
  + [Detailed Timeline](#detailed-timeline)
  + [Bug Bounty](#bug-bounty)
## Consulting

*Iâm a freelance Security Consultant and currently available for new projects.
If you are looking for assistance to secure your projects or organization, [contact me](/consulting).*

## Fuzzing Methodology

The previous [libykpiv article](/posts/yubico-libykpiv-vuln/#fuzzing-methodology) outlines the fuzzing approach and related strategies which I used.

To summarize:

* The libyubihsm library is fuzzed with libFuzzer through the yubihsm-shell CLI program.
* The modified yubihsm-shell operates on HSM2 messages that the fuzzer creates (via a custom USB backend).
* Yubihsm-shell is called with various command line parameters, covering a lot of the âshallowâ HSM library functionality.
* The in-process design of libFuzzer and omission of actual network or USB I/O operations keeps the executions reasonably fast.
* The HTTP backend path was not fuzzed, but USB-related bugs mostly apply to it as well.

Given the complexity of the encrypted and authenticated HSM message contents, the focus of this research was to check for **low-level memory issues in the basic message handling code**,
similar to previous libykpiv and libu2f-host issues.
The custom fuzzing harness does not have an internal model of the HSM implementation details and performs no cryptographic steps such as encryption with hard-coded keys.
While the resulting fuzzer setup is unable to reach a lot of the âcomplexâ code paths, issues discovered via this unfocused approach have the nice property that they do not require specific knowledge of device secrets or special device states for the attacker.
As mentioned in the following paragraphs, this strategy was successful in finding new low-level issues.

To reach additional in-depth coverage of the complex message handling functions (and potential bugs that remain there), a more concentrated approach with extensive code changes such as circumvention of the encryption + authentication of the messages or a special message generation harness will likely be necessary.
This could be explored in future research.

As with most fuzzing targets, there were a number of functional issues which had to be discovered, debugged and [fixed](https://github.com/Yubico/yubihsm-shell/issues/88) to allow a stable fuzzing operation.
This is common for fuzzing research, but can significantly increase the necessary time required to reach interesting results.
Overhead due to essential stability bugfixing should be factored in when estimating how long it takes to analyze a specific software.

## Technical Background

In the basic setup configuration, the HSM2 USB 2.0 device is directly attached to the host. The local software talks to the HSM via libyubihsm, the USB backend and operating system.
This simple configuration is viable as a self-contained HSM setup and needs no network configuration.

Schematic diagram:

```
+--------------------------------+
|                                |
| HOST A   +------------------+  |
|          |    libyubihsm    |  |
| e.g.     |                  |  |
| yubihsm- |   USB handling   |  |
| shell    +--------+---------+  |
|                   |            |
+--------------------------------+
                    |
            +-------v-------+
            |  HSM2 device  |
            +---------------+

```

This structure was also the conceptual base of the fuzzing setup:

```
yubishm-  +-----------------+
shell     |    libyubihsm   |
fuzzer    |                 |
          |   USB handling  |
          +--------+--------+
                   |
                   |
          +--------v--------+
          | mod. USB backend|
          |    libfuzzer    |
          +-----------------+

```

Larger and more complex HSM setups have requirements for redundancy and abstraction from a single host and local HSM.
Yubico addresses this by providing an additional HTTP-based network layer that can be used to connect the client host and HSM either locally or remotely.
The requests are proxied over the network to the [yubihsm-connector](https://developers.yubico.com/YubiHSM2/Component_Reference/yubihsm-connector/) server (written in Go) instead of direct USB communication.
The connector service passes the raw USB messages over unencrypted HTTP to and from the HSM as a sort of USB proxy.

Example configuration:

```
         +---------------+            +--------------------------------+
         |  HSM2 device  |            |                                |
         +-------+-------+            | HOST A   +------------------+  |
                 |                    |          |    libyubihsm    |  |
                 |                    | e.g.     |                  |  |
+---------------------------------+   | yubihsm- |   USB handling   |  |
|                |                |   | shell    +--------+---------+  |
| HOST B  +------+----------+     |   |                   |            |
|         |  USB wrapping   |     |   |          +--------v---------+  |
|         +------+----------+     |   |          |   USB wrapping   |  |
| yubihsm-       |                |   |          +--------+---------+  |
| connector      |                |   |                   |            |
|        +-------+----------+     |   |          +--------v---------+  |
|        | HTTP proxy server|     |   |          |   http client    |  |
|        +-------+----------+     |   |          +--------+---------+  |
|                |                |   |                   |            |
+---------------------------------+   +--------------------------------+
                 |                                        |
            XXXXX+X                                       |
          XXX     XXXXXX                                  |
        XX              XXXXX                             |
       XX   L3 network       XX                           |
       X                      <---------------------------+
      XX   or localhost      XX
       X                    XX
       XXXXXXXX          XXXX
              XXXXXXXXXXX

```

Note that the network connection adds no encryption or authentication by default and usually relies on the basic TCP checksum for message integrity.
This is intentional and well-known via the official documentation:

> [...] the Connector is not meant to be a trusted component. For this reason, it defaults to HTTP connections. It is possible to use HTTPS, however this requires providing a key and a certificate to the Connector.

For the purpose of the discovered vulnerabilities, the default configuration provides no defense against network-level attackers that can mount a Man-In-The-Middle attack.

Some of the documentation suggests that the existing inner security layer is sufficient:

> Sessions are established cryptographically between the application and the YubiHSM 2 using a symmetric mutual authentication scheme that is both encrypted and authenticated.

However, as I will show, the cryptographic defenses on the HSM session level do not prevent the discovered attacks.

## The Vulnerabilities

### CVE-2020-24387

Interaction with the HSM2 device happens over individual logical **sessions** which represent open connections between an application and the HSM device.
Session IDs and related decisions are coordinated by the HSM.
This design allows concurrent access from multiple sources as well as long-running connections, but requires robust session management on all endpoints to avoid collisions or local issues.
A noteworthy detail of the HSM message protocol design is that the initial session handshake between client and HSM is exchanged in cleartext and without message authentication.

CVE-2020-24387 consists of an essential flaw in the handshake parsing on the library side.
This turns into a memory management and memory safety problem that terminates the running process.

The relevant code to open a new connection with the HSM includes the following section:

```
yrc = send_msg(connector, &msg, &response_msg, new_session->s.identifier);

[...] // basic failure handling and sanity checks

ptr = response_msg.st.data;

// Save sid
new_session->s.sid = (*ptr++);
```

[yubihsm.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/lib/yubihsm.c#L680-L702)

The `new_session->s.sid` is an `uint8_t` integer with a maximum value of **255** that represents the session ID as decided by the HSM.

There are a maximum of **16** sessions running with the HSM at any given time. A genuine HSM2 device will constantly reuse session IDs **0** to **15** for new connections.
Although the library code is aware of the session limits via `#define YH_MAX_SESSIONS 16`,
this limited value range **is not actually enforced** in the library code and session IDs with values between **16** and **255** are also accepted.
This represents the main bug.

The ID value range restrictions are important because the memory handling of libyubihsm directly uses the session ID parameter as an **index value** into the fixed session array `yh_session *sessions[YH_MAX_SESSIONS]`
that keeps track of the open connections.

As it is common with C, the access happens without additional implicit or explicit bounds checking.
Successfully opening sessions with session IDs **greater than 15 therefore cause out of bounds writes and reads behind this array**.

`yh_com_open_session()` is one code section with unsafe session index usage:

```
if (ctx->sessions[session_id] != NULL) {
  yrc = yh_destroy_session(&ctx->sessions[session_id]);
  if (yrc != YHR_SUCCESS) {
    fprintf(stderr, "Failed to destroy old session with same id (%d): %s\n",
            session_id, yh_strerror(yrc));
    return -1;
  }
}
ctx->sessions[session_id] = ses;
```

[commands.c](https://github.com/Yubico/yubihsm-shell/blob/34c717f1b94f9bedcf6e045cf2c598eefb42af30/src/commands.c#L1311-L1319)

The comparison check `ctx->sessions[session_id] != NULL` will evaluate to false in many cases, particularly early in the program execution.
The `session` array is located on the global buffer which is initialized with `0x00` at startup by C specifications.

Corresponding sanitizer warning:

```
==19585==ERROR: AddressSanitizer: global-buffer-overflow on address 0x0000010c52b8 at pc 0x0000005a623a bp 0x7fffffff63d0 sp 0x7fffffff63c8
READ of size 8 at 0x0000010c52b8 thread T0
```

The `ctx->sessions[session_id] = ses` operation will then do an out of bounds write with the `ses` session pointer value into the global buffer. Under x86\_64, this writes a 64 bit = 8 byte memory segment.
An attacker can control **the offset** of the destination memory address via the session ID, but has no direct control over **the value** that is written.

Corresponding sanitizer warning:

```
==19585==ERROR: AddressSanitizer: global-buffer-overflow on address 0x0000010c52b8 at pc 0x0000005a6802 bp 0x7fffffff63d0 sp 0x7fffffff63c8
WRITE of size 8 at 0x0000010c52b8 thread T0
```

In order to trigger a successful session handshake and therefore practical code issues,
the malicious HSM (or MITM network attacker) has to accept a response message that is addressed to the problematic session ID.
This requires a HSM response with the `YHC_AUTHENTICATE_SESSION_R` flag.
In the hypothetical case where the session ID accidentally became large as a result of message transmission errors, a genuine HSM will not send a positive response. This should prevent further issues.

In a targeted exploit, the required 2nd message is easily sent by the attacker and libyubihsm continues with problematic behavior.

According to my understanding and the assessment of the relevant Yubico engineers, the out of bounds writes impact **the general memory integrity** of the program.
However, we are not aware at the moment of a way to leverage this into some direct control over the code flow due to the location of the out of bounds write and other constraints.
Since the writes are happening from a position on the global buffer and not the stack, existing stack protection countermeasures will be ineffective and the attack is not detected.

In an attack scenario, the code flow continues without returning error codes and the CLI or library code will perform some additional function calls depending on the originally requested HSM command that invoked the session creation.
The original command may fail or succeed depending on the HSM behavior.

At some point, the code will attempt to close the session via `yh_util_close_session()`, which sends an encrypted command via `_send_secure_msg()` towards the HSM to inform it of the session state change:

```
yrc = yh_send_secure_msg(session, YHC_CLOSE_SESSION, NULL, 0, &response_cmd,
                         response, &response_len);
```

[yubihsm.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/lib/yubihsm.c#L1292-L1293)

Since the code is expecting an active session in the normal session array (but there is none), some steps of the parameter initialization fail and the session pointer given to the following functions is still in a strange state.
Consequently, a lot of the message preparation routines in `_send_secure_msg()` silently fail.
The first deadly error happens when preparing AES data for the message encryption:

```
aes_set_encrypt_key((uint8_t *) session->s.s_enc, SCP_KEY_LEN, &aes_ctx);
```

[yubihsm.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/lib/yubihsm.c#L308)

`session->s.s_enc` is not in a usable state, and it is not in a memory region that may be accessed:

```
(gdb) print &session->s
$5 = (Scp_ctx *) 0x2c
```

The access results in a segfault that kills the process:

```
==20041==ERROR: AddressSanitizer: SEGV on unknown address 0x00000000002d (pc 0x7f304ec6e192 bp 0x7fff50637810 sp 0x7fff50637728 T0)
==20041==The signal is caused by a READ memory access.
==20041==Hint: address points to the zero page.
    #0 0x7f304ec6e192 in AES_set_encrypt_key (/usr/lib/x86_64-linux-gnu/libcrypto.so.1.1+0x8f192)
```

For the analyzed library use case, this denial of service represents the primary impact.

### CVE-2020-24388

When sending a secure message to the HSM via `_send_secure_msg()`, the code looks like this:

```
yrc = send_authenticated_msg(session, &msg, &response_msg);

// [...] error handling

// definition: uint16_t out_len;
out_len = response_msg.st.len;

memcpy(work_buf, session->s.mac_chaining_value, SCP_PRF_LEN);
response_msg.st.len = htons(response_msg.st.len);
memcpy(work_buf + SCP_PRF_LEN, response_msg.raw, 3 + out_len - SCP_MAC_LEN);
compute_full_mac(work_buf, SCP_PRF_LEN + 3 + out_len - SCP_MAC_LEN,
                 session->s.s_rmac, SCP_KEY_LEN, mac_buf);

// [...] MAC result verification
```

[yubihsm.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/lib/yubihsm.c#L331-L356)

`send_authenticated_msg()` internally calls `send_msg()` to transmit the specified message and receive a response message from the HSM in `&response_msg`.
If the HSM sends a response and does not flag `YHC_ERROR`, the error handling code is passed and the code continues towards the response parsing section.

Note that `out_len = response_msg.st.len` is fully controlled by the HSM.
The essential flaw behind CVE-2020-24388 is the use of `out_len` as an unchecked length field.
This becomes a problem a few lines down at

```
memcpy(work_buf + SCP_PRF_LEN, response_msg.raw, 3 + out_len - SCP_MAC_LEN);

```

Since `SCP_MAC_LEN` is **8** , the length calculation for the `memcpy()` can result in negative numbers, for example with `out_len = 0`:

```
==16960==ERROR: AddressSanitizer: negative-size-param: (size=-5)
    #0 0x528eb4 in __asan_memcpy
    #1 0x655456 in _send_secure_msg
```

`memcpy()` expects positive integers of type `size_t`. Negative parameter values get converted implicitly to a large positive number via an unsigned integer underflow.
As a result, the memory copy attempts to significantly over-read from the target memory region and violates memory bounds:

```
==16649==ERROR: UndefinedBehaviorSanitizer: SEGV on unknown address 0x7ffc85183fe8
==16649==The signal is caused by a READ memory access.
    #0 0x7fcac423564d  (/lib/x86_64-linux-gnu/libc.so.6)
```

The result is a segmentation fault that kills the program.
Notably, this happens before the message authentication code (MAC) on the response packet is checked,
so the provided authentication code is irrelevant.

### Out of Bounds Read in hex\_decode()

This is a small problem in a custom utility function.

```
bool hex_decode(const char *in, uint8_t *out, size_t *len) {
  int pos = 0;
  size_t in_len = strlen(in);
  if (in[in_len - 1] == '\n') {
    in_len--;
  }
  if (in[in_len - 1] == '\r') {
    in_len--;
  }
[...]
```

[util.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/common/util.c#L559-L567)

For small inputs, `in[in_len - 1]` can perform stack out of bounds reads before the input buffer `in`:

```
==30564==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffdf03b8bef at pc 0x0000006e6bd2 bp 0x7ffdf03b7d10 sp 0x7ffdf03b7d08
READ of size 1 at 0x7ffdf03b8bef thread T0
    #0 0x6e6bd1 in hex_decode /yubihsm-shell/common/util.c:568:7
    #1 0x616824 in get_input_data /yubihsm-shell/src/main.c:1446:11
[...]

    [1232, 5328) 'buf' (line 1911) <== Memory access at offset 1231 underflows this variable
```

Given the context, this does not look like a serious security problem to me.

### Undefined Behavior in send\_secure\_msg()

When closing a session, `send_secure_msg()` is called with the parameters `data_len = 0` and `*data = NULL`.

`send_secure_msg()` has the following line:

```
memcpy(decrypted_data + 3, data, data_len);
```

[yubihsm.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/lib/yubihsm.c#L301)

The send function will therefore call `memcpy(decrypted_data + 3, NULL, 0)`.

This is undefined behavior:

```
yubihsm-shell/lib/yubihsm.c:303:30: runtime error: null pointer passed as argument 2, which is declared to never be null

```

The simple solution is to skip this operation if no data source is given.
Although technically all kind of things can go wrong, it is unlikely that this causes a notable issue in practice.

### Out of Bounds Read in yh\_util\_get\_log\_entries()

This bug appears to be a combination of multiple issues.
The main result are multiple out of bounds reads on the stack since `n_items` is larger than intended when processing log entries at the following location:

```
  for (uint16_t i = 0; i < *n_items; i++) {
    out[i].number = ntohs(ptr[i].number);
```

[yubihsm.c](https://github.com/Yubico/yubihsm-shell/blob/130a1cf65d7bedefa7c700655884b3e75eb5223d/lib/yubihsm.c#L2613-L2614)

Example warning for the resulting access:

```
==26697==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe14a9eb80 at pc 0x000000528ed7 bp 0x7ffe14a9e270 sp 0x7ffe14a9da38
READ of size 16 at 0x7ffe14a9eb80 thread T0
    #0 0x528ed6 in __asan_memcpy (/yubihsm-shell/build/src/yubihsm-shell+0x528ed6)
    #1 0x5d2775 in yh_util_get_log_entries /yubihsm-shell/lib/yubihsm.c:2659:5
    #2 0x56dad9 in yh_com_audit /yubihsm-shell/src/commands.c:92:9

    [256, 2304) 'response' (line 2601) <== Memory access at offset 2304 overflows this variable
```

During fuzzing, this problem was not consistently reproducible.
It appears that at least one code path that triggers this issue also depends on the state of uninitialized memory,
so it is possible that this issue cannot be reached or fully controlled in a deterministic way by an attacker.

This section will be updated later with more information.

### Attack Scenario and Security Implications

Note that the vulnerabilities

* will not be triggered by genuine HSMs (*when excluding transmission error events for CVE-2020-24388*)
* are in the host side code and do not affect the HSM2 firmware

If you use HSM2 devices via software stacks that exclude libyubihsm, you are not affected.

#### CVSS Score

| ID | CVSS 3.1 Score | Parameters |
| --- | --- | --- |
| CVE-2020-24387 | 6.5 (Medium) | [`CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:H`](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:H) |
| CVE-2020-24388 | 5.9 (Medium) | [`CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H`](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H) |

### Proof Of Concept

The following patches simulate the attack with limited code changes to a vulnerable library version.
This can be tested with an expendable HSM2 device to validate the error behavior without a complex hardware setup.

**WARNING: use the following code at your own risk. Although not intended, please assume that this will PERMANENTLY overwrite data on the HSM device that you have connected.**

Procedure:

1. Rebuild libyubihsm and all relevant programs with the specified patch, example: [vulnerable repo version](https://github.com/Yubico/yubihsm-shell/commits/349418dd238ed53d74ed9d0ba68b2c12cfba13fb)
2. Insert a test HSM device in factory settings
3. Run a basic command to test the impact

* Variant A: yubihsm-connector is running on localhost, run
  `./yubihsm-shell -a blink-device -p password`
* Variant B: direct USB connection, run
  `./yubihsm-shell -C yhusb:// -a blink-device -p password`

If you observe connection problems, please make sure that your setup is working with the regular unmodified CLI.

#### CVE-2020-24387

```
diff --git a/lib/yubihsm.c b/lib/yubihsm.c
index 565679a..427fbc2 100644
--- a/lib/yubihsm.c
+++ b/lib/yubihsm.c
@@ -81,6 +81,12 @@ static yh_rc send_msg(yh_connector *connector, Msg *msg, Msg *response,
     return YHR_INVALID_PARAMETERS;
   }
   DBG_NET(msg, dump_msg);
+  printf("sending message with id %u\n", msg->st.data[0]);
+  if(msg->st.data[0] == 0x42) {
+    printf("faking successful auth response\n");
+    response->st.cmd = YHC_AUTHENTICATE_SESSION_R;
+    return YHR_SUCCESS;
+  }
   yrc = connector->bf->backend_send_msg(connector->connection, msg, response,
                                         identifier);
   if (yrc == YHR_SUCCESS) {
@@ -699,7 +705,9 @@ yh_rc yh_create_session(yh_connector *connector, uint16_t authkey_id,
   ptr = response_msg.st.data;
   // Save sid
-  new_session->s.sid = (*ptr++);
+  new_session->s.sid = 0x42;
+  printf("simulating malicious response with sid %u\n" , new_session->s.sid);
+  ptr++;
   // Save card challenge
   memcpy(new_session->context + SCP_HOST_CHAL_LEN, ptr, SCP_CARD_CHAL_LEN);
```

Observed log:

```
Using default connector URL: http://127.0.0.1:12345
Session keepalive set up to run every 15 seconds
sending message with id 0
simulating malicious response with sid 66
sending message with id 66
faking successful auth response
Created session 66
Segmentation fault

```
#### CVE-2020-24388

```
diff --git a/lib/yubihsm.c b/lib/yubihsm.c
index 565679a..cfc4c77 100644
--- a/lib/yubihsm.c
+++ b/lib/yubihsm.c
@@ -346,6 +346,9 @@ static yh_rc _send_secure_msg(yh_session *session, yh_cmd cmd,
     goto cleanup;
   }
+  printf("manipulating response to secure message\n");
+  response_msg.st.len = 0;
+
   // Response is MAC'ed and encrypted. Unwrap it
   out_len = response_msg.st.len;
```

Observed log:

```
Using default connector URL: http://127.0.0.1:12345
Session keepalive set up to run every 15 seconds
Created session 0
manipulating response to secure message
Segmentation fault

```
## Coordinated Disclosure

The disclosure went fairly smoothly.
All the essentials were already in place from previous vulnerability reports, which reduces the overhead.

Similar to the libykpiv disclosure, I was able to coordinate closely with a dedicated security contact person,
evaluate the proposed security patches and make suggestions for technical reporting summaries such as the CVE descriptions.
This process was again very positive and I appreciate the trust from the Yubico engineers.

One aspect that could be improved in my opinion is the patch response time. Yubico spent basically the full 90 days of disclosure duration before
shipping the security patch release.
I am aware that libyubihsm is used in large and complex software ecosystems and that the corresponding release preparations are not trivial,
so I am sympathetic towards not rushing a fix which might cause regressions.
Nevertheless, I think it will be beneficial in the long run to work towards a more flexible release process that can accommodate security fixes in for example a month or less.

Overall, I am satisfied with the disclosure process.

### Relevant yubihsm-shell Sources

| variant | source | fix | references |
| --- | --- | --- | --- |
| Yubico upstream | [GitHub](https://github.com/Yubico/yubihsm-shell) | [patch to 2.0.3](https://github.com/Yubico/yubihsm-shell/commit/52f9c0373b19215e5af622f436461f150968b2df), bundled in SDK release [2020.10](https://developers.yubico.com/YubiHSM2/Releases) | [YSA-2020-06](https://www.yubico.com/support/security-advisories/ysa-2020-06/) |
| Fedora | [Fedora](https://src.fedoraproject.org/rpms/yubihsm-shell) | [update to 2.0.3-1](https://src.fedoraproject.org/rpms/yubihsm-shell/c/47623caa26843dfe53c8c9f4fb9a4ac2d89c9062) | [Bug 1890204](https://bugzilla.redhat.com/show_bug.cgi?id=1890204), [Bug 1890205](https://bugzilla.redhat.com/show_bug.cgi?id=1890205), [Bug 1890206](https://bugzilla.redhat.com/show_bug.cgi?id=1890206) |

### Other Relevant Software

| variant | source | notes |
| --- | --- | --- |
| yubihsm.rs | [GitHub](https://github.com/iqlusioninc/yubihsm.rs) | not affected (AFAIK), not included in the disclosure |

### Detailed Timeline

| Date | info |
| --- | --- |
| 2020-07-20 | Disclosure of issue #1 to Yubico |
| 2020-07-21 | Disclosure of issue #2 to #7 to Yubico |
| 2020-07-21 | Yubico acknowledges receiving the reports |
| 2020-08-05 | Yubico confirms issue #1 |
| 2020-08-07 | Yubico confirms issue #2 to #7 |
| 2020-08-12 | Yubico sends preview of proposed fixes |
| 2020-08-12 | Positive feedback to Yubico on proposed fixes |
| 2020-08-17 | Discussion of planned CVE descriptions |
| 2020-08-18 | Yubico requests CVEs from MITRE |
| 2020-08-19 | MITRE assigns CVEs |
| 2020-08-25 | Yubico communicates planned disclosure date: 2020-09-29 |
| 2020-09-28 | Yubico communicates planned disclosure date: 2020-10-14 |
| 2020-10-09 | Yubico communicates planned disclosure date: 2020-10-19 |
| 2020-10-19 | Release of patched HSM2 SDK version 2020.10 |
| 2020-10-19 | Public disclosure via YSA-2020-06 |
| 2020-10-19 | Publication of this blog post |
| 2020-10-21 | Fedora includes patched version |

### Bug Bounty

Yubico provided hardware as a bug bounty for this issue.

* **Christian Reitter**

Information security and other interests.



=== Content from bugzilla.redhat.com_2032dc2e_20250119_130424.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1890203)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1890203)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1890203)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1890203

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1890203**](show_bug.cgi?id=1890203)
(CVE-2020-24387)
- [CVE-2020-24387](https://access.redhat.com/security/cve/CVE-2020-24387) yubihsm-shell: yh\_create\_session() does not explicitly check the returned session id could result in DoS

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2020-24387 yubihsm-shell: yh\_create\_session() does not explicitly check ...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-24387 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1890203&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1890203&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2020-10-21 16:52 UTC by Michael Kaplan | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-10-28 05:27 UTC ([History](show_activity.cgi?id=1890203)) | | [CC List:](page.cgi?id=fields.html#cclist) | 1 user (show)  jjelen | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-10-28 05:27:23 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1890203#c0)  Michael Kaplan    2020-10-21 16:52:05 UTC  ``` An issue was discovered in the yh_create_session() function of yubihsm-shell through 2.0.2. The function does not explicitly check the returned session id from the device. An invalid session id would lead to out-of-bounds read and write operations in the session array. This could be used by an attacker to cause a denial of service attack.  References:  <https://blog.inhq.net/posts/yubico-libyubihsm-vuln/> <https://developers.yubico.com/yubihsm-shell/> <https://github.com/Yubico/yubihsm-shell> <https://www.yubico.com/support/security-advisories/ysa-2020-06/>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1890203&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from lists.fedoraproject.org_91b513e2_20250119_110600.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO.mbox.gz?message=Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO/#Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO)

# [SECURITY] Fedora 33 Update: yubihsm-shell-2.0.3-1.fc33

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

28 Oct
2020

28 Oct
'20

8:09 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2020-8afd443d46
2020-10-29 01:04:57.850474
--------------------------------------------------------------------------------

Name : yubihsm-shell
Product : Fedora 33
Version : 2.0.3
Release : 1.fc33
URL : <https://github.com/Yubico/yubihsm-shell/>
Summary : Tools to interact with YubiHSM 2
Description :
This package contains most of the components used to interact with
the YubiHSM 2 at both a user-facing and programmatic level.

--------------------------------------------------------------------------------
Update Information:

New upstream release (#1889941). It turned out to be security release, so added
the security bugs.
--------------------------------------------------------------------------------
ChangeLog:

\* Wed Oct 21 2020 Jakub Jelen jjelen@redhat.com - 2.0.3-1
- New upstream release (#1889941)
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1890203 - CVE-2020-24387 yubihsm-shell: yh\_create\_session() does not explicitly check the returned session id could result in DoS
<https://bugzilla.redhat.com/show_bug.cgi?id=1890203>
[ 2 ] Bug #1890205 - CVE-2020-24388 yubihsm-shell: \_send\_secure\_msg() does not validate the embedded length field of a message which could result in DoS
<https://bugzilla.redhat.com/show_bug.cgi?id=1890205>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2020-8afd443d46' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO/#Y77KQJW76M3PFOBFLBT6DLH2NWHYRNZO)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from developers.yubico.com_104f4a0f_20250119_110558.html ===


[![](/logo.png)](/)

* [Passkeys](/Passkeys)
* [WebAuthn](/WebAuthn)
* [CTAP](/CTAP)
* [OTP](/OTP)
* [OATH](/OATH)
* [PGP](/PGP)
* [PIV](/PIV)
* [YubiHSM2](/YubiHSM2)
* [Software Projects](/Software_Projects)

1. [Home](/)
2. yubihsm-shell

* [yubihsm-shell](/yubihsm-shell)
  + [Releases](/yubihsm-shell/Releases)
  + [Manuals](/yubihsm-shell/Manuals)
  + [API Changes](/yubihsm-shell/API_Changes.html)
  + [API Documentation](/yubihsm-shell/API_Documentation)
  + [libykhsmauth](/yubihsm-shell/libykhsmauth.html)
  + [libyubihsm](/yubihsm-shell/libyubihsm.html)
  + [yubihsm-auth](/yubihsm-shell/yubihsm-auth.html)
  + [yubihsm-pkcs11](/yubihsm-shell/yubihsm-pkcs11.html)
  + [yubihsm-shell](/yubihsm-shell/yubihsm-shell.html)
  + [yubihsm-wrap](/yubihsm-shell/yubihsm-wrap.html)

* [Github](https://github.com/Yubico/yubihsm-shell)

# YubiHSM Shell

This repository contains most of the components used to interact with
the YubiHSM 2 at both a user-facing and programmatic level.

The available components are:

* [libyubihsm](lib/README.html)âââC library to expose low- and high-level functions to
  interact with a YubiHSM
* [yubihsm-shell](src/README.html)âââthin wrapper around `libyubihsm` providing both
  an interactive and command-line interface to a YubiHSM
* [yubihsm-pkcs11](pkcs11/README.html)âââPKCS#11 module using `libyubihsm`
* [yubihsm-wrap](yhwrap/README.html)âââcommand-line tool to create encrypted objects (wraps) that can be imported in the YubiHSM
* [libykhsmauth](ykhsmauth/README.html)âââC library for using the YubiKey HSM Auth application
* [yubihsm-auth](yubihsm-auth/README.html)âââcommand-line tool to use the YubiKey HSM Auth application

### Dependencies

* cmake
* cppcheck (optional)
* gcov and lcov (optional)
* gengetopt
* help2man (optional)
* libcrypto
* libcurl
* libedit
* libusb
* libpcsclite-dev
* llvm/clang and friends
* pkg-config
* pre-commit

### Documentation

Documentation for this project and the YubiHSM2 in general can be found on Yubicoâs [developers website](https://developers.yubico.com/YubiHSM2/).

### pre-commit

This repository uses [pre-commit](https://pre-commit.com/).

```

pre-commit install

```

### Building

```

mkdir build && cd build
cmake ..
make

```

Note that `ninja` builds are available as well:

```

mkdir build && cd build
cmake -GNinja ..
ninja

```

The binaries will be located in `build` directory. To install them on the system, run the following command. Note that this
step may require admin privileges on some systems (e.g. `sudo` on Linux)

```

make install

```

| Important | Building from source on Windows should be made with the source from the source release package and not directly from the cloned repository. This is due to the `gengetopt` library not being available for Windows. |
| --- | --- |

Manpages are built by default using `help2man`. It is possible to skip this step with:

```

mkdir build && cd build
cmake -DWITHOUT_MANPAGES=1 ..
make

```

It is possible to build the libraries and binaries with static linking, this can be enabled with:

```

mkdir build && cd build
cmake -DENABLE_STATIC=1 ..
make

```

### Linting

There is a `cppcheck` target that runs the source through `cppcheck`

```

make cppcheck

```

### Testing

PKCS#11 tests can be run using [pkcs11test](https://github.com/Yubico/pkcs11test).

The tool must be already built, and the path to the resulting binary
must be in your `PATH`, or `PKCS11TEST_PATH` must be set.

The programs found in the `/examples` directory are also used as tests.

The tests can be run via

```

make test

```

Or using ctest directly

```

ctest

```

By default the tests expect a local connector running at `http://localhost:12345`.
A different connector for the tests can be specified by setting the
`DEFAULT_CONNECTOR_URL` environment variable.
For example, to run tests using direct USB (i.e., without a connector) use

```

DEFAULT_CONNECTOR_URL="yhusb://" ctest

```

If you are building `yubihsm-shell` with `ninja`, the following is available:

```

ninja test

```

The test output can be found in `.../yubihsm-shell/build/Testing/Temporary/LastTest{,sFailed}.log`.

Direct command-line output can be obtained with

```

ctest -V

```

#### Coverage

Code coverage is provided courtesy of lcov and [CMake-codecov](https://github.com/RWTH-HPC/CMake-codecov). This currently only works with `make` and not with `ninja`.

Enable coverage with

```

cmake -DENABLE_COVERAGE=1 ..

```

You can then build the project normally and run some executables (for example running the tests with `make test`).

At this point coverage evaluation can be generated with gcov/lcov related targets. For example

```

make lcov

```

will generate a single HTML report in `./lcov/html/all_targets/index.html`

### License

```
 Copyright 2015-2018 Yubico AB

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
```

**[DEV.YUBICO](https://developers.yubico.com/)**

[Passkeys](/Passkeys)

[WebAuthn](/WebAuthn)

[CTAP](/CTAP)

[OTP](/OTP)

[OATH](/OATH)

[PGP](/PGP)

[PIV](/PIV)

[YubiHSM2](/YubiHSM2)

[Software Projects](/Software_Projects)

**RESOURCES**

[Buy YubiKeys](https://www.yubico.com/store/)

[Blog](https://www.yubico.com/blog/)

[Newsletter](https://www.yubico.com/newsletter/)

[Yubico Forum Archive](https://forum.yubico.com/)

**[YUBICO.COM](https://www.yubico.com/)**

[Why Yubico](https://www.yubico.com/why-yubico/)

[About Yubico](https://www.yubico.com/about/about-us/)

[Cookie](https://www.yubico.com/support/terms-conditions/cookie-notice/)

[Legal](https://www.yubico.com/support/terms-conditions/)

[Privacy](https://www.yubico.com/support/terms-conditions/privacy-notice/)

[Terms of use](https://www.yubico.com/support/terms-conditions/yubico-website-terms-conditions/)

[Trust](https://www.yubico.com/trust/)

|  |  |  |  |  |
| --- | --- | --- | --- | --- |



=== Content from github.com_7e018663_20250119_110559.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FYubico%2Fyubihsm-shell)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FYubico%2Fyubihsm-shell)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=Yubico%2Fyubihsm-shell)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Yubico](/Yubico)
/
**[yubihsm-shell](/Yubico/yubihsm-shell)**
Public

* [Notifications](/login?return_to=%2FYubico%2Fyubihsm-shell) You must be signed in to change notification settings
* [Fork
  54](/login?return_to=%2FYubico%2Fyubihsm-shell)
* [Star
   96](/login?return_to=%2FYubico%2Fyubihsm-shell)

yubihsm-shell and libyubihsm

[developers.yubico.com/yubihsm-shell/](https://developers.yubico.com/yubihsm-shell/ "https://developers.yubico.com/yubihsm-shell/")

### License

[Apache-2.0 license](/Yubico/yubihsm-shell/blob/master/LICENSE)

[96
stars](/Yubico/yubihsm-shell/stargazers) [54
forks](/Yubico/yubihsm-shell/forks) [Branches](/Yubico/yubihsm-shell/branches) [Tags](/Yubico/yubihsm-shell/tags) [Activity](/Yubico/yubihsm-shell/activity)
 [Star](/login?return_to=%2FYubico%2Fyubihsm-shell)

 [Notifications](/login?return_to=%2FYubico%2Fyubihsm-shell) You must be signed in to change notification settings

* [Code](/Yubico/yubihsm-shell)
* [Issues
  27](/Yubico/yubihsm-shell/issues)
* [Pull requests
  10](/Yubico/yubihsm-shell/pulls)
* [Actions](/Yubico/yubihsm-shell/actions)
* [Security](/Yubico/yubihsm-shell/security)
* [Insights](/Yubico/yubihsm-shell/pulse)

Additional navigation options

* [Code](/Yubico/yubihsm-shell)
* [Issues](/Yubico/yubihsm-shell/issues)
* [Pull requests](/Yubico/yubihsm-shell/pulls)
* [Actions](/Yubico/yubihsm-shell/actions)
* [Security](/Yubico/yubihsm-shell/security)
* [Insights](/Yubico/yubihsm-shell/pulse)

# Yubico/yubihsm-shell

    master[Branches](/Yubico/yubihsm-shell/branches)[Tags](/Yubico/yubihsm-shell/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[746 Commits](/Yubico/yubihsm-shell/commits/master/) | | |
| [.ci](/Yubico/yubihsm-shell/tree/master/.ci ".ci") | | [.ci](/Yubico/yubihsm-shell/tree/master/.ci ".ci") |  |  |
| [.github](/Yubico/yubihsm-shell/tree/master/.github ".github") | | [.github](/Yubico/yubihsm-shell/tree/master/.github ".github") |  |  |
| [aes\_cmac](/Yubico/yubihsm-shell/tree/master/aes_cmac "aes_cmac") | | [aes\_cmac](/Yubico/yubihsm-shell/tree/master/aes_cmac "aes_cmac") |  |  |
| [cmake](/Yubico/yubihsm-shell/tree/master/cmake "cmake") | | [cmake](/Yubico/yubihsm-shell/tree/master/cmake "cmake") |  |  |
| [common](/Yubico/yubihsm-shell/tree/master/common "common") | | [common](/Yubico/yubihsm-shell/tree/master/common "common") |  |  |
| [debian](/Yubico/yubihsm-shell/tree/master/debian "debian") | | [debian](/Yubico/yubihsm-shell/tree/master/debian "debian") |  |  |
| [doc](/Yubico/yubihsm-shell/tree/master/doc "doc") | | [doc](/Yubico/yubihsm-shell/tree/master/doc "doc") |  |  |
| [examples](/Yubico/yubihsm-shell/tree/master/examples "examples") | | [examples](/Yubico/yubihsm-shell/tree/master/examples "examples") |  |  |
| [lib](/Yubico/yubihsm-shell/tree/master/lib "lib") | | [lib](/Yubico/yubihsm-shell/tree/master/lib "lib") |  |  |
| [pkcs11](/Yubico/yubihsm-shell/tree/master/pkcs11 "pkcs11") | | [pkcs11](/Yubico/yubihsm-shell/tree/master/pkcs11 "pkcs11") |  |  |
| [resources](/Yubico/yubihsm-shell/tree/master/resources "resources") | | [resources](/Yubico/yubihsm-shell/tree/master/resources "resources") |  |  |
| [src](/Yubico/yubihsm-shell/tree/master/src "src") | | [src](/Yubico/yubihsm-shell/tree/master/src "src") |  |  |
| [yhwrap](/Yubico/yubihsm-shell/tree/master/yhwrap "yhwrap") | | [yhwrap](/Yubico/yubihsm-shell/tree/master/yhwrap "yhwrap") |  |  |
| [ykhsmauth](/Yubico/yubihsm-shell/tree/master/ykhsmauth "ykhsmauth") | | [ykhsmauth](/Yubico/yubihsm-shell/tree/master/ykhsmauth "ykhsmauth") |  |  |
| [yubihsm-auth](/Yubico/yubihsm-shell/tree/master/yubihsm-auth "yubihsm-auth") | | [yubihsm-auth](/Yubico/yubihsm-shell/tree/master/yubihsm-auth "yubihsm-auth") |  |  |
| [.clang-format](/Yubico/yubihsm-shell/blob/master/.clang-format ".clang-format") | | [.clang-format](/Yubico/yubihsm-shell/blob/master/.clang-format ".clang-format") |  |  |
| [.gitignore](/Yubico/yubihsm-shell/blob/master/.gitignore ".gitignore") | | [.gitignore](/Yubico/yubihsm-shell/blob/master/.gitignore ".gitignore") |  |  |
| [.pre-commit-config.yaml](/Yubico/yubihsm-shell/blob/master/.pre-commit-config.yaml ".pre-commit-config.yaml") | | [.pre-commit-config.yaml](/Yubico/yubihsm-shell/blob/master/.pre-commit-config.yaml ".pre-commit-config.yaml") |  |  |
| [CHANGELOG](/Yubico/yubihsm-shell/blob/master/CHANGELOG "CHANGELOG") | | [CHANGELOG](/Yubico/yubihsm-shell/blob/master/CHANGELOG "CHANGELOG") |  |  |
| [CMakeLists.txt](/Yubico/yubihsm-shell/blob/master/CMakeLists.txt "CMakeLists.txt") | | [CMakeLists.txt](/Yubico/yubihsm-shell/blob/master/CMakeLists.txt "CMakeLists.txt") |  |  |
| [LICENSE](/Yubico/yubihsm-shell/blob/master/LICENSE "LICENSE") | | [LICENSE](/Yubico/yubihsm-shell/blob/master/LICENSE "LICENSE") |  |  |
| [README](/Yubico/yubihsm-shell/blob/master/README "README") | | [README](/Yubico/yubihsm-shell/blob/master/README "README") |  |  |
| [README.adoc](/Yubico/yubihsm-shell/blob/master/README.adoc "README.adoc") | | [README.adoc](/Yubico/yubihsm-shell/blob/master/README.adoc "README.adoc") |  |  |
| View all files | | |

## Repository files navigation

* README
* Apache-2.0 license
## YubiHSM Shell

This repository contains most of the components used to interact with
the YubiHSM 2 at both a user-facing and programmatic level.

The available components are:

* [libyubihsm](/Yubico/yubihsm-shell/blob/master/lib/README.adoc) — C library to expose low- and high-level functions to
  interact with a YubiHSM
* [yubihsm-shell](/Yubico/yubihsm-shell/blob/master/src/README.adoc) — thin wrapper around `libyubihsm` providing both
  an interactive and command-line interface to a YubiHSM
* [yubihsm-pkcs11](/Yubico/yubihsm-shell/blob/master/pkcs11/README.adoc) — PKCS#11 module using `libyubihsm`
* [yubihsm-wrap](/Yubico/yubihsm-shell/blob/master/yhwrap/README.adoc) — command-line tool to create encrypted objects (wraps) that can be imported in the YubiHSM
* [libykhsmauth](/Yubico/yubihsm-shell/blob/master/ykhsmauth/README.adoc) — C library for using the YubiKey HSM Auth application
* [yubihsm-auth](/Yubico/yubihsm-shell/blob/master/yubihsm-auth/README.adoc) — command-line tool to use the YubiKey HSM Auth application

### Dependencies

* cmake
* cppcheck (optional)
* gcov and lcov (optional)
* gengetopt
* help2man (optional)
* libcrypto
* libcurl
* libedit
* libusb
* libpcsclite-dev
* llvm/clang and friends
* pkg-config
* pre-commit

### Documentation

Documentation for this project and the YubiHSM2 in general can be found on Yubico’s [developers website](https://developers.yubico.com/YubiHSM2/).

### pre-commit

This repository uses [pre-commit](https://pre-commit.com/).

```
$ pre-commit install
```

### Building

```
$ mkdir build && cd build
$ cmake ..
$ make
```

Note that `ninja` builds are available as well:

```
$ mkdir build && cd build
$ cmake -GNinja ..
$ ninja
```

The binaries will be located in `build` directory. To install them on the system, run the following command. Note that this
step may require admin privileges on some systems (e.g. `sudo` on Linux)

```
$ make install
```

| Important | Building from source on Windows should be made with the source from the source release package and not directly from the cloned repository. This is due to the `gengetopt` library not being available for Windows. |
| --- | --- |

Manpages are built by default using `help2man`. It is possible to skip this step with:

```
$ mkdir build && cd build
$ cmake -DWITHOUT_MANPAGES=1 ..
$ make
```

It is possible to build the libraries and binaries with static linking, this can be enabled with:

```
$ mkdir build && cd build
$ cmake -DENABLE_STATIC=1 ..
$ make
```

### Linting

There is a `cppcheck` target that runs the source through `cppcheck`

```
$ make cppcheck
```

### Testing

PKCS#11 tests can be run using [pkcs11test](https://github.com/Yubico/pkcs11test).

The tool must be already built, and the path to the resulting binary
must be in your `PATH`, or `PKCS11TEST_PATH` must be set.

The programs found in the `/examples` directory are also used as tests.

The tests can be run via

```
$ make test
```

Or using ctest directly

```
$ ctest
```

By default the tests expect a local connector running at `<http://localhost:12345>`.
A different connector for the tests can be specified by setting the
`DEFAULT_CONNECTOR_URL` environment variable.
For example, to run tests using direct USB (i.e., without a connector) use

```
$ DEFAULT_CONNECTOR_URL="yhusb://" ctest
```

If you are building `yubihsm-shell` with `ninja`, the following is available:

```
$ ninja test
```

The test output can be found in `…​/yubihsm-shell/build/Testing/Temporary/LastTest{,sFailed}.log`.

Direct command-line output can be obtained with

```
$ ctest -V
```

#### Coverage

Code coverage is provided courtesy of lcov and [CMake-codecov](https://github.com/RWTH-HPC/CMake-codecov). This currently only works with `make` and not with `ninja`.

Enable coverage with

```
$ cmake -DENABLE_COVERAGE=1 ..
```

You can then build the project normally and run some executables (for example running the tests with `make test`).

At this point coverage evaluation can be generated with gcov/lcov related targets. For example

```
$ make lcov
```

will generate a single HTML report in `./lcov/html/all_targets/index.html`

### License

```
 Copyright 2015-2018 Yubico AB

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
```

## About

yubihsm-shell and libyubihsm

[developers.yubico.com/yubihsm-shell/](https://developers.yubico.com/yubihsm-shell/ "https://developers.yubico.com/yubihsm-shell/")

### Resources

[Readme](#readme-ov-file)
### License

[Apache-2.0 license](#Apache-2.0-1-ov-file)

[Activity](/Yubico/yubihsm-shell/activity)
[Custom properties](/Yubico/yubihsm-shell/custom-properties)
### Stars

[**96**
stars](/Yubico/yubihsm-shell/stargazers)
### Watchers

[**34**
watching](/Yubico/yubihsm-shell/watchers)
### Forks

[**54**
forks](/Yubico/yubihsm-shell/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FYubico%2Fyubihsm-shell&report=Yubico+%28user%29)

## [Releases](/Yubico/yubihsm-shell/releases)

[15
tags](/Yubico/yubihsm-shell/tags)

## [Packages 0](/orgs/Yubico/packages?repo_name=yubihsm-shell)

No packages published

## [Contributors 28](/Yubico/yubihsm-shell/graphs/contributors)

* [![@qpernil](https://avatars.githubusercontent.com/u/55495058?s=64&v=4)](https://github.com/qpernil)
* [![@aveenismail](https://avatars.githubusercontent.com/u/42414844?s=64&v=4)](https://github.com/aveenismail)
* [![@klali](https://avatars.githubusercontent.com/u/264413?s=64&v=4)](https://github.com/klali)
* [![@a-dma](https://avatars.githubusercontent.com/u/711165?s=64&v=4)](https://github.com/a-dma)
* [![@LDVG](https://avatars.githubusercontent.com/u/4864502?s=64&v=4)](https://github.com/LDVG)
* [![@alexgeana](https://avatars.githubusercontent.com/u/90633119?s=64&v=4)](https://github.com/alexgeana)
* [![@nevun](https://avatars.githubusercontent.com/u/208243?s=64&v=4)](https://github.com/nevun)
* [![@notdpate](https://avatars.githubusercontent.com/u/11393922?s=64&v=4)](https://github.com/notdpate)
* [![@Jakuje](https://avatars.githubusercontent.com/u/2694489?s=64&v=4)](https://github.com/Jakuje)
* [![@juikim](https://avatars.githubusercontent.com/u/1071564?s=64&v=4)](https://github.com/juikim)
* [![@spoonincode](https://avatars.githubusercontent.com/u/32485495?s=64&v=4)](https://github.com/spoonincode)
* [![@joostd](https://avatars.githubusercontent.com/u/668631?s=64&v=4)](https://github.com/joostd)
* [![@HRio](https://avatars.githubusercontent.com/u/2410382?s=64&v=4)](https://github.com/HRio)
* [![@cjwatson](https://avatars.githubusercontent.com/u/2429141?s=64&v=4)](https://github.com/cjwatson)

[+ 14 contributors](/Yubico/yubihsm-shell/graphs/contributors)

## Languages

* [C
  80.3%](/Yubico/yubihsm-shell/search?l=c)
* [Shell
  9.4%](/Yubico/yubihsm-shell/search?l=shell)
* [CMake
  4.6%](/Yubico/yubihsm-shell/search?l=cmake)
* [PowerShell
  4.4%](/Yubico/yubihsm-shell/search?l=powershell)
* [C++
  1.2%](/Yubico/yubihsm-shell/search?l=c%2B%2B)
* [Batchfile
  0.1%](/Yubico/yubihsm-shell/search?l=batchfile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.yubico.com_92c01746_20250119_110601.html ===


[Skip to content](#wp--skip-link--target)
EnglishFrançaisDeutsch日本語EspañolSvenska

* [Contact Sales](/contact-us/)
* [Resellers](/support/resellers/)
* [Support](https://support.yubico.com/hc/en-us/)

menu![X icon](https://www.yubico.com/wp-content/themes/yubicool/img/icons/close.svg)[![Yubico Header Text Logo](https://www.yubico.com/wp-content/themes/yubicool/img/logos/logo.svg)](https://www.yubico.com)
Why Yubicoexpand\_more
[Why Yubico](https://www.yubico.com/why-yubico/)
How we help

* [Enterprises](https://www.yubico.com/why-yubico/for-business/)
* [SMBs](https://www.yubico.com/why-yubico/yubico-and-smbs/)
* [Individuals](https://www.yubico.com/why-yubico/for-individuals/)
* [Developers](https://www.yubico.com/why-yubico/for-developers/)

Work with us

* [Careers](https://www.yubico.com/careers/)
* [Partner programs](https://www.yubico.com/why-yubico/partners/)

Connect & learn

* [Contact Sales](https://www.yubico.com/contact-us/)
* [Events](https://www.yubico.com/events/)
* [Press room](https://www.yubico.com/press/)
* [About us](/why-yubico/about-us/)
* [The team](/why-yubico/team/)
* [Investors](https://investors.yubico.com/)
* [Innovation history](https://www.yubico.com/why-yubico/yubico-innovation-history/)
* [Secure it Forward](https://www.yubico.com/why-yubico/secure-it-forward/)

![](https://www.yubico.com/wp-content/uploads/2023/03/WhyY-nav-easy-to-use-1.jpg)Easy-to-use, secure authenticationWith YubiKey there’s no tradeoff between great security and usabilityWhy YubiKeysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/WhyY-nav-google-1.jpg)Proven at scale at GoogleGoogle defends against account takeovers and reduces IT costsGoogle Case Studysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-passwordless-nav-5-1.jpg)Protecting vulnerable organizationsSecure it Forward: Yubico matches up to 5% of the number of YubiKeys purchased on Yubico.comSecure it Forwardsecurity-advisory
Productsexpand\_more
[All products](/products/)
Hardware

* [YubiKey 5 Series](https://www.yubico.com/products/yubikey-5-overview/)
* [YubiKey 5 FIPS Series](https://www.yubico.com/products/yubikey-fips/)
* [YubiKey Bio Series](https://www.yubico.com/products/yubikey-bio-series/)
* [Security Key Series](/products/security-key/)
* [YubiHSM 2 & YubiHSM 2 FIPS](https://www.yubico.com/products/hardware-security-module/)

Services

* [YubiKey as a Service](https://www.yubico.com/products/yubikey-as-a-service/)
* [YubiEnterprise Delivery](https://www.yubico.com/products/yubienterprise-delivery/)
* [Yubico Enrollment Suite](https://www.yubico.com/products/yubicoenrollmentsuite/)
* [YubiCloud](https://www.yubico.com/products/yubicloud/)

Software and tools

* [Yubico Authenticator](https://www.yubico.com/products/yubico-authenticator/)
* [Computer login tools](https://www.yubico.com/products/computer-login-tools/)
* [Software Development Toolkits](https://www.yubico.com/products/software-development-toolkits-sdks/)

Discover the YubiKey

* [Using YubiKey is easy](https://www.yubico.com/products/ease-of-use/)
* [Find the right YubiKey](/quiz/)
* [Works with YubiKey](/works-with-yubikey/catalog/)
* [Compare YubiKeys](https://www.yubico.com/store/compare/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-hundreds-services-nav-3-1.jpg)One key for hundreds of apps and servicesYubiKey works out-of-the-box and has no client software or batteryYubico protects yousecurity-advisory
![See YubiKeys as a Service](https://www.yubico.com/wp-content/uploads/2023/03/img-YubiEnterprise-nav-3-1.jpg)YubiKey as a Service delivers scale and savingsGain a future-proofed solution and faster MFA rolloutsYubiKey as a Servicesecurity-advisory
Solutionsexpand\_more
[Solutions overview](/solutions/)
Initiatives

* [Zero Trust](https://www.yubico.com/solutions/zero-trust/)
* [Executive Order OMB M-22-09](https://www.yubico.com/solutions/executive-order-hub/)
* [Phishing-resistant MFA](https://www.yubico.com/solutions/multi-factor-authentication/)
* [Passwordless](https://www.yubico.com/solutions/passwordless/)
* [Compliance](https://www.yubico.com/solutions/cybersecurity-compliance/)
* [Cyber Insurance](https://www.yubico.com/solutions/cyber-insurance/)
* [Critical infrastructure](https://www.yubico.com/solutions/critical-infrastructure-security/)
* [Secure supply chain](/solutions/supply-chain-security/)
* [Protect call centers](https://www.yubico.com/solutions/call-centers/)

Use cases

* [Hybrid & remote workers](/solutions/secure-hybrid-and-remote-workers/)
* [Secure privileged users](https://www.yubico.com/solutions/privileged-users/)
* [Mobile restricted environments](https://www.yubico.com/solutions/mobile-restricted-environment/)
* [Shared workstations](https://www.yubico.com/solutions/shared-workstations/)

Technologies

* [Microsoft ecosystem](https://www.yubico.com/solutions/microsoft-365-mfa/)
* [Salesforce workspace](https://www.yubico.com/solutions/yubico-and-salesforce/)
* [IAM solutions](https://www.yubico.com/solutions/identity-access-management/)
* [AWS environment](https://www.yubico.com/solutions/yubico-and-amazon-web-services/)
* [HYPR experience](https://www.yubico.com/solutions/hypr-and-yubico/)
* [Okta identity solutions](https://www.yubico.com/solutions/okta-and-yubico/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-passwordless-nav-5-1.jpg)The Bridge to PasswordlessBegin the journey to make your organization passwordless Get the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-zero-trust-nav-3.jpg)Accelerate your Zero Trust Strategy7 best authentication practices to jumpstart your Zero Trust programGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-federal-nav-3.jpg)Federal cybersecurity requirements Guidance for leaders to prepare for the modern cyber threat eraGet the white papersecurity-advisory
Industriesexpand\_more
[Industries overview](https://www.yubico.com/industries/)
Industries

* [High tech](https://www.yubico.com/industries/technology/)
* [Federal government](https://www.yubico.com/industries/federal/)
* [Department of Defense](https://www.yubico.com/industries/us-department-of-defense/)
* [Federal systems integrators](https://www.yubico.com/industries/federal-systems-integrators/)
* [State & local government](https://www.yubico.com/industries/state-local-government/)
* [Education](https://www.yubico.com/industries/education/)
* [Financial services](https://www.yubico.com/industries/finance/)

* [Retail & hospitality](https://www.yubico.com/industries/retail-and-hospitality/)
* [Telecommunications](/industries/telecommunications/)
* [Healthcare](https://www.yubico.com/industries/healthcare/)
* [Pharmaceuticals](https://www.yubico.com/industries/pharmaceuticals/)
* [Cryptocurrency](https://www.yubico.com/industries/cryptocurrency/)
* [Energy & natural resources](https://www.yubico.com/industries/energy-and-natural-resources/)
* [Manufacturing](https://www.yubico.com/industries/manufacturing/)
* [Elections & campaigns](https://www.yubico.com/industries/political-campaigns/)
* [Insurance organizations](https://www.yubico.com/industries/phishing-resistant-mfa-and-passwordless-for-insurance-organizations/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-mfg-nav.jpg)Manufacturing and supply chain security Authentication best practices for manufacturingGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-phishing-nav.jpg)Phishing-resistant MFA: Fact vs. FictionMeet requirements for phishing-resistant MFA in OMB M-22-09 guidelinesGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-nat-resources-nav.jpg)Secure energy and natural resources from cyber threats Best practices for phishing-resistant MFA to protect infrastructureGet the white papersecurity-advisory
Resourcesexpand\_more
[All resources](/resources/)
Learn

* [Yubico Blog](https://www.yubico.com/blog/)
* [Cybersecurity glossary](https://www.yubico.com/resources/glossary/)
* [Authentication standards](https://www.yubico.com/authentication-standards/)
* [Resource library](https://www.yubico.com/resources/library/)
* [Developer program](https://developers.yubico.com/)
* [Product briefs](https://www.yubico.com/resource_categories/product-briefs/)
* [Solution briefs](https://www.yubico.com/resource_categories/solution-briefs/)
* [Passkeys](https://www.yubico.com/passkeys/)

Best practices

* [Case studies](https://www.yubico.com/resources/reference-customers/)
* [Get a pilot started](https://www.yubico.com/resources/getting-started/)
* [White papers and reports](https://www.yubico.com/resource_categories/white-papers/)
* [Webinars](https://www.yubico.com/resource_categories/webinars/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-beyondTrust-nav.jpg)BeyondTrust: secured with a subscriptionPrivileged Access Management leader simplifies deploymentSee case studysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/04/DCT-608-Navigation-promotional-image-for-451-webinar-390x216-1.jpg)S&P Global Market Intelligence report: old habits die hardOnly 46% of orgs protect their applications with MFA. How about yours?Read the reportsecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/08/img-Ebook-nav.jpg)Considering Passkeys for your Enterprise?Learn how to avoid common passkey pitfallsVisit Passkey Hubsecurity-advisory
Supportexpand\_more
 [Support home](https://support.yubico.com/hc/en-us)
Get started

* [Find the right YubiKey](/quiz/)
* [Set up your YubiKey](/setup/)
* [Downloads](https://www.yubico.com/support/download/)
* [Product documentation](https://docs.yubico.com/)
* [Support articles](https://support.yubico.com/hc/en-us/)

Services

* [Support Services](https://www.yubico.com/support/support-services/)
* [Professional Services](https://www.yubico.com/support/yubico-for-professional-services/)
* [YubiKey as a Service](https://www.yubico.com/products/yubikey-as-a-service/)

Additional resources

* [Works with YubiKey Program](https://www.yubico.com/works-with-yubikey/catalog/?sort=popular)
* [Buying and shipping information](https://www.yubico.com/support/shipping-and-buying-information/)
* [Security advisories](https://www.yubico.com/support/security-advisories/)
* [Help center](https://support.yubico.com/hc/en-us/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-setup-nav-3.jpg)How to set up your YubiKeyFollow our guided tutorials to start protecting your servicesSet up your YubiKeysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-find-nav-3.jpg)Find the best YubiKey for your needsTake the guided quiz and see which YubiKeys fit your needsTake the quizsecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-accelerate-nav-3.jpg)Accelerate your YubiKey deploymentTechnical and operational guidance for your YubiKey rolloutProfessional Servicessecurity-advisory
Search![X icon](https://www.yubico.com/wp-content/themes/yubicool/img/icons/close.svg)[Subscribe](/products/yubienterprise-subscription/)[Store](/store/)

* # ****Security Advisory YSA-2020-06****

  ## **Security Advisory YSA-2020-06 – Denial of service issues in yubihsm-shell**

  Published Date: 2020-10-19
  Tracking ID: YSA-2020-06
  CVE: [CVE-2020-24387](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24387), [CVE-2020-24388](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24388)

  ### Summary

  The yubihsm library, included in the yubihsm-shell project, does not properly validate two message fields during device communication. A maliciously-crafted YubiHSM2 device, or someone with access to the HTTP traffic between a client and server handling the device, could cause the yubihsm library to crash.

  ### Affected products

  The yubihsm-shell project is included in the YubiHSM2 SDK product. All SDK versions prior to 2020.10 are thus affected. Note that several components included in the SDK depend on the yubihsm library from the yubihsm-shell project.

  ### Customer actions

  Check the version of yubihsm-shell:

  `$ yubihsm-shell --version`
  `yubihsm-shell 2.0.2`

  If you have 2.0.2 or below it means you are affected and we recommend upgrading to the latest [YubiHSM2 SDK 2020.10](https://developers.yubico.com/YubiHSM2/Releases/) which comes with binaries for most common platforms.

  ### Mitigation

  To prevent an adversary from gaining access to communication in cases where the YubiHSM device is communicating over the internet, encrypt the connection. The use of mutual TLS is strongly recommended. To reduce the possibility of a maliciously-crafted YubiHSM device being introduced into a customer environment, HSMs should also be used with internal USB slots and in computers with appropriate physical and environmental controls.

  ### Technical details

  The first issue is that the yubihsm-shell library is not checking the range of the session id when parsing a response in yh\_create\_session(). If this id is out of bounds it will cause the code to index the sessions array out of bounds and later cause the address of the heap allocated session object to be written to the same place.

  The second issue is that the yubihsm-shell library does not correctly check the length field returned from the YubiHSM2 device in the function \_send\_secure\_msg(). This could lead to an oversized memcpy() call that will crash the running process.

  The yubihsm-shell tool can talk to a YubiHSM2 device either over USB or over the network using the HTTP plugin. In the network case the server side is in most cases a [yubishm-connector](https://developers.yubico.com/YubiHSM2/Component_Reference/yubihsm-connector/) process which in turn talks to the actual YubiHSM. The protocol is not by default protected by TLS although the sessions are established cryptographically between the application and the YubiHSM2 using a symmetric mutual authentication scheme that is both encrypted and authenticated.

  A maliciously-crafted YubiHSM2 device, or someone with access to the HTTP traffic between a client and device, could cause the yubihsm library to crash.

  ### Downloads

  The latest source code release of yubihsm-shell can be found [here](https://developers.yubico.com/yubihsm-shell). The latest version of the YubiHSM2 SDK which contains binaries for yubihsm-shell for most common platforms can be found [here](https://developers.yubico.com/YubiHSM2/Releases/).

  ### Aggregate severity rating

  Yubico has rated these issues as Moderate based on maximum security impact. The base CVSS score for the first issue is [6.5](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:H) and for the second, [5.9](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H).

  ### Acknowledgements

  On July 20, 2020, Christian Reitter notified Yubico of multiple security issues. We thank Christian Reitter for reporting these issues and working with us under coordinated vulnerability disclosure.

  ### Timeline

  | July 20, 2020 | Christian Reitter reports issue to Yubico |
  | --- | --- |
  | October 19, 2020 | Security Advisory is published |

[![Yubico Text Logo](https://www.yubico.com/wp-content/themes/yubicool/img/logos/logo.svg)](https://www.yubico.com)

* [RSS Feed](https://www.yubico.com/feed/)
* [X](https://x.com/Yubico)
* [LinkedIn](https://www.linkedin.com/company/Yubico)
* [Facebook](https://www.facebook.com/Yubikey)
* [Instagram](https://www.instagram.com/Yubico)
* [YouTube](https://www.youtube.com/c/Yubico)
* [GitHub](https://www.github.com/Yubico)

Find

* [Product finder quiz](/quiz/)

Set up

* [Find set-up guides](/setup/)

Buy

* [Buy online](/store)
* [Contact sales](/contact-us/)

Sign up

* [Get Yubico updates](https://www.yubico.com/email-subscription/)

Why Yubico

* [Careers](https://www.yubico.com/careers/)
* [Events](https://www.yubico.com/events/)
* [Press room](https://www.yubico.com/press/)
* [About us](https://www.yubico.com/why-yubico/about-us/)
* [Investors](https://investors.yubico.com)
* [Partner programs](https://www.yubico.com/why-yubico/partners/)

Products

* [YubiKey 5 Series](https://www.yubico.com/products/yubikey-5-overview/)
* [YubiKey 5 FIPS Series](https://www.yubico.com/products/yubikey-fips/)
* [YubiKey Bio Series](https://www.yubico.com/products/yubikey-bio-series/)
* [Security Key Series](https://www.yubico.com/products/security-key/)
* [YubiHSM 2 & YubiHSM 2 FIPS](https://www.yubico.com/products/hardware-security-module/)

* [Yubico Authenticator](https://www.yubico.com/products/yubico-authenticator/)

Solutions

* [Zero Trust](https://www.yubico.com/solutions/zero-trust/)
* [Phishing-resistant MFA](https://www.yubico.com/solutions/multi-factor-authentication/)
* [Passwordless](https://www.yubico.com/solutions/passwordless/)
* [Cyber insurance](https://www.yubico.com/solutions/cyber-insurance/)
* [More solutions](https://www.yubico.com/solutions/)

Industries

* [Industries overview](https://www.yubico.com/industries/)

Resources

* [Yubico blog](https://www.yubico.com/blog/)
* [Resource library](https://www.yubico.com/resources/library/)
* [Cybersecurity glossary](https://www.yubico.com/resources/glossary/)
* [Authentication standards](https://www.yubico.com/authentication-standards/)
* [Developer program](https://developers.yubico.com/)

Support

* [Works with YubiKey](https://www.yubico.com/works-with-yubikey/catalog/?sort=popular/)
* [Help center](https://support.yubico.com/hc/en-us/)
* [Downloads](https://www.yubico.com/support/download/)
* [Product documentation](https://docs.yubico.com/)
* [Support Services](https://www.yubico.com/support-services/)
* [Professional Services](https://www.yubico.com/support/yubico-for-professional-services/)
* [Contact support](https://support.yubico.com/hc/en-us/requests/new/)

EnglishFrançaisDeutsch日本語EspañolSvenska
 Yubico © 2025 All Rights Reserved.

* [Sitemap](/sitemap_index.xml)
* [Cookies](/support/terms-conditions/cookie-notice/)
* [Legal](/support/terms-conditions/)
* [Privacy](/support/terms-conditions/privacy-notice/)
* [Patents](https://www.yubico.com/why-yubico/patents/)
* [Terms of use](/support/terms-conditions/yubico-website-terms-conditions/)
* [Trust](/trust/)


