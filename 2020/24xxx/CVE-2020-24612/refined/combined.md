=== Content from github.com_12625ab7_20250119_111939.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffedora-selinux%2Fselinux-policy%2Fcommit%2F71e1989028802c7875d3436fd3966c587fa383fb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffedora-selinux%2Fselinux-policy%2Fcommit%2F71e1989028802c7875d3436fd3966c587fa383fb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fedora-selinux%2Fselinux-policy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fedora-selinux](/fedora-selinux)
/
**[selinux-policy](/fedora-selinux/selinux-policy)**
Public

* [Notifications](/login?return_to=%2Ffedora-selinux%2Fselinux-policy) You must be signed in to change notification settings
* [Fork
  176](/login?return_to=%2Ffedora-selinux%2Fselinux-policy)
* [Star
   168](/login?return_to=%2Ffedora-selinux%2Fselinux-policy)

* [Code](/fedora-selinux/selinux-policy)
* [Issues
  86](/fedora-selinux/selinux-policy/issues)
* [Pull requests
  73](/fedora-selinux/selinux-policy/pulls)
* [Actions](/fedora-selinux/selinux-policy/actions)
* [Projects
  0](/fedora-selinux/selinux-policy/projects)
* [Wiki](/fedora-selinux/selinux-policy/wiki)
* [Security](/fedora-selinux/selinux-policy/security)
* [Insights](/fedora-selinux/selinux-policy/pulse)

Additional navigation options

* [Code](/fedora-selinux/selinux-policy)
* [Issues](/fedora-selinux/selinux-policy/issues)
* [Pull requests](/fedora-selinux/selinux-policy/pulls)
* [Actions](/fedora-selinux/selinux-policy/actions)
* [Projects](/fedora-selinux/selinux-policy/projects)
* [Wiki](/fedora-selinux/selinux-policy/wiki)
* [Security](/fedora-selinux/selinux-policy/security)
* [Insights](/fedora-selinux/selinux-policy/pulse)

## Commit

[Permalink](/fedora-selinux/selinux-policy/commit/71e1989028802c7875d3436fd3966c587fa383fb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add file context for ~/.config/Yubico

[Browse files](/fedora-selinux/selinux-policy/tree/71e1989028802c7875d3436fd3966c587fa383fb)
Browse the repository at this point in the history

```
Add file context specification for ~/.config/Yubico in addition to
existing ~/.yubico. Update the auth_filetrans_home_content() and
auth_filetrans_admin_home_content() interfaces accordingly.

Resolves: rhbz#1860888
```

* Loading branch information

[![@zpytela](https://avatars.githubusercontent.com/u/16078627?s=40&v=4)](/zpytela)

[zpytela](/fedora-selinux/selinux-policy/commits?author=zpytela "View all commits by zpytela")
committed
Aug 24, 2020

1 parent
[204a23c](/fedora-selinux/selinux-policy/commit/204a23cf3da322e59c1b7af2e5cd62c835b91c2a)

commit 71e1989

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**4 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* policy/modules/system

  + policy/modules/system/authlogin.fc
    [authlogin.fc](#diff-2c3335f3d959da78931d6f291ac38499974ccf6e23d61e70f0b4afbc3b8128a3)
  + policy/modules/system/authlogin.if
    [authlogin.if](#diff-4ee4501e4341e12753832c32c7ba4513c856acc9176720dd2ce333296c4a7c0e)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[policy/modules/system/authlogin.fc](#diff-2c3335f3d959da78931d6f291ac38499974ccf6e23d61e70f0b4afbc3b8128a3 "policy/modules/system/authlogin.fc")

Show comments

[View file](/fedora-selinux/selinux-policy/blob/71e1989028802c7875d3436fd3966c587fa383fb/policy/modules/system/authlogin.fc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,9 @@ |
|  |  | HOME\_DIR/\.yubico(/.\*)? gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | HOME\_DIR/\.config/Yubico(/.\*)? gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | HOME\_DIR/\.google\_authenticator gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | HOME\_DIR/\.google\_authenticator~ gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | /root/\.yubico(/.\*)? gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | /root/\.config/Yubico(/.\*)? gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | /root/\.google\_authenticator gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  | /root/\.google\_authenticator~ gen\_context(system\_u:object\_r:auth\_home\_t,s0) |
|  |  |  |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[policy/modules/system/authlogin.if](#diff-4ee4501e4341e12753832c32c7ba4513c856acc9176720dd2ce333296c4a7c0e "policy/modules/system/authlogin.if")

Show comments

[View file](/fedora-selinux/selinux-policy/blob/71e1989028802c7875d3436fd3966c587fa383fb/policy/modules/system/authlogin.if)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2313,6 +2313,7 @@ interface(`auth\_filetrans\_admin\_home\_content',` |
|  |  | userdom\_admin\_home\_dir\_filetrans($1, auth\_home\_t, file, ".google\_authenticator") |
|  |  | userdom\_admin\_home\_dir\_filetrans($1, auth\_home\_t, file, ".google\_authenticator~") |
|  |  | userdom\_admin\_home\_dir\_filetrans($1, auth\_home\_t, dir, ".yubico") |
|  |  | userdom\_admin\_home\_dir\_filetrans($1, auth\_home\_t, dir, ".config/Yubico") |
|  |  | ') |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -2377,6 +2378,7 @@ interface(`auth\_filetrans\_home\_content',` |
|  |  | userdom\_user\_home\_dir\_filetrans($1, auth\_home\_t, file, ".google\_authenticator") |
|  |  | userdom\_user\_home\_dir\_filetrans($1, auth\_home\_t, file, ".google\_authenticator~") |
|  |  | userdom\_user\_home\_dir\_filetrans($1, auth\_home\_t, dir, ".yubico") |
|  |  | userdom\_user\_home\_dir\_filetrans($1, auth\_home\_t, dir, ".config/Yubico") |
|  |  | ') |
|  |  |  |
|  |  | ######################################## |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `71e1989`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffedora-selinux%2Fselinux-policy%2Fcommit%2F71e1989028802c7875d3436fd3966c587fa383fb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugzilla.redhat.com_b7a444a0_20250119_111938.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1860888)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1860888)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1860888)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1860888

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1860888**](show_bug.cgi?id=1860888)
- [authselect] Obligatory 2FA doesn't work

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
[authselect] Obligatory 2FA doesn't work

| | [Keywords](describekeywords.cgi): | Triaged | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Fedora | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Fedora | | [Component:](describecomponents.cgi?product=Fedora "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | selinux-policy | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 32 | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Zdenek Pytela | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Fedora Extras Quality Assurance | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (1): | [1871219](show_bug.cgi?id=1871219 "CLOSED DUPLICATE - selinux-policy: SELinux prevents pam-u2f to work correctly, disabling the 2nd factor during authentication [fedora-all]")  ([view as bug list](buglist.cgi?bug_id=1871219)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [CVE-2020-24612](show_bug.cgi?id=1871217 "CLOSED UPSTREAM - CVE-2020-24612 selinux-policy: SELinux prevents pam-u2f to work correctly, disabling the 2nd factor during authentication") | | TreeView+ | [depends on](buglist.cgi?bug_id=1860888&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1860888&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2020-07-27 10:53 UTC by dlippold | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2020-09-21 11:53 UTC ([History](show_activity.cgi?id=1860888)) | | [CC List:](page.cgi?id=fields.html#cclist) | 10 users (show)  cbuissar dwalsh grepl.miroslav jhrozek lvrabec mmalik pbrezina plautrba vmojzis zpytela | | Fixed In Version: | selinux-policy-3.14.5-43.fc32 | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2020-08-31 15:50:10 UTC | | | Type: | Bug | | | Embargoed: |  | | | [Dependent Products:](page.cgi?id=fields.html#dependent_products "Other Products that are affected by this bug.") | Ember-CSI Red Hat Enterprise Virtualization Manager Red Hat OpenStack Service Telemetry Framework | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**output of ausearch**](attachment.cgi?id=1711121 "View the content of the attachment") (1.37 KB, text/plain)  [2020-08-11 21:45 UTC](#attach_1711121 "Go to the comment associated with the attachment"), dlippold | *no flags* | [Details](attachment.cgi?id=1711121&action=edit) | | [View All](attachment.cgi?bugid=1860888&action=viewall) | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Github | [authselect authselect issues 216](https://github.com/authselect/authselect/issues/216) | 0 | None | closed | Add without-pam-u2f-nouserok | 2021-02-03 21:35:42 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1860888#c0)  dlippold    2020-07-27 10:53:17 UTC  ``` Description of problem:  When obligatory two-factor authentification (2FA) is activated by authselect with the function "with-pam-u2f-2fa" it is still possible to login on the console without the Yubikey. This works at the login screen and when the screen is locked.   Version-Release number of selected component (if applicable):  Fedora 32 LXDE x86_64 authselect-1.2.1-1.fc32.x86_64.rpm   How reproducible: Always   Steps to Reproduce:   1. Activate "with-pam-u2f-2fa" (e.g. execute "authselect select sssd with-pam-u2f-2fa without-nullok" by root)  2. Activate a Yubikey for a user (e.g. exectute "mkdir ~/.config/Yubico; pamu2fcfg > ~/.config/Yubico/u2f_keys" by the user and press the Yubikey button)  3. Reboot the system  4. Wait until the login manager appears  5. Press the key combination Strg-Alt-F2 to switch to a console  6. Login as the user only with the password without the Yubikey   Actual results:  Login without Yubikey is possible.   Expected results:  The login should not be possible without verification of the Yubikey or should never be possible on the console.   Additional info:  This is a potential security problem because someone might choose a weak password, e.g. a pin of four digits, because of the second factor (which would be ok if the 2FA would realy work). But because the 2FA can be avoided that would be highly insecure.  Workaround: Remove the option "nouserok" in the files "/etc/pam.d/*". But that should only be done when login by a Yubikey is already activated for root (otherwise root cannot login anymore).   ```  [Comment 1](show_bug.cgi?id=1860888#c1)  Pavel Březina    2020-07-29 09:57:51 UTC  ``` Upstream ticket: <https://github.com/authselect/authselect/issues/216>   ```  [Comment 3](show_bug.cgi?id=1860888#c3)  dlippold    2020-08-07 21:20:19 UTC  ``` The problem was discussed more detailed in relation to pam-u2f on the page <https://github.com/Yubico/pam-u2f/issues/152>  It became clear that there is basically a SELinux problem. Therefore I sent a mail to the SELinux mailing list (<https://lists.fedoraproject.org/admin/lists/selinux.lists.fedoraproject.org/>). I hope the mail will appear soon on the archive page [https://lists.fedoraproject.org/archives/list/selinux@lists.fedoraproject.org/2020/8/](https://lists.fedoraproject.org/archives/list/selinux%40lists.fedoraproject.org/2020/8/)   ```  [Comment 4](show_bug.cgi?id=1860888#c4)  dlippold    2020-08-11 21:42:29 UTC  ``` Because there obviously was a problem with the SELinux mailing list regarding my mail I add the main information of that mail here.  The package pam-u2f of Fedora 32 uses configuration (authorization) files in the user home directories, by default "~/.config/Yubico/u2f_keys". But when one tries to login from the console that file cannot be read because of SELinux. Because of that the 2-factor authorization is not used (with the option "nouserok" of pam-u2f although it should be used) and one can login only with password and without the second factor.  To get more details from SELinux Zdenek Pytela from the SELinux team suggested the following steps (in a private mail).  1. From the file /etc/audit/rules.d/audit.rules I commented out the following line: -a task,never  2. I added the following line to the end of the file: -w /etc/shadow -p w  3. I restarted the audit daemon by the following command: service auditd restart  4. I switched to the console by pressing Strg-Alt-F2, logged in with password only without the second factor, logged out and switched back to the X screen by pressing Strg-Alt-F1.  5. I executed the following command to get more information: ausearch -i -m avc,user_avc,selinux_err,user_selinux_err -ts today  The output of the last command is in the attached file "ausearch-output.txt". The included German text "Keine Berechtigung" means "No permission".  BTW: After step 4 a window with a SELinux security alert popped up which I didn't saw at former tests (maybe because of my installation of new updates in the last days).  Maybe the component of this bug should be changed to SELinux and someone can choose the appropriate component.   ```  [Comment 5](show_bug.cgi?id=1860888#c5)  dlippold    2020-08-11 21:45:03 UTC  ``` Created [attachment 1711121](attachment.cgi?id=1711121 "output of ausearch") [[details]](attachment.cgi?id=1711121&action=edit "output of ausearch") output of ausearch   ```  [Comment 6](show_bug.cgi?id=1860888#c6)  Zdenek Pytela    2020-08-12 09:30:26 UTC  ``` Dietmar,  Thank you for the output. It looks the yubico configuration directory has changed: we have in the policy rules for   /home/[^/]+/\.yubico(/.*)?                         all files          unconfined_u:object_r:auth_home_t:s0  /root/\.yubico(/.*)?                               all files          system_u:object_r:auth_home_t:s0   As a quick solution, you can try  chcon -R -t auth_home_t /home/anonym/.config/Yubico  and login again.  If that does not help, please re-run the previous steps and collect additional denials:  setenforce 0 <repeat the previous steps> setenforce 1  I also wonder if you changed the value of this boolean:  semanage boolean -l | grep authlogin_yubikey   ```  [Comment 7](show_bug.cgi?id=1860888#c7)  dlippold    2020-08-12 20:57:33 UTC  ``` Zdenek,  your chcon command resolved the problem. Now I need the second factor to login on the console.  The output of your semanage command is: authlogin_yubikey              (aus  ,  aus)  Allow authlogin to yubikey  The German "aus" means "off".  Will there be an update for Fedora 32 and Fedora 31 which resolves the problem in general?  Are there any more SELinux rules for Yubikey or pam-u2f so that specific changes by the developers of pam-u2f should be reported to the SELinux mailing list (or to somewhere else)?   ```  [Comment 8](show_bug.cgi?id=1860888#c8)  Zdenek Pytela    2020-08-13 10:36:13 UTC  ``` Dietmar,  The policy will be updated to resolve this issue, just based on developer availability.  I am afraid I cannot answer your last question directly; in general - policy needs to be adjusted every time an important change has been made to a package.   ```  [Comment 9](show_bug.cgi?id=1860888#c9)  dlippold    2020-08-13 13:21:31 UTC  ``` Zdenek,  until now we only discussed the reading of the file "~/.config/Yubico/u2f_keys" by the login process (when login is done on the console). But an arbitrary file in the home directory of a user can be specified by the parameter "authfile" of pam-u2f (for the parameter look at "<https://developers.yubico.com/pam-u2f/>"). Therefore it seems reasonable to me to define a SELinux rule that login can read any file below "/home". Do you agree?  I asked about any more SELinux rules for Yubikey and pam-u2f to avoid a situation where an important file cannot be read after a change of "pam-u2f". So there are three questions from my poit of view which should be answered: 1. Which changes of pam-u2f should be reported? 2. Who should report these changes (the developer of pam-u2f who may not know much about Fedora and SELinux or the person who creates the rpm package of pam-u2f for Fedora)? 3. To whom the changes should be reported (to the SELinux mailing list or to somewhere else)?  These questions may also be important for other packages.   ```  [Comment 11](show_bug.cgi?id=1860888#c11)  Cedric Buissart    2020-08-21 16:00:37 UTC  ``` *** [Bug 1871219](show_bug.cgi?id=1871219 "CLOSED DUPLICATE - selinux-policy: SELinux prevents pam-u2f to work correctly, disabling the 2nd factor during authentication [fedora-all]") has been marked as a duplicate of this bug. ***   ```  [Comment 12](show_bug.cgi?id=1860888#c12)  Zdenek Pytela    2020-08-24 12:34:27 UTC  ``` I've submitted a Fedora PR to address the issue: <https://github.com/fedora-selinux/selinux-policy/pull/415>   ```  [Comment 13](show_bug.cgi?id=1860888#c13)  Lukas Vrabec    2020-08-24 12:45:38 UTC  ``` commit 1363710b88904f29915e39335fef0dfb673a0f70 (HEAD -> rawhide, origin/rawhide) Author: Zdenek Pytela <zpytela> Date:   Mon Aug 24 14:29:15 2020 +0200      Add file context for ~/.config/Yubico          Add file context specification for ~/.config/Yubico in addition to     existing ~/.yubico. Update the auth_filetrans_home_content() and     auth_filetrans_admin_home_content() interfaces accordingly.          Resolves: rhbz#1860888   ```  [Comment 14](show_bug.cgi?id=1860888#c14)  Zdenek Pytela    2020-08-24 12:53:55 UTC  ``` (In reply to dlippold from [comment #9](show_bug.cgi?id=1860888#c9)) > Zdenek, >  > until now we only discussed the reading of the file > "~/.config/Yubico/u2f_keys" by the login process (when login is done on the > console). But an arbitrary file in the home directory of a user can be > specified by the parameter "authfile" of pam-u2f (for the parameter look at > "<https://developers.yubico.com/pam-u2f/>"). Therefore it seems reasonable to > me to define a SELinux rule that login can read any file below "/home". Do > you agree? Dietmar,  With a fix for this bz we will assign the auth_home_t type for ~/.config/Yubico the same way as it was for ~/.yubico.  We cannot assign this type for an arbitrary filename; if a custom one is used in user's environment, a local SELinux policy needs to be created, too.  > I asked about any more SELinux rules for Yubikey and pam-u2f to avoid a > situation where an important file cannot be read after a change of > "pam-u2f". So there are three questions from my poit of view which should be > answered: 1. Which changes of pam-u2f should be reported? 2. Who should > report these changes (the developer of pam-u2f who may not know much about > Fedora and SELinux or the person who creates the rpm package of pam-u2f for > Fedora)? 3. To whom the changes should be reported (to the SELinux mailing > list or to somewhere else)? >  > These questions may also be important for other packages. There are no strict rules. On FedoraDOCS, a general HOWTO can be found: <https://docs.fedoraproject.org/en-US/quick-docs/howto-file-a-bug/>  There is the selinux mailing list at lists.fedoraproject.org which matches the best when it comes to SELinux related problems. The fedora-devel list can be used when a more broad developers discussion is needed, just with the word selinux in the subject not to miss it. Anyone is welcome to report a bug. If there are AVC denials, the initial component should be selinux-policy. Proactive change reporting is also welcome as well as hard to outline, in general it is when a new SELinux permission is required: most frequently for a file, port, syscall, capability.   ```  [Comment 15](show_bug.cgi?id=1860888#c15)  Fedora Update System    2020-08-27 21:10:45 UTC  ``` FEDORA-2020-740de661da has been submitted as an update to Fedora 32. <https://bodhi.fedoraproject.org/updates/FEDORA-2020-740de661da>   ```  [Comment 16](show_bug.cgi?id=1860888#c16)  Fedora Update System    2020-08-28 14:55:16 UTC  ``` FEDORA-2020-740de661da has been pushed to the Fedora 32 testing repository. In short time you'll be able to install the update with the following command: `sudo dnf upgrade --enablerepo=updates-testing --advisory=FEDORA-2020-740de661da` You can provide feedback for this update here: <https://bodhi.fedoraproject.org/updates/FEDORA-2020-740de661da>  See also [https://fedoraproject.org/wiki/QA:Updates_Testing](https://fedoraproject.org/wiki/QA%3AUpdates_Testing) for more information on how to test updates.   ```  [Comment 17](show_bug.cgi?id=1860888#c17)  dlippold    2020-08-30 13:46:54 UTC  ``` I executed the dnf command and the following two packages were installed (updated):    selinux-policy-3.14.5-43.fc32.noarch   selinux-policy-targeted-3.14.5-43.fc32.noarch  Then I rebooted the system. But the bug still exists and the file "~/.config/Yubico/u2f_keys" is still not readable.  I executed the steps dscribed in my comment above with date "2020-08-11 21:42:29 UTC". The relevant output of the ausearch command is:  type=AVC msg=audit(30.08.2020 14:57:58.329:271) : avc:  denied  { read } for  pid=1935 comm=login name=u2f_keys dev="sda2" ino=655918 scontext=system_u:system_r:local_login_t:s0-s0:c0.c1023 tcontext=unconfined_u:object_r:config_home_t:s0 tclass=file permissive=0   Then I executed the chcon command you gave above:    chcon -R -t auth_home_t /home/anonym/.config/Yubico  Now the file "~/.config/Yubico/u2f_keys" is readable.  So it seems to me that the update din't change much. Which file of my Fedora system should contain the new SELinux rule (for the file "~/.config/Yubico/u2f_keys")?   ```  [Comment 18](show_bug.cgi?id=1860888#c18)  Zdenek Pytela    2020-08-31 09:06:14 UTC  ``` This updates deals with the situation the directory does not exist, the permissions are the same as they were previously. Files in the /home directory are not automatically relabeled, so a command for restoring context needs to be run, e. g.    # fixfiles onboot  and reboot the system.   ```  [Comment 19](show_bug.cgi?id=1860888#c19)  Fedora Update System    2020-08-31 15:50:10 UTC  ``` FEDORA-2020-740de661da has been pushed to the Fedora 32 stable repository. If problem still persists, please make note of it in this bug report.   ```  [Comment 20](show_bug.cgi?id=1860888#c20)  dlippold    2020-09-01 08:22:19 UTC  ``` Zdenek,  the command "fixfiles onboot" resolves the bug for me. Could that command (or even better the update of the SELinux security contexts only for the files in "/home/*/.config/" and "/root/.config/") be done automatically when the RPM packages are installed? That would fix the bug also for those users who already use "pam-u2f" and who are most seriously affected by the bug.   ```  [Comment 21](show_bug.cgi?id=1860888#c21)  dlippold    2020-09-01 08:28:03 UTC  ``` The updates should also be provided for Fedora 31.   ```  [Comment 22](show_bug.cgi?id=1860888#c22)  Zdenek Pytela    2020-09-01 08:41:25 UTC  ``` Dietmar,  I am afraid this is not possible. The fixfiles script, executed from a rpm scriptlet, explicitly excludes /home and /root from filesystems to relabel during update:  # # Compare PREVious File Context to currently installed File Context and # run restorecon on all files affected by the differences. # diff_filecontext() { EXCLUDEDIRS="`exclude_dirs_from_relabelling`" for i in /sys /proc /dev /run /mnt /var/tmp /var/lib/BackupPC /home /tmp /dev; do     [ -e $i ]  && EXCLUDEDIRS="${EXCLUDEDIRS} -e $i"; done LogExcluded  if [ -f ${PREFC} -a -x /usr/bin/diff ]; then 	TEMPFILE=`mktemp ${FC}.XXXXXXXXXX` 	test -z "$TEMPFILE" && exit 	PREFCTEMPFILE=`mktemp ${PREFC}.XXXXXXXXXX` 	sed -r -e 's,:s0, ,g' $PREFC | sort -u > ${PREFCTEMPFILE} 	sed -r -e 's,:s0, ,g' $FC | sort -u | \ 	/usr/bin/diff -b ${PREFCTEMPFILE} - | \ 	    grep '^[<>]'|cut -c3-| grep ^/ | \ 	    egrep -v '(^/home|^/root|^/tmp|^/dev)' |\ ...  The reason probably is it could possibly take a really long time. Not skipping dot-directories is a good idea worth suggesting as an RFE in the policycoreutils component.  If setroubleshoot is installed and the path is logged, the restorecon plugin will now suggest the restorecon action.  In a perfect world, the change in the yubikey-handling package would be accompanied with a matching change in selinux-policy at the same time so that nobody notices a change.   ```  [Comment 23](show_bug.cgi?id=1860888#c23)  dlippold    2020-09-02 07:38:03 UTC  ``` Zdenek,  if I understand you correctly the SELinux context of the files in "/home/*/.config/" can currently not be fixed (automatically) when the PRM package is installed. But wouldn't it be possible to execute the command "fixfiles onboot" when the PRM package is installed?  When it would not be possible to fix the bug for the users who already use pam-u2f then there would be a bug in the process of installation of RPM packages without doubt.   ```  [Comment 24](show_bug.cgi?id=1860888#c24)  Zdenek Pytela    2020-09-02 09:13:47 UTC  ``` Dietmar,  The fixfiles onboot command leads to relabeling all filesystems. Some systems may then boot reasonably long time as all mounted filesystems are checked; even relabeling just /home can take time, and as this is not expected, we avoid such actions.  For new installations of pam-u2f or for users without ~/.config/Yubico existing, it should work out of the box with the updates selinux-policy package. For others, invoking one of the commands for relabeling is required.   ```  [Comment 25](show_bug.cgi?id=1860888#c25)  dlippold    2020-09-21 10:00:18 UTC  ```  Zdenek,  the problem is that probably most of the user of pam-u2f don't know of this bug and don't know that they have to relabel their directories.  The general problem of the update of SELinux contexts after modifying the SELinux policy is still discussed on [https://lore.kernel.org/selinux/CAEjxPJ5BczUFZ82C4bnioSiFLwqv4uvBaGP1afmAf4+amOraAQ@mail.gmail.com/T/#t](https://lore.kernel.org/selinux/CAEjxPJ5BczUFZ82C4bnioSiFLwqv4uvBaGP1afmAf4%2BamOraAQ%40mail.gmail.com/T/#t) after a discussion on <https://github.com/SELinuxProject/selinux/issues/263> . But that would probably not result in a fix for this concrete bug.  Would it be possible to add the following specific command (or a equivalent one) to the next RPM package of selinux-policy so that this command is executed when the package is installed?    fixfiles /root/.config/Yubico/ /home/*/.config/Yubico/  This command would not need much time for execution.   ```  [Comment 26](show_bug.cgi?id=1860888#c26)  dlippold    2020-09-21 11:53:04 UTC  ``` It would also be sufficient to add the above mentioned command to the RPM package of "pam-u2f".   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1860888&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


