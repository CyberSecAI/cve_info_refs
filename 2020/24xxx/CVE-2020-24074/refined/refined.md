The provided content is a commit diff from a GitHub repository. This commit introduces a size check on the decoded packet data before performing a memory move.

**Root cause of vulnerability:**
The code was vulnerable to an out-of-bounds read and write due to a lack of proper size checks on the decoded packet data. The size of the received packet data was not validated before being used in a `memmove` operation.

**Weaknesses/vulnerabilities present:**
-   **Out-of-bounds read/write**: The `memmove` operation could potentially read and write outside the bounds of the `payload` buffer if `totBytes` was not validated, causing a crash or undefined behavior.

**Impact of exploitation:**
-   A specially crafted input could cause the program to crash, potentially causing a denial-of-service. It might also be possible to overwrite parts of memory, leading to other unspecified consequences.

**Attack vectors:**
-   By providing a modified data stream which leads to the calculation of an invalid `totBytes` value.

**Required attacker capabilities/position:**
-   The attacker needs to be able to provide a malicious data stream to the decoder. This may happen via file or network access.

**Changes in Commit:**
-   The code adds a check on `totBytes` to make sure its value is not negative and that it's within the bounds of the `payload` buffer (`if (totBytes < 0 || totBytes > sizeof(payload))`). If invalid, the function returns -1, preventing the vulnerable `memmove` operation.