=== Content from bugzilla.nasm.us_3d38eab2_20250119_122814.html ===


Bugzilla – Bug 3392707
heap-use-after-free in saa\_wbytes nasmlib/saa.c:132
Last modified: 2020-07-30 17:08:29 PDT

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=3392707&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=3392707&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

Self-registration is disabled due to spam issue (mail gorcunov@gmail.com or hpa@zytor.com to create an account)

[**Bug 3392707**](show_bug.cgi?id=3392707)
- heap-use-after-free in saa\_wbytes nasmlib/saa.c:132

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
heap-use-after-free in saa\_wbytes nasmlib/saa.c:132

| | [Status](page.cgi?id=fields.html#bug_status): | CLOSED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | NASM | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=NASM "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Assembler ([show other bugs](buglist.cgi?component=Assembler&product=NASM&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.15.xx | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | Medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | nobody | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2020-07-28 04:01 PDT by Suhwan | | --- | --- | | Modified: | 2020-07-30 17:08 PDT ([History](show_activity.cgi?id=3392707)) | | CC List: | 5 users (show)  chang.seok.bae gorcunov hpa nasm-bugs prada960808 | |  | | | [Obtained from:](page.cgi?id=fields.html#cf_build "Please indicate where you obtained and/or built your version of NASM.") | Build from source archive using configure | | [Generated by:](page.cgi?id=fields.html#cf_robot "Was this bug report generated by an automatic tool, such as a memory leak detector or fuzzer, *without* including a human validation description or analysis of the problem?") | --- | | [Bug category:](page.cgi?id=fields.html#cf_category "The general category of this bug oor request.") |  | | [Breaks existing code:](page.cgi?id=fields.html#cf_breaks "This bug report breaks existing code in production or under development.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**poc**](attachment.cgi?id=411796 "View the content of the attachment") (301 bytes, text/plain)  [2020-07-28 04:01 PDT](#attach_411796 "Go to the comment associated with the attachment"), Suhwan | [Details](attachment.cgi?id=411796&action=edit) | | [Add an attachment](attachment.cgi?bugid=3392707&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=3392707&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=3392707#c0)  Suhwan    2020-07-28 04:01:17 PDT  ``` Created [attachment 411796](attachment.cgi?id=411796 "poc") [[details]](attachment.cgi?id=411796&action=edit "poc") poc  Hi,  I found a heap-use-after-free in saa_wbytes nasmlib/saa.c:132 It is triggered in nasm version 2.15rc10.  Please run following command `nasm -f win64 -o tmp.o $PoC`   ==32342==ERROR: AddressSanitizer: heap-use-after-free on address 0x6060000098f0 at pc 0x7f61c67b5733 bp 0x7ffeb12d40b0 sp 0x7ffeb12d3858 READ of size 1 at 0x6060000098f0 thread T0     #0 0x7f61c67b5732  (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x79732)     #1 0x55ca40ce4396 in memcpy /usr/include/x86_64-linux-gnu/bits/string_fortified.h:34     #2 0x55ca40ce4396 in saa_wbytes nasmlib/saa.c:132                                                                                                                                                                                      #3 0x55ca40eede30 in coff_sect_write output/outcoff.c:687     #4 0x55ca40eede30 in coff_out output/outcoff.c:615                                                                                                                                                                                     #5 0x55ca40d0dcf2 in out asm/assemble.c:434     #6 0x55ca40d14d03 in out_rawdata asm/assemble.c:462     #7 0x55ca40d14d03 in out_eops asm/assemble.c:663     #8 0x55ca40d4e387 in assemble asm/assemble.c:700     #9 0x55ca40ca7f6f in process_insn asm/nasm.c:1605     #10 0x55ca40ca7f6f in assemble_file asm/nasm.c:1720     #11 0x55ca40c9c056 in main asm/nasm.c:712     #12 0x7f61c636cb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)     #13 0x55ca40c9f129 in _start (/mnt/hda2/suhwan/add_project/final/FINAL_TEST_ZONE/program/nasm-2.15rc10/install_dir/bin/nasm+0x124129)  0x6060000098f0 is located 48 bytes inside of 49-byte region [0x6060000098c0,0x6060000098f1) freed by thread T0 here:     #0 0x7f61c681a7a8 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xde7a8)     #1 0x55ca40d90c69 in parse_eops asm/parser.c:464  previously allocated by thread T0 here:     #0 0x7f61c681af30 in realloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdef30)     #1 0x55ca40ccca50 in nasm_realloc nasmlib/alloc.c:101  SUMMARY: AddressSanitizer: heap-use-after-free (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x79732) Shadow bytes around the buggy address:   0x0c0c7fff92c0: fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa   0x0c0c7fff92d0: 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00   0x0c0c7fff92e0: 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 fa   0x0c0c7fff92f0: fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa   0x0c0c7fff9300: 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 =>0x0c0c7fff9310: 00 00 00 fa fa fa fa fa fd fd fd fd fd fd[fd]fa   0x0c0c7fff9320: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c0c7fff9330: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c0c7fff9340: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c0c7fff9350: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c0c7fff9360: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==32342==ABORTING ```  [Comment 1](show_bug.cgi?id=3392707#c1)  Suhwan    2020-07-28 23:16:47 PDT  ``` This is found by Agency for Defense Development (ADD) in South Korea. ```  [Comment 2](show_bug.cgi?id=3392707#c2)  H. Peter Anvin    2020-07-30 15:49:58 PDT  ``` The original problem fixed in checkin 6ac6ac57e3d01ea8ed4ea47706eb724b59176461, but this PoC triggers another sanitizer violation when using -gcv8, so leave open for now. ```  [Comment 3](show_bug.cgi?id=3392707#c3)  H. Peter Anvin    2020-07-30 17:08:29 PDT  ``` Secondary bug fixed in checkin 78df8828a0a5d8e2d8ff3dced562bf1778ce2e6c. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=3392707)
* - [XML](show_bug.cgi?ctype=xml&id=3392707)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=3392707)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=3392707&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=3392707&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


