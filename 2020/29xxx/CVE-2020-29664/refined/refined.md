```
[
  {
    "CVE_ID": "CVE-2020-29664",
    "content": "=== Content from gist.github.com_4c28b0eb_20250119_123756.html ===\n\n[viktoredstrom](/viktoredstrom)/**[CVE-2020-29664.txt](/viktoredstrom/2f0463ebe7cd786904f229e11386e817)**\n\n    |  | [Suggested description] |\n| --- | --- |\n|  | A command injection issue in |\n|  | dji_sys in DJI Mavic 2 Remote Controller before firmware version 01.00.0510 allows for code execution via a malicious firmware upgrade packet. |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [VulnerabilityType Other] |\n|  | Command injection |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Vendor of Product] |\n|  | DJI |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Affected Product Code Base] |\n|  | DJI Mavic 2 Remote Controller - Firmware versions before 01.00.0510 (01.00.0100, 01.00.0200, 01.00.0300, 01.00.0400) |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Affected Component] |\n|  | Affected executable: dji\_sys |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Attack Type] |\n|  | Local |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Impact Code execution] |\n|  | true |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Attack Vectors] |\n|  | Malicious firmware upgrade packet sent via USB |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Reference] |\n|  | http://hacktheplanet.nu/djihax.pdf |\n|  | http://kth.diva-portal.org/smash/get/diva2:1463784/FULLTEXT01.pdf |\n|  | https://www.dji.com/mavic-2 |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Has vendor confirmed or acknowledged the vulnerability?] |\n|  | true |\n|  |  |\n|  | ------------------------------------------ |\n|  |  |\n|  | [Discoverer] |\n|  | Viktor Edstroem |\n",
    "vulnerability_details": {
      "Root cause of vulnerability": "The `dji_sys` program uses `popen` to execute shell commands for verifying firmware signatures, but it improperly sanitizes the filename parameter, allowing for command injection.",
      "Weaknesses/vulnerabilities present": "Command Injection.",
      "Impact of exploitation": "Arbitrary code execution on the affected device (DJI Mavic 2 Remote Controller).",
      "Attack vectors": "Malicious firmware upgrade packet sent via USB.",
      "Required attacker capabilities/position": "Local access to the device to initiate a firmware upgrade via USB."
    }
  },
  {
    "CVE_ID": "CVE-2020-29664",
    "content": "=== Content from hacktheplanet.nu_02e59f75_20250119_123755.html ===\nCVE-2020-29664 is a security vulnerability discovered during our research,\nresulting in local arbitrary code execution without any hardware modiﬁcations\non the DJI Mavic 2 Remote Controller and Leadcore processor on the DJI\nMavic 2 Zoom drone.\n\nDuring the ﬁrmware upgrade process a signature ﬁle (ﬁle.cfg.sig) and one\nor more ﬁrmware ﬁles (ﬁle.cfg.fw) get uploaded to the device. The signature\nﬁle contains XML-data describing which ﬁrmware ﬁles have been uploaded\nand their corresponding meta-data such as ﬁle size and checksums. The pro-\ngram in charge of processing ﬁrmware upgrades is dji_sys.\n\n    int main() {\n    /* ... */\n\n    snprintf(cmd,0x100,\"busybox find %s\" \\\n\n    \"-name \\\"*.cfg.sig\\\"\",\n    \"/data/upgrade/backup/\");\n\n    FILE *f = popen(cmd,\"r\");\n    if (f)\n\n    fgets(cfg_name, 0x100, f);\n\n    /* ... */\n\n    int verify_ret = dji_verify_sig(\\\n\n    cfg_name,\"/tmp/wm330_0000.xml\",&DAT_0005c8a5);\n\n    /* ... */\n}\n\nFigure 1: Psuedocode of how signatures gets after upload.\n\nBefore the upgrade is performed, the signature and ﬁrmware ﬁles are ver-\niﬁed to make sure that the data which was just uploaded came from DJI. The\nprogram branches out to the program dji_verify via the C programming lan-\nguage function popen. The program dji_verify veriﬁes the ﬁle’s signature to\nconﬁrm the ﬁle sent is signed by DJI.\n\nint dji_verify_sig(char *cfg_name,\\\\\n\nchar *param_2, char *param_3) {\n\n    /* ... */\n    snprintf(cmd,0x100, \\\n\n    \"dji_verify -n %s -o %s '%s'\", \\\n    param_3,param_2,cfg_name);\n\n    FILE *f = popen(cmd,\"r\");\n    if (f)\n\n    fgets(cmd_output,0x100,f);\n\n    /* ... */\n\n}\n\nFigure 2: Psuedocode of how signatures gets veriﬁed.\n\nThe ﬁrst parameter to this function is the ﬁlename of the signature ﬁle or\nﬁrmware ﬁle that will be veriﬁed. This string gets used by the call to snprintf,\nwhich builds a shell-command executing dji_verify with a set of parameters,\nwhere the last parameter is the provided ﬁlename surrounded by apostrophes.\nThis is done to prevent the ﬁlename from being interpreted as a valid shell-\ncommand syntax, which could allow an attacker to execute arbitrary shell-\ncommands (command injection vulnerability).\n\nThe\npopen() function opens a process by creating a pipe, forking,\nand invoking the shell. Since a pipe is by definition unidirectional,\nthe type argument may specify only reading or writing, not both.\nThe resulting stream is correspondingly read-only or write-only.\n\nThe argument is a pointer to a null-terminated string\ncommand containing a shell command line.\nThis command is passed to /bin/sh using the -c flag.\nInterpretation, if any, is performed by the shell.\n\nFigure 3: Manual page for the function popen\n\nThe method in which the ﬁlename argument is sanitised (via apostrophes)\nis ﬂawed. By supplying a ﬁlename containing two apostrophes, it is possible\nto escape the previous apostrophes and execute arbitrary commands. We have\nveriﬁed this vulnerability and written a proof-of-concept capable of interacting\nwith the device via a shell.\n\ndef hack_device(command):\n\n    \"wm240_rcAA'`\"\n    evil_name =\n    evil_name += command\n    evil_name += \"`'.cfg.sig\"\n    send_firmware_file(evil_name)\n\nFigure 4: Psuedo code for how to execute arbitrary commands\n",
    "vulnerability_details": {
      "Root cause of vulnerability": "The `dji_verify_sig` function in the `dji_sys` program uses `popen` to execute shell commands, and it attempts to sanitize the filename by enclosing it in single quotes. However, this sanitization is flawed because a filename with embedded single quotes can be used to escape the intended quoting and inject shell commands.",
      "Weaknesses/vulnerabilities present": "Command Injection vulnerability.",
      "Impact of exploitation": "Arbitrary code execution on the DJI Mavic 2 Remote Controller.",
      "Attack vectors": "A malicious firmware upgrade packet with a crafted filename is sent to the device via USB.",
      "Required attacker capabilities/position": "The attacker needs physical access to the DJI Mavic 2 Remote Controller and the ability to initiate a firmware upgrade process via USB."
    }
  },
  {
    "CVE_ID": "CVE-2020-29664",
    "content": "=== Content from kth.diva-portal.org_8c7a25dd_20250119_123756.html ===\nReverse engineering the ﬁrmware upgrade process revealed that both re-\nspective systems and chips utilize ARMs TEE – Trusted Execution Environ-\nment, TrustZone.\n\nThe implementation of Trust-Zone DJI uses in the Mavic 2 Zoom is OP-\nTEE – Open Portable Trusted Execution Environment, initially developed by\nST-Ericsson and later on open-sourced. We found out that one use-case of\nOP-TEE in the DJI system is ﬁrmware upgrades. Firmware ﬁles are validated,\ndecrypted, and ﬂashed from the TEE.\n\n    int dji_fw_load(const char *a1, int a2, int a3) {\n\n    /* ... */\n    v6 = TEEC_InitializeContext(0, v30);\n    if ( !v6 )\n    {\n\n    v8 = TEEC_OpenSession(v30, &v20, &v26, 0, 0, 0, &v21);\n    if ( v8 )\n    {\n\n    printf(\"TEEC_Opensession failed with code 0x%x origin 0x%x\",\n\n    v8, v21);\n\n    TEEC_FinalizeContext(v30);\n    return v8;\n\n    }\n\n    /* ... */\n\n    }\n\nFigure 4.1: DJI ﬁrmware function utilizing TEE\n\nDuring our research, a previously undiscovered vulnerability was discov-\nered aﬀecting the DJI Mavic 2 Zoom. This vulnerability has been sent to DJI’s\nSecurity Response Center and is being resolved.\n",
    "vulnerability_details": {
      "Root cause of vulnerability": "The provided content does not specify the root cause of the vulnerability.",
      "Weaknesses/vulnerabilities present": "The provided content only mentions a vulnerability was discovered and reported but does not elaborate on the type of vulnerability.",
      "Impact of exploitation": "The provided content only mentions that it is a previously undiscovered vulnerability. The impact is not specified.",
      "Attack vectors": "The provided content does not specify the attack vector.",
        "Required attacker capabilities/position": "The provided content does not specify attacker capabilities or required position"
    }
  }
]
```