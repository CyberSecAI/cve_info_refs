=== Content from i.blackhat.com_133010ef_20250119_121348.html ===
2020

Finding Backdoors
in
Applications

Presented by Loke Hui Yi & Max Chee

GovTech Singapore

#BHASIA  @BLACKHATEVENTS

OUTLINE

• About Us
• What We Do

• Our Modus Operandi

• Developer Backdoors – Windows Application

• Developer Backdoors – iOS Application
• Questions?

ABOUT US

ABOUT US

• Government Technology Agency of Singapore

(GovTech) is the Government Sector Lead driving
technology innovation within the Singapore
government

• Implementor of Singapore’s Smart Nation vision

• The Cyber Security Group in GovTech is the Cyber

Sector Lead for the Singapore Government,
looking into public sector resilience and ecosystem
defence

ABOUT US – COMMUNITY
CONTRIBUTIONS

ABOUT US – COMMUNITY
CONTRIBUTIONS

https://github.com/spaceraccoon/manuka

WHAT WE DO

Mobile / IoT /
Web / Social
Engineering
PT

Infrastructure
Vulnerability
Assessments

Source Code
Review

Source

Code

Review

Product
Security
Assessment

Adversary
Simulations

What We Do

Bug Bounties

7

• No fixed methodology as the applications we assess can vary widely

OUR MODUS OPERANDI

Interesting
strings in the
program

Light fuzzing

Inline functions

Code coverage

OUR MODUS OPERANDI -
IN ACTION

Example of using fuzzing on another product: Generate all permutations of
HTML tags and all possible attributes

• The target software should cleanse all JavaScript from the input source

Original

Cleaned

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

Initial Goal
• We audit the software and environments used by government agencies to ensure that they

are secure

Application Environment
• Application is a database driven COTs product requiring users to log in

• Regular users use the application’s GUI to do work. A regular user cannot do admin
operations such as changing other users’ passwords nor seeing their login sessions.

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

Look for interesting strings in the program via IDA

• This string was not encountered in normal operation, and seemed to suggest a potential

elevation of permissions

• We traced the function calls that used this string and found that it was being called when

the program was starting up

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

Look at the startup flow for anything interesting

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

• Turns out that the function using our

interesting string checking if certain keys were
pressed in order to determine if it should
appear

• Pressing the right combination of keys on
application startup presented us with this
dialog

• Paydirt!

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

• But what about the password?

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

What we knew
• The password is not hardcoded

• Probably not stored in the database as the prompt appears before the user signs in

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

After some digging…
• The application loads a function

(generateSuperSecretPassword) in
another DLL to generate the password
on the fly, passing in a hardcoded seed
value

• It then calls another function

(callChkPassWord) in the same DLL to
prompt and compare the passwords

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

• Recipe for super secret
password generation

• Ingredients:

• Seed value
• Today’s date time object

• Method:

• /, %, <<, >>, ^, &
• Mix well and prepare to

serve

• Return: 6 char string that

changes every week

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

• Since the password didn't change that often, we pulled it out from RCX

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

• We are greeted with a console

once we’ve entered the password

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

• Hey! We can run stored DB

procedures!

• Here’s a list of login sessions for
users, something a normal user
should not have access to

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

Impact

• On elevating a user by entering the password, the user can run database queries (stored procedures
or raw SQL) to do activities such as changing passwords of other users, checking log in sessions and
potentially viewing other sensitive data

Why

• The developers put it in to ease their remote maintenance operations

Mitigation?

• The password changes every week. However the seed was the same, so anyone with an installation

of the program could generate the same password to be used on other machines

DEVELOPER BACKDOORS –
WINDOWS APPLICATION

Challenges
• Restrictive testing environment
• Short testing time
• Communication with the developers

Tools Used
•
• WinDBG

IDA

Key Takeaway
• The application was not built with security in mind, hence it was easy to RE and figure out their secret password
• Applications should enforce security by design instead, especially those dealing with sensitive data, and not merely

assume their environment to be secure

PLACEHOLDER

• Handover to Max

• Transition slide, to be edited out

DEVELOPER BACKDOORS – IOS
APPLICATION

Initial Goal
• To demonstrate the impact of local

authentication bypass

Why?
• Password managers hold tasty loot!!!

• Local authentication for master passwords to

unlock

• Verification checks for master password can be

as simple as true/false

DEVELOPER BACKDOORS – IOS
APPLICATION

Assembly Code for Password Comparison

I MEAN… JUST LOOK AT
THIS???

• Verification of master password is
done by just comparing if string is
equal.

• Input password is not used to

decrypt the vault

DEVELOPER BACKDOORS – IOS
APPLICATION

• So… should you entrust your passwords to random free password managers found online?

• As a learning experience, we selected “Lock Password Manager” to conduct our tests. It can

be downloaded from the AppStore, averaging 4 of 5 stars with over 500 ratings.

DEVELOPER BACKDOORS – IOS
APPLICATION

• Set a master password for Password Manager

• Didn’t set password hint. Who needs one?

DEVELOPER BACKDOORS – IOS
APPLICATION

• Password manager ask to backup master

password

• Complains forgotten master password will lead

to “no way of accessing the app”

• “There are no recovery passcode”

DEVELOPER BACKDOORS – IOS
APPLICATION

• Hooking framework “THEOS” used to
observe application flow for password
entry

Explanation for Theos Logos

%hook – Opens a hook block for the specified class
%log  - Prints the method arguments in system log
%orig - Calls the original hooked method
%end - Close the hook block

Tweak to observe application behaviour

%hook NBAppDelegate
- (unsigned char)isUseSecureClearData { %log; unsigned char r = %orig; HBLogDebug(@"isUseSecureClearData return value: = %hhu", r); return r; }
- (unsigned char)PAPasscodeViewControllerDidEnterPasscode:(id)arg1 enterPasscode:(id)arg2 { %log; unsigned char r = %orig;
HBLogDebug(@"PAPasscodeViewControllerDidEnterPasscode return value: = %hhu", r); return r; }
- (void)PAPasscodeViewControllerDidEnterPasscode:(id)arg1 { %log; %orig; }
- (void)PAPasscodeViewController:(id)arg1 didFailToEnterPasscode:(long long)arg2 { %log; %orig; }
- (void)IsSuccessLogin:(unsigned char)arg1 { %log; %orig; }
- (long long)genErrorLoginTimes { %log; long long r = %orig; HBLogDebug(@" = %lld", r); return r; }
- (void)setDateFlag { %log; %orig; }
%end

DEVELOPER BACKDOORS – IOS
APPLICATION

Observe application flow for right/wrong password entry

Application logic/call stack for right password entry

[<NBAppDelegate: 0x2813e1a80> PAPasscodeViewControllerDidEnterPasscode:<PAPasscodeViewController: 0x10284a000> enterPasscode:123456]
[<NBAppDelegate: 0x2813e1a80> setDateFlag]
[<NBAppDelegate: 0x2813e1a80> isUseSecureClearData]
[isUseSecureClearData return value: = 0]
[<NBAppDelegate: 0x2813e1a80> IsSuccessLogin:1]
[<NBAppDelegate: 0x2813e1a80> notificationLoadAds]
[PasscodeViewController return value: = 1]

Application logic/call stack for wrong password entry

[<NBAppDelegate: 0x2812eefc0> PAPasscodeViewControllerDidEnterPasscode:<PAPasscodeViewController: 0x106148a00> enterPasscode:112233]
[PasscodeViewController return value: = 0]
[<NBAppDelegate: 0x2812eefc0> PAPasscodeViewController:<PAPasscodeViewController: 0x106148a00> didFailToEnterPasscode:2]
[<NBAppDelegate: 0x2812eefc0> IsSuccessLogin:0]
[<NBAppDelegate: 0x2812eefc0> isUseSecureClearData]
[isUseSecureClearData return value: = 0]

DEVELOPER BACKDOORS – IOS
APPLICATION

Observe application flow for right/wrong password entry

Application logic/call stack for right password entry

[<NBAppDelegate: 0x2813e1a80> PAPasscodeViewControllerDidEnterPasscode:<PAPasscodeViewController: 0x10284a000> enterPasscode:123456]
[<NBAppDelegate: 0x2813e1a80> setDateFlag]
[<NBAppDelegate: 0x2813e1a80> isUseSecureClearData]
[isUseSecureClearData return value: = 0]
[<NBAppDelegate: 0x2813e1a80> IsSuccessLogin:1]
[<NBAppDelegate: 0x2813e1a80> notificationLoadAds]
[PasscodeViewController return value: = 1]

Application logic/call stack for wrong password entry

[<NBAppDelegate: 0x2812eefc0> PAPasscodeViewControllerDidEnterPasscode:<PAPasscodeViewController: 0x106148a00> enterPasscode:112233]
[PasscodeViewController return value: = 0]
[<NBAppDelegate: 0x2812eefc0> PAPasscodeViewController:<PAPasscodeViewController: 0x106148a00> didFailToEnterPasscode:2]
[<NBAppDelegate: 0x2812eefc0> IsSuccessLogin:0]
[<NBAppDelegate: 0x2812eefc0> isUseSecureClearData]
[isUseSecureClearData return value: = 0]

DEVELOPER BACKDOORS – IOS
APPLICATION

• Compare the input password against the master password set

• Returns true (value 1), else return false (value 0)

DEVELOPER BACKDOORS – IOS
APPLICATION

• On right password entry,

• Calls [NBAppDelegate setDateFlag]
• Calls [NBAppDelegate isSuccessLogin] passing 1 as argument

Assembly Code for Correct Password

DEVELOPER BACKDOORS – IOS
APPLICATION

So far so good…
• When the right master password is entered, IsSuccessLogin will be set to true, allowing the

application to display saved passwords

• In the same vein, if the wrong master password is entered, the application should just

prompt an error

• However…

DEVELOPER BACKDOORS – IOS
APPLICATION

• On wrong password entry,

• Checks if user input password was equal to *#06#*

Assembly Code for Wrong Password

DEVELOPER BACKDOORS – IOS
APPLICATION

• Secret backdoor in password manager

• User input of *#06#* will write false to key-pair kpasswordon
• Removes the need for master password to unlock

DEVELOPER BACKDOORS – IOS
APPLICATION

• Tracing through important key-pair value in the NSUserDefaults,

• kpasswordon determines if master password is needed to access app
• kloginpassword stores the originally set master password
• Both are located in group.com.estill.passwordmgr.plist

DEVELOPER BACKDOORS – IOS
APPLICATION

• Extracted group.com.estill.passwordmgr.plist from iphone

• Found unencrypted master password in plist!!!

DEVELOPER BACKDOORS – IOS
APPLICATION

• So much for telling users to backup their master

password

DEVELOPER BACKDOORS – IOS
APPLICATION

• Total of 4 apps were found, 3 free and 1 paid

version

• Total of 3 password managers created by this

developer

DEVELOPER BACKDOORS – IOS
APPLICATION

• Tried the other app (Password Manager Finger Print

Lock for iPhone Safe)

• Same interface as the original app

• Has the same backdoor *#06#*

• High chance that paid password manager “Password
Manager Pro Keep passcode.s safe & lock private
account.s” also have the same backdoor!!!

DEVELOPER BACKDOORS – IOS
APPLICATION

Impact
• Someone with physical access to your phone could use the backdoor and get all your

sweet, sweet passwords

Why
• Who knows? Backdoor recovery code?

Mitigation?
• Reported to developer multiple times since 2 Jan 2020. Since there was no reply from

developer, I also tried to reach out to Apple.To date, the vulnerable app is still available on
the AppStore.

INGOTS OF HARD WORK
FOLLOW OUR DEVELOPMENT!

GovTech CSG Medium Page
https://medium.com/csg-govtech

SNEAK PREVIEW!

CAPTURE THE FLAG (CTF)
COMPETITION

• GovTech CSG will be organizing our first

inaugural CTF competition!
o Why? We want to create something fun for

the community!

• There will be a range of attractive prizes
to be won, not just for the top teams!

•

It will be a co-event with Stack 2020
o By the way, Stack 2020 is a free virtual

event this year!

• More details will be released by us soon!

QUESTIONS?

Feel free to reach us at

angelystor & max-chee

@angelystor


