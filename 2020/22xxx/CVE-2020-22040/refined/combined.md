=== Content from trac.ffmpeg.org_218ae9b0_20250119_115441.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8282 "Ticket #8282")
* [Next Ticket](/ticket/8284 "Ticket #8284") →

---

Opened [5 years ago](/timeline?from=2019-10-16T13%3A41%3A33Z&precision=second "See timeline at Oct 16, 2019, 1:41:33 PM")

Closed [5 years ago](/timeline?from=2019-10-16T14%3A31%3A18Z&precision=second "See timeline at Oct 16, 2019, 2:31:18 PM")

## [#8283](/ticket/8283) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# memory leaks are detected in av\_frame\_alloc

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [important](/query?priority=important&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: |  |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

memory leaks are detected

How to reproduce:

```
% ffmpeg_g -y -i $PoC -filter_complex reverse -target vcd -loglevel 0 -map 0 -vframes 94 -aframes 45 -r 32 -ab 991k -ar 48000 -ac 29 -b:v 711k -strict 0 tmp.g726

ffmpeg version N-95389-gdd01947397 Copyright (c) 2000-2019 the FFmpeg developers
built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug

```

Here's Valgrind log

```
==15573== HEAP SUMMARY:
==15573==     in use at exit: 14,638 bytes in 20 blocks
==15573==   total heap usage: 2,581 allocs, 2,561 frees, 1,418,329 bytes allocated
==15573==
==15573== 14,606 (536 direct, 14,070 indirect) bytes in 1 blocks are definitely lost in loss record 16 of 16
==15573==    at 0x9D3CE76: memalign (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==15573==    by 0x9D3CF91: posix_memalign (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==15573==    by 0x590EC79: av_malloc (mem.c:87)
==15573==    by 0x590EC79: av_mallocz (mem.c:238)
==15573==    by 0x58E2E0D: av_frame_alloc (frame.c:191)
==15573==    by 0x5F4120: av_buffersrc_add_frame_internal (buffersrc.c:237)
==15573==    by 0x5F2E2D: av_buffersrc_add_frame_flags (buffersrc.c:170)
==15573==    by 0x4CAD0F: ifilter_send_frame (ffmpeg.c:2186)
==15573==    by 0x4CAD0F: send_frame_to_filters (ffmpeg.c:2260)
==15573==    by 0x4A076B: decode_video (ffmpeg.c:2459)
==15573==    by 0x4A076B: process_input_packet (ffmpeg.c:2613)
==15573==    by 0x4B9FE7: process_input (ffmpeg.c:4303)
==15573==    by 0x48D59A: transcode_step (ffmpeg.c:4628)
==15573==    by 0x48D59A: transcode (ffmpeg.c:4682)
==15573==    by 0x487D53: main (ffmpeg.c:4884)
==15573==
==15573== LEAK SUMMARY:
==15573==    definitely lost: 536 bytes in 1 blocks
==15573==    indirectly lost: 14,070 bytes in 18 blocks
==15573==      possibly lost: 0 bytes in 0 blocks
==15573==    still reachable: 32 bytes in 1 blocks
==15573==         suppressed: 0 bytes in 0 blocks
==15573== Reachable blocks (those to which a pointer was found) are not shown.
==15573== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==15573==
==15573== For counts of detected and suppressed errors, rerun with: -v
==15573== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

```

Please confirm.

Thanks

### Attachments (1)

[PoC\_memory\_leaks\_8283.png24](/attachment/ticket/8283/PoC_memory_leaks_8283.png24 "View attachment")[​](/raw-attachment/ticket/8283/PoC_memory_leaks_8283.png24 "Download")
(665 bytes
) - added by Suhwan [5 years ago](/timeline?from=2019-10-16T13%3A41%3A59Z&precision=second "See timeline at Oct 16, 2019, 1:41:59 PM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8283/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (3)

### by Suhwan, [5 years ago](/timeline?from=2019-10-16T13%3A41%3A59Z&precision=second "See timeline at Oct 16, 2019, 1:41:59 PM")

| Attachment: | [*PoC\_memory\_leaks\_8283.png24*](/attachment/ticket/8283/PoC_memory_leaks_8283.png24)[​](/raw-attachment/ticket/8283/PoC_memory_leaks_8283.png24 "Download") added |
| --- | --- |

poc

### [comment:1](#comment:1) by Suhwan, [5 years ago](/timeline?from=2019-10-16T13%3A47%3A02Z&precision=second "See timeline at Oct 16, 2019, 1:47:02 PM")

| Summary: | memory leaks are detected → memory leaks are detected in av\_frame\_alloc |
| --- | --- |

### [comment:2](#comment:2) by Elon Musk, [5 years ago](/timeline?from=2019-10-16T14%3A31%3A18Z&precision=second "See timeline at Oct 16, 2019, 2:31:18 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8283?format=rss)
* [Comma-delimited Text](/ticket/8283?format=csv)
* [Tab-delimited Text](/ticket/8283?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


