=== Content from trac.ffmpeg.org_b7280fb4_20250119_115242.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8301 "Ticket #8301")
* [Next Ticket](/ticket/8303 "Ticket #8303") →

---

Opened [5 years ago](/timeline?from=2019-10-18T04%3A29%3A41Z&precision=second "See timeline at Oct 18, 2019, 4:29:41 AM")

Closed [5 years ago](/timeline?from=2019-10-21T20%3A39%3A12Z&precision=second "See timeline at Oct 21, 2019, 8:39:12 PM")

Last modified [5 years ago](/timeline?from=2019-10-26T16%3A14%3A08Z&precision=second "See timeline at Oct 26, 2019, 4:14:08 PM")

## [#8302](/ticket/8302) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# memory leaks in avi\_add\_ientry()

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [avformat](/query?component=avformat&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [avi](/query?keywords=~avi&status=!closed) [leak](/query?keywords=~leak&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

There are memory leaks in avi\_add\_ientry()

How to reproduce:

```
% ffmpeg_g -y -i $PoC -filter_complex buffersink -c copy tmp.avi

ffmpeg version N-95441-g0ae6fb276b Copyright (c) 2000-2019 the FFmpeg developers
built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug

```

Here's Valgrind log

```
==16010== HEAP SUMMARY:
==16010==     in use at exit: 262,184 bytes in 3 blocks
==16010==   total heap usage: 252 allocs, 249 frees, 2,009,670 bytes allocated
==16010==
==16010== 262,152 (8 direct, 262,144 indirect) bytes in 1 blocks are definitely lost in loss record 3 of 3
==16010==    at 0x9FE0A3F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==16010==    by 0x9FE2D84: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==16010==    by 0x592E631: av_realloc (mem.c:144)
==16010==    by 0x592E631: av_realloc_f (mem.c:157)
==16010==    by 0x146737C: avi_add_ientry (avienc.c:117)
==16010==    by 0x1466ABB: avi_write_packet_internal (avienc.c:893)
==16010==    by 0x146226F: avi_write_packet (avienc.c:853)
==16010==    by 0x17E6344: write_packet (mux.c:747)
==16010==    by 0x17ECD05: av_interleaved_write_frame (mux.c:1238)
==16010==    by 0x4B5DEA: write_packet (ffmpeg.c:815)
==16010==    by 0x4A3F70: do_streamcopy (ffmpeg.c:0)
==16010==    by 0x4A3F70: process_input_packet (ffmpeg.c:2736)
==16010==    by 0x4BF0EF: process_input (ffmpeg.c:4508)
==16010==    by 0x48D5EA: transcode_step (ffmpeg.c:4628)
==16010==    by 0x48D5EA: transcode (ffmpeg.c:4682)
==16010==
==16010== LEAK SUMMARY:
==16010==    definitely lost: 8 bytes in 1 blocks
==16010==    indirectly lost: 262,144 bytes in 1 blocks
==16010==      possibly lost: 0 bytes in 0 blocks
==16010==    still reachable: 32 bytes in 1 blocks
==16010==         suppressed: 0 bytes in 0 blocks
==16010== Reachable blocks (those to which a pointer was found) are not shown.
==16010== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==16010==
==16010== For counts of detected and suppressed errors, rerun with: -v
==16010== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

```

Please confirm.

Thanks

### Attachments (1)

[PoC\_avi\_add.pct](/attachment/ticket/8302/PoC_avi_add.pct "View attachment")[​](/raw-attachment/ticket/8302/PoC_avi_add.pct "Download")
(675.8 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-10-18T04%3A29%3A52Z&precision=second "See timeline at Oct 18, 2019, 4:29:52 AM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8302/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (3)

### by Suhwan, [5 years ago](/timeline?from=2019-10-18T04%3A29%3A52Z&precision=second "See timeline at Oct 18, 2019, 4:29:52 AM")

| Attachment: | [*PoC\_avi\_add.pct*](/attachment/ticket/8302/PoC_avi_add.pct)[​](/raw-attachment/ticket/8302/PoC_avi_add.pct "Download") added |
| --- | --- |

poc

### [comment:1](#comment:1) by James, [5 years ago](/timeline?from=2019-10-21T20%3A39%3A12Z&precision=second "See timeline at Oct 21, 2019, 8:39:12 PM")

| Component: | undetermined → avformat |
| --- | --- |
| Resolution: | → fixed |
| Status: | new → closed |

Fixed in [a581bb66ea5eb981e2e498ca301df7d1ef15a6a3](/changeset/a581bb66ea5eb981e2e498ca301df7d1ef15a6a3/ffmpeg "avformat/avienc: add deinit function

Fixes ticket #8302

Reviewed-by: ...")

### [comment:2](#comment:2) by Carl Eugen Hoyos, [5 years ago](/timeline?from=2019-10-26T16%3A14%3A08Z&precision=second "See timeline at Oct 26, 2019, 4:14:08 PM")

| Keywords: | avi leak added |
| --- | --- |
| Priority: | important → normal |

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8302?format=rss)
* [Comma-delimited Text](/ticket/8302?format=csv)
* [Tab-delimited Text](/ticket/8302?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


