=== Content from trac.ffmpeg.org_9a252feb_20250119_114701.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8312 "Ticket #8312")
* [Next Ticket](/ticket/8314 "Ticket #8314") →

---

Opened [5 years ago](/timeline?from=2019-10-19T16%3A36%3A18Z&precision=second "See timeline at Oct 19, 2019, 4:36:18 PM")

Closed [5 years ago](/timeline?from=2019-10-20T16%3A09%3A57Z&precision=second "See timeline at Oct 20, 2019, 4:09:57 PM")

## [#8313](/ticket/8313) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# memory leaks in filter\_frame()

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [important](/query?priority=important&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: |  |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

There are memory leaks in filter\_frame()

How to reproduce:

```
% ffmpeg_g -y -i $PoC -filter_complex tile -target dvd -loglevel 0 -vbsf mpeg4_unpack_bframes tmp.ass

ffmpeg version N-95464-g7056ddc0e0 Copyright (c) 2000-2019 the FFmpeg developers
built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug

```

Here's Valgrind log

```
==47004== HEAP SUMMARY:
==47004==     in use at exit: 323,351 bytes in 7 blocks
==47004==   total heap usage: 2,604 allocs, 2,597 frees, 2,239,057 bytes allocated
==47004==
==47004== 323,319 (536 direct, 322,783 indirect) bytes in 1 blocks are definitely lost in loss record 7 of 7
==47004==    at 0x9FE3E76: memalign (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==47004==    by 0x9FE3F91: posix_memalign (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==47004==    by 0x592F079: av_malloc (mem.c:87)
==47004==    by 0x592F079: av_mallocz (mem.c:238)
==47004==    by 0x590320D: av_frame_alloc (frame.c:191)
==47004==    by 0x64FD65: ff_frame_pool_get (framepool.c:201)
==47004==    by 0xFB8D7C: ff_default_get_video_buffer (video.c:90)
==47004==    by 0xD892DB: filter_frame (vf_tile.c:203)
==47004==    by 0x5D002C: ff_filter_frame_framed (avfilter.c:1084)
==47004==    by 0x5D002C: ff_filter_frame_to_filter (avfilter.c:1232)
==47004==    by 0x5D002C: ff_filter_activate_default (avfilter.c:1281)
==47004==    by 0x5D002C: ff_filter_activate (avfilter.c:1443)
==47004==    by 0x5F4434: push_frame (buffersrc.c:187)
==47004==    by 0x5F4434: av_buffersrc_add_frame_internal (buffersrc.c:261)
==47004==    by 0x5F300D: av_buffersrc_add_frame_flags (buffersrc.c:170)
==47004==    by 0x4CAD7F: ifilter_send_frame (ffmpeg.c:2186)
==47004==    by 0x4CAD7F: send_frame_to_filters (ffmpeg.c:2260)
==47004==    by 0x4A07DB: decode_video (ffmpeg.c:2459)
==47004==    by 0x4A07DB: process_input_packet (ffmpeg.c:2613)
==47004==
==47004== LEAK SUMMARY:
==47004==    definitely lost: 536 bytes in 1 blocks
==47004==    indirectly lost: 322,783 bytes in 5 blocks
==47004==      possibly lost: 0 bytes in 0 blocks
==47004==    still reachable: 32 bytes in 1 blocks
==47004==         suppressed: 0 bytes in 0 blocks
==47004== Reachable blocks (those to which a pointer was found) are not shown.
==47004== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==47004==
==47004== For counts of detected and suppressed errors, rerun with: -v
==47004== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

```

Please confirm.

Thanks

### Attachments (1)

[PoC.bmp](/attachment/ticket/8313/PoC.bmp "View attachment")[​](/raw-attachment/ticket/8313/PoC.bmp "Download")
(9.7 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-10-19T16%3A36%3A29Z&precision=second "See timeline at Oct 19, 2019, 4:36:29 PM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8313/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (2)

### by Suhwan, [5 years ago](/timeline?from=2019-10-19T16%3A36%3A29Z&precision=second "See timeline at Oct 19, 2019, 4:36:29 PM")

| Attachment: | [*PoC.bmp*](/attachment/ticket/8313/PoC.bmp)[​](/raw-attachment/ticket/8313/PoC.bmp "Download") added |
| --- | --- |

poc

### [comment:1](#comment:1) by Elon Musk, [5 years ago](/timeline?from=2019-10-20T16%3A09%3A57Z&precision=second "See timeline at Oct 20, 2019, 4:09:57 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

Fixed in [673fce6d40d9a594fb7a0ea17d296b7d3d9ea856](/changeset/673fce6d40d9a594fb7a0ea17d296b7d3d9ea856/ffmpeg "avfilter/vf_tile: fix memory leak

Fixes #8313")

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8313?format=rss)
* [Comma-delimited Text](/ticket/8313?format=csv)
* [Tab-delimited Text](/ticket/8313?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


