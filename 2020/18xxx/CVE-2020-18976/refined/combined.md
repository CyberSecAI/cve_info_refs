=== Content from github.com_703aa0f6_20250119_122541.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fappneta%2Ftcpreplay%2Fissues%2F556)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fappneta%2Ftcpreplay%2Fissues%2F556)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=appneta%2Ftcpreplay)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[appneta](/appneta)
/
**[tcpreplay](/appneta/tcpreplay)**
Public

* [Notifications](/login?return_to=%2Fappneta%2Ftcpreplay) You must be signed in to change notification settings
* [Fork
  274](/login?return_to=%2Fappneta%2Ftcpreplay)
* [Star
   1.2k](/login?return_to=%2Fappneta%2Ftcpreplay)

* [Code](/appneta/tcpreplay)
* [Issues
  39](/appneta/tcpreplay/issues)
* [Pull requests
  6](/appneta/tcpreplay/pulls)
* [Discussions](/appneta/tcpreplay/discussions)
* [Actions](/appneta/tcpreplay/actions)
* [Projects
  1](/appneta/tcpreplay/projects)
* [Wiki](/appneta/tcpreplay/wiki)
* [Security](/appneta/tcpreplay/security)
* [Insights](/appneta/tcpreplay/pulse)

Additional navigation options

* [Code](/appneta/tcpreplay)
* [Issues](/appneta/tcpreplay/issues)
* [Pull requests](/appneta/tcpreplay/pulls)
* [Discussions](/appneta/tcpreplay/discussions)
* [Actions](/appneta/tcpreplay/actions)
* [Projects](/appneta/tcpreplay/projects)
* [Wiki](/appneta/tcpreplay/wiki)
* [Security](/appneta/tcpreplay/security)
* [Insights](/appneta/tcpreplay/pulse)

# A Buffer Overflow Write Bug at Checksum.c:88Â #556

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[A Buffer Overflow Write Bug at Checksum.c:88](#top)#556Copy linkLabels[bug](https://github.com/appneta/tcpreplay/issues?q=state%3Aopen%20label%3A%22bug%22)![@lvtao-sec](https://avatars.githubusercontent.com/u/32359169?u=4c4cf53eaebf121cfcabac94f13c7ee0f453bf95&v=4&size=80)
## Description

![@lvtao-sec](https://avatars.githubusercontent.com/u/32359169?u=4c4cf53eaebf121cfcabac94f13c7ee0f453bf95&v=4&size=48)[lvtao-sec](https://github.com/lvtao-sec)opened [on May 7, 2019](https://github.com/appneta/tcpreplay/issues/556#issue-441202888)

**Describe the bug**

There is a buffer overflow write at `checksum.c:88`, download at lastest commit [a00fd47](https://github.com/appneta/tcpreplay/commit/a00fd4760d2289d854b6f6505902bb4264daff9c).

Code near checksum.c:88 is showed below.

The code didn't check whether the data is long enough comparing IP and TCP packet length. When running the poc, the data len is even less than IP header. So a buffer overflow write will reported when writing to TCP header.

```
 37 do_checksum(tcpedit_t *tcpedit, uint8_t *data, int proto, int len) {
 ...
 ip_hl = //assign value to ip_hl
 ...
 80    switch (proto) {
 81
 82         case IPPROTO_TCP:
 83             tcp = (tcp_hdr_t *)(data + ip_hl);  //note: A check patch should be here
 84 #ifdef STUPID_SOLARIS_CHECKSUM_BUG
 85             tcp->th_sum = tcp->th_off << 2;
 86             return (TCPEDIT_OK);
 87 #endif
 88             tcp->th_sum = 0; //Buffer overlow write occurs here.
```

**To Reproduce**

Steps to reproduce the behavior:

1. download the code from commit [a00fd47](https://github.com/appneta/tcpreplay/commit/a00fd4760d2289d854b6f6505902bb4264daff9c) (master head now).
2. download [poc](https://github.com/lvtao-sec/Pocs/raw/master/id-4-buffer-overflow-checksum.c-88)
3. Compile program with `CFLAGS="-g -O0 -fsanitize=address"`
4. Execute `tcpreplay-edit -r 80:84 -s 20 -b -C -m 1500 -P --oneatatime -i eth0 $poc`

**Expected behavior**

A buffer overflow write will be reported by ASAN, which is showed at below screen shots part.

**Screenshots**

```
$ gdb -q -arg tcpreplay-edit -r 80:84 -s 20 -b -C -m 1500 -P --oneatatime -i eth0 ./poc
Reading symbols from /home/lt/vuln-fuzz/program/tcpreplay/asan-install/bin/tcpreplay-edit...done.
(gdb) b checksum.c:83
Breakpoint 1 at 0x427dee: file checksum.c, line 83.
(gdb) r
Starting program: /home/lt/vuln-fuzz/program/tcpreplay/asan-install/bin/tcpreplay-edit -r 80:84 -s 20 -b -C -m 1500 -P --oneatatime -i eth0 crashes/id:000004,sig:06,src:000068+000292,op:splice,rep:2
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
PID: 65942
Warning: crashes/id:000004,sig:06,src:000068+000292,op:splice,rep:2 was captured using a snaplen of 64 bytes.  This may mean you have truncated packets.

Breakpoint 1, do_checksum (tcpedit=0x61d00001e080, data=0x60600000ec0e "[", proto=6, len=4) at checksum.c:83
83                  tcp = (tcp_hdr_t *)(data + ip_hl);
(gdb) p len
$1 = 4
(gdb) p ip_hl
$2 = 44
(gdb) n
88                  tcp->th_sum = 0;
(gdb) p *tcp
$3 = {th_sport = 8738, th_dport = 8738, th_seq = 2528755390, th_ack = 52334, th_x2 = 0 '\000', th_off = 0 '\000',
  th_flags = 0 '\000', th_win = 60496, th_sum = 0, th_urp = 24672}
(gdb) n
=================================================================
==65942==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60600000ec4a at pc 0x000000427e3a bp 0x7fffffffd660 sp 0x7fffffffd650
WRITE of size 2 at 0x60600000ec4a thread T0
    #0 0x427e39 in do_checksum /home/lt/vuln-fuzz/program/tcpreplay/src/tcpedit/checksum.c:88
    #1 0x41fbca in fix_ipv4_checksums /home/lt/vuln-fuzz/program/tcpreplay/src/tcpedit/edit_packet.c:74
    #2 0x41c209 in tcpedit_packet /home/lt/vuln-fuzz/program/tcpreplay/src/tcpedit/tcpedit.c:354
    #3 0x408f4b in send_packets /home/lt/vuln-fuzz/program/tcpreplay/src/send_packets.c:552
    #4 0x4187aa in replay_file /home/lt/vuln-fuzz/program/tcpreplay/src/replay.c:182
    #5 0x417783 in tcpr_replay_index /home/lt/vuln-fuzz/program/tcpreplay/src/replay.c:59
    #6 0x4166f4 in tcpreplay_replay /home/lt/vuln-fuzz/program/tcpreplay/src/tcpreplay_api.c:1136
    #7 0x40f45f in main /home/lt/vuln-fuzz/program/tcpreplay/src/tcpreplay.c:139
    #8 0x7ffff665d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)
    #9 0x402e18 in _start (/home/lt/vuln-fuzz/program/tcpreplay/asan-install/bin/tcpreplay-edit+0x402e18)

0x60600000ec4a is located 10 bytes to the right of 64-byte region [0x60600000ec00,0x60600000ec40)
allocated by thread T0 here:
    #0 0x7ffff6f02602 in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x98602)
    #1 0x7ffff6c4752e  (/usr/lib/x86_64-linux-gnu/libpcap.so.0.8+0x1f52e)

SUMMARY: AddressSanitizer: heap-buffer-overflow /home/lt/vuln-fuzz/program/tcpreplay/src/tcpedit/checksum.c:88 do_checksum
Shadow bytes around the buggy address:
  0x0c0c7fff9d30: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c0c7fff9d40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c0c7fff9d50: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c0c7fff9d60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c0c7fff9d70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
=>0x0c0c7fff9d80: 00 00 00 00 00 00 00 00 fa[fa]fa fa 00 00 00 00
  0x0c0c7fff9d90: 00 00 00 03 fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c0c7fff9da0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa
  0x0c0c7fff9db0: 00 00 00 00 00 00 00 fa fa fa fa fa fd fd fd fd
  0x0c0c7fff9dc0: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c0c7fff9dd0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack partial redzone:   f4
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
==65942==ABORTING
[Inferior 1 (process 65942) exited with code 01]

```

**System (please complete the following information):**

* OS: ubuntu linux
* OS version : 4.2.0-16-generic [option --unique-ip is slower than expected.Â #19](https://github.com/appneta/tcpreplay/issues/19)-Ubuntu SMP Thu Oct 8 15:35:06 UTC 2015 x86\_64 x86\_64 x86\_64 GNU/Linux
* Tcpreplay Version : master head at 2019-05-07 commit [a00fd47](https://github.com/appneta/tcpreplay/commit/a00fd4760d2289d854b6f6505902bb4264daff9c)
## Metadata

### Assignees

No one assigned

### Labels

[bug](https://github.com/appneta/tcpreplay/issues?q=state%3Aopen%20label%3A%22bug%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.


