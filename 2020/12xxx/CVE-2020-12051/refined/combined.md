=== Content from gerrit.wikimedia.org_f58a803a_20250119_124419.html ===




=== Content from phabricator.wikimedia.org_bdbb1881_20250119_124421.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT250594)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T250594
# globaluserinfo api allows access to information about hidden users (CVE-2020-12051)Closed, Resolved[Public](/policy/explain/PHID-TASK-lsvs6wqwbkb5jb6kom6s/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/250594/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/250594/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* [Protect as security issue](/wmf/escalate-task/250594/)
* [Award Token](/token/give/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)
* [Flag For Later](/flag/edit/PHID-TASK-lsvs6wqwbkb5jb6kom6s/)

Assigned To

|  | [DannyS712](/p/DannyS712/) |
| --- | --- |

Authored By

|  | [DannyS712](/p/DannyS712/) |
| --- | --- |
| Apr 19 2020, 12:13 AM2020-04-19 00:13:55 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Security](/tag/security/)
* [User-DannyS712](/tag/user-dannys712/) [(Merged)](/project/board/3849/)
* [MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/) [(Done)](/project/board/167/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [Stewards-and-global-tools](/tag/stewards-and-global-tools/) [(High priority)](/project/board/1596/)
* [MW-1.35-notes (1.35.0-wmf.30; 2020-04-28)](/project/view/4671/)
* [MW-1.31-release-notes](/tag/mw-1.31-release-notes/)
* [MW-1.33-notes](/tag/mw-1.33-notes/)
* [MW-1.34-notes](/tag/mw-1.34-notes/)
Referenced Files

|  | [F31767927: T250594.patch](/F31767927) |
| --- | --- |
| Apr 20 2020, 9:04 AM2020-04-20 09:04:21 (UTC+0) |

|  | [F31764949: T250594.patch (v.1)](/F31764949) |
| --- | --- |
| Apr 19 2020, 12:44 AM2020-04-19 00:44:32 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [DannyS712](/p/DannyS712/) |
| --- | --- |

|  | [Krenair](/p/Krenair/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [Urbanecm](/p/Urbanecm/) |
| --- | --- |

|  | [Zabe](/p/Zabe/) |
| --- | --- |

# Description

[https://login.wikimedia.org/wiki/Special:CentralAuth/Jyosei\_and\_nodobotoke\_sine](https://login.wikimedia.org/wiki/Special%3ACentralAuth/Jyosei_and_nodobotoke_sine) shows There is no global account for "Jyosei and nodobotoke sine" because the account was hidden/hideuser/whatever stewards do

<https://login.wikimedia.org/w/api.php?action=query&meta=globaluserinfo&guiuser=Jyosei%20and%20nodobotoke%20sine&guiprop=groups%7Cmerged%7Cunattached> returns the account`s globaluserinfo, and while it notes that the account is missing, it then proceeds to give all of the information anyway

As a user, when I query the globaluserinfo for a global account, and I do not have access to see the account, I should not receive information about the account via the api

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Do not leak user info via API](https://gerrit.wikimedia.org/r/c/591253) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [REL1\_31](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/REL1_31) | +4 -0 |
|  | [SECURITY: Do not leak user info via API](https://gerrit.wikimedia.org/r/c/591252) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [REL1\_33](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/REL1_33) | +4 -0 |
|  | [SECURITY: Do not leak user info via API](https://gerrit.wikimedia.org/r/c/591251) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [REL1\_34](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/REL1_34) | +4 -0 |
|  | [SECURITY: Do not leak user info via API](https://gerrit.wikimedia.org/r/c/591250) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/master) | +4 -0 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T250594)
# Related Objects

* Mentions

Mentioned In [T256742: Unable to set final story points for security issue subtype](/T256742)
[T248542: Write and send supplementary release announcement for extensions and skins with security patches (MediaWiki 1.31.8/1.33.4/1.34.2)](/T248542)
### Event Timeline

[DannyS712](/p/DannyS712/) created this task.[Apr 19 2020, 12:13 AM2020-04-19 00:13:55 (UTC+0)](#6068857)Restricted Application added a project: [User-DannyS712](/tag/user-dannys712/).  · [View Herald Transcript](/herald/transcript/3645035/)[Apr 19 2020, 12:13 AM2020-04-19 00:13:56 (UTC+0)](#6068868)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/3645035/)[DannyS712](/p/DannyS712/) moved this task from [Unsorted](/project/board/3849/) to [Reports](/project/board/3849/) on the [User-DannyS712](/tag/user-dannys712/) board.[Apr 19 2020, 12:15 AM2020-04-19 00:15:36 (UTC+0)](#6068869)[DannyS712](/p/DannyS712/) added projects: [MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/), [Vuln-Infoleak](/tag/vuln-infoleak/), [Stewards-and-global-tools](/tag/stewards-and-global-tools/).

[DannyS712](/p/DannyS712/) added a comment.Edited · [Apr 19 2020, 12:44 AM2020-04-19 00:44:32 (UTC+0)](#6068879)Comment Actions

I'm unable to test this, since I don't have CentralAuth set up, but just setting $userExists to false in ApiQueryGlobalUserInfo::execute when labelling the user as missing might be enough:

T250594.patch (v.1)1 KB[Download](https://phab.wmfusercontent.org/file/download/nqvly6xz6dqpv2rsmrya/PHID-FILE-m54jsnvmbtuxrphi3cn6/T250594.patch_%28v.1%29)

[Urbanecm](/p/Urbanecm/) assigned this task to [DannyS712](/p/DannyS712/).[Apr 20 2020, 9:04 AM2020-04-20 09:04:02 (UTC+0)](#6070593)[Urbanecm](/p/Urbanecm/) triaged this task as High priority.[Urbanecm](/p/Urbanecm/) subscribed.Comment Actions

Sounds sane, just the commit message doesn't comply with our current commit message guidelines for security patches - it should start with SECURITY:. see <https://www.mediawiki.org/wiki/Developing_security_patches>.

[DannyS712](/p/DannyS712/) added a comment.Edited · [Apr 20 2020, 9:04 AM2020-04-20 09:04:21 (UTC+0)](#6070596)Comment Actions

Version 2 with fixed commit message:

T250594.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/uk5dv5477vse43zwcaua/PHID-FILE-uqgrf7hqfwidm32vnjms/T250594.patch)

[Urbanecm](/p/Urbanecm/) added a comment.Edited · [Apr 20 2020, 9:23 AM2020-04-20 09:23:26 (UTC+0)](#6070658)Comment Actions
```
11:19 <Urbanecm> !log Security deploy for T250594
```
> In [T250594#6070596](/T250594#6070596), [@DannyS712](/p/DannyS712/) wrote:
>
> Version 2 with fixed commit message:
>
> T250594.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/uk5dv5477vse43zwcaua/PHID-FILE-uqgrf7hqfwidm32vnjms/T250594.patch)

Live as of this patch. Danny helped me to test this patch in production, and it works. When logged in, I'm able to view account details, but Danny can't (as well as me in incognito window).

[@sbassett](/p/sbassett/) Could you do the final honours, please?

[Urbanecm](/p/Urbanecm/) added a subscriber: [sbassett](/p/sbassett/).[Apr 20 2020, 9:23 AM2020-04-20 09:23:42 (UTC+0)](#6070659)[DannyS712](/p/DannyS712/) moved this task from [Reports](/project/board/3849/) to [In progress](/project/board/3849/) on the [User-DannyS712](/tag/user-dannys712/) board.[Apr 20 2020, 9:32 AM2020-04-20 09:32:14 (UTC+0)](#6070706)[DannyS712](/p/DannyS712/) moved this task from [Untriaged](/project/board/1596/) to [High priority](/project/board/1596/) on the [Stewards-and-global-tools](/tag/stewards-and-global-tools/) board.[DannyS712](/p/DannyS712/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-vzdzhwl5llsg3y6/)[sbassett](/p/sbassett/) added a comment.[Apr 21 2020, 2:16 AM2020-04-21 02:16:07 (UTC+0)](#6074029)Comment Actions
> In [T250594#6070658](/T250594#6070658), [@Urbanecm](/p/Urbanecm/) wrote:
>
> Live as of this patch. Danny helped me to test this patch in production, and it works. When logged in, I'm able to view account details, but Danny can't (as well as me in incognito window).
>
> [@sbassett](/p/sbassett/) Could you do the final honours, please?

I assume you just mean making this task public? Also, thanks for the testing and deploy.

[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-zwu7pzkn3nsfz6w/)" to "Public (No Login Required)".[Apr 21 2020, 2:16 AM2020-04-21 02:16:46 (UTC+0)](#6074031)[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Krenair](/p/Krenair/) subscribed.[Apr 21 2020, 2:18 AM2020-04-21 02:18:29 (UTC+0)](#6074034)

[DannyS712](/p/DannyS712/) added a comment.Edited · [Apr 21 2020, 2:19 AM2020-04-21 02:19:13 (UTC+0)](#6074036)Comment Actions

[@sbassett](/p/sbassett/) this hasn't been merged to the master branch, just production, if I understand correctly, and so the "final honours" was any public commit needed

[sbassett](/p/sbassett/) added a comment.[Apr 21 2020, 2:20 AM2020-04-21 02:20:18 (UTC+0)](#6074038)Comment Actions
> In [T250594#6074036](/T250594#6074036), [@DannyS712](/p/DannyS712/) wrote:
>
> [@sbassett](/p/sbassett/) this hasn't been merged to the master branch, just production, if I understand correctly, and so the "final honours" was any public commit needed

Ok, I can get the backports going.

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 2:26 AM2020-04-21 02:26:09 (UTC+0)](#6074058)Comment Actions

Change 591250 had a related patch set uploaded (by SBassett; owner: dannys712-main):

[mediawiki/extensions/CentralAuth@master] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591250>

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 2:27 AM2020-04-21 02:27:23 (UTC+0)](#6074060)Comment Actions

Change 591251 had a related patch set uploaded (by SBassett; owner: dannys712-main):

[mediawiki/extensions/CentralAuth@REL1\_34] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591251>

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 2:27 AM2020-04-21 02:27:56 (UTC+0)](#6074061)Comment Actions

Change 591252 had a related patch set uploaded (by SBassett; owner: dannys712-main):

[mediawiki/extensions/CentralAuth@REL1\_33] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591252>

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 2:28 AM2020-04-21 02:28:51 (UTC+0)](#6074063)Comment Actions

Change 591253 had a related patch set uploaded (by SBassett; owner: dannys712-main):

[mediawiki/extensions/CentralAuth@REL1\_31] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591253>

[sbassett](/p/sbassett/) added a comment.Edited · [Apr 21 2020, 2:37 AM2020-04-21 02:37:21 (UTC+0)](#6074066)Comment Actions

A CVE has also been requested - will update this task when I have the ID.

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 2:43 AM2020-04-21 02:43:17 (UTC+0)](#6074067)Comment Actions

Change 591250 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@master] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591250>

[Jdforrester-WMF](/p/Jdforrester-WMF/) added projects: [MW-1.35-notes (1.35.0-wmf.30; 2020-04-28)](/project/view/4671/), [MW-1.31-release-notes](/tag/mw-1.31-release-notes/), [MW-1.33-notes](/tag/mw-1.33-notes/), [MW-1.34-notes](/tag/mw-1.34-notes/).[Apr 21 2020, 5:15 PM2020-04-21 17:15:05 (UTC+0)](#6076091)[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 5:23 PM2020-04-21 17:23:37 (UTC+0)](#6076131)Comment Actions

Change 591251 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@REL1\_34] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591251>

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 5:23 PM2020-04-21 17:23:39 (UTC+0)](#6076132)Comment Actions

Change 591253 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@REL1\_31] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591253>

[gerritbot](/p/gerritbot/) added a comment.[Apr 21 2020, 5:24 PM2020-04-21 17:24:54 (UTC+0)](#6076134)Comment Actions

Change 591252 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@REL1\_33] SECURITY: Do not leak user info via API

<https://gerrit.wikimedia.org/r/591252>

[sbassett](/p/sbassett/) renamed this task from globaluserinfo api allows access to information about hidden users to globaluserinfo api allows access to information about hidden users (CVE-2020-12051).[Apr 23 2020, 2:42 AM2020-04-23 02:42:57 (UTC+0)](#6078987)[sbassett](/p/sbassett/) mentioned this in [T248542: Write and send supplementary release announcement for extensions and skins with security patches (MediaWiki 1.31.8/1.33.4/1.34.2)](/T248542).[Apr 23 2020, 2:50 AM2020-04-23 02:50:26 (UTC+0)](#6079003)[sbassett](/p/sbassett/) closed this task as Resolved.[Apr 23 2020, 2:52 AM2020-04-23 02:52:38 (UTC+0)](#6079006)[sbassett](/p/sbassett/) moved this task from [Backlog](/project/board/167/) to [Done](/project/board/167/) on the [MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/) board.[DannyS712](/p/DannyS712/) moved this task from [In progress](/project/board/3849/) to [Merged](/project/board/3849/) on the [User-DannyS712](/tag/user-dannys712/) board.[May 27 2020, 8:36 AM2020-05-27 08:36:38 (UTC+0)](#6168273)[DannyS712](/p/DannyS712/) mentioned this in [T256742: Unable to set final story points for security issue subtype](/T256742).[Jun 30 2020, 11:25 AM2020-06-30 11:25:37 (UTC+0)](#6267246)[Zabe](/p/Zabe/) subscribed.[Sep 25 2021, 1:34 PM2021-09-25 13:34:25 (UTC+0)](#7377923)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
