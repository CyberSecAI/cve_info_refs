=== Content from usn.ubuntu.com_6c0ee4f5_20250119_114844.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4391-1: Linux kernel vulnerabilities

11 June 2020

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 16.04 ESM](/security/notices?release=xenial)
* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-lts-xenial](/security/cves?package=linux-lts-xenial) - Linux hardware enablement kernel from Xenial for Trusty
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi (V7) systems
* [linux-snapdragon](/security/cves?package=linux-snapdragon) - Linux kernel for Qualcomm Snapdragon processors

## Details

It was discovered that the ext4 file system implementation in the Linux

kernel did not properly handle setxattr operations in some situations. A

local attacker could use this to cause a denial of service (system crash)

or possibly execute arbitrary code. ([CVE-2019-19319](/security/CVE-2019-19319))

It was discovered that memory contents previously stored in

microarchitectural special registers after RDRAND, RDSEED, and SGX EGETKEY

read operations on Intel client and Xeon E3 processors may be briefly

exposed to processes on the same or different processor cores. A local

attacker could use this to expose sensitive information. ([CVE-2020-0543](/security/CVE-2020-0543))

Piotr Krysiuk discovered that race conditions existed in the file system

implementation in the Linux kernel. A local attacker could use this to

cause a denial of service (system crash). ([CVE-2020-12114](/security/CVE-2020-12114))

It was discovered that the USB susbsystem's scatter-gather implementation

in the Linux kernel did not properly take data references in some

situations, leading to a use-after-free. A physically proximate attacker

could use this to cause a denial of service (system crash) or possibly

execute arbitrary code. ([CVE-2020-12464](/security/CVE-2020-12464))

It was discovered that the DesignWare SPI controller driver in the Linux

kernel contained a race condition. A local attacker could possibly use this

to cause a denial of service (system crash). ([CVE-2020-12769](/security/CVE-2020-12769))

It was discovered that the exit signaling implementation in the Linux

kernel contained an integer overflow. A local attacker could use this to

cause a denial of service (arbitrary application crash). ([CVE-2020-12826](/security/CVE-2020-12826))

Xiumei Mu discovered that the IPSec implementation in the Linux kernel did

not properly encrypt IPv6 traffic in some situations. An attacker could use

this to expose sensitive information. ([CVE-2020-1749](/security/CVE-2020-1749))

Dmitry Vyukov discovered that the SELinux netlink security hook in the

Linux kernel did not validate messages in some situations. A privileged

attacker could use this to bypass SELinux netlink restrictions.

([CVE-2020-10751](/security/CVE-2020-10751))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 16.04

* [linux-image-4.4.0-1075-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [4.4.0-1075.82](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/4.4.0-1075.82)
* [linux-image-4.4.0-1109-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.4.0-1109.120](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.4.0-1109.120)
* [linux-image-4.4.0-1134-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.4.0-1134.143](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.4.0-1134.143)
* [linux-image-4.4.0-1138-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon)
  -
  [4.4.0-1138.146](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon/4.4.0-1138.146)
* [linux-image-4.4.0-184-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux-signed/4.4.0-184.214)
* [linux-image-4.4.0-184-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-184.214)
* [linux-image-4.4.0-184-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux-signed/4.4.0-184.214)
* [linux-image-4.4.0-184-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-184.214)
* [linux-image-4.4.0-184-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-184.214)
* [linux-image-4.4.0-184-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-184.214)
* [linux-image-4.4.0-184-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-184.214](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-184.214)
* [linux-image-aws](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws)
  -
  [4.4.0.1109.113](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws/4.4.0.1109.113)
* [linux-image-generic](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm)
  -
  [4.4.0.1075.73](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm/4.4.0.1075.73)
* [linux-image-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)
* [linux-image-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi2)
  -
  [4.4.0.1134.134](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi2/4.4.0.1134.134)
* [linux-image-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-meta-snapdragon)
  -
  [4.4.0.1138.130](https://launchpad.net/ubuntu/%2Bsource/linux-meta-snapdragon/4.4.0.1138.130)
* [linux-image-virtual](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.4.0.184.190](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.4.0.184.190)

##### Ubuntu 14.04

* [linux-image-4.4.0-1073-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.4.0-1073.77](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.4.0-1073.77)
* [linux-image-4.4.0-184-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-4.4.0-184-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-4.4.0-184-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-4.4.0-184-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-4.4.0-184-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-4.4.0-184-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-4.4.0-184-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-184.214~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-184.214~14.04.1)
* [linux-image-aws](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws)
  -
  [4.4.0.1073.70](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws/4.4.0.1073.70)
* [linux-image-generic-lpae-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-generic-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-lowlatency-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-powerpc-e500mc-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-powerpc-smp-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-powerpc64-emb-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-powerpc64-smp-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)
* [linux-image-virtual-lts-xenial](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial)
  -
  [4.4.0.184.161](https://launchpad.net/ubuntu/%2Bsource/linux-meta-lts-xenial/4.4.0.184.161)

Please note that the mitigation for CVE-2020-0543 requires a processor

microcode update to be applied, either from your system manufacturer

or via the intel-microcode package. The kernel update for this issue

provides the ability to disable the mitigation and to report

vulnerability status.

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2019-19319](/security/CVE-2019-19319)
* [CVE-2020-0543](/security/CVE-2020-0543)
* [CVE-2020-10751](/security/CVE-2020-10751)
* [CVE-2020-12114](/security/CVE-2020-12114)
* [CVE-2020-12464](/security/CVE-2020-12464)
* [CVE-2020-12769](/security/CVE-2020-12769)
* [CVE-2020-12826](/security/CVE-2020-12826)
* [CVE-2020-1749](/security/CVE-2020-1749)
* <https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SRBDS>

## Related notices

* [USN-4387-1](/security/notices/USN-4387-1)
* [USN-4390-1](/security/notices/USN-4390-1)
* [USN-4385-1](/security/notices/USN-4385-1)
* [USN-4389-1](/security/notices/USN-4389-1)
* [USN-4392-1](/security/notices/USN-4392-1)
* [USN-4388-1](/security/notices/USN-4388-1)
* [USN-4393-1](/security/notices/USN-4393-1)
* [LSN-0068-1](/security/notices/LSN-0068-1)
* [USN-5617-1](/security/notices/USN-5617-1)
* [USN-4412-1](/security/notices/USN-4412-1)
* [USN-4413-1](/security/notices/USN-4413-1)
* [LSN-0072-1](/security/notices/LSN-0072-1)
* [LSN-0069-1](/security/notices/LSN-0069-1)
* [USN-4369-1](/security/notices/USN-4369-1)
* [USN-4367-1](/security/notices/USN-4367-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from access.redhat.com_e360343b_20250119_133531.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry this application will not work properly without JavaScript enabled.
Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from lists.debian.org_4f0c4dca_20250119_114841.html ===


---

[[Date Prev](msg00012.html)][[Date Next](msg00014.html)]
[[Thread Prev](msg00012.html)][[Thread Next](msg00014.html)]
[[Date Index](maillist.html#00013)]
[[Thread Index](threads.html#00013)]

# [SECURITY] [DLA 2241-2] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2241-2] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 10 Jun 2020 11:55:23 +0100
* *Message-id*: <[[🔎]](/msgid-search/fa69a9353152b3507fa4914c112f33c44983ef5e.camel%40debian.org) [fa69a9353152b3507fa4914c112f33c44983ef5e.camel@debian.org](msg00013.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux
Version        : 3.16.84-1
CVE ID         : CVE-2015-8839 CVE-2018-14610 CVE-2018-14611 CVE-2018-14612
                 CVE-2018-14613 CVE-2019-5108 CVE-2019-19319 CVE-2019-19447
                 CVE-2019-19768 CVE-2019-20636 CVE-2020-0009 CVE-2020-0543
                 CVE-2020-1749 CVE-2020-2732 CVE-2020-8647 CVE-2020-8648
                 CVE-2020-8649 CVE-2020-9383 CVE-2020-10690 CVE-2020-10751
                 CVE-2020-10942 CVE-2020-11494 CVE-2020-11565 CVE-2020-11608
                 CVE-2020-11609 CVE-2020-11668 CVE-2020-12114 CVE-2020-12464
                 CVE-2020-12652 CVE-2020-12653 CVE-2020-12654 CVE-2020-12769
                 CVE-2020-12770 CVE-2020-12826 CVE-2020-13143

This update is now available for all supported architectures.  For
reference the original advisory text follows.

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2015-8839

    A race condition was found in the ext4 filesystem implementation.
    A local user could exploit this to cause a denial of service
    (filesystem corruption).

CVE-2018-14610, CVE-2018-14611, CVE-2018-14612, CVE-2018-14613

    Wen Xu from SSLab at Gatech reported that crafted Btrfs volumes
    could trigger a crash (Oops) and/or out-of-bounds memory access.
    An attacker able to mount such a volume could use this to cause a
    denial of service or possibly for privilege escalation.

CVE-2019-5108

    Mitchell Frank of Cisco discovered that when the IEEE 802.11
    (WiFi) stack was used in AP mode with roaming, it would trigger
    roaming for a newly associated station before the station was
    authenticated.  An attacker within range of the AP could use this
    to cause a denial of service, either by filling up a switching
    table or by redirecting traffic away from other stations.

CVE-2019-19319

    Jungyeon discovered that a crafted filesystem can cause the ext4
    implementation to deallocate or reallocate journal blocks.  A user
    permitted to mount filesystems could use this to cause a denial of
    service (crash), or possibly for privilege escalation.

CVE-2019-19447

    It was discovered that the ext4 filesystem driver did not safely
    handle unlinking of an inode that, due to filesystem corruption,
    already has a link count of 0.  An attacker able to mount
    arbitrary ext4 volumes could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-19768

    Tristan Madani reported a race condition in the blktrace debug
    facility that could result in a use-after-free.  A local user able
    to trigger removal of block devices could possibly use this to
    cause a denial of service (crash) or for privilege escalation.

CVE-2019-20636

    The syzbot tool found that the input subsystem did not fully
    validate keycode changes, which could result in a heap
    out-of-bounds write.  A local user permitted to access the device
    node for an input or VT device could possibly use this to cause a
    denial of service (crash or memory corruption) or for privilege
    escalation.

CVE-2020-0009

    Jann Horn reported that the Android ashmem driver did not prevent
    read-only files from being memory-mapped and then remapped as
    read-write.  However, Android drivers are not enabled in Debian
    kernel configurations.

CVE-2020-0543

    Researchers at VU Amsterdam discovered that on some Intel CPUs
    supporting the RDRAND and RDSEED instructions, part of a random
    value generated by these instructions may be used in a later
    speculative execution on any core of the same physical CPU.
    Depending on how these instructions are used by applications, a
    local user or VM guest could use this to obtain sensitive
    information such as cryptographic keys from other users or VMs.

    This vulnerability can be mitigated by a microcode update, either
    as part of system firmware (BIOS) or through the intel-microcode
    package in Debian's non-free archive section.  This kernel update
    only provides reporting of the vulnerability and the option to
    disable the mitigation if it is not needed.

CVE-2020-1749

    Xiumei Mu reported that some network protocols that can run on top
    of IPv6 would bypass the Transformation (XFRM) layer used by
    IPsec, IPcomp/IPcomp6, IPIP, and IPv6 Mobility.  This could result
    in disclosure of information over the network, since it would not
    be encrypted or routed according to the system policy.

CVE-2020-2732

    Paulo Bonzini discovered that the KVM implementation for Intel
    processors did not properly handle instruction emulation for L2
    guests when nested virtualization is enabled. This could allow an
    L2 guest to cause privilege escalation, denial of service, or
    information leaks in the L1 guest.

CVE-2020-8647, CVE-2020-8649

    The Hulk Robot tool found a potential MMIO out-of-bounds access in
    the vgacon driver.  A local user permitted to access a virtual
    terminal (/dev/tty1 etc.) on a system using the vgacon driver
    could use this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2020-8648

    The syzbot tool found a race condition in the the virtual terminal
    driver, which could result in a use-after-free.  A local user
    permitted to access a virtual terminal could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2020-9383

    Jordy Zomer reported an incorrect range check in the floppy driver
    which could lead to a static out-of-bounds access.  A local user
    permitted to access a floppy drive could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2020-10690

    It was discovered that the PTP hardware clock subsystem did not
    properly manage device lifetimes.  Removing a PTP hardware clock
    from the system while a user process was using it could lead to a
    use-after-free.  The security impact of this is unclear.

CVE-2020-10751

    Dmitry Vyukov reported that the SELinux subsystem did not properly
    handle validating multiple messages, which could allow a privileged
    attacker to bypass SELinux netlink restrictions.

CVE-2020-10942

    It was discovered that the vhost_net driver did not properly
    validate the type of sockets set as back-ends. A local user
    permitted to access /dev/vhost-net could use this to cause a stack
    corruption via crafted system calls, resulting in denial of
    service (crash) or possibly privilege escalation.

CVE-2020-11494

    It was discovered that the slcan (serial line CAN) network driver
    did not fully initialise CAN headers for received packets,
    resulting in an information leak from the kernel to user-space or
    over the CAN network.

CVE-2020-11565

    Entropy Moe reported that the shared memory filesystem (tmpfs) did
    not correctly handle an "mpol" mount option specifying an empty
    node list, leading to a stack-based out-of-bounds write. If user
    namespaces are enabled, a local user could use this to cause a
    denial of service (crash) or possibly for privilege escalation.

CVE-2020-11608, CVE-2020-11609, CVE-2020-11668

    It was discovered that the ov519, stv06xx, and xirlink_cit media
    drivers did not properly validate USB device descriptors.  A
    physically present user with a specially constructed USB device
    could use this to cause a denial-of-service (crash) or possibly
    for privilege escalation.

CVE-2020-12114

    Piotr Krysiuk discovered a race condition between the umount and
    pivot_root operations in the filesystem core (vfs).  A local user
    with the CAP_SYS_ADMIN capability in any user namespace could use
    this to cause a denial of service (crash).

CVE-2020-12464

    Kyungtae Kim reported a race condition in the USB core that can
    result in a use-after-free.  It is not clear how this can be
    exploited, but it could result in a denial of service (crash or
    memory corruption) or privilege escalation.

CVE-2020-12652

    Tom Hatskevich reported a bug in the mptfusion storage drivers.
    An ioctl handler fetched a parameter from user memory twice,
    creating a race condition which could result in incorrect locking
    of internal data structures.  A local user permitted to access
    /dev/mptctl could use this to cause a denial of service (crash or
    memory corruption) or for privilege escalation.

CVE-2020-12653

    It was discovered that the mwifiex WiFi driver did not
    sufficiently validate scan requests, resulting a potential heap
    buffer overflow.  A local user with CAP_NET_ADMIN capability could
    use this to cause a denial of service (crash or memory corruption)
    or possibly for privilege escalation.

CVE-2020-12654

    It was discovered that the mwifiex WiFi driver did not
    sufficiently validate WMM parameters received from an access point
    (AP), resulting a potential heap buffer overflow.  A malicious AP
    could use this to cause a denial of service (crash or memory
    corruption) or possibly to execute code on a vulnerable system.

CVE-2020-12769

    It was discovered that the spi-dw SPI host driver did not properly
    serialise access to its internal state.  The security impact of
    this is unclear, and this driver is not included in Debian's
    binary packages.

CVE-2020-12770

    It was discovered that the sg (SCSI generic) driver did not
    correctly release internal resources in a particular error case.
    A local user permitted to access an sg device could possibly use
    this to cause a denial of service (resource exhaustion).

CVE-2020-12826

    Adam Zabrocki reported a weakness in the signal subsystem's
    permission checks.  A parent process can choose an arbitary signal
    for a child process to send when it exits, but if the parent has
    executed a new program then the default SIGCHLD signal is sent.  A
    local user permitted to run a program for several days could
    bypass this check, execute a setuid program, and then send an
    arbitrary signal to it.  Depending on the setuid programs
    installed, this could have some security impact.

CVE-2020-13143

    Kyungtae Kim reported a potential heap out-of-bounds write in
    the USB gadget subsystem.  A local user permitted to write to
    the gadget configuration filesystem could use this to cause a
    denial of service (crash or memory corruption) or potentially
    for privilege escalation.

For Debian 8 "Jessie", these problems have been fixed in version
3.16.84-1.

We recommend that you upgrade your linux packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgprA4TYV0cOI.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from access.redhat.com_947d3f32_20250119_133531.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_2f28719f_20250119_133530.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from usn.ubuntu.com_c9c45080_20250119_114843.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4369-1: Linux kernel vulnerabilities

24 May 2020

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 19.10](/security/notices?release=eoan)
* [Ubuntu 18.04 ESM](/security/notices?release=bionic)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-aws-5.3](/security/cves?package=linux-aws-5.3) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-azure-5.3](/security/cves?package=linux-azure-5.3) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-gcp-5.3](/security/cves?package=linux-gcp-5.3) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-gke-5.3](/security/cves?package=linux-gke-5.3) - Linux kernel for Google Container Engine (GKE) systems
* [linux-hwe](/security/cves?package=linux-hwe) - Linux hardware enablement (HWE) kernel
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-oracle](/security/cves?package=linux-oracle) - Linux kernel for Oracle Cloud systems
* [linux-oracle-5.3](/security/cves?package=linux-oracle-5.3) - Linux kernel for Oracle Cloud systems
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi (V7) systems

## Details

It was discovered that the btrfs implementation in the Linux kernel did not

properly detect that a block was marked dirty in some situations. An

attacker could use this to specially craft a file system image that, when

unmounted, could cause a denial of service (system crash). ([CVE-2019-19377](/security/CVE-2019-19377))

Tristan Madani discovered that the file locking implementation in the Linux

kernel contained a race condition. A local attacker could possibly use this

to cause a denial of service or expose sensitive information.

([CVE-2019-19769](/security/CVE-2019-19769))

It was discovered that the Serial CAN interface driver in the Linux kernel

did not properly initialize data. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2020-11494](/security/CVE-2020-11494))

It was discovered that the linux kernel did not properly validate certain

mount options to the tmpfs virtual memory file system. A local attacker

with the ability to specify mount options could use this to cause a denial

of service (system crash). ([CVE-2020-11565](/security/CVE-2020-11565))

It was discovered that the OV51x USB Camera device driver in the Linux

kernel did not properly validate device metadata. A physically proximate

attacker could use this to cause a denial of service (system crash).

([CVE-2020-11608](/security/CVE-2020-11608))

It was discovered that the STV06XX USB Camera device driver in the Linux

kernel did not properly validate device metadata. A physically proximate

attacker could use this to cause a denial of service (system crash).

([CVE-2020-11609](/security/CVE-2020-11609))

It was discovered that the Xirlink C-It USB Camera device driver in the

Linux kernel did not properly validate device metadata. A physically

proximate attacker could use this to cause a denial of service (system

crash). ([CVE-2020-11668](/security/CVE-2020-11668))

It was discovered that the block layer in the Linux kernel contained a race

condition leading to a use-after-free vulnerability. A local attacker could

possibly use this to cause a denial of service (system crash) or execute

arbitrary code. ([CVE-2020-12657](/security/CVE-2020-12657))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 19.10

* [linux-image-5.3.0-1017-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [5.3.0-1017.19](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/5.3.0-1017.19)
* [linux-image-5.3.0-1018-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-oracle)
  -
  [5.3.0-1018.20](https://launchpad.net/ubuntu/%2Bsource/linux-oracle/5.3.0-1018.20)
* [linux-image-5.3.0-1019-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [5.3.0-1019.21](https://launchpad.net/ubuntu/%2Bsource/linux-aws/5.3.0-1019.21)
* [linux-image-5.3.0-1020-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-gcp)
  -
  [5.3.0-1020.22](https://launchpad.net/ubuntu/%2Bsource/linux-gcp/5.3.0-1020.22)
* [linux-image-5.3.0-1022-azure](https://launchpad.net/ubuntu/%2Bsource/linux-azure)
  -
  [5.3.0-1022.23](https://launchpad.net/ubuntu/%2Bsource/linux-azure/5.3.0-1022.23)
* [linux-image-5.3.0-1025-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [5.3.0-1025.27](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/5.3.0-1025.27)
* [linux-image-5.3.0-53-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.3.0-53.47](https://launchpad.net/ubuntu/%2Bsource/linux/5.3.0-53.47)
* [linux-image-5.3.0-53-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.3.0-53.47](https://launchpad.net/ubuntu/%2Bsource/linux/5.3.0-53.47)
* [linux-image-5.3.0-53-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.3.0-53.47](https://launchpad.net/ubuntu/%2Bsource/linux/5.3.0-53.47)
* [linux-image-5.3.0-53-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.3.0-53.47](https://launchpad.net/ubuntu/%2Bsource/linux/5.3.0-53.47)
* linux-image-aws
  -
  5.3.0.1019.31
* linux-image-azure
  -
  5.3.0.1022.41
* linux-image-gcp
  -
  5.3.0.1020.31
* linux-image-generic
  -
  5.3.0.53.45
* linux-image-generic-lpae
  -
  5.3.0.53.45
* linux-image-gke
  -
  5.3.0.1020.31
* linux-image-kvm
  -
  5.3.0.1017.19
* linux-image-lowlatency
  -
  5.3.0.53.45
* linux-image-oracle
  -
  5.3.0.1018.33
* linux-image-raspi2
  -
  5.3.0.1025.22
* linux-image-snapdragon
  -
  5.3.0.53.45
* linux-image-virtual
  -
  5.3.0.53.45

##### Ubuntu 18.04

* [linux-image-5.3.0-1018-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle-5.3)
  -
  [5.3.0-1018.20~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle-5.3/5.3.0-1018.20~18.04.1)
* [linux-image-5.3.0-1019-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws-5.3)
  -
  [5.3.0-1019.21~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-aws-5.3/5.3.0-1019.21~18.04.1)
* [linux-image-5.3.0-1020-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp-5.3)
  -
  [5.3.0-1020.22~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp-5.3/5.3.0-1020.22~18.04.1)
* [linux-image-5.3.0-1020-gke](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gke-5.3)
  -
  [5.3.0-1020.22~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gke-5.3/5.3.0-1020.22~18.04.1)
* [linux-image-5.3.0-1022-azure](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure-5.3)
  -
  [5.3.0-1022.23~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure-5.3/5.3.0-1022.23~18.04.1)
* [linux-image-5.3.0-53-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [5.3.0-53.47~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/5.3.0-53.47~18.04.1)
* [linux-image-5.3.0-53-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [5.3.0-53.47~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/5.3.0-53.47~18.04.1)
* [linux-image-5.3.0-53-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [5.3.0-53.47~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/5.3.0-53.47~18.04.1)
* [linux-image-aws](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-5.3)
  -
  [5.3.0.1019.20](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-5.3/5.3.0.1019.20)
* [linux-image-aws-edge](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-5.3)
  -
  [5.3.0.1019.20](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-5.3/5.3.0.1019.20)
* [linux-image-azure](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure-5.3)
  -
  [5.3.0.1022.22](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure-5.3/5.3.0.1022.22)
* [linux-image-azure-edge](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure-5.3)
  -
  [5.3.0.1022.22](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure-5.3/5.3.0.1022.22)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp-5.3)
  -
  [5.3.0.1020.19](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp-5.3/5.3.0.1020.19)
* [linux-image-gcp-edge](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp-5.3)
  -
  [5.3.0.1020.19](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp-5.3/5.3.0.1020.19)
* [linux-image-generic-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.3.0.53.109](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.3.0.53.109)
* [linux-image-generic-lpae-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.3.0.53.109](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.3.0.53.109)
* [linux-image-gke-5.3](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-5.3)
  -
  [5.3.0.1020.10](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-5.3/5.3.0.1020.10)
* [linux-image-gkeop-5.3](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.3.0.53.109](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.3.0.53.109)
* [linux-image-lowlatency-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.3.0.53.109](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.3.0.53.109)
* [linux-image-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle-5.3)
  -
  [5.3.0.1018.19](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle-5.3/5.3.0.1018.19)
* [linux-image-snapdragon-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.3.0.53.109](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.3.0.53.109)
* [linux-image-virtual-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.3.0.53.109](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.3.0.53.109)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2019-19377](/security/CVE-2019-19377)
* [CVE-2019-19769](/security/CVE-2019-19769)
* [CVE-2020-11494](/security/CVE-2020-11494)
* [CVE-2020-11565](/security/CVE-2020-11565)
* [CVE-2020-11608](/security/CVE-2020-11608)
* [CVE-2020-11609](/security/CVE-2020-11609)
* [CVE-2020-11668](/security/CVE-2020-11668)
* [CVE-2020-12657](/security/CVE-2020-12657)
* [CVE-2020-12826](/security/CVE-2020-12826)

## Related notices

* [USN-4367-1](/security/notices/USN-4367-1)
* [USN-4414-1](/security/notices/USN-4414-1)
* [USN-4368-1](/security/notices/USN-4368-1)
* [USN-4364-1](/security/notices/USN-4364-1)
* [USN-4363-1](/security/notices/USN-4363-1)
* [LSN-0067-1](/security/notices/LSN-0067-1)
* [LSN-0068-1](/security/notices/LSN-0068-1)
* [LSN-0072-1](/security/notices/LSN-0072-1)
* [USN-4345-1](/security/notices/USN-4345-1)
* [USN-4391-1](/security/notices/USN-4391-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from security.netapp.com_41a9e947_20250119_114842.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [May 2020 Linux Kernel Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20200608-0001)

## May 2020 Linux Kernel Vulnerabilities in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20200608-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20200608-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20200608-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20200608-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20200608-0001
**Version:**
20.0

**Last updated:**
02/07/2023

**Status:**
Interim.

**CVEs:** CVE-2020-10711, CVE-2020-13143, CVE-2020-12888, CVE-2020-12826, CVE-2020-12771, CVE-2020-12770, CVE-2020-12769, CVE-2019-20794, CVE-2019-14898, CVE-2020-12659, CVE-2020-12657, CVE-2020-12655, CVE-2020-12653, CVE-2020-12654, CVE-2020-12652, CVE-2020-12114, CVE-2020-12465, CVE-2020-12464, CVE-2020-11884, CVE-2019-11599, CVE-2020-10690

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions prior to 5.7 are susceptible to vulnerabilities which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2019-11599](https://nvd.nist.gov/vuln/detail/CVE-2019-11599) | 7.0 (HIGH) | CVSS:3.0/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-14898](https://nvd.nist.gov/vuln/detail/CVE-2019-14898) | 7.0 (HIGH) | CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-20794](https://nvd.nist.gov/vuln/detail/CVE-2019-20794) | 5.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2020-10690](https://nvd.nist.gov/vuln/detail/CVE-2020-10690) | 6.4 (MEDIUM) | CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-10711](https://nvd.nist.gov/vuln/detail/CVE-2020-10711) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2020-11884](https://nvd.nist.gov/vuln/detail/CVE-2020-11884) | 7.0 (HIGH) | CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12114](https://nvd.nist.gov/vuln/detail/CVE-2020-12114) | 4.7 (MEDIUM) | CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2020-12464](https://nvd.nist.gov/vuln/detail/CVE-2020-12464) | 6.7 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12465](https://nvd.nist.gov/vuln/detail/CVE-2020-12465) | 6.7 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12652](https://nvd.nist.gov/vuln/detail/CVE-2020-12652) | 6.4 (MEDIUM) | CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12653](https://nvd.nist.gov/vuln/detail/CVE-2020-12653) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12654](https://nvd.nist.gov/vuln/detail/CVE-2020-12654) | 9.8 (CRITICAL) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12655](https://nvd.nist.gov/vuln/detail/CVE-2020-12655) | 5.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2020-12657](https://nvd.nist.gov/vuln/detail/CVE-2020-12657) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12659](https://nvd.nist.gov/vuln/detail/CVE-2020-12659) | 6.7 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12769](https://nvd.nist.gov/vuln/detail/CVE-2020-12769) | 5.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2020-12770](https://nvd.nist.gov/vuln/detail/CVE-2020-12770) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2020-12771](https://nvd.nist.gov/vuln/detail/CVE-2020-12771) | 5.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2020-12826](https://nvd.nist.gov/vuln/detail/CVE-2020-12826) | 8.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H |
| [CVE-2020-12888](https://nvd.nist.gov/vuln/detail/CVE-2020-12888) | 6.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H |
| [CVE-2020-13143](https://nvd.nist.gov/vuln/detail/CVE-2020-13143) | 6.5 (MEDIUM) | CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://cdn.kernel.org/pub/linux/kernel/v5.x/ChangeLog-5.6.7>

Affected Products
#### Affected Products

* AFF Baseboard Management Controller (BMC) - A700s
* Active IQ Unified Manager for VMware vSphere
* NetApp Cloud Backup (formerly AltaVault)
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Baseboard Management Controller (BMC)
* NetApp SteelStore Cloud Integrated Storage

#### Products Not Affected

* 7-Mode Transition Tool
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ mobile app
* Astra Trident
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Telegraf Agent
* Cloud Secure Agent
* Cloud Volumes ONTAP Mediator
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Storage Manager
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Python SDK
* FAS/AFF BIOS - 8300/8700/A400
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400
* FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800
* FAS/AFF Service Processor - 8080/8060/8040/8020
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* Inventory Collect Tool
* Management Services for Element Software and NetApp HCI
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp BlueXP
* NetApp Cloud Backup OST Plug-in (formerly AltaVault OST Plug-in)
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Performance Analyzer
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SMI-S Provider
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp Storage Services Connector for SAP Landscape Management
* NetApp VASA Provider for Clustered Data ONTAP 9.7 and above
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* OnCommand Insight
* OnCommand Workflow Automation
* SAS Firmware
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 9.7 and above
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID Baseboard Management Controller (BMC)
* StorageGRID9 (9.x and prior)
* System Manager 9.x
* Virtual Storage Console for VMware vSphere 9.7 and above

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **Active IQ Unified Manager for VMware vSphere** | <https://mysupport.netapp.com/site/products/all/details/activeiq-unified-manager/downloads-tab/download/62791/9.12> |
| **AFF Baseboard Management Controller (BMC) - A700s** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1323875. First fixed versions include the following: 1.87 |
| **NetApp Cloud Backup (formerly AltaVault)** | NetApp Cloud Backup (formerly AltaVault) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2880179.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H610C** | <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/Compute_Firmware_Bundle> First included in Compute Firmware Bundle version 2.146.2-12.5.74. |
| **NetApp HCI Baseboard Management Controller (BMC) - H610S** | <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/Compute_Firmware_Bundle/downloads> <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/Storage_Firmware_Bundle/downloads> First fixed in storage firmware version 2.76. |
| **NetApp HCI Baseboard Management Controller (BMC) - H615C** | <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/Compute_Firmware_Bundle> First included in Compute Firmware Bundle version 2.146.2-12.5.74. |
| **NetApp SolidFire & HCI Management Node** | <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/12.5> <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/1.10> |
| **NetApp SolidFire Baseboard Management Controller (BMC)** | NetApp SolidFire Baseboard Management Controller (BMC) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2847476.html%20) for more information. |
| **NetApp SteelStore Cloud Integrated Storage** | NetApp SteelStore Cloud Integrated Storage has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2397079.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20200608-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20200608 | Initial Public Release |
| 2.0 | 20200611 | AFF Baseboard Management Controller (BMC) - A700s moved to Affected Products and Cloud Volumes ONTAP Mediator moved to Products Not Affected |
| 3.0 | 20200616 | Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above moved to Affected Products |
| 4.0 | 20200618 | Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above moved to Affected Products |
| 5.0 | 20200619 | After additional review FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400 moved from Affected Products to Products Not Affected |
| 6.0 | 20200717 | NetApp Converged Systems Advisor Agent moved to Products Not Affected |
| 7.0 | 20200722 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 8.0 | 20200730 | NetApp HCI Baseboard Management Controller (BMC) - H610C, NetApp HCI Baseboard Management Controller (BMC) - H610S, and NetApp HCI Baseboard Management Controller (BMC) - H615C moved to Affected Products |
| 9.0 | 20200731 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S, and NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Affected Products |
| 10.0 | 20200901 | NetApp SteelStore Cloud Integrated Storage moved to Won't Fix status |
| 11.0 | 20210205 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Affected Products |
| 12.0 | 20210209 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Affected Products |
| 13.0 | 20210414 | NetApp HCI Baseboard Management Controller (BMC) - H610S added to Software Versions and Fixes |
| 14.0 | 20210816 | AFF Baseboard Management Controller (BMC) - A700s added to Software Versions and Fixes |
| 15.0 | 20211012 | NetApp HCI Baseboard Management Controller (BMC) - H410C and NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S moved to Won't Fix status |
| 16.0 | 20211101 | NetApp SolidFire Baseboard Management Controller (BMC) moved to Won't Fix status |
| 17.0 | 20220106 | NetApp Cloud Backup (formerly AltaVault) moved to Won't Fix status |
| 18.0 | 20220527 | NetApp SolidFire & HCI Management Node added to Software Versions and Fixes |
| 19.0 | 20220701 | NetApp HCI Baseboard Management Controller (BMC) - H610C and NetApp HCI Baseboard Management Controller (BMC) - H615C added to Software Versions and Fixes |
| 20.0 | 20230207 | Active IQ Unified Manager for VMware vSphere added to Software Versions and Fixes |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from www.openwall.com_5a965d1f_20250119_114844.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2020/03/24/61) [[next>]](2) [[thread-next>]](../../../2020/03/29/6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20200324215049.GA3710@pi3.com.pl>
Date: Tue, 24 Mar 2020 22:50:49 +0100
From: Adam Zabrocki <pi3@....com.pl>
To: linux-kernel@...r.kernel.org, kernel-hardening@...ts.openwall.com
Subject: Curiosity around 'exec_id' and some problems associated with it

Problems:
     I.               The "exit_notify" function in the Linux kernel does not
                      sufficiently restrict exit signals
    II.               Preserve references to the "old" / dead process' VM via
                      file descriptor
Author:               Adam Zabrocki (<pi3@....com.pl>)
Date:                 September 1999 - March 2020

   Description:

In 2009 Oleg Nesterov discovered that Linux kernel has an incorrect logic to
reset ->exit_signal. As a result, the malicious user can bypass it if it execs
the setuid application before exiting (->exit_signal won't be reset to SIGCHLD).
His original message can be found here:

<https://marc.info/?l=linux-kernel&m=123560588713763&w=2>

CVE-2009-1337 was assigned to track this issue. More information about this bug
can be found here:

<https://www.cvedetails.com/cve/CVE-2009-1337/>

Patch:

<https://lore.kernel.org/patchwork/patch/150993/>

The logic responsible for handling ->exit_signal has been changed a few times
and the current logic is locked down since Linux kernel 3.3.5. However, it is
not fully robust and it's still possible for the malicious user to bypass it.
Basically, it's possible to send arbitrary signals to a privileged (suidroot)
parent process (Problem I.). Nevertheless, it's not trivial and more limited
comparing to the CVE-2009-1337.

   Details (Problem I.):

    When process dies function do_exit() -> exit_notify() from "kernel/exit.c"
is called:

"kernel/exit.c"
static void exit_notify(struct task_struct *tsk, int group_dead)
{
        ...
        tsk->exit_state = EXIT_ZOMBIE;
        if (unlikely(tsk->ptrace)) {
        ...
        } else if (thread_group_leader(tsk)) {
                autoreap = thread_group_empty(tsk) &&
                        do_notify_parent(tsk, tsk->exit_signal);
        } else {
        ...
    }
    ...
}

To be able to inform that child process died, do_notify_parent() from
"kernel/signal.c" is executed:

"kernel/signal.c"
bool do_notify_parent(struct task_struct *tsk, int sig)
{
        ...
        if (sig != SIGCHLD) {
                /*
                 * This is only possible if parent == real_parent.
                 * Check if it has changed security domain.
                 */
                if (tsk->parent_exec_id != tsk->parent->self_exec_id)
                        sig = SIGCHLD;
        }
        ...
        if (valid_signal(sig) && sig)
                __group_send_sig_info(sig, &info, tsk->parent);
        ...
}

It is possible for the child process to send to the parent process any signal
only when they run within the same security domain. If parent or child process
are not in the same domain, kernel will overwrite signal with SIGCHLD value.

However, this check is weak. It is possible for the malicious user to cause an
integer overflow for the value tsk->parent->self_exec_id and bypass this
validation.

Both values, self_exec_id and parent_exec_id are defined in the "task_struct"
structure in file "include/linux/sched.h":

"include/linux/sched.h"
struct task_struct {
        ...
        /* Thread group tracking: */
        u32                             parent_exec_id;
        u32                             self_exec_id;
        ...
}

Linux kernel defines "u32" as "unsigned int" type, which most of the modern
compiler's data model defines as a 32 bits value.

Some curiosities which are interesting to point out:

 1) Linus Torvalds in 2012 suspected that such 'overflow' might be possible.
    You can read more about it here:

    <https://www.openwall.com/lists/kernel-hardening/2012/03/11/4>

 2) Solar Designer in 1999(!) was aware about the problem that 'exit_signal' can
    be abused. The kernel didn't protect it at all at that time. So he came up
    with the idea to introduce those two counters to deal with that problem.
    Originally, these counters were defined as "long long" type. However, during
    the revising between September 14 and September 16, 1999 he switched from
    "long long" to "int" and introduced integer wraparound handling. His patches
    were merged to the kernel 2.0.39 and 2.0.40.

 3) It is worth to read the Solar Designer's message during the discussion about
    the fix for the problem CVE-2012-0056 (I'm referencing this problem later in
    that write-up about "Problem II"):

    <https://www.openwall.com/lists/kernel-hardening/2012/03/11/12>

   Exploitability:

    To be able to cause an integer overflow on self_exec_id or parent_exec_id,
attacker needs to find a way to precisely control that value from the user-mode.
Linux kernel references '*_exec_id' variables just in a few places in the code:

    1) Function do_notify_parent() from "kernel/exit.c"
    2) Function copy_process() from "kernel/fork.c"
    3) Function setup_new_exec() from "fs/exec.c"

Option 1) we already covered. Let's take a look at 2nd case:

"kernel/fork.c"
static __latent_entropy struct task_struct *copy_process(
                                        struct pid *pid,
                                        int trace,
                                        int node,
                                        struct kernel_clone_args *args)
{
        ...
        /* CLONE_PARENT re-uses the old parent */
        if (clone_flags & (CLONE_PARENT|CLONE_THREAD)) {
                p->real_parent = current->real_parent;
                p->parent_exec_id = current->parent_exec_id;
        } else {
                p->real_parent = current;
                p->parent_exec_id = current->self_exec_id;
        }
        ...
}

When mother creates a child process / thread (or in general 'task'), there is
a way to semi-control 'parent_exec_id' value by controlling which process will
be assigned as a 'real_parent'. To be able to do that, an attacker can pass
(or not) a CLONE_PARENT or CLONE_THREAD flag. However, this 'primitive' doesn't
directly allow to bypass the checks in do_notify_parent() function.

The only hope is in option 3:

"fs/exec.c"
void setup_new_exec(struct linux_binprm * bprm)
{
        ...
        current->self_exec_id++;
        flush_signal_handlers(current, 0);
}

Whenever current process executes a new binary, kernel increments "self_exec_id"
variable. There is no validation on the current value, and malicious user can
indirectly set any value for that variable.

However, to be able to bypass validation in do_notify_parent() function,
attacker needs to control parent's "self_exec_id":

                if (tsk->parent_exec_id != tsk->parent->self_exec_id)
                        sig = SIGCHLD;

To achieve that, malicious user must:

 a) Create a mother process
 b) Invoke clone() without CLONE_PARENT neither CLONE_THREAD flag. In such case,
    a new process will get the same values for "parent_exec_id" and
    "self_exec_id" as mother process.
 c) Mother process executes itself as many times as to be able to overflow own
    "self_exec_id" value, and set it to the "original self_exec_id" - 1.
 d) If desired value is acquired, then mother process executes any SUID
    privileged binary. By doing that, mother process will run in much higher
    security domain but the child's "parent_exec_id" will match
    "tsk->parent->self_exec_id" and that leads to bypass of the validation in
    do_notify_parent() function.

It is important to note, that beginning from the version 3.3.5, before kernel
calls setup_new_exec(), function flush_old_exec -> de_thread() will be executed:

"fs/exec.c"
static int de_thread(struct task_struct *tsk)
{
        ...
no_thread_group:
        /* we have changed execution domain */
        tsk->exit_signal = SIGCHLD;
        ...
}

This function overwrites "exit_signal" to always be SIGCHLD. This means that any
"exit_signal" set-up by the mother to the new child process, will be overwriten
as soon as child execs.

A few examples:

1) No execve at all

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |
|   exit_signal =    |
|           SIGCHLD  |
`--------------------`
  ^       |
  |       |
  |       `---> clone(SIGSEGV) --->     tsk2: child
  |                                 ,--------------------,
  |                                 |  self_exec_id = 6  |
  |                                 | parent_exec_id = 6 |
  |                                 |    parent = tsk1   |
  |                                 |   exit_signal =    |
  |                                 |           SIGSEGV  |
  |   original                      `--------------------`
  | "exit_signal"                             |
  |    SIGSEGV                                v
  |                                        exit(...)
  |                                           |
  |                                           v
  |                                    x = tsk2->parent_exec_id = 6
  |                                    y = tsk2->tsk1->self_exec_id = 6
  |                                         x == y
  |                                           |
  |                                           v
  ^------------------------< Deliver original "exit_signal" (SIGSEGV) >

2) child calls execve

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |
|   exit_signal =    |
|           SIGCHLD  |
`--------------------`
  ^       |
  |       |
  |       `---> clone(SIGSEGV) --->     tsk2: child
  |                                 ,--------------------,
  |                                 |  self_exec_id = 6  |
  |                                 | parent_exec_id = 6 |
  |                                 |    parent = tsk1   |
  |                                 |   exit_signal =    |
  |                                 |           SIGSEGV  |
  |   original                      `--------------------`
  | "exit_signal"                             |
  |    SIGCHLD                                v
  |                                        execve(...)
  |                                    exit_signal = SIGCHLD
  |                                           |
  |                                           v
  |                                        exit(...)
  |                                           |
  |                                           v
  |                                    x = tsk2->parent_exec_id = 6
  |                                    y = tsk2->tsk1->self_exec_id = 6
  |                                         x == y
  |                                           |
  |                                           v
  ^------------------------< Deliver overwritten "exit_signal" (SIGCHLD) >

3) mother calls execve

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |----------------------,
|   exit_signal =    |                      |
|           SIGTERM  |                      |
`--------------------`                      |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 v
          v                            clone(SIGSEGV)
     tsk1: mother                           |
,--------------------,                      |
|  self_exec_id = 7  |                      |
| parent_exec_id = 6 |                      |
|   parent = <bash>  |                      |
|   exit_signal =    |                      |
|           SIGCHLD  |                      |
`--------------------`                      |
                                            |
                                            |
                                            |
                                            |
                                            v
                                        tsk2: child
                                    ,--------------------,
                                    |  self_exec_id = 6  |
                                    | parent_exec_id = 6 |
                                    |    parent = tsk1   |
                                    |   exit_signal =    |
                                    |           SIGSEGV  |
                                    `--------------------`
                                              |
                                              v
                                           execve(...)
                                       exit_signal = SIGCHLD
                                              |
                                              v
                                           exit(...)
                                              |
                                              v
                                       x = tsk2->parent_exec_id = 6
                                       y = tsk2->tsk1->self_exec_id = 7
                                            x != y
                                              |
                                              v
                                "exit_signal" will NOT be delivered

4) mother execs as many times as generates an integer overflow (our attack)

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |----------------------,
|   exit_signal =    |                      |
|           SIGTERM  |                      |
`--------------------`                      |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 v
          v                            clone(SIGSEGV)
     tsk1: mother                           |
,--------------------,                      |
|  self_exec_id = 7  |                      |
| parent_exec_id = 6 |                      |
|   parent = <bash>  |                      |
|   exit_signal =    |                      |
|           SIGCHLD  |                      |
`--------------------`                      |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 |
         ...                                |
    "self_exec_id"                          |
      overflows                             |
         ...                                |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 v
          v                             tsk2: child
     tsk1: mother                   ,--------------------,
,--------------------,              |  self_exec_id = 6  |
|  self_exec_id = 5  |              | parent_exec_id = 6 |
| parent_exec_id = 6 |              |    parent = tsk1   |
|   parent = <bash>  |              |   exit_signal =    |
|   exit_signal =    |              |           SIGSEGV  |
|           SIGCHLD  |              `--------------------`
`--------------------`                        |
          |                                   |
          v                                   v
      execve(SUID)                         exit(...)
          |                                   |
          v                                   |
     tsk1: mother                             |
,--------------------,                        |
|  self_exec_id = 6  |                        v
|   parent = <bash>  |                 x = tsk2->parent_exec_id = 6
|   exit_signal =    |                 y = tsk2->tsk1->self_exec_id = 6
|           SIGCHLD  |                      x == y
`--------------------`                        |
  ^   original                                |
  | "exit_signal"                             |
  |    SIGSEGV                                v
  ^------------------------< Deliver original "exit_signal" (SIGSEGV) >

   Proof of Concept (PoC):

    I was able to generate an integer overflow on tsk->parent->self_exec_id and
successfully pass the verification in the "do_notify_parent" function. This
allowed me to send an arbitrary signal to the mother process running in the
different security domain. However, it takes relatively long time to generate
such integer overflow:

 1) test_case 1:
    Machine: VM under Hyper-V hypervisor
    CPU:     2 VCPUs (i7-8850H CPU @ 2.60GHz)
    RAM:     3.4 GB
    OS:      Ubuntu 19.10 (eoan)
    kernel:  5.5.1-050501-generic

    Time to overflow -> 17 days*

 2) test_case 2:
    Machine: Bare-metal
    CPU:     12 CPUs (Xeon(R) E-2176G CPU @ 3.70GHz)
    RAM:     32 GB
    OS:      Ubuntu 18.04.3 LTS (bionic)
    kernel:  4.15.0-72-generic

    Time to overflow -> 7 days*

*) However, my test cases were NOT optimized for speed and it is likely possible
   to reduce amount of time needed for such overflow.

After successful verification that described scenario is possible to achieve,
I've created a kernel module which simplifies my tests and instead of waiting
for a few days to generate an integer overflow, it simulates it. Kernel module
exports 2 IOCTLs:
 1) Dump current process':
    -> current process' task_struct pointer
    -> current process' PID
    -> current process' self_exec_id
    -> current process' parent_exec_id
    -> parent's task_struct pointer
    -> parent's PID
    -> parent's self_exec_id
    -> parent's parent_exec_id
 2) Overwrites parent's self_exec_id with value -100

I've adopted my PoC to leverage new kernel module and immediately simulate
described attack. Here are some notes from my tests:

 -> Ubuntu sets 2 as a default value for /proc/sys/fs/suid_dumpable
    -> This value requires that pattern set in /proc/sys/kernel/core_pattern
       must be either an absolute pathname (starting with a leading '/'
       character) or a pipe.
    -> Ubuntu is shipped with 'apport' package by default. This means that
       crashes are forwarded through pipe to the 'apport'
 -> However, apport throws an unhandled exception in case of ruid != uid, e.g.:

        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: called for pid 12762, signal 11, core limit 0, dump mode 2
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: not creating core for pid with dump mode of 2
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: Unhandled exception:
        Traceback (most recent call last):
          File "/usr/share/apport/apport", line 589, in <module>
            info.add_proc_info(proc_pid_fd=proc_pid_fd)
          File "/usr/lib/python3/dist-packages/apport/report.py", line 548, in add_proc_info
            self['ExecutablePath'] = os.readlink('exe', dir_fd=proc_pid_fd)
        PermissionError: [Errno 13] Permission denied: 'exe'
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: pid: 12773, uid: 1000, gid: 1000, euid: 0, egid: 0
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: environment: environ({})

    This situation is a results of dropped privileges by apport:

        euid = os.geteuid()
        egid = os.getegid()
        try:
            # Drop permissions temporarily to make sure that we don't
            # include information in the crash report that the user should
            # not be allowed to access.
            os.seteuid(os.getuid())
            os.setegid(os.getgid())
            info.add_proc_info(proc_pid_fd=proc_pid_fd)
        finally:
            os.seteuid(euid)
            os.setegid(egid)

 -> If you set 1 as a value for /proc/sys/fs/suid_dumpable (not recommended),
    you are free to fully play with crashdumps.

   Vectors of attack:

    The most obvious attack is to generate a coredump from the higher privileged
processes (like SUID binary). However, most of the modern distros should be
securely configured to protect from the attack using such situation (but I just
verified Ubuntu case).
Nevertheless, SIGSEGV is not the only useful signal to send. It is possible that
some privileged applications (SUID) might change their behavior based on the
signals which they receive. Various apps might implement signal handlers in
a various way which might be exploited using a described kernel bug. More
research is needed in that field.

   Details (Problem II.):

    Until 2012, 'self_exec_id' field (among others) was used to enforce
permissions checking restrictions for /proc/pid/{mem/maps/...} interface.
However, it was done poorly and serious security problem was reported known as
"Mempodipper" (CVE-2012-0056). More details about the bug can be found here:

<https://git.zx2c4.com/CVE-2012-0056/about/>

Linux kernel received a patch for that issue which completely changed the logic
how permission checks are enforced for /proc/pid/{mem/maps/...} interface. It
can be found here:

<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e268337dfe26dfc7efd422a804dbb27977a3cccc>

Since that patch, 'self_exec_id' is not tracked anymore, but kernel is looking
at process' VM during the time of the open(). However, as Solar Designer pointed
out, this logic might generate some problems:

<https://www.openwall.com/lists/oss-security/2012/01/22/5>

In short, if you hold the file descriptor open over an execve() (e.g. share it
with child) the old VM is preserved (refcounted) and might be never released.
Essentially, mother process' VM will be still in memory (and pointer to it is
valid) even if the mother process passed an execve().
This is some kind of 'memory leak' scenario. I did a simple test where process
open /proc/self/maps file and calls clone() with CLONE_FILES flag. Next mother
'overwrite' itself by executing SUID binary (doesn't need to be SUID), and child
was still able to use the original file descriptor - it's valid.

Nevertheless, I didn't explore that problem more. Maybe it is worth to do so?
Suspected resource limits bypass, to be confirmed or disproved with further
research.

Another interesting curiosity which is worth to point out about Problem II is
the Alan Cox's message sent during the discussion on the fix for CVE-2012-0056:

<https://www.openwall.com/lists/kernel-hardening/2012/03/11/13>

   Affected Software:

    Almost all Linux kernels should be affected. However, currently tested logic
is available since 3.3.5 up to the latest one (5.5.8).
Kernels 2.0.39 and 2.0.40 looks secure ;-)

Best regards,
Adam 'pi3' Zabrocki

--
pi3 (pi3ki31ny) - pi3 (at) itsec pl
<http://pi3.com.pl>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.debian.org_e8a44d58_20250119_114841.html ===


---

[[Date Prev](msg00010.html)][[Date Next](msg00012.html)]
[[Thread Prev](msg00010.html)][[Thread Next](msg00012.html)]
[[Date Index](maillist.html#00011)]
[[Thread Index](threads.html#00011)]

# [SECURITY] [DLA 2241-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2241-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Tue, 09 Jun 2020 22:29:32 +0100
* *Message-id*: <[[🔎]](/msgid-search/1747f9196b0ccb9346b57f15681d74c04217c837.camel%40debian.org) [1747f9196b0ccb9346b57f15681d74c04217c837.camel@debian.org](msg00011.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux
Version        : 3.16.84-1
CVE ID         : CVE-2015-8839 CVE-2018-14610 CVE-2018-14611 CVE-2018-14612
                 CVE-2018-14613 CVE-2019-5108 CVE-2019-19319 CVE-2019-19447
                 CVE-2019-19768 CVE-2019-20636 CVE-2020-0009 CVE-2020-0543
                 CVE-2020-1749 CVE-2020-2732 CVE-2020-8647 CVE-2020-8648
                 CVE-2020-8649 CVE-2020-9383 CVE-2020-10690 CVE-2020-10751
                 CVE-2020-10942 CVE-2020-11494 CVE-2020-11565 CVE-2020-11608
                 CVE-2020-11609 CVE-2020-11668 CVE-2020-12114 CVE-2020-12464
                 CVE-2020-12652 CVE-2020-12653 CVE-2020-12654 CVE-2020-12769
                 CVE-2020-12770 CVE-2020-12826 CVE-2020-13143

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2015-8839

    A race condition was found in the ext4 filesystem implementation.
    A local user could exploit this to cause a denial of service
    (filesystem corruption).

CVE-2018-14610, CVE-2018-14611, CVE-2018-14612, CVE-2018-14613

    Wen Xu from SSLab at Gatech reported that crafted Btrfs volumes
    could trigger a crash (Oops) and/or out-of-bounds memory access.
    An attacker able to mount such a volume could use this to cause a
    denial of service or possibly for privilege escalation.

CVE-2019-5108

    Mitchell Frank of Cisco discovered that when the IEEE 802.11
    (WiFi) stack was used in AP mode with roaming, it would trigger
    roaming for a newly associated station before the station was
    authenticated.  An attacker within range of the AP could use this
    to cause a denial of service, either by filling up a switching
    table or by redirecting traffic away from other stations.

CVE-2019-19319

    Jungyeon discovered that a crafted filesystem can cause the ext4
    implementation to deallocate or reallocate journal blocks.  A user
    permitted to mount filesystems could use this to cause a denial of
    service (crash), or possibly for privilege escalation.

CVE-2019-19447

    It was discovered that the ext4 filesystem driver did not safely
    handle unlinking of an inode that, due to filesystem corruption,
    already has a link count of 0.  An attacker able to mount
    arbitrary ext4 volumes could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-19768

    Tristan Madani reported a race condition in the blktrace debug
    facility that could result in a use-after-free.  A local user able
    to trigger removal of block devices could possibly use this to
    cause a denial of service (crash) or for privilege escalation.

CVE-2019-20636

    The syzbot tool found that the input subsystem did not fully
    validate keycode changes, which could result in a heap
    out-of-bounds write.  A local user permitted to access the device
    node for an input or VT device could possibly use this to cause a
    denial of service (crash or memory corruption) or for privilege
    escalation.

CVE-2020-0009

    Jann Horn reported that the Android ashmem driver did not prevent
    read-only files from being memory-mapped and then remapped as
    read-write.  However, Android drivers are not enabled in Debian
    kernel configurations.

CVE-2020-0543

    Researchers at VU Amsterdam discovered that on some Intel CPUs
    supporting the RDRAND and RDSEED instructions, part of a random
    value generated by these instructions may be used in a later
    speculative execution on any core of the same physical CPU.
    Depending on how these instructions are used by applications, a
    local user or VM guest could use this to obtain sensitive
    information such as cryptographic keys from other users or VMs.

    This vulnerability can be mitigated by a microcode update, either
    as part of system firmware (BIOS) or through the intel-microcode
    package in Debian's non-free archive section.  This kernel update
    only provides reporting of the vulnerability and the option to
    disable the mitigation if it is not needed.

CVE-2020-1749

    Xiumei Mu reported that some network protocols that can run on top
    of IPv6 would bypass the Transformation (XFRM) layer used by
    IPsec, IPcomp/IPcomp6, IPIP, and IPv6 Mobility.  This could result
    in disclosure of information over the network, since it would not
    be encrypted or routed according to the system policy.

CVE-2020-2732

    Paulo Bonzini discovered that the KVM implementation for Intel
    processors did not properly handle instruction emulation for L2
    guests when nested virtualization is enabled. This could allow an
    L2 guest to cause privilege escalation, denial of service, or
    information leaks in the L1 guest.

CVE-2020-8647, CVE-2020-8649

    The Hulk Robot tool found a potential MMIO out-of-bounds access in
    the vgacon driver.  A local user permitted to access a virtual
    terminal (/dev/tty1 etc.) on a system using the vgacon driver
    could use this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2020-8648

    The syzbot tool found a race condition in the the virtual terminal
    driver, which could result in a use-after-free.  A local user
    permitted to access a virtual terminal could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2020-9383

    Jordy Zomer reported an incorrect range check in the floppy driver
    which could lead to a static out-of-bounds access.  A local user
    permitted to access a floppy drive could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2020-10690

    It was discovered that the PTP hardware clock subsystem did not
    properly manage device lifetimes.  Removing a PTP hardware clock
    from the system while a user process was using it could lead to a
    use-after-free.  The security impact of this is unclear.

CVE-2020-10751

    Dmitry Vyukov reported that the SELinux subsystem did not properly
    handle validating multiple messages, which could allow a privileged
    attacker to bypass SELinux netlink restrictions.

CVE-2020-10942

    It was discovered that the vhost_net driver did not properly
    validate the type of sockets set as back-ends. A local user
    permitted to access /dev/vhost-net could use this to cause a stack
    corruption via crafted system calls, resulting in denial of
    service (crash) or possibly privilege escalation.

CVE-2020-11494

    It was discovered that the slcan (serial line CAN) network driver
    did not fully initialise CAN headers for received packets,
    resulting in an information leak from the kernel to user-space or
    over the CAN network.

CVE-2020-11565

    Entropy Moe reported that the shared memory filesystem (tmpfs) did
    not correctly handle an "mpol" mount option specifying an empty
    node list, leading to a stack-based out-of-bounds write. If user
    namespaces are enabled, a local user could use this to cause a
    denial of service (crash) or possibly for privilege escalation.

CVE-2020-11608, CVE-2020-11609, CVE-2020-11668

    It was discovered that the ov519, stv06xx, and xirlink_cit media
    drivers did not properly validate USB device descriptors.  A
    physically present user with a specially constructed USB device
    could use this to cause a denial-of-service (crash) or possibly
    for privilege escalation.

CVE-2020-12114

    Piotr Krysiuk discovered a race condition between the umount and
    pivot_root operations in the filesystem core (vfs).  A local user
    with the CAP_SYS_ADMIN capability in any user namespace could use
    this to cause a denial of service (crash).

CVE-2020-12464

    Kyungtae Kim reported a race condition in the USB core that can
    result in a use-after-free.  It is not clear how this can be
    exploited, but it could result in a denial of service (crash or
    memory corruption) or privilege escalation.

CVE-2020-12652

    Tom Hatskevich reported a bug in the mptfusion storage drivers.
    An ioctl handler fetched a parameter from user memory twice,
    creating a race condition which could result in incorrect locking
    of internal data structures.  A local user permitted to access
    /dev/mptctl could use this to cause a denial of service (crash or
    memory corruption) or for privilege escalation.

CVE-2020-12653

    It was discovered that the mwifiex WiFi driver did not
    sufficiently validate scan requests, resulting a potential heap
    buffer overflow.  A local user with CAP_NET_ADMIN capability could
    use this to cause a denial of service (crash or memory corruption)
    or possibly for privilege escalation.

CVE-2020-12654

    It was discovered that the mwifiex WiFi driver did not
    sufficiently validate WMM parameters received from an access point
    (AP), resulting a potential heap buffer overflow.  A malicious AP
    could use this to cause a denial of service (crash or memory
    corruption) or possibly to execute code on a vulnerable system.

CVE-2020-12769

    It was discovered that the spi-dw SPI host driver did not properly
    serialise access to its internal state.  The security impact of
    this is unclear, and this driver is not included in Debian's
    binary packages.

CVE-2020-12770

    It was discovered that the sg (SCSI generic) driver did not
    correctly release internal resources in a particular error case.
    A local user permitted to access an sg device could possibly use
    this to cause a denial of service (resource exhaustion).

CVE-2020-12826

    Adam Zabrocki reported a weakness in the signal subsystem's
    permission checks.  A parent process can choose an arbitary signal
    for a child process to send when it exits, but if the parent has
    executed a new program then the default SIGCHLD signal is sent.  A
    local user permitted to run a program for several days could
    bypass this check, execute a setuid program, and then send an
    arbitrary signal to it.  Depending on the setuid programs
    installed, this could have some security impact.

CVE-2020-13143

    Kyungtae Kim reported a potential heap out-of-bounds write in
    the USB gadget subsystem.  A local user permitted to write to
    the gadget configuration filesystem could use this to cause a
    denial of service (crash or memory corruption) or potentially
    for privilege escalation.

For Debian 8 "Jessie", these problems have been fixed in version
3.16.84-1.

We recommend that you upgrade your linux packages.  Binary packages for
the EABI ARM (armel) architecture are not yet available, and a separate
announcement will be made when they are.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpvpMY1PuWto.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from cdn.kernel.org_b131dd65_20250119_114840.html ===
commit f07f08b09f05e371d988f83f06d41be4551bc68b
Author: Greg Kroah-Hartman
Date: Fri Apr 17 16:13:49 2020 +0200
Linux 5.6.5
commit 724170c2df5b4a21ad41c911b9b0594e10c47a43
Author: Julia Lawall
Date: Sun Apr 5 17:03:48 2020 +0200
ASoC: stm32: sai: Add missing cleanup
[ Upstream commit 7506baeed8d05fc164254c64af14cfed2ac14446 ]
The commit 0d6defc7e0e4 ("ASoC: stm32: sai: manage rebind issue")
converts some function calls to their non-devm equivalents. The
appropriate cleanup code was added to the remove function, but not
to the probe function. Add a call to snd\_dmaengine\_pcm\_unregister
to compensate for the call to snd\_dmaengine\_pcm\_register in case
of subsequent failure.
Fixes: commit 0d6defc7e0e4 ("ASoC: stm32: sai: manage rebind issue")
Signed-off-by: Julia Lawall
Acked-by: Olivier Moysan
Link: https://lore.kernel.org/r/1586099028-5104-1-git-send-email-Julia.Lawall@inria.fr
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
commit b5887920dbe9777858fe02cf56e75a1142a40d09
Author: Gary Lin
Date: Thu Apr 9 15:04:33 2020 +0200
efi/x86: Fix the deletion of variables in mixed mode
[ Upstream commit a4b81ccfd4caba017d2b84720b6de4edd16911a0 ]
efi\_thunk\_set\_variable() treated the NULL "data" pointer as an invalid
parameter, and this broke the deletion of variables in mixed mode.
This commit fixes the check of data so that the userspace program can
delete a variable in mixed mode.
Fixes: 8319e9d5ad98ffcc ("efi/x86: Handle by-ref arguments covering multiple pages in mixed mode")
Signed-off-by: Gary Lin
Signed-off-by: Ard Biesheuvel
Signed-off-by: Ingo Molnar
Link: https://lore.kernel.org/r/20200408081606.1504-1-glin@suse.com
Link: https://lore.kernel.org/r/20200409130434.6736-9-ardb@kernel.org
Signed-off-by: Sasha Levin
commit e176f1d1a503bfa00f04201a24e82028a4af37fb
Author: Andy Shevchenko
Date: Wed Feb 26 16:51:58 2020 +0200
mfd: dln2: Fix sanity checking for endpoints
[ Upstream commit fb945c95a482200876993977008b67ea658bd938 ]
While the commit 2b8bd606b1e6 ("mfd: dln2: More sanity checking for endpoints")
tries to harden the sanity checks it made at the same time a regression,
i.e. mixed in and out endpoints. Obviously it should have been not tested on
real hardware at that time, but unluckily it didn't happen.
So, fix above mentioned typo and make device being enumerated again.
While here, introduce an enumerator for magic values to prevent similar issue
to happen in the future.
Fixes: 2b8bd606b1e6 ("mfd: dln2: More sanity checking for endpoints")
Cc: Oliver Neukum
Cc: Greg Kroah-Hartman
Signed-off-by: Andy Shevchenko
Signed-off-by: Lee Jones
Signed-off-by: Sasha Levin
commit 98666f218f188f9cbd60560cc40eb4c4bdb67c0b
Author: Jann Horn
Date: Mon Mar 30 18:03:23 2020 +0200
bpf: Fix tnum constraints for 32-bit comparisons
[ Upstream commit 604dca5e3af1db98bd123b7bfc02b017af99e3a0 ]
The BPF verifier tried to track values based on 32-bit comparisons by
(ab)using the tnum state via 581738a681b6 ("bpf: Provide better register
bounds after jmp32 instructions"). The idea is that after a check like
this:
if ((u32)r0 > 3)
exit
We can't meaningfully constrain the arithmetic-range-based tracking, but
we can update the tnum state to (value=0,mask=0xffff'ffff'0000'0003).
However, the implementation from 581738a681b6 didn't compute the tnum
constraint based on the fixed operand, but instead derives it from the
arithmetic-range-based tracking. This means that after the following
sequence of operations:
if (r0 >= 0x1'0000'0001)
exit
if ((u32)r0 > 7)
exit
The verifier assumed that the lower half of r0 is in the range (0, 0)
and apply the tnum constraint (value=0,mask=0xffff'ffff'0000'0000) thus
causing the overall tnum to be (value=0,mask=0x1'0000'0000), which was
incorrect. Provide a fixed implementation.
Fixes: 581738a681b6 ("bpf: Provide better register bounds after jmp32 instructions")
Signed-off-by: Jann Horn
Signed-off-by: Daniel Borkmann
Signed-off-by: Alexei Starovoitov
Link: https://lore.kernel.org/bpf/20200330160324.15259-3-daniel@iogearbox.net
Signed-off-by: Sasha Levin
commit 3915e383f7cd70c2ccb885ae8c38568f172fd293
Author: Christophe Leroy
Date: Fri Mar 6 15:09:40 2020 +0000
powerpc/kasan: Fix kasan\_remap\_early\_shadow\_ro()
[ Upstream commit af92bad615be75c6c0d1b1c5b48178360250a187 ]
At the moment kasan\_remap\_early\_shadow\_ro() does nothing, because
k\_end is 0 and k\_cur < 0 is always true.
Change the test to k\_cur != k\_end, as done in
kasan\_init\_shadow\_page\_tables()
Signed-off-by: Christophe Leroy
Fixes: cbd18991e24f ("powerpc/mm: Fix an Oops in kasan\_mmu\_init()")
Cc: stable@vger.kernel.org
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/4e7b56865e01569058914c991143f5961b5d4719.1583507333.git.christophe.leroy@c-s.fr
Signed-off-by: Sasha Levin
commit 0678087c6134e2d7ded9b26780ed68759bb0fc6d
Author: Peter Zijlstra
Date: Wed Aug 7 11:45:01 2019 +0200
perf/core: Remove 'struct sched\_in\_data'
[ Upstream commit 2c2366c7548ecee65adfd264517ddf50f9e2d029 ]
We can deduce the ctx and cpuctx from the event, no need to pass them
along. Remove the structure and pass in can\_add\_hw directly.
Signed-off-by: Peter Zijlstra (Intel)
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 7af133a2d686578c3dcb94ad8a10ec47a4771853
Author: Peter Zijlstra
Date: Wed Mar 18 20:33:37 2020 +0100
perf/core: Fix event cgroup tracking
[ Upstream commit 33238c50451596be86db1505ab65fee5172844d0 ]
Song reports that installing cgroup events is broken since:
db0503e4f675 ("perf/core: Optimize perf\_install\_in\_event()")
The problem being that cgroup events try to track cpuctx->cgrp even
for disabled events, which is pointless and actively harmful since the
above commit. Rework the code to have explicit enable/disable hooks
for cgroup events, such that we can limit cgroup tracking to active
events.
More specifically, since the above commit disabled events are no
longer added to their context from the 'right' CPU, and we can't
access things like the current cgroup for a remote CPU.
Cc:  # v5.5+
Fixes: db0503e4f675 ("perf/core: Optimize perf\_install\_in\_event()")
Reported-by: Song Liu
Tested-by: Song Liu
Reviewed-by: Song Liu
Signed-off-by: Peter Zijlstra (Intel)
Signed-off-by: Ingo Molnar
Link: https://lkml.kernel.org/r/20200318193337.GB20760@hirez.programming.kicks-ass.net
Signed-off-by: Sasha Levin
commit ad3c96b0b3cbb8f95ade40cec777b4fdac720ff8
Author: Peter Zijlstra
Date: Wed Aug 7 11:17:00 2019 +0200
perf/core: Unify {pinned,flexible}\_sched\_in()
[ Upstream commit ab6f824cfdf7363b5e529621cbc72ae6519c78d1 ]
Less is more; unify the two very nearly identical function.
Signed-off-by: Peter Zijlstra (Intel)
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 6880d00ea4c64a9f5d4f29fbe30cb8bfe635e804
Author: Chris Wilson
Date: Tue Mar 31 16:23:48 2020 +0100
drm/i915/gt: Fill all the unused space in the GGTT
[ Upstream commit 0b72a251bf92ca2378530fa1f9b35a71830ab51c ]
When we allocate space in the GGTT we may have to allocate a larger
region than will be populated by the object to accommodate fencing. Make
sure that this space beyond the end of the buffer points safely into
scratch space, in case the HW tries to access it anyway (e.g. fenced
access to the last tile row).
v2: Preemptively / conservatively guard gen6 ggtt as well.
Reported-by: Imre Deak
References: https://gitlab.freedesktop.org/drm/intel/-/issues/1554
Signed-off-by: Chris Wilson
Cc: Matthew Auld
Cc: Imre Deak
Cc: stable@vger.kernel.org
Reviewed-by: Matthew Auld
Reviewed-by: Imre Deak
Link: https://patchwork.freedesktop.org/patch/msgid/20200331152348.26946-1-chris@chris-wilson.co.uk
(cherry picked from commit 4d6c18590870fbac1e65dde5e01e621c8e0ca096)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Sasha Levin
commit 79dbe6fbdd4606acabc9df266018046b75b62cdc
Author: Daniele Ceraolo Spurio
Date: Wed Feb 26 10:56:57 2020 -0800
drm/i915/ggtt: do not set bits 1-11 in gen12 ptes
[ Upstream commit 69edc390a54268d41e45089cb972bf71510f5f07 ]
On TGL, bits 2-4 in the GGTT PTE are not ignored anymore and are
instead used for some extra VT-d capabilities. We don't (yet?) have
support for those capabilities, but, given that we shared the pte\_encode
function betweed GGTT and PPGTT, we still set those bits to the PPGTT
PPAT values. The DMA engine gets very confused when those bits are
set while the iommu is enabled, leading to errors. E.g. when loading
the GuC we get:
[ 9.796218] DMAR: DRHD: handling fault status reg 2
[ 9.796235] DMAR: [DMA Write] Request device [00:02.0] PASID ffffffff fault addr 0 [fault reason 02] Present bit in context entry is clear
[ 9.899215] [drm:intel\_guc\_fw\_upload [i915]] \*ERROR\* GuC firmware signature verification failed
To fix this, just have dedicated gen8\_pte\_encode function per type of
gtt. Also, explicitly set vm->pte\_encode for gen8\_ppgtt, even if we
don't use it, to make sure we don't accidentally assign it to the GGTT
one, like we do for gen6\_ppgtt, in case we need it in the future.
Reported-by: "Sodhi, Vunny"
Signed-off-by: Daniele Ceraolo Spurio
Cc: Chris Wilson
Cc: Mika Kuoppala
Cc: Matthew Auld
Cc: Michal Wajdeczko
Reviewed-by: Mika Kuoppala
Signed-off-by: Chris Wilson
Link: https://patchwork.freedesktop.org/patch/msgid/20200226185657.26445-1-daniele.ceraolospurio@intel.com
Signed-off-by: Sasha Levin
commit a1f57b87ddcc869b576aca73608f35cb436c3fdc
Author: Prike Liang
Date: Tue Apr 7 20:21:26 2020 +0800
drm/amdgpu: fix gfx hang during suspend with video playback (v2)
[ Upstream commit 487eca11a321ef33bcf4ca5adb3c0c4954db1b58 ]
The system will be hang up during S3 suspend because of SMU is pending
for GC not respose the register CP\_HQD\_ACTIVE access request.This issue
root cause of accessing the GC register under enter GFX CGGPG and can
be fixed by disable GFX CGPG before perform suspend.
v2: Use disable the GFX CGPG instead of RLC safe mode guard.
Signed-off-by: Prike Liang
Tested-by: Mengbing Wang
Reviewed-by: Huang Rui
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Sasha Levin
commit f9613df38f0804fac20fcf985d131cdb5c2ead41
Author: Lyude Paul
Date: Wed Jan 22 14:43:20 2020 -0500
drm/dp\_mst: Fix clearing payload state on topology disable
[ Upstream commit 8732fe46b20c951493bfc4dba0ad08efdf41de81 ]
The issues caused by:
commit 64e62bdf04ab ("drm/dp\_mst: Remove VCPI while disabling topology
mgr")
Prompted me to take a closer look at how we clear the payload state in
general when disabling the topology, and it turns out there's actually
two subtle issues here.
The first is that we're not grabbing &mgr.payload\_lock when clearing the
payloads in drm\_dp\_mst\_topology\_mgr\_set\_mst(). Seeing as the canonical
lock order is &mgr.payload\_lock -> &mgr.lock (because we always want
&mgr.lock to be the inner-most lock so topology validation always
works), this makes perfect sense. It also means that -technically- there
could be racing between someone calling
drm\_dp\_mst\_topology\_mgr\_set\_mst() to disable the topology, along with a
modeset occurring that's modifying the payload state at the same time.
The second is the more obvious issue that Wayne Lin discovered, that
we're not clearing proposed\_payloads when disabling the topology.
I actually can't see any obvious places where the racing caused by the
first issue would break something, and it could be that some of our
higher-level locks already prevent this by happenstance, but better safe
then sorry. So, let's make it so that drm\_dp\_mst\_topology\_mgr\_set\_mst()
first grabs &mgr.payload\_lock followed by &mgr.lock so that we never
race when modifying the payload state. Then, we also clear
proposed\_payloads to fix the original issue of enabling a new topology
with a dirty payload state. This doesn't clear any of the drm\_dp\_vcpi
structures, but those are getting destroyed along with the ports anyway.
Changes since v1:
\* Use sizeof(mgr->payloads[0])/sizeof(mgr->proposed\_vcpis[0]) instead -
vsyrjala
Cc: Sean Paul
Cc: Wayne Lin
Cc: Ville Syrjälä
Cc: stable@vger.kernel.org # v4.4+
Signed-off-by: Lyude Paul
Reviewed-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20200122194321.14953-1-lyude@redhat.com
Signed-off-by: Sasha Levin
commit a048bb435d30cd90a37be09de729c8b5882b22a4
Author: Lyude Paul
Date: Fri Jan 17 15:51:49 2020 -0500
Revert "drm/dp\_mst: Remove VCPI while disabling topology mgr"
[ Upstream commit a86675968e2300fb567994459da3dbc4cd1b322a ]
This reverts commit 64e62bdf04ab8529f45ed0a85122c703035dec3a.
This commit ends up causing some lockdep splats due to trying to grab the
payload lock while holding the mgr's lock:
[ 54.010099]
[ 54.011765] ======================================================
[ 54.018670] WARNING: possible circular locking dependency detected
[ 54.025577] 5.5.0-rc6-02274-g77381c23ee63 #47 Not tainted
[ 54.031610] ------------------------------------------------------
[ 54.038516] kworker/1:6/1040 is trying to acquire lock:
[ 54.044354] ffff888272af3228 (&mgr->payload\_lock){+.+.}, at:
drm\_dp\_mst\_topology\_mgr\_set\_mst+0x218/0x2e4
[ 54.054957]
[ 54.054957] but task is already holding lock:
[ 54.061473] ffff888272af3060 (&mgr->lock){+.+.}, at:
drm\_dp\_mst\_topology\_mgr\_set\_mst+0x3c/0x2e4
[ 54.071193]
[ 54.071193] which lock already depends on the new lock.
[ 54.071193]
[ 54.080334]
[ 54.080334] the existing dependency chain (in reverse order) is:
[ 54.088697]
[ 54.088697] -> #1 (&mgr->lock){+.+.}:
[ 54.094440] \_\_mutex\_lock+0xc3/0x498
[ 54.099015] drm\_dp\_mst\_topology\_get\_port\_validated+0x25/0x80
[ 54.106018] drm\_dp\_update\_payload\_part1+0xa2/0x2e2
[ 54.112051] intel\_mst\_pre\_enable\_dp+0x144/0x18f
[ 54.117791] intel\_encoders\_pre\_enable+0x63/0x70
[ 54.123532] hsw\_crtc\_enable+0xa1/0x722
[ 54.128396] intel\_update\_crtc+0x50/0x194
[ 54.133455] skl\_commit\_modeset\_enables+0x40c/0x540
[ 54.139485] intel\_atomic\_commit\_tail+0x5f7/0x130d
[ 54.145418] intel\_atomic\_commit+0x2c8/0x2d8
[ 54.150770] drm\_atomic\_helper\_set\_config+0x5a/0x70
[ 54.156801] drm\_mode\_setcrtc+0x2ab/0x833
[ 54.161862] drm\_ioctl+0x2e5/0x424
[ 54.166242] vfs\_ioctl+0x21/0x2f
[ 54.170426] do\_vfs\_ioctl+0x5fb/0x61e
[ 54.175096] ksys\_ioctl+0x55/0x75
[ 54.179377] \_\_x64\_sys\_ioctl+0x1a/0x1e
[ 54.184146] do\_syscall\_64+0x5c/0x6d
[ 54.188721] entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
[ 54.194946]
[ 54.194946] -> #0 (&mgr->payload\_lock){+.+.}:
[ 54.201463]
[ 54.201463] other info that might help us debug this:
[ 54.201463]
[ 54.210410] Possible unsafe locking scenario:
[ 54.210410]
[ 54.217025] CPU0 CPU1
[ 54.222082] ---- ----
[ 54.227138] lock(&mgr->lock);
[ 54.230643] lock(&mgr->payload\_lock);
[ 54.237742] lock(&mgr->lock);
[ 54.244062] lock(&mgr->payload\_lock);
[ 54.248346]
[ 54.248346] \*\*\* DEADLOCK \*\*\*
[ 54.248346]
[ 54.254959] 7 locks held by kworker/1:6/1040:
[ 54.259822] #0: ffff888275c4f528 ((wq\_completion)events){+.+.},
at: worker\_thread+0x455/0x6e2
[ 54.269451] #1: ffffc9000119beb0
((work\_completion)(&(&dev\_priv->hotplug.hotplug\_work)->work)){+.+.},
at: worker\_thread+0x455/0x6e2
[ 54.282768] #2: ffff888272a403f0 (&dev->mode\_config.mutex){+.+.},
at: i915\_hotplug\_work\_func+0x4b/0x2be
[ 54.293368] #3: ffffffff824fc6c0 (drm\_connector\_list\_iter){.+.+},
at: i915\_hotplug\_work\_func+0x17e/0x2be
[ 54.304061] #4: ffffc9000119bc58 (crtc\_ww\_class\_acquire){+.+.},
at: drm\_helper\_probe\_detect\_ctx+0x40/0xfd
[ 54.314855] #5: ffff888272a40470 (crtc\_ww\_class\_mutex){+.+.}, at:
drm\_modeset\_lock+0x74/0xe2
[ 54.324385] #6: ffff888272af3060 (&mgr->lock){+.+.}, at:
drm\_dp\_mst\_topology\_mgr\_set\_mst+0x3c/0x2e4
[ 54.334597]
[ 54.334597] stack backtrace:
[ 54.339464] CPU: 1 PID: 1040 Comm: kworker/1:6 Not tainted
5.5.0-rc6-02274-g77381c23ee63 #47
[ 54.348893] Hardware name: Google Fizz/Fizz, BIOS
Google\_Fizz.10139.39.0 01/04/2018
[ 54.357451] Workqueue: events i915\_hotplug\_work\_func
[ 54.362995] Call Trace:
[ 54.365724] dump\_stack+0x71/0x9c
[ 54.369427] check\_noncircular+0x91/0xbc
[ 54.373809] ? \_\_lock\_acquire+0xc9e/0xf66
[ 54.378286] ? \_\_lock\_acquire+0xc9e/0xf66
[ 54.382763] ? lock\_acquire+0x175/0x1ac
[ 54.387048] ? drm\_dp\_mst\_topology\_mgr\_set\_mst+0x218/0x2e4
[ 54.393177] ? \_\_mutex\_lock+0xc3/0x498
[ 54.397362] ? drm\_dp\_mst\_topology\_mgr\_set\_mst+0x218/0x2e4
[ 54.403492] ? drm\_dp\_mst\_topology\_mgr\_set\_mst+0x218/0x2e4
[ 54.409620] ? drm\_dp\_dpcd\_access+0xd9/0x101
[ 54.414390] ? drm\_dp\_mst\_topology\_mgr\_set\_mst+0x218/0x2e4
[ 54.420517] ? drm\_dp\_mst\_topology\_mgr\_set\_mst+0x218/0x2e4
[ 54.426645] ? intel\_digital\_port\_connected+0x34d/0x35c
[ 54.432482] ? intel\_dp\_detect+0x227/0x44e
[ 54.437056] ? ww\_mutex\_lock+0x49/0x9a
[ 54.441242] ? drm\_helper\_probe\_detect\_ctx+0x75/0xfd
[ 54.446789] ? intel\_encoder\_hotplug+0x4b/0x97
[ 54.451752] ? intel\_ddi\_hotplug+0x61/0x2e0
[ 54.456423] ? mark\_held\_locks+0x53/0x68
[ 54.460803] ? \_raw\_spin\_unlock\_irqrestore+0x3a/0x51
[ 54.466347] ? lockdep\_hardirqs\_on+0x187/0x1a4
[ 54.471310] ? drm\_connector\_list\_iter\_next+0x89/0x9a
[ 54.476953] ? i915\_hotplug\_work\_func+0x206/0x2be
[ 54.482208] ? worker\_thread+0x4d5/0x6e2
[ 54.486587] ? worker\_thread+0x455/0x6e2
[ 54.490966] ? queue\_work\_on+0x64/0x64
[ 54.495151] ? kthread+0x1e9/0x1f1
[ 54.498946] ? queue\_work\_on+0x64/0x64
[ 54.503130] ? kthread\_unpark+0x5e/0x5e
[ 54.507413] ? ret\_from\_fork+0x3a/0x50
The proper fix for this is probably cleanup the VCPI allocations when we're
enabling the topology, or on the first payload allocation. For now though,
let's just revert.
Signed-off-by: Lyude Paul
Fixes: 64e62bdf04ab ("drm/dp\_mst: Remove VCPI while disabling topology mgr")
Cc: Sean Paul
Cc: Wayne Lin
Reviewed-by: Sean Paul
Link: https://patchwork.freedesktop.org/patch/msgid/20200117205149.97262-1-lyude@redhat.com
Signed-off-by: Sasha Levin
commit 3a847af82de44e71244950e40f464911032b969b
Author: Mark Brown
Date: Tue Mar 31 20:44:59 2020 +0100
arm64: Always force a branch protection mode when the compiler has one
commit b8fdef311a0bd9223f10754f94fdcf1a594a3457 upstream.
Compilers with branch protection support can be configured to enable it by
default, it is likely that distributions will do this as part of deploying
branch protection system wide. As well as the slight overhead from having
some extra NOPs for unused branch protection features this can cause more
serious problems when the kernel is providing pointer authentication to
userspace but not built for pointer authentication itself. In that case our
switching of keys for userspace can affect the kernel unexpectedly, causing
pointer authentication instructions in the kernel to corrupt addresses.
To ensure that we get consistent and reliable behaviour always explicitly
initialise the branch protection mode, ensuring that the kernel is built
the same way regardless of the compiler defaults.
[This is a reworked version of b8fdef311a0bd9223f1075 ("arm64: Always
force a branch protection mode when the compiler has one") for backport.
Kernels prior to 74afda4016a7 ("arm64: compile the kernel with ptrauth
return address signing") don't have any Makefile machinery for forcing
on pointer auth but still have issues if the compiler defaults it on so
need this reworked version. -- broonie]
Fixes: 7503197562567 (arm64: add basic pointer authentication support)
Reported-by: Szabolcs Nagy
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
[catalin.marinas@arm.com: remove Kconfig option in favour of Makefile check]
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit a39f676c9d8483a04619cc1a1b923bd4622de4f6
Author: Michael Ellerman
Date: Fri Mar 20 14:21:16 2020 +1100
powerpc/64: Prevent stack protection in early boot
commit 7053f80d96967d8e72e9f2a724bbfc3906ce2b07 upstream.
The previous commit reduced the amount of code that is run before we
setup a paca. However there are still a few remaining functions that
run with no paca, or worse, with an arbitrary value in r13 that will
be used as a paca pointer.
In particular the stack protector canary is stored in the paca, so if
stack protector is activated for any of these functions we will read
the stack canary from wherever r13 points. If r13 happens to point
outside of memory we will get a machine check / checkstop.
For example if we modify initialise\_paca() to trigger stack
protection, and then boot in the mambo simulator with r13 poisoned in
skiboot before calling the kernel:
DEBUG: 19952232: (19952232): INSTRUCTION: PC=0xC0000000191FC1E8: [0x3C4C006D]: addis r2,r12,0x6D [fetch]
DEBUG: 19952236: (19952236): INSTRUCTION: PC=0xC00000001807EAD8: [0x7D8802A6]: mflr r12 [fetch]
FATAL ERROR: 19952276: (19952276): Check Stop for 0:0: Machine Check with ME bit of MSR off
DEBUG: 19952276: (19952276): INSTRUCTION: PC=0xC0000000191FCA7C: [0xE90D0CF8]: ld r8,0xCF8(r13) [Instruction Failed]
INFO: 19952276: (19952277): \*\* Execution stopped: Mambo Error, Machine Check Stop, \*\*
systemsim % bt
pc: 0xC0000000191FCA7C initialise\_paca+0x54
lr: 0xC0000000191FC22C early\_setup+0x44
stack:0x00000000198CBED0 0x0 +0x0
stack:0x00000000198CBF00 0xC0000000191FC22C early\_setup+0x44
stack:0x00000000198CBF90 0x1801C968 +0x1801C968
So annotate the relevant functions to ensure stack protection is never
enabled for them.
Fixes: 06ec27aea9fc ("powerpc/64: add stack protector support")
Cc: stable@vger.kernel.org # v4.20+
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200320032116.1024773-2-mpe@ellerman.id.au
Signed-off-by: Greg Kroah-Hartman
commit 35031e72284839d2e53765bd63420bed3248c43c
Author: Christophe Leroy
Date: Tue Feb 18 19:38:27 2020 +0000
powerpc/kprobes: Ignore traps that happened in real mode
commit 21f8b2fa3ca5b01f7a2b51b89ce97a3705a15aa0 upstream.
When a program check exception happens while MMU translation is
disabled, following Oops happens in kprobe\_handler() in the following
code:
} else if (\*addr != BREAKPOINT\_INSTRUCTION) {
BUG: Unable to handle kernel data access on read at 0x0000e268
Faulting instruction address: 0xc000ec34
Oops: Kernel access of bad area, sig: 11 [#1]
BE PAGE\_SIZE=16K PREEMPT CMPC885
Modules linked in:
CPU: 0 PID: 429 Comm: cat Not tainted 5.6.0-rc1-s3k-dev-00824-g84195dc6c58a #3267
NIP: c000ec34 LR: c000ecd8 CTR: c019cab8
REGS: ca4d3b58 TRAP: 0300 Not tainted (5.6.0-rc1-s3k-dev-00824-g84195dc6c58a)
MSR: 00001032  CR: 2a4d3c52 XER: 00000000
DAR: 0000e268 DSISR: c0000000
GPR00: c000b09c ca4d3c10 c66d0620 00000000 ca4d3c60 00000000 00009032 00000000
GPR08: 00020000 00000000 c087de44 c000afe0 c66d0ad0 100d3dd6 fffffff3 00000000
GPR16: 00000000 00000041 00000000 ca4d3d70 00000000 00000000 0000416d 00000000
GPR24: 00000004 c53b6128 00000000 0000e268 00000000 c07c0000 c07bb6fc ca4d3c60
NIP [c000ec34] kprobe\_handler+0x128/0x290
LR [c000ecd8] kprobe\_handler+0x1cc/0x290
Call Trace:
[ca4d3c30] [c000b09c] program\_check\_exception+0xbc/0x6fc
[ca4d3c50] [c000e43c] ret\_from\_except\_full+0x0/0x4
--- interrupt: 700 at 0xe268
Instruction dump:
913e0008 81220000 38600001 3929ffff 91220000 80010024 bb410008 7c0803a6
38210020 4e800020 38600000 4e800020 <813b0000> 6d2a7fe0 2f8a0008 419e0154
---[ end trace 5b9152d4cdadd06d ]---
kprobe is not prepared to handle events in real mode and functions
running in real mode should have been blacklisted, so kprobe\_handler()
can safely bail out telling 'this trap is not mine' for any trap that
happened while in real-mode.
If the trap happened with MSR\_IR or MSR\_DR cleared, return 0
immediately.
Reported-by: Larry Finger
Fixes: 6cc89bad60a6 ("powerpc/kprobes: Invoke handlers directly")
Cc: stable@vger.kernel.org # v4.10+
Signed-off-by: Christophe Leroy
Reviewed-by: Masami Hiramatsu
Reviewed-by: Naveen N. Rao
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/424331e2006e7291a1bfe40e7f3fa58825f565e1.1582054578.git.christophe.leroy@c-s.fr
Signed-off-by: Greg Kroah-Hartman
commit 15e60a936e57dec9adaa76c0048f19117a725964
Author: Cédric Le Goater
Date: Fri Mar 6 16:01:41 2020 +0100
powerpc/xive: Fix xmon support on the PowerNV platform
commit 97ef275077932c65b1b8ec5022abd737a9fbf3e0 upstream.
The PowerNV platform has multiple IRQ chips and the xmon command
dumping the state of the XIVE interrupt should only operate on the
XIVE IRQ chip.
Fixes: 5896163f7f91 ("powerpc/xmon: Improve output of XIVE interrupts")
Cc: stable@vger.kernel.org # v5.4+
Signed-off-by: Cédric Le Goater
Reviewed-by: Greg Kurz
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200306150143.5551-3-clg@kaod.org
Signed-off-by: Greg Kroah-Hartman
commit 08aa8a2c0f5b80cc0a852fde3bdb2b9979d94310
Author: Daniel Axtens
Date: Fri Mar 20 14:21:15 2020 +1100
powerpc/64: Setup a paca before parsing device tree etc.
commit d4a8e98621543d5798421eed177978bf2b3cdd11 upstream.
Currently we set up the paca after parsing the device tree for CPU
features. Prior to that, r13 contains random data, which means there
is random data in r13 while we're running the generic dt parsing code.
This random data varies depending on whether we boot through a vmlinux
or a zImage: for the vmlinux case it's usually around zero, but for
zImages we see random values like 912a72603d420015.
This is poor practice, and can also lead to difficult-to-debug
crashes. For example, when kcov is enabled, the kcov instrumentation
attempts to read preempt\_count out of the current task, which goes via
the paca. This then crashes in the zImage case.
Similarly stack protector can cause crashes if r13 is bogus, by
reading from the stack canary in the paca.
To resolve this:
- move the paca setup to before the CPU feature parsing.
- because we no longer have access to CPU feature flags in paca
setup, change the HV feature test in the paca setup path to consider
the actual value of the MSR rather than the CPU feature.
Translations get switched on once we leave early\_setup, so I think
we'd already catch any other cases where the paca or task aren't set
up.
Boot tested on a P9 guest and host.
Fixes: fb0b0a73b223 ("powerpc: Enable kcov")
Fixes: 06ec27aea9fc ("powerpc/64: add stack protector support")
Cc: stable@vger.kernel.org # v4.20+
Reviewed-by: Andrew Donnellan
Suggested-by: Michael Ellerman
Signed-off-by: Daniel Axtens
[mpe: Reword comments & change log a bit to mention stack protector]
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200320032116.1024773-1-mpe@ellerman.id.au
Signed-off-by: Greg Kroah-Hartman
commit 89a454bd871d61549931a41992a49ffd66c993ba
Author: Cédric Le Goater
Date: Fri Mar 6 16:01:40 2020 +0100
powerpc/xive: Use XIVE\_BAD\_IRQ instead of zero to catch non configured IPIs
commit b1a504a6500df50e83b701b7946b34fce27ad8a3 upstream.
When a CPU is brought up, an IPI number is allocated and recorded
under the XIVE CPU structure. Invalid IPI numbers are tracked with
interrupt number 0x0.
On the PowerNV platform, the interrupt number space starts at 0x10 and
this works fine. However, on the sPAPR platform, it is possible to
allocate the interrupt number 0x0 and this raises an issue when CPU 0
is unplugged. The XIVE spapr driver tracks allocated interrupt numbers
in a bitmask and it is not correctly updated when interrupt number 0x0
is freed. It stays allocated and it is then impossible to reallocate.
Fix by using the XIVE\_BAD\_IRQ value instead of zero on both platforms.
Reported-by: David Gibson
Fixes: eac1e731b59e ("powerpc/xive: guest exploitation of the XIVE interrupt controller")
Cc: stable@vger.kernel.org # v4.14+
Signed-off-by: Cédric Le Goater
Reviewed-by: David Gibson
Tested-by: David Gibson
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200306150143.5551-2-clg@kaod.org
Signed-off-by: Greg Kroah-Hartman
commit 8dcdd2f509ea1c51f49a01b06ec5a6867a77d81c
Author: Aneesh Kumar K.V
Date: Fri Mar 13 15:18:42 2020 +0530
powerpc/hash64/devmap: Use H\_PAGE\_THP\_HUGE when setting up huge devmap PTE entries
commit 36b78402d97a3b9aeab136feb9b00d8647ec2c20 upstream.
H\_PAGE\_THP\_HUGE is used to differentiate between a THP hugepage and
hugetlb hugepage entries. The difference is WRT how we handle hash
fault on these address. THP address enables MPSS in segments. We want
to manage devmap hugepage entries similar to THP pt entries. Hence use
H\_PAGE\_THP\_HUGE for devmap huge PTE entries.
With current code while handling hash PTE fault, we do set is\_thp =
true when finding devmap PTE huge PTE entries.
Current code also does the below sequence we setting up huge devmap
entries.
entry = pmd\_mkhuge(pfn\_t\_pmd(pfn, prot));
if (pfn\_t\_devmap(pfn))
entry = pmd\_mkdevmap(entry);
In that case we would find both H\_PAGE\_THP\_HUGE and PAGE\_DEVMAP set
for huge devmap PTE entries. This results in false positive error like
below.
kernel BUG at /home/kvaneesh/src/linux/mm/memory.c:4321!
Oops: Exception in kernel mode, sig: 5 [#1]
LE PAGE\_SIZE=64K MMU=Hash SMP NR\_CPUS=2048 NUMA pSeries
Modules linked in:
CPU: 56 PID: 67996 Comm: t\_mmap\_dio Not tainted 5.6.0-rc4-59640-g371c804dedbc #128
....
NIP [c00000000044c9e4] \_\_follow\_pte\_pmd+0x264/0x900
LR [c0000000005d45f8] dax\_writeback\_one+0x1a8/0x740
Call Trace:
str\_spec.74809+0x22ffb4/0x2d116c (unreliable)
dax\_writeback\_one+0x1a8/0x740
dax\_writeback\_mapping\_range+0x26c/0x700
ext4\_dax\_writepages+0x150/0x5a0
do\_writepages+0x68/0x180
\_\_filemap\_fdatawrite\_range+0x138/0x180
file\_write\_and\_wait\_range+0xa4/0x110
ext4\_sync\_file+0x370/0x6e0
vfs\_fsync\_range+0x70/0xf0
sys\_msync+0x220/0x2e0
system\_call+0x5c/0x68
This is because our pmd\_trans\_huge check doesn't exclude \_PAGE\_DEVMAP.
To make this all consistent, update pmd\_mkdevmap to set
H\_PAGE\_THP\_HUGE and pmd\_trans\_huge check now excludes \_PAGE\_DEVMAP
correctly.
Fixes: ebd31197931d ("powerpc/mm: Add devmap support for ppc64")
Cc: stable@vger.kernel.org # v4.13+
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200313094842.351830-1-aneesh.kumar@linux.ibm.com
Signed-off-by: Greg Kroah-Hartman
commit c8f4397ad9572c7925369a298fe5f1d92acead21
Author: Laurentiu Tudor
Date: Thu Jan 23 11:19:25 2020 +0000
powerpc/fsl\_booke: Avoid creating duplicate tlb1 entry
commit aa4113340ae6c2811e046f08c2bc21011d20a072 upstream.
In the current implementation, the call to loadcam\_multi() is wrapped
between switch\_to\_as1() and restore\_to\_as0() calls so, when it tries
to create its own temporary AS=1 TLB1 entry, it ends up duplicating
the existing one created by switch\_to\_as1(). Add a check to skip
creating the temporary entry if already running in AS=1.
Fixes: d9e1831a4202 ("powerpc/85xx: Load all early TLB entries at once")
Cc: stable@vger.kernel.org # v4.4+
Signed-off-by: Laurentiu Tudor
Acked-by: Scott Wood
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200123111914.2565-1-laurentiu.tudor@nxp.com
Signed-off-by: Greg Kroah-Hartman
commit 7afbbd0cf19f592a5969ce1bbc61440e42d7ea9f
Author: Michael Ellerman
Date: Tue Mar 31 22:47:19 2020 +1100
powerpc/64/tm: Don't let userspace set regs->trap via sigreturn
commit c7def7fbdeaa25feaa19caf4a27c5d10bd8789e4 upstream.
In restore\_tm\_sigcontexts() we take the trap value directly from the
user sigcontext with no checking:
err |= \_\_get\_user(regs->trap, &sc->gp\_regs[PT\_TRAP]);
This means we can be in the kernel with an arbitrary regs->trap value.
Although that's not immediately problematic, there is a risk we could
trigger one of the uses of CHECK\_FULL\_REGS():
#define CHECK\_FULL\_REGS(regs) BUG\_ON(regs->trap & 1)
It can also cause us to unnecessarily save non-volatile GPRs again in
save\_nvgprs(), which shouldn't be problematic but is still wrong.
It's also possible it could trick the syscall restart machinery, which
relies on regs->trap not being == 0xc00 (see 9a81c16b5275 ("powerpc:
fix double syscall restarts")), though I haven't been able to make
that happen.
Finally it doesn't match the behaviour of the non-TM case, in
restore\_sigcontext() which zeroes regs->trap.
So change restore\_tm\_sigcontexts() to zero regs->trap.
This was discovered while testing Nick's upcoming rewrite of the
syscall entry path. In that series the call to save\_nvgprs() prior to
signal handling (do\_notify\_resume()) is removed, which leaves the
low-bit of regs->trap uncleared which can then trigger the FULL\_REGS()
WARNs in setup\_tm\_sigcontexts().
Fixes: 2b0a576d15e0 ("powerpc: Add new transactional memory state to the signal context")
Cc: stable@vger.kernel.org # v3.9+
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200401023836.3286664-1-mpe@ellerman.id.au
Signed-off-by: Greg Kroah-Hartman
commit e5bc95e39441611f7e4cd541b7604c9c7dd44b27
Author: Clement Courbet
Date: Mon Mar 30 10:03:56 2020 +0200
powerpc: Make setjmp/longjmp signature standard
commit c17eb4dca5a353a9dbbb8ad6934fe57af7165e91 upstream.
Declaring setjmp()/longjmp() as taking longs makes the signature
non-standard, and makes clang complain. In the past, this has been
worked around by adding -ffreestanding to the compile flags.
The implementation looks like it only ever propagates the value
(in longjmp) or sets it to 1 (in setjmp), and we only call longjmp
with integer parameters.
This allows removing -ffreestanding from the compilation flags.
Fixes: c9029ef9c957 ("powerpc: Avoid clang warnings around setjmp and longjmp")
Cc: stable@vger.kernel.org # v4.14+
Signed-off-by: Clement Courbet
Reviewed-by: Nathan Chancellor
Tested-by: Nathan Chancellor
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200330080400.124803-1-courbet@google.com
Signed-off-by: Greg Kroah-Hartman
commit c0a44b4479433f4d95f4d4c7e6219ac4b018d6eb
Author: Bart Van Assche
Date: Sun Mar 29 19:51:51 2020 -0700
scsi: sr: Fix sr\_block\_release()
commit 72655c0ebd1d941d80f47bf614b02d563a1e61ae upstream.
This patch fixes the following two complaints:
WARNING: CPU: 3 PID: 1326 at kernel/locking/mutex-debug.c:103 mutex\_destroy+0x74/0x80
Modules linked in: scsi\_debug sd\_mod t10\_pi brd scsi\_transport\_iscsi af\_packet crct10dif\_pclmul sg aesni\_intel glue\_helper virtio\_balloon button crypto\_simd cryptd intel\_agp intel\_gtt agpgart ip\_tables x\_tables ipv6 nf\_defrag\_ipv6 autofs4 ext4 crc16 mbcache jbd2 hid\_generic usbhid hid sr\_mod cdrom ata\_generic pata\_acpi virtio\_blk virtio\_net net\_failover failover ata\_piix xhci\_pci ahci libahci xhci\_hcd i2c\_piix4 libata virtio\_pci usbcore i2c\_core virtio\_ring scsi\_mod usb\_common virtio [last unloaded: scsi\_debug]
CPU: 3 PID: 1326 Comm: systemd-udevd Not tainted 5.6.0-rc1-dbg+ #1
Hardware name: Bochs Bochs, BIOS Bochs 01/01/2011
RIP: 0010:mutex\_destroy+0x74/0x80
Call Trace:
sr\_kref\_release+0xb9/0xd0 [sr\_mod]
scsi\_cd\_put+0x79/0x90 [sr\_mod]
sr\_block\_release+0x54/0x70 [sr\_mod]
\_\_blkdev\_put+0x2ce/0x3c0
blkdev\_put+0x68/0x220
blkdev\_close+0x4d/0x60
\_\_fput+0x170/0x3b0
\_\_\_\_fput+0x12/0x20
task\_work\_run+0xa2/0xf0
exit\_to\_usermode\_loop+0xeb/0xf0
do\_syscall\_64+0x2be/0x300
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
RIP: 0033:0x7fa16d40aab7
BUG: KASAN: use-after-free in \_\_mutex\_unlock\_slowpath+0x98/0x420
Read of size 8 at addr ffff8881c6e4f4b0 by task systemd-udevd/1326
CPU: 3 PID: 1326 Comm: systemd-udevd Tainted: G W 5.6.0-rc1-dbg+ #1
Hardware name: Bochs Bochs, BIOS Bochs 01/01/2011
Call Trace:
dump\_stack+0xa5/0xe6
print\_address\_description.constprop.0+0x46/0x60
\_\_kasan\_report.cold+0x7b/0x94
kasan\_report+0x16/0x20
check\_memory\_region+0x140/0x1b0
\_\_kasan\_check\_read+0x15/0x20
\_\_mutex\_unlock\_slowpath+0x98/0x420
mutex\_unlock+0x16/0x20
sr\_block\_release+0x5c/0x70 [sr\_mod]
\_\_blkdev\_put+0x2ce/0x3c0
hardirqs last enabled at (1875522): [] \_raw\_spin\_unlock\_irqrestore+0x56/0x70
blkdev\_put+0x68/0x220
blkdev\_close+0x4d/0x60
\_\_fput+0x170/0x3b0
\_\_\_\_fput+0x12/0x20
task\_work\_run+0xa2/0xf0
exit\_to\_usermode\_loop+0xeb/0xf0
do\_syscall\_64+0x2be/0x300
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
RIP: 0033:0x7fa16d40aab7
Allocated by task 3201:
save\_stack+0x23/0x90
\_\_kasan\_kmalloc.constprop.0+0xcf/0xe0
kasan\_kmalloc+0xd/0x10
kmem\_cache\_alloc\_trace+0x161/0x3c0
sr\_probe+0x12f/0xb60 [sr\_mod]
really\_probe+0x183/0x5d0
driver\_probe\_device+0x13f/0x1a0
\_\_device\_attach\_driver+0xe6/0x150
bus\_for\_each\_drv+0x101/0x160
\_\_device\_attach+0x183/0x230
device\_initial\_probe+0x17/0x20
bus\_probe\_device+0x110/0x130
device\_add+0xb7b/0xd40
scsi\_sysfs\_add\_sdev+0xe8/0x360 [scsi\_mod]
scsi\_probe\_and\_add\_lun+0xdc4/0x14c0 [scsi\_mod]
\_\_scsi\_scan\_target+0x12d/0x850 [scsi\_mod]
scsi\_scan\_channel+0xcd/0xe0 [scsi\_mod]
scsi\_scan\_host\_selected+0x182/0x190 [scsi\_mod]
store\_scan+0x1e9/0x200 [scsi\_mod]
dev\_attr\_store+0x42/0x60
sysfs\_kf\_write+0x8b/0xb0
kernfs\_fop\_write+0x158/0x250
\_\_vfs\_write+0x4c/0x90
vfs\_write+0x145/0x2c0
ksys\_write+0xd7/0x180
\_\_x64\_sys\_write+0x47/0x50
do\_syscall\_64+0x6f/0x300
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Freed by task 1326:
save\_stack+0x23/0x90
\_\_kasan\_slab\_free+0x13a/0x190
kasan\_slab\_free+0x12/0x20
kfree+0x109/0x410
sr\_kref\_release+0xc1/0xd0 [sr\_mod]
scsi\_cd\_put+0x79/0x90 [sr\_mod]
sr\_block\_release+0x54/0x70 [sr\_mod]
\_\_blkdev\_put+0x2ce/0x3c0
blkdev\_put+0x68/0x220
blkdev\_close+0x4d/0x60
\_\_fput+0x170/0x3b0
\_\_\_\_fput+0x12/0x20
task\_work\_run+0xa2/0xf0
exit\_to\_usermode\_loop+0xeb/0xf0
do\_syscall\_64+0x2be/0x300
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Link: https://lore.kernel.org/r/20200330025151.10535-1-bvanassche@acm.org
Fixes: 51a858817dcd ("scsi: sr: get rid of sr global mutex")
Cc: Merlijn Wajer
Cc: Arnd Bergmann
Cc:
Acked-by: Merlijn Wajer
Signed-off-by: Bart Van Assche
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 6138fc62e208ffeb877009157d01183e76b39df6
Author: Merlijn Wajer
Date: Tue Feb 18 15:39:17 2020 +0100
scsi: sr: get rid of sr global mutex
commit 51a858817dcdbbdee22cb54b0b2b26eb145ca5b6 upstream.
When replacing the Big Kernel Lock in commit 2a48fc0ab242 ("block:
autoconvert trivial BKL users to private mutex"), the lock was replaced
with a sr-wide lock.
This causes very poor performance when using multiple sr devices, as the sr
driver was not able to execute more than one command to one drive at any
given time, even when there were many CD drives available.
Replace the global mutex with per-sr-device mutex.
Someone tried this patch at the time, but it never made it upstream, due to
possible concerns with race conditions, but it's not clear the patch
actually caused those:
https://www.spinics.net/lists/linux-scsi/msg63706.html
https://www.spinics.net/lists/linux-scsi/msg63750.html
Also see
http://lists.xiph.org/pipermail/paranoia/2019-December/001647.html
Link: https://lore.kernel.org/r/20200218143918.30267-1-merlijn@archive.org
Acked-by: Arnd Bergmann
Signed-off-by: Merlijn Wajer
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 9c6e9d82f29ef16564b74d6c07e5cece00aa94e0
Author: Juergen Gross
Date: Fri Apr 3 11:00:34 2020 +0200
xen/blkfront: fix memory allocation flags in blkfront\_setup\_indirect()
commit 3a169c0be75b59dd85d159493634870cdec6d3c4 upstream.
Commit 1d5c76e664333 ("xen-blkfront: switch kcalloc to kvcalloc for
large array allocation") didn't fix the issue it was meant to, as the
flags for allocating the memory are GFP\_NOIO, which will lead the
memory allocation falling back to kmalloc().
So instead of GFP\_NOIO use GFP\_KERNEL and do all the memory allocation
in blkfront\_setup\_indirect() in a memalloc\_noio\_{save,restore} section.
Fixes: 1d5c76e664333 ("xen-blkfront: switch kcalloc to kvcalloc for large array allocation")
Cc: stable@vger.kernel.org
Signed-off-by: Juergen Gross
Reviewed-by: Boris Ostrovsky
Acked-by: Roger Pau Monné
Link: https://lore.kernel.org/r/20200403090034.8753-1-jgross@suse.com
Signed-off-by: Juergen Gross
Signed-off-by: Greg Kroah-Hartman
commit d14e47371442bd1adce9fcb3802e7a6f59638827
Author: Wen Yang
Date: Fri Apr 3 17:04:08 2020 +0800
ipmi: fix hung processes in \_\_get\_guid()
commit 32830a0534700f86366f371b150b17f0f0d140d7 upstream.
The wait\_event() function is used to detect command completion.
When send\_guid\_cmd() returns an error, smi\_send() has not been
called to send data. Therefore, wait\_event() should not be used
on the error path, otherwise it will cause the following warning:
[ 1361.588808] systemd-udevd D 0 1501 1436 0x00000004
[ 1361.588813] ffff883f4b1298c0 0000000000000000 ffff883f4b188000 ffff887f7e3d9f40
[ 1361.677952] ffff887f64bd4280 ffffc90037297a68 ffffffff8173ca3b ffffc90000000010
[ 1361.767077] 00ffc90037297ad0 ffff887f7e3d9f40 0000000000000286 ffff883f4b188000
[ 1361.856199] Call Trace:
[ 1361.885578] [] ? \_\_schedule+0x23b/0x780
[ 1361.951406] [] schedule+0x36/0x80
[ 1362.010979] [] get\_guid+0x118/0x150 [ipmi\_msghandler]
[ 1362.091281] [] ? prepare\_to\_wait\_event+0x100/0x100
[ 1362.168533] [] ipmi\_register\_smi+0x405/0x940 [ipmi\_msghandler]
[ 1362.258337] [] try\_smi\_init+0x529/0x950 [ipmi\_si]
[ 1362.334521] [] ? std\_irq\_setup+0xd0/0xd0 [ipmi\_si]
[ 1362.411701] [] init\_ipmi\_si+0x492/0x9e0 [ipmi\_si]
[ 1362.487917] [] ? ipmi\_pci\_probe+0x280/0x280 [ipmi\_si]
[ 1362.568219] [] do\_one\_initcall+0x50/0x180
[ 1362.636109] [] ? kmem\_cache\_alloc\_trace+0x142/0x190
[ 1362.714330] [] do\_init\_module+0x5f/0x200
[ 1362.781208] [] load\_module+0x1898/0x1de0
[ 1362.848069] [] ? \_\_symbol\_put+0x60/0x60
[ 1362.913886] [] ? security\_kernel\_post\_read\_file+0x6b/0x80
[ 1362.998514] [] SYSC\_finit\_module+0xe5/0x120
[ 1363.068463] [] ? SYSC\_finit\_module+0xe5/0x120
[ 1363.140513] [] SyS\_finit\_module+0xe/0x10
[ 1363.207364] [] do\_syscall\_64+0x74/0x180
Fixes: 50c812b2b951 ("[PATCH] ipmi: add full sysfs support")
Signed-off-by: Wen Yang
Cc: Corey Minyard
Cc: Arnd Bergmann
Cc: Greg Kroah-Hartman
Cc: openipmi-developer@lists.sourceforge.net
Cc: linux-kernel@vger.kernel.org
Cc: stable@vger.kernel.org # 2.6.17-
Message-Id: <20200403090408.58745-1-wenyang@linux.alibaba.com>
Signed-off-by: Corey Minyard
Signed-off-by: Greg Kroah-Hartman
commit 874410923a95b669e45cb3b3efb92f0b38f9affa
Author: Kai-Heng Feng
Date: Wed Mar 27 17:02:54 2019 +0800
libata: Return correct status in sata\_pmp\_eh\_recover\_pm() when ATA\_DFLAG\_DETACH is set
commit 8305f72f952cff21ce8109dc1ea4b321c8efc5af upstream.
During system resume from suspend, this can be observed on ASM1062 PMP
controller:
ata10.01: SATA link down (SStatus 0 SControl 330)
ata10.02: hard resetting link
ata10.02: SATA link down (SStatus 0 SControl 330)
ata10.00: configured for UDMA/133
Kernel panic - not syncing: stack-protector: Kernel
in: sata\_pmp\_eh\_recover+0xa2b/0xa40
CPU: 2 PID: 230 Comm: scsi\_eh\_9 Tainted: P OE
#49-Ubuntu
Hardware name: System manufacturer System Product
1001 12/10/2017
Call Trace:
dump\_stack+0x63/0x8b
panic+0xe4/0x244
? sata\_pmp\_eh\_recover+0xa2b/0xa40
\_\_stack\_chk\_fail+0x19/0x20
sata\_pmp\_eh\_recover+0xa2b/0xa40
? ahci\_do\_softreset+0x260/0x260 [libahci]
? ahci\_do\_hardreset+0x140/0x140 [libahci]
? ata\_phys\_link\_offline+0x60/0x60
? ahci\_stop\_engine+0xc0/0xc0 [libahci]
sata\_pmp\_error\_handler+0x22/0x30
ahci\_error\_handler+0x45/0x80 [libahci]
ata\_scsi\_port\_error\_handler+0x29b/0x770
? ata\_scsi\_cmd\_error\_handler+0x101/0x140
ata\_scsi\_error+0x95/0xd0
? scsi\_try\_target\_reset+0x90/0x90
scsi\_error\_handler+0xd0/0x5b0
kthread+0x121/0x140
? scsi\_eh\_get\_sense+0x200/0x200
? kthread\_create\_worker\_on\_cpu+0x70/0x70
ret\_from\_fork+0x22/0x40
Kernel Offset: 0xcc00000 from 0xffffffff81000000
(relocation range: 0xffffffff80000000-0xffffffffbfffffff)
Since sata\_pmp\_eh\_recover\_pmp() doens't set rc when ATA\_DFLAG\_DETACH is
set, sata\_pmp\_eh\_recover() continues to run. During retry it triggers
the stack protector.
Set correct rc in sata\_pmp\_eh\_recover\_pmp() to let sata\_pmp\_eh\_recover()
jump to pmp\_fail directly.
BugLink: https://bugs.launchpad.net/bugs/1821434
Cc: stable@vger.kernel.org
Signed-off-by: Kai-Heng Feng
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit d79b3265732b80d33e46fb02d38f85561b1c6600
Author: Simon Gander
Date: Fri Apr 10 14:32:16 2020 -0700
hfsplus: fix crash and filesystem corruption when deleting files
commit 25efb2ffdf991177e740b2f63e92b4ec7d310a92 upstream.
When removing files containing extended attributes, the hfsplus driver may
remove the wrong entries from the attributes b-tree, causing major
filesystem damage and in some cases even kernel crashes.
To remove a file, all its extended attributes have to be removed as well.
The driver does this by looking up all keys in the attributes b-tree with
the cnid of the file. Each of these entries then gets deleted using the
key used for searching, which doesn't contain the attribute's name when it
should. Since the key doesn't contain the name, the deletion routine will
not find the correct entry and instead remove the one in front of it. If
parent nodes have to be modified, these become corrupt as well. This
causes invalid links and unsorted entries that not even macOS's fsck\_hfs
is able to fix.
To fix this, modify the search key before an entry is deleted from the
attributes b-tree by copying the found entry's key into the search key,
therefore ensuring that the correct entry gets removed from the tree.
Signed-off-by: Simon Gander
Signed-off-by: Andrew Morton
Reviewed-by: Anton Altaparmakov
Cc:
Link: http://lkml.kernel.org/r/20200327155541.1521-1-simon@tuxera.com
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 9565962199fd6d105df23940e59569db5ed2a529
Author: Oliver O'Halloran
Date: Thu Feb 6 17:26:21 2020 +1100
cpufreq: powernv: Fix use-after-free
commit d0a72efac89d1c35ac55197895201b7b94c5e6ef upstream.
The cpufreq driver has a use-after-free that we can hit if:
a) There's an OCC message pending when the notifier is registered, and
b) The cpufreq driver fails to register with the core.
When a) occurs the notifier schedules a workqueue item to handle the
message. The backing work\_struct is located on chips[].throttle and
when b) happens we clean up by freeing the array. Once we get to
the (now free) queued item and the kernel crashes.
Fixes: c5e29ea7ac14 ("cpufreq: powernv: Fix bugs in powernv\_cpufreq\_{init/exit}")
Cc: stable@vger.kernel.org # v4.6+
Signed-off-by: Oliver O'Halloran
Reviewed-by: Gautham R. Shenoy
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200206062622.28235-1-oohall@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 7ed7f7cabb938931d90c5b9f04e49206ab60f386
Author: Eric Biggers
Date: Fri Apr 10 14:33:43 2020 -0700
kmod: make request\_module() return an error when autoloading is disabled
commit d7d27cfc5cf0766a26a8f56868c5ad5434735126 upstream.
Patch series "module autoloading fixes and cleanups", v5.
This series fixes a bug where request\_module() was reporting success to
kernel code when module autoloading had been completely disabled via
'echo > /proc/sys/kernel/modprobe'.
It also addresses the issues raised on the original thread
(https://lkml.kernel.org/lkml/20200310223731.126894-1-ebiggers@kernel.org/T/#u)
bydocumenting the modprobe sysctl, adding a self-test for the empty path
case, and downgrading a user-reachable WARN\_ONCE().
This patch (of 4):
It's long been possible to disable kernel module autoloading completely
(while still allowing manual module insertion) by setting
/proc/sys/kernel/modprobe to the empty string.
This can be preferable to setting it to a nonexistent file since it
avoids the overhead of an attempted execve(), avoids potential
deadlocks, and avoids the call to security\_kernel\_module\_request() and
thus on SELinux-based systems eliminates the need to write SELinux rules
to dontaudit module\_request.
However, when module autoloading is disabled in this way,
request\_module() returns 0. This is broken because callers expect 0 to
mean that the module was successfully loaded.
Apparently this was never noticed because this method of disabling
module autoloading isn't used much, and also most callers don't use the
return value of request\_module() since it's always necessary to check
whether the module registered its functionality or not anyway.
But improperly returning 0 can indeed confuse a few callers, for example
get\_fs\_type() in fs/filesystems.c where it causes a WARNING to be hit:
if (!fs && (request\_module("fs-%.\*s", len, name) == 0)) {
fs = \_\_get\_fs\_type(name, len);
WARN\_ONCE(!fs, "request\_module fs-%.\*s succeeded, but still no fs?\n", len, name);
}
This is easily reproduced with:
echo > /proc/sys/kernel/modprobe
mount -t NONEXISTENT none /
It causes:
request\_module fs-NONEXISTENT succeeded, but still no fs?
WARNING: CPU: 1 PID: 1106 at fs/filesystems.c:275 get\_fs\_type+0xd6/0xf0
[...]
This should actually use pr\_warn\_once() rather than WARN\_ONCE(), since
it's also user-reachable if userspace immediately unloads the module.
Regardless, request\_module() should correctly return an error when it
fails. So let's make it return -ENOENT, which matches the error when
the modprobe binary doesn't exist.
I've also sent patches to document and test this case.
Signed-off-by: Eric Biggers
Signed-off-by: Andrew Morton
Reviewed-by: Kees Cook
Reviewed-by: Jessica Yu
Acked-by: Luis Chamberlain
Cc: Alexei Starovoitov
Cc: Greg Kroah-Hartman
Cc: Jeff Vander Stoep
Cc: Ben Hutchings
Cc: Josh Triplett
Cc:
Link: http://lkml.kernel.org/r/20200310223731.126894-1-ebiggers@kernel.org
Link: http://lkml.kernel.org/r/20200312202552.241885-1-ebiggers@kernel.org
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 438d08315ab2229389dfa82d0d07170f28021eb7
Author: Paul Cercueil
Date: Thu Feb 13 13:19:52 2020 -0300
clk: ingenic/TCU: Fix round\_rate returning error
commit edcc42945dee85e9dec3737f3dbf59d917ae5418 upstream.
When requesting a rate superior to the parent's rate, it would return
-EINVAL instead of simply returning the parent's rate like it should.
Fixes: 4f89e4b8f121 ("clk: ingenic: Add driver for the TCU clocks")
Cc: stable@vger.kernel.org
Signed-off-by: Paul Cercueil
Link: https://lkml.kernel.org/r/20200213161952.37460-2-paul@crapouillou.net
Signed-off-by: Stephen Boyd
Signed-off-by: Greg Kroah-Hartman
commit 9eab68f29949148cf89845e96115c7ce8fc7b811
Author: Paul Cercueil
Date: Thu Feb 13 13:19:51 2020 -0300
clk: ingenic/jz4770: Exit with error if CGU init failed
commit c067b46d731a764fc46ecc466c2967088c97089e upstream.
Exit jz4770\_cgu\_init() if the 'cgu' pointer we get is NULL, since the
pointer is passed as argument to functions later on.
Fixes: 7a01c19007ad ("clk: Add Ingenic jz4770 CGU driver")
Cc: stable@vger.kernel.org
Signed-off-by: Paul Cercueil
Reported-by: kbuild test robot
Reported-by: Dan Carpenter
Link: https://lkml.kernel.org/r/20200213161952.37460-1-paul@crapouillou.net
Signed-off-by: Stephen Boyd
Signed-off-by: Greg Kroah-Hartman
commit 337731ef8a74b6769e41a7fb6000f84412c1cea8
Author: Masami Hiramatsu
Date: Tue Mar 24 16:34:48 2020 +0900
ftrace/kprobe: Show the maxactive number on kprobe\_events
commit 6a13a0d7b4d1171ef9b80ad69abc37e1daa941b3 upstream.
Show maxactive parameter on kprobe\_events.
This allows user to save the current configuration and
restore it without losing maxactive parameter.
Link: http://lkml.kernel.org/r/4762764a-6df7-bc93-ed60-e336146dce1f@gmail.com
Link: http://lkml.kernel.org/r/158503528846.22706.5549974121212526020.stgit@devnote2
Cc: stable@vger.kernel.org
Fixes: 696ced4fb1d76 ("tracing/kprobes: expose maxactive for kretprobe in kprobe\_events")
Reported-by: Taeung Song
Signed-off-by: Masami Hiramatsu
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit d83ccd26cf786ee31367bdb5fe33480558b85ec9
Author: Hans de Goede
Date: Wed Apr 1 13:23:06 2020 -0700
Input: i8042 - add Acer Aspire 5738z to nomux list
commit ebc68cedec4aead47d8d11623d013cca9bf8e825 upstream.
The Acer Aspire 5738z has a button to disable (and re-enable) the
touchpad next to the touchpad.
When this button is pressed a LED underneath indicates that the touchpad
is disabled (and an event is send to userspace and GNOME shows its
touchpad enabled / disable OSD thingie).
So far so good, but after re-enabling the touchpad it no longer works.
The laptop does not have an external ps2 port, so mux mode is not needed
and disabling mux mode fixes the touchpad no longer working after toggling
it off and back on again, so lets add this laptop model to the nomux list.
Signed-off-by: Hans de Goede
Link: https://lore.kernel.org/r/20200331123947.318908-1-hdegoede@redhat.com
Cc: stable@vger.kernel.org
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 068ca0eda09d81664e1ce1188678dd5c21592d9d
Author: Michael Mueller
Date: Tue Mar 3 16:42:01 2020 +0100
s390/diag: fix display of diagnose call statistics
commit 6c7c851f1b666a8a455678a0b480b9162de86052 upstream.
Show the full diag statistic table and not just parts of it.
The issue surfaced in a KVM guest with a number of vcpus
defined smaller than NR\_DIAG\_STAT.
Fixes: 1ec2772e0c3c ("s390/diag: add a statistic for diagnose calls")
Cc: stable@vger.kernel.org
Signed-off-by: Michael Mueller
Reviewed-by: Heiko Carstens
Signed-off-by: Vasily Gorbik
Signed-off-by: Greg Kroah-Hartman
commit 752aadf330840a35f123c59a5d60d9140958d7b7
Author: Sam Lunt
Date: Fri Jan 31 12:11:23 2020 -0600
perf tools: Support Python 3.8+ in Makefile
commit b9c9ce4e598e012ca7c1813fae2f4d02395807de upstream.
Python 3.8 changed the output of 'python-config --ldflags' to no longer
include the '-lpythonX.Y' flag (this apparently fixed an issue loading
modules with a statically linked Python executable). The libpython
feature check in linux/build/feature fails if the Python library is not
included in FEATURE\_CHECK\_LDFLAGS-libpython variable.
This adds a check in the Makefile to determine if PYTHON\_CONFIG accepts
the '--embed' flag and passes that flag alongside '--ldflags' if so.
tools/perf is the only place the libpython feature check is used.
Signed-off-by: Sam Lunt
Tested-by: He Zhe
Link: http://lore.kernel.org/lkml/c56be2e1-8111-9dfe-8298-f7d0f9ab7431@windriver.com
Acked-by: Jiri Olsa
Cc: Alexander Shishkin
Cc: Mark Rutland
Cc: Namhyung Kim
Cc: Peter Zijlstra
Cc: trivial@kernel.org
Cc: stable@kernel.org
Link: http://lore.kernel.org/lkml/20200131181123.tmamivhq4b7uqasr@gmail.com
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit 471e45f81ca6c036dcae819e0ba3d522a0ec3ba9
Author: Changwei Ge
Date: Fri Apr 10 14:32:38 2020 -0700
ocfs2: no need try to truncate file beyond i\_size
commit 783fda856e1034dee90a873f7654c418212d12d7 upstream.
Linux fallocate(2) with FALLOC\_FL\_PUNCH\_HOLE mode set, its offset can
exceed the inode size. Ocfs2 now doesn't allow that offset beyond inode
size. This restriction is not necessary and violates fallocate(2)
semantics.
If fallocate(2) offset is beyond inode size, just return success and do
nothing further.
Otherwise, ocfs2 will crash the kernel.
kernel BUG at fs/ocfs2//alloc.c:7264!
ocfs2\_truncate\_inline+0x20f/0x360 [ocfs2]
ocfs2\_remove\_inode\_range+0x23c/0xcb0 [ocfs2]
\_\_ocfs2\_change\_file\_space+0x4a5/0x650 [ocfs2]
ocfs2\_fallocate+0x83/0xa0 [ocfs2]
vfs\_fallocate+0x148/0x230
SyS\_fallocate+0x48/0x80
do\_syscall\_64+0x79/0x170
Signed-off-by: Changwei Ge
Signed-off-by: Andrew Morton
Reviewed-by: Joseph Qi
Cc: Mark Fasheh
Cc: Joel Becker
Cc: Junxiao Bi
Cc: Changwei Ge
Cc: Gang He
Cc: Jun Piao
Cc:
Link: http://lkml.kernel.org/r/20200407082754.17565-1-chge@linux.alibaba.com
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 29517d568cd526b03a751909c29149172f1f2151
Author: Eric Biggers
Date: Fri Apr 10 14:33:47 2020 -0700
fs/filesystems.c: downgrade user-reachable WARN\_ONCE() to pr\_warn\_once()
commit 26c5d78c976ca298e59a56f6101a97b618ba3539 upstream.
After request\_module(), nothing is stopping the module from being
unloaded until someone takes a reference to it via try\_get\_module().
The WARN\_ONCE() in get\_fs\_type() is thus user-reachable, via userspace
running 'rmmod' concurrently.
Since WARN\_ONCE() is for kernel bugs only, not for user-reachable
situations, downgrade this warning to pr\_warn\_once().
Keep it printed once only, since the intent of this warning is to detect
a bug in modprobe at boot time. Printing the warning more than once
wouldn't really provide any useful extra information.
Fixes: 41124db869b7 ("fs: warn in case userspace lied about modprobe return")
Signed-off-by: Eric Biggers
Signed-off-by: Andrew Morton
Reviewed-by: Jessica Yu
Cc: Alexei Starovoitov
Cc: Greg Kroah-Hartman
Cc: Jeff Vander Stoep
Cc: Jessica Yu
Cc: Kees Cook
Cc: Luis Chamberlain
Cc: NeilBrown
Cc:  [4.13+]
Link: http://lkml.kernel.org/r/20200312202552.241885-3-ebiggers@kernel.org
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit cf458f0ed6413b6241cccdefe870cb2b8e1b15fc
Author: Mike Willard
Date: Wed Apr 1 20:54:54 2020 +0000
ASoC: cs4270: pull reset GPIO low then high
commit ccfc531695f3a4aada042f6bdb33ac6be24e1aec upstream.
Pull the RST line low then high when initializing the driver,
in order to force a reset of the chip.
Previously, the line was not pulled low, which could result in
the chip registers not resetting to their default values on boot.
Signed-off-by: Mike Willard
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20200401205454.79792-1-mwillard@izotope.com
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit a9c0c79861b04b614729a81d14133dd691445be8
Author: Chris Wilson
Date: Sun Mar 22 16:32:24 2020 +0000
drm/i915/gt: Treat idling as a RPS downclock event
commit 98479ada421a8fd2123b98efd398a6f1379307ab upstream.
If we park/unpark faster than we can respond to RPS events, we never
will process a downclock event after expiring a waitboost, and thus we
will forever restart the GPU at max clocks even if the workload switches
and doesn't justify full power.
Closes: https://gitlab.freedesktop.org/drm/intel/issues/1500
Fixes: 3e7abf814193 ("drm/i915: Extract GT render power state management")
Signed-off-by: Chris Wilson
Cc: Andi Shyti
Cc: Lyude Paul
Reviewed-by: Andi Shyti
Link: https://patchwork.freedesktop.org/patch/msgid/20200322163225.28791-1-chris@chris-wilson.co.uk
Cc:  # v5.5+
(cherry picked from commit 21abf0bf168dffff1192e0f072af1dc74ae1ff0e)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Greg Kroah-Hartman
commit 6b40f1ee4a479e87d16699b99708566c092746f3
Author: Qian Cai
Date: Fri Feb 21 23:32:58 2020 -0500
ext4: fix a data race at inode->i\_blocks
commit 28936b62e71e41600bab319f262ea9f9b1027629 upstream.
inode->i\_blocks could be accessed concurrently as noticed by KCSAN,
BUG: KCSAN: data-race in ext4\_do\_update\_inode [ext4] / inode\_add\_bytes
write to 0xffff9a00d4b982d0 of 8 bytes by task 22100 on cpu 118:
inode\_add\_bytes+0x65/0xf0
\_\_inode\_add\_bytes at fs/stat.c:689
(inlined by) inode\_add\_bytes at fs/stat.c:702
ext4\_mb\_new\_blocks+0x418/0xca0 [ext4]
ext4\_ext\_map\_blocks+0x1a6b/0x27b0 [ext4]
ext4\_map\_blocks+0x1a9/0x950 [ext4]
\_ext4\_get\_block+0xfc/0x270 [ext4]
ext4\_get\_block\_unwritten+0x33/0x50 [ext4]
\_\_block\_write\_begin\_int+0x22e/0xae0
\_\_block\_write\_begin+0x39/0x50
ext4\_write\_begin+0x388/0xb50 [ext4]
ext4\_da\_write\_begin+0x35f/0x8f0 [ext4]
generic\_perform\_write+0x15d/0x290
ext4\_buffered\_write\_iter+0x11f/0x210 [ext4]
ext4\_file\_write\_iter+0xce/0x9e0 [ext4]
new\_sync\_write+0x29c/0x3b0
\_\_vfs\_write+0x92/0xa0
vfs\_write+0x103/0x260
ksys\_write+0x9d/0x130
\_\_x64\_sys\_write+0x4c/0x60
do\_syscall\_64+0x91/0xb05
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
read to 0xffff9a00d4b982d0 of 8 bytes by task 8 on cpu 65:
ext4\_do\_update\_inode+0x4a0/0xf60 [ext4]
ext4\_inode\_blocks\_set at fs/ext4/inode.c:4815
ext4\_mark\_iloc\_dirty+0xaf/0x160 [ext4]
ext4\_mark\_inode\_dirty+0x129/0x3e0 [ext4]
ext4\_convert\_unwritten\_extents+0x253/0x2d0 [ext4]
ext4\_convert\_unwritten\_io\_end\_vec+0xc5/0x150 [ext4]
ext4\_end\_io\_rsv\_work+0x22c/0x350 [ext4]
process\_one\_work+0x54f/0xb90
worker\_thread+0x80/0x5f0
kthread+0x1cd/0x1f0
ret\_from\_fork+0x27/0x50
4 locks held by kworker/u256:0/8:
#0: ffff9a025abc4328 ((wq\_completion)ext4-rsv-conversion){+.+.}, at: process\_one\_work+0x443/0xb90
#1: ffffab5a862dbe20 ((work\_completion)(&ei->i\_rsv\_conversion\_work)){+.+.}, at: process\_one\_work+0x443/0xb90
#2: ffff9a025a9d0f58 (jbd2\_handle){++++}, at: start\_this\_handle+0x1c1/0x9d0 [jbd2]
#3: ffff9a00d4b985d8 (&(&ei->i\_raw\_lock)->rlock){+.+.}, at: ext4\_do\_update\_inode+0xaa/0xf60 [ext4]
irq event stamp: 3009267
hardirqs last enabled at (3009267): [] \_\_find\_get\_block+0x107/0x790
hardirqs last disabled at (3009266): [] \_\_find\_get\_block+0x49/0x790
softirqs last enabled at (3009230): [] \_\_do\_softirq+0x34c/0x57c
softirqs last disabled at (3009223): [] irq\_exit+0xa2/0xc0
Reported by Kernel Concurrency Sanitizer on:
CPU: 65 PID: 8 Comm: kworker/u256:0 Tainted: G L 5.6.0-rc2-next-20200221+ #7
Hardware name: HPE ProLiant DL385 Gen10/ProLiant DL385 Gen10, BIOS A40 07/10/2019
Workqueue: ext4-rsv-conversion ext4\_end\_io\_rsv\_work [ext4]
The plain read is outside of inode->i\_lock critical section which
results in a data race. Fix it by adding READ\_ONCE() there.
Link: https://lore.kernel.org/r/20200222043258.2279-1-cai@lca.pw
Signed-off-by: Qian Cai
Signed-off-by: Theodore Ts'o
Cc: stable@kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 86c3caa710ebc5ff7bd75491c3ba10c786d74d2d
Author: Scott Mayhew
Date: Thu Apr 2 17:20:44 2020 -0400
NFS: Fix a few constant\_table array definitions
commit 529af90576cfa44aa107e9876e2ebaa053983986 upstream.
nfs\_vers\_tokens, nfs\_xprt\_protocol\_tokens, and nfs\_secflavor\_tokens were
all missing an empty item at the end of the array, allowing
lookup\_constant() to potentially walk off the end and trigger and oops.
Reported-by: Olga Kornievskaia
Signed-off-by: Scott Mayhew
Fixes: e38bb238ed8c ("NFS: Convert mount option parsing to use functionality from fs\_parser.h")
Cc: stable@vger.kernel.org # v5.6
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit ca9273fea3693b500b09721b315ab0f1046340e8
Author: Trond Myklebust
Date: Thu Apr 2 10:34:36 2020 -0400
NFS: finish\_automount() requires us to hold 2 refs to the mount record
commit 75da98586af75eb80664714a67a9895bf0a5517e upstream.
We must not return from nfs\_d\_automount() without holding 2 references
to the mount record. Doing so, will trigger the BUG() in finish\_automount().
Also ensure that we don't try to reschedule the automount timer with
a negative or zero timeout value.
Fixes: 22a1ae9a93fb ("NFS: If nfs\_mountpoint\_expiry\_timeout < 0, do not expire submounts")
Cc: stable@vger.kernel.org # v5.5+
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 6c334eb80a0d3dd14496bce01ee370488806636b
Author: Trond Myklebust
Date: Wed Apr 1 10:07:16 2020 -0400
NFS: Fix a page leak in nfs\_destroy\_unlinked\_subrequests()
commit add42de31721fa29ed77a7ce388674d69f9d31a4 upstream.
When we detach a subrequest from the list, we must also release the
reference it holds to the parent.
Fixes: 5b2b5187fa85 ("NFS: Fix nfs\_page\_group\_destroy() and nfs\_lock\_and\_join\_requests() race cases")
Cc: stable@vger.kernel.org # v4.14+
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit a73fc80715e3e2ee3bd59255825fedddea4f43dd
Author: Trond Myklebust
Date: Sun Mar 29 19:55:05 2020 -0400
NFS: Fix use-after-free issues in nfs\_pageio\_add\_request()
commit dc9dc2febb17f72e9878eb540ad3996f7984239a upstream.
We need to ensure that we create the mirror requests before calling
nfs\_pageio\_add\_request\_mirror() on the request we are adding.
Otherwise, we can end up with a use-after-free if the call to
nfs\_pageio\_add\_request\_mirror() triggers I/O.
Fixes: c917cfaf9bbe ("NFS: Fix up NFS I/O subrequest creation")
Cc: stable@vger.kernel.org
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 8af7a3035045dca1d06f3c326ad3d390c24fcaed
Author: J. Bruce Fields
Date: Thu Mar 19 11:30:38 2020 -0400
nfsd: fsnotify on rmdir under nfsd/clients/
commit 69afd267982e733a555fede4e85fe30329ed0588 upstream.
Userspace should be able to monitor nfsd/clients/ to see when clients
come and go, but we're failing to send fsnotify events.
Cc: stable@kernel.org
Signed-off-by: J. Bruce Fields
Signed-off-by: Chuck Lever
Signed-off-by: Greg Kroah-Hartman
commit 537cab150418fbc67afc579c94b51f713c43f995
Author: Hans de Goede
Date: Wed Mar 25 15:43:10 2020 +0100
drm/vboxvideo: Add missing remove\_conflicting\_pci\_framebuffers call, v2
commit a65a97b48694d34248195eb89bf3687403261056 upstream.
The vboxvideo driver is missing a call to remove conflicting framebuffers.
Surprisingly, when using legacy BIOS booting this does not really cause
any issues. But when using UEFI to boot the VM then plymouth will draw
on both the efifb /dev/fb0 and /dev/drm/card0 (which has registered
/dev/fb1 as fbdev emulation).
VirtualBox will actual display the output of both devices (I guess it is
showing whatever was drawn last), this causes weird artifacts because of
pitch issues in the efifb when the VM window is not sized at 1024x768
(the window will resize to its last size once the vboxvideo driver loads,
changing the pitch).
Adding the missing drm\_fb\_helper\_remove\_conflicting\_pci\_framebuffers()
call fixes this.
Changes in v2:
-Make the drm\_fb\_helper\_remove\_conflicting\_pci\_framebuffers() call one of
the first things we do in our probe() method
Cc: stable@vger.kernel.org
Fixes: 2695eae1f6d3 ("drm/vboxvideo: Switch to generic fbdev emulation")
Signed-off-by: Hans de Goede
Reviewed-by: Daniel Vetter
Link: https://patchwork.freedesktop.org/patch/msgid/20200325144310.36779-1-hdegoede@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit 7a76c7d64d506eec125f098d37529ac78e22950f
Author: Libor Pechacek
Date: Fri Jan 31 14:28:29 2020 +0100
powerpc/pseries: Avoid NULL pointer dereference when drmem is unavailable
commit a83836dbc53e96f13fec248ecc201d18e1e3111d upstream.
In guests without hotplugagble memory drmem structure is only zero
initialized. Trying to manipulate DLPAR parameters results in a crash.
$ echo "memory add count 1" > /sys/kernel/dlpar
Oops: Kernel access of bad area, sig: 11 [#1]
LE PAGE\_SIZE=64K MMU=Hash SMP NR\_CPUS=2048 NUMA pSeries
...
NIP: c0000000000ff294 LR: c0000000000ff248 CTR: 0000000000000000
REGS: c0000000fb9d3880 TRAP: 0300 Tainted: G E (5.5.0-rc6-2-default)
MSR: 8000000000009033  CR: 28242428 XER: 20000000
CFAR: c0000000009a6c10 DAR: 0000000000000010 DSISR: 40000000 IRQMASK: 0
...
NIP dlpar\_memory+0x6e4/0xd00
LR dlpar\_memory+0x698/0xd00
Call Trace:
dlpar\_memory+0x698/0xd00 (unreliable)
handle\_dlpar\_errorlog+0xc0/0x190
dlpar\_store+0x198/0x4a0
kobj\_attr\_store+0x30/0x50
sysfs\_kf\_write+0x64/0x90
kernfs\_fop\_write+0x1b0/0x290
\_\_vfs\_write+0x3c/0x70
vfs\_write+0xd0/0x260
ksys\_write+0xdc/0x130
system\_call+0x5c/0x68
Taking closer look at the code, I can see that for\_each\_drmem\_lmb is a
macro expanding into `for (lmb = &drmem\_info->lmbs[0]; lmb <=
&drmem\_info->lmbs[drmem\_info->n\_lmbs - 1]; lmb++)`. When drmem\_info->lmbs
is NULL, the loop would iterate through the whole address range if it
weren't stopped by the NULL pointer dereference on the next line.
This patch aligns for\_each\_drmem\_lmb and for\_each\_drmem\_lmb\_in\_range
macro behavior with the common C semantics, where the end marker does
not belong to the scanned range, and alters get\_lmb\_range() semantics.
As a side effect, the wraparound observed in the crash is prevented.
Fixes: 6c6ea53725b3 ("powerpc/mm: Separate ibm, dynamic-memory data from DT format")
Cc: stable@vger.kernel.org # v4.16+
Signed-off-by: Libor Pechacek
Signed-off-by: Michal Suchanek
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200131132829.10281-1-msuchanek@suse.de
Signed-off-by: Greg Kroah-Hartman
commit 617452d8bf771c83d7dd2bc2050a9953453b93b6
Author: Imre Deak
Date: Mon Mar 30 18:22:44 2020 +0300
drm/i915/icl+: Don't enable DDI IO power on a TypeC port in TBT mode
commit 6e8a36c13382b7165d23928caee8d91c1b301142 upstream.
The DDI IO power well must not be enabled for a TypeC port in TBT mode,
ensure this during driver loading/system resume.
This gets rid of error messages like
[drm] \*ERROR\* power well DDI E TC2 IO state mismatch (refcount 1/enabled 0)
and avoids leaking the power ref when disabling the output.
Cc:  # v5.4+
Signed-off-by: Imre Deak
Reviewed-by: José Roberto de Souza
Link: https://patchwork.freedesktop.org/patch/msgid/20200330152244.11316-1-imre.deak@intel.com
(cherry picked from commit f77a2db27f26c3ccba0681f7e89fef083718f07f)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Greg Kroah-Hartman
commit cf36bed67b772225546554e4c369b96c387eba86
Author: Marek Szyprowski
Date: Fri Mar 27 17:21:26 2020 +0100
drm/prime: fix extracting of the DMA addresses from a scatterlist
commit c0f83d164fb8f3a2b7bc379a6c1e27d1123a9eab upstream.
Scatterlist elements contains both pages and DMA addresses, but one
should not assume 1:1 relation between them. The sg->length is the size
of the physical memory chunk described by the sg->page, while
sg\_dma\_len(sg) is the size of the DMA (IO virtual) chunk described by
the sg\_dma\_address(sg).
The proper way of extracting both: pages and DMA addresses of the whole
buffer described by a scatterlist it to iterate independently over the
sg->pages/sg->length and sg\_dma\_address(sg)/sg\_dma\_len(sg) entries.
Fixes: 42e67b479eab ("drm/prime: use dma length macro when mapping sg")
Signed-off-by: Marek Szyprowski
Reviewed-by: Alex Deucher
Signed-off-by: Alex Deucher
Link: https://patchwork.freedesktop.org/patch/msgid/20200327162126.29705-1-m.szyprowski@samsung.com
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit a924ec1a2c7d59ca8c50aae377f160ea9c75cab9
Author: Michael Strauss
Date: Sun Apr 5 16:41:12 2020 -0400
drm/amd/display: Check for null fclk voltage when parsing clock table
commit 72f5b5a308c744573fdbc6c78202c52196d2c162 upstream.
[WHY]
In cases where a clock table is malformed such that fclk entries have
frequencies but not voltages listed, we don't catch the error and set
clocks to 0 instead of using hardcoded values as we should.
[HOW]
Add check for clock tables fclk entry's voltage as well
Signed-off-by: Michael Strauss
Reviewed-by: Eric Yang
Acked-by: Rodrigo Siqueira
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 2915a98997be9f215abd9ce5d1021bec5e4b984b
Author: Aaron Liu
Date: Tue Apr 7 17:46:04 2020 +0800
drm/amdgpu: unify fw\_write\_wait for new gfx9 asics
commit 2960758cce2310774de60bbbd8d6841d436c54d9 upstream.
Make the fw\_write\_wait default case true since presumably all new
gfx9 asics will have updated firmware. That is using unique WAIT\_REG\_MEM
packet with opration=1.
Signed-off-by: Aaron Liu
Tested-by: Aaron Liu
Tested-by: Yuxian Dai
Acked-by: Alex Deucher
Acked-by: Huang Rui
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 75bd8f735d6276d1be8702da65d21299257c7e5e
Author: Prike Liang
Date: Fri Apr 3 12:26:15 2020 +0800
drm/amd/powerplay: implement the is\_dpm\_running()
commit 4ee2bb22ddb53a2eafc675690d0d67452029ca37 upstream.
As the pmfw hasn't exported the interface of SMU feature
mask to APU SKU so just force on all the features to driver
inquired interface at early initial stage.
Signed-off-by: Prike Liang
Reviewed-by: Huang Rui
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 635529ed928b187ccdad88474aae26f7a1e9455b
Author: Yuxian Dai
Date: Wed Apr 1 19:26:26 2020 +0800
drm/amdgpu/powerplay: using the FCLK DPM table to set the MCLK
commit 022ac4c9c55be35a2d1f71019a931324c51b0dab upstream.
1.Using the FCLK DPM table to set the MCLK for DPM states consist of
three entities:
FCLK
UCLK
MEMCLK
All these three clk change together, MEMCLK from FCLK, so use the fclk
frequency.
2.we should show the current working clock freqency from clock table metric
Signed-off-by: Yuxian Dai
Reviewed-by: Alex Deucher
Reviewed-by: Huang Rui
Reviewed-by: Kevin Wang
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 3c4346379788ef2c3898301693a39e4c0b885437
Author: Chris Wilson
Date: Sun Feb 2 17:16:31 2020 +0000
drm: Remove PageReserved manipulation from drm\_pci\_alloc
commit ea36ec8623f56791c6ff6738d0509b7920f85220 upstream.
drm\_pci\_alloc/drm\_pci\_free are very thin wrappers around the core dma
facilities, and we have no special reason within the drm layer to behave
differently. In particular, since
commit de09d31dd38a50fdce106c15abd68432eebbd014
Author: Kirill A. Shutemov
Date: Fri Jan 15 16:51:42 2016 -0800
page-flags: define PG\_reserved behavior on compound pages
As far as I can see there's no users of PG\_reserved on compound pages.
Let's use PF\_NO\_COMPOUND here.
it has been illegal to combine GFP\_COMP with SetPageReserved, so lets
stop doing both and leave the dma layer to its own devices.
Reported-by: Taketo Kabe
Bug: https://gitlab.freedesktop.org/drm/intel/issues/1027
Fixes: de09d31dd38a ("page-flags: define PG\_reserved behavior on compound pages")
Signed-off-by: Chris Wilson
Cc:  # v4.5+
Reviewed-by: Alex Deucher
Link: https://patchwork.freedesktop.org/patch/msgid/20200202171635.4039044-1-chris@chris-wilson.co.uk
Signed-off-by: Greg Kroah-Hartman
commit 46d3729cdd01b0e94f2101016a407ec44c7bc71d
Author: Christian Gmeiner
Date: Fri Feb 28 11:37:49 2020 +0100
drm/etnaviv: rework perfmon query infrastructure
commit ed1dd899baa32d47d9a93d98336472da50564346 upstream.
Report the correct perfmon domains and signals depending
on the supported feature flags.
Reported-by: Dan Carpenter
Fixes: 9e2c2e273012 ("drm/etnaviv: add infrastructure to query perf counter")
Cc: stable@vger.kernel.org
Signed-off-by: Christian Gmeiner
Signed-off-by: Lucas Stach
Signed-off-by: Greg Kroah-Hartman
commit 8da826efb6e124350f488c717cf40dedd871e5e0
Author: Torsten Duwe
Date: Tue Feb 18 16:57:44 2020 +0100
drm/bridge: analogix-anx78xx: Fix drm\_dp\_link helper removal
commit 3e138a63d6674a4567a018a31e467567c40b14d5 upstream.
drm\_dp\_link\_rate\_to\_bw\_code and ...bw\_code\_to\_link\_rate simply divide by
and multiply with 27000, respectively. Avoid an overflow in the u8 dpcd[0]
and the multiply+divide alltogether.
Signed-off-by: Torsten Duwe
Fixes: ff1e8fb68ea0 ("drm/bridge: analogix-anx78xx: Avoid drm\_dp\_link helpers")
Cc: Thierry Reding
Cc: Daniel Vetter
Cc: Andrzej Hajda
Cc: Neil Armstrong
Cc: Laurent Pinchart
Cc: Jonas Karlman
Cc: Jernej Skrabec
Cc:  # v5.5+
Reviewed-by: Thierry Reding
Signed-off-by: Thomas Zimmermann
Link: https://patchwork.freedesktop.org/patch/msgid/20200218155744.9675368BE1@verein.lst.de
Signed-off-by: Greg Kroah-Hartman
commit dd3edecc6f878d34b45ea3cf346e06ec313a4544
Author: Chris Wilson
Date: Mon Apr 6 12:48:21 2020 +0100
drm/i915/gem: Flush all the reloc\_gpu batch
commit 1aaea8476d9f014667d2cb24819f9bcaf3ebb7a4 upstream.
\_\_i915\_gem\_object\_flush\_map() takes a byte range, so feed it the written
bytes and do not mistake the u32 index as bytes!
Fixes: a679f58d0510 ("drm/i915: Flush pages on acquisition")
Signed-off-by: Chris Wilson
Cc: Matthew Auld
Cc:  # v5.2+
Reviewed-by: Matthew Auld
Link: https://patchwork.freedesktop.org/patch/msgid/20200406114821.10949-1-chris@chris-wilson.co.uk
(cherry picked from commit 30c88a47f1abd5744908d3681f54dcf823fe2a12)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Greg Kroah-Hartman
commit 7327374fc83e3c4acefd496509b5dceab9ce0049
Author: Eric Auger
Date: Tue Mar 24 09:26:30 2020 -0600
vfio: platform: Switch to platform\_get\_irq\_optional()
commit 723fe298ad85ad1278bd2312469ad14738953cc6 upstream.
Since commit 7723f4c5ecdb ("driver core: platform: Add an error
message to platform\_get\_irq\*()"), platform\_get\_irq() calls dev\_err()
on an error. As we enumerate all interrupts until platform\_get\_irq()
fails, we now systematically get a message such as:
"vfio-platform fff51000.ethernet: IRQ index 3 not found" which is
a false positive.
Let's use platform\_get\_irq\_optional() instead.
Signed-off-by: Eric Auger
Cc: stable@vger.kernel.org # v5.3+
Reviewed-by: Andre Przywara
Tested-by: Andre Przywara
Signed-off-by: Alex Williamson
Signed-off-by: Greg Kroah-Hartman
commit 625b4439bebdfb122eabf2100c3c7c5f549a514e
Author: Michael Ellerman
Date: Fri Mar 27 20:53:19 2020 +1100
selftests/powerpc: Fix try-run when source tree is not writable
commit 9686813f6e9d5568bc045de0be853411e44958c8 upstream.
We added a usage of try-run to pmu/ebb/Makefile to detect if the
toolchain supported the -no-pie option.
This fails if we build out-of-tree and the source tree is not
writable, as try-run tries to write its temporary files to the current
directory. That leads to the -no-pie option being silently dropped,
which leads to broken executables with some toolchains.
If we remove the redirect to /dev/null in try-run, we see the error:
make[3]: Entering directory '/linux/tools/testing/selftests/powerpc/pmu/ebb'
/usr/bin/ld: cannot open output file .54.tmp: Read-only file system
collect2: error: ld returned 1 exit status
make[3]: Nothing to be done for 'all'.
And looking with strace we see it's trying to use a file that's in the
source tree:
lstat("/linux/tools/testing/selftests/powerpc/pmu/ebb/.54.tmp", 0x7ffffc0f83c8)
We can fix it by setting TMPOUT to point to the $(OUTPUT) directory,
and we can verify with strace it's now trying to write to the output
directory:
lstat("/output/kselftest/powerpc/pmu/ebb/.54.tmp", 0x7fffd1bf6bf8)
And also see that the -no-pie option is now correctly detected.
Fixes: 0695f8bca93e ("selftests/powerpc: Handle Makefile for unrecognized option")
Cc: stable@vger.kernel.org # v5.5+
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20200327095319.2347641-1-mpe@ellerman.id.au
Signed-off-by: Greg Kroah-Hartman
commit 0a02377943216e1d0a1d0314d9446e8fb45e66de
Author: Christophe Leroy
Date: Fri Feb 28 00:00:09 2020 +0000
selftests/powerpc: Add tlbie\_test in .gitignore
commit 47bf235f324c696395c30541fe4fcf99fcd24188 upstream.
The commit identified below added tlbie\_test but forgot to add it in
.gitignore.
Fixes: 93cad5f78995 ("selftests/powerpc: Add test case for tlbie vs mtpidr ordering issue")
Cc: stable@vger.kernel.org # v5.4+
Signed-off-by: Christophe Leroy
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/259f9c06ed4563c4fa4fa8ffa652347278d769e7.1582847784.git.christophe.leroy@c-s.fr
Signed-off-by: Greg Kroah-Hartman
commit bc96c39f2046e2c2abb094d6da4425b1c245e202
Author: Christophe Leroy
Date: Wed Apr 1 21:11:51 2020 -0700
selftests/vm: fix map\_hugetlb length used for testing read and write
commit cabc30da10e677c67ab9a136b1478175734715c5 upstream.
Commit fa7b9a805c79 ("tools/selftest/vm: allow choosing mem size and page
size in map\_hugetlb") added the possibility to change the size of memory
mapped for the test, but left the read and write test using the default
value. This is unnoticed when mapping a length greater than the default
one, but segfaults otherwise.
Fix read\_bytes() and write\_bytes() by giving them the real length.
Also fix the call to munmap().
Fixes: fa7b9a805c79 ("tools/selftest/vm: allow choosing mem size and page size in map\_hugetlb")
Signed-off-by: Christophe Leroy
Signed-off-by: Andrew Morton
Reviewed-by: Leonardo Bras
Cc: Michael Ellerman
Cc: Shuah Khan
Cc:
Link: http://lkml.kernel.org/r/9a404a13c871c4bd0ba9ede68f69a1225180dd7e.1580978385.git.christophe.leroy@c-s.fr
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 52794bc3d9dc2e9e5ba5caf401f568b8b44ca824
Author: Michal Hocko
Date: Wed Apr 1 21:10:25 2020 -0700
selftests: vm: drop dependencies on page flags from mlock2 tests
commit eea274d64e6ea8aff2224d33d0851133a84cc7b5 upstream.
It was noticed that mlock2 tests are failing after 9c4e6b1a7027f ("mm,
mlock, vmscan: no more skipping pagevecs") because the patch has changed
the timing on when the page is added to the unevictable LRU list and thus
gains the unevictable page flag.
The test was just too dependent on the implementation details which were
true at the time when it was introduced. Page flags and the timing when
they are set is something no userspace should ever depend on. The test
should be testing only for the user observable contract of the tested
syscalls. Those are defined pretty well for the mlock and there are other
means for testing them. In fact this is already done and testing for page
flags can be safely dropped to achieve the aimed purpose. Present bits
can be checked by /proc//smaps RSS field and the locking state by
VmFlags although I would argue that Locked: field would be more
appropriate.
Drop all the page flag machinery and considerably simplify the test. This
should be more robust for future kernel changes while checking the
promised contract is still valid.
Fixes: 9c4e6b1a7027f ("mm, mlock, vmscan: no more skipping pagevecs")
Reported-by: Rafael Aquini
Signed-off-by: Michal Hocko
Signed-off-by: Andrew Morton
Acked-by: Rafael Aquini
Cc: Shakeel Butt
Cc: Eric B Munson
Cc: Shuah Khan
Cc:
Link: http://lkml.kernel.org/r/20200324154218.GS19542@dhcp22.suse.cz
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 390b769cb0dda7e26a9319000eefcbafdb541047
Author: Fredrik Strupe
Date: Wed Apr 8 13:29:41 2020 +0200
arm64: armv8\_deprecated: Fix undef\_hook mask for thumb setend
commit fc2266011accd5aeb8ebc335c381991f20e26e33 upstream.
For thumb instructions, call\_undef\_hook() in traps.c first reads a u16,
and if the u16 indicates a T32 instruction (u16 >= 0xe800), a second
u16 is read, which then makes up the the lower half-word of a T32
instruction. For T16 instructions, the second u16 is not read,
which makes the resulting u32 opcode always have the upper half set to
0.
However, having the upper half of instr\_mask in the undef\_hook set to 0
masks out the upper half of all thumb instructions - both T16 and T32.
This results in trapped T32 instructions with the lower half-word equal
to the T16 encoding of setend (b650) being matched, even though the upper
half-word is not 0000 and thus indicates a T32 opcode.
An example of such a T32 instruction is eaa0b650, which should raise a
SIGILL since T32 instructions with an eaa prefix are unallocated as per
Arm ARM, but instead works as a SETEND because the second half-word is set
to b650.
This patch fixes the issue by extending instr\_mask to include the
upper u32 half, which will still match T16 instructions where the upper
half is 0, but not T32 instructions.
Fixes: 2d888f48e056 ("arm64: Emulate SETEND for AArch32 tasks")
Cc:  # 4.0.x-
Reviewed-by: Suzuki K Poulose
Signed-off-by: Fredrik Strupe
Signed-off-by: Catalin Marinas
Signed-off-by: Greg Kroah-Hartman
commit 318e7113418553fe2191755d20ea17f186841a47
Author: Dave Gerlach
Date: Wed Mar 11 16:41:11 2020 +0200
arm64: dts: ti: k3-am65: Add clocks to dwc3 nodes
commit a81e5442d796ccfa2cc97d205a5477053264d978 upstream.
The TI sci-clk driver can scan the DT for all clocks provided by system
firmware and does this by checking the clocks property of all nodes, so
we must add this to the dwc3 nodes so USB clocks are available.
Without this USB does not work with latest system firmware i.e.
[ 1.714662] clk: couldn't get parent clock 0 for /interconnect@100000/dwc3@4020000
Fixes: cc54a99464ccd ("arm64: dts: ti: k3-am6: add USB suppor")
Signed-off-by: Dave Gerlach
Signed-off-by: Roger Quadros
Cc: stable@kernel.org
Signed-off-by: Tero Kristo
Signed-off-by: Greg Kroah-Hartman
commit ddde67d887e03d56a6566a8c50952f4f06599beb
Author: Marek Szyprowski
Date: Wed Mar 4 15:37:26 2020 +0100
ARM: dts: exynos: Fix polarity of the LCD SPI bus on UniversalC210 board
commit 32a1671ff8e84f0dfff3a50d4b2091d25e91f5e2 upstream.
Recent changes in the SPI core and the SPI-GPIO driver revealed that the
GPIO lines for the LD9040 LCD controller on the UniversalC210 board are
defined incorrectly. Fix the polarity for those lines to match the old
behavior and hardware requirements to fix LCD panel operation with
recent kernels.
Cc:  # 5.0.x
Signed-off-by: Marek Szyprowski
Reviewed-by: Andrzej Hajda
Signed-off-by: Krzysztof Kozlowski
Signed-off-by: Greg Kroah-Hartman
commit 84cd2f5360336d7e76fc630af341595eaa964c4a
Author: James Smart
Date: Mon Jan 27 16:23:03 2020 -0800
scsi: lpfc: Fix broken Credit Recovery after driver load
commit 835214f5d5f516a38069bc077c879c7da00d6108 upstream.
When driver is set to enable bb credit recovery, the switch displayed the
setting as inactive. If the link bounces, it switches to Active.
During link up processing, the driver currently does a MBX\_READ\_SPARAM
followed by a MBX\_CONFIG\_LINK. These mbox commands are queued to be
executed, one at a time and the completion is processed by the worker
thread. Since the MBX\_READ\_SPARAM is done BEFORE the MBX\_CONFIG\_LINK, the
BB\_SC\_N bit is never set the the returned values. BB Credit recovery status
only gets set after the driver requests the feature in CONFIG\_LINK, which
is done after the link up. Thus the ordering of READ\_SPARAM needs to follow
the CONFIG\_LINK.
Fix by reordering so that READ\_SPARAM is done after CONFIG\_LINK. Added a
HBA\_DEFER\_FLOGI flag so that any FLOGI handling waits until after the
READ\_SPARAM is done so that the proper BB credit value is set in the FLOGI
payload.
Fixes: 6bfb16208298 ("scsi: lpfc: Fix configuration of BB credit recovery in service parameters")
Cc:  # v5.4+
Link: https://lore.kernel.org/r/20200128002312.16346-4-jsmart2021@gmail.com
Signed-off-by: Dick Kennedy
Signed-off-by: James Smart
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 0c560bc54a55cb2f3a4a95f88ff75b88ffc005b4
Author: James Smart
Date: Mon Jan 27 16:23:02 2020 -0800
scsi: lpfc: Fix lpfc\_io\_buf resource leak in lpfc\_get\_scsi\_buf\_s4 error path
commit 0ab384a49c548baf132ccef249f78d9c6c506380 upstream.
If a call to lpfc\_get\_cmd\_rsp\_buf\_per\_hdwq returns NULL (memory allocation
failure), a previously allocated lpfc\_io\_buf resource is leaked.
Fix by releasing the lpfc\_io\_buf resource in the failure path.
Fixes: d79c9e9d4b3d ("scsi: lpfc: Support dynamic unbounded SGL lists on G7 hardware.")
Cc:  # v5.4+
Link: https://lore.kernel.org/r/20200128002312.16346-3-jsmart2021@gmail.com
Signed-off-by: Dick Kennedy
Signed-off-by: James Smart
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit ee1c23227323d923caf928f82d654ce3eb7fa64e
Author: Stanley Chu
Date: Wed Jan 29 18:52:50 2020 +0800
scsi: ufs: fix Auto-Hibern8 error detection
commit 5a244e0ea67b293abb1d26c825db2ddde5f2862f upstream.
Auto-Hibern8 may be disabled by some vendors or sysfs in runtime even if
Auto-Hibern8 capability is supported by host. If Auto-Hibern8 capability is
supported by host but not actually enabled, Auto-Hibern8 error shall not
happen.
To fix this, provide a way to detect if Auto-Hibern8 is actually enabled
first, and bypass Auto-Hibern8 disabling case in
ufshcd\_is\_auto\_hibern8\_error().
Fixes: 821744403913 ("scsi: ufs: Add error-handling of Auto-Hibernate")
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20200129105251.12466-4-stanley.chu@mediatek.com
Reviewed-by: Bean Huo
Reviewed-by: Alim Akhtar
Reviewed-by: Asutosh Das
Reviewed-by: Can Guo
Signed-off-by: Stanley Chu
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit b1b4ea2f81313a1f89dc99f6412f461ef10edba2
Author: Steffen Maier
Date: Thu Mar 12 18:44:56 2020 +0100
scsi: zfcp: fix missing erp\_lock in port recovery trigger for point-to-point
commit 819732be9fea728623e1ed84eba28def7384ad1f upstream.
v2.6.27 commit cc8c282963bd ("[SCSI] zfcp: Automatically attach remote
ports") introduced zfcp automatic port scan.
Before that, the user had to use the sysfs attribute "port\_add" of an FCP
device (adapter) to add and open remote (target) ports, even for the remote
peer port in point-to-point topology. That code path did a proper port open
recovery trigger taking the erp\_lock.
Since above commit, a new helper function zfcp\_erp\_open\_ptp\_port()
performed an UNlocked port open recovery trigger. This can race with other
parallel recovery triggers. In zfcp\_erp\_action\_enqueue() this could corrupt
e.g. adapter->erp\_total\_count or adapter->erp\_ready\_head.
As already found for fabric topology in v4.17 commit fa89adba1941 ("scsi:
zfcp: fix infinite iteration on ERP ready list"), there was an endless loop
during tracing of rport (un)block. A subsequent v4.18 commit 9e156c54ace3
("scsi: zfcp: assert that the ERP lock is held when tracing a recovery
trigger") introduced a lockdep assertion for that case.
As a side effect, that lockdep assertion now uncovered the unlocked code
path for PtP. It is from within an adapter ERP action:
zfcp\_erp\_strategy[1479] intentionally DROPs erp lock around
zfcp\_erp\_strategy\_do\_action()
zfcp\_erp\_strategy\_do\_action[1441] NO erp lock
zfcp\_erp\_adapter\_strategy[876] NO erp lock
zfcp\_erp\_adapter\_strategy\_open[855] NO erp lock
zfcp\_erp\_adapter\_strategy\_open\_fsf[806]NO erp lock
zfcp\_erp\_adapter\_strat\_fsf\_xconf[772] erp lock only around
zfcp\_erp\_action\_to\_running(),
BUT \*\_not\_\* around
zfcp\_erp\_enqueue\_ptp\_port()
zfcp\_erp\_enqueue\_ptp\_port[728] BUG: \*\_not\_\* taking erp lock
\_zfcp\_erp\_port\_reopen[432] assumes to be called with erp lock
zfcp\_erp\_action\_enqueue[314] assumes to be called with erp lock
zfcp\_dbf\_rec\_trig[288] \_checks\_ to be called with erp lock:
lockdep\_assert\_held(&adapter->erp\_lock);
It causes the following lockdep warning:
WARNING: CPU: 2 PID: 775 at drivers/s390/scsi/zfcp\_dbf.c:288
zfcp\_dbf\_rec\_trig+0x16a/0x188
no locks held by zfcperp0.0.17c0/775.
Fix this by using the proper locked recovery trigger helper function.
Link: https://lore.kernel.org/r/20200312174505.51294-2-maier@linux.ibm.com
Fixes: cc8c282963bd ("[SCSI] zfcp: Automatically attach remote ports")
Cc:  #v2.6.27+
Reviewed-by: Jens Remus
Reviewed-by: Benjamin Block
Signed-off-by: Steffen Maier
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 7752e7c0fc1dee32a3a6353de69bcbc37badac2b
Author: Gilad Ben-Yossef
Date: Sun Feb 2 18:19:14 2020 +0200
crypto: ccree - dec auth tag size from cryptlen map
commit 8962c6d2c2b8ca51b0f188109015b15fc5f4da44 upstream.
Remove the auth tag size from cryptlen before mapping the destination
in out-of-place AEAD decryption thus resolving a crash with
extended testmgr tests.
Signed-off-by: Gilad Ben-Yossef
Reported-by: Geert Uytterhoeven
Cc: stable@vger.kernel.org # v4.19+
Tested-by: Geert Uytterhoeven
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 4a812dd1e1a691b34b7a4be797ff5bcb61579b0f
Author: Gilad Ben-Yossef
Date: Wed Jan 29 16:37:55 2020 +0200
crypto: ccree - only try to map auth tag if needed
commit 504e84abec7a635b861afd8d7f92ecd13eaa2b09 upstream.
Make sure to only add the size of the auth tag to the source mapping
for encryption if it is an in-place operation. Failing to do this
previously caused us to try and map auth size len bytes from a NULL
mapping and crashing if both the cryptlen and assoclen are zero.
Reported-by: Geert Uytterhoeven
Tested-by: Geert Uytterhoeven
Signed-off-by: Gilad Ben-Yossef
Cc: stable@vger.kernel.org # v4.19+
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 4d980ce4c0e73b8c2fdee1744bd22e45dd9eedf7
Author: Gilad Ben-Yossef
Date: Wed Jan 29 16:37:54 2020 +0200
crypto: ccree - protect against empty or NULL scatterlists
commit ce0fc6db38decf0d2919bfe783de6d6b76e421a9 upstream.
Deal gracefully with a NULL or empty scatterlist which can happen
if both cryptlen and assoclen are zero and we're doing in-place
AEAD encryption.
This fixes a crash when this causes us to try and map a NULL page,
at least with some platforms / DMA mapping configs.
Cc: stable@vger.kernel.org # v4.19+
Reported-by: Geert Uytterhoeven
Tested-by: Geert Uytterhoeven
Signed-off-by: Gilad Ben-Yossef
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit bf06cc883990318792dc6361cc3987465d982819
Author: Andrei Botila
Date: Fri Feb 28 12:46:48 2020 +0200
crypto: caam - update xts sector size for large input length
commit 3f142b6a7b573bde6cff926f246da05652c61eb4 upstream.
Since in the software implementation of XTS-AES there is
no notion of sector every input length is processed the same way.
CAAM implementation has the notion of sector which causes different
results between the software implementation and the one in CAAM
for input lengths bigger than 512 bytes.
Increase sector size to maximum value on 16 bits.
Fixes: c6415a6016bf ("crypto: caam - add support for acipher xts(aes)")
Cc:  # v4.12+
Signed-off-by: Andrei Botila
Reviewed-by: Horia Geantă
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 13cc917bfa2f26dfa7d720c935c5b73184940a9e
Author: Horia Geantă
Date: Fri Feb 28 08:51:23 2020 +0200
crypto: caam/qi2 - fix chacha20 data size error
commit 3a5a9e1ef37b030b836d92df8264f840988f4a38 upstream.
HW generates a Data Size error for chacha20 requests that are not
a multiple of 64B, since algorithm state (AS) does not have
the FINAL bit set.
Since updating req->iv (for chaining) is not required,
modify skcipher descriptors to set the FINAL bit for chacha20.
[Note that for skcipher decryption we know that ctx1\_iv\_off is 0,
which allows for an optimization by not checking algorithm type,
since append\_dec\_op1() sets FINAL bit for all algorithms except AES.]
Also drop the descriptor operations that save the IV.
However, in order to keep code logic simple, things like
S/G tables generation etc. are not touched.
Cc:  # v5.3+
Fixes: 334d37c9e263 ("crypto: caam - update IV using HW support")
Signed-off-by: Horia Geantă
Tested-by: Valentin Ciocoi Radulescu
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 6295d6374a69a76eaa8d989ddb8f116328169fce
Author: Matthew Wilcox (Oracle)
Date: Thu Mar 12 17:29:11 2020 -0400
xarray: Fix early termination of xas\_for\_each\_marked
commit 7e934cf5ace1dceeb804f7493fa28bb697ed3c52 upstream.
xas\_for\_each\_marked() is using entry == NULL as a termination condition
of the iteration. When xas\_for\_each\_marked() is used protected only by
RCU, this can however race with xas\_store(xas, NULL) in the following
way:
TASK1 TASK2
page\_cache\_delete() find\_get\_pages\_range\_tag()
xas\_for\_each\_marked()
xas\_find\_marked()
off = xas\_find\_chunk()
xas\_store(&xas, NULL)
xas\_init\_marks(&xas);
...
rcu\_assign\_pointer(\*slot, NULL);
entry = xa\_entry(off);
And thus xas\_for\_each\_marked() terminates prematurely possibly leading
to missed entries in the iteration (translating to missing writeback of
some pages or a similar problem).
If we find a NULL entry that has been marked, skip it (unless we're trying
to allocate an entry).
Reported-by: Jan Kara
CC: stable@vger.kernel.org
Fixes: ef8e5717db01 ("page cache: Convert delete\_batch to XArray")
Signed-off-by: Matthew Wilcox (Oracle)
Signed-off-by: Greg Kroah-Hartman
commit d849c6103b048dbd43667444fe95b7a89456b4e1
Author: Matthew Wilcox (Oracle)
Date: Fri Jan 31 06:17:09 2020 -0500
XArray: Fix xas\_pause for large multi-index entries
commit c36d451ad386b34f452fc3c8621ff14b9eaa31a6 upstream.
Inspired by the recent Coverity report, I looked for other places where
the offset wasn't being converted to an unsigned long before being
shifted, and I found one in xas\_pause() when the entry being paused is
of order >32.
Fixes: b803b42823d0 ("xarray: Add XArray iterators")
Signed-off-by: Matthew Wilcox (Oracle)
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 54aabddcf0b7e0cf51cbf80c1b9ee03e2723f7d2
Author: Nikos Tsironis
Date: Fri Mar 27 16:01:11 2020 +0200
dm clone metadata: Fix return type of dm\_clone\_nr\_of\_hydrated\_regions()
commit 81d5553d1288c2ec0390f02f84d71ca0f0f9f137 upstream.
dm\_clone\_nr\_of\_hydrated\_regions() returns the number of regions that
have been hydrated so far. In order to do so it employs bitmap\_weight().
Until now, the return type of dm\_clone\_nr\_of\_hydrated\_regions() was
unsigned long.
Because bitmap\_weight() returns an int, in case BITS\_PER\_LONG == 64 and
the return value of bitmap\_weight() is 2^31 (the maximum allowed number
of regions for a device), the result is sign extended from 32 bits to 64
bits and an incorrect value is displayed, in the status output of
dm-clone, as the number of hydrated regions.
Fix this by having dm\_clone\_nr\_of\_hydrated\_regions() return an unsigned
int.
Fixes: 7431b7835f55 ("dm: add clone target")
Cc: stable@vger.kernel.org # v5.4+
Signed-off-by: Nikos Tsironis
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 6709d665259a678200af6fb7ce9b95a3e3aae74f
Author: Nikos Tsironis
Date: Fri Mar 27 16:01:10 2020 +0200
dm clone: Add missing casts to prevent overflows and data corruption
commit 9fc06ff56845cc5ccafec52f545fc2e08d22f849 upstream.
Add missing casts when converting from regions to sectors.
In case BITS\_PER\_LONG == 32, the lack of the appropriate casts can lead
to overflows and miscalculation of the device sector.
As a result, we could end up discarding and/or copying the wrong parts
of the device, thus corrupting the device's data.
Fixes: 7431b7835f55 ("dm: add clone target")
Cc: stable@vger.kernel.org # v5.4+
Signed-off-by: Nikos Tsironis
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit c159c51aa421f88d488a744d7b871e2e0c42ab45
Author: Nikos Tsironis
Date: Fri Mar 27 16:01:09 2020 +0200
dm clone: Add overflow check for number of regions
commit cd481c12269b4d276f1a52eda0ebd419079bfe3a upstream.
Add overflow check for clone->nr\_regions variable, which holds the
number of regions of the target.
The overflow can occur with sufficiently large devices, if BITS\_PER\_LONG
== 32. E.g., if the region size is 8 sectors (4K), the overflow would
occur for device sizes > 34359738360 sectors (~16TB).
This could result in multiple device sectors wrongly mapping to the same
region number, due to the truncation from 64 bits to 32 bits, which
would lead to data corruption.
Fixes: 7431b7835f55 ("dm: add clone target")
Cc: stable@vger.kernel.org # v5.4+
Signed-off-by: Nikos Tsironis
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit d57808385c1aff1c66d5d51e040395a5efdec8fb
Author: Nikos Tsironis
Date: Fri Mar 27 16:01:08 2020 +0200
dm clone: Fix handling of partial region discards
commit 4b5142905d4ff58a4b93f7c8eaa7ba829c0a53c9 upstream.
There is a bug in the way dm-clone handles discards, which can lead to
discarding the wrong blocks or trying to discard blocks beyond the end
of the device.
This could lead to data corruption, if the destination device indeed
discards the underlying blocks, i.e., if the discard operation results
in the original contents of a block to be lost.
The root of the problem is the code that calculates the range of regions
covered by a discard request and decides which regions to discard.
Since dm-clone handles the device in units of regions, we don't discard
parts of a region, only whole regions.
The range is calculated as:
rs = dm\_sector\_div\_up(bio->bi\_iter.bi\_sector, clone->region\_size);
re = bio\_end\_sector(bio) >> clone->region\_shift;
, where 'rs' is the first region to discard and (re - rs) is the number
of regions to discard.
The bug manifests when we try to discard part of a single region, i.e.,
when we try to discard a block with size < region\_size, and the discard
request both starts at an offset with respect to the beginning of that
region and ends before the end of the region.
The root cause is the following comparison:
if (rs == re)
// skip discard and complete original bio immediately
, which doesn't take into account that 'rs' might be greater than 're'.
Thus, we then issue a discard request for the wrong blocks, instead of
skipping the discard all together.
Fix the check to also take into account the above case, so we don't end
up discarding the wrong blocks.
Also, add some range checks to dm\_clone\_set\_region\_hydrated() and
dm\_clone\_cond\_set\_range(), which update dm-clone's region bitmap.
Note that the aforementioned bug doesn't cause invalid memory accesses,
because dm\_clone\_is\_range\_hydrated() returns True for this case, so the
checks are just precautionary.
Fixes: 7431b7835f55 ("dm: add clone target")
Cc: stable@vger.kernel.org # v5.4+
Signed-off-by: Nikos Tsironis
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 016e73f75aba65654ccf5ba0f695b35c96cab582
Author: Bob Liu
Date: Tue Mar 24 21:22:45 2020 +0800
dm zoned: remove duplicate nr\_rnd\_zones increase in dmz\_init\_zone()
commit b8fdd090376a7a46d17db316638fe54b965c2fb0 upstream.
zmd->nr\_rnd\_zones was increased twice by mistake. The other place it
is increased in dmz\_init\_zone() is the only one needed:
1131 zmd->nr\_useable\_zones++;
1132 if (dmz\_is\_rnd(zone)) {
1133 zmd->nr\_rnd\_zones++;
^^^
Fixes: 3b1a94c88b79 ("dm zoned: drive-managed zoned block device target")
Cc: stable@vger.kernel.org
Signed-off-by: Bob Liu
Reviewed-by: Damien Le Moal
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit e3dd9eb82a8782954d97d8bbd78bd54e7df8ac75
Author: Shetty, Harshini X (EXT-Sony Mobile)
Date: Tue Mar 17 09:15:45 2020 +0000
dm verity fec: fix memory leak in verity\_fec\_dtr
commit 75fa601934fda23d2f15bf44b09c2401942d8e15 upstream.
Fix below kmemleak detected in verity\_fec\_ctr. output\_pool is
allocated for each dm-verity-fec device. But it is not freed when
dm-table for the verity target is removed. Hence free the output
mempool in destructor function verity\_fec\_dtr.
unreferenced object 0xffffffffa574d000 (size 4096):
comm "init", pid 1667, jiffies 4294894890 (age 307.168s)
hex dump (first 32 bytes):
8e 36 00 98 66 a8 0b 9b 00 00 00 00 00 00 00 00 .6..f...........
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
backtrace:
[<0000000060e82407>] \_\_kmalloc+0x2b4/0x340
[<00000000dd99488f>] mempool\_kmalloc+0x18/0x20
[<000000002560172b>] mempool\_init\_node+0x98/0x118
[<000000006c3574d2>] mempool\_init+0x14/0x20
[<0000000008cb266e>] verity\_fec\_ctr+0x388/0x3b0
[<000000000887261b>] verity\_ctr+0x87c/0x8d0
[<000000002b1e1c62>] dm\_table\_add\_target+0x174/0x348
[<000000002ad89eda>] table\_load+0xe4/0x328
[<000000001f06f5e9>] dm\_ctl\_ioctl+0x3b4/0x5a0
[<00000000bee5fbb7>] do\_vfs\_ioctl+0x5dc/0x928
[<00000000b475b8f5>] \_\_arm64\_sys\_ioctl+0x70/0x98
[<000000005361e2e8>] el0\_svc\_common+0xa0/0x158
[<000000001374818f>] el0\_svc\_handler+0x6c/0x88
[<000000003364e9f4>] el0\_svc+0x8/0xc
[<000000009d84cec9>] 0xffffffffffffffff
Fixes: a739ff3f543af ("dm verity: add support for forward error correction")
Depends-on: 6f1c819c219f7 ("dm: convert to bioset\_init()/mempool\_init()")
Cc: stable@vger.kernel.org
Signed-off-by: Harshini Shetty
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 31cc25c635b64d3dc9fec102196fc0d9450c10e8
Author: Mikulas Patocka
Date: Sun Mar 22 20:42:21 2020 +0100
dm integrity: fix a crash with unusually large tag size
commit b93b6643e9b5a7f260b931e97f56ffa3fa65e26d upstream.
If the user specifies tag size larger than HASH\_MAX\_DIGESTSIZE,
there's a crash in integrity\_metadata().
Cc: stable@vger.kernel.org
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 323f56d3c7eddd9933048bbc4a258829c353b86a
Author: Mikulas Patocka
Date: Fri Mar 27 07:22:36 2020 -0400
dm writecache: add cond\_resched to avoid CPU hangs
commit 1edaa447d958bec24c6a79685a5790d98976fd16 upstream.
Initializing a dm-writecache device can take a long time when the
persistent memory device is large. Add cond\_resched() to a few loops
to avoid warnings that the CPU is stuck.
Cc: stable@vger.kernel.org # v4.18+
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit cbb99658e07349a6879d34b726bd0f70046afebf
Author: Jakub Kicinski
Date: Fri Apr 10 14:32:19 2020 -0700
mm, memcg: do not high throttle allocators based on wraparound
commit 9b8b17541f13809d06f6f873325305ddbb760e3e upstream.
If a cgroup violates its memory.high constraints, we may end up unduly
penalising it. For example, for the following hierarchy:
A: max high, 20 usage
A/B: 9 high, 10 usage
A/C: max high, 10 usage
We would end up doing the following calculation below when calculating
high delay for A/B:
A/B: 10 - 9 = 1...
A: 20 - PAGE\_COUNTER\_MAX = 21, so set max\_overage to 21.
This gets worse with higher disparities in usage in the parent.
I have no idea how this disappeared from the final version of the patch,
but it is certainly Not Good(tm). This wasn't obvious in testing because,
for a simple cgroup hierarchy with only one child, the result is usually
roughly the same. It's only in more complex hierarchies that things go
really awry (although still, the effects are limited to a maximum of 2
seconds in schedule\_timeout\_killable at a maximum).
[chris@chrisdown.name: changelog]
Fixes: e26733e0d0ec ("mm, memcg: throttle allocators based on ancestral memory.high")
Signed-off-by: Jakub Kicinski
Signed-off-by: Chris Down
Signed-off-by: Andrew Morton
Acked-by: Michal Hocko
Cc: Johannes Weiner
Cc:  [5.4.x]
Link: http://lkml.kernel.org/r/20200331152424.GA1019937@chrisdown.name
Signed-off-by: Linus Torvalds
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 1be6329e5535ee1363d6d04da8db645bf8a3d5f7
Author: Maxime Ripard
Date: Mon Feb 10 10:55:59 2020 +0100
arm64: dts: allwinner: h5: Fix PMU compatible
commit 4ae7a3c3d7d31260f690d8d658f0365f3eca67a2 upstream.
The commit c35a516a4618 ("arm64: dts: allwinner: H5: Add PMU node")
introduced support for the PMU found on the Allwinner H5. However, the
binding only allows for a single compatible, while the patch was adding
two.
Make sure we follow the binding.
Fixes: c35a516a4618 ("arm64: dts: allwinner: H5: Add PMU node")
Signed-off-by: Maxime Ripard
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 42f43f292639bcb1620544beff22561c60da85ea
Author: Scott Wood
Date: Mon Feb 3 19:35:58 2020 -0500
sched/core: Remove duplicate assignment in sched\_tick\_remote()
commit 82e0516ce3a147365a5dd2a9bedd5ba43a18663d upstream.
A redundant "curr = rq->curr" was added; remove it.
Fixes: ebc0f83c78a2 ("timers/nohz: Update NOHZ load in remote tick")
Signed-off-by: Scott Wood
Signed-off-by: Peter Zijlstra (Intel)
Signed-off-by: Ingo Molnar
Signed-off-by: Thomas Gleixner
Link: https://lkml.kernel.org/r/1580776558-12882-1-git-send-email-swood@redhat.com
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit f366f6700494605e7c69677880c1fce3f2e9f0d2
Author: Maxime Ripard
Date: Mon Feb 10 10:56:00 2020 +0100
arm64: dts: allwinner: h6: Fix PMU compatible
commit 4c7eeb9af3e41ae7d840977119c58f3bbb3f4f59 upstream.
The commit 7aa9b9eb7d6a ("arm64: dts: allwinner: H6: Add PMU mode")
introduced support for the PMU found on the Allwinner H6. However, the
binding only allows for a single compatible, while the patch was adding
two.
Make sure we follow the binding.
Fixes: 7aa9b9eb7d6a ("arm64: dts: allwinner: H6: Add PMU mode")
Signed-off-by: Maxime Ripard
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit d0aa115aff7f7cb479e667702e37a904e3020237
Author: Subash Abhinov Kasiviswanathan
Date: Wed Apr 1 15:23:55 2020 -0600
net: qualcomm: rmnet: Allow configuration updates to existing devices
commit 2abb5792387eb188b12051337d5dcd2cba615cb0 upstream.
This allows the changelink operation to succeed if the mux\_id was
specified as an argument. Note that the mux\_id must match the
existing mux\_id of the rmnet device or should be an unused mux\_id.
Fixes: 1dc49e9d164c ("net: rmnet: do not allow to change mux id if mux id is duplicated")
Reported-and-tested-by: Alex Elder
Signed-off-by: Sean Tranchetti
Signed-off-by: Subash Abhinov Kasiviswanathan
Signed-off-by: David S. Miller
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 6182908d649f3e9a73bc58db4ca2b6bd420aaf1b
Author: Anssi Hannula
Date: Wed Mar 25 12:31:54 2020 +0200
tools: gpio: Fix out-of-tree build regression
commit 82f04bfe2aff428b063eefd234679b2d693228ed upstream.
Commit 0161a94e2d1c7 ("tools: gpio: Correctly add make dependencies for
gpio\_utils") added a make rule for gpio-utils-in.o but used $(output)
instead of the correct $(OUTPUT) for the output directory, breaking
out-of-tree build (O=xx) with the following error:
No rule to make target 'out/tools/gpio/gpio-utils-in.o', needed by 'out/tools/gpio/lsgpio-in.o'. Stop.
Fix that.
Fixes: 0161a94e2d1c ("tools: gpio: Correctly add make dependencies for gpio\_utils")
Cc:
Cc: Laura Abbott
Signed-off-by: Anssi Hannula
Link: https://lore.kernel.org/r/20200325103154.32235-1-anssi.hannula@bitwise.fi
Reviewed-by: Bartosz Golaszewski
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 4dbaa2e90e2fa7ae5ef2129ef478e2d825c970ee
Author: Sreekanth Reddy
Date: Fri Mar 27 05:52:43 2020 -0400
scsi: mpt3sas: Fix kernel panic observed on soft HBA unplug
commit cc41f11a21a51d6869d71e525a7264c748d7c0d7 upstream.
Generic protection fault type kernel panic is observed when user performs
soft (ordered) HBA unplug operation while IOs are running on drives
connected to HBA.
When user performs ordered HBA removal operation, the kernel calls PCI
device's .remove() call back function where driver is flushing out all the
outstanding SCSI IO commands with DID\_NO\_CONNECT host byte and also unmaps
sg buffers allocated for these IO commands.
However, in the ordered HBA removal case (unlike of real HBA hot removal),
HBA device is still alive and hence HBA hardware is performing the DMA
operations to those buffers on the system memory which are already unmapped
while flushing out the outstanding SCSI IO commands and this leads to
kernel panic.
Don't flush out the outstanding IOs from .remove() path in case of ordered
removal since HBA will be still alive in this case and it can complete the
outstanding IOs. Flush out the outstanding IOs only in case of 'physical
HBA hot unplug' where there won't be any communication with the HBA.
During shutdown also it is possible that HBA hardware can perform DMA
operations on those outstanding IO buffers which are completed with
DID\_NO\_CONNECT by the driver from .shutdown(). So same above fix is applied
in shutdown path as well.
It is safe to drop the outstanding commands when HBA is inaccessible such
as when permanent PCI failure happens, when HBA is in non-operational
state, or when someone does a real HBA hot unplug operation. Since driver
knows that HBA is inaccessible during these cases, it is safe to drop the
outstanding commands instead of waiting for SCSI error recovery to kick in
and clear these outstanding commands.
Link: https://lore.kernel.org/r/1585302763-23007-1-git-send-email-sreekanth.reddy@broadcom.com
Fixes: c666d3be99c0 ("scsi: mpt3sas: wait for and flush running commands on shutdown/unload")
Cc: stable@vger.kernel.org #v4.14.174+
Signed-off-by: Sreekanth Reddy
Signed-off-by: Martin K. Petersen
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 04a9f66062b8bfbed8043e9a9081b6b3f2f2157a
Author: Jens Axboe
Date: Fri Mar 20 11:23:41 2020 -0600
io\_uring: honor original task RLIMIT\_FSIZE
commit 4ed734b0d0913e566a9d871e15d24eb240f269f7 upstream.
With the previous fixes for number of files open checking, I added some
debug code to see if we had other spots where we're checking rlimit()
against the async io-wq workers. The only one I found was file size
checking, which we should also honor.
During write and fallocate prep, store the max file size and override
that for the current ask if we're in io-wq worker context.
Cc: stable@vger.kernel.org # 5.1+
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit ce5994942e00004bcc5f8ce637272f4680fa9c49
Author: Rosioru Dragos
Date: Tue Feb 25 17:05:52 2020 +0200
crypto: mxs-dcp - fix scatterlist linearization for hash
commit fa03481b6e2e82355c46644147b614f18c7a8161 upstream.
The incorrect traversal of the scatterlist, during the linearization phase
lead to computing the hash value of the wrong input buffer.
New implementation uses scatterwalk\_map\_and\_copy()
to address this issue.
Cc:
Fixes: 15b59e7c3733 ("crypto: mxs - Add Freescale MXS DCP driver")
Signed-off-by: Rosioru Dragos
Reviewed-by: Horia Geantă
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit fac8cc0f19087200609afec9ca5bf9673225f50d
Author: Dan Carpenter
Date: Mon Jan 20 17:38:04 2020 +0300
crypto: rng - Fix a refcounting bug in crypto\_rng\_reset()
commit eed74b3eba9eda36d155c11a12b2b4b50c67c1d8 upstream.
We need to decrement this refcounter on these error paths.
Fixes: f7d76e05d058 ("crypto: user - fix use\_after\_free of struct xxx\_request")
Cc:
Signed-off-by: Dan Carpenter
Acked-by: Neil Horman
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit b8ba50560134a1e8ec745518f2809d2ac9085878
Author: Dmitry Safonov <0x7f454c46@gmail.com>
Date: Mon Apr 6 18:13:42 2020 +0100
time/namespace: Add max\_time\_namespaces ucount
commit eeec26d5da8248ea4e240b8795bb4364213d3247 upstream.
Michael noticed that userns limit for number of time namespaces is missing.
Furthermore, time namespace introduced UCOUNT\_TIME\_NAMESPACES, but didn't
introduce an array member in user\_table[]. It would make array's
initialisation OOB write, but by luck the user\_table array has an excessive
empty member (all accesses to the array are limited with UCOUNT\_COUNTS - so
it silently reuses the last free member.
Fixes user-visible regression: max\_inotify\_instances by reason of the
missing UCOUNT\_ENTRY() has limited max number of namespaces instead of the
number of inotify instances.
Fixes: 769071ac9f20 ("ns: Introduce Time Namespace")
Reported-by: Michael Kerrisk (man-pages)
Signed-off-by: Dmitry Safonov
Signed-off-by: Thomas Gleixner
Acked-by: Andrei Vagin
Acked-by: Vincenzo Frascino
Cc: stable@kernel.org
Link: https://lkml.kernel.org/r/20200406171342.128733-1-dima@arista.com
Signed-off-by: Greg Kroah-Hartman
commit 2f476bbfaa92865389cc4ffa14f29e501a2173eb
Author: Michael Kerrisk (man-pages)
Date: Fri Apr 3 14:11:39 2020 +0200
time/namespace: Fix time\_for\_children symlink
commit b801f1e22c23c259d6a2c955efddd20370de19a6 upstream.
Looking at the contents of the /proc/PID/ns/time\_for\_children symlink shows
an anomaly:
$ ls -l /proc/self/ns/\* |awk '{print $9, $10, $11}'
...
/proc/self/ns/pid -> pid:[4026531836]
/proc/self/ns/pid\_for\_children -> pid:[4026531836]
/proc/self/ns/time -> time:[4026531834]
/proc/self/ns/time\_for\_children -> time\_for\_children:[4026531834]
/proc/self/ns/user -> user:[4026531837]
...
The reference for 'time\_for\_children' should be a 'time' namespace, just as
the reference for 'pid\_for\_children' is a 'pid' namespace. In other words,
the above time\_for\_children link should read:
/proc/self/ns/time\_for\_children -> time:[4026531834]
Fixes: 769071ac9f20 ("ns: Introduce Time Namespace")
Signed-off-by: Michael Kerrisk
Signed-off-by: Thomas Gleixner
Reviewed-by: Dmitry Safonov
Acked-by: Christian Brauner
Acked-by: Andrei Vagin
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/a2418c48-ed80-3afe-116e-6611cb799557@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 438d3d80186e61554dd8e81bff41fe9cd0ca1b00
Author: Nikita Shubin
Date: Fri Mar 6 10:24:53 2020 +0300
remoteproc: Fix NULL pointer dereference in rproc\_virtio\_notify
commit 791c13b709dd51eb37330f2a5837434e90c87c27 upstream.
Undefined rproc\_ops .kick method in remoteproc driver will result in
"Unable to handle kernel NULL pointer dereference" in rproc\_virtio\_notify,
after firmware loading if:
1) .kick method wasn't defined in driver
2) resource\_table exists in firmware and has "Virtio device entry" defined
Let's refuse to register an rproc-induced virtio device if no kick method was
defined for rproc.
[ 13.180049][ T415] 8<--- cut here ---
[ 13.190558][ T415] Unable to handle kernel NULL pointer dereference at virtual address 00000000
[ 13.212544][ T415] pgd = (ptrval)
[ 13.217052][ T415] [00000000] \*pgd=00000000
[ 13.224692][ T415] Internal error: Oops: 80000005 [#1] PREEMPT SMP ARM
[ 13.231318][ T415] Modules linked in: rpmsg\_char imx\_rproc virtio\_rpmsg\_bus rpmsg\_core [last unloaded: imx\_rproc]
[ 13.241687][ T415] CPU: 0 PID: 415 Comm: unload-load.sh Not tainted 5.5.2-00002-g707df13bbbdd #6
[ 13.250561][ T415] Hardware name: Freescale i.MX7 Dual (Device Tree)
[ 13.257009][ T415] PC is at 0x0
[ 13.260249][ T415] LR is at rproc\_virtio\_notify+0x2c/0x54
[ 13.265738][ T415] pc : [<00000000>] lr : [<8050f6b0>] psr: 60010113
[ 13.272702][ T415] sp : b8d47c48 ip : 00000001 fp : bc04de00
[ 13.278625][ T415] r10: bc04c000 r9 : 00000cc0 r8 : b8d46000
[ 13.284548][ T415] r7 : 00000000 r6 : b898f200 r5 : 00000000 r4 : b8a29800
[ 13.291773][ T415] r3 : 00000000 r2 : 990a3ad4 r1 : 00000000 r0 : b8a29800
[ 13.299000][ T415] Flags: nZCv IRQs on FIQs on Mode SVC\_32 ISA ARM Segment none
[ 13.306833][ T415] Control: 10c5387d Table: b8b4806a DAC: 00000051
[ 13.313278][ T415] Process unload-load.sh (pid: 415, stack limit = 0x(ptrval))
[ 13.320591][ T415] Stack: (0xb8d47c48 to 0xb8d48000)
[ 13.325651][ T415] 7c40: b895b680 00000001 b898f200 803c6430 b895bc80 7f00ae18
[ 13.334531][ T415] 7c60: 00000035 00000000 00000000 b9393200 80b3ed80 00004000 b9393268 bbf5a9a2
[ 13.343410][ T415] 7c80: 00000e00 00000200 00000000 7f00aff0 7f00a014 b895b680 b895b800 990a3ad4
[ 13.352290][ T415] 7ca0: 00000001 b898f210 b898f200 00000000 00000000 7f00e000 00000001 00000000
[ 13.361170][ T415] 7cc0: 00000000 803c62e0 80b2169c 802a0924 b898f210 00000000 00000000 b898f210
[ 13.370049][ T415] 7ce0: 80b9ba44 00000000 80b9ba48 00000000 7f00e000 00000008 80b2169c 80400114
[ 13.378929][ T415] 7d00: 80b2169c 8061fd64 b898f210 7f00e000 80400744 b8d46000 80b21634 80b21634
[ 13.387809][ T415] 7d20: 80b2169c 80400614 80b21634 80400718 7f00e000 00000000 b8d47d7c 80400744
[ 13.396689][ T415] 7d40: b8d46000 80b21634 80b21634 803fe338 b898f254 b80fe76c b8d32e38 990a3ad4
[ 13.405569][ T415] 7d60: fffffff3 b898f210 b8d46000 00000001 b898f254 803ffe7c 80857a90 b898f210
[ 13.414449][ T415] 7d80: 00000001 990a3ad4 b8d46000 b898f210 b898f210 80b17aec b8a29c20 803ff0a4
[ 13.423328][ T415] 7da0: b898f210 00000000 b8d46000 803fb8e0 b898f200 00000000 80b17aec b898f210
[ 13.432209][ T415] 7dc0: b8a29c20 990a3ad4 b895b900 b898f200 8050fb7c 80b17aec b898f210 b8a29c20
[ 13.441088][ T415] 7de0: b8a29800 b895b900 b8a29a04 803c5ec0 b8a29c00 b898f200 b8a29a20 00000007
[ 13.449968][ T415] 7e00: b8a29c20 8050fd78 b8a29800 00000000 b8a29a20 b8a29c04 b8a29820 b8a299d0
[ 13.458848][ T415] 7e20: b895b900 8050e5a4 b8a29800 b8a299d8 b8d46000 b8a299e0 b8a29820 b8a299d0
[ 13.467728][ T415] 7e40: b895b900 8050e008 000041ed 00000000 b8b8c440 b8a299d8 b8a299e0 b8a299d8
[ 13.476608][ T415] 7e60: b8b8c440 990a3ad4 00000000 b8a29820 b8b8c400 00000006 b8a29800 b895b880
[ 13.485487][ T415] 7e80: b8d47f78 00000000 00000000 8050f4b4 00000006 b895b890 b8b8c400 008fbea0
[ 13.494367][ T415] 7ea0: b895b880 8029f530 00000000 00000000 b8d46000 00000006 b8d46000 008fbea0
[ 13.503246][ T415] 7ec0: 8029f434 00000000 b8d46000 00000000 00000000 8021e2e4 0000000a 8061fd0c
[ 13.512125][ T415] 7ee0: 0000000a b8af0c00 0000000a b8af0c40 00000001 b8af0c40 00000000 8061f910
[ 13.521005][ T415] 7f00: 0000000a 80240af4 00000002 b8d46000 00000000 8061fd0c 00000002 80232d7c
[ 13.529884][ T415] 7f20: 00000000 b8d46000 00000000 990a3ad4 00000000 00000006 b8a62d80 008fbea0
[ 13.538764][ T415] 7f40: b8d47f78 00000000 b8d46000 00000000 00000000 802210c0 b88f2900 00000000
[ 13.547644][ T415] 7f60: b8a62d80 b8a62d80 b8d46000 00000006 008fbea0 80221320 00000000 00000000
[ 13.556524][ T415] 7f80: b8af0c00 990a3ad4 0000006c 008fbea0 76f1cda0 00000004 80101204 00000004
[ 13.565403][ T415] 7fa0: 00000000 80101000 0000006c 008fbea0 00000001 008fbea0 00000006 00000000
[ 13.574283][ T415] 7fc0: 0000006c 008fbea0 76f1cda0 00000004 00000006 00000006 00000000 00000000
[ 13.583162][ T415] 7fe0: 00000004 7ebaf7d0 76eb4c0b 76e3f206 600d0030 00000001 00000000 00000000
[ 13.592056][ T415] [<8050f6b0>] (rproc\_virtio\_notify) from [<803c6430>] (virtqueue\_notify+0x1c/0x34)
[ 13.601298][ T415] [<803c6430>] (virtqueue\_notify) from [<7f00ae18>] (rpmsg\_probe+0x280/0x380 [virtio\_rpmsg\_bus])
[ 13.611663][ T415] [<7f00ae18>] (rpmsg\_probe [virtio\_rpmsg\_bus]) from [<803c62e0>] (virtio\_dev\_probe+0x1f8/0x2c4)
[ 13.622022][ T415] [<803c62e0>] (virtio\_dev\_probe) from [<80400114>] (really\_probe+0x200/0x450)
[ 13.630817][ T415] [<80400114>] (really\_probe) from [<80400614>] (driver\_probe\_device+0x16c/0x1ac)
[ 13.639873][ T415] [<80400614>] (driver\_probe\_device) from [<803fe338>] (bus\_for\_each\_drv+0x84/0xc8)
[ 13.649102][ T415] [<803fe338>] (bus\_for\_each\_drv) from [<803ffe7c>] (\_\_device\_attach+0xd4/0x164)
[ 13.658069][ T415] [<803ffe7c>] (\_\_device\_attach) from [<803ff0a4>] (bus\_probe\_device+0x84/0x8c)
[ 13.666950][ T415] [<803ff0a4>] (bus\_probe\_device) from [<803fb8e0>] (device\_add+0x444/0x768)
[ 13.675572][ T415] [<803fb8e0>] (device\_add) from [<803c5ec0>] (register\_virtio\_device+0xa4/0xfc)
[ 13.684541][ T415] [<803c5ec0>] (register\_virtio\_device) from [<8050fd78>] (rproc\_add\_virtio\_dev+0xcc/0x1b8)
[ 13.694466][ T415] [<8050fd78>] (rproc\_add\_virtio\_dev) from [<8050e5a4>] (rproc\_start+0x148/0x200)
[ 13.703521][ T415] [<8050e5a4>] (rproc\_start) from [<8050e008>] (rproc\_boot+0x384/0x5c0)
[ 13.711708][ T415] [<8050e008>] (rproc\_boot) from [<8050f4b4>] (state\_store+0x3c/0xc8)
[ 13.719723][ T415] [<8050f4b4>] (state\_store) from [<8029f530>] (kernfs\_fop\_write+0xfc/0x214)
[ 13.728348][ T415] [<8029f530>] (kernfs\_fop\_write) from [<8021e2e4>] (\_\_vfs\_write+0x30/0x1cc)
[ 13.736971][ T415] [<8021e2e4>] (\_\_vfs\_write) from [<802210c0>] (vfs\_write+0xac/0x17c)
[ 13.744985][ T415] [<802210c0>] (vfs\_write) from [<80221320>] (ksys\_write+0x64/0xe4)
[ 13.752825][ T415] [<80221320>] (ksys\_write) from [<80101000>] (ret\_fast\_syscall+0x0/0x54)
[ 13.761178][ T415] Exception stack(0xb8d47fa8 to 0xb8d47ff0)
[ 13.766932][ T415] 7fa0: 0000006c 008fbea0 00000001 008fbea0 00000006 00000000
[ 13.775811][ T415] 7fc0: 0000006c 008fbea0 76f1cda0 00000004 00000006 00000006 00000000 00000000
[ 13.784687][ T415] 7fe0: 00000004 7ebaf7d0 76eb4c0b 76e3f206
[ 13.790442][ T415] Code: bad PC value
[ 13.839214][ T415] ---[ end trace 1fe21ecfc9f28852 ]---
Reviewed-by: Mathieu Poirier
Signed-off-by: Nikita Shubin
Fixes: 7a186941626d ("remoteproc: remove the single rpmsg vdev limitation")
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20200306072452.24743-1-NShubin@topcon.com
Signed-off-by: Bjorn Andersson
Signed-off-by: Greg Kroah-Hartman
commit 174e9da46c2c5c9b4ab87456a577207c1c724be6
Author: Sibi Sankar
Date: Thu Mar 5 01:17:29 2020 +0530
remoteproc: qcom\_q6v5\_mss: Reload the mba region on coredump
commit d96f2571dc84d128cacf1944f4ecc87834c779a6 upstream.
On secure devices after a wdog/fatal interrupt, the mba region has to be
refreshed in order to prevent the following errors during mba load.
Err Logs:
remoteproc remoteproc2: stopped remote processor 4080000.remoteproc
qcom-q6v5-mss 4080000.remoteproc: PBL returned unexpected status -284031232
qcom-q6v5-mss 4080000.remoteproc: PBL returned unexpected status -284031232
....
qcom-q6v5-mss 4080000.remoteproc: PBL returned unexpected status -284031232
qcom-q6v5-mss 4080000.remoteproc: MBA booted, loading mpss
Fixes: 7dd8ade24dc2a ("remoteproc: qcom: q6v5-mss: Add custom dump function for modem")
Cc: stable@vger.kernel.org
Signed-off-by: Sibi Sankar
Tested-by: Bjorn Andersson
Link: https://lore.kernel.org/r/20200304194729.27979-4-sibis@codeaurora.org
Signed-off-by: Bjorn Andersson
Signed-off-by: Greg Kroah-Hartman
commit 34883e393b9f116af82402d68dcd7aa74b32b919
Author: Bjorn Andersson
Date: Thu Mar 5 01:17:27 2020 +0530
remoteproc: qcom\_q6v5\_mss: Don't reassign mpss region on shutdown
commit 900fc60df22748dbc28e4970838e8f7b8f1013ce upstream.
Trying to reclaim mpss memory while the mba is not running causes the
system to crash on devices with security fuses blown, so leave it
assigned to the remote on shutdown and recover it on a subsequent boot.
Fixes: 6c5a9dc2481b ("remoteproc: qcom: Make secure world call for mem ownership switch")
Cc: stable@vger.kernel.org
Signed-off-by: Bjorn Andersson
Signed-off-by: Sibi Sankar
Tested-by: Bjorn Andersson
Link: https://lore.kernel.org/r/20200304194729.27979-2-sibis@codeaurora.org
Signed-off-by: Bjorn Andersson
Signed-off-by: Greg Kroah-Hartman
commit 98cbca530925210586ff918b4cd3fc3d9f0365dc
Author: Josef Bacik
Date: Thu Mar 19 10:11:32 2020 -0400
btrfs: use nofs allocations for running delayed items
commit 351cbf6e4410e7ece05e35d0a07320538f2418b4 upstream.
Zygo reported the following lockdep splat while testing the balance
patches
======================================================
WARNING: possible circular locking dependency detected
5.6.0-c6f0579d496a+ #53 Not tainted
------------------------------------------------------
kswapd0/1133 is trying to acquire lock:
ffff888092f622c0 (&delayed\_node->mutex){+.+.}, at: \_\_btrfs\_release\_delayed\_node+0x7c/0x5b0
but task is already holding lock:
ffffffff8fc5f860 (fs\_reclaim){+.+.}, at: \_\_fs\_reclaim\_acquire+0x5/0x30
which lock already depends on the new lock.
the existing dependency chain (in reverse order) is:
-> #1 (fs\_reclaim){+.+.}:
fs\_reclaim\_acquire.part.91+0x29/0x30
fs\_reclaim\_acquire+0x19/0x20
kmem\_cache\_alloc\_trace+0x32/0x740
add\_block\_entry+0x45/0x260
btrfs\_ref\_tree\_mod+0x6e2/0x8b0
btrfs\_alloc\_tree\_block+0x789/0x880
alloc\_tree\_block\_no\_bg\_flush+0xc6/0xf0
\_\_btrfs\_cow\_block+0x270/0x940
btrfs\_cow\_block+0x1ba/0x3a0
btrfs\_search\_slot+0x999/0x1030
btrfs\_insert\_empty\_items+0x81/0xe0
btrfs\_insert\_delayed\_items+0x128/0x7d0
\_\_btrfs\_run\_delayed\_items+0xf4/0x2a0
btrfs\_run\_delayed\_items+0x13/0x20
btrfs\_commit\_transaction+0x5cc/0x1390
insert\_balance\_item.isra.39+0x6b2/0x6e0
btrfs\_balance+0x72d/0x18d0
btrfs\_ioctl\_balance+0x3de/0x4c0
btrfs\_ioctl+0x30ab/0x44a0
ksys\_ioctl+0xa1/0xe0
\_\_x64\_sys\_ioctl+0x43/0x50
do\_syscall\_64+0x77/0x2c0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
-> #0 (&delayed\_node->mutex){+.+.}:
\_\_lock\_acquire+0x197e/0x2550
lock\_acquire+0x103/0x220
\_\_mutex\_lock+0x13d/0xce0
mutex\_lock\_nested+0x1b/0x20
\_\_btrfs\_release\_delayed\_node+0x7c/0x5b0
btrfs\_remove\_delayed\_node+0x49/0x50
btrfs\_evict\_inode+0x6fc/0x900
evict+0x19a/0x2c0
dispose\_list+0xa0/0xe0
prune\_icache\_sb+0xbd/0xf0
super\_cache\_scan+0x1b5/0x250
do\_shrink\_slab+0x1f6/0x530
shrink\_slab+0x32e/0x410
shrink\_node+0x2a5/0xba0
balance\_pgdat+0x4bd/0x8a0
kswapd+0x35a/0x800
kthread+0x1e9/0x210
ret\_from\_fork+0x3a/0x50
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0 CPU1
---- ----
lock(fs\_reclaim);
lock(&delayed\_node->mutex);
lock(fs\_reclaim);
lock(&delayed\_node->mutex);
\*\*\* DEADLOCK \*\*\*
3 locks held by kswapd0/1133:
#0: ffffffff8fc5f860 (fs\_reclaim){+.+.}, at: \_\_fs\_reclaim\_acquire+0x5/0x30
#1: ffffffff8fc380d8 (shrinker\_rwsem){++++}, at: shrink\_slab+0x1e8/0x410
#2: ffff8881e0e6c0e8 (&type->s\_umount\_key#42){++++}, at: trylock\_super+0x1b/0x70
stack backtrace:
CPU: 2 PID: 1133 Comm: kswapd0 Not tainted 5.6.0-c6f0579d496a+ #53
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.12.0-1 04/01/2014
Call Trace:
dump\_stack+0xc1/0x11a
print\_circular\_bug.isra.38.cold.57+0x145/0x14a
check\_noncircular+0x2a9/0x2f0
? print\_circular\_bug.isra.38+0x130/0x130
? stack\_trace\_consume\_entry+0x90/0x90
? save\_trace+0x3cc/0x420
\_\_lock\_acquire+0x197e/0x2550
? btrfs\_inode\_clear\_file\_extent\_range+0x9b/0xb0
? register\_lock\_class+0x960/0x960
lock\_acquire+0x103/0x220
? \_\_btrfs\_release\_delayed\_node+0x7c/0x5b0
\_\_mutex\_lock+0x13d/0xce0
? \_\_btrfs\_release\_delayed\_node+0x7c/0x5b0
? \_\_asan\_loadN+0xf/0x20
? pvclock\_clocksource\_read+0xeb/0x190
? \_\_btrfs\_release\_delayed\_node+0x7c/0x5b0
? mutex\_lock\_io\_nested+0xc20/0xc20
? \_\_kasan\_check\_read+0x11/0x20
? check\_chain\_key+0x1e6/0x2e0
mutex\_lock\_nested+0x1b/0x20
? mutex\_lock\_nested+0x1b/0x20
\_\_btrfs\_release\_delayed\_node+0x7c/0x5b0
btrfs\_remove\_delayed\_node+0x49/0x50
btrfs\_evict\_inode+0x6fc/0x900
? btrfs\_setattr+0x840/0x840
? do\_raw\_spin\_unlock+0xa8/0x140
evict+0x19a/0x2c0
dispose\_list+0xa0/0xe0
prune\_icache\_sb+0xbd/0xf0
? invalidate\_inodes+0x310/0x310
super\_cache\_scan+0x1b5/0x250
do\_shrink\_slab+0x1f6/0x530
shrink\_slab+0x32e/0x410
? do\_shrink\_slab+0x530/0x530
? do\_shrink\_slab+0x530/0x530
? \_\_kasan\_check\_read+0x11/0x20
? mem\_cgroup\_protected+0x13d/0x260
shrink\_node+0x2a5/0xba0
balance\_pgdat+0x4bd/0x8a0
? mem\_cgroup\_shrink\_node+0x490/0x490
? \_raw\_spin\_unlock\_irq+0x27/0x40
? finish\_task\_switch+0xce/0x390
? rcu\_read\_lock\_bh\_held+0xb0/0xb0
kswapd+0x35a/0x800
? \_raw\_spin\_unlock\_irqrestore+0x4c/0x60
? balance\_pgdat+0x8a0/0x8a0
? finish\_wait+0x110/0x110
? \_\_kasan\_check\_read+0x11/0x20
? \_\_kthread\_parkme+0xc6/0xe0
? balance\_pgdat+0x8a0/0x8a0
kthread+0x1e9/0x210
? kthread\_create\_worker\_on\_cpu+0xc0/0xc0
ret\_from\_fork+0x3a/0x50
This is because we hold that delayed node's mutex while doing tree
operations. Fix this by just wrapping the searches in nofs.
CC: stable@vger.kernel.org # 4.4+
Signed-off-by: Josef Bacik
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit d91eefd1cb9df0465e7e4a8b918cbba55849ddc6
Author: Robbie Ko
Date: Tue Mar 17 14:31:02 2020 +0800
btrfs: fix missing semaphore unlock in btrfs\_sync\_file
commit 6ff06729c22ec0b7498d900d79cc88cfb8aceaeb upstream.
Ordered ops are started twice in sync file, once outside of inode mutex
and once inside, taking the dio semaphore. There was one error path
missing the semaphore unlock.
Fixes: aab15e8ec2576 ("Btrfs: fix rare chances for data loss when doing a fast fsync")
CC: stable@vger.kernel.org # 4.19+
Signed-off-by: Robbie Ko
Reviewed-by: Filipe Manana
[ add changelog ]
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 9b8fda769d8a11ea0e7905042af459039d202294
Author: Josef Bacik
Date: Wed Mar 4 11:18:25 2020 -0500
btrfs: unset reloc control if we fail to recover
commit fb2d83eefef4e1c717205bac71cb1941edf8ae11 upstream.
If we fail to load an fs root, or fail to start a transaction we can
bail without unsetting the reloc control, which leads to problems later
when we free the reloc control but still have it attached to the file
system.
In the normal path we'll end up calling unset\_reloc\_control() twice, but
all it does is set fs\_info->reloc\_control = NULL, and we can only have
one balance at a time so it's not racey.
CC: stable@vger.kernel.org # 5.4+
Reviewed-by: Qu Wenruo
Signed-off-by: Josef Bacik
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 496567527d8f674a293558b07b975b19f8429df6
Author: Filipe Manana
Date: Mon Mar 9 12:41:05 2020 +0000
btrfs: fix missing file extent item for hole after ranged fsync
commit 95418ed1d10774cd9a49af6f39e216c1256f1eeb upstream.
When doing a fast fsync for a range that starts at an offset greater than
zero, we can end up with a log that when replayed causes the respective
inode miss a file extent item representing a hole if we are not using the
NO\_HOLES feature. This is because for fast fsyncs we don't log any extents
that cover a range different from the one requested in the fsync.
Example scenario to trigger it:
$ mkfs.btrfs -O ^no-holes -f /dev/sdd
$ mount /dev/sdd /mnt
# Create a file with a single 256K and fsync it to clear to full sync
# bit in the inode - we want the msync below to trigger a fast fsync.
$ xfs\_io -f -c "pwrite -S 0xab 0 256K" -c "fsync" /mnt/foo
# Force a transaction commit and wipe out the log tree.
$ sync
# Dirty 768K of data, increasing the file size to 1Mb, and flush only
# the range from 256K to 512K without updating the log tree
# (sync\_file\_range() does not trigger fsync, it only starts writeback
# and waits for it to finish).
$ xfs\_io -c "pwrite -S 0xcd 256K 768K" /mnt/foo
$ xfs\_io -c "sync\_range -abw 256K 256K" /mnt/foo
# Now dirty the range from 768K to 1M again and sync that range.
$ xfs\_io -c "mmap -w 768K 256K" \
-c "mwrite -S 0xef 768K 256K" \
-c "msync -s 768K 256K" \
-c "munmap" \
/mnt/foo
# Mount to replay the log.
$ mount /dev/sdd /mnt
$ umount /mnt
$ btrfs check /dev/sdd
Opening filesystem to check...
Checking filesystem on /dev/sdd
UUID: 482fb574-b288-478e-a190-a9c44a78fca6
[1/7] checking root items
[2/7] checking extents
[3/7] checking free space cache
[4/7] checking fs roots
root 5 inode 257 errors 100, file extent discount
Found file extent holes:
start: 262144, len: 524288
ERROR: errors found in fs roots
found 720896 bytes used, error(s) found
total csum bytes: 512
total tree bytes: 131072
total fs tree bytes: 32768
total extent tree bytes: 16384
btree space waste bytes: 123514
file data blocks allocated: 589824
referenced 589824
Fix this issue by setting the range to full (0 to LLONG\_MAX) when the
NO\_HOLES feature is not enabled. This results in extra work being done
but it gives the guarantee we don't end up with missing holes after
replaying the log.
CC: stable@vger.kernel.org # 4.19+
Reviewed-by: Josef Bacik
Signed-off-by: Filipe Manana
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 69e4552427158621cb2d53f1c9f0524bec9cecd7
Author: Josef Bacik
Date: Wed Mar 4 11:18:23 2020 -0500
btrfs: drop block from cache on error in relocation
commit 8e19c9732ad1d127b5575a10f4fbcacf740500ff upstream.
If we have an error while building the backref tree in relocation we'll
process all the pending edges and then free the node. However if we
integrated some edges into the cache we'll lose our link to those edges
by simply freeing this node, which means we'll leak memory and
references to any roots that we've found.
Instead we need to use remove\_backref\_node(), which walks through all of
the edges that are still linked to this node and free's them up and
drops any root references we may be holding.
CC: stable@vger.kernel.org # 4.9+
Reviewed-by: Qu Wenruo
Signed-off-by: Josef Bacik
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 706cd9e4e23ab6e422673b6d5954372563f4c390
Author: Josef Bacik
Date: Fri Feb 14 15:22:06 2020 -0500
btrfs: set update the uuid generation as soon as possible
commit 75ec1db8717a8f0a9d9c8d033e542fdaa7b73898 upstream.
In my EIO stress testing I noticed I was getting forced to rescan the
uuid tree pretty often, which was weird. This is because my error
injection stuff would sometimes inject an error after log replay but
before we loaded the UUID tree. If log replay committed the transaction
it wouldn't have updated the uuid tree generation, but the tree was
valid and didn't change, so there's no reason to not update the
generation here.
Fix this by setting the BTRFS\_FS\_UPDATE\_UUID\_TREE\_GEN bit immediately
after reading all the fs roots if the uuid tree generation matches the
fs generation. Then any transaction commits that happen during mount
won't screw up our uuid tree state, forcing us to do needless uuid
rescans.
Fixes: 70f801754728 ("Btrfs: check UUID tree during mount if required")
CC: stable@vger.kernel.org # 4.19+
Signed-off-by: Josef Bacik
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit b48821695b328b5e7ffe0f64f966623829534d3a
Author: Josef Bacik
Date: Wed Mar 4 11:18:27 2020 -0500
btrfs: reloc: clean dirty subvols if we fail to start a transaction
commit 6217b0fadd4473a16fabc6aecd7527a9f71af534 upstream.
If we do merge\_reloc\_roots() we could insert a few roots onto the dirty
subvol roots list, where we hold a ref on them. If we fail to start the
transaction we need to run clean\_dirty\_subvols() in order to cleanup the
refs.
CC: stable@vger.kernel.org # 5.4+
Signed-off-by: Josef Bacik
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 3dd4bb593822c2567245286687639d3d084e9b50
Author: Filipe Manana
Date: Fri Feb 28 13:04:36 2020 +0000
Btrfs: fix crash during unmount due to race with delayed inode workers
commit f0cc2cd70164efe8f75c5d99560f0f69969c72e4 upstream.
During unmount we can have a job from the delayed inode items work queue
still running, that can lead to at least two bad things:
1) A crash, because the worker can try to create a transaction just
after the fs roots were freed;
2) A transaction leak, because the worker can create a transaction
before the fs roots are freed and just after we committed the last
transaction and after we stopped the transaction kthread.
A stack trace example of the crash:
[79011.691214] kernel BUG at lib/radix-tree.c:982!
[79011.692056] invalid opcode: 0000 [#1] PREEMPT SMP DEBUG\_PAGEALLOC PTI
[79011.693180] CPU: 3 PID: 1394 Comm: kworker/u8:2 Tainted: G W 5.6.0-rc2-btrfs-next-54 #2
(...)
[79011.696789] Workqueue: btrfs-delayed-meta btrfs\_work\_helper [btrfs]
[79011.697904] RIP: 0010:radix\_tree\_tag\_set+0xe7/0x170
(...)
[79011.702014] RSP: 0018:ffffb3c84a317ca0 EFLAGS: 00010293
[79011.702949] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000000
[79011.704202] RDX: ffffb3c84a317cb0 RSI: ffffb3c84a317ca8 RDI: ffff8db3931340a0
[79011.705463] RBP: 0000000000000005 R08: 0000000000000005 R09: ffffffff974629d0
[79011.706756] R10: ffffb3c84a317bc0 R11: 0000000000000001 R12: ffff8db393134000
[79011.708010] R13: ffff8db3931340a0 R14: ffff8db393134068 R15: 0000000000000001
[79011.709270] FS: 0000000000000000(0000) GS:ffff8db3b6a00000(0000) knlGS:0000000000000000
[79011.710699] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[79011.711710] CR2: 00007f22c2a0a000 CR3: 0000000232ad4005 CR4: 00000000003606e0
[79011.712958] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[79011.714205] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[79011.715448] Call Trace:
[79011.715925] record\_root\_in\_trans+0x72/0xf0 [btrfs]
[79011.716819] btrfs\_record\_root\_in\_trans+0x4b/0x70 [btrfs]
[79011.717925] start\_transaction+0xdd/0x5c0 [btrfs]
[79011.718829] btrfs\_async\_run\_delayed\_root+0x17e/0x2b0 [btrfs]
[79011.719915] btrfs\_work\_helper+0xaa/0x720 [btrfs]
[79011.720773] process\_one\_work+0x26d/0x6a0
[79011.721497] worker\_thread+0x4f/0x3e0
[79011.722153] ? process\_one\_work+0x6a0/0x6a0
[79011.722901] kthread+0x103/0x140
[79011.723481] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[79011.724379] ret\_from\_fork+0x3a/0x50
(...)
The following diagram shows a sequence of steps that lead to the crash
during ummount of the filesystem:
CPU 1 CPU 2 CPU 3
btrfs\_punch\_hole()
btrfs\_btree\_balance\_dirty()
btrfs\_balance\_delayed\_items()
--> sees
fs\_info->delayed\_root->items
with value 200, which is greater
than
BTRFS\_DELAYED\_BACKGROUND (128)
and smaller than
BTRFS\_DELAYED\_WRITEBACK (512)
btrfs\_wq\_run\_delayed\_node()
--> queues a job for
fs\_info->delayed\_workers to run
btrfs\_async\_run\_delayed\_root()
btrfs\_async\_run\_delayed\_root()
--> job queued by CPU 1
--> starts picking and running
delayed nodes from the
prepare\_list list
close\_ctree()
btrfs\_delete\_unused\_bgs()
btrfs\_commit\_super()
btrfs\_join\_transaction()
--> gets transaction N
btrfs\_commit\_transaction(N)
--> set transaction state
to TRANTS\_STATE\_COMMIT\_START
btrfs\_first\_prepared\_delayed\_node()
--> picks delayed node X through
the prepared\_list list
btrfs\_run\_delayed\_items()
btrfs\_first\_delayed\_node()
--> also picks delayed node X
but through the node\_list
list
\_\_btrfs\_commit\_inode\_delayed\_items()
--> runs all delayed items from
this node and drops the
node's item count to 0
through call to
btrfs\_release\_delayed\_inode()
--> finishes running any remaining
delayed nodes
--> finishes transaction commit
--> stops cleaner and transaction threads
btrfs\_free\_fs\_roots()
--> frees all roots and removes them
from the radix tree
fs\_info->fs\_roots\_radix
btrfs\_join\_transaction()
start\_transaction()
btrfs\_record\_root\_in\_trans()
record\_root\_in\_trans()
radix\_tree\_tag\_set()
--> crashes because
the root is not in
the radix tree
anymore
If the worker is able to call btrfs\_join\_transaction() before the unmount
task frees the fs roots, we end up leaking a transaction and all its
resources, since after the call to btrfs\_commit\_super() and stopping the
transaction kthread, we don't expect to have any transaction open anymore.
When this situation happens the worker has a delayed node that has no
more items to run, since the task calling btrfs\_run\_delayed\_items(),
which is doing a transaction commit, picks the same node and runs all
its items first.
We can not wait for the worker to complete when running delayed items
through btrfs\_run\_delayed\_items(), because we call that function in
several phases of a transaction commit, and that could cause a deadlock
because the worker calls btrfs\_join\_transaction() and the task doing the
transaction commit may have already set the transaction state to
TRANS\_STATE\_COMMIT\_DOING.
Also it's not possible to get into a situation where only some of the
items of a delayed node are added to the fs/subvolume tree in the current
transaction and the remaining ones in the next transaction, because when
running the items of a delayed inode we lock its mutex, effectively
waiting for the worker if the worker is running the items of the delayed
node already.
Since this can only cause issues when unmounting a filesystem, fix it in
a simple way by waiting for any jobs on the delayed workers queue before
calling btrfs\_commit\_supper() at close\_ctree(). This works because at this
point no one can call btrfs\_btree\_balance\_dirty() or
btrfs\_balance\_delayed\_items(), and if we end up waiting for any worker to
complete, btrfs\_commit\_super() will commit the transaction created by the
worker.
CC: stable@vger.kernel.org # 4.4+
Signed-off-by: Filipe Manana
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit b8c026e1fc3af03c852160b6847145f5a5500c21
Author: Josef Bacik
Date: Fri Feb 21 16:41:10 2020 -0500
btrfs: fix btrfs\_calc\_reclaim\_metadata\_size calculation
commit fa121a26b2ceabce613e0b4cfc7498cfde73fe8d upstream.
I noticed while running my snapshot torture test that we were getting a
lot of metadata chunks allocated with very little actually used.
Digging into this we would commit the transaction, still not have enough
space, and then force a chunk allocation.
I noticed that we were barely flushing any delalloc at all, despite the
fact that we had around 13gib of outstanding delalloc reservations. It
turns out this is because of our btrfs\_calc\_reclaim\_metadata\_size()
calculation. It \_only\_ takes into account the outstanding ticket sizes,
which isn't the whole story. In this particular workload we're slowly
filling up the disk, which means our overcommit space will suddenly
become a lot less, and our outstanding reservations will be well more
than what we can handle. However we are only flushing based on our
ticket size, which is much less than we need to actually reclaim.
So fix btrfs\_calc\_reclaim\_metadata\_size() to take into account the
overage in the case that we've gotten less available space suddenly.
This makes it so we attempt to reclaim a lot more delalloc space, which
allows us to make our reservations and we no longer are allocating a
bunch of needless metadata chunks.
CC: stable@vger.kernel.org # 4.4+
Signed-off-by: Josef Bacik
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit cc3c1509c8339447c259ba947acc594ed09d204c
Author: Qu Wenruo
Date: Wed Feb 12 14:12:44 2020 +0800
btrfs: Don't submit any btree write bio if the fs has errors
commit b3ff8f1d380e65dddd772542aa9bff6c86bf715a upstream.
[BUG]
There is a fuzzed image which could cause KASAN report at unmount time.
BUG: KASAN: use-after-free in btrfs\_queue\_work+0x2c1/0x390
Read of size 8 at addr ffff888067cf6848 by task umount/1922
CPU: 0 PID: 1922 Comm: umount Tainted: G W 5.0.21 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014
Call Trace:
dump\_stack+0x5b/0x8b
print\_address\_description+0x70/0x280
kasan\_report+0x13a/0x19b
btrfs\_queue\_work+0x2c1/0x390
btrfs\_wq\_submit\_bio+0x1cd/0x240
btree\_submit\_bio\_hook+0x18c/0x2a0
submit\_one\_bio+0x1be/0x320
flush\_write\_bio.isra.41+0x2c/0x70
btree\_write\_cache\_pages+0x3bb/0x7f0
do\_writepages+0x5c/0x130
\_\_writeback\_single\_inode+0xa3/0x9a0
writeback\_single\_inode+0x23d/0x390
write\_inode\_now+0x1b5/0x280
iput+0x2ef/0x600
close\_ctree+0x341/0x750
generic\_shutdown\_super+0x126/0x370
kill\_anon\_super+0x31/0x50
btrfs\_kill\_super+0x36/0x2b0
deactivate\_locked\_super+0x80/0xc0
deactivate\_super+0x13c/0x150
cleanup\_mnt+0x9a/0x130
task\_work\_run+0x11a/0x1b0
exit\_to\_usermode\_loop+0x107/0x130
do\_syscall\_64+0x1e5/0x280
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
[CAUSE]
The fuzzed image has a completely screwd up extent tree:
leaf 29421568 gen 8 total ptrs 6 free space 3587 owner EXTENT\_TREE
refs 2 lock (w:0 r:0 bw:0 br:0 sw:0 sr:0) lock\_owner 0 current 5938
item 0 key (12587008 168 4096) itemoff 3942 itemsize 53
extent refs 1 gen 9 flags 1
ref#0: extent data backref root 5 objectid 259 offset 0 count 1
item 1 key (12591104 168 8192) itemoff 3889 itemsize 53
extent refs 1 gen 9 flags 1
ref#0: extent data backref root 5 objectid 271 offset 0 count 1
item 2 key (12599296 168 4096) itemoff 3836 itemsize 53
extent refs 1 gen 9 flags 1
ref#0: extent data backref root 5 objectid 259 offset 4096 count 1
item 3 key (29360128 169 0) itemoff 3803 itemsize 33
extent refs 1 gen 9 flags 2
ref#0: tree block backref root 5
item 4 key (29368320 169 1) itemoff 3770 itemsize 33
extent refs 1 gen 9 flags 2
ref#0: tree block backref root 5
item 5 key (29372416 169 0) itemoff 3737 itemsize 33
extent refs 1 gen 9 flags 2
ref#0: tree block backref root 5
Note that leaf 29421568 doesn't have its backref in the extent tree.
Thus extent allocator can re-allocate leaf 29421568 for other trees.
In short, the bug is caused by:
- Existing tree block gets allocated to log tree
This got its generation bumped.
- Log tree balance cleaned dirty bit of offending tree block
It will not be written back to disk, thus no WRITTEN flag.
- Original owner of the tree block gets COWed
Since the tree block has higher transid, no WRITTEN flag, it's reused,
and not traced by transaction::dirty\_pages.
- Transaction aborted
Tree blocks get cleaned according to transaction::dirty\_pages. But the
offending tree block is not recorded at all.
- Filesystem unmount
All pages are assumed to be are clean, destroying all workqueue, then
call iput(btree\_inode).
But offending tree block is still dirty, which triggers writeback, and
causes use-after-free bug.
The detailed sequence looks like this:
- Initial status
eb: 29421568, header=WRITTEN bflags\_dirty=0, page\_dirty=0, gen=8,
not traced by any dirty extent\_iot\_tree.
- New tree block is allocated
Since there is no backref for 29421568, it's re-allocated as new tree
block.
Keep in mind that tree block 29421568 is still referred by extent
tree.
- Tree block 29421568 is filled for log tree
eb: 29421568, header=0 bflags\_dirty=1, page\_dirty=1, gen=9 << (gen bumped)
traced by btrfs\_root::dirty\_log\_pages
- Some log tree operations
Since the fs is using node size 4096, the log tree can easily go a
level higher.
- Log tree needs balance
Tree block 29421568 gets all its content pushed to right, thus now
it is empty, and we don't need it.
btrfs\_clean\_tree\_block() from \_\_push\_leaf\_right() get called.
eb: 29421568, header=0 bflags\_dirty=0, page\_dirty=0, gen=9
traced by btrfs\_root::dirty\_log\_pages
- Log tree write back
btree\_write\_cache\_pages() goes through dirty pages ranges, but since
page of tree block 29421568 gets cleaned already, it's not written
back to disk. Thus it doesn't have WRITTEN bit set.
But ranges in dirty\_log\_pages are cleared.
eb: 29421568, header=0 bflags\_dirty=0, page\_dirty=0, gen=9
not traced by any dirty extent\_iot\_tree.
- Extent tree update when committing transaction
Since tree block 29421568 has transid equal to running trans, and has
no WRITTEN bit, should\_cow\_block() will use it directly without adding
it to btrfs\_transaction::dirty\_pages.
eb: 29421568, header=0 bflags\_dirty=1, page\_dirty=1, gen=9
not traced by any dirty extent\_iot\_tree.
At this stage, we're doomed. We have a dirty eb not tracked by any
extent io tree.
- Transaction gets aborted due to corrupted extent tree
Btrfs cleans up dirty pages according to transaction::dirty\_pages and
btrfs\_root::dirty\_log\_pages.
But since tree block 29421568 is not tracked by neither of them, it's
still dirty.
eb: 29421568, header=0 bflags\_dirty=1, page\_dirty=1, gen=9
not traced by any dirty extent\_iot\_tree.
- Filesystem unmount
Since all cleanup is assumed to be done, all workqueus are destroyed.
Then iput(btree\_inode) is called, expecting no dirty pages.
But tree 29421568 is still dirty, thus triggering writeback.
Since all workqueues are already freed, we cause use-after-free.
This shows us that, log tree blocks + bad extent tree can cause wild
dirty pages.
[FIX]
To fix the problem, don't submit any btree write bio if the filesytem
has any error. This is the last safe net, just in case other cleanup
haven't caught catch it.
Link: https://github.com/bobfuzzer/CVE/tree/master/CVE-2019-19377
CC: stable@vger.kernel.org # 5.4+
Reviewed-by: Josef Bacik
Signed-off-by: Qu Wenruo
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 36e2528914b6a5196361a58d2c9d937738e1f1fe
Author: Tvrtko Ursulin
Date: Thu Mar 12 11:57:48 2020 +0000
drm/i915/gen12: Disable preemption timeout
commit 07bcfd1291de77ffa9b627b4442783aba1335229 upstream.
Allow super long OpenCL workloads which cannot be preempted within
the default timeout to run out of the box.
v2:
\* Make it stick out more and apply only to RCS. (Chris)
v3:
\* Mention platform override in kconfig. (Joonas)
Signed-off-by: Tvrtko Ursulin
Cc: Chris Wilson
Cc: Joonas Lahtinen
Cc: Michal Mrozek
Cc:  # v5.6+
Acked-by: Chris Wilson
Acked-by: Michal Mrozek
Link: https://patchwork.freedesktop.org/patch/msgid/20200312115748.29970-1-tvrtko.ursulin@linux.intel.com
Signed-off-by: Greg Kroah-Hartman
commit 9d63d5135b4fd3d19223443b0055ed4a1e0176f4
Author: Piotr Sroka
Date: Mon Feb 10 10:55:28 2020 +0100
mtd: rawnand: cadence: reinit completion before executing a new command
commit 0d7d6c8183aadb1dcc13f415941404a7913b46b3 upstream.
Reing the completion object before executing CDMA command to make sure
the 'done' flag is OK.
Fixes: ec4ba01e894d ("mtd: rawnand: Add new Cadence NAND driver to MTD subsystem")
Cc: stable@vger.kernel.org
Signed-off-by: Piotr Sroka
Signed-off-by: Miquel Raynal
Link: https://lore.kernel.org/linux-mtd/1581328530-29966-4-git-send-email-piotrs@cadence.com
Signed-off-by: Greg Kroah-Hartman
commit 26453f4936a57594fd0540bf05df690df8d2fa0e
Author: Piotr Sroka
Date: Mon Feb 10 10:55:27 2020 +0100
mtd: rawnand: cadence: change bad block marker size
commit 9bf1903bed7a2e84f5a8deedb38f7e0ac5e8bfc6 upstream.
Increase bad block marker size from one byte to two bytes.
Bad block marker is handled by skip bytes feature of HPNFC.
Controller expects this value to be an even number.
Fixes: ec4ba01e894d ("mtd: rawnand: Add new Cadence NAND driver to MTD subsystem")
Cc: stable@vger.kernel.org
Signed-off-by: Piotr Sroka
Signed-off-by: Miquel Raynal
Link: https://lore.kernel.org/linux-mtd/1581328530-29966-3-git-send-email-piotrs@cadence.com
Signed-off-by: Greg Kroah-Hartman
commit a30a4dabdfa8f184b9a2e466c502b1f62dca889b
Author: Piotr Sroka
Date: Mon Feb 10 10:55:26 2020 +0100
mtd: rawnand: cadence: fix the calculation of the avaialble OOB size
commit e4578af0354176ff6b4ae78b9998b4f479f7c31c upstream.
The value of cdns\_chip->sector\_count is not known at the moment
of the derivation of ecc\_size, leading to a zero value. Fix
this by assigning ecc\_size later in the code.
Fixes: ec4ba01e894d ("mtd: rawnand: Add new Cadence NAND driver to MTD subsystem")
Cc: stable@vger.kernel.org
Signed-off-by: Piotr Sroka
Signed-off-by: Miquel Raynal
Link: https://lore.kernel.org/linux-mtd/1581328530-29966-2-git-send-email-piotrs@cadence.com
Signed-off-by: Greg Kroah-Hartman
commit 834a686ea0b35bc89530270264322a1cd87f0736
Author: Frieder Schrempf
Date: Tue Feb 18 10:05:35 2020 +0000
mtd: spinand: Do not erase the block before writing a bad block marker
commit b645ad39d56846618704e463b24bb994c9585c7f upstream.
Currently when marking a block, we use spinand\_erase\_op() to erase
the block before writing the marker to the OOB area. Doing so without
waiting for the operation to finish can lead to the marking failing
silently and no bad block marker being written to the flash.
In fact we don't need to do an erase at all before writing the BBM.
The ECC is disabled for raw accesses to the OOB data and we don't
need to work around any issues with chips reporting ECC errors as it
is known to be the case for raw NAND.
Fixes: 7529df465248 ("mtd: nand: Add core infrastructure to support SPI NANDs")
Cc: stable@vger.kernel.org
Signed-off-by: Frieder Schrempf
Reviewed-by: Boris Brezillon
Signed-off-by: Miquel Raynal
Link: https://lore.kernel.org/linux-mtd/20200218100432.32433-4-frieder.schrempf@kontron.de
Signed-off-by: Greg Kroah-Hartman
commit 1aeeb0e85c7a68f3cd16a120bfa21506fb881aeb
Author: Frieder Schrempf
Date: Tue Feb 18 10:05:14 2020 +0000
mtd: spinand: Stop using spinand->oobbuf for buffering bad block markers
commit 2148937501ee3d663e0010e519a553fea67ad103 upstream.
For reading and writing the bad block markers, spinand->oobbuf is
currently used as a buffer for the marker bytes. During the
underlying read and write operations to actually get/set the content
of the OOB area, the content of spinand->oobbuf is reused and changed
by accessing it through spinand->oobbuf and/or spinand->databuf.
This is a flaw in the original design of the SPI NAND core and at the
latest from 13c15e07eedf ("mtd: spinand: Handle the case where
PROGRAM LOAD does not reset the cache") on, it results in not having
the bad block marker written at all, as the spinand->oobbuf is
cleared to 0xff after setting the marker bytes to zero.
To fix it, we now just store the two bytes for the marker on the
stack and let the read/write operations copy it from/to the page
buffer later.
Fixes: 7529df465248 ("mtd: nand: Add core infrastructure to support SPI NANDs")
Cc: stable@vger.kernel.org
Signed-off-by: Frieder Schrempf
Reviewed-by: Boris Brezillon
Signed-off-by: Miquel Raynal
Link: https://lore.kernel.org/linux-mtd/20200218100432.32433-2-frieder.schrempf@kontron.de
Signed-off-by: Greg Kroah-Hartman
commit 6553f451dbf2b4cf11ded120ed6e1bfc4679e071
Author: Murphy Zhou
Date: Wed Mar 18 20:43:38 2020 +0800
CIFS: check new file size when extending file by fallocate
commit ef4a632ccc1c7d3fb71a5baae85b79af08b7f94b upstream.
xfstests generic/228 checks if fallocate respect RLIMIT\_FSIZE.
After fallocate mode 0 extending enabled, we can hit this failure.
Fix this by check the new file size with vfs helper, return
error if file size is larger then RLIMIT\_FSIZE(ulimit -f).
This patch has been tested by LTP/xfstests aginst samba and
Windows server.
Acked-by: Ronnie Sahlberg
Signed-off-by: Murphy Zhou
Signed-off-by: Steve French
CC: Stable
Signed-off-by: Greg Kroah-Hartman
commit 147a4fd99da833cc82de2ef6b8068b8e43a524bb
Author: Yilu Lin
Date: Wed Mar 18 11:59:19 2020 +0800
CIFS: Fix bug which the return value by asynchronous read is error
commit 97adda8b3ab703de8e4c8d27646ddd54fe22879c upstream.
This patch is used to fix the bug in collect\_uncached\_read\_data()
that rc is automatically converted from a signed number to an
unsigned number when the CIFS asynchronous read fails.
It will cause ctx->rc is error.
Example:
Share a directory and create a file on the Windows OS.
Mount the directory to the Linux OS using CIFS.
On the CIFS client of the Linux OS, invoke the pread interface to
deliver the read request.
The size of the read length plus offset of the read request is greater
than the maximum file size.
In this case, the CIFS server on the Windows OS returns a failure
message (for example, the return value of
smb2.nt\_status is STATUS\_INVALID\_PARAMETER).
After receiving the response message, the CIFS client parses
smb2.nt\_status to STATUS\_INVALID\_PARAMETER
and converts it to the Linux error code (rdata->result=-22).
Then the CIFS client invokes the collect\_uncached\_read\_data function to
assign the value of rdata->result to rc, that is, rc=rdata->result=-22.
The type of the ctx->total\_len variable is unsigned integer,
the type of the rc variable is integer, and the type of
the ctx->rc variable is ssize\_t.
Therefore, during the ternary operation, the value of rc is
automatically converted to an unsigned number. The final result is
ctx->rc=4294967274. However, the expected result is ctx->rc=-22.
Signed-off-by: Yilu Lin
Signed-off-by: Steve French
CC: Stable
Acked-by: Ronnie Sahlberg
Signed-off-by: Greg Kroah-Hartman
commit 491bcd1e5d978a199a3c4862600d631030f7421c
Author: Steve French
Date: Mon Feb 24 17:37:39 2020 -0600
smb3: fix performance regression with setting mtime
commit cf5371ae460eb8e484e4884747af270c86c3c469 upstream.
There are cases when we don't want to send the SMB2 flush operation
(e.g. when user specifies mount parm "nostrictsync") and it can be
a very expensive operation on the server. In most cases in order
to set mtime, we simply need to flush (write) the dirtry pages from
the client and send the writes to the server not also send a flush
protocol operation to the server.
Fixes: aa081859b10c ("cifs: flush before set-info if we have writeable handles")
CC: Stable
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit e35a2dc8c7f664ae8a9cc46d19985dc79bfc1083
Author: Vitaly Kuznetsov
Date: Wed Apr 1 10:13:48 2020 +0200
KVM: VMX: fix crash cleanup when KVM wasn't used
commit dbef2808af6c594922fe32833b30f55f35e9da6d upstream.
If KVM wasn't used at all before we crash the cleanup procedure fails with
BUG: unable to handle page fault for address: ffffffffffffffc8
#PF: supervisor read access in kernel mode
#PF: error\_code(0x0000) - not-present page
PGD 23215067 P4D 23215067 PUD 23217067 PMD 0
Oops: 0000 [#8] SMP PTI
CPU: 0 PID: 3542 Comm: bash Kdump: loaded Tainted: G D 5.6.0-rc2+ #823
RIP: 0010:crash\_vmclear\_local\_loaded\_vmcss.cold+0x19/0x51 [kvm\_intel]
The root cause is that loaded\_vmcss\_on\_cpu list is not yet initialized,
we initialize it in hardware\_enable() but this only happens when we start
a VM.
Previously, we used to have a bitmap with enabled CPUs and that was
preventing [masking] the issue.
Initialized loaded\_vmcss\_on\_cpu list earlier, right before we assign
crash\_vmclear\_loaded\_vmcss pointer. blocked\_vcpu\_on\_cpu list and
blocked\_vcpu\_on\_cpu\_lock are moved altogether for consistency.
Fixes: 31603d4fc2bb ("KVM: VMX: Always VMCLEAR in-use VMCSes during crash with kexec support")
Signed-off-by: Vitaly Kuznetsov
Message-Id: <20200401081348.1345307-1-vkuznets@redhat.com>
Reviewed-by: Sean Christopherson
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit c03cdc0d484c80672fe4c8158008f2556456b6d1
Author: Sean Christopherson
Date: Thu Mar 26 09:07:12 2020 -0700
KVM: VMX: Add a trampoline to fix VMREAD error handling
commit 842f4be95899df22b5843ba1a7c8cf37e831a6e8 upstream.
Add a hand coded assembly trampoline to preserve volatile registers
across vmread\_error(), and to handle the calling convention differences
between 64-bit and 32-bit due to asmlinkage on vmread\_error(). Pass
@field and @fault on the stack when invoking the trampoline to avoid
clobbering volatile registers in the context of the inline assembly.
Calling vmread\_error() directly from inline assembly is partially broken
on 64-bit, and completely broken on 32-bit. On 64-bit, it will clobber
%rdi and %rsi (used to pass @field and @fault) and any volatile regs
written by vmread\_error(). On 32-bit, asmlinkage means vmread\_error()
expects the parameters to be passed on the stack, not via regs.
Opportunistically zero out the result in the trampoline to save a few
bytes of code for every VMREAD. A happy side effect of the trampoline
is that the inline code footprint is reduced by three bytes on 64-bit
due to PUSH/POP being more efficent (in terms of opcode bytes) than MOV.
Fixes: 6e2020977e3e6 ("KVM: VMX: Add error handling to VMREAD helper")
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson
Message-Id: <20200326160712.28803-1-sean.j.christopherson@intel.com>
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 6264ca7d24454b66e9c209d0a4b930a7f6f473e5
Author: Sean Christopherson
Date: Sun Jan 26 16:41:11 2020 -0800
KVM: x86: Gracefully handle \_\_vmalloc() failure during VM allocation
commit d18b2f43b9147c8005ae0844fb445d8cc6a87e31 upstream.
Check the result of \_\_vmalloc() to avoid dereferencing a NULL pointer in
the event that allocation failres.
Fixes: d1e5b0e98ea27 ("kvm: Make VM ioctl do valloc for some archs")
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson
Reviewed-by: Vitaly Kuznetsov
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit acd78bbb81e6457319a74e5e03655f1c09219ee5
Author: Sean Christopherson
Date: Sat Mar 21 12:37:49 2020 -0700
KVM: VMX: Always VMCLEAR in-use VMCSes during crash with kexec support
commit 31603d4fc2bb4f0815245d496cb970b27b4f636a upstream.
VMCLEAR all in-use VMCSes during a crash, even if kdump's NMI shootdown
interrupted a KVM update of the percpu in-use VMCS list.
Because NMIs are not blocked by disabling IRQs, it's possible that
crash\_vmclear\_local\_loaded\_vmcss() could be called while the percpu list
of VMCSes is being modified, e.g. in the middle of list\_add() in
vmx\_vcpu\_load\_vmcs(). This potential corner case was called out in the
original commit[\*], but the analysis of its impact was wrong.
Skipping the VMCLEARs is wrong because it all but guarantees that a
loaded, and therefore cached, VMCS will live across kexec and corrupt
memory in the new kernel. Corruption will occur because the CPU's VMCS
cache is non-coherent, i.e. not snooped, and so the writeback of VMCS
memory on its eviction will overwrite random memory in the new kernel.
The VMCS will live because the NMI shootdown also disables VMX, i.e. the
in-progress VMCLEAR will #UD, and existing Intel CPUs do not flush the
VMCS cache on VMXOFF.
Furthermore, interrupting list\_add() and list\_del() is safe due to
crash\_vmclear\_local\_loaded\_vmcss() using forward iteration. list\_add()
ensures the new entry is not visible to forward iteration unless the
entire add completes, via WRITE\_ONCE(prev->next, new). A bad "prev"
pointer could be observed if the NMI shootdown interrupted list\_del() or
list\_add(), but list\_for\_each\_entry() does not consume ->prev.
In addition to removing the temporary disabling of VMCLEAR, open code
loaded\_vmcs\_init() in \_\_loaded\_vmcs\_clear() and reorder VMCLEAR so that
the VMCS is deleted from the list only after it's been VMCLEAR'd.
Deleting the VMCS before VMCLEAR would allow a race where the NMI
shootdown could arrive between list\_del() and vmcs\_clear() and thus
neither flow would execute a successful VMCLEAR. Alternatively, more
code could be moved into loaded\_vmcs\_init(), but that gets rather silly
as the only other user, alloc\_loaded\_vmcs(), doesn't need the smp\_wmb()
and would need to work around the list\_del().
Update the smp\_\*() comments related to the list manipulation, and
opportunistically reword them to improve clarity.
[\*] https://patchwork.kernel.org/patch/1675731/#3720461
Fixes: 8f536b7697a0 ("KVM: VMX: provide the vmclear function and a bitmap to support VMCLEAR in kdump")
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson
Message-Id: <20200321193751.24985-2-sean.j.christopherson@intel.com>
Reviewed-by: Vitaly Kuznetsov
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 431289df2a612d778f931cfc7ed600a5f80bdc9d
Author: Sean Christopherson
Date: Tue Feb 18 13:07:15 2020 -0800
KVM: x86: Allocate new rmap and large page tracking when moving memslot
commit edd4fa37baa6ee8e44dc65523b27bd6fe44c94de upstream.
Reallocate a rmap array and recalcuate large page compatibility when
moving an existing memslot to correctly handle the alignment properties
of the new memslot. The number of rmap entries required at each level
is dependent on the alignment of the memslot's base gfn with respect to
that level, e.g. moving a large-page aligned memslot so that it becomes
unaligned will increase the number of rmap entries needed at the now
unaligned level.
Not updating the rmap array is the most obvious bug, as KVM accesses
garbage data beyond the end of the rmap. KVM interprets the bad data as
pointers, leading to non-canonical #GPs, unexpected #PFs, etc...
general protection fault: 0000 [#1] SMP
CPU: 0 PID: 1909 Comm: move\_memory\_reg Not tainted 5.4.0-rc7+ #139
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015
RIP: 0010:rmap\_get\_first+0x37/0x50 [kvm]
Code: <48> 8b 3b 48 85 ff 74 ec e8 6c f4 ff ff 85 c0 74 e3 48 89 d8 5b c3
RSP: 0018:ffffc9000021bbc8 EFLAGS: 00010246
RAX: ffff00617461642e RBX: ffff00617461642e RCX: 0000000000000012
RDX: ffff88827400f568 RSI: ffffc9000021bbe0 RDI: ffff88827400f570
RBP: 0010000000000000 R08: ffffc9000021bd00 R09: ffffc9000021bda8
R10: ffffc9000021bc48 R11: 0000000000000000 R12: 0030000000000000
R13: 0000000000000000 R14: ffff88827427d700 R15: ffffc9000021bce8
FS: 00007f7eda014700(0000) GS:ffff888277a00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f7ed9216ff8 CR3: 0000000274391003 CR4: 0000000000162eb0
Call Trace:
kvm\_mmu\_slot\_set\_dirty+0xa1/0x150 [kvm]
\_\_kvm\_set\_memory\_region.part.64+0x559/0x960 [kvm]
kvm\_set\_memory\_region+0x45/0x60 [kvm]
kvm\_vm\_ioctl+0x30f/0x920 [kvm]
do\_vfs\_ioctl+0xa1/0x620
ksys\_ioctl+0x66/0x70
\_\_x64\_sys\_ioctl+0x16/0x20
do\_syscall\_64+0x4c/0x170
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
RIP: 0033:0x7f7ed9911f47
Code: <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 21 6f 2c 00 f7 d8 64 89 01 48
RSP: 002b:00007ffc00937498 EFLAGS: 00000246 ORIG\_RAX: 0000000000000010
RAX: ffffffffffffffda RBX: 0000000001ab0010 RCX: 00007f7ed9911f47
RDX: 0000000001ab1350 RSI: 000000004020ae46 RDI: 0000000000000004
RBP: 000000000000000a R08: 0000000000000000 R09: 00007f7ed9214700
R10: 00007f7ed92149d0 R11: 0000000000000246 R12: 00000000bffff000
R13: 0000000000000003 R14: 00007f7ed9215000 R15: 0000000000000000
Modules linked in: kvm\_intel kvm irqbypass
---[ end trace 0c5f570b3358ca89 ]---
The disallow\_lpage tracking is more subtle. Failure to update results
in KVM creating large pages when it shouldn't, either due to stale data
or again due to indexing beyond the end of the metadata arrays, which
can lead to memory corruption and/or leaking data to guest/userspace.
Note, the arrays for the old memslot are freed by the unconditional call
to kvm\_free\_memslot() in \_\_kvm\_set\_memory\_region().
Fixes: 05da45583de9b ("KVM: MMU: large page support")
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson
Reviewed-by: Peter Xu
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit b9d5adc9bcfba21bafae5d15c96d35b7c9f4e5a1
Author: David Hildenbrand
Date: Fri Apr 3 17:30:47 2020 +0200
KVM: s390: vsie: Fix delivery of addressing exceptions
commit 4d4cee96fb7a3cc53702a9be8299bf525be4ee98 upstream.
Whenever we get an -EFAULT, we failed to read in guest 2 physical
address space. Such addressing exceptions are reported via a program
intercept to the nested hypervisor.
We faked the intercept, we have to return to guest 2. Instead, right
now we would be returning -EFAULT from the intercept handler, eventually
crashing the VM.
the correct thing to do is to return 1 as rc == 1 is the internal
representation of "we have to go back into g2".
Addressing exceptions can only happen if the g2->g3 page tables
reference invalid g2 addresses (say, either a table or the final page is
not accessible - so something that basically never happens in sane
environments.
Identified by manual code inspection.
Fixes: a3508fbe9dc6 ("KVM: s390: vsie: initial support for nested virtualization")
Cc:  # v4.8+
Signed-off-by: David Hildenbrand
Link: https://lore.kernel.org/r/20200403153050.20569-3-david@redhat.com
Reviewed-by: Claudio Imbrenda
Reviewed-by: Christian Borntraeger
[borntraeger@de.ibm.com: fix patch description]
Signed-off-by: Christian Borntraeger
Signed-off-by: Greg Kroah-Hartman
commit af5d64c7f8443cb28e609c52e92630fca64306f9
Author: David Hildenbrand
Date: Fri Apr 3 17:30:46 2020 +0200
KVM: s390: vsie: Fix region 1 ASCE sanity shadow address checks
commit a1d032a49522cb5368e5dfb945a85899b4c74f65 upstream.
In case we have a region 1 the following calculation
(31 + ((gmap->asce & \_ASCE\_TYPE\_MASK) >> 2)\*11)
results in 64. As shifts beyond the size are undefined the compiler is
free to use instructions like sllg. sllg will only use 6 bits of the
shift value (here 64) resulting in no shift at all. That means that ALL
addresses will be rejected.
The can result in endless loops, e.g. when prefix cannot get mapped.
Fixes: 4be130a08420 ("s390/mm: add shadow gmap support")
Tested-by: Janosch Frank
Reported-by: Janosch Frank
Cc:  # v4.8+
Signed-off-by: David Hildenbrand
Link: https://lore.kernel.org/r/20200403153050.20569-2-david@redhat.com
Reviewed-by: Claudio Imbrenda
Reviewed-by: Christian Borntraeger
[borntraeger@de.ibm.com: fix patch description, remove WARN\_ON\_ONCE]
Signed-off-by: Christian Borntraeger
Signed-off-by: Greg Kroah-Hartman
commit fcbc47231fd877851807a5349bcb2d7f86b2ba34
Author: Sean Christopherson
Date: Mon Mar 2 22:27:35 2020 -0800
KVM: nVMX: Properly handle userspace interrupt window request
commit a1c77abb8d93381e25a8d2df3a917388244ba776 upstream.
Return true for vmx\_interrupt\_allowed() if the vCPU is in L2 and L1 has
external interrupt exiting enabled. IRQs are never blocked in hardware
if the CPU is in the guest (L2 from L1's perspective) when IRQs trigger
VM-Exit.
The new check percolates up to kvm\_vcpu\_ready\_for\_interrupt\_injection()
and thus vcpu\_run(), and so KVM will exit to userspace if userspace has
requested an interrupt window (to inject an IRQ into L1).
Remove the @external\_intr param from vmx\_check\_nested\_events(), which is
actually an indicator that userspace wants an interrupt window, e.g.
it's named @req\_int\_win further up the stack. Injecting a VM-Exit into
L1 to try and bounce out to L0 userspace is all kinds of broken and is
no longer necessary.
Remove the hack in nested\_vmx\_vmexit() that attempted to workaround the
breakage in vmx\_check\_nested\_events() by only filling interrupt info if
there's an actual interrupt pending. The hack actually made things
worse because it caused KVM to \_never\_ fill interrupt info when the
LAPIC resides in userspace (kvm\_cpu\_has\_interrupt() queries
interrupt.injected, which is always cleared by prepare\_vmcs12() before
reaching the hack in nested\_vmx\_vmexit()).
Fixes: 6550c4df7e50 ("KVM: nVMX: Fix interrupt window request with "Acknowledge interrupt on exit"")
Cc: stable@vger.kernel.org
Cc: Liran Alon
Signed-off-by: Sean Christopherson
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit fe6464a21eed8af7d18bde971ddf1fba8079b58a
Author: Fabiano Rosas
Date: Thu Mar 19 19:55:10 2020 -0300
KVM: PPC: Book3S HV: Skip kvmppc\_uvmem\_free if Ultravisor is not supported
commit 9bee484b280a059c1faa10ae174af4f4af02c805 upstream.
kvmppc\_uvmem\_init checks for Ultravisor support and returns early if
it is not present. Calling kvmppc\_uvmem\_free at module exit will cause
an Oops:
$ modprobe -r kvm-hv
Oops: Kernel access of bad area, sig: 11 [#1]
NIP: c000000000789e90 LR: c000000000789e8c CTR: c000000000401030
REGS: c000003fa7bab9a0 TRAP: 0300 Not tainted (5.6.0-rc6-00033-g6c90b86a745a-dirty)
MSR: 9000000000009033  CR: 24002282 XER: 00000000
CFAR: c000000000dae880 DAR: 0000000000000008 DSISR: 40000000 IRQMASK: 1
GPR00: c000000000789e8c c000003fa7babc30 c0000000016fe500 0000000000000000
GPR04: 0000000000000000 0000000000000006 0000000000000000 c000003faf205c00
GPR08: 0000000000000000 0000000000000001 000000008000002d c00800000ddde140
GPR12: c000000000401030 c000003ffffd9080 0000000000000001 0000000000000000
GPR16: 0000000000000000 0000000000000000 000000013aad0074 000000013aaac978
GPR20: 000000013aad0070 0000000000000000 00007fffd1b37158 0000000000000000
GPR24: 000000014fef0d58 0000000000000000 000000014fef0cf0 0000000000000001
GPR28: 0000000000000000 0000000000000000 c0000000018b2a60 0000000000000000
NIP [c000000000789e90] percpu\_ref\_kill\_and\_confirm+0x40/0x170
LR [c000000000789e8c] percpu\_ref\_kill\_and\_confirm+0x3c/0x170
Call Trace:
[c000003fa7babc30] [c000003faf2064d4] 0xc000003faf2064d4 (unreliable)
[c000003fa7babcb0] [c000000000400e8c] dev\_pagemap\_kill+0x6c/0x80
[c000003fa7babcd0] [c000000000401064] memunmap\_pages+0x34/0x2f0
[c000003fa7babd50] [c00800000dddd548] kvmppc\_uvmem\_free+0x30/0x80 [kvm\_hv]
[c000003fa7babd80] [c00800000ddcef18] kvmppc\_book3s\_exit\_hv+0x20/0x78 [kvm\_hv]
[c000003fa7babda0] [c0000000002084d0] sys\_delete\_module+0x1d0/0x2c0
[c000003fa7babe20] [c00000000000b9d0] system\_call+0x5c/0x68
Instruction dump:
3fc2001b fb81ffe0 fba1ffe8 fbe1fff8 7c7f1b78 7c9c2378 3bde4560 7fc3f378
f8010010 f821ff81 486249a1 60000000  7c7d1b78 712a0002 40820084
---[ end trace 5774ef4dc2c98279 ]---
So this patch checks if kvmppc\_uvmem\_init actually allocated anything
before running kvmppc\_uvmem\_free.
Fixes: ca9f4942670c ("KVM: PPC: Book3S HV: Support for running secure guests")
Cc: stable@vger.kernel.org # v5.5+
Reported-by: Greg Kurz
Signed-off-by: Fabiano Rosas
Tested-by: Greg Kurz
Signed-off-by: Paul Mackerras
Signed-off-by: Greg Kroah-Hartman
commit 1fd821aee741fe2d1348ce52700efa3350325628
Author: Kristian Klausen
Date: Tue Mar 3 19:02:15 2020 +0100
platform/x86: asus-wmi: Support laptops where the first battery is named BATT
commit 6b3586d45bba14f6912f37488090c37a3710e7b4 upstream.
The WMI method to set the charge threshold does not provide a
way to specific a battery, so we assume it is the first/primary
battery (by checking if the name is BAT0).
On some newer ASUS laptops (Zenbook UM431DA) though, the
primary/first battery isn't named BAT0 but BATT, so we need
to support that case.
Fixes: 7973353e92ee ("platform/x86: asus-wmi: Refactor charge threshold to use the battery hooking API")
Cc: stable@vger.kernel.org
Signed-off-by: Kristian Klausen
Signed-off-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman
commit 332ce21eede69c09e673513c2b90f9bbdde2cfb5
Author: Thomas Gleixner
Date: Tue Feb 25 22:36:37 2020 +0100
x86/entry/32: Add missing ASM\_CLAC to general\_protection entry
commit 3d51507f29f2153a658df4a0674ec5b592b62085 upstream.
All exception entry points must have ASM\_CLAC right at the
beginning. The general\_protection entry is missing one.
Fixes: e59d1b0a2419 ("x86-32, smap: Add STAC/CLAC instructions to 32-bit kernel entry")
Signed-off-by: Thomas Gleixner
Reviewed-by: Frederic Weisbecker
Reviewed-by: Alexandre Chartre
Reviewed-by: Andy Lutomirski
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20200225220216.219537887@linutronix.de
Signed-off-by: Greg Kroah-Hartman
commit d8eb71e7d4783659581999e6b70309539623613b
Author: Hans de Goede
Date: Sun Feb 23 15:06:10 2020 +0100
x86/tsc\_msr: Make MSR derived TSC frequency more accurate
commit fac01d11722c92a186b27ee26cd429a8066adfb5 upstream.
The "Intel 64 and IA-32 Architectures Software Developer’s Manual Volume 4:
Model-Specific Registers" has the following table for the values from
freq\_desc\_byt:
000B: 083.3 MHz
001B: 100.0 MHz
010B: 133.3 MHz
011B: 116.7 MHz
100B: 080.0 MHz
Notice how for e.g the 83.3 MHz value there are 3 significant digits, which
translates to an accuracy of a 1000 ppm, where as a typical crystal
oscillator is 20 - 100 ppm, so the accuracy of the frequency format used in
the Software Developer’s Manual is not really helpful.
As far as we know Bay Trail SoCs use a 25 MHz crystal and Cherry Trail
uses a 19.2 MHz crystal, the crystal is the source clock for a root PLL
which outputs 1600 and 100 MHz. It is unclear if the root PLL outputs are
used directly by the CPU clock PLL or if there is another PLL in between.
This does not matter though, we can model the chain of PLLs as a single PLL
with a quotient equal to the quotients of all PLLs in the chain multiplied.
So we can create a simplified model of the CPU clock setup using a
reference clock of 100 MHz plus a quotient which gets us as close to the
frequency from the SDM as possible.
For the 83.3 MHz example from above this would give 100 MHz \* 5 / 6 = 83
and 1/3 MHz, which matches exactly what has been measured on actual
hardware.
Use a simplified PLL model with a reference clock of 100 MHz for all Bay
and Cherry Trail models.
This has been tested on the following models:
CPU freq before: CPU freq after:
Intel N2840 2165.800 MHz 2166.667 MHz
Intel Z3736 1332.800 MHz 1333.333 MHz
Intel Z3775 1466.300 MHz 1466.667 MHz
Intel Z8350 1440.000 MHz 1440.000 MHz
Intel Z8750 1600.000 MHz 1600.000 MHz
This fixes the time drifting by about 1 second per hour (20 - 30 seconds
per day) on (some) devices which rely on the tsc\_msr.c code to determine
the TSC frequency.
Reported-by: Vipul Kumar
Suggested-by: Thomas Gleixner
Signed-off-by: Hans de Goede
Signed-off-by: Thomas Gleixner
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20200223140610.59612-3-hdegoede@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit a0bdd883eb78eb129162e941c601028e6c13eb10
Author: Hans de Goede
Date: Sun Feb 23 15:06:09 2020 +0100
x86/tsc\_msr: Fix MSR\_FSB\_FREQ mask for Cherry Trail devices
commit c8810e2ffc30c7e1577f9c057c4b85d984bbc35a upstream.
According to the "Intel 64 and IA-32 Architectures Software Developer's
Manual Volume 4: Model-Specific Registers" on Cherry Trail (Airmont)
devices the 4 lowest bits of the MSR\_FSB\_FREQ mask indicate the bus freq
unlike on e.g. Bay Trail where only the lowest 3 bits are used.
This is also the reason why MAX\_NUM\_FREQS is defined as 9, since Cherry
Trail SoCs have 9 possible frequencies, so the lo value from the MSR needs
to be masked with 0x0f, not with 0x07 otherwise the 9th frequency will get
interpreted as the 1st.
Bump MAX\_NUM\_FREQS to 16 to avoid any possibility of addressing the array
out of bounds and makes the mask part of the cpufreq struct so it can be
set it per model.
While at it also log an error when the index points to an uninitialized
part of the freqs lookup-table.
Signed-off-by: Hans de Goede
Signed-off-by: Thomas Gleixner
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20200223140610.59612-2-hdegoede@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit 68dae89b48ca39724ab2d0bc642d0ea40dd21285
Author: Hans de Goede
Date: Sun Feb 23 15:06:08 2020 +0100
x86/tsc\_msr: Use named struct initializers
commit 812c2d7506fde7cdf83cb2532810a65782b51741 upstream.
Use named struct initializers for the freq\_desc struct-s initialization
and change the "u8 msr\_plat" to a "bool use\_msr\_plat" to make its meaning
more clear instead of relying on a comment to explain it.
Signed-off-by: Hans de Goede
Signed-off-by: Thomas Gleixner
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20200223140610.59612-1-hdegoede@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit 7395ea4e65c2a00d23185a3f63ad315756ba9cef
Author: Eric W. Biederman
Date: Mon Mar 30 19:01:04 2020 -0500
signal: Extend exec\_id to 64bits
commit d1e7fd6462ca9fc76650fbe6ca800e35b24267da upstream.
Replace the 32bit exec\_id with a 64bit exec\_id to make it impossible
to wrap the exec\_id counter. With care an attacker can cause exec\_id
wrap and send arbitrary signals to a newly exec'd parent. This
bypasses the signal sending checks if the parent changes their
credentials during exec.
The severity of this problem can been seen that in my limited testing
of a 32bit exec\_id it can take as little as 19s to exec 65536 times.
Which means that it can take as little as 14 days to wrap a 32bit
exec\_id. Adam Zabrocki has succeeded wrapping the self\_exe\_id in 7
days. Even my slower timing is in the uptime of a typical server.
Which means self\_exec\_id is simply a speed bump today, and if exec
gets noticably faster self\_exec\_id won't even be a speed bump.
Extending self\_exec\_id to 64bits introduces a problem on 32bit
architectures where reading self\_exec\_id is no longer atomic and can
take two read instructions. Which means that is is possible to hit
a window where the read value of exec\_id does not match the written
value. So with very lucky timing after this change this still
remains expoiltable.
I have updated the update of exec\_id on exec to use WRITE\_ONCE
and the read of exec\_id in do\_notify\_parent to use READ\_ONCE
to make it clear that there is no locking between these two
locations.
Link: https://lore.kernel.org/kernel-hardening/20200324215049.GA3710@pi3.com.pl
Fixes: 2.3.23pre2
Cc: stable@vger.kernel.org
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 0d0d5e6d99b2f4506452d47da3083fc9a7451118
Author: Remi Pommarel
Date: Sat Feb 29 17:13:47 2020 +0100
ath9k: Handle txpower changes even when TPC is disabled
commit 968ae2caad0782db5dbbabb560d3cdefd2945d38 upstream.
When TPC is disabled IEEE80211\_CONF\_CHANGE\_POWER event can be handled to
reconfigure HW's maximum txpower.
This fixes 0dBm txpower setting when user attaches to an interface for
the first time with the following scenario:
ieee80211\_do\_open()
ath9k\_add\_interface()
ath9k\_set\_txpower() /\* Set TX power with not yet initialized
sc->hw->conf.power\_level \*/
ieee80211\_hw\_config() /\* Iniatilize sc->hw->conf.power\_level and
raise IEEE80211\_CONF\_CHANGE\_POWER \*/
ath9k\_config() /\* IEEE80211\_CONF\_CHANGE\_POWER is ignored \*/
This issue can be reproduced with the following:
$ modprobe -r ath9k
$ modprobe ath9k
$ wpa\_supplicant -i wlan0 -c /tmp/wpa.conf &
$ iw dev /\* Here TX power is either 0 or 3 depending on RF chain \*/
$ killall wpa\_supplicant
$ iw dev /\* TX power goes back to calibrated value and subsequent
calls will be fine \*/
Fixes: 283dd11994cde ("ath9k: add per-vif TX power capability")
Cc: stable@vger.kernel.org
Signed-off-by: Remi Pommarel
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 0047e343b2229e1737b454bb058343d464e9cff6
Author: Neeraj Upadhyay
Date: Mon Mar 23 10:38:51 2020 +0530
PM: sleep: wakeup: Skip wakeup\_source\_sysfs\_remove() if device is not there
commit 87de6594dc45dbf6819f3e0ef92f9331c5a9444c upstream.
Skip wakeup\_source\_sysfs\_remove() to fix a NULL pinter dereference via
ws->dev, if the wakeup source is unregistered before registering the
wakeup class from device\_add().
Fixes: 2ca3d1ecb8c4 ("PM / wakeup: Register wakeup class kobj after device is added")
Signed-off-by: Neeraj Upadhyay
Cc: 5.4+  # 5.4+
[ rjw: Subject & changelog, white space ]
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 1a377e65564f0a2718f8da12e7e790d236fb9166
Author: Ulf Hansson
Date: Tue Mar 10 11:40:23 2020 +0100
PM / Domains: Allow no domain-idle-states DT property in genpd when parsing
commit 56cb26891ea4180121265dc6b596015772c4a4b8 upstream.
Commit 2c361684803e ("PM / Domains: Don't treat zero found compatible idle
states as an error"), moved of\_genpd\_parse\_idle\_states() towards allowing
none compatible idle state to be found for the device node, rather than
returning an error code.
However, it didn't consider that the "domain-idle-states" DT property may
be missing as it's optional, which makes of\_count\_phandle\_with\_args() to
return -ENOENT. Let's fix this to make the behaviour consistent.
Fixes: 2c361684803e ("PM / Domains: Don't treat zero found compatible idle states as an error")
Reported-by: Benjamin Gaignard
Cc: 4.20+  # 4.20+
Reviewed-by: Sudeep Holla
Signed-off-by: Ulf Hansson
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 5ff5e214a4d35b2ea033d054e6c74453bd07577e
Author: Gustavo A. R. Silva
Date: Tue Jan 22 14:18:42 2019 -0600
MIPS: OCTEON: irq: Fix potential NULL pointer dereference
commit 792a402c2840054533ef56279c212ef6da87d811 upstream.
There is a potential NULL pointer dereference in case kzalloc()
fails and returns NULL.
Fix this by adding a NULL check on \*cd\*
This bug was detected with the help of Coccinelle.
Fixes: 64b139f97c01 ("MIPS: OCTEON: irq: add CIB and other fixes")
Cc: stable@vger.kernel.org
Signed-off-by: Gustavo A. R. Silva
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Greg Kroah-Hartman
commit d5355d0cf3b44a5f30177d52f5f0afc8fba52b38
Author: Huacai Chen
Date: Wed Mar 25 11:44:54 2020 +0800
MIPS/tlbex: Fix LDDIR usage in setup\_pw() for Loongson-3
commit d191aaffe3687d1e73e644c185f5f0550ec242b5 upstream.
LDDIR/LDPTE is Loongson-3's acceleration for Page Table Walking. If BD
(Base Directory, the 4th page directory) is not enabled, then GDOffset
is biased by BadVAddr[63:62]. So, if GDOffset (aka. BadVAddr[47:36] for
Loongson-3) is big enough, "0b11(BadVAddr[63:62])|BadVAddr[47:36]|...."
can far beyond pg\_swapper\_dir. This means the pg\_swapper\_dir may NOT be
accessed by LDDIR correctly, so fix it by set PWDirExt in CP0\_PWCtl.
Cc:
Signed-off-by: Pei Huang
Signed-off-by: Huacai Chen
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Greg Kroah-Hartman
commit a46d78a48f0d32412bd80c00a900f7293789c3d2
Author: Vasily Averin
Date: Tue Feb 25 11:11:20 2020 +0300
pstore: pstore\_ftrace\_seq\_next should increase position index
commit 6c871b7314dde9ab64f20de8f5aa3d01be4518e8 upstream.
In Aug 2018 NeilBrown noticed
commit 1f4aace60b0e ("fs/seq\_file.c: simplify seq\_file iteration code and interface")
"Some ->next functions do not increment \*pos when they return NULL...
Note that such ->next functions are buggy and should be fixed.
A simple demonstration is
dd if=/proc/swaps bs=1000 skip=1
Choose any block size larger than the size of /proc/swaps. This will
always show the whole last line of /proc/swaps"
/proc/swaps output was fixed recently, however there are lot of other
affected files, and one of them is related to pstore subsystem.
If .next function does not change position index, following .show function
will repeat output related to current position index.
There are at least 2 related problems:
- read after lseek beyond end of file, described above by NeilBrown
"dd if= bs=1000 skip=1" will generate whole last list
- read after lseek on in middle of last line will output expected rest of
last line but then repeat whole last line once again.
If .show() function generates multy-line output (like
pstore\_ftrace\_seq\_show() does ?) following bash script cycles endlessly
$ q=;while read -r r;do echo "$((++q)) $r";done < AFFECTED\_FILE
Unfortunately I'm not familiar enough to pstore subsystem and was unable
to find affected pstore-related file on my test node.
If .next function does not change position index, following .show function
will repeat output related to current position index.
Cc: stable@vger.kernel.org
Fixes: 1f4aace60b0e ("fs/seq\_file.c: simplify seq\_file iteration code ...")
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=206283
Signed-off-by: Vasily Averin
Link: https://lore.kernel.org/r/4e49830d-4c88-0171-ee24-1ee540028dad@virtuozzo.com
[kees: with robustness tweak from Joel Fernandes ]
Signed-off-by: Kees Cook
Signed-off-by: Greg Kroah-Hartman
commit fa8bc007ebd2f3dc5910fd7fac4032c6d1ae3803
Author: Pavel Begunkov
Date: Mon Apr 6 00:08:52 2020 +0300
io\_uring: fix ctx refcounting in io\_submit\_sqes()
commit 48bdd849e967f1c573d2b2bc24308e24a83f39c2 upstream.
If io\_get\_req() fails, it drops a ref. Then, awhile keeping @submitted
unmodified, io\_submit\_sqes() breaks the loop and puts @nr - @submitted
refs. For each submitted req a ref is dropped in io\_put\_req() and
friends. So, for @nr taken refs there will be
(@nr - @submitted + @submitted + 1) dropped.
Remove ctx refcounting from io\_get\_req(), that at the same time makes
it clearer.
Fixes: 2b85edfc0c90 ("io\_uring: batch getting pcpu references")
Cc: stable@vger.kernel.org # v5.6
Signed-off-by: Pavel Begunkov
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit a628d98304f2c0fce64a6761e4accc23a2cae296
Author: Jens Axboe
Date: Fri Apr 3 13:54:26 2020 -0600
io\_uring: remove bogus RLIMIT\_NOFILE check in file registration
commit c336e992cb1cb1db9ee608dfb30342ae781057ab upstream.
We already checked this limit when the file was opened, and we keep it
open in the file table. Hence when we added unit\_inflight to the count
we want to register, we're doubly accounting these files. This results
in -EMFILE for file registration, if we're at half the limit.
Cc: stable@vger.kernel.org # v5.1+
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 5ecbd81fd8f4be127fdcfbd1516d88b7926a4164
Author: Jens Axboe
Date: Wed Apr 8 09:20:54 2020 -0600
io\_uring: ensure openat sets O\_LARGEFILE if needed
commit 08a1d26eb894a9dcf79f674558a284ad1ffef517 upstream.
OPENAT2 correctly sets O\_LARGEFILE if it has to, but that escaped the
OPENAT opcode. Dmitry reports that his test case that compares openat()
and IORING\_OP\_OPENAT sees failures on large files:
commit 02ba63d95c61fcc2c361fdb2399ae7d1238ee2d3
Author: Sungbo Eo
Date: Sat Mar 21 22:38:42 2020 +0900
irqchip/versatile-fpga: Apply clear-mask earlier
commit 6a214a28132f19ace3d835a6d8f6422ec80ad200 upstream.
Clear its own IRQs before the parent IRQ get enabled, so that the
remaining IRQs do not accidentally interrupt the parent IRQ controller.
This patch also fixes a reboot bug on OX820 SoC, where the remaining
rps-timer IRQ raises a GIC interrupt that is left pending. After that,
the rps-timer IRQ is cleared during driver initialization, and there's
no IRQ left in rps-irq when local\_irq\_enable() is called, which evokes
an error message "unexpected IRQ trap".
Fixes: bdd272cbb97a ("irqchip: versatile FPGA: support cascaded interrupts from DT")
Signed-off-by: Sungbo Eo
Signed-off-by: Marc Zyngier
Reviewed-by: Linus Walleij
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20200321133842.2408823-1-mans0n@gorani.run
Signed-off-by: Greg Kroah-Hartman
commit 17373365ec50f244ce9b8c358ef64616d500d2a2
Author: Thomas Gleixner
Date: Fri Mar 6 14:03:42 2020 +0100
genirq/debugfs: Add missing sanity checks to interrupt injection
commit a740a423c36932695b01a3e920f697bc55b05fec upstream.
Interrupts cannot be injected when the interrupt is not activated and when
a replay is already in progress.
Fixes: 536e2e34bd00 ("genirq/debugfs: Triggering of interrupts from userspace")
Signed-off-by: Thomas Gleixner
Acked-by: Marc Zyngier
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20200306130623.500019114@linutronix.de
Signed-off-by: Greg Kroah-Hartman
commit ee4f22419d7692162e234d3d56fa9c86d8a12b44
Author: Thomas Gleixner
Date: Fri Mar 27 12:06:44 2020 +0100
cpu/hotplug: Ignore pm\_wakeup\_pending() for disable\_nonboot\_cpus()
commit e98eac6ff1b45e4e73f2e6031b37c256ccb5d36b upstream.
A recent change to freeze\_secondary\_cpus() which added an early abort if a
wakeup is pending missed the fact that the function is also invoked for
shutdown, reboot and kexec via disable\_nonboot\_cpus().
In case of disable\_nonboot\_cpus() the wakeup event needs to be ignored as
the purpose is to terminate the currently running kernel.
Add a 'suspend' argument which is only set when the freeze is in context of
a suspend operation. If not set then an eventually pending wakeup event is
ignored.
Fixes: a66d955e910a ("cpu/hotplug: Abort disabling secondary CPUs if wakeup is pending")
Reported-by: Boqun Feng
Signed-off-by: Thomas Gleixner
Cc: Pavankumar Kondeti
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/874kuaxdiz.fsf@nanos.tec.linutronix.de
Signed-off-by: Greg Kroah-Hartman
commit 15c47daa03abe3df4f201350be92a3db943e8bb8
Author: Paul E. McKenney
Date: Tue Feb 11 06:17:33 2020 -0800
rcu: Make rcu\_barrier() account for offline no-CBs CPUs
commit 127e29815b4b2206c0a97ac1d83f92ffc0e25c34 upstream.
Currently, rcu\_barrier() ignores offline CPUs, However, it is possible
for an offline no-CBs CPU to have callbacks queued, and rcu\_barrier()
must wait for those callbacks. This commit therefore makes rcu\_barrier()
directly invoke the rcu\_barrier\_func() with interrupts disabled for such
CPUs. This requires passing the CPU number into this function so that
it can entrain the rcu\_barrier() callback onto the correct CPU's callback
list, given that the code must instead execute on the current CPU.
While in the area, this commit fixes a bug where the first CPU's callback
might have been invoked before rcu\_segcblist\_entrain() returned, which
would also result in an early wakeup.
Fixes: 5d6742b37727 ("rcu/nocb: Use rcu\_segcblist for no-CBs CPUs")
Signed-off-by: Paul E. McKenney
[ paulmck: Apply optimization feedback from Boqun Feng. ]
Cc:  # 5.5.x
Signed-off-by: Greg Kroah-Hartman
commit d222a9cb52254403a6b6b4742388b29ccdf1ccba
Author: Ludovic Barre
Date: Wed Mar 25 15:34:08 2020 +0100
mmc: mmci\_sdmmc: Fix clear busyd0end irq flag
commit d4a384cb563e555ce00255f5f496b503e6cc6358 upstream.
The busyd0 line transition can be very fast. The busy request may be
completed by busy\_d0end, without waiting for the busy\_d0 steps. Therefore,
clear the busyd0end irq flag, even if no busy\_status.
Fixes: 0e68de6aa7b1 ("mmc: mmci: sdmmc: add busy\_complete callback")
Cc: stable@vger.kernel.org
Signed-off-by: Ludovic Barre
Link: https://lore.kernel.org/r/20200325143409.13005-2-ludovic.barre@st.com
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit a3ed1bdd7d7a1c9dd501135a900bf7ec79a55f6e
Author: Yang Xu
Date: Fri Feb 28 12:41:51 2020 +0800
KEYS: reaching the keys quotas correctly
commit 2e356101e72ab1361821b3af024d64877d9a798d upstream.
Currently, when we add a new user key, the calltrace as below:
add\_key()
key\_create\_or\_update()
key\_alloc()
\_\_key\_instantiate\_and\_link
generic\_key\_instantiate
key\_payload\_reserve
......
Since commit a08bf91ce28e ("KEYS: allow reaching the keys quotas exactly"),
we can reach max bytes/keys in key\_alloc, but we forget to remove this
limit when we reserver space for payload in key\_payload\_reserve. So we
can only reach max keys but not max bytes when having delta between plen
and type->def\_datalen. Remove this limit when instantiating the key, so we
can keep consistent with key\_alloc.
Also, fix the similar problem in keyctl\_chown\_key().
Fixes: 0b77f5bfb45c ("keys: make the keyring quotas controllable through /proc/sys")
Fixes: a08bf91ce28e ("KEYS: allow reaching the keys quotas exactly")
Cc: stable@vger.kernel.org # 5.0.x
Cc: Eric Biggers
Signed-off-by: Yang Xu
Reviewed-by: Jarkko Sakkinen
Reviewed-by: Eric Biggers
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 57f11236d1bbe21ba57d225399dde93635562d64
Author: Vasily Averin
Date: Tue Feb 25 09:26:22 2020 +0300
tpm: tpm2\_bios\_measurements\_next should increase position index
commit f9bf8adb55cd5a357b247a16aafddf8c97b276e0 upstream.
If .next function does not change position index,
following .show function will repeat output related
to current position index.
For /sys/kernel/security/tpm0/binary\_bios\_measurements:
1) read after lseek beyound end of file generates whole last line.
2) read after lseek to middle of last line generates
expected end of last line and unexpected whole last line once again.
Cc: stable@vger.kernel.org # 4.19.x
Fixes: 1f4aace60b0e ("fs/seq\_file.c: simplify seq\_file iteration code ...")
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=206283
Signed-off-by: Vasily Averin
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit c9dcd15874ccd096c361902f171c1f557ff36a73
Author: Vasily Averin
Date: Tue Feb 25 09:26:08 2020 +0300
tpm: tpm1\_bios\_measurements\_next should increase position index
commit d7a47b96ed1102551eb7325f97937e276fb91045 upstream.
If .next function does not change position index,
following .show function will repeat output related
to current position index.
In case of /sys/kernel/security/tpm0/ascii\_bios\_measurements
and binary\_bios\_measurements:
1) read after lseek beyound end of file generates whole last line.
2) read after lseek to middle of last line generates
expected end of last line and unexpected whole last line once again.
Cc: stable@vger.kernel.org # 4.19.x
Fixes: 1f4aace60b0e ("fs/seq\_file.c: simplify seq\_file iteration code ...")
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=206283
Signed-off-by: Vasily Averin
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit fe1971184d0f0244ba85ae8391d895b7adc39bde
Author: Matthew Garrett
Date: Thu Jan 2 13:55:18 2020 -0800
tpm: Don't make log failures fatal
commit 805fa88e0780b7ce1cc9b649dd91a0a7164c6eb4 upstream.
If a TPM is in disabled state, it's reasonable for it to have an empty
log. Bailing out of probe in this case means that the PPI interface
isn't available, so there's no way to then enable the TPM from the OS.
In general it seems reasonable to ignore log errors - they shouldn't
interfere with any other TPM functionality.
Signed-off-by: Matthew Garrett
Cc: stable@vger.kernel.org # 4.19.x
Reviewed-by: Jerry Snitselaar
Reviewed-by: Jarkko Sakkinen
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Greg Kroah-Hartman
commit 1480f835bea2fb36408fcee7129dfdc0daa51b32
Author: Vincent Guittot
Date: Fri Mar 6 14:52:57 2020 +0100
sched/fair: Fix enqueue\_task\_fair warning
commit fe61468b2cbc2b7ce5f8d3bf32ae5001d4c434e9 upstream.
When a cfs rq is throttled, the latter and its child are removed from the
leaf list but their nr\_running is not changed which includes staying higher
than 1. When a task is enqueued in this throttled branch, the cfs rqs must
be added back in order to ensure correct ordering in the list but this can
only happens if nr\_running == 1.
When cfs bandwidth is used, we call unconditionnaly list\_add\_leaf\_cfs\_rq()
when enqueuing an entity to make sure that the complete branch will be
added.
Similarly unthrottle\_cfs\_rq() can stop adding cfs in the list when a parent
is throttled. Iterate the remaining entity to ensure that the complete
branch will be added in the list.
Reported-by: Christian Borntraeger
Signed-off-by: Vincent Guittot
Signed-off-by: Peter Zijlstra (Intel)
Reviewed-by: Dietmar Eggemann
Tested-by: Christian Borntraeger
Tested-by: Dietmar Eggemann
Cc: stable@vger.kernel.org
Cc: stable@vger.kernel.org #v5.1+
Link: https://lkml.kernel.org/r/20200306135257.25044-1-vincent.guittot@linaro.org
Signed-off-by: Greg Kroah-Hartman
commit 766964b2b1f1b4655e93c86d88cd345abfbd81a3
Author: Gao Xiang
Date: Wed Feb 26 16:10:06 2020 +0800
erofs: correct the remaining shrink objects
commit 9d5a09c6f3b5fb85af20e3a34827b5d27d152b34 upstream.
The remaining count should not include successful
shrink attempts.
Fixes: e7e9a307be9d ("staging: erofs: introduce workstation for decompression")
Cc:  # 4.19+
Link: https://lore.kernel.org/r/20200226081008.86348-1-gaoxiang25@huawei.com
Reviewed-by: Chao Yu
Signed-off-by: Gao Xiang
Signed-off-by: Greg Kroah-Hartman
commit be9bfa9188f5c114432f51827b23260283331f4d
Author: Kishon Vijay Abraham I
Date: Mon Feb 24 15:23:36 2020 +0530
PCI: endpoint: Fix for concurrent memory allocation in OB address region
commit 04e046ca57ebed3943422dee10eec9e73aec081e upstream.
pci-epc-mem uses a bitmap to manage the Endpoint outbound (OB) address
region. This address region will be shared by multiple endpoint
functions (in the case of multi function endpoint) and it has to be
protected from concurrent access to avoid updating an inconsistent state.
Use a mutex to protect bitmap updates to prevent the memory
allocation API from returning incorrect addresses.
Signed-off-by: Kishon Vijay Abraham I
Signed-off-by: Lorenzo Pieralisi
Cc: stable@vger.kernel.org # v4.14+
Signed-off-by: Greg Kroah-Hartman
commit 98c3a42689cd51b9088d27d403896057bb19c9b0
Author: Bjorn Andersson
Date: Thu Dec 26 17:27:17 2019 -0800
PCI: qcom: Fix the fixup of PCI\_VENDOR\_ID\_QCOM
commit 604f3956524a6a53c1e3dd27b4b685b664d181ec upstream.
There exists non-bridge PCIe devices with PCI\_VENDOR\_ID\_QCOM, so limit
the fixup to only affect the relevant PCIe bridges.
Fixes: 322f03436692 ("PCI: qcom: Use default config space read function")
Signed-off-by: Bjorn Andersson
Signed-off-by: Lorenzo Pieralisi
Acked-by: Stanimir Varbanov
Cc: stable@vger.kernel.org # v5.2+
Signed-off-by: Greg Kroah-Hartman
commit 9ad284c07611ed3802eb05af43e74201f13df839
Author: Sean V Kelley
Date: Thu Feb 20 11:29:29 2020 -0800
PCI: Add boot interrupt quirk mechanism for Xeon chipsets
commit b88bf6c3b6ff77948c153cac4e564642b0b90632 upstream.
The following was observed by Kar Hin Ong with RT patchset:
Backtrace:
irq 19: nobody cared (try booting with the "irqpoll" option)
CPU: 0 PID: 3329 Comm: irq/34-nipalk Tainted:4.14.87-rt49 #1
Hardware name: National Instruments NI PXIe-8880/NI PXIe-8880,
BIOS 2.1.5f1 01/09/2020
Call Trace:
? dump\_stack+0x46/0x5e
? \_\_report\_bad\_irq+0x2e/0xb0
? note\_interrupt+0x242/0x290
? nNIKAL100\_memoryRead16+0x8/0x10 [nikal]
? handle\_irq\_event\_percpu+0x55/0x70
? handle\_irq\_event+0x4f/0x80
? handle\_fasteoi\_irq+0x81/0x180
? handle\_irq+0x1c/0x30
? do\_IRQ+0x41/0xd0
? common\_interrupt+0x84/0x84

...
handlers:
[] irq\_default\_primary\_handler threaded
[] usb\_hcd\_irq
Disabling IRQ #19
The problem being that this device is triggering boot interrupts
due to threaded interrupt handling and masking of the IO-APIC. These
boot interrupts are then forwarded on to the legacy PCH's PIRQ lines
where there is no handler present for the device.
Whenever a PCI device fires interrupt (INTx) to Pin 20 of IOAPIC 2
(GSI 44), the kernel receives two interrupts:
1. Interrupt from Pin 20 of IOAPIC 2 -> Expected
2. Interrupt from Pin 19 of IOAPIC 1 -> UNEXPECTED
Quirks for disabling boot interrupts (preferred) or rerouting the
handler exist but do not address these Xeon chipsets' mechanism:
https://lore.kernel.org/lkml/12131949181903-git-send-email-sassmann@suse.de/
Add a new mechanism via PCI CFG for those chipsets supporting CIPINTRC
register's dis\_intx\_rout2ich bit.
Link: https://lore.kernel.org/r/20200220192930.64820-2-sean.v.kelley@linux.intel.com
Reported-by: Kar Hin Ong
Tested-by: Kar Hin Ong
Signed-off-by: Sean V Kelley
Signed-off-by: Bjorn Helgaas
Reviewed-by: Thomas Gleixner
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 627b2f28193506bb2a9785757b42366370bbc48d
Author: Yicong Yang
Date: Fri Mar 13 17:53:47 2020 +0800
PCI/ASPM: Clear the correct bits when enabling L1 substates
commit 58a3862a10a317a81097ab0c78aecebabb1704f5 upstream.
In pcie\_config\_aspm\_l1ss(), we cleared the wrong bits when enabling ASPM L1
Substates. Instead of the L1.x enable bits (PCI\_L1SS\_CTL1\_L1SS\_MASK, 0xf), we
cleared the Link Activation Interrupt Enable bit (PCI\_L1SS\_CAP\_L1\_PM\_SS,
0x10).
Clear the L1.x enable bits before writing the new L1.x configuration.
[bhelgaas: changelog]
Fixes: aeda9adebab8 ("PCI/ASPM: Configure L1 substate settings")
Link: https://lore.kernel.org/r/1584093227-1292-1-git-send-email-yangyicong@hisilicon.com
Signed-off-by: Yicong Yang
Signed-off-by: Bjorn Helgaas
CC: stable@vger.kernel.org # v4.11+
Signed-off-by: Greg Kroah-Hartman
commit b2d0ff7c78b3e9cdc6532a1cb38b6256b1c620f8
Author: Lukas Wunner
Date: Wed Mar 18 12:33:12 2020 +0100
PCI: pciehp: Fix indefinite wait on sysfs requests
commit 3e487d2e4aa466decd226353755c9d423e8fbacc upstream.
David Hoyer reports that powering pciehp slots up or down via sysfs may
hang: The call to wait\_event() in pciehp\_sysfs\_enable\_slot() and
\_disable\_slot() does not return because ctrl->ist\_running remains true.
This flag, which was introduced by commit 157c1062fcd8 ("PCI: pciehp: Avoid
returning prematurely from sysfs requests"), signifies that the IRQ thread
pciehp\_ist() is running. It is set to true at the top of pciehp\_ist() and
reset to false at the end. However there are two additional return
statements in pciehp\_ist() before which the commit neglected to reset the
flag to false and wake up waiters for the flag.
That omission opens up the following race when powering up the slot:
\* pciehp\_ist() runs because a PCI\_EXP\_SLTSTA\_PDC event was requested
by pciehp\_sysfs\_enable\_slot()
\* pciehp\_ist() turns on slot power via the following call stack:
pciehp\_handle\_presence\_or\_link\_change() -> pciehp\_enable\_slot() ->
\_\_pciehp\_enable\_slot() -> board\_added() -> pciehp\_power\_on\_slot()
\* after slot power is turned on, the link comes up, resulting in a
PCI\_EXP\_SLTSTA\_DLLSC event
\* the IRQ handler pciehp\_isr() stores the event in ctrl->pending\_events
and returns IRQ\_WAKE\_THREAD
\* the IRQ thread is already woken (it's bringing up the slot), but the
genirq code remembers to re-run the IRQ thread after it has finished
(such that it can deal with the new event) by setting IRQTF\_RUNTHREAD
via \_\_handle\_irq\_event\_percpu() -> \_\_irq\_wake\_thread()
\* the IRQ thread removes PCI\_EXP\_SLTSTA\_DLLSC from ctrl->pending\_events
via board\_added() -> pciehp\_check\_link\_status() in order to deal with
presence and link flaps per commit 6c35a1ac3da6 ("PCI: pciehp:
Tolerate initially unstable link")
\* after pciehp\_ist() has successfully brought up the slot, it resets
ctrl->ist\_running to false and wakes up the sysfs requester
\* the genirq code re-runs pciehp\_ist(), which sets ctrl->ist\_running
to true but then returns with IRQ\_NONE because ctrl->pending\_events
is empty
\* pciehp\_sysfs\_enable\_slot() is finally woken but notices that
ctrl->ist\_running is true, hence continues waiting
The only way to get the hung task going again is to trigger a hotplug
event which brings down the slot, e.g. by yanking out the card.
The same race exists when powering down the slot because remove\_board()
likewise clears link or presence changes in ctrl->pending\_events per commit
3943af9d01e9 ("PCI: pciehp: Ignore Link State Changes after powering off a
slot") and thereby may cause a re-run of pciehp\_ist() which returns with
IRQ\_NONE without resetting ctrl->ist\_running to false.
Fix by adding a goto label before the teardown steps at the end of
pciehp\_ist() and jumping to that label from the two return statements which
currently neglect to reset the ctrl->ist\_running flag.
Fixes: 157c1062fcd8 ("PCI: pciehp: Avoid returning prematurely from sysfs requests")
Link: https://lore.kernel.org/r/cca1effa488065cb055120aa01b65719094bdcb5.1584530321.git.lukas@wunner.de
Reported-by: David Hoyer
Signed-off-by: Lukas Wunner
Signed-off-by: Bjorn Helgaas
Reviewed-by: Keith Busch
Cc: stable@vger.kernel.org # v4.19+
Signed-off-by: Greg Kroah-Hartman
commit ab73308fd924e1fd6633dfeab25bdc1ccbcb18af
Author: Tom Lendacky
Date: Fri Feb 28 13:14:03 2020 +0100
efi/x86: Add TPM related EFI tables to unencrypted mapping checks
commit f10e80a19b07b58fc2adad7945f8313b01503bae upstream.
When booting with SME active, EFI tables must be mapped unencrypted since
they were built by UEFI in unencrypted memory. Update the list of tables
to be checked during early\_memremap() processing to account for the EFI
TPM tables.
This fixes a bug where an EFI TPM log table has been created by UEFI, but
it lives in memory that has been marked as usable rather than reserved.
Signed-off-by: Tom Lendacky
Signed-off-by: Ard Biesheuvel
Signed-off-by: Ingo Molnar
Cc: linux-efi@vger.kernel.org
Cc: Ingo Molnar
Cc: Thomas Gleixner
Cc: David Hildenbrand
Cc: Heinrich Schuchardt
Cc:  # v5.4+
Link: https://lore.kernel.org/r/4144cd813f113c20cdfa511cf59500a64e6015be.1582662842.git.thomas.lendacky@amd.com
Link: https://lore.kernel.org/r/20200228121408.9075-2-ardb@kernel.org
Signed-off-by: Greg Kroah-Hartman
commit a192f91a9e915600599ed13d6a92e16120f97647
Author: James Smart
Date: Fri Apr 3 07:33:20 2020 -0700
nvme-fc: Revert "add module to ops template to allow module references"
commit 8c5c660529209a0e324c1c1a35ce3f83d67a2aa5 upstream.
The original patch was to resolve the lldd being able to be unloaded
while being used to talk to the boot device of the system. However, the
end result of the original patch is that any driver unload while a nvme
controller is live via the lldd is now being prohibited. Given the module
reference, the module teardown routine can't be called, thus there's no
way, other than manual actions to terminate the controllers.
Fixes: 863fbae929c7 ("nvme\_fc: add module to ops template to allow module references")
Cc:  # v5.4+
Signed-off-by: James Smart
Reviewed-by: Himanshu Madhani
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit f7c91cee97b4757b5f7cfad1f892690e68f09d31
Author: Sagi Grimberg
Date: Tue Feb 25 16:42:27 2020 -0800
nvmet-tcp: fix maxh2cdata icresp parameter
commit 9cda34e37489244a8c8628617e24b2dbc8a8edad upstream.
MAXH2CDATA is not zero based. Also no reason to limit ourselves to
1M transfers as we can do more easily. Make this an arbitrary limit
of 16M.
Reported-by: Wenhua Liu
Cc: stable@vger.kernel.org # v5.0+
Signed-off-by: Sagi Grimberg
Signed-off-by: Keith Busch
Signed-off-by: Greg Kroah-Hartman
commit ee0422caa6c40fdcc6369a198053b444b2b9f79c
Author: Martin Blumenstingl
Date: Fri Apr 3 22:51:33 2020 +0200
thermal: devfreq\_cooling: inline all stubs for CONFIG\_DEVFREQ\_THERMAL=n
commit 3f5b9959041e0db6dacbea80bb833bff5900999f upstream.
When CONFIG\_DEVFREQ\_THERMAL is disabled all functions except
of\_devfreq\_cooling\_register\_power() were already inlined. Also inline
the last function to avoid compile errors when multiple drivers call
of\_devfreq\_cooling\_register\_power() when CONFIG\_DEVFREQ\_THERMAL is not
set. Compilation failed with the following message:
multiple definition of `of\_devfreq\_cooling\_register\_power'
(which then lists all usages of of\_devfreq\_cooling\_register\_power())
Thomas Zimmermann reported this problem [0] on a kernel config with
CONFIG\_DRM\_LIMA={m,y}, CONFIG\_DRM\_PANFROST={m,y} and
CONFIG\_DEVFREQ\_THERMAL=n after both, the lima and panfrost drivers
gained devfreq cooling support.
[0] https://www.spinics.net/lists/dri-devel/msg252825.html
Fixes: a76caf55e5b356 ("thermal: Add devfreq cooling")
Cc: stable@vger.kernel.org
Reported-by: Thomas Zimmermann
Signed-off-by: Martin Blumenstingl
Tested-by: Thomas Zimmermann
Signed-off-by: Daniel Lezcano
Link: https://lore.kernel.org/r/20200403205133.1101808-1-martin.blumenstingl@googlemail.com
Signed-off-by: Greg Kroah-Hartman
commit bb6e6880832c91d969e565aa1ad6f59f329cb0ac
Author: Gayatri Kammela
Date: Fri Mar 27 14:28:21 2020 -0700
thermal: int340x\_thermal: fix: Update Tiger Lake ACPI device IDs
commit 26d8bec1e97ba218b7d82afadca1c049eb75f773 upstream.
Tiger Lake's new unique ACPI device IDs for Intel thermal driver are not
valid because of missing 'C' in the IDs. Fix the IDs by updating them.
After the update, the new IDs should now look like
INT1040 --> INTC1040
INT1043 --> INTC1043
Fixes: 9b1b5535dfc9 ("thermal: int340x\_thermal: Add Tiger Lake ACPI device IDs")
Cc: 5.6+  # 5.6+
Suggested-by: Srinivas Pandruvada
Signed-off-by: Gayatri Kammela
Acked-by: Zhang Rui
Reviewed-by: Andy Shevchenko
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 70ace882e863974d3411a6f6f31f4ef75952fd60
Author: Rafael J. Wysocki
Date: Wed Mar 25 11:55:48 2020 +0100
ACPI: PM: s2idle: Refine active GPEs check
commit d5406284ff803a578ca503373624312770319054 upstream.
The check for any active GPEs added by commit fdde0ff8590b ("ACPI:
PM: s2idle: Prevent spurious SCIs from waking up the system") turns
out to be insufficiently precise to prevent some systems from
resuming prematurely due to a spurious EC wakeup, so refine it
by first checking if any GPEs other than the EC GPE are active
and skipping all of the SCIs coming from the EC that do not produce
any genuine wakeup events after processing.
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=206629
Fixes: fdde0ff8590b ("ACPI: PM: s2idle: Prevent spurious SCIs from waking up the system")
Reported-by: Ondřej Caletka
Tested-by: Ondřej Caletka
Cc: 5.4+  # 5.4+
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit cd437419878e8d3f980afabdf7a015f2d0e1a172
Author: Rafael J. Wysocki
Date: Wed Mar 25 11:54:29 2020 +0100
ACPICA: Allow acpi\_any\_gpe\_status\_set() to skip one GPE
commit 0ce792d660bda990c675eaf14ce09594a9b85cbf upstream.
The check carried out by acpi\_any\_gpe\_status\_set() is not precise enough
for the suspend-to-idle implementation in Linux and in some cases it is
necessary make it skip one GPE (specifically, the EC GPE) from the check
to prevent a race condition leading to a premature system resume from
occurring.
For this reason, redefine acpi\_any\_gpe\_status\_set() to take the number
of a GPE to skip as an argument.
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=206629
Tested-by: Ondřej Caletka
Cc: 5.4+  # 5.4+
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 7226bbb2f40758d18a0b07262b77964c5d0b9358
Author: Jan Engelhardt
Date: Thu Mar 5 13:24:25 2020 +0100
acpi/x86: ignore unspecified bit positions in the ACPI global lock field
commit ecb9c790999fd6c5af0f44783bd0217f0b89ec2b upstream.
The value in "new" is constructed from "old" such that all bits defined
as reserved by the ACPI spec[1] are left untouched. But if those bits
do not happen to be all zero, "new < 3" will not evaluate to true.
The firmware of the laptop(s) Medion MD63490 / Akoya P15648 comes with
garbage inside the "FACS" ACPI table. The starting value is
old=0x4944454d, therefore new=0x4944454e, which is >= 3. Mask off
the reserved bits.
[1] https://uefi.org/sites/default/files/resources/ACPI\_6\_2.pdf
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=206553
Cc: All applicable
Signed-off-by: Jan Engelhardt
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 99ba1aea65e67f9e5f6f943145b9adf378060eda
Author: Rafael J. Wysocki
Date: Thu Feb 27 22:51:36 2020 +0100
ACPI: EC: Avoid printing confusing messages in acpi\_ec\_setup()
commit c823c17a8ea4db4943152388a0beb9a556715716 upstream.
It doesn't really make sense to pass ec->handle of the ECDT EC to
acpi\_handle\_info(), because it is set to ACPI\_ROOT\_OBJECT in
acpi\_ec\_ecdt\_probe(), so rework acpi\_ec\_setup() to avoid using
acpi\_handle\_info() for printing messages.
First, notice that the "Used as first EC" message is not really
useful, because it is immediately followed by a more meaningful one
from either acpi\_ec\_ecdt\_probe() or acpi\_ec\_dsdt\_probe() (the latter
also includes the EC object path), so drop it altogether.
Second, use pr\_info() for printing the EC configuration information.
While at it, make the code in question avoid printing invalid GPE or
IRQ numbers and make it print the GPE/IRQ information only when the
driver is ready to handle events.
Fixes: 72c77b7ea9ce ("ACPI / EC: Cleanup first\_ec/boot\_ec code")
Fixes: 406857f773b0 ("ACPI: EC: add support for hardware-reduced systems")
Cc: 5.5+  # 5.5+
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 6015bbcf850c2b67f0015915ce4d2842412091a4
Author: Sven Schnelle
Date: Tue Mar 10 13:33:32 2020 +0100
seccomp: Add missing compat\_ioctl for notify
commit 3db81afd99494a33f1c3839103f0429c8f30cb9d upstream.
Executing the seccomp\_bpf testsuite under a 64-bit kernel with 32-bit
userland (both s390 and x86) doesn't work because there's no compat\_ioctl
handler defined. Add the handler.
Signed-off-by: Sven Schnelle
Fixes: 6a21cc50f0c7 ("seccomp: add a return code to trap to userspace")
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20200310123332.42255-1-svens@linux.ibm.com
Signed-off-by: Kees Cook
Signed-off-by: Greg Kroah-Hartman
commit 8f1d061d754844b463cf592c982eee1ae674c2c1
Author: Benoit Parrot
Date: Fri Mar 6 14:08:39 2020 +0100
media: ti-vpe: cal: fix a kernel oops when unloading module
commit 80264809ea0a3fd2ee8251f31a9eb85d2c3fc77e upstream.
After the switch to use v4l2\_async\_notifier\_add\_subdev() and
v4l2\_async\_notifier\_cleanup(), unloading the ti\_cal module would cause a
kernel oops.
This was root cause to the fact that v4l2\_async\_notifier\_cleanup() tries
to kfree the asd pointer passed into v4l2\_async\_notifier\_add\_subdev().
In our case the asd reference was from a statically allocated struct.
So in effect v4l2\_async\_notifier\_cleanup() was trying to free a pointer
that was not kalloc.
So here we switch to using a kzalloc struct instead of a static one.
To achieve this we re-order some of the calls to prevent asd allocation
from leaking.
Fixes: d079f94c9046 ("media: platform: Switch to v4l2\_async\_notifier\_add\_subdev")
Cc: stable@vger.kernel.org
Signed-off-by: Benoit Parrot
Reviewed-by: Tomi Valkeinen
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit ec00e4a8d89f9c90137f06a5022379e4c2766333
Author: Benoit Parrot
Date: Mon Mar 2 14:56:52 2020 +0100
media: ti-vpe: cal: fix disable\_irqs to only the intended target
commit 1db56284b9da9056093681f28db48a09a243274b upstream.
disable\_irqs() was mistakenly disabling all interrupts when called.
This cause all port stream to stop even if only stopping one of them.
Cc: stable
Signed-off-by: Benoit Parrot
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit d2ae9461ec0683422f447810da56973d76dacf0a
Author: Andrzej Pietrasiewicz
Date: Mon Jan 27 15:30:06 2020 +0100
media: hantro: Read be32 words starting at every fourth byte
commit e34bca49e4953e5c2afc0425303199a5fd515f82 upstream.
Since (luma/chroma)\_qtable is an array of unsigned char, indexing it
returns consecutive byte locations, but we are supposed to read the arrays
in four-byte words. Consequently, we should be pointing
get\_unaligned\_be32() at consecutive word locations instead.
Signed-off-by: Andrzej Pietrasiewicz
Reviewed-by: Ezequiel Garcia
Tested-by: Ezequiel Garcia
Cc: stable@vger.kernel.org
Fixes: 00c30f42c7595f "media: rockchip vpu: remove some unused vars"
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 28a2f5c6283f86b2649a5c3db3b94373bc30d90d
Author: Stanimir Varbanov
Date: Wed Mar 4 11:09:49 2020 +0100
media: venus: firmware: Ignore secure call error on first resume
commit 2632e7b618a7730969f9782593c29ca53553aa22 upstream.
With the latest cleanup in qcom scm driver the secure monitor
call for setting the remote processor state returns EINVAL when
it is called for the first time and after another scm call
auth\_and\_reset. The error returned from scm call could be ignored
because the state transition is already done in auth\_and\_reset.
Acked-by: Bjorn Andersson
Signed-off-by: Stanimir Varbanov
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 03fa57dd4d94764e3ee384b65f33c1fe9bb57d01
Author: Stanimir Varbanov
Date: Thu Feb 13 10:55:14 2020 +0100
media: venus: cache vb payload to be used by clock scaling
commit fd1ee315dcd4a0f913a74939eb88f6d9b0bd9250 upstream.
Instead of iterate over previously queued buffers in clock
scaling code do cache the payload in instance context structure
for later use when calculating new clock rate.
This will avoid to use spin locks during buffer list iteration
in clock\_scaling.
This fixes following kernel Oops:
Unable to handle kernel paging request at virtual address deacfffffffffd6c
Mem abort info:
ESR = 0x96000004
EC = 0x25: DABT (current EL), IL = 32 bits
SET = 0, FnV = 0
EA = 0, S1PTW = 0
Data abort info:
ISV = 0, ISS = 0x00000004
CM = 0, WnR = 0
[deacfffffffffd6c] address between user and kernel address ranges
Internal error: Oops: 96000004 [#1] PREEMPT SMP
CPU: 7 PID: 5763 Comm: V4L2DecoderThre Tainted: G S W 5.4.11 #8
pstate: 20400009 (nzCv daif +PAN -UAO)
pc : load\_scale\_v4+0x4c/0x2bc [venus\_core]
lr : session\_process\_buf+0x18c/0x1c0 [venus\_core]
sp : ffffffc01376b8d0
x29: ffffffc01376b8d0 x28: ffffff80cf1b0220
x27: ffffffc01376bba0 x26: ffffffd8f562b2d8
x25: ffffff80cf1b0220 x24: 0000000000000005
x23: ffffffd8f5620d98 x22: ffffff80ca01c800
x21: ffffff80cf1b0000 x20: ffffff8149490080
x19: ffffff8174b2c010 x18: 0000000000000000
x17: 0000000000000000 x16: ffffffd96ee3a0dc
x15: 0000000000000026 x14: 0000000000000026
x13: 00000000000055ac x12: 0000000000000001
x11: deacfffffffffd6c x10: dead000000000100
x9 : ffffff80ca01cf28 x8 : 0000000000000026
x7 : 0000000000000000 x6 : ffffff80cdd899c0
x5 : ffffff80cdd899c0 x4 : 0000000000000008
x3 : ffffff80ca01cf28 x2 : ffffff80ca01cf28
x1 : ffffff80d47ffc00 x0 : ffffff80cf1b0000
Call trace:
load\_scale\_v4+0x4c/0x2bc [venus\_core]
session\_process\_buf+0x18c/0x1c0 [venus\_core]
venus\_helper\_vb2\_buf\_queue+0x7c/0xf0 [venus\_core]
\_\_enqueue\_in\_driver+0xe4/0xfc [videobuf2\_common]
vb2\_core\_qbuf+0x15c/0x338 [videobuf2\_common]
vb2\_qbuf+0x78/0xb8 [videobuf2\_v4l2]
v4l2\_m2m\_qbuf+0x80/0xf8 [v4l2\_mem2mem]
v4l2\_m2m\_ioctl\_qbuf+0x2c/0x38 [v4l2\_mem2mem]
v4l\_qbuf+0x48/0x58
\_\_video\_do\_ioctl+0x2b0/0x39c
video\_usercopy+0x394/0x710
video\_ioctl2+0x38/0x48
v4l2\_ioctl+0x6c/0x80
do\_video\_ioctl+0xb00/0x2874
v4l2\_compat\_ioctl32+0x5c/0xcc
\_\_se\_compat\_sys\_ioctl+0x100/0x2074
\_\_arm64\_compat\_sys\_ioctl+0x20/0x2c
el0\_svc\_common+0xa4/0x154
el0\_svc\_compat\_handler+0x2c/0x38
el0\_svc\_compat+0x8/0x10
Code: eb0a013f 54000200 aa1f03e8 d10e514b (b940016c)
---[ end trace e11304b46552e0b9 ]---
Fixes: c0e284ccfeda ("media: venus: Update clock scaling")
Cc: stable@vger.kernel.org # v5.5+
Signed-off-by: Stanimir Varbanov
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit b7f337eeb98103333d1d7a568d42bfa5e77fdc9c
Author: Takashi Iwai
Date: Wed Apr 8 15:56:45 2020 +0200
ALSA: hda/realtek - Add quirk for MSI GL63
commit 1d3aa4a5516d2e4933fe3cca11d3349ef63bc547 upstream.
MSI GL63 laptop requires the similar quirk like other MSI models,
ALC1220\_FIXUP\_CLEVO\_P950. The board BIOS doesn't provide a PCI SSID
for the device, hence we need to take the codec SSID (1462:1275)
instead.
BugLink: https://bugzilla.kernel.org/show\_bug.cgi?id=207157
Cc:
Link: https://lore.kernel.org/r/20200408135645.21896-1-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 95e175af21a19789bfe1d3ca7605f0327173ec01
Author: Hans de Goede
Date: Thu Apr 2 19:43:11 2020 +0200
ALSA: hda/realtek - Add quirk for Lenovo Carbon X1 8th gen
commit ca707b3f00b4f31a6e1eb37e8ae99f15f2bb1fe5 upstream.
The audio setup on the Lenovo Carbon X1 8th gen is the same as that on
the Lenovo Carbon X1 7th gen, as such it needs the same
ALC285\_FIXUP\_THINKPAD\_HEADSET\_JACK quirk.
This fixes volume control of the speaker not working among other things.
BugLink: https://bugzilla.redhat.com/show\_bug.cgi?id=1820196
Cc: stable@vger.kernel.org
Suggested-by: Jaroslav Kysela
Signed-off-by: Hans de Goede
Reviewed-by: Jaroslav Kysela
Link: https://lore.kernel.org/r/20200402174311.238614-1-hdegoede@redhat.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 19f3d7cc941aabdbfd8e12e2ae3cf480d66c9edb
Author: Thomas Hebb
Date: Mon Mar 30 12:09:39 2020 -0400
ALSA: hda/realtek - Remove now-unnecessary XPS 13 headphone noise fixups
commit f36938aa7440f46a0a365f1cfde5f5985af2bef3 upstream.
patch\_realtek.c has historically failed to properly configure the PC
Beep Hidden Register for the ALC256 codec (among others). Depending on
your kernel version, symptoms of this misconfiguration can range from
chassis noise, picked up by a poorly-shielded PCBEEP trace, getting
amplified and played on your internal speaker and/or headphones to loud
feedback, which responds to the "Headphone Mic Boost" ALSA control,
getting played through your headphones. For details of the problem, see
the patch in this series titled "ALSA: hda/realtek - Set principled PC
Beep configuration for ALC256", which fixes the configuration.
These symptoms have been most noticed on the Dell XPS 13 9350 and 9360,
popular laptops that use the ALC256. As a result, several model-specific
fixups have been introduced to try and fix the problem, the most
egregious of which locks the "Headphone Mic Boost" control as a hack to
minimize noise from a feedback loop that shouldn't have been there in
the first place.
Now that the underlying issue has been fixed, remove all these fixups.
Remaining fixups needed by the XPS 13 are all picked up by existing pin
quirks.
This change should, for the XPS 13 9350/9360
- Significantly increase volume and audio quality on headphones
- Eliminate headphone popping on suspend/resume
- Allow "Headphone Mic Boost" to be set again, making the headphone
jack fully usable as a microphone jack too.
Fixes: 8c69729b4439 ("ALSA: hda - Fix headphone noise after Dell XPS 13 resume back from S3")
Fixes: 423cd785619a ("ALSA: hda - Fix headphone noise on Dell XPS 13 9360")
Fixes: e4c9fd10eb21 ("ALSA: hda - Apply headphone noise quirk for another Dell XPS 13 variant")
Fixes: 1099f48457d0 ("ALSA: hda/realtek: Reduce the Headphone static noise on XPS 9350/9360")
Cc: stable@vger.kernel.org
Signed-off-by: Thomas Hebb
Link: https://lore.kernel.org/r/b649a00edfde150cf6eebbb4390e15e0c2deb39a.1585584498.git.tommyhebb@gmail.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 61789e712e6ba17fab99cfeebffb9885cc244963
Author: Thomas Hebb
Date: Mon Mar 30 12:09:38 2020 -0400
ALSA: hda/realtek - Set principled PC Beep configuration for ALC256
commit c44737449468a0bdc50e09ec75e530f208391561 upstream.
The Realtek PC Beep Hidden Register[1] is currently set by
patch\_realtek.c in two different places:
In alc\_fill\_eapd\_coef(), it's set to the value 0x5757, corresponding to
non-beep input on 1Ah and no 1Ah loopback to either headphones or
speakers. (Although, curiously, the loopback amp is still enabled.) This
write was added fairly recently by commit e3743f431143 ("ALSA:
hda/realtek - Dell headphone has noise on unmute for ALC236") and is a
safe default. However, it happens in the wrong place:
alc\_fill\_eapd\_coef() runs on module load and cold boot but not on S3
resume, meaning the register loses its value after suspend.
Conversely, in alc256\_init(), the register is updated to unset bit 13
(disable speaker loopback) and set bit 5 (set non-beep input on 1Ah).
Although this write does run on S3 resume, it's not quite enough to fix
up the register's default value of 0x3717. What's missing is a set of
bit 14 to disable headphone loopback. Without that, we end up with a
feedback loop where the headphone jack is being driven by amplified
samples of itself[2].
This change eliminates the update in alc256\_init() and replaces it with
the 0x5757 write from alc\_fill\_eapd\_coef(). Kailang says that 0x5757 is
supposed to be the codec's default value, so using it will make
debugging easier for Realtek.
Affects the ALC255, ALC256, ALC257, ALC235, and ALC236 codecs.
[1] Newly documented in Documentation/sound/hd-audio/realtek-pc-beep.rst
[2] Setting the "Headphone Mic Boost" control from userspace changes
this feedback loop and has been a widely-shared workaround for headphone
noise on laptops like the Dell XPS 13 9350. This commit eliminates the
feedback loop and makes the workaround unnecessary.
Fixes: e1e8c1fdce8b ("ALSA: hda/realtek - Dell headphone has noise on unmute for ALC236")
Cc: stable@vger.kernel.org
Signed-off-by: Thomas Hebb
Link: https://lore.kernel.org/r/bf22b417d1f2474b12011c2a39ed6cf8b06d3bf5.1585584498.git.tommyhebb@gmail.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit ca30f1bcf7749469c6b2f5b9125080463e198637
Author: Thomas Hebb
Date: Mon Mar 30 12:09:37 2020 -0400
ALSA: doc: Document PC Beep Hidden Register on Realtek ALC256
commit f128090491c3f5aacef91a863f8c52abf869c436 upstream.
This codec (among others) has a hidden set of audio routes, apparently
designed to allow PC Beep output without a mixer widget on the output
path, which are controlled by an undocumented Realtek vendor register.
The default configuration of these routes means that certain inputs
aren't accessible, necessitating driver control of the register.
However, Realtek has provided no documentation of the register, instead
opting to fix issues by providing magic numbers, most of which have been
at least somewhat erroneous. These magic numbers then get copied by
others into model-specific fixups, leading to a fragmented and buggy set
of configurations.
To get out of this situation, I've reverse engineered the register by
flipping bits and observing how the codec's behavior changes. This
commit documents my findings. It does not change any code.
Cc: stable@vger.kernel.org
Signed-off-by: Thomas Hebb
Link: https://lore.kernel.org/r/bd69dfdeaf40ff31c4b7b797c829bb320031739c.1585584498.git.tommyhebb@gmail.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 8abdf64702be863fec4f3af9339ef3ac13f81aeb
Author: Hui Wang
Date: Sun Mar 29 16:20:18 2020 +0800
ALSA: hda/realtek - a fake key event is triggered by running shutup
commit 476c02e0b4fd9071d158f6a1a1dfea1d36ee0ffd upstream.
On the Lenovo X1C7 machines, after we plug the headset, the rt\_resume()
and rt\_suspend() of the codec driver will be called periodically, the
driver can't stay in the rt\_suspend state even users doen't use the
sound card.
Through debugging, I found when running rt\_suspend(), it will call
alc225\_shutup(), in this function, it will change 3k pull down control
by alc\_update\_coef\_idx(codec, 0x4a, 0, 3 << 10), this will trigger a
fake key event and that event will resume the codec, when codec
suspend agin, it will trigger the fake key event one more time, this
process will repeat.
If disable the key event before changing the pull down control, it
will not trigger fake key event. It also needs to restore the pull
down control and re-enable the key event, otherwise the system can't
get key event when codec is in rt\_suspend state.
Also move some functions ahead of alc225\_shutup(), this can save the
function declaration.
Fixes: 76f7dec08fd6 (ALSA: hda/realtek - Add Headset Button supported for ThinkPad X1)
Cc: Kailang Yang
Cc:
Signed-off-by: Hui Wang
Link: https://lore.kernel.org/r/20200329082018.20486-1-hui.wang@canonical.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e423423475628b4ca5e6c5f35dee94281206d23f
Author: Kai-Heng Feng
Date: Fri Mar 27 12:46:25 2020 +0800
ALSA: hda/realtek: Enable mute LED on an HP system
commit f5a88b0accc24c4a9021247d7a3124f90aa4c586 upstream.
The system in question uses ALC285, and it uses GPIO 0x04 to control its
mute LED.
The mic mute LED can be controlled by GPIO 0x01, however the system uses
DMIC so we should use that to control mic mute LED.
Signed-off-by: Kai-Heng Feng
Cc:
Link: https://lore.kernel.org/r/20200327044626.29582-1-kai.heng.feng@canonical.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e582029ac25cb654e4e744f55226ff0d127f85e5
Author: Takashi Iwai
Date: Fri Apr 3 09:25:15 2020 +0200
ALSA: pcm: oss: Fix regression by buffer overflow fix
commit ae769d3556644888c964635179ef192995f40793 upstream.
The recent fix for the OOB access in PCM OSS plugins (commit
f2ecf903ef06: "ALSA: pcm: oss: Avoid plugin buffer overflow") caused a
regression on OSS applications. The patch introduced the size check
in client and slave size calculations to limit to each plugin's buffer
size, but I overlooked that some code paths call those without
allocating the buffer but just for estimation.
This patch fixes the bug by skipping the size check for those code
paths while keeping checking in the actual transfer calls.
Fixes: f2ecf903ef06 ("ALSA: pcm: oss: Avoid plugin buffer overflow")
Tested-and-reported-by: Jari Ruusu
Cc:
Link: https://lore.kernel.org/r/20200403072515.25539-1-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 8c53b65f8f251c1ac4adecabee51d874f5a0590d
Author: Takashi Iwai
Date: Tue Apr 7 10:44:02 2020 +0200
ALSA: ice1724: Fix invalid access for enumerated ctl items
commit c47914c00be346bc5b48c48de7b0da5c2d1a296c upstream.
The access to Analog Capture Source control value implemented in
prodigy\_hifi.c is wrong, as caught by the recently introduced sanity
check; it should be accessing value.enumerated.item[] instead of
value.integer.value[]. This patch corrects the wrong access pattern.
Fixes: 6b8d6e5518e2 ("[ALSA] ICE1724: Added support for Audiotrak Prodigy 7.1 HiFi & HD2, Hercules Fortissimo IV")
BugLink: https://bugzilla.kernel.org/show\_bug.cgi?id=207139
Reviewed-by: Jaroslav Kysela
Cc:
Link: https://lore.kernel.org/r/20200407084402.25589-3-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 9b63ea2157b6d741a917c5ebe664c9f243909add
Author: Takashi Iwai
Date: Tue Apr 7 10:44:01 2020 +0200
ALSA: hda: Fix potential access overflow in beep helper
commit 0ad3f0b384d58f3bd1f4fb87d0af5b8f6866f41a upstream.
The beep control helper function blindly stores the values in two
stereo channels no matter whether the actual control is mono or
stereo. This is practically harmless, but it annoys the recently
introduced sanity check, resulting in an error when the checker is
enabled.
This patch corrects the behavior to store only on the defined array
member.
Fixes: 0401e8548eac ("ALSA: hda - Move beep helper functions to hda\_beep.c")
BugLink: https://bugzilla.kernel.org/show\_bug.cgi?id=207139
Reviewed-by: Jaroslav Kysela
Cc:
Link: https://lore.kernel.org/r/20200407084402.25589-2-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 7f722d9aa00fde795834840cc84e13a94efb29ed
Author: Takashi Iwai
Date: Wed Apr 8 16:04:49 2020 +0200
ALSA: hda: Add driver blacklist
commit 3c6fd1f07ed03a04debbb9a9d782205f1ef5e2ab upstream.
The recent AMD platform exposes an HD-audio bus but without any actual
codecs, which is internally tied with a USB-audio device, supposedly.
It results in "no codecs" error of HD-audio bus driver, and it's
nothing but a waste of resources.
This patch introduces a static blacklist table for skipping such a
known bogus PCI SSID entry. As of writing this patch, the known SSIDs
are:
\* 1043:874f - ASUS ROG Zenith II / Strix
\* 1462:cb59 - MSI TRX40 Creator
\* 1462:cb60 - MSI TRX40
BugLink: https://bugzilla.kernel.org/show\_bug.cgi?id=206543
Cc:
Link: https://lore.kernel.org/r/20200408140449.22319-2-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit dd3f9044af86124c3141147d70e30d05a659f60d
Author: Takashi Iwai
Date: Wed Apr 8 16:04:48 2020 +0200
ALSA: usb-audio: Add mixer workaround for TRX40 and co
commit 2a48218f8e23d47bd3e23cfdfb8aa9066f7dc3e6 upstream.
Some recent boards (supposedly with a new AMD platform) contain the
USB audio class 2 device that is often tied with HD-audio. The device
exposes an Input Gain Pad control (id=19, control=12) but this node
doesn't behave correctly, returning an error for each inquiry of
GET\_MIN and GET\_MAX that should have been mandatory.
As a workaround, simply ignore this node by adding a usbmix\_name\_map
table entry. The currently known devices are:
\* 0414:a002 - Gigabyte TRX40 Aorus Pro WiFi
\* 0b05:1916 - ASUS ROG Zenith II
\* 0b05:1917 - ASUS ROG Strix
\* 0db0:0d64 - MSI TRX40 Creator
\* 0db0:543d - MSI TRX40
BugLink: https://bugzilla.kernel.org/show\_bug.cgi?id=206543
Cc:
Link: https://lore.kernel.org/r/20200408140449.22319-1-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e8f80e08e545d0713c6a1a01a2e0ce5be041d052
Author: Thinh Nguyen
Date: Mon Feb 3 18:05:32 2020 -0800
usb: gadget: composite: Inform controller driver of self-powered
commit 5e5caf4fa8d3039140b4548b6ab23dd17fce9b2c upstream.
Different configuration/condition may draw different power. Inform the
controller driver of the change so it can respond properly (e.g.
GET\_STATUS request). This fixes an issue with setting MaxPower from
configfs. The composite driver doesn't check this value when setting
self-powered.
Cc: stable@vger.kernel.org
Fixes: 88af8bbe4ef7 ("usb: gadget: the start of the configfs interface")
Signed-off-by: Thinh Nguyen
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 08aebe0723a4ed04379259c487068b46083a9c9d
Author: Sriharsha Allenki
Date: Thu Mar 26 17:26:20 2020 +0530
usb: gadget: f\_fs: Fix use after free issue as part of queue failure
commit f63ec55ff904b2f2e126884fcad93175f16ab4bb upstream.
In AIO case, the request is freed up if ep\_queue fails.
However, io\_data->req still has the reference to this freed
request. In the case of this failure if there is aio\_cancel
call on this io\_data it will lead to an invalid dequeue
operation and a potential use after free issue.
Fix this by setting the io\_data->req to NULL when the request
is freed as part of queue failure.
Fixes: 2e4c7553cd6f ("usb: gadget: f\_fs: add aio support")
Signed-off-by: Sriharsha Allenki
CC: stable
Reviewed-by: Peter Chen
Link: https://lore.kernel.org/r/20200326115620.12571-1-sallenki@codeaurora.org
Signed-off-by: Greg Kroah-Hartman
commit 2b8ff4ce5e590938c403d122c7cff4164e73f804
Author: 이경택
Date: Wed Apr 1 18:05:24 2020 +0900
ASoC: topology: use name\_prefix for new kcontrol
commit abca9e4a04fbe9c6df4d48ca7517e1611812af25 upstream.
Current topology doesn't add prefix of component to new kcontrol.
Signed-off-by: Gyeongtaek Lee
Link: https://lore.kernel.org/r/009b01d60804$ae25c2d0$0a714870$@samsung.com
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 8aebccb1fd9a22f68cdd8f70928379f8a58bb57e
Author: 이경택
Date: Wed Apr 1 10:04:21 2020 +0900
ASoC: dpcm: allow start or stop during pause for backend
commit 21fca8bdbb64df1297e8c65a746c4c9f4a689751 upstream.
soc\_compr\_trigger\_fe() allows start or stop after pause\_push.
In dpcm\_be\_dai\_trigger(), however, only pause\_release is allowed
command after pause\_push.
So, start or stop after pause in compress offload is always
returned as error if the compress offload is used with dpcm.
To fix the problem, SND\_SOC\_DPCM\_STATE\_PAUSED should be allowed
for start or stop command.
Signed-off-by: Gyeongtaek Lee
Reviewed-by: Vinod Koul
Link: https://lore.kernel.org/r/004d01d607c1$7a3d5250$6eb7f6f0$@samsung.com
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit e2c533467546d362ee1aca300b70bd0f9540679c
Author: 이경택
Date: Tue Mar 31 16:55:16 2020 +0900
ASoC: dapm: connect virtual mux with default value
commit 3bbbb7728fc853d71dbce4073fef9f281fbfb4dd upstream.
Since a virtual mixer has no backing registers
to decide which path to connect,
it will try to match with initial state.
This is to ensure that the default mixer choice will be
correctly powered up during initialization.
Invert flag is used to select initial state of the virtual switch.
Since actual hardware can't be disconnected by virtual switch,
connected is better choice as initial state in many cases.
Signed-off-by: Gyeongtaek Lee
Link: https://lore.kernel.org/r/01a301d60731$b724ea10$256ebe30$@samsung.com
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 72b0ac17952aba6971dc8c2cfba45d5c19202c70
Author: 이경택
Date: Mon Mar 30 16:35:59 2020 +0900
ASoC: fix regwmask
commit 0ab070917afdc93670c2d0ea02ab6defb6246a7c upstream.
If regwshift is 32 and the selected architecture compiles '<<' operator
for signed int literal into rotating shift, '1<
Link: https://lore.kernel.org/r/001001d60665$db7af3e0$9270dba0$@samsung.com
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit a53dcc9dd81e63a8f1703ec6c5399161352a1761
Author: Josef Bacik
Date: Fri Mar 13 17:17:08 2020 -0400
btrfs: track reloc roots based on their commit root bytenr
[ Upstream commit ea287ab157c2816bf12aad4cece41372f9d146b4 ]
We always search the commit root of the extent tree for looking up back
references, however we track the reloc roots based on their current
bytenr.
This is wrong, if we commit the transaction between relocating tree
blocks we could end up in this code in build\_backref\_tree
if (key.objectid == key.offset) {
/\*
\* Only root blocks of reloc trees use backref
\* pointing to itself.
\*/
root = find\_reloc\_root(rc, cur->bytenr);
ASSERT(root);
cur->root = root;
break;
}
find\_reloc\_root() is looking based on the bytenr we had in the commit
root, but if we've COWed this reloc root we will not find that bytenr,
and we will trip over the ASSERT(root).
Fix this by using the commit\_root->start bytenr for indexing the commit
root. Then we change the \_\_update\_reloc\_root() caller to be used when
we switch the commit root for the reloc root during commit.
This fixes the panic I was seeing when we started throttling relocation
for delayed refs.
Signed-off-by: Josef Bacik
Signed-off-by: David Sterba
Signed-off-by: Sasha Levin
commit e4f8a9fa7d60dca424873d1afe929990f2cd1bc2
Author: Josef Bacik
Date: Fri Mar 13 17:17:07 2020 -0400
btrfs: restart relocate\_tree\_blocks properly
[ Upstream commit 50dbbb71c79df89532ec41d118d59386e5a877e3 ]
There are two bugs here, but fixing them independently would just result
in pain if you happened to bisect between the two patches.
First is how we handle the -EAGAIN from relocate\_tree\_block(). We don't
set error, unless we happen to be the first node, which makes no sense,
I have no idea what the code was trying to accomplish here.
We in fact \_do\_ want err set here so that we know we need to restart in
relocate\_block\_group(). Also we need finish\_pending\_nodes() to not
actually call link\_to\_upper(), because we didn't actually relocate the
block.
And then if we do get -EAGAIN we do not want to set our backref cache
last\_trans to the one before ours. This would force us to update our
backref cache if we didn't cross transaction ids, which would mean we'd
have some nodes updated to their new\_bytenr, but still able to find
their old bytenr because we're searching the same commit root as the
last time we went through relocate\_tree\_blocks.
Fixing these two things keeps us from panicing when we start breaking
out of relocate\_tree\_blocks() either for delayed ref flushing or enospc.
Signed-off-by: Josef Bacik
Signed-off-by: David Sterba
Signed-off-by: Sasha Levin
commit 685ada9c3337ca1fcdbbdc8c349cfa6fd11cf9f2
Author: Josef Bacik
Date: Wed Mar 4 11:18:30 2020 -0500
btrfs: remove a BUG\_ON() from merge\_reloc\_roots()
[ Upstream commit 7b7b74315b24dc064bc1c683659061c3d48f8668 ]
This was pretty subtle, we default to reloc roots having 0 root refs, so
if we crash in the middle of the relocation they can just be deleted.
If we successfully complete the relocation operations we'll set our root
refs to 1 in prepare\_to\_merge() and then go on to merge\_reloc\_roots().
At prepare\_to\_merge() time if any of the reloc roots have a 0 reference
still, we will remove that reloc root from our reloc root rb tree, and
then clean it up later.
However this only happens if we successfully start a transaction. If
we've aborted previously we will skip this step completely, and only
have reloc roots with a reference count of 0, but were never properly
removed from the reloc control's rb tree.
This isn't a problem per-se, our references are held by the list the
reloc roots are on, and by the original root the reloc root belongs to.
If we end up in this situation all the reloc roots will be added to the
dirty\_reloc\_list, and then properly dropped at that point. The reloc
control will be free'd and the rb tree is no longer used.
There were two options when fixing this, one was to remove the BUG\_ON(),
the other was to make prepare\_to\_merge() handle the case where we
couldn't start a trans handle.
IMO this is the cleaner solution. I started with handling the error in
prepare\_to\_merge(), but it turned out super ugly. And in the end this
BUG\_ON() simply doesn't matter, the cleanup was happening properly, we
were just panicing because this BUG\_ON() only matters in the success
case. So I've opted to just remove it and add a comment where it was.
Reviewed-by: Qu Wenruo
Signed-off-by: Josef Bacik
Signed-off-by: David Sterba
Signed-off-by: Sasha Levin
commit 465d76bc554cfcd9ddd303f21bafac8e8d8aec9d
Author: Qu Wenruo
Date: Fri Feb 7 13:38:20 2020 +0800
btrfs: qgroup: ensure qgroup\_rescan\_running is only set when the worker is at least queued
[ Upstream commit d61acbbf54c612ea9bf67eed609494cda0857b3a ]
[BUG]
There are some reports about btrfs wait forever to unmount itself, with
the following call trace:
INFO: task umount:4631 blocked for more than 491 seconds.
Tainted: G X 5.3.8-2-default #1
"echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
umount D 0 4631 3337 0x00000000
Call Trace:
([<00000000174adf7a>] \_\_schedule+0x342/0x748)
[<00000000174ae3ca>] schedule+0x4a/0xd8
[<00000000174b1f08>] schedule\_timeout+0x218/0x420
[<00000000174af10c>] wait\_for\_common+0x104/0x1d8
[<000003ff804d6994>] btrfs\_qgroup\_wait\_for\_completion+0x84/0xb0 [btrfs]
[<000003ff8044a616>] close\_ctree+0x4e/0x380 [btrfs]
[<0000000016fa3136>] generic\_shutdown\_super+0x8e/0x158
[<0000000016fa34d6>] kill\_anon\_super+0x26/0x40
[<000003ff8041ba88>] btrfs\_kill\_super+0x28/0xc8 [btrfs]
[<0000000016fa39f8>] deactivate\_locked\_super+0x68/0x98
[<0000000016fcb198>] cleanup\_mnt+0xc0/0x140
[<0000000016d6a846>] task\_work\_run+0xc6/0x110
[<0000000016d04f76>] do\_notify\_resume+0xae/0xb8
[<00000000174b30ae>] system\_call+0xe2/0x2c8
[CAUSE]
The problem happens when we have called qgroup\_rescan\_init(), but
not queued the worker. It can be caused mostly by error handling.
Qgroup ioctl thread | Unmount thread
----------------------------------------+-----------------------------------
|
btrfs\_qgroup\_rescan() |
|- qgroup\_rescan\_init() |
| |- qgroup\_rescan\_running = true; |
| |
|- trans = btrfs\_join\_transaction() |
| Some error happened |
| |
|- btrfs\_qgroup\_rescan() returns error |
But qgroup\_rescan\_running == true; |
| close\_ctree()
| |- btrfs\_qgroup\_wait\_for\_completion()
| |- running == true;
| |- wait\_for\_completion();
btrfs\_qgroup\_rescan\_worker is never queued, thus no one is going to wake
up close\_ctree() and we get a deadlock.
All involved qgroup\_rescan\_init() callers are:
- btrfs\_qgroup\_rescan()
The example above. It's possible to trigger the deadlock when error
happened.
- btrfs\_quota\_enable()
Not possible. Just after qgroup\_rescan\_init() we queue the work.
- btrfs\_read\_qgroup\_config()
It's possible to trigger the deadlock. It only init the work, the
work queueing happens in btrfs\_qgroup\_rescan\_resume().
Thus if error happened in between, deadlock is possible.
We shouldn't set fs\_info->qgroup\_rescan\_running just in
qgroup\_rescan\_init(), as at that stage we haven't yet queued qgroup
rescan worker to run.
[FIX]
Set qgroup\_rescan\_running before queueing the work, so that we ensure
the rescan work is queued when we wait for it.
Fixes: 8d9eddad1946 ("Btrfs: fix qgroup rescan worker initialization")
Signed-off-by: Jeff Mahoney
[ Change subject and cause analyse, use a smaller fix ]
Signed-off-by: Qu Wenruo
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Sasha Levin
commit 0224307d9154db3c14d82a8d9d5aa18942a7eaf0
Author: Zhiqiang Liu
Date: Thu Mar 19 19:18:13 2020 +0800
block, bfq: fix use-after-free in bfq\_idle\_slice\_timer\_body
[ Upstream commit 2f95fa5c955d0a9987ffdc3a095e2f4e62c5f2a9 ]
In bfq\_idle\_slice\_timer func, bfqq = bfqd->in\_service\_queue is
not in bfqd-lock critical section. The bfqq, which is not
equal to NULL in bfq\_idle\_slice\_timer, may be freed after passing
to bfq\_idle\_slice\_timer\_body. So we will access the freed memory.
In addition, considering the bfqq may be in race, we should
firstly check whether bfqq is in service before doing something
on it in bfq\_idle\_slice\_timer\_body func. If the bfqq in race is
not in service, it means the bfqq has been expired through
\_\_bfq\_bfqq\_expire func, and wait\_request flags has been cleared in
\_\_bfq\_bfqd\_reset\_in\_service func. So we do not need to re-clear the
wait\_request of bfqq which is not in service.
KASAN log is given as follows:
[13058.354613] ==================================================================
[13058.354640] BUG: KASAN: use-after-free in bfq\_idle\_slice\_timer+0xac/0x290
[13058.354644] Read of size 8 at addr ffffa02cf3e63f78 by task fork13/19767
[13058.354646]
[13058.354655] CPU: 96 PID: 19767 Comm: fork13
[13058.354661] Call trace:
[13058.354667] dump\_backtrace+0x0/0x310
[13058.354672] show\_stack+0x28/0x38
[13058.354681] dump\_stack+0xd8/0x108
[13058.354687] print\_address\_description+0x68/0x2d0
[13058.354690] kasan\_report+0x124/0x2e0
[13058.354697] \_\_asan\_load8+0x88/0xb0
[13058.354702] bfq\_idle\_slice\_timer+0xac/0x290
[13058.354707] \_\_hrtimer\_run\_queues+0x298/0x8b8
[13058.354710] hrtimer\_interrupt+0x1b8/0x678
[13058.354716] arch\_timer\_handler\_phys+0x4c/0x78
[13058.354722] handle\_percpu\_devid\_irq+0xf0/0x558
[13058.354731] generic\_handle\_irq+0x50/0x70
[13058.354735] \_\_handle\_domain\_irq+0x94/0x110
[13058.354739] gic\_handle\_irq+0x8c/0x1b0
[13058.354742] el1\_irq+0xb8/0x140
[13058.354748] do\_wp\_page+0x260/0xe28
[13058.354752] \_\_handle\_mm\_fault+0x8ec/0x9b0
[13058.354756] handle\_mm\_fault+0x280/0x460
[13058.354762] do\_page\_fault+0x3ec/0x890
[13058.354765] do\_mem\_abort+0xc0/0x1b0
[13058.354768] el0\_da+0x24/0x28
[13058.354770]
[13058.354773] Allocated by task 19731:
[13058.354780] kasan\_kmalloc+0xe0/0x190
[13058.354784] kasan\_slab\_alloc+0x14/0x20
[13058.354788] kmem\_cache\_alloc\_node+0x130/0x440
[13058.354793] bfq\_get\_queue+0x138/0x858
[13058.354797] bfq\_get\_bfqq\_handle\_split+0xd4/0x328
[13058.354801] bfq\_init\_rq+0x1f4/0x1180
[13058.354806] bfq\_insert\_requests+0x264/0x1c98
[13058.354811] blk\_mq\_sched\_insert\_requests+0x1c4/0x488
[13058.354818] blk\_mq\_flush\_plug\_list+0x2d4/0x6e0
[13058.354826] blk\_flush\_plug\_list+0x230/0x548
[13058.354830] blk\_finish\_plug+0x60/0x80
[13058.354838] read\_pages+0xec/0x2c0
[13058.354842] \_\_do\_page\_cache\_readahead+0x374/0x438
[13058.354846] ondemand\_readahead+0x24c/0x6b0
[13058.354851] page\_cache\_sync\_readahead+0x17c/0x2f8
[13058.354858] generic\_file\_buffered\_read+0x588/0xc58
[13058.354862] generic\_file\_read\_iter+0x1b4/0x278
[13058.354965] ext4\_file\_read\_iter+0xa8/0x1d8 [ext4]
[13058.354972] \_\_vfs\_read+0x238/0x320
[13058.354976] vfs\_read+0xbc/0x1c0
[13058.354980] ksys\_read+0xdc/0x1b8
[13058.354984] \_\_arm64\_sys\_read+0x50/0x60
[13058.354990] el0\_svc\_common+0xb4/0x1d8
[13058.354994] el0\_svc\_handler+0x50/0xa8
[13058.354998] el0\_svc+0x8/0xc
[13058.354999]
[13058.355001] Freed by task 19731:
[13058.355007] \_\_kasan\_slab\_free+0x120/0x228
[13058.355010] kasan\_slab\_free+0x10/0x18
[13058.355014] kmem\_cache\_free+0x288/0x3f0
[13058.355018] bfq\_put\_queue+0x134/0x208
[13058.355022] bfq\_exit\_icq\_bfqq+0x164/0x348
[13058.355026] bfq\_exit\_icq+0x28/0x40
[13058.355030] ioc\_exit\_icq+0xa0/0x150
[13058.355035] put\_io\_context\_active+0x250/0x438
[13058.355038] exit\_io\_context+0xd0/0x138
[13058.355045] do\_exit+0x734/0xc58
[13058.355050] do\_group\_exit+0x78/0x220
[13058.355054] \_\_wake\_up\_parent+0x0/0x50
[13058.355058] el0\_svc\_common+0xb4/0x1d8
[13058.355062] el0\_svc\_handler+0x50/0xa8
[13058.355066] el0\_svc+0x8/0xc
[13058.355067]
[13058.355071] The buggy address belongs to the object at ffffa02cf3e63e70#012 which belongs to the cache bfq\_queue of size 464
[13058.355075] The buggy address is located 264 bytes inside of#012 464-byte region [ffffa02cf3e63e70, ffffa02cf3e64040)
[13058.355077] The buggy address belongs to the page:
[13058.355083] page:ffff7e80b3cf9800 count:1 mapcount:0 mapping:ffff802db5c90780 index:0xffffa02cf3e606f0 compound\_mapcount: 0
[13058.366175] flags: 0x2ffffe0000008100(slab|head)
[13058.370781] raw: 2ffffe0000008100 ffff7e80b53b1408 ffffa02d730c1c90 ffff802db5c90780
[13058.370787] raw: ffffa02cf3e606f0 0000000000370023 00000001ffffffff 0000000000000000
[13058.370789] page dumped because: kasan: bad access detected
[13058.370791]
[13058.370792] Memory state around the buggy address:
[13058.370797] ffffa02cf3e63e00: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fb fb
[13058.370801] ffffa02cf3e63e80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[13058.370805] >ffffa02cf3e63f00: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[13058.370808] ^
[13058.370811] ffffa02cf3e63f80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[13058.370815] ffffa02cf3e64000: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
[13058.370817] ==================================================================
[13058.370820] Disabling lock debugging due to kernel taint
Here, we directly pass the bfqd to bfq\_idle\_slice\_timer\_body func.
--
V2->V3: rewrite the comment as suggested by Paolo Valente
V1->V2: add one comment, and add Fixes and Reported-by tag.
Fixes: aee69d78d ("block, bfq: introduce the BFQ-v0 I/O scheduler as an extra scheduler")
Acked-by: Paolo Valente
Reported-by: Wang Wang
Signed-off-by: Zhiqiang Liu
Signed-off-by: Feilong Lin
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 190b42d6a1ba950ee3b46fff5e764fbf77310fe6
Author: Sergio Paracuellos
Date: Fri Mar 20 16:38:37 2020 +0100
staging: mt7621-pci: avoid to poweroff the phy for slot one
[ Upstream commit 5737cfe87a9c242ad0f60b34b5ac1688770a9236 ]
Phy for slot 0 and 1 is shared and handled properly in slot 0.
If there is only one port in use,(slot 0) we shall not call the
'phy\_power\_off' function with an invalid slot because kernel
will crash with an unaligned access fault like the following:
mt7621-pci 1e140000.pcie: Error applying setting, reverse things back
mt7621-pci-phy 1e149000.pcie-phy: PHY for 0xbe149000 (dual port = 1)
mt7621-pci-phy 1e14a000.pcie-phy: PHY for 0xbe14a000 (dual port = 0)
mt7621-pci-phy 1e149000.pcie-phy: Xtal is 40MHz
mt7621-pci-phy 1e14a000.pcie-phy: Xtal is 40MHz
mt7621-pci 1e140000.pcie: pcie1 no card, disable it (RST & CLK)
Unhandled kernel unaligned access[#1]:
CPU: 3 PID: 111 Comm: kworker/3:2 Not tainted 5.6.0-rc3-00347-g825c6f470c62-dirty #9
Workqueue: events deferred\_probe\_work\_func
$ 0 : 00000000 00000001 5f60d043 8fe1ba80
$ 4 : 0000010d 01eb9000 00000000 00000000
$ 8 : 294b4c00 80940000 00000008 000000ce
$12 : 2e303030 00000000 00000000 65696370
$16 : ffffffed 0000010d 8e373cd0 8214c1e0
$20 : 00000000 82144c80 82144680 8214c250
$24 : 00000018 803ef8f4
$28 : 8e372000 8e373c60 8214c080 803940e8
Hi : 00000125
Lo : 122f2000
epc : 807b3328 mutex\_lock+0x8/0x44
ra : 803940e8 phy\_power\_off+0x28/0xb0
Status: 1100fc03 KERNEL EXL IE
Cause : 00800010 (ExcCode 04)
BadVA : 0000010d
PrId : 0001992f (MIPS 1004Kc)
Modules linked in:
Process kworker/3:2 (pid: 111, threadinfo=(ptrval), task=(ptrval), tls=00000000)
Stack : 8e373cd0 803fe4f4 8e372000 8e373c90 8214c080 804fde1c 8e373c98 808d62f4
8e373c78 00000000 8214c254 804fe648 1e160000 804f27b8 00000001 808d62f4
00000000 00000001 8214c228 808d62f4 80930000 809a0000 8fd47e10 808d63d4
808d62d4 8fd47e10 808d0000 808d0000 8e373cd0 8e373cd0 809e2a74 809db510
809db510 00000006 00000001 00000000 00000000 00000000 01000000 1e1440ff
...
Call Trace:
[<807b3328>] mutex\_lock+0x8/0x44
[<803940e8>] phy\_power\_off+0x28/0xb0
[<804fe648>] mt7621\_pci\_probe+0xc20/0xd18
[<80402ab8>] platform\_drv\_probe+0x40/0x94
[<80400a74>] really\_probe+0x104/0x364
[<803feb74>] bus\_for\_each\_drv+0x84/0xdc
[<80400924>] \_\_device\_attach+0xdc/0x120
[<803ffb5c>] bus\_probe\_device+0xa0/0xbc
[<80400124>] deferred\_probe\_work\_func+0x7c/0xbc
[<800420e8>] process\_one\_work+0x230/0x450
[<80042638>] worker\_thread+0x330/0x5fc
[<80048eb0>] kthread+0x12c/0x134
[<80007438>] ret\_from\_kernel\_thread+0x14/0x1c
Code: 24050002 27bdfff8 8f830000  14a00005 00000000 00600825 e0810000 1020fffa
Fixes: bf516f413f4e ("staging: mt7621-pci: use only two phys from device tree")
Signed-off-by: Sergio Paracuellos
Link: https://lore.kernel.org/r/20200320153837.20415-1-sergio.paracuellos@gmail.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 2222dd46f2954435cfe05e41d35bbda52f942359
Author: Boqun Feng
Date: Thu Mar 12 23:12:55 2020 +0800
locking/lockdep: Avoid recursion in lockdep\_count\_{for,back}ward\_deps()
[ Upstream commit 25016bd7f4caf5fc983bbab7403d08e64cba3004 ]
Qian Cai reported a bug when PROVE\_RCU\_LIST=y, and read on /proc/lockdep
triggered a warning:
[ ] DEBUG\_LOCKS\_WARN\_ON(current->hardirqs\_enabled)
...
[ ] Call Trace:
[ ] lock\_is\_held\_type+0x5d/0x150
[ ] ? rcu\_lockdep\_current\_cpu\_online+0x64/0x80
[ ] rcu\_read\_lock\_any\_held+0xac/0x100
[ ] ? rcu\_read\_lock\_held+0xc0/0xc0
[ ] ? \_\_slab\_free+0x421/0x540
[ ] ? kasan\_kmalloc+0x9/0x10
[ ] ? \_\_kmalloc\_node+0x1d7/0x320
[ ] ? kvmalloc\_node+0x6f/0x80
[ ] \_\_bfs+0x28a/0x3c0
[ ] ? class\_equal+0x30/0x30
[ ] lockdep\_count\_forward\_deps+0x11a/0x1a0
The warning got triggered because lockdep\_count\_forward\_deps() call
\_\_bfs() without current->lockdep\_recursion being set, as a result
a lockdep internal function (\_\_bfs()) is checked by lockdep, which is
unexpected, and the inconsistency between the irq-off state and the
state traced by lockdep caused the warning.
Apart from this warning, lockdep internal functions like \_\_bfs() should
always be protected by current->lockdep\_recursion to avoid potential
deadlocks and data inconsistency, therefore add the
current->lockdep\_recursion on-and-off section to protect \_\_bfs() in both
lockdep\_count\_forward\_deps() and lockdep\_count\_backward\_deps()
Reported-by: Qian Cai
Signed-off-by: Boqun Feng
Signed-off-by: Peter Zijlstra (Intel)
Link: https://lkml.kernel.org/r/20200312151258.128036-1-boqun.feng@gmail.com
Signed-off-by: Sasha Levin
commit d60f7842d749b121c74da5bd2f132ed2081fa4b3
Author: Vladimir Oltean
Date: Wed Mar 18 02:15:57 2020 +0200
spi: spi-fsl-dspi: Replace interruptible wait queue with a simple completion
[ Upstream commit 4f5ee75ea1718a09149460b3df993f389a67b56a ]
Currently the driver puts the process in interruptible sleep waiting for
the interrupt train to finish transfer to/from the tx\_buf and rx\_buf.
But exiting the process with ctrl-c may make the kernel panic: the
wait\_event\_interruptible call will return -ERESTARTSYS, which a proper
driver implementation is perhaps supposed to handle, but nonetheless
this one doesn't, and aborts the transfer altogether.
Actually when the task is interrupted, there is still a high chance that
the dspi\_interrupt is still triggering. And if dspi\_transfer\_one\_message
returns execution all the way to the spi\_device driver, that can free
the spi\_message and spi\_transfer structures, leaving the interrupts to
access a freed tx\_buf and rx\_buf.
hexdump -C /dev/mtd0
00000000 00 75 68 75 0a ff ff ff ff ff ff ff ff ff ff ff
|.uhu............|
00000010 ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff
|................|
\*
^C[ 38.495955] fsl-dspi 2120000.spi: Waiting for transfer to complete failed!
[ 38.503097] spi\_master spi2: failed to transfer one message from queue
[ 38.509729] Unable to handle kernel paging request at virtual address ffff800095ab3377
[ 38.517676] Mem abort info:
[ 38.520474] ESR = 0x96000045
[ 38.523533] EC = 0x25: DABT (current EL), IL = 32 bits
[ 38.528861] SET = 0, FnV = 0
[ 38.531921] EA = 0, S1PTW = 0
[ 38.535067] Data abort info:
[ 38.537952] ISV = 0, ISS = 0x00000045
[ 38.541797] CM = 0, WnR = 1
[ 38.544771] swapper pgtable: 4k pages, 48-bit VAs, pgdp=0000000082621000
[ 38.551494] [ffff800095ab3377] pgd=00000020fffff003, p4d=00000020fffff003, pud=0000000000000000
[ 38.560229] Internal error: Oops: 96000045 [#1] PREEMPT SMP
[ 38.565819] Modules linked in:
[ 38.568882] CPU: 0 PID: 2729 Comm: hexdump Not tainted 5.6.0-rc4-next-20200306-00052-gd8730cdc8a0b-dirty #193
[ 38.578834] Hardware name: Kontron SMARC-sAL28 (Single PHY) on SMARC Eval 2.0 carrier (DT)
[ 38.587129] pstate: 20000085 (nzCv daIf -PAN -UAO)
[ 38.591941] pc : ktime\_get\_real\_ts64+0x3c/0x110
[ 38.596487] lr : spi\_take\_timestamp\_pre+0x40/0x90
[ 38.601203] sp : ffff800010003d90
[ 38.604525] x29: ffff800010003d90 x28: ffff80001200e000
[ 38.609854] x27: ffff800011da9000 x26: ffff002079c40400
[ 38.615184] x25: ffff8000117fe018 x24: ffff800011daa1a0
[ 38.620513] x23: ffff800015ab3860 x22: ffff800095ab3377
[ 38.625841] x21: 000000000000146e x20: ffff8000120c3000
[ 38.631170] x19: ffff0020795f6e80 x18: ffff800011da9948
[ 38.636498] x17: 0000000000000000 x16: 0000000000000000
[ 38.641826] x15: ffff800095ab3377 x14: 0720072007200720
[ 38.647155] x13: 0720072007200765 x12: 0775076507750771
[ 38.652483] x11: 0720076d076f0772 x10: 0000000000000040
[ 38.657812] x9 : ffff8000108e2100 x8 : ffff800011dcabe8
[ 38.663139] x7 : 0000000000000000 x6 : ffff800015ab3a60
[ 38.668468] x5 : 0000000007200720 x4 : ffff800095ab3377
[ 38.673796] x3 : 0000000000000000 x2 : 0000000000000ab0
[ 38.679125] x1 : ffff800011daa000 x0 : 0000000000000026
[ 38.684454] Call trace:
[ 38.686905] ktime\_get\_real\_ts64+0x3c/0x110
[ 38.691100] spi\_take\_timestamp\_pre+0x40/0x90
[ 38.695470] dspi\_fifo\_write+0x58/0x2c0
[ 38.699315] dspi\_interrupt+0xbc/0xd0
[ 38.702987] \_\_handle\_irq\_event\_percpu+0x78/0x2c0
[ 38.707706] handle\_irq\_event\_percpu+0x3c/0x90
[ 38.712161] handle\_irq\_event+0x4c/0xd0
[ 38.716008] handle\_fasteoi\_irq+0xbc/0x170
[ 38.720115] generic\_handle\_irq+0x2c/0x40
[ 38.724135] \_\_handle\_domain\_irq+0x68/0xc0
[ 38.728243] gic\_handle\_irq+0xc8/0x160
[ 38.732000] el1\_irq+0xb8/0x180
[ 38.735149] spi\_nor\_spimem\_read\_data+0xe0/0x140
[ 38.739779] spi\_nor\_read+0xc4/0x120
[ 38.743364] mtd\_read\_oob+0xa8/0xc0
[ 38.746860] mtd\_read+0x4c/0x80
[ 38.750007] mtdchar\_read+0x108/0x2a0
[ 38.753679] \_\_vfs\_read+0x20/0x50
[ 38.757002] vfs\_read+0xa4/0x190
[ 38.760237] ksys\_read+0x6c/0xf0
[ 38.763471] \_\_arm64\_sys\_read+0x20/0x30
[ 38.767319] el0\_svc\_common.constprop.3+0x90/0x160
[ 38.772125] do\_el0\_svc+0x28/0x90
[ 38.775449] el0\_sync\_handler+0x118/0x190
[ 38.779468] el0\_sync+0x140/0x180
[ 38.782793] Code: 91000294 1400000f d50339bf f9405e80 (f90002c0)
[ 38.788910] ---[ end trace 55da560db4d6bef7 ]---
[ 38.793540] Kernel panic - not syncing: Fatal exception in interrupt
[ 38.799914] SMP: stopping secondary CPUs
[ 38.803849] Kernel Offset: disabled
[ 38.807344] CPU features: 0x10002,20006008
[ 38.811451] Memory Limit: none
[ 38.814513] ---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---
So it is clear that the "interruptible" part isn't handled correctly.
When the process receives a signal, one could either attempt a clean
abort (which appears to be difficult with this hardware) or just keep
restarting the sleep until the wait queue really completes. But checking
in a loop for -ERESTARTSYS is a bit too complicated for this driver, so
just make the sleep uninterruptible, to avoid all that nonsense.
The wait queue was actually restructured as a completion, after polling
other drivers for the most "popular" approach.
Fixes: 349ad66c0ab0 ("spi:Add Freescale DSPI driver for Vybrid VF610 platform")
Reported-by: Michael Walle
Signed-off-by: Vladimir Oltean
Tested-by: Michael Walle
Link: https://lore.kernel.org/r/20200318001603.9650-7-olteanv@gmail.com
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
commit 4fe972b9747c264f9c2f526841fdc0e1c70f491b
Author: Junyong Sun
Date: Tue Mar 3 10:36:08 2020 +0800
firmware: fix a double abort case with fw\_load\_sysfs\_fallback
[ Upstream commit bcfbd3523f3c6eea51a74d217a8ebc5463bcb7f4 ]
fw\_sysfs\_wait\_timeout may return err with -ENOENT
at fw\_load\_sysfs\_fallback and firmware is already
in abort status, no need to abort again, so skip it.
This issue is caused by concurrent situation like below:
when thread 1# wait firmware loading, thread 2# may write
-1 to abort loading and wakeup thread 1# before it timeout.
so wait\_for\_completion\_killable\_timeout of thread 1# would
return remaining time which is != 0 with fw\_st->status
FW\_STATUS\_ABORTED.And the results would be converted into
err -ENOENT in \_\_fw\_state\_wait\_common and transfered to
fw\_load\_sysfs\_fallback in thread 1#.
The -ENOENT means firmware status is already at ABORTED,
so fw\_load\_sysfs\_fallback no need to get mutex to abort again.
-----------------------------
thread 1#,wait for loading
fw\_load\_sysfs\_fallback
->fw\_sysfs\_wait\_timeout
->\_\_fw\_state\_wait\_common
->wait\_for\_completion\_killable\_timeout
in \_\_fw\_state\_wait\_common,
...
93 ret = wait\_for\_completion\_killable\_timeout(&fw\_st->completion, timeout);
94 if (ret != 0 && fw\_st->status == FW\_STATUS\_ABORTED)
95 return -ENOENT;
96 if (!ret)
97 return -ETIMEDOUT;
98
99 return ret < 0 ? ret : 0;
-----------------------------
thread 2#, write -1 to abort loading
firmware\_loading\_store
->fw\_load\_abort
->\_\_fw\_load\_abort
->fw\_state\_aborted
->\_\_fw\_state\_set
->complete\_all
in \_\_fw\_state\_set,
...
111 if (status == FW\_STATUS\_DONE || status == FW\_STATUS\_ABORTED)
112 complete\_all(&fw\_st->completion);
-------------------------------------------
BTW,the double abort issue would not cause kernel panic or create an issue,
but slow down it sometimes.The change is just a minor optimization.
Signed-off-by: Junyong Sun
Acked-by: Luis Chamberlain
Link: https://lore.kernel.org/r/1583202968-28792-1-git-send-email-sunjunyong@xiaomi.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 3ba42886fa35c0c50629a63380a18cc77b143209
Author: Guoqing Jiang
Date: Tue Feb 11 11:10:04 2020 +0100
md: check arrays is suspended in mddev\_detach before call quiesce operations
[ Upstream commit 6b40bec3b13278d21fa6c1ae7a0bdf2e550eed5f ]
Don't call quiesce(1) and quiesce(0) if array is already suspended,
otherwise in level\_store, the array is writable after mddev\_detach
in below part though the intention is to make array writable after
resume.
mddev\_suspend(mddev);
mddev\_detach(mddev);
...
mddev\_resume(mddev);
And it also causes calltrace as follows in [1].
[48005.653834] WARNING: CPU: 1 PID: 45380 at kernel/kthread.c:510 kthread\_park+0x77/0x90
[...]
[48005.653976] CPU: 1 PID: 45380 Comm: mdadm Tainted: G OE 5.4.10-arch1-1 #1
[48005.653979] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./J4105-ITX, BIOS P1.40 08/06/2018
[48005.653984] RIP: 0010:kthread\_park+0x77/0x90
[48005.654015] Call Trace:
[48005.654039] r5l\_quiesce+0x3c/0x70 [raid456]
[48005.654052] raid5\_quiesce+0x228/0x2e0 [raid456]
[48005.654073] mddev\_detach+0x30/0x70 [md\_mod]
[48005.654090] level\_store+0x202/0x670 [md\_mod]
[48005.654099] ? security\_capable+0x40/0x60
[48005.654114] md\_attr\_store+0x7b/0xc0 [md\_mod]
[48005.654123] kernfs\_fop\_write+0xce/0x1b0
[48005.654132] vfs\_write+0xb6/0x1a0
[48005.654138] ksys\_write+0x67/0xe0
[48005.654146] do\_syscall\_64+0x4e/0x140
[48005.654155] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
[48005.654161] RIP: 0033:0x7fa0c8737497
[1]: https://bugzilla.kernel.org/show\_bug.cgi?id=206161
Signed-off-by: Guoqing Jiang
Signed-off-by: Song Liu
Signed-off-by: Sasha Levin
commit 424f1e45ab16802d7aa8f9bd1fa540de0c020617
Author: Marc Zyngier
Date: Tue Mar 10 18:49:21 2020 +0000
irqchip/gic-v4: Provide irq\_retrigger to avoid circular locking dependency
[ Upstream commit 7809f7011c3bce650e502a98afeb05961470d865 ]
On a very heavily loaded D05 with GICv4, I managed to trigger the
following lockdep splat:
[ 6022.598864] ======================================================
[ 6022.605031] WARNING: possible circular locking dependency detected
[ 6022.611200] 5.6.0-rc4-00026-geee7c7b0f498 #680 Tainted: G E
[ 6022.618061] ------------------------------------------------------
[ 6022.624227] qemu-system-aar/7569 is trying to acquire lock:
[ 6022.629789] ffff042f97606808 (&p->pi\_lock){-.-.}, at: try\_to\_wake\_up+0x54/0x7a0
[ 6022.637102]
[ 6022.637102] but task is already holding lock:
[ 6022.642921] ffff002fae424cf0 (&irq\_desc\_lock\_class){-.-.}, at: \_\_irq\_get\_desc\_lock+0x5c/0x98
[ 6022.651350]
[ 6022.651350] which lock already depends on the new lock.
[ 6022.651350]
[ 6022.659512]
[ 6022.659512] the existing dependency chain (in reverse order) is:
[ 6022.666980]
[ 6022.666980] -> #2 (&irq\_desc\_lock\_class){-.-.}:
[ 6022.672983] \_raw\_spin\_lock\_irqsave+0x50/0x78
[ 6022.677848] \_\_irq\_get\_desc\_lock+0x5c/0x98
[ 6022.682453] irq\_set\_vcpu\_affinity+0x40/0xc0
[ 6022.687236] its\_make\_vpe\_non\_resident+0x6c/0xb8
[ 6022.692364] vgic\_v4\_put+0x54/0x70
[ 6022.696273] vgic\_v3\_put+0x20/0xd8
[ 6022.700183] kvm\_vgic\_put+0x30/0x48
[ 6022.704182] kvm\_arch\_vcpu\_put+0x34/0x50
[ 6022.708614] kvm\_sched\_out+0x34/0x50
[ 6022.712700] \_\_schedule+0x4bc/0x7f8
[ 6022.716697] schedule+0x50/0xd8
[ 6022.720347] kvm\_arch\_vcpu\_ioctl\_run+0x5f0/0x978
[ 6022.725473] kvm\_vcpu\_ioctl+0x3d4/0x8f8
[ 6022.729820] ksys\_ioctl+0x90/0xd0
[ 6022.733642] \_\_arm64\_sys\_ioctl+0x24/0x30
[ 6022.738074] el0\_svc\_common.constprop.3+0xa8/0x1e8
[ 6022.743373] do\_el0\_svc+0x28/0x88
[ 6022.747198] el0\_svc+0x14/0x40
[ 6022.750761] el0\_sync\_handler+0x124/0x2b8
[ 6022.755278] el0\_sync+0x140/0x180
[ 6022.759100]
[ 6022.759100] -> #1 (&rq->lock){-.-.}:
[ 6022.764143] \_raw\_spin\_lock+0x38/0x50
[ 6022.768314] task\_fork\_fair+0x40/0x128
[ 6022.772572] sched\_fork+0xe0/0x210
[ 6022.776484] copy\_process+0x8c4/0x18d8
[ 6022.780742] \_do\_fork+0x88/0x6d8
[ 6022.784478] kernel\_thread+0x64/0x88
[ 6022.788563] rest\_init+0x30/0x270
[ 6022.792390] arch\_call\_rest\_init+0x14/0x1c
[ 6022.796995] start\_kernel+0x498/0x4c4
[ 6022.801164]
[ 6022.801164] -> #0 (&p->pi\_lock){-.-.}:
[ 6022.806382] \_\_lock\_acquire+0xdd8/0x15c8
[ 6022.810813] lock\_acquire+0xd0/0x218
[ 6022.814896] \_raw\_spin\_lock\_irqsave+0x50/0x78
[ 6022.819761] try\_to\_wake\_up+0x54/0x7a0
[ 6022.824018] wake\_up\_process+0x1c/0x28
[ 6022.828276] wakeup\_softirqd+0x38/0x40
[ 6022.832533] \_\_tasklet\_schedule\_common+0xc4/0xf0
[ 6022.837658] \_\_tasklet\_schedule+0x24/0x30
[ 6022.842176] check\_irq\_resend+0xc8/0x158
[ 6022.846609] irq\_startup+0x74/0x128
[ 6022.850606] \_\_enable\_irq+0x6c/0x78
[ 6022.854602] enable\_irq+0x54/0xa0
[ 6022.858431] its\_make\_vpe\_non\_resident+0xa4/0xb8
[ 6022.863557] vgic\_v4\_put+0x54/0x70
[ 6022.867469] kvm\_arch\_vcpu\_blocking+0x28/0x38
[ 6022.872336] kvm\_vcpu\_block+0x48/0x490
[ 6022.876594] kvm\_handle\_wfx+0x18c/0x310
[ 6022.880938] handle\_exit+0x138/0x198
[ 6022.885022] kvm\_arch\_vcpu\_ioctl\_run+0x4d4/0x978
[ 6022.890148] kvm\_vcpu\_ioctl+0x3d4/0x8f8
[ 6022.894494] ksys\_ioctl+0x90/0xd0
[ 6022.898317] \_\_arm64\_sys\_ioctl+0x24/0x30
[ 6022.902748] el0\_svc\_common.constprop.3+0xa8/0x1e8
[ 6022.908046] do\_el0\_svc+0x28/0x88
[ 6022.911871] el0\_svc+0x14/0x40
[ 6022.915434] el0\_sync\_handler+0x124/0x2b8
[ 6022.919951] el0\_sync+0x140/0x180
[ 6022.923773]
[ 6022.923773] other info that might help us debug this:
[ 6022.923773]
[ 6022.931762] Chain exists of:
[ 6022.931762] &p->pi\_lock --> &rq->lock --> &irq\_desc\_lock\_class
[ 6022.931762]
[ 6022.942101] Possible unsafe locking scenario:
[ 6022.942101]
[ 6022.948007] CPU0 CPU1
[ 6022.952523] ---- ----
[ 6022.957039] lock(&irq\_desc\_lock\_class);
[ 6022.961036] lock(&rq->lock);
[ 6022.966595] lock(&irq\_desc\_lock\_class);
[ 6022.973109] lock(&p->pi\_lock);
[ 6022.976324]
[ 6022.976324] \*\*\* DEADLOCK \*\*\*
This is happening because we have a pending doorbell that requires
retrigger. As SW retriggering is done in a tasklet, we trigger the
circular dependency above.
The easy cop-out is to provide a retrigger callback that doesn't
require acquiring any extra lock.
Signed-off-by: Marc Zyngier
Link: https://lore.kernel.org/r/20200310184921.23552-5-maz@kernel.org
Signed-off-by: Sasha Levin
commit 399cf29ee6d495acc22c5027529f2e53d3a829e8
Author: Neil Armstrong
Date: Fri Feb 21 10:15:31 2020 +0100
usb: dwc3: core: add support for disabling SS instances in park mode
[ Upstream commit 7ba6b09fda5e0cb741ee56f3264665e0edc64822 ]
In certain circumstances, the XHCI SuperSpeed instance in park mode
can fail to recover, thus on Amlogic G12A/G12B/SM1 SoCs when there is high
load on the single XHCI SuperSpeed instance, the controller can crash like:
xhci-hcd xhci-hcd.0.auto: xHCI host not responding to stop endpoint command.
xhci-hcd xhci-hcd.0.auto: Host halt failed, -110
xhci-hcd xhci-hcd.0.auto: xHCI host controller not responding, assume dead
xhci-hcd xhci-hcd.0.auto: xHCI host not responding to stop endpoint command.
hub 2-1.1:1.0: hub\_ext\_port\_status failed (err = -22)
xhci-hcd xhci-hcd.0.auto: HC died; cleaning up
usb 2-1.1-port1: cannot reset (err = -22)
Setting the PARKMODE\_DISABLE\_SS bit in the DWC3\_USB3\_GUCTL1 mitigates
the issue. The bit is described as :
"When this bit is set to '1' all SS bus instances in park mode are disabled"
Synopsys explains:
The GUCTL1.PARKMODE\_DISABLE\_SS is only available in
dwc\_usb3 controller running in host mode.
This should not be set for other IPs.
This can be disabled by default based on IP, but I recommend to have a
property to enable this feature for devices that need this.
CC: Dongjin Kim
Cc: Jianxin Pan
Cc: Thinh Nguyen
Cc: Jun Li
Reported-by: Tim
Signed-off-by: Neil Armstrong
Signed-off-by: Felipe Balbi
Signed-off-by: Sasha Levin
commit b7faadf5b351cc3d739da54060f40de85a7140c9
Author: Dongchun Zhu
Date: Wed Mar 11 11:47:28 2020 +0100
media: i2c: ov5695: Fix power on and off sequences
[ Upstream commit f1a64f56663e9d03e509439016dcbddd0166b2da ]
From the measured hardware signal, OV5695 reset pin goes high for a
short period of time during boot-up. From the sensor specification, the
reset pin is active low and the DT binding defines the pin as active
low, which means that the values set by the driver are inverted and thus
the value requested in probe ends up high.
Fix it by changing probe to request the reset GPIO initialized to high,
which makes the initial state of the physical signal low.
In addition, DOVDD rising must occur before DVDD rising from spec., but
regulator\_bulk\_enable() API enables all the regulators asynchronously.
Use an explicit loops of regulator\_enable() instead.
For power off sequence, it is required that DVDD falls first. Given the
bulk API does not give any guarantee about the order of regulators,
change the driver to use regulator\_disable() instead.
The sensor also requires a delay between reset high and first I2C
transaction, which was assumed to be 8192 XVCLK cycles, but 1ms is
recommended by the vendor. Fix this as well.
Signed-off-by: Dongchun Zhu
Signed-off-by: Tomasz Figa
Signed-off-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit ff930e534339b80fb8d096f96b0c69f2f2ec8192
Author: Hsin-Yi Wang
Date: Wed Mar 4 03:58:51 2020 +0100
media: mtk-vpu: avoid unaligned access to DTCM buffer.
[ Upstream commit e6599adfad30c340d06574e49a86afa7015c5c60 ]
Previously, vpu->recv\_buf and send\_buf are forced cast from
void \_\_iomem \*tcm. vpu->recv\_buf->share\_buf is passed to
vpu\_ipi\_desc.handler(). It's not able to do unaligned access. Otherwise
kernel would crash due to unable to handle kernel paging request.
struct vpu\_run {
u32 signaled;
char fw\_ver[VPU\_FW\_VER\_LEN];
unsigned int dec\_capability;
unsigned int enc\_capability;
wait\_queue\_head\_t wq;
};
fw\_ver starts at 4 byte boundary. If system enables
CONFIG\_HAVE\_EFFICIENT\_UNALIGNED\_ACCESS, strscpy() will do
read\_word\_at\_a\_time(), which tries to read 8-byte: \*(unsigned long \*)addr
vpu\_init\_ipi\_handler() calls strscpy(), which would lead to crash.
vpu\_init\_ipi\_handler() and several other handlers (eg.
vpu\_dec\_ipi\_handler) only do read access to this data, so they can be
const, and we can use memcpy\_fromio() to copy the buf to another non iomem
buffer then pass to handler.
Fixes: 85709cbf1524 ("media: replace strncpy() by strscpy()")
Signed-off-by: Hsin-Yi Wang
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 162eae93e9ffe9413b58ace37b37cb73fa3e439f
Author: Alexey Dobriyan
Date: Wed Feb 12 20:40:27 2020 +0300
block, zoned: fix integer overflow with BLKRESETZONE et al
[ Upstream commit 11bde986002c0af67eb92d73321d06baefae7128 ]
Check for overflow in addition before checking for end-of-block-device.
Steps to reproduce:
#define \_GNU\_SOURCE 1
#include
#include
#include
#include
typedef unsigned long long \_\_u64;
struct blk\_zone\_range {
\_\_u64 sector;
\_\_u64 nr\_sectors;
};
#define BLKRESETZONE \_IOW(0x12, 131, struct blk\_zone\_range)
int main(void)
{
int fd = open("/dev/nullb0", O\_RDWR|O\_DIRECT);
struct blk\_zone\_range zr = {4096, 0xfffffffffffff000ULL};
ioctl(fd, BLKRESETZONE, &zr);
return 0;
}
BUG: KASAN: null-ptr-deref in submit\_bio\_wait+0x74/0xe0
Write of size 8 at addr 0000000000000040 by task a.out/1590
CPU: 8 PID: 1590 Comm: a.out Not tainted 5.6.0-rc1-00019-g359c92c02bfa #2
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS ?-20190711\_202441-buildvm-armv7-10.arm.fedoraproject.org-2.fc31 04/01/2014
Call Trace:
dump\_stack+0x76/0xa0
\_\_kasan\_report.cold+0x5/0x3e
kasan\_report+0xe/0x20
submit\_bio\_wait+0x74/0xe0
blkdev\_zone\_mgmt+0x26f/0x2a0
blkdev\_zone\_mgmt\_ioctl+0x14b/0x1b0
blkdev\_ioctl+0xb28/0xe60
block\_ioctl+0x69/0x80
ksys\_ioctl+0x3af/0xa50
Reviewed-by: Christoph Hellwig
Signed-off-by: Alexey Dobriyan (SK hynix)
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit f6570a599ba5ede786a5bcf98aa61c7c39e291db
Author: Sahitya Tummala
Date: Wed Mar 11 16:07:50 2020 +0530
block: Fix use-after-free issue accessing struct io\_cq
[ Upstream commit 30a2da7b7e225ef6c87a660419ea04d3cef3f6a7 ]
There is a potential race between ioc\_release\_fn() and
ioc\_clear\_queue() as shown below, due to which below kernel
crash is observed. It also can result into use-after-free
issue.
context#1: context#2:
ioc\_release\_fn() \_\_ioc\_clear\_queue() gets the same icq
->spin\_lock(&ioc->lock); ->spin\_lock(&ioc->lock);
->ioc\_destroy\_icq(icq);
->list\_del\_init(&icq->q\_node);
->call\_rcu(&icq->\_\_rcu\_head,
icq\_free\_icq\_rcu);
->spin\_unlock(&ioc->lock);
->ioc\_destroy\_icq(icq);
->hlist\_del\_init(&icq->ioc\_node);
This results into below crash as this memory
is now used by icq->\_\_rcu\_head in context#1.
There is a chance that icq could be free'd
as well.
22150.386550: <6> Unable to handle kernel write to read-only memory
at virtual address ffffffaa8d31ca50
...
Call trace:
22150.607350: <2> ioc\_destroy\_icq+0x44/0x110
22150.611202: <2> ioc\_clear\_queue+0xac/0x148
22150.615056: <2> blk\_cleanup\_queue+0x11c/0x1a0
22150.619174: <2> \_\_scsi\_remove\_device+0xdc/0x128
22150.623465: <2> scsi\_forget\_host+0x2c/0x78
22150.627315: <2> scsi\_remove\_host+0x7c/0x2a0
22150.631257: <2> usb\_stor\_disconnect+0x74/0xc8
22150.635371: <2> usb\_unbind\_interface+0xc8/0x278
22150.639665: <2> device\_release\_driver\_internal+0x198/0x250
22150.644897: <2> device\_release\_driver+0x24/0x30
22150.649176: <2> bus\_remove\_device+0xec/0x140
22150.653204: <2> device\_del+0x270/0x460
22150.656712: <2> usb\_disable\_device+0x120/0x390
22150.660918: <2> usb\_disconnect+0xf4/0x2e0
22150.664684: <2> hub\_event+0xd70/0x17e8
22150.668197: <2> process\_one\_work+0x210/0x480
22150.672222: <2> worker\_thread+0x32c/0x4c8
Fix this by adding a new ICQ\_DESTROYED flag in ioc\_destroy\_icq() to
indicate this icq is once marked as destroyed. Also, ensure
\_\_ioc\_clear\_queue() is accessing icq within rcu\_read\_lock/unlock so
that icq doesn't get free'd up while it is still using it.
Signed-off-by: Sahitya Tummala
Co-developed-by: Pradeep P V K
Signed-off-by: Pradeep P V K
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 2a9118bf03a0da2b9aeff8e06997ccdad984d74c
Author: Alexander Sverdlin
Date: Fri Mar 6 18:47:20 2020 +0100
genirq/irqdomain: Check pointer in irq\_domain\_alloc\_irqs\_hierarchy()
[ Upstream commit 87f2d1c662fa1761359fdf558246f97e484d177a ]
irq\_domain\_alloc\_irqs\_hierarchy() has 3 call sites in the compilation unit
but only one of them checks for the pointer which is being dereferenced
inside the called function. Move the check into the function. This allows
for catching the error instead of the following crash:
Unable to handle kernel NULL pointer dereference at virtual address 00000000
PC is at 0x0
LR is at gpiochip\_hierarchy\_irq\_domain\_alloc+0x11f/0x140
...
[] (gpiochip\_hierarchy\_irq\_domain\_alloc)
[] (\_\_irq\_domain\_alloc\_irqs)
[] (irq\_create\_fwspec\_mapping)
[] (gpiochip\_to\_irq)
[] (gpiod\_to\_irq)
[] (gpio\_irqs\_init [gpio\_irqs])
[] (gpio\_irqs\_exit+0xecc/0xe84 [gpio\_irqs])
Code: bad PC value
Signed-off-by: Alexander Sverdlin
Signed-off-by: Thomas Gleixner
Link: https://lkml.kernel.org/r/20200306174720.82604-1-alexander.sverdlin@nokia.com
Signed-off-by: Sasha Levin
commit 4eff1e8913867cd4d5f34357d97697d6db4a6f8a
Author: Ard Biesheuvel
Date: Sun Mar 8 09:08:51 2020 +0100
efi/x86: Ignore the memory attributes table on i386
[ Upstream commit dd09fad9d2caad2325a39b766ce9e79cfc690184 ]
Commit:
3a6b6c6fb23667fa ("efi: Make EFI\_MEMORY\_ATTRIBUTES\_TABLE initialization common across all architectures")
moved the call to efi\_memattr\_init() from ARM specific to the generic
EFI init code, in order to be able to apply the restricted permissions
described in that table on x86 as well.
We never enabled this feature fully on i386, and so mapping and
reserving this table is pointless. However, due to the early call to
memblock\_reserve(), the memory bookkeeping gets confused to the point
where it produces the splat below when we try to map the memory later
on:
------------[ cut here ]------------
ioremap on RAM at 0x3f251000 - 0x3fa1afff
WARNING: CPU: 0 PID: 0 at arch/x86/mm/ioremap.c:166 \_\_ioremap\_caller ...
Modules linked in:
CPU: 0 PID: 0 Comm: swapper/0 Not tainted 4.20.0 #48
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 0.0.0 02/06/2015
EIP: \_\_ioremap\_caller.constprop.0+0x249/0x260
Code: 90 0f b7 05 4e 38 40 de 09 45 e0 e9 09 ff ff ff 90 8d 45 ec c6 05 ...
EAX: 00000029 EBX: 00000000 ECX: de59c228 EDX: 00000001
ESI: 3f250fff EDI: 00000000 EBP: de3edf20 ESP: de3edee0
DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068 EFLAGS: 00200296
CR0: 80050033 CR2: ffd17000 CR3: 1e58c000 CR4: 00040690
Call Trace:
ioremap\_cache+0xd/0x10
? old\_map\_region+0x72/0x9d
old\_map\_region+0x72/0x9d
efi\_map\_region+0x8/0xa
efi\_enter\_virtual\_mode+0x260/0x43b
start\_kernel+0x329/0x3aa
i386\_start\_kernel+0xa7/0xab
startup\_32\_smp+0x164/0x168
---[ end trace e15ccf6b9f356833 ]---
Let's work around this by disregarding the memory attributes table
altogether on i386, which does not result in a loss of functionality
or protection, given that we never consumed the contents.
Fixes: 3a6b6c6fb23667fa ("efi: Make EFI\_MEMORY\_ATTRIBUTES\_TABLE ... ")
Tested-by: Arvind Sankar
Signed-off-by: Ard Biesheuvel
Signed-off-by: Ingo Molnar
Link: https://lore.kernel.org/r/20200304165917.5893-1-ardb@kernel.org
Link: https://lore.kernel.org/r/20200308080859.21568-21-ardb@kernel.org
Signed-off-by: Sasha Levin
commit df6e74b6e3f63472fd6a5ecc85215851d8b1c7b0
Author: Arvind Sankar
Date: Sun Mar 8 09:08:44 2020 +0100
x86/boot: Use unsigned comparison for addresses
[ Upstream commit 81a34892c2c7c809f9c4e22c5ac936ae673fb9a2 ]
The load address is compared with LOAD\_PHYSICAL\_ADDR using a signed
comparison currently (using jge instruction).
When loading a 64-bit kernel using the new efi32\_pe\_entry() point added by:
97aa276579b2 ("efi/x86: Add true mixed mode entry point into .compat section")
using Qemu with -m 3072, the firmware actually loads us above 2Gb,
resulting in a very early crash.
Use the JAE instruction to perform a unsigned comparison instead, as physical
addresses should be considered unsigned.
Signed-off-by: Arvind Sankar
Signed-off-by: Ard Biesheuvel
Signed-off-by: Ingo Molnar
Link: https://lore.kernel.org/r/20200301230436.2246909-6-nivedita@alum.mit.edu
Link: https://lore.kernel.org/r/20200308080859.21568-14-ardb@kernel.org
Signed-off-by: Sasha Levin
commit aebfcccd331c39678fc5470e9bff56da5d7c4805
Author: Peng Fan
Date: Tue Mar 3 10:14:49 2020 +0800
cpufreq: imx6q: fix error handling
[ Upstream commit 3646f50a3838c5949a89ecbdb868497cdc05b8fd ]
When speed checking failed, direclty jumping to put\_node label
is not correct. Need jump to out\_free\_opp to avoid resources leak.
Fixes: 2733fb0d0699 ("cpufreq: imx6q: read OCOTP through nvmem for imx6ul/imx6ull")
Signed-off-by: Peng Fan
Signed-off-by: Viresh Kumar
Signed-off-by: Sasha Levin
commit 5659fc2f2099900e33c9a2b8ca6e40034db90127
Author: Bob Peterson
Date: Wed Nov 13 14:08:45 2019 -0600
gfs2: Don't demote a glock until its revokes are written
[ Upstream commit df5db5f9ee112e76b5202fbc331f990a0fc316d6 ]
Before this patch, run\_queue would demote glocks based on whether
there are any more holders. But if the glock has pending revokes that
haven't been written to the media, giving up the glock might end in
file system corruption if the revokes never get written due to
io errors, node crashes and fences, etc. In that case, another node
will replay the metadata blocks associated with the glock, but
because the revoke was never written, it could replay that block
even though the glock had since been granted to another node who
might have made changes.
This patch changes the logic in run\_queue so that it never demotes
a glock until its count of pending revokes reaches zero.
Signed-off-by: Bob Peterson
Reviewed-by: Andreas Gruenbacher
Signed-off-by: Sasha Levin
commit b802b4f366297a7576f72bae3faf91040a99a820
Author: Bob Peterson
Date: Wed Nov 13 13:47:02 2019 -0600
gfs2: Do log\_flush in gfs2\_ail\_empty\_gl even if ail list is empty
[ Upstream commit 9ff78289356af640941bbb0dd3f46af2063f0046 ]
Before this patch, if gfs2\_ail\_empty\_gl saw there was nothing on
the ail list, it would return and not flush the log. The problem
is that there could still be a revoke for the rgrp sitting on the
sd\_log\_le\_revoke list that's been recently taken off the ail list.
But that revoke still needs to be written, and the rgrp\_go\_inval
still needs to call log\_flush\_wait to ensure the revokes are all
properly written to the journal before we relinquish control of
the glock to another node. If we give the glock to another node
before we have this knowledge, the node might crash and its journal
replayed, in which case the missing revoke would allow the journal
replay to replay the rgrp over top of the rgrp we already gave to
another node, thus overwriting its changes and corrupting the
file system.
This patch makes gfs2\_ail\_empty\_gl still call gfs2\_log\_flush rather
than returning.
Signed-off-by: Bob Peterson
Reviewed-by: Andreas Gruenbacher
Signed-off-by: Sasha Levin
commit 72306f78fb54a61cc89a571f8899c1a58546a95e
Author: chenqiwu
Date: Fri Feb 7 17:46:39 2020 +0800
pstore/platform: fix potential mem leak if pstore\_init\_fs failed
[ Upstream commit 8a57d6d4ddfa41c49014e20493152c41a38fcbf8 ]
There is a potential mem leak when pstore\_init\_fs failed,
since the pstore compression maybe unlikey to initialized
successfully. We must clean up the allocation once this
unlikey issue happens.
Signed-off-by: chenqiwu
Link: https://lore.kernel.org/r/1581068800-13817-1-git-send-email-qiwuchen55@gmail.com
Signed-off-by: Kees Cook
Signed-off-by: Sasha Levin
commit 950105d1778aacacd61cc3b1bd41ea1ccd964a16
Author: John Garry
Date: Fri Feb 28 19:33:35 2020 +0800
libata: Remove extra scsi\_host\_put() in ata\_scsi\_add\_hosts()
[ Upstream commit 1d72f7aec3595249dbb83291ccac041a2d676c57 ]
If the call to scsi\_add\_host\_with\_dma() in ata\_scsi\_add\_hosts() fails,
then we may get use-after-free KASAN warns:
==================================================================
BUG: KASAN: use-after-free in kobject\_put+0x24/0x180
Read of size 1 at addr ffff0026b8c80364 by task swapper/0/1
CPU: 1 PID: 1 Comm: swapper/0 Tainted: G W 5.6.0-rc3-00004-g5a71b206ea82-dirty #1765
Hardware name: Huawei TaiShan 200 (Model 2280)/BC82AMDD, BIOS 2280-V2 CS V3.B160.01 02/24/2020
Call trace:
dump\_backtrace+0x0/0x298
show\_stack+0x14/0x20
dump\_stack+0x118/0x190
print\_address\_description.isra.9+0x6c/0x3b8
\_\_kasan\_report+0x134/0x23c
kasan\_report+0xc/0x18
\_\_asan\_load1+0x5c/0x68
kobject\_put+0x24/0x180
put\_device+0x10/0x20
scsi\_host\_put+0x10/0x18
ata\_devres\_release+0x74/0xb0
release\_nodes+0x2d0/0x470
devres\_release\_all+0x50/0x78
really\_probe+0x2d4/0x560
driver\_probe\_device+0x7c/0x148
device\_driver\_attach+0x94/0xa0
\_\_driver\_attach+0xa8/0x110
bus\_for\_each\_dev+0xe8/0x158
driver\_attach+0x30/0x40
bus\_add\_driver+0x220/0x2e0
driver\_register+0xbc/0x1d0
\_\_pci\_register\_driver+0xbc/0xd0
ahci\_pci\_driver\_init+0x20/0x28
do\_one\_initcall+0xf0/0x608
kernel\_init\_freeable+0x31c/0x384
kernel\_init+0x10/0x118
ret\_from\_fork+0x10/0x18
Allocated by task 5:
save\_stack+0x28/0xc8
\_\_kasan\_kmalloc.isra.8+0xbc/0xd8
kasan\_kmalloc+0xc/0x18
\_\_kmalloc+0x1a8/0x280
scsi\_host\_alloc+0x44/0x678
ata\_scsi\_add\_hosts+0x74/0x268
ata\_host\_register+0x228/0x488
ahci\_host\_activate+0x1c4/0x2a8
ahci\_init\_one+0xd18/0x1298
local\_pci\_probe+0x74/0xf0
work\_for\_cpu\_fn+0x2c/0x48
process\_one\_work+0x488/0xc08
worker\_thread+0x330/0x5d0
kthread+0x1c8/0x1d0
ret\_from\_fork+0x10/0x18
Freed by task 5:
save\_stack+0x28/0xc8
\_\_kasan\_slab\_free+0x118/0x180
kasan\_slab\_free+0x10/0x18
slab\_free\_freelist\_hook+0xa4/0x1a0
kfree+0xd4/0x3a0
scsi\_host\_dev\_release+0x100/0x148
device\_release+0x7c/0xe0
kobject\_put+0xb0/0x180
put\_device+0x10/0x20
scsi\_host\_put+0x10/0x18
ata\_scsi\_add\_hosts+0x210/0x268
ata\_host\_register+0x228/0x488
ahci\_host\_activate+0x1c4/0x2a8
ahci\_init\_one+0xd18/0x1298
local\_pci\_probe+0x74/0xf0
work\_for\_cpu\_fn+0x2c/0x48
process\_one\_work+0x488/0xc08
worker\_thread+0x330/0x5d0
kthread+0x1c8/0x1d0
ret\_from\_fork+0x10/0x18
There is also refcount issue, as well:
WARNING: CPU: 1 PID: 1 at lib/refcount.c:28 refcount\_warn\_saturate+0xf8/0x170
The issue is that we make an erroneous extra call to scsi\_host\_put()
for that host:
So in ahci\_init\_one()->ata\_host\_alloc\_pinfo()->ata\_host\_alloc(), we setup
a device release method - ata\_devres\_release() - which intends to release
the SCSI hosts:
static void ata\_devres\_release(struct device \*gendev, void \*res)
{
...
for (i = 0; i < host->n\_ports; i++) {
struct ata\_port \*ap = host->ports[i];
if (!ap)
continue;
if (ap->scsi\_host)
scsi\_host\_put(ap->scsi\_host);
}
...
}
However in the ata\_scsi\_add\_hosts() error path, we also call
scsi\_host\_put() for the SCSI hosts.
Fix by removing the the scsi\_host\_put() calls in ata\_scsi\_add\_hosts() and
leave this to ata\_devres\_release().
Fixes: f31871951b38 ("libata: separate out ata\_host\_alloc() and ata\_host\_register()")
Signed-off-by: John Garry
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit b73e58ebb8992167d92452d21ef4322789e973bf
Author: Matt Ranostay
Date: Tue Mar 24 02:07:41 2020 +0100
media: i2c: video-i2c: fix build errors due to 'imply hwmon'
[ Upstream commit 64d4fc9926f09861a35d8f0f7d81f056e6d5af7b ]
Fix build fault when CONFIG\_HWMON is a module, and CONFIG\_VIDEO\_I2C
as builtin. This is due to 'imply hwmon' in the respective Kconfig.
Issue build log:
ld: drivers/media/i2c/video-i2c.o: in function `amg88xx\_hwmon\_init':
video-i2c.c:(.text+0x2e1): undefined reference to `devm\_hwmon\_device\_register\_with\_info
Cc: rdunlap@infradead.org
Fixes: acbea6798955 (media: video-i2c: add hwmon support for amg88xx)
Signed-off-by: Matt Ranostay
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit d5fde715fc34503615924e28e384a84376a84320
Author: Paolo Valente
Date: Sat Mar 21 10:45:18 2020 +0100
block, bfq: move forward the getting of an extra ref in bfq\_bfqq\_move
[ Upstream commit fd1bb3ae54a9a2e0c42709de861c69aa146b8955 ]
Commit ecedd3d7e199 ("block, bfq: get extra ref to prevent a queue
from being freed during a group move") gets an extra reference to a
bfq\_queue before possibly deactivating it (temporarily), in
bfq\_bfqq\_move(). This prevents the bfq\_queue from disappearing before
being reactivated in its new group.
Yet, the bfq\_queue may also be expired (i.e., its service may be
stopped) before the bfq\_queue is deactivated. And also an expiration
may lead to a premature freeing. This commit fixes this issue by
simply moving forward the getting of the extra reference already
introduced by commit ecedd3d7e199 ("block, bfq: get extra ref to
prevent a queue from being freed during a group move").
Reported-by: cki-project@redhat.com
Tested-by: cki-project@redhat.com
Signed-off-by: Paolo Valente
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 7673c99bdbb5b2b23285e54f0b287db07248a06f
Author: Logan Gunthorpe
Date: Sat Mar 21 12:25:45 2020 +0100
PCI/switchtec: Fix init\_completion race condition with poll\_wait()
[ Upstream commit efbdc769601f4d50018bf7ca50fc9f7c67392ece ]
The call to init\_completion() in mrpc\_queue\_cmd() can theoretically
race with the call to poll\_wait() in switchtec\_dev\_poll().
poll() write()
switchtec\_dev\_poll() switchtec\_dev\_write()
poll\_wait(&s->comp.wait); mrpc\_queue\_cmd()
init\_completion(&s->comp)
init\_waitqueue\_head(&s->comp.wait)
To my knowledge, no one has hit this bug.
Fix this by using reinit\_completion() instead of init\_completion() in
mrpc\_queue\_cmd().
Fixes: 080b47def5e5 ("MicroSemi Switchtec management interface driver")
Reported-by: Sebastian Andrzej Siewior
Signed-off-by: Logan Gunthorpe
Signed-off-by: Thomas Gleixner
Signed-off-by: Peter Zijlstra (Intel)
Acked-by: Bjorn Helgaas
Link: https://lkml.kernel.org/r/20200313183608.2646-1-logang@deltatee.com
Signed-off-by: Sasha Levin
commit d0b3d7dd06561625d32e9ccfb59279f7c110f500
Author: Andy Lutomirski
Date: Thu Mar 12 15:35:51 2020 -0700
selftests/x86/ptrace\_syscall\_32: Fix no-vDSO segfault
[ Upstream commit 630b99ab60aa972052a4202a1ff96c7e45eb0054 ]
If AT\_SYSINFO is not present, don't try to call a NULL pointer.
Reported-by: kbuild test robot
Signed-off-by: Andy Lutomirski
Signed-off-by: Borislav Petkov
Link: https://lkml.kernel.org/r/faaf688265a7e1a5b944d6f8bc0f6368158306d3.1584052409.git.luto@kernel.org
Signed-off-by: Sasha Levin
commit 16ecd11d503d51cda4e8d4583542da6ee3ede9f7
Author: Tao Zhou
Date: Thu Mar 19 11:39:20 2020 +0800
sched/fair: Fix condition of avg\_load calculation
[ Upstream commit 6c8116c914b65be5e4d6f66d69c8142eb0648c22 ]
In update\_sg\_wakeup\_stats(), the comment says:
Computing avg\_load makes sense only when group is fully
busy or overloaded.
But, the code below this comment does not check like this.
From reading the code about avg\_load in other functions, I
confirm that avg\_load should be calculated in fully busy or
overloaded case. The comment is correct and the checking
condition is wrong. So, change that condition.
Fixes: 57abff067a08 ("sched/fair: Rework find\_idlest\_group()")
Signed-off-by: Tao Zhou
Signed-off-by: Peter Zijlstra (Intel)
Reviewed-by: Vincent Guittot
Acked-by: Mel Gorman
Link: https://lkml.kernel.org/r/Message-ID:
Signed-off-by: Sasha Levin
commit 0cd828462d79d18609ff8017cf042f3feb7616a0
Author: Michael Wang
Date: Wed Mar 18 10:15:15 2020 +0800
sched: Avoid scale real weight down to zero
[ Upstream commit 26cf52229efc87e2effa9d788f9b33c40fb3358a ]
During our testing, we found a case that shares no longer
working correctly, the cgroup topology is like:
/sys/fs/cgroup/cpu/A (shares=102400)
/sys/fs/cgroup/cpu/A/B (shares=2)
/sys/fs/cgroup/cpu/A/B/C (shares=1024)
/sys/fs/cgroup/cpu/D (shares=1024)
/sys/fs/cgroup/cpu/D/E (shares=1024)
/sys/fs/cgroup/cpu/D/E/F (shares=1024)
The same benchmark is running in group C & F, no other tasks are
running, the benchmark is capable to consumed all the CPUs.
We suppose the group C will win more CPU resources since it could
enjoy all the shares of group A, but it's F who wins much more.
The reason is because we have group B with shares as 2, since
A->cfs\_rq.load.weight == B->se.load.weight == B->shares/nr\_cpus,
so A->cfs\_rq.load.weight become very small.
And in calc\_group\_shares() we calculate shares as:
load = max(scale\_load\_down(cfs\_rq->load.weight), cfs\_rq->avg.load\_avg);
shares = (tg\_shares \* load) / tg\_weight;
Since the 'cfs\_rq->load.weight' is too small, the load become 0
after scale down, although 'tg\_shares' is 102400, shares of the se
which stand for group A on root cfs\_rq become 2.
While the se of D on root cfs\_rq is far more bigger than 2, so it
wins the battle.
Thus when scale\_load\_down() scale real weight down to 0, it's no
longer telling the real story, the caller will have the wrong
information and the calculation will be buggy.
This patch add check in scale\_load\_down(), so the real weight will
be >= MIN\_SHARES after scale, after applied the group C wins as
expected.
Suggested-by: Peter Zijlstra
Signed-off-by: Michael Wang
Signed-off-by: Peter Zijlstra (Intel)
Reviewed-by: Vincent Guittot
Link: https://lkml.kernel.org/r/38e8e212-59a1-64b2-b247-b6d0b52d8dc1@linux.alibaba.com
Signed-off-by: Sasha Levin
commit 1bba493b74fa76be7eb6a1604c20982f99720daf
Author: Michael Tretter
Date: Mon Mar 16 16:26:23 2020 +0100
media: allegro: fix type of gop\_length in channel\_create message
[ Upstream commit 8277815349327b8e65226eb58ddb680f90c2c0c0 ]
The gop\_length field is actually only u16 and there are two more u8
fields in the message:
- the number of consecutive b-frames
- frequency of golden frames
Fix the message and thus fix the configuration of the GOP length.
Signed-off-by: Michael Tretter
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 6c9fae879dc18fc455faa288ec6bfe5918b65323
Author: Marc Zyngier
Date: Wed Mar 4 20:33:09 2020 +0000
irqchip/gic-v4.1: Skip absent CPUs while iterating over redistributors
[ Upstream commit 28d160de5194c68ff534443d2a8b6f1d10d57c58 ]
In a system that is only sparsly populated with CPUs, we can end-up with
redistributors structures that are not initialized. Let's make sure we
don't try and access those when iterating over them (in this case when
checking we have a L2 VPE table).
Fixes: 4e6437f12d6e ("irqchip/gic-v4.1: Ensure L2 vPE table is allocated at RD level")
Signed-off-by: Marc Zyngier
Reviewed-by: Zenghui Yu
Reviewed-by: Eric Auger
Link: https://lore.kernel.org/r/20200304203330.4967-3-maz@kernel.org
Signed-off-by: Sasha Levin
commit 02d989a0645639797e6e000b61336442c94cb879
Author: Ahmed S. Darwish
Date: Mon Mar 9 18:15:29 2020 +0000
time/sched\_clock: Expire timer in hardirq context
[ Upstream commit 2c8bd58812ee3dbf0d78b566822f7eacd34bdd7b ]
To minimize latency, PREEMPT\_RT kernels expires hrtimers in preemptible
softirq context by default. This can be overriden by marking the timer's
expiry with HRTIMER\_MODE\_HARD.
sched\_clock\_timer is missing this annotation: if its callback is preempted
and the duration of the preemption exceeds the wrap around time of the
underlying clocksource, sched clock will get out of sync.
Mark the sched\_clock\_timer for expiry in hard interrupt context.
Signed-off-by: Ahmed S. Darwish
Signed-off-by: Thomas Gleixner
Link: https://lkml.kernel.org/r/20200309181529.26558-1-a.darwish@linutronix.de
Signed-off-by: Sasha Levin
commit 83e99928675f84e5fb17db7b3c5ad8b2b74d829d
Author: Sungbo Eo
Date: Thu Mar 19 11:34:48 2020 +0900
irqchip/versatile-fpga: Handle chained IRQs properly
[ Upstream commit 486562da598c59e9f835b551d7cf19507de2d681 ]
Enclose the chained handler with chained\_irq\_{enter,exit}(), so that the
muxed interrupts get properly acked.
This patch also fixes a reboot bug on OX820 SoC, where the jiffies timer
interrupt is never acked. The kernel waits a clock tick forever in
calibrate\_delay\_converge(), which leads to a boot hang.
Fixes: c41b16f8c9d9 ("ARM: integrator/versatile: consolidate FPGA IRQ handling code")
Signed-off-by: Sungbo Eo
Signed-off-by: Marc Zyngier
Link: https://lore.kernel.org/r/20200319023448.1479701-1-mans0n@gorani.run
Signed-off-by: Sasha Levin
commit 7dac336f66c13e4594b7ebd9bd5092b848548056
Author: Vladimir Oltean
Date: Wed Mar 18 02:15:58 2020 +0200
spi: spi-fsl-dspi: Avoid NULL pointer in dspi\_slave\_abort for non-DMA mode
[ Upstream commit 3d6224e63be39ff26cf416492cb3923cd3d07dd0 ]
The driver does not create the dspi->dma structure unless operating in
DSPI\_DMA\_MODE, so it makes sense to check for that.
Fixes: f4b323905d8b ("spi: Introduce dspi\_slave\_abort() function for NXP's dspi SPI driver")
Signed-off-by: Vladimir Oltean
Tested-by: Michael Walle
Link: https://lore.kernel.org/r/20200318001603.9650-8-olteanv@gmail.com
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
commit ada5bea750cd567c77e48b20595927bfa4fed5bc
Author: Taehee Yoo
Date: Tue Feb 18 04:31:50 2020 +0000
debugfs: Check module state before warning in {full/open}\_proxy\_open()
[ Upstream commit 275678e7a9be6a0ea9c1bb493e48abf2f4a01be5 ]
When the module is being removed, the module state is set to
MODULE\_STATE\_GOING. At this point, try\_module\_get() fails.
And when {full/open}\_proxy\_open() is being called,
it calls try\_module\_get() to try to hold module reference count.
If it fails, it warns about the possibility of debugfs file leak.
If {full/open}\_proxy\_open() is called while the module is being removed,
it fails to hold the module.
So, It warns about debugfs file leak. But it is not the debugfs file
leak case. So, this patch just adds module state checking routine
in the {full/open}\_proxy\_open().
Test commands:
#SHELL1
while :
do
modprobe netdevsim
echo 1 > /sys/bus/netdevsim/new\_device
modprobe -rv netdevsim
done
#SHELL2
while :
do
cat /sys/kernel/debug/netdevsim/netdevsim1/ports/0/ipsec
done
Splat looks like:
[ 298.766738][T14664] debugfs file owner did not clean up at exit: ipsec
[ 298.766766][T14664] WARNING: CPU: 2 PID: 14664 at fs/debugfs/file.c:312 full\_proxy\_open+0x10f/0x650
[ 298.768595][T14664] Modules linked in: netdevsim(-) openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 n][ 298.771343][T14664] CPU: 2 PID: 14664 Comm: cat Tainted: G W 5.5.0+ #1
[ 298.772373][T14664] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006
[ 298.773545][T14664] RIP: 0010:full\_proxy\_open+0x10f/0x650
[ 298.774247][T14664] Code: 48 c1 ea 03 80 3c 02 00 0f 85 c1 04 00 00 49 8b 3c 24 e8 e4 b5 78 ff 84 c0 75 2d 4c 89 ee 48
[ 298.776782][T14664] RSP: 0018:ffff88805b7df9b8 EFLAGS: 00010282[ 298.777583][T14664] RAX: dffffc0000000008 RBX: ffff8880511725c0 RCX: 0000000000000000
[ 298.778610][T14664] RDX: 0000000000000000 RSI: 0000000000000006 RDI: ffff8880540c5c14
[ 298.779637][T14664] RBP: 0000000000000000 R08: fffffbfff15235ad R09: 0000000000000000
[ 298.780664][T14664] R10: 0000000000000001 R11: 0000000000000000 R12: ffffffffc06b5000
[ 298.781702][T14664] R13: ffff88804c234a88 R14: ffff88804c22dd00 R15: ffffffff8a1b5660
[ 298.782722][T14664] FS: 00007fafa13a8540(0000) GS:ffff88806c800000(0000) knlGS:0000000000000000
[ 298.783845][T14664] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 298.784672][T14664] CR2: 00007fafa0e9cd10 CR3: 000000004b286005 CR4: 00000000000606e0
[ 298.785739][T14664] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 298.786769][T14664] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 298.787785][T14664] Call Trace:
[ 298.788237][T14664] do\_dentry\_open+0x63c/0xf50
[ 298.788872][T14664] ? open\_proxy\_open+0x270/0x270
[ 298.789524][T14664] ? \_\_x64\_sys\_fchdir+0x180/0x180
[ 298.790169][T14664] ? inode\_permission+0x65/0x390
[ 298.790832][T14664] path\_openat+0xc45/0x2680
[ 298.791425][T14664] ? save\_stack+0x69/0x80
[ 298.791988][T14664] ? save\_stack+0x19/0x80
[ 298.792544][T14664] ? path\_mountpoint+0x2e0/0x2e0
[ 298.793233][T14664] ? check\_chain\_key+0x236/0x5d0
[ 298.793910][T14664] ? sched\_clock\_cpu+0x18/0x170
[ 298.794527][T14664] ? find\_held\_lock+0x39/0x1d0
[ 298.795153][T14664] do\_filp\_open+0x16a/0x260
[ ... ]
Fixes: 9fd4dcece43a ("debugfs: prevent access to possibly dead file\_operations at file open")
Reported-by: kbuild test robot
Signed-off-by: Taehee Yoo
Link: https://lore.kernel.org/r/20200218043150.29447-1-ap420073@gmail.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 95e2c92e85059bc592973c62337262bf78b2f6d2
Author: Konstantin Khlebnikov
Date: Fri Feb 28 17:51:48 2020 +0300
block: keep bdi->io\_pages in sync with max\_sectors\_kb for stacked devices
[ Upstream commit e74d93e96d721c4297f2a900ad0191890d2fc2b0 ]
Field bdi->io\_pages added in commit 9491ae4aade6 ("mm: don't cap request
size based on read-ahead setting") removes unneeded split of read requests.
Stacked drivers do not call blk\_queue\_max\_hw\_sectors(). Instead they set
limits of their devices by blk\_set\_stacking\_limits() + disk\_stack\_limits().
Field bio->io\_pages stays zero until user set max\_sectors\_kb via sysfs.
This patch updates io\_pages after merging limits in disk\_stack\_limits().
Commit c6d6e9b0f6b4 ("dm: do not allow readahead to limit IO size") fixed
the same problem for device-mapper devices, this one fixes MD RAIDs.
Fixes: 9491ae4aade6 ("mm: don't cap request size based on read-ahead setting")
Reviewed-by: Paul Menzel
Reviewed-by: Bob Liu
Signed-off-by: Konstantin Khlebnikov
Signed-off-by: Song Liu
Signed-off-by: Sasha Levin
commit 8430efb411d3ea4b9233ea0c2ab7991bd7795632
Author: Thomas Hellstrom
Date: Wed Mar 4 12:45:27 2020 +0100
dma-mapping: Fix dma\_pgprot() for unencrypted coherent pages
[ Upstream commit 17c4a2ae15a7aaefe84bdb271952678c5c9cd8e1 ]
When dma\_mmap\_coherent() sets up a mapping to unencrypted coherent memory
under SEV encryption and sometimes under SME encryption, it will actually
set up an encrypted mapping rather than an unencrypted, causing devices
that DMAs from that memory to read encrypted contents. Fix this.
When force\_dma\_unencrypted() returns true, the linear kernel map of the
coherent pages have had the encryption bit explicitly cleared and the
page content is unencrypted. Make sure that any additional PTEs we set
up to these pages also have the encryption bit cleared by having
dma\_pgprot() return a protection with the encryption bit cleared in this
case.
Signed-off-by: Thomas Hellstrom
Signed-off-by: Borislav Petkov
Reviewed-by: Christoph Hellwig
Acked-by: Tom Lendacky
Link: https://lkml.kernel.org/r/20200304114527.3636-3-thomas\_os@shipmail.org
Signed-off-by: Sasha Levin
commit bf51ca166cfb60c7ffec27eab72ca87100de45fd
Author: Thomas Hellstrom
Date: Wed Mar 4 12:45:26 2020 +0100
x86: Don't let pgprot\_modify() change the page encryption bit
[ Upstream commit 6db73f17c5f155dbcfd5e48e621c706270b84df0 ]
When SEV or SME is enabled and active, vm\_get\_page\_prot() typically
returns with the encryption bit set. This means that users of
pgprot\_modify(, vm\_get\_page\_prot()) (mprotect\_fixup(), do\_mmap()) end up
with a value of vma->vm\_pg\_prot that is not consistent with the intended
protection of the PTEs.
This is also important for fault handlers that rely on the VMA
vm\_page\_prot to set the page protection. Fix this by not allowing
pgprot\_modify() to change the encryption bit, similar to how it's done
for PAT bits.
Signed-off-by: Thomas Hellstrom
Signed-off-by: Borislav Petkov
Reviewed-by: Dave Hansen
Acked-by: Tom Lendacky
Link: https://lkml.kernel.org/r/20200304114527.3636-2-thomas\_os@shipmail.org
Signed-off-by: Sasha Levin
commit bf0d357c52ec8881ec8fb2548aa3b8c2f44e1cb6
Author: Claudiu Beznea
Date: Mon Mar 16 11:52:56 2020 +0200
clocksource/drivers/timer-microchip-pit64b: Fix rate for gck
[ Upstream commit 0585244523f0f4de7e4480375e871617a79cab98 ]
Generic clock rate needs to be set in case it was selected as timer clock
source in mchp\_pit64b\_init\_mode(). Otherwise it will be enabled with wrong
rate.
Fixes: 625022a5f160 ("clocksource/drivers/timer-microchip-pit64b: Add Microchip PIT64B support")
Signed-off-by: Claudiu Beznea
Signed-off-by: Daniel Lezcano
Link: https://lore.kernel.org/r/1584352376-32585-1-git-send-email-claudiu.beznea@microchip.com
Signed-off-by: Sasha Levin
commit 281e612b4b9587c0c72e30c49ec279587b20da0f
Author: Rafael J. Wysocki
Date: Fri Mar 6 00:15:24 2020 +0100
ACPI: EC: Do not clear boot\_ec\_is\_ecdt in acpi\_ec\_add()
[ Upstream commit 65a691f5f8f0bb63d6a82eec7b0ffd193d8d8a5f ]
The reason for clearing boot\_ec\_is\_ecdt in acpi\_ec\_add() (if a
PNP0C09 device object matching the ECDT boot EC had been found in
the namespace) was to cause acpi\_ec\_ecdt\_start() to return early,
but since the latter does not look at boot\_ec\_is\_ecdt any more,
acpi\_ec\_add() need not clear it.
Moreover, doing that may be confusing as it may cause "DSDT" to be
printed instead of "ECDT" in the EC initialization completion
message, so stop doing it.
While at it, split the EC initialization completion message into
two messages, one regarding the boot EC and another one printed
regardless of whether or not the EC at hand is the boot one.
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Sasha Levin
commit ddf86decc00211046a7533909c2ddca37aee7e1a
Author: Mathias Nyman
Date: Thu Mar 12 16:45:09 2020 +0200
xhci: bail out early if driver can't accress host in resume
[ Upstream commit 72ae194704da212e2ec312ab182a96799d070755 ]
Bail out early if the xHC host needs to be reset at resume
but driver can't access xHC PCI registers.
If xhci driver already fails to reset the controller then there
is no point in attempting to free, re-initialize, re-allocate and
re-start the host. If failure to access the host is detected later,
failing the resume, xhci interrupts will be double freed
when remove is called.
Signed-off-by: Mathias Nyman
Link: https://lore.kernel.org/r/20200312144517.1593-2-mathias.nyman@linux.intel.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 26e29aa76c73e53374bcd60156a5ef3f0cd40049
Author: Laurent Pinchart
Date: Tue Mar 10 17:06:29 2020 +0100
media: imx: imx7-media-csi: Fix video field handling
[ Upstream commit f7b8488bd39ae8feced4dfbb41cf1431277b893f ]
Commit 4791bd7d6adc ("media: imx: Try colorimetry at both sink and
source pads") reworked the way that formats are set on the sink pad of
the CSI subdevice, and accidentally removed video field handling.
Restore it by defaulting to V4L2\_FIELD\_NONE if the field value isn't
supported, with the only two supported value being V4L2\_FIELD\_NONE and
V4L2\_FIELD\_INTERLACED.
Fixes: 4791bd7d6adc ("media: imx: Try colorimetry at both sink and source pads")
Signed-off-by: Laurent Pinchart
Reviewed-by: Rui Miguel Silva
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 4b8306fbcc2c4ab1d0a1011ac270a817ba1cc684
Author: Laurent Pinchart
Date: Tue Mar 10 17:06:24 2020 +0100
media: imx: imx7\_mipi\_csis: Power off the source when stopping streaming
[ Upstream commit 770cbf89f90b0663499dbb3f03aa81b3322757ec ]
The .s\_stream() implementation incorrectly powers on the source when
stopping the stream. Power it off instead.
Fixes: 7807063b862b ("media: staging/imx7: add MIPI CSI-2 receiver subdev for i.MX7")
Signed-off-by: Laurent Pinchart
Reviewed-by: Rui Miguel Silva
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 6dc42bc90669ef3d90e9321d3007f36662553a37
Author: Alexey Dobriyan
Date: Wed Feb 12 23:23:20 2020 +0300
null\_blk: fix spurious IO errors after failed past-wp access
[ Upstream commit ff77042296d0a54535ddf74412c5ae92cb4ec76a ]
Steps to reproduce:
BLKRESETZONE zone 0
// force EIO
pwrite(fd, buf, 4096, 4096);
[issue more IO including zone ioctls]
It will start failing randomly including IO to unrelated zones because of
->error "reuse". Trigger can be partition detection as well if test is not
run immediately which is even more entertaining.
The fix is of course to clear ->error where necessary.
Reviewed-by: Christoph Hellwig
Signed-off-by: Alexey Dobriyan (SK hynix)
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 15dff7aa75469e2754d65f52dadb5ef3e78d441b
Author: Bart Van Assche
Date: Mon Mar 9 21:26:19 2020 -0700
null\_blk: Suppress an UBSAN complaint triggered when setting 'memory\_backed'
[ Upstream commit b9853b4d6fb403ccb1d4d82e2d39fc17fc07519c ]
Although it is not clear to me why UBSAN complains when 'memory\_backed'
is set, this patch suppresses the UBSAN complaint that is triggered when
setting that configfs attribute.
UBSAN: Undefined behaviour in drivers/block/null\_blk\_main.c:327:1
load of value 16 is not a valid value for type '\_Bool'
CPU: 2 PID: 8396 Comm: check Not tainted 5.6.0-rc1-dbg+ #14
Hardware name: Bochs Bochs, BIOS Bochs 01/01/2011
Call Trace:
dump\_stack+0xa5/0xe6
ubsan\_epilogue+0x9/0x26
\_\_ubsan\_handle\_load\_invalid\_value+0x6d/0x76
nullb\_device\_memory\_backed\_store.cold+0x2c/0x38 [null\_blk]
configfs\_write\_file+0x1c4/0x250 [configfs]
\_\_vfs\_write+0x4c/0x90
vfs\_write+0x145/0x2c0
ksys\_write+0xd7/0x180
\_\_x64\_sys\_write+0x47/0x50
do\_syscall\_64+0x6f/0x2f0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Signed-off-by: Bart Van Assche
Reviewed-by: Chaitanya Kulkarni
Cc: Johannes Thumshirn
Cc: Hannes Reinecke
Cc: Ming Lei
Cc: Christoph Hellwig
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 9fbcc855fab3d7b2809ed1b4f35212c7b57661ae
Author: Bart Van Assche
Date: Mon Mar 9 21:26:22 2020 -0700
null\_blk: Handle null\_add\_dev() failures properly
[ Upstream commit 9b03b713082a31a5b90e0a893c72aa620e255c26 ]
If null\_add\_dev() fails then null\_del\_dev() is called with a NULL argument.
Make null\_del\_dev() handle this scenario correctly. This patch fixes the
following KASAN complaint:
null-ptr-deref in null\_del\_dev+0x28/0x280 [null\_blk]
Read of size 8 at addr 0000000000000000 by task find/1062
Call Trace:
dump\_stack+0xa5/0xe6
\_\_kasan\_report.cold+0x65/0x99
kasan\_report+0x16/0x20
\_\_asan\_load8+0x58/0x90
null\_del\_dev+0x28/0x280 [null\_blk]
nullb\_group\_drop\_item+0x7e/0xa0 [null\_blk]
client\_drop\_item+0x53/0x80 [configfs]
configfs\_rmdir+0x395/0x4e0 [configfs]
vfs\_rmdir+0xb6/0x220
do\_rmdir+0x238/0x2c0
\_\_x64\_sys\_unlinkat+0x75/0x90
do\_syscall\_64+0x6f/0x2f0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Signed-off-by: Bart Van Assche
Reviewed-by: Chaitanya Kulkarni
Cc: Johannes Thumshirn
Cc: Hannes Reinecke
Cc: Ming Lei
Cc: Christoph Hellwig
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 7e75fc163f0de0c6d977652ce4c1db27040a1bcf
Author: Bart Van Assche
Date: Mon Mar 9 21:26:18 2020 -0700
blk-mq: Fix a recently introduced regression in blk\_mq\_realloc\_hw\_ctxs()
[ Upstream commit d0930bb8f46b8fb4a7d429c0bf1c91b3ed00a7cf ]
q->nr\_hw\_queues must only be updated once it is known that
blk\_mq\_realloc\_hw\_ctxs() has succeeded. Otherwise it can happen that
reallocation fails and that q->nr\_hw\_queues is larger than the number of
allocated hardware queues. This patch fixes the following crash if
increasing the number of hardware queues fails:
BUG: KASAN: null-ptr-deref in blk\_mq\_map\_swqueue+0x775/0x810
Write of size 8 at addr 0000000000000118 by task check/977
CPU: 3 PID: 977 Comm: check Not tainted 5.6.0-rc1-dbg+ #8
Hardware name: Bochs Bochs, BIOS Bochs 01/01/2011
Call Trace:
dump\_stack+0xa5/0xe6
\_\_kasan\_report.cold+0x65/0x99
kasan\_report+0x16/0x20
check\_memory\_region+0x140/0x1b0
memset+0x28/0x40
blk\_mq\_map\_swqueue+0x775/0x810
blk\_mq\_update\_nr\_hw\_queues+0x468/0x710
nullb\_device\_submit\_queues\_store+0xf7/0x1a0 [null\_blk]
configfs\_write\_file+0x1c4/0x250 [configfs]
\_\_vfs\_write+0x4c/0x90
vfs\_write+0x145/0x2c0
ksys\_write+0xd7/0x180
\_\_x64\_sys\_write+0x47/0x50
do\_syscall\_64+0x6f/0x2f0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Fixes: ac0d6b926e74 ("block: Reduce the amount of memory required per request queue")
Signed-off-by: Bart Van Assche
Reviewed-by: Ming Lei
Cc: Keith Busch
Cc: Johannes Thumshirn
Cc: Hannes Reinecke
Cc: Christoph Hellwig
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit f720d394829b2f1b0b08c2920d62d307f1ec6b31
Author: Bart Van Assche
Date: Mon Mar 9 21:26:21 2020 -0700
null\_blk: Fix the null\_add\_dev() error path
[ Upstream commit 2004bfdef945fe55196db6b9cdf321fbc75bb0de ]
If null\_add\_dev() fails, clear dev->nullb.
This patch fixes the following KASAN complaint:
BUG: KASAN: use-after-free in nullb\_device\_submit\_queues\_store+0xcf/0x160 [null\_blk]
Read of size 8 at addr ffff88803280fc30 by task check/8409
Call Trace:
dump\_stack+0xa5/0xe6
print\_address\_description.constprop.0+0x26/0x260
\_\_kasan\_report.cold+0x7b/0x99
kasan\_report+0x16/0x20
\_\_asan\_load8+0x58/0x90
nullb\_device\_submit\_queues\_store+0xcf/0x160 [null\_blk]
configfs\_write\_file+0x1c4/0x250 [configfs]
\_\_vfs\_write+0x4c/0x90
vfs\_write+0x145/0x2c0
ksys\_write+0xd7/0x180
\_\_x64\_sys\_write+0x47/0x50
do\_syscall\_64+0x6f/0x2f0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
RIP: 0033:0x7ff370926317
Code: 64 89 02 48 c7 c0 ff ff ff ff eb bb 0f 1f 80 00 00 00 00 f3 0f 1e fa 64 8b 04 25 18 00 00 00 85 c0 75 10 b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 51 c3 48 83 ec 28 48 89 54 24 18 48 89 74 24
RSP: 002b:00007fff2dd2da48 EFLAGS: 00000246 ORIG\_RAX: 0000000000000001
RAX: ffffffffffffffda RBX: 0000000000000002 RCX: 00007ff370926317
RDX: 0000000000000002 RSI: 0000559437ef23f0 RDI: 0000000000000001
RBP: 0000559437ef23f0 R08: 000000000000000a R09: 0000000000000001
R10: 0000559436703471 R11: 0000000000000246 R12: 0000000000000002
R13: 00007ff370a006a0 R14: 00007ff370a014a0 R15: 00007ff370a008a0
Allocated by task 8409:
save\_stack+0x23/0x90
\_\_kasan\_kmalloc.constprop.0+0xcf/0xe0
kasan\_kmalloc+0xd/0x10
kmem\_cache\_alloc\_node\_trace+0x129/0x4c0
null\_add\_dev+0x24a/0xe90 [null\_blk]
nullb\_device\_power\_store+0x1b6/0x270 [null\_blk]
configfs\_write\_file+0x1c4/0x250 [configfs]
\_\_vfs\_write+0x4c/0x90
vfs\_write+0x145/0x2c0
ksys\_write+0xd7/0x180
\_\_x64\_sys\_write+0x47/0x50
do\_syscall\_64+0x6f/0x2f0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Freed by task 8409:
save\_stack+0x23/0x90
\_\_kasan\_slab\_free+0x112/0x160
kasan\_slab\_free+0x12/0x20
kfree+0xdf/0x250
null\_add\_dev+0xaf3/0xe90 [null\_blk]
nullb\_device\_power\_store+0x1b6/0x270 [null\_blk]
configfs\_write\_file+0x1c4/0x250 [configfs]
\_\_vfs\_write+0x4c/0x90
vfs\_write+0x145/0x2c0
ksys\_write+0xd7/0x180
\_\_x64\_sys\_write+0x47/0x50
do\_syscall\_64+0x6f/0x2f0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Fixes: 2984c8684f96 ("nullb: factor disk parameters")
Signed-off-by: Bart Van Assche
Reviewed-by: Chaitanya Kulkarni
Cc: Johannes Thumshirn
Cc: Hannes Reinecke
Cc: Ming Lei
Cc: Christoph Hellwig
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 8e2ef10a70e62c62769bdb95fa37a220c1147916
Author: Lorenzo Bianconi
Date: Fri Feb 7 13:37:54 2020 +0100
iio: imu: st\_lsm6dsx: check return value from st\_lsm6dsx\_sensor\_set\_enable
[ Upstream commit f20dbe11e2e904547597ae7371c1f635e3be9cad ]
Add missing return value check in st\_lsm6dsx\_shub\_read\_oneshot disabling
the slave device connected to the st\_lsm6dsx i2c controller.
The issue is reported by coverity with the following error:
Unchecked return value:
If the function returns an error value, the error value may be mistaken
for a normal value.
Addresses-Coverity-ID: 1456767 ("Unchecked return value")
Signed-off-by: Lorenzo Bianconi
Signed-off-by: Jonathan Cameron
Signed-off-by: Sasha Levin
commit 230634920cf4f5d80e2be6ff9ef590925ca4b454
Author: Chris Wilson
Date: Thu Jan 23 19:08:49 2020 +0100
sched/vtime: Prevent unstable evaluation of WARN(vtime->state)
[ Upstream commit f1dfdab694eb3838ac26f4b73695929c07d92a33 ]
As the vtime is sampled under loose seqcount protection by kcpustat, the
vtime fields may change as the code flows. Where logic dictates a field
has a static value, use a READ\_ONCE.
Signed-off-by: Chris Wilson
Signed-off-by: Frederic Weisbecker
Signed-off-by: Peter Zijlstra (Intel)
Signed-off-by: Ingo Molnar
Fixes: 74722bb223d0 ("sched/vtime: Bring up complete kcpustat accessor")
Link: https://lkml.kernel.org/r/20200123180849.28486-1-frederic@kernel.org
Signed-off-by: Sasha Levin
commit e1f75f8f98ad7e8ce2f31ab6316a644ebb9c9fc7
Author: Anshuman Khandual
Date: Wed Mar 4 09:58:42 2020 +0530
arm64/mm: Hold memory hotplug lock while walking for kernel page table dump
[ Upstream commit bf2b59f60ee1fefa768d62ec6e8f4b4d9e04c691 ]
The arm64 page table dump code can race with concurrent modification of the
kernel page tables. When a leaf entries are modified concurrently, the dump
code may log stale or inconsistent information for a VA range, but this is
otherwise not harmful.
When intermediate levels of table are freed, the dump code will continue to
use memory which has been freed and potentially reallocated for another
purpose. In such cases, the dump code may dereference bogus addresses,
leading to a number of potential problems.
Intermediate levels of table may by freed during memory hot-remove,
which will be enabled by a subsequent patch. To avoid racing with
this, take the memory hotplug lock when walking the kernel page table.
Acked-by: David Hildenbrand
Acked-by: Mark Rutland
Acked-by: Catalin Marinas
Reviewed-by: Steven Price
Signed-off-by: Anshuman Khandual
Signed-off-by: Catalin Marinas
Signed-off-by: Sasha Levin
commit 811c579dce59ddcc938caf3aaa1c7ff76b178f55
Author: Krzysztof Kozlowski
Date: Tue Mar 3 12:29:20 2020 +0100
usb: phy: tegra: Include proper GPIO consumer header to fix compile testing
[ Upstream commit 9cb9322a26ae84424c3e16e58617b3d8962fdbbb ]
The driver uses only GPIO Descriptor Consumer Interface so include
proper header. This fixes compile test failures (e.g. on i386):
drivers/usb/phy/phy-tegra-usb.c: In function ‘ulpi\_phy\_power\_on’:
drivers/usb/phy/phy-tegra-usb.c:695:2: error:
implicit declaration of function ‘gpiod\_set\_value\_cansleep’ [-Werror=implicit-function-declaration]
drivers/usb/phy/phy-tegra-usb.c: In function ‘tegra\_usb\_phy\_probe’:
drivers/usb/phy/phy-tegra-usb.c:1167:11: error:
implicit declaration of function ‘devm\_gpiod\_get\_from\_of\_node’ [-Werror=implicit-function-declaration]
Signed-off-by: Krzysztof Kozlowski
Reviewed-by: Dmitry Osipenko
Link: https://lore.kernel.org/r/1583234960-24909-1-git-send-email-krzk@kernel.org
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 733857131674aae6256a2d9eb370ec252848c4f1
Author: Mohammad Rasim
Date: Fri Feb 14 09:58:02 2020 +0100
media: arm64: dts: amlogic: add rc-videostrong-kii-pro keymap
[ Upstream commit 806d06161af045dba29f3c7747550c93b2ea3ca9 ]
videostrong kii pro comes with a nec rc, add the keymap to the dts
Signed-off-by: Mohammad Rasim
Reviewed-by: Neil Armstrong
Signed-off-by: Sean Young
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 6c8075cd066e47bd7b19166ddd07186abebbd482
Author: James Morse
Date: Fri Feb 21 16:35:06 2020 +0000
firmware: arm\_sdei: fix double-lock on hibernate with shared events
[ Upstream commit 6ded0b61cf638bf9f8efe60ab8ba23db60ea9763 ]
SDEI has private events that must be registered on each CPU. When
CPUs come and go they must re-register and re-enable their private
events. Each event has flags to indicate whether this should happen
to protect against an event being registered on a CPU coming online,
while all the others are unregistering the event.
These flags are protected by the sdei\_list\_lock spinlock, because
the cpuhp callbacks can't take the mutex.
Hibernate needs to unregister all events, but keep the in-memory
re-register and re-enable as they are. sdei\_unregister\_shared()
takes the spinlock to walk the list, then calls \_sdei\_event\_unregister()
on each shared event. \_sdei\_event\_unregister() tries to take the
same spinlock to update re-register and re-enable. This doesn't go
so well.
Push the re-register and re-enable updates out to their callers.
sdei\_unregister\_shared() doesn't want these values updated, so
doesn't need to do anything.
This also fixes shared events getting lost over hibernate as this
path made them look unregistered.
Fixes: da351827240e ("firmware: arm\_sdei: Add support for CPU and system power states")
Reported-by: Liguang Zhang
Signed-off-by: James Morse
Signed-off-by: Catalin Marinas
Signed-off-by: Sasha Levin
commit 9c55d757c96ca73f2c0723ae966d9240278e429a
Author: Stephan Gerhold
Date: Mon Dec 9 20:16:52 2019 +0100
media: venus: hfi\_parser: Ignore HEVC encoding for V1
[ Upstream commit c50cc6dc6c48300af63a6fbc71b647053c15fc80 ]
Some older MSM8916 Venus firmware versions also seem to indicate
support for encoding HEVC, even though they really can't.
This will lead to errors later because hfi\_session\_init() fails
in this case.
HEVC is already ignored for "dec\_codecs", so add the same for
"enc\_codecs" to make these old firmware versions work correctly.
Signed-off-by: Stephan Gerhold
Signed-off-by: Stanimir Varbanov
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 6968c1332341dadce62f4341274f8bdf735e043c
Author: Helen Koike
Date: Thu Feb 6 23:07:12 2020 +0100
media: staging: rkisp1: isp: do not set invalid mbus code for pad
[ Upstream commit 100f720aabab3d5f58f67c508186041b3c797a9b ]
When setting source pad, check if the given mbus code is indeed valid
for source pad, if not, then set the default code.
Same for sink pad.
Fixes: d65dd85281fb ("media: staging: rkisp1: add Rockchip ISP1 base driver")
Reported-by: Wojciech Zabolotny
Signed-off-by: Helen Koike
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 5c5331da05b7d1048235f51c82114823ec5f327b
Author: Helen Koike
Date: Thu Feb 6 23:07:08 2020 +0100
media: staging: rkisp1: use consistent bus\_info string for media\_dev
[ Upstream commit 12d3d8090bc5e8cdda2f56caed2a2a0d70009456 ]
Media device is using a slightly different bus\_info string
"platform: rkisp1" (with a space) instead of "platform:rkisp1" used by
the rest of rkisp1 code.
This causes errors when using v4l2-util tools that uses the bus\_info
string to identify the device.
Fixes: d65dd85281fb ("media: staging: rkisp1: add Rockchip ISP1 base driver")
Signed-off-by: Helen Koike
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 07db96c07f2329c34674109fbecb6527c37baa93
Author: Philipp Zabel
Date: Mon Jan 27 15:56:02 2020 +0100
media: hantro: fix extra MV/MC sync space calculation
[ Upstream commit 042584e9055b615ac917239884fb0d65690f56ec ]
Add space for MVs and MC sync data to the capture buffers depending on
whether the post processor will be enabled for the new capture format
passed to TRY\_FMT, not the currently set capture format.
Signed-off-by: Philipp Zabel
Reviewed-by: Ezequiel Garcia
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit f533a90de15afd2b65531c7701e10c240b0c2ad8
Author: Dafna Hirschfeld
Date: Mon Jan 13 19:59:33 2020 +0100
media: vimc: streamer: fix memory leak in vimc subdevs if kthread\_run fails
[ Upstream commit ceeb2e6166dddf3c9757abbbf84032027e2fa2d2 ]
In case kthread\_run fails, the vimc subdevices
should be notified that streaming stopped so they can
release the memory for the streaming. Also, kthread should be
set to NULL.
Signed-off-by: Dafna Hirschfeld
Acked-by: Helen Koike
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
commit 4f5fa9d2b734229d35ae92456980ed3c7e9cb672
Author: Ajay Singh
Date: Fri Feb 21 11:30:20 2020 +0000
staging: wilc1000: avoid double unlocking of 'wilc->hif\_cs' mutex
[ Upstream commit 6c411581caef6e3b2c286871641018364c6db50a ]
Possible double unlocking of 'wilc->hif\_cs' mutex was identified by
smatch [1]. Removed the extra call to release\_bus() in
wilc\_wlan\_handle\_txq() which was missed in earlier commit fdc2ac1aafc6
("staging: wilc1000: support suspend/resume functionality").
[1]. https://lists.01.org/hyperkitty/list/kbuild-all@lists.01.org/thread/NOEVW7C3GV74EWXJO3XX6VT2NKVB2HMT/
Reported-by: kbuild test robot
Reported-by: Dan Carpenter
Signed-off-by: Ajay Singh
Link: https://lore.kernel.org/r/20200221170120.15739-1-ajay.kathat@microchip.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit e93cb9b64833bf3aeba418ed404b2235e7dfff63
Author: Ajay Gupta
Date: Mon Feb 17 17:49:12 2020 +0300
usb: ucsi: ccg: disable runtime pm during fw flashing
[ Upstream commit 57a5e5f936be583d2c6cef3661c169e3ea4bf922 ]
Ucsi ppm is unregistered during fw flashing so disable
runtime pm also and reenable after fw flashing is completed
and ppm is re-registered.
Signed-off-by: Ajay Gupta
Signed-off-by: Heikki Krogerus
Link: https://lore.kernel.org/r/20200217144913.55330-3-heikki.krogerus@linux.intel.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 3b04920e0756a698fd9ad56d423f9b575c975d5a
Author: Robert Richter
Date: Thu Jan 23 09:03:00 2020 +0000
EDAC/mc: Report "unknown memory" on too many DIMM labels found
[ Upstream commit 65bb4d1af92cf007adc0a0c59dadcc393c5cada6 ]
There is a limitation to report only EDAC\_MAX\_LABELS in e->label of
the error descriptor. This is to prevent a potential string overflow.
The current implementation falls back to "any memory" in this case and
also stops all further processing to find a unique row and channel of
the possible error location.
Reporting "any memory" is wrong as the memory controller reported an
error location for one of the layers. Instead, report "unknown memory"
and also do not break early in the loop to further check row and channel
for uniqueness.
[ bp: Massage commit message. ]
Signed-off-by: Robert Richter
Signed-off-by: Borislav Petkov
Acked-by: Aristeu Rozanski
Link: https://lkml.kernel.org/r/20200123090210.26933-7-rrichter@marvell.com
Signed-off-by: Sasha Levin
commit f156f1d70dd860bcc3747e6792ae8da740b488df
Author: Christoph Niedermaier
Date: Tue Feb 11 12:58:07 2020 +0100
cpufreq: imx6q: Fixes unwanted cpu overclocking on i.MX6ULL
[ Upstream commit 36eb7dc1bd42fe5f850329c893768ff89b696fba ]
imx6ul\_opp\_check\_speed\_grading is called for both i.MX6UL and i.MX6ULL.
Since the i.MX6ULL was introduced to a separate ocotp compatible node
later, it is possible that the i.MX6ULL has also dtbs with
"fsl,imx6ull-ocotp". On a system without nvmem-cell speed grade a
missing check on this node causes a driver fail without considering
the cpu speed grade.
This patch prevents unwanted cpu overclocking on i.MX6ULL with compatible
node "fsl,imx6ull-ocotp" in old dtbs without nvmem-cell speed grade.
Fixes: 2733fb0d0699 ("cpufreq: imx6q: read OCOTP through nvmem for imx6ul/imx6ull")
Signed-off-by: Christoph Niedermaier
Signed-off-by: Viresh Kumar
Signed-off-by: Sasha Levin
commit 27056473a48afb5a0a98383680d0ee5c0cf6815b
Author: Mohammad Rasim
Date: Fri Jan 10 17:25:45 2020 +0100
media: rc: add keymap for Videostrong KII Pro
[ Upstream commit 30defecb98400575349a7d32f0526e1dc42ea83e ]
This is an NEC remote control device shipped with the Videostrong KII Pro
tv box as well as other devices from videostrong.
Signed-off-by: Mohammad Rasim
Signed-off-by: Sean Young
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin


=== Content from lists.openwall.net_74858cc0_20250119_114842.html ===


| [lists.openwall.net](https://lists.openwall.net) [lists](/)  /  [announce](https://www.openwall.com/lists/announce/)  [owl-users](https://www.openwall.com/lists/owl-users/)  [owl-dev](https://www.openwall.com/lists/owl-dev/)  [john-users](https://www.openwall.com/lists/john-users/)  [john-dev](https://www.openwall.com/lists/john-dev/)  [passwdqc-users](https://www.openwall.com/lists/passwdqc-users/)  [yescrypt](https://www.openwall.com/lists/yescrypt/)  [popa3d-users](https://www.openwall.com/lists/popa3d-users/)  /  [oss-security](https://www.openwall.com/lists/oss-security/)  [kernel-hardening](https://www.openwall.com/lists/kernel-hardening/)  [musl](https://www.openwall.com/lists/musl/)  [sabotage](https://www.openwall.com/lists/sabotage/)  [tlsify](https://www.openwall.com/lists/tlsify/)  [passwords](https://www.openwall.com/lists/passwords/)  /  [crypt-dev](https://www.openwall.com/lists/crypt-dev/)  [xvendor](https://www.openwall.com/lists/xvendor/)  /  [Bugtraq](/bugtraq/)  [Full-Disclosure](/full-disclosure/)  [linux-kernel](/linux-kernel/)  linux-[netdev](/netdev/)  [linux-ext4](/linux-ext4/)  [linux-hardening](/linux-hardening/)  [linux-cve-announce](/linux-cve-announce/)  [PHC](/phc-discussions/)| *Open Source and information security mailing list archives*|  | | | | |
| --- | --- | --- | --- | --- |

| | [Hash Suite for Android: free password hash cracker in your pocket](https://hashsuite.openwall.net/android) | | --- | |
| --- | --- |

[[<prev]](1802) [[next>]](1804) [[thread-next>]](../../../2020/03/29/437) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20200324215049.GA3710@pi3.com.pl>
Date:   Tue, 24 Mar 2020 22:50:49 +0100
From:   Adam Zabrocki <pi3@....com.pl>
To:     linux-kernel@...r.kernel.org, kernel-hardening@...ts.openwall.com
Subject: Curiosity around 'exec_id' and some problems associated with it

Problems:
     I.               The "exit_notify" function in the Linux kernel does not
                      sufficiently restrict exit signals
    II.               Preserve references to the "old" / dead process' VM via
                      file descriptor
Author:               Adam Zabrocki (<pi3@....com.pl>)
Date:                 September 1999 - March 2020

   Description:

In 2009 Oleg Nesterov discovered that Linux kernel has an incorrect logic to
reset ->exit_signal. As a result, the malicious user can bypass it if it execs
the setuid application before exiting (->exit_signal won't be reset to SIGCHLD).
His original message can be found here:

<https://marc.info/?l=linux-kernel&m=123560588713763&w=2>

CVE-2009-1337 was assigned to track this issue. More information about this bug
can be found here:

<https://www.cvedetails.com/cve/CVE-2009-1337/>

Patch:

<https://lore.kernel.org/patchwork/patch/150993/>

The logic responsible for handling ->exit_signal has been changed a few times
and the current logic is locked down since Linux kernel 3.3.5. However, it is
not fully robust and it's still possible for the malicious user to bypass it.
Basically, it's possible to send arbitrary signals to a privileged (suidroot)
parent process (Problem I.). Nevertheless, it's not trivial and more limited
comparing to the CVE-2009-1337.

   Details (Problem I.):

    When process dies function do_exit() -> exit_notify() from "kernel/exit.c"
is called:

"kernel/exit.c"
static void exit_notify(struct task_struct *tsk, int group_dead)
{
        ...
        tsk->exit_state = EXIT_ZOMBIE;
        if (unlikely(tsk->ptrace)) {
        ...
        } else if (thread_group_leader(tsk)) {
                autoreap = thread_group_empty(tsk) &&
                        do_notify_parent(tsk, tsk->exit_signal);
        } else {
        ...
    }
    ...
}

To be able to inform that child process died, do_notify_parent() from
"kernel/signal.c" is executed:

"kernel/signal.c"
bool do_notify_parent(struct task_struct *tsk, int sig)
{
        ...
        if (sig != SIGCHLD) {
                /*
                 * This is only possible if parent == real_parent.
                 * Check if it has changed security domain.
                 */
                if (tsk->parent_exec_id != tsk->parent->self_exec_id)
                        sig = SIGCHLD;
        }
        ...
        if (valid_signal(sig) && sig)
                __group_send_sig_info(sig, &info, tsk->parent);
        ...
}

It is possible for the child process to send to the parent process any signal
only when they run within the same security domain. If parent or child process
are not in the same domain, kernel will overwrite signal with SIGCHLD value.

However, this check is weak. It is possible for the malicious user to cause an
integer overflow for the value tsk->parent->self_exec_id and bypass this
validation.

Both values, self_exec_id and parent_exec_id are defined in the "task_struct"
structure in file "include/linux/sched.h":

"include/linux/sched.h"
struct task_struct {
        ...
        /* Thread group tracking: */
        u32                             parent_exec_id;
        u32                             self_exec_id;
        ...
}

Linux kernel defines "u32" as "unsigned int" type, which most of the modern
compiler's data model defines as a 32 bits value.

Some curiosities which are interesting to point out:

 1) Linus Torvalds in 2012 suspected that such 'overflow' might be possible.
    You can read more about it here:

    <https://www.openwall.com/lists/kernel-hardening/2012/03/11/4>

 2) Solar Designer in 1999(!) was aware about the problem that 'exit_signal' can
    be abused. The kernel didn't protect it at all at that time. So he came up
    with the idea to introduce those two counters to deal with that problem.
    Originally, these counters were defined as "long long" type. However, during
    the revising between September 14 and September 16, 1999 he switched from
    "long long" to "int" and introduced integer wraparound handling. His patches
    were merged to the kernel 2.0.39 and 2.0.40.

 3) It is worth to read the Solar Designer's message during the discussion about
    the fix for the problem CVE-2012-0056 (I'm referencing this problem later in
    that write-up about "Problem II"):

    <https://www.openwall.com/lists/kernel-hardening/2012/03/11/12>

   Exploitability:

    To be able to cause an integer overflow on self_exec_id or parent_exec_id,
attacker needs to find a way to precisely control that value from the user-mode.
Linux kernel references '*_exec_id' variables just in a few places in the code:

    1) Function do_notify_parent() from "kernel/exit.c"
    2) Function copy_process() from "kernel/fork.c"
    3) Function setup_new_exec() from "fs/exec.c"

Option 1) we already covered. Let's take a look at 2nd case:

"kernel/fork.c"
static __latent_entropy struct task_struct *copy_process(
                                        struct pid *pid,
                                        int trace,
                                        int node,
                                        struct kernel_clone_args *args)
{
        ...
        /* CLONE_PARENT re-uses the old parent */
        if (clone_flags & (CLONE_PARENT|CLONE_THREAD)) {
                p->real_parent = current->real_parent;
                p->parent_exec_id = current->parent_exec_id;
        } else {
                p->real_parent = current;
                p->parent_exec_id = current->self_exec_id;
        }
        ...
}

When mother creates a child process / thread (or in general 'task'), there is
a way to semi-control 'parent_exec_id' value by controlling which process will
be assigned as a 'real_parent'. To be able to do that, an attacker can pass
(or not) a CLONE_PARENT or CLONE_THREAD flag. However, this 'primitive' doesn't
directly allow to bypass the checks in do_notify_parent() function.

The only hope is in option 3:

"fs/exec.c"
void setup_new_exec(struct linux_binprm * bprm)
{
        ...
        current->self_exec_id++;
        flush_signal_handlers(current, 0);
}

Whenever current process executes a new binary, kernel increments "self_exec_id"
variable. There is no validation on the current value, and malicious user can
indirectly set any value for that variable.

However, to be able to bypass validation in do_notify_parent() function,
attacker needs to control parent's "self_exec_id":

                if (tsk->parent_exec_id != tsk->parent->self_exec_id)
                        sig = SIGCHLD;

To achieve that, malicious user must:

 a) Create a mother process
 b) Invoke clone() without CLONE_PARENT neither CLONE_THREAD flag. In such case,
    a new process will get the same values for "parent_exec_id" and
    "self_exec_id" as mother process.
 c) Mother process executes itself as many times as to be able to overflow own
    "self_exec_id" value, and set it to the "original self_exec_id" - 1.
 d) If desired value is acquired, then mother process executes any SUID
    privileged binary. By doing that, mother process will run in much higher
    security domain but the child's "parent_exec_id" will match
    "tsk->parent->self_exec_id" and that leads to bypass of the validation in
    do_notify_parent() function.

It is important to note, that beginning from the version 3.3.5, before kernel
calls setup_new_exec(), function flush_old_exec -> de_thread() will be executed:

"fs/exec.c"
static int de_thread(struct task_struct *tsk)
{
        ...
no_thread_group:
        /* we have changed execution domain */
        tsk->exit_signal = SIGCHLD;
        ...
}

This function overwrites "exit_signal" to always be SIGCHLD. This means that any
"exit_signal" set-up by the mother to the new child process, will be overwriten
as soon as child execs.

A few examples:

1) No execve at all

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |
|   exit_signal =    |
|           SIGCHLD  |
`--------------------`
  ^       |
  |       |
  |       `---> clone(SIGSEGV) --->     tsk2: child
  |                                 ,--------------------,
  |                                 |  self_exec_id = 6  |
  |                                 | parent_exec_id = 6 |
  |                                 |    parent = tsk1   |
  |                                 |   exit_signal =    |
  |                                 |           SIGSEGV  |
  |   original                      `--------------------`
  | "exit_signal"                             |
  |    SIGSEGV                                v
  |                                        exit(...)
  |                                           |
  |                                           v
  |                                    x = tsk2->parent_exec_id = 6
  |                                    y = tsk2->tsk1->self_exec_id = 6
  |                                         x == y
  |                                           |
  |                                           v
  ^------------------------< Deliver original "exit_signal" (SIGSEGV) >

2) child calls execve

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |
|   exit_signal =    |
|           SIGCHLD  |
`--------------------`
  ^       |
  |       |
  |       `---> clone(SIGSEGV) --->     tsk2: child
  |                                 ,--------------------,
  |                                 |  self_exec_id = 6  |
  |                                 | parent_exec_id = 6 |
  |                                 |    parent = tsk1   |
  |                                 |   exit_signal =    |
  |                                 |           SIGSEGV  |
  |   original                      `--------------------`
  | "exit_signal"                             |
  |    SIGCHLD                                v
  |                                        execve(...)
  |                                    exit_signal = SIGCHLD
  |                                           |
  |                                           v
  |                                        exit(...)
  |                                           |
  |                                           v
  |                                    x = tsk2->parent_exec_id = 6
  |                                    y = tsk2->tsk1->self_exec_id = 6
  |                                         x == y
  |                                           |
  |                                           v
  ^------------------------< Deliver overwritten "exit_signal" (SIGCHLD) >

3) mother calls execve

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |----------------------,
|   exit_signal =    |                      |
|           SIGTERM  |                      |
`--------------------`                      |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 v
          v                            clone(SIGSEGV)
     tsk1: mother                           |
,--------------------,                      |
|  self_exec_id = 7  |                      |
| parent_exec_id = 6 |                      |
|   parent = <bash>  |                      |
|   exit_signal =    |                      |
|           SIGCHLD  |                      |
`--------------------`                      |
                                            |
                                            |
                                            |
                                            |
                                            v
                                        tsk2: child
                                    ,--------------------,
                                    |  self_exec_id = 6  |
                                    | parent_exec_id = 6 |
                                    |    parent = tsk1   |
                                    |   exit_signal =    |
                                    |           SIGSEGV  |
                                    `--------------------`
                                              |
                                              v
                                           execve(...)
                                       exit_signal = SIGCHLD
                                              |
                                              v
                                           exit(...)
                                              |
                                              v
                                       x = tsk2->parent_exec_id = 6
                                       y = tsk2->tsk1->self_exec_id = 7
                                            x != y
                                              |
                                              v
                                "exit_signal" will NOT be delivered

4) mother execs as many times as generates an integer overflow (our attack)

     tsk1: mother
,--------------------,
|  self_exec_id = 6  |
| parent_exec_id = 6 |
|   parent = <bash>  |----------------------,
|   exit_signal =    |                      |
|           SIGTERM  |                      |
`--------------------`                      |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 v
          v                            clone(SIGSEGV)
     tsk1: mother                           |
,--------------------,                      |
|  self_exec_id = 7  |                      |
| parent_exec_id = 6 |                      |
|   parent = <bash>  |                      |
|   exit_signal =    |                      |
|           SIGCHLD  |                      |
`--------------------`                      |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 |
         ...                                |
    "self_exec_id"                          |
      overflows                             |
         ...                                |
          |                                 |
          v                                 |
       execve(...)                          |
          |                                 v
          v                             tsk2: child
     tsk1: mother                   ,--------------------,
,--------------------,              |  self_exec_id = 6  |
|  self_exec_id = 5  |              | parent_exec_id = 6 |
| parent_exec_id = 6 |              |    parent = tsk1   |
|   parent = <bash>  |              |   exit_signal =    |
|   exit_signal =    |              |           SIGSEGV  |
|           SIGCHLD  |              `--------------------`
`--------------------`                        |
          |                                   |
          v                                   v
      execve(SUID)                         exit(...)
          |                                   |
          v                                   |
     tsk1: mother                             |
,--------------------,                        |
|  self_exec_id = 6  |                        v
|   parent = <bash>  |                 x = tsk2->parent_exec_id = 6
|   exit_signal =    |                 y = tsk2->tsk1->self_exec_id = 6
|           SIGCHLD  |                      x == y
`--------------------`                        |
  ^   original                                |
  | "exit_signal"                             |
  |    SIGSEGV                                v
  ^------------------------< Deliver original "exit_signal" (SIGSEGV) >

   Proof of Concept (PoC):

    I was able to generate an integer overflow on tsk->parent->self_exec_id and
successfully pass the verification in the "do_notify_parent" function. This
allowed me to send an arbitrary signal to the mother process running in the
different security domain. However, it takes relatively long time to generate
such integer overflow:

 1) test_case 1:
    Machine: VM under Hyper-V hypervisor
    CPU:     2 VCPUs (i7-8850H CPU @ 2.60GHz)
    RAM:     3.4 GB
    OS:      Ubuntu 19.10 (eoan)
    kernel:  5.5.1-050501-generic

    Time to overflow -> 17 days*

 2) test_case 2:
    Machine: Bare-metal
    CPU:     12 CPUs (Xeon(R) E-2176G CPU @ 3.70GHz)
    RAM:     32 GB
    OS:      Ubuntu 18.04.3 LTS (bionic)
    kernel:  4.15.0-72-generic

    Time to overflow -> 7 days*

*) However, my test cases were NOT optimized for speed and it is likely possible
   to reduce amount of time needed for such overflow.

After successful verification that described scenario is possible to achieve,
I've created a kernel module which simplifies my tests and instead of waiting
for a few days to generate an integer overflow, it simulates it. Kernel module
exports 2 IOCTLs:
 1) Dump current process':
    -> current process' task_struct pointer
    -> current process' PID
    -> current process' self_exec_id
    -> current process' parent_exec_id
    -> parent's task_struct pointer
    -> parent's PID
    -> parent's self_exec_id
    -> parent's parent_exec_id
 2) Overwrites parent's self_exec_id with value -100

I've adopted my PoC to leverage new kernel module and immediately simulate
described attack. Here are some notes from my tests:

 -> Ubuntu sets 2 as a default value for /proc/sys/fs/suid_dumpable
    -> This value requires that pattern set in /proc/sys/kernel/core_pattern
       must be either an absolute pathname (starting with a leading '/'
       character) or a pipe.
    -> Ubuntu is shipped with 'apport' package by default. This means that
       crashes are forwarded through pipe to the 'apport'
 -> However, apport throws an unhandled exception in case of ruid != uid, e.g.:

        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: called for pid 12762, signal 11, core limit 0, dump mode 2
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: not creating core for pid with dump mode of 2
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: Unhandled exception:
        Traceback (most recent call last):
          File "/usr/share/apport/apport", line 589, in <module>
            info.add_proc_info(proc_pid_fd=proc_pid_fd)
          File "/usr/lib/python3/dist-packages/apport/report.py", line 548, in add_proc_info
            self['ExecutablePath'] = os.readlink('exe', dir_fd=proc_pid_fd)
        PermissionError: [Errno 13] Permission denied: 'exe'
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: pid: 12773, uid: 1000, gid: 1000, euid: 0, egid: 0
        ERROR: apport (pid 12773) Mon Mar  9 21:07:00 2020: environment: environ({})

    This situation is a results of dropped privileges by apport:

        euid = os.geteuid()
        egid = os.getegid()
        try:
            # Drop permissions temporarily to make sure that we don't
            # include information in the crash report that the user should
            # not be allowed to access.
            os.seteuid(os.getuid())
            os.setegid(os.getgid())
            info.add_proc_info(proc_pid_fd=proc_pid_fd)
        finally:
            os.seteuid(euid)
            os.setegid(egid)

 -> If you set 1 as a value for /proc/sys/fs/suid_dumpable (not recommended),
    you are free to fully play with crashdumps.

   Vectors of attack:

    The most obvious attack is to generate a coredump from the higher privileged
processes (like SUID binary). However, most of the modern distros should be
securely configured to protect from the attack using such situation (but I just
verified Ubuntu case).
Nevertheless, SIGSEGV is not the only useful signal to send. It is possible that
some privileged applications (SUID) might change their behavior based on the
signals which they receive. Various apps might implement signal handlers in
a various way which might be exploited using a described kernel bug. More
research is needed in that field.

   Details (Problem II.):

    Until 2012, 'self_exec_id' field (among others) was used to enforce
permissions checking restrictions for /proc/pid/{mem/maps/...} interface.
However, it was done poorly and serious security problem was reported known as
"Mempodipper" (CVE-2012-0056). More details about the bug can be found here:

<https://git.zx2c4.com/CVE-2012-0056/about/>

Linux kernel received a patch for that issue which completely changed the logic
how permission checks are enforced for /proc/pid/{mem/maps/...} interface. It
can be found here:

<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e268337dfe26dfc7efd422a804dbb27977a3cccc>

Since that patch, 'self_exec_id' is not tracked anymore, but kernel is looking
at process' VM during the time of the open(). However, as Solar Designer pointed
out, this logic might generate some problems:

<https://www.openwall.com/lists/oss-security/2012/01/22/5>

In short, if you hold the file descriptor open over an execve() (e.g. share it
with child) the old VM is preserved (refcounted) and might be never released.
Essentially, mother process' VM will be still in memory (and pointer to it is
valid) even if the mother process passed an execve().
This is some kind of 'memory leak' scenario. I did a simple test where process
open /proc/self/maps file and calls clone() with CLONE_FILES flag. Next mother
'overwrite' itself by executing SUID binary (doesn't need to be SUID), and child
was still able to use the original file descriptor - it's valid.

Nevertheless, I didn't explore that problem more. Maybe it is worth to do so?
Suspected resource limits bypass, to be confirmed or disproved with further
research.

Another interesting curiosity which is worth to point out about Problem II is
the Alan Cox's message sent during the discussion on the fix for CVE-2012-0056:

<https://www.openwall.com/lists/kernel-hardening/2012/03/11/13>

   Affected Software:

    Almost all Linux kernels should be affected. However, currently tested logic
is available since 3.3.5 up to the latest one (5.5.8).
Kernels 2.0.39 and 2.0.40 looks secure ;-)

Best regards,
Adam 'pi3' Zabrocki

--
pi3 (pi3ki31ny) - pi3 (at) itsec pl
<http://pi3.com.pl>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

[![Powered by Openwall GNU/*/Linux](/images/Owl-80x15-4.png)](https://www.openwall.com/Owl/ "Powered by Openwall GNU/*/Linux - security-enhanced \"Linux distribution\"")
[![Powered by OpenVZ](/images/OpenVZ-80x15-cd.png)](https://openvz.org "Powered by OpenVZ - OS virtualization solution for Linux")



=== Content from usn.ubuntu.com_8f4813dd_20250119_114842.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4367-1: Linux kernel vulnerabilities

24 May 2020

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 20.04 LTS](/security/notices?release=focal)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-oracle](/security/cves?package=linux-oracle) - Linux kernel for Oracle Cloud systems
* [linux-raspi](/security/cves?package=linux-raspi) - Linux kernel for Raspberry Pi (V8) systems
* [linux-riscv](/security/cves?package=linux-riscv) - Linux kernel for RISC-V systems

## Details

It was discovered that the btrfs implementation in the Linux kernel did not

properly detect that a block was marked dirty in some situations. An

attacker could use this to specially craft a file system image that, when

unmounted, could cause a denial of service (system crash). ([CVE-2019-19377](/security/CVE-2019-19377))

It was discovered that the linux kernel did not properly validate certain

mount options to the tmpfs virtual memory file system. A local attacker

with the ability to specify mount options could use this to cause a denial

of service (system crash). ([CVE-2020-11565](/security/CVE-2020-11565))

It was discovered that the block layer in the Linux kernel contained a race

condition leading to a use-after-free vulnerability. A local attacker could

possibly use this to cause a denial of service (system crash) or execute

arbitrary code. ([CVE-2020-12657](/security/CVE-2020-12657))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 20.04

* [linux-image-5.4.0-1011-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [5.4.0-1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-aws/5.4.0-1011.11)
* [linux-image-5.4.0-1011-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp)
  -
  [5.4.0-1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp/5.4.0-1011.11)
* [linux-image-5.4.0-1011-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [5.4.0-1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/5.4.0-1011.11)
* [linux-image-5.4.0-1011-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle)
  -
  [5.4.0-1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle/5.4.0-1011.11)
* [linux-image-5.4.0-1011-raspi](https://launchpad.net/ubuntu/%2Bsource/linux-raspi)
  -
  [5.4.0-1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-raspi/5.4.0-1011.11)
* [linux-image-5.4.0-1012-azure](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure)
  -
  [5.4.0-1012.12](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure/5.4.0-1012.12)
* [linux-image-5.4.0-26-generic](https://launchpad.net/ubuntu/%2Bsource/linux-riscv)
  -
  [5.4.0-26.30](https://launchpad.net/ubuntu/%2Bsource/linux-riscv/5.4.0-26.30)
* [linux-image-5.4.0-31-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [5.4.0-31.35](https://launchpad.net/ubuntu/%2Bsource/linux-signed/5.4.0-31.35)
* [linux-image-5.4.0-31-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.4.0-31.35](https://launchpad.net/ubuntu/%2Bsource/linux/5.4.0-31.35)
* [linux-image-5.4.0-31-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [5.4.0-31.35](https://launchpad.net/ubuntu/%2Bsource/linux-signed/5.4.0-31.35)
* [linux-image-aws](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws)
  -
  [5.4.0.1011.14](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws/5.4.0.1011.14)
* [linux-image-azure](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure)
  -
  [5.4.0.1012.14](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure/5.4.0.1012.14)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [5.4.0.1011.12](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/5.4.0.1011.12)
* [linux-image-generic](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [5.4.0.31.36](https://launchpad.net/ubuntu/%2Bsource/linux-meta/5.4.0.31.36)
* [linux-image-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [5.4.0.31.36](https://launchpad.net/ubuntu/%2Bsource/linux-meta/5.4.0.31.36)
* [linux-image-gke](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [5.4.0.1011.12](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/5.4.0.1011.12)
* [linux-image-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm)
  -
  [5.4.0.1011.12](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm/5.4.0.1011.12)
* [linux-image-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [5.4.0.31.36](https://launchpad.net/ubuntu/%2Bsource/linux-meta/5.4.0.31.36)
* [linux-image-oem](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [5.4.0.31.36](https://launchpad.net/ubuntu/%2Bsource/linux-meta/5.4.0.31.36)
* [linux-image-oem-osp1](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [5.4.0.31.36](https://launchpad.net/ubuntu/%2Bsource/linux-meta/5.4.0.31.36)
* [linux-image-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle)
  -
  [5.4.0.1011.12](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle/5.4.0.1011.12)
* [linux-image-raspi](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi)
  -
  [5.4.0.1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi/5.4.0.1011.11)
* [linux-image-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi)
  -
  [5.4.0.1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi/5.4.0.1011.11)
* [linux-image-virtual](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [5.4.0.31.36](https://launchpad.net/ubuntu/%2Bsource/linux-meta/5.4.0.31.36)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2019-19377](/security/CVE-2019-19377)
* [CVE-2020-11565](/security/CVE-2020-11565)
* [CVE-2020-12657](/security/CVE-2020-12657)
* [CVE-2020-12826](/security/CVE-2020-12826)

## Related notices

* [USN-4369-1](/security/notices/USN-4369-1)
* [USN-4414-1](/security/notices/USN-4414-1)
* [USN-4364-1](/security/notices/USN-4364-1)
* [USN-4363-1](/security/notices/USN-4363-1)
* [USN-4368-1](/security/notices/USN-4368-1)
* [USN-4391-1](/security/notices/USN-4391-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from github.com_1bda07bf_20250119_114841.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F7395ea4e65c2a00d23185a3f63ad315756ba9cef)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F7395ea4e65c2a00d23185a3f63ad315756ba9cef)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.8k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  436](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/7395ea4e65c2a00d23185a3f63ad315756ba9cef)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

signal: Extend exec\_id to 64bits

[Browse files](/torvalds/linux/tree/7395ea4e65c2a00d23185a3f63ad315756ba9cef)
Browse the repository at this point in the history

```
commit [d1e7fd6](https://github.com/torvalds/linux/commit/d1e7fd6462ca9fc76650fbe6ca800e35b24267da) upstream.

Replace the 32bit exec_id with a 64bit exec_id to make it impossible
to wrap the exec_id counter.  With care an attacker can cause exec_id
wrap and send arbitrary signals to a newly exec'd parent.  This
bypasses the signal sending checks if the parent changes their
credentials during exec.

The severity of this problem can been seen that in my limited testing
of a 32bit exec_id it can take as little as 19s to exec 65536 times.
Which means that it can take as little as 14 days to wrap a 32bit
exec_id.  Adam Zabrocki has succeeded wrapping the self_exe_id in 7
days.  Even my slower timing is in the uptime of a typical server.
Which means self_exec_id is simply a speed bump today, and if exec
gets noticably faster self_exec_id won't even be a speed bump.

Extending self_exec_id to 64bits introduces a problem on 32bit
architectures where reading self_exec_id is no longer atomic and can
take two read instructions.  Which means that is is possible to hit
a window where the read value of exec_id does not match the written
value.  So with very lucky timing after this change this still
remains expoiltable.

I have updated the update of exec_id on exec to use WRITE_ONCE
and the read of exec_id in do_notify_parent to use READ_ONCE
to make it clear that there is no locking between these two
locations.

Link: [https://lore.kernel.org/kernel-hardening/20200324215049.GA3710@pi3.com.pl](https://lore.kernel.org/kernel-hardening/20200324215049.GA3710%40pi3.com.pl)
Fixes: 2.3.23pre2
Cc: stable@vger.kernel.org
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
```

* Loading branch information

[![@ebiederm](https://avatars.githubusercontent.com/u/7477136?s=40&v=4)](/ebiederm) [![@gregkh](https://avatars.githubusercontent.com/u/14953?s=40&v=4)](/gregkh)

[ebiederm](/torvalds/linux/commits?author=ebiederm "View all commits by ebiederm")
authored and
[gregkh](/torvalds/linux/commits?author=gregkh "View all commits by gregkh")
committed
Apr 17, 2020

1 parent
[0d0d5e6](/torvalds/linux/commit/0d0d5e6d99b2f4506452d47da3083fc9a7451118)

commit 7395ea4

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**4 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* fs

  + fs/exec.c
    [exec.c](#diff-ff6060da281bd9ef3f24e17b77a9b0b5b2ed2d7208bb69b29107bee69732bd31)
* include/linux

  + include/linux/sched.h
    [sched.h](#diff-f8d8a1568ae83bbff6f40f9c70559a4f7dbf426a397131ba9d4fbfb947ea5222)
* kernel

  + kernel/signal.c
    [signal.c](#diff-d27dff658f39a6871b764e4efe94bef225af513a35f0d9f4f3009ca6c94f3767)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[fs/exec.c](#diff-ff6060da281bd9ef3f24e17b77a9b0b5b2ed2d7208bb69b29107bee69732bd31 "fs/exec.c")

Show comments

[View file](/torvalds/linux/blob/7395ea4e65c2a00d23185a3f63ad315756ba9cef/fs/exec.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1386,7 +1386,7 @@ void setup\_new\_exec(struct linux\_binprm \* bprm) |
|  |  |  |
|  |  | /\* An exec changes our domain. We are no longer part of the thread |
|  |  | group \*/ |
|  |  | current->self\_exec\_id++; |
|  |  | WRITE\_ONCE(current->self\_exec\_id, current->self\_exec\_id + 1); |
|  |  | flush\_signal\_handlers(current, 0); |
|  |  | } |
|  |  | EXPORT\_SYMBOL(setup\_new\_exec); |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[include/linux/sched.h](#diff-f8d8a1568ae83bbff6f40f9c70559a4f7dbf426a397131ba9d4fbfb947ea5222 "include/linux/sched.h")

Show comments

[View file](/torvalds/linux/blob/7395ea4e65c2a00d23185a3f63ad315756ba9cef/include/linux/sched.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -939,8 +939,8 @@ struct task\_struct { |
|  |  | struct seccomp seccomp; |
|  |  |  |
|  |  | /\* Thread group tracking: \*/ |
|  |  | u32 parent\_exec\_id; |
|  |  | u32 self\_exec\_id; |
|  |  | u64 parent\_exec\_id; |
|  |  | u64 self\_exec\_id; |
|  |  |  |
|  |  | /\* Protection against (de-)allocation: mm, files, fs, tty, keyrings, mems\_allowed, mempolicy: \*/ |
|  |  | spinlock\_t alloc\_lock; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[kernel/signal.c](#diff-d27dff658f39a6871b764e4efe94bef225af513a35f0d9f4f3009ca6c94f3767 "kernel/signal.c")

Show comments

[View file](/torvalds/linux/blob/7395ea4e65c2a00d23185a3f63ad315756ba9cef/kernel/signal.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1931,7 +1931,7 @@ bool do\_notify\_parent(struct task\_struct \*tsk, int sig) |
|  |  | \* This is only possible if parent == real\_parent. |
|  |  | \* Check if it has changed security domain. |
|  |  | \*/ |
|  |  | if (tsk->parent\_exec\_id != tsk->parent->self\_exec\_id) |
|  |  | if (tsk->parent\_exec\_id != READ\_ONCE(tsk->parent->self\_exec\_id)) |
|  |  | sig = SIGCHLD; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7395ea4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F7395ea4e65c2a00d23185a3f63ad315756ba9cef) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from wiki.ubuntu.com_7483ce6a_20250119_133530.html ===


* [Partners](http://www.ubuntu.com/partners)
* [Support](http://www.ubuntu.com/support)
* [Community](http://www.ubuntu.com/community)
* [Ubuntu.com](http://www.ubuntu.com)

# [Ubuntu Wiki](/ "Ubuntu Wiki")

Search:

* Immutable Page
* [Info](/SecurityTeam/KnowledgeBase/SRBDS?action=info)
* [Attachments](/SecurityTeam/KnowledgeBase/SRBDS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Copy Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  Sync Pages
  ------------------------
  Load
  Save
  SlideShow

* [Ubuntu Wiki](/Home)
* [Login](?action=login)
* [Help](/HelpContents)

---

## [SRBDS](/SecurityTeam/KnowledgeBase/SRBDS)

## Special Register Buffer Data Sampling (SRBDS) Hardware Vulnerability in Intel CPUs (CVE-2020-0543, aka Crosstalk)

It was [discovered](https://www.intel.com/content/www/us/en/security-center/advisory/INTEL-SA-00320.html) that special register buffer data of certain Intel CPUs may be exposed to a malicious process executing on the same CPU. Particular processor operations (e.g RDRAND, RDSEED) use data from outside the physical processor core - this can be done via an internal microarchitectural operation called a special register read. This uses part of a shared staging buffer which may not be completely zero'd on subsequent uses by other threads. As such, a local attacker may be able to infer stale values which were previously returned from special register reads to other processors (as their contents may still be present in other parts of the shared staging buffer). Some special register reads return sensitive information (such as RDRAND, RDSEED and SGX EGETKEY) and so an attacker executing code on the same CPU may be able to infer these values for another thread / process executing on the same CPU.

This attack relies on the same techniques used to exploit previous microarchitectural speculative execution vulnerabilities such as [MDS](https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/MDS) and [TSX Asynchronous Abort](https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/TAA_MCEPSC_i915), and affects some client and Intel® Xeon® E3 processors; it does not affect other Intel Xeon or Intel Atom® processors.

Mitigations for this issue are provided by CPU microcode updates via the intel-microcode package. This mitigation consists of ensuring data in the shared staging buffer is overwritten by the RDRAND, RDSEED and EGETKEY instructions and serialising execution of RDRAND etc instructions across multiple logical processors. As a result, this will have an effect on the performance of these instructions. In conjunction, the microcode updates also supports an opt-out mechanism so that performance can be restored if desired - to support this, the Linux kernel supports a kernel command-line option srbds=off to allow system administrators to make use of the opt-out mechanism. For details on the boot command line option and how to check system status, please see the [Linux Kernel Special Register Buffer Data Sampling Admin Guide](https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/special-register-buffer-data-sampling.html).

It should be noted, that for Linux, whilst RDRAND / RDSEED output is used in the generation of secure random numbers via the /dev/urandom device / getrandom() system-call, this value is also mixed with other sources of entropy in a secure manner, and knowledge of RDRAND / RDSEED values by a local attacker is highly unlikely to allow recovery of the actual random values which are then subsequently provided to applications which may use these in the generation of secret key material or other sensitive data. As such, it is highly unlikely this vulnerability will allow recovery of secret keys or similar \*unless\* an application is using RDRAND / RDSEED instructions directly to generate such secrets.

For a full list of affected processors, please refer to [Intel's guidance document](https://software.intel.com/security-software-guidance/insights/processors-affected-special-register-buffer-data-sampling).

This issue was fixed in Intel IPU 2020.1. Ubuntu 14.04 ESM, 16.04 LTS, 18.04 LTS, 19.10 and 20.04 LTS were affected. To address the issue, ensure that the appropriate version of the intel-microcode package as listed below is installed. These updates were announced in [USN 4385-2](http://usn.ubuntu.com/usn/4385-2).

Computers that have trouble booting after installing the microcode update can bypass the microcode loading step by adding dis\_ucode\_ldr to the kernel command line in the grub bootloader. This will disable all microcode-loaded mitigations and other bugfixes, so it's best to use it temporarily, to install new microcode.

| **Release** | **intel-microcode Version** |
| --- | --- |
| 20.04 LTS | [intel-microcode 3.20200609.0ubuntu0.20.04.2](https://launchpad.net/ubuntu/%2Bsource/intel-microcode/3.20200609.0ubuntu0.20.04.2/) |
| 19.10 | [intel-microcode 3.20200609.0ubuntu0.19.10.2](https://launchpad.net/ubuntu/%2Bsource/intel-microcode/3.20200609.0ubuntu0.19.10.2/) |
| 18.04 LTS | [intel-microcode 3.20200609.0ubuntu0.18.04.1](https://launchpad.net/ubuntu/%2Bsource/intel-microcode/3.20200609.0ubuntu0.18.04.1/) |
| 16.04 LTS | [intel-microcode 3.20200609.0ubuntu0.16.04.1](https://launchpad.net/ubuntu/%2Bsource/intel-microcode/3.20200609.0ubuntu0.16.04.1/) |
| 14.04 ESM | intel-microcode 3.20200609.0ubuntu0.14.04.1 |
| 12.04 ESM | Not available; please consult your hardware vendor's website for a BIOS update containing new microcode |

#### Timeline

* 2019 Dec 11: Notification received
* 2020 Jun 09: Coordinated Release Date
* 2020 Jun 09: Ubuntu publish updated intel-microcode packages
* 2020 Jun 10: Ubuntu publish updated intel-microcode packages to revert the fix for Intel Skylake family (06\_4EH)

### References

* <https://www.intel.com/content/www/us/en/security-center/advisory/INTEL-SA-00320.html>
* <https://www.vusec.net/projects/crosstalk>
* <https://software.intel.com/security-software-guidance/software-guidance/special-register-buffer-data-sampling>
* <https://software.intel.com/security-software-guidance/insights/deep-dive-special-register-buffer-data-sampling>
* <https://software.intel.com/security-software-guidance/insights/processors-affected-special-register-buffer-data-sampling>
* <https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/special-register-buffer-data-sampling.html>

---

[CategoryTemplate](/CategoryTemplate)

SecurityTeam/KnowledgeBase/SRBDS (last edited 2020-06-11 23:48:27 by [seth-arnold](https://launchpad.net/~seth-arnold "seth-arnold @ localhost[127.0.0.1]"))

The material on this wiki is available under a free license, see
[Copyright / License](https://help.ubuntu.com/community/License) for details.



=== Content from bugzilla.redhat.com_730e9cfb_20250119_114831.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1822077)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1822077)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1822077)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1822077

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1822077**](show_bug.cgi?id=1822077)
(CVE-2020-12826)
- [CVE-2020-12826](https://access.redhat.com/security/cve/CVE-2020-12826) kernel: possible to send arbitrary signals to a privileged (suidroot) parent process

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2020-12826 kernel: possible to send arbitrary signals to a privileged (su...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-12826 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1834649](show_bug.cgi?id=1834649 "CLOSED ERRATA - CVE-2020-10741 kernel: possible to send arbitrary signals to a privileged (suidroot) parent process [fedora-all]") [1834650](show_bug.cgi?id=1834650) [1834651](show_bug.cgi?id=1834651) [1834652](show_bug.cgi?id=1834652) [1834653](show_bug.cgi?id=1834653) [1834654](show_bug.cgi?id=1834654) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1818051](show_bug.cgi?id=1818051) | | TreeView+ | [depends on](buglist.cgi?bug_id=1822077&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1822077&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2020-04-08 08:06 UTC by Dhananjay Arunesh | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-12-15 17:38 UTC ([History](show_activity.cgi?id=1822077)) | | [CC List:](page.cgi?id=fields.html#cclist) | 50 users (show)  acaringi airlied bhu blc bmasney brdeoliv bskeggs carnil dhoward dvlasenk esammons fhrbata hdegoede hkrzesin iboverma ichavero itamar jarodwilson jeremy jforbes jglisse jlelli john.j5live jonathan josef jross jshortt jstancek jwboyer kcarcia kernel-maint kernel-mgr lgoncalv linville masami256 matt mchehab mcressma mjg59 mlangsdo nmurray ptalbert qzhao rt-maint rvrbovsk security-response-team steved williams wmealing yozone | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A flaw was found in the Linux kernel loose validation of child/parent process identification handling while filtering signal handlers. A local attacker is able to abuse this flaw to bypass checks to send any signal to a privileged process. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2020-09-29 22:00:31 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHBA-2020:4416](https://access.redhat.com/errata/RHBA-2020%3A4416) | 0 | None | None | None | 2020-10-29 15:10:29 UTC | | Red Hat Product Errata | [RHBA-2020:4417](https://access.redhat.com/errata/RHBA-2020%3A4417) | 0 | None | None | None | 2020-10-29 15:08:58 UTC | | Red Hat Product Errata | [RHBA-2020:4418](https://access.redhat.com/errata/RHBA-2020%3A4418) | 0 | None | None | None | 2020-10-29 15:14:24 UTC | | Red Hat Product Errata | [RHBA-2020:4419](https://access.redhat.com/errata/RHBA-2020%3A4419) | 0 | None | None | None | 2020-10-29 15:12:48 UTC | | Red Hat Product Errata | [RHBA-2020:4420](https://access.redhat.com/errata/RHBA-2020%3A4420) | 0 | None | None | None | 2020-10-29 15:51:41 UTC | | Red Hat Product Errata | [RHSA-2020:4060](https://access.redhat.com/errata/RHSA-2020%3A4060) | 0 | None | None | None | 2020-09-29 20:53:56 UTC | | Red Hat Product Errata | [RHSA-2020:4062](https://access.redhat.com/errata/RHSA-2020%3A4062) | 0 | None | None | None | 2020-09-29 18:59:40 UTC | | Red Hat Product Errata | [RHSA-2020:4431](https://access.redhat.com/errata/RHSA-2020%3A4431) | 0 | None | None | None | 2020-11-04 00:50:44 UTC | | Red Hat Product Errata | [RHSA-2020:4609](https://access.redhat.com/errata/RHSA-2020%3A4609) | 0 | None | None | None | 2020-11-04 02:23:02 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Comment 2](show_bug.cgi?id=1822077#c2)  Wade Mealing    2020-05-12 02:05:32 UTC  ``` A flaw was found in the Linux kernel loose validation of child/parent process identification handling while filtering signal handlers.  A local attacker is able to abuse this flaw to bypass checks to send any signal to a privileged process.  The most likely attack vector is a local user attempting to attack a setuid process.   ```  [Comment 3](show_bug.cgi?id=1822077#c3)  Wade Mealing    2020-05-12 05:42:24 UTC  ``` Acknowledgments:  Name: Adam Zabrocki   ```  [Comment 6](show_bug.cgi?id=1822077#c6)  Wade Mealing    2020-05-12 06:42:23 UTC  ``` This flaw is rated as moderate, this may trigger a fault or possibly dos but there isnt a known memory corruption/privesc   ```  [Comment 7](show_bug.cgi?id=1822077#c7)  Wade Mealing    2020-05-12 06:52:54 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 1834649](show_bug.cgi?id=1834649 "CLOSED ERRATA - CVE-2020-10741 kernel: possible to send arbitrary signals to a privileged (suidroot) parent process [fedora-all]")]   ```  [Comment 10](show_bug.cgi?id=1822077#c10)  Wade Mealing    2020-05-12 07:43:22 UTC  ``` External References:  <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d1e7fd6462ca9fc76650fbe6ca800e35b24267da> <https://lists.openwall.net/linux-kernel/2020/03/24/1803> <https://www.openwall.com/lists/kernel-hardening/2020/03/25/1>   ```  [Comment 11](show_bug.cgi?id=1822077#c11)  Justin M. Forbes    2020-05-12 17:15:46 UTC  ``` This was fixed for Fedora with the 5.5.18 stable kernel updates.   ```  [Comment 12](show_bug.cgi?id=1822077#c12)  Salvatore Bonaccorso    2020-05-13 06:41:23 UTC  ``` This seems to be a duplicate of <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-12826> .  FWIW, issued via cveform.mitre.org a question on that to MITRE as well.   ```  [Comment 16](show_bug.cgi?id=1822077#c16)  Petr Matousek    2020-05-15 14:55:56 UTC  ``` In reply to [comment #12](show_bug.cgi?id=1822077#c12): > This seems to be a duplicate of > <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-12826> . >  > FWIW, issued via cveform.mitre.org a question on that to MITRE as well.  thank you.  [CVE-2020-10741](https://access.redhat.com/security/cve/CVE-2020-10741) was rejected in favor of [CVE-2020-12826](https://access.redhat.com/security/cve/CVE-2020-12826). I added [CVE-2020-12826](https://access.redhat.com/security/cve/CVE-2020-12826) as a CVE alias for this bug.   ```  [Comment 17](show_bug.cgi?id=1822077#c17)  Petr Matousek    2020-05-15 14:57:51 UTC  ``` *** PLEASE NOTE ***  [CVE-2020-10741](https://access.redhat.com/security/cve/CVE-2020-10741) was rejected as per <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-10741> and [CVE-2020-12826](https://access.redhat.com/security/cve/CVE-2020-12826) should be used instead. based on that [CVE-2020-10741](https://access.redhat.com/security/cve/CVE-2020-10741) has been removed from this bug.  *** PLEASE NOTE ***   ```  [Comment 18](show_bug.cgi?id=1822077#c18)  Petr Matousek    2020-05-26 12:58:03 UTC  ``` Mitigation:  Mitigation for this issue is either not available or the currently available options don't meet the Red Hat Product Security criteria comprising ease of use and deployment, applicability to widespread installation base or stability.   ```  [Comment 19](show_bug.cgi?id=1822077#c19)  errata-xmlrpc    2020-09-29 18:59:35 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 7  Via RHSA-2020:4062 [https://access.redhat.com/errata/RHSA-2020:4062](https://access.redhat.com/errata/RHSA-2020%3A4062)   ```  [Comment 20](show_bug.cgi?id=1822077#c20)  errata-xmlrpc    2020-09-29 20:53:53 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 7  Via RHSA-2020:4060 [https://access.redhat.com/errata/RHSA-2020:4060](https://access.redhat.com/errata/RHSA-2020%3A4060)   ```  [Comment 21](show_bug.cgi?id=1822077#c21)  Product Security DevOps Team    2020-09-29 22:00:31 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2020-12826>   ```  [Comment 37](show_bug.cgi?id=1822077#c37)  errata-xmlrpc    2020-11-04 00:50:42 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8  Via RHSA-2020:4431 [https://access.redhat.com/errata/RHSA-2020:4431](https://access.redhat.com/errata/RHSA-2020%3A4431)   ```  [Comment 38](show_bug.cgi?id=1822077#c38)  errata-xmlrpc    2020-11-04 02:22:59 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8  Via RHSA-2020:4609 [https://access.redhat.com/errata/RHSA-2020:4609](https://access.redhat.com/errata/RHSA-2020%3A4609)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1822077&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


