=== Content from plugins.trac.wordpress.org_dda7f2dd_20250119_110701.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fadvanced-woo-search%2Ftags%2F2.00%2Fincludes%2Fclass-aws-search.php%3Frev%3D2290090)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← Previous Revision
* [Latest Revision](/browser/advanced-woo-search/tags/2.00/includes/class-aws-search.php)
* Next Revision →
* [Blame](/browser/advanced-woo-search/tags/2.00/includes/class-aws-search.php?annotate=blame&rev=2290090 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/advanced-woo-search/tags/2.00/includes/class-aws-search.php?rev=2290090)

---

# [source:](/browser?rev=2290090&order=name "Go to repository root") [advanced-woo-search](/browser/advanced-woo-search?rev=2290090&order=name "View advanced-woo-search")/[tags](/browser/advanced-woo-search/tags?rev=2290090&order=name "View tags")/[2.00](/browser/advanced-woo-search/tags/2.00?rev=2290090&order=name "View 2.00")/[includes](/browser/advanced-woo-search/tags/2.00/includes?rev=2290090&order=name "View includes")/[class-aws-search.php](/browser/advanced-woo-search/tags/2.00/includes/class-aws-search.php?rev=2290090&order=name "View class-aws-search.php") @ [2290090](/changeset/2290090/ "View changeset 2290090")

View diff against:

View revision:

| [Last change](/changeset/2290090/advanced-woo-search/tags/2.00/includes/class-aws-search.php "View differences") on this file since 2290090 was [2290090](/changeset/2290090/ "View changeset 2290090"), checked in by Mihail Barinov, [5 years ago](/timeline?from=2020-04-23T12%3A12%3A57Z&precision=second "See timeline at 04/23/2020 12:12:57 PM") |
| --- |
| Version 2.00 |
| **File size:** 27.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { |
| [4](#L4) | exit; |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | if ( ! class\_exists( 'AWS\_Search' ) ) : |
| [8](#L8) |  |
| [9](#L9) | /\*\* |
| [10](#L10) | \* Class for plugin search |
| [11](#L11) | \*/ |
| [12](#L12) | class AWS\_Search { |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* @var AWS\_Search Array of all plugin data $data |
| [16](#L16) | \*/ |
| [17](#L17) | private $data = array(); |
| [18](#L18) |  |
| [19](#L19) | /\*\* |
| [20](#L20) | \* @var AWS\_Search Current language $lang |
| [21](#L21) | \*/ |
| [22](#L22) | private $lang = 0; |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Return a singleton instance of the current class |
| [26](#L26) | \* |
| [27](#L27) | \* @return object |
| [28](#L28) | \*/ |
| [29](#L29) | public static function factory() { |
| [30](#L30) | static $instance = false; |
| [31](#L31) |  |
| [32](#L32) | if ( ! $instance ) { |
| [33](#L33) | $instance = new self(); |
| [34](#L34) | $instance->setup(); |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | return $instance; |
| [38](#L38) | } |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* Constructor |
| [42](#L42) | \*/ |
| [43](#L43) | public function \_\_construct() {} |
| [44](#L44) |  |
| [45](#L45) | /\*\* |
| [46](#L46) | \* Setup actions and filters for all things settings |
| [47](#L47) | \*/ |
| [48](#L48) | public function setup() { |
| [49](#L49) |  |
| [50](#L50) | $this->data['settings'] = get\_option( 'aws\_settings' ); |
| [51](#L51) |  |
| [52](#L52) | if ( isset( $\_REQUEST['wc-ajax'] ) ) { |
| [53](#L53) | add\_action( 'wc\_ajax\_aws\_action', array( $this, 'action\_callback' ) ); |
| [54](#L54) | } else { |
| [55](#L55) | add\_action( 'wp\_ajax\_aws\_action', array( $this, 'action\_callback' ) ); |
| [56](#L56) | add\_action( 'wp\_ajax\_nopriv\_aws\_action', array( $this, 'action\_callback' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | } |
| [60](#L60) |  |
| [61](#L61) | /\* |
| [62](#L62) | \* AJAX call action callback |
| [63](#L63) | \*/ |
| [64](#L64) | public function action\_callback() { |
| [65](#L65) |  |
| [66](#L66) | if ( ! defined( 'DOING\_AJAX' ) ) { |
| [67](#L67) | define( 'DOING\_AJAX', true ); |
| [68](#L68) | } |
| [69](#L69) |  |
| [70](#L70) | if ( ! headers\_sent() && isset( $\_REQUEST['typedata'] ) ) { |
| [71](#L71) | header( 'Content-Type: application/json; charset=' . get\_option( 'blog\_charset' ) ); |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | echo json\_encode( $this->search() ); |
| [75](#L75) |  |
| [76](#L76) | die; |
| [77](#L77) |  |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | /\* |
| [81](#L81) | \* Search |
| [82](#L82) | \*/ |
| [83](#L83) | public function search( $keyword = ''  ) { |
| [84](#L84) |  |
| [85](#L85) | global $wpdb; |
| [86](#L86) |  |
| [87](#L87) | $this->lang = isset( $\_REQUEST['lang'] ) ? sanitize\_text\_field( $\_REQUEST['lang'] ) : ''; |
| [88](#L88) |  |
| [89](#L89) | if ( $this->lang ) { |
| [90](#L90) | do\_action( 'wpml\_switch\_language', $this->lang ); |
| [91](#L91) | } |
| [92](#L92) |  |
| [93](#L93) | $cache = AWS()->get\_settings( 'cache' ); |
| [94](#L94) |  |
| [95](#L95) | $s = $keyword ? esc\_attr( $keyword ) : esc\_attr( $\_POST['keyword'] ); |
| [96](#L96) | $s = htmlspecialchars\_decode( $s ); |
| [97](#L97) |  |
| [98](#L98) | $this->data['s\_nonormalize'] = $s; |
| [99](#L99) |  |
| [100](#L100) | $s = AWS\_Helpers::normalize\_string( $s ); |
| [101](#L101) |  |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Fires each time when performing the search |
| [105](#L105) | \* @since 1.59 |
| [106](#L106) | \* @param string $s Search query |
| [107](#L107) | \*/ |
| [108](#L108) | do\_action( 'aws\_search\_start', $s ); |
| [109](#L109) |  |
| [110](#L110) |  |
| [111](#L111) | $cache\_option\_name = ''; |
| [112](#L112) |  |
| [113](#L113) | if ( $cache === 'true' && ! $keyword  ) { |
| [114](#L114) | $cache\_option\_name = AWS()->cache->get\_cache\_name( $s ); |
| [115](#L115) | $res = AWS()->cache->get\_from\_cache\_table( $cache\_option\_name ); |
| [116](#L116) | if ( $res ) { |
| [117](#L117) | $cached\_value = json\_decode( $res ); |
| [118](#L118) | if ( $cached\_value && ! empty( $cached\_value ) ) { |
| [119](#L119) | return $cached\_value; |
| [120](#L120) | } |
| [121](#L121) | } |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | $show\_cats     = AWS()->get\_settings( 'show\_cats' ); |
| [125](#L125) | $show\_tags     = AWS()->get\_settings( 'show\_tags' ); |
| [126](#L126) | $results\_num   = $keyword ? apply\_filters( 'aws\_page\_results', 100 ) : AWS()->get\_settings( 'results\_num' ); |
| [127](#L127) | $search\_in     = AWS()->get\_settings( 'search\_in' ); |
| [128](#L128) | $outofstock    = AWS()->get\_settings( 'outofstock' ); |
| [129](#L129) |  |
| [130](#L130) | $search\_in\_arr = explode( ',',  AWS()->get\_settings( 'search\_in' ) ); |
| [131](#L131) |  |
| [132](#L132) | // Search in title if all options is disabled |
| [133](#L133) | if ( ! $search\_in ) { |
| [134](#L134) | $search\_in\_arr = array( 'title' ); |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | $products\_array = array(); |
| [138](#L138) | $tax\_to\_display = array(); |
| [139](#L139) | $custom\_tax\_array = array(); |
| [140](#L140) |  |
| [141](#L141) | $this->data['s'] = $s; |
| [142](#L142) | $this->data['results\_num']  = $results\_num ? $results\_num : 10; |
| [143](#L143) | $this->data['search\_terms'] = array(); |
| [144](#L144) | $this->data['search\_in']    = $search\_in\_arr; |
| [145](#L145) | $this->data['outofstock']   = $outofstock; |
| [146](#L146) |  |
| [147](#L147) | $search\_array = array\_unique( explode( ' ', $s ) ); |
| [148](#L148) |  |
| [149](#L149) | $search\_array = AWS\_Helpers::filter\_stopwords( $search\_array ); |
| [150](#L150) |  |
| [151](#L151) | if ( is\_array( $search\_array ) && ! empty( $search\_array ) ) { |
| [152](#L152) | foreach ( $search\_array as $search\_term ) { |
| [153](#L153) | $search\_term = trim( $search\_term ); |
| [154](#L154) | if ( $search\_term ) { |
| [155](#L155) | $this->data['search\_terms'][] = $search\_term; |
| [156](#L156) | } |
| [157](#L157) | } |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | //            if ( empty( $this->data['search\_terms'] ) ) { |
| [161](#L161) | //                $this->data['search\_terms'][] = ''; |
| [162](#L162) | //            } |
| [163](#L163) |  |
| [164](#L164) | if ( ! empty( $this->data['search\_terms'] ) ) { |
| [165](#L165) |  |
| [166](#L166) | $posts\_ids = $this->query\_index\_table(); |
| [167](#L167) |  |
| [168](#L168) | /\*\* |
| [169](#L169) | \* Filters array of products ids |
| [170](#L170) | \* |
| [171](#L171) | \* @since 1.53 |
| [172](#L172) | \* |
| [173](#L173) | \* @param array $posts\_ids Array of products ids |
| [174](#L174) | \* @param string $s Search query |
| [175](#L175) | \*/ |
| [176](#L176) | $posts\_ids = apply\_filters( 'aws\_search\_results\_products\_ids', $posts\_ids, $s ); |
| [177](#L177) |  |
| [178](#L178) |  |
| [179](#L179) | $products\_array = $this->get\_products( $posts\_ids ); |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \* Filters array of products before they displayed in search results |
| [183](#L183) | \* |
| [184](#L184) | \* @since 1.42 |
| [185](#L185) | \* |
| [186](#L186) | \* @param array $products\_array Array of products results |
| [187](#L187) | \* @param string $s Search query |
| [188](#L188) | \*/ |
| [189](#L189) | $products\_array = apply\_filters( 'aws\_search\_results\_products', $products\_array, $s ); |
| [190](#L190) |  |
| [191](#L191) | if ( $show\_cats === 'true' ) { |
| [192](#L192) | $tax\_to\_display[] = 'product\_cat'; |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | if ( $show\_tags === 'true' ) { |
| [196](#L196) | $tax\_to\_display[] = 'product\_tag'; |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | /\*\* |
| [200](#L200) | \* Filters array of custom taxonomies that must be displayed in search results |
| [201](#L201) | \* |
| [202](#L202) | \* @since 1.68 |
| [203](#L203) | \* |
| [204](#L204) | \* @param array $taxonomies\_archives Array of custom taxonomies |
| [205](#L205) | \* @param string $s Search query |
| [206](#L206) | \*/ |
| [207](#L207) | $taxonomies\_archives = apply\_filters( 'aws\_search\_results\_tax\_archives', $tax\_to\_display, $s ); |
| [208](#L208) |  |
| [209](#L209) | if ( $taxonomies\_archives && is\_array( $taxonomies\_archives ) && ! empty( $taxonomies\_archives ) ) { |
| [210](#L210) |  |
| [211](#L211) | $tax\_search = new AWS\_Tax\_Search( $taxonomies\_archives, $this->data ); |
| [212](#L212) | $custom\_tax\_array = $tax\_search->get\_results(); |
| [213](#L213) |  |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | } |
| [217](#L217) |  |
| [218](#L218) |  |
| [219](#L219) | $result\_array = array( |
| [220](#L220) | 'tax'      => $custom\_tax\_array, |
| [221](#L221) | 'products' => $products\_array, |
| [222](#L222) | ); |
| [223](#L223) |  |
| [224](#L224) |  |
| [225](#L225) | /\*\* |
| [226](#L226) | \* Filters array of all results data before they displayed in search results |
| [227](#L227) | \* |
| [228](#L228) | \* @since 1.43 |
| [229](#L229) | \* |
| [230](#L230) | \* @param array $brands\_array Array of products data |
| [231](#L231) | \* @param string $s Search query |
| [232](#L232) | \*/ |
| [233](#L233) | $result\_array = apply\_filters( 'aws\_search\_results\_all', $result\_array, $s ); |
| [234](#L234) |  |
| [235](#L235) | if ( $cache === 'true' && ! $keyword  ) { |
| [236](#L236) | AWS()->cache->insert\_into\_cache\_table( $cache\_option\_name, $result\_array ); |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | return $result\_array; |
| [240](#L240) |  |
| [241](#L241) | } |
| [242](#L242) |  |
| [243](#L243) | /\* |
| [244](#L244) | \* Query in index table |
| [245](#L245) | \*/ |
| [246](#L246) | private function query\_index\_table() { |
| [247](#L247) |  |
| [248](#L248) | global $wpdb; |
| [249](#L249) |  |
| [250](#L250) | $table\_name = $wpdb->prefix . AWS\_INDEX\_TABLE\_NAME; |
| [251](#L251) |  |
| [252](#L252) | $search\_in\_arr    = $this->data['search\_in']; |
| [253](#L253) | $results\_num      = $this->data['results\_num']; |
| [254](#L254) | $outofstock       = $this->data['outofstock']; |
| [255](#L255) |  |
| [256](#L256) |  |
| [257](#L257) | $reindex\_version = get\_option( 'aws\_reindex\_version' ); |
| [258](#L258) |  |
| [259](#L259) | $query = array(); |
| [260](#L260) |  |
| [261](#L261) | $query['select'] = ''; |
| [262](#L262) | $query['search'] = ''; |
| [263](#L263) | $query['relevance'] = ''; |
| [264](#L264) | $query['stock'] = ''; |
| [265](#L265) | $query['visibility'] = ''; |
| [266](#L266) | $query['exclude\_products'] = ''; |
| [267](#L267) | $query['lang'] = ''; |
| [268](#L268) |  |
| [269](#L269) | $search\_array = array(); |
| [270](#L270) | $relevance\_array = array(); |
| [271](#L271) | $new\_relevance\_array = array(); |
| [272](#L272) |  |
| [273](#L273) |  |
| [274](#L274) | /\*\* |
| [275](#L275) | \* Filters array of search terms before generating SQL query |
| [276](#L276) | \* |
| [277](#L277) | \* @since 1.49 |
| [278](#L278) | \* |
| [279](#L279) | \* @param array $this->data['search\_terms'] Array of search terms |
| [280](#L280) | \*/ |
| [281](#L281) | $this->data['search\_terms'] = apply\_filters( 'aws\_search\_terms', $this->data['search\_terms'] ); |
| [282](#L282) |  |
| [283](#L283) |  |
| [284](#L284) | foreach ( $this->data['search\_terms'] as $search\_term ) { |
| [285](#L285) |  |
| [286](#L286) | $search\_term\_len = strlen( $search\_term ); |
| [287](#L287) |  |
| [288](#L288) | $relevance\_title        = 200 + 20 \* $search\_term\_len; |
| [289](#L289) | $relevance\_content      = 35 + 4 \* $search\_term\_len; |
| [290](#L290) | $relevance\_title\_like   = 40 + 2 \* $search\_term\_len; |
| [291](#L291) | $relevance\_content\_like = 35 + 1 \* $search\_term\_len; |
| [292](#L292) |  |
| [293](#L293) | $search\_term\_norm = AWS\_Plurals::singularize( $search\_term ); |
| [294](#L294) |  |
| [295](#L295) | if ( $search\_term\_norm && $search\_term\_len > 3 && strlen( $search\_term\_norm ) > 2 ) { |
| [296](#L296) | $search\_term = $search\_term\_norm; |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | $like = '%' . $wpdb->esc\_like( $search\_term ) . '%'; |
| [300](#L300) |  |
| [301](#L301) |  |
| [302](#L302) | if ( $search\_term\_len > 1 ) { |
| [303](#L303) | $search\_array[] = $wpdb->prepare( '( term LIKE %s )', $like ); |
| [304](#L304) | } else { |
| [305](#L305) | $search\_array[] = $wpdb->prepare( '( term = "%s" )', $search\_term ); |
| [306](#L306) | } |
| [307](#L307) |  |
| [308](#L308) | foreach ( $search\_in\_arr as $search\_in\_term ) { |
| [309](#L309) |  |
| [310](#L310) | switch ( $search\_in\_term ) { |
| [311](#L311) |  |
| [312](#L312) | case 'title': |
| [313](#L313) | $relevance\_array['title'][] = $wpdb->prepare( "( case when ( term\_source = 'title' AND term = '%s' ) then {$relevance\_title} \* count else 0 end )", $search\_term ); |
| [314](#L314) | $relevance\_array['title'][] = $wpdb->prepare( "( case when ( term\_source = 'title' AND term LIKE %s ) then {$relevance\_title\_like} \* count else 0 end )", $like ); |
| [315](#L315) | break; |
| [316](#L316) |  |
| [317](#L317) | case 'content': |
| [318](#L318) | $relevance\_array['content'][] = $wpdb->prepare( "( case when ( term\_source = 'content' AND term = '%s' ) then {$relevance\_content} \* count else 0 end )", $search\_term ); |
| [319](#L319) | $relevance\_array['content'][] = $wpdb->prepare( "( case when ( term\_source = 'content' AND term LIKE %s ) then {$relevance\_content\_like} \* count else 0 end )", $like ); |
| [320](#L320) | break; |
| [321](#L321) |  |
| [322](#L322) | case 'excerpt': |
| [323](#L323) | $relevance\_array['excerpt'][] = $wpdb->prepare( "( case when ( term\_source = 'excerpt' AND term = '%s' ) then {$relevance\_content} \* count else 0 end )", $search\_term ); |
| [324](#L324) | $relevance\_array['excerpt'][] = $wpdb->prepare( "( case when ( term\_source = 'excerpt' AND term LIKE %s ) then {$relevance\_content\_like} \* count else 0 end )", $like ); |
| [325](#L325) | break; |
| [326](#L326) |  |
| [327](#L327) | case 'category': |
| [328](#L328) | $relevance\_array['category'][] = $wpdb->prepare( "( case when ( term\_source = 'category' AND term = '%s' ) then 35 else 0 end )", $search\_term ); |
| [329](#L329) | $relevance\_array['category'][] = $wpdb->prepare( "( case when ( term\_source = 'category' AND term LIKE %s ) then 5 else 0 end )", $like ); |
| [330](#L330) | break; |
| [331](#L331) |  |
| [332](#L332) | case 'tag': |
| [333](#L333) | $relevance\_array['tag'][] = $wpdb->prepare( "( case when ( term\_source = 'tag' AND term = '%s' ) then 35 else 0 end )", $search\_term ); |
| [334](#L334) | $relevance\_array['tag'][] = $wpdb->prepare( "( case when ( term\_source = 'tag' AND term LIKE %s ) then 5 else 0 end )", $like ); |
| [335](#L335) | break; |
| [336](#L336) |  |
| [337](#L337) | case 'sku': |
| [338](#L338) | $relevance\_array['sku'][] = $wpdb->prepare( "( case when ( term\_source = 'sku' AND term = '%s' ) then 300 else 0 end )", $search\_term ); |
| [339](#L339) | $relevance\_array['sku'][] = $wpdb->prepare( "( case when ( term\_source = 'sku' AND term LIKE %s ) then 50 else 0 end )", $like ); |
| [340](#L340) | break; |
| [341](#L341) |  |
| [342](#L342) | case 'id': |
| [343](#L343) | $relevance\_array['id'][] = $wpdb->prepare( "( case when ( term\_source = 'id' AND term = '%s' ) then 300 else 0 end )", $search\_term ); |
| [344](#L344) | $relevance\_array['id'][] = $wpdb->prepare( "( case when ( term\_source = 'id' AND term LIKE %s ) then 5 else 0 end )", $like ); |
| [345](#L345) | break; |
| [346](#L346) |  |
| [347](#L347) | } |
| [348](#L348) |  |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) | } |
| [352](#L352) |  |
| [353](#L353) | // Sort 'relevance' queries in the array by search priority |
| [354](#L354) | foreach ( $search\_in\_arr as $search\_in\_item ) { |
| [355](#L355) | if ( isset( $relevance\_array[$search\_in\_item] ) ) { |
| [356](#L356) | $new\_relevance\_array[$search\_in\_item] = implode( ' + ', $relevance\_array[$search\_in\_item] ); |
| [357](#L357) | } |
| [358](#L358) | } |
| [359](#L359) |  |
| [360](#L360) | $query['select'] = ' distinct ID'; |
| [361](#L361) | $query['relevance'] = sprintf( ' (SUM( %s )) ', implode( ' + ', $new\_relevance\_array ) ); |
| [362](#L362) | $query['search'] = sprintf( ' AND ( %s )', implode( ' OR ', $search\_array ) ); |
| [363](#L363) |  |
| [364](#L364) |  |
| [365](#L365) | if ( $reindex\_version && version\_compare( $reindex\_version, '1.16', '>=' ) ) { |
| [366](#L366) |  |
| [367](#L367) | if ( $outofstock !== 'true' ) { |
| [368](#L368) | $query['stock'] = " AND in\_stock = 1"; |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | $query['visibility'] = " AND NOT visibility LIKE '%hidden%'"; |
| [372](#L372) |  |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) |  |
| [376](#L376) | /\*\* |
| [377](#L377) | \* Exclude certain products from search |
| [378](#L378) | \* |
| [379](#L379) | \* @since 1.58 |
| [380](#L380) | \* |
| [381](#L381) | \* @param array |
| [382](#L382) | \*/ |
| [383](#L383) | $exclude\_products\_filter = apply\_filters( 'aws\_exclude\_products', array() ); |
| [384](#L384) |  |
| [385](#L385) | if ( $exclude\_products\_filter && is\_array( $exclude\_products\_filter ) && ! empty( $exclude\_products\_filter ) ) { |
| [386](#L386) | $query['exclude\_products'] = sprintf( ' AND ( id NOT IN ( %s ) )', implode( ',', $exclude\_products\_filter ) ); |
| [387](#L387) | } |
| [388](#L388) |  |
| [389](#L389) |  |
| [390](#L390) | if ( $this->lang ) { |
| [391](#L391) | $current\_lang = $this->lang; |
| [392](#L392) | } else { |
| [393](#L393) | $current\_lang = AWS\_Helpers::get\_lang(); |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | /\*\* |
| [397](#L397) | \* Filter current language code |
| [398](#L398) | \* @since 1.59 |
| [399](#L399) | \* @param string $current\_lang Lang code |
| [400](#L400) | \*/ |
| [401](#L401) | $current\_lang = apply\_filters( 'aws\_search\_current\_lang', $current\_lang ); |
| [402](#L402) |  |
| [403](#L403) | if ( $current\_lang && $reindex\_version && version\_compare( $reindex\_version, '1.20', '>=' ) ) { |
| [404](#L404) | $query['lang'] = $wpdb->prepare( " AND ( lang LIKE %s OR lang = '' )", $current\_lang ); |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | /\*\* |
| [408](#L408) | \* Filter search query parameters |
| [409](#L409) | \* @since 1.67 |
| [410](#L410) | \* @param array $query Query parameters |
| [411](#L411) | \*/ |
| [412](#L412) | $query = apply\_filters( 'aws\_search\_query\_array', $query ); |
| [413](#L413) |  |
| [414](#L414) | $sql = "SELECT |
| [415](#L415) | {$query['select']}, |
| [416](#L416) | {$query['relevance']} as relevance |
| [417](#L417) | FROM |
| [418](#L418) | {$table\_name} |
| [419](#L419) | WHERE |
| [420](#L420) | 1=1 |
| [421](#L421) | {$query['search']} |
| [422](#L422) | {$query['stock']} |
| [423](#L423) | {$query['visibility']} |
| [424](#L424) | {$query['exclude\_products']} |
| [425](#L425) | {$query['lang']} |
| [426](#L426) | GROUP BY ID |
| [427](#L427) | having relevance > 0 |
| [428](#L428) | ORDER BY |
| [429](#L429) | relevance DESC, id DESC |
| [430](#L430) | LIMIT 0, {$results\_num} |
| [431](#L431) | "; |
| [432](#L432) |  |
| [433](#L433) | $this->data['sql'] = $sql; |
| [434](#L434) |  |
| [435](#L435) | $posts\_ids = $this->get\_posts\_ids( $sql ); |
| [436](#L436) |  |
| [437](#L437) | return $posts\_ids; |
| [438](#L438) |  |
| [439](#L439) | } |
| [440](#L440) |  |
| [441](#L441) | /\* |
| [442](#L442) | \* Get array of included to search result posts ids |
| [443](#L443) | \*/ |
| [444](#L444) | private function get\_posts\_ids( $sql ) { |
| [445](#L445) |  |
| [446](#L446) | global $wpdb; |
| [447](#L447) |  |
| [448](#L448) | $posts\_ids = array(); |
| [449](#L449) |  |
| [450](#L450) | $search\_results = $wpdb->get\_results( $sql ); |
| [451](#L451) |  |
| [452](#L452) |  |
| [453](#L453) | if ( !empty( $search\_results ) && !is\_wp\_error( $search\_results ) && is\_array( $search\_results ) ) { |
| [454](#L454) | foreach ( $search\_results as $search\_result ) { |
| [455](#L455) | $post\_id = intval( $search\_result->ID ); |
| [456](#L456) | if ( ! in\_array( $post\_id, $posts\_ids ) ) { |
| [457](#L457) | $posts\_ids[] = $post\_id; |
| [458](#L458) | } |
| [459](#L459) | } |
| [460](#L460) | } |
| [461](#L461) |  |
| [462](#L462) | unset( $search\_results ); |
| [463](#L463) |  |
| [464](#L464) | return $posts\_ids; |
| [465](#L465) |  |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | /\* |
| [469](#L469) | \* Get products info |
| [470](#L470) | \*/ |
| [471](#L471) | private function get\_products( $posts\_ids ) { |
| [472](#L472) |  |
| [473](#L473) | $products\_array = array(); |
| [474](#L474) |  |
| [475](#L475) | if ( count( $posts\_ids ) > 0 ) { |
| [476](#L476) |  |
| [477](#L477) | $show\_excerpt         = AWS()->get\_settings( 'show\_excerpt' ); |
| [478](#L478) | $excerpt\_source       = AWS()->get\_settings( 'desc\_source' ); |
| [479](#L479) | $excerpt\_length       = AWS()->get\_settings( 'excerpt\_length' ); |
| [480](#L480) | $desc\_scrap\_words     = AWS()->get\_settings( 'mark\_words' ); |
| [481](#L481) | $highlight\_words      = AWS()->get\_settings( 'highlight' ); |
| [482](#L482) | $show\_price           = AWS()->get\_settings( 'show\_price' ); |
| [483](#L483) | $show\_outofstockprice = AWS()->get\_settings( 'show\_outofstock\_price' ); |
| [484](#L484) | $show\_sale            = AWS()->get\_settings( 'show\_sale' ); |
| [485](#L485) | $show\_image           = AWS()->get\_settings( 'show\_image' ); |
| [486](#L486) | $show\_sku             = AWS()->get\_settings( 'show\_sku' ); |
| [487](#L487) | $show\_stock\_status    = AWS()->get\_settings( 'show\_stock' ); |
| [488](#L488) | $show\_featured        = AWS()->get\_settings( 'show\_featured' ); |
| [489](#L489) |  |
| [490](#L490) | $posts\_items = $posts\_ids; |
| [491](#L491) |  |
| [492](#L492) | foreach ( $posts\_items as $post\_item ) { |
| [493](#L493) |  |
| [494](#L494) | if ( ! is\_object( $post\_item ) ) { |
| [495](#L495) | $product = wc\_get\_product( $post\_item ); |
| [496](#L496) | } else { |
| [497](#L497) | $product = $post\_item; |
| [498](#L498) | } |
| [499](#L499) |  |
| [500](#L500) | if ( ! is\_a( $product, 'WC\_Product' ) ) { |
| [501](#L501) | continue; |
| [502](#L502) | } |
| [503](#L503) |  |
| [504](#L504) | $post\_id = method\_exists( $product, 'get\_id' ) ? $product->get\_id() : $post\_item; |
| [505](#L505) |  |
| [506](#L506) | /\*\* |
| [507](#L507) | \* Filter additional product data |
| [508](#L508) | \* @since 1.60 |
| [509](#L509) | \* @param array $this->data Additional data |
| [510](#L510) | \* @param int $post\_id Product id |
| [511](#L511) | \* @param object $product Product |
| [512](#L512) | \*/ |
| [513](#L513) | $this->data = apply\_filters( 'aws\_search\_data\_params', $this->data, $post\_id, $product ); |
| [514](#L514) |  |
| [515](#L515) | $post\_data = get\_post( $post\_id ); |
| [516](#L516) |  |
| [517](#L517) | $title = $product->get\_title(); |
| [518](#L518) | $title = AWS\_Helpers::html2txt( $title ); |
| [519](#L519) |  |
| [520](#L520) | $excerpt      = ''; |
| [521](#L521) | $price        = ''; |
| [522](#L522) | $on\_sale      = ''; |
| [523](#L523) | $image        = ''; |
| [524](#L524) | $sku          = ''; |
| [525](#L525) | $stock\_status = ''; |
| [526](#L526) | $featured     = ''; |
| [527](#L527) |  |
| [528](#L528) |  |
| [529](#L529) | if ( $show\_excerpt === 'true' ) { |
| [530](#L530) |  |
| [531](#L531) | $excerpt = ( $excerpt\_source === 'excerpt' && $post\_data->post\_excerpt ) ? $post\_data->post\_excerpt : $post\_data->post\_content; |
| [532](#L532) | $excerpt = AWS\_Helpers::html2txt( $excerpt ); |
| [533](#L533) | $excerpt = str\_replace('"', "'", $excerpt); |
| [534](#L534) | $excerpt = strip\_shortcodes( $excerpt ); |
| [535](#L535) | $excerpt = AWS\_Helpers::strip\_shortcodes( $excerpt ); |
| [536](#L536) |  |
| [537](#L537) | if ( $desc\_scrap\_words === 'true'  ) { |
| [538](#L538) |  |
| [539](#L539) | $marked\_content = $this->scrap\_content( $excerpt ); |
| [540](#L540) |  |
| [541](#L541) | if ( $marked\_content ) { |
| [542](#L542) | $excerpt = $marked\_content; |
| [543](#L543) | } else { |
| [544](#L544) | $excerpt = wp\_trim\_words( $excerpt, $excerpt\_length, '...' ); |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | } else { |
| [548](#L548) | $excerpt = wp\_trim\_words( $excerpt, $excerpt\_length, '...' ); |
| [549](#L549) | } |
| [550](#L550) |  |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) |  |
| [554](#L554) | if ( $show\_price === 'true' && ( $product->is\_in\_stock() || ( ! $product->is\_in\_stock() && $show\_outofstockprice === 'true' ) ) ) { |
| [555](#L555) | $price = $product->get\_price\_html(); |
| [556](#L556) | $price = preg\_replace("/<a\s(.+?)>(.+?)<\/a>/is", "<span>$2</span>", $price); |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | if ( $show\_sale === 'true' && ( $product->is\_in\_stock() || ( ! $product->is\_in\_stock() && $show\_outofstockprice === 'true' ) ) ) { |
| [560](#L560) | $on\_sale = $product->is\_on\_sale(); |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) | if ( $show\_image === 'true' ) { |
| [564](#L564) | $image\_id = $product->get\_image\_id(); |
| [565](#L565) | $image\_attributes = wp\_get\_attachment\_image\_src( $image\_id ); |
| [566](#L566) | $image = $image\_attributes[0]; |
| [567](#L567) | } |
| [568](#L568) |  |
| [569](#L569) | if ( $show\_sku === 'true' ) { |
| [570](#L570) | $sku = $product->get\_sku(); |
| [571](#L571) | } |
| [572](#L572) |  |
| [573](#L573) | if ( $show\_featured === 'true' ) { |
| [574](#L574) | $featured = $product->is\_featured(); |
| [575](#L575) | } |
| [576](#L576) |  |
| [577](#L577) | if ( $show\_stock\_status === 'true' ) { |
| [578](#L578) | if ( $product->is\_in\_stock() ) { |
| [579](#L579) | $stock\_status = array( |
| [580](#L580) | 'status' => true, |
| [581](#L581) | 'text'   => esc\_html\_\_( 'In stock', 'advanced-woo-search' ) |
| [582](#L582) | ); |
| [583](#L583) | } else { |
| [584](#L584) | $stock\_status = array( |
| [585](#L585) | 'status' => false, |
| [586](#L586) | 'text'   => esc\_html\_\_( 'Out of stock', 'advanced-woo-search' ) |
| [587](#L587) | ); |
| [588](#L588) | } |
| [589](#L589) | } |
| [590](#L590) |  |
| [591](#L591) | if ( method\_exists( $product, 'get\_price' ) ) { |
| [592](#L592) | $f\_price = $product->get\_price(); |
| [593](#L593) | } |
| [594](#L594) |  |
| [595](#L595) | if ( method\_exists( $product, 'get\_average\_rating' ) ) { |
| [596](#L596) | $f\_rating  = $product->get\_average\_rating(); |
| [597](#L597) | } |
| [598](#L598) |  |
| [599](#L599) | if ( method\_exists( $product,'get\_review\_count' ) ) { |
| [600](#L600) | $f\_reviews = $product->get\_review\_count(); |
| [601](#L601) | } |
| [602](#L602) |  |
| [603](#L603) | //                    $categories = $product->get\_categories( ',' ); |
| [604](#L604) | //                    $tags = $product->get\_tags( ',' ); |
| [605](#L605) |  |
| [606](#L606) | if ( $highlight\_words === 'true'  ) { |
| [607](#L607) | $title   = $this->highlight\_words( $title ); |
| [608](#L608) | $excerpt = $this->highlight\_words( $excerpt ); |
| [609](#L609) | $sku     = $this->highlight\_words( $sku ); |
| [610](#L610) | } |
| [611](#L611) |  |
| [612](#L612) | $title   = apply\_filters( 'aws\_title\_search\_result', $title, $post\_id, $product ); |
| [613](#L613) | $excerpt = apply\_filters( 'aws\_excerpt\_search\_result', $excerpt, $post\_id, $product ); |
| [614](#L614) |  |
| [615](#L615) | $new\_result = array( |
| [616](#L616) | 'id'           => $post\_id, |
| [617](#L617) | 'title'        => $title, |
| [618](#L618) | 'excerpt'      => $excerpt, |
| [619](#L619) | 'link'         => get\_permalink( $post\_id ), |
| [620](#L620) | 'image'        => $image, |
| [621](#L621) | 'price'        => $price, |
| [622](#L622) | 'on\_sale'      => $on\_sale, |
| [623](#L623) | 'sku'          => $sku, |
| [624](#L624) | 'stock\_status' => $stock\_status, |
| [625](#L625) | 'featured'     => $featured, |
| [626](#L626) | 'f\_price'      => $f\_price, |
| [627](#L627) | 'f\_rating'     => $f\_rating, |
| [628](#L628) | 'f\_reviews'    => $f\_reviews, |
| [629](#L629) | 'post\_data'    => $post\_data |
| [630](#L630) | ); |
| [631](#L631) |  |
| [632](#L632) | $products\_array[] = $new\_result; |
| [633](#L633) | } |
| [634](#L634) |  |
| [635](#L635) | } |
| [636](#L636) |  |
| [637](#L637) | /\*\* |
| [638](#L638) | \* Filter products array before output |
| [639](#L639) | \* @since 1.60 |
| [640](#L640) | \* @param array $products\_array Products array |
| [641](#L641) | \* @param array $this->data Additional data |
| [642](#L642) | \*/ |
| [643](#L643) | $products\_array = apply\_filters( 'aws\_search\_pre\_filter\_products', $products\_array, $this->data ); |
| [644](#L644) |  |
| [645](#L645) | return $products\_array; |
| [646](#L646) |  |
| [647](#L647) | } |
| [648](#L648) |  |
| [649](#L649) | /\* |
| [650](#L650) | \* Scrap content excerpt |
| [651](#L651) | \*/ |
| [652](#L652) | private function scrap\_content( $content ) { |
| [653](#L653) |  |
| [654](#L654) | $exact\_words = array(); |
| [655](#L655) | $words = array(); |
| [656](#L656) |  |
| [657](#L657) | foreach( $this->data['search\_terms'] as $search\_in ) { |
| [658](#L658) |  |
| [659](#L659) | $exact\_words[] = '\b' . $search\_in . '\b'; |
| [660](#L660) |  |
| [661](#L661) | if ( strlen( $search\_in ) > 1 ) { |
| [662](#L662) | $words[] = $search\_in; |
| [663](#L663) | } else { |
| [664](#L664) | $words[] = '\b' . $search\_in . '\b'; |
| [665](#L665) | } |
| [666](#L666) |  |
| [667](#L667) | } |
| [668](#L668) |  |
| [669](#L669) | usort( $exact\_words, array( $this, 'sort\_by\_length' ) ); |
| [670](#L670) | $exact\_words = implode( '|', $exact\_words ); |
| [671](#L671) |  |
| [672](#L672) | usort( $words, array( $this, 'sort\_by\_length' ) ); |
| [673](#L673) | $words = implode( '|', $words ); |
| [674](#L674) |  |
| [675](#L675) | preg\_match( '/([^.?!]\*?)(' . $exact\_words . '){1}(.\*?[.!?])/i', $content, $matches ); |
| [676](#L676) |  |
| [677](#L677) | if ( ! isset( $matches[0] ) ) { |
| [678](#L678) | preg\_match( '/([^.?!]\*?)(' . $words . '){1}(.\*?[.!?])/i', $content, $matches ); |
| [679](#L679) | } |
| [680](#L680) |  |
| [681](#L681) | if ( ! isset( $matches[0] ) ) { |
| [682](#L682) | preg\_match( '/([^.?!]\*?)(.\*?)(.\*?[.!?])/i', $content, $matches ); |
| [683](#L683) | } |
| [684](#L684) |  |
| [685](#L685) | if ( isset( $matches[0] ) ) { |
| [686](#L686) |  |
| [687](#L687) | $content = $matches[0]; |
| [688](#L688) |  |
| [689](#L689) | // Trim to long content |
| [690](#L690) | if (str\_word\_count(strip\_tags($content)) > 34) { |
| [691](#L691) |  |
| [692](#L692) | if (str\_word\_count(strip\_tags($matches[3])) > 34) { |
| [693](#L693) | $matches[3] = wp\_trim\_words($matches[3], 30, '...'); |
| [694](#L694) | } |
| [695](#L695) |  |
| [696](#L696) | $content = '...' . $matches[2] . $matches[3]; |
| [697](#L697) |  |
| [698](#L698) | } |
| [699](#L699) |  |
| [700](#L700) | } else { |
| [701](#L701) |  |
| [702](#L702) | $content = ''; |
| [703](#L703) |  |
| [704](#L704) | } |
| [705](#L705) |  |
| [706](#L706) | return $content; |
| [707](#L707) |  |
| [708](#L708) | } |
| [709](#L709) |  |
| [710](#L710) | /\* |
| [711](#L711) | \* Highlight search words |
| [712](#L712) | \*/ |
| [713](#L713) | private function highlight\_words( $text ) { |
| [714](#L714) |  |
| [715](#L715) | if ( ! $text ) { |
| [716](#L716) | return $text; |
| [717](#L717) | } |
| [718](#L718) |  |
| [719](#L719) | $pattern = array(); |
| [720](#L720) |  |
| [721](#L721) | foreach( $this->data['search\_terms'] as $search\_in ) { |
| [722](#L722) |  |
| [723](#L723) | if ( strlen( $search\_in ) > 1 ) { |
| [724](#L724) | $pattern[] = '(' . $search\_in . ')+'; |
| [725](#L725) | } else { |
| [726](#L726) | $pattern[] = '\b[' . $search\_in . ']{1}\b'; |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) | usort( $pattern, array( $this, 'sort\_by\_length' ) ); |
| [732](#L732) | $pattern = implode( '|', $pattern ); |
| [733](#L733) | $pattern = sprintf( '/%s/i', $pattern ); |
| [734](#L734) |  |
| [735](#L735) | /\*\* |
| [736](#L736) | \* Tag to use for highlighting search words inside content |
| [737](#L737) | \* @since 1.88 |
| [738](#L738) | \* @param string Tag for highlighting |
| [739](#L739) | \*/ |
| [740](#L740) | $highlight\_tag = apply\_filters( 'aws\_highlight\_tag', 'strong' ); |
| [741](#L741) |  |
| [742](#L742) | $highlight\_tag\_pattern = '<' . $highlight\_tag . '>${0}</' . $highlight\_tag . '>'; |
| [743](#L743) |  |
| [744](#L744) | $text = preg\_replace($pattern, $highlight\_tag\_pattern, $text ); |
| [745](#L745) |  |
| [746](#L746) | return $text; |
| [747](#L747) |  |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) | /\* |
| [751](#L751) | \* Sort array by its values length |
| [752](#L752) | \*/ |
| [753](#L753) | private function sort\_by\_length( $a, $b ) { |
| [754](#L754) | return strlen( $b ) - strlen( $a ); |
| [755](#L755) | } |
| [756](#L756) |  |
| [757](#L757) | } |
| [758](#L758) |  |
| [759](#L759) |  |
| [760](#L760) | endif; |
| [761](#L761) |  |
| [762](#L762) | AWS\_Search::factory(); |
| [763](#L763) |  |
| [764](#L764) | function aws\_search( $keyword = '' ) { |
| [765](#L765) | return AWS\_Search::factory()->search( $keyword ); |
| [766](#L766) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/advanced-woo-search/tags/2.00/includes/class-aws-search.php?rev=2290090&format=txt)
* [Original Format](/export/2290090/advanced-woo-search/tags/2.00/includes/class-aws-search.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_697f1e43_20250119_110701.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Advanced Woo Search

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fadvanced-woo-search&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fadvanced-woo-search&locale=en_US)

Search plugins

![](https://ps.w.org/advanced-woo-search/assets/banner-772x250.jpg?rev=2244825)
![](https://ps.w.org/advanced-woo-search/assets/icon-128x128.jpg?rev=2244825)
# Advanced Woo Search

By [ILLID](https://advanced-woo-search.com/)

[Download](https://downloads.wordpress.org/plugin/advanced-woo-search.3.24.zip)

* [Details](https://wordpress.org/plugins/advanced-woo-search/#description)
* [Reviews](https://wordpress.org/plugins/advanced-woo-search/#reviews)
* [Installation](https://wordpress.org/plugins/advanced-woo-search/#installation)
* [Development](https://wordpress.org/plugins/advanced-woo-search/#developers)

[Support](https://wordpress.org/support/plugin/advanced-woo-search/)

## Description

Advanced Woo Search – powerful search plugin for WooCommerce. Supports **AJAX** search and **search results page** display.

[Plugin home page](https://advanced-woo-search.com/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo) | [Features List](https://advanced-woo-search.com/features/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo) | [Docs](https://advanced-woo-search.com/guide/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo)

### Main Features

* **Products search** – Search across all your WooCommerce products
* **Search in** – Search in product **title**, **content**, **excerpt**, **categories**, **tags**, **ID** and **sku**. Or just in some of them
* **Terms search** – Search for product categories and tags
* **Smart ordering** – Search results ordered by the priority of source where they were found
* Supports **variable products**
* **Plurals** support
* **Synonyms** support
* **Misspelling** correction ( fuzzy search )
* **Search results page** support. Plugin search results will be integrated to your current page layout.
* **Settings page** – User-friendly settings page with lot of options
* **Shortcode** and **widget** – Use shortcode and widget to place search box anywhere you want
* **Product image** – Each search result contains product image
* **Product price** – Each search result contains product price
* **Fast** – Nothing extra. Just what you need for proper work
* **Stop Words** support to exclude certain words from search.
* Automatically synchronize all product data. No need to re-index all content manually after every change.
* Diacritical marks support
* Google Analytics support
* Seamless integration option for easy replacing your current search form
* **WPML**, **Polylang**, **WooCommerce Multilingual**, **qTranslate**, **GTranslate**, etc. support
* **WPML multi-currency** support
* Page builder plugins support: Gutenberg, Elementor, Beaver Builder, WPBakery, Divi Builder
* Custom Product Tabs for WooCommerce plugin support
* Search Exclude plugin support

### Premium Features

Additional features available only in the PRO plugin version.

* Search **results layouts**
* Search **form layouts**
* **Filters**. Switch between tabs to show different search results
* **Unlimited** amount of search form instances
* Search for custom taxonomies and attributes **archive pages**
* Support for **variable products**: show child products, parent product or both in search results.
* Product **attributes** search ( including custom attributes)
* Product **custom taxonomies** search
* Product **custom fields** search
* **Users** search
* **Advanced settings page** with lot of options
* **Exclude/include** specific products by its ids, taxonomies or attributes from search results
* Ability to specify **source of image** for search results: featured image, gallery, product content, product short description or set default image if there is no other images
* **Visibility/stock status option** – choose what catalog visibility and stock status must be for product to displayed in search results
* Show product **categories** and **tags** in search results
* AND or OR search logic
* **Add to cart** button in search results
* Support for [WooCommerce Brands plugin](https://woocommerce.com/products/brands/)
* Support for **Advanced Custom Fields** plugin
* Support for **WCFM – WooCommerce Multivendor Marketplace** plugin
* Support for **Dokan – WooCommerce Multivendor Marketplace** plugin
* Support for **MultiVendorX – Multivendor Marketplace** plugin
* And the [huge list of other integrations](https://advanced-woo-search.com/guide-category/integrations/)

[Features list](https://advanced-woo-search.com/features/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo)

### More Plugins From Us

Here are some additional plugins that were made with love.

* [Advanced Woo Labels](https://wordpress.org/plugins/advanced-woo-labels/) – advanced labels for WooCommerce products
* [Share This Image](https://wordpress.org/plugins/share-this-image/) – image sharing plugin

### More useful links

* Plugin [homepage](https://advanced-woo-search.com/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo).
* Plugin [documentation](https://advanced-woo-search.com/guide/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo).
* Follow Advanced Woo Search on [Twitter](https://twitter.com/WooSearch)

## Screenshots

* [![](https://ps.w.org/advanced-woo-search/assets/screenshot-1.png?rev=1871423)](https://ps.w.org/advanced-woo-search/assets/screenshot-1.png?rev=1871423)

  Search from front-end view
* [![](https://ps.w.org/advanced-woo-search/assets/screenshot-2.png?rev=1919749)](https://ps.w.org/advanced-woo-search/assets/screenshot-2.png?rev=1919749)

  Search form in sidebar added as widget
* [![](https://ps.w.org/advanced-woo-search/assets/screenshot-3.png?rev=1919749)](https://ps.w.org/advanced-woo-search/assets/screenshot-3.png?rev=1919749)

  Plugin settings page. General options
* [![](https://ps.w.org/advanced-woo-search/assets/screenshot-4.png?rev=1919749)](https://ps.w.org/advanced-woo-search/assets/screenshot-4.png?rev=1919749)

  Plugin settings page. Search form options
* [![](https://ps.w.org/advanced-woo-search/assets/screenshot-5.png?rev=1919749)](https://ps.w.org/advanced-woo-search/assets/screenshot-5.png?rev=1919749)

  Plugin settings page. Search results options

## Blocks

This plugin provides 1 block.

* Search Form

## Installation

1. Upload advanced-woo-search to the /wp-content/plugins/ directory
2. Activate the plugin through the ‘Plugins’ menu in WordPress
3. Place the plugin shortcode [aws\_search\_form] into your template or post-page or just use build-in widget

## FAQ

Please visit our [Advanced Woo Search guide](https://advanced-woo-search.com/guide/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo) before requesting any support.

### What is Advanced Woo Search?

Advanced Woo Search as is advanced search plugin for WooCommerce shops. Its packed with many usefull features like:

* Search by product title, content, short description, SKU, tags, categories, ID, custom fields, attributes, taxonomies.
* Support for variable product and its variations.
* Multilingual plugins support.
* Search and display product tags, categories, custom taxonomies.
* and many more…

Please visit [features page](https://advanced-woo-search.com/features/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo) for full list of available features.

### What are the requirements to use Advanced Woo Search?

Advanced Woo Search is a plugin for self-hosted WordPress sites, or wordpress.com hosted sites that allow installation of third party plugins.

Plugin requires the following at minimum to work properly:

* WordPress 4.0 or greater
* WooCommerce 3.0.0 or greater
* PHP 5.5 or greater
* MySQL 5.6 or MariaDB 10.0 or greater
* Apache or Nginx server (recommended, but other options may work as well)

### How to insert search form?

There are several ways you can add plugins search form on your site. The simplest way – is by turning on the **Seamless integration** option from the plugins settings page.

You can also use build-in widget to place plugins search form to your sidebar or any other available widget area.

Or just use shortcode for displaying form inside your post/page:

```
[aws_search_form]

```

Or insert this function inside php file ( often it used to insert form inside page templates files ):

```
echo do_shortcode( '[aws_search_form]' );

```

Also please read the guide article about search form placement: [Adding Search Form.](https://advanced-woo-search.com/guide/search-form/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo)

### What is the steps to make this plugin works on my site?

In order to start using the plugin search form you need to take following steps:

* **Installation**. Install and activate the plugin. You can follow [these steps](https://advanced-woo-search.com/guide/installation/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo) if you face any problems.
* **Index plugin table**. Click on the **Reindex table** button inside the plugin settings page and wait till the index process is finished.
* **Set plugin settings**. Leave it to default values or customize some of them.
* **Add search form**. There are several ways you can add a search form to your site. Use the **Seamless integration** option, shortcode, widget or custom php function. Read more in the guide article: [Adding Search Form](https://advanced-woo-search.com/guide/search-form/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo).
* **Finish!** Now all is set and you can check your search form on the pages where you add it.

### Will this plugin work with my theme?

Plugin search will works with most of the available WordPress themes. If you faced any problems using the plugin with your theme please [contact support](https://advanced-woo-search.com/contact/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo).

### Is it integrated with my plugin?

Advanced Woo Search works with many plugins out-of-the-box. For some of the most popular plugins we manually check proper work of integration features. It is the plugins like **Advanced Custom Fields**, **WPML**, **Polylang**, **Elementor**, **Divi Builder**, **BeRocket AJAX Product Filters**, **FacetWP** and many more.

Please read some guide integrations articles: [Integrations](https://advanced-woo-search.com/guide-category/integrations/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo).

Note that if some of the plugin is not presented in the list it doesn’t mean that it will not work with Advanced Woo Search. Many plugins will just work without any extra effort. But if you find any problem with your plugin and Advanced Woo Search please [contact support team](https://advanced-woo-search.com/contact/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo).

### Is this plugin compatible with latest version of Woocommerce?

Yep. This plugin is always compatible with the latest version of Woocommerce?

## Reviews

![](https://secure.gravatar.com/avatar/3a0fb9d1be5969b62b0d09ba696cb14aa16cc7de3b8ee6ad414287edd3ea5be0?s=60&d=retro&r=g)
### [Excellent Support](https://wordpress.org/support/topic/excellent-support-2368/)

[austinelecross](https://profiles.wordpress.org/austinelecross/ "Posts by austinelecross")
November 14, 2024

Great plugin and even better support team

![](https://secure.gravatar.com/avatar/a781bdac59bfdb532e422bcf5c2dc301f433af32d387fb41ce59249973833d03?s=60&d=retro&r=g)
### [great plugin and even greater support](https://wordpress.org/support/topic/great-plugin-and-even-greater-support-28/)

[srjj](https://profiles.wordpress.org/srjj/ "Posts by srjj")
October 11, 2024

We loved the support for this plugin.
The developer took the time to resolve a specific requirement for our site.
Thank you!

![](https://secure.gravatar.com/avatar/acc62bf85c3867fd2430e22bf1ca57bf271f9c02adb96e252f7d1a602e445d4c?s=60&d=retro&r=g)
### [Advanced WooSearch Plugin](https://wordpress.org/support/topic/advanced-woosearch-plugin/)

[webberzprg](https://profiles.wordpress.org/webberzprg/ "Posts by webberzprg")
October 3, 2024

Advanced Woo Search is a great plugin and the author support is great even for the Free versions.I would recommend to all my clients.

![](https://secure.gravatar.com/avatar/b1f3847718a35ab3c538738ad77c6d712e5ed92e121f1f1d1c0b2f379117bebd?s=60&d=retro&r=g)
### [Best plugin](https://wordpress.org/support/topic/best-plugin-1416/)

[chagitkremer](https://profiles.wordpress.org/chagitkremer/ "Posts by chagitkremer")
September 16, 2024

The best search plugin.By purchasing the pro I received an excellent product and fast and great support.
Thank you very much

![](https://secure.gravatar.com/avatar/272c72c32562c140f225426510d9123d75ac6c8ebb87c2aeae4331e5c5bb8cf7?s=60&d=retro&r=g)
### [adding wordpress search result to product search](https://wordpress.org/support/topic/adding-wordpress-search-result-to-product-search/)

[yusufcivir](https://profiles.wordpress.org/yusufcivir/ "Posts by yusufcivir")
September 3, 2024
1 reply

Hello everyone,
is there any way to adding wordpress search result to product search with this plugin? I want to just 1 searchbox that provide search anything.
Please help,
Thanks.

![](https://secure.gravatar.com/avatar/c6bd92f22c32eccb565ce954f4dbd2b7fcda7512e20ab1580a9c3635ee2ff2c7?s=60&d=retro&r=g)
### [Highly configurable!](https://wordpress.org/support/topic/highly-configurable-10/)

[thewebsitesupply](https://profiles.wordpress.org/thewebsitesupply/ "Posts by thewebsitesupply")
July 6, 2024

Great support too with the pro version!

[Read all 231 reviews](https://wordpress.org/support/plugin/advanced-woo-search/reviews/)
## Contributors & Developers

“Advanced Woo Search” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/e4c01de3f3f568ce8cabeb4204db4a766a61f2c6f7e3ccd83bc8f4fb51138a09?s=32&d=mm&r=g) [ILLID](https://profiles.wordpress.org/mihail-barinov/)

“Advanced Woo Search” has been translated into 3 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/advanced-woo-search/contributors) for their contributions.

[Translate “Advanced Woo Search” into your language.](https://translate.wordpress.org/projects/wp-plugins/advanced-woo-search)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/advanced-woo-search/), check out the [SVN repository](https://plugins.svn.wordpress.org/advanced-woo-search/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/advanced-woo-search/) by [RSS](https://plugins.trac.wordpress.org/log/advanced-woo-search/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

[View full changelog](https://advanced-woo-search.com/guide/free-version/?utm_source=wp-repo&utm_medium=listing&utm_campaign=aws-repo)

#### 3.24 ( 2024-12-30 )

* Update – Tested with WC 9.5
* Update – Settings page pro block description

#### 3.23 ( 2024-12-16 )

* Add – New shortcodes for similar terms, search terms
* Fix – Integration with Yoast Premium plugin. Allow additional parameters for permalinks
* Dev – Update forceNewSearch method to use additional parameters

#### 3.22 ( 2024-11-29 )

* Update – Settings page descriptions

#### 3.21 ( 2024-11-26 )

* Update – Tested with WC 9.4
* Update – Improve search speed and update index table structure
* Update – Structure of cache table
* Dev – Update conditions for table check

#### 3.20 ( 2024-11-11 )

* Update – Integration with YITH WooCommerce Ajax Product Filter plugin
* Update – Taxonomies search when using Begins search logic
* Fix – Bug with diacritical characters replacement

#### 3.19 ( 2024-10-28 )

* Update – Add different search rules for taxonomies search
* Update – Styles for search form. Fix min height for input
* Dev – Add aws\_search\_custom\_top\_results filter

#### 3.18 ( 2024-10-14 )

* Add – Support for Jet Blocks plugin search widget
* Update – Support for Italian language
* Update – Admin page notices about integrations
* Dev – Update the structure of plugin tables

#### 3.17 ( 2024-10-01 )

* Add – Support for Shopical theme
* Add – Support for WooCommerce Product Table by Barn2 plugin
* Fix – Index duplicated products when using WPML plugin
* Fix – Bug with quick edit feature when using WPML plugin
* Dev – New check for currently active plugins

#### 3.16 ( 2024-09-16 )

* Add – Greek to latin characters replace
* Add – Plurals support for different languages
* Add – Support for Breakdance plugin
* Update – Tested with WC 9.3
* Update – On page stock status and sale filters
* Fix – Show clear button on first search when ajax is disabled

#### 3.15 ( 2024-09-02 )

* Update – Tested with WC 9.2
* Update – Add new parameters for orderby
* Update – Settings page text
* Fix – Filter by attributes for the search page. Fix filtering by slugs with integers inside
* Dev – Add additional check for product IDs inside search page

#### 3.14 ( 2024-08-12 )

* Update – Integration with Oxygen theme
* Fix – Filtering for search results page when using slugs with numbers inside URL for terms
* Fix – Add new parameters for orderby function
* Fix – Automatically index products that were restored from the trash
* Dev – Fix functions naming

#### 3.13 ( 2024-08-05 )

* Add – Integration with EAN for WooCommerce by WPFactory plugin
* Fix – Bug with search results filtering via third party plugins
* Fix – Bug when filtering product variations on search results page
* Dev – New function to get current page id

#### 3.12 ( 2024-07-19 )

* Fix – Bug with search results page taxonomies filters

#### 3.11 ( 2024-07-15 )

* Add – Support for Filter Everything plugin
* Update – Tested with WC 9.1
* Update – Integration with WooCommerce Product Filter by WooBeWoo plugin
* Update – Integration with Product Filters for WooCommerce plugin
* Update – Integration with YITH WooCommerce Ajax Product Filter plugin
* Update – Integration with BeRocket WooCommerce AJAX Products Filter plugin
* Update – Filter for search results page. Inherit tax\_query parameters
* Update – Integration with Avada theme. Move js scripts to footer
* Update – Integration with The7 theme. Fix submit button for search forms
* Update – Admin notice about reindex on first plugin activation
* Fix – Bug with calling search function inside wp admin orders page

#### 3.10 ( 2024-07-01 )

* Add – New option to show fixed terms list inside search results
* Add – Support for Hitek theme
* Update – Change default value for Form Styling option
* Update – Tested with WC 9.0
* Update – Integration with Bricks theme
* Fix – Return content and short description for post object inside search page
* Dev – Add aws\_search\_fixed\_terms\_suggestions\_num filter
* Dev – Add js event aws\_search\_force to force search with specific terms
* Dev – Add old/new pairs for similar terms output
* Dev – Add generate\_combinations helper function
* Dev – Add aws\_search\_page\_posts\_objects\_ids filter hook
* Dev – Add aws\_search\_notices filter

#### 3.09 ( 2024-06-17 )

* Add – Support for The7 theme
* Update – Integration with Shoptimizer theme
* Fix – Disable misspelling fix for numeric search terms
* Dev – Add new parameter for aws\_search\_results\_products\_ids filter
* Dev – Add aws\_search\_no\_results filter
* Dev – Add aws\_search\_custom\_results\_data and aws\_search\_top\_text filters

#### 3.08 ( 2024-06-05 )

* Add – Integration for YITH WooCommerce Ajax Product Filter plugin
* Update – Speed up search results page
* Update – Integration with WOOF plugin
* Update – Tested with WC 8.9
* Update – Reduce the size of search results output
* Fix – FaceWP plugin integration fix
* Fix – Misspelling function now respect search terms sources
* Dev – Replace aws\_products\_search\_page\_filtered and aws\_products\_order hooks
* Dev – Add show\_wcfm\_badge filter
* Dev – Update aws\_searchpage\_enabled function

#### 3.07 ( 2024-05-20 )

* Add – Header for plugin admin page

#### 3.06 ( 2024-05-06 )

* Add – Required plugins dependencies
* Update – Formula to calculate relevance score
* Update – Support for Zephyr theme
* Dev – New class for terms suggestions

#### 3.05 ( 2024-04-22 )

* Add – Feature to fix misspellings inside search queries
* Add – Support for Open Shop theme
* Add – Support for Advance Product Search by themehunk
* Update – Tested with WC 8.8
* Fix – Search results sorting inside results page when using custom filters

#### 3.04 ( 2024-04-08 )

* Add – Support for WooCommerce Product Search plugin
* Update – Values for search page filters

#### 3.03 ( 2024-03-25 )

* Update – Tested with WC 8.7
* Update – Add loading icon for clear cache button inside settings page
* Update – New values for orderby for better integration with themes
* Fix – Bug with adding new products during index process

#### 3.02 ( 2024-03-12 )

* Update – Integration for WPML plugin. Fix indexation for product taxonomies
* Dev – Add aws\_index\_before\_scrapping and aws\_index\_after\_scrapping hooks

#### 3.01 ( 2024-02-26 )

* Update – Tested with WC 8.6
* Update – Indexation for synonyms phrases
* Fix – Bug with search results page integration with Elementor

#### 3.00 ( 2024-02-12 )

* Add – New option to limit maximal number of search words

#### 2.99 ( 2024-02-05 )

* Update – Plugin settings page. Set minimal values for some options
* Update – Support for Elessi theme. Fix shop filters
* Dev – Add aws\_admin\_capability filter

#### 2.98 ( 2024-01-22 )

* Update – Remove plugin options during uninstall

#### 2.97 ( 2024-01-10 )

* Update – Notices about plugin integrations
* Update – Tested with WC 8.5
* Update – Integration with Dynamic Content for Elementor plugin
* Fix – FacetWP plugin issue with pagination

#### 2.96 ( 2024-01-08 )

* Update – SQL query for taxonomies search results. Speed up search for multilingual results
* Update – Woodmart theme support. Fix seamless integration for header

#### 2.95 ( 2023-12-25 )

* Add – Support for WooCommerce Show Single Variations by Iconic plugin
* Update – Tested with WC 8.4
* Update – Integration with GA4
* Dev – Add awsAnalytics js event

#### 2.94 ( 2023-12-12 )

* Add – Support for WooCommerce Memberships plugin
* Update – Notices about plugin integrations

#### 2.93 ( 2023-11-27 )

* Update – WCFM plugin integration. Fix search form on stores list page sidebar
* Update – Tested with WC 8.3
* Fix – Integration with Elessi theme. Fix search form after using shop filters
* Dev – Add aws\_index\_started action

#### 2.92 ( 2023-11-14 )

* Add – Support for Hestia theme

#### 2.91 ( 2023-10-30 )

* Update – Support for Astra theme. Fix broken search form in the header

#### 2.90 ( 2023-10-16 )

* Update – Tested with WC 8.2
* Fix – Pricing filter for default WooCommerce widgets

#### 2.89 ( 2023-09-29 )

* Add – Support for Sinatra theme. Enable seamless integration for search form in the header
* Update – Add taxonomies class names inside search results blocks

#### 2.88 ( 2023-09-18 )

* Add – Support for Kapee theme
* Update – Tested with WC 8.1
* Fix – Fix label search form styles for mobile devices
* Dev – Fix php notice with dynamically created child\_theme property
* Dev – Add aws\_relevance\_parameters filter

#### 2.87 ( 2023-09-04 )

* Add – Support for WooCommerce Products Visibility plugin
* Update – Support for BeRocket WooCommerce AJAX Products Filter plugin. Fix filters when nice URLs is enabled
* Update – Support for HUSKY plugin. Fix filtering issue for custom taxonomies
* Fix – Display On backorder product stock status when needed
* Dev – Update aws\_results\_html js hook. Add new property – translate
* Dev – Add aws\_search\_tax\_result\_item filter

## Meta

* Version **3.24**
* Last updated **3 weeks ago**
* Active installations **70,000+**
* WordPress version **4.0 or higher**
* Tested up to **6.7.1**
* Languages
  See all 4

  Close

  [English (US)](https://wordpress.org/plugins/advanced-woo-search/), [Hebrew](https://he.wordpress.org/plugins/advanced-woo-search/), [Spanish (Argentina)](https://es-ar.wordpress.org/plugins/advanced-woo-search/), and [Spanish (Spain)](https://es.wordpress.org/plugins/advanced-woo-search/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/advanced-woo-search)
* Tags [live search](https://wordpress.org/plugins/tags/live-search/)[product search](https://wordpress.org/plugins/tags/product-search/)[search](https://wordpress.org/plugins/tags/search/)[woocommerce](https://wordpress.org/plugins/tags/woocommerce/)[woocommerce search](https://wordpress.org/plugins/tags/woocommerce-search/)
* [Advanced View](https://wordpress.org/plugins/advanced-woo-search/advanced/)

## Ratings

4.8 out of 5 stars.

* [216 5-star reviews
  5 stars

  216](https://wordpress.org/support/plugin/advanced-woo-search/reviews/?filter=5)
* [3 4-star reviews
  4 stars

  3](https://wordpress.org/support/plugin/advanced-woo-search/reviews/?filter=4)
* [3 3-star reviews
  3 stars

  3](https://wordpress.org/support/plugin/advanced-woo-search/reviews/?filter=3)
* [2 2-star reviews
  2 stars

  2](https://wordpress.org/support/plugin/advanced-woo-search/reviews/?filter=2)
* [7 1-star reviews
  1 star

  7](https://wordpress.org/support/plugin/advanced-woo-search/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/advanced-woo-search/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/advanced-woo-search/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/e4c01de3f3f568ce8cabeb4204db4a766a61f2c6f7e3ccd83bc8f4fb51138a09?s=32&d=mm&r=g) [ILLID](https://profiles.wordpress.org/mihail-barinov/)
## Support

Issues resolved in last two months:

11 out of 14

[View support forum](https://wordpress.org/support/plugin/advanced-woo-search/)

## Donate

Would you like to support the advancement of this plugin?

[Donate to this plugin](https://www.paypal.com/donate/?hosted_button_id=FDRDNZE6XAKE8)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_0cccc216_20250119_110633.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fadvanced-woo-search%2Ftags%2F1.99%2Fincludes%2Fclass-aws-search.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/advanced-woo-search/tags/1.99/includes/class-aws-search.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/advanced-woo-search/tags/1.99/includes/class-aws-search.php)

---

# [source:](/browser?order=name "Go to repository root") [advanced-woo-search](/browser/advanced-woo-search?order=name "View advanced-woo-search")/[tags](/browser/advanced-woo-search/tags?order=name "View tags")/[1.99](/browser/advanced-woo-search/tags/1.99?order=name "View 1.99")/[includes](/browser/advanced-woo-search/tags/1.99/includes?order=name "View includes")/[class-aws-search.php](/browser/advanced-woo-search/tags/1.99/includes/class-aws-search.php?order=name "View class-aws-search.php")

View diff against:

View revision:

| [Last change](/changeset/2287358/advanced-woo-search/tags/1.99/includes/class-aws-search.php "View differences") on this file was [2287358](/changeset/2287358/ "View changeset 2287358"), checked in by Mihail Barinov, [5 years ago](/timeline?from=2020-04-20T11%3A25%3A26Z&precision=second "See timeline at 04/20/2020 11:25:26 AM") |
| --- |
| Version 1.99 |
| **File size:** 27.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { |
| [4](#L4) | exit; |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | if ( ! class\_exists( 'AWS\_Search' ) ) : |
| [8](#L8) |  |
| [9](#L9) | /\*\* |
| [10](#L10) | \* Class for plugin search |
| [11](#L11) | \*/ |
| [12](#L12) | class AWS\_Search { |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* @var AWS\_Search Array of all plugin data $data |
| [16](#L16) | \*/ |
| [17](#L17) | private $data = array(); |
| [18](#L18) |  |
| [19](#L19) | /\*\* |
| [20](#L20) | \* @var AWS\_Search Current language $lang |
| [21](#L21) | \*/ |
| [22](#L22) | private $lang = 0; |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Return a singleton instance of the current class |
| [26](#L26) | \* |
| [27](#L27) | \* @return object |
| [28](#L28) | \*/ |
| [29](#L29) | public static function factory() { |
| [30](#L30) | static $instance = false; |
| [31](#L31) |  |
| [32](#L32) | if ( ! $instance ) { |
| [33](#L33) | $instance = new self(); |
| [34](#L34) | $instance->setup(); |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | return $instance; |
| [38](#L38) | } |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* Constructor |
| [42](#L42) | \*/ |
| [43](#L43) | public function \_\_construct() {} |
| [44](#L44) |  |
| [45](#L45) | /\*\* |
| [46](#L46) | \* Setup actions and filters for all things settings |
| [47](#L47) | \*/ |
| [48](#L48) | public function setup() { |
| [49](#L49) |  |
| [50](#L50) | $this->data['settings'] = get\_option( 'aws\_settings' ); |
| [51](#L51) |  |
| [52](#L52) | if ( isset( $\_REQUEST['wc-ajax'] ) ) { |
| [53](#L53) | add\_action( 'wc\_ajax\_aws\_action', array( $this, 'action\_callback' ) ); |
| [54](#L54) | } else { |
| [55](#L55) | add\_action( 'wp\_ajax\_aws\_action', array( $this, 'action\_callback' ) ); |
| [56](#L56) | add\_action( 'wp\_ajax\_nopriv\_aws\_action', array( $this, 'action\_callback' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | } |
| [60](#L60) |  |
| [61](#L61) | /\* |
| [62](#L62) | \* AJAX call action callback |
| [63](#L63) | \*/ |
| [64](#L64) | public function action\_callback() { |
| [65](#L65) |  |
| [66](#L66) | if ( ! defined( 'DOING\_AJAX' ) ) { |
| [67](#L67) | define( 'DOING\_AJAX', true ); |
| [68](#L68) | } |
| [69](#L69) |  |
| [70](#L70) | if ( ! headers\_sent() && isset( $\_REQUEST['typedata'] ) ) { |
| [71](#L71) | header( 'Content-Type: application/json; charset=' . get\_option( 'blog\_charset' ) ); |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | echo json\_encode( $this->search() ); |
| [75](#L75) |  |
| [76](#L76) | die; |
| [77](#L77) |  |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | /\* |
| [81](#L81) | \* Search |
| [82](#L82) | \*/ |
| [83](#L83) | public function search( $keyword = ''  ) { |
| [84](#L84) |  |
| [85](#L85) | global $wpdb; |
| [86](#L86) |  |
| [87](#L87) | $this->lang = isset( $\_REQUEST['lang'] ) ? sanitize\_text\_field( $\_REQUEST['lang'] ) : ''; |
| [88](#L88) |  |
| [89](#L89) | if ( $this->lang ) { |
| [90](#L90) | do\_action( 'wpml\_switch\_language', $this->lang ); |
| [91](#L91) | } |
| [92](#L92) |  |
| [93](#L93) | $cache = AWS()->get\_settings( 'cache' ); |
| [94](#L94) |  |
| [95](#L95) | $s = $keyword ? esc\_attr( $keyword ) : esc\_attr( $\_POST['keyword'] ); |
| [96](#L96) | $s = htmlspecialchars\_decode( $s ); |
| [97](#L97) |  |
| [98](#L98) | $this->data['s\_nonormalize'] = $s; |
| [99](#L99) |  |
| [100](#L100) | $s = AWS\_Helpers::normalize\_string( $s ); |
| [101](#L101) |  |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Fires each time when performing the search |
| [105](#L105) | \* @since 1.59 |
| [106](#L106) | \* @param string $s Search query |
| [107](#L107) | \*/ |
| [108](#L108) | do\_action( 'aws\_search\_start', $s ); |
| [109](#L109) |  |
| [110](#L110) |  |
| [111](#L111) | $cache\_option\_name = ''; |
| [112](#L112) |  |
| [113](#L113) | if ( $cache === 'true' && ! $keyword  ) { |
| [114](#L114) | $cache\_option\_name = AWS()->cache->get\_cache\_name( $s ); |
| [115](#L115) | $res = AWS()->cache->get\_from\_cache\_table( $cache\_option\_name ); |
| [116](#L116) | if ( $res ) { |
| [117](#L117) | $cached\_value = json\_decode( $res ); |
| [118](#L118) | if ( $cached\_value && ! empty( $cached\_value ) ) { |
| [119](#L119) | return $cached\_value; |
| [120](#L120) | } |
| [121](#L121) | } |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | $show\_cats     = AWS()->get\_settings( 'show\_cats' ); |
| [125](#L125) | $show\_tags     = AWS()->get\_settings( 'show\_tags' ); |
| [126](#L126) | $results\_num   = $keyword ? apply\_filters( 'aws\_page\_results', 100 ) : AWS()->get\_settings( 'results\_num' ); |
| [127](#L127) | $search\_in     = AWS()->get\_settings( 'search\_in' ); |
| [128](#L128) | $outofstock    = AWS()->get\_settings( 'outofstock' ); |
| [129](#L129) |  |
| [130](#L130) | $search\_in\_arr = explode( ',',  AWS()->get\_settings( 'search\_in' ) ); |
| [131](#L131) |  |
| [132](#L132) | // Search in title if all options is disabled |
| [133](#L133) | if ( ! $search\_in ) { |
| [134](#L134) | $search\_in\_arr = array( 'title' ); |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | $products\_array = array(); |
| [138](#L138) | $tax\_to\_display = array(); |
| [139](#L139) | $custom\_tax\_array = array(); |
| [140](#L140) |  |
| [141](#L141) | $this->data['s'] = $s; |
| [142](#L142) | $this->data['results\_num']  = $results\_num ? $results\_num : 10; |
| [143](#L143) | $this->data['search\_terms'] = array(); |
| [144](#L144) | $this->data['search\_in']    = $search\_in\_arr; |
| [145](#L145) | $this->data['outofstock']   = $outofstock; |
| [146](#L146) |  |
| [147](#L147) | $search\_array = array\_unique( explode( ' ', $s ) ); |
| [148](#L148) |  |
| [149](#L149) | $search\_array = AWS\_Helpers::filter\_stopwords( $search\_array ); |
| [150](#L150) |  |
| [151](#L151) | if ( is\_array( $search\_array ) && ! empty( $search\_array ) ) { |
| [152](#L152) | foreach ( $search\_array as $search\_term ) { |
| [153](#L153) | $search\_term = trim( $search\_term ); |
| [154](#L154) | if ( $search\_term ) { |
| [155](#L155) | $this->data['search\_terms'][] = $search\_term; |
| [156](#L156) | } |
| [157](#L157) | } |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | //            if ( empty( $this->data['search\_terms'] ) ) { |
| [161](#L161) | //                $this->data['search\_terms'][] = ''; |
| [162](#L162) | //            } |
| [163](#L163) |  |
| [164](#L164) | if ( ! empty( $this->data['search\_terms'] ) ) { |
| [165](#L165) |  |
| [166](#L166) | $posts\_ids = $this->query\_index\_table(); |
| [167](#L167) |  |
| [168](#L168) | /\*\* |
| [169](#L169) | \* Filters array of products ids |
| [170](#L170) | \* |
| [171](#L171) | \* @since 1.53 |
| [172](#L172) | \* |
| [173](#L173) | \* @param array $posts\_ids Array of products ids |
| [174](#L174) | \* @param string $s Search query |
| [175](#L175) | \*/ |
| [176](#L176) | $posts\_ids = apply\_filters( 'aws\_search\_results\_products\_ids', $posts\_ids, $s ); |
| [177](#L177) |  |
| [178](#L178) |  |
| [179](#L179) | $products\_array = $this->get\_products( $posts\_ids ); |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \* Filters array of products before they displayed in search results |
| [183](#L183) | \* |
| [184](#L184) | \* @since 1.42 |
| [185](#L185) | \* |
| [186](#L186) | \* @param array $products\_array Array of products results |
| [187](#L187) | \* @param string $s Search query |
| [188](#L188) | \*/ |
| [189](#L189) | $products\_array = apply\_filters( 'aws\_search\_results\_products', $products\_array, $s ); |
| [190](#L190) |  |
| [191](#L191) | if ( $show\_cats === 'true' ) { |
| [192](#L192) | $tax\_to\_display[] = 'product\_cat'; |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | if ( $show\_tags === 'true' ) { |
| [196](#L196) | $tax\_to\_display[] = 'product\_tag'; |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | /\*\* |
| [200](#L200) | \* Filters array of custom taxonomies that must be displayed in search results |
| [201](#L201) | \* |
| [202](#L202) | \* @since 1.68 |
| [203](#L203) | \* |
| [204](#L204) | \* @param array $taxonomies\_archives Array of custom taxonomies |
| [205](#L205) | \* @param string $s Search query |
| [206](#L206) | \*/ |
| [207](#L207) | $taxonomies\_archives = apply\_filters( 'aws\_search\_results\_tax\_archives', $tax\_to\_display, $s ); |
| [208](#L208) |  |
| [209](#L209) | if ( $taxonomies\_archives && is\_array( $taxonomies\_archives ) && ! empty( $taxonomies\_archives ) ) { |
| [210](#L210) |  |
| [211](#L211) | $tax\_search = new AWS\_Tax\_Search( $taxonomies\_archives, $this->data ); |
| [212](#L212) | $custom\_tax\_array = $tax\_search->get\_results(); |
| [213](#L213) |  |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | } |
| [217](#L217) |  |
| [218](#L218) |  |
| [219](#L219) | $result\_array = array( |
| [220](#L220) | 'tax'      => $custom\_tax\_array, |
| [221](#L221) | 'products' => $products\_array, |
| [222](#L222) | 'sql'      => isset( $this->data['sql'] ) ? $this->data['sql'] : '' |
| [223](#L223) | ); |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) | /\*\* |
| [227](#L227) | \* Filters array of all results data before they displayed in search results |
| [228](#L228) | \* |
| [229](#L229) | \* @since 1.43 |
| [230](#L230) | \* |
| [231](#L231) | \* @param array $brands\_array Array of products data |
| [232](#L232) | \* @param string $s Search query |
| [233](#L233) | \*/ |
| [234](#L234) | $result\_array = apply\_filters( 'aws\_search\_results\_all', $result\_array, $s ); |
| [235](#L235) |  |
| [236](#L236) | if ( $cache === 'true' && ! $keyword  ) { |
| [237](#L237) | AWS()->cache->insert\_into\_cache\_table( $cache\_option\_name, $result\_array ); |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | return $result\_array; |
| [241](#L241) |  |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | /\* |
| [245](#L245) | \* Query in index table |
| [246](#L246) | \*/ |
| [247](#L247) | private function query\_index\_table() { |
| [248](#L248) |  |
| [249](#L249) | global $wpdb; |
| [250](#L250) |  |
| [251](#L251) | $table\_name = $wpdb->prefix . AWS\_INDEX\_TABLE\_NAME; |
| [252](#L252) |  |
| [253](#L253) | $search\_in\_arr    = $this->data['search\_in']; |
| [254](#L254) | $results\_num      = $this->data['results\_num']; |
| [255](#L255) | $outofstock       = $this->data['outofstock']; |
| [256](#L256) |  |
| [257](#L257) |  |
| [258](#L258) | $reindex\_version = get\_option( 'aws\_reindex\_version' ); |
| [259](#L259) |  |
| [260](#L260) | $query = array(); |
| [261](#L261) |  |
| [262](#L262) | $query['select'] = ''; |
| [263](#L263) | $query['search'] = ''; |
| [264](#L264) | $query['relevance'] = ''; |
| [265](#L265) | $query['stock'] = ''; |
| [266](#L266) | $query['visibility'] = ''; |
| [267](#L267) | $query['exclude\_products'] = ''; |
| [268](#L268) | $query['lang'] = ''; |
| [269](#L269) |  |
| [270](#L270) | $search\_array = array(); |
| [271](#L271) | $relevance\_array = array(); |
| [272](#L272) | $new\_relevance\_array = array(); |
| [273](#L273) |  |
| [274](#L274) |  |
| [275](#L275) | /\*\* |
| [276](#L276) | \* Filters array of search terms before generating SQL query |
| [277](#L277) | \* |
| [278](#L278) | \* @since 1.49 |
| [279](#L279) | \* |
| [280](#L280) | \* @param array $this->data['search\_terms'] Array of search terms |
| [281](#L281) | \*/ |
| [282](#L282) | $this->data['search\_terms'] = apply\_filters( 'aws\_search\_terms', $this->data['search\_terms'] ); |
| [283](#L283) |  |
| [284](#L284) |  |
| [285](#L285) | foreach ( $this->data['search\_terms'] as $search\_term ) { |
| [286](#L286) |  |
| [287](#L287) | $search\_term\_len = strlen( $search\_term ); |
| [288](#L288) |  |
| [289](#L289) | $relevance\_title        = 200 + 20 \* $search\_term\_len; |
| [290](#L290) | $relevance\_content      = 35 + 4 \* $search\_term\_len; |
| [291](#L291) | $relevance\_title\_like   = 40 + 2 \* $search\_term\_len; |
| [292](#L292) | $relevance\_content\_like = 35 + 1 \* $search\_term\_len; |
| [293](#L293) |  |
| [294](#L294) | $search\_term\_norm = AWS\_Plurals::singularize( $search\_term ); |
| [295](#L295) |  |
| [296](#L296) | if ( $search\_term\_norm && $search\_term\_len > 3 && strlen( $search\_term\_norm ) > 2 ) { |
| [297](#L297) | $search\_term = $search\_term\_norm; |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | $like = '%' . $wpdb->esc\_like( $search\_term ) . '%'; |
| [301](#L301) |  |
| [302](#L302) |  |
| [303](#L303) | if ( $search\_term\_len > 1 ) { |
| [304](#L304) | $search\_array[] = $wpdb->prepare( '( term LIKE %s )', $like ); |
| [305](#L305) | } else { |
| [306](#L306) | $search\_array[] = $wpdb->prepare( '( term = "%s" )', $search\_term ); |
| [307](#L307) | } |
| [308](#L308) |  |
| [309](#L309) | foreach ( $search\_in\_arr as $search\_in\_term ) { |
| [310](#L310) |  |
| [311](#L311) | switch ( $search\_in\_term ) { |
| [312](#L312) |  |
| [313](#L313) | case 'title': |
| [314](#L314) | $relevance\_array['title'][] = $wpdb->prepare( "( case when ( term\_source = 'title' AND term = '%s' ) then {$relevance\_title} \* count else 0 end )", $search\_term ); |
| [315](#L315) | $relevance\_array['title'][] = $wpdb->prepare( "( case when ( term\_source = 'title' AND term LIKE %s ) then {$relevance\_title\_like} \* count else 0 end )", $like ); |
| [316](#L316) | break; |
| [317](#L317) |  |
| [318](#L318) | case 'content': |
| [319](#L319) | $relevance\_array['content'][] = $wpdb->prepare( "( case when ( term\_source = 'content' AND term = '%s' ) then {$relevance\_content} \* count else 0 end )", $search\_term ); |
| [320](#L320) | $relevance\_array['content'][] = $wpdb->prepare( "( case when ( term\_source = 'content' AND term LIKE %s ) then {$relevance\_content\_like} \* count else 0 end )", $like ); |
| [321](#L321) | break; |
| [322](#L322) |  |
| [323](#L323) | case 'excerpt': |
| [324](#L324) | $relevance\_array['excerpt'][] = $wpdb->prepare( "( case when ( term\_source = 'excerpt' AND term = '%s' ) then {$relevance\_content} \* count else 0 end )", $search\_term ); |
| [325](#L325) | $relevance\_array['excerpt'][] = $wpdb->prepare( "( case when ( term\_source = 'excerpt' AND term LIKE %s ) then {$relevance\_content\_like} \* count else 0 end )", $like ); |
| [326](#L326) | break; |
| [327](#L327) |  |
| [328](#L328) | case 'category': |
| [329](#L329) | $relevance\_array['category'][] = $wpdb->prepare( "( case when ( term\_source = 'category' AND term = '%s' ) then 35 else 0 end )", $search\_term ); |
| [330](#L330) | $relevance\_array['category'][] = $wpdb->prepare( "( case when ( term\_source = 'category' AND term LIKE %s ) then 5 else 0 end )", $like ); |
| [331](#L331) | break; |
| [332](#L332) |  |
| [333](#L333) | case 'tag': |
| [334](#L334) | $relevance\_array['tag'][] = $wpdb->prepare( "( case when ( term\_source = 'tag' AND term = '%s' ) then 35 else 0 end )", $search\_term ); |
| [335](#L335) | $relevance\_array['tag'][] = $wpdb->prepare( "( case when ( term\_source = 'tag' AND term LIKE %s ) then 5 else 0 end )", $like ); |
| [336](#L336) | break; |
| [337](#L337) |  |
| [338](#L338) | case 'sku': |
| [339](#L339) | $relevance\_array['sku'][] = $wpdb->prepare( "( case when ( term\_source = 'sku' AND term = '%s' ) then 300 else 0 end )", $search\_term ); |
| [340](#L340) | $relevance\_array['sku'][] = $wpdb->prepare( "( case when ( term\_source = 'sku' AND term LIKE %s ) then 50 else 0 end )", $like ); |
| [341](#L341) | break; |
| [342](#L342) |  |
| [343](#L343) | case 'id': |
| [344](#L344) | $relevance\_array['id'][] = $wpdb->prepare( "( case when ( term\_source = 'id' AND term = '%s' ) then 300 else 0 end )", $search\_term ); |
| [345](#L345) | $relevance\_array['id'][] = $wpdb->prepare( "( case when ( term\_source = 'id' AND term LIKE %s ) then 5 else 0 end )", $like ); |
| [346](#L346) | break; |
| [347](#L347) |  |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | } |
| [353](#L353) |  |
| [354](#L354) | // Sort 'relevance' queries in the array by search priority |
| [355](#L355) | foreach ( $search\_in\_arr as $search\_in\_item ) { |
| [356](#L356) | if ( isset( $relevance\_array[$search\_in\_item] ) ) { |
| [357](#L357) | $new\_relevance\_array[$search\_in\_item] = implode( ' + ', $relevance\_array[$search\_in\_item] ); |
| [358](#L358) | } |
| [359](#L359) | } |
| [360](#L360) |  |
| [361](#L361) | $query['select'] = ' distinct ID'; |
| [362](#L362) | $query['relevance'] = sprintf( ' (SUM( %s )) ', implode( ' + ', $new\_relevance\_array ) ); |
| [363](#L363) | $query['search'] = sprintf( ' AND ( %s )', implode( ' OR ', $search\_array ) ); |
| [364](#L364) |  |
| [365](#L365) |  |
| [366](#L366) | if ( $reindex\_version && version\_compare( $reindex\_version, '1.16', '>=' ) ) { |
| [367](#L367) |  |
| [368](#L368) | if ( $outofstock !== 'true' ) { |
| [369](#L369) | $query['stock'] = " AND in\_stock = 1"; |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | $query['visibility'] = " AND NOT visibility LIKE '%hidden%'"; |
| [373](#L373) |  |
| [374](#L374) | } |
| [375](#L375) |  |
| [376](#L376) |  |
| [377](#L377) | /\*\* |
| [378](#L378) | \* Exclude certain products from search |
| [379](#L379) | \* |
| [380](#L380) | \* @since 1.58 |
| [381](#L381) | \* |
| [382](#L382) | \* @param array |
| [383](#L383) | \*/ |
| [384](#L384) | $exclude\_products\_filter = apply\_filters( 'aws\_exclude\_products', array() ); |
| [385](#L385) |  |
| [386](#L386) | if ( $exclude\_products\_filter && is\_array( $exclude\_products\_filter ) && ! empty( $exclude\_products\_filter ) ) { |
| [387](#L387) | $query['exclude\_products'] = sprintf( ' AND ( id NOT IN ( %s ) )', implode( ',', $exclude\_products\_filter ) ); |
| [388](#L388) | } |
| [389](#L389) |  |
| [390](#L390) |  |
| [391](#L391) | if ( $this->lang ) { |
| [392](#L392) | $current\_lang = $this->lang; |
| [393](#L393) | } else { |
| [394](#L394) | $current\_lang = AWS\_Helpers::get\_lang(); |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | /\*\* |
| [398](#L398) | \* Filter current language code |
| [399](#L399) | \* @since 1.59 |
| [400](#L400) | \* @param string $current\_lang Lang code |
| [401](#L401) | \*/ |
| [402](#L402) | $current\_lang = apply\_filters( 'aws\_search\_current\_lang', $current\_lang ); |
| [403](#L403) |  |
| [404](#L404) | if ( $current\_lang && $reindex\_version && version\_compare( $reindex\_version, '1.20', '>=' ) ) { |
| [405](#L405) | $query['lang'] = $wpdb->prepare( " AND ( lang LIKE %s OR lang = '' )", $current\_lang ); |
| [406](#L406) | } |
| [407](#L407) |  |
| [408](#L408) | /\*\* |
| [409](#L409) | \* Filter search query parameters |
| [410](#L410) | \* @since 1.67 |
| [411](#L411) | \* @param array $query Query parameters |
| [412](#L412) | \*/ |
| [413](#L413) | $query = apply\_filters( 'aws\_search\_query\_array', $query ); |
| [414](#L414) |  |
| [415](#L415) | $sql = "SELECT |
| [416](#L416) | {$query['select']}, |
| [417](#L417) | {$query['relevance']} as relevance |
| [418](#L418) | FROM |
| [419](#L419) | {$table\_name} |
| [420](#L420) | WHERE |
| [421](#L421) | 1=1 |
| [422](#L422) | {$query['search']} |
| [423](#L423) | {$query['stock']} |
| [424](#L424) | {$query['visibility']} |
| [425](#L425) | {$query['exclude\_products']} |
| [426](#L426) | {$query['lang']} |
| [427](#L427) | GROUP BY ID |
| [428](#L428) | having relevance > 0 |
| [429](#L429) | ORDER BY |
| [430](#L430) | relevance DESC, id DESC |
| [431](#L431) | LIMIT 0, {$results\_num} |
| [432](#L432) | "; |
| [433](#L433) |  |
| [434](#L434) | $this->data['sql'] = $sql; |
| [435](#L435) |  |
| [436](#L436) | $posts\_ids = $this->get\_posts\_ids( $sql ); |
| [437](#L437) |  |
| [438](#L438) | return $posts\_ids; |
| [439](#L439) |  |
| [440](#L440) | } |
| [441](#L441) |  |
| [442](#L442) | /\* |
| [443](#L443) | \* Get array of included to search result posts ids |
| [444](#L444) | \*/ |
| [445](#L445) | private function get\_posts\_ids( $sql ) { |
| [446](#L446) |  |
| [447](#L447) | global $wpdb; |
| [448](#L448) |  |
| [449](#L449) | $posts\_ids = array(); |
| [450](#L450) |  |
| [451](#L451) | $search\_results = $wpdb->get\_results( $sql ); |
| [452](#L452) |  |
| [453](#L453) |  |
| [454](#L454) | if ( !empty( $search\_results ) && !is\_wp\_error( $search\_results ) && is\_array( $search\_results ) ) { |
| [455](#L455) | foreach ( $search\_results as $search\_result ) { |
| [456](#L456) | $post\_id = intval( $search\_result->ID ); |
| [457](#L457) | if ( ! in\_array( $post\_id, $posts\_ids ) ) { |
| [458](#L458) | $posts\_ids[] = $post\_id; |
| [459](#L459) | } |
| [460](#L460) | } |
| [461](#L461) | } |
| [462](#L462) |  |
| [463](#L463) | unset( $search\_results ); |
| [464](#L464) |  |
| [465](#L465) | return $posts\_ids; |
| [466](#L466) |  |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | /\* |
| [470](#L470) | \* Get products info |
| [471](#L471) | \*/ |
| [472](#L472) | private function get\_products( $posts\_ids ) { |
| [473](#L473) |  |
| [474](#L474) | $products\_array = array(); |
| [475](#L475) |  |
| [476](#L476) | if ( count( $posts\_ids ) > 0 ) { |
| [477](#L477) |  |
| [478](#L478) | $show\_excerpt         = AWS()->get\_settings( 'show\_excerpt' ); |
| [479](#L479) | $excerpt\_source       = AWS()->get\_settings( 'desc\_source' ); |
| [480](#L480) | $excerpt\_length       = AWS()->get\_settings( 'excerpt\_length' ); |
| [481](#L481) | $desc\_scrap\_words     = AWS()->get\_settings( 'mark\_words' ); |
| [482](#L482) | $highlight\_words      = AWS()->get\_settings( 'highlight' ); |
| [483](#L483) | $show\_price           = AWS()->get\_settings( 'show\_price' ); |
| [484](#L484) | $show\_outofstockprice = AWS()->get\_settings( 'show\_outofstock\_price' ); |
| [485](#L485) | $show\_sale            = AWS()->get\_settings( 'show\_sale' ); |
| [486](#L486) | $show\_image           = AWS()->get\_settings( 'show\_image' ); |
| [487](#L487) | $show\_sku             = AWS()->get\_settings( 'show\_sku' ); |
| [488](#L488) | $show\_stock\_status    = AWS()->get\_settings( 'show\_stock' ); |
| [489](#L489) | $show\_featured        = AWS()->get\_settings( 'show\_featured' ); |
| [490](#L490) |  |
| [491](#L491) | $posts\_items = $posts\_ids; |
| [492](#L492) |  |
| [493](#L493) | foreach ( $posts\_items as $post\_item ) { |
| [494](#L494) |  |
| [495](#L495) | if ( ! is\_object( $post\_item ) ) { |
| [496](#L496) | $product = wc\_get\_product( $post\_item ); |
| [497](#L497) | } else { |
| [498](#L498) | $product = $post\_item; |
| [499](#L499) | } |
| [500](#L500) |  |
| [501](#L501) | if ( ! is\_a( $product, 'WC\_Product' ) ) { |
| [502](#L502) | continue; |
| [503](#L503) | } |
| [504](#L504) |  |
| [505](#L505) | $post\_id = method\_exists( $product, 'get\_id' ) ? $product->get\_id() : $post\_item; |
| [506](#L506) |  |
| [507](#L507) | /\*\* |
| [508](#L508) | \* Filter additional product data |
| [509](#L509) | \* @since 1.60 |
| [510](#L510) | \* @param array $this->data Additional data |
| [511](#L511) | \* @param int $post\_id Product id |
| [512](#L512) | \* @param object $product Product |
| [513](#L513) | \*/ |
| [514](#L514) | $this->data = apply\_filters( 'aws\_search\_data\_params', $this->data, $post\_id, $product ); |
| [515](#L515) |  |
| [516](#L516) | $post\_data = get\_post( $post\_id ); |
| [517](#L517) |  |
| [518](#L518) | $title = $product->get\_title(); |
| [519](#L519) | $title = AWS\_Helpers::html2txt( $title ); |
| [520](#L520) |  |
| [521](#L521) | $excerpt      = ''; |
| [522](#L522) | $price        = ''; |
| [523](#L523) | $on\_sale      = ''; |
| [524](#L524) | $image        = ''; |
| [525](#L525) | $sku          = ''; |
| [526](#L526) | $stock\_status = ''; |
| [527](#L527) | $featured     = ''; |
| [528](#L528) |  |
| [529](#L529) |  |
| [530](#L530) | if ( $show\_excerpt === 'true' ) { |
| [531](#L531) |  |
| [532](#L532) | $excerpt = ( $excerpt\_source === 'excerpt' && $post\_data->post\_excerpt ) ? $post\_data->post\_excerpt : $post\_data->post\_content; |
| [533](#L533) | $excerpt = AWS\_Helpers::html2txt( $excerpt ); |
| [534](#L534) | $excerpt = str\_replace('"', "'", $excerpt); |
| [535](#L535) | $excerpt = strip\_shortcodes( $excerpt ); |
| [536](#L536) | $excerpt = AWS\_Helpers::strip\_shortcodes( $excerpt ); |
| [537](#L537) |  |
| [538](#L538) | if ( $desc\_scrap\_words === 'true'  ) { |
| [539](#L539) |  |
| [540](#L540) | $marked\_content = $this->scrap\_content( $excerpt ); |
| [541](#L541) |  |
| [542](#L542) | if ( $marked\_content ) { |
| [543](#L543) | $excerpt = $marked\_content; |
| [544](#L544) | } else { |
| [545](#L545) | $excerpt = wp\_trim\_words( $excerpt, $excerpt\_length, '...' ); |
| [546](#L546) | } |
| [547](#L547) |  |
| [548](#L548) | } else { |
| [549](#L549) | $excerpt = wp\_trim\_words( $excerpt, $excerpt\_length, '...' ); |
| [550](#L550) | } |
| [551](#L551) |  |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) |  |
| [555](#L555) | if ( $show\_price === 'true' && ( $product->is\_in\_stock() || ( ! $product->is\_in\_stock() && $show\_outofstockprice === 'true' ) ) ) { |
| [556](#L556) | $price = $product->get\_price\_html(); |
| [557](#L557) | $price = preg\_replace("/<a\s(.+?)>(.+?)<\/a>/is", "<span>$2</span>", $price); |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | if ( $show\_sale === 'true' && ( $product->is\_in\_stock() || ( ! $product->is\_in\_stock() && $show\_outofstockprice === 'true' ) ) ) { |
| [561](#L561) | $on\_sale = $product->is\_on\_sale(); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | if ( $show\_image === 'true' ) { |
| [565](#L565) | $image\_id = $product->get\_image\_id(); |
| [566](#L566) | $image\_attributes = wp\_get\_attachment\_image\_src( $image\_id ); |
| [567](#L567) | $image = $image\_attributes[0]; |
| [568](#L568) | } |
| [569](#L569) |  |
| [570](#L570) | if ( $show\_sku === 'true' ) { |
| [571](#L571) | $sku = $product->get\_sku(); |
| [572](#L572) | } |
| [573](#L573) |  |
| [574](#L574) | if ( $show\_featured === 'true' ) { |
| [575](#L575) | $featured = $product->is\_featured(); |
| [576](#L576) | } |
| [577](#L577) |  |
| [578](#L578) | if ( $show\_stock\_status === 'true' ) { |
| [579](#L579) | if ( $product->is\_in\_stock() ) { |
| [580](#L580) | $stock\_status = array( |
| [581](#L581) | 'status' => true, |
| [582](#L582) | 'text'   => esc\_html\_\_( 'In stock', 'advanced-woo-search' ) |
| [583](#L583) | ); |
| [584](#L584) | } else { |
| [585](#L585) | $stock\_status = array( |
| [586](#L586) | 'status' => false, |
| [587](#L587) | 'text'   => esc\_html\_\_( 'Out of stock', 'advanced-woo-search' ) |
| [588](#L588) | ); |
| [589](#L589) | } |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | if ( method\_exists( $product, 'get\_price' ) ) { |
| [593](#L593) | $f\_price = $product->get\_price(); |
| [594](#L594) | } |
| [595](#L595) |  |
| [596](#L596) | if ( method\_exists( $product, 'get\_average\_rating' ) ) { |
| [597](#L597) | $f\_rating  = $product->get\_average\_rating(); |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | if ( method\_exists( $product,'get\_review\_count' ) ) { |
| [601](#L601) | $f\_reviews = $product->get\_review\_count(); |
| [602](#L602) | } |
| [603](#L603) |  |
| [604](#L604) | //                    $categories = $product->get\_categories( ',' ); |
| [605](#L605) | //                    $tags = $product->get\_tags( ',' ); |
| [606](#L606) |  |
| [607](#L607) | if ( $highlight\_words === 'true'  ) { |
| [608](#L608) | $title   = $this->highlight\_words( $title ); |
| [609](#L609) | $excerpt = $this->highlight\_words( $excerpt ); |
| [610](#L610) | $sku     = $this->highlight\_words( $sku ); |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | $title   = apply\_filters( 'aws\_title\_search\_result', $title, $post\_id, $product ); |
| [614](#L614) | $excerpt = apply\_filters( 'aws\_excerpt\_search\_result', $excerpt, $post\_id, $product ); |
| [615](#L615) |  |
| [616](#L616) | $new\_result = array( |
| [617](#L617) | 'id'           => $post\_id, |
| [618](#L618) | 'title'        => $title, |
| [619](#L619) | 'excerpt'      => $excerpt, |
| [620](#L620) | 'link'         => get\_permalink( $post\_id ), |
| [621](#L621) | 'image'        => $image, |
| [622](#L622) | 'price'        => $price, |
| [623](#L623) | 'on\_sale'      => $on\_sale, |
| [624](#L624) | 'sku'          => $sku, |
| [625](#L625) | 'stock\_status' => $stock\_status, |
| [626](#L626) | 'featured'     => $featured, |
| [627](#L627) | 'f\_price'      => $f\_price, |
| [628](#L628) | 'f\_rating'     => $f\_rating, |
| [629](#L629) | 'f\_reviews'    => $f\_reviews, |
| [630](#L630) | 'post\_data'    => $post\_data |
| [631](#L631) | ); |
| [632](#L632) |  |
| [633](#L633) | $products\_array[] = $new\_result; |
| [634](#L634) | } |
| [635](#L635) |  |
| [636](#L636) | } |
| [637](#L637) |  |
| [638](#L638) | /\*\* |
| [639](#L639) | \* Filter products array before output |
| [640](#L640) | \* @since 1.60 |
| [641](#L641) | \* @param array $products\_array Products array |
| [642](#L642) | \* @param array $this->data Additional data |
| [643](#L643) | \*/ |
| [644](#L644) | $products\_array = apply\_filters( 'aws\_search\_pre\_filter\_products', $products\_array, $this->data ); |
| [645](#L645) |  |
| [646](#L646) | return $products\_array; |
| [647](#L647) |  |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | /\* |
| [651](#L651) | \* Scrap content excerpt |
| [652](#L652) | \*/ |
| [653](#L653) | private function scrap\_content( $content ) { |
| [654](#L654) |  |
| [655](#L655) | $exact\_words = array(); |
| [656](#L656) | $words = array(); |
| [657](#L657) |  |
| [658](#L658) | foreach( $this->data['search\_terms'] as $search\_in ) { |
| [659](#L659) |  |
| [660](#L660) | $exact\_words[] = '\b' . $search\_in . '\b'; |
| [661](#L661) |  |
| [662](#L662) | if ( strlen( $search\_in ) > 1 ) { |
| [663](#L663) | $words[] = $search\_in; |
| [664](#L664) | } else { |
| [665](#L665) | $words[] = '\b' . $search\_in . '\b'; |
| [666](#L666) | } |
| [667](#L667) |  |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | usort( $exact\_words, array( $this, 'sort\_by\_length' ) ); |
| [671](#L671) | $exact\_words = implode( '|', $exact\_words ); |
| [672](#L672) |  |
| [673](#L673) | usort( $words, array( $this, 'sort\_by\_length' ) ); |
| [674](#L674) | $words = implode( '|', $words ); |
| [675](#L675) |  |
| [676](#L676) | preg\_match( '/([^.?!]\*?)(' . $exact\_words . '){1}(.\*?[.!?])/i', $content, $matches ); |
| [677](#L677) |  |
| [678](#L678) | if ( ! isset( $matches[0] ) ) { |
| [679](#L679) | preg\_match( '/([^.?!]\*?)(' . $words . '){1}(.\*?[.!?])/i', $content, $matches ); |
| [680](#L680) | } |
| [681](#L681) |  |
| [682](#L682) | if ( ! isset( $matches[0] ) ) { |
| [683](#L683) | preg\_match( '/([^.?!]\*?)(.\*?)(.\*?[.!?])/i', $content, $matches ); |
| [684](#L684) | } |
| [685](#L685) |  |
| [686](#L686) | if ( isset( $matches[0] ) ) { |
| [687](#L687) |  |
| [688](#L688) | $content = $matches[0]; |
| [689](#L689) |  |
| [690](#L690) | // Trim to long content |
| [691](#L691) | if (str\_word\_count(strip\_tags($content)) > 34) { |
| [692](#L692) |  |
| [693](#L693) | if (str\_word\_count(strip\_tags($matches[3])) > 34) { |
| [694](#L694) | $matches[3] = wp\_trim\_words($matches[3], 30, '...'); |
| [695](#L695) | } |
| [696](#L696) |  |
| [697](#L697) | $content = '...' . $matches[2] . $matches[3]; |
| [698](#L698) |  |
| [699](#L699) | } |
| [700](#L700) |  |
| [701](#L701) | } else { |
| [702](#L702) |  |
| [703](#L703) | $content = ''; |
| [704](#L704) |  |
| [705](#L705) | } |
| [706](#L706) |  |
| [707](#L707) | return $content; |
| [708](#L708) |  |
| [709](#L709) | } |
| [710](#L710) |  |
| [711](#L711) | /\* |
| [712](#L712) | \* Highlight search words |
| [713](#L713) | \*/ |
| [714](#L714) | private function highlight\_words( $text ) { |
| [715](#L715) |  |
| [716](#L716) | if ( ! $text ) { |
| [717](#L717) | return $text; |
| [718](#L718) | } |
| [719](#L719) |  |
| [720](#L720) | $pattern = array(); |
| [721](#L721) |  |
| [722](#L722) | foreach( $this->data['search\_terms'] as $search\_in ) { |
| [723](#L723) |  |
| [724](#L724) | if ( strlen( $search\_in ) > 1 ) { |
| [725](#L725) | $pattern[] = '(' . $search\_in . ')+'; |
| [726](#L726) | } else { |
| [727](#L727) | $pattern[] = '\b[' . $search\_in . ']{1}\b'; |
| [728](#L728) | } |
| [729](#L729) |  |
| [730](#L730) | } |
| [731](#L731) |  |
| [732](#L732) | usort( $pattern, array( $this, 'sort\_by\_length' ) ); |
| [733](#L733) | $pattern = implode( '|', $pattern ); |
| [734](#L734) | $pattern = sprintf( '/%s/i', $pattern ); |
| [735](#L735) |  |
| [736](#L736) | /\*\* |
| [737](#L737) | \* Tag to use for highlighting search words inside content |
| [738](#L738) | \* @since 1.88 |
| [739](#L739) | \* @param string Tag for highlighting |
| [740](#L740) | \*/ |
| [741](#L741) | $highlight\_tag = apply\_filters( 'aws\_highlight\_tag', 'strong' ); |
| [742](#L742) |  |
| [743](#L743) | $highlight\_tag\_pattern = '<' . $highlight\_tag . '>${0}</' . $highlight\_tag . '>'; |
| [744](#L744) |  |
| [745](#L745) | $text = preg\_replace($pattern, $highlight\_tag\_pattern, $text ); |
| [746](#L746) |  |
| [747](#L747) | return $text; |
| [748](#L748) |  |
| [749](#L749) | } |
| [750](#L750) |  |
| [751](#L751) | /\* |
| [752](#L752) | \* Sort array by its values length |
| [753](#L753) | \*/ |
| [754](#L754) | private function sort\_by\_length( $a, $b ) { |
| [755](#L755) | return strlen( $b ) - strlen( $a ); |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | } |
| [759](#L759) |  |
| [760](#L760) |  |
| [761](#L761) | endif; |
| [762](#L762) |  |
| [763](#L763) | AWS\_Search::factory(); |
| [764](#L764) |  |
| [765](#L765) | function aws\_search( $keyword = '' ) { |
| [766](#L766) | return AWS\_Search::factory()->search( $keyword ); |
| [767](#L767) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/advanced-woo-search/tags/1.99/includes/class-aws-search.php?format=txt)
* [Original Format](/export/3225039/advanced-woo-search/tags/1.99/includes/class-aws-search.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


