=== Content from github.com_0039da49_20250119_120027.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP-maltego%2Fcommit%2F3ccde66dab4096ab5663e69f352992cc73e1160b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP-maltego%2Fcommit%2F3ccde66dab4096ab5663e69f352992cc73e1160b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MISP%2FMISP-maltego)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MISP](/MISP)
/
**[MISP-maltego](/MISP/MISP-maltego)**
Public

* [Notifications](/login?return_to=%2FMISP%2FMISP-maltego) You must be signed in to change notification settings
* [Fork
  43](/login?return_to=%2FMISP%2FMISP-maltego)
* [Star
   174](/login?return_to=%2FMISP%2FMISP-maltego)

* [Code](/MISP/MISP-maltego)
* [Issues
  19](/MISP/MISP-maltego/issues)
* [Pull requests
  0](/MISP/MISP-maltego/pulls)
* [Actions](/MISP/MISP-maltego/actions)
* [Security](/MISP/MISP-maltego/security)
* [Insights](/MISP/MISP-maltego/pulse)

Additional navigation options

* [Code](/MISP/MISP-maltego)
* [Issues](/MISP/MISP-maltego/issues)
* [Pull requests](/MISP/MISP-maltego/pulls)
* [Actions](/MISP/MISP-maltego/actions)
* [Security](/MISP/MISP-maltego/security)
* [Insights](/MISP/MISP-maltego/pulse)

## Commit

[Permalink](/MISP/MISP-maltego/commit/3ccde66dab4096ab5663e69f352992cc73e1160b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: [security] fixes a security issue when used as remote transform

[Browse files](/MISP/MISP-maltego/tree/3ccde66dab4096ab5663e69f352992cc73e1160b)
Browse the repository at this point in the history

```
the MISP connection being shared by all the users
```

* Loading branch information

[![@cvandeplas](https://avatars.githubusercontent.com/u/1073662?s=40&v=4)](/cvandeplas)

[cvandeplas](/MISP/MISP-maltego/commits?author=cvandeplas "View all commits by cvandeplas")
committed
May 15, 2020

1 parent
[32ccad3](/MISP/MISP-maltego/commit/32ccad30ec3fb954d7174690b871b587e580025f)

commit 3ccde66

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**139 additions**
and
**144 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/MISP\_maltego/transforms

  + src/MISP\_maltego/transforms/attributetoevent.py
    [attributetoevent.py](#diff-939352bdb53e06a483cb8439196aa42f4f624087dc81a8c624d0079d03ca78cc)
  + common

    - src/MISP\_maltego/transforms/common/util.py
      [util.py](#diff-d7c185815f1db7803ec6553ff8568e468abf38396d90a291eeff4f93f0298824)
  + src/MISP\_maltego/transforms/eventtoattributes.py
    [eventtoattributes.py](#diff-eff792f9a5e3c646a80fc83d6d8d0e2e1b20d5138615d676e0f5102a70073719)
  + src/MISP\_maltego/transforms/galaxytoevent.py
    [galaxytoevent.py](#diff-e740c6cc4e82570b3316efaf5b443b8d7c292be7c8c05cef92c539706eb5bfd2)

## There are no files selected for viewing

30 changes: 15 additions & 15 deletions

30
[src/MISP\_maltego/transforms/attributetoevent.py](#diff-939352bdb53e06a483cb8439196aa42f4f624087dc81a8c624d0079d03ca78cc "src/MISP_maltego/transforms/attributetoevent.py")

Show comments

[View file](/MISP/MISP-maltego/blob/3ccde66dab4096ab5663e69f352992cc73e1160b/src/MISP_maltego/transforms/attributetoevent.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,7 @@ |
|  |  | from canari.maltego.entities import Unknown, Hashtag |
|  |  | from canari.maltego.transform import Transform |
|  |  | from MISP\_maltego.transforms.common.entities import MISPGalaxy |
|  |  | from MISP\_maltego.transforms.common.util import check\_update, get\_misp\_connection, event\_to\_entity, object\_to\_entity, get\_attribute\_in\_event, get\_attribute\_in\_object, attribute\_to\_entity, get\_entity\_property, search\_galaxy\_cluster, galaxycluster\_to\_entity, tag\_matches\_note\_prefix |
|  |  | from MISP\_maltego.transforms.common.util import check\_update, MISPConnection, event\_to\_entity, get\_attribute\_in\_event, get\_attribute\_in\_object, attribute\_to\_entity, get\_entity\_property, search\_galaxy\_cluster, galaxycluster\_to\_entity |
|  |  | from canari.maltego.message import LinkDirection, Bookmark |
|  |  |  |
|  |  | \_\_author\_\_ = 'Christophe Vandeplas' |
| Expand All | | @@ -26,20 +26,20 @@ def do\_transform(self, request, response, config): |
|  |  | link\_label = 'Search result' |
|  |  |  |
|  |  | if 'properties.mispevent' in request.entity.fields: |
|  |  | misp = get\_misp\_connection(config, request.parameters) |
|  |  | conn = MISPConnection(config, request.parameters) |
|  |  | # if event\_id |
|  |  | try: |
|  |  | if request.entity.value == '0': |
|  |  | return response |
|  |  | eventid = int(request.entity.value) |
|  |  | events\_json = misp.search(controller='events', eventid=eventid, with\_attachments=False) |
|  |  | events\_json = conn.misp.search(controller='events', eventid=eventid, with\_attachments=False) |
|  |  | for e in events\_json: |
|  |  | response += event\_to\_entity(e, link\_label=link\_label, link\_direction=LinkDirection.OutputToInput) |
|  |  | return response |
|  |  | except ValueError: |
|  |  | pass |
|  |  | # if event\_info string as value |
|  |  | events\_json = misp.search(controller='events', eventinfo=request.entity.value, with\_attachments=False) |
|  |  | events\_json = conn.misp.search(controller='events', eventinfo=request.entity.value, with\_attachments=False) |
|  |  | for e in events\_json: |
|  |  | response += event\_to\_entity(e, link\_label=link\_label, link\_direction=LinkDirection.OutputToInput) |
|  |  | return response |
| Expand Down  Expand Up | | @@ -68,8 +68,8 @@ def do\_transform(self, request, response, config): |
|  |  | keyword = get\_entity\_property(request.entity, 'Temp') |
|  |  | if not keyword: |
|  |  | keyword = request.entity.value |
|  |  | misp = get\_misp\_connection(config, request.parameters) |
|  |  | result = misp.direct\_call('tags/search', {'name': keyword}) |
|  |  | conn = MISPConnection(config, request.parameters) |
|  |  | result = conn.misp.direct\_call('tags/search', {'name': keyword}) |
|  |  | for t in result: |
|  |  | # skip misp-galaxies as we have processed them earlier on |
|  |  | if t['Tag']['name'].startswith('misp-galaxy'): |
| Expand All | | @@ -80,8 +80,8 @@ def do\_transform(self, request, response, config): |
|  |  | return response |
|  |  |  |
|  |  | # for all other normal entities |
|  |  | misp = get\_misp\_connection(config, request.parameters) |
|  |  | events\_json = misp.search(controller='events', value=request.entity.value, with\_attachments=False) |
|  |  | conn = MISPConnection(config, request.parameters) |
|  |  | events\_json = conn.misp.search(controller='events', value=request.entity.value, with\_attachments=False) |
|  |  | # we need to do really rebuild the Entity from scratch as request.entity is of type Unknown |
|  |  | for e in events\_json: |
|  |  | # find the value as attribute |
| Expand All | | @@ -93,7 +93,7 @@ def do\_transform(self, request, response, config): |
|  |  | if 'Object' in e['Event']: |
|  |  | for o in e['Event']['Object']: |
|  |  | if get\_attribute\_in\_object(o, attribute\_value=request.entity.value, substring=True).get('value'): |
|  |  | response += object\_to\_entity(o, link\_label=link\_label) |
|  |  | response += conn.object\_to\_entity(o, link\_label=link\_label) |
|  |  |  |
|  |  | return response |
|  |  |  |
| Expand Down  Expand Up | | @@ -137,20 +137,20 @@ def do\_transform(self, request, response, config): |
|  |  | # placeholder for https://github.com/MISP/MISP-maltego/issues/11 |
|  |  | pass |
|  |  |  |
|  |  | misp = get\_misp\_connection(config, request.parameters) |
|  |  | conn = MISPConnection(config, request.parameters) |
|  |  | # from Galaxy |
|  |  | if 'properties.mispgalaxy' in request.entity.fields: |
|  |  | tag\_name = get\_entity\_property(request.entity, 'tag\_name') |
|  |  | if not tag\_name: |
|  |  | tag\_name = request.entity.value |
|  |  | events\_json = misp.search(controller='events', tags=tag\_name, with\_attachments=False) |
|  |  | events\_json = conn.misp.search(controller='events', tags=tag\_name, with\_attachments=False) |
|  |  | for e in events\_json: |
|  |  | response += event\_to\_entity(e, link\_direction=LinkDirection.OutputToInput) |
|  |  | return response |
|  |  | # from Object |
|  |  | elif 'properties.mispobject' in request.entity.fields: |
|  |  | if request.entity.fields.get('event\_id'): |
|  |  | events\_json = misp.search(controller='events', eventid=request.entity.fields.get('event\_id').value, with\_attachments=False) |
|  |  | events\_json = conn.misp.search(controller='events', eventid=request.entity.fields.get('event\_id').value, with\_attachments=False) |
|  |  | for e in events\_json: |
|  |  | response += event\_to\_entity(e, link\_direction=LinkDirection.OutputToInput) |
|  |  | return response |
| Expand All | | @@ -161,13 +161,13 @@ def do\_transform(self, request, response, config): |
|  |  | tag\_name = get\_entity\_property(request.entity, 'Temp') |
|  |  | if not tag\_name: |
|  |  | tag\_name = request.entity.value |
|  |  | events\_json = misp.search(controller='events', tags=tag\_name, with\_attachments=False) |
|  |  | events\_json = conn.misp.search(controller='events', tags=tag\_name, with\_attachments=False) |
|  |  | for e in events\_json: |
|  |  | response += event\_to\_entity(e, link\_direction=LinkDirection.OutputToInput) |
|  |  | return response |
|  |  | # standard Entities (normal attributes) |
|  |  | else: |
|  |  | events\_json = misp.search(controller='events', value=request.entity.value, with\_attachments=False) |
|  |  | events\_json = conn.misp.search(controller='events', value=request.entity.value, with\_attachments=False) |
|  |  |  |
|  |  | # return the MISPEvent or MISPObject of the attribute |
|  |  | for e in events\_json: |
| Expand All | | @@ -179,6 +179,6 @@ def do\_transform(self, request, response, config): |
|  |  | if 'Object' in e['Event']: |
|  |  | for o in e['Event']['Object']: |
|  |  | if get\_attribute\_in\_object(o, attribute\_value=request.entity.value).get('value'): |
|  |  | response += object\_to\_entity(o, link\_direction=LinkDirection.OutputToInput) |
|  |  | response += conn.object\_to\_entity(o, link\_direction=LinkDirection.OutputToInput) |
|  |  |  |
|  |  | return response |

223 changes: 109 additions & 114 deletions

223
[src/MISP\_maltego/transforms/common/util.py](#diff-d7c185815f1db7803ec6553ff8568e468abf38396d90a291eeff4f93f0298824 "src/MISP_maltego/transforms/common/util.py")

Show comments

[View file](/MISP/MISP-maltego/blob/3ccde66dab4096ab5663e69f352992cc73e1160b/src/MISP_maltego/transforms/common/util.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,7 +18,6 @@ |
|  |  |  |
|  |  | tag\_note\_prefixes = ['tlp:', 'PAP:', 'de-vs:', 'euci:', 'fr-classif:', 'nato:'] |
|  |  |  |
|  |  | misp\_connection = None |
|  |  | update\_url = 'https://raw.githubusercontent.com/MISP/MISP-maltego/master/setup.py' |
|  |  | local\_path\_root = os.path.join(tempfile.gettempdir(), 'MISP-maltego') |
|  |  | local\_path\_version = os.path.join(local\_path\_root, 'versioncheck') |
| Expand Down  Expand Up | | @@ -64,37 +63,116 @@ def check\_update(config): |
|  |  | return None |
|  |  |  |
|  |  |  |
|  |  | def get\_misp\_connection(config=None, parameters=None): |
|  |  | global misp\_connection |
|  |  | if misp\_connection: |
|  |  | return misp\_connection |
|  |  | if not config: |
|  |  | raise MaltegoException("ERROR: MISP connection not yet established, and config not provided as parameter.") |
|  |  | misp\_verify = True |
|  |  | misp\_debug = False |
|  |  | misp\_url = None |
|  |  | misp\_key = None |
|  |  | try: |
|  |  | if is\_local\_exec\_mode(): |
|  |  | misp\_url = config['MISP\_maltego.local.misp\_url'] |
|  |  | misp\_key = config['MISP\_maltego.local.misp\_key'] |
|  |  | if config['MISP\_maltego.local.misp\_verify'] in ['False', 'false', 0, 'no', 'No']: |
|  |  | misp\_verify = False |
|  |  | if config['MISP\_maltego.local.misp\_debug'] in ['True', 'true', 1, 'yes', 'Yes']: |
|  |  | misp\_debug = True |
|  |  | if is\_remote\_exec\_mode(): |
|  |  | class MISPConnection(): |
|  |  | def \_\_init\_\_(self, config=None, parameters=None): |
|  |  | self.misp = None |
|  |  |  |
|  |  | if not config: |
|  |  | raise MaltegoException("ERROR: MISP connection not yet established, and config not provided as parameter.") |
|  |  | misp\_verify = True |
|  |  | misp\_debug = False |
|  |  | misp\_url = None |
|  |  | misp\_key = None |
|  |  | try: |
|  |  | if is\_local\_exec\_mode(): |
|  |  | misp\_url = config['MISP\_maltego.local.misp\_url'] |
|  |  | misp\_key = config['MISP\_maltego.local.misp\_key'] |
|  |  | if config['MISP\_maltego.local.misp\_verify'] in ['False', 'false', 0, 'no', 'No']: |
|  |  | misp\_verify = False |
|  |  | if config['MISP\_maltego.local.misp\_debug'] in ['True', 'true', 1, 'yes', 'Yes']: |
|  |  | misp\_debug = True |
|  |  | else: |
|  |  | try: |
|  |  | misp\_url = parameters['mispurl'].value |
|  |  | misp\_key = parameters['mispkey'].value |
|  |  | except AttributeError: |
|  |  | raise MaltegoException("ERROR: mispurl and mispkey need to be set to something valid") |
|  |  | self.misp = PyMISP(misp\_url, misp\_key, misp\_verify, 'json', misp\_debug, tool='misp\_maltego') |
|  |  | except Exception: |
|  |  | if is\_local\_exec\_mode(): |
|  |  | raise MaltegoException("ERROR: Cannot connect to MISP server. Please verify your MISP\_Maltego.conf settings.") |
|  |  | else: |
|  |  | raise MaltegoException("ERROR: Cannot connect to MISP server. Please verify your settings (MISP URL and API key), and ensure the MISP server is reachable from the internet.") |
|  |  |  |
|  |  | def object\_to\_entity(self, o, link\_label=None, link\_direction=LinkDirection.InputToOutput): |
|  |  | # find a nice icon for it |
|  |  | try: |
|  |  | icon\_url = mapping\_object\_icon[o['name']] |
|  |  | except KeyError: |
|  |  | # it's not in our mapping, just ignore and leave the default icon |
|  |  | icon\_url = None |
|  |  | # Generate a human readable display-name: |
|  |  | # - find the first RequiredOneOf that exists |
|  |  | # - if none, use the first RequiredField |
|  |  | # LATER further finetune the human readable version of this object |
|  |  | o\_template = self.misp.get\_object\_template(o['template\_uuid']) |
|  |  | human\_readable = None |
|  |  | try: |
|  |  | found = False |
|  |  | while not found: # the while loop is broken once something is found, or the requiredOneOf has no elements left |
|  |  | required\_ote\_type = o\_template['ObjectTemplate']['requirements']['requiredOneOf'].pop(0) |
|  |  | for ote in o\_template['ObjectTemplateElement']: |
|  |  | if ote['object\_relation'] == required\_ote\_type: |
|  |  | required\_a\_type = ote['type'] |
|  |  | break |
|  |  | for a in o['Attribute']: |
|  |  | if a['type'] == required\_a\_type: |
|  |  | human\_readable = '{}:\n{}'.format(o['name'], a['value']) |
|  |  | found = True |
|  |  | break |
|  |  | except Exception: |
|  |  | pass |
|  |  | if not human\_readable: |
|  |  | try: |
|  |  | misp\_url = parameters['mispurl'].value |
|  |  | misp\_key = parameters['mispkey'].value |
|  |  | except AttributeError: |
|  |  | raise MaltegoException("ERROR: mispurl and mispkey need to be set to something valid") |
|  |  | misp\_connection = PyMISP(misp\_url, misp\_key, misp\_verify, 'json', misp\_debug, tool='misp\_maltego') |
|  |  | except Exception: |
|  |  | if is\_local\_exec\_mode(): |
|  |  | raise MaltegoException("ERROR: Cannot connect to MISP server. Please verify your MISP\_Maltego.conf settings.") |
|  |  | if is\_remote\_exec\_mode(): |
|  |  | raise MaltegoException("ERROR: Cannot connect to MISP server. Please verify your settings (MISP URL and API key), and ensure the MISP server is reachable from the internet.") |
|  |  | return misp\_connection |
|  |  | found = False |
|  |  | parts = [] |
|  |  | for required\_ote\_type in o\_template['ObjectTemplate']['requirements']['required']: |
|  |  | for ote in o\_template['ObjectTemplateElement']: |
|  |  | if ote['object\_relation'] == required\_ote\_type: |
|  |  | required\_a\_type = ote['type'] |
|  |  | break |
|  |  | for a in o['Attribute']: |
|  |  | if a['type'] == required\_a\_type: |
|  |  | parts.append(a['value']) |
|  |  | break |
|  |  | human\_readable = '{}:\n{}'.format(o['name'], '|'.join(parts)) |
|  |  | except Exception: |
|  |  | human\_readable = o['name'] |
|  |  | return MISPObject( |
|  |  | human\_readable, |
|  |  | uuid=o['uuid'], |
|  |  | event\_id=int(o['event\_id']), |
|  |  | meta\_category=o.get('meta\_category'), |
|  |  | description=o.get('description'), |
|  |  | comment=o.get('comment'), |
|  |  | icon\_url=icon\_url, |
|  |  | link\_label=link\_label, |
|  |  | link\_direction=link\_direction, |
|  |  | bookmark=Bookmark.Green |
|  |  | ) |
|  |  |  |
|  |  | def object\_to\_relations(self, o, e): |
|  |  | # process forward and reverse references, so just loop over all the objects of the event |
|  |  | if 'Object' in e['Event']: |
|  |  | for eo in e['Event']['Object']: |
|  |  | if 'ObjectReference' in eo: |
|  |  | for ref in eo['ObjectReference']: |
|  |  | # we have found original object. Expand to the related object and attributes |
|  |  | if eo['uuid'] == o['uuid']: |
|  |  | # the reference is an Object |
|  |  | if ref.get('Object'): |
|  |  | # get the full object in the event, as our objectReference included does not contain everything we need |
|  |  | sub\_object = get\_object\_in\_event(ref['Object']['uuid'], e) |
|  |  | yield self.object\_to\_entity(sub\_object, link\_label=ref['relationship\_type']) |
|  |  | # the reference is an Attribute |
|  |  | if ref.get('Attribute'): |
|  |  | ref['Attribute']['event\_id'] = ref['event\_id'] # LATER remove this ugly workaround - object can't be requested directly from MISP using the uuid, and to find a full object we need the event\_id |
|  |  | for item in attribute\_to\_entity(ref['Attribute'], link\_label=ref['relationship\_type']): |
|  |  | yield item |
|  |  |  |
|  |  | # reverse-lookup - this is another objects relating the original object |
|  |  | if ref['referenced\_uuid'] == o['uuid']: |
|  |  | yield self.object\_to\_entity(eo, link\_label=ref['relationship\_type'], link\_direction=LinkDirection.OutputToInput) |
|  |  |  |
|  |  |  |
|  |  | def entity\_obj\_to\_entity(entity\_obj, v, t, \*\*kwargs): |
| Expand Down  Expand Up | | @@ -176,65 +254,6 @@ def attribute\_to\_entity(a, link\_label=None, event\_tags=[], only\_self=False): |
|  |  | # LATER : relationships from attributes - not yet supported by MISP yet, but there are references in the datamodel |
|  |  |  |
|  |  |  |
|  |  | def object\_to\_entity(o, link\_label=None, link\_direction=LinkDirection.InputToOutput): |
|  |  | misp = get\_misp\_connection() |
|  |  | # find a nice icon for it |
|  |  | try: |
|  |  | icon\_url = mapping\_object\_icon[o['name']] |
|  |  | except KeyError: |
|  |  | # it's not in our mapping, just ignore and leave the default icon |
|  |  | icon\_url = None |
|  |  | # Generate a human readable display-name: |
|  |  | # - find the first RequiredOneOf that exists |
|  |  | # - if none, use the first RequiredField |
|  |  | # LATER further finetune the human readable version of this object |
|  |  | o\_template = misp.get\_object\_template(o['template\_uuid']) |
|  |  | human\_readable = None |
|  |  | try: |
|  |  | found = False |
|  |  | while not found: # the while loop is broken once something is found, or the requiredOneOf has no elements left |
|  |  | required\_ote\_type = o\_template['ObjectTemplate']['requirements']['requiredOneOf'].pop(0) |
|  |  | for ote in o\_template['ObjectTemplateElement']: |
|  |  | if ote['object\_relation'] == required\_ote\_type: |
|  |  | required\_a\_type = ote['type'] |
|  |  | break |
|  |  | for a in o['Attribute']: |
|  |  | if a['type'] == required\_a\_type: |
|  |  | human\_readable = '{}:\n{}'.format(o['name'], a['value']) |
|  |  | found = True |
|  |  | break |
|  |  | except Exception: |
|  |  | pass |
|  |  | if not human\_readable: |
|  |  | try: |
|  |  | found = False |
|  |  | parts = [] |
|  |  | for required\_ote\_type in o\_template['ObjectTemplate']['requirements']['required']: |
|  |  | for ote in o\_template['ObjectTemplateElement']: |
|  |  | if ote['object\_relation'] == required\_ote\_type: |
|  |  | required\_a\_type = ote['type'] |
|  |  | break |
|  |  | for a in o['Attribute']: |
|  |  | if a['type'] == required\_a\_type: |
|  |  | parts.append(a['value']) |
|  |  | break |
|  |  | human\_readable = '{}:\n{}'.format(o['name'], '|'.join(parts)) |
|  |  | except Exception: |
|  |  | human\_readable = o['name'] |
|  |  | return MISPObject( |
|  |  | human\_readable, |
|  |  | uuid=o['uuid'], |
|  |  | event\_id=int(o['event\_id']), |
|  |  | meta\_category=o.get('meta\_category'), |
|  |  | description=o.get('description'), |
|  |  | comment=o.get('comment'), |
|  |  | icon\_url=icon\_url, |
|  |  | link\_label=link\_label, |
|  |  | link\_direction=link\_direction, |
|  |  | bookmark=Bookmark.Green |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | def object\_to\_attributes(o, e): |
|  |  | # first process attributes from an object that belong together (eg: first-name + last-name), and remove them from the list |
|  |  | if o['name'] == 'person': |
| Expand All | | @@ -248,30 +267,6 @@ def object\_to\_attributes(o, e): |
|  |  | yield item |
|  |  |  |
|  |  |  |
|  |  | def object\_to\_relations(o, e): |
|  |  | # process forward and reverse references, so just loop over all the objects of the event |
|  |  | if 'Object' in e['Event']: |
|  |  | for eo in e['Event']['Object']: |
|  |  | if 'ObjectReference' in eo: |
|  |  | for ref in eo['ObjectReference']: |
|  |  | # we have found original object. Expand to the related object and attributes |
|  |  | if eo['uuid'] == o['uuid']: |
|  |  | # the reference is an Object |
|  |  | if ref.get('Object'): |
|  |  | # get the full object in the event, as our objectReference included does not contain everything we need |
|  |  | sub\_object = get\_object\_in\_event(ref['Object']['uuid'], e) |
|  |  | yield object\_to\_entity(sub\_object, link\_label=ref['relationship\_type']) |
|  |  | # the reference is an Attribute |
|  |  | if ref.get('Attribute'): |
|  |  | ref['Attribute']['event\_id'] = ref['event\_id'] # LATER remove this ugly workaround - object can't be requested directly from MISP using the uuid, and to find a full object we need the event\_id |
|  |  | for item in attribute\_to\_entity(ref['Attribute'], link\_label=ref['relationship\_type']): |
|  |  | yield item |
|  |  |  |
|  |  | # reverse-lookup - this is another objects relating the original object |
|  |  | if ref['referenced\_uuid'] == o['uuid']: |
|  |  | yield object\_to\_entity(eo, link\_label=ref['relationship\_type'], link\_direction=LinkDirection.OutputToInput) |
|  |  |  |
|  |  |  |
|  |  | def get\_object\_in\_event(uuid, e): |
|  |  | for o in e['Event']['Object']: |
|  |  | if o['uuid'] == uuid: |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3ccde66`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP-maltego%2Fcommit%2F3ccde66dab4096ab5663e69f352992cc73e1160b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


