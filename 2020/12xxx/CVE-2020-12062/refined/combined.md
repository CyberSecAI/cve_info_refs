=== Content from github.com_eac0ba3e_20250119_113059.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssh%2Fopenssh-portable%2Fcommit%2Faad87b88fc2536b1ea023213729aaf4eaabe1894)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssh%2Fopenssh-portable%2Fcommit%2Faad87b88fc2536b1ea023213729aaf4eaabe1894)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openssh%2Fopenssh-portable)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openssh](/openssh)
/
**[openssh-portable](/openssh/openssh-portable)**
Public

* [Notifications](/login?return_to=%2Fopenssh%2Fopenssh-portable) You must be signed in to change notification settings
* [Fork
  1.8k](/login?return_to=%2Fopenssh%2Fopenssh-portable)
* [Star
   3.2k](/login?return_to=%2Fopenssh%2Fopenssh-portable)

* [Code](/openssh/openssh-portable)
* [Pull requests
  110](/openssh/openssh-portable/pulls)
* [Actions](/openssh/openssh-portable/actions)
* [Security](/openssh/openssh-portable/security)
* [Insights](/openssh/openssh-portable/pulse)

Additional navigation options

* [Code](/openssh/openssh-portable)
* [Pull requests](/openssh/openssh-portable/pulls)
* [Actions](/openssh/openssh-portable/actions)
* [Security](/openssh/openssh-portable/security)
* [Insights](/openssh/openssh-portable/pulse)

## Commit

[Permalink](/openssh/openssh-portable/commit/aad87b88fc2536b1ea023213729aaf4eaabe1894)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

upstream: when receving a file in sink(), be careful to send at

[Browse files](/openssh/openssh-portable/tree/aad87b88fc2536b1ea023213729aaf4eaabe1894)
Browse the repository at this point in the history

```
most a single error response after the file has been opened. Otherwise the
source() and sink() can become desyncronised. Reported by Daniel Goujot,
Georges-Axel Jaloyan, Ryan Lahfa, and David Naccache.

ok deraadt@ markus@

OpenBSD-Commit-ID: 6c14d233c97349cb811a8f7921ded3ae7d9e0035
```

* Loading branch information

[![@djmdjm](https://avatars.githubusercontent.com/u/170281?s=40&v=4)](/djmdjm)

[djmdjm](/openssh/openssh-portable/commits?author=djmdjm "View all commits by djmdjm")
committed
May 1, 2020

1 parent
[3190969](/openssh/openssh-portable/commit/31909696c4620c431dd55f6cd15db65c4e9b98da)

commit aad87b8

Showing
**1 changed file**
with
**59 additions**
and
**37 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

96 changes: 59 additions & 37 deletions

96
[scp.c](#diff-7f918cdeae9104eeb91432e4096e5f886af9f481409033052cf07d2fc932f465 "scp.c")

Show comments

[View file](/openssh/openssh-portable/blob/aad87b88fc2536b1ea023213729aaf4eaabe1894/scp.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | /\* $OpenBSD: scp.c,v 1.208 2020/04/30 17:07:10 markus Exp $ \*/ |
|  |  | /\* $OpenBSD: scp.c,v 1.209 2020/05/01 06:31:42 djm Exp $ \*/ |
|  |  | /\* |
|  |  | \* scp - secure remote copy. This is basically patched BSD rcp which |
|  |  | \* uses ssh to do the data transfer (instead of using rcmd). |
| Expand Down  Expand Up | | @@ -374,6 +374,7 @@ BUF \*allocbuf(BUF \*, int, int); |
|  |  | void lostconn(int); |
|  |  | int okname(char \*); |
|  |  | void run\_err(const char \*,...); |
|  |  | int note\_err(const char \*,...); |
|  |  | void verifydir(char \*); |
|  |  |  |
|  |  | struct passwd \*pwd; |
| Expand Down  Expand Up | | @@ -1231,17 +1232,14 @@ sink(int argc, char \*\*argv, const char \*src) |
|  |  | { |
|  |  | static BUF buffer; |
|  |  | struct stat stb; |
|  |  | enum { |
|  |  | YES, NO, DISPLAYED |
|  |  | } wrerr; |
|  |  | BUF \*bp; |
|  |  | off\_t i; |
|  |  | size\_t j, count; |
|  |  | int amt, exists, first, ofd; |
|  |  | mode\_t mode, omode, mask; |
|  |  | off\_t size, statbytes; |
|  |  | unsigned long long ull; |
|  |  | int setimes, targisdir, wrerrno = 0; |
|  |  | int setimes, targisdir, wrerr; |
|  |  | char ch, \*cp, \*np, \*targ, \*why, \*vect[1], buf[2048], visbuf[2048]; |
|  |  | char \*\*patterns = NULL; |
|  |  | size\_t n, npatterns = 0; |
| Expand Down  Expand Up | | @@ -1450,8 +1448,13 @@ bad: run\_err("%s: %s", np, strerror(errno)); |
|  |  | continue; |
|  |  | } |
|  |  | cp = bp->buf; |
|  |  | wrerr = NO; |
|  |  | wrerr = 0; |
|  |  |  |
|  |  | /\* |
|  |  | \* NB. do not use run\_err() unless immediately followed by |
|  |  | \* exit() below as it may send a spurious reply that might |
|  |  | \* desyncronise us from the peer. Use note\_err() instead. |
|  |  | \*/ |
|  |  | statbytes = 0; |
|  |  | if (showprogress) |
|  |  | start\_progress\_meter(curfile, size, &statbytes); |
| Expand All | | @@ -1476,38 +1479,36 @@ bad: run\_err("%s: %s", np, strerror(errno)); |
|  |  |  |
|  |  | if (count == bp->cnt) { |
|  |  | /\* Keep reading so we stay sync'd up. \*/ |
|  |  | if (wrerr == NO) { |
|  |  | if (!wrerr) { |
|  |  | if (atomicio(vwrite, ofd, bp->buf, |
|  |  | count) != count) { |
|  |  | wrerr = YES; |
|  |  | wrerrno = errno; |
|  |  | note\_err("%s: %s", np, |
|  |  | strerror(errno)); |
|  |  | wrerr = 1; |
|  |  | } |
|  |  | } |
|  |  | count = 0; |
|  |  | cp = bp->buf; |
|  |  | } |
|  |  | } |
|  |  | unset\_nonblock(remin); |
|  |  | if (count != 0 && wrerr == NO && |
|  |  | if (count != 0 && !wrerr && |
|  |  | atomicio(vwrite, ofd, bp->buf, count) != count) { |
|  |  | wrerr = YES; |
|  |  | wrerrno = errno; |
|  |  | } |
|  |  | if (wrerr == NO && (!exists || S\_ISREG(stb.st\_mode)) && |
|  |  | ftruncate(ofd, size) != 0) { |
|  |  | run\_err("%s: truncate: %s", np, strerror(errno)); |
|  |  | wrerr = DISPLAYED; |
|  |  | note\_err("%s: %s", np, strerror(errno)); |
|  |  | wrerr = 1; |
|  |  | } |
|  |  | if (!wrerr && (!exists || S\_ISREG(stb.st\_mode)) && |
|  |  | ftruncate(ofd, size) != 0) |
|  |  | note\_err("%s: truncate: %s", np, strerror(errno)); |
|  |  | if (pflag) { |
|  |  | if (exists || omode != mode) |
|  |  | #ifdef HAVE\_FCHMOD |
|  |  | if (fchmod(ofd, omode)) { |
|  |  | #else /\* HAVE\_FCHMOD \*/ |
|  |  | if (chmod(np, omode)) { |
|  |  | #endif /\* HAVE\_FCHMOD \*/ |
|  |  | run\_err("%s: set mode: %s", |
|  |  | note\_err("%s: set mode: %s", |
|  |  | np, strerror(errno)); |
|  |  | wrerr = DISPLAYED; |
|  |  | } |
|  |  | } else { |
|  |  | if (!exists && omode != mode) |
| Expand All | | @@ -1516,36 +1517,25 @@ bad: run\_err("%s: %s", np, strerror(errno)); |
|  |  | #else /\* HAVE\_FCHMOD \*/ |
|  |  | if (chmod(np, omode & ~mask)) { |
|  |  | #endif /\* HAVE\_FCHMOD \*/ |
|  |  | run\_err("%s: set mode: %s", |
|  |  | note\_err("%s: set mode: %s", |
|  |  | np, strerror(errno)); |
|  |  | wrerr = DISPLAYED; |
|  |  | } |
|  |  | } |
|  |  | if (close(ofd) == -1) { |
|  |  | wrerr = YES; |
|  |  | wrerrno = errno; |
|  |  | } |
|  |  | if (close(ofd) == -1) |
|  |  | note\_err(np, "%s: close: %s", np, strerror(errno)); |
|  |  | (void) response(); |
|  |  | if (showprogress) |
|  |  | stop\_progress\_meter(); |
|  |  | if (setimes && wrerr == NO) { |
|  |  | if (setimes && !wrerr) { |
|  |  | setimes = 0; |
|  |  | if (utimes(np, tv) == -1) { |
|  |  | run\_err("%s: set times: %s", |
|  |  | note\_err("%s: set times: %s", |
|  |  | np, strerror(errno)); |
|  |  | wrerr = DISPLAYED; |
|  |  | } |
|  |  | } |
|  |  | switch (wrerr) { |
|  |  | case YES: |
|  |  | run\_err("%s: %s", np, strerror(wrerrno)); |
|  |  | break; |
|  |  | case NO: |
|  |  | /\* If no error was noted then signal success for this file \*/ |
|  |  | if (note\_err(NULL) == 0) |
|  |  | (void) atomicio(vwrite, remout, "", 1); |
|  |  | break; |
|  |  | case DISPLAYED: |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | done: |
|  |  | for (n = 0; n < npatterns; n++) |
| Expand Down  Expand Up | | @@ -1633,6 +1623,38 @@ run\_err(const char \*fmt,...) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Notes a sink error for sending at the end of a file transfer. Returns 0 if |
|  |  | \* no error has been noted or -1 otherwise. Use note\_err(NULL) to flush |
|  |  | \* any active error at the end of the transfer. |
|  |  | \*/ |
|  |  | int |
|  |  | note\_err(const char \*fmt, ...) |
|  |  | { |
|  |  | static char \*emsg; |
|  |  | va\_list ap; |
|  |  |  |
|  |  | /\* Replay any previously-noted error \*/ |
|  |  | if (fmt == NULL) { |
|  |  | if (emsg == NULL) |
|  |  | return 0; |
|  |  | run\_err("%s", emsg); |
|  |  | free(emsg); |
|  |  | emsg = NULL; |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | errs++; |
|  |  | /\* Prefer first-noted error \*/ |
|  |  | if (emsg != NULL) |
|  |  | return -1; |
|  |  |  |
|  |  | va\_start(ap, fmt); |
|  |  | vasnmprintf(&emsg, INT\_MAX, NULL, fmt, ap); |
|  |  | va\_end(ap); |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | void |
|  |  | verifydir(char \*cp) |
|  |  | { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `aad87b8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssh%2Fopenssh-portable%2Fcommit%2Faad87b88fc2536b1ea023213729aaf4eaabe1894) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6e1e102a_20250119_113058.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssh%2Fopenssh-portable%2Fcommit%2F955854cafca88e0cdcd3d09ca1ad4ada465364a1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssh%2Fopenssh-portable%2Fcommit%2F955854cafca88e0cdcd3d09ca1ad4ada465364a1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openssh%2Fopenssh-portable)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openssh](/openssh)
/
**[openssh-portable](/openssh/openssh-portable)**
Public

* [Notifications](/login?return_to=%2Fopenssh%2Fopenssh-portable) You must be signed in to change notification settings
* [Fork
  1.8k](/login?return_to=%2Fopenssh%2Fopenssh-portable)
* [Star
   3.2k](/login?return_to=%2Fopenssh%2Fopenssh-portable)

* [Code](/openssh/openssh-portable)
* [Pull requests
  110](/openssh/openssh-portable/pulls)
* [Actions](/openssh/openssh-portable/actions)
* [Security](/openssh/openssh-portable/security)
* [Insights](/openssh/openssh-portable/pulse)

Additional navigation options

* [Code](/openssh/openssh-portable)
* [Pull requests](/openssh/openssh-portable/pulls)
* [Actions](/openssh/openssh-portable/actions)
* [Security](/openssh/openssh-portable/security)
* [Insights](/openssh/openssh-portable/pulse)

## Commit

[Permalink](/openssh/openssh-portable/commit/955854cafca88e0cdcd3d09ca1ad4ada465364a1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

upstream: another case where a utimes() failure could make scp send

[Browse files](/openssh/openssh-portable/tree/955854cafca88e0cdcd3d09ca1ad4ada465364a1)
Browse the repository at this point in the history

```
a desynchronising error; reminded by Aymeric Vincent ok deraadt markus

OpenBSD-Commit-ID: 2ea611d34d8ff6d703a7a8bf858aa5dbfbfa7381
```

* Loading branch information

[![@djmdjm](https://avatars.githubusercontent.com/u/170281?s=40&v=4)](/djmdjm) [![@daztucker](https://avatars.githubusercontent.com/u/4781274?s=40&v=4)](/daztucker)

[djmdjm](/openssh/openssh-portable/commits?author=djmdjm "View all commits by djmdjm")
authored and
[daztucker](/openssh/openssh-portable/commits?author=daztucker "View all commits by daztucker")
committed
May 7, 2020

1 parent
[59d5315](/openssh/openssh-portable/commit/59d531553fd90196946743da391f3a27cf472f4e)

commit 955854c

Showing
**1 changed file**
with
**2 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

6 changes: 2 additions & 4 deletions

6
[scp.c](#diff-7f918cdeae9104eeb91432e4096e5f886af9f481409033052cf07d2fc932f465 "scp.c")

Show comments

[View file](/openssh/openssh-portable/blob/955854cafca88e0cdcd3d09ca1ad4ada465364a1/scp.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | /\* $OpenBSD: scp.c,v 1.209 2020/05/01 06:31:42 djm Exp $ \*/ |
|  |  | /\* $OpenBSD: scp.c,v 1.210 2020/05/06 20:57:38 djm Exp $ \*/ |
|  |  | /\* |
|  |  | \* scp - secure remote copy. This is basically patched BSD rcp which |
|  |  | \* uses ssh to do the data transfer (instead of using rcmd). |
| Expand Down  Expand Up | | @@ -1427,9 +1427,7 @@ sink(int argc, char \*\*argv, const char \*src) |
|  |  | sink(1, vect, src); |
|  |  | if (setimes) { |
|  |  | setimes = 0; |
|  |  | if (utimes(vect[0], tv) == -1) |
|  |  | run\_err("%s: set times: %s", |
|  |  | vect[0], strerror(errno)); |
|  |  | (void) utimes(vect[0], tv); |
|  |  | } |
|  |  | if (mod\_flag) |
|  |  | (void) chmod(vect[0], mode); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `955854c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssh%2Fopenssh-portable%2Fcommit%2F955854cafca88e0cdcd3d09ca1ad4ada465364a1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openssh.com_2f1f82b6_20250119_113100.html ===
OpenSSH 8.3 was released on 2020-05-27. It is available from the
mirrors listed at https://www.openssh.com/.
OpenSSH is a 100% complete SSH protocol 2.0 implementation and
includes sftp client and server support.
Once again, we would like to thank the OpenSSH community for their
continued support of the project, especially those who contributed
code or patches, reported bugs, tested snapshots or donated to the
project. More information on donations may be found at:
https://www.openssh.com/donations.html
Future deprecation notice
=========================
It is now possible[1] to perform chosen-prefix attacks against the
SHA-1 algorithm for less than USD$50K. For this reason, we will be
disabling the "ssh-rsa" public key signature algorithm by default in a
near-future release.
This algorithm is unfortunately still used widely despite the
existence of better alternatives, being the only remaining public key
signature algorithm specified by the original SSH RFCs.
The better alternatives include:
\* The RFC8332 RSA SHA-2 signature algorithms rsa-sha2-256/512. These
algorithms have the advantage of using the same key type as
"ssh-rsa" but use the safe SHA-2 hash algorithms. These have been
supported since OpenSSH 7.2 and are already used by default if the
client and server support them.
\* The ssh-ed25519 signature algorithm. It has been supported in
OpenSSH since release 6.5.
\* The RFC5656 ECDSA algorithms: ecdsa-sha2-nistp256/384/521. These
have been supported by OpenSSH since release 5.7.
To check whether a server is using the weak ssh-rsa public key
algorithm, for host authentication, try to connect to it after
removing the ssh-rsa algorithm from ssh(1)'s allowed list:
ssh -oHostKeyAlgorithms=-ssh-rsa user@host
If the host key verification fails and no other supported host key
types are available, the server software on that host should be
upgraded.
A future release of OpenSSH will enable UpdateHostKeys by default
to allow the client to automatically migrate to better algorithms.
Users may consider enabling this option manually. Vendors of devices
that implement the SSH protocol should ensure that they support the
new signature algorithms for RSA keys.
[1] "SHA-1 is a Shambles: First Chosen-Prefix Collision on SHA-1 and
Application to the PGP Web of Trust" Leurent, G and Peyrin, T
(2020) https://eprint.iacr.org/2020/014.pdf
Security
========
\* scp(1): when receiving files, scp(1) could be become desynchronised
if a utimes(2) system call failed. This could allow file contents
to be interpreted as file metadata and thereby permit an adversary
to craft a file system that, when copied with scp(1) in a
configuration that caused utimes(2) to fail (e.g. under a SELinux
policy or syscall sandbox), transferred different file names and
contents to the actual file system layout.
Exploitation of this is not likely as utimes(2) does not fail under
normal circumstances. Successful exploitation is not silent - the
output of scp(1) would show transfer errors followed by the actual
file(s) that were received.
Finally, filenames returned from the peer are (since openssh-8.0)
matched against the user's requested destination, thereby
disallowing a successful exploit from writing files outside the
user's selected target glob (or directory, in the case of a
recursive transfer). This ensures that this attack can achieve no
more than a hostile peer is already able to achieve within the scp
protocol.
Potentially-incompatible changes
================================
This release includes a number of changes that may affect existing
configurations:
\* sftp(1): reject an argument of "-1" in the same way as ssh(1) and
scp(1) do instead of accepting and silently ignoring it.
Changes since OpenSSH 8.2
=========================
The focus of this release is bug fixing.
New Features
------------
\* sshd(8): make IgnoreRhosts a tri-state option: "yes" to ignore
rhosts/shosts, "no" allow rhosts/shosts or (new) "shosts-only"
to allow .shosts files but not .rhosts.
\* sshd(8): allow the IgnoreRhosts directive to appear anywhere in a
sshd\_config, not just before any Match blocks; bz3148
\* ssh(1): add %TOKEN percent expansion for the LocalFoward and
RemoteForward keywords when used for Unix domain socket forwarding.
bz#3014
\* all: allow loading public keys from the unencrypted envelope of a
private key file if no corresponding public key file is present.
\* ssh(1), sshd(8): prefer to use chacha20 from libcrypto where
possible instead of the (slower) portable C implementation included
in OpenSSH.
\* ssh-keygen(1): add ability to dump the contents of a binary key
revocation list via "ssh-keygen -lQf /path" bz#3132
Bugfixes
--------
\* ssh(1): fix IdentitiesOnly=yes to also apply to keys loaded from
a PKCS11Provider; bz#3141
\* ssh-keygen(1): avoid NULL dereference when trying to convert an
invalid RFC4716 private key.
\* scp(1): when performing remote-to-remote copies using "scp -3",
start the second ssh(1) channel with BatchMode=yes enabled to
avoid confusing and non-deterministic ordering of prompts.
\* ssh(1), ssh-keygen(1): when signing a challenge using a FIDO token,
perform hashing of the message to be signed in the middleware layer
rather than in OpenSSH code. This permits the use of security key
middlewares that perform the hashing implicitly, such as Windows
Hello.
\* ssh(1): fix incorrect error message for "too many known hosts
files." bz#3149
\* ssh(1): make failures when establishing "Tunnel" forwarding
terminate the connection when ExitOnForwardFailure is enabled;
bz#3116
\* ssh-keygen(1): fix printing of fingerprints on private keys and add
a regression test for same.
\* sshd(8): document order of checking AuthorizedKeysFile (first) and
AuthorizedKeysCommand (subsequently, if the file doesn't match);
bz#3134
\* sshd(8): document that /etc/hosts.equiv and /etc/shosts.equiv are
not considered for HostbasedAuthentication when the target user is
root; bz#3148
\* ssh(1), ssh-keygen(1): fix NULL dereference in private certificate
key parsing (oss-fuzz #20074).
\* ssh(1), sshd(8): more consistency between sets of %TOKENS are
accepted in various configuration options.
\* ssh(1), ssh-keygen(1): improve error messages for some common
PKCS#11 C\_Login failure cases; bz#3130
\* ssh(1), sshd(8): make error messages for problems during SSH banner
exchange consistent with other SSH transport-layer error messages
and ensure they include the relevant IP addresses bz#3129
\* various: fix a number of spelling errors in comments and debug/error
messages
\* ssh-keygen(1), ssh-add(1): when downloading FIDO2 resident keys
from a token, don't prompt for a PIN until the token has told us
that it needs one. Avoids double-prompting on devices that
implement on-device authentication.
\* sshd(8), ssh-keygen(1): no-touch-required FIDO certificate option
should be an extension, not a critical option.
\* ssh(1), ssh-keygen(1), ssh-add(1): offer a better error message
when trying to use a FIDO key function and SecurityKeyProvider is
empty.
\* ssh-add(1), ssh-agent(8): ensure that a key lifetime fits within
the values allowed by the wire format (u32). Prevents integer
wraparound of the timeout values. bz#3119
\* ssh(1): detect and prevent trivial configuration loops when using
ProxyJump. bz#3057.
Portability
-----------
\* Detect systems where signals flagged with SA\_RESTART will interrupt
select(2). POSIX permits implementations to choose whether
select(2) will return when interrupted with a SA\_RESTART-flagged
signal, but OpenSSH requires interrupting behaviour.
\* Several compilation fixes for HP/UX and AIX.
\* On platforms that do not support setting process-wide routing
domains (all excepting OpenBSD at present), fail to accept a
configuration attempts to set one at process start time rather than
fatally erroring at run time. bz#3126
\* Improve detection of egrep (used in regression tests) on platforms
that offer a poor default one (e.g. Solaris).
\* A number of shell portability fixes for the regression tests.
\* Fix theoretical infinite loop in the glob(3) replacement
implementation.
\* Fix seccomp sandbox compilation problems for some Linux
configurations bz#3085
\* Improved detection of libfido2 and some compilation fixes for some
configurations when --with-security-key-builtin is selected.
Checksums:
==========
- SHA1 (openssh-8.3.tar.gz) = 46c63b7ddbe46a0666222f7988c993866c31fcca
- SHA256 (openssh-8.3.tar.gz) = M6CnZ+duGs4bzDio8hQNLwyLQChV+3wkUEO8HWLV35c=
- SHA1 (/openssh-8.3p1.tar.gz) = 04c7adb9986f16746588db8988b910530c589819
- SHA256 (openssh-8.3p1.tar.gz) = 8r774Ecv5+t10jNA6xdTHLazqsJAdeIGa0H4FOEjh7I=
Please note that the SHA256 signatures are base64 encoded and not
hexadecimal (which is the default for most checksum tools). The PGP
key used to sign the releases is available as RELEASE\_KEY.asc from
the mirror sites.
Reporting Bugs:
===============
- Please read https://www.openssh.com/report.html
Security bugs should be reported directly to openssh@openssh.com


=== Content from www.openwall.com_04857bab_20250119_113100.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2020/05/22/6) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <9739d4a6516e888a@openbsd.org>
Date: Wed, 27 May 2020 00:12:59 -0600 (MDT)
From: Damien Miller <djm@...nbsd.org>
To: oss-security@...ts.openwall.com
Subject: Announce: OpenSSH 8.3 released

OpenSSH 8.3 has just been released. It will be available from the
mirrors listed at <https://www.openssh.com/> shortly.

OpenSSH is a 100% complete SSH protocol 2.0 implementation and
includes sftp client and server support.

Once again, we would like to thank the OpenSSH community for their
continued support of the project, especially those who contributed
code or patches, reported bugs, tested snapshots or donated to the
project. More information on donations may be found at:
<https://www.openssh.com/donations.html>

Future deprecation notice
=========================

It is now possible[1] to perform chosen-prefix attacks against the
SHA-1 algorithm for less than USD$50K. For this reason, we will be
disabling the "ssh-rsa" public key signature algorithm by default in a
near-future release.

This algorithm is unfortunately still used widely despite the
existence of better alternatives, being the only remaining public key
signature algorithm specified by the original SSH RFCs.

The better alternatives include:

 * The RFC8332 RSA SHA-2 signature algorithms rsa-sha2-256/512. These
   algorithms have the advantage of using the same key type as
   "ssh-rsa" but use the safe SHA-2 hash algorithms. These have been
   supported since OpenSSH 7.2 and are already used by default if the
   client and server support them.

 * The ssh-ed25519 signature algorithm. It has been supported in
   OpenSSH since release 6.5.

 * The RFC5656 ECDSA algorithms: ecdsa-sha2-nistp256/384/521. These
   have been supported by OpenSSH since release 5.7.

To check whether a server is using the weak ssh-rsa public key
algorithm, for host authentication, try to connect to it after
removing the ssh-rsa algorithm from ssh(1)'s allowed list:

    ssh -oHostKeyAlgorithms=-ssh-rsa user@...t

If the host key verification fails and no other supported host key
types are available, the server software on that host should be
upgraded.

A future release of OpenSSH will enable UpdateHostKeys by default
to allow the client to automatically migrate to better algorithms.
Users may consider enabling this option manually. Vendors of devices
that implement the SSH protocol should ensure that they support the
new signature algorithms for RSA keys.

[1] "SHA-1 is a Shambles: First Chosen-Prefix Collision on SHA-1 and
    Application to the PGP Web of Trust" Leurent, G and Peyrin, T
    (2020) <https://eprint.iacr.org/2020/014.pdf>

Security
========

 * scp(1): when receiving files, scp(1) could be become desynchronised
   if a utimes(2) system call failed. This could allow file contents
   to be interpreted as file metadata and thereby permit an adversary
   to craft a file system that, when copied with scp(1) in a
   configuration that caused utimes(2) to fail (e.g. under a SELinux
   policy or syscall sandbox), transferred different file names and
   contents to the actual file system layout.

   Exploitation of this is not likely as utimes(2) does not fail under
   normal circumstances. Successful exploitation is not silent - the
   output of scp(1) would show transfer errors followed by the actual
   file(s) that were received.

   Finally, filenames returned from the peer are (since openssh-8.0)
   matched against the user's requested destination, thereby
   disallowing a successful exploit from writing files outside the
   user's selected target glob (or directory, in the case of a
   recursive transfer). This ensures that this attack can achieve no
   more than a hostile peer is already able to achieve within the scp
   protocol.

Potentially-incompatible changes
================================

This release includes a number of changes that may affect existing
configurations:

 * sftp(1): reject an argument of "-1" in the same way as ssh(1) and
   scp(1) do instead of accepting and silently ignoring it.

Changes since OpenSSH 8.2
=========================

The focus of this release is bug fixing.

New Features
------------

 * sshd(8): make IgnoreRhosts a tri-state option: "yes" to ignore
   rhosts/shosts, "no" allow rhosts/shosts or (new) "shosts-only"
   to allow .shosts files but not .rhosts.

 * sshd(8): allow the IgnoreRhosts directive to appear anywhere in a
   sshd_config, not just before any Match blocks; bz3148

 * ssh(1): add %TOKEN percent expansion for the LocalFoward and
   RemoteForward keywords when used for Unix domain socket forwarding.
   bz#3014

 * all: allow loading public keys from the unencrypted envelope of a
   private key file if no corresponding public key file is present.

 * ssh(1), sshd(8): prefer to use chacha20 from libcrypto where
   possible instead of the (slower) portable C implementation included
   in OpenSSH.

 * ssh-keygen(1): add ability to dump the contents of a binary key
   revocation list via "ssh-keygen -lQf /path" bz#3132

Bugfixes
--------

 * ssh(1): fix IdentitiesOnly=yes to also apply to keys loaded from
   a PKCS11Provider; bz#3141

 * ssh-keygen(1): avoid NULL dereference when trying to convert an
   invalid RFC4716 private key.

 * scp(1): when performing remote-to-remote copies using "scp -3",
   start the second ssh(1) channel with BatchMode=yes enabled to
   avoid confusing and non-deterministic ordering of prompts.

 * ssh(1), ssh-keygen(1): when signing a challenge using a FIDO token,
   perform hashing of the message to be signed in the middleware layer
   rather than in OpenSSH code. This permits the use of security key
   middlewares that perform the hashing implicitly, such as Windows
   Hello.

 * ssh(1): fix incorrect error message for "too many known hosts
   files." bz#3149

 * ssh(1): make failures when establishing "Tunnel" forwarding
   terminate the connection when ExitOnForwardFailure is enabled;
   bz#3116

 * ssh-keygen(1): fix printing of fingerprints on private keys and add
   a regression test for same.

 * sshd(8): document order of checking AuthorizedKeysFile (first) and
   AuthorizedKeysCommand (subsequently, if the file doesn't match);
   bz#3134

 * sshd(8): document that /etc/hosts.equiv and /etc/shosts.equiv are
   not considered for HostbasedAuthentication when the target user is
   root; bz#3148

 * ssh(1), ssh-keygen(1): fix NULL dereference in private certificate
   key parsing (oss-fuzz #20074).

 * ssh(1), sshd(8): more consistency between sets of %TOKENS are
   accepted in various configuration options.

 * ssh(1), ssh-keygen(1): improve error messages for some common
   PKCS#11 C_Login failure cases; bz#3130

 * ssh(1), sshd(8): make error messages for problems during SSH banner
   exchange consistent with other SSH transport-layer error messages
   and ensure they include the relevant IP addresses bz#3129

 * various: fix a number of spelling errors in comments and debug/error
   messages

 * ssh-keygen(1), ssh-add(1): when downloading FIDO2 resident keys
   from a token, don't prompt for a PIN until the token has told us
   that it needs one. Avoids double-prompting on devices that
   implement on-device authentication.

 * sshd(8), ssh-keygen(1): no-touch-required FIDO certificate option
   should be an extension, not a critical option.

 * ssh(1), ssh-keygen(1), ssh-add(1): offer a better error message
   when trying to use a FIDO key function and SecurityKeyProvider is
   empty.

 * ssh-add(1), ssh-agent(8): ensure that a key lifetime fits within
   the values allowed by the wire format (u32). Prevents integer
   wraparound of the timeout values. bz#3119

 * ssh(1): detect and prevent trivial configuration loops when using
    ProxyJump. bz#3057.

Portability
-----------

 * Detect systems where signals flagged with SA_RESTART will interrupt
   select(2). POSIX permits implementations to choose whether
   select(2) will return when interrupted with a SA_RESTART-flagged
   signal, but OpenSSH requires interrupting behaviour.

 * Several compilation fixes for HP/UX and AIX.

 * On platforms that do not support setting process-wide routing
   domains (all excepting OpenBSD at present), fail to accept a
   configuration attempts to set one at process start time rather than
   fatally erroring at run time. bz#3126

 * Improve detection of egrep (used in regression tests) on platforms
   that offer a poor default one (e.g. Solaris).

 * A number of shell portability fixes for the regression tests.

 * Fix theoretical infinite loop in the glob(3) replacement
   implementation.

 * Fix seccomp sandbox compilation problems for some Linux
   configurations bz#3085

 * Improved detection of libfido2 and some compilation fixes for some
   configurations when --with-security-key-builtin is selected.

Checksums:
==========

 - SHA1 (openssh-8.3.tar.gz) = 46c63b7ddbe46a0666222f7988c993866c31fcca
 - SHA256 (openssh-8.3.tar.gz) = M6CnZ+duGs4bzDio8hQNLwyLQChV+3wkUEO8HWLV35c=

 - SHA1 (/openssh-8.3p1.tar.gz) = 04c7adb9986f16746588db8988b910530c589819
 - SHA256 (openssh-8.3p1.tar.gz) = 8r774Ecv5+t10jNA6xdTHLazqsJAdeIGa0H4FOEjh7I=

Please note that the SHA256 signatures are base64 encoded and not
hexadecimal (which is the default for most checksum tools). The PGP
key used to sign the releases is available as RELEASE_KEY.asc from
the mirror sites.

Reporting Bugs:
===============

- Please read <https://www.openssh.com/report.html>
  Security bugs should be reported directly to openssh@...nssh.com

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


