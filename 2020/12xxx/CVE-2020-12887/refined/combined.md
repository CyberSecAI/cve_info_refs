=== Content from github.com_a20c262b_20250119_132054.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-ghhj-m687-4jqx)

**CVE-2020-12884**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-ghhj-m687-4jqx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-12884](/advisories/GHSA-ghhj-m687-4jqx)

## A buffer over-read was discovered in the CoAP library in...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-ghhj-m687-4jqx/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

A buffer over-read was discovered in the CoAP library in Arm Mbed OS 5.15.3. The CoAP parser is responsible for parsing received CoAP packets. The function sn\_coap\_parser\_options\_parse\_multiple\_options() parses CoAP options that may occur multiple consecutive times in a single packet. While processing the options, packet\_data\_pptr is accessed after being incremented by option\_len without a prior out-of-bounds memory check. The temp\_parsed\_uri\_query\_ptr is validated for a correct range, but the range valid for temp\_parsed\_uri\_query\_ptr is derived from the amount of allocated heap memory, not the actual input size. Therefore the check of temp\_parsed\_uri\_query\_ptr may be insufficient for safe access to the area pointed to by packet\_data\_pptr. As a result, access to a memory area outside of the intended boundary of the packet buffer is made.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-12884>
* [ARMmbed/mbed-os#12928](https://github.com/ARMmbed/mbed-os/issues/12928)
* [PelionIoT/mbed-coap#116](https://github.com/PelionIoT/mbed-coap/pull/116)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-12884)
Jun 18, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### [EPSS score](https://www.first.org/epss/user-guide)

0.235%
 (61st percentile)

### Weaknesses

No CWEs

### CVE ID

CVE-2020-12884

### GHSA ID

GHSA-ghhj-m687-4jqx

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-ghhj-m687-4jqx/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_425c1236_20250119_132054.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-p665-3xc8-4hrv)

**CVE-2020-12887**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-p665-3xc8-4hrv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-12887](/advisories/GHSA-p665-3xc8-4hrv)

## Memory leaks were discovered in the CoAP library in Arm...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-p665-3xc8-4hrv/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

Memory leaks were discovered in the CoAP library in Arm Mbed OS 5.15.3 when using the Arm mbed-coap library 5.1.5. The CoAP parser is responsible for parsing received CoAP packets. The function sn\_coap\_parser\_options\_parse() parses the CoAP option number field of all options present in the input packet. Each option number is calculated as a sum of the previous option number and a delta of the current option. The delta and the previous option number are expressed as unsigned 16-bit integers. Due to lack of overflow detection, it is possible to craft a packet that wraps the option number around and results in the same option number being processed again in a single packet. Certain options allocate memory by calling a memory allocation function. In the cases of COAP\_OPTION\_URI\_QUERY, COAP\_OPTION\_URI\_PATH, COAP\_OPTION\_LOCATION\_QUERY, and COAP\_OPTION\_ETAG, there is no check on whether memory has already been allocated, which in conjunction with the option number integer overflow may lead to multiple assignments of allocated memory to a single pointer. This has been demonstrated to lead to memory leak by buffer orphaning. As a result, the memory is never freed.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-12887>
* [ARMmbed/mbed-os#12930](https://github.com/ARMmbed/mbed-os/issues/12930)
* [ARMmbed/mbed-os#12957](https://github.com/ARMmbed/mbed-os/issues/12957)
* [PelionIoT/mbed-coap#116](https://github.com/PelionIoT/mbed-coap/pull/116)
* [mjurczak/mbed-coap@4647a68](https://github.com/mjurczak/mbed-coap/commit/4647a68e364401e81dbd370728127d844f221d93)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-12887)
Jun 18, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### [EPSS score](https://www.first.org/epss/user-guide)

0.399%
 (73rd percentile)

### Weaknesses

[CWE-401](/advisories?query=cwe%3A401)

### CVE ID

CVE-2020-12887

### GHSA ID

GHSA-p665-3xc8-4hrv

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-p665-3xc8-4hrv/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_46cf39bb_20250119_112933.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmjurczak%2Fmbed-coap%2Fcommit%2F4647a68e364401e81dbd370728127d844f221d93)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmjurczak%2Fmbed-coap%2Fcommit%2F4647a68e364401e81dbd370728127d844f221d93)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mjurczak%2Fmbed-coap)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mjurczak](/mjurczak)
/
**[mbed-coap](/mjurczak/mbed-coap)**
Public

forked from [PelionIoT/mbed-coap](/PelionIoT/mbed-coap)

* [Notifications](/login?return_to=%2Fmjurczak%2Fmbed-coap) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fmjurczak%2Fmbed-coap)
* [Star
   0](/login?return_to=%2Fmjurczak%2Fmbed-coap)

* [Code](/mjurczak/mbed-coap)
* [Pull requests
  0](/mjurczak/mbed-coap/pulls)
* [Actions](/mjurczak/mbed-coap/actions)
* [Projects
  0](/mjurczak/mbed-coap/projects)
* [Security](/mjurczak/mbed-coap/security)
* [Insights](/mjurczak/mbed-coap/pulse)

Additional navigation options

* [Code](/mjurczak/mbed-coap)
* [Pull requests](/mjurczak/mbed-coap/pulls)
* [Actions](/mjurczak/mbed-coap/actions)
* [Projects](/mjurczak/mbed-coap/projects)
* [Security](/mjurczak/mbed-coap/security)
* [Insights](/mjurczak/mbed-coap/pulse)

## Commit

[Permalink](/mjurczak/mbed-coap/commit/4647a68e364401e81dbd370728127d844f221d93)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Implemented measures to prevent memory leaks in sn\_coap\_parser\_option…

[Browse files](/mjurczak/mbed-coap/tree/4647a68e364401e81dbd370728127d844f221d93)
Browse the repository at this point in the history

```
…s_parse().

Added a helper uint16_t addition function with overflow detection. The function is used when calculating the extended length and option delta. The overlow detection is needed to avoid wrap-around of option number or length.
Additional checks in options using sn_coap_parser_options_parse_multiple_options() have been implemented to avoid overwriting of pointers pointing to previously allocated memory.
```

* Loading branch information

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=40&v=4)](/mjurczak)

[mjurczak](/mjurczak/mbed-coap/commits?author=mjurczak "View all commits by mjurczak")
committed
May 11, 2020

1 parent
[14aff16](/mjurczak/mbed-coap/commit/14aff16e4f2bee871caeeae5e773ef265a9afaf2)

commit 4647a68

Showing
**1 changed file**
with
**60 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

71 changes: 60 additions & 11 deletions

71
[source/sn\_coap\_parser.c](#diff-e25f6e7d860c4706a90a35e0b07afe86349122740a202deffea4e7ee55e35f80 "source/sn_coap_parser.c")

Show comments

[View file](/mjurczak/mbed-coap/blob/4647a68e364401e81dbd370728127d844f221d93/source/sn_coap_parser.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -260,6 +260,29 @@ static uint32\_t sn\_coap\_parser\_options\_parse\_uint(uint8\_t \*\*packet\_data\_pptr, ui |
|  |  | return value; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* \brief Add u16 integers with overflow detection |
|  |  | \* |
|  |  | \* \param a first term of addition |
|  |  | \* \param b second term of addion |
|  |  | \* \param result pointer to the result variable |
|  |  | \* |
|  |  | \* \return Return 0 if there was no overflow, -1 otherwise |
|  |  | \*/ |
|  |  | static int8\_t sn\_coap\_parser\_add\_u16\_limit(uint16\_t a, uint16\_t b, uint16\_t \*result) |
|  |  | { |
|  |  | uint16\_t c; |
|  |  |  |
|  |  | c = a + b; |
|  |  | if (c < a || c < b) |
|  |  | { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | \*result = c; |
|  |  |  |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* \brief Performs data packet pointer boundary check |
| Expand Down  Expand Up | | @@ -397,11 +420,15 @@ static int8\_t parse\_ext\_option(uint16\_t \*dst, uint8\_t \*\*packet\_data\_pptr, uint8\_ |
|  |  | return -1; |
|  |  | } |
|  |  | else { |
|  |  | option\_number += option\_ext; |
|  |  | \*message\_left = sn\_coap\_parser\_move\_packet\_ptr(packet\_data\_pptr, |
|  |  | packet\_data\_start\_ptr, |
|  |  | packet\_len, |
|  |  | 1); |
|  |  | if(sn\_coap\_parser\_add\_u16\_limit(option\_number, option\_ext, &option\_number) != 0) |
|  |  | { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | \*message\_left = sn\_coap\_parser\_move\_packet\_ptr(packet\_data\_pptr, |
|  |  | packet\_data\_start\_ptr, |
|  |  | packet\_len, |
|  |  | 1); |
|  |  | } |
|  |  | } else if (option\_number == 14) { |
|  |  | int8\_t read\_result = sn\_coap\_parser\_read\_packet\_u16(&option\_number, |
| Expand All | | @@ -414,11 +441,15 @@ static int8\_t parse\_ext\_option(uint16\_t \*dst, uint8\_t \*\*packet\_data\_pptr, uint8\_ |
|  |  | return -1; |
|  |  | } |
|  |  | else { |
|  |  | option\_number += 269; |
|  |  | \*message\_left = sn\_coap\_parser\_move\_packet\_ptr(packet\_data\_pptr, |
|  |  | packet\_data\_start\_ptr, |
|  |  | packet\_len, |
|  |  | 2); |
|  |  | if(sn\_coap\_parser\_add\_u16\_limit(option\_number, 269, &option\_number) != 0) |
|  |  | { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | \*message\_left = sn\_coap\_parser\_move\_packet\_ptr(packet\_data\_pptr, |
|  |  | packet\_data\_start\_ptr, |
|  |  | packet\_len, |
|  |  | 2); |
|  |  | } |
|  |  | } |
|  |  | /\* Option number 15 reserved for payload marker. This is handled as a error! \*/ |
| Expand Down  Expand Up | | @@ -499,7 +530,10 @@ static int8\_t sn\_coap\_parser\_options\_parse(struct coap\_s \*handle, uint8\_t \*\*pack |
|  |  | return -1; |
|  |  | } |
|  |  | /\* Add previous option to option delta and get option number \*/ |
|  |  | option\_number += previous\_option\_number; |
|  |  | if(sn\_coap\_parser\_add\_u16\_limit(option\_number, previous\_option\_number, &option\_number) != 0) |
|  |  | { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | /\* Add possible option length extension to resolve full length of the option \*/ |
|  |  | option\_parse\_result = parse\_ext\_option(&option\_len, |
| Expand Down  Expand Up | | @@ -577,6 +611,11 @@ static int8\_t sn\_coap\_parser\_options\_parse(struct coap\_s \*handle, uint8\_t \*\*pack |
|  |  | break; |
|  |  |  |
|  |  | case COAP\_OPTION\_ETAG: |
|  |  | if (dst\_coap\_msg\_ptr->options\_list\_ptr->etag\_ptr) |
|  |  | { |
|  |  | tr\_error("sn\_coap\_parser\_options\_parse - COAP\_OPTION\_ETAG exists!"); |
|  |  | return -1; |
|  |  | } |
|  |  | /\* This is managed independently because User gives this option in one character table \*/ |
|  |  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, |
|  |  | message\_left, |
| Expand Down  Expand Up | | @@ -628,6 +667,11 @@ static int8\_t sn\_coap\_parser\_options\_parse(struct coap\_s \*handle, uint8\_t \*\*pack |
|  |  | break; |
|  |  |  |
|  |  | case COAP\_OPTION\_LOCATION\_QUERY: |
|  |  | if (dst\_coap\_msg\_ptr->options\_list\_ptr->location\_query\_ptr) |
|  |  | { |
|  |  | tr\_error("sn\_coap\_parser\_options\_parse - COAP\_OPTION\_LOCATION\_QUERY exists!"); |
|  |  | return -1; |
|  |  | } |
|  |  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, message\_left, |
|  |  | &dst\_coap\_msg\_ptr->options\_list\_ptr->location\_query\_ptr, &dst\_coap\_msg\_ptr->options\_list\_ptr->location\_query\_len, |
|  |  | COAP\_OPTION\_LOCATION\_QUERY, option\_len); |
| Expand All | | @@ -639,6 +683,11 @@ static int8\_t sn\_coap\_parser\_options\_parse(struct coap\_s \*handle, uint8\_t \*\*pack |
|  |  | break; |
|  |  |  |
|  |  | case COAP\_OPTION\_URI\_PATH: |
|  |  | if (dst\_coap\_msg\_ptr->uri\_path\_ptr) |
|  |  | { |
|  |  | tr\_error("sn\_coap\_parser\_options\_parse - COAP\_OPTION\_URI\_PATH exists!"); |
|  |  | return -1; |
|  |  | } |
|  |  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, message\_left, |
|  |  | &dst\_coap\_msg\_ptr->uri\_path\_ptr, &dst\_coap\_msg\_ptr->uri\_path\_len, |
|  |  | COAP\_OPTION\_URI\_PATH, option\_len); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4647a68`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmjurczak%2Fmbed-coap%2Fcommit%2F4647a68e364401e81dbd370728127d844f221d93) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ac25a848_20250119_132053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-jhjh-34gq-3m8c)

**CVE-2020-12885**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-jhjh-34gq-3m8c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-12885](/advisories/GHSA-jhjh-34gq-3m8c)

## An infinite loop was discovered in the CoAP library in...

High severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-jhjh-34gq-3m8c/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

An infinite loop was discovered in the CoAP library in Arm Mbed OS 5.15.3. The CoAP parser is responsible for parsing received CoAP packets. The function sn\_coap\_parser\_options\_parse\_multiple\_options() parses CoAP options in a while loop. This loop's exit condition is computed using the previously allocated heap memory required for storing the result of parsing multiple options. If the input heap memory calculation results in zero bytes, the loop exit condition is never met and the loop is not terminated. As a result, the packet parsing function never exits, leading to resource consumption.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-12885>
* [ARMmbed/mbed-os#12929](https://github.com/ARMmbed/mbed-os/issues/12929)
* [PelionIoT/mbed-coap#116](https://github.com/PelionIoT/mbed-coap/pull/116)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-12885)
Jun 18, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

High

### [EPSS score](https://www.first.org/epss/user-guide)

0.145%
 (51st percentile)

### Weaknesses

No CWEs

### CVE ID

CVE-2020-12885

### GHSA ID

GHSA-jhjh-34gq-3m8c

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-jhjh-34gq-3m8c/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6611b78d_20250119_112929.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPelionIoT%2Fmbed-coap%2Fpull%2F116)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPelionIoT%2Fmbed-coap%2Fpull%2F116)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=PelionIoT%2Fmbed-coap)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[PelionIoT](/PelionIoT)
/
**[mbed-coap](/PelionIoT/mbed-coap)**
Public

* [Notifications](/login?return_to=%2FPelionIoT%2Fmbed-coap) You must be signed in to change notification settings
* [Fork
  16](/login?return_to=%2FPelionIoT%2Fmbed-coap)
* [Star
   29](/login?return_to=%2FPelionIoT%2Fmbed-coap)

* [Code](/PelionIoT/mbed-coap)
* [Issues
  6](/PelionIoT/mbed-coap/issues)
* [Pull requests
  2](/PelionIoT/mbed-coap/pulls)
* [Actions](/PelionIoT/mbed-coap/actions)
* [Projects
  0](/PelionIoT/mbed-coap/projects)
* [Security](/PelionIoT/mbed-coap/security)
* [Insights](/PelionIoT/mbed-coap/pulse)

Additional navigation options

* [Code](/PelionIoT/mbed-coap)
* [Issues](/PelionIoT/mbed-coap/issues)
* [Pull requests](/PelionIoT/mbed-coap/pulls)
* [Actions](/PelionIoT/mbed-coap/actions)
* [Projects](/PelionIoT/mbed-coap/projects)
* [Security](/PelionIoT/mbed-coap/security)
* [Insights](/PelionIoT/mbed-coap/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FPelionIoT%2Fmbed-coap%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FPelionIoT%2Fmbed-coap%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Bugfix/coap parser mem access bugs #116

 Merged

[esajaa](/esajaa)
merged 6 commits into
[PelionIoT:master](/PelionIoT/mbed-coap/tree/master "PelionIoT/mbed-coap:master")
from
[mjurczak:bugfix/coap\_parser\_mem\_access\_bugs](/mjurczak/mbed-coap/tree/bugfix/coap_parser_mem_access_bugs "mjurczak/mbed-coap:bugfix/coap_parser_mem_access_bugs")

Jun 22, 2020

 Merged

# [Bugfix/coap parser mem access bugs](#top) #116

[esajaa](/esajaa)
merged 6 commits into
[PelionIoT:master](/PelionIoT/mbed-coap/tree/master "PelionIoT/mbed-coap:master")
from
[mjurczak:bugfix/coap\_parser\_mem\_access\_bugs](/mjurczak/mbed-coap/tree/bugfix/coap_parser_mem_access_bugs "mjurczak/mbed-coap:bugfix/coap_parser_mem_access_bugs")

Jun 22, 2020

[Conversation
2](/PelionIoT/mbed-coap/pull/116)
[Commits
6](/PelionIoT/mbed-coap/pull/116/commits)
[Checks
0](/PelionIoT/mbed-coap/pull/116/checks)
[Files changed](/PelionIoT/mbed-coap/pull/116/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mjurczak](https://avatars.githubusercontent.com/u/9540275?s=60&v=4)](/mjurczak)

Copy link

Contributor

### @mjurczak **[mjurczak](/mjurczak)** commented [Jun 10, 2020](#issue-636576282)

[x] I confirm this contribution is my own and I agree to license it with Apache 2.0.

[x] I confirm the moderators may change the PR before merging it in.

### Summary of changes

Fixes for out-ouf-bounds memory access, memory leak and infinite loop condition in coap packets parser.

The fixed issues described in detail in the following threads:

[ARMmbed/mbed-os#12957](https://github.com/ARMmbed/mbed-os/issues/12957)

[ARMmbed/mbed-os#12948](https://github.com/ARMmbed/mbed-os/issues/12948)

[ARMmbed/mbed-os#12930](https://github.com/ARMmbed/mbed-os/issues/12930)

[ARMmbed/mbed-os#12928](https://github.com/ARMmbed/mbed-os/issues/12928)

[ARMmbed/mbed-os#12927](https://github.com/ARMmbed/mbed-os/issues/12927)

[ARMmbed/mbed-os#12926](https://github.com/ARMmbed/mbed-os/issues/12926)

[ARMmbed/mbed-os#12925](https://github.com/ARMmbed/mbed-os/issues/12925)

Reserved CVE identifiers related to the resolved issues:

[CVE-2020-12886](https://github.com/advisories/GHSA-8v45-9mw2-ffmm "CVE-2020-12886")

[CVE-2020-12883](https://github.com/advisories/GHSA-x723-g4p2-w8m5 "CVE-2020-12883")

[CVE-2020-12884](https://github.com/advisories/GHSA-ghhj-m687-4jqx "CVE-2020-12884")

[CVE-2020-12885](https://github.com/advisories/GHSA-jhjh-34gq-3m8c "CVE-2020-12885")

[CVE-2020-12887](https://github.com/advisories/GHSA-p665-3xc8-4hrv "CVE-2020-12887")

Sorry, something went wrong.

All reactions

 [mjurczak](/mjurczak)
added 4 commits
[May 7, 2020 12:23](#commits-pushed-152cde0)

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=40&v=4)](/mjurczak)

`[Merge pull request](/PelionIoT/mbed-coap/pull/116/commits/152cde0a79afc1e66ef36484172ee2f433777d0b "Merge pull request #1 from ARMmbed/master

Update to latest mastser") [#1](https://github.com/mjurczak/mbed-coap/pull/1) [from ARMmbed/master](/PelionIoT/mbed-coap/pull/116/commits/152cde0a79afc1e66ef36484172ee2f433777d0b "Merge pull request #1 from ARMmbed/master

Update to latest mastser")`
 …

`[152cde0](/PelionIoT/mbed-coap/pull/116/commits/152cde0a79afc1e66ef36484172ee2f433777d0b)`

```
Update to latest mastser
```

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=40&v=4)](/mjurczak)

`[Implemented measures to protect against out-of-bounds memory access i…](/PelionIoT/mbed-coap/pull/116/commits/cbcb40b466d05905d354437849f3e806beee3202 "Implemented measures to protect against out-of-bounds memory access in coap parser.

Fixed insufficient memory range validation prior to memory access in options parsing and token parsing.

CVE-2020-12886
CVE-2020-12883
CVE-2020-12884")`
 …

`[cbcb40b](/PelionIoT/mbed-coap/pull/116/commits/cbcb40b466d05905d354437849f3e806beee3202)`

```
…n coap parser.

Fixed insufficient memory range validation prior to memory access in options parsing and token parsing.

[CVE-2020-12886](https://github.com/advisories/GHSA-8v45-9mw2-ffmm "CVE-2020-12886")
[CVE-2020-12883](https://github.com/advisories/GHSA-x723-g4p2-w8m5 "CVE-2020-12883")
[CVE-2020-12884](https://github.com/advisories/GHSA-ghhj-m687-4jqx "CVE-2020-12884")
```

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=40&v=4)](/mjurczak)

`[Fixed possible infinite loop in sn_coap_parser_options_parse_multiple…](/PelionIoT/mbed-coap/pull/116/commits/f50e3311337d68092e1fe21f1c195f16a1d0cb43 "Fixed possible infinite loop in sn_coap_parser_options_parse_multiple_options()

Fixed an issue with improved boundary checks and inproved end-of multiple options processing loop break conditions.
Simplified the sn_coap_parser_options_count_needed_memory_multiple_option() function by reusing extended options number/length parsing functions.

CVE-2020-12885")`
 …

`[f50e331](/PelionIoT/mbed-coap/pull/116/commits/f50e3311337d68092e1fe21f1c195f16a1d0cb43)`

```
…_options()

Fixed an issue with improved boundary checks and inproved end-of multiple options processing loop break conditions.
Simplified the sn_coap_parser_options_count_needed_memory_multiple_option() function by reusing extended options number/length parsing functions.

[CVE-2020-12885](https://github.com/advisories/GHSA-jhjh-34gq-3m8c "CVE-2020-12885")
```

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=40&v=4)](/mjurczak)

`[Implemented measures to prevent memory leaks in sn_coap_parser_option…](/PelionIoT/mbed-coap/pull/116/commits/e65e5eb79a66e004e9fdb30f224447ab6179059a "Implemented measures to prevent memory leaks in sn_coap_parser_options_parse().

Added a helper uint16_t addition function with overflow detection. The function is used when calculating the extended length and option delta. The overlow detection is needed to avoid wrap-around of option number or length.
Additional checks in options using sn_coap_parser_options_parse_multiple_options() have been implemented to avoid overwriting of pointers pointing to previously allocated memory.

CVE-2020-12887")`
 …

`[e65e5eb](/PelionIoT/mbed-coap/pull/116/commits/e65e5eb79a66e004e9fdb30f224447ab6179059a)`

```
…s_parse().

Added a helper uint16_t addition function with overflow detection. The function is used when calculating the extended length and option delta. The overlow detection is needed to avoid wrap-around of option number or length.
Additional checks in options using sn_coap_parser_options_parse_multiple_options() have been implemented to avoid overwriting of pointers pointing to previously allocated memory.

[CVE-2020-12887](https://github.com/advisories/GHSA-p665-3xc8-4hrv "CVE-2020-12887")
```

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=40&u=c8ed5071ca8020098fdd9c01e58b807398a7bbe2&v=4)](/mjurczak)
[mjurczak](/mjurczak)
mentioned this pull request
[Jun 10, 2020](#ref-issue-616186629)

[Memory leak in MbedOS CoAP library parser - sn\_coap\_parser\_options\_parse()
ARMmbed/mbed-os#12957](/ARMmbed/mbed-os/issues/12957)

Closed

 [![@esajaa](https://avatars.githubusercontent.com/u/26139870?s=40&v=4)](/esajaa)
[esajaa](/esajaa)
requested a review
from [anttiylitokola](/anttiylitokola)
[June 15, 2020 11:53](#event-3444025197)

[![@esajaa](https://avatars.githubusercontent.com/u/26139870?s=40&v=4)](/esajaa)

`[Formatting fixes](/PelionIoT/mbed-coap/pull/116/commits/91253bf3be7d928243ac8e804002153df035137c "Formatting fixes")`

`[91253bf](/PelionIoT/mbed-coap/pull/116/commits/91253bf3be7d928243ac8e804002153df035137c)`

[![@esajaa](https://avatars.githubusercontent.com/u/26139870?s=80&v=4)](/esajaa)

Copy link

Contributor

### **[esajaa](/esajaa)** commented [Jun 16, 2020](#issuecomment-644742448)

| Hi [@mjurczak](https://github.com/mjurczak),  I've been going through your pull request, and to me it seems like a good addition. I asked for a second opinion, but so far it's passing all the tests and nothing really seems out of place. I pushed some formatting fixes to the branch, hopefully that's okay to you.  I also noticed that you had few other branches in your fork. Is all the content here in this PR, or are there more pull requests incoming?  Best Regards, Esa |
| --- |

All reactions

Sorry, something went wrong.

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=80&u=c8ed5071ca8020098fdd9c01e58b807398a7bbe2&v=4)](/mjurczak)

Copy link

Contributor

Author

### **[mjurczak](/mjurczak)** commented [Jun 16, 2020](#issuecomment-644983503)

| Hi [@esajaa](https://github.com/esajaa) , Thanks for the formatting fixes. The content of the remaining branches in my fork is included in this single PR. I hope this is okay.  Kind regards, Maciej |
| --- |

All reactions

Sorry, something went wrong.

[![anttiylitokola](https://avatars.githubusercontent.com/u/13655184?s=60&v=4)](/anttiylitokola)

**[anttiylitokola](/anttiylitokola)**
approved these changes
[Jun 18, 2020](#pullrequestreview-432933217)

 [View reviewed changes](/PelionIoT/mbed-coap/pull/116/files/91253bf3be7d928243ac8e804002153df035137c)

`[Merge branch 'master' into bugfix/coap_parser_mem_access_bugs](/PelionIoT/mbed-coap/pull/116/commits/efbec0df4db5f5eafacd439c6af42ce11d286e21 "Merge branch 'master' into bugfix/coap_parser_mem_access_bugs")`

`[efbec0d](/PelionIoT/mbed-coap/pull/116/commits/efbec0df4db5f5eafacd439c6af42ce11d286e21)`

[![@esajaa](https://avatars.githubusercontent.com/u/26139870?s=40&v=4)](/esajaa)
[esajaa](/esajaa)
merged commit [`fd2a3ef`](/PelionIoT/mbed-coap/commit/fd2a3effd3dbd932ebfc390a501d65a7bd52d7cf)
into
PelionIoT:master

[Jun 22, 2020](https://github.com/PelionIoT/mbed-coap/pull/116#event-3466867759)

[![@kjbracey](https://avatars.githubusercontent.com/u/11025917?s=40&v=4)](/kjbracey)
[kjbracey](/kjbracey)
mentioned this pull request
[Jun 24, 2020](#ref-pullrequest-638824292)

[Optimise packet parser and builder core
#117](/PelionIoT/mbed-coap/pull/117)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FPelionIoT%2Fmbed-coap%2Fpull%2F116)

Reviewers

[![@anttiylitokola](https://avatars.githubusercontent.com/u/13655184?s=40&v=4)](/anttiylitokola) [anttiylitokola](/anttiylitokola)

anttiylitokola approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@mjurczak](https://avatars.githubusercontent.com/u/9540275?s=52&v=4)](/mjurczak) [![@esajaa](https://avatars.githubusercontent.com/u/26139870?s=52&v=4)](/esajaa) [![@anttiylitokola](https://avatars.githubusercontent.com/u/13655184?s=52&v=4)](/anttiylitokola)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_121afe15_20250119_112932.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FARMmbed%2Fmbed-os%2Fissues%2F12957)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FARMmbed%2Fmbed-os%2Fissues%2F12957)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=ARMmbed%2Fmbed-os)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ARMmbed](/ARMmbed)
/
**[mbed-os](/ARMmbed/mbed-os)**
Public

* [Notifications](/login?return_to=%2FARMmbed%2Fmbed-os) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2FARMmbed%2Fmbed-os)
* [Star
   4.7k](/login?return_to=%2FARMmbed%2Fmbed-os)

* [Code](/ARMmbed/mbed-os)
* [Issues
  195](/ARMmbed/mbed-os/issues)
* [Pull requests
  11](/ARMmbed/mbed-os/pulls)
* [Actions](/ARMmbed/mbed-os/actions)
* [Projects
  0](/ARMmbed/mbed-os/projects)
* [Security](/ARMmbed/mbed-os/security)
* [Insights](/ARMmbed/mbed-os/pulse)

Additional navigation options

* [Code](/ARMmbed/mbed-os)
* [Issues](/ARMmbed/mbed-os/issues)
* [Pull requests](/ARMmbed/mbed-os/pulls)
* [Actions](/ARMmbed/mbed-os/actions)
* [Projects](/ARMmbed/mbed-os/projects)
* [Security](/ARMmbed/mbed-os/security)
* [Insights](/ARMmbed/mbed-os/pulse)

# Memory leak in MbedOS CoAP library parser - sn\_coap\_parser\_options\_parse() #12957

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Memory leak in MbedOS CoAP library parser - sn\_coap\_parser\_options\_parse()](#top)#12957Copy linkLabels[type: bug](https://github.com/ARMmbed/mbed-os/issues?q=state%3Aopen%20label%3A%22type%3A%20bug%22)![@mjurczak](https://avatars.githubusercontent.com/u/9540275?u=c8ed5071ca8020098fdd9c01e58b807398a7bbe2&v=4&size=80)
## Description

![@mjurczak](https://avatars.githubusercontent.com/u/9540275?u=c8ed5071ca8020098fdd9c01e58b807398a7bbe2&v=4&size=48)[mjurczak](https://github.com/mjurczak)opened [on May 11, 2020](https://github.com/ARMmbed/mbed-os/issues/12957#issue-616186629)
### Description of defect

**References:**

<https://github.com/ARMmbed/mbed-os/tree/mbed-os-5.15.3/features/frameworks/mbed-coap>

<https://github.com/ARMmbed/mbed-coap/tree/v5.1.5>

**File:**

[sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c)

Example Trace (64 Byte leak):

```
MALLOC: allocated 44 bytes @ 0xf4c00f50, current depth: 1.
Allocation depth before parsing: 1
MALLOC: allocated 44 bytes @ 0xf4c00f10, current depth: 2.
MALLOC: allocated 64 bytes @ 0xf5a01640, current depth: 3.
MALLOC: allocated 1 bytes @ 0xf48007b0, current depth: 4.
FREE: freed buffer @ 0xf48007b0, current depth: 3.
FREE: freed buffer @ 0xf4c00f10, current depth: 2.
Allocation depth after parsing and releasing: 2

=================================================================
ERROR: detected memory leaks

Direct leak of 64 byte(s) in 1 object(s) allocated from:
    #0 0xf7a06c17 in malloc
    #1 0x5659c669 in coap_malloc main.c
    #2 0x565a9945 in sn_coap_parser_options_parse_multiple_options sn_coap_parser.c
    #3 0x565a7d41 in sn_coap_parser_options_parse sn_coap_parser.c
    #4 0x565a3ec4 in sn_coap_parser sn_coap_parser.c
    #5 0x5659ca9a in main main.c
    #6 0xf7726ee4 in __libc_start_main

SUMMARY: 64 byte(s) leaked in 1 allocation(s).

```

Example Trace (double 8 Byte leak):

```
MALLOC: allocated 44 bytes @ 0xf4d00f50, current depth: 1.
Allocation depth before parsing: 1
MALLOC: allocated 44 bytes @ 0xf4d00f10, current depth: 2.
MALLOC: allocated 68 bytes @ 0xf4901ad0, current depth: 3.
MALLOC: allocated 8 bytes @ 0xf47007b0, current depth: 4.
MALLOC: allocated 8 bytes @ 0xf4700790, current depth: 5.
MALLOC: allocated 1 bytes @ 0xf4700770, current depth: 6.
FREE: freed buffer @ 0xf4700770, current depth: 5.
FREE: freed buffer @ 0xf4901ad0, current depth: 4.
FREE: freed buffer @ 0xf4d00f10, current depth: 3.
Allocation depth after parsing and releasing: 3

=================================================================
ERROR: detected memory leaks

Direct leak of 16 byte(s) in 2 object(s) allocated from:
    #0 0xf7a42c17 in malloc
    #1 0x56639669 in coap_malloc main.c
    #2 0x56646945 in sn_coap_parser_options_parse_multiple_options sn_coap_parser.c
    #3 0x56643eb8 in sn_coap_parser_options_parse sn_coap_parser.c
    #4 0x56640ec4 in sn_coap_parser sn_coap_parser.c
    #5 0x56639a9a in main main.c
    #6 0xf7762ee4 in __libc_start_main

SUMMARY: 16 byte(s) leaked in 2 allocation(s).

```

**Analysis:**

If a packet with multiple options with the same effective option number, but with non-zero delta is processed it may lead to memory leak.

This issue is related to:

[#12930](https://github.com/ARMmbed/mbed-os/issues/12930)

The parser assumes in sn\_coap\_parser\_options\_parse\_multiple\_options() that options with the same number can occur only adjacent to each other using zero delta after the first option with a given number.

This is not true due to integer overflow in option number addition which makes it possible to craft a packet with multiple options resulting in the same option number in arbitrary order.

In conjunction with lack of verification of pointers to allocated memory before rewriting the pointer with newly allocated space it may lead to memory leak due to memory buffer orphaning.

Integer overflow is described in detail in:

[#12930](https://github.com/ARMmbed/mbed-os/issues/12930)

uint16 variable overflow can happen at:

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L309-L322)

Lines 309 to 322
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | if (option\_number == 13) { |
| --- | --- |
|  | option\_number = \*(\*packet\_data\_pptr + 1) + 13; |
|  | (\*packet\_data\_pptr)++; |
|  | } else if (option\_number == 14) { |
|  | if (message\_left >= 2){ |
|  | option\_number = \*(\*packet\_data\_pptr + 2); |
|  | option\_number += (\*(\*packet\_data\_pptr + 1) << 8) + 269; |
|  | (\*packet\_data\_pptr) += 2; |
|  | } else { |
|  | /\* packet\_data\_pptr would overflow! \*/ |
|  | tr\_error("sn\_coap\_parser\_options\_parse - \*\*packet\_data\_pptr overflow !"); |
|  | return -1; |
|  | } |
|  | } |

and

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L338)

Line 338
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | option\_number += previous\_option\_number; |
| --- | --- |

If more than one occurence of option with the same number is encountered by sn\_coap\_parser\_options\_parse(), the sn\_coap\_parser\_options\_parse\_multiple\_options() may allocate new memory buffer and overwrite pointer pointing to previously allocated memory space in:

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L434-L441)

Lines 434 to 441
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | case COAP\_OPTION\_ETAG: |
| --- | --- |
|  | /\* This is managed independently because User gives this option in one character table \*/ |
|  |  |
|  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, |
|  | message\_left, |
|  | &dst\_coap\_msg\_ptr->options\_list\_ptr->etag\_ptr, |
|  | (uint16\_t \*)&dst\_coap\_msg\_ptr->options\_list\_ptr->etag\_len, |
|  | COAP\_OPTION\_ETAG, option\_len); |

or

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L497-L500)

Lines 497 to 500
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | case COAP\_OPTION\_LOCATION\_QUERY: |
| --- | --- |
|  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, message\_left, |
|  | &dst\_coap\_msg\_ptr->options\_list\_ptr->location\_query\_ptr, &dst\_coap\_msg\_ptr->options\_list\_ptr->location\_query\_len, |
|  | COAP\_OPTION\_LOCATION\_QUERY, option\_len); |

or

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L510-L513)

Lines 510 to 513
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | case COAP\_OPTION\_URI\_PATH: |
| --- | --- |
|  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, message\_left, |
|  | &dst\_coap\_msg\_ptr->uri\_path\_ptr, &dst\_coap\_msg\_ptr->uri\_path\_len, |
|  | COAP\_OPTION\_URI\_PATH, option\_len); |

or

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L535-L538)

Lines 535 to 538
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | case COAP\_OPTION\_URI\_QUERY: |
| --- | --- |
|  | ret\_status = sn\_coap\_parser\_options\_parse\_multiple\_options(handle, packet\_data\_pptr, message\_left, |
|  | &dst\_coap\_msg\_ptr->options\_list\_ptr->uri\_query\_ptr, &dst\_coap\_msg\_ptr->options\_list\_ptr->uri\_query\_len, |
|  | COAP\_OPTION\_URI\_QUERY, option\_len); |

As a result the previously allocated buffer is orphaned and never freed.

**Patch proposal:**

[mjurczak/mbed-coap@4647a68](https://github.com/mjurczak/mbed-coap/commit/4647a68e364401e81dbd370728127d844f221d93)

**Type:**

* Integer Overflow or Wraparound
* Memory leak / heap exhaustion

**Result:**

* Excessive memory usage
* Possible crash due to lack of resources
* Denial of Service

#### Target(s) affected by this defect ?

* MbedOS mbed-coap library 5.1.5
* MbedOS 5.15.3

#### Toolchain(s) (name and version) displaying this defect ?

N/A

#### What version of Mbed-os are you using (tag or sha) ?

MbedOS 5.15.3

#### What version(s) of tools are you using. List all that apply (E.g. mbed-cli)

N/A

#### How is this defect reproduced ?

Parsing the provided input example input with sn\_coap\_parser() function.

```
#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include "sn_coap_protocol.h"
#include "sn_coap_header.h"

struct coap_s* coapHandle;
coap_version_e coapVersion = COAP_VERSION_1;

static int32_t allocation_counter = 0;

void* coap_malloc(uint16_t size){
    void *ptr;
    ptr = malloc(size);
    allocation_counter++;
    printf("MALLOC: allocated %d bytes @ %p, current depth: %d.\r\n", size, ptr, allocation_counter);
    return ptr;
}

void coap_free(void* addr){
    free(addr);
    if (addr != NULL)
    {
        allocation_counter--;
        printf("FREE: freed buffer @ %p, current depth: %d.\r\n", addr, allocation_counter);
    }
}

uint8_t coap_tx_cb(uint8_t *arg_a, uint16_t arg_b, sn_nsdl_addr_s *arg_c, void *arg_d){
    return 0;
}

int8_t coap_rx_cb(sn_coap_hdr_s *arg_a, sn_nsdl_addr_s *arg_b, void *arg_c){
    return 0;
}

int main(int argc, const char* argv[])
{
    FILE *fp;
    size_t read_bytes;
    size_t input_size;
    uint8_t *message_buffer;
    if (argc != 2)
    {
       return 1;
    }

    fp = fopen(argv[1], "r");
    if (fp == NULL)
    {
      return 2;
    }

    fseek (fp , 0 , SEEK_END);
    input_size = ftell(fp);
    rewind (fp);

    if (input_size > 65527)
    {
      return 3;
    }

    message_buffer = malloc(input_size);
    read_bytes = fread(message_buffer, 1, input_size, fp);
    fclose(fp);
    coapHandle = sn_coap_protocol_init(&coap_malloc, &coap_free, &coap_tx_cb, &coap_rx_cb);
    printf("Allocation depth before parsing: %d\r\n", allocation_counter);
    sn_coap_hdr_s* parsed = sn_coap_parser(coapHandle, read_bytes, message_buffer, &coapVersion);
    sn_coap_parser_release_allocated_coap_msg_mem(coapHandle, parsed);
    printf("Allocation depth after parsing and releasing: %d\r\n", allocation_counter);
    free(message_buffer);

    return 0;
}
```

[mem\_leak\_8B\_double\_option.log](https://github.com/ARMmbed/mbed-os/files/4612075/mem_leak_8B_double_option.log)

[mem\_leak\_16B\_triple\_option.log](https://github.com/ARMmbed/mbed-os/files/4612076/mem_leak_16B_triple_option.log)

[mem\_leak\_64B\_double\_option.log](https://github.com/ARMmbed/mbed-os/files/4612077/mem_leak_64B_double_option.log)

## Metadata

### Assignees

No one assigned

### Labels

[type: bug](https://github.com/ARMmbed/mbed-os/issues?q=state%3Aopen%20label%3A%22type%3A%20bug%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_7beeb947_20250119_132054.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  ( (" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? �&ԭ�-�i�]��e�� w5jsI��N�FG!�P��2?Z�5}Hiڥ��i ��e�?�'G��t��:��;\�x��Y`3ӑ��:����R���v��C4{Ն�F:{�zU� ș?�r��柭]K-��`#
!�W��q�?�L\_tE�$\*���>�ҭU��1�)'dtj�y��Gۡ� �����s��Y���lc��n���� ��� =�:��U��iJʁՇ�s�G�l~�sdm#X.d]��t����h1��b�b�(���0�籬M�Q�]��n'd27!�U�����9GCҧR<�o���ʋ���3��G��\*�+1��l���V��k5�bI6�c���}8�Y�#\���5��.�3|��Yⷞ�Y������.�7������^�L���N�ڱ����Ċ�� �������� �j$�zgb��ᐆF���[ė�p�1a\*� g������ ��?δ?��� �Wf�W+\_0��u��+���aӴא��냚��� S/Ҹ� �.\_���VU]�Qٲk}~M/I[��2���d��������G� @v� ���+7\� �6���� �Ee�m1����

=== Content from avatars.githubusercontent.com_17f0b3a9_20250119_132053.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  ( (" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? �&ԭ�-�i�]��e�� w5jsI��N�FG!�P��2?Z�5}Hiڥ��i ��e�?�'G��t��:��;\�x��Y`3ӑ��:����R���v��C4{Ն�F:{�zU� ș?�r��柭]K-��`#
!�W��q�?�L\_tE�$\*���>�ҭU��1�)'dtj�y��Gۡ� �����s��Y���lc��n���� ��� =�:��U��iJʁՇ�s�G�l~�sdm#X.d]��t����h1��b�b�(���0�籬M�Q�]��n'd27!�U�����9GCҧR<�o���ʋ���3��G��\*�+1��l���V��k5�bI6�c���}8�Y�#\���5��.�3|��Yⷞ�Y������.�7������^�L���N�ڱ����Ċ�� �������� �j$�zgb��ᐆF���[ė�p�1a\*� g������ ��?δ?��� �Wf�W+\_0��u��+���aӴא��냚��� S/Ҹ� �.\_���VU]�Qٲk}~M/I[��2���d��������G� @v� ���+7\� �6���� �Ee�m1����

=== Content from github.com_d1052da0_20250119_112931.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FARMmbed%2Fmbed-os%2Fissues%2F12930)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FARMmbed%2Fmbed-os%2Fissues%2F12930)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=ARMmbed%2Fmbed-os)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ARMmbed](/ARMmbed)
/
**[mbed-os](/ARMmbed/mbed-os)**
Public

* [Notifications](/login?return_to=%2FARMmbed%2Fmbed-os) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2FARMmbed%2Fmbed-os)
* [Star
   4.7k](/login?return_to=%2FARMmbed%2Fmbed-os)

* [Code](/ARMmbed/mbed-os)
* [Issues
  195](/ARMmbed/mbed-os/issues)
* [Pull requests
  11](/ARMmbed/mbed-os/pulls)
* [Actions](/ARMmbed/mbed-os/actions)
* [Projects
  0](/ARMmbed/mbed-os/projects)
* [Security](/ARMmbed/mbed-os/security)
* [Insights](/ARMmbed/mbed-os/pulse)

Additional navigation options

* [Code](/ARMmbed/mbed-os)
* [Issues](/ARMmbed/mbed-os/issues)
* [Pull requests](/ARMmbed/mbed-os/pulls)
* [Actions](/ARMmbed/mbed-os/actions)
* [Projects](/ARMmbed/mbed-os/projects)
* [Security](/ARMmbed/mbed-os/security)
* [Insights](/ARMmbed/mbed-os/pulse)

# Integer overflow in MbedOS CoAP library parser #12930

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Integer overflow in MbedOS CoAP library parser](#top)#12930Copy linkLabels[type: bug](https://github.com/ARMmbed/mbed-os/issues?q=state%3Aopen%20label%3A%22type%3A%20bug%22)![@mjurczak](https://avatars.githubusercontent.com/u/9540275?u=c8ed5071ca8020098fdd9c01e58b807398a7bbe2&v=4&size=80)
## Description

![@mjurczak](https://avatars.githubusercontent.com/u/9540275?u=c8ed5071ca8020098fdd9c01e58b807398a7bbe2&v=4&size=48)[mjurczak](https://github.com/mjurczak)opened [on May 5, 2020](https://github.com/ARMmbed/mbed-os/issues/12930#issue-612897471)
### Description of defect

**References:**

<https://github.com/ARMmbed/mbed-os/tree/mbed-os-5.15.3/features/frameworks/mbed-coap>

<https://github.com/ARMmbed/mbed-coap/tree/v5.1.5>

**File:**

[sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c)

**Analysis:**

Unhandled option length variable roll-over occurs if extended option length encoding is used with >65535 length encoded. The frame is further processed with the result of integer roll-over.

[mbed-os/features/frameworks/mbed-coap/source/sn\_coap\_parser.c](https://github.com/ARMmbed/mbed-os/blob/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3/features/frameworks/mbed-coap/source/sn_coap_parser.c#L341-L354)

Lines 341 to 354
in
[b6370b4](/ARMmbed/mbed-os/commit/b6370b4c37f3d4665ed1cdcb1afea85396bba1b3)

|  | if (option\_len == 13) { |
| --- | --- |
|  | option\_len = \*(\*packet\_data\_pptr + 1) + 13; |
|  | (\*packet\_data\_pptr)++; |
|  | } else if (option\_len == 14) { |
|  | if (message\_left >= 2){ |
|  | option\_len = \*(\*packet\_data\_pptr + 2); |
|  | option\_len += (\*(\*packet\_data\_pptr + 1) << 8) + 269; |
|  | (\*packet\_data\_pptr) += 2; |
|  | } else { |
|  | /\* packet\_data\_pptr would overflow! \*/ |
|  | tr\_error("sn\_coap\_parser\_options\_parse - \*\*packet\_data\_pptr overflow while resolving option length!"); |
|  | return -1; |
|  | } |
|  | } |

**Type:**

* Integer Overflow or Wraparound

**Result:**

* Undetected malformed frame
* Incorrect packet parsing

#### Target(s) affected by this defect ?

* MbedOS mbed-coap library 5.1.5
* MbedOS 5.15.3

#### Toolchain(s) (name and version) displaying this defect ?

N/A

#### What version of Mbed-os are you using (tag or sha) ?

MbedOS 5.15.3

#### What version(s) of tools are you using. List all that apply (E.g. mbed-cli)

N/A

#### How is this defect reproduced ?

N/A

## Metadata

### Assignees

No one assigned

### Labels

[type: bug](https://github.com/ARMmbed/mbed-os/issues?q=state%3Aopen%20label%3A%22type%3A%20bug%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


