=== Content from trac.ffmpeg.org_3321993d_20250119_115039.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8093 "Ticket #8093")
* [Next Ticket](/ticket/8095 "Ticket #8095") →

---

Opened [5 years ago](/timeline?from=2019-08-26T06%3A33%3A23Z&precision=second "See timeline at Aug 26, 2019, 6:33:23 AM")

Closed [5 years ago](/timeline?from=2020-03-01T00%3A16%3A43Z&precision=second "See timeline at Mar 1, 2020, 12:16:43 AM")

## [#8094](/ticket/8094) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# Memory leaks from realloc

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [minor](/query?priority=minor&status=!closed) | Component: | [ffmpeg](/query?component=ffmpeg&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [leak](/query?keywords=~leak&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [yes](/query?reproduced=1&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

There is a memory leak from realloc

How to reproduce:

```
% ./ffmpeg_g  -i audio-gaps.ogg -loglevel 99 -c copy -map 0 -y  -disposition:v:174 a64multi  -c:a:171 a64multi -disposition:s:9 a64multi -stream_loop 24 -t 3 -target vcd -r 82 -ab 907 -ar 22050 -ac 4 -b:v 866k -level 12 -strict 3 tmp.mp4
ffmpeg version git-master
built on ... clang-6.0

```

ASAN report:

```
==48423==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 96 byte(s) in 3 object(s) allocated from:
    #0 0x4de8d0 in realloc (ffmpeg_g+0x4de8d0)
    #1 0x5ce398 in grow_array ffmpeg/fftools/cmdutils.c:2163:24

Indirect leak of 34 byte(s) in 6 object(s) allocated from:
    #0 0x4de8d0 in realloc (ffmpeg_g+0x4de8d0)
    #1 0x8500297 in av_realloc ffmpeg/libavutil/mem.c:144:12
    #2 0x8500297 in av_strdup ffmpeg/libavutil/mem.c:256
    #3 0x5b5001 in parse_optgroup ffmpeg/fftools/cmdutils.c:437:15

Indirect leak of 15 byte(s) in 2 object(s) allocated from:
    #0 0x4de8d0 in realloc (ffmpeg_g+0x4de8d0)
    #1 0x8500297 in av_realloc ffmpeg/libavutil/mem.c:144:12
    #2 0x8500297 in av_strdup ffmpeg/libavutil/mem.c:256
    #3 0x5b5001 in parse_optgroup ffmpeg/fftools/cmdutils.c:437:15
    #4 0x69746c756d343660  (<unknown module>)

SUMMARY: AddressSanitizer: 145 byte(s) leaked in 11 allocation(s).

```

### Attachments (2)

[debug\_report](/attachment/ticket/8094/debug_report "View attachment")[​](/raw-attachment/ticket/8094/debug_report "Download")
(7.7 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-08-26T06%3A34%3A00Z&precision=second "See timeline at Aug 26, 2019, 6:34:00 AM").
[audio-gaps.ogg](/attachment/ticket/8094/audio-gaps.ogg "View attachment")[​](/raw-attachment/ticket/8094/audio-gaps.ogg "Download")
(12.0 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-09-15T11%3A10%3A39Z&precision=second "See timeline at Sep 15, 2019, 11:10:39 AM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8094/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (5)

### by Suhwan, [5 years ago](/timeline?from=2019-08-26T06%3A34%3A00Z&precision=second "See timeline at Aug 26, 2019, 6:34:00 AM")

| Attachment: | [*debug\_report*](/attachment/ticket/8094/debug_report)[​](/raw-attachment/ticket/8094/debug_report "Download") added |
| --- | --- |

### [comment:1](#comment:1) by Suhwan, [5 years ago](/timeline?from=2019-09-15T11%3A09%3A47Z&precision=second "See timeline at Sep 15, 2019, 11:09:47 AM")

| Priority: | normal → important |
| --- | --- |

Valgrind report

```
 $ valgrind ./ffmpeg_g -i ./samples/ogg/audio-gaps.ogg -loglevel 99 -c copy -map 0 -y -disposition:v:174 a64multi -c:a:171 a64multi -disposition:s:9 a64multi -stream_loop 24 -t 3 -target vcd -r 82 -ab 907 -ar 22050 -ac 4 -b:v 866k -level 12 -strict 3 tmp.mp4

```
```
==21685== Memcheck, a memory error detector
==21685== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==21685== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info
==21685== Command: ../ffmpeg/ffmpeg_g -i ./samples/ogg/audio-gaps.ogg -loglevel 99 -c copy -map 0 -y -disposition:v:174 a64multi -c:a:171 a64multi -disposition:s:9 a64multi -stream_loop 24 -t 3 -target vcd -r 82 -ab 907 -ar 22050 -ac 4 -b:v 866k -level 12 -strict 3 tmp.mp4
==21685==
ffmpeg version N-94906-gcb8d6a4e3e Copyright (c) 2000-2019 the FFmpeg developers
  built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
  configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-usan
  libavutil      56. 35.100 / 56. 35.100
  libavcodec     58. 56.101 / 58. 56.101
  libavformat    58. 32.104 / 58. 32.104
  libavdevice    58.  9.100 / 58.  9.100
  libavfilter     7. 58.102 /  7. 58.102
  libswscale      5.  6.100 /  5.  6.100
  libswresample   3.  6.100 /  3.  6.100
Splitting the commandline.
Reading option '-i' ... matched as input url with argument './samples/ogg/audio-gaps.ogg'.
Reading option '-loglevel' ... matched as option 'loglevel' (set logging level) with argument '99'.
Reading option '-c' ... matched as option 'c' (codec name) with argument 'copy'.
Reading option '-map' ... matched as option 'map' (set input stream mapping) with argument '0'.
Reading option '-y' ... matched as option 'y' (overwrite output files) with argument '1'.
Reading option '-disposition:v:174' ... matched as option 'disposition' (disposition) with argument 'a64multi'.
Reading option '-c:a:171' ... matched as option 'c' (codec name) with argument 'a64multi'.
Reading option '-disposition:s:9' ... matched as option 'disposition' (disposition) with argument 'a64multi'.
Reading option '-stream_loop' ... matched as option 'stream_loop' (set number of times input stream shall be looped) with argument '24'.
Reading option '-t' ... matched as option 't' (record or transcode "duration" seconds of audio/video) with argument '3'.
Reading option '-target' ... matched as option 'target' (specify target file type ("vcd", "svcd", "dvd", "dv" or "dv50" with optional prefixes "pal-", "ntsc-" or "film-")) with argument 'vcd'.
Reading option '-r' ... matched as option 'r' (set frame rate (Hz value, fraction or abbreviation)) with argument '82'.
Reading option '-ab' ... matched as option 'ab' (audio bitrate (please use -b:a)) with argument '907'.
Reading option '-ar' ... matched as option 'ar' (set audio sampling rate (in Hz)) with argument '22050'.
Reading option '-ac' ... matched as option 'ac' (set number of audio channels) with argument '4'.
Reading option '-b:v' ... matched as option 'b' (video bitrate (please use -b:v)) with argument '866k'.
Reading option '-level' ... matched as AVOption 'level' with argument '12'.
Reading option '-strict' ...Routing option strict to both codec and muxer layer
 matched as AVOption 'strict' with argument '3'.
Reading option 'tmp.mp4' ... matched as output url.
Finished splitting the commandline.
Parsing a group of options: global .
Applying option loglevel (set logging level) with argument 99.
Applying option y (overwrite output files) with argument 1.
Successfully parsed a group of options.
Parsing a group of options: input url ./samples/ogg/audio-gaps.ogg.
Successfully parsed a group of options.
Opening an input file: ./samples/ogg/audio-gaps.ogg.
[NULL @ 0x11c4b880] Opening './samples/ogg/audio-gaps.ogg' for reading
[file @ 0x11c4c6c0] Setting default whitelist 'file,crypto'
Probing mp3 score:1 size:2048
Probing ogg score:100 size:2048
[ogg @ 0x11c4b880] Format ogg probed with size=2048 and score=100
[ogg @ 0x11c4b880] ogg_packet: curidx=-1
[ogg @ 0x11c4b880] ogg_packet: idx=0 pstart=0 psize=0 segp=0 nsegs=1
[ogg @ 0x11c4b880] ogg_packet: curidx=-1
[ogg @ 0x11c4b880] ogg_packet: idx=0 pstart=30 psize=0 segp=0 nsegs=14
[ogg @ 0x11c4b880] ogg_packet: curidx=0
[ogg @ 0x11c4b880] ogg_packet: idx=0 pstart=46 psize=0 segp=1 nsegs=14
[ogg @ 0x11c4b880] ogg_packet: curidx=-1
[ogg @ 0x11c4b880] ogg_packet: idx=0 pstart=3288 psize=0 segp=0 nsegs=19
[ogg @ 0x11c4b880] found headers
[ogg @ 0x11c4b880] ogg_packet: curidx=-1
[ogg @ 0x11c4b880] ogg_packet: idx=0 pstart=0 psize=0 segp=0 nsegs=19
[ogg @ 0x11c4b880] Before avformat_find_stream_info() pos: 7636 bytes read:12306 seeks:0 nb_streams:1
[ogg @ 0x11c4b880] ogg_packet: curidx=0
[ogg @ 0x11c4b880] ogg_packet: idx=0 pstart=3288 psize=0 segp=0 nsegs=19
[ogg @ 0x11c4b880] All info found
[ogg @ 0x11c4b880] stream 0: start_time: 0.000 duration: 2.301
[ogg @ 0x11c4b880] format: start_time: 0.000 duration: 2.301 bitrate=42 kb/s
[ogg @ 0x11c4b880] After avformat_find_stream_info() pos: 7636 bytes read:12306 seeks:0 frames:1
Input #0, ogg, from './samples/ogg/audio-gaps.ogg':
  Duration: 00:00:02.30, start: 0.000000, bitrate: 42 kb/s
    Stream #0:0, 1, 1/11127: Audio: vorbis, 11127 Hz, stereo, fltp
Successfully opened the file.
Parsing a group of options: output url tmp.mp4.
Applying option c (codec name) with argument copy.
Applying option map (set input stream mapping) with argument 0.
Applying option disposition:v:174 (disposition) with argument a64multi.
Applying option c:a:171 (codec name) with argument a64multi.
Applying option disposition:s:9 (disposition) with argument a64multi.
Option stream_loop (set number of times input stream shall be looped) cannot be applied to output url tmp.mp4 -- you are trying to apply an input option to an output file or vice versa. Move this option before the file it belongs to.
Error parsing options for output file tmp.mp4.
Error opening output files: Invalid argument
[AVIOContext @ 0x11c551c0] Statistics: 12306 bytes read, 0 seeks
==21685==
==21685== HEAP SUMMARY:
==21685==     in use at exit: 177 bytes in 12 blocks
==21685==   total heap usage: 322 allocs, 310 frees, 1,022,052 bytes allocated
==21685==
==21685== LEAK SUMMARY:
==21685==    definitely lost: 96 bytes in 3 blocks
==21685==    indirectly lost: 49 bytes in 8 blocks
==21685==      possibly lost: 0 bytes in 0 blocks
==21685==    still reachable: 32 bytes in 1 blocks
==21685==         suppressed: 0 bytes in 0 blocks
==21685== Rerun with --leak-check=full to see details of leaked memory
==21685==
==21685== For counts of detected and suppressed errors, rerun with: -v
==21685== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

```

### by Suhwan, [5 years ago](/timeline?from=2019-09-15T11%3A10%3A39Z&precision=second "See timeline at Sep 15, 2019, 11:10:39 AM")

| Attachment: | [*audio-gaps.ogg*](/attachment/ticket/8094/audio-gaps.ogg)[​](/raw-attachment/ticket/8094/audio-gaps.ogg "Download") added |
| --- | --- |

poc

### [comment:2](#comment:2) by Carl Eugen Hoyos, [5 years ago](/timeline?from=2020-02-28T18%3A07%3A48Z&precision=second "See timeline at Feb 28, 2020, 6:07:48 PM")

| Component: | undetermined → ffmpeg |
| --- | --- |
| Keywords: | leak added |
| Priority: | important → minor |
| Reproduced by developer: | set |
| Status: | new → open |

Not a library leak afaics.

### [comment:3](#comment:3) by Carl Eugen Hoyos, [5 years ago](/timeline?from=2020-03-01T00%3A16%3A43Z&precision=second "See timeline at Mar 1, 2020, 12:16:43 AM")

| Resolution: | → fixed |
| --- | --- |
| Status: | open → closed |

Fixed by Andreas Rheinhardt in [21265f42ecb265debe9fec1dbfd0cb7de5a8aefb](/changeset/21265f42ecb265debe9fec1dbfd0cb7de5a8aefb/ffmpeg "fftools/ffmpeg_opt: Fix leak of options when parsing options fails
 ...")

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8094?format=rss)
* [Comma-delimited Text](/ticket/8094?format=csv)
* [Tab-delimited Text](/ticket/8094?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from lists.debian.org_6a8652f3_20250119_115037.html ===


---

[[Date Prev](msg00011.html)][[Date Next](msg00013.html)]
[[Thread Prev](msg00011.html)][[Thread Next](msg00013.html)]
[[Date Index](maillist.html#00012)]
[[Thread Index](threads.html#00012)]

# [SECURITY] [DLA 2818-1] ffmpeg security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 2818-1] ffmpeg security update
* *From*: Anton Gladky <gladk@debian.org>
* *Date*: Sun, 14 Nov 2021 21:47:56 +0100
* *Message-id*: <[[🔎]](/msgid-search/20211114204756.953FA4A035E%40thinkpad.localdomain) [20211114204756.953FA4A035E@thinkpad.localdomain](msg00012.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2818-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                         Anton Gladky
November 13, 2021                             <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : ffmpeg
Version        : 7:3.2.16-1+deb9u1
CVE ID         : CVE-2020-20445 CVE-2020-20446 CVE-2020-20451 CVE-2020-20453
                 CVE-2020-22037 CVE-2020-22041 CVE-2020-22044 CVE-2020-22046
                 CVE-2020-22048 CVE-2020-22049 CVE-2020-22054 CVE-2021-38171
                 CVE-2021-38291

Multiple issues have been discovered in ffmpeg - tools for transcoding,
streaming and playing of multimedia files.

CVE-2020-20445

    Divide By Zero issue via libavcodec/lpc.h, which allows a remote malicious
    user to cause a Denial of Service.

CVE-2020-20446

    Divide By Zero issue via libavcodec/aacpsy.c, which allows a remote malicious
    user to cause a Denial of Service.

CVE-2020-20451

    Denial of Service issue due to resource management errors via
    fftools/cmdutils.c.

CVE-2020-20453

    Divide By Zero issue via libavcodec/aaccoder, which allows a remote
    malicious user to cause a Denial of Service.

CVE-2020-22037

    A Denial of Service vulnerability due to a memory leak in
    avcodec_alloc_context3 at options.c

CVE-2020-22041

    A Denial of Service vulnerability due to a memory leak in
    the av_buffersrc_add_frame_flags function in buffersrc.

CVE-2020-22044

    A Denial of Service vulnerability due to a memory leak in the
    url_open_dyn_buf_internal function in libavformat/aviobuf.c.

CVE-2020-22046

    A Denial of Service vulnerability due to a memory leak in the
    avpriv_float_dsp_allocl function in libavutil/float_dsp.c.

CVE-2020-22048

    A Denial of Service vulnerability due to a memory leak in the
    ff_frame_pool_get function in framepool.c.

CVE-2020-22049

    A Denial of Service vulnerability due to a memory leak in the
    wtvfile_open_sector function in wtvdec.c.

CVE-2020-22054

    A Denial of Service vulnerability due to a memory leak in the av_dict_set
    function in dict.c.

CVE-2021-38171

    adts_decode_extradata in libavformat/adtsenc.c does not check the
    init_get_bits return value, which is a necessary step because the second
    argument to init_get_bits can be crafted.

CVE-2021-38291

    Assertion failure at src/libavutil/mathematics.c, causing ffmpeg aborted
    is detected. In some extrme cases, like with adpcm_ms samples with an
    extremely high channel count, get_audio_frame_duration() may return a
    negative frame duration value.

For Debian 9 stretch, these problems have been fixed in version
7:3.2.16-1+deb9u1.

We recommend that you upgrade your ffmpeg packages.

For the detailed security status of ffmpeg please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/ffmpeg>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEu71F6oGKuG/2fnKF0+Fzg8+n/wYFAmGRdfMACgkQ0+Fzg8+n
/wYM1hAAlHzYwm9B2nvTdl09cQjxypZel3vsSLywadLMkwxz+nOkqT8eKK7NUCx+
DDuCEpNKx8NXudadNxp3RFgjkmC72cB9aFZsjaq2OoycCJhRK43hTWNt+4fEuSWZ
AVThV5bC72usSf2bW56cHsiF1nIJqkPIlc9wpPBXPz+sVSoDrZAN7npzdMmrZbEi
jakCPqUAtOfJXMlphT5rN91DVFvHbSeeSl4YSVk4/ne7vPv8exy2eQH1UfHOu7JY
7jzg15Y9H5eQILlVTyj5Kjqf8oC20toyMTFJLYTnBBlnRGjDa71RqBajWN3wfH2h
HNrLrFuqpeR0L5Pp7BdybGETHTh4xdXthj6yWQr83rGJt6qSr4wbB7cYyhp/fPci
+5k92Cr/4+GVtbZ5Mf3swqVuak6N+FHHhO3RmcNGxaGBf8FGo6R4appfbMITusow
AdJWeGIwIU57jPkD3gVAuySWJGtm2jiqpHMpL7tF9t4ZX/tOE3Anzoxtql+qJhZH
fU+GdJ6giWA80NnpicG44I6dh/yC8zL3B/nXRI/dBVVgmSEwL4ypFfj/C491nx2i
FQ/suwiZLaSip8dDyjsb6kdvvoivRqMZhzmWlsp3cdvJluJdqSfMMG0sI9J7nxfk
phWZs4mBriPSOu+zQoLr7uyqtL/sSHeQ0gINBAN9iO5sagG6aBk=
=2qUQ
-----END PGP SIGNATURE-----

```

---


