=== Content from trac.ffmpeg.org_cea1cf23_20250119_130328.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/7989 "Ticket #7989")
* [Next Ticket](/ticket/7991 "Ticket #7991") →

---

Opened [6 years ago](/timeline?from=2019-07-04T05%3A27%3A12Z&precision=second "See timeline at Jul 4, 2019, 5:27:12 AM")

Closed [4 years ago](/timeline?from=2021-05-28T17%3A21%3A23Z&precision=second "See timeline at May 28, 2021, 5:21:23 PM")

Last modified [4 years ago](/timeline?from=2021-05-28T19%3A47%3A08Z&precision=second "See timeline at May 28, 2021, 7:47:08 PM")

## [#7990](/ticket/7990) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# undefined-behavior at libavcodec/snowenc.c and division by zero at libavcodec/ratecontrol.c

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [unspecified](/query?status=!closed&version=unspecified) | Keywords: | [ubsan](/query?keywords=~ubsan&status=!closed) [snowenc](/query?keywords=~snowenc&status=!closed) [ratecontrol](/query?keywords=~ratecontrol&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

There're undefined-behavior at libavcodec/snowenc.c and division by zero at libavcodec/ratecontrol.c.

How to reproduce:

```
% ffmpeg_g  -y -r 51 -i tmp.avi -map 0 -c:v snow -c:v:82 sgi -disposition:a msvideo1 -disposition:s:13 g726 -r 2 -ab 841k -ar 22050 -ac 5 -strict 1 tmp_.adx

ffmpeg version : N-94163-g664a27ea40
built with clang version 9.0.0

```

Patches should be submitted to the ffmpeg-devel mailing list and not this bug tracker.

### Attachments (2)

[tmp.avi](/attachment/ticket/7990/tmp.avi "View attachment")[​](/raw-attachment/ticket/7990/tmp.avi "Download")
(282.5 KB
) - added by Suhwan [6 years ago](/timeline?from=2019-07-04T05%3A28%3A54Z&precision=second "See timeline at Jul 4, 2019, 5:28:54 AM").
[gdb\_log\_7990](/attachment/ticket/7990/gdb_log_7990 "View attachment")[​](/raw-attachment/ticket/7990/gdb_log_7990 "Download")
(14.1 KB
) - added by Suhwan [6 years ago](/timeline?from=2019-07-04T05%3A29%3A21Z&precision=second "See timeline at Jul 4, 2019, 5:29:21 AM").

Download all attachments as:
[.zip](/zip-attachment/ticket/7990/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (5)

### by Suhwan, [6 years ago](/timeline?from=2019-07-04T05%3A28%3A54Z&precision=second "See timeline at Jul 4, 2019, 5:28:54 AM")

| Attachment: | [*tmp.avi*](/attachment/ticket/7990/tmp.avi)[​](/raw-attachment/ticket/7990/tmp.avi "Download") added |
| --- | --- |

### by Suhwan, [6 years ago](/timeline?from=2019-07-04T05%3A29%3A21Z&precision=second "See timeline at Jul 4, 2019, 5:29:21 AM")

| Attachment: | [*gdb\_log\_7990*](/attachment/ticket/7990/gdb_log_7990)[​](/raw-attachment/ticket/7990/gdb_log_7990 "Download") added |
| --- | --- |

### [comment:1](#comment:1) by Michael Niedermayer, [4 years ago](/timeline?from=2021-05-28T17%3A21%3A23Z&precision=second "See timeline at May 28, 2021, 5:21:23 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

The 2 undefined shifts in snowenc where fixed in [8802e329c8317ca5ceb929df48a23eb0f9e852b2](/changeset/8802e329c8317ca5ceb929df48a23eb0f9e852b2/ffmpeg "avcodec/snowenc: Fix 2 undefined shifts

Fixes: Ticket7990
 ...")

The division by 0 in ratecontrol is not an integer division so its not a bug as such

### [comment:2](#comment:2) by Michael Niedermayer, [4 years ago](/timeline?from=2021-05-28T18%3A36%3A21Z&precision=second "See timeline at May 28, 2021, 6:36:21 PM")

I will post a patch to ffmpeg-devel to avoid the floating point division.

### [comment:3](#comment:3) by Michael Niedermayer, [4 years ago](/timeline?from=2021-05-28T19%3A47%3A08Z&precision=second "See timeline at May 28, 2021, 7:47:08 PM")

No floating point division by 0 is reproduceable anymore since a long time

The floating point division was fixed already in [55279d699fa64d8eb1185d8db04ab4ed92e8dea2](/changeset/55279d699fa64d8eb1185d8db04ab4ed92e8dea2/ffmpeg "avcodec/snowenc: Set mb_num to avoid ratecontrol floating point ...")

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/7990?format=rss)
* [Comma-delimited Text](/ticket/7990?format=csv)
* [Tab-delimited Text](/ticket/7990?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


