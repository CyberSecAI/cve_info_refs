=== Content from git.ffmpeg.org_847d191f_20250119_111310.html ===

[![git](static/git-logo.png)](http://git-scm.com/ "git homepage")[projects](/gitweb) / [ffmpeg.git](/gitweb/ffmpeg.git) / commit

commit
grep
author
committer
pickaxe
 [?](/gitweb/ffmpeg.git/search_help "search help") search:

re

[summary](/gitweb/ffmpeg.git) | [shortlog](/gitweb/ffmpeg.git/shortlog/dd01947397b98e94c3f2a79d5820aaf4594f4d3b) | [log](/gitweb/ffmpeg.git/log/dd01947397b98e94c3f2a79d5820aaf4594f4d3b) | commit | [commitdiff](/gitweb/ffmpeg.git/commitdiff/dd01947397b98e94c3f2a79d5820aaf4594f4d3b) | [tree](/gitweb/ffmpeg.git/tree/dd01947397b98e94c3f2a79d5820aaf4594f4d3b)

(parent: [f259848](/gitweb/ffmpeg.git/commit/f2598484b8301d8836ec34c45a9003d99c2bd606)) | [patch](/gitweb/ffmpeg.git/patch/dd01947397b98e94c3f2a79d5820aaf4594f4d3b)

[avformat/latmenc: abort if no extradata is available](/gitweb/ffmpeg.git/commitdiff/dd01947397b98e94c3f2a79d5820aaf4594f4d3b)

| author | [James Almer](/gitweb/ffmpeg.git/search/dd01947397b98e94c3f2a79d5820aaf4594f4d3b?s=James+Almer;st=author "Search for commits authored by James Almer") [<jamrial@gmail.com>](/gitweb/ffmpeg.git/search/dd01947397b98e94c3f2a79d5820aaf4594f4d3b?s=jamrial@gmail.com;st=author "Search for commits authored by jamrial@gmail.com") |  |
| --- | --- | --- |
|  | Tue, 15 Oct 2019 14:38:23 +0000 (11:38 -0300) |
| committer | [James Almer](/gitweb/ffmpeg.git/search/dd01947397b98e94c3f2a79d5820aaf4594f4d3b?s=James+Almer;st=committer "Search for commits committed by James Almer") [<jamrial@gmail.com>](/gitweb/ffmpeg.git/search/dd01947397b98e94c3f2a79d5820aaf4594f4d3b?s=jamrial@gmail.com;st=committer "Search for commits committed by jamrial@gmail.com") |  |
|  | Tue, 15 Oct 2019 16:04:44 +0000 (13:04 -0300) |
| commit | dd01947397b98e94c3f2a79d5820aaf4594f4d3b |
| tree | [f0ea093d72b6c1416966ce6b57bf9c7d72560a09](/gitweb/ffmpeg.git/tree/dd01947397b98e94c3f2a79d5820aaf4594f4d3b) | [tree](/gitweb/ffmpeg.git/tree/dd01947397b98e94c3f2a79d5820aaf4594f4d3b) |
| parent | [f2598484b8301d8836ec34c45a9003d99c2bd606](/gitweb/ffmpeg.git/commit/f2598484b8301d8836ec34c45a9003d99c2bd606) | [commit](/gitweb/ffmpeg.git/commit/f2598484b8301d8836ec34c45a9003d99c2bd606) | [diff](/gitweb/ffmpeg.git/commitdiff/dd01947397b98e94c3f2a79d5820aaf4594f4d3b?hp=f2598484b8301d8836ec34c45a9003d99c2bd606) |

avformat/latmenc: abort if no extradata is available

Fixes ticket #8273.

Reviewed-by: Paul B Mahol <onemda@gmail.com>

Signed-off-by: James Almer <jamrial@gmail.com>

| [libavformat/latmenc.c](/gitweb/ffmpeg.git/blob/dd01947397b98e94c3f2a79d5820aaf4594f4d3b%3A/libavformat/latmenc.c) |  | [diff](/gitweb/ffmpeg.git/blobdiff/f2598484b8301d8836ec34c45a9003d99c2bd606..dd01947397b98e94c3f2a79d5820aaf4594f4d3b%3A/libavformat/latmenc.c) | [blob](/gitweb/ffmpeg.git/blob/dd01947397b98e94c3f2a79d5820aaf4594f4d3b%3A/libavformat/latmenc.c) | [history](/gitweb/ffmpeg.git/history/dd01947397b98e94c3f2a79d5820aaf4594f4d3b%3A/libavformat/latmenc.c) |
| --- | --- | --- |

FFmpeg git repo
[RSS](/gitweb/ffmpeg.git/rss "log RSS feed")
[Atom](/gitweb/ffmpeg.git/atom "log Atom feed")



=== Content from trac.ffmpeg.org_dda908f1_20250119_111317.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8272 "Ticket #8272")
* [Next Ticket](/ticket/8274 "Ticket #8274") →

---

Opened [5 years ago](/timeline?from=2019-10-15T14%3A06%3A36Z&precision=second "See timeline at Oct 15, 2019, 2:06:36 PM")

Closed [5 years ago](/timeline?from=2019-10-15T16%3A06%3A01Z&precision=second "See timeline at Oct 15, 2019, 4:06:01 PM")

## [#8273](/ticket/8273) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# Segmentation fault in avpriv\_copy\_bits at libavcodec/bitstream.c:86

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [important](/query?priority=important&status=!closed) | Component: | [avformat](/query?component=avformat&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [SIGSEGV](/query?keywords=~SIGSEGV&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [yes](/query?reproduced=1&status=!closed) |
| Analyzed by developer: | [yes](/query?analyzed=1&status=!closed) |  |  |

## Description

Summary of the bug:

There is a Segmentation fault in avpriv\_copy\_bits at libavcodec/bitstream.c:86

How to reproduce:

```
% ffmpeg_g -i $PoC -c copy tmp.loas

ffmpeg version N-95382-g62f4722582 Copyright (c) 2000-2019 the FFmpeg developers
built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug

```

Here's log

```
Program received signal SIGSEGV, Segmentation fault.
0x0000000001cb6126 in avpriv_copy_bits (pb=<optimized out>, src=<optimized out>, length=3) at libavcodec/bitstream.c:86
86	    put_bits(pb, bits, AV_RB16(src + 2 * words) >> (16 - bits));
(gdb) bt
#0  0x0000000001cb6126 in avpriv_copy_bits (pb=<optimized out>, src=<optimized out>, length=3) at libavcodec/bitstream.c:86
#1  0x00000000015ee80f in latm_write_frame_header (s=<optimized out>, bs=<optimized out>) at libavformat/latmenc.c:128
#2  latm_write_packet (s=<optimized out>, pkt=<optimized out>) at libavformat/latmenc.c:188
#3  0x00000000017c7515 in write_packet (s=0x9132ec0, pkt=<optimized out>) at libavformat/mux.c:747
#4  0x00000000017cded6 in av_interleaved_write_frame (s=<optimized out>, pkt=0x7fffffffc790) at libavformat/mux.c:1238
#5  0x00000000004b5d9b in write_packet (of=<optimized out>, pkt=0x7fffffffc790, ost=<optimized out>, unqueue=<optimized out>) at fftools/ffmpeg.c:815
#6  0x00000000004a3f21 in do_streamcopy (ist=<optimized out>, ost=<optimized out>, pkt=<optimized out>) at fftools/ffmpeg.c:2066
#7  process_input_packet (ist=<optimized out>, pkt=<optimized out>, no_eof=<optimized out>) at fftools/ffmpeg.c:2736
#8  0x00000000004bf0a0 in process_input (file_index=<optimized out>) at fftools/ffmpeg.c:4508
#9  0x000000000048d59b in transcode_step () at fftools/ffmpeg.c:4628
#10 transcode () at fftools/ffmpeg.c:4682
#11 0x0000000000487d54 in main (argc=9, argv=<optimized out>) at fftools/ffmpeg.c:4884
(gdb) disass $pc-32,$pc+32
Dump of assembler code from 0x1cb6106 to 0x1cb6146:
   0x0000000001cb6106 <avpriv_copy_bits+2038>:	repnz add %rax,%rdx
   0x0000000001cb610a <avpriv_copy_bits+2042>:	setb   %bl
   0x0000000001cb610d <avpriv_copy_bits+2045>:	cmp    %rsi,%rdx
   0x0000000001cb6110 <avpriv_copy_bits+2048>:	setae  %cl
   0x0000000001cb6113 <avpriv_copy_bits+2051>:	test   %ebp,%ebp
   0x0000000001cb6115 <avpriv_copy_bits+2053>:	js     0x1cb6153 <avpriv_copy_bits+2115>
   0x0000000001cb6117 <avpriv_copy_bits+2055>:	add    %rax,%r12
   0x0000000001cb611a <avpriv_copy_bits+2058>:	test   %cl,%cl
   0x0000000001cb611c <avpriv_copy_bits+2060>:	je     0x1cb615c <avpriv_copy_bits+2124>
   0x0000000001cb611e <avpriv_copy_bits+2062>:	and    $0xf,%ebp
   0x0000000001cb6121 <avpriv_copy_bits+2065>:	test   %r12,%r12
   0x0000000001cb6124 <avpriv_copy_bits+2068>:	je     0x1cb616e <avpriv_copy_bits+2142>
=> 0x0000000001cb6126 <avpriv_copy_bits+2070>:	movzwl (%r12),%eax
   0x0000000001cb612b <avpriv_copy_bits+2075>:	rol    $0x8,%ax
   0x0000000001cb612f <avpriv_copy_bits+2079>:	movzwl %ax,%edx
   0x0000000001cb6132 <avpriv_copy_bits+2082>:	mov    $0x10,%ecx
   0x0000000001cb6137 <avpriv_copy_bits+2087>:	sub    %ebp,%ecx
   0x0000000001cb6139 <avpriv_copy_bits+2089>:	shr    %cl,%edx
   0x0000000001cb613b <avpriv_copy_bits+2091>:	mov    %r15,%rdi
   0x0000000001cb613e <avpriv_copy_bits+2094>:	mov    %ebp,%esi
   0x0000000001cb6140 <avpriv_copy_bits+2096>:	add    $0x38,%rsp
   0x0000000001cb6144 <avpriv_copy_bits+2100>:	pop    %rbx
   0x0000000001cb6145 <avpriv_copy_bits+2101>:	pop    %r12
End of assembler dump.

```

Please confirm.

Thanks

### Attachments (2)

[gdb-bitstream\_86](/attachment/ticket/8273/gdb-bitstream_86 "View attachment")[​](/raw-attachment/ticket/8273/gdb-bitstream_86 "Download")
(21.3 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-10-15T14%3A06%3A49Z&precision=second "See timeline at Oct 15, 2019, 2:06:49 PM").
[PoC\_bitstream\_86.rm](/attachment/ticket/8273/PoC_bitstream_86.rm "View attachment")[​](/raw-attachment/ticket/8273/PoC_bitstream_86.rm "Download")
(312.7 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-10-15T14%3A07%3A04Z&precision=second "See timeline at Oct 15, 2019, 2:07:04 PM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8273/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (3)

### by Suhwan, [5 years ago](/timeline?from=2019-10-15T14%3A06%3A49Z&precision=second "See timeline at Oct 15, 2019, 2:06:49 PM")

| Attachment: | [*gdb-bitstream\_86*](/attachment/ticket/8273/gdb-bitstream_86)[​](/raw-attachment/ticket/8273/gdb-bitstream_86 "Download") added |
| --- | --- |

### by Suhwan, [5 years ago](/timeline?from=2019-10-15T14%3A07%3A04Z&precision=second "See timeline at Oct 15, 2019, 2:07:04 PM")

| Attachment: | [*PoC\_bitstream\_86.rm*](/attachment/ticket/8273/PoC_bitstream_86.rm)[​](/raw-attachment/ticket/8273/PoC_bitstream_86.rm "Download") added |
| --- | --- |

poc

### [comment:1](#comment:1) by James, [5 years ago](/timeline?from=2019-10-15T16%3A06%3A01Z&precision=second "See timeline at Oct 15, 2019, 4:06:01 PM")

| Analyzed by developer: | set |
| --- | --- |
| Component: | undetermined → avformat |
| Reproduced by developer: | set |
| Resolution: | → fixed |
| Status: | new → closed |

Fixed in [dd01947397b98e94c3f2a79d5820aaf4594f4d3b](/changeset/dd01947397b98e94c3f2a79d5820aaf4594f4d3b/ffmpeg "avformat/latmenc: abort if no extradata is available

Fixes ticket ...").

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8273?format=rss)
* [Comma-delimited Text](/ticket/8273?format=csv)
* [Tab-delimited Text](/ticket/8273?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


