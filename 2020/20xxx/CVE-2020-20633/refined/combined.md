=== Content from blog.nintechnet.com_fe992f4f_20250119_120757.html ===

[![NinTechNet](https://blog.nintechnet.com/wp-content/uploads/2018/07/nintechnet_logo.png)](https://nintechnet.com/)

[NinTechNet](https://nintechnet.com/ "Back to NinTechNet's home")

The Ninja Technologies Network

[Skip to content](#content)
[Menu](#header-menu-responsive)

* [Blog Summary](https://blog.nintechnet.com/)
* [NinTechNet’s Home](https://nintechnet.com/)

# WordPress GDPR Cookie Consent plugin fixed vulnerability.

* by [Jerome Bruandet](https://blog.nintechnet.com/author/bruandet/)
* Posted on [February 12, 2020 - 11:10am [+0700]February 12, 2020 - 11:30am [+0700]](https://blog.nintechnet.com/wordpress-gdpr-cookie-consent-plugin-fixed-vulnerability/)

[GDPR Cookie Consent](https://wordpress.org/plugins/cookie-law-info/), a popular WordPress plugin with 700,000+ active installations, fixed a vulnerability affecting version 1.8.2 and below that could lead to authenticated stored XSS and privilege escalation.

### Reference

*A CVE ID has been requested and we’ll update this post when it is assigned.*

In the `__construct` method of the “admin/modules/cli-policy-generator/classes/class-policy-generator-ajax.php” script, the plugin registers the `cli_policy_generator` action via the WordPress AJAX API, which loads `ajax_policy_generator`:

```

public function __construct()
{
   add_action('wp_ajax_cli_policy_generator',array($this,'ajax_policy_generator'));
}

/*
*
* Main Ajax hook for processing requests
*/
public function ajax_policy_generator()
{
   $out=array(
      'response'=>false,
      'message'=>__('Unable to handle your request.','cookie-law-info'),
   );
   $non_json_response=array();
   if(isset($_POST['cli_policy_generator_action']))
   {
      $cli_policy_generator_action=$_POST['cli_policy_generator_action'];
      $allowed_actions=array('autosave_contant_data','save_contentdata','get_policy_pageid');
      if(in_array($cli_policy_generator_action,$allowed_actions) && method_exists($this,$cli_policy_generator_action))
      {
         $out=$this->{$cli_policy_generator_action}();
      }
   }
   if(in_array($cli_policy_generator_action,$non_json_response))
   {
      echo is_array($out) ? $out['message'] : $out;
   }else
   {
      echo json_encode($out);
   }
   exit();
}

```

It lacks capability checks and, although a nonce is sent over AJAX, it is not checked anywhere in the PHP code. It accepts three different values for the `cli_policy_generator_action` input and calls the corresponding method. Two of them, `autosave_contant_data` and `save_contentdata` can be easily exploited by an attacker.

### Privilege Escalation

The `save_contentdata` method allows the administrator to save the GDPR cookie notice to the database as a page post type:

```

public function save_contentdata()
{
   $out=array(
      'response'=>true,
      'er'=>''
   );
   $content_data=isset($_POST['content_data']) ? $_POST['content_data'] : array();
   $page_id=(int) isset($_POST['page_id']) ? $_POST['page_id']*1 : 0;
   $enable_webtofee_powered_by=(int) isset($_POST['enable_webtofee_powered_by']) ? $_POST['enable_webtofee_powered_by']*1 : 0;
   $id=wp_insert_post(
      array(
         'ID'=>$page_id, //if ID is zero it will create new page otherwise update
         'post_title'=>'Cookie Policy',
         'post_type'=>'page',
         'post_content'=>Cookie_Law_Info_Cli_Policy_Generator::generate_page_content($enable_webtofee_powered_by,$content_data,0),
         'post_status' => 'draft', //default is draft
      )
   );
   if(is_wp_error($id))
   {
      $out=array(
         'response'=>false,
         'er'=>__('Error','cookie-law-info'),
         //'er'=>$id->get_error_message(),
      );
   }else
   {
      Cookie_Law_Info_Cli_Policy_Generator::set_cookie_policy_pageid($id);
      $out['url']=get_edit_post_link($id);
   }
   return $out;
}

```

An authenticated user such as a subscriber can use it to put any existing page or post (or the entire website) offline by changing their status from “published” to “draft”:

![](../wp-content/uploads/2020/01/cookie-law-info-privilege-escalation-vulnerability.png)

Additionally, it is possible to delete or change their content. Injected content can include formatted text, local or remote images as well as hyperlinks and shortcodes.

### Authenticated Stored XSS

The `autosave_contant_data` method is used to save, in the background, the GDPR cookie info page while the admin is editing it:

```

public function autosave_contant_data()
{
   global $wpdb;
   $scan_table=$wpdb->prefix.$this->main_tb;
   $out=array(
      'response'=>true,
      'er'=>''
   );
   $content_data=isset($_POST['content_data']) ? $_POST['content_data'] : array();
   $page_id=isset($_POST['page_id']) ? $_POST['page_id'] : '';
   $enable_webtofee_powered_by=(int) isset($_POST['enable_webtofee_powered_by']) ? $_POST['enable_webtofee_powered_by']*1 : 0;
   if(is_array($content_data))
   {
      $content_html=Cookie_Law_Info_Cli_Policy_Generator::generate_page_content($enable_webtofee_powered_by,$content_data);
      update_option('cli_pg_content_data',$content_html);
   }else
   {
      $out=array(
         'response'=>false,
         'er'=>__('Error','cookie-law-info')
      );
   }
   return $out;
}

```

It saves the data into the `cli_pg_content_data` database field without validating it. An authenticated user can use it to inject JavaScript code, which will be loaded and executed each time someone, authenticated or not, visits the “http://example.com/cli-policy-preview/” page.

![](../wp-content/uploads/2020/01/cookie-law-info-xss-vulnerability.png)

### Timeline

We discovered the vulnerability and reported it to the wordpress.org team on January 28, 2020 and to the author on February 04. A new version 1.8.3 was released on February 10, 2020.

### Recommendations

Update as soon as possible if you have version 1.8.2 or below installed.

If you are using our web application firewall for WordPress, [NinjaFirewall WP Edition](https://wordpress.org/plugins/ninjafirewall/) (free) and [NinjaFirewall WP+ Edition](https://nintechnet.com/ninjafirewall/wp-edition/) (premium), you are protected against this vulnerability since January 28th, 2020.

Stay informed about the latest vulnerabilities in WordPress plugins and themes: [@nintechnet](https://twitter.com/nintechnet)

Tagged: [NinjaFirewall](https://blog.nintechnet.com/tag/ninjafirewall/), [Security](https://blog.nintechnet.com/tag/security/), [Vulnerability](https://blog.nintechnet.com/tag/vulnerability/), [WordPress](https://blog.nintechnet.com/tag/wordpress/)

* [Share on Twitter](https://twitter.com/share?text=WordPress%20GDPR%20Cookie%20Consent%20plugin%20fixed%20vulnerability.&url=https%3A%2F%2Fblog.nintechnet.com%2Fwordpress-gdpr-cookie-consent-plugin-fixed-vulnerability%2F)
* [Share on Facebook](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.nintechnet.com%2Fwordpress-gdpr-cookie-consent-plugin-fixed-vulnerability%2F)
* [Share on Reddit](https://www.reddit.com/submit?title=WordPress%20GDPR%20Cookie%20Consent%20plugin%20fixed%20vulnerability.&url=https%3A%2F%2Fblog.nintechnet.com%2Fwordpress-gdpr-cookie-consent-plugin-fixed-vulnerability%2F)
* [RSS icon](https://blog.nintechnet.com/feed/)

## Post navigation

[Previous WordPress WPS Hide Login fixed security issue.](https://blog.nintechnet.com/wordpress-wps-hide-login-fixed-security-issue/)[Next Zero-day vulnerability fixed in WordPress Flexible Checkout Fields for WooCommerce plugin.](https://blog.nintechnet.com/zero-day-vulnerability-fixed-in-wordpress-flexible-checkout-fields-for-woocommerce-plugin/)

## Our Products

![NinjaFirewall](https://blog.nintechnet.com/wp-content/uploads/2018/09/logo-nfwp-150.png)

**NinjaFirewall WP+**

Web Application Firewall for WordPress. It will give your blog the highest level of protection it deserves.

Free Download

---

![SaferCheckout](https://blog.nintechnet.com/wp-content/uploads/safercheckout_150x150.png)

**SaferCheckout**

A powerful security plugin to protect WooCommerce stores from fraudulent transactions.

Free Download

---

![NinjaFirewall](https://blog.nintechnet.com/wp-content/uploads/2018/09/logo-nfpro-150.png)

**NinjaFirewall Pro+**

Web Application Firewall for PHP applications. It will protect your PHP site, from custom scripts to popular shopping cart and CMS applications.

Free Download

---

![Code Profiler](https://blog.nintechnet.com/wp-content/uploads/2018/09/logo-cp-150.png)

**Code Profiler**

Speed up your WordPress website by locating bottlenecks and performance issues in your plugins and themes.

Free Download

---

![NinjaScanner](https://blog.nintechnet.com/wp-content/uploads/2018/09/logo-ns-150.png)

**NinjaScanner**

A lightweight, fast and powerful malware and virus scanner for WordPress which includes many features to help you scan your blog for malware and virus.

Free Download
## Categories

Categories
Select Category
Benchmarks  (5)
Changelog  (1)
Code Profiler  (1)
HHVM  (1)
Joomla!  (2)
Magento  (1)
NinjaFirewall  (150)
NinjaScanner  (8)
Performance  (2)
Privacy  (1)
Security  (154)
   Brute-force attack  (5)
   Malware  (7)
   Phishing  (2)
   Virus  (2)
   Vulnerability  (129)
Troubleshooting  (14)
Tutorial  (26)
WooCommerce  (2)
WordPress  (149)

## Search

Search for:

Search

## Recent Posts

* [XSS / HTML injection vulnerability in WordPress Plugin Check (PCP) plugin.](https://blog.nintechnet.com/xss-html-injection-vulnerability-in-wordpress-plugin-check-pcp-plugin/)
  December 6, 2024 - 7:24pm [+0700]
* [How to debug WooCommerce Add to Cart action with Code Profiler.](https://blog.nintechnet.com/how-to-debug-woocommerce-add-to-cart-action-with-code-profiler/)
  November 28, 2024 - 7:00pm [+0700]
* [SaferCheckout: Fraud prevention plugin for WooCommerce stores.](https://blog.nintechnet.com/safercheckout-fraud-prevention-plugin-for-woocommerce-stores/)
  August 5, 2024 - 5:31pm [+0700]
* [Unauthenticated function injection vulnerability in WordPress Shortcode Addons plugin (unpatched).](https://blog.nintechnet.com/unauthenticated-function-injection-vulnerability-in-wordpress-shortcode-addons-plugin-unpatched/)
  April 22, 2024 - 11:29am [+0700]
* [Broken access control vulnerability fixed in WordPress 10Web AI Assistant plugin.](https://blog.nintechnet.com/broken-access-control-vulnerability-fixed-in-wordpress-10web-ai-assistant-plugin/)
  January 26, 2024 - 1:50pm [+0700]

© Copyright
2025 – [The Ninja Technologies Network](https://nintechnet.com/)


