=== Content from git.ffmpeg.org_524b4255_20250119_112719.html ===

[![git](static/git-logo.png)](http://git-scm.com/ "git homepage")[projects](/gitweb) / [ffmpeg.git](/gitweb/ffmpeg.git) / commit

commit
grep
author
committer
pickaxe
 [?](/gitweb/ffmpeg.git/search_help "search help") search:

re

[summary](/gitweb/ffmpeg.git) | [shortlog](/gitweb/ffmpeg.git/shortlog/64a805883d7223c868a683f0030837d859edd2ab) | [log](/gitweb/ffmpeg.git/log/64a805883d7223c868a683f0030837d859edd2ab) | commit | [commitdiff](/gitweb/ffmpeg.git/commitdiff/64a805883d7223c868a683f0030837d859edd2ab) | [tree](/gitweb/ffmpeg.git/tree/64a805883d7223c868a683f0030837d859edd2ab)

(parent: [e14f5fd](/gitweb/ffmpeg.git/commit/e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df)) | [patch](/gitweb/ffmpeg.git/patch/64a805883d7223c868a683f0030837d859edd2ab)

[avfilter/vf\_gblur: fix heap-buffer overflow](/gitweb/ffmpeg.git/commitdiff/64a805883d7223c868a683f0030837d859edd2ab)

| author | [Paul B Mahol](/gitweb/ffmpeg.git/search/64a805883d7223c868a683f0030837d859edd2ab?s=Paul+B+Mahol;st=author "Search for commits authored by Paul B Mahol") [<onemda@gmail.com>](/gitweb/ffmpeg.git/search/64a805883d7223c868a683f0030837d859edd2ab?s=onemda@gmail.com;st=author "Search for commits authored by onemda@gmail.com") |  |
| --- | --- | --- |
|  | Wed, 16 Oct 2019 10:13:04 +0000 (12:13 +0200) |
| committer | [Paul B Mahol](/gitweb/ffmpeg.git/search/64a805883d7223c868a683f0030837d859edd2ab?s=Paul+B+Mahol;st=committer "Search for commits committed by Paul B Mahol") [<onemda@gmail.com>](/gitweb/ffmpeg.git/search/64a805883d7223c868a683f0030837d859edd2ab?s=onemda@gmail.com;st=committer "Search for commits committed by onemda@gmail.com") |  |
|  | Wed, 16 Oct 2019 10:13:04 +0000 (12:13 +0200) |
| commit | 64a805883d7223c868a683f0030837d859edd2ab |
| tree | [7a54e2b33ee5edb7f3a730020789dc3f9cd36cb4](/gitweb/ffmpeg.git/tree/64a805883d7223c868a683f0030837d859edd2ab) | [tree](/gitweb/ffmpeg.git/tree/64a805883d7223c868a683f0030837d859edd2ab) |
| parent | [e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df](/gitweb/ffmpeg.git/commit/e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df) | [commit](/gitweb/ffmpeg.git/commit/e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df) | [diff](/gitweb/ffmpeg.git/commitdiff/64a805883d7223c868a683f0030837d859edd2ab?hp=e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df) |

avfilter/vf\_gblur: fix heap-buffer overflow

Fixes #8282

| [libavfilter/vf\_gblur.c](/gitweb/ffmpeg.git/blob/64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/vf_gblur.c) |  | [diff](/gitweb/ffmpeg.git/blobdiff/e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df..64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/vf_gblur.c) | [blob](/gitweb/ffmpeg.git/blob/64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/vf_gblur.c) | [history](/gitweb/ffmpeg.git/history/64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/vf_gblur.c) |
| --- | --- | --- |
| [libavfilter/x86/vf\_gblur.asm](/gitweb/ffmpeg.git/blob/64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/x86/vf_gblur.asm) |  | [diff](/gitweb/ffmpeg.git/blobdiff/e14f5fd0a6983838b5fe3c6ad1c2ec2f2d8e49df..64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/x86/vf_gblur.asm) | [blob](/gitweb/ffmpeg.git/blob/64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/x86/vf_gblur.asm) | [history](/gitweb/ffmpeg.git/history/64a805883d7223c868a683f0030837d859edd2ab%3A/libavfilter/x86/vf_gblur.asm) |

FFmpeg git repo
[RSS](/gitweb/ffmpeg.git/rss "log RSS feed")
[Atom](/gitweb/ffmpeg.git/atom "log Atom feed")



=== Content from trac.ffmpeg.org_5e385348_20250119_112719.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8281 "Ticket #8281")
* [Next Ticket](/ticket/8283 "Ticket #8283") →

---

Opened [5 years ago](/timeline?from=2019-10-15T17%3A16%3A01Z&precision=second "See timeline at Oct 15, 2019, 5:16:01 PM")

Closed [5 years ago](/timeline?from=2019-10-16T10%3A21%3A36Z&precision=second "See timeline at Oct 16, 2019, 10:21:36 AM")

## [#8282](/ticket/8282) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# invalid free at at libavfilter/avfilter.c:771

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: |  |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

There is an invalid free at libavutil/dict.c:209

How to reproduce:

```
% ffmpeg_g -y -i $PoC -filter_complex gblur -target dv50 -loglevel 0 tmp.fsb

ffmpeg version N-95385-ge1b89c76f6 Copyright (c) 2000-2019 the FFmpeg developers
built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)

```

Here's GDB log

```
free(): invalid next size (fast)

Thread 1 "ffmpeg_g" received signal SIGABRT, Aborted.
__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51
51	../sysdeps/unix/sysv/linux/raise.c: No such file or directory.
(gdb) bt
#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51
#1  0x00007ffff5cb2801 in __GI_abort () at abort.c:79
#2  0x00007ffff5cfb897 in __libc_message (action=action@entry=do_abort,
    fmt=fmt@entry=0x7ffff5e28b9a "%s\n") at ../sysdeps/posix/libc_fatal.c:181
#3  0x00007ffff5d0290a in malloc_printerr (
    str=str@entry=0x7ffff5e2a800 "free(): invalid next size (fast)") at malloc.c:5350
#4  0x00007ffff5d09f60 in _int_free (have_lock=0, p=0x9132d50, av=0x7ffff605dc40 <main_arena>)
    at malloc.c:4213
#5  __GI___libc_free (mem=0x9132d60) at malloc.c:3124
#6  0x00000000058ca92f in av_dict_free (pm=0x7fffffffbfa8) at libavutil/dict.c:209
#7  0x000000000591bf1d in av_opt_set_dict2 (obj=0x93048c0, options=<optimized out>, search_flags=0)
    at libavutil/opt.c:1621
#8  0x000000000344a249 in avcodec_open2 (avctx=0x9304440, codec=0x6d47b10 <ff_dvvideo_encoder>,
    options=<optimized out>) at libavcodec/utils.c:640
#9  0x00000000021540d9 in ff_frame_thread_encoder_init (avctx=0x9111c40, options=0x9182440)
    at libavcodec/frame_thread_encoder.c:220
#10 0x000000000344d160 in avcodec_open2 (avctx=0x9111c40, codec=0x6d47b10 <ff_dvvideo_encoder>,
    options=<optimized out>) at libavcodec/utils.c:740
#11 0x00000000004a67f2 in init_output_stream (ost=<optimized out>, error=<optimized out>,
    error_len=1024) at fftools/ffmpeg.c:3507
#12 0x00000000004bff96 in reap_filters (flush=0) at fftools/ffmpeg.c:1442
#13 0x000000000048d612 in transcode_step () at fftools/ffmpeg.c:4638
#14 transcode () at fftools/ffmpeg.c:4682
#15 0x0000000000487d54 in main (argc=11, argv=<optimized out>) at fftools/ffmpeg.c:4884

```

ASAN log

```
==20551==ERROR: AddressSanitizer: attempting free on address which was not malloc()-ed: 0x60900000a840 in thread T0
    #0 0x4ddbe0 in __interceptor_free.localalias.0 (ffmpeg_asan+0x4ddbe0)
    #1 0x81a8f7 in avfilter_free ffmpeg/libavfilter/avfilter.c:771:9
    #2 0x835347 in avfilter_graph_free ffmpeg/libavfilter/avfiltergraph.c:126:9
    #3 0x5dbdf9 in ffmpeg_cleanup ffmpeg/fftools/ffmpeg.c:494:9
    #4 0x5afb04 in exit_program ffmpeg/fftools/cmdutils.c:139:9
    #5 0x5db8e2 in main ffmpeg/fftools/ffmpeg.c:4901:5
    #6 0x7ffff5c93b96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310
    #7 0x41def9 in _start (ffmpeg_asan+0x41def9)

0x60900000a840 is located 0 bytes inside of 97902940-byte region [0x60900000a840,0x609005d6899c)
==20551==AddressSanitizer CHECK failed: /build/llvm-toolchain-6.0-QjOn7h/llvm-toolchain-6.0-6.0/projects/compiler-rt/lib/asan/asan_descriptions.cc:179 "((res.trace)) != (0)" (0x0, 0x0)
    #0 0x4e6f05 in __asan::AsanCheckFailed(char const*, int, char const*, unsigned long long, unsigned long long) (ffmpeg_asan+0x4e6f05)
    #1 0x5047b5 in __sanitizer::CheckFailed(char const*, int, char const*, unsigned long long, unsigned long long) (ffmpeg_asan+0x5047b5)
    #2 0x42cc4c in __asan::HeapAddressDescription::Print() const (ffmpeg_asan+0x42cc4c)
    #3 0x42e1bb in __asan::ErrorFreeNotMalloced::Print() (ffmpeg_asan+0x42e1bb)
    #4 0x4e46a3 in __asan::ReportFreeNotMalloced(unsigned long, __sanitizer::BufferedStackTrace*) (ffmpeg_asan+0x4e46a3)
    #5 0x42941f in __asan::asan_free(void*, __sanitizer::BufferedStackTrace*, __asan::AllocType) (ffmpeg_asan+0x42941f)
    #6 0x4ddbba in __interceptor_free.localalias.0 (ffmpeg_asan+0x4ddbba)
    #7 0x81a8f7 in avfilter_free ffmpeg/libavfilter/avfilter.c:771:9
    #8 0x835347 in avfilter_graph_free ffmpeg/libavfilter/avfiltergraph.c:126:9
    #9 0x5dbdf9 in ffmpeg_cleanup ffmpeg/fftools/ffmpeg.c:494:9
    #10 0x5afb04 in exit_program ffmpeg/fftools/cmdutils.c:139:9
    #11 0x5db8e2 in main ffmpeg/fftools/ffmpeg.c:4901:5
    #12 0x7ffff5c93b96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310
    #13 0x41def9 in _start (ffmpeg_asan+0x41def9)

```

### Attachments (1)

[PoC\_dict\_209.png48](/attachment/ticket/8282/PoC_dict_209.png48 "View attachment")[​](/raw-attachment/ticket/8282/PoC_dict_209.png48 "Download")
(290 bytes
) - added by Suhwan [5 years ago](/timeline?from=2019-10-15T17%3A17%3A26Z&precision=second "See timeline at Oct 15, 2019, 5:17:26 PM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8282/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (3)

### by Suhwan, [5 years ago](/timeline?from=2019-10-15T17%3A17%3A26Z&precision=second "See timeline at Oct 15, 2019, 5:17:26 PM")

| Attachment: | [*PoC\_dict\_209.png48*](/attachment/ticket/8282/PoC_dict_209.png48)[​](/raw-attachment/ticket/8282/PoC_dict_209.png48 "Download") added |
| --- | --- |

poc

### [comment:1](#comment:1) by Suhwan, [5 years ago](/timeline?from=2019-10-16T04%3A59%3A12Z&precision=second "See timeline at Oct 16, 2019, 4:59:12 AM")

| Summary: | invalid free at libavutil/dict.c:209 → invalid free at at libavfilter/avfilter.c:771 |
| --- | --- |

```
ffmpeg version N-95389-gdd01947397 Copyright (c) 2000-2019 the FFmpeg developers
built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)

```
```
free(): invalid size

Thread 1 "ffmpeg_g" received signal SIGABRT, Aborted.
__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51
51	../sysdeps/unix/sysv/linux/raise.c: No such file or directory.
(gdb) bt
#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51
#1  0x00007ffff5cb2801 in __GI_abort () at abort.c:79
#2  0x00007ffff5cfb897 in __libc_message (action=action@entry=do_abort, fmt=fmt@entry=0x7ffff5e28b9a "%s\n") at ../sysdeps/posix/libc_fatal.c:181
#3  0x00007ffff5d0290a in malloc_printerr (str=str@entry=0x7ffff5e26da0 "free(): invalid size") at malloc.c:5350
#4  0x00007ffff5d09e2c in _int_free (have_lock=0, p=0x914a6f0, av=0x0) at malloc.c:4161
#5  __GI___libc_free (mem=0x914a700) at malloc.c:3124
#6  0x00000000005ca023 in avfilter_free (filter=0x9148440) at libavfilter/avfilter.c:771
#7  0x00000000005d5fd8 in avfilter_graph_free (graph=0x910b710) at libavfilter/avfiltergraph.c:126
#8  0x000000000048814b in ffmpeg_cleanup (ret=0) at fftools/ffmpeg.c:494
#9  0x0000000000474463 in exit_program (ret=0) at fftools/cmdutils.c:139
#10 0x0000000000487eef in main (argc=<optimized out>, argv=<optimized out>) at fftools/ffmpeg.c:4901

```

### [comment:2](#comment:2) by Elon Musk, [5 years ago](/timeline?from=2019-10-16T10%3A21%3A36Z&precision=second "See timeline at Oct 16, 2019, 10:21:36 AM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8282?format=rss)
* [Comma-delimited Text](/ticket/8282?format=csv)
* [Tab-delimited Text](/ticket/8282?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


