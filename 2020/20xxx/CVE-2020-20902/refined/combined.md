=== Content from trac.ffmpeg.org_3c1e21ad_20250119_122809.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8175 "Ticket #8175")
* [Next Ticket](/ticket/8177 "Ticket #8177") →

---

Opened [5 years ago](/timeline?from=2019-09-18T19%3A15%3A31Z&precision=second "See timeline at Sep 18, 2019, 7:15:31 PM")

Closed [5 years ago](/timeline?from=2020-01-23T13%3A25%3A53Z&precision=second "See timeline at Jan 23, 2020, 1:25:53 PM")

## [#8176](/ticket/8176) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# four out-of-bound bugs in g729dec.c and g729postfilter.c

| Reported by: | [Suhwan](/query?reporter=Suhwan&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [avcodec](/query?component=avcodec&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [g729](/query?keywords=~g729&status=!closed) [ubsan](/query?keywords=~ubsan&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [yes](/query?reproduced=1&status=!closed) |
| Analyzed by developer: | [yes](/query?analyzed=1&status=!closed) |  |  |

## Description

Summary of the bug:

There're 4 out of bounds bugs in g729dec.c and g729postfilter.c and 10 left shift of negative value bugs in libavcodec/lsp.c and libavcodec/g729postfilter.c

```
libavcodec/lsp.c:111:20: runtime error: left shift of negative value -31132
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/lsp.c:111:20 in
libavcodec/lsp.c:119:28: runtime error: left shift of negative value -9097
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/lsp.c:119:28 in
libavcodec/g729postfilter.c:503:58: runtime error: left shift of negative value -1743
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:503:58 in
libavcodec/g729postfilter.c:159:41: runtime error: left shift of negative value -1
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:159:41 in
libavcodec/g729postfilter.c:503:28: runtime error: left shift of negative value -11
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:503:28 in
libavcodec/g729dec.c:555:45: runtime error: index 62 out of bounds for type 'int16_t [40]'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729dec.c:555:45 in
libavcodec/g729dec.c:556:45: runtime error: index 62 out of bounds for type 'int16_t [40]'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729dec.c:556:45 in
libavcodec/g729postfilter.c:204:65: runtime error: index -61 out of bounds for type 'int16_t [192]'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:204:65 in
libavcodec/g729postfilter.c:205:64: runtime error: index -61 out of bounds for type 'int16_t [192]'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:205:64 in
libavcodec/g729postfilter.c:509:24: runtime error: left shift of negative value -14
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:509:24 in
libavcodec/g729postfilter.c:509:54: runtime error: left shift of negative value -23520
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:509:54 in
libavcodec/g729postfilter.c:349:49: runtime error: left shift of negative value -1
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:349:49 in
libavcodec/g729postfilter.c:370:36: runtime error: left shift of negative value -55
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:370:36 in
libavcodec/g729postfilter.c:467:18: runtime error: left shift of negative value -338
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior libavcodec/g729postfilter.c:467:18 in

```

How to reproduce:

```
% ffmpeg_g -stream_loop 25 -y -r 110 -i rec09.act -loglevel 0 -map 0 -aframes 52 -ar 22050 -ac 14 -b:v 786k -strict 3 tmp.ogg

ffmpeg version N-94961-g1d86e4b3eb Copyright (c) 2000-2019 the FFmpeg developers
  built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
  configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-usan

```

### Attachments (2)

[gdb-g729](/attachment/ticket/8176/gdb-g729 "View attachment")[​](/raw-attachment/ticket/8176/gdb-g729 "Download")
(11.6 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-09-18T19%3A15%3A48Z&precision=second "See timeline at Sep 18, 2019, 7:15:48 PM").
[rec09.act](/attachment/ticket/8176/rec09.act "View attachment")[​](/raw-attachment/ticket/8176/rec09.act "Download")
(23.0 KB
) - added by Suhwan [5 years ago](/timeline?from=2019-09-18T19%3A16%3A10Z&precision=second "See timeline at Sep 18, 2019, 7:16:10 PM").
poc

Download all attachments as:
[.zip](/zip-attachment/ticket/8176/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (4)

### by Suhwan, [5 years ago](/timeline?from=2019-09-18T19%3A15%3A48Z&precision=second "See timeline at Sep 18, 2019, 7:15:48 PM")

| Attachment: | [*gdb-g729*](/attachment/ticket/8176/gdb-g729)[​](/raw-attachment/ticket/8176/gdb-g729 "Download") added |
| --- | --- |

### by Suhwan, [5 years ago](/timeline?from=2019-09-18T19%3A16%3A10Z&precision=second "See timeline at Sep 18, 2019, 7:16:10 PM")

| Attachment: | [*rec09.act*](/attachment/ticket/8176/rec09.act)[​](/raw-attachment/ticket/8176/rec09.act "Download") added |
| --- | --- |

poc

### [comment:1](#comment:1) by Michael Niedermayer, [5 years ago](/timeline?from=2019-10-17T10%3A00%3A03Z&precision=second "See timeline at Oct 17, 2019, 10:00:03 AM")

| Analyzed by developer: | set |
| --- | --- |
| Component: | undetermined → avcodec |
| Reproduced by developer: | set |
| Status: | new → open |

This had some overlap with ossfuzz issue 17689 which was fixed in [6a4fdbf112385824fc9b7d7739685359213b579a](/changeset/6a4fdbf112385824fc9b7d7739685359213b579a/ffmpeg "avcodec/g729postfilter: Fix undefined shifts

Fixes: left shift of ...") [0c61661a2cbe1b8b284c80ada1c2fdddf4992cad](/changeset/0c61661a2cbe1b8b284c80ada1c2fdddf4992cad/ffmpeg "avcodec/g729postfilter: Fix undefined intermediate pointers

Fixes: ...") [2b93f52cd635f372b7b22396939e840c63e8edf3](/changeset/2b93f52cd635f372b7b22396939e840c63e8edf3/ffmpeg "avcodec/lsp: Fix undefined shifts in lsp2poly()

Fixes: left shift of ...")

Ill post a fix for the remaining issues for this ticket to ffmpeg-devel

### [comment:2](#comment:2) by Carl Eugen Hoyos, [5 years ago](/timeline?from=2020-01-23T13%3A25%3A53Z&precision=second "See timeline at Jan 23, 2020, 1:25:53 PM")

| Keywords: | g729 added |
| --- | --- |
| Resolution: | → fixed |
| Status: | open → closed |

Fixed by Michael in [5f0acc5064ed501cb40d4aaccae2b3ce5c4552fd](/changeset/5f0acc5064ed501cb40d4aaccae2b3ce5c4552fd/ffmpeg "avcodec/g729postfilter: Fix left shift of negative value

Fixes: ...") and [2c78a76cb0443f8a12a5eadc3b58373aa2f4ab22](/changeset/2c78a76cb0443f8a12a5eadc3b58373aa2f4ab22/ffmpeg "avcodec/g729dec: Avoid computing invalid temporary pointers for ...")

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8176?format=rss)
* [Comma-delimited Text](/ticket/8176?format=csv)
* [Tab-delimited Text](/ticket/8176?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


