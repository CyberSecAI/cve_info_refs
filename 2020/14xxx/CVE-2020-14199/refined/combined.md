=== Content from blog.trezor.io_d9babf3b_20250119_114412.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1eba8f60f2dd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Details of firmware updates for Trezor One (version 1.9.1) and Trezor Model T (version 2.3.1)

[![Pavol Rusnak](https://miro.medium.com/v2/resize:fill:88:88/1*0d3CRyIEjq-BFoJjRt-JEw.png)](https://medium.com/%40pavolrusnak?source=post_page---byline--1eba8f60f2dd--------------------------------)[![Trezor Blog](https://miro.medium.com/v2/resize:fill:48:48/1*Sek00YxqMdOJp5FsjveZiQ.png)](https://blog.trezor.io/?source=post_page---byline--1eba8f60f2dd--------------------------------)

[Pavol Rusnak](https://medium.com/%40pavolrusnak?source=post_page---byline--1eba8f60f2dd--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fee7d93e3e375&operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&user=Pavol+Rusnak&userId=ee7d93e3e375&source=post_page-ee7d93e3e375--byline--1eba8f60f2dd---------------------post_header-----------)

Published in[Trezor Blog](https://blog.trezor.io/?source=post_page---byline--1eba8f60f2dd--------------------------------)·4 min read·Jun 3, 2020

--

5

Listen

Share

![]()

This Wednesday we are releasing the firmware update 1.9.1 for Trezor One and 2.3.1 for Trezor Model T devices. Apart from some internal refactoring tasks, the main reason to deliver the updates is to fix a security vulnerability found by Saleem Rashid. The bug was reported via our responsible disclosure program and we thank Saleem for yet another great contribution.

# Possible large transaction fee via two Segwit transactions

## Introduction

For non-Segwit transactions, Trezor always requires the previous transaction to check the UTXO’s real balance. Why? An attacker could claim that the UTXO’s balance is lower than it actually is. As you might know, the difference between input and output amounts is considered as the transaction fee in the Bitcoin network. That means the user would pay a significantly larger fee without actually knowing it. That is why Trezor requires the previous transaction to check the real amount.

This is true for non-Segwit transactions and this check was in place from the very beginning. With the introduction of Segwit, the Bitcoin developers tried to simplify this. When signing a Segwit transaction a slightly different piece of data is being signed. This is defined in BIP-143 and one of the changes was that the amount of the UTXO is present in the signed data. This helps significantly; if the attacker lies about the UTXO’s amount, the signature is simply not valid in the Bitcoin network.

## Vulnerability

Saleem found a clever way to circumvent this. Consider this scenario:

1. The victim has two SegWit/BIP-143 UTXOs of 15 BTC and 20 BTC.
2. The malware asks the user to confirm a transaction with input 1 as 15 BTC and input 2 as 5.00000001 BTC, with the user’s chosen outputs and a valid change output, if necessary.
3. The user confirms the transaction, spending 20 BTC plus 0.00000001 BTC fee.
4. The malware throws an error and tells the user to confirm the transaction again (e.g. “Uh, oh! Something went wrong. Please try again.”).
5. The malware asks the user to confirm a transaction with input 1 as 0.00000001 BTC and input 2 as 20 BTC, with exactly the same outputs as before.
6. The user sees an apparently identical transaction, and again confirms spending 20 BTC plus 0.00000001 BTC fee.
7. The malware uses the signature of input 1 from the first transaction, and the signature of input 2 from the second transaction, creating a transaction that in fact spends 15 BTC from input 1 **and** 20 BTC from input 2.
8. The user ends up paying a transaction fee of just over 15 BTC.

> **Note that this vulnerability is inherent in the design of** [**BIP-143**](https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki) and it is even hinted at in the Taproot proposal described in [BIP-341](https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki#cite_note-17) (Rationale, [note 17](https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki#cite_note-17)). **This flaw affects all hardware wallet vendors**, some of which requested 90 days to implement the solution. That is why it took us longer than usual to release this fix because we respect the rules of coordinated disclosure.

## Fix

The fix is straightforward — we need to deal with Segwit transactions in the very same manner as we do with non-Segwit transactions. That means we need to require and validate the previous transactions’ UTXO amounts. That is exactly what we are introducing in firmware versions 2.3.1 and 1.9.1.

# Third parties

Unfortunately, some third-party tools do not allow hardware wallets to obtain the previous transaction in case of SegWit inputs, which is why Trezor will not be able to sign transactions using these tools until they are updated to work correctly. Due to the responsible disclosure process, we were not able to inform the maintainers beforehand.

## Web-based applications

Applications using Trezor Connect version 8 will continue to work seamlessly.

If you encounter problems in your favorite Trezor-enabled web application, please let the developers know that they should upgrade to Connect v8.

## Electrum

We are providing a patch for Electrum as a pull [request #6198](https://github.com/spesmilo/electrum/pull/6198). It will be impossible to use Electrum with Trezor 1.9.1 and 2.3.1 until this patch is released.

## PSBT-based tools

This section is of concern to users of HWI, BTCPay Server, and Wasabi wallet, as all these tools are internally using the BIP-174 PSBT format.

The PSBT format allows specifying either the full previous transaction or just the previous output. The latter is recommended for SegWit inputs. In order to fix the security issue, it is necessary to ignore this recommendation and supply full previous transactions in all cases.

A bug in HWI [(issue #338](https://github.com/bitcoin-core/HWI/issues/338)) must be fixed to properly submit the previous transaction to Trezor. Afterwards, modifications to BTCPay Server ([issue #1631](https://github.com/btcpayserver/btcpayserver/issues/1631)) and Wasabi ([issue #3734](https://github.com/zkSNACKs/WalletWasabi/issues/3734)) will be necessary.

# Timeline

* 2020–03–03 — issue reported by Saleem Rashid, coordination with other vendors is required
* 2020–06–03 — firmware update 1.9.1 for Trezor One released
* 2020–06–03 — firmware update 2.3.1 for Trezor Model T released
# About Us

*Created by SatoshiLabs in 2014, the Trezor One is the original and most trusted hardware wallet in the world. It offers unmatched security for cryptocurrencies, password management, and serves as the second factor in Two-Factor Authentication. These features combine with an interface that is easy to use whether you are a security expert or a brand new user.*

*Trezor Model T is the next-generation hardware wallet, designed with the benefits of the original Trezor in mind, combined with a modern and intuitive interface for improved user experience and security. It features a touchscreen, faster processor, and advanced coin support, as well as all the features of the Trezor One.*

[![]()](https://shop.trezor.io)[Dev Corner](https://medium.com/tag/dev-corner?source=post_page-----1eba8f60f2dd--------------------------------)[Bitcoin](https://medium.com/tag/bitcoin?source=post_page-----1eba8f60f2dd--------------------------------)[Security](https://medium.com/tag/security?source=post_page-----1eba8f60f2dd--------------------------------)[Updates](https://medium.com/tag/updates?source=post_page-----1eba8f60f2dd--------------------------------)[Trezor](https://medium.com/tag/trezor?source=post_page-----1eba8f60f2dd--------------------------------)

--

--

5

[![Trezor Blog](https://miro.medium.com/v2/resize:fill:96:96/1*Sek00YxqMdOJp5FsjveZiQ.png)](https://blog.trezor.io/?source=post_page---post_publication_info--1eba8f60f2dd--------------------------------)[![Trezor Blog](https://miro.medium.com/v2/resize:fill:128:128/1*Sek00YxqMdOJp5FsjveZiQ.png)](https://blog.trezor.io/?source=post_page---post_publication_info--1eba8f60f2dd--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftrezor-security-blog&operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&collection=Trezor+Blog&collectionId=4b757f6fc8b0&source=post_page---post_publication_info--1eba8f60f2dd---------------------follow_profile-----------)[## Published in Trezor Blog](https://blog.trezor.io/?source=post_page---post_publication_info--1eba8f60f2dd--------------------------------)[19.1K Followers](/followers?source=post_page---post_publication_info--1eba8f60f2dd--------------------------------)·[Last published Jan 8, 2025](/best-practices-for-securing-your-wallet-backup-8f11e5838a48?source=post_page---post_publication_info--1eba8f60f2dd--------------------------------)

The official blog for Trezor, the world’s first hardware wallet. All you need to keep your digital assets safe.

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftrezor-security-blog&operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&collection=Trezor+Blog&collectionId=4b757f6fc8b0&source=post_page---post_publication_info--1eba8f60f2dd---------------------follow_profile-----------)[![Pavol Rusnak](https://miro.medium.com/v2/resize:fill:96:96/1*0d3CRyIEjq-BFoJjRt-JEw.png)](https://medium.com/%40pavolrusnak?source=post_page---post_author_info--1eba8f60f2dd--------------------------------)[![Pavol Rusnak](https://miro.medium.com/v2/resize:fill:128:128/1*0d3CRyIEjq-BFoJjRt-JEw.png)](https://medium.com/%40pavolrusnak?source=post_page---post_author_info--1eba8f60f2dd--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fee7d93e3e375&operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&user=Pavol+Rusnak&userId=ee7d93e3e375&source=post_page-ee7d93e3e375--post_author_info--1eba8f60f2dd---------------------follow_profile-----------)[## Written by Pavol Rusnak](https://medium.com/%40pavolrusnak?source=post_page---post_author_info--1eba8f60f2dd--------------------------------)[120 Followers](https://medium.com/%40pavolrusnak/followers?source=post_page---post_author_info--1eba8f60f2dd--------------------------------)·[4 Following](https://medium.com/%40pavolrusnak/following?source=post_page---post_author_info--1eba8f60f2dd--------------------------------)

✊ Strengthening individual power and independence • Co-Founder @SatoshiLabs = { @Trezor , @TropicSquare , @Vexl , @Invity\_io } • #Cypherpunk #FOSS #AI #Bitcoin

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fee7d93e3e375&operation=register&redirect=https%3A%2F%2Fblog.trezor.io%2Fdetails-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd&user=Pavol+Rusnak&userId=ee7d93e3e375&source=post_page-ee7d93e3e375--post_author_info--1eba8f60f2dd---------------------follow_profile-----------)
## Responses (5)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----1eba8f60f2dd--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----1eba8f60f2dd--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----1eba8f60f2dd--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----1eba8f60f2dd--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----1eba8f60f2dd--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----1eba8f60f2dd--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1eba8f60f2dd--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1eba8f60f2dd--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----1eba8f60f2dd--------------------------------)[Teams](https://medium.com/business?source=post_page-----1eba8f60f2dd--------------------------------)


