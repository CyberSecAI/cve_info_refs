=== Content from github.com_e6754cae_20250119_115252.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fblob%2F627bbb0fae81ac34c60b43f0867eadcf8e1bc523%2Fincludes%2Fcore%2Fclass-files.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fblob%2F627bbb0fae81ac34c60b43f0867eadcf8e1bc523%2Fincludes%2Fcore%2Fclass-files.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ultimatemember%2Fultimatemember)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ultimatemember](/ultimatemember)
/
**[ultimatemember](/ultimatemember/ultimatemember)**
Public

* [Notifications](/login?return_to=%2Fultimatemember%2Fultimatemember) You must be signed in to change notification settings
* [Fork
  185](/login?return_to=%2Fultimatemember%2Fultimatemember)
* [Star
   252](/login?return_to=%2Fultimatemember%2Fultimatemember)

* [Code](/ultimatemember/ultimatemember)
* [Issues
  204](/ultimatemember/ultimatemember/issues)
* [Pull requests
  27](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects
  0](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

Additional navigation options

* [Code](/ultimatemember/ultimatemember)
* [Issues](/ultimatemember/ultimatemember/issues)
* [Pull requests](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

## Files

 627bbb0
## Breadcrumbs

1. [ultimatemember](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523)
2. /[includes](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes)
3. /[core](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core)
/
# class-files.php

Copy path Blame  Blame
## Latest commit

## History

[History](/ultimatemember/ultimatemember/commits/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core/class-files.php)1236 lines (986 loc) · 29.8 KB 627bbb0
## Breadcrumbs

1. [ultimatemember](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523)
2. /[includes](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes)
3. /[core](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core)
/
# class-files.php

Top
## File metadata and controls

* Code
* Blame

1236 lines (986 loc) · 29.8 KB[Raw](https://github.com/ultimatemember/ultimatemember/raw/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core/class-files.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?phpnamespace um\core;
// Exit if accessed directlyif ( ! defined( 'ABSPATH' ) ) exit;
if ( ! class\_exists( 'um\core\Files' ) ) {
 /\*\* \* Class Files \* @package um\core \*/ class Files {
 /\*\* \* @var \*/ var $upload\_temp;
 /\*\* \* @var \*/ var $upload\_baseurl;
 /\*\* \* @var \*/ var $upload\_basedir;
 /\*\* \* Files constructor. \*/ function \_\_construct() {
 $this->setup\_paths();
 add\_action( 'template\_redirect', array( &$this, 'download\_routing' ) );
 $this->fonticon = array( 'pdf' => array('icon' => 'um-faicon-file-pdf-o', 'color' => '#D24D4D' ), 'txt' => array('icon' => 'um-faicon-file-text-o' ), 'csv' => array('icon' => 'um-faicon-file-text-o' ), 'doc' => array('icon' => 'um-faicon-file-text-o', 'color' => '#2C95D5' ), 'docx' => array('icon' => 'um-faicon-file-text-o', 'color' => '#2C95D5' ), 'odt' => array('icon' => 'um-faicon-file-text-o', 'color' => '#2C95D5' ), 'ods' => array('icon' => 'um-faicon-file-excel-o', 'color' => '#51BA6A' ), 'xls' => array('icon' => 'um-faicon-file-excel-o', 'color' => '#51BA6A' ), 'xlsx' => array('icon' => 'um-faicon-file-excel-o', 'color' => '#51BA6A' ), 'zip' => array('icon' => 'um-faicon-file-zip-o' ), 'rar' => array('icon' => 'um-faicon-file-zip-o' ), 'mp3' => array('icon' => 'um-faicon-file-audio-o' ), 'jpg' => array('icon' => 'um-faicon-picture-o' ), 'jpeg' => array('icon' => 'um-faicon-picture-o' ), 'png' => array('icon' => 'um-icon-image' ), 'gif' => array('icon' => 'um-icon-images' ), 'eps' => array('icon' => 'um-icon-images' ), 'psd' => array('icon' => 'um-icon-images' ), 'tif' => array('icon' => 'um-icon-image' ), 'tiff' => array('icon' => 'um-icon-image' ), );
 $this->default\_file\_fonticon = 'um-faicon-file-o'; }
 /\*\* \* File download link generate \* \* @param int $form\_id \* @param string $field\_key \* @param int $user\_id \* \* @return string \*/ function get\_download\_link( $form\_id, $field\_key, $user\_id ) { $field\_key = urlencode( $field\_key );
 if ( UM()->is\_permalinks ) { $url = get\_home\_url( get\_current\_blog\_id() ); $nonce = wp\_create\_nonce( $user\_id . $form\_id . 'um-download-nonce' ); $url = $url . "/um-download/{$form\_id}/{$field\_key}/{$user\_id}/{$nonce}"; } else { $url = get\_home\_url( get\_current\_blog\_id() ); $nonce = wp\_create\_nonce( $user\_id . $form\_id . 'um-download-nonce' ); $url = add\_query\_arg( array( 'um\_action' => 'download', 'um\_form' => $form\_id, 'um\_field' => $field\_key, 'um\_user' => $user\_id, 'um\_verify' => $nonce ), $url ); }
 //add time to query args for sites with the cache return add\_query\_arg( array( 't' => time() ), $url ); }
 /\*\* \* @return bool \*/ function download\_routing() { if ( 'download' !== get\_query\_var( 'um\_action' ) ) { return false; }
 $query\_form = get\_query\_var( 'um\_form' ); if ( empty( $query\_form ) ) { return false; }
 $form\_id = get\_query\_var( 'um\_form' ); $query\_field = get\_query\_var( 'um\_field' ); if ( empty( $query\_field ) ) { return false; } $field\_key = urldecode( get\_query\_var( 'um\_field' ) ); $query\_user = get\_query\_var( 'um\_user' ); if ( empty( $query\_user ) ) { return false; }
 $user\_id = get\_query\_var( 'um\_user' ); $user = get\_userdata( $user\_id );
 if ( empty( $user ) || is\_wp\_error( $user ) ) { return false; } $query\_verify = get\_query\_var( 'um\_verify' ); if ( empty( $query\_verify ) || ! wp\_verify\_nonce( $query\_verify, $user\_id . $form\_id . 'um-download-nonce' ) ) { return false; }
 um\_fetch\_user( $user\_id ); $field\_data = get\_post\_meta( $form\_id, '\_um\_custom\_fields', true ); if ( empty( $field\_data[ $field\_key ] ) ) { return false; }
 if ( ! um\_can\_view\_field( $field\_data[ $field\_key ] ) ) { return false; }
 $field\_value = UM()->fields()->field\_value( $field\_key ); if ( empty( $field\_value ) ) { return false; }
 $download\_type = $field\_data[ $field\_key ]['type']; if ( $download\_type === 'file' ) { $this->file\_download( $user\_id, $field\_key, $field\_value ); } else { $this->image\_download( $user\_id, $field\_key, $field\_value ); }
 return false; }
 /\*\* \* @param $user\_id \* @param $field\_key \* @param $field\_value \*/ function image\_download( $user\_id, $field\_key, $field\_value ) { $file\_path = UM()->uploader()->get\_upload\_base\_dir() . $user\_id . DIRECTORY\_SEPARATOR . $field\_value; if ( ! file\_exists( $file\_path ) ) { if ( is\_multisite() ) { //multisite fix for old customers $file\_path = str\_replace( DIRECTORY\_SEPARATOR . 'sites' . DIRECTORY\_SEPARATOR . get\_current\_blog\_id() . DIRECTORY\_SEPARATOR, DIRECTORY\_SEPARATOR, $file\_path ); } }
 //validate traversal file if ( validate\_file( $file\_path ) === 1 ) { return; }
 $file\_info = get\_user\_meta( $user\_id, $field\_key . "\_metadata", true );
 $pathinfo = pathinfo( $file\_path ); $size = filesize( $file\_path ); $originalname = ! empty( $file\_info['original\_name'] ) ? $file\_info['original\_name'] : $pathinfo['basename']; $type = ! empty( $file\_info['type'] ) ? $file\_info['type'] : $pathinfo['extension'];
 header('Content-Description: File Transfer'); header('Content-Type: ' . $type ); header('Content-Disposition: inline; filename="' . $originalname . '"'); header('Content-Transfer-Encoding: binary'); header('Expires: 0'); header('Cache-Control: must-revalidate, post-check=0, pre-check=0'); header('Pragma: public'); header('Content-Length: ' . $size);
 $levels = ob\_get\_level(); for ( $i = 0; $i < $levels; $i++ ) { @ob\_end\_clean(); }
 readfile( $file\_path ); exit; }
 /\*\* \* @param $user\_id \* @param $field\_key \* @param $field\_value \*/ function file\_download( $user\_id, $field\_key, $field\_value ) { $file\_path = UM()->uploader()->get\_upload\_base\_dir() . $user\_id . DIRECTORY\_SEPARATOR . $field\_value; if ( ! file\_exists( $file\_path ) ) { if ( is\_multisite() ) { //multisite fix for old customers $file\_path = str\_replace( DIRECTORY\_SEPARATOR . 'sites' . DIRECTORY\_SEPARATOR . get\_current\_blog\_id() . DIRECTORY\_SEPARATOR, DIRECTORY\_SEPARATOR, $file\_path ); } }
 //validate traversal file if ( validate\_file( $file\_path ) === 1 ) { return; }
 $file\_info = get\_user\_meta( $user\_id, $field\_key . "\_metadata", true );
 $pathinfo = pathinfo( $file\_path ); $size = filesize( $file\_path ); $originalname = ! empty( $file\_info['original\_name'] ) ? $file\_info['original\_name'] : $pathinfo['basename']; $type = ! empty( $file\_info['type'] ) ? $file\_info['type'] : $pathinfo['extension'];
 header('Content-Description: File Transfer'); header('Content-Type: ' . $type ); header('Content-Disposition: attachment; filename="' . $originalname . '"'); header('Content-Transfer-Encoding: binary'); header('Expires: 0'); header('Cache-Control: must-revalidate, post-check=0, pre-check=0'); header('Pragma: public'); header('Content-Length: ' . $size);
 $levels = ob\_get\_level(); for ( $i = 0; $i < $levels; $i++ ) { @ob\_end\_clean(); }
 readfile( $file\_path ); exit; }
 /\*\* \* Remove file by AJAX \*/ function ajax\_remove\_file() { UM()->check\_ajax\_nonce();
 /\*\* \* @var $src \*/ extract( $\_REQUEST ); $this->delete\_file( $src );
 wp\_send\_json\_success(); }
 /\*\* \* Resize image AJAX handler \*/ function ajax\_resize\_image() { UM()->check\_ajax\_nonce();
 /\*\* \* @var $key \* @var $src \* @var $coord \* @var $user\_id \*/ extract( $\_REQUEST );
 if ( ! isset( $src ) || ! isset( $coord ) ) { wp\_send\_json\_error( esc\_js( \_\_( 'Invalid parameters', 'ultimate-member' ) ) ); }
 $coord\_n = substr\_count( $coord, "," ); if ( $coord\_n != 3 ) { wp\_send\_json\_error( esc\_js( \_\_( 'Invalid coordinates', 'ultimate-member' ) ) ); }
 $user\_id = empty( $\_REQUEST['user\_id'] ) ? get\_current\_user\_id() : $\_REQUEST['user\_id']; $image\_path = um\_is\_file\_owner( $src, $user\_id, true ); if ( ! $image\_path ) { wp\_send\_json\_error( esc\_js( \_\_( 'Invalid file ownership', 'ultimate-member' ) ) ); }
 UM()->uploader()->replace\_upload\_dir = true; $output = UM()->uploader()->resize\_image( $image\_path, $src, $key, $user\_id, $coord ); UM()->uploader()->replace\_upload\_dir = false;
 delete\_option( "um\_cache\_userdata\_{$user\_id}" );
 wp\_send\_json\_success( $output ); }
 /\*\* \* Image upload by AJAX \* \* @throws \Exception \*/ function ajax\_image\_upload() { $ret['error'] = null; $ret = array();
 $id = $\_POST['key']; $timestamp = $\_POST['timestamp']; $nonce = $\_POST['\_wpnonce']; $user\_id = empty( $\_POST['user\_id'] ) ? get\_current\_user\_id() : $\_POST['user\_id'];
 UM()->fields()->set\_id = $\_POST['set\_id']; UM()->fields()->set\_mode = $\_POST['set\_mode'];
 /\*\* \* UM hook \* \* @type filter \* @title um\_image\_upload\_nonce \* @description Change Image Upload nonce \* @input\_vars \* [{"var":"$nonce","type":"bool","desc":"Nonce"}] \* @change\_log \* ["Since: 2.0"] \* @usage \* <?php add\_filter( 'um\_image\_upload\_nonce', 'function\_name', 10, 1 ); ?> \* @example \* <?php \* add\_filter( 'um\_image\_upload\_nonce', 'my\_image\_upload\_nonce', 10, 1 ); \* function my\_image\_upload\_nonce( $nonce ) { \* // your code here \* return $nonce; \* } \* ?> \*/ $um\_image\_upload\_nonce = apply\_filters( 'um\_image\_upload\_nonce', true );
 if ( $um\_image\_upload\_nonce ) { if ( ! wp\_verify\_nonce( $nonce, "um\_upload\_nonce-{$timestamp}" ) && is\_user\_logged\_in() ) { // This nonce is not valid. $ret['error'] = \_\_( 'Invalid nonce', 'ultimate-member' ); wp\_send\_json\_error( $ret ); } }
 if ( isset( $\_FILES[ $id ]['name'] ) ) {
 if ( ! is\_array( $\_FILES[ $id ]['name'] ) ) {
 UM()->uploader()->replace\_upload\_dir = true; $uploaded = UM()->uploader()->upload\_image( $\_FILES[ $id ], $user\_id, $id ); UM()->uploader()->replace\_upload\_dir = false; if ( isset( $uploaded['error'] ) ) { $ret['error'] = $uploaded['error']; } else { $ret[] = $uploaded['handle\_upload']; }
 }
 } else { $ret['error'] = \_\_( 'A theme or plugin compatibility issue', 'ultimate-member' ); } wp\_send\_json\_success( $ret ); }
 /\*\* \* File upload by AJAX \*/ function ajax\_file\_upload() { $ret['error'] = null; $ret = array();
 /\* commented for enable download files on registration form \* if ( ! is\_user\_logged\_in() ) { $ret['error'] = 'Invalid user'; die( json\_encode( $ret ) ); }\*/
 $nonce = $\_POST['\_wpnonce']; $id = $\_POST['key']; $timestamp = $\_POST['timestamp'];
 UM()->fields()->set\_id = $\_POST['set\_id']; UM()->fields()->set\_mode = $\_POST['set\_mode'];
 /\*\* \* UM hook \* \* @type filter \* @title um\_file\_upload\_nonce \* @description Change File Upload nonce \* @input\_vars \* [{"var":"$nonce","type":"bool","desc":"Nonce"}] \* @change\_log \* ["Since: 2.0"] \* @usage \* <?php add\_filter( 'um\_file\_upload\_nonce', 'function\_name', 10, 1 ); ?> \* @example \* <?php \* add\_filter( 'um\_file\_upload\_nonce', 'my\_file\_upload\_nonce', 10, 1 ); \* function my\_file\_upload\_nonce( $nonce ) { \* // your code here \* return $nonce; \* } \* ?> \*/ $um\_file\_upload\_nonce = apply\_filters("um\_file\_upload\_nonce", true );
 if ( $um\_file\_upload\_nonce ) { if ( ! wp\_verify\_nonce( $nonce, 'um\_upload\_nonce-'.$timestamp ) && is\_user\_logged\_in() ) { // This nonce is not valid. $ret['error'] = 'Invalid nonce'; wp\_send\_json\_error( $ret );
 } }
 if( isset( $\_FILES[ $id ]['name'] ) ) {
 if ( ! is\_array( $\_FILES[ $id ]['name'] ) ) {
 $user\_id = $\_POST['user\_id'];
 UM()->uploader()->replace\_upload\_dir = true; $uploaded = UM()->uploader()->upload\_file( $\_FILES[ $id ], $user\_id, $id ); UM()->uploader()->replace\_upload\_dir = false; if ( isset( $uploaded['error'] ) ){
 $ret['error'] = $uploaded['error'];
 } else {
 $uploaded\_file = $uploaded['handle\_upload']; $ret['url'] = $uploaded\_file['file\_info']['name']; $ret['icon'] = UM()->files()->get\_fonticon\_by\_ext( $uploaded\_file['file\_info']['ext'] ); $ret['icon\_bg'] = UM()->files()->get\_fonticon\_bg\_by\_ext( $uploaded\_file['file\_info']['ext'] ); $ret['filename'] = $uploaded\_file['file\_info']['basename']; $ret['original\_name'] = $uploaded\_file['file\_info']['original\_name'];
 }
 }
 } else { $ret['error'] = \_\_('A theme or plugin compatibility issue','ultimate-member'); }
 wp\_send\_json\_success( $ret ); }
 /\*\* \* Allowed image types \* \* @return array \*/ function allowed\_image\_types() { /\*\* \* UM hook \* \* @type filter \* @title um\_allowed\_image\_types \* @description Extend allowed image types \* @input\_vars \* [{"var":"$types","type":"array","desc":"Image ext types"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_allowed\_image\_types', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_allowed\_image\_types', 'my\_allowed\_image\_types', 10, 1 ); \* function my\_allowed\_image\_types( $types ) { \* // your code here \* return $types; \* } \* ?> \*/ return apply\_filters( 'um\_allowed\_image\_types', array( 'png' => 'PNG', 'jpeg' => 'JPEG', 'jpg' => 'JPG', 'gif' => 'GIF' ) ); }
 /\*\* \* Allowed file types \* \* @return mixed \*/ function allowed\_file\_types() { /\*\* \* UM hook \* \* @type filter \* @title um\_allowed\_file\_types \* @description Extend allowed File types \* @input\_vars \* [{"var":"$types","type":"array","desc":"Files ext types"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_allowed\_file\_types', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_allowed\_file\_types', 'my\_allowed\_file\_types', 10, 1 ); \* function my\_allowed\_file\_types( $types ) { \* // your code here \* return $types; \* } \* ?> \*/ return apply\_filters( 'um\_allowed\_file\_types', array( 'pdf' => 'PDF', 'txt' => 'Text', 'csv' => 'CSV', 'doc' => 'DOC', 'docx' => 'DOCX', 'odt' => 'ODT', 'ods' => 'ODS', 'xls' => 'XLS', 'xlsx' => 'XLSX', 'zip' => 'ZIP', 'rar' => 'RAR', 'mp3' => 'MP3', 'jpg' => 'JPG', 'jpeg' => 'JPEG', 'png' => 'PNG', 'gif' => 'GIF', 'eps' => 'EPS', 'psd' => 'PSD', 'tif' => 'TIF', 'tiff' => 'TIFF', ) ); }
 /\*\* \* Get extension icon \* \* @param $extension \* \* @return string \*/ function get\_fonticon\_by\_ext( $extension ) { if ( isset( $this->fonticon[$extension]['icon'] ) ) { return $this->fonticon[$extension]['icon']; } else { return $this->default\_file\_fonticon; } }
 /\*\* \* Get extension icon background \* \* @param $extension \* \* @return string \*/ function get\_fonticon\_bg\_by\_ext( $extension ) { if ( isset( $this->fonticon[$extension]['color'] ) ) { return $this->fonticon[$extension]['color']; } else { return '#666'; } }
 /\*\* \* Setup upload directory \*/ function setup\_paths() {
 $this->upload\_dir = wp\_upload\_dir();
 $this->upload\_basedir = $this->upload\_dir['basedir'] . '/ultimatemember/'; $this->upload\_baseurl = $this->upload\_dir['baseurl'] . '/ultimatemember/';
 /\*\* \* UM hook \* \* @type filter \* @title um\_upload\_basedir\_filter \* @description Change Uploads Basedir \* @input\_vars \* [{"var":"$basedir","type":"string","desc":"Uploads basedir"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_upload\_basedir\_filter', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_upload\_basedir\_filter', 'my\_upload\_basedir', 10, 1 ); \* function my\_upload\_basedir( $basedir ) { \* // your code here \* return $basedir; \* } \* ?> \*/ $this->upload\_basedir = apply\_filters( 'um\_upload\_basedir\_filter', $this->upload\_basedir ); /\*\* \* UM hook \* \* @type filter \* @title um\_upload\_baseurl\_filter \* @description Change Uploads Base URL \* @input\_vars \* [{"var":"$baseurl","type":"string","desc":"Uploads base URL"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_upload\_baseurl\_filter', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_upload\_baseurl\_filter', 'my\_upload\_baseurl', 10, 1 ); \* function my\_upload\_baseurl( $baseurl ) { \* // your code here \* return $baseurl; \* } \* ?> \*/ $this->upload\_baseurl = apply\_filters( 'um\_upload\_baseurl\_filter', $this->upload\_baseurl );
 // @note : is\_ssl() doesn't work properly for some sites running with load balancers // Check the links for more info about this bug // https://codex.wordpress.org/Function\_Reference/is\_ssl // http://snippets.webaware.com.au/snippets/wordpress-is\_ssl-doesnt-work-behind-some-load-balancers/ if ( is\_ssl() || stripos( get\_option( 'siteurl' ), 'https://' ) !== false || ( isset( $\_SERVER['HTTP\_X\_FORWARDED\_PROTO'] ) && $\_SERVER['HTTP\_X\_FORWARDED\_PROTO'] == 'https' ) ) { $this->upload\_baseurl = str\_replace("http://", "https://", $this->upload\_baseurl); }
 $this->upload\_temp = $this->upload\_basedir . 'temp/'; $this->upload\_temp\_url = $this->upload\_baseurl . 'temp/';
 if ( ! file\_exists( $this->upload\_basedir ) ) { $old = umask(0); @mkdir( $this->upload\_basedir, 0755, true ); umask( $old ); }
 if ( ! file\_exists( $this->upload\_temp ) ) { $old = umask(0); @mkdir( $this->upload\_temp , 0755, true ); umask( $old ); }
 }
 /\*\* \* Generate unique temp directory \* \* @return mixed \*/ function unique\_dir(){ $unique\_number = UM()->validation()->generate(); $array['dir'] = $this->upload\_temp . $unique\_number . '/'; $array['url'] = $this->upload\_temp\_url . $unique\_number . '/'; return $array; }
 /\*\* \* Get path only without file name \* \* @param $file \* \* @return string \*/ function path\_only( $file ) {
 return trailingslashit( dirname( $file ) ); }
 /\*\* \* Fix image orientation \* \* @param $rotate \* @param $source \* \* @return resource \*/ function fix\_image\_orientation( $rotate, $source ) { if ( extension\_loaded('exif') ){ $exif = @exif\_read\_data( $source );
 if (isset($exif['Orientation'])) { switch ($exif['Orientation']) { case 3: $rotate = imagerotate($rotate, 180, 0); break;
 case 6: $rotate = imagerotate($rotate, -90, 0); break;
 case 8: $rotate = imagerotate($rotate, 90, 0); break; } } } return $rotate; }
 /\*\* \* Process an image \* \* @param $source \* @param $destination \* @param int $quality \* \* @return array \*/ function create\_and\_copy\_image($source, $destination, $quality = 100) {
 $info = @getimagesize($source);
 if ($info['mime'] == 'image/jpeg'){
 $image = imagecreatefromjpeg( $source );
 } else if ($info['mime'] == 'image/gif'){
 $image = imagecreatefromgif( $source );
 } else if ($info['mime'] == 'image/png'){
 $image = imagecreatefrompng( $source ); imagealphablending( $image, false ); imagesavealpha( $image, true );
 }
 list($w, $h) = @getimagesize( $source ); if ( $w > UM()->options()->get('image\_max\_width') ) {
 $ratio = round( $w / $h, 2 ); $new\_w = UM()->options()->get('image\_max\_width'); $new\_h = round( $new\_w / $ratio, 2 );
 if ( $info['mime'] == 'image/jpeg' || $info['mime'] == 'image/gif' ){
 $image\_p = imagecreatetruecolor( $new\_w, $new\_h ); imagecopyresampled( $image\_p, $image, 0, 0, 0, 0, $new\_w, $new\_h, $w, $h ); $image\_p = $this->fix\_image\_orientation( $image\_p, $source );
 }else if( $info['mime'] == 'image/png' ){
 $srcImage = $image; $targetImage = imagecreatetruecolor( $new\_w, $new\_h ); imagealphablending( $targetImage, false ); imagesavealpha( $targetImage, true ); imagecopyresampled( $targetImage, $srcImage, 0, 0, 0, 0, $new\_w, $new\_h, $w, $h );
 }
 if ( $info['mime'] == 'image/jpeg' ){ $has\_copied = imagejpeg( $image\_p, $destination, $quality ); }else if ( $info['mime'] == 'image/gif' ){ $has\_copied = imagegif( $image\_p, $destination ); }else if ( $info['mime'] == 'image/png' ){ $has\_copied = imagepng( $targetImage, $destination, 0 ,PNG\_ALL\_FILTERS); }
 $info['um\_has\_max\_width'] = 'custom'; $info['um\_has\_copied'] = $has\_copied ? 'yes':'no';
 } else {
 $image = $this->fix\_image\_orientation( $image, $source );
 if ( $info['mime'] == 'image/jpeg' ){ $has\_copied = imagejpeg( $image, $destination, $quality ); }else if ( $info['mime'] == 'image/gif' ){ $has\_copied = imagegif( $image, $destination ); }else if ( $info['mime'] == 'image/png' ){ $has\_copied = imagepng( $image , $destination , 0 ,PNG\_ALL\_FILTERS); }
 $info['um\_has\_max\_width'] = 'default'; $info['um\_has\_copied'] = $has\_copied ? 'yes':'no'; }
 return $info; }
 /\*\* \* Process a file \* \* @param $source \* @param $destination \*/ function upload\_temp\_file( $source, $destination ) {
 move\_uploaded\_file( $source, $destination ); }
 /\*\* \* Process a temp upload \* \* @param $source \* @param $destination \* @param int $quality \* \* @return string \*/ function new\_image\_upload\_temp( $source, $destination, $quality = 100 ){
 $unique\_dir = $this->unique\_dir();
 $this->make\_dir( $unique\_dir['dir'] );
 $info = $this->create\_and\_copy\_image( $source, $unique\_dir['dir'] . $destination, $quality );
 $url = $unique\_dir['url'] . $destination ;
 return $url;
 }
 /\*\* \* Process a temp upload for files \* \* @param $source \* @param $destination \* \* @return string \*/ function new\_file\_upload\_temp( $source, $destination ){
 $unique\_dir = $this->unique\_dir();
 $this->make\_dir( $unique\_dir['dir'] );
 $this->upload\_temp\_file( $source, $unique\_dir['dir'] . $destination );
 $url = $unique\_dir['url'] . $destination;
 return $url;
 }
 /\*\* \* Make a Folder \* \* @param $dir \*/ function make\_dir( $dir ) { $old = umask(0); @mkdir( $dir, 0755, true); umask( $old ); }
 /\*\* \* Get extension by mime type \* \* @param $mime \* \* @return mixed \*/ function get\_extension\_by\_mime\_type( $mime ) { $split = explode('/', $mime ); return $split[1]; }
 /\*\* \* Get file data \* \* @param $file \* \* @return mixed \*/ function get\_file\_data( $file ) { $array['size'] = filesize( $file ); return $array; }
 /\*\* \* Get image data \* \* @param $file \* \* @return mixed \*/ function get\_image\_data( $file ) {
 $finfo = finfo\_open( FILEINFO\_MIME\_TYPE );
 $mime\_type = finfo\_file( $finfo, $file );
 if( function\_exists('exif\_imagetype') ){
 $array\_exif\_image\_mimes = array( IMAGETYPE\_GIF, IMAGETYPE\_JPEG, IMAGETYPE\_PNG );
 $allowed\_types = apply\_filters('um\_image\_upload\_allowed\_exif\_mimes', $array\_exif\_image\_mimes );
 if( ! in\_array( @exif\_imagetype( $file ), $allowed\_types ) ) {
 $array['invalid\_image'] = true;
 return $array; }
 }else{
 $array\_image\_mimes = array('image/jpeg','image/png','image/gif');
 $allowed\_types = apply\_filters('um\_image\_upload\_allowed\_mimes', $array\_image\_mimes );
 if ( ! in\_array( $mime\_type, $allowed\_types ) ) {
 $array['invalid\_image'] = true;
 return $array; }
 }
 $array['size'] = filesize( $file );
 $image\_data = @getimagesize( $file );
 $array['image'] = $image\_data;
 $array['invalid\_image'] = false;
 list($width, $height, $type, $attr) = $image\_data;
 $array['width'] = $width;
 $array['height'] = $height;
 $array['ratio'] = $width / $height;
 $array['extension'] = $this->get\_extension\_by\_mime\_type( $mime\_type );
 return $array; }
 /\*\* \* If a value exists in comma seperated list \* \* @param $value \* @param $array \* \* @return bool \*/ function in\_array( $value, $array ) {
 if ( in\_array( $value, explode(',', $array ) ) ){ return true; }
 return false; }
 /\*\* \* This function will delete file upload from server \* \* @param $src \*/ function delete\_file( $src ) {
 if ( strstr( $src, '?' ) ) { $splitted = explode( '?', $src ); $src = $splitted[0]; }
 $is\_temp = um\_is\_temp\_upload( $src ); if ( $is\_temp ) { unlink( $is\_temp ); rmdir( dirname( $is\_temp ) ); } else { wp\_die( \_\_('Ultimate Member: Not a valid temp file','ultimate-member') ); } }[View remainder of file in raw view](https://github.com/ultimatemember/ultimatemember/raw/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core/class-files.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_271787d8_20250119_115254.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fcommit%2F249682559012734a4f7d71f52609b2f301ea55b1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fcommit%2F249682559012734a4f7d71f52609b2f301ea55b1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ultimatemember%2Fultimatemember)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ultimatemember](/ultimatemember)
/
**[ultimatemember](/ultimatemember/ultimatemember)**
Public

* [Notifications](/login?return_to=%2Fultimatemember%2Fultimatemember) You must be signed in to change notification settings
* [Fork
  185](/login?return_to=%2Fultimatemember%2Fultimatemember)
* [Star
   252](/login?return_to=%2Fultimatemember%2Fultimatemember)

* [Code](/ultimatemember/ultimatemember)
* [Issues
  204](/ultimatemember/ultimatemember/issues)
* [Pull requests
  27](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects
  0](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

Additional navigation options

* [Code](/ultimatemember/ultimatemember)
* [Issues](/ultimatemember/ultimatemember/issues)
* [Pull requests](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

## Commit

[Permalink](/ultimatemember/ultimatemember/commit/249682559012734a4f7d71f52609b2f301ea55b1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

- fixed vulnerability with uploading cover/profile photo for other us…

[Browse files](/ultimatemember/ultimatemember/tree/249682559012734a4f7d71f52609b2f301ea55b1)
Browse the repository at this point in the history

```
…er ID;

- re-written member directory meta queries;
- fixed search line additional slashes;
```

* Loading branch information

[![@nikitasinelnikov](https://avatars.githubusercontent.com/u/26598684?s=40&v=4)](/nikitasinelnikov)

[nikitasinelnikov](/ultimatemember/ultimatemember/commits?author=nikitasinelnikov "View all commits by nikitasinelnikov")
committed
Jan 8, 2020

1 parent
[f0e3bc9](/ultimatemember/ultimatemember/commit/f0e3bc9ef4fb74b9f9ab0e03c9cd3c2b1a360224)

commit 2496825

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**309 additions**
and
**489 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* includes

  + admin/core

    - includes/admin/core/class-admin-settings.php
      [class-admin-settings.php](#diff-2d5cbdd4d46a4674770249f757522b039878dbdd31d15a8d5da839909cc6c6e6)
  + core

    - includes/core/class-files.php
      [class-files.php](#diff-8bc2a4f02bf72858ef0e2b37e9db60fefc7076111a78006f4950c48436172c42)
    - includes/core/class-member-directory-meta.php
      [class-member-directory-meta.php](#diff-2438a7a6506b82e50c27c0e90843bc9a34445abd2b08c993f3029c56b3c36ae6)
    - includes/core/class-member-directory.php
      [class-member-directory.php](#diff-c4ce658fa6ad020dba5d9a2c6b5f7f469cbaa11dbd3dc32073b9056c8de5b96e)
* templates

  + templates/members.php
    [members.php](#diff-9dbbfcf6c5e32271ce3c127cee1067dee625060ff307ac449de34308716eccf3)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[includes/admin/core/class-admin-settings.php](#diff-2d5cbdd4d46a4674770249f757522b039878dbdd31d15a8d5da839909cc6c6e6 "includes/admin/core/class-admin-settings.php")

Show comments

[View file](/ultimatemember/ultimatemember/blob/249682559012734a4f7d71f52609b2f301ea55b1/includes/admin/core/class-admin-settings.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -120,6 +120,7 @@ function same\_page\_update\_ajax() { |
|  |  |  |
|  |  | //member directory data |
|  |  | $metakeys[] = 'um\_member\_directory\_data'; |
|  |  | $metakeys[] = '\_um\_verified'; |
|  |  |  |
|  |  | $skip\_fields = UM()->builtin()->get\_fields\_without\_metakey(); |
|  |  | $skip\_fields = array\_merge( $skip\_fields, UM()->member\_directory()->core\_search\_fields ); |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[includes/core/class-files.php](#diff-8bc2a4f02bf72858ef0e2b37e9db60fefc7076111a78006f4950c48436172c42 "includes/core/class-files.php")

Show comments

[View file](/ultimatemember/ultimatemember/blob/249682559012734a4f7d71f52609b2f301ea55b1/includes/core/class-files.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -287,6 +287,12 @@ function ajax\_resize\_image() { |
|  |  | } |
|  |  |  |
|  |  | $user\_id = empty( $\_REQUEST['user\_id'] ) ? get\_current\_user\_id() : $\_REQUEST['user\_id']; |
|  |  |  |
|  |  | if ( ! UM()->roles()->um\_current\_user\_can( 'edit', $user\_id ) ) { |
|  |  | $ret['error'] = esc\_js( \_\_( 'You haven\'t ability to edit this user', 'ultimate-member' ) ); |
|  |  | wp\_send\_json\_error( $ret ); |
|  |  | } |
|  |  |  |
|  |  | $image\_path = um\_is\_file\_owner( $src, $user\_id, true ); |
|  |  | if ( ! $image\_path ) { |
|  |  | wp\_send\_json\_error( esc\_js( \_\_( 'Invalid file ownership', 'ultimate-member' ) ) ); |
| Expand Down  Expand Up | | @@ -319,6 +325,11 @@ function ajax\_image\_upload() { |
|  |  | UM()->fields()->set\_id = $\_POST['set\_id']; |
|  |  | UM()->fields()->set\_mode = $\_POST['set\_mode']; |
|  |  |  |
|  |  | if ( ! UM()->roles()->um\_current\_user\_can( 'edit', $user\_id ) ) { |
|  |  | $ret['error'] = \_\_( 'You haven\'t ability to edit this user', 'ultimate-member' ); |
|  |  | wp\_send\_json\_error( $ret ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* UM hook |
|  |  | \* |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2496825`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fcommit%2F249682559012734a4f7d71f52609b2f301ea55b1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from wordpress.org_a39c40c1_20250119_115255.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction & Membership Plugin

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fultimate-member&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fultimate-member&locale=en_US)

Search plugins

![](https://ps.w.org/ultimate-member/assets/banner-772x250.png?rev=3160947)
![](https://ps.w.org/ultimate-member/assets/icon-256x256.png?rev=3160947)
# Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction & Membership Plugin

By [Ultimate Member](http://ultimatemember.com/)

[Download](https://downloads.wordpress.org/plugin/ultimate-member.2.9.2.zip)
[Live Preview](https://wordpress.org/plugins/ultimate-member/?preview=1)

* [Details](https://wordpress.org/plugins/ultimate-member/#description)
* [Reviews](https://wordpress.org/plugins/ultimate-member/#reviews)
* [Installation](https://wordpress.org/plugins/ultimate-member/#installation)
* [Development](https://wordpress.org/plugins/ultimate-member/#developers)

[Support](https://wordpress.org/support/plugin/ultimate-member/)

## Description

#### User Profile & Membership Plugin for WordPress

The ultimate user profile & membership plugin for WordPress. The plugin makes it a breeze for users to sign-up and become members of your website. The plugin allows you to add beautiful user profiles to your site and is designed for creating advanced online communities and membership sites. Lightweight and highly extendible, Ultimate Member will enable you to create almost any type of site where users can join and become members with absolute ease.

#### Features of the plugin include:

* Front-end user profiles
* Front-end user registration
* Front-end user login
* Custom form fields
* Conditional logic for form fields
* Drag and drop form builder
* User account page
* Custom user roles
* Member directories
* User emails
* Content restriction
* Conditional nav menus
* Show author posts & comments on user profiles
* Developer friendly with dozens of actions and filters

Read about all of the plugin’s features at [Ultimate Member](https://ultimatemember.com)

#### Paid Extensions

Ultimate Member has a range of extensions that allow you to extend the power of the plugin. You can purchase all of these extensions at a significant discount with our [All Access Pass](https://ultimatemember.com/pricing/) or you can purchase extensions individually.

* [Zapier](https://ultimatemember.com/extensions/zapier/) – Allow to integrate the Zapier popular apps with Ultimate Member
* [Stripe](https://ultimatemember.com/extensions/stripe/) – Sell paid memberships to access your website via Stripe subscriptions
* [User Notes](https://ultimatemember.com/extensions/user-notes/) – Allow users to create public and private notes from their profile
* [Profile Tabs](https://ultimatemember.com/extensions/profile-tabs/) – Allow to add the custom tabs to profiles
* [User Locations](https://ultimatemember.com/extensions/user-locations/) – Allow to display users on a map on the member directory page and allow users to add their location via their profile
* [Unsplash](https://ultimatemember.com/extensions/unsplash/) – Allow users to select a profile cover photo from [Unsplash](https://unsplash.com/) from their profile
* [User Bookmarks](https://ultimatemember.com/extensions/user-bookmarks/) – Allow users to bookmark content from your website
* [User Photos](https://ultimatemember.com/extensions/user-photos/) – Allow users to upload photos to their profile
* [Groups](https://ultimatemember.com/extensions/groups/) – Allow users to create and join groups around shared topics, interests etc.
* [Private Content](https://ultimatemember.com/extensions/private-content/) – Display private content to logged in users that only they can access
* [User Tags](https://ultimatemember.com/extensions/user-tags/) – Lets you add a user tag system to your website
* [Social Activity](https://ultimatemember.com/extensions/social-activity/) – Let users create public wall posts & see the activity of other users
* [WooCommerce](https://ultimatemember.com/extensions/woocommerce/) – Allow you to integrate WooCommerce with Ultimate Member
* [Private Messages](https://ultimatemember.com/extensions/private-messages/) – Add a private messaging system to your site & allow users to message each other
* [Followers](https://ultimatemember.com/extensions/followers/) – Allow users to follow each other on your site and protect their profile information
* [Real-time Notifications](https://ultimatemember.com/extensions/real-time-notifications/) – Add a notifications system to your site so users can receive real-time notifications
* [Social Login](https://ultimatemember.com/extensions/social-login/) – Let users register & login to your site via Facebook, Twitter, G+, LinkedIn, Instagram and Vkontakte (VK.com)
* [bbPress](https://ultimatemember.com/extensions/bbpress/) – With the bbPress extension you can beautifully integrate Ultimate Member with bbPress
* [MailChimp](https://ultimatemember.com/extensions/mailchimp/) – Allow users to subscribe to your MailChimp lists when they signup on your site and sync user meta to MailChimp
* [User Reviews](https://ultimatemember.com/extensions/user-reviews/) – Allow users to rate & review each other using a 5 star rate/review system
* [Verified Users](https://ultimatemember.com/extensions/verified-users/) – Add a user verification system to your site so user accounts can be verified
* [myCRED](https://ultimatemember.com/extensions/mycred/) – With the myCRED extension you can integrate Ultimate Member with the popular myCRED points management plugin
* [Notices](https://ultimatemember.com/extensions/notices/) – Alert users to important information using conditional notices
* [Profile Completeness](https://ultimatemember.com/extensions/profile-completeness/) – Encourage or force users to complete their profiles with the profile completeness extension
* [Friends](https://ultimatemember.com/extensions/friends/) – Allows users to become friends by sending & accepting/rejecting friend requests

#### Free Extensions

* [JobsBoardWP](https://ultimatemember.com/extensions/jobboardwp/) – This free extension integrates Ultimate Member with the job board plugin [JobBoardWP](https://wordpress.org/plugins/jobboardwp).
* [ForumWP](https://ultimatemember.com/extensions/forumwp/) – This free extension integrates Ultimate Member with the forum plugin [ForumWP](https://forumwpplugin.com).
* [Terms & Conditions](https://ultimatemember.com/extensions/terms-conditions/) – Add a terms and condition checkbox to your registration forms & require users to agree to your T&Cs before registering on your site.
* [Google reCAPTCHA](https://ultimatemember.com/extensions/google-recaptcha/) – Stop bots on your registration & login forms with Google reCAPTCHA
* [Online Users](https://ultimatemember.com/extensions/online-users/) – Display what users are online with this extension

#### Theme

Our official [theme](https://ultimatemember.com/theme/) is purpose built for websites that have logged in and out users. The [theme](https://ultimatemember.com/theme/) has deep integration with Ultimate Member plugin and the extensions, different header designs for logged-in/out users and works alongside the Beaver Builder and Elementor page builders.

#### Our other plugins

In addition to Ultimate Member, we also have two other plugins: [ForumWP](https://forumwpplugin.com/) and [JobBoardWP](https://wordpress.org/plugins/jobboardwp).

#### ForumWP

[ForumWP](https://forumwpplugin.com/) is a forum plugin which adds an online forum to your website, allowing users to create topics and write replies. Forums are a great way to build and grow an online community.

#### JobBoardWP

[JobBoardWP](https://wordpress.org/plugins/jobboardwp) is a job board plugin which adds a modern job board to your website. Display job listings and allow employers to submit and manage jobs all from the front-end.

#### Development \* Translations

If you’re a developer and would like to contribute to the source code of the plugin you can do so via our [GitHub Repository](https://github.com/ultimatemember/ultimatemember).

Want to add a new language to Ultimate Member? Great! You can contribute via [translate.wordpress.org](https://translate.wordpress.org/projects/wp-plugins/ultimate-member).

If you are a developer and you need to know the list of UM Hooks, make this via our [Hooks Documentation](https://docs.ultimatemember.com/article/1324-hooks-list) or [Hooks Documentation v2](https://ultimatemember.github.io/ultimatemember/hooks/).

If you are a developer and you need to know the structure of our code, make this via our [Documentation API](https://ultimatemember.github.io/ultimatemember/phpdoc/).

#### Documentation & Support

Got a problem or need help with Ultimate Member? Head over to our [documentation](http://docs.ultimatemember.com/) and perform a search of the knowledge base. If you can’t find a solution to your issue then you can create a topic on the [support forum](https://wordpress.org/support/plugin/ultimate-member).

## Screenshots

* [![](https://ps.w.org/ultimate-member/assets/screenshot-1.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-1.png?rev=3160947)

  Screenshot 1
* [![](https://ps.w.org/ultimate-member/assets/screenshot-2.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-2.png?rev=3160947)

  Screenshot 2
* [![](https://ps.w.org/ultimate-member/assets/screenshot-3.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-3.png?rev=3160947)

  Screenshot 3
* [![](https://ps.w.org/ultimate-member/assets/screenshot-4.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-4.png?rev=3160947)

  Screenshot 4
* [![](https://ps.w.org/ultimate-member/assets/screenshot-5.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-5.png?rev=3160947)

  Screenshot 5
* [![](https://ps.w.org/ultimate-member/assets/screenshot-6.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-6.png?rev=3160947)

  Screenshot 6
* [![](https://ps.w.org/ultimate-member/assets/screenshot-7.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-7.png?rev=3160947)

  Screenshot 7
* [![](https://ps.w.org/ultimate-member/assets/screenshot-8.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-8.png?rev=3160947)

  Screenshot 8
* [![](https://ps.w.org/ultimate-member/assets/screenshot-9.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-9.png?rev=3160947)

  Screenshot 9
* [![](https://ps.w.org/ultimate-member/assets/screenshot-10.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-10.png?rev=3160947)

  Screenshot 10
* [![](https://ps.w.org/ultimate-member/assets/screenshot-11.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-11.png?rev=3160947)

  Screenshot 11
* [![](https://ps.w.org/ultimate-member/assets/screenshot-12.png?rev=3160947)](https://ps.w.org/ultimate-member/assets/screenshot-12.png?rev=3160947)

  Screenshot 12

## Blocks

This plugin provides 4 blocks.

* Form
  Choose display form
* Member Directory
  Choose display directory
* Password Reset
  Displaying the password reset form
* Account
  Displaying the account page of the current user

## Installation

1. Activate the plugin
2. That’s it. Go to Ultimate Member > Settings to customize plugin options
3. For more details, please visit the official [Documentation](http://docs.ultimatemember.com/) page.

## FAQ

### Do I need to know any coding to use this plugin?

No, we have built Ultimate Member to be extremely easy to use and does not require you to manually build shortcodes or have any coding knowledge.

### Is Ultimate Member mobile responsive?

Yes. Ultimate Member is designed to adapt nicely to any screen resolution. It includes specific designs for phones, tablets and desktops.

### Is Ultimate Member multi-site compatible?

Yes. Ultimate Member works great on both single site and multi-site WordPress installs.

### Does the plugin work with any WordPress theme?

Yes. Ultimate Member will work with any properly coded theme. However, some themes may cause conflicts with the plugin. If you find a styling issue with your theme please create a post in the community forum.

### Does the plugin work with caching plugins?

The plugin works with popular caching plugins by automatically excluding Ultimate Member pages from being cached. This ensures other visitors to a page will not see the private information of another user. However, if you add features of Ultimate Member to other pages you have to exclude those pages from being cached through your cache plugin settings panel.

### Does Ultimate Member restrict access to wp-login.php when the plugin is active?

The plugin does not restrict access to the wp-login.php page when active, so that our plugin does not interfere with the existing functionality of a website or other plugins that may utilise the default login page. If you wish to restrict access to the wp-login.php page you can use a plugin such as [WPS Hide Login](https://wordpress.org/plugins/wps-hide-login/) or another plugin that removes the ability to login via wp-login.php.

### Are Ultimate Member Login/Registration pages required?

No, you do not need to use our plugin’s login or registration pages and can use another plugin or the default WordPress methods for user registration and login.

### Are additional PHP modules necessary for the plugin to work correctly?

No specific extensions are needed. But we highly recommended keep active these PHP modules: `mbstring`, `json`, `dom`, `exif`, `gd`, `fileinfo`, `curl`, `iconv`. wp-admin > Tools > Site Health page has a summary about your installation and required modules. All major extensions are listed [here](https://make.wordpress.org/hosting/handbook/server-environment/#php-extensions).

## Reviews

![](https://secure.gravatar.com/avatar/ec54f5225f10dccac637120c39da6b0c993a3013b4f1651523c627b72acb61f4?s=60&d=retro&r=g)
### [Fantastic for private (members only) websites with great support](https://wordpress.org/support/topic/unresponsive-support-confusing-unadjustable-directory-ux/)

[drnwd6](https://profiles.wordpress.org/drnwd6/ "Posts by drnwd6")
January 3, 2025

If you are looking for a member directory that supports your members in search/sorting/filtering to find members based on specific criteria, including a googlemaps (~$) integration, this plugin can do it. It is also fantastic for creating members-only accessible content for part (or all!) of your website.
In addition, the team behind this plug-in have been very responsive to queries, providing exceptional support and communications.

![](https://secure.gravatar.com/avatar/78a4c9833122d6ae6120680c8e3bb18782e05e188f47a86649e78553cd9cd8d7?s=60&d=retro&r=g)
### [Excellent plugin](https://wordpress.org/support/topic/excellent-plugin-9436/)

[bradleyfie](https://profiles.wordpress.org/bradleyfie/ "Posts by bradleyfie")
December 17, 2024

This plugin has made managing users on my website so much easier. The ability to assign custom roles and permissions is a lifesaver for my multi-author blog. However, the interface could use a bit more polishing as it’s not entirely intuitive.

![](https://secure.gravatar.com/avatar/b0fe7bdbcb88c1e2c6d68bf3af6128b546e0e197da72749821f0792a9d87ee55?s=60&d=retro&r=g)
### [Grave problema de seguridad. versión free](https://wordpress.org/support/topic/grave-problema-de-seguridad-version-free/)

[mairimweb](https://profiles.wordpress.org/mairimweb/ "Posts by mairimweb")
December 3, 2024
3 replies

Advertencia: No recomendamos el uso de esta herramienta. Hemos detectado que, al instalarla, abre puertos en tu sitio web que facilitan la ejecución de malware, comprometiendo la seguridad del sistema. Este problema se ha confirmado en múltiples sitios donde fue implementada. Si decides usarla, será bajo tu propia responsabilidad, ya que presenta graves vulnerabilidades de seguridad.

![](https://secure.gravatar.com/avatar/6f8d3ca578cb73d9b909e55b09597095a4ffb4d669a1591f808f5586d2825b28?s=60&d=retro&r=g)
### [wp safety](https://wordpress.org/support/topic/wp-safety/)

[maxlov](https://profiles.wordpress.org/maxlov/ "Posts by maxlov")
November 21, 2024

cool safety feature

![](https://secure.gravatar.com/avatar/921f9ad906842f16b5cd05d4a0a9de53793d085d4fd3ce31295af733b32d1a17?s=60&d=retro&r=g)
### [Perfect, but annoying updates](https://wordpress.org/support/topic/perfect-but-annoying-updates/)

[theoduncker](https://profiles.wordpress.org/theoduncker/ "Posts by theoduncker")
November 17, 2024

Every time an update for this plugin comes out, I have to redo all the translations of the emails in settings again. Is there nothing you can do about that?

![](https://secure.gravatar.com/avatar/5aa19e535fb39642827042e756d249d8f63a62c8aba3308ea6bc1979de56e043?s=60&d=retro&r=g)
### [checkbox fields](https://wordpress.org/support/topic/checkbox-fields-3/)

[alexsamusevich](https://profiles.wordpress.org/alexsamusevich/ "Posts by alexsamusevich")
November 6, 2024

How can I fix a typo in a checkbox without losing the selection of this field for users who have already selected it? I’m faced with the problem that after changing the text in a checkbox, the values for those who have previously selected it disappear.

[Read all 1,432 reviews](https://wordpress.org/support/plugin/ultimate-member/reviews/)
## Contributors & Developers

“Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction & Membership Plugin” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/b27656f03037b4d5f03d0a72a729fb463d179f725e068962c906c38f5a495f7c?s=32&d=mm&r=g) [Ultimate Member](https://profiles.wordpress.org/ultimatemember/)
* ![](https://secure.gravatar.com/avatar/84238f519476e1a78b18e7ff5b0e5a18b5bcdaa9c6b4c4e91324db7ed29ece5f?s=32&d=mm&r=g) [Champ Camba](https://profiles.wordpress.org/champsupertramp/)
* ![](https://secure.gravatar.com/avatar/a585086eb557690eb6ad9354b15737c57687462aed7870b9e40315366825b931?s=32&d=mm&r=g) [Mykyta Synelnikov](https://profiles.wordpress.org/nsinelnikov/)

“Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction & Membership Plugin” has been translated into 27 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/ultimate-member/contributors) for their contributions.

[Translate “Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction & Membership Plugin” into your language.](https://translate.wordpress.org/projects/wp-plugins/ultimate-member)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/ultimate-member/), check out the [SVN repository](https://plugins.svn.wordpress.org/ultimate-member/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/ultimate-member/) by [RSS](https://plugins.trac.wordpress.org/log/ultimate-member/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### Important:

IMPORTANT: PLEASE UPDATE THE PLUGIN TO AT LEAST VERSION 2.6.7 IMMEDIATELY. VERSION 2.6.7 PATCHES SECURITY PRIVILEGE ESCALATION VULNERABILITY. PLEASE SEE [THIS ARTICLE](https://docs.ultimatemember.com/article/1866-security-incident-update-and-recommended-actions) FOR MORE INFORMATION

#### 2.9.2 2025-01-14

**Enhancements**

* Added: Compatibility with the new [Ultimate Member – Zapier](https://ultimatemember.com/extensions/zapier/) extension
* Added: Only approved user Reset Password setting defined as true by default
* Added: `UM()->is_new_ui()` function for future enhancements related to new UI
* Added: Filter hook `um_before_user_submitted_registration_data`
* Tweak: Changed hook’s priority for initialization of email templates paths
* Tweak: Removed `load_plugin_textdomain` due to (article)[https://make.wordpress.org/core/2024/10/21/i18n-improvements-6-7/#Enhanced-support-for-only-using-PHP-translation-files]

**Bugfixes**

* Fixed: Security issue CVE ID: CVE-2025-0308
* Fixed: Security issue CVE ID: CVE-2025-0318
* Fixed: Using placeholders in email templates when Action Scheduler is active. Using `fetch_user_id` attribute for fetching necessary user before sending email
* Fixed: PHP 8.4 compatibility. Using WordPress native `wp_is_mobile()` instead of MobileDetect library
* Fixed: PHP errors related to `UM()->localize()` function
* Fixed: PHP errors in user meta header when `last_update` meta is empty
* Fixed: Small CSS changes and avoid duplicates
* Fixed: Removed ms-native show password button for type=”password” field in UM forms
* Fixed: Define scalable attribute for cropper

**Deprecated**

* Fully deprecated `UM()->mobile()` function
* Fully deprecated `UM()->localize()` function
* Fully deprecated `um_language_textdomain` filter hook

**Templates required update**

* account.php

**Cached and optimized/minified assets(JS/CSS) must be flushed/re-generated after upgrade**

#### 2.9.1 2024-11-15

**Enhancements**

* Added: `um_image_upload_validation` hook for 3rd-party validation during upload images

**Bugfixes**

* Fixed: “Load textdomain just in time” issue
* Fixed: Capabilities checking in the wp-admin > Users list table
* Fixed: File/image upload on the role specific profile form
* Fixed: Issues when the form’s custom fields meta has a wrong format
* Fixed: Validation of the “Registration Default Role” slug
* Fixed: Allowed query variables via registered REST API class only when REST\_REQUEST is defined

#### 2.9.0 2024-11-12

**Enhancements**

* Added: Action Scheduler (version 3.8.1) for email sending. More info is [here](https://actionscheduler.org/).
* Added: Supporting new `wp_register_block_metadata_collection()` function for registering WP Blocks

**Bugfixes**

* Fixed: `ajax_image_upload()` and `ajax_resize_image()` handlers vulnerability. CVE ID: CVE-2024-10528
* Fixed: Disabling user status column wp-admin > Users screen
* Fixed: User status filter on wp-admin > Users on mobile devices
* Fixed: Extra unwrapping of the WP Editor field’s value

**Cached and optimized/minified assets(JS/CSS) must be flushed/re-generated after upgrade**

[See changelog for all versions](https://plugins.svn.wordpress.org/ultimate-member/trunk/changelog.txt).

## Commercial plugin

This plugin is free but offers additional paid commercial upgrades or support.

## Meta

* Version **2.9.2**
* Last updated **5 days ago**
* Active installations **200,000+**
* WordPress version **5.5 or higher**
* Tested up to **6.7.1**
* PHP version **5.6 or higher**
* Languages
  See all 28

  Close

  [Arabic](https://ar.wordpress.org/plugins/ultimate-member/), [Chinese (China)](https://cn.wordpress.org/plugins/ultimate-member/), [Chinese (Taiwan)](https://tw.wordpress.org/plugins/ultimate-member/), [Czech](https://cs.wordpress.org/plugins/ultimate-member/), [Danish](https://da.wordpress.org/plugins/ultimate-member/), [Dutch](https://nl.wordpress.org/plugins/ultimate-member/), [English (US)](https://wordpress.org/plugins/ultimate-member/), [French (Canada)](https://fr-ca.wordpress.org/plugins/ultimate-member/), [French (France)](https://fr.wordpress.org/plugins/ultimate-member/), [German](https://de.wordpress.org/plugins/ultimate-member/), [German (Switzerland)](https://de-ch.wordpress.org/plugins/ultimate-member/), [Greek](https://el.wordpress.org/plugins/ultimate-member/), [Hebrew](https://he.wordpress.org/plugins/ultimate-member/), [Japanese](https://ja.wordpress.org/plugins/ultimate-member/), [Korean](https://ko.wordpress.org/plugins/ultimate-member/), [Norwegian (Bokmål)](https://nb.wordpress.org/plugins/ultimate-member/), [Persian](https://fa.wordpress.org/plugins/ultimate-member/), [Polish](https://pl.wordpress.org/plugins/ultimate-member/), [Russian](https://ru.wordpress.org/plugins/ultimate-member/), [Spanish (Chile)](https://cl.wordpress.org/plugins/ultimate-member/), [Spanish (Colombia)](https://es-co.wordpress.org/plugins/ultimate-member/), [Spanish (Costa Rica)](https://es-cr.wordpress.org/plugins/ultimate-member/), [Spanish (Ecuador)](https://es-ec.wordpress.org/plugins/ultimate-member/), [Spanish (Mexico)](https://es-mx.wordpress.org/plugins/ultimate-member/), [Spanish (Spain)](https://es.wordpress.org/plugins/ultimate-member/), [Spanish (Venezuela)](https://ve.wordpress.org/plugins/ultimate-member/), [Swedish](https://sv.wordpress.org/plugins/ultimate-member/), and [Ukrainian](https://uk.wordpress.org/plugins/ultimate-member/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/ultimate-member)
* Tags [community](https://wordpress.org/plugins/tags/community/)[member](https://wordpress.org/plugins/tags/member/)[membership](https://wordpress.org/plugins/tags/membership/)[user profile](https://wordpress.org/plugins/tags/user-profile/)[User Registration](https://wordpress.org/plugins/tags/user-registration/)
* [Advanced View](https://wordpress.org/plugins/ultimate-member/advanced/)

## Ratings

4.4 out of 5 stars.

* [1135 5-star reviews
  5 stars

  1135](https://wordpress.org/support/plugin/ultimate-member/reviews/?filter=5)
* [70 4-star reviews
  4 stars

  70](https://wordpress.org/support/plugin/ultimate-member/reviews/?filter=4)
* [37 3-star reviews
  3 stars

  37](https://wordpress.org/support/plugin/ultimate-member/reviews/?filter=3)
* [43 2-star reviews
  2 stars

  43](https://wordpress.org/support/plugin/ultimate-member/reviews/?filter=2)
* [147 1-star reviews
  1 star

  147](https://wordpress.org/support/plugin/ultimate-member/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/ultimate-member/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/ultimate-member/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/b27656f03037b4d5f03d0a72a729fb463d179f725e068962c906c38f5a495f7c?s=32&d=mm&r=g) [Ultimate Member](https://profiles.wordpress.org/ultimatemember/)
* ![](https://secure.gravatar.com/avatar/84238f519476e1a78b18e7ff5b0e5a18b5bcdaa9c6b4c4e91324db7ed29ece5f?s=32&d=mm&r=g) [Champ Camba](https://profiles.wordpress.org/champsupertramp/)
* ![](https://secure.gravatar.com/avatar/a585086eb557690eb6ad9354b15737c57687462aed7870b9e40315366825b931?s=32&d=mm&r=g) [Mykyta Synelnikov](https://profiles.wordpress.org/nsinelnikov/)
## Support

Issues resolved in last two months:

139 out of 207

[View support forum](https://wordpress.org/support/plugin/ultimate-member/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from github.com_04a34e6c_20250119_115250.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fblob%2F627bbb0fae81ac34c60b43f0867eadcf8e1bc523%2Fincludes%2Fcore%2Fclass-files.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fblob%2F627bbb0fae81ac34c60b43f0867eadcf8e1bc523%2Fincludes%2Fcore%2Fclass-files.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ultimatemember%2Fultimatemember)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ultimatemember](/ultimatemember)
/
**[ultimatemember](/ultimatemember/ultimatemember)**
Public

* [Notifications](/login?return_to=%2Fultimatemember%2Fultimatemember) You must be signed in to change notification settings
* [Fork
  185](/login?return_to=%2Fultimatemember%2Fultimatemember)
* [Star
   252](/login?return_to=%2Fultimatemember%2Fultimatemember)

* [Code](/ultimatemember/ultimatemember)
* [Issues
  204](/ultimatemember/ultimatemember/issues)
* [Pull requests
  27](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects
  0](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

Additional navigation options

* [Code](/ultimatemember/ultimatemember)
* [Issues](/ultimatemember/ultimatemember/issues)
* [Pull requests](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

## Files

 627bbb0
## Breadcrumbs

1. [ultimatemember](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523)
2. /[includes](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes)
3. /[core](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core)
/
# class-files.php

Copy path Blame  Blame
## Latest commit

## History

[History](/ultimatemember/ultimatemember/commits/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core/class-files.php)1236 lines (986 loc) · 29.8 KB 627bbb0
## Breadcrumbs

1. [ultimatemember](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523)
2. /[includes](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes)
3. /[core](/ultimatemember/ultimatemember/tree/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core)
/
# class-files.php

Top
## File metadata and controls

* Code
* Blame

1236 lines (986 loc) · 29.8 KB[Raw](https://github.com/ultimatemember/ultimatemember/raw/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core/class-files.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?phpnamespace um\core;
// Exit if accessed directlyif ( ! defined( 'ABSPATH' ) ) exit;
if ( ! class\_exists( 'um\core\Files' ) ) {
 /\*\* \* Class Files \* @package um\core \*/ class Files {
 /\*\* \* @var \*/ var $upload\_temp;
 /\*\* \* @var \*/ var $upload\_baseurl;
 /\*\* \* @var \*/ var $upload\_basedir;
 /\*\* \* Files constructor. \*/ function \_\_construct() {
 $this->setup\_paths();
 add\_action( 'template\_redirect', array( &$this, 'download\_routing' ) );
 $this->fonticon = array( 'pdf' => array('icon' => 'um-faicon-file-pdf-o', 'color' => '#D24D4D' ), 'txt' => array('icon' => 'um-faicon-file-text-o' ), 'csv' => array('icon' => 'um-faicon-file-text-o' ), 'doc' => array('icon' => 'um-faicon-file-text-o', 'color' => '#2C95D5' ), 'docx' => array('icon' => 'um-faicon-file-text-o', 'color' => '#2C95D5' ), 'odt' => array('icon' => 'um-faicon-file-text-o', 'color' => '#2C95D5' ), 'ods' => array('icon' => 'um-faicon-file-excel-o', 'color' => '#51BA6A' ), 'xls' => array('icon' => 'um-faicon-file-excel-o', 'color' => '#51BA6A' ), 'xlsx' => array('icon' => 'um-faicon-file-excel-o', 'color' => '#51BA6A' ), 'zip' => array('icon' => 'um-faicon-file-zip-o' ), 'rar' => array('icon' => 'um-faicon-file-zip-o' ), 'mp3' => array('icon' => 'um-faicon-file-audio-o' ), 'jpg' => array('icon' => 'um-faicon-picture-o' ), 'jpeg' => array('icon' => 'um-faicon-picture-o' ), 'png' => array('icon' => 'um-icon-image' ), 'gif' => array('icon' => 'um-icon-images' ), 'eps' => array('icon' => 'um-icon-images' ), 'psd' => array('icon' => 'um-icon-images' ), 'tif' => array('icon' => 'um-icon-image' ), 'tiff' => array('icon' => 'um-icon-image' ), );
 $this->default\_file\_fonticon = 'um-faicon-file-o'; }
 /\*\* \* File download link generate \* \* @param int $form\_id \* @param string $field\_key \* @param int $user\_id \* \* @return string \*/ function get\_download\_link( $form\_id, $field\_key, $user\_id ) { $field\_key = urlencode( $field\_key );
 if ( UM()->is\_permalinks ) { $url = get\_home\_url( get\_current\_blog\_id() ); $nonce = wp\_create\_nonce( $user\_id . $form\_id . 'um-download-nonce' ); $url = $url . "/um-download/{$form\_id}/{$field\_key}/{$user\_id}/{$nonce}"; } else { $url = get\_home\_url( get\_current\_blog\_id() ); $nonce = wp\_create\_nonce( $user\_id . $form\_id . 'um-download-nonce' ); $url = add\_query\_arg( array( 'um\_action' => 'download', 'um\_form' => $form\_id, 'um\_field' => $field\_key, 'um\_user' => $user\_id, 'um\_verify' => $nonce ), $url ); }
 //add time to query args for sites with the cache return add\_query\_arg( array( 't' => time() ), $url ); }
 /\*\* \* @return bool \*/ function download\_routing() { if ( 'download' !== get\_query\_var( 'um\_action' ) ) { return false; }
 $query\_form = get\_query\_var( 'um\_form' ); if ( empty( $query\_form ) ) { return false; }
 $form\_id = get\_query\_var( 'um\_form' ); $query\_field = get\_query\_var( 'um\_field' ); if ( empty( $query\_field ) ) { return false; } $field\_key = urldecode( get\_query\_var( 'um\_field' ) ); $query\_user = get\_query\_var( 'um\_user' ); if ( empty( $query\_user ) ) { return false; }
 $user\_id = get\_query\_var( 'um\_user' ); $user = get\_userdata( $user\_id );
 if ( empty( $user ) || is\_wp\_error( $user ) ) { return false; } $query\_verify = get\_query\_var( 'um\_verify' ); if ( empty( $query\_verify ) || ! wp\_verify\_nonce( $query\_verify, $user\_id . $form\_id . 'um-download-nonce' ) ) { return false; }
 um\_fetch\_user( $user\_id ); $field\_data = get\_post\_meta( $form\_id, '\_um\_custom\_fields', true ); if ( empty( $field\_data[ $field\_key ] ) ) { return false; }
 if ( ! um\_can\_view\_field( $field\_data[ $field\_key ] ) ) { return false; }
 $field\_value = UM()->fields()->field\_value( $field\_key ); if ( empty( $field\_value ) ) { return false; }
 $download\_type = $field\_data[ $field\_key ]['type']; if ( $download\_type === 'file' ) { $this->file\_download( $user\_id, $field\_key, $field\_value ); } else { $this->image\_download( $user\_id, $field\_key, $field\_value ); }
 return false; }
 /\*\* \* @param $user\_id \* @param $field\_key \* @param $field\_value \*/ function image\_download( $user\_id, $field\_key, $field\_value ) { $file\_path = UM()->uploader()->get\_upload\_base\_dir() . $user\_id . DIRECTORY\_SEPARATOR . $field\_value; if ( ! file\_exists( $file\_path ) ) { if ( is\_multisite() ) { //multisite fix for old customers $file\_path = str\_replace( DIRECTORY\_SEPARATOR . 'sites' . DIRECTORY\_SEPARATOR . get\_current\_blog\_id() . DIRECTORY\_SEPARATOR, DIRECTORY\_SEPARATOR, $file\_path ); } }
 //validate traversal file if ( validate\_file( $file\_path ) === 1 ) { return; }
 $file\_info = get\_user\_meta( $user\_id, $field\_key . "\_metadata", true );
 $pathinfo = pathinfo( $file\_path ); $size = filesize( $file\_path ); $originalname = ! empty( $file\_info['original\_name'] ) ? $file\_info['original\_name'] : $pathinfo['basename']; $type = ! empty( $file\_info['type'] ) ? $file\_info['type'] : $pathinfo['extension'];
 header('Content-Description: File Transfer'); header('Content-Type: ' . $type ); header('Content-Disposition: inline; filename="' . $originalname . '"'); header('Content-Transfer-Encoding: binary'); header('Expires: 0'); header('Cache-Control: must-revalidate, post-check=0, pre-check=0'); header('Pragma: public'); header('Content-Length: ' . $size);
 $levels = ob\_get\_level(); for ( $i = 0; $i < $levels; $i++ ) { @ob\_end\_clean(); }
 readfile( $file\_path ); exit; }
 /\*\* \* @param $user\_id \* @param $field\_key \* @param $field\_value \*/ function file\_download( $user\_id, $field\_key, $field\_value ) { $file\_path = UM()->uploader()->get\_upload\_base\_dir() . $user\_id . DIRECTORY\_SEPARATOR . $field\_value; if ( ! file\_exists( $file\_path ) ) { if ( is\_multisite() ) { //multisite fix for old customers $file\_path = str\_replace( DIRECTORY\_SEPARATOR . 'sites' . DIRECTORY\_SEPARATOR . get\_current\_blog\_id() . DIRECTORY\_SEPARATOR, DIRECTORY\_SEPARATOR, $file\_path ); } }
 //validate traversal file if ( validate\_file( $file\_path ) === 1 ) { return; }
 $file\_info = get\_user\_meta( $user\_id, $field\_key . "\_metadata", true );
 $pathinfo = pathinfo( $file\_path ); $size = filesize( $file\_path ); $originalname = ! empty( $file\_info['original\_name'] ) ? $file\_info['original\_name'] : $pathinfo['basename']; $type = ! empty( $file\_info['type'] ) ? $file\_info['type'] : $pathinfo['extension'];
 header('Content-Description: File Transfer'); header('Content-Type: ' . $type ); header('Content-Disposition: attachment; filename="' . $originalname . '"'); header('Content-Transfer-Encoding: binary'); header('Expires: 0'); header('Cache-Control: must-revalidate, post-check=0, pre-check=0'); header('Pragma: public'); header('Content-Length: ' . $size);
 $levels = ob\_get\_level(); for ( $i = 0; $i < $levels; $i++ ) { @ob\_end\_clean(); }
 readfile( $file\_path ); exit; }
 /\*\* \* Remove file by AJAX \*/ function ajax\_remove\_file() { UM()->check\_ajax\_nonce();
 /\*\* \* @var $src \*/ extract( $\_REQUEST ); $this->delete\_file( $src );
 wp\_send\_json\_success(); }
 /\*\* \* Resize image AJAX handler \*/ function ajax\_resize\_image() { UM()->check\_ajax\_nonce();
 /\*\* \* @var $key \* @var $src \* @var $coord \* @var $user\_id \*/ extract( $\_REQUEST );
 if ( ! isset( $src ) || ! isset( $coord ) ) { wp\_send\_json\_error( esc\_js( \_\_( 'Invalid parameters', 'ultimate-member' ) ) ); }
 $coord\_n = substr\_count( $coord, "," ); if ( $coord\_n != 3 ) { wp\_send\_json\_error( esc\_js( \_\_( 'Invalid coordinates', 'ultimate-member' ) ) ); }
 $user\_id = empty( $\_REQUEST['user\_id'] ) ? get\_current\_user\_id() : $\_REQUEST['user\_id']; $image\_path = um\_is\_file\_owner( $src, $user\_id, true ); if ( ! $image\_path ) { wp\_send\_json\_error( esc\_js( \_\_( 'Invalid file ownership', 'ultimate-member' ) ) ); }
 UM()->uploader()->replace\_upload\_dir = true; $output = UM()->uploader()->resize\_image( $image\_path, $src, $key, $user\_id, $coord ); UM()->uploader()->replace\_upload\_dir = false;
 delete\_option( "um\_cache\_userdata\_{$user\_id}" );
 wp\_send\_json\_success( $output ); }
 /\*\* \* Image upload by AJAX \* \* @throws \Exception \*/ function ajax\_image\_upload() { $ret['error'] = null; $ret = array();
 $id = $\_POST['key']; $timestamp = $\_POST['timestamp']; $nonce = $\_POST['\_wpnonce']; $user\_id = empty( $\_POST['user\_id'] ) ? get\_current\_user\_id() : $\_POST['user\_id'];
 UM()->fields()->set\_id = $\_POST['set\_id']; UM()->fields()->set\_mode = $\_POST['set\_mode'];
 /\*\* \* UM hook \* \* @type filter \* @title um\_image\_upload\_nonce \* @description Change Image Upload nonce \* @input\_vars \* [{"var":"$nonce","type":"bool","desc":"Nonce"}] \* @change\_log \* ["Since: 2.0"] \* @usage \* <?php add\_filter( 'um\_image\_upload\_nonce', 'function\_name', 10, 1 ); ?> \* @example \* <?php \* add\_filter( 'um\_image\_upload\_nonce', 'my\_image\_upload\_nonce', 10, 1 ); \* function my\_image\_upload\_nonce( $nonce ) { \* // your code here \* return $nonce; \* } \* ?> \*/ $um\_image\_upload\_nonce = apply\_filters( 'um\_image\_upload\_nonce', true );
 if ( $um\_image\_upload\_nonce ) { if ( ! wp\_verify\_nonce( $nonce, "um\_upload\_nonce-{$timestamp}" ) && is\_user\_logged\_in() ) { // This nonce is not valid. $ret['error'] = \_\_( 'Invalid nonce', 'ultimate-member' ); wp\_send\_json\_error( $ret ); } }
 if ( isset( $\_FILES[ $id ]['name'] ) ) {
 if ( ! is\_array( $\_FILES[ $id ]['name'] ) ) {
 UM()->uploader()->replace\_upload\_dir = true; $uploaded = UM()->uploader()->upload\_image( $\_FILES[ $id ], $user\_id, $id ); UM()->uploader()->replace\_upload\_dir = false; if ( isset( $uploaded['error'] ) ) { $ret['error'] = $uploaded['error']; } else { $ret[] = $uploaded['handle\_upload']; }
 }
 } else { $ret['error'] = \_\_( 'A theme or plugin compatibility issue', 'ultimate-member' ); } wp\_send\_json\_success( $ret ); }
 /\*\* \* File upload by AJAX \*/ function ajax\_file\_upload() { $ret['error'] = null; $ret = array();
 /\* commented for enable download files on registration form \* if ( ! is\_user\_logged\_in() ) { $ret['error'] = 'Invalid user'; die( json\_encode( $ret ) ); }\*/
 $nonce = $\_POST['\_wpnonce']; $id = $\_POST['key']; $timestamp = $\_POST['timestamp'];
 UM()->fields()->set\_id = $\_POST['set\_id']; UM()->fields()->set\_mode = $\_POST['set\_mode'];
 /\*\* \* UM hook \* \* @type filter \* @title um\_file\_upload\_nonce \* @description Change File Upload nonce \* @input\_vars \* [{"var":"$nonce","type":"bool","desc":"Nonce"}] \* @change\_log \* ["Since: 2.0"] \* @usage \* <?php add\_filter( 'um\_file\_upload\_nonce', 'function\_name', 10, 1 ); ?> \* @example \* <?php \* add\_filter( 'um\_file\_upload\_nonce', 'my\_file\_upload\_nonce', 10, 1 ); \* function my\_file\_upload\_nonce( $nonce ) { \* // your code here \* return $nonce; \* } \* ?> \*/ $um\_file\_upload\_nonce = apply\_filters("um\_file\_upload\_nonce", true );
 if ( $um\_file\_upload\_nonce ) { if ( ! wp\_verify\_nonce( $nonce, 'um\_upload\_nonce-'.$timestamp ) && is\_user\_logged\_in() ) { // This nonce is not valid. $ret['error'] = 'Invalid nonce'; wp\_send\_json\_error( $ret );
 } }
 if( isset( $\_FILES[ $id ]['name'] ) ) {
 if ( ! is\_array( $\_FILES[ $id ]['name'] ) ) {
 $user\_id = $\_POST['user\_id'];
 UM()->uploader()->replace\_upload\_dir = true; $uploaded = UM()->uploader()->upload\_file( $\_FILES[ $id ], $user\_id, $id ); UM()->uploader()->replace\_upload\_dir = false; if ( isset( $uploaded['error'] ) ){
 $ret['error'] = $uploaded['error'];
 } else {
 $uploaded\_file = $uploaded['handle\_upload']; $ret['url'] = $uploaded\_file['file\_info']['name']; $ret['icon'] = UM()->files()->get\_fonticon\_by\_ext( $uploaded\_file['file\_info']['ext'] ); $ret['icon\_bg'] = UM()->files()->get\_fonticon\_bg\_by\_ext( $uploaded\_file['file\_info']['ext'] ); $ret['filename'] = $uploaded\_file['file\_info']['basename']; $ret['original\_name'] = $uploaded\_file['file\_info']['original\_name'];
 }
 }
 } else { $ret['error'] = \_\_('A theme or plugin compatibility issue','ultimate-member'); }
 wp\_send\_json\_success( $ret ); }
 /\*\* \* Allowed image types \* \* @return array \*/ function allowed\_image\_types() { /\*\* \* UM hook \* \* @type filter \* @title um\_allowed\_image\_types \* @description Extend allowed image types \* @input\_vars \* [{"var":"$types","type":"array","desc":"Image ext types"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_allowed\_image\_types', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_allowed\_image\_types', 'my\_allowed\_image\_types', 10, 1 ); \* function my\_allowed\_image\_types( $types ) { \* // your code here \* return $types; \* } \* ?> \*/ return apply\_filters( 'um\_allowed\_image\_types', array( 'png' => 'PNG', 'jpeg' => 'JPEG', 'jpg' => 'JPG', 'gif' => 'GIF' ) ); }
 /\*\* \* Allowed file types \* \* @return mixed \*/ function allowed\_file\_types() { /\*\* \* UM hook \* \* @type filter \* @title um\_allowed\_file\_types \* @description Extend allowed File types \* @input\_vars \* [{"var":"$types","type":"array","desc":"Files ext types"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_allowed\_file\_types', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_allowed\_file\_types', 'my\_allowed\_file\_types', 10, 1 ); \* function my\_allowed\_file\_types( $types ) { \* // your code here \* return $types; \* } \* ?> \*/ return apply\_filters( 'um\_allowed\_file\_types', array( 'pdf' => 'PDF', 'txt' => 'Text', 'csv' => 'CSV', 'doc' => 'DOC', 'docx' => 'DOCX', 'odt' => 'ODT', 'ods' => 'ODS', 'xls' => 'XLS', 'xlsx' => 'XLSX', 'zip' => 'ZIP', 'rar' => 'RAR', 'mp3' => 'MP3', 'jpg' => 'JPG', 'jpeg' => 'JPEG', 'png' => 'PNG', 'gif' => 'GIF', 'eps' => 'EPS', 'psd' => 'PSD', 'tif' => 'TIF', 'tiff' => 'TIFF', ) ); }
 /\*\* \* Get extension icon \* \* @param $extension \* \* @return string \*/ function get\_fonticon\_by\_ext( $extension ) { if ( isset( $this->fonticon[$extension]['icon'] ) ) { return $this->fonticon[$extension]['icon']; } else { return $this->default\_file\_fonticon; } }
 /\*\* \* Get extension icon background \* \* @param $extension \* \* @return string \*/ function get\_fonticon\_bg\_by\_ext( $extension ) { if ( isset( $this->fonticon[$extension]['color'] ) ) { return $this->fonticon[$extension]['color']; } else { return '#666'; } }
 /\*\* \* Setup upload directory \*/ function setup\_paths() {
 $this->upload\_dir = wp\_upload\_dir();
 $this->upload\_basedir = $this->upload\_dir['basedir'] . '/ultimatemember/'; $this->upload\_baseurl = $this->upload\_dir['baseurl'] . '/ultimatemember/';
 /\*\* \* UM hook \* \* @type filter \* @title um\_upload\_basedir\_filter \* @description Change Uploads Basedir \* @input\_vars \* [{"var":"$basedir","type":"string","desc":"Uploads basedir"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_upload\_basedir\_filter', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_upload\_basedir\_filter', 'my\_upload\_basedir', 10, 1 ); \* function my\_upload\_basedir( $basedir ) { \* // your code here \* return $basedir; \* } \* ?> \*/ $this->upload\_basedir = apply\_filters( 'um\_upload\_basedir\_filter', $this->upload\_basedir ); /\*\* \* UM hook \* \* @type filter \* @title um\_upload\_baseurl\_filter \* @description Change Uploads Base URL \* @input\_vars \* [{"var":"$baseurl","type":"string","desc":"Uploads base URL"}] \* @change\_log \* ["Since: 2.0"] \* @usage add\_filter( 'um\_upload\_baseurl\_filter', 'function\_name', 10, 1 ); \* @example \* <?php \* add\_filter( 'um\_upload\_baseurl\_filter', 'my\_upload\_baseurl', 10, 1 ); \* function my\_upload\_baseurl( $baseurl ) { \* // your code here \* return $baseurl; \* } \* ?> \*/ $this->upload\_baseurl = apply\_filters( 'um\_upload\_baseurl\_filter', $this->upload\_baseurl );
 // @note : is\_ssl() doesn't work properly for some sites running with load balancers // Check the links for more info about this bug // https://codex.wordpress.org/Function\_Reference/is\_ssl // http://snippets.webaware.com.au/snippets/wordpress-is\_ssl-doesnt-work-behind-some-load-balancers/ if ( is\_ssl() || stripos( get\_option( 'siteurl' ), 'https://' ) !== false || ( isset( $\_SERVER['HTTP\_X\_FORWARDED\_PROTO'] ) && $\_SERVER['HTTP\_X\_FORWARDED\_PROTO'] == 'https' ) ) { $this->upload\_baseurl = str\_replace("http://", "https://", $this->upload\_baseurl); }
 $this->upload\_temp = $this->upload\_basedir . 'temp/'; $this->upload\_temp\_url = $this->upload\_baseurl . 'temp/';
 if ( ! file\_exists( $this->upload\_basedir ) ) { $old = umask(0); @mkdir( $this->upload\_basedir, 0755, true ); umask( $old ); }
 if ( ! file\_exists( $this->upload\_temp ) ) { $old = umask(0); @mkdir( $this->upload\_temp , 0755, true ); umask( $old ); }
 }
 /\*\* \* Generate unique temp directory \* \* @return mixed \*/ function unique\_dir(){ $unique\_number = UM()->validation()->generate(); $array['dir'] = $this->upload\_temp . $unique\_number . '/'; $array['url'] = $this->upload\_temp\_url . $unique\_number . '/'; return $array; }
 /\*\* \* Get path only without file name \* \* @param $file \* \* @return string \*/ function path\_only( $file ) {
 return trailingslashit( dirname( $file ) ); }
 /\*\* \* Fix image orientation \* \* @param $rotate \* @param $source \* \* @return resource \*/ function fix\_image\_orientation( $rotate, $source ) { if ( extension\_loaded('exif') ){ $exif = @exif\_read\_data( $source );
 if (isset($exif['Orientation'])) { switch ($exif['Orientation']) { case 3: $rotate = imagerotate($rotate, 180, 0); break;
 case 6: $rotate = imagerotate($rotate, -90, 0); break;
 case 8: $rotate = imagerotate($rotate, 90, 0); break; } } } return $rotate; }
 /\*\* \* Process an image \* \* @param $source \* @param $destination \* @param int $quality \* \* @return array \*/ function create\_and\_copy\_image($source, $destination, $quality = 100) {
 $info = @getimagesize($source);
 if ($info['mime'] == 'image/jpeg'){
 $image = imagecreatefromjpeg( $source );
 } else if ($info['mime'] == 'image/gif'){
 $image = imagecreatefromgif( $source );
 } else if ($info['mime'] == 'image/png'){
 $image = imagecreatefrompng( $source ); imagealphablending( $image, false ); imagesavealpha( $image, true );
 }
 list($w, $h) = @getimagesize( $source ); if ( $w > UM()->options()->get('image\_max\_width') ) {
 $ratio = round( $w / $h, 2 ); $new\_w = UM()->options()->get('image\_max\_width'); $new\_h = round( $new\_w / $ratio, 2 );
 if ( $info['mime'] == 'image/jpeg' || $info['mime'] == 'image/gif' ){
 $image\_p = imagecreatetruecolor( $new\_w, $new\_h ); imagecopyresampled( $image\_p, $image, 0, 0, 0, 0, $new\_w, $new\_h, $w, $h ); $image\_p = $this->fix\_image\_orientation( $image\_p, $source );
 }else if( $info['mime'] == 'image/png' ){
 $srcImage = $image; $targetImage = imagecreatetruecolor( $new\_w, $new\_h ); imagealphablending( $targetImage, false ); imagesavealpha( $targetImage, true ); imagecopyresampled( $targetImage, $srcImage, 0, 0, 0, 0, $new\_w, $new\_h, $w, $h );
 }
 if ( $info['mime'] == 'image/jpeg' ){ $has\_copied = imagejpeg( $image\_p, $destination, $quality ); }else if ( $info['mime'] == 'image/gif' ){ $has\_copied = imagegif( $image\_p, $destination ); }else if ( $info['mime'] == 'image/png' ){ $has\_copied = imagepng( $targetImage, $destination, 0 ,PNG\_ALL\_FILTERS); }
 $info['um\_has\_max\_width'] = 'custom'; $info['um\_has\_copied'] = $has\_copied ? 'yes':'no';
 } else {
 $image = $this->fix\_image\_orientation( $image, $source );
 if ( $info['mime'] == 'image/jpeg' ){ $has\_copied = imagejpeg( $image, $destination, $quality ); }else if ( $info['mime'] == 'image/gif' ){ $has\_copied = imagegif( $image, $destination ); }else if ( $info['mime'] == 'image/png' ){ $has\_copied = imagepng( $image , $destination , 0 ,PNG\_ALL\_FILTERS); }
 $info['um\_has\_max\_width'] = 'default'; $info['um\_has\_copied'] = $has\_copied ? 'yes':'no'; }
 return $info; }
 /\*\* \* Process a file \* \* @param $source \* @param $destination \*/ function upload\_temp\_file( $source, $destination ) {
 move\_uploaded\_file( $source, $destination ); }
 /\*\* \* Process a temp upload \* \* @param $source \* @param $destination \* @param int $quality \* \* @return string \*/ function new\_image\_upload\_temp( $source, $destination, $quality = 100 ){
 $unique\_dir = $this->unique\_dir();
 $this->make\_dir( $unique\_dir['dir'] );
 $info = $this->create\_and\_copy\_image( $source, $unique\_dir['dir'] . $destination, $quality );
 $url = $unique\_dir['url'] . $destination ;
 return $url;
 }
 /\*\* \* Process a temp upload for files \* \* @param $source \* @param $destination \* \* @return string \*/ function new\_file\_upload\_temp( $source, $destination ){
 $unique\_dir = $this->unique\_dir();
 $this->make\_dir( $unique\_dir['dir'] );
 $this->upload\_temp\_file( $source, $unique\_dir['dir'] . $destination );
 $url = $unique\_dir['url'] . $destination;
 return $url;
 }
 /\*\* \* Make a Folder \* \* @param $dir \*/ function make\_dir( $dir ) { $old = umask(0); @mkdir( $dir, 0755, true); umask( $old ); }
 /\*\* \* Get extension by mime type \* \* @param $mime \* \* @return mixed \*/ function get\_extension\_by\_mime\_type( $mime ) { $split = explode('/', $mime ); return $split[1]; }
 /\*\* \* Get file data \* \* @param $file \* \* @return mixed \*/ function get\_file\_data( $file ) { $array['size'] = filesize( $file ); return $array; }
 /\*\* \* Get image data \* \* @param $file \* \* @return mixed \*/ function get\_image\_data( $file ) {
 $finfo = finfo\_open( FILEINFO\_MIME\_TYPE );
 $mime\_type = finfo\_file( $finfo, $file );
 if( function\_exists('exif\_imagetype') ){
 $array\_exif\_image\_mimes = array( IMAGETYPE\_GIF, IMAGETYPE\_JPEG, IMAGETYPE\_PNG );
 $allowed\_types = apply\_filters('um\_image\_upload\_allowed\_exif\_mimes', $array\_exif\_image\_mimes );
 if( ! in\_array( @exif\_imagetype( $file ), $allowed\_types ) ) {
 $array['invalid\_image'] = true;
 return $array; }
 }else{
 $array\_image\_mimes = array('image/jpeg','image/png','image/gif');
 $allowed\_types = apply\_filters('um\_image\_upload\_allowed\_mimes', $array\_image\_mimes );
 if ( ! in\_array( $mime\_type, $allowed\_types ) ) {
 $array['invalid\_image'] = true;
 return $array; }
 }
 $array['size'] = filesize( $file );
 $image\_data = @getimagesize( $file );
 $array['image'] = $image\_data;
 $array['invalid\_image'] = false;
 list($width, $height, $type, $attr) = $image\_data;
 $array['width'] = $width;
 $array['height'] = $height;
 $array['ratio'] = $width / $height;
 $array['extension'] = $this->get\_extension\_by\_mime\_type( $mime\_type );
 return $array; }
 /\*\* \* If a value exists in comma seperated list \* \* @param $value \* @param $array \* \* @return bool \*/ function in\_array( $value, $array ) {
 if ( in\_array( $value, explode(',', $array ) ) ){ return true; }
 return false; }
 /\*\* \* This function will delete file upload from server \* \* @param $src \*/ function delete\_file( $src ) {
 if ( strstr( $src, '?' ) ) { $splitted = explode( '?', $src ); $src = $splitted[0]; }
 $is\_temp = um\_is\_temp\_upload( $src ); if ( $is\_temp ) { unlink( $is\_temp ); rmdir( dirname( $is\_temp ) ); } else { wp\_die( \_\_('Ultimate Member: Not a valid temp file','ultimate-member') ); } }[View remainder of file in raw view](https://github.com/ultimatemember/ultimatemember/raw/627bbb0fae81ac34c60b43f0867eadcf8e1bc523/includes/core/class-files.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


