=== Content from wiki.mozilla.org_3659d679_20250119_134623.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_0d803829_20250119_120200.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2020-08

## Security Vulnerabilities fixed in Firefox 74

Announced
March 10, 2020
Impact
high
Products
Firefox
Fixed in

* Firefox 74

#### [#CVE-2020-6805: Use-after-free when removing data about origins](#CVE-2020-6805)

Reporter
Brian Carpenter
Impact
high
##### Description

When removing data about an origin whose tab was recently closed, a use-after-free could occur in the Quota manager, resulting in a potentially exploitable crash.

##### References

* [Bug 1610880](https://bugzilla.mozilla.org/show_bug.cgi?id=1610880)

#### [#CVE-2020-6806: BodyStream::OnInputStreamReady was missing protections against state confusion](#CVE-2020-6806)

Reporter
Sergei Glazunov of Google Project Zero
Impact
high
##### Description

By carefully crafting promise resolutions, it was possible to cause an out-of-bounds read off the end of an array resized during script execution. This could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1612308](https://bugzilla.mozilla.org/show_bug.cgi?id=1612308)

#### [#CVE-2020-6807: Use-after-free in cubeb during stream destruction](#CVE-2020-6807)

Reporter
C.M.Chang
Impact
high
##### Description

When a device was changed while a stream was about to be destroyed, the `stream-reinit` task may have been executed after the stream was destroyed, causing a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1614971](https://bugzilla.mozilla.org/show_bug.cgi?id=1614971)

#### [#CVE-2020-6808: URL Spoofing via javascript: URL](#CVE-2020-6808)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

When a JavaScript URL (javascript:) is evaluated and the result is a string, this string is parsed to create an HTML document, which is then presented. Previously, this document's URL (as reported by the document.location property, for example) was the originating javascript: URL which could lead to spoofing attacks; it is now correctly the URL of the originating document.

##### References

* [Bug 1247968](https://bugzilla.mozilla.org/show_bug.cgi?id=1247968)

#### [#CVE-2020-6809: Web Extensions with the all-urls permission could access local files](#CVE-2020-6809)

Reporter
Jan Biniok
Impact
moderate
##### Description

When a Web Extension had the all-urls permission and made a fetch request with a mode set to 'same-origin', it was possible for the Web Extension to read local files.

##### References

* [Bug 1420296](https://bugzilla.mozilla.org/show_bug.cgi?id=1420296)

#### [#CVE-2020-6810: Focusing a popup while in fullscreen could have obscured the fullscreen notification](#CVE-2020-6810)

Reporter
Avi Drissman of the Chrome security team
Impact
moderate
##### Description

After a website had entered fullscreen mode, it could have used a previously opened popup to obscure the notification that indicates the browser is in fullscreen mode. Combined with spoofing the browser chrome, this could have led to confusing the user about the current origin of the page and credential theft or other attacks.

##### References

* [Bug 1432856](https://bugzilla.mozilla.org/show_bug.cgi?id=1432856)

#### [#CVE-2020-6811: Devtools' 'Copy as cURL' feature did not fully escape website-controlled data, potentially leading to command injection](#CVE-2020-6811)

Reporter
Ophir LOJKINE
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP method of a request, which can be controlled by the website. If a user used the 'Copy as Curl' feature and pasted the command into a terminal, it could have resulted in command injection and arbitrary command execution.

##### References

* [Bug 1607742](https://bugzilla.mozilla.org/show_bug.cgi?id=1607742)

#### [#CVE-2019-20503: Out of bounds reads in sctp\_load\_addresses\_from\_init](#CVE-2019-20503)

Reporter
Natalie Silvanovich of Google Project Zero
Impact
moderate
##### Description

The inputs to `sctp_load_addresses_from_init` are verified by `sctp_arethere_unrecognized_parameters`; however, the two functions handled parameter bounds differently, resulting in out of bounds reads when parameters are partially outside a chunk.

##### References

* [Bug 1613765](https://bugzilla.mozilla.org/show_bug.cgi?id=1613765)

#### [#CVE-2020-6812: The names of AirPods with personally identifiable information were exposed to websites with camera or microphone permission](#CVE-2020-6812)

Reporter
Jan-Ivar Bruaroey
Impact
moderate
##### Description

The first time AirPods are connected to an iPhone, they become named after the user's name by default (e.g. Jane Doe's AirPods.) Websites with camera or microphone permission are able to enumerate device names, disclosing the user's name. To resolve this issue, Firefox added a special case that renames devices containing the substring 'AirPods' to simply 'AirPods'.

##### References

* [Bug 1616661](https://bugzilla.mozilla.org/show_bug.cgi?id=1616661)

#### [#CVE-2020-6813: @import statements in CSS could bypass the Content Security Policy nonce feature](#CVE-2020-6813)

Reporter
Matheus Vrech
Impact
low
##### Description

When protecting CSS blocks with the nonce feature of Content Security Policy, the @import statement in the CSS block could allow an attacker to inject arbitrary styles, bypassing the intent of the Content Security Policy.

##### References

* [Bug 1605814](https://bugzilla.mozilla.org/show_bug.cgi?id=1605814)

#### [#CVE-2020-6814: Memory safety bugs fixed in Firefox 74 and Firefox ESR 68.6](#CVE-2020-6814)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Byron Campen, Jason Kratzer, and Christian Holler reported memory safety bugs present in Firefox 73 and Firefox ESR 68.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 74 and Firefox ESR 68.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1592078%2C1604847%2C1608256%2C1612636%2C1614339)

#### [#CVE-2020-6815: Memory and script safety bugs fixed in Firefox 74](#CVE-2020-6815)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Jason Kratzer, Boris Zbarsky, Tyson Smith, and Alexandru Michis reported memory safety and script safety bugs present in Firefox 73. Some of these bugs showed evidence of memory corruption or escalation of privilege and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory and script safety bugs fixed in Firefox 74](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1181957%2C1557732%2C1557739%2C1611457%2C1612431)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_905c548a_20250119_134605.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1420296)
* [XML](/show_bug.cgi?ctype=xml&id=1420296)

Closed
[Bug 1420296](/show_bug.cgi?id=1420296)
(CVE-2020-6809)

Opened 7 years ago
Closed 5 years ago

# Webextensions can access local files

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Webextensions can access local files

## Categories

### (WebExtensions :: General, defect, P1)

[Product:](/describecomponents.cgi?product=WebExtensions)

WebExtensions
▾

WebExtensions
File feature requests and bugs related to the WebExtension add-on API.
[See Open Bugs in This Product](/buglist.cgi?product=WebExtensions&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=WebExtensions)
Watch This Product

[Component:](/describecomponents.cgi?product=WebExtensions&component=General#General)

General
▾

WebExtensions :: General
All other bugs about WebExtensions
[See Open Bugs in This Component](/buglist.cgi?product=WebExtensions&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=WebExtensions&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=WebExtensions&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

57 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### (firefox-esr68 wontfix, firefox72 wontfix, firefox73 wontfix, firefox74 verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla74

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix) |
| firefox72 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix) |
| firefox73 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix) |
| firefox74 | --- | [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox72 |  | wontfix |
| firefox73 |  | wontfix |
| firefox74 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

[Blocking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Blocking_Flags)

| webextensions | --- |
| --- | --- |

## People

### (Reporter: jan, Assigned: robwu, Mentored)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/30e26944b9b786ea16fce8b18394c6e4?d=mm&size=40)  [robwu](/user_profile?user_id=447061)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

![](https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=40)  [kmag](/user_profile?user_id=106098)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/922adfc5538ed07a332c6f248f30ffa1?d=mm&size=40)  [jan](/user_profile?user_id=547788)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2132cf6e7db0fa0e604b86d120c813ee?d=mm&size=40)  [zombie](/user_profile?user_id=445095)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

41 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[803143](/show_bug.cgi?id=803143 "RESOLVED FIXED - Local files can access other files in the same directory"), [1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1487353](/show_bug.cgi?id=1487353 "RESOLVED FIXED - Extensions can run content scripts in local files and read any other local file")

Dependency [tree](/showdependencytree.cgi?id=1420296&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1420296)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1621935](/show_bug.cgi?id=1621935 "RESOLVED FIXED - webRequest listeners are not called for subresources loaded by file:// pages"), [1644488](/show_bug.cgi?id=1644488 "RESOLVED INVALID - content scripts cannot fetch contents of file URIs")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: webext-sec [post-critsmash-triage][adv-main74+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-6809

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

webext-sec [post-critsmash-triage][adv-main74+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [btot](/user_profile?user_id=553429) | [qe-verify](#a67712091_553429 "5 years ago") | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [file\_same\_origin.patch](/attachment.cgi?id=8936952)  [7 years ago](#c19)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   1.12 KB, patch | bkelly : [review-](#c21 "7 years ago") | [Details](/attachment.cgi?id=8936952&action=edit) | [Diff](/attachment.cgi?id=8936952&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1420296&attachment=8936952) |
| --- | --- | --- |
| [fileaccess.xpi](/attachment.cgi?id=9105000)  [5 years ago](#c53)  [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685)   722 bytes, application/x-xpinstall |  | [Details](/attachment.cgi?id=9105000&action=edit) |
| [Bug 1420296 - Add file check to WebExtensionPolicy](/attachment.cgi?id=9111270)  [5 years ago](#c60)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9111270&action=edit) | [Review](/attachment.cgi?id=9111270) |
| [Bug 1420296 - Add tests for file access from extensions](/attachment.cgi?id=9111271)  [5 years ago](#c61)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9111271&action=edit) | [Review](/attachment.cgi?id=9111271) |
| [Bug 1420296 - Test for same-origin file requests](/attachment.cgi?id=9111273)  [5 years ago](#c62)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9111273&action=edit) | [Review](/attachment.cgi?id=9111273) |
| [advisory.txt](/attachment.cgi?id=9131374)  [5 years ago](#c76)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   250 bytes, text/plain |  | [Details](/attachment.cgi?id=9131374&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan Biniok](/user_profile?user_id=547788)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1420296#c0)• 7 years ago |
|  | |

User Agent: Mozilla/5.0 (X11; Linux x86\_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/62.0.3202.89 Chrome/62.0.3202.89 Safari/537.36
Steps to reproduce:
Try the code from this stack overflow answer at a webextension:
<https://stackoverflow.com/questions/42108782/firefox-webextensions-get-local-files-content-by-path/44516256#44516256>
And you'll see that it is possible to read local files without user interaction.
More information:
As far as I know this is at the moment used by Stylus and a beta version of Tampermonkey (my extension). At Tampermonkey it's necessary that the user \_explicitly\_ enables file access, just like it's necessary at Chrome, in order to use it.
However, since the stack overflow answer was posted on 2017-05-13, I guess there are some more extensions that use it. That's why and since AMO currently is using a faster/automatic review I'm a little bit concerned that other extension might use it in a non-good-natured way, because the review process is unable to detect it (in opposition to Firefox's legacy API add-ons where the reviewers took account of this).
Finally, please think about implementing user-permitted file \_read\_ access. It's one of the most requested features of Tampermonkey.
[https://bugzilla.mozilla.org/show\_bug.cgi?id=1246236](/show_bug.cgi?id=1246236 "NEW - Implement local filesystem read/write access.")
[https://bugzilla.mozilla.org/show\_bug.cgi?id=1266960](/show_bug.cgi?id=1266960 "NEW - Extensions can not load file: URLs")
Actual results:
It's possible to read local files without any user interaction.
Expected results:
It should (not/only after user confirmation) be possible to access local files.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1420296#c1)• 7 years ago |
|  | |

Only files under $HOME, or also elsewhere? (background: when e10s is enabled, I would expect sandboxing to prohibit accessing files outside of $HOME)Group: firefox-core-security → toolkit-core-securityComponent: Untriaged → WebExtensions: GeneralFlags: needinfo?(jan)Product: Firefox → Toolkit

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1420296#c2)• 7 years ago |
|  | |

Looks like it can be anywhere in my testing of the function in Stylus.
<https://addons.mozilla.org/en-US/firefox/addon/styl-us/>
To reproduce
1) install stylus
2) go to about:debugging
3) click debug and in the browser console type something like:
download('file:///etc/passwd').then(e => console.log(e));
Output:
##
# User Database
#
# Note that this file is consulted directly only when the system is running
# in single-user mode. At other times this information is provided by
# Open Directory.
#
# See the opendirectoryd(8) man page for additional information about
# Open Directory.
##
nobody...
Also pinging Jim to let the sandboxing team know.Flags: needinfo?(kmaglione+bmo)Flags: needinfo?(jmathies)Priority: -- → P1

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1420296#c3)• 7 years ago |
|  | |

This is a bug in fetch & web extension context, when the {mode:'same-origin'} flag is set. I wonder if it affects any other contexts.
MDN says: "same-origin — If a request is made to another origin with this mode set, the result is simply an error. You could use this to ensure that a request is always being made to your origin."
But somehow, moz-extension//{UUID} and file:// are considered same origin when you set this flag.
STR:
Run this script in the background context of any web extension.
var url = file:///SOME/LOCAL/FILE/PATH
fetch(url, {mode:'same-origin'}).then(f=>console.log("read file",f.url)).catch(e=> console.log('Error trying to read file'))
Expected:
Console: Error trying to read file
Actual
Console: read file file:///SOME/LOCAL/FILE/PATH

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1420296#c4)• 7 years ago |
|  | |

This isn't exactly unexpected. If the extension has the <all\_urls> permission, it has same origin permissions for file: URLs, so this is pretty much the way it should work.Flags: needinfo?(kmaglione+bmo)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1420296#c5)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> This isn't exactly unexpected. If the extension has the <all\_urls>
> permission, it has same origin permissions for file: URLs, so this is pretty
> much the way it should work.
Why does this ONLY work when you set the 'same-origin' flag.
Also note that this request completely bypasses the sandbox.

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1420296#c6)• 7 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #5](/show_bug.cgi?id=1420296#c5 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> > This isn't exactly unexpected. If the extension has the <all\_urls>
> > permission, it has same origin permissions for file: URLs, so this is pretty
> > much the way it should work.
>
> Why does this ONLY work when you set the 'same-origin' flag.
Because our fetch support kind of sucks, and if you don't specify same-origin, it tries to treat it as a CORS request.
> Also note that this request completely bypasses the sandbox.
As far as I recall, extension processes don't have filesystem sandboxing yet, so as long as it doesn't work from content scripts, that's not too surprising.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1420296#c7)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> This isn't exactly unexpected. If the extension has the <all\_urls>
> permission, it has same origin permissions for file: URLs,
Maybe we should change that? :-)
> so this is pretty much the way it should work.
I mean, that wfm, but then we need to be clearer about expectations here, and this doesn't really explain to me why the add-on has to (apparently?) jump through hoops to read files...

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1420296#c8)• 7 years ago |
|  | |

(In reply to :Gijs from [comment #7](/show_bug.cgi?id=1420296#c7 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> > This isn't exactly unexpected. If the extension has the <all\_urls>
> > permission, it has same origin permissions for file: URLs,
>
> Maybe we should change that? :-)
We should, but it's basically blocked on [bug 1246236](/show_bug.cgi?id=1246236 "NEW - Implement local filesystem read/write access."), and figuring out how we want to deal with filesystem access. I suppose we could add an exception, and ignore file: URL permissions for requests but still allow them for content scripts and such, but I'm not super happy about the idea...
> > so this is pretty much the way it should work.
>
> I mean, that wfm, but then we need to be clearer about expectations here,
> and this doesn't really explain to me why the add-on has to (apparently?)
> jump through hoops to read files...
They have to jump through hoops to make any cross-origin requests that don't support CORS. Like I said, our fetch() support kind of sucks.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1420296#c9)• 7 years ago |
|  | |

Allowing the ability to read arbitrary files, by default is surprising and hard to justify from a security model perspective. Am I missing something here? Why does fetch() fail, and fetch({mode:'same-origin'}). I was taken completely by surprise about this, and I have been looking at web extensions for months. On one hand we say file:// is forbidden [1] but we do clearly state that match patterns will match on file:/// [2]
Regardless, default access to file:/// that bypasses the sandbox is risky and means extensions undermine the sandbox. At a minimum I think, we need to have users opt-in to extensions being allow to read file: URIs. Something like with a checkbox or menu option in about:addons. (Actually I thought there was a bug on file for that but I can't find it).
[1] <https://wiki.mozilla.org/WebExtensions/Filesystem>
[2] <https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Match_patterns>

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a9266_434339)• 7 years ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1420296#c10)• 7 years ago |
|  | |

There's no default access to file: URLs. Extensions can access file: URLs if they have permissions for those URLs listed in their manifests, which works the same way for file: URLs as it does for other URLs.
For the third time: fetch() can only fetch those URLs in same-origin mode because our fetch() support sucks, and by default it tries to make a CORS request, which file: URLs don't support, rather than a same-origin request that leverages the extension permissions. Requests to http: URLs work the same way.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1420296#c11)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #10](/show_bug.cgi?id=1420296#c10 "VERIFIED FIXED - Webextensions can access local files"))
> There's no default access to file: URLs. Extensions can access file: URLs if
> they have permissions for those URLs listed in their manifests, which works
> the same way for file: URLs as it does for other URLs.
Right, but we don't tell the user that in the prompt that is shown for <all\_urls>.
>
> For the third time: fetch() can only fetch those URLs in same-origin mode
> because our fetch() support sucks, and by default it tries to make a CORS
> request, which file: URLs don't support, rather than a same-origin request
> that leverages the extension permissions. Requests to http: URLs work the
> same way.
Sorry I missed [comment 6](/show_bug.cgi?id=1420296#c6 "VERIFIED FIXED - Webextensions can access local files"), and thus didnt understand [comment 8](/show_bug.cgi?id=1420296#c8 "VERIFIED FIXED - Webextensions can access local files").
(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #6](/show_bug.cgi?id=1420296#c6 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Paul Theriault [:pauljt] from [comment #5](/show_bug.cgi?id=1420296#c5 "VERIFIED FIXED - Webextensions can access local files"))
> > (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> > blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> > > This isn't exactly unexpected. If the extension has the <all\_urls>
> > > permission, it has same origin permissions for file: URLs, so this is pretty
> > > much the way it should work.
> >
> > Why does this ONLY work when you set the 'same-origin' flag.
>
> Because our fetch support kind of sucks, and if you don't specify
> same-origin, it tries to treat it as a CORS request.
>
> > Also note that this request completely bypasses the sandbox.
>
> As far as I recall, extension processes don't have filesystem sandboxing
> yet, so as long as it doesn't work from content scripts, that's not too
> surprising.
Ok I didn't know that - I thought that all content processes had the same rules, except for the one for loading File:// uris.
I guess Jim can clarify there.
In any case, I think we need to \_something\_ here. My preference would be to deny file:// access by default, and allow the user to opt-in. Not sure how complex that is though, so maybe in the meantime, perhaps we should improve the permission prompt to at least advise the user that the extension can read your local files.

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1420296#c12)• 7 years ago |
|  | |

Changing the permission prompt is a bit of a rabbit hole with quite a few problems (how do you message people who installed this already, for example). I think we should deny this case, uplift it to 58 (if possible) and work with the ACE team to message affected add-ons.
Then we keep on the course of figuring out, with all the relevant teams, what use cases for file access to allow and how to do that in the future.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a477904_279663)• 7 years ago |

Flags: needinfo?(jmathies)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1420296#c14)• 7 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #11](/show_bug.cgi?id=1420296#c11 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #10](/show_bug.cgi?id=1420296#c10 "VERIFIED FIXED - Webextensions can access local files"))
> > There's no default access to file: URLs. Extensions can access file: URLs if
> > they have permissions for those URLs listed in their manifests, which works
> > the same way for file: URLs as it does for other URLs.
>
> Right, but we don't tell the user that in the prompt that is shown for
> <all\_urls>.
I think that's the crux of the problem. Not that extensions shouldn't be able to read files (if given permission it's a valid thing to do in some cases) but that many/most users will be thinking "Web" when they see that prompt and will not expect "rummage around on my disk" to be part of it. That is, do we need to add a "<file\_urls>" permission?Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1420296#c15)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #14](/show_bug.cgi?id=1420296#c14 "VERIFIED FIXED - Webextensions can access local files"))
> I think that's the crux of the problem. Not that extensions shouldn't be
> able to read files (if given permission it's a valid thing to do in some
> cases) but that many/most users will be thinking "Web" when they see that
> prompt and will not expect "rummage around on my disk" to be part of it.
> That is, do we need to add a "<file\_urls>" permission?
I think we should probably make the <all\_urls> permission not apply to files, and require extensions to explicitly specify file://\*/. And we should probably require that to be an optional permission.

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1420296#c16)• 7 years ago |
|  | |

The question of how we expose local files to be read is a question for a few groups (security, UX, product) and doing it on a security restricted bug is probably not the best way to get to a solution. There's some good stuff here but I think we should probably stick to the focus of shutting off local file access to fetch in this bug and moving the rest of the discussion to a public bug or forum.

|  | [Jonathan Kingston [:jkt] he/him](/user_profile?user_id=563455) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1420296#c17)• 7 years ago |
|  | |

I probably have some spare cycles to shut off the file access here if no one else gets to it before me.
I had some ideas about how we can handle files but as :andym mentioned we can discuss elsewhere after this is resolved.

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1420296#c18)• 7 years ago |
|  | |

I think baku and catalinb would have thoughts here, too.Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a1813672_446257)• 7 years ago |

Assignee: nobody → amarchesiniFlags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1420296#c19)• 7 years ago |
|  | |

Attached patch

[file\_same\_origin.patch](attachment.cgi?id=8936952&action=diff)
— [Details](attachment.cgi?id=8936952&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1420296&attachment=8936952)

The spec says that:
"To perform a scheme fetch using request, switch on request’s current url’s scheme, and run the associated steps: [...] file: For now, unfortunate as it is, file and ftp URLs are left as an exercise for the reader."
Let's force no-cors for file URLs.
[Attachment #8936952](/attachment.cgi?id=8936952&action=edit "file_same_origin.patch") -
Flags: review?(bkelly)

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1420296#c20)• 7 years ago |
|  | |

Why does no-cors mode help here if we treat the principal's as same-origin? A no-cors request can return a basic response if it's same-origin.

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1420296#c21)• 7 years ago |
|  | |

Comment on [attachment 8936952](/attachment.cgi?id=8936952 "file_same_origin.patch") [[details]](/attachment.cgi?id=8936952&action=edit "file_same_origin.patch") [[diff]](/attachment.cgi?id=8936952&action=diff "file_same_origin.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420296&attachment=8936952)
file\_same\_origin.patch
I think this is a bug in our security checks and we probably should not try to paper over them here. This patch relies on this particular bug to work. I think I understand what is going wrong and will post a follow-up comment with details.
[Attachment #8936952](/attachment.cgi?id=8936952&action=edit "file_same_origin.patch") -
Flags: review?(bkelly) → review-

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1420296#c22)• 7 years ago |
|  | |

So, both 'cors' and 'no-cors' mode reject because we end up calling DoCheckLoadURIChecks() here:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/dom/security/nsContentSecurityManager.cpp#724>
This in turn ends up calling CheckLoadURIFlags() eventually which checks URI\_IS\_LOCAL\_FILE:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/caps/nsScriptSecurityManager.cpp#938>
This block ends up failing and the file URL is blocked as intended. Note, this is done \*before\* checking for URI\_LOADABLE\_BY\_ANYONE.
For 'same-origin' mode, though, we do not call DoCheckLoadURIChecks(). Instead we call DoSOPChecks() which basically calls NS\_HasBeenCrossOrigin():
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/dom/security/nsContentSecurityManager.cpp#711>
Which then ends up calling BasePrincipal::CheckMayLoad(). This happily accepts any URL if URI\_FETCHABLE\_BY\_ANYONE is set:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/caps/BasePrincipal.cpp#152>
As Kris mentioned, web extensions set this flag based on manifest data:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/netwerk/protocol/res/ExtensionProtocolHandler.cpp#382>
This seems like a policy or security check problem. I don't think trying to fix this in fetch() is the right place.

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1420296#c23)• 7 years ago |
|  | |

To clarify what I think is at least one problem:
In the cross-origin security checks we explicitly check for and disallow file URLs. In same-origin security checks we don't do this because we assume they will be cross-origin and fail anyway. The flag breaks that assumption, though.

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1420296#c24)• 7 years ago |
|  | |

Other same-origin requests I see in the tree which would be able to touch local files:
\* worker scripts
\* HTMLTrackElement
\* Some FontFace loading code
\* nsManifestCheck
\* etc
These probably don't have the simple attack vector of fetch(), but I think we should fix them in a way that addressed them all if we can.

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a2020369_446257)• 7 years ago |

Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1420296#c25)• 7 years ago |
|  | |

Boris, I think Bens assessment in [comment 22](/show_bug.cgi?id=1420296#c22 "VERIFIED FIXED - Webextensions can access local files") and [comment 23](/show_bug.cgi?id=1420296#c23 "VERIFIED FIXED - Webextensions can access local files") is correct. I think it wouldn't hurt to also explicitly add an disallow file URL access check to same origin checks. I assume the problem was just the assumption that SOP checks would fail file: loads because they are considered cross-origin anyway, right?Flags: needinfo?(ckerschb) → needinfo?(bzbarsky)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1420296#c26)• 7 years ago |
|  | |

Can you also add a test, at least for high level local file access through WebExtensions, and maybe unit tests for the content security checks, please? :)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1420296#c27)• 7 years ago |
|  | |

I am not actually following [comment 22](/show_bug.cgi?id=1420296#c22 "VERIFIED FIXED - Webextensions can access local files"). That "FETCHABLE\_BY\_ANYONE" flag would be on the \_uri\_, not the \_principal\_. Webextensions set that on \_webextension\_ URIs, which doesn't obviously have anything to do with attempts to load file:// URIs.
I have a slightly different question. Why is file:// special? Can extensions use this same mechanism to get at chrome:// URIs or whatnot?
Or put another way, should <all\_urls> basically mean "all URLs that are URI\_LOADABLE\_BY\_ANYONE", as opposed to "all URLs"? That will presumably restrict it to the things users expect....Flags: needinfo?(bzbarsky)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1420296#c28)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Daniel Veditz [:dveditz] from [comment #14](/show_bug.cgi?id=1420296#c14 "VERIFIED FIXED - Webextensions can access local files"))
> > I think that's the crux of the problem. Not that extensions shouldn't be
> > able to read files (if given permission it's a valid thing to do in some
> > cases) but that many/most users will be thinking "Web" when they see that
> > prompt and will not expect "rummage around on my disk" to be part of it.
> > That is, do we need to add a "<file\_urls>" permission?
>
> I think we should probably make the <all\_urls> permission not apply to
> files, and require extensions to explicitly specify file://\*/. And we should
> probably require that to be an optional permission.
FWIW I like this proposal, even though it differs from chrome.
I'm here though now, to bring up [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") which complicates the fix here slightly i think (at least i think this bug will depend on 1427448).Depends on: [1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url")

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1420296#c29)• 7 years ago |
|  | |

This seems to have stalled, it got listed as sec-moderate but a P1 by the WebExtensions team, so it keeps popping up in triages for us. Should we drop the priority down to reflect the sec- status? Is there anything we can do to help move this forward baku?

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1420296#c30)• 7 years ago |
|  | |

I think the fix is probably more in Christoph's wheelhouse in the security manager. Christoph, can you take this?Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1420296#c31)• 7 years ago |
|  | |

(In reply to Ben Kelly [:bkelly] from [comment #30](/show_bug.cgi?id=1420296#c30 "VERIFIED FIXED - Webextensions can access local files"))
> I think the fix is probably more in Christoph's wheelhouse in the security
> manager. Christoph, can you take this?
Unfortunately I don't have the cycles to tackle this one at the moment. I guess we have to lower the priority until we get more engineering power back in content security.Flags: needinfo?(ckerschb)

|  | [Jan Biniok](/user_profile?user_id=547788)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a6467898_547788)• 7 years ago |

Flags: needinfo?(jan)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1420296#c32)• 7 years ago |
|  | |

(In reply to Andy McKay [:andym] from [comment #29](/show_bug.cgi?id=1420296#c29 "VERIFIED FIXED - Webextensions can access local files"))
> This seems to have stalled, it got listed as sec-moderate but a P1 by the
> WebExtensions team, so it keeps popping up in triages for us. Should we drop
> the priority down to reflect the sec- status? Is there anything we can do to
> help move this forward baku?
No, keep it P1 - this is fundamental inconsistency in the security model. Either we need to fix this, or we need to make it clear that web extensions are allowed to read files from the file system. Web Extension bugs tend to get lower rating due to exploitation being predicated on installing a malicious extension - not a huge barrier, but more than if the issue was web exploitable. So while only being moderate in the scheme of firefox, I'd say this should be a P1 in the context of web extensions.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1420296#c33)• 7 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #28](/show_bug.cgi?id=1420296#c28 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files"))
> > (In reply to Daniel Veditz [:dveditz] from [comment #14](/show_bug.cgi?id=1420296#c14 "VERIFIED FIXED - Webextensions can access local files"))
> > > I think that's the crux of the problem. Not that extensions shouldn't be
> > > able to read files (if given permission it's a valid thing to do in some
> > > cases) but that many/most users will be thinking "Web" when they see that
> > > prompt and will not expect "rummage around on my disk" to be part of it.
> > > That is, do we need to add a "<file\_urls>" permission?
> >
> > I think we should probably make the <all\_urls> permission not apply to
> > files, and require extensions to explicitly specify file://\*/. And we should
> > probably require that to be an optional permission.
>
> FWIW I like this proposal, even though it differs from chrome.
>
> I'm here though now, to bring up [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") which complicates the fix here
> slightly i think (at least i think this bug will depend on 1427448).
What's needed to move ahead with this proposal? I don't think the fix for [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") will necessarily make much of a difference here. AIUI to fix this type of thing, we'd need to:
1) add a new permission for <file\_urls>
2) require it to be optional
3) in CAPS, when the triggering/subject principal is an add-on and the target URI chain has the local file flag, check if the add-on has the relevant permission
Does that sound right? Do we need further buy-in on this plan to move forward here?Flags: needinfo?(kmaglione+bmo)Flags: needinfo?(ddurst)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1420296#c34)• 7 years ago |
|  | |

(In reply to :Gijs from [comment #33](/show_bug.cgi?id=1420296#c33 "VERIFIED FIXED - Webextensions can access local files"))
> What's needed to move ahead with this proposal? I don't think the fix for
> [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") will necessarily make much of a difference here. AIUI to fix
> this type of thing, we'd need to:
>
> 1) add a new permission for <file\_urls>
> 2) require it to be optional
> 3) in CAPS, when the triggering/subject principal is an add-on and the
> target URI chain has the local file flag, check if the add-on has the
> relevant permission
>
> Does that sound right? Do we need further buy-in on this plan to move
> forward here?
No. <all\_urls> should still match file URLs, and so should file://\*
What we need is a separate setting that allows users to opt into giving an extension access to local files, similar to what Chrome does. I don't particularly care when/where we prompt users to opt into this, but the status of that permission should at least be displayed on the add-on's about:addons detail page, and be togglable there.Flags: needinfo?(kmaglione+bmo)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1420296#c35)• 7 years ago |
|  | |

(In reply to :Gijs from [comment #33](/show_bug.cgi?id=1420296#c33 "VERIFIED FIXED - Webextensions can access local files"))
> 3) in CAPS, when the triggering/subject principal is an add-on and the
> target URI chain has the local file flag, check if the add-on has the
> relevant permission
Which means adding a new boolean flag to WebExtensionPolicy[1] and checking it in MatchPattern[2]. Which probably means adding an optional policy property to MatchPattern instances.
[1]: <https://searchfox.org/mozilla-central/source/dom/webidl/WebExtensionPolicy.webidl>
[2]: <https://searchfox.org/mozilla-central/rev/d03ad8843e3bf2e856126bc53b0475c595e5183b/toolkit/components/extensions/MatchPattern.cpp#405>

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1420296#c36)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> No. <all\_urls> should still match file URLs, and so should file://\*
To me this seems like the opposite of what [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files") said:
(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files"))
> I think we should probably make the <all\_urls> permission not apply to
> files, and require extensions to explicitly specify file://\*/. And we should
> probably require that to be an optional permission.
Can you clarify what you mean more precisely?Flags: needinfo?(kmaglione+bmo)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a7203326_446257)• 7 years ago |

Assignee: amarchesini → nobody

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1420296#c37)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to :Gijs from [comment #33](/show_bug.cgi?id=1420296#c33 "VERIFIED FIXED - Webextensions can access local files"))
...
>
> What we need is a separate setting that allows users to opt into giving an
> extension access to local files, similar to what Chrome does. I don't
> particularly care when/where we prompt users to opt into this, but the
> status of that permission should at least be displayed on the add-on's
> about:addons detail page, and be togglable there.
We just spoke about this at all hands, and as asked Im adding my strong support for the approach suggested by Kris above (i.e. a toggle where users can OPT IN to allowing extensions to have file access, and prevent access in the regular case).

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1420296#c38)• 7 years ago |
|  | |

With a side note that, in addition to preventing direct loading of file:// uris, we also need to prevent extensions open in tabs with file:// URIs (and then injecting a content script into it). From a discussion here it sounds like we don't want to still allow extensions even without the "file access" granted to inject content scripts into tabs with File:// uris that the USER opened. (im not super pumped about that, but it sounds also you shouldn't have to grant a random extension access to your file system, just so that it can inject some content script into the one specific document you opened from the file system.

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a17961711_546015)• 7 years ago |

Product: Toolkit → WebExtensions

|  | [David Durst [:ddurst]](/user_profile?user_id=500559) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a18039021_500559)• 7 years ago |

Assignee: nobody → kmaglione+bmoFlags: needinfo?(ddurst)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1420296#c39)• 7 years ago |
|  | |

I'm going to handle the back-end portion of this. I might punt the front-end portion to Mark, since I have a lot of things on my plate at the moment.Flags: needinfo?(kmaglione+bmo)

|  | [Jan Biniok](/user_profile?user_id=547788)  Reporter |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1420296#c40)• 7 years ago |
|  | |

> I'm going to handle the back-end portion of this.
Does "this" mean to prevent content script file:// access by default \_AND\_ to implement "a toggle where users can OPT IN to allowing extensions to have file access"?
I'm asking because the first "fix" will break Tampermonkey's ability to install scripts from local file URIs unless content scripts that are defined at the manifest are exempted from this change.
Thanks, Jan
{
"manifest\_version": 2,
...
"content\_scripts":
[
{...}, {
"js": [
"rea/content.js"
],
"matches": [ "file:///\*.user.js" ],
"run\_at": "document\_start"
}
],
...
}

|  | [David Durst [:ddurst]](/user_profile?user_id=500559) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a30576910_500559)• 6 years ago |

Assignee: kmaglione+bmo → tomica

|  | [David Durst [:ddurst]](/user_profile?user_id=500559) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a30577845_500559)• 6 years ago |

Mentor: kmaglione+bmo

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1420296#c41)• 6 years ago |
|  | |

I'm looking into this, but there are several linked bugs that I can't access. Can someone please go through [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"), [bug 1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?"), and [bug 1316343](/show_bug.cgi?id=1316343 "RESOLVED FIXED"), and CC me to those pertinent to this issue?
(In reply to Kris Maglione [:kmag] from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> What we need is a separate setting that allows users to opt into giving an
> extension access to local files, similar to what Chrome does. I don't
> particularly care when/where we prompt users to opt into this, but the
> status of that permission should at least be displayed on the add-on's
> about:addons detail page, and be togglable there.
Do we want this as a new "public" permission, or just an internal flag that extension can never request, and can only be manually toggled though the UI?
And what should we do with already installed extensions in either case?
(In reply to Paul Theriault [:pauljt] from [comment #38](/show_bug.cgi?id=1420296#c38 "VERIFIED FIXED - Webextensions can access local files"))
> With a side note that, in addition to preventing direct loading of file://
> uris, we also need to prevent extensions open in tabs with file:// URIs (and
> then injecting a content script into it). From a discussion here it sounds
> like we don't want to still allow extensions even without the "file access"
> granted to inject content scripts into tabs with File:// uris that the USER
> opened. (im not super pumped about that, but it sounds also you shouldn't
> have to grant a random extension access to your file system, just so that it
> can inject some content script into the one specific document you opened
> from the file system.
I don't understand this the way it's worded. And it seems all of the discussion in this bug is about direct access to reading local files, content scripts are a separate issue, and can be a separate bug.
(In reply to Kris Maglione [:kmag] from [comment #39](/show_bug.cgi?id=1420296#c39 "VERIFIED FIXED - Webextensions can access local files"))
> I might punt the front-end portion to Mark
This can be done in a separate public bug, if it needs to involve UX and/or others, right?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1420296#c42)• 6 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files"))
> I'm looking into this, but there are several linked bugs that I can't
> access. Can someone please go through [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"), [bug 1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?"), and bug
> 1316343, and CC me to those pertinent to this issue?
Done this for you, can't comment on the other stuff.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1420296#c43)• 6 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files"))
> I'm looking into this, but there are several linked bugs that I can't
> access. Can someone please go through [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"), [bug 1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?"), and bug
> 1316343, and CC me to those pertinent to this issue?
>
>
>
> (In reply to Kris Maglione [:kmag] from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> > What we need is a separate setting that allows users to opt into giving an
> > extension access to local files, similar to what Chrome does. I don't
> > particularly care when/where we prompt users to opt into this, but the
> > status of that permission should at least be displayed on the add-on's
> > about:addons detail page, and be togglable there.
>
> Do we want this as a new "public" permission, or just an internal flag that
> extension can never request, and can only be manually toggled though the UI?
>
> And what should we do with already installed extensions in either case?
>
>
>
> (In reply to Paul Theriault [:pauljt] from [comment #38](/show_bug.cgi?id=1420296#c38 "VERIFIED FIXED - Webextensions can access local files"))
> > With a side note that, in addition to preventing direct loading of file://
> > uris, we also need to prevent extensions open in tabs with file:// URIs (and
> > then injecting a content script into it). From a discussion here it sounds
> > like we don't want to still allow extensions even without the "file access"
> > granted to inject content scripts into tabs with File:// uris that the USER
> > opened. (im not super pumped about that, but it sounds also you shouldn't
> > have to grant a random extension access to your file system, just so that it
> > can inject some content script into the one specific document you opened
> > from the file system.
>
> I don't understand this the way it's worded. And it seems all of the
> discussion in this bug is about direct access to reading local files,
> content scripts are a separate issue, and can be a separate bug.
Sorry, my comment is barely readable. I meant that we should have a holistic approach to restricting file system access. If we close this fetch hole, but still allow extensions to open and interact with tabs which have a file:// url open, then extensions will still have read access to the file system (since file: uris are treated as same-origin as files in the same directory). But you are right, that perhaps should be a separate bug.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1420296#c44)• 6 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #43](/show_bug.cgi?id=1420296#c43 "VERIFIED FIXED - Webextensions can access local files"))
> (since file: uris are treated as same-origin as files in the same
> directory)
We should just finally fix this - [bug 803143](/show_bug.cgi?id=803143 "RESOLVED FIXED - Local files can access other files in the same directory").

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1420296#c45)• 6 years ago |
|  | |

ni? to Kris and Mike for what to do with already installed extensions here ([comment 41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files")), similar to the situation about private browsing being solved right now.

Flags: needinfo?(mconca)Flags: needinfo?(kmaglione+bmo)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a41820253_1689)• 6 years ago |

Group: toolkit-core-security → firefox-core-security

|  | [Mike Conca [:mconca]](/user_profile?user_id=599100) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1420296#c46)• 6 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #45](/show_bug.cgi?id=1420296#c45 "VERIFIED FIXED - Webextensions can access local files"))

> ni? to Kris and Mike for what to do with already installed extensions here ([comment 41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files")), similar to the situation about private browsing being solved right now.

This particular question is being rolled up into a larger discussion around exactly how/when extensions can access local files.

Flags: needinfo?(mconca)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1420296#c47)• 6 years ago |
|  | |

I'm confused by this bug; the docs describe a function to check this capability: <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension/isAllowedFileSchemeAccess> and describe "the user-controlled 'Allow access to File URLs' checkbox" (on <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension#getURL()> )

Are the docs incorrect or has much of what has been discussed in this bug been implemented?

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1420296#c48)• 6 years ago |
|  | |

(In reply to Tom Ritter [:tjr] from [comment #47](/show_bug.cgi?id=1420296#c47 "VERIFIED FIXED - Webextensions can access local files"))

> I'm confused by this bug; the docs describe a function to check this capability: <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension/isAllowedFileSchemeAccess> and describe "the user-controlled 'Allow access to File URLs' checkbox" (on <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension#getURL()> )
>
> Are the docs incorrect or has much of what has been discussed in this bug been implemented?

That currently only applies to Chrome, who we inherited this API from.

Flags: needinfo?(kmaglione+bmo)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a50601475_279663)• 6 years ago |

Depends on: [803143](/show_bug.cgi?id=803143 "RESOLVED FIXED - Local files can access other files in the same directory")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a54501379_279663)• 5 years ago |

Whiteboard: webext-sec

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a60819031_279663)• 5 years ago |

Assignee: tomica → nobody

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1420296#c49)• 5 years ago |
|  | |

I'm currently unable to reproduce this with either the stack overflow example from [comment 0](/show_bug.cgi?id=1420296#c0 "VERIFIED FIXED - Webextensions can access local files") or the simplified version in [comment 3](/show_bug.cgi?id=1420296#c3 "VERIFIED FIXED - Webextensions can access local files").

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1420296#c50)• 5 years ago |
|  | |

I can still reproduce on Linux with Nightly 72.0a1, buildID 20191021215155 .

1. manifest.json with

```
    "name": "Extension with file access",
    "version": "1",
    "manifest_version": 2,
    "background": {"scripts": ["bg.js"]},
    "permissions": ["file:///*"]
}

```

2. bg.js

```
async function test() {
    let r = await fetch('file:///etc/passwd', {mode:'same-origin'});
    let t = await r.text();
    console.log(t)
}
test();

```

Result: The content of `/etc/passwd`.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1420296#c51)• 5 years ago |
|  | |

If I add a catch on the fetch, I get "TypeError: NetworkError when attempting to fetch resource.".

Nightly OSX 10.14

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1420296#c52)• 5 years ago |
|  | |

So, I am still unable to reproduce this on osx regardless of the privacy.file\_unique\_origin value. However, on a fresh profile, same extension, I can reproduce this on linux. Either it is unrelated to file\_unique\_origin or it is linux specific. Due to this, I'll set my vm to dealing with windows for the rest of the afternoon.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1420296#c53)• 5 years ago |
|  | |

Attached file
[fileaccess.xpi](attachment.cgi?id=9105000)
— [Details](attachment.cgi?id=9105000&action=edit)

This xpi does two fetches, one that is just normal (was making sure I didn't have some stupid problem) and one that does a file fetch. This same xpi fails to fetch the file on osx, but works fine on linux.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1420296#c54)• 5 years ago |
|  | |

How do I check whether I'm reproducing with that extension? I installed the extension, started the browser, loaded example.com, but I don't know which console it's logging to and hence whether it's managing to do the fetches...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1420296#c55)• 5 years ago |
|  | |

Ah, nevermind. If I add some `dump()` calls I can see it running at startup. Poking at things...

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1420296#c56)• 5 years ago |
|  | |

This reproduces on Windows 10 and latest Nightly 72 from today.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1420296#c57)• 5 years ago |
|  | |

So the `fetch('file:///etc/passwd')` call happens in a content process. The triggering principal (and loading principal) for the fetch is a ContentPrincipal with the URI `"moz-extension://01cf4af3-f9f4-4f63-8222-1f2c1db5bffb/_generated_background_page.html"`.

We end up in `ContentPrincipal::MayLoadInternal` and the `AddonAllowsLoad` call there returns true, because the `WebExtensionPolicy::CanAccessURI` call returns true. Given the manifest claims `"file:///*"` in the permissions this doesn't seem surprising, right? Anyway, that means `BasePrincipal::CheckMayLoad` returns true, and that's our general "Should this principal be considered same-origin with this URI?" method. So we consider this a same-origin load (e.g. `NS_HasBeenCrossOrigin` returns false, so `DoSOPChecks` returns success, so `nsContentSecurityManager::CheckChannel` returns success, so the load is allowed.

After things things Just Work: the fetch successfully opens the `FileChannelChild` channel, that remotes the actual filesystem access to the parent process (which is why sandboxing is nor relevant), etc.

Is there some expectation that given our current code this should *not* work?

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1420296#c58)• 5 years ago |
|  | |

`fetch('file:///etc/passwd');` does not load the resource (and neither does `XMLHttpRequest`) - this is desired as explained below.

`fetch('file:///etc/passwd', {mode:'same-origin'});` does load the resource.

They should behave consistently.

`file:///*` is automatically granted when the `<all_urls>` permission is requested, which is very common.

Most of the extensions that request `<all_urls>` don't really need file access.

I'd like to block file access by default unless a user explicitly consented, to protect the general population whose add-ons don't need to access files.

(FWIW, in Chrome `<all_urls>` also includes `file:///*`, but access is withheld until the user manually grants access at the extension management page.)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a62984924_447061)• 5 years ago |

Assignee: nobody → robStatus: NEW → ASSIGNED

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1420296#c59)• 5 years ago |
|  | |

Next week (or maybe the week after, at the start of release cycle of 73), I intend to land a patch that closes this hole.

The hole does already not work on macOS ([comment 49](/show_bug.cgi?id=1420296#c49 "VERIFIED FIXED - Webextensions can access local files")), and starting with my patch, it won't work either on Linux, Windows and Android.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1420296#c60)• 5 years ago |
|  | |

Attached file
[Bug 1420296 - Add file check to WebExtensionPolicy](attachment.cgi?id=9111270)
— [Details](attachment.cgi?id=9111270&action=edit)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1420296#c61)• 5 years ago |
|  | |

Attached file
[Bug 1420296 - Add tests for file access from extensions](attachment.cgi?id=9111271)
— [Details](attachment.cgi?id=9111271&action=edit)

Content scripts are allowed to run on file:-URLs, but other forms of

file access from extensions are not allowed. This has been the behavior

for a while, but there were no tests. This commit adds tests to ensure

that the functionality continues to work as intended.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1420296#c62)• 5 years ago |
|  | |

Attached file
[Bug 1420296 - Test for same-origin file requests](attachment.cgi?id=9111273)
— [Details](attachment.cgi?id=9111273&action=edit)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1420296#c63)• 5 years ago |
|  | |

* [comment 60](/show_bug.cgi?id=1420296#c60 "VERIFIED FIXED - Webextensions can access local files") is a fix for this bug and [bug 1487353](/show_bug.cgi?id=1487353 "RESOLVED FIXED - Extensions can run content scripts in local files and read any other local file") (a unit test is attached in that other bug).
* [comment 61](/show_bug.cgi?id=1420296#c61 "VERIFIED FIXED - Webextensions can access local files") is a set of unit tests that already pass, independently of the bugfix. These tests were added to make sure that content scripts for files do not regress.
* [comment 61](/show_bug.cgi?id=1420296#c61 "VERIFIED FIXED - Webextensions can access local files") is a regression test for this bug, and should land in the future, when this bug becomes public.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a63221681_447061)• 5 years ago |

Blocks: [1487353](/show_bug.cgi?id=1487353 "RESOLVED FIXED - Extensions can run content scripts in local files and read any other local file")

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1420296#c64)• 5 years ago |
|  | |

The patch in [comment 60](/show_bug.cgi?id=1420296#c60 "VERIFIED FIXED - Webextensions can access local files") seems fine, but I want to understand answers to a few questions beforehand:

1. This proposed fix is different than the agreed consensus in most of this bug, up to and including your second-to-last [comment 58](/show_bug.cgi?id=1420296#c58 "VERIFIED FIXED - Webextensions can access local files"), which was putting this access behind a special permission prompt/checkbox. Why did you change your approach? Given recent urgency in [bug 1598946](/show_bug.cgi?id=1598946 "ASSIGNED"), should we bundle the two bugs together, behind the same optional permission?
2. Why doesn't this work on MacOS? Is it a recent "regression", or some configuration/platform difference?
3. I'm looking up code related to [comment 23](/show_bug.cgi?id=1420296#c23 "VERIFIED FIXED - Webextensions can access local files"), perhaps this cross-origin check should be lower in the chain to cover more than just addons usecase.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1420296#c65)• 5 years ago |
|  | |

(In reply to :Tomislav Jovanovic :zombie from [comment #64](/show_bug.cgi?id=1420296#c64 "VERIFIED FIXED - Webextensions can access local files"))

> The patch in [comment 60](/show_bug.cgi?id=1420296#c60 "VERIFIED FIXED - Webextensions can access local files") seems fine, but I want to understand answers to a few questions beforehand:
>
> 1. This proposed fix is different than the agreed consensus in most of this bug, up to and including your second-to-last [comment 58](/show_bug.cgi?id=1420296#c58 "VERIFIED FIXED - Webextensions can access local files"), which was putting this access behind a special permission prompt/checkbox. Why did you change your approach? Given recent urgency in [bug 1598946](/show_bug.cgi?id=1598946 "ASSIGNED"), should we bundle the two bugs together, behind the same optional permission?

I implemented it like this because it fixes file:-access related bugs without breaking known supported cases.

We probably still want to support a prompt/checkbox, but that requires more efforts and review/feedback cycles. That fits better in [bug 1598946](/show_bug.cgi?id=1598946 "ASSIGNED") or a follow-up to that bug (and some of the ideas expressed here already align with the tentative plan).

> 2. Why doesn't this work on MacOS? Is it a recent "regression", or some configuration/platform difference?

The paths that we tested were blocked by the sandbox on macOS. If I choose a [whitelisted location](https://searchfox.org/mozilla-central/rev/efdf9bb55789ea782ae3a431bda6be74a87b041e/security/sandbox/mac/SandboxPolicyContent.h#70), e.g. `file:///usr/share/` , then the load is still accepted.

> 3. I'm looking up code related to [comment 23](/show_bug.cgi?id=1420296#c23 "VERIFIED FIXED - Webextensions can access local files"), perhaps this cross-origin check should be lower in the chain to cover more than just addons usecase.

I'm not aware of any other generic file:-whitelisting other than extensions. Judged by extension permissions only, `file:`-access should have been allowed (and is so, according to `WebExtensionPolicy::CanAccessURI`). But we don't have a separate permission warning or any other obvious indication that an extension is allowed access to local files, so it was a nice "feature" that `file:`-URLs were somehow already blocked access (through `fetch` / `XMLHttpRequest`) despite being allowed by `CanAccessURI`. The patch changes the implementation of `CanAccessURI` to match the current default behavior for cors-fetches, and does it at that place to cover most scenarios (without affecting content scripts, for which we want to continue supporting access). If we ever decide to open up file:-access (rather than restricting it), then we probably need to revisit the implementation, but until then, I'd rather be on the safe side.

I think that file:-access to extensions can be a useful feature in some cases, but it should by no means be the silent default behavior.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1420296#c66)• 5 years ago |
|  | |

What's your advice on landing the patches?

I want to land two patches, the fix itself, and unit tests that verifies that the supported behaviors are still working as intended.

Do you think that it is fine to land the following at the same time:

* <https://phabricator.services.mozilla.com/D54541> (tests that already passed before the fix)
* <https://phabricator.services.mozilla.com/D54540> (fix itself)

(and the regression test in the future - <https://phabricator.services.mozilla.com/D54543> ).

... or should I only land the fix now, and land the tests later?

One interesting point to consider is that the bug itself has been public for over two years by now:

<https://stackoverflow.com/questions/42108782/firefox-webextensions-get-local-files-content-by-path/44516256#44516256>

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1420296#c67)• 5 years ago |
|  | |

Given the public stackoverflow item I'm fine with you landing all of it at once, including D54543.

Flags: needinfo?(dveditz)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1420296#c68)• 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/b4cc65a4d11e4569ea64670d24e38ef6c88a075e>

<https://hg.mozilla.org/mozilla-central/rev/b4cc65a4d11e>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 5 years ago
[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla73

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1420296#c69)• 5 years ago |
|  | |

I've only landed the already-passing tests; I'll land the other parts once I've verified that the impact on extensions is minimal.

Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a65194422_575867)• 5 years ago |

[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=affected)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1420296#c70)• 5 years ago |
|  | |

I checked all public add-ons on AMO, and the following add-ons are relying on this bug / "feature". I've listed the number of users and the use cases:

* <https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/> 323k users
  + To import local files in scripts: <https://github.com/Tampermonkey/tampermonkey/issues/347>
* <https://addons.mozilla.org/en-US/firefox/addon/s3download-statusbar/> 82k users (recommended badge)
  + To read files for checksum calculations and image preview.
* <https://addons.mozilla.org/en-US/firefox/addon/styl-us/> 77k users (recommended badge)
  + To support installation of local user styles: <https://github.com/openstyles/stylus/pull/134>
* <https://addons.mozilla.org/en-US/firefox/addon/exif-viewer/> 35k users
  + Used to view metadata of local files.
* <https://addons.mozilla.org/en-US/firefox/addon/foxreplace/> 7k users
  + Used to automatically update by reading from a local file.
* <https://addons.mozilla.org/en-US/firefox/addon/surfingkeys_ff/> (version <= 0.9.41) 1k users
  + Used to read settings from a local file: <https://github.com/brookhong/Surfingkeys/pull/891>
  + Author removed the code in the latest versions (including 0.9.57) when they discovered that the functionality does not work on macOS.
* and a couple of smaller ones.

The total number of users is about 500k. Since the functionality is already not working on macOS, and the loss of use cases is not extremely critical, I'll land the patch that disables local file access, next week.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1420296#c71)• 5 years ago |
|  | |

Many of those affected addons would be better served with `<input type=file>`, it seems.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1420296#c72)• 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/a32b39b12097218637d33cb0f6ac86e8d93366aa>

<https://hg.mozilla.org/mozilla-central/rev/a32b39b12097>

Status: REOPENED → RESOLVEDClosed: 5 years ago → 5 years ago
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: mozilla73 → mozilla74

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1420296#c73)• 5 years ago |
|  | |

Doesn't feel like the kind of change we'd want to land on an ESR branch, but should we consider uplifting this to Beta for Fx73?

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix)Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1420296#c74)• 5 years ago |
|  | |

This vulnerability has been public for multiple years, and consequently some extensions rely on it for legitimate reasons. I want to let it ride the trains to give add-on developers the opportunity to work with the limitations.

Flags: needinfo?(rob)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a67577739_75935)• 5 years ago |

[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a67712091_553429)• 5 years ago |

Flags: qe-verify+Whiteboard: webext-sec → webext-sec [post-critsmash-triage]

|  | [Miruna Curtean](/user_profile?user_id=642772) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1420296#c75)• 5 years ago |
|  | |

Verified fixed using the fileaccess.xpi extension provided in [comment 53](/show_bug.cgi?id=1420296#c53 "VERIFIED FIXED - Webextensions can access local files") On Windows 10 Pro 64-bit, MacOS Catalina 10.15 and Ubuntu 16.04 LTS on FF 74.0a1 (20200121215203).

Checked through loading the extension from about debugging and inspecting it on a fixed version and also installing it (after setting xpinstall.signatures.required to false) in about:addons on a Nightly build from before the push and then upgrading the browser.

A security error declaring that data may not be loaded from "file:///etc/passwd" is logged in the extension console log after the fix.

Status: RESOLVED → VERIFIED
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a71989444_578488)• 5 years ago |

Whiteboard: webext-sec [post-critsmash-triage] → webext-sec [post-critsmash-triage][adv-main74+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1420296#c76)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9131374)
— [Details](attachment.cgi?id=9131374&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a72295880_578488)• 5 years ago |

Alias: CVE-2020-6809

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1420296#c77)• 5 years ago |
|  | |

Test for same-origin file requests:

<https://hg.mozilla.org/integration/autoland/rev/823481edb95885927d150b4584ecfe639022830b>

<https://hg.mozilla.org/mozilla-central/rev/823481edb958>

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a72540371_447061)• 5 years ago |

Regressions: [1621935](/show_bug.cgi?id=1621935 "RESOLVED FIXED - webRequest listeners are not called for subresources loaded by file:// pages")

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a80929187_580382)• 5 years ago |

Regressions: [1644488](/show_bug.cgi?id=1644488 "RESOLVED INVALID - content scripts cannot fetch contents of file URIs")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a96862731_1689)• 4 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1420296&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_f08fe526_20250119_120159.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1432856)
* [XML](/show_bug.cgi?ctype=xml&id=1432856)

Closed
[Bug 1432856](/show_bug.cgi?id=1432856)
(CVE-2020-6810)

Opened 7 years ago
Closed 5 years ago

# Popup window can cover fullscreen security UI

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Popup window can cover fullscreen security UI

## Categories

### (Core :: DOM: Core & HTML, defect, P3)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

57 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla74

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix) |
| firefox72 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix) |
| firefox73 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix) |
| firefox74 | --- | [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox72 |  | wontfix |
| firefox73 |  | wontfix |
| firefox74 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: avi, Assigned: emz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/46f58cc04758e80835820f0f1d5646bb?d=mm&size=40)  [emz](/user_profile?user_id=636491)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/f33071d6cbc294ca88eb887099e02595?d=mm&size=40)  [avi](/user_profile?user_id=14310)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b89a42ca4c4d59c27f33c399bb1ecc7b?d=mm&size=40)  [farre](/user_profile?user_id=566192)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1613065](/show_bug.cgi?id=1613065 "RESOLVED FIXED - Popup focus request not honored when called from fullscreen")

[1609896](/show_bug.cgi?id=1609896 "NEW - Log warning to web console when leaving fullscreen due to popup window")

Dependency [tree](/showdependencytree.cgi?id=1432856&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1432856)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1613065](/show_bug.cgi?id=1613065 "RESOLVED FIXED - Popup focus request not honored when called from fullscreen"), [1712038](/show_bug.cgi?id=1712038 "RESOLVED FIXED - YouTube Video Automatically Exits Full-Screen Mode When Another YouTube Tab Opened in Background Finish Loading With Fission Enabled")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1437219](/show_bug.cgi?id=1437219 "RESOLVED DUPLICATE - Addressbar spoofing attack with using fullscreen (popup show up over fullscreen mode and hide the fullscreen notification)"), [1596189](/show_bug.cgi?id=1596189 "RESOLVED DUPLICATE - Website opens popups in fullscreen and tricks user into installing add-on")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=776418 "https://bugs.chromium.org/p/chromium/issues/detail?id=776418")

## Details

### (Keywords: csectype-spoof, sec-moderate, Whiteboard: [parity Chrome and Edge][post-critsmash-triage][adv-main74+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-6810

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[parity Chrome and Edge][post-critsmash-triage][adv-main74+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (9 files, 2 obsolete files)

| [fullscreenpopuptest.html](/attachment.cgi?id=8945145)  [7 years ago](#c0)  [Avi Drissman](/user_profile?user_id=14310)   933 bytes, text/html |  | [Details](/attachment.cgi?id=8945145&action=edit) |
| --- | --- | --- |
| [Bug 1432856 - Exit full-screen on window.open() and window.focus() when fs security warning is visible. r=smaug](/attachment.cgi?id=9080659)  [5 years ago](#c15)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9080659&action=edit) | [Review](/attachment.cgi?id=9080659) |
| [Bug 1432856 - Leave DOM fullscreen on window.open(). r=smaug](/attachment.cgi?id=9113472)  [5 years ago](#c17)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9113472&action=edit) | [Review](/attachment.cgi?id=9113472) |
| [Bug 1432856 - Leave DOM fullscreen on window raise. r=smaug](/attachment.cgi?id=9113473)  [5 years ago](#c18)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9113473&action=edit) | [Review](/attachment.cgi?id=9113473) |
| [Bug 1432856 - Extended focus methods in Window.webidl, Client.webidl and Element.webidl to pass CallerType. r=smaug](/attachment.cgi?id=9113475)  [5 years ago](#c19)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9113475&action=edit) | [Review](/attachment.cgi?id=9113475) |
| [Bug 1432856 - Added prefs for DOM fullscreen leave on window open or raise. r=smaug](/attachment.cgi?id=9113476)  [5 years ago](#c20)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9113476&action=edit) | [Review](/attachment.cgi?id=9113476) |
| [Bug 1432856 - Added console logging for DOM fullscreen leave on window raise. r=smaug](/attachment.cgi?id=9113477)  [5 years ago](#c21)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9113477&action=edit) | [Review](/attachment.cgi?id=9113477) |
| [Bug 1432856 - Added tests for window open and focus in fullscreen. r=smaug](/attachment.cgi?id=9114590)  [5 years ago](#c23)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9114590&action=edit) | [Review](/attachment.cgi?id=9114590) |
| [Bug 1432856 - Disable fullscreen leave on raise and open for fullscreen-multiple test. r=smaug](/attachment.cgi?id=9116232)  [5 years ago](#c24)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9116232&action=edit) | [Review](/attachment.cgi?id=9116232) |
| [advisory.txt](/attachment.cgi?id=9131370)  [5 years ago](#c33)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   453 bytes, text/plain |  | [Details](/attachment.cgi?id=9131370&action=edit) |
| [advisory.txt](/attachment.cgi?id=9131381)  [5 years ago](#c34)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   459 bytes, text/plain |  | [Details](/attachment.cgi?id=9131381&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Avi Drissman](/user_profile?user_id=14310)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1432856#c0)• 7 years ago |
|  | |

Attached file
[fullscreenpopuptest.html](attachment.cgi?id=8945145)
— [Details](attachment.cgi?id=8945145&action=edit)

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_11\_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3315.3 Safari/537.36
Steps to reproduce:
Hello. I am Avi Drissman on the Chrome security team. While investigating a security issue in Chrome, I found that Firefox is also vulnerable. The issue is <https://crbug.com/776418> . While I'm happy to allow any Firefox security people access to that bug, I will explain the issue entirely in this bug.
When you take a page in Chrome into fullscreen, a bubble is shown at the top of the screen, saying "hey, you're in fullscreen, tap the escape key to get out". Chrome considers this to be security UI. Firefox has a similar bubble, and I imagine you consider this bubble to be security UI as well.
Obscuring that bubble would be bad. Therefore, if a page tries to open a popup while it is fullscreen, Chrome drops fullscreen. Firefox has the same behavior, and I again imagine it is for the same reason.
However, suppose a page opens a popup while not in fullscreen. If the page is subsequently taken to fullscreen, and then the page uses window.focus() to focus the popup, the popup is shown on top of the fullscreened page, and it obscures the fullscreen security UI bubble.
I attach a sample HTML page that will allow you to reproduce this behavior.
The original Chrome bug report has a very elaborate reproduction that spoofs Chrome UI to induce the user to click on the original page. Please be assured that limits on user gestures will not help here.
The solution that Chrome will be taking will be to kick a page out of fullscreen if it attempts to do any focusing of popups. Edge already has this behavior, and so I recommend that Firefox adopt this behavior.
In addition, I'm proposing this behavior to be standardized; see <https://github.com/whatwg/fullscreen/issues/116> .
Please feel free to contact me (avi@google.com/avi@chromium.org) with any questions you may have.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1432856#c1)• 7 years ago |
|  | |

We have a bug on making window.focus() kick us out of fullscreen. Was used as an abuse technique--this fullscreen thing is new to us. When I find that again I'll make this bug depend on it.Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)See Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=776418>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a88197_1689)• 7 years ago |

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1432856#c2)• 7 years ago |
|  | |

Actually we have conflicting bugs about window.focus() and fullscreen, but the one I was vaguely remembering is not this bug.Group: firefox-core-security → dom-core-securityComponent: Untriaged → DOM: Core & HTMLFlags: needinfo?(dveditz)Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---)Product: Firefox → CoreWhiteboard: [parity Chrome and Edge]

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a214667_373403)• 7 years ago |

Flags: needinfo?(xidorn+moz)

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1432856#c3)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #2](/show_bug.cgi?id=1432856#c2 "VERIFIED FIXED - Popup window can cover fullscreen security UI"))
> Actually we have conflicting bugs about window.focus() and fullscreen, but
> the one I was vaguely remembering is not this bug.
I guess you were thinking about [bug 1196588](/show_bug.cgi?id=1196588 "NEW - The fullscreen reminder shows up every time that you switch to Firefox") and probably [bug 724554](/show_bug.cgi?id=724554 "RESOLVED FIXED - Don't exit fullscreen when focusing window on different display").
(In reply to Avi Drissman from [comment #0](/show_bug.cgi?id=1432856#c0 "VERIFIED FIXED - Popup window can cover fullscreen security UI"))
> Created [attachment 8945145](/attachment.cgi?id=8945145 "fullscreenpopuptest.html") [[details]](/attachment.cgi?id=8945145&action=edit "fullscreenpopuptest.html")
> fullscreenpopuptest.html
This test page is great. Thanks!
> Obscuring that bubble would be bad. Therefore, if a page tries to open a
> popup while it is fullscreen, Chrome drops fullscreen. Firefox has the same
> behavior, and I again imagine it is for the same reason.
It doesn't seem to me that we do, at least I cannot reproduce this behavior on Windows. There may be some other behavior on other platforms due to certain code path, but I believe it's not intended.
It's not clear to me how the mechanism you proposed would work, or specifically, where should we put the check in when someone invokes window.focus(). I guess there are several options:
(1) kick out any fullscreen document when anyone invokes an effective window.focus()
(2) kick out any fullscreen document of an origin when another window of that origin is raised by an effective window.focus()
(3) kick out fullscreen document when anything in the stack calling into window.focus() is related to that document
So, 3 is complicated, and not enough, because one can always ask other document to do this in an async way, although that may be rejected by the popup abuse protection we have for window.focus(), but nothing in the spec really stops it from happening.
(1) and (2) seem to be too strict to me. I think there are valid usecase for a fullscreen document to open a popup or something like that, e.g. when you are doing presentation, and you want to show another page in a new window.
IIUC, the problem we want to solve is that, the security UI should not be blocked by anything when we show it. In that sense, I think we can solve it in an easier way:
\* when we about to show the security UI, we check that we do have the focus, if not, kick the document out from fullscreen, and
\* when the notification is on screen, if we lose the focus, kick the document out from fullscreen.
That should solve the security concern here without adding much complexity to the platform logic, I believe. And the spec just need to make developers aware in the section of "Security and Privacy Considerations".Flags: needinfo?(xidorn+moz)

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1432856#c4)• 7 years ago |
|  | |

Daniel, what do you think about the solution I proposed at the end of [comment 3](/show_bug.cgi?id=1432856#c3 "VERIFIED FIXED - Popup window can cover fullscreen security UI")?Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1432856#c5)• 7 years ago |
|  | |

(In reply to Xidorn Quan [:xidorn] UTC+10 from [comment #3](/show_bug.cgi?id=1432856#c3 "VERIFIED FIXED - Popup window can cover fullscreen security UI"))
> > the one I was vaguely remembering is not this bug.
>
> I guess you were thinking about [bug 1196588](/show_bug.cgi?id=1196588 "NEW - The fullscreen reminder shows up every time that you switch to Firefox") and probably [bug 724554](/show_bug.cgi?id=724554 "RESOLVED FIXED - Don't exit fullscreen when focusing window on different display").
I think I was thinking of conversations the Security Engineering team has had about Chrome's Intent to Implement
<https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/8Z36QLPkCd0/xrGkjvLcAAAJ>
But also see [bug 1437219](/show_bug.cgi?id=1437219 "RESOLVED DUPLICATE - Addressbar spoofing attack with using fullscreen (popup show up over fullscreen mode and hide the fullscreen notification)")
> (2) kick out any fullscreen document of an origin when another window of
> that origin is raised by an effective window.focus()
Restricting it to the same origin wouldn't stop abuse -- easy to make sure the other window is on a different but confederate domain.
> IIUC, the problem we want to solve is that, the security UI should not be
> blocked by anything when we show it. In that sense, I think we can solve it
> in an easier way:
> \* when we about to show the security UI, we check that we do have the focus,
> if not, kick the document out from fullscreen, and
> \* when the notification is on screen, if we lose the focus, kick the
> document out from fullscreen.
That sounds great.Flags: needinfo?(dveditz)

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1432856#c6)• 7 years ago |
|  | |

ni? myself for implementing this.Flags: needinfo?(xidorn+moz)

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a18977296_240353)• 6 years ago |

Blocks: [1437219](/show_bug.cgi?id=1437219 "RESOLVED DUPLICATE - Addressbar spoofing attack with using fullscreen (popup show up over fullscreen mode and hide the fullscreen notification)")

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1432856#c7)• 6 years ago |
|  | |

I am not sure if Xidorn has bandwidth to implement this since he's not full-time employee.

NI Ethan to put this into the security team's radar.

Flags: needinfo?(xidorn+moz) → needinfo?(ettseng)Priority: -- → P3

|  | [Ethan Tseng [:ethan]](/user_profile?user_id=473897) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1432856#c8)• 6 years ago |
|  | |

Johann, this is an issue that our team can handle?

Flags: needinfo?(ettseng) → needinfo?(jhofmann)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1432856#c10)• 6 years ago |
|  | |

Paul might be able to give it a shot, but to set expectations this is more of a backlog item for us. I'll add it to the list :)

Flags: needinfo?(jhofmann)

|  | [Ethan Tseng [:ethan]](/user_profile?user_id=473897) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1432856#c11)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1432856&comment_id=14043486 "1 revision") |
|  | |

(In reply to Johann Hofmann [:johannh] from [comment #10](/show_bug.cgi?id=1432856#c10 "VERIFIED FIXED - Popup window can cover fullscreen security UI"))

> Paul might be able to give it a shot, but to set expectations this is more of a backlog item for us. I'll add it to the list :)

Sounds good. Thanks!

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a37995757_522029)• 6 years ago |

No longer blocks: [1437219](/show_bug.cgi?id=1437219 "RESOLVED DUPLICATE - Addressbar spoofing attack with using fullscreen (popup show up over fullscreen mode and hide the fullscreen notification)")

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1432856#c12)• 6 years ago |
|  | |

Thanks! I indeed may not have bandwidth to work on this myself at the moment, but I'm always happy to answer any question and possibly review the code, so feel free to flag me if there's anything I can help!

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a41634759_636491)• 6 years ago |

Assignee: nobody → pbzStatus: NEW → ASSIGNED

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1432856#c13)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1432856&comment_id=14135483 "1 revision") |
|  | |

> IIUC, the problem we want to solve is that, the security UI should not be
>
> blocked by anything when we show it. In that sense, I think we can solve it
>
> in an easier way:
>
> * when we about to show the security UI, we check that we do have the focus,
>
>   if not, kick the document out from fullscreen, and
> * when the notification is on screen, if we lose the focus, kick the
>
>   document out from fullscreen.

I've done some testing and also implemented this behaviour by listening for the `blur` event. However this can interfere with normal usage. For example, opening a Video in fullscreen and then doing something on a secondary monitor would cause the browser to leave fullscreen.

I think the approach Chromium uses, to leave fullscreen on `window.open()` and also on `window.focus()` might be a good solution. Alternatively we could only behave this way while the fullscreen warning is shown.

|  | [Xidorn Quan [:xidorn] UTC+10](/user_profile?user_id=373403) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1432856#c14)• 6 years ago |
|  | |

> I think the approach Chromium uses, to leave fullscreen on window.open() and also on window.focus() might be a good solution.

It might be a good solution but I also think there can be reasonable usecase triggering this. A imaginary case, for example, if user is watching a sample movie in fullscreen, and when it comes to part requiring payment, the website may pop up a payment window, and when the payment finishes, user can continue the movie in fullscreen.

> Alternatively we could only behave this way while the fullscreen warning is shown.

That's exactly what I meant.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1432856#c15)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Exit full-screen on window.open() and window.focus() when fs security warning is visible. r=smaug](attachment.cgi?id=9080659) (obsolete)
— [Details](attachment.cgi?id=9080659&action=edit)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1432856#c16)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1432856&comment_id=14517854 "1 revision") |
|  | |

Apologies for the delayed update on this. I've looked into various options and also submitted a patch, but I'm not happy with it yet. Only leaving fullscreen when the fs warning is on screen requires a lot of refactoring, since we only know about the fs warning state in the frontend. The event has to be passed all the way through the focus manager to the frontend code. This includes extending the webidl interfaces to pass caller type (if the open/focus was triggered by the website or the system).

Going for Chromiums approach and exiting fullscreen on `window.open` and `window.focus`, would make for a much cleaner patch. We could handle everything in the backend. It would also help with other 'evil traps' where websites abuse popups in fullscreen to trick users into installing addons ([Bug 1596189](/show_bug.cgi?id=1596189 "RESOLVED DUPLICATE - Website opens popups in fullscreen and tricks user into installing add-on")).

While there are some valid use cases for popups in fullscreen this wouldn't fully break workflows. Websites are aware of the fullscreen state and can avoid this behavior; given the market share of Chromium based browsers they already do. An example use case is Google Slides, where the user can open speaker notes in a popup. In Chromium, if the notes window is opened while in (DOM) fullscreen, the fullscreen is cancelled and the user has to enter it again. That's an extra click.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1432856#c17)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Leave DOM fullscreen on window.open(). r=smaug](attachment.cgi?id=9113472)
— [Details](attachment.cgi?id=9113472&action=edit)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1432856#c18)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Leave DOM fullscreen on window raise. r=smaug](attachment.cgi?id=9113473)
— [Details](attachment.cgi?id=9113473&action=edit)

Depends on D55809

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1432856#c19)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Extended focus methods in Window.webidl, Client.webidl and Element.webidl to pass CallerType. r=smaug](attachment.cgi?id=9113475)
— [Details](attachment.cgi?id=9113475&action=edit)

Depends on D55810

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1432856#c20)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Added prefs for DOM fullscreen leave on window open or raise. r=smaug](attachment.cgi?id=9113476)
— [Details](attachment.cgi?id=9113476&action=edit)

Depends on D55811

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1432856#c21)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Added console logging for DOM fullscreen leave on window raise. r=smaug](attachment.cgi?id=9113477)
— [Details](attachment.cgi?id=9113477&action=edit)

Depends on D55812

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a58656357_600971)• 5 years ago |

[Attachment #9080659](/attachment.cgi?id=9080659&action=edit "Bug 1432856 - Exit full-screen on window.open() and window.focus() when fs security warning is visible. r=smaug") -
Attachment is obsolete: true

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1432856#c22)• 5 years ago |
|  | |

That seems reasonable to me. Thank you for all the work, Paul.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1432856#c23)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Added tests for window open and focus in fullscreen. r=smaug](attachment.cgi?id=9114590)
— [Details](attachment.cgi?id=9114590&action=edit)

Depends on D55813

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a59442329_600971)• 5 years ago |

[Attachment #9113477](/attachment.cgi?id=9113477&action=edit "Bug 1432856 - Added console logging for DOM fullscreen leave on window raise. r=smaug") -
Attachment description: Bug 1432856 - Added console logging for DOM fullscreen leave on window open or raise. → Bug 1432856 - Added console logging for DOM fullscreen leave on window open or raise. r=smaug

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1432856#c24)• 5 years ago |
|  | |

Attached file
[Bug 1432856 - Disable fullscreen leave on raise and open for fullscreen-multiple test. r=smaug](attachment.cgi?id=9116232)
— [Details](attachment.cgi?id=9116232&action=edit)

Depends on D56391

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1432856#c25)• 5 years ago |
|  | |

Backed out for build bustages failures in nsWindow.h:

<https://hg.mozilla.org/integration/autoland/rev/d94afce0c18b72e8febfaa68a21fcb7790d1118c>

Build failure: <https://treeherder.mozilla.org/#/jobs?repo=autoland&selectedJob=281441289&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&revision=3d08c3cce53325d6623178e60d1ca5d38b4721c5>

/builds/worker/workspace/build/src/widget/cocoa/nsChildView.h:310:16: error: 'SetFocus' marked 'override' but does not override any member functions

/builds/worker/workspace/build/src/widget/cocoa/nsChildView.h:282:7: error: abstract class is marked 'final' [-Werror,-Wabstract-final-class]

/builds/worker/workspace/build/src/widget/cocoa/nsChildView.h:310:16: error: 'nsChildView::SetFocus' hides overloaded virtual function [-Werror,-Woverloaded-virtual]

/builds/worker/workspace/build/src/widget/cocoa/nsCocoaWindow.h:235:16: error: 'SetFocus' marked 'override' but does not override any member functions

/builds/worker/workspace/build/src/widget/cocoa/nsCocoaWindow.h:207:7: error: abstract class is marked 'final' [-Werror,-Wabstract-final-class]

/builds/worker/workspace/build/src/widget/cocoa/nsCocoaWindow.h:235:16: error: 'nsCocoaWindow::SetFocus' hides overloaded virtual function [-Werror,-Woverloaded-virtual]

Eslint failure: <https://treeherder.mozilla.org/logviewer.html#?job_id=281436170&repo=autoland>

browser/base/content/test/fullscreen/open\_and\_focus\_helper.html:32:37 | Prefer boolean length check (mozilla/prefer-boolean-length-check)

Had landed before as

<https://hg.mozilla.org/integration/autoland/rev/a303b775a51b3df084ccd88d457ed2c0f8c7a4a3>

<https://hg.mozilla.org/integration/autoland/rev/8351a8b1d96ad8ff5b501d94b3b2c76c79db4293>

<https://hg.mozilla.org/integration/autoland/rev/c81f3d5b9bf33e648b9d7b4e427d1c9a8a10c38e>

<https://hg.mozilla.org/integration/autoland/rev/a8a4fa63f5b20f2dcc0b11e0496076e435c7e83c>

<https://hg.mozilla.org/integration/autoland/rev/62fc84c8ce9978f4df6d65ac6e8d8e4939b0bb65>

<https://hg.mozilla.org/integration/autoland/rev/49d03dd89b1759bdf28f50ad5330d5a2f9651803>

<https://hg.mozilla.org/integration/autoland/rev/3d08c3cce53325d6623178e60d1ca5d38b4721c5>

Flags: needinfo?(pbz)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a62276856_600971)• 5 years ago |

[Attachment #9113477](/attachment.cgi?id=9113477&action=edit "Bug 1432856 - Added console logging for DOM fullscreen leave on window raise. r=smaug") -
Attachment description: Bug 1432856 - Added console logging for DOM fullscreen leave on window open or raise. r=smaug → Bug 1432856 - Added console logging for DOM fullscreen leave on window raise. r=smaug

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a62373360_636491)• 5 years ago |

Flags: needinfo?(pbz)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1432856#c26)• 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/325eec16f032c255567b1081f941735677d9c5b2>

<https://hg.mozilla.org/integration/autoland/rev/f09a7b5da021be3b821e571fd8cb27db8d72dc63>

<https://hg.mozilla.org/integration/autoland/rev/5cb2b4727452b54b0ecf07c10178e01e1f8bc4a1>

<https://hg.mozilla.org/integration/autoland/rev/10fde12558b7cf7fb1f2849d8b2bdbf3b5b196c9>

<https://hg.mozilla.org/integration/autoland/rev/7594dab35ba4fcb5ce33e58cfae265aa76787f8d>

<https://hg.mozilla.org/integration/autoland/rev/03b7899094663bba35802764ac8f15d9f28f69da>

<https://hg.mozilla.org/integration/autoland/rev/a03b869d45a9680b63d45d96f217c2c476b20d09>

<https://hg.mozilla.org/mozilla-central/rev/325eec16f032>

<https://hg.mozilla.org/mozilla-central/rev/f09a7b5da021>

<https://hg.mozilla.org/mozilla-central/rev/5cb2b4727452>

<https://hg.mozilla.org/mozilla-central/rev/10fde12558b7>

<https://hg.mozilla.org/mozilla-central/rev/7594dab35ba4>

<https://hg.mozilla.org/mozilla-central/rev/03b789909466>

<https://hg.mozilla.org/mozilla-central/rev/a03b869d45a9>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 5 years ago
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla74

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a62441705_636491)• 5 years ago |

Blocks: [1609896](/show_bug.cgi?id=1609896 "NEW - Log warning to web console when leaving fullscreen due to popup window")

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a62454029_553429)• 5 years ago |

Flags: qe-verify+Whiteboard: [parity Chrome and Edge] → [parity Chrome and Edge][post-critsmash-triage]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1432856#c27)• 5 years ago |
|  | |

I see no reason to rush this fix to release. LMK if you feel strongly otherwise.

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix)
[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1432856#c28)• 5 years ago |
|  | |

Dan, Tom suggests in [bug 1596189 comment 17](/show_bug.cgi?id=1596189#c17 "RESOLVED DUPLICATE - Website opens popups in fullscreen and tricks user into installing add-on") that we should open up this bug and I think it makes sense. The patch is public and I think since the projected attack is mostly about spoofing or irritating the user, there's no risk of an "active exploit" appearing in the small window of time until the fix hits release. It made sense to keep it sensitive while the time to fix was unknown but now I don't think we're at risk.

If you agree, can you open this up, please?

Flags: needinfo?(dveditz)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1432856#c29)• 5 years ago |
|  | |

I have attempted verification with the "fullscreenpopuptest.html" attachment using the following steps:

1. Open browser.
2. Load the attachment (login to Bugzilla required).
3. Make sure that the browser window is on the primary screen (if more than one is being used).
4. Click on the "Make pop-up" button.
5. Click on the "Toggle fullscreen" button.
6. Click on the "Focus pop-up" button.

   Affected: The pop-up window is displayed and overlaps the full-screen related notification.

   Fixed: The pop-up window DOES NOT overlap the full-screen related notification. However, the user is forced to leave full-screen mode.

These are my results on Nightly v74.0a1 from 2020-01-31:

* Windows 10: The pop-up window DOES NOT overlap the full-screen related notification. However, the user is forced to leave full-screen mode. **Also, in this case, the pop-up does not stay in focus because the normal window gets focused after leaving full-screen mode.**
* Ubuntu 18.04: The pop-up window DOES NOT overlap the full-screen related notification. However, the user is forced to leave full-screen mode. Also, in this case, the pop-up will stay in focus (as seen in the Chrome browser).
* Mac OS 10.14.6: The pop-up window DOES NOT overlap the full-screen related notification. However, the user is forced to leave full-screen mode. **Also, in this case, the pop-up does not stay in focus because the normal window gets focused after leaving full-screen mode.**

Should a new bug be logged for the secondary issue seen on Windows 10 and Mac OS?

Status: RESOLVED → VERIFIED
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified)Flags: qe-verify+ → needinfo?(pbz)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1432856#c30)• 5 years ago |
|  | |

Hsin-Tsai, I am requesting information from you in hope that you could answer some questions regarding the fix. Which are:

One issue that I observed is that the browser will instantly leave the full-screen mode when the pop-up is focused, but I am assuming that this is the compromise we are making in favor of not covering the notification about exiting full-screen. Can you confirm this is a valid approach?

A second issue is that the pop-up that gets focused will lose its focus because the "normal" browser window will be focused when leaving full-screen mode. This issue occurs only on Windows and Mac OS. Is this a valid issue? Should it be logged?

Flags: needinfo?(htsai)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1432856#c31)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1432856&comment_id=14622418 "1 revision") |
|  | |

Thanks for verifying the fix!

(In reply to Bodea Daniel [:danibodea] from [comment #30](/show_bug.cgi?id=1432856#c30 "VERIFIED FIXED - Popup window can cover fullscreen security UI"))

> Hsin-Tsai, I am requesting information from you in hope that you could answer some questions regarding the fix. Which are:
>
> One issue that I observed is that the browser will instantly leave the full-screen mode when the pop-up is focused, but I am assuming that this is the compromise we are making in favor of not covering the notification about exiting full-screen. Can you confirm this is a valid approach?

Yes, this is the approach we opted for. See discussion above.

> A second issue is that the pop-up that gets focused will lose its focus because the "normal" browser window will be focused when leaving full-screen mode. This issue occurs only on Windows and Mac OS. Is this a valid issue? Should it be logged?

Yes, that's a bit inconsistent. The behavior on Linux is the correct one, we should honor the focus request, so the window should be in focus after leaving fullscreen. I've filed [Bug 1613065](/show_bug.cgi?id=1613065 "RESOLVED FIXED - Popup focus request not honored when called from fullscreen").

Flags: needinfo?(pbz)Flags: needinfo?(htsai)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a63996951_636491)• 5 years ago |

Blocks: [1613065](/show_bug.cgi?id=1613065 "RESOLVED FIXED - Popup focus request not honored when called from fullscreen")Regressions: [1613065](/show_bug.cgi?id=1613065 "RESOLVED FIXED - Popup focus request not honored when called from fullscreen")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a64553160_1689)• 5 years ago |

Group: core-security-releaseFlags: needinfo?(dveditz)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a66649846_578488)• 5 years ago |

Whiteboard: [parity Chrome and Edge][post-critsmash-triage] → [parity Chrome and Edge][post-critsmash-triage][adv-main74+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1432856#c33)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9131370) (obsolete)
— [Details](attachment.cgi?id=9131370&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1432856#c34)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9131381)
— [Details](attachment.cgi?id=9131381&action=edit)

[Attachment #9131370](/attachment.cgi?id=9131370&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a66956213_578488)• 5 years ago |

Alias: CVE-2020-6810

|  | [Edgar Chen [:edgar]](/user_profile?user_id=455480) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432856#a105808900_455480)• 4 years ago |

Regressions: [1712038](/show_bug.cgi?id=1712038 "RESOLVED FIXED - YouTube Video Automatically Exits Full-Screen Mode When Another YouTube Tab Opened in Background Finish Loading With Fission Enabled")
You need to [log in](/show_bug.cgi?id=1432856&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Avi Drissman](/user_profile?user_id=14310)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250119_134611.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)


