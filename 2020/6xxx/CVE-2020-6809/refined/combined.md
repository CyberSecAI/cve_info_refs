=== Content from wiki.mozilla.org_ef8238f3_20250119_134632.html ===


# BMO/UserGuide/Whiteboard

From MozillaWiki
< [BMO](/BMO "BMO")â€Ž | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)

Each bug has a free-form single line text entry box for adding tags and status information. This wiki page is dedicated to collect a comprehensive list of whiteboard tags used in the Mozilla project.

## Contents

* [1 Whiteboard considered harmful](#Whiteboard_considered_harmful)
* [2 Contributor mentoring](#Contributor_mentoring)
* [3 Automated Testing](#Automated_Testing)
* [4 Autonag](#Autonag)
* [5 Release Engineering](#Release_Engineering)
* [6 Sheriffing](#Sheriffing)
* [7 Firefox](#Firefox)
* [8 Community reported bugs](#Community_reported_bugs)
* [9 Firefox OS](#Firefox_OS)
* [10 Tor](#Tor)
* [11 Web Compatibility](#Web_Compatibility)
* [12 Scrum Development](#Scrum_Development)
* [13 What does this whiteboard keyword mean?](#What_does_this_whiteboard_keyword_mean?)
## Whiteboard considered harmful

It is recommended that you request alternative metadata instead of using whiteboard tagging.

* Updating whiteboards tags through the API is non-trivial
* There is no global auto-suggest for whiteboard tags
* There is no verification of whiteboard tags; typos will not be caught and prevented
* Renaming a whiteboard tag requires writing a script to update every bug with that tag, changing its last modified timestamp and generating bugmail; other solutions involve a simple change by administrators
* Whiteboard tags cannot be disabled; people might continue to provide them after they are no longer relevant thinking they still apply
* If desired it's possible to restrict who can set flags to particular values; it will never be possible to prevent accidental or other changes to the whiteboard from any user with editbugs or the bug's reporter

Consider using a keyword, a flag, or a status flag. You can request this on [Bugzilla](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).

## Contributor mentoring

For more information, see [Mentors](/Mentors "Mentors").

* `[lang=]`: The programming language involved for this bug.
* `[mentor-lang=]`: (human/natural) language other than English the mentor will be able to communicate to the contributor with.

## Automated Testing

* `[test disabled]`: Indicates an automated test has been disabled. Typically used in bugs filed for intermittent test failures, to indicate that the absence of new failures in the bug is due to the test being disabled - as well as remind module owners that the test needs fixing and re-enabling.

## Autonag

`[no-nag]`: Indicates that a bug should not be modified or commented in by our [Autonag](/Release_Management/autonag "Release Management/autonag") scripts.

## Release Engineering

* `[capacity]`: This bug will help increase (or free up) capacity for our automated build & test machines.

## Sheriffing

* `[leave open]`: This has [been deprecated](https://groups.google.com/forum/#!topic/mozilla.dev.platform/Ie9OXcWbTSs) in favour of the 'leave-open' keyword. Used to ensure that the bug updating tool mcMerge does not close the bug when commits referencing it are merged into mozilla-central.
* `[retriggered]`: Used by sheriffs when investigating Fresh Oranges [[1]](https://charts.mozilla.org/FreshOranges/index.html) to find where a failure started from, using backfills and retriggers

## Firefox

* `dupeme`, `dupme`, or `DUPEME`: we're pretty sure this bug report is a duplicate of another bug, but cannot recall which one or cannot find it.
* `[qa-]`: QE (Quality Engineering) verification not required - superseded by the qe-verify flag.
* `[adv-mainNN+]` (where `NN` is some number): a security advisory about this bug for the release `NN` will be (has been) written.
* `[MemShrink]`: [a project](/Performance/MemShrink "Performance/MemShrink") to reduce memory consumption.

## Community reported bugs

* `[nightly-community]`: This bug was reported by a member of the Firefox Nightly community. Used to triage community-reported bugs and measure the impact of our core community on product quality.
* `[mozfr-community]`: This bug was reported by a member of the MozFR French-speaking community. Used to evaluate the impact of the mozfr.org community on product quality.

## Firefox OS

[Template:Note: This project is no longer active, but we leave these definitions for bug tracker historian purposes](/index.php?title=Template:Note:_This_project_is_no_longer_active,_but_we_leave_these_definitions_for_bug_tracker_historian_purposes&action=edit&redlink=1 "Template:Note: This project is no longer active, but we leave these definitions for bug tracker historian purposes (page does not exist)")

* `[POVB]`: Part of vendor build; the fix of this bug is not in the Mozilla codebase, but it's in our interest to track it.
* `[priority]`: Indicates we are asked by a partner to address this issue with priority.
* `[tarako_only]`: Special pref or feature that only lands on branch for Tarako (low memory phone), i.e. 1.3T branch of Gaia and Gecko. To be picked up on future releases.
* `[p=]/[u=]/[c=]/[s=]`: See [Scrum Development](/BMO/Whiteboard#Scrum_Development "BMO/Whiteboard"). Firefox OS uses the u= tag as the milestone instead, see [Firefox OS Performance Triage](/FirefoxOS/Performance/Triage#Scrumbugs_Tags "FirefoxOS/Performance/Triage")
* `[ft:<name of the team>]`, `[systemsfe]`, etc: Bugs identified to be owned by a "functional team" within B2G engineering. Each team owns a specific set of Bugzilla components, and tags are used to denote owned bugs outside of these components.

## Tor

* `[tor ###]` Part of the [Tor uplift project](/Security/Tor_Uplift/Tracking "Security/Tor Uplift/Tracking"). For example, `[tor 16620]` indicates a corresponding ticket at <https://trac.torproject.org/16620>. See also <https://torpat.ch/uplift>

## Web Compatibility

[Our whiteboard keywords](/Compatibility/BugsGuide "Compatibility/BugsGuide") are already described.

## Scrum Development

The following flags are used by tools like [scrumbu.gs](https://scrumbu.gs/help/) for managing sprints using the scrum development framework:

* `[p=]`: A rough estimate from engineer on how long the bug is going to take.
* `[u=]`: The user (in the scrum sense) that this story affects
* `[c=]`: The component (in the scrum sense) that this story affects
* `[s=]`: An explicit sprint slug this bug should belong to.

If you are not managing a product, you probably don't have to set these.

## What does this whiteboard keyword mean?

If you know what one of the following whiteboard keywords means, please describe it and put it into one of the above categories above (or create a new one):

* `[2.0-FL-bug-bash]` (example: <https://bugzilla.mozilla.org/show_bug.cgi?id=1021384>)
* `[games]` (example: <https://bugzilla.mozilla.org/show_bug.cgi?id=1017892>)
* `[reserve-photon-structure]` ([examples](https://bugzilla.mozilla.org/buglist.cgi?list_id=14108939&status_whiteboard_type=substring&status_whiteboard=%5Breserve-photon-structure%5D&order=Bug%20Number&query_format=advanced))
* `[TCP]` (example: <https://bugzilla.mozilla.org/show_bug.cgi?id=920036>)
  + my guess: Tablet Contribution Program?

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/Whiteboard&oldid=1245932>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FWhiteboard "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/Whiteboard "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/Whiteboard&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/Whiteboard)
* [View source](/index.php?title=BMO/UserGuide/Whiteboard&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/Whiteboard&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/Whiteboard "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/Whiteboard "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/Whiteboard&oldid=1245932 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/Whiteboard&action=info "More information about this page")

* This page was last edited on 27 March 2023, at 15:08.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/Whiteboard&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_3659d679_20250119_134634.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")â€Ž | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_0d803829_20250119_120322.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2020-08

## Security Vulnerabilities fixed in Firefox 74

Announced
March 10, 2020
Impact
high
Products
Firefox
Fixed in

* Firefox 74

#### [#CVE-2020-6805: Use-after-free when removing data about origins](#CVE-2020-6805)

Reporter
Brian Carpenter
Impact
high
##### Description

When removing data about an origin whose tab was recently closed, a use-after-free could occur in the Quota manager, resulting in a potentially exploitable crash.

##### References

* [Bug 1610880](https://bugzilla.mozilla.org/show_bug.cgi?id=1610880)

#### [#CVE-2020-6806: BodyStream::OnInputStreamReady was missing protections against state confusion](#CVE-2020-6806)

Reporter
Sergei Glazunov of Google Project Zero
Impact
high
##### Description

By carefully crafting promise resolutions, it was possible to cause an out-of-bounds read off the end of an array resized during script execution. This could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1612308](https://bugzilla.mozilla.org/show_bug.cgi?id=1612308)

#### [#CVE-2020-6807: Use-after-free in cubeb during stream destruction](#CVE-2020-6807)

Reporter
C.M.Chang
Impact
high
##### Description

When a device was changed while a stream was about to be destroyed, the `stream-reinit` task may have been executed after the stream was destroyed, causing a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1614971](https://bugzilla.mozilla.org/show_bug.cgi?id=1614971)

#### [#CVE-2020-6808: URL Spoofing via javascript: URL](#CVE-2020-6808)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

When a JavaScript URL (javascript:) is evaluated and the result is a string, this string is parsed to create an HTML document, which is then presented. Previously, this document's URL (as reported by the document.location property, for example) was the originating javascript: URL which could lead to spoofing attacks; it is now correctly the URL of the originating document.

##### References

* [Bug 1247968](https://bugzilla.mozilla.org/show_bug.cgi?id=1247968)

#### [#CVE-2020-6809: Web Extensions with the all-urls permission could access local files](#CVE-2020-6809)

Reporter
Jan Biniok
Impact
moderate
##### Description

When a Web Extension had the all-urls permission and made a fetch request with a mode set to 'same-origin', it was possible for the Web Extension to read local files.

##### References

* [Bug 1420296](https://bugzilla.mozilla.org/show_bug.cgi?id=1420296)

#### [#CVE-2020-6810: Focusing a popup while in fullscreen could have obscured the fullscreen notification](#CVE-2020-6810)

Reporter
Avi Drissman of the Chrome security team
Impact
moderate
##### Description

After a website had entered fullscreen mode, it could have used a previously opened popup to obscure the notification that indicates the browser is in fullscreen mode. Combined with spoofing the browser chrome, this could have led to confusing the user about the current origin of the page and credential theft or other attacks.

##### References

* [Bug 1432856](https://bugzilla.mozilla.org/show_bug.cgi?id=1432856)

#### [#CVE-2020-6811: Devtools' 'Copy as cURL' feature did not fully escape website-controlled data, potentially leading to command injection](#CVE-2020-6811)

Reporter
Ophir LOJKINE
Impact
moderate
##### Description

The 'Copy as cURL' feature of Devtools' network tab did not properly escape the HTTP method of a request, which can be controlled by the website. If a user used the 'Copy as Curl' feature and pasted the command into a terminal, it could have resulted in command injection and arbitrary command execution.

##### References

* [Bug 1607742](https://bugzilla.mozilla.org/show_bug.cgi?id=1607742)

#### [#CVE-2019-20503: Out of bounds reads in sctp\_load\_addresses\_from\_init](#CVE-2019-20503)

Reporter
Natalie Silvanovich of Google Project Zero
Impact
moderate
##### Description

The inputs to `sctp_load_addresses_from_init` are verified by `sctp_arethere_unrecognized_parameters`; however, the two functions handled parameter bounds differently, resulting in out of bounds reads when parameters are partially outside a chunk.

##### References

* [Bug 1613765](https://bugzilla.mozilla.org/show_bug.cgi?id=1613765)

#### [#CVE-2020-6812: The names of AirPods with personally identifiable information were exposed to websites with camera or microphone permission](#CVE-2020-6812)

Reporter
Jan-Ivar Bruaroey
Impact
moderate
##### Description

The first time AirPods are connected to an iPhone, they become named after the user's name by default (e.g. Jane Doe's AirPods.) Websites with camera or microphone permission are able to enumerate device names, disclosing the user's name. To resolve this issue, Firefox added a special case that renames devices containing the substring 'AirPods' to simply 'AirPods'.

##### References

* [Bug 1616661](https://bugzilla.mozilla.org/show_bug.cgi?id=1616661)

#### [#CVE-2020-6813: @import statements in CSS could bypass the Content Security Policy nonce feature](#CVE-2020-6813)

Reporter
Matheus Vrech
Impact
low
##### Description

When protecting CSS blocks with the nonce feature of Content Security Policy, the @import statement in the CSS block could allow an attacker to inject arbitrary styles, bypassing the intent of the Content Security Policy.

##### References

* [Bug 1605814](https://bugzilla.mozilla.org/show_bug.cgi?id=1605814)

#### [#CVE-2020-6814: Memory safety bugs fixed in Firefox 74 and Firefox ESR 68.6](#CVE-2020-6814)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Byron Campen, Jason Kratzer, and Christian Holler reported memory safety bugs present in Firefox 73 and Firefox ESR 68.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 74 and Firefox ESR 68.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1592078%2C1604847%2C1608256%2C1612636%2C1614339)

#### [#CVE-2020-6815: Memory and script safety bugs fixed in Firefox 74](#CVE-2020-6815)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Jason Kratzer, Boris Zbarsky, Tyson Smith, and Alexandru Michis reported memory safety and script safety bugs present in Firefox 73. Some of these bugs showed evidence of memory corruption or escalation of privilege and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory and script safety bugs fixed in Firefox 74](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1181957%2C1557732%2C1557739%2C1611457%2C1612431)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_905c548a_20250119_120322.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  Â·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summaryâ–¾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View â–¾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1420296)
* [XML](/show_bug.cgi?ctype=xml&id=1420296)

Closed
[Bug 1420296](/show_bug.cgi?id=1420296)
(CVE-2020-6809)

Opened 7 years ago
Closed 5 years ago

# Webextensions can access local files

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Webextensions can access local files

## Categories

### (WebExtensions :: General, defect, P1)

[Product:](/describecomponents.cgi?product=WebExtensions)

WebExtensions
â–¾

WebExtensions
File feature requests and bugs related to the WebExtension add-on API.
[See Open Bugs in This Product](/buglist.cgi?product=WebExtensions&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=WebExtensions)
Watch This Product

[Component:](/describecomponents.cgi?product=WebExtensions&component=General#General)

General
â–¾

WebExtensions :: General
All other bugs about WebExtensions
[See Open Bugs in This Component](/buglist.cgi?product=WebExtensions&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=WebExtensions&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=WebExtensions&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

57 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### (firefox-esr68 wontfix, firefox72 wontfix, firefox73 wontfix, firefox74 verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla74

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix) |
| firefox72 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix) |
| firefox73 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix) |
| firefox74 | --- | [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox72 |  | wontfix |
| firefox73 |  | wontfix |
| firefox74 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

[Blocking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Blocking_Flags)

| webextensions | --- |
| --- | --- |

## People

### (Reporter: jan, Assigned: robwu, Mentored)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/30e26944b9b786ea16fce8b18394c6e4?d=mm&size=40)  [robwu](/user_profile?user_id=447061)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

![](https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=40)  [kmag](/user_profile?user_id=106098)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/922adfc5538ed07a332c6f248f30ffa1?d=mm&size=40)  [jan](/user_profile?user_id=547788)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2132cf6e7db0fa0e604b86d120c813ee?d=mm&size=40)  [zombie](/user_profile?user_id=445095)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

41 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[803143](/show_bug.cgi?id=803143 "RESOLVED FIXED - Local files can access other files in the same directory"), [1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1487353](/show_bug.cgi?id=1487353 "RESOLVED FIXED - Extensions can run content scripts in local files and read any other local file")

Dependency [tree](/showdependencytree.cgi?id=1420296&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1420296)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1621935](/show_bug.cgi?id=1621935 "RESOLVED FIXED - webRequest listeners are not called for subresources loaded by file:// pages"), [1644488](/show_bug.cgi?id=1644488 "RESOLVED INVALID - content scripts cannot fetch contents of file URIs")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: webext-sec [post-critsmash-triage][adv-main74+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-6809

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

webext-sec [post-critsmash-triage][adv-main74+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [btot](/user_profile?user_id=553429) | [qe-verify](#a67712091_553429 "5 years ago") | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [file\_same\_origin.patch](/attachment.cgi?id=8936952)  [7 years ago](#c19)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   1.12 KB, patch | bkelly : [review-](#c21 "7 years ago") | [Details](/attachment.cgi?id=8936952&action=edit) | [Diff](/attachment.cgi?id=8936952&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1420296&attachment=8936952) |
| --- | --- | --- |
| [fileaccess.xpi](/attachment.cgi?id=9105000)  [5 years ago](#c53)  [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685)   722 bytes, application/x-xpinstall |  | [Details](/attachment.cgi?id=9105000&action=edit) |
| [Bug 1420296 - Add file check to WebExtensionPolicy](/attachment.cgi?id=9111270)  [5 years ago](#c60)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9111270&action=edit) | [Review](/attachment.cgi?id=9111270) |
| [Bug 1420296 - Add tests for file access from extensions](/attachment.cgi?id=9111271)  [5 years ago](#c61)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9111271&action=edit) | [Review](/attachment.cgi?id=9111271) |
| [Bug 1420296 - Test for same-origin file requests](/attachment.cgi?id=9111273)  [5 years ago](#c62)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9111273&action=edit) | [Review](/attachment.cgi?id=9111273) |
| [advisory.txt](/attachment.cgi?id=9131374)  [5 years ago](#c76)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   250 bytes, text/plain |  | [Details](/attachment.cgi?id=9131374&action=edit) |

Bottom â†“
Tags â–¾

* Reset

Timeline â–¾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan Biniok](/user_profile?user_id=547788)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1420296#c0)â€¢ 7 years ago |
|  | |

User Agent: Mozilla/5.0 (X11; Linux x86\_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/62.0.3202.89 Chrome/62.0.3202.89 Safari/537.36
Steps to reproduce:
Try the code from this stack overflow answer at a webextension:
<https://stackoverflow.com/questions/42108782/firefox-webextensions-get-local-files-content-by-path/44516256#44516256>
And you'll see that it is possible to read local files without user interaction.
More information:
As far as I know this is at the moment used by Stylus and a beta version of Tampermonkey (my extension). At Tampermonkey it's necessary that the user \_explicitly\_ enables file access, just like it's necessary at Chrome, in order to use it.
However, since the stack overflow answer was posted on 2017-05-13, I guess there are some more extensions that use it. That's why and since AMO currently is using a faster/automatic review I'm a little bit concerned that other extension might use it in a non-good-natured way, because the review process is unable to detect it (in opposition to Firefox's legacy API add-ons where the reviewers took account of this).
Finally, please think about implementing user-permitted file \_read\_ access. It's one of the most requested features of Tampermonkey.
[https://bugzilla.mozilla.org/show\_bug.cgi?id=1246236](/show_bug.cgi?id=1246236 "NEW - Implement local filesystem read/write access.")
[https://bugzilla.mozilla.org/show\_bug.cgi?id=1266960](/show_bug.cgi?id=1266960 "NEW - Extensions can not load file: URLs")
Actual results:
It's possible to read local files without any user interaction.
Expected results:
It should (not/only after user confirmation) be possible to access local files.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1420296#c1)â€¢ 7 years ago |
|  | |

Only files under $HOME, or also elsewhere? (background: when e10s is enabled, I would expect sandboxing to prohibit accessing files outside of $HOME)Group: firefox-core-security â†’ toolkit-core-securityComponent: Untriaged â†’ WebExtensions: GeneralFlags: needinfo?(jan)Product: Firefox â†’ Toolkit

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1420296#c2)â€¢ 7 years ago |
|  | |

Looks like it can be anywhere in my testing of the function in Stylus.
<https://addons.mozilla.org/en-US/firefox/addon/styl-us/>
To reproduce
1) install stylus
2) go to about:debugging
3) click debug and in the browser console type something like:
download('file:///etc/passwd').then(e => console.log(e));
Output:
##
# User Database
#
# Note that this file is consulted directly only when the system is running
# in single-user mode. At other times this information is provided by
# Open Directory.
#
# See the opendirectoryd(8) man page for additional information about
# Open Directory.
##
nobody...
Also pinging Jim to let the sandboxing team know.Flags: needinfo?(kmaglione+bmo)Flags: needinfo?(jmathies)Priority: -- â†’ P1

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1420296#c3)â€¢ 7 years ago |
|  | |

This is a bug in fetch & web extension context, when the {mode:'same-origin'} flag is set. I wonder if it affects any other contexts.
MDN says: "same-origin â€” If a request is made to another origin with this mode set, the result is simply an error. You could use this to ensure that a request is always being made to your origin."
But somehow, moz-extension//{UUID} and file:// are considered same origin when you set this flag.
STR:
Run this script in the background context of any web extension.
var url = file:///SOME/LOCAL/FILE/PATH
fetch(url, {mode:'same-origin'}).then(f=>console.log("read file",f.url)).catch(e=> console.log('Error trying to read file'))
Expected:
Console: Error trying to read file
Actual
Console: read file file:///SOME/LOCAL/FILE/PATH

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1420296#c4)â€¢ 7 years ago |
|  | |

This isn't exactly unexpected. If the extension has the <all\_urls> permission, it has same origin permissions for file: URLs, so this is pretty much the way it should work.Flags: needinfo?(kmaglione+bmo)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1420296#c5)â€¢ 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> This isn't exactly unexpected. If the extension has the <all\_urls>
> permission, it has same origin permissions for file: URLs, so this is pretty
> much the way it should work.
Why does this ONLY work when you set the 'same-origin' flag.
Also note that this request completely bypasses the sandbox.

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1420296#c6)â€¢ 7 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #5](/show_bug.cgi?id=1420296#c5 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> > This isn't exactly unexpected. If the extension has the <all\_urls>
> > permission, it has same origin permissions for file: URLs, so this is pretty
> > much the way it should work.
>
> Why does this ONLY work when you set the 'same-origin' flag.
Because our fetch support kind of sucks, and if you don't specify same-origin, it tries to treat it as a CORS request.
> Also note that this request completely bypasses the sandbox.
As far as I recall, extension processes don't have filesystem sandboxing yet, so as long as it doesn't work from content scripts, that's not too surprising.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1420296#c7)â€¢ 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> This isn't exactly unexpected. If the extension has the <all\_urls>
> permission, it has same origin permissions for file: URLs,
Maybe we should change that? :-)
> so this is pretty much the way it should work.
I mean, that wfm, but then we need to be clearer about expectations here, and this doesn't really explain to me why the add-on has to (apparently?) jump through hoops to read files...

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1420296#c8)â€¢ 7 years ago |
|  | |

(In reply to :Gijs from [comment #7](/show_bug.cgi?id=1420296#c7 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> > This isn't exactly unexpected. If the extension has the <all\_urls>
> > permission, it has same origin permissions for file: URLs,
>
> Maybe we should change that? :-)
We should, but it's basically blocked on [bug 1246236](/show_bug.cgi?id=1246236 "NEW - Implement local filesystem read/write access."), and figuring out how we want to deal with filesystem access. I suppose we could add an exception, and ignore file: URL permissions for requests but still allow them for content scripts and such, but I'm not super happy about the idea...
> > so this is pretty much the way it should work.
>
> I mean, that wfm, but then we need to be clearer about expectations here,
> and this doesn't really explain to me why the add-on has to (apparently?)
> jump through hoops to read files...
They have to jump through hoops to make any cross-origin requests that don't support CORS. Like I said, our fetch() support kind of sucks.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1420296#c9)â€¢ 7 years ago |
|  | |

Allowing the ability to read arbitrary files, by default is surprising and hard to justify from a security model perspective. Am I missing something here? Why does fetch() fail, and fetch({mode:'same-origin'}). I was taken completely by surprise about this, and I have been looking at web extensions for months. On one hand we say file:// is forbidden [1] but we do clearly state that match patterns will match on file:/// [2]
Regardless, default access to file:/// that bypasses the sandbox is risky and means extensions undermine the sandbox. At a minimum I think, we need to have users opt-in to extensions being allow to read file: URIs. Something like with a checkbox or menu option in about:addons. (Actually I thought there was a bug on file for that but I can't find it).
[1] <https://wiki.mozilla.org/WebExtensions/Filesystem>
[2] <https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Match_patterns>

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a9266_434339)â€¢ 7 years ago |

Status: UNCONFIRMED â†’ NEWEver confirmed: true

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1420296#c10)â€¢ 7 years ago |
|  | |

There's no default access to file: URLs. Extensions can access file: URLs if they have permissions for those URLs listed in their manifests, which works the same way for file: URLs as it does for other URLs.
For the third time: fetch() can only fetch those URLs in same-origin mode because our fetch() support sucks, and by default it tries to make a CORS request, which file: URLs don't support, rather than a same-origin request that leverages the extension permissions. Requests to http: URLs work the same way.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1420296#c11)â€¢ 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #10](/show_bug.cgi?id=1420296#c10 "VERIFIED FIXED - Webextensions can access local files"))
> There's no default access to file: URLs. Extensions can access file: URLs if
> they have permissions for those URLs listed in their manifests, which works
> the same way for file: URLs as it does for other URLs.
Right, but we don't tell the user that in the prompt that is shown for <all\_urls>.
>
> For the third time: fetch() can only fetch those URLs in same-origin mode
> because our fetch() support sucks, and by default it tries to make a CORS
> request, which file: URLs don't support, rather than a same-origin request
> that leverages the extension permissions. Requests to http: URLs work the
> same way.
Sorry I missed [comment 6](/show_bug.cgi?id=1420296#c6 "VERIFIED FIXED - Webextensions can access local files"), and thus didnt understand [comment 8](/show_bug.cgi?id=1420296#c8 "VERIFIED FIXED - Webextensions can access local files").
(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #6](/show_bug.cgi?id=1420296#c6 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Paul Theriault [:pauljt] from [comment #5](/show_bug.cgi?id=1420296#c5 "VERIFIED FIXED - Webextensions can access local files"))
> > (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> > blocked) from [comment #4](/show_bug.cgi?id=1420296#c4 "VERIFIED FIXED - Webextensions can access local files"))
> > > This isn't exactly unexpected. If the extension has the <all\_urls>
> > > permission, it has same origin permissions for file: URLs, so this is pretty
> > > much the way it should work.
> >
> > Why does this ONLY work when you set the 'same-origin' flag.
>
> Because our fetch support kind of sucks, and if you don't specify
> same-origin, it tries to treat it as a CORS request.
>
> > Also note that this request completely bypasses the sandbox.
>
> As far as I recall, extension processes don't have filesystem sandboxing
> yet, so as long as it doesn't work from content scripts, that's not too
> surprising.
Ok I didn't know that - I thought that all content processes had the same rules, except for the one for loading File:// uris.
I guess Jim can clarify there.
In any case, I think we need to \_something\_ here. My preference would be to deny file:// access by default, and allow the user to opt-in. Not sure how complex that is though, so maybe in the meantime, perhaps we should improve the permission prompt to at least advise the user that the extension can read your local files.

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1420296#c12)â€¢ 7 years ago |
|  | |

Changing the permission prompt is a bit of a rabbit hole with quite a few problems (how do you message people who installed this already, for example). I think we should deny this case, uplift it to 58 (if possible) and work with the ACE team to message affected add-ons.
Then we keep on the course of figuring out, with all the relevant teams, what use cases for file access to allow and how to do that in the future.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a477904_279663)â€¢ 7 years ago |

Flags: needinfo?(jmathies)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1420296#c14)â€¢ 7 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #11](/show_bug.cgi?id=1420296#c11 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #10](/show_bug.cgi?id=1420296#c10 "VERIFIED FIXED - Webextensions can access local files"))
> > There's no default access to file: URLs. Extensions can access file: URLs if
> > they have permissions for those URLs listed in their manifests, which works
> > the same way for file: URLs as it does for other URLs.
>
> Right, but we don't tell the user that in the prompt that is shown for
> <all\_urls>.
I think that's the crux of the problem. Not that extensions shouldn't be able to read files (if given permission it's a valid thing to do in some cases) but that many/most users will be thinking "Web" when they see that prompt and will not expect "rummage around on my disk" to be part of it. That is, do we need to add a "<file\_urls>" permission?Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1420296#c15)â€¢ 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #14](/show_bug.cgi?id=1420296#c14 "VERIFIED FIXED - Webextensions can access local files"))
> I think that's the crux of the problem. Not that extensions shouldn't be
> able to read files (if given permission it's a valid thing to do in some
> cases) but that many/most users will be thinking "Web" when they see that
> prompt and will not expect "rummage around on my disk" to be part of it.
> That is, do we need to add a "<file\_urls>" permission?
I think we should probably make the <all\_urls> permission not apply to files, and require extensions to explicitly specify file://\*/. And we should probably require that to be an optional permission.

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1420296#c16)â€¢ 7 years ago |
|  | |

The question of how we expose local files to be read is a question for a few groups (security, UX, product) and doing it on a security restricted bug is probably not the best way to get to a solution. There's some good stuff here but I think we should probably stick to the focus of shutting off local file access to fetch in this bug and moving the rest of the discussion to a public bug or forum.

|  | [Jonathan Kingston [:jkt] he/him](/user_profile?user_id=563455) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1420296#c17)â€¢ 7 years ago |
|  | |

I probably have some spare cycles to shut off the file access here if no one else gets to it before me.
I had some ideas about how we can handle files but as :andym mentioned we can discuss elsewhere after this is resolved.

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1420296#c18)â€¢ 7 years ago |
|  | |

I think baku and catalinb would have thoughts here, too.Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a1813672_446257)â€¢ 7 years ago |

Assignee: nobody â†’ amarchesiniFlags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1420296#c19)â€¢ 7 years ago |
|  | |

Attached patch

[file\_same\_origin.patch](attachment.cgi?id=8936952&action=diff)
â€” [Details](attachment.cgi?id=8936952&action=edit)
â€” [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1420296&attachment=8936952)

The spec says that:
"To perform a scheme fetch using request, switch on requestâ€™s current urlâ€™s scheme, and run the associated steps: [...] file: For now, unfortunate as it is, file and ftp URLs are left as an exercise for the reader."
Let's force no-cors for file URLs.
[Attachment #8936952](/attachment.cgi?id=8936952&action=edit "file_same_origin.patch") -
Flags: review?(bkelly)

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1420296#c20)â€¢ 7 years ago |
|  | |

Why does no-cors mode help here if we treat the principal's as same-origin? A no-cors request can return a basic response if it's same-origin.

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1420296#c21)â€¢ 7 years ago |
|  | |

Comment on [attachment 8936952](/attachment.cgi?id=8936952 "file_same_origin.patch") [[details]](/attachment.cgi?id=8936952&action=edit "file_same_origin.patch") [[diff]](/attachment.cgi?id=8936952&action=diff "file_same_origin.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1420296&attachment=8936952)
file\_same\_origin.patch
I think this is a bug in our security checks and we probably should not try to paper over them here. This patch relies on this particular bug to work. I think I understand what is going wrong and will post a follow-up comment with details.
[Attachment #8936952](/attachment.cgi?id=8936952&action=edit "file_same_origin.patch") -
Flags: review?(bkelly) â†’ review-

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1420296#c22)â€¢ 7 years ago |
|  | |

So, both 'cors' and 'no-cors' mode reject because we end up calling DoCheckLoadURIChecks() here:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/dom/security/nsContentSecurityManager.cpp#724>
This in turn ends up calling CheckLoadURIFlags() eventually which checks URI\_IS\_LOCAL\_FILE:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/caps/nsScriptSecurityManager.cpp#938>
This block ends up failing and the file URL is blocked as intended. Note, this is done \*before\* checking for URI\_LOADABLE\_BY\_ANYONE.
For 'same-origin' mode, though, we do not call DoCheckLoadURIChecks(). Instead we call DoSOPChecks() which basically calls NS\_HasBeenCrossOrigin():
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/dom/security/nsContentSecurityManager.cpp#711>
Which then ends up calling BasePrincipal::CheckMayLoad(). This happily accepts any URL if URI\_FETCHABLE\_BY\_ANYONE is set:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/caps/BasePrincipal.cpp#152>
As Kris mentioned, web extensions set this flag based on manifest data:
<https://searchfox.org/mozilla-central/rev/110706c3c09d457dc70293b213d7bccb4f6f5643/netwerk/protocol/res/ExtensionProtocolHandler.cpp#382>
This seems like a policy or security check problem. I don't think trying to fix this in fetch() is the right place.

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1420296#c23)â€¢ 7 years ago |
|  | |

To clarify what I think is at least one problem:
In the cross-origin security checks we explicitly check for and disallow file URLs. In same-origin security checks we don't do this because we assume they will be cross-origin and fail anyway. The flag breaks that assumption, though.

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1420296#c24)â€¢ 7 years ago |
|  | |

Other same-origin requests I see in the tree which would be able to touch local files:
\* worker scripts
\* HTMLTrackElement
\* Some FontFace loading code
\* nsManifestCheck
\* etc
These probably don't have the simple attack vector of fetch(), but I think we should fix them in a way that addressed them all if we can.

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a2020369_446257)â€¢ 7 years ago |

Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1420296#c25)â€¢ 7 years ago |
|  | |

Boris, I think Bens assessment in [comment 22](/show_bug.cgi?id=1420296#c22 "VERIFIED FIXED - Webextensions can access local files") and [comment 23](/show_bug.cgi?id=1420296#c23 "VERIFIED FIXED - Webextensions can access local files") is correct. I think it wouldn't hurt to also explicitly add an disallow file URL access check to same origin checks. I assume the problem was just the assumption that SOP checks would fail file: loads because they are considered cross-origin anyway, right?Flags: needinfo?(ckerschb) â†’ needinfo?(bzbarsky)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1420296#c26)â€¢ 7 years ago |
|  | |

Can you also add a test, at least for high level local file access through WebExtensions, and maybe unit tests for the content security checks, please? :)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1420296#c27)â€¢ 7 years ago |
|  | |

I am not actually following [comment 22](/show_bug.cgi?id=1420296#c22 "VERIFIED FIXED - Webextensions can access local files"). That "FETCHABLE\_BY\_ANYONE" flag would be on the \_uri\_, not the \_principal\_. Webextensions set that on \_webextension\_ URIs, which doesn't obviously have anything to do with attempts to load file:// URIs.
I have a slightly different question. Why is file:// special? Can extensions use this same mechanism to get at chrome:// URIs or whatnot?
Or put another way, should <all\_urls> basically mean "all URLs that are URI\_LOADABLE\_BY\_ANYONE", as opposed to "all URLs"? That will presumably restrict it to the things users expect....Flags: needinfo?(bzbarsky)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1420296#c28)â€¢ 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Daniel Veditz [:dveditz] from [comment #14](/show_bug.cgi?id=1420296#c14 "VERIFIED FIXED - Webextensions can access local files"))
> > I think that's the crux of the problem. Not that extensions shouldn't be
> > able to read files (if given permission it's a valid thing to do in some
> > cases) but that many/most users will be thinking "Web" when they see that
> > prompt and will not expect "rummage around on my disk" to be part of it.
> > That is, do we need to add a "<file\_urls>" permission?
>
> I think we should probably make the <all\_urls> permission not apply to
> files, and require extensions to explicitly specify file://\*/. And we should
> probably require that to be an optional permission.
FWIW I like this proposal, even though it differs from chrome.
I'm here though now, to bring up [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") which complicates the fix here slightly i think (at least i think this bug will depend on 1427448).Depends on: [1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url")

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1420296#c29)â€¢ 7 years ago |
|  | |

This seems to have stalled, it got listed as sec-moderate but a P1 by the WebExtensions team, so it keeps popping up in triages for us. Should we drop the priority down to reflect the sec- status? Is there anything we can do to help move this forward baku?

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1420296#c30)â€¢ 7 years ago |
|  | |

I think the fix is probably more in Christoph's wheelhouse in the security manager. Christoph, can you take this?Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1420296#c31)â€¢ 7 years ago |
|  | |

(In reply to Ben Kelly [:bkelly] from [comment #30](/show_bug.cgi?id=1420296#c30 "VERIFIED FIXED - Webextensions can access local files"))
> I think the fix is probably more in Christoph's wheelhouse in the security
> manager. Christoph, can you take this?
Unfortunately I don't have the cycles to tackle this one at the moment. I guess we have to lower the priority until we get more engineering power back in content security.Flags: needinfo?(ckerschb)

|  | [Jan Biniok](/user_profile?user_id=547788)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a6467898_547788)â€¢ 7 years ago |

Flags: needinfo?(jan)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1420296#c32)â€¢ 7 years ago |
|  | |

(In reply to Andy McKay [:andym] from [comment #29](/show_bug.cgi?id=1420296#c29 "VERIFIED FIXED - Webextensions can access local files"))
> This seems to have stalled, it got listed as sec-moderate but a P1 by the
> WebExtensions team, so it keeps popping up in triages for us. Should we drop
> the priority down to reflect the sec- status? Is there anything we can do to
> help move this forward baku?
No, keep it P1 - this is fundamental inconsistency in the security model. Either we need to fix this, or we need to make it clear that web extensions are allowed to read files from the file system. Web Extension bugs tend to get lower rating due to exploitation being predicated on installing a malicious extension - not a huge barrier, but more than if the issue was web exploitable. So while only being moderate in the scheme of firefox, I'd say this should be a P1 in the context of web extensions.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1420296#c33)â€¢ 7 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #28](/show_bug.cgi?id=1420296#c28 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
> blocked) from [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files"))
> > (In reply to Daniel Veditz [:dveditz] from [comment #14](/show_bug.cgi?id=1420296#c14 "VERIFIED FIXED - Webextensions can access local files"))
> > > I think that's the crux of the problem. Not that extensions shouldn't be
> > > able to read files (if given permission it's a valid thing to do in some
> > > cases) but that many/most users will be thinking "Web" when they see that
> > > prompt and will not expect "rummage around on my disk" to be part of it.
> > > That is, do we need to add a "<file\_urls>" permission?
> >
> > I think we should probably make the <all\_urls> permission not apply to
> > files, and require extensions to explicitly specify file://\*/. And we should
> > probably require that to be an optional permission.
>
> FWIW I like this proposal, even though it differs from chrome.
>
> I'm here though now, to bring up [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") which complicates the fix here
> slightly i think (at least i think this bug will depend on 1427448).
What's needed to move ahead with this proposal? I don't think the fix for [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") will necessarily make much of a difference here. AIUI to fix this type of thing, we'd need to:
1) add a new permission for <file\_urls>
2) require it to be optional
3) in CAPS, when the triggering/subject principal is an add-on and the target URI chain has the local file flag, check if the add-on has the relevant permission
Does that sound right? Do we need further buy-in on this plan to move forward here?Flags: needinfo?(kmaglione+bmo)Flags: needinfo?(ddurst)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1420296#c34)â€¢ 7 years ago |
|  | |

(In reply to :Gijs from [comment #33](/show_bug.cgi?id=1420296#c33 "VERIFIED FIXED - Webextensions can access local files"))
> What's needed to move ahead with this proposal? I don't think the fix for
> [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url") will necessarily make much of a difference here. AIUI to fix
> this type of thing, we'd need to:
>
> 1) add a new permission for <file\_urls>
> 2) require it to be optional
> 3) in CAPS, when the triggering/subject principal is an add-on and the
> target URI chain has the local file flag, check if the add-on has the
> relevant permission
>
> Does that sound right? Do we need further buy-in on this plan to move
> forward here?
No. <all\_urls> should still match file URLs, and so should file://\*
What we need is a separate setting that allows users to opt into giving an extension access to local files, similar to what Chrome does. I don't particularly care when/where we prompt users to opt into this, but the status of that permission should at least be displayed on the add-on's about:addons detail page, and be togglable there.Flags: needinfo?(kmaglione+bmo)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1420296#c35)â€¢ 7 years ago |
|  | |

(In reply to :Gijs from [comment #33](/show_bug.cgi?id=1420296#c33 "VERIFIED FIXED - Webextensions can access local files"))
> 3) in CAPS, when the triggering/subject principal is an add-on and the
> target URI chain has the local file flag, check if the add-on has the
> relevant permission
Which means adding a new boolean flag to WebExtensionPolicy[1] and checking it in MatchPattern[2]. Which probably means adding an optional policy property to MatchPattern instances.
[1]: <https://searchfox.org/mozilla-central/source/dom/webidl/WebExtensionPolicy.webidl>
[2]: <https://searchfox.org/mozilla-central/rev/d03ad8843e3bf2e856126bc53b0475c595e5183b/toolkit/components/extensions/MatchPattern.cpp#405>

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1420296#c36)â€¢ 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> No. <all\_urls> should still match file URLs, and so should file://\*
To me this seems like the opposite of what [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files") said:
(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #15](/show_bug.cgi?id=1420296#c15 "VERIFIED FIXED - Webextensions can access local files"))
> I think we should probably make the <all\_urls> permission not apply to
> files, and require extensions to explicitly specify file://\*/. And we should
> probably require that to be an optional permission.
Can you clarify what you mean more precisely?Flags: needinfo?(kmaglione+bmo)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a7203326_446257)â€¢ 7 years ago |

Assignee: amarchesini â†’ nobody

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1420296#c37)â€¢ 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> (In reply to :Gijs from [comment #33](/show_bug.cgi?id=1420296#c33 "VERIFIED FIXED - Webextensions can access local files"))
...
>
> What we need is a separate setting that allows users to opt into giving an
> extension access to local files, similar to what Chrome does. I don't
> particularly care when/where we prompt users to opt into this, but the
> status of that permission should at least be displayed on the add-on's
> about:addons detail page, and be togglable there.
We just spoke about this at all hands, and as asked Im adding my strong support for the approach suggested by Kris above (i.e. a toggle where users can OPT IN to allowing extensions to have file access, and prevent access in the regular case).

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1420296#c38)â€¢ 7 years ago |
|  | |

With a side note that, in addition to preventing direct loading of file:// uris, we also need to prevent extensions open in tabs with file:// URIs (and then injecting a content script into it). From a discussion here it sounds like we don't want to still allow extensions even without the "file access" granted to inject content scripts into tabs with File:// uris that the USER opened. (im not super pumped about that, but it sounds also you shouldn't have to grant a random extension access to your file system, just so that it can inject some content script into the one specific document you opened from the file system.

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a17961711_546015)â€¢ 7 years ago |

Product: Toolkit â†’ WebExtensions

|  | [David Durst [:ddurst]](/user_profile?user_id=500559) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a18039021_500559)â€¢ 7 years ago |

Assignee: nobody â†’ kmaglione+bmoFlags: needinfo?(ddurst)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1420296#c39)â€¢ 7 years ago |
|  | |

I'm going to handle the back-end portion of this. I might punt the front-end portion to Mark, since I have a lot of things on my plate at the moment.Flags: needinfo?(kmaglione+bmo)

|  | [Jan Biniok](/user_profile?user_id=547788)  Reporter |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1420296#c40)â€¢ 7 years ago |
|  | |

> I'm going to handle the back-end portion of this.
Does "this" mean to prevent content script file:// access by default \_AND\_ to implement "a toggle where users can OPT IN to allowing extensions to have file access"?
I'm asking because the first "fix" will break Tampermonkey's ability to install scripts from local file URIs unless content scripts that are defined at the manifest are exempted from this change.
Thanks, Jan
{
"manifest\_version": 2,
...
"content\_scripts":
[
{...}, {
"js": [
"rea/content.js"
],
"matches": [ "file:///\*.user.js" ],
"run\_at": "document\_start"
}
],
...
}

|  | [David Durst [:ddurst]](/user_profile?user_id=500559) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a30576910_500559)â€¢ 6 years ago |

Assignee: kmaglione+bmo â†’ tomica

|  | [David Durst [:ddurst]](/user_profile?user_id=500559) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a30577845_500559)â€¢ 6 years ago |

Mentor: kmaglione+bmo

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1420296#c41)â€¢ 6 years ago |
|  | |

I'm looking into this, but there are several linked bugs that I can't access. Can someone please go through [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"), [bug 1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?"), and [bug 1316343](/show_bug.cgi?id=1316343 "RESOLVED FIXED"), and CC me to those pertinent to this issue?
(In reply to Kris Maglione [:kmag] from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> What we need is a separate setting that allows users to opt into giving an
> extension access to local files, similar to what Chrome does. I don't
> particularly care when/where we prompt users to opt into this, but the
> status of that permission should at least be displayed on the add-on's
> about:addons detail page, and be togglable there.
Do we want this as a new "public" permission, or just an internal flag that extension can never request, and can only be manually toggled though the UI?
And what should we do with already installed extensions in either case?
(In reply to Paul Theriault [:pauljt] from [comment #38](/show_bug.cgi?id=1420296#c38 "VERIFIED FIXED - Webextensions can access local files"))
> With a side note that, in addition to preventing direct loading of file://
> uris, we also need to prevent extensions open in tabs with file:// URIs (and
> then injecting a content script into it). From a discussion here it sounds
> like we don't want to still allow extensions even without the "file access"
> granted to inject content scripts into tabs with File:// uris that the USER
> opened. (im not super pumped about that, but it sounds also you shouldn't
> have to grant a random extension access to your file system, just so that it
> can inject some content script into the one specific document you opened
> from the file system.
I don't understand this the way it's worded. And it seems all of the discussion in this bug is about direct access to reading local files, content scripts are a separate issue, and can be a separate bug.
(In reply to Kris Maglione [:kmag] from [comment #39](/show_bug.cgi?id=1420296#c39 "VERIFIED FIXED - Webextensions can access local files"))
> I might punt the front-end portion to Mark
This can be done in a separate public bug, if it needs to involve UX and/or others, right?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1420296#c42)â€¢ 6 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files"))
> I'm looking into this, but there are several linked bugs that I can't
> access. Can someone please go through [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"), [bug 1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?"), and bug
> 1316343, and CC me to those pertinent to this issue?
Done this for you, can't comment on the other stuff.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1420296#c43)â€¢ 6 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files"))
> I'm looking into this, but there are several linked bugs that I can't
> access. Can someone please go through [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"), [bug 1420360](/show_bug.cgi?id=1420360 "RESOLVED DUPLICATE - Is this a bug that get any files by path when you have applied <all_urls> of permissions key?"), and bug
> 1316343, and CC me to those pertinent to this issue?
>
>
>
> (In reply to Kris Maglione [:kmag] from [comment #34](/show_bug.cgi?id=1420296#c34 "VERIFIED FIXED - Webextensions can access local files"))
> > What we need is a separate setting that allows users to opt into giving an
> > extension access to local files, similar to what Chrome does. I don't
> > particularly care when/where we prompt users to opt into this, but the
> > status of that permission should at least be displayed on the add-on's
> > about:addons detail page, and be togglable there.
>
> Do we want this as a new "public" permission, or just an internal flag that
> extension can never request, and can only be manually toggled though the UI?
>
> And what should we do with already installed extensions in either case?
>
>
>
> (In reply to Paul Theriault [:pauljt] from [comment #38](/show_bug.cgi?id=1420296#c38 "VERIFIED FIXED - Webextensions can access local files"))
> > With a side note that, in addition to preventing direct loading of file://
> > uris, we also need to prevent extensions open in tabs with file:// URIs (and
> > then injecting a content script into it). From a discussion here it sounds
> > like we don't want to still allow extensions even without the "file access"
> > granted to inject content scripts into tabs with File:// uris that the USER
> > opened. (im not super pumped about that, but it sounds also you shouldn't
> > have to grant a random extension access to your file system, just so that it
> > can inject some content script into the one specific document you opened
> > from the file system.
>
> I don't understand this the way it's worded. And it seems all of the
> discussion in this bug is about direct access to reading local files,
> content scripts are a separate issue, and can be a separate bug.
Sorry, my comment is barely readable. I meant that we should have a holistic approach to restricting file system access. If we close this fetch hole, but still allow extensions to open and interact with tabs which have a file:// url open, then extensions will still have read access to the file system (since file: uris are treated as same-origin as files in the same directory). But you are right, that perhaps should be a separate bug.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1420296#c44)â€¢ 6 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #43](/show_bug.cgi?id=1420296#c43 "VERIFIED FIXED - Webextensions can access local files"))
> (since file: uris are treated as same-origin as files in the same
> directory)
We should just finally fix this - [bug 803143](/show_bug.cgi?id=803143 "RESOLVED FIXED - Local files can access other files in the same directory").

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1420296#c45)â€¢ 6 years ago |
|  | |

ni? to Kris and Mike for what to do with already installed extensions here ([comment 41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files")), similar to the situation about private browsing being solved right now.

Flags: needinfo?(mconca)Flags: needinfo?(kmaglione+bmo)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a41820253_1689)â€¢ 6 years ago |

Group: toolkit-core-security â†’ firefox-core-security

|  | [Mike Conca [:mconca]](/user_profile?user_id=599100) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1420296#c46)â€¢ 6 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #45](/show_bug.cgi?id=1420296#c45 "VERIFIED FIXED - Webextensions can access local files"))

> ni? to Kris and Mike for what to do with already installed extensions here ([comment 41](/show_bug.cgi?id=1420296#c41 "VERIFIED FIXED - Webextensions can access local files")), similar to the situation about private browsing being solved right now.

This particular question is being rolled up into a larger discussion around exactly how/when extensions can access local files.

Flags: needinfo?(mconca)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1420296#c47)â€¢ 6 years ago |
|  | |

I'm confused by this bug; the docs describe a function to check this capability: <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension/isAllowedFileSchemeAccess> and describe "the user-controlled 'Allow access to File URLs' checkbox" (on <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension#getURL()> )

Are the docs incorrect or has much of what has been discussed in this bug been implemented?

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1420296#c48)â€¢ 6 years ago |
|  | |

(In reply to Tom Ritter [:tjr] from [comment #47](/show_bug.cgi?id=1420296#c47 "VERIFIED FIXED - Webextensions can access local files"))

> I'm confused by this bug; the docs describe a function to check this capability: <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension/isAllowedFileSchemeAccess> and describe "the user-controlled 'Allow access to File URLs' checkbox" (on <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension#getURL()> )
>
> Are the docs incorrect or has much of what has been discussed in this bug been implemented?

That currently only applies to Chrome, who we inherited this API from.

Flags: needinfo?(kmaglione+bmo)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a50601475_279663)â€¢ 6 years ago |

Depends on: [803143](/show_bug.cgi?id=803143 "RESOLVED FIXED - Local files can access other files in the same directory")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a54501379_279663)â€¢ 5 years ago |

Whiteboard: webext-sec

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a60819031_279663)â€¢ 5 years ago |

Assignee: tomica â†’ nobody

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1420296#c49)â€¢ 5 years ago |
|  | |

I'm currently unable to reproduce this with either the stack overflow example from [comment 0](/show_bug.cgi?id=1420296#c0 "VERIFIED FIXED - Webextensions can access local files") or the simplified version in [comment 3](/show_bug.cgi?id=1420296#c3 "VERIFIED FIXED - Webextensions can access local files").

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1420296#c50)â€¢ 5 years ago |
|  | |

I can still reproduce on Linux with Nightly 72.0a1, buildID 20191021215155 .

1. manifest.json with

```
    "name": "Extension with file access",
    "version": "1",
    "manifest_version": 2,
    "background": {"scripts": ["bg.js"]},
    "permissions": ["file:///*"]
}

```

2. bg.js

```
async function test() {
    let r = await fetch('file:///etc/passwd', {mode:'same-origin'});
    let t = await r.text();
    console.log(t)
}
test();

```

Result: The content of `/etc/passwd`.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1420296#c51)â€¢ 5 years ago |
|  | |

If I add a catch on the fetch, I get "TypeError: NetworkError when attempting to fetch resource.".

Nightly OSX 10.14

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1420296#c52)â€¢ 5 years ago |
|  | |

So, I am still unable to reproduce this on osx regardless of the privacy.file\_unique\_origin value. However, on a fresh profile, same extension, I can reproduce this on linux. Either it is unrelated to file\_unique\_origin or it is linux specific. Due to this, I'll set my vm to dealing with windows for the rest of the afternoon.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1420296#c53)â€¢ 5 years ago |
|  | |

Attached file
[fileaccess.xpi](attachment.cgi?id=9105000)
â€” [Details](attachment.cgi?id=9105000&action=edit)

This xpi does two fetches, one that is just normal (was making sure I didn't have some stupid problem) and one that does a file fetch. This same xpi fails to fetch the file on osx, but works fine on linux.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1420296#c54)â€¢ 5 years ago |
|  | |

How do I check whether I'm reproducing with that extension? I installed the extension, started the browser, loaded example.com, but I don't know which console it's logging to and hence whether it's managing to do the fetches...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1420296#c55)â€¢ 5 years ago |
|  | |

Ah, nevermind. If I add some `dump()` calls I can see it running at startup. Poking at things...

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1420296#c56)â€¢ 5 years ago |
|  | |

This reproduces on Windows 10 and latest Nightly 72 from today.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1420296#c57)â€¢ 5 years ago |
|  | |

So the `fetch('file:///etc/passwd')` call happens in a content process. The triggering principal (and loading principal) for the fetch is a ContentPrincipal with the URI `"moz-extension://01cf4af3-f9f4-4f63-8222-1f2c1db5bffb/_generated_background_page.html"`.

We end up in `ContentPrincipal::MayLoadInternal` and the `AddonAllowsLoad` call there returns true, because the `WebExtensionPolicy::CanAccessURI` call returns true. Given the manifest claims `"file:///*"` in the permissions this doesn't seem surprising, right? Anyway, that means `BasePrincipal::CheckMayLoad` returns true, and that's our general "Should this principal be considered same-origin with this URI?" method. So we consider this a same-origin load (e.g. `NS_HasBeenCrossOrigin` returns false, so `DoSOPChecks` returns success, so `nsContentSecurityManager::CheckChannel` returns success, so the load is allowed.

After things things Just Work: the fetch successfully opens the `FileChannelChild` channel, that remotes the actual filesystem access to the parent process (which is why sandboxing is nor relevant), etc.

Is there some expectation that given our current code this should *not* work?

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1420296#c58)â€¢ 5 years ago |
|  | |

`fetch('file:///etc/passwd');` does not load the resource (and neither does `XMLHttpRequest`) - this is desired as explained below.

`fetch('file:///etc/passwd', {mode:'same-origin'});` does load the resource.

They should behave consistently.

`file:///*` is automatically granted when the `<all_urls>` permission is requested, which is very common.

Most of the extensions that request `<all_urls>` don't really need file access.

I'd like to block file access by default unless a user explicitly consented, to protect the general population whose add-ons don't need to access files.

(FWIW, in Chrome `<all_urls>` also includes `file:///*`, but access is withheld until the user manually grants access at the extension management page.)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a62984924_447061)â€¢ 5 years ago |

Assignee: nobody â†’ robStatus: NEW â†’ ASSIGNED

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1420296#c59)â€¢ 5 years ago |
|  | |

Next week (or maybe the week after, at the start of release cycle of 73), I intend to land a patch that closes this hole.

The hole does already not work on macOS ([comment 49](/show_bug.cgi?id=1420296#c49 "VERIFIED FIXED - Webextensions can access local files")), and starting with my patch, it won't work either on Linux, Windows and Android.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1420296#c60)â€¢ 5 years ago |
|  | |

Attached file
[Bug 1420296 - Add file check to WebExtensionPolicy](attachment.cgi?id=9111270)
â€” [Details](attachment.cgi?id=9111270&action=edit)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1420296#c61)â€¢ 5 years ago |
|  | |

Attached file
[Bug 1420296 - Add tests for file access from extensions](attachment.cgi?id=9111271)
â€” [Details](attachment.cgi?id=9111271&action=edit)

Content scripts are allowed to run on file:-URLs, but other forms of

file access from extensions are not allowed. This has been the behavior

for a while, but there were no tests. This commit adds tests to ensure

that the functionality continues to work as intended.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1420296#c62)â€¢ 5 years ago |
|  | |

Attached file
[Bug 1420296 - Test for same-origin file requests](attachment.cgi?id=9111273)
â€” [Details](attachment.cgi?id=9111273&action=edit)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1420296#c63)â€¢ 5 years ago |
|  | |

* [comment 60](/show_bug.cgi?id=1420296#c60 "VERIFIED FIXED - Webextensions can access local files") is a fix for this bug and [bug 1487353](/show_bug.cgi?id=1487353 "RESOLVED FIXED - Extensions can run content scripts in local files and read any other local file") (a unit test is attached in that other bug).
* [comment 61](/show_bug.cgi?id=1420296#c61 "VERIFIED FIXED - Webextensions can access local files") is a set of unit tests that already pass, independently of the bugfix. These tests were added to make sure that content scripts for files do not regress.
* [comment 61](/show_bug.cgi?id=1420296#c61 "VERIFIED FIXED - Webextensions can access local files") is a regression test for this bug, and should land in the future, when this bug becomes public.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a63221681_447061)â€¢ 5 years ago |

Blocks: [1487353](/show_bug.cgi?id=1487353 "RESOLVED FIXED - Extensions can run content scripts in local files and read any other local file")

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1420296#c64)â€¢ 5 years ago |
|  | |

The patch in [comment 60](/show_bug.cgi?id=1420296#c60 "VERIFIED FIXED - Webextensions can access local files") seems fine, but I want to understand answers to a few questions beforehand:

1. This proposed fix is different than the agreed consensus in most of this bug, up to and including your second-to-last [comment 58](/show_bug.cgi?id=1420296#c58 "VERIFIED FIXED - Webextensions can access local files"), which was putting this access behind a special permission prompt/checkbox. Why did you change your approach? Given recent urgency in [bug 1598946](/show_bug.cgi?id=1598946 "ASSIGNED"), should we bundle the two bugs together, behind the same optional permission?
2. Why doesn't this work on MacOS? Is it a recent "regression", or some configuration/platform difference?
3. I'm looking up code related to [comment 23](/show_bug.cgi?id=1420296#c23 "VERIFIED FIXED - Webextensions can access local files"), perhaps this cross-origin check should be lower in the chain to cover more than just addons usecase.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1420296#c65)â€¢ 5 years ago |
|  | |

(In reply to :Tomislav Jovanovic :zombie from [comment #64](/show_bug.cgi?id=1420296#c64 "VERIFIED FIXED - Webextensions can access local files"))

> The patch in [comment 60](/show_bug.cgi?id=1420296#c60 "VERIFIED FIXED - Webextensions can access local files") seems fine, but I want to understand answers to a few questions beforehand:
>
> 1. This proposed fix is different than the agreed consensus in most of this bug, up to and including your second-to-last [comment 58](/show_bug.cgi?id=1420296#c58 "VERIFIED FIXED - Webextensions can access local files"), which was putting this access behind a special permission prompt/checkbox. Why did you change your approach? Given recent urgency in [bug 1598946](/show_bug.cgi?id=1598946 "ASSIGNED"), should we bundle the two bugs together, behind the same optional permission?

I implemented it like this because it fixes file:-access related bugs without breaking known supported cases.

We probably still want to support a prompt/checkbox, but that requires more efforts and review/feedback cycles. That fits better in [bug 1598946](/show_bug.cgi?id=1598946 "ASSIGNED") or a follow-up to that bug (and some of the ideas expressed here already align with the tentative plan).

> 2. Why doesn't this work on MacOS? Is it a recent "regression", or some configuration/platform difference?

The paths that we tested were blocked by the sandbox on macOS. If I choose a [whitelisted location](https://searchfox.org/mozilla-central/rev/efdf9bb55789ea782ae3a431bda6be74a87b041e/security/sandbox/mac/SandboxPolicyContent.h#70), e.g. `file:///usr/share/` , then the load is still accepted.

> 3. I'm looking up code related to [comment 23](/show_bug.cgi?id=1420296#c23 "VERIFIED FIXED - Webextensions can access local files"), perhaps this cross-origin check should be lower in the chain to cover more than just addons usecase.

I'm not aware of any other generic file:-whitelisting other than extensions. Judged by extension permissions only, `file:`-access should have been allowed (and is so, according to `WebExtensionPolicy::CanAccessURI`). But we don't have a separate permission warning or any other obvious indication that an extension is allowed access to local files, so it was a nice "feature" that `file:`-URLs were somehow already blocked access (through `fetch` / `XMLHttpRequest`) despite being allowed by `CanAccessURI`. The patch changes the implementation of `CanAccessURI` to match the current default behavior for cors-fetches, and does it at that place to cover most scenarios (without affecting content scripts, for which we want to continue supporting access). If we ever decide to open up file:-access (rather than restricting it), then we probably need to revisit the implementation, but until then, I'd rather be on the safe side.

I think that file:-access to extensions can be a useful feature in some cases, but it should by no means be the silent default behavior.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1420296#c66)â€¢ 5 years ago |
|  | |

What's your advice on landing the patches?

I want to land two patches, the fix itself, and unit tests that verifies that the supported behaviors are still working as intended.

Do you think that it is fine to land the following at the same time:

* <https://phabricator.services.mozilla.com/D54541> (tests that already passed before the fix)
* <https://phabricator.services.mozilla.com/D54540> (fix itself)

(and the regression test in the future - <https://phabricator.services.mozilla.com/D54543> ).

... or should I only land the fix now, and land the tests later?

One interesting point to consider is that the bug itself has been public for over two years by now:

<https://stackoverflow.com/questions/42108782/firefox-webextensions-get-local-files-content-by-path/44516256#44516256>

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1420296#c67)â€¢ 5 years ago |
|  | |

Given the public stackoverflow item I'm fine with you landing all of it at once, including D54543.

Flags: needinfo?(dveditz)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1420296#c68)â€¢ 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/b4cc65a4d11e4569ea64670d24e38ef6c88a075e>

<https://hg.mozilla.org/mozilla-central/rev/b4cc65a4d11e>

Group: firefox-core-security â†’ core-security-releaseStatus: ASSIGNED â†’ RESOLVEDClosed: 5 years ago
[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
--- â†’ [fixed](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=fixed)Resolution: --- â†’ FIXEDTarget Milestone: --- â†’ mozilla73

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1420296#c69)â€¢ 5 years ago |
|  | |

I've only landed the already-passing tests; I'll land the other parts once I've verified that the impact on extensions is minimal.

Status: RESOLVED â†’ REOPENEDResolution: FIXED â†’ ---

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a65194422_575867)â€¢ 5 years ago |

[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=fixed) â†’ [affected](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=affected)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1420296#c70)â€¢ 5 years ago |
|  | |

I checked all public add-ons on AMO, and the following add-ons are relying on this bug / "feature". I've listed the number of users and the use cases:

* <https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/> 323k users
  + To import local files in scripts: <https://github.com/Tampermonkey/tampermonkey/issues/347>
* <https://addons.mozilla.org/en-US/firefox/addon/s3download-statusbar/> 82k users (recommended badge)
  + To read files for checksum calculations and image preview.
* <https://addons.mozilla.org/en-US/firefox/addon/styl-us/> 77k users (recommended badge)
  + To support installation of local user styles: <https://github.com/openstyles/stylus/pull/134>
* <https://addons.mozilla.org/en-US/firefox/addon/exif-viewer/> 35k users
  + Used to view metadata of local files.
* <https://addons.mozilla.org/en-US/firefox/addon/foxreplace/> 7k users
  + Used to automatically update by reading from a local file.
* <https://addons.mozilla.org/en-US/firefox/addon/surfingkeys_ff/> (version <= 0.9.41) 1k users
  + Used to read settings from a local file: <https://github.com/brookhong/Surfingkeys/pull/891>
  + Author removed the code in the latest versions (including 0.9.57) when they discovered that the functionality does not work on macOS.
* and a couple of smaller ones.

The total number of users is about 500k. Since the functionality is already not working on macOS, and the loss of use cases is not extremely critical, I'll land the patch that disables local file access, next week.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1420296#c71)â€¢ 5 years ago |
|  | |

Many of those affected addons would be better served with `<input type=file>`, it seems.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1420296#c72)â€¢ 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/a32b39b12097218637d33cb0f6ac86e8d93366aa>

<https://hg.mozilla.org/mozilla-central/rev/a32b39b12097>

Status: REOPENED â†’ RESOLVEDClosed: 5 years ago â†’ 5 years ago
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
--- â†’ [fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed)Resolution: --- â†’ FIXEDTarget Milestone: mozilla73 â†’ mozilla74

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1420296#c73)â€¢ 5 years ago |
|  | |

Doesn't feel like the kind of change we'd want to land on an ESR branch, but should we consider uplifting this to Beta for Fx73?

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix)Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1420296#c74)â€¢ 5 years ago |
|  | |

This vulnerability has been public for multiple years, and consequently some extensions rely on it for legitimate reasons. I want to let it ride the trains to give add-on developers the opportunity to work with the limitations.

Flags: needinfo?(rob)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a67577739_75935)â€¢ 5 years ago |

[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=affected) â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a67712091_553429)â€¢ 5 years ago |

Flags: qe-verify+Whiteboard: webext-sec â†’ webext-sec [post-critsmash-triage]

|  | [Miruna Curtean](/user_profile?user_id=642772) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1420296#c75)â€¢ 5 years ago |
|  | |

Verified fixed using the fileaccess.xpi extension provided in [comment 53](/show_bug.cgi?id=1420296#c53 "VERIFIED FIXED - Webextensions can access local files") On Windows 10 Pro 64-bit, MacOS Catalina 10.15 and Ubuntu 16.04 LTS on FF 74.0a1 (20200121215203).

Checked through loading the extension from about debugging and inspecting it on a fixed version and also installing it (after setting xpinstall.signatures.required to false) in about:addons on a Nightly build from before the push and then upgrading the browser.

A security error declaring that data may not be loaded from "file:///etc/passwd" is logged in the extension console log after the fix.

Status: RESOLVED â†’ VERIFIED
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a71989444_578488)â€¢ 5 years ago |

Whiteboard: webext-sec [post-critsmash-triage] â†’ webext-sec [post-critsmash-triage][adv-main74+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1420296#c76)â€¢ 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9131374)
â€” [Details](attachment.cgi?id=9131374&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a72295880_578488)â€¢ 5 years ago |

Alias: CVE-2020-6809

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1420296#c77)â€¢ 5 years ago |
|  | |

Test for same-origin file requests:

<https://hg.mozilla.org/integration/autoland/rev/823481edb95885927d150b4584ecfe639022830b>

<https://hg.mozilla.org/mozilla-central/rev/823481edb958>

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a72540371_447061)â€¢ 5 years ago |

Regressions: [1621935](/show_bug.cgi?id=1621935 "RESOLVED FIXED - webRequest listeners are not called for subresources loaded by file:// pages")

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a80929187_580382)â€¢ 5 years ago |

Regressions: [1644488](/show_bug.cgi?id=1644488 "RESOLVED INVALID - content scripts cannot fetch contents of file URIs")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1420296#a96862731_1689)â€¢ 4 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1420296&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top â†‘

## Attachment

Hide Details

### General

Creator:  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250119_134633.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")â€Ž | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_fc1a03a0_20250119_134631.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  Â·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summaryâ–¾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View â–¾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1247968)
* [XML](/show_bug.cgi?ctype=xml&id=1247968)

Closed
[Bug 1247968](/show_bug.cgi?id=1247968)
(CVE-2020-6808)

Opened 9 years ago
Closed 5 years ago

# Full URL spoof using javascript URI scheme

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Full URL spoof using javascript URI scheme

## Categories

### (Core :: DOM: Navigation, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
â–¾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Navigation#DOM%3A%20Navigation)

DOM: Navigation
â–¾

Core :: DOM: Navigation
For bugs with HTMLâ€™s [navigate](https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate) algorithm and browsing contexts.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Navigation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla74

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix) |
| firefox72 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix) |
| firefox73 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix) |
| firefox74 | --- | [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified) |
| firefox75 | --- | [verified](/buglist.cgi?f1=cf_status_firefox75&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox72 |  | wontfix |
| firefox73 |  | wontfix |
| firefox74 |  | verified |
| firefox75 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: Gijs, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b89a42ca4c4d59c27f33c399bb1ecc7b?d=mm&size=40)  [farre](/user_profile?user_id=566192)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)"), [CVE-2016-1958](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1247968&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1247968)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-moderate, Whiteboard: [post-critsmash-triage][adv-main74+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2020-6808

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main74+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a63166485_1689 "9 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [FF-URL-SPOOFv2.html](/attachment.cgi?id=8718878)  [9 years ago](#c0)  [:Gijs (he/him)](/user_profile?user_id=159069)   1.02 KB, text/html |  | [Details](/attachment.cgi?id=8718878&action=edit) |
| --- | --- | --- |
| [Different approach to the same bug, javascript acts buggy with hash symbol.](/attachment.cgi?id=8727015)  [9 years ago](#c5)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   549 bytes, text/html |  | [Details](/attachment.cgi?id=8727015&action=edit) |
| [WIP](/attachment.cgi?id=8814066)  [8 years ago](#c15)  [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029)   9.93 KB, patch |  | [Details](/attachment.cgi?id=8814066&action=edit) | [Diff](/attachment.cgi?id=8814066&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1247968&attachment=8814066) |
| [advisory.txt](/attachment.cgi?id=9131371)  [5 years ago](#c31)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   435 bytes, text/plain |  | [Details](/attachment.cgi?id=9131371&action=edit) |

Bottom â†“
Tags â–¾

* Reset

Timeline â–¾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1247968#c0)â€¢ 9 years ago |
|  | |

Attached file
[FF-URL-SPOOFv2.html](attachment.cgi?id=8718878)
â€” [Details](attachment.cgi?id=8718878&action=edit)

+++ This bug was initially created as a clone of [Bug #1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)") +++
(original test and steps from [bug 1228754](/show_bug.cgi?id=1228754 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)") and @qab, not from me)
1. Open attached file.
2. click link
3. click back button in the browser
Somehow, the URL stays in the URL bar. Interrogating the browser's currentURI shows the URL shown in the URL bar, but the document displayed is actually about:blank (and the documentURI and so on verify this, and document.documentElement.nodePrincipal is the original opener's principal (localhost if you host the file there, bugzilla if you opened it directly ).
(In reply to Boris Zbarsky [:bz] from [bug 1228754 comment #33](/show_bug.cgi?id=1228754#c33 "VERIFIED FIXED - Show about:blank (placeholder \"Search or enter address\" in the URL bar) using javascript URI scheme (spoof)"))
> Sounds like it, but it also sounds like something different from the
> original issue reported in this bug (the one I analyzed in [comment 6](/show_bug.cgi?id=1247968#c6 "VERIFIED FIXED - Full URL spoof using javascript URI scheme")).
> Seems like we should get a new bug filed on the interaction involving
> session history, and probably ask Olli whether he can take a look.
--> ni Olli.Flags: needinfo?(bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a1482_159069)â€¢ 9 years ago |

Group: firefox-core-security â†’ core-securityComponent: Location Bar â†’ Document NavigationOS: Unspecified â†’ AllProduct: Firefox â†’ CoreHardware: Unspecified â†’ AllVersion: 42 Branch â†’ Trunk

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a353424_452604)â€¢ 9 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1247968#c1)â€¢ 9 years ago |
|  | |

I thought I had taken this.
Trying to get to this once I've done the current reviews.Flags: needinfo?(bugs)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a380704_1689)â€¢ 9 years ago |

Group: core-security â†’ dom-core-security

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1247968#c2)â€¢ 9 years ago |
|  | |

And I so thought I had assigned this to myself. At least I had added this to my todo list.Assignee: nobody â†’ bugs

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1247968#c3)â€¢ 9 years ago |
|  | |

Adding the bounty flag as requested by the reporter.
Lowering the severity to sec-moderate reflecting that
1) the user has to hit back on the error page (unusual suspicion-raising circumstances)
2) you can only spoof sites that don't actually have certs
#2 in particular means you can't spoof Facebook, Google, "my bank", etc. Spoofing is only useful if it can be used to fake a valuable target site for phishing, etc. attacks.Flags: sec-bounty?Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) â†’ [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1247968#c4)â€¢ 9 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #3](/show_bug.cgi?id=1247968#c3 "VERIFIED FIXED - Full URL spoof using javascript URI scheme"))
> Adding the bounty flag as requested by the reporter.
>
> Lowering the severity to sec-moderate reflecting that
> 1) the user has to hit back on the error page (unusual suspicion-raising
> circumstances)
> 2) you can only spoof sites that don't actually have certs
>
> #2 in particular means you can't spoof Facebook, Google, "my bank", etc.
> Spoofing is only useful if it can be used to fake a valuable target site for
> phishing, etc. attacks.
You can spoof pages that contain in invalid character. So, for example, you can spoof a page that looks like '<https://www.facebook.com>`' (note the invalid character), so its not just websites with no certs. In my opinion most users would not notice the invalid character at the end. Also I assume there is a special character that is less noticeable than '`' which could be used.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1247968#c5)â€¢ 9 years ago |
|  | |

Attached file
[Different approach to the same bug, javascript acts buggy with hash symbol.](attachment.cgi?id=8727015)
â€” [Details](attachment.cgi?id=8727015&action=edit)

Hope this will help in fixing.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1247968#c6)â€¢ 9 years ago |
|  | |

Any update on this security bug?Flags: needinfo?(bugs)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1247968#c7)â€¢ 9 years ago |
|  | |

Any updates here? This bug is lingering quite a bit.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1247968#c8)â€¢ 8 years ago |
|  | |

Samael, do you think you'd have time to help here? Just say no if you don't have, and I'll try to
find time.
I've been slacking horribly with this one.Flags: needinfo?(bugs) â†’ needinfo?(sawang)

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1247968#c9)â€¢ 8 years ago |
|  | |

As the prerendering stuff are progressing so slowly, I don't think I can take this bug recently...Flags: needinfo?(sawang)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1247968#c10)â€¢ 8 years ago |
|  | |

ok, no problem.

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1247968#c11)â€¢ 8 years ago |
|  | |

(In reply to Olli Pettay [:smaug] (vacation Nov 19-26) from [comment #10](/show_bug.cgi?id=1247968#c10 "VERIFIED FIXED - Full URL spoof using javascript URI scheme"))
> ok, no problem.
Got time for this. I'll try to figure it out.Assignee: bugs â†’ sawang

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1247968#c12)â€¢ 8 years ago |
|  | |

One thing I'm noticing is that Chrome doens't put javascript: into session history. As an extremely simple test, I did:
location.href="javascript:'whatever'";
In chrome, the document does change, but URL bar, history.length and location.href remain the same. In firefox both URL bar and location.href changed to javascript:'whatever', and history length increases.
I don't see a clear reason to keep javascript: in session history, maybe we should change this behavior.
BTW I think that's also the reason I sometimes keep being redirected again when pressing back. Addons such as Wikiwand is using javascript: to redirect. I have impression that some websites also do.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1247968#c13)â€¢ 8 years ago |
|  | |

Per spec, history.length should increase. Otherwise you get user dataloss: the user can't go back to the page that used to be there!
Also per spec the URL bar and location.href should become the URL of the document triggering the javascript: load or so. At some point we should really sit down and align this last bit with the spec... Pretty sure we have existing bugs tracking that.

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1247968#c14)â€¢ 8 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] (still a bit busy) from [comment #13](/show_bug.cgi?id=1247968#c13 "VERIFIED FIXED - Full URL spoof using javascript URI scheme"))
> Per spec, history.length should increase. Otherwise you get user dataloss:
> the user can't go back to the page that used to be there!
>
> Also per spec the URL bar and location.href should become the URL of the
> document triggering the javascript: load or so. At some point we should
> really sit down and align this last bit with the spec... Pretty sure we
> have existing bugs tracking that.
I believe you're referring [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)"). I found the spec for document.URL stuff [1] and am still trying to better understand how spec describes session history behaviors.
It looks to me that the document.URL stuff is all we need for this bug. I'll see what I can do.
[1] <https://html.spec.whatwg.org/multipage/browsers.html#javascript-protocol>

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1247968#c15)â€¢ 8 years ago |
|  | |

Attached patch

[WIP](attachment.cgi?id=8814066&action=diff)
â€” [Details](attachment.cgi?id=8814066&action=edit)
â€” [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1247968&attachment=8814066)

Hi Boris,
May I have your feedback and advices here? I'm trying to use the override URI as the URI for document, session history entry, and docshell's current URI, but I'm not quite confident about how it should be implemented. Does this look the right path to you?Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1247968#c16)â€¢ 8 years ago |
|  | |

If we want to take the "change the URI" approach, why wouldn't we just have the javascript: channel return the URI we want from GetURI, and presumably set the LOAD\_REPLACE flag so people ignore the originalURI?Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1247968#c17)â€¢ 8 years ago |
|  | |

Or perhaps even more simply, change which URI we pass to the NS\_NewInputStreamChannel call in nsJSChannel::Init, if we know which URI we'll really want at that point.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1247968#c18)â€¢ 8 years ago |
|  | |

In fact, I expect that the GetURI the nsJSChannel returns doesn't matter; what matters is the stream channel's URI.

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1247968#c19)â€¢ 8 years ago |
|  | |

Thanks Boris!
I will commit patches on [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)") since it's more reasonable to deal with the document.URL issue there, and revisit this bug afterward. I'm expecting I'll be able to just invalid this bug then.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1247968#c20)â€¢ 8 years ago |
|  | |

(In reply to Samael Wang [:freesamael] from [comment #19](/show_bug.cgi?id=1247968#c19 "VERIFIED FIXED - Full URL spoof using javascript URI scheme"))
> I will commit patches on [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)")
Any timeline on that? Doesn't seem to be much activity over there.
> and revisit this bug afterward. I'm expecting I'll be able to just invalid this bug then.
No, don't do that! Fixing a bug elsewhere doesn't make a related bug INVALID. You could maybe use "worksforme" for an old bug that magically goes away, but if it's a security bug and you know what fixed it (as in this case, [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)") presumably) then you need to mark it FIXED.Depends on: [836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)")Flags: needinfo?(sawang)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1247968#c21)â€¢ 8 years ago |
|  | |

Looks like the 'String.contains' function doesn't exist anymore. Make sure to replace
>"location.toString().contains('http')"
into
>"location.toString().startsWith('http')"
At line 13 of the original PoC attached in [Comment 0](/show_bug.cgi?id=1247968#c0 "VERIFIED FIXED - Full URL spoof using javascript URI scheme") for the PoC work again.

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1247968#c22)â€¢ 8 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #20](/show_bug.cgi?id=1247968#c20 "VERIFIED FIXED - Full URL spoof using javascript URI scheme"))
> (In reply to Samael Wang [:freesamael] from [comment #19](/show_bug.cgi?id=1247968#c19 "VERIFIED FIXED - Full URL spoof using javascript URI scheme"))
> > I will commit patches on [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)")
>
> Any timeline on that? Doesn't seem to be much activity over there.
>
> > and revisit this bug afterward. I'm expecting I'll be able to just invalid this bug then.
>
> No, don't do that! Fixing a bug elsewhere doesn't make a related bug
> INVALID. You could maybe use "worksforme" for an old bug that magically goes
> away, but if it's a security bug and you know what fixed it (as in this
> case, [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)") presumably) then you need to mark it FIXED.
Sorry I wasn't actively working on this recently. Made some attempts these 2 days but according to [bug 836567 comment 19](/show_bug.cgi?id=836567#c19 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)") I should be holding it for a moment. And thanks for the suggestion on the bugzilla process which I admit I'm not quite familiar.Flags: needinfo?(sawang)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1247968#c23)â€¢ 7 years ago |
|  | |

Any update here? This bug is getting very old.Flags: needinfo?(sawang)

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1247968#c24)â€¢ 7 years ago |
|  | |

I'll try to get back to this next week. Keep the ni? for reminding.

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1247968#c25)â€¢ 7 years ago |
|  | |

Updates will be on [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)")Flags: needinfo?(sawang)

|  | [Samael Wang [:freesamael] (away for now)](/user_profile?user_id=531029) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1247968#c26)â€¢ 7 years ago |
|  | |

Well, we need someone else to take on this for obvious reasons.Assignee: freesamael â†’ nobody

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1247968#c27)â€¢ 7 years ago |
|  | |

Since Boris took over [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)"), I am ni? him here.Flags: needinfo?(bzbarsky)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a63166485_1689)â€¢ 7 years ago |

Flags: sec-bounty? â†’ sec-bounty+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1247968#c28)â€¢ 5 years ago |
|  | |

OK, [bug 836567](/show_bug.cgi?id=836567 "RESOLVED FIXED - Set document.URL (location) to url of active document when navigation started for javascript:-generated documents per HTML5 (Nested javascript: iframe doesn't load, runs into nesting limit for frames with same URL)") is fixed now. Is there still an issue here? The original testcase in this bug doesn't even give me a "go back" option (if it's the first thing I load in the tab). If it's not, I can go back just fine and the URL updates correctly.

Flags: needinfo?(bzbarsky) â†’ needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1247968#c29)â€¢ 5 years ago |
|  | |

Yeah, this seems to be OK on nightly now.

Assignee: nobody â†’ bzbarskyGroup: dom-core-security â†’ core-security-releaseStatus: NEW â†’ RESOLVEDClosed: 5 years ago
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
--- â†’ [fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed)Flags: needinfo?(gijskruitbosch+bugs)Resolution: --- â†’ FIXEDTarget Milestone: --- â†’ mozilla74

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a125472191_75935)â€¢ 5 years ago |

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=wontfix)
[status-firefox73](/buglist.cgi?f1=cf_status_firefox73&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox73&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a126139550_553429)â€¢ 5 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Hani Yacoub, Desktop QA](/user_profile?user_id=583007) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1247968#c30)â€¢ 5 years ago |
|  | |

Verified as fixed on Firefox 75.0a1 (2020-02-12) and on Firefox 74.0b1 on Windows 10 x64, Ubuntu 16.04 and Mac OS X 10.14.

Status: RESOLVED â†’ VERIFIED
[status-firefox74](/buglist.cgi?f1=cf_status_firefox74&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox74&o1=equals&v1=verified)
[status-firefox75](/buglist.cgi?f1=cf_status_firefox75&o1=isnotempty):
--- â†’ [verified](/buglist.cgi?f1=cf_status_firefox75&o1=equals&v1=verified)Flags: qe-verify+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a128172053_578488)â€¢ 5 years ago |

Whiteboard: [post-critsmash-triage] â†’ [post-critsmash-triage][adv-main74+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1247968#c31)â€¢ 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9131371)
â€” [Details](attachment.cgi?id=9131371&action=edit)

I cribbed sheppy's comment from <https://bugzilla.mozilla.org/show_bug.cgi?id=836567#c68> for this one...

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a128478415_578488)â€¢ 5 years ago |

Alias: CVE-2020-6808

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a153045291_1689)â€¢ 4 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1247968#a261790981_5898)â€¢ 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1247968&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top â†‘

## Attachment

Hide Details

### General

Creator:  [:Gijs (he/him)](/user_profile?user_id=159069)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


