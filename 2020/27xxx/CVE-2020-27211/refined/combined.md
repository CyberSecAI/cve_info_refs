=== Content from infocenter.nordicsemi.com_b15b7c30_20250119_113308.html ===

[Skip to main content](#content)[Skip to search](#search)Powered by Zoomin Software. For more details please contact[Zoomin](https://www.zoominsoftware.com)[![Technical Documentation](/assets/img/nordic-logo.svg?d1d635ef035529247bd9)![Technical Documentation](/assets/img/nordic-logo.svg?d1d635ef035529247bd9)](/)[![Technical Documentation](/assets/img/nordic-logo.svg?d1d635ef035529247bd9)](/)

* Other Sites[Nordicsemi.com](https://www.nordicsemi.com/)[DevAcademy](https://academy.nordicsemi.com/)[DevZone](https://devzone.nordicsemi.com/)
* [All Documents](/bundle)
* [Login](/auth/login)

* + About
  + [Terms of Service](https://www.nordicsemi.com/About-us/Policies-and-Statements)[Privacy Policy](https://www.nordicsemi.com/Privacy/Privacy-Policy)[Contact Us](https://www.nordicsemi.com/About-us/Contact-Us)
* + Support
  - [![](/assets/img/devzone.png?857c0856e19043cc8533)](https://devzone.nordicsemi.com/)
  - [![](/assets/img/academy.png?c316dc4b79741481dede)](https://academy.nordicsemi.com/)
* + Follow us!

* Copyright Â© 2008 - 2025 Nordic Semiconductor ASA. All Rights Reserved.
* Powered By[*Zoomin\_Logo*](https://zoominsoftware.com)
TitleResults for âHow to create a CRG?âAlso Available inAlert



=== Content from www.aisec.fraunhofer.de_83b45f81_20250119_113320.html ===


Search

[![](/content/dam/aisec/aisec_190x52.gif)
Fraunhofer Institute for Applied and Integrated Security](/en.html)

[Fraunhofer Institute for Applied and Integrated Security](/en.html)

* [Jobs / Career](/en/jobs-career.html)
* [Blog](/en/Blog.html)
* [Contact](/en/about-us/contact.html)
* [Deutsch](/)

* [Jobs / Career](/en/jobs-career.html)
* [About Fraunhofer AISEC](/en/about-us.html)
  [X]
  [About Fraunhofer AISEC](/en/about-us.html)
  + [In Profile](/en/about-us/in-profile.html)
  + [Opportunities for collaboration](/en/about-us/Collaboration.html)
  + [How to find us](/en/about-us/how-to-find-us.html)
  + [Contact](/en/about-us/contact.html)
  + [Laboratories](/en/about-us/Laboratories.html)
  + [Scientific Excellence](/en/about-us/scientific_excellence.html)
  + [Quality Management](/en/about-us/quality_management.html)
  + [Competence Center for Post-Quantum Cryptography](/en/about-us/Competence-Center-PQC.html)
  + [Advisory Board](/en/about-us/advisory-board.html)
  + [Statement for Democracy](/en/about-us/statement-for-democracy.html)
* [Fields of Expertise](/en/fields-of-expertise.html)
  [X]
  [Fields of Expertise](/en/fields-of-expertise.html)
  + [Cognitive Security Technologies](/en/fields-of-expertise/CST.html)
    - [BayQS](/en/fields-of-expertise/CST/bayqs.html)
  + [Hardware Security](/en/fields-of-expertise/HWS.html)
  + [Secure Infrastructure](/en/fields-of-expertise/SIS.html)
  + [Secure Systems Engineering](/en/fields-of-expertise/SSE.html)
  + [Secure Operating Systems](/en/fields-of-expertise/SOS.html)
  + [Product Protection and Industrial Security](/en/fields-of-expertise/PIN.html)
  + [Service and Application Security](/en/fields-of-expertise/SAS.html)
* [Spotlights](/en/spotlights.html)
  [X]
  [Spotlights](/en/spotlights.html)
  + [Trusted Electronics](/en/spotlights/trusted-electronics.html)
  + [Post-Quantum Cryptography](/en/spotlights/Competence-Center-PQC.html)
  + [Deepfakes](/en/spotlights/Deepfakes.html)
  + [Cyber Resilience Act](/en/spotlights/the-cyber-resilience-act---security-requirements-for-products-wi.html)
* [Media](/en/media.html)
  [X]
  [Media](/en/media.html)
  + [Publications](/en/media/publications.html)
    - [Annual report 2022](/en/media/publications/Annual-report-2022.html)
    - [Annual Report 2023](/en/media/publications/annual-report-2023.html)
  + [Press Releases](/en/media/press-releases.html)
  + [Newsletter](/en/media/Newsletter.html)
  + [Events](/en/media/events.html)
    - [Workshop Secure & Trustworthy Hardware](/en/media/events/workshop--secure-and-trustworthy-hardware-.html)
  + [More media](/en/media/moremedia.html)
    - [Serious Game](/en/media/moremedia/CharlieQC.html)
* [Blog](/en/Blog.html)
* More

To view this video please enable JavaScript, and consider upgrading to a web browser that supports HTML5 video

Where am I?

* [English](/en.html)
* Shedding too much Light on a Microcontroller’s Firmware Protection

# Shedding too much Light on a Microcontroller's Firmware Protection

Proceedings of the 11th USENIX Workshop on Offensive Technologies (WOOT '17) - Vancouver, BC, Canada            [CVE number 2017-18347](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18347)

Almost every microcontroller with integrated flash features firmware readout protection. This is a form of content protection which aims at securing intellectual property (IP) as well as cryptographic keys and algorithms from an adversary. One series of microcontrollers are the STM32 which have recently gained popularity and thus are increasingly under attack. However, no practical experience and information on the resilience of STM32 microcontrollers is publicly available. The paper presents the first investigation of the STM32 security concept, especially targeting the STM32F0 sub-series. Starting with a conceptual analysis, we discover three weaknesses and develop them to vulnerabilities by demonstrating corresponding Proofs-of-Concept. At first, we discover that a common security configuration provides low protection which can be exploited using our Cold-boot Stepping approach to extract critical data or even readout-protected firmware. Secondly, we reveal a design weakness in the security configuration storage which allows an attacker to downgrade the level of firmware protection, thereby enabling additional attacks. Thirdly, we discover and analyze a hardware flaw in the debug interface, attributed to a race condition, that allows us to directly extract readprotected firmware using an iterative approach. Each attack requires only low-priced equipment, thereby increasing the impact of each weakness and resulting in a severe threat altogether.

##

### Paper Download

[Download](/content/dam/aisec/ResearchExcellence/woot17-paper-obermaier.pdf "Download")

### Presentation

[Download](/content/dam/aisec/ResearchExcellence/firmwareprotection-pres-woot17.pdf "Download")

### Bibtex

[Download](/content/dam/aisec/Dokumente/Publikationen/Studien_TechReports/englisch/Biblio-Bibtex.bib "Download")

### Download

### Firmware under attack

[Download](/content/dam/aisec/ResearchExcellence/microbootCrc.zip "Download")

### Download

### Coldboot Stepping PoC

[Download](/content/dam/aisec/ResearchExcellence/coldbootStepping.zip "Download")

### Download

### Firmware Extraction PoC

[Download](/content/dam/aisec/ResearchExcellence/swdFirmwareExtractor.zip "Download")

## Laboratory setup for Cold Boot Stepping

[![](/en/FirmwareProtection/jcr:content/contentPar/sectioncomponent_0/sectionParsys/textwithasset/imageComponent/image.img.jpg/1501770805414/1-coldbootStepping-setup1.jpg)](/en/FirmwareProtection/jcr%3Acontent/contentPar/sectioncomponent_0/sectionParsys/textwithasset/imageComponent/image.img.4col.large.jpg/1501770805414/1-coldbootStepping-setup1.jpg)

By observing changes in SRAM, one can reverse-engineer the basic control flow, find out the usage of specific addresses and may also discover briefly visible secret data. The system is only allowed to run for a precisely controlled duration and is then stopped. The contents of the SRAM is read out and a snapshot is created. With well chosen and increasing runtime duration this is similar to stepping through the firmware, since only a few instructions are executed between each SRAM snapshot.

## UV-C irradiation setup for Security Downgrade

[![](/en/FirmwareProtection/jcr:content/contentPar/sectioncomponent_0/sectionParsys/textwithasset_0/imageComponent/image.img.jpg/1501770832653/2-uv1.jpg)](/en/FirmwareProtection/jcr%3Acontent/contentPar/sectioncomponent_0/sectionParsys/textwithasset_0/imageComponent/image.img.4col.large.jpg/1501770832653/2-uv1.jpg)

The STM32 Readout Protection Level protection mechanism is based on the RDP and nRDP bytes in the option byte memory region. At the power-on event, the option bytes are loaded from flash memory and the corresponding RDP Level is set. We show by experiment, that a flaw in the implementation evolves to a practical threat. The option byte memory region can be modified specifically by UV-C light performing optical fault injection.

## Setup for firmware extraction out of a device using RDP Level 1

[![](/en/FirmwareProtection/jcr:content/contentPar/sectioncomponent_0/sectionParsys/textwithasset_1/imageComponent/image.img.jpg/1501770858638/3-lvl1Extract.jpg)](/en/FirmwareProtection/jcr%3Acontent/contentPar/sectioncomponent_0/sectionParsys/textwithasset_1/imageComponent/image.img.4col.large.jpg/1501770858638/3-lvl1Extract.jpg)

The STM32F0 series microcontrollers use the Serial Wire Debug interface for debugging and flash programming. When a debugger becomes attached to this interface in Readout Protection Level 1, the flash protection logic cuts access to flash memory. Due to a race condition in the implementation not only a single access can be performed, but the whole firmware can be extracted from a microcontroller.

### Contact

### Contact Press / Media

#### Stefan Tatschner

Security Researcher

Fraunhofer AISEC
Lichtenbergstraße 11
85748 Garching b. München

* Send email
* stefan.tatschner@aisec.fraunhofer.de

## Navigation and Social Media

### Share

Print

* [Visitor regulations](/en/Visitorregulations.html)
* [Tenders](/en/Tenders.html)
* [Imprint](/en/imprint.html)
* [Data Protection](/en/data_protection.html)

© 2025

**Source: Fraunhofer-Gesellschaft
Fraunhofer Institute for Applied and Integrated Security - Shedding too much Light on a Microcontroller’s Firmware Protection**

Online in Internet; URL: https://www.aisec.fraunhofer.de/en/FirmwareProtection.html

Date: 16.1.2025 22:55



=== Content from www.aisec.fraunhofer.de_9735de12_20250119_113318.html ===


Titel - Suche

[![](/content/dam/aisec/aisec_190x52.gif)
Fraunhofer-Institut für Angewandte und Integrierte Sicherheit](/)

[Fraunhofer-Institut für Angewandte und Integrierte Sicherheit](/)
[zurück zur Startseite](/)

* [Jobs und Karriere](/de/jobs.html)
* [Ansprechpartner](/de/das-institut/kontakt-und-anfahrt/ansprechpartner.html)
* [Publikationen](/de/das-institut/publikationen.html)
* [Kontakt und Anfahrt](/de/das-institut/kontakt-und-anfahrt.html)
* [Blog](/de/blog.html)
* [English](/en.html)

* [Das Fraunhofer AISEC](/de/das-institut.html)
  [X]
  [Das Fraunhofer AISEC](/de/das-institut.html)
  + [Im Profil](/de/das-institut/im-profil.html)
  + [Wissenschaftliche Exzellenz](/de/das-institut/wissenschaftliche-exzellenz.html)
  + [Kooperationsmöglichkeiten](/de/das-institut/Kooperationen.html)
  + [Qualitätsmanagement](/de/das-institut/qualitaetsmanagement.html)
  + [Kontakt und Anfahrt](/de/das-institut/kontakt-und-anfahrt.html)
  + [Publikationen](/de/das-institut/publikationen.html)
    - [Jahresbericht 2022](/de/das-institut/publikationen/jahresbericht-2022.html)
    - [Jahresbericht 2023](/de/das-institut/publikationen/Jahresbericht2023.html)
  + [Unser Netzwerk](/de/das-institut/netzwerk.html)
  + [Kuratorium](/de/das-institut/kuratorium.html)
  + [Laborlandschaft](/de/das-institut/laborraeume.html)
  + [Statement für Demokratie](/de/das-institut/statement-fuer-demokratie.html)
* [Forschungsabteilungen](/de/forschungsabteilungen.html)
  [X]
  [Forschungsabteilungen](/de/forschungsabteilungen.html)
  + [Cognitive Security Technologies](/de/forschungsabteilungen/CST.html)
  + [Hardware Security](/de/forschungsabteilungen/HWS.html)
  + [Product Protection and Industrial Security](/de/forschungsabteilungen/PIN.html)
  + [Service and Application Security](/de/forschungsabteilungen/SAS.html)
  + [Secure Operating Systems](/de/forschungsabteilungen/SOS.html)
  + [Secure Systems Engineering](/de/forschungsabteilungen/SSE.html)
  + [Secure Infrastructure](/de/forschungsabteilungen/SIS.html)
* [Spotlights](/de/spotlights.html)
  [X]
  [Spotlights](/de/spotlights.html)
  + [Cyber Resilience Act](/de/spotlights/Cyber-Resilience-Act-Sicherheitsanforderungen-fuer-Produkte-mit-digitalen-Elementen.html)
  + [Vertrauenswürdige Elektronik](/de/spotlights/vertrauenswuerdige-elektronik.html)
  + [Post-Quanten-Kryptografie](/de/spotlights/kompetenzzentrum-post-quanten-kryptografie.html)
  + [Deepfakes](/de/spotlights/Deepfakes.html)
* [Presse und Veranstaltungen](/de/presse-und-veranstaltungen.html)
  [X]
  [Presse und Veranstaltungen](/de/presse-und-veranstaltungen.html)
  + [Veranstaltungen](/de/presse-und-veranstaltungen/veranstaltungen.html)
    - [Workshop Sichere & Vertrauenswürdige Hardware](/de/presse-und-veranstaltungen/veranstaltungen/workshop--sichere-und-vertrauenswuerdige-hardware-.html)
  + [Pressemitteilungen](/de/presse-und-veranstaltungen/pressemitteilungen.html)
  + [Newsletter](/de/presse-und-veranstaltungen/NewsletterAbo.html)
  + [Medien](/de/presse-und-veranstaltungen/Medien.html)
* [Jobs und Karriere](/de/jobs.html)
  [X]
  [Jobs und Karriere](/de/jobs.html)
  + [Duales Studium](/de/jobs/Duales_Studium.html)
    - [AISEC-2021-28](/de/jobs/Duales_Studium/aisec-2021-28.html)
    - [AISEC-2021-27](/de/jobs/Duales_Studium/aisec-2021-27.html)
* [Lernlabor Cybersicherheit](/de/lernlabor.html)
  [X]
  [Lernlabor Cybersicherheit](/de/lernlabor.html)
  + [Fachbeirat](/de/lernlabor/fachbeirat_LLCS.html)
  + [Charlie und die Quantenfabrik](/de/lernlabor/SeriousGame.html)
  + [Kompetenzlücken schließen](/de/lernlabor/Interview.html)
* [Blog](/de/blog.html)
* Mehr

Wo bin ich?

* [Deutsch](/)
* [Das Fraunhofer AISEC](/de/das-institut.html)
* [Wissenschaftliche Exzellenz](/de/das-institut/wissenschaftliche-exzellenz.html)
* Security and Trust in Open Source Security Tokens

# Security and Trust in Open Source Security Tokens

Passwords are the most common authentication mechanism for private as well as professional IT services such as social media, banking or enterprise infrastructure. Unfortunately, the use of passwords leads to many security issues. Weak passwords allow for guessing or dictionary attacks, password re-use may lead to credential stuffing where stolen passwords are used for other services of the same users.

This is why hardware security tokens are often used as a second authentication factor to increase the security. These tokens have been designed to prevent the described threats effectively by using strong cryptography and a securely stored key. Although the use of security tokens is generally helpful to improve authentication security, tokens could be manipulated at multiple points before they reach the end user. Starting from the actual token designs going into internationally distributed production, then to the supply chain and distribution to end users, there is significant additional attack surface for malicious manipulation.

In the paper **[Security and Trust in Open Source Security Tokens](https://eprint.iacr.org/2021/640.pdf)**, we investigated the trustworthiness of security tokens. We specifically concentrate on security tokens which are marketed as open source and focus on hardware attacks in supply chain and evil maid scenarios. We perform a systematic analysis of the most important commercially available candidates. The trustworthiness of the security tokens was assessed according to a top-down methodology which we outline shortly in the following. We uncovered several vulnerabilities for which we were able to contribute effective software-based mitigation measures to the respective open source projects. All details can be found in the paper. The uncovered vulnerabilities in hardware indicated that respective microchips must only be used with caution when security is important for a product.

##

![](/de/das-institut/wissenschaftliche-exzellenz/security-and-trust-in-open-source-security-tokens/jcr:content/contentPar/sectioncomponent/sectionParsys/textwithasset_897530638/imageComponent/image.img.jpg/1621239832585/Architectural-Attacks-HWS.jpg "Architectural Attacks_Hardware Security")

© Fraunhofer AISECArchitectural Attacks

#### **Architectural Attacks**

We started with an evaluation of the device architecture and by identifying components which are used for the storage of secrets and authentication operations. Based on the preliminary analysis, we investigated whether the existing inter-chip and debug interfaces have any exploitable logical flaws or are prone to known vulnerabilities. Within this step we successfully compromised the Nitrokey FIDO U2F and the Nitrokey Pro 2 token security measures. The Librem Key from Purism is identical to the Nitrokey Pro 2 and as such it is by this attack affected as well. The attacks are explained in detail in chapter 5 and 6 of this paper.

**Relevant CVEs:**

* Nitrokey FIDO U2F - CVE-2020-12061
* ST Microelectronics STM32F1 - CVE-2020-8004

##

#### **Side-Channel Attacks**

If the previous attempts did not reveal any weaknesses, we focused on the cryptographic implementations that are used during the authentication operations. For that, we used pen-like EM measurement probes with coarse spatial resolution and oscilloscopes operating in a sub-GHz range. This side-channel analysis led to the successful recovery of the private keys for the micro-ecc library, which is used within the Solokeys Solo and the Nitrokey FIDO2 token, and the ARM CryptoCell hardware accelerator, which is contained in the nRF52840 microcontroller and which is part of the Google OpenSK and the Feitian OpenSK token. The details about the side-channel analysis and key recovery is explained in chapter 7.1 and 8.1.

**Relevant CVEs:**

* micro-ecc - CVE-2020-27209
* Nordic Semiconductor nRF52840 - CVE-2020-27211

![](/de/das-institut/wissenschaftliche-exzellenz/security-and-trust-in-open-source-security-tokens/jcr:content/contentPar/sectioncomponent/sectionParsys/textwithasset_1445364373/imageComponent/image.img.jpg/1621239887161/Side-Channel-Attacks-HWS.jpg "Side-Channel-Atttacks_Hardware Security")

© Fraunhofer AISEC Side-Channel Attacks

##

![](/de/das-institut/wissenschaftliche-exzellenz/security-and-trust-in-open-source-security-tokens/jcr:content/contentPar/sectioncomponent/sectionParsys/textwithasset_1911974987/imageComponent/image.img.jpg/1621239912261/Fault-Injection-Attacks-HWS.jpg "Fault Injection Attacks_Hardware Security")

© Fraunhofer AISECFault Injection Attacks

#### **Fault Injection Attacks**

To further assess the security, we investigated the hardware security features of the included chips in more detail. In this step, we evaluated if included chips exhibit exploitable vulnerabilities with the help of side-channel analyses and fault injections. Due to the black box nature of the implemented security measures reverse engineering effort is needed. We were able to circumvent the read-out protection of the STM32L4 and the nRF52840 microcontroller, which are used in the SoloKeys Solo & Somu, the Nitrokey FIDO2, the Google OpenSK and the Feititan OpenSK. The details of these attacks can be found in chapter 7.2 and 8.2.

**Relevant CVEs:**

* ST Microelectronics STM32L4 - CVE-2020-27212, CVE-2021-29414
* Nordic Semiconductor nRF52840 - CVE-2021-29415
* SoloKeys Solo & Somu - CVE-2020-27208
* Nitrokey FIDO2 - CVE-2020-27208

Despite our findings, authentication tokens and second factor authentication are clearly beneficial for security. However, our findings show that it is not always easy to rely on hardware security features which are provided by chip manufacturers. **We conclude that it is highly important to carefully assess the security of microchips against physical attacks in a capable laboratory**. Some vulnerabilities can be mitigated using proper countermeasures, as it was the case here. We proposed effective countermeasures which, at the time of writing, have already been partially implemented. In this way we were able to contribute to the security of current and future authentication tokens. In other cases, however, hardware vulnerabilities may be unrecoverable. This shows the high relevance of hardware security for the security of end products. The full details of the analysis, attacks as well as countermeasures can be found in the paper, which is open access and linked below.

## Further information

* [Read the paper](https://eprint.iacr.org/2021/640.pdf "Read the paper")
* [CHES 2021](https://www.iacr.org/cryptodb/data/paper.php?pubkey=31282%20)

## Authors

### Contact Press / Media

#### Marc Schink

Hardware Security

Fraunhofer AISEC
Lichtenbergstraße 11
85748 Garching b. München

Telefon  +49 89 3229986-144

* E-Mail senden
* marc.schink@aisec.fraunhofer.de

### Contact Press / Media

#### Alexander Wagner

Hardware Security

Fraunhofer AISEC
Lichtenbergstraße 11
85748 Garching b. München

Telefon  +49 89 3229986-149

* E-Mail senden
* alexander.wagner@aisec.fraunhofer.de

### Contact Press / Media

#### Florian Unterstein

Hardware Security

Fraunhofer AISEC
Lichtenbergstraße 11
85748 Garching b. München

### Kontakt

### Contact Press / Media

#### Marc Schink

Hardware Security

Fraunhofer AISEC
Lichtenbergstraße 11
85748 Garching b. München

Telefon  +49 89 3229986-144

* E-Mail senden
* marc.schink@aisec.fraunhofer.de

### Contact Press / Media

#### Alexander Wagner

Hardware Security

Fraunhofer AISEC
Lichtenbergstraße 11
85748 Garching b. München

Telefon  +49 89 3229986-149

* E-Mail senden
* alexander.wagner@aisec.fraunhofer.de

## Navigation und Social Media

### Teilen

Drucken

* [Besucherregelung](/de/Besucherregelungen.html)
* [Ausschreibungen](/de/Ausschreibungen.html)
* [Beschaffung](/de/Beschaffung.html)
* [Impressum](/de/impressum.html)
* [Datenschutzerklärung](/de/datenschutzerklaerung.html)

© 2025

**Quelle: Fraunhofer-Gesellschaft
Fraunhofer-Institut für Angewandte und Integrierte Sicherheit - Security and Trust in Open Source Security Tokens**

Online im Internet; URL: https://www.aisec.fraunhofer.de/de/das-institut/wissenschaftliche-exzellenz/security-and-trust-in-open-source-security-tokens.html

Datum: 16.1.2025 21:08



=== Content from limitedresults.com_e897854d_20250119_113316.html ===


Search for:

Search

[Skip to content](#content)

[LimitedResults](https://limitedresults.com/)

Limited contribution to this world

Menu

* [Boot](https://limitedresults.com/)
* [Results](https://limitedresults.com/posts/)
  + [Enter the EFM32 Gecko](https://limitedresults.com/2021/06/enter-the-efm32-gecko/)
  + [The PocketGlitcher](https://limitedresults.com/2021/03/the-pocketglitcher/)
  + [nRF52 Debug Resurrection (APPROTECT Bypass) Part 2](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass-part-2/)
  + [nRF52 Debug Resurrection (APPROTECT Bypass) Part 1](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/)
  + [Nuvoton M2351 MKROM](https://limitedresults.com/2020/01/nuvoton-m2351-mkrom-armv8-m-trustzone/)
  + [ESP32 Pwned Forever](https://limitedresults.com/2019/11/pwn-the-esp32-forever-flash-encryption-and-sec-boot-keys-extraction/)
  + [ESP32 Secure Boot](https://limitedresults.com/2019/09/pwn-the-esp32-secure-boot/)
  + [ESP32 Crypto-Core](https://limitedresults.com/2019/08/pwn-the-esp32-crypto-core/)
  + [ARM MBedTLS](https://limitedresults.com/2019/05/pwn-mbedtls-on-esp32-dfa-warm-up/)
  + [WIZ connected](https://limitedresults.com/2019/02/pwn-the-wiz-connected/)
  + [LIFX Mini white](https://limitedresults.com/2019/01/pwn-the-lifx-mini-white/)
  + [Tuya lightbulbs](https://limitedresults.com/2018/11/pwn-the-tuya-lightbulbs/)
  + [Xiaomi Yeelight](https://limitedresults.com/2018/10/pwn-the-yeelight-dirty/)
* [COMS](https://limitedresults.com/category/talk/)
  + [NoHat 21](https://limitedresults.com/2021/11/nohat-21/)
  + [Black Hat Europe 2020](https://limitedresults.com/2020/12/black-hat-europe-2020/)
  + [Black Hat Europe 2019](https://limitedresults.com/2019/12/black-hat-europe-2019/)
  + [ZeroNights 2019](https://limitedresults.com/2019/12/zeronights-2019/)
  + [Bsides Stuttgart 2019](https://limitedresults.com/2019/05/bsides-stuttgart-2019/)
  + [BSides Ljubljana::0x7E3](https://limitedresults.com/2019/03/bsides-ljubljana0x7e3/)
* Tags
  + [nRF52](/tag/nRF52/)
  + [ESP32](/tag/esp32/)
  + [Fault Injection](/tag/fault-injection/)
  + [LightBulbs](/tag/lightbulbs/)
  + [IOT](/tag/iot/)
* [About me](https://limitedresults.com/about-me/)

# nRF52 Debug Resurrection (APPROTECT Bypass) Part 1

Posted on June 10, 2020May 23, 2021 by [LimitedResults](https://limitedresults.com/author/admin/)

**Yes, resurrection of JTAG/SWD interface on protected platforms has always been a sensitive topic in embedded security**.

This security investigation presents a way to bypass the APPROTECT on a protected nRF52840, in order to reactivate the Serial Wire Debug Interface (SWD), offering full debug capabilities on the target (R/W access to Flash/RAM/Registers, Code Exec and reprogramming). All the nRF52 versions are impacted.

Due to its intrinsic characteristics, the vulnerability cannot be patched without Silicon redesign, leading to a countless number of vulnerable devices on the field forever.

**Nordic Semiconductor and LimitedResults did not agree on a responsible disclosure.**

## **About nRF52 Series SoC Family**

The entire nRF52 family consists of six different nRF52 platforms, all built around the ARM Cortex-M4F CPU.

![](data:image/svg+xml...)![](https://i1.wp.com/limitedresults.com/wp-content/uploads/2020/06/nRF52_series.png?fit=1024%2C235&ssl=1)

*The entire Nordic nRF52 Series SoC Family*

A comparison table between the different platforms is available [**here**](https://infocenter.nordicsemi.com/index.jsp?topic=%2Fstruct_nrf52%2Fstruct%2Fnrf52.html).

Let’s focus on the family flagship, the nRF52840.

## **The Target: nRF52840**

**The nRF52840** System-on-Chip (SoC) is the most advanced member of the nRF52 Series SoC family. It is an advanced Bluetooth, Thread and Zigbee multi-protocol SoC built around a 64 MHz Cortex-M4F CPU. It comes with 1MB of Flash and 256Kb of RAM, both fully integrated.

In term of security, the ARM TrustZone CryptoCell cryptographic unit is integrated as cryptographic engine. The block diagram gives an idea of the capabilities (and the complexity) of the nRF52840:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/block_diagram.png?resize=609%2C833&ssl=1)

*Block diagram of the Nordic nRF52840*

## **Code Readout Protection**

Nowadays, most of the Semiconductor Vendors implement a security feature called **Code Readout Protection** inside their MCUs/SoCs, preventing an attacker with physical access to dump the Code/Data stored in the integrated Flash Memory and also to modify it.

This security feature can have different names depending on the chip vendors (CRP, RDP, PCROP…)

Generally, once an attacker has a copy of the Firmware, he can start the reverse engineering process or just grab some sensitive data (such as keys and passwords).

### **Previously on the nRF51 serie**s

Back in 2015, **[Include Security](https://blog.includesecurity.com/2015/11/NordicSemi-ARM-SoC-Firmware-dumping-technique.html)** found a vulnerability in the design of the nRF51 code readout protection feature (called **RBPCONF**), allowing an attacker to recover the entire Firmware using the SWD debug interface.

On the nRF51, once the RBPCONF protection is enabled, using the debugger to access directly the Flash or RAM return nothing but zeros. However, it is still possible to control the code execution and read and write to registers (even to Program Counter). So finding a “gadget” in the protected memory such as a simple load word instruction that read memory from an address in some register to another register is sufficient to extract the entire Firmware. Consequently, an attacker with physical access to an nRF51-based device, is able to dump the Flash, exploiting this design vulnerability.

**Thereby, nRF51 code readout protection (RBPCONF) is considered as a broken security mechanism and does not protect against Firmware Extraction.**

### **Access Port Protection APPROTECT on nRF52**

After this fail, **[NordicSemiconductor](https://www.nordicsemi.com)** decided to design the nRF52 with a more restricted security mechanism in order to protect against Memory Readout. This security feature is called **Access Port Protection (APPROTECT)**, mentioned very briefly in the nRF52 Datasheet:

![](data:image/svg+xml...)![](https://i1.wp.com/limitedresults.com/wp-content/uploads/2020/06/approtect.png?fit=1024%2C482&ssl=1)

*nRF52 Overview*

Typically, an external debugger is accessing the ARM CPU through the Debug Access Port (DAP). Then, two different ports are available:

– **CTRL-AP.** This is the Master Debug Port and it is not dependent of APPROTECT. It will be used to recover, in case of bricked device for example.

– **AHB-AP.** This the real Debug Port to access memories and control the CPU via SWD.

***NordicSemiconductor does not provide any information about the APPROTECT mechanism.*** I recommend to read **[ARM reference documentation of Cortex-M](http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.ddi0439b/ch01s05s01.html)**.

### UICR

**User Information Configuration Registers (UICR)** are non-volatile memory (NVM) registers for configuring user-specific settings. They are mapped at **0x10001000**.

**APPROTECT** belongs to UICR. **It is necessary to write 0xFFFFFF00 at address 0x10001208** to enable the Access Port Protection, as shown below:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/approtect_reg.png?fit=1024%2C414&ssl=1)

*APPROTECT Configuration Register*

Power-on-Reset is then required to apply new settings present in UICR.

**According to Nordic, the APPROTECT security cannot be disabled without erasing all the RAM and Memory Flash.**

## **Setting the environment**

### **nRF52840 Dev-Kit**

The development Kit [**nRF52840-DK**](https://www.nordicsemi.com/Software-and-tools/Development-Kits/nRF52840-DK) is used for the tests, based on **[nRF52840](https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF52840)**.

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/nRF52840-DK.png?resize=731%2C350&ssl=1)

*nRF52840 Dev-Kit. The target is the little chip on the right.*

The User Manual and schematics are available on the manufacturer’s website. The nRF52840 is a QFN73 version, 7x7mm, located on the right.

This kit has an embedded **[Segger J-Link debugger](https://www.segger.com/products/debug-probes/j-link/)** (the biggest chip with a white sticker).

The SDK is the latest version available now **nRF5\_SDK\_16.0.0\_98a08e2**.

**Nrfjprog v10.6.0 and JLink v6.64** are used as command line tools.

As a quick start, I just compile and flash an example from the SDK to check my environment is OK. Everything runs smoothly, I can focus on the APPROTECT security feature.

### Enabling the APPROTECT

Method 1 (via OpenOCD):

```
$ openocd -s /usr/local/share/openocd/scripts -f ./interface/jlink.cfg -c "transport select swd" -f ./target/nrf52.cfg
#Telnet
$ telnet localhost 4444
> flash fillw 0x10001208 0xFFFFFF00 0x01
> reset
```

Method 2 (via nrfjprog):

```
$ nrfjprog --memwr 0x10001208 -- val 0xFFFFFF00
```

After that, any attempt to connect the CPU will fail, displaying “**Error: Could not find MEM- AP to control the core”**:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/APPROTECT_ACTIVATED.png?resize=814%2C292&ssl=1)

*SWD is disabled, due to the activation of the APPROTECT.*

Any attempt to attach GDB displays the error:

```
Error: attempted 'gdb' connection rejected
```
### **Disabling the APPROTECT**

Method 1 (via OpenOCD):

```
# Read APPROTECTSTATUS
# (0x0 Access port protection enabled - 0x1 APP disabled)
> nrf52.dap apreg 1 0x0c 0x00000000
# Write ERASEALL register
> nrf52.dap apreg 1 0x04 0x01
> reset
```

Method 2 (via nrfjprog):

```
$ nrfjprog -f NRF52 --recover
```

**All Flash and RAM are erased during the process. After a Reset, the nRF52 can be programmed again.**

## **Attack Strategy**

### **Boot Process**

The Boot Process is relatively simple, due to the fact that the nRF52840 does not contain bootROM code (so no embedded boot-loader routines, nor IAP/ISP routines to  reverse-engineer…)

The entry point is 0x000002B4, located in Flash memory:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/reset_vector.png?resize=519%2C212&ssl=1)

 *I used Ghidra…economic times are tough.*

So far, it is really simple. All the blocks, like the NVMC, the memories, the Debug Acces Port… are initialised purely in Hardware.

### Reset

Several sources may trigger a reset. All the reset sources and their targets are summarised in the table below:

![](data:image/svg+xml...)![](https://i2.wp.com/limitedresults.com/wp-content/uploads/2020/06/reset.png?fit=1024%2C346&ssl=1)

*Reset Table*

The last line is interesting. **A Power-on Reset will reset the entire SoC, included the Debug Port.**

### The Limited Plan

**The goal is to re-enable the access to the AHB-AP Debug, despite of the APPROTECT.**

After a Power-on Reset, the AHB-AP has to initialise itself according to the value of the APPROTECT, which is stored in UICR (a dedicated Flash memory partition).

During the boot, the Memory Controller (NVMC) has to communicate with the CPU (or with the AHB-AP Block directly) to provide the APPROTECT value stored in Flash, and then set its protection state accordingly.

Due to the absence of BootROM, this is achieved by pure Hardware and it has to be done during the early boot process, before the CPU start to load from Flash and execute Code.

**My goal is to identify this “pure HW process” and then try to modify the AHB-AP Debug Initialisation. If successful, the Debug features will be reactivated until the next Power-on Reset.**

**Fault injection is (again) the only way to go here.**

## **Target Preparation**

### Power Configuration

The system contains two different regulator stages, REG0 and REG1. Each regulator stage has two different and configurable options based on Low-dropout Regulators (LDO) and Buck Regulators (DC/DC).

![](data:image/svg+xml...)![](https://i2.wp.com/limitedresults.com/wp-content/uploads/2020/06/power_config.png?fit=1024%2C640&ssl=1)

*Normal Voltage mode on nRF52840, with only LDO enabled*

Only DEC4 is mentioned on the schematic above.

**I am particularly interested by the DEC pins (DEC1, DEC2 until DEC6**), where external decoupling capacitors are connected. NordicSemiconductor does not provide any detail about the nRF52 power network.

After a quick probing session, I **decide to focus on DEC4 (1.2V-1.3V) and DEC1 (0.8V-0.9V):**

* **DEC4** is the power line after the REG1 stage. So it probably supplies the entire digital system (CPU & memories)

* **DEC1** is definitively the CPU power line.

### PCB Modification

To analyse the activity inside the chip, it is necessary to slightly modify the PCB:

![](data:image/svg+xml...)![](https://i1.wp.com/limitedresults.com/wp-content/uploads/2020/06/nrf52840_sch-cap_removed.png?fit=1024%2C609&ssl=1)

*PCB Schematic. Some capacitors has been removed.*

The corresponding decoupling capacitors C5, C15, C16 and C11 are removed.

### **Fault Injection System**

My **low-cost voltage gliching** is an homemade HW electronic system, dedicated to perform fault injections in a suitable manner. The total cost of this electronic board is less than 5$, which proves fault injection is a very low cost technique and can be achieved by limited hackers.

**The output of my low-cost voltage glitching system will be connected to DEC1**, using the SMA connector previously installed.

### **Soldering**

A red wire is soldered to DEC4 and a thin wire is soldered to DEC1:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/dec4dec1_soldered.jpg?fit=1024%2C768&ssl=1)

*Under the binocular to solder wires on DEC1 (CPU Power) and DEC4 (System Power).*

*Note: I re-soldered a 100nF capacitor at C5 location to have more “stability” of the CPU power during boot-up. This is not really necessary but it can help in case of unexpected CPU crashes.*

I connect the two wires to SMA connectors and I use a GND point as a common ground:

![](data:image/svg+xml...)![](https://i1.wp.com/limitedresults.com/wp-content/uploads/2020/06/zoom_setup-1.png?ssl=1)![](data:image/svg+xml...)![](https://i1.wp.com/limitedresults.com/wp-content/uploads/2020/06/PCB_setup_done-1.png?ssl=1)

A micro-USB cable is used to power the entire board. USB to Serial Cable is connected to display UART message from the application (115200, 8N1).

### Scope config

The oscilloscope is connected to the target:

* **CHANNEL1 (CH1) = TxD (pin P0.06)**
* **CHANNEL2 (CH2) = Power consumption of the chip through DEC1**
* **CHANNEL3 (CH3) = Pulse command for the glitch**
* **CHANNEL4 (CH4) = Power consumption of the chip through DEC4 (Scope Trigger)**

## **The results**

### Black-Box Reverse

The goal is to identify a particular pattern into the power consumption, which could validated my previous assumption.

For that purpose, the CPU power consumption (CH2) on DEC1 and System power Consumption (CH4) on DEC4 are both monitored.

First, the Flash Memory Activity is clearly distinguishable (at the trigger T mark) and corresponds to successive read operations from Flash:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/Power-Up_Flash.png?resize=1024%2C630&ssl=1)

*Scope Screenshot monitoring the nRF52840 Power-Up. CH1= UART, CH2 = CPU power, CH3 = glitch command (not activated) and CH4= System Power.*

On the next screenshot, the Arm CPU starts its execution (at 19us after the trigger mark). It is distinguishable on CH2 (CPU power consumption):

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/before_Flash.png?resize=1024%2C630&ssl=1)

*CPU starting its execution. CH1= UART, CH2 = CPU power, CH3 = glitch command (not activated) and CH4= System Power.*

Then, I decide to focus my analysis to find the NVMC activity, by comparing the two power signals DEC4 and DEC1:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/Identification-1.png?resize=1024%2C630&ssl=1)

*NVMC initialisation . CH1= UART, CH2 = CPU power, CH3 = glitch command (not activated) and CH4= System Power.*

I am quite confident this pattern (**red frame**) corresponds to the memory controller (NVMC) transferring the UICR values to the core (or to the AHB-AP block directly), to configure the Debug Ports (AHB-AP, CTRL-AP) and set the APPROTECT to finally disable the debug interface.

### **Bypass the APPROTECT on nRF52840**

A python script is in charge to arm the scope, set the different glitch parameters and reset the board.

A glitch campaign is started, producing very short pulse on the DEC1 power line to target specifically the previous identified pattern.

The next scope screenshot shows a successful glitch attempt:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/Glitch.png?resize=1024%2C630&ssl=1)

*NVMC initialisation . CH1= UART, CH2 = CPU power, CH3 = glitter command (not activated) and CH4= System Power.*

*Note how the power consumption of the System is modified after the glitch. This is the result you want to obtain.*

After each glitch attempt, the following OpenOcd command is then played by the script, in order to dump the entire Flash memory (this will happen only in case of successful connection to the AHB-AP Debug interface):

```
$ openocd -s /usr/local/share/openocd/scripts -f ./interface/jlink.cfg -c "transport select swd" -f ./target/nrf52.cfg -c "init;dump_image nrf52_dumped.bin 0x0 0x100000"
```

The AHB-AP Debug Port is successfully unlocked by the glitch effect. The external debugger can now connect to the nRF52840 CPU (cortex-M4F) to dump the Flash memory:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/openocd_OK.png?resize=843%2C410&ssl=1)

*Debugger connected to the target nRF52840 despite the APPROTECT activated.*

An Arm GDB session is then attached. Even if the APPROTECT value shows the nRF52840 is protected (0xFFFFFF00), it is now possible to debug the target, for example by reading the Firmware at 0x00000000:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/gdb.png?resize=750%2C287&ssl=1)

*GDB session connected to the target nRF52840 despite APPROTECT activated.*

### PoC: Full Debug Capabilities

You probably guess it’s also possible to fully control the device (because the debug interface is reactivated).

During my experiment, the CPU is stuck in endless loop at 0x61C4 after the glitch. So, the screen below shows how the Program Counter (PC) is set to execute the first instruction (at 0x2b4) then step-in into the code as Proof-of-Concept:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/PoC_debug.png?resize=586%2C440&ssl=1)

*Code execution on a protected nRF52840.*

R/W Access to Registers is below (SRAM and Flash R/W operations are available too, trust me):

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/PoC_reg.png?resize=483%2C704&ssl=1)

*Full Debug Capabilities, making future reverse easier 🙂*

This PoC proves control of Flow Execution and R/W access to memories and registers.

### **Access to the FICR**

Factory information configuration registers (FICR) are pre-programmed in factory and cannot be erased by the user. These registers contain chip-specific information (device id, keys, device address…) and are located at 0x10000000:

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/ficr.png?resize=836%2C572&ssl=1)

*Factory Info Configuration Registers dumped*

### Adding persistence to the Exploit

Finally, the goal is to reactivate permanently the full debug capabilities on the device under test. The scenario is the following:

* Dump the Flash memory at 0x00000000
* Dump the UICR at 0x10001000
* Erase the device*: nrfjprog -f NRF52 –recover*
* Reflash the nRF52 again to write the Flash memory content and the UICR (with a proper patch of the APPROTECT value set to 0xFFFFFFFF of course).

**After that, Debug over the SWD interface is enabled and the glitching attack is not necessary.**

Enjoy.

## **Come on LR…”hacking dev-kit is easy”**

Some people can say : *“Always easy to hack dev-kit…”*

OK, you’re right and I am agree 🙂

To demonstrate how easy it is to apply this exploit, the attack has been reproduced on a real product, [**my Logitech Pro G Mouse**](https://twitter.com/LimitedResults/status/1250489319250448388).

![](data:image/svg+xml...)![](https://i0.wp.com/limitedresults.com/wp-content/uploads/2020/06/mouse_on.png?resize=232%2C266&ssl=1)

RIP my little girl…

This will be the **[part 2 of this investigation](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass-part-2/)** of the nRF52 SoCs. I will demonstrate how **this vulnerability is currently impacting ALL the nRF52 SoCs, from nRF52810 to nRF52840.**

## **Conclusion**

The Access Port Protection APPROTECT is the most recent security feature designed by NordicSemiconductor to protect against Firmware Readout and Reverse-Engineering. This APPROTECT feature is therefore present into the entire nRF52 SoCs Family.

In this blogpost, a low-cost fault attack has been successfully achieved on nRF52840. **It allows an attacker having physical access to bypass the APPROTECT to reactivate the SWD debug interface permanently** (R/W access to memories and registers, control CPU code execution, dump the Flash memory, FICR and UICR…)

Due to its low-complexity, this attack on the nRF52840 can be reproduced on the field easily. I have no doubt any motivated proficient hacker could reproduce this attack in less than one day and with less than 500$ equipment.

**The vulnerability resides in Silicon. There is no way to patch without HW revision. This is impacting a tremendous number of products based on nRF52 platforms**.

[**Stay Tuned for Part 2**.](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass-part-2/)

## **Timeline Disclosure**

**17/04/2020**: Nordic PSIRT contacts LimitedResults.

**22/04/2020**: Nordic PSIRT proposes to purchase the full report for a rock-bottom price.

**22/04/2020**: LimitedResults says “No, sorry” (and stays polite).

**28/04/2020**: LimitedResults proposes to work with Nordic on a responsible disclosure based on CVE process.

**29/04/2020**: Nordic PSIRT is positive but does not provide any guarantees.

**29/04/2020**: LR asks for proper guarantees.

**08/06/2020:** After one month of silence and several follow-ups without any response from Nordic PSIRT, Nordic PSIRT declines to work with LimitedResults on a responsible disclosure.

**10/06/2020:** Posted.

[edited] **12/06/2020**: Nordic have emailed all their customers with the following information notice **[here](https://infocenter.nordicsemi.com/pdf/in_133_v1.0.pdf)**.

### Share this:

* [Click to share on Twitter (Opens in new window)](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/?share=twitter "Click to share on Twitter")
* [Click to share on Telegram (Opens in new window)](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/?share=telegram "Click to share on Telegram")
* [Click to share on LinkedIn (Opens in new window)](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/?share=linkedin "Click to share on LinkedIn")
* [Click to share on Reddit (Opens in new window)](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/?share=reddit "Click to share on Reddit")
* [Click to share on WhatsApp (Opens in new window)](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/?share=jetpack-whatsapp "Click to share on WhatsApp")
* [Click to share on Facebook (Opens in new window)](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/?share=facebook "Click to share on Facebook")

Categories[fault injection](https://limitedresults.com/category/fault-injection/), [reverse](https://limitedresults.com/category/reverse/), [SoCs](https://limitedresults.com/category/socs/), [zero-day](https://limitedresults.com/category/zero-day/)Tags[ARM](https://limitedresults.com/tag/arm/), [Cortex-M4](https://limitedresults.com/tag/cortex-m4/), [Exploit](https://limitedresults.com/tag/exploit/), [Hardware Hacking](https://limitedresults.com/tag/hardware-hacking/), [JTAG](https://limitedresults.com/tag/jtag/), [NordicSemiconductor](https://limitedresults.com/tag/nordicsemiconductor/), [nRF52](https://limitedresults.com/tag/nrf52/), [SWD](https://limitedresults.com/tag/swd/)
## Post navigation

[PreviousPrevious post: Nuvoton M2351 MKROM](https://limitedresults.com/2020/01/nuvoton-m2351-mkrom-armv8-m-trustzone/)[NextNext post: nRF52 Debug Resurrection (APPROTECT Bypass) Part 2](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass-part-2/)

### 29 Replies to “nRF52 Debug Resurrection (APPROTECT Bypass) Part 1”

1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/f70965ea0ec7f4b6891d03f264ac3c22?s=42&d=mm&r=g) **f** says:
   [June 11, 2020 at 5:40 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-886)

   small optimization – you don’t need to dump the flash and write it back, just dumping uicr is enough. once you have debug access you can clear just uicr area via nvmc eraseuicr register and unlock it permanently, no need to erase whole flash. then just restore uicr except aprotect

   [Reply](#comment-886)
   1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
      [June 11, 2020 at 7:09 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-888)

      Hi,

      interesting. I was thinking erase UICR leads to erase Flash App content. So in my mind, it was safer to dump the flash just in case.

      And at the end, dumping FW is my goal to be able to reverse it.

      Regards

      LR

      [Reply](#comment-888)
3. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/a17b27333b35351896bfa8a1a3c9a27c?s=42&d=mm&r=g) **[Hemal](http://black-electronics.com/blog)** says:
   [June 11, 2020 at 5:56 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-887)

   This is really interesting! Looking forward to the next article.

   [Reply](#comment-887)
5. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/fc60a40f6f0f0e4638b81c9a58949bcc?s=42&d=mm&r=g) **[Nanch](https://nanch.com)** says:
   [June 11, 2020 at 7:21 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-889)

   Fantastic work and write up. Also looking forward to the next post.

   [Reply](#comment-889)
7. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/9504e0f1db6f1a0c1d48fbc77aa0090f?s=42&d=mm&r=g) **Emil** says:
   [June 11, 2020 at 12:25 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-894)

   Interesting, but I think you should’t have posted this due to the big number of devices affected, that can never be patched. Better just tell Nordic so they can fix the issue in following hw revisions.

   Normally security disclosures are accepted after around 90 days after notifying the manufacturer, when there are software exploits that can be patched, so that the manufacturer has time to send out a patch to customers.

   [Reply](#comment-894)
   1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/f1a41f00eac91827a1f46959ec99bc12?s=42&d=mm&r=g) **Kit** says:
      [June 11, 2020 at 1:18 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-896)

      @Emil – that doesn’t make any sense whatsoever. Since we’re talking about consumer-grade products being affected here, Nordic has, at a minimum, some ethical responsibility for broad-distribution of a security notification to industry.

      Leaving these kinds of vulnerabilities to the security ecosystem (which is non-formalized at best) doesn’t solve the problem. Of course LR, here, has the risk of retribution. But, it is their responsibility to do right by all consumers – not Nordic, or any of their direct customers who have integrated their gear. Not a lawyer, but AFIAK there is nothing anywhere that dictates attribution procedure – doubly so when formal contact WAS made.

      [Reply](#comment-896)
9. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/fb9ac380c274ce0f5c717e7834affe2d?s=42&d=mm&r=g) **Nicholas Lee** says:
   [June 12, 2020 at 2:21 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-902)

   FYI: Nordic have today emailed all their customers with the following disclosure:

   Product Update Notification June 12 2020

   Hi,

   An Informational Notice has been issued related to a fault injection technique that disables access port protection on the nRF52 Series devices.

   The following devices are affected:

   • nRF52 Series devices

   For more information, see the full IN-133:

   <https://infocenter.nordicsemi.com/pdf/in_133_v1.0.pdf>

   Thanks and best regards;

   The Nordic team

   [Reply](#comment-902)
   1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
      [June 12, 2020 at 2:44 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-903)

      Hi,

      Timeline disclosure will be edited.

      Thanks for sharing

      LR

      [Reply](#comment-903)
   3. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/06d9c18e361228f927e7c7b4d07b9366?s=42&d=mm&r=g) **backahasten** says:
      [June 16, 2020 at 8:09 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-915)

      I read the file and it looks like they won’t fix the problem.

      To be honest, the defense of fault injection requires the deployment of analog sensors on the die, and the adjustment of chip technology will affect the yield.

      [Reply](#comment-915)
11. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/722f8243b80acba5541562f93c3b729e?s=42&d=mm&r=g) **long** says:
    [June 14, 2020 at 1:52 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-907)

    HI, It’s very impressive. Could you give more about the detail of your ” low-cost voltage gliching” ? How do you know the exact time to start the glitch ?

    [Reply](#comment-907)
13. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/14fb77c4c570bead96a13a22a2896bdb?s=42&d=mm&r=g) **Christopher** says:
    [June 22, 2020 at 2:13 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-946)

    So you mention that after glitching the CPU was stuck in an endless loop at 0x61C4, was this always the address it was stuck at, or did the ‘stuck’ address change based upon glitch timing offset? Because if this is always the same address then there would be ways to mitigate this.

    [Reply](#comment-946)
    1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
       [June 22, 2020 at 2:19 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-947)

       hi,

       take a look to others GDB screenshots in part 2 and you will have your answer.

       No way to fix except a new Silicon revision. that’s life.

       LR

       [Reply](#comment-947)
15. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/15393533a2ae84b59eeeb8bd7beeed9d?s=42&d=mm&r=g) **Watsug** says:
    [July 10, 2020 at 8:37 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-1033)

    Could you please share more info about this “low-cost voltage glitching system”? Thanks in advance :)!

    [Reply](#comment-1033)
17. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/96b7b266b60090744be9c05eb0ff10d6?s=42&d=mm&r=g) **brett.io** says:
    [September 23, 2020 at 7:06 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-1260)

    Can you publish any more information on your homemade fault injection system?

    [Reply](#comment-1260)
19. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/f087ef7ff3027052b4bbb78ba5ce9104?s=42&d=mm&r=g) **Long** says:
    [January 28, 2021 at 6:49 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-2145)

    How was the reset board performed? You mentioned about the Power-on Reset, would a Pin Reset allow for the same effect?

    [Reply](#comment-2145)
21. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/35bd9acc9a2efea982d335e9413aa083?s=42&d=mm&r=g) **Fritz Furz** says:
    [April 15, 2021 at 7:32 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-2688)

    Yeah, great job. Just one question, why do you ignore all the requests for elaborating on the “Glitcher”-Device? Either this is sharing knowledge or it is bragging and then keeping the important parts secret.

    There was a time when hackers believed in free information for everyone. Sadly that time has passed.

    [Reply](#comment-2688)
    1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
       [April 16, 2021 at 5:54 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-2692)

       Hello, I understand your point of view.

       If you want to reproduce this debug resurrection easily, check this:

       <https://limitedresults.com/2021/03/the-pocketglitcher/>

       [Reply](#comment-2692)
23. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6569a486fc966e7616dd554864d3e48d?s=42&d=mm&r=g) **Ed** says:
    [May 10, 2021 at 12:19 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-2818)

    Assuming that glitching causes the disabling settings to be missed by the chip, then a solution for Nordic is to disable the debug port by default on power-up and then only enable it when it has received the correct setting from the UICR registers. That way glitching won’t cause the debug port to be enabled as it is disabled by default.

    [Reply](#comment-2818)
25. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/27607773023395d46fd5e7049a4b7f74?s=42&d=mm&r=g) **item99** says:
    [May 14, 2021 at 5:40 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-2880)

    “I am quite confident this pattern (red frame) corresponds to the memory controller (NVMC) transferring the UICR values to the core”

    Could you please explain why this is? Very curious how to find such a position in glitch, thank you!

    [Reply](#comment-2880)
    1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
       [May 15, 2021 at 6:00 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-2890)

       Analysis, methodology and experience (I do that since long time…)

       Take care, regards

       [Reply](#comment-2890)
27. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/c70bebde72d64eb2de1562a8d702777a?s=42&d=mm&r=g) **radiotommy** says:
    [August 25, 2021 at 11:33 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-4520)

    Fantastic analysis. Seems like the only way to protect is permanently burn off the debug connection on silicon.

    [Reply](#comment-4520)
29. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/907c52df4f36a570fe6a1cd73cb37574?s=42&d=mm&r=g) **Mahmut** says:
    [October 15, 2021 at 6:30 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-5571)

    28/04/2020: LimitedResults proposes to work with Nordic on a responsible disclosure based on CVE process.

    29/04/2020: Nordic PSIRT is positive but does not provide any guarantees.

    29/04/2020: LR asks for proper guarantees.

    What is going on this part ? What isnthe guarantee and what is the importance of cve process over aceppting money ?

    Is this part is not a secret can you explain what is going on ?

    [Reply](#comment-5571)
31. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/ac532e5e748930696b09432383a16cf9?s=42&d=mm&r=g) **Thomas** says:
    [January 12, 2022 at 4:07 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-7690)

    There is a new hardware revision of the nRF52832 (rev. G) that changes how the APPROTECT feature works. See Product Specification 1.8 section 16.2. Is this a hardware fix for the exploit explained on this page?

    Something similar applies to the nRF52840.

    [Reply](#comment-7690)
    1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
       [January 12, 2022 at 4:18 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-7692)

       That’s life 😉

       [Reply](#comment-7692)
       1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/ac532e5e748930696b09432383a16cf9?s=42&d=mm&r=g) **Thomas** says:
          [January 12, 2022 at 4:19 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-7693)

          So… yes?

          [Reply](#comment-7693)
          1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/6c5244c135cfa4f43c388eb10c8662a7?s=42&d=mm&r=g) **LimitedResults** says:
             [January 13, 2022 at 8:48 am](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-7701)

             Yes, nordic spent 1.5 year to patch that. They released last November

             [Reply](#comment-7701)
             1. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/1c9aa5ba399537b8c2f921bda1e9e7e7?s=42&d=mm&r=g) **[crack\_glitch](http://52pojie.cn)** says:
                [September 25, 2023 at 2:01 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-17587)

                I would like to ask, is this method still applicable to the new version after repair?
33. ![](data:image/svg+xml...)![](https://secure.gravatar.com/avatar/19bf424960a750bec0c5e8da802bb8e0?s=42&d=mm&r=g) **pege** says:
    [September 14, 2023 at 8:31 pm](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-17500)

    Great overview on the fault injection for nRF52840!!

    Q: What chip version was used for your research?

    I did a similar fault injection exercise on the STM32F4x, but that required in addition fault injection on the serial FW-boot loader. And as I’m now planning to switch to nRF52840, I get a lot of Déjà vu!

    cheers

    \PeGe

    [Reply](#comment-17500)

### Leave a Reply [Cancel reply](/2020/06/nrf52-debug-resurrection-approtect-bypass/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

Δ

Search for:

Search

#### Recent Posts

* [NoHat 21](https://limitedresults.com/2021/11/nohat-21/)
* [Enter the EFM32 Gecko](https://limitedresults.com/2021/06/enter-the-efm32-gecko/)
* [The PocketGlitcher](https://limitedresults.com/2021/03/the-pocketglitcher/)
* [Black Hat Europe 2020](https://limitedresults.com/2020/12/black-hat-europe-2020/)
* [nRF52 Debug Resurrection (APPROTECT Bypass) Part 2](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass-part-2/)
#### Categories

* [embedded](https://limitedresults.com/category/embedded/)
* [fault injection](https://limitedresults.com/category/fault-injection/)
* [iot](https://limitedresults.com/category/iot/)
* [MCU](https://limitedresults.com/category/mcu/)
* [Results](https://limitedresults.com/category/results/)
* [reverse](https://limitedresults.com/category/reverse/)
* [SoCs](https://limitedresults.com/category/socs/)
* [talk](https://limitedresults.com/category/talk/)
* [Tools](https://limitedresults.com/category/tools/)
* [Uncategorized](https://limitedresults.com/category/uncategorized/)
* [unpatchable](https://limitedresults.com/category/unpatchable/)
* [zero-day](https://limitedresults.com/category/zero-day/)
#### Recent Comments

* Chapoly on [Pwn the WIZ connected](https://limitedresults.com/2019/02/pwn-the-wiz-connected/#comment-18867)
* [crack\_glitch](http://52pojie.cn) on [nRF52 Debug Resurrection (APPROTECT Bypass) Part 1](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-17587)
* NonaSuomy on [Pwn the ESP32 Forever: Flash Encryption and Sec. Boot Keys Extraction](https://limitedresults.com/2019/11/pwn-the-esp32-forever-flash-encryption-and-sec-boot-keys-extraction/#comment-17565)
* pege on [nRF52 Debug Resurrection (APPROTECT Bypass) Part 1](https://limitedresults.com/2020/06/nrf52-debug-resurrection-approtect-bypass/#comment-17500)
* [David H Mills](http://none) on [Pwn the ESP32 Forever: Flash Encryption and Sec. Boot Keys Extraction](https://limitedresults.com/2019/11/pwn-the-esp32-forever-flash-encryption-and-sec-boot-keys-extraction/#comment-17445)
#### Popular Tags

[ARM](https://limitedresults.com/tag/arm/)
[automation](https://limitedresults.com/tag/automation/)
[blackhat](https://limitedresults.com/tag/blackhat/)
[bsides](https://limitedresults.com/tag/bsides/)
[Cortex-M4](https://limitedresults.com/tag/cortex-m4/)
[Cortex-M23](https://limitedresults.com/tag/cortex-m23/)
[Crypto](https://limitedresults.com/tag/crypto/)
[CVE-2019-15894](https://limitedresults.com/tag/cve-2019-15894/)
[CVE-2019-17391](https://limitedresults.com/tag/cve-2019-17391/)
[debug resurrection](https://limitedresults.com/tag/debug-resurrection/)
[efm32](https://limitedresults.com/tag/efm32/)
[EMFI](https://limitedresults.com/tag/emfi/)
[ESP32](https://limitedresults.com/tag/esp32/)
[esp8266](https://limitedresults.com/tag/esp8266/)
[Exploit](https://limitedresults.com/tag/exploit/)
[fault attack](https://limitedresults.com/tag/fault-attack/)
[Fault injection](https://limitedresults.com/tag/fault-injection/)
[Forever Pwn](https://limitedresults.com/tag/forever-pwn/)
[Full disclosure](https://limitedresults.com/tag/full-disclosure/)
[Glitch](https://limitedresults.com/tag/glitch/)
[Hacking](https://limitedresults.com/tag/hacking/)
[Hardware](https://limitedresults.com/tag/hardware/)
[Hardware Hacking](https://limitedresults.com/tag/hardware-hacking/)
[iot](https://limitedresults.com/tag/iot/)
[JTAG](https://limitedresults.com/tag/jtag/)
[Lifx](https://limitedresults.com/tag/lifx/)
[lightbulbs](https://limitedresults.com/tag/lightbulbs/)
[lyasi](https://limitedresults.com/tag/lyasi/)
[MCU](https://limitedresults.com/tag/mcu/)
[modding](https://limitedresults.com/tag/modding/)
[NordicSemiconductor](https://limitedresults.com/tag/nordicsemiconductor/)
[nRF52](https://limitedresults.com/tag/nrf52/)
[PCB](https://limitedresults.com/tag/pcb/)
[Pocketbeagle](https://limitedresults.com/tag/pocketbeagle/)
[PocketGlitcher](https://limitedresults.com/tag/pocketglitcher/)
[Pwn](https://limitedresults.com/tag/pwn/)
[Reverse](https://limitedresults.com/tag/reverse/)
[SWD](https://limitedresults.com/tag/swd/)
[talk](https://limitedresults.com/tag/talk/)
[tuya](https://limitedresults.com/tag/tuya/)
[WI-FI](https://limitedresults.com/tag/wi-fi/)
[WIZ connected](https://limitedresults.com/tag/wiz-connected/)
[XIaomi](https://limitedresults.com/tag/xiaomi/)
[Yeelight](https://limitedresults.com/tag/yeelight/)
[Zero-day](https://limitedresults.com/tag/zero-day/)

[Proudly powered by WordPress](https://wordpress.org/)

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###



=== Content from eprint.iacr.org_48fafd58_20250119_113307.html ===

# What a lovely hat

#### Is it made out of [tin foil](https://iacr.org/tinfoil.html)?

[![IACR Logo](/img/iacrlogo_small.png)](https://iacr.org/)

[Cryptology ePrint Archive](/)

* Papers
  Updates from the last:+ [7 days](/days/7)
  + [31 days](/days/31)
  + [6 months](/days/183)
  + [365 days](/days/365)
  + ---
  + [Listing by year](/byyear)
  + [All papers](/complete)
  + [Compact view](/complete/compact)
  + [Subscribe](https://www.iacr.org/news/subscribe)
  + ---
  + [How to cite](/citation.html)
  + ---
  + [Harvesting metadata](/rss)
* Submissions
  + [Submit a paper](/submit)
  + [Revise or withdraw a paper](/revise)
  + [Acceptance and publishing conditions](/operations.html)
* About
  + [Goals and history](/about.html)
  + [News](/news.html)
  + [Statistics](/stats)
  + [Contact](/contact.html)

![Search Button](/img/search.svg)

Search

[Advanced search](/search)

#### Paper 2021/640

### Security and Trust in Open Source Security Tokens

Marc Schink, Alexander Wagner, Florian Unterstein, and Johann Heyszl

##### Abstract

Using passwords for authentication has been proven vulnerable in countless security incidents. Hardware authentication tokens effectively prevent most password-related security issues and improve security indisputably. However, we would like to highlight that there are new threats from attackers with physical access which need to be discussed. Supply chain adversaries may manipulate devices on a large scale and install backdoors before they even reach end users. In evil maid scenarios, specific devices may even be attacked while already in use. Hence, we thoroughly investigate the security and trustworthiness of eight commercially available open source authentication tokens, including devices from the two market leaders: SoloKeys and Nitrokey. Unfortunately, we identify and practically verify significant vulnerabilities in all eight examined tokens. Some of them based on severe, previously undiscovered, vulnerabilities of three major microcontroller products which are used at a large scale in various products. Our findings clearly emphasize the significant threat from supply chain and evil maid scenarios since the attacks are practical and only require moderate attacker efforts. Fortunately, we are able to describe software-based countermeasures as effective improvements to retrofit the examined devices. To improve the security and trustworthiness of future authentication tokens, we also derive important general design recommendations.

##### Metadata

Available format(s)

[![](/img/file-pdf.svg)PDF](/2021/640.pdf)

Category
[Applications](/search?category=APPLICATIONS)
Publication info
A minor revision of an IACR publication in TCHES 2021
Keywords
[security token](/search?q=security%20token)[second factor authentication](/search?q=second%20factor%20authentication)[FIDO](/search?q=FIDO)[fault injection attack](/search?q=fault%20injection%20attack)[side-channel attack](/search?q=side-channel%20attack)[firmware protection](/search?q=firmware%20protection)
Contact author(s)
marc schink @ aisec fraunhofer de

History
2021-05-17: received
Short URL
<https://ia.cr/2021/640>
License
[![Creative Commons Attribution](/img/license/CC_BY.svg "Creative Commons Attribution")

CC BY](https://creativecommons.org/licenses/by/4.0/)

**BibTeX**
![](/img/copy-outline.svg)Copy to clipboard

```

@misc{cryptoeprint:2021/640,
      author = {Marc Schink and Alexander Wagner and Florian Unterstein and Johann Heyszl},
      title = {Security and Trust in Open Source Security Tokens},
      howpublished = {Cryptology {ePrint} Archive, Paper 2021/640},
      year = {2021},
      url = {https://eprint.iacr.org/2021/640}
}

```

[![IACR Logo](/img/iacrlogo_small.png)](https://iacr.org/)

Note: In order to protect the privacy of readers, eprint.iacr.org
does not use cookies or embedded third party content.


