=== Content from launchpad.net_2d9d727f_20250119_132135.html ===

[Log in / Register](https://launchpad.net/~juliank/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~juliank)

## [Julian Andres Klode](https://launchpad.net/~juliank)

* Overview
* [Code](https://code.launchpad.net/~juliank)
* [Bugs](https://bugs.launchpad.net/~juliank)
* [Blueprints](https://blueprints.launchpad.net/~juliank)
* [Translations](https://translations.launchpad.net/~juliank)
* [Answers](https://answers.launchpad.net/~juliank)

\* Debian Developer (<http://qa.debian.org/developer.php?login=jak>)

\* Ubuntu Core Developer

\* Contributing Member of Software in the Public Interest (SPI - <http://www.spi-inc.org/>)

\* /u/-jak- on reddit

Website: <https://jak-linux.org/>

Blog: <https://blog.jak-linux.org/>

* [Related packages](https://launchpad.net/~juliank/%2Brelated-packages)
* [Related projects](https://launchpad.net/~juliank/%2Brelated-projects)

## User information

Launchpad Id:
juliank

Email:
[Log in](%2Blogin) for email information.

Member since:
2005-12-29

[![Icon of Bluetooth](https://launchpadlibrarian.net/4683649/stock_bluetooth.png "Member of Bluetooth")](/~bluetooth)
[![Icon of Edubuntu Developers](https://launchpadlibrarian.net/71879383/edubuntu-logo-only_14.png "Member of Edubuntu Developers")](/~edubuntu-dev)
[![Icon of GNOME3 Team](https://launchpadlibrarian.net/235731434/roundel14.png "Member of GNOME3 Team")](/~gnome3-team)
[![Icon of Indicator Applet Developers](https://launchpadlibrarian.net/22816053/add-notification-applet.14.png "Member of Indicator Applet Developers")](/~indicator-applet-developers)
[![Icon of Kubuntu Ninjas - Yellow belts](https://launchpadlibrarian.net/192173133/belt2-yellow3.png "Member of Kubuntu Ninjas - Yellow belts")](/~kubuntu-ninjas-yellow-belts)
[![Icon of Kubuntu Ninjas](https://launchpadlibrarian.net/31496145/icon.png "Member of Kubuntu Ninjas")](/~kubuntu-ninjas)
[![Icon of Kubuntu Package Archives](https://launchpadlibrarian.net/44411915/deb-small.png "Member of Kubuntu Package Archives")](/~kubuntu-ppa)
[![Icon of Launchpad Beta Testers](https://launchpadlibrarian.net/600856498/Canonical_Launchpad_icon_14px.png "Member of Launchpad Beta Testers")](/~launchpad-beta-testers)
[![Icon of Lubuntu Code](https://launchpadlibrarian.net/704307155/lennyborg_14.png "Member of Lubuntu Code")](/~lubuntu-code)
[![Icon of Lubuntu Continuous Integration](https://launchpadlibrarian.net/704307325/lennyborg_14.png "Member of Lubuntu Continuous Integration")](/~lubuntu-ci)
[![Icon of Lubuntu Developers](https://launchpadlibrarian.net/704306355/lennyborg_14.png "Member of Lubuntu Developers")](/~lubuntu-dev)
[![Icon of Lubuntu Packages Team](https://launchpadlibrarian.net/704305879/lenny_bug_14.png "Member of Lubuntu Packages Team")](/~lubuntu-packaging)
[![Icon of Lubuntu](https://launchpadlibrarian.net/357050187/14.png "Member of Lubuntu")](/~lubuntu-desktop)
[![Icon of MOTU](https://launchpadlibrarian.net/1516491/motu-image-2.png "Member of MOTU")](/~motu)
[![Icon of Network-manager](https://launchpadlibrarian.net/11610188/nm-team.png "Member of Network-manager")](/~network-manager)
[![Icon of OEM Archive Admins](https://launchpadlibrarian.net/31251458/oem-admin-logo_14x14.png "Member of OEM Archive Admins")](/~oem-archive)
[![Icon of Super Friends](https://launchpadlibrarian.net/134634591/superman14.png "Member of Super Friends")](/~super-friends)
[![Icon of Ubuntu Bug Control](https://launchpadlibrarian.net/4423778/qa-icon.png "Member of Ubuntu Bug Control")](/~ubuntu-bugcontrol)
[![Icon of Ubuntu Contributing Developers](https://launchpadlibrarian.net/17290192/wrench_emblem-trans.png "Member of Ubuntu Contributing Developers")](/~ubuntu-developer-members)
[![Icon of Ubuntu Core Development Team](https://launchpadlibrarian.net/1072365/main.png "Member of Ubuntu Core Development Team")](/~ubuntu-core-dev)
[![Icon of Ubuntu Development Team](https://launchpadlibrarian.net/1072363/motu.png "Member of Ubuntu Development Team")](/~ubuntu-dev)
[![Icon of Ubuntu Documentation Project Team](https://launchpadlibrarian.net/162165522/ubuntu-doc.png "Member of Ubuntu Documentation Project Team")](/~ubuntu-doc)
[![Icon of Ubuntu Foundations Team](https://launchpadlibrarian.net/27376187/foundations_icon.gif "Member of Ubuntu Foundations Team")](/~ubuntu-foundations-team)
[![Icon of Ubuntu GNOME Developers](https://launchpadlibrarian.net/254356645/roundel14.png "Member of Ubuntu GNOME Developers")](/~ubuntu-gnome-dev)
[![Icon of Ubuntu GNOME](https://launchpadlibrarian.net/258611022/ubuntu-gnome_14.png "Member of Ubuntu GNOME")](/~ubuntu-gnome)
[![Icon of Ubuntu Kylin Members](https://launchpadlibrarian.net/444398797/623185830.jpg "Member of Ubuntu Kylin Members")](/~ubuntukylin-members)
[![Icon of Ubuntu MATE Developers](https://launchpadlibrarian.net/212349832/icon.png "Member of Ubuntu MATE Developers")](/~ubuntu-mate-dev)
[![Icon of Ubuntu Members](https://launchpadlibrarian.net/606495581/CoF%2014px.png "Member of Ubuntu Members")](/~ubuntumembers)
[![Icon of Ubuntu Sponsors](https://launchpadlibrarian.net/40794090/minitools.png "Member of Ubuntu Sponsors")](/~ubuntu-sponsors)
[![Icon of Ubuntu Studio Development](https://launchpadlibrarian.net/479050820/14.png "Member of Ubuntu Studio Development")](/~ubuntustudio-dev)
[![Icon of Xubuntu Artwork](https://launchpadlibrarian.net/341831649/icon_optimized_14.png "Member of Xubuntu Artwork")](/~xubuntu-art)
[![Icon of Xubuntu Developers](https://launchpadlibrarian.net/139019912/x-dev.png "Member of Xubuntu Developers")](/~xubuntu-dev)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English, German

OpenPGP keys:

AEE1C8AAAAF0B7684019C546021B361B6B031B00

SSH keys:

[cardno:000606447305](%2Bsshkeys)

Time zone:

Europe/Berlin
(UTC+0100)

Karma:
[82979](https://launchpad.net/~juliank/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**juliank**
 on
**irc.libera.chat**

![IRC](/@@/social-irc "IRC")
**jak**
 on
**irc.libera.chat**

![IRC](/@@/social-irc "IRC")
**juliank**
 on
**irc.oftc.net**

![Jabber](/@@/social-jabber "Jabber")
<email address hidden>

## [All bugs in progress](https://launchpad.net/~juliank/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1250109 [Please use dpkg-triggers for update-grub when installing or removing kernel packages](https://bugs.launchpad.net/ubuntu/%2Bsource/grub2/%2Bbug/1250109) |  |
| --- | --- | --- |
| in [Ubuntu](/ubuntu), [Debian](/debian) | | |

| --- | --- | --- | --- | --- | --- |
||  | #1929860 [initrdfail can result in resuming with different initrd images and hanging resume](https://bugs.launchpad.net/ubuntu/bionic/%2Bsource/grub2/%2Bbug/1929860) |  |
| --- | --- | --- |
| in [Ubuntu](/ubuntu) | | |

||  | #1940097 [A forgotten "space"](https://bugs.launchpad.net/ubuntu/%2Bsource/python-apt/%2Bbug/1940097) |  |
| --- | --- | --- |
| in [Ubuntu](/ubuntu) | | |

||  | #1833415 [Version.sha256 throws SystemError](https://bugs.launchpad.net/ubuntu/%2Bsource/python-apt/%2Bbug/1833415) |  |
| --- | --- | --- |
| in [Ubuntu](/ubuntu) | | |

||  | #1578007 [python-apt in yakkety no longer creates partial](https://bugs.launchpad.net/ubuntu/%2Bsource/python-apt/%2Bbug/1578007) |  |
| --- | --- | --- |
| in [Ubuntu](/ubuntu), [Snapcraft](/snapcraft) | | |

## Personal package archives

| [apt esm playground](/~juliank/%2Barchive/ubuntu/apt-esm) |
| --- |
| [PPA named apt-solver3 for Julian Andres Klode](/~juliank/%2Barchive/ubuntu/apt-solver3) |
| [aptdaemon PPA](/~juliank/%2Barchive/ubuntu/aptdaemon) |
| [cc merges](/~juliank/%2Barchive/ubuntu/cc-merges) |
| [dino updates](/~juliank/%2Barchive/ubuntu/dino-im) |
| [Move essential to /usr](/~juliank/%2Barchive/ubuntu/essential-usrmove) |
| [foobar](/~juliank/%2Barchive/ubuntu/foobar) |
| [gnu-efi-arm64](/~juliank/%2Barchive/ubuntu/gnu-efi-arm64) |
| [gnu-efi-arm64-proposed](/~juliank/%2Barchive/ubuntu/gnu-efi-arm64-proposed) |
| [Staging PPA for gnu-efi](/~juliank/%2Barchive/ubuntu/gnu-efi-staging) |
| [PPA named jak-meta for Julian Andres Klode](/~juliank/%2Barchive/ubuntu/jak-meta) |
| [kopanocore](/~juliank/%2Barchive/ubuntu/kopanocore) |
| [libinput updates](/~juliank/%2Barchive/ubuntu/libinput-updates) |
| [livecd-rootfs](/~juliank/%2Barchive/ubuntu/livecd-rootfs) |
| [meow](/~juliank/%2Barchive/ubuntu/meow014923) |
| [multipath-tools builds](/~juliank/%2Barchive/ubuntu/multipath-tools-074) |
| [netatalk3 binaries](/~juliank/%2Barchive/ubuntu/netatalk3) |
| [Pidgin uploads](/~juliank/%2Barchive/ubuntu/pidgin) |
| [newer pipewire builds](/~juliank/%2Barchive/ubuntu/pipewire) |
| [Podman stuff](/~juliank/%2Barchive/ubuntu/podman) |
| [PPA for Julian Andres Klode](/~juliank/%2Barchive/ubuntu/ppa) |
| [rails-cycle-break](/~juliank/%2Barchive/ubuntu/rails-cycle-break) |
| [redis security](/~juliank/%2Barchive/ubuntu/redis-security) |
| [Magic](/~juliank/%2Barchive/ubuntu/security) |
| [signing test](/~juliank/%2Barchive/ubuntu/test-signing) |
| [Unistring Transition](/~juliank/%2Barchive/ubuntu/unistring2) |
| [util-linux throwaway PPA](/~juliank/%2Barchive/ubuntu/util-linux) |
| [vim](/~juliank/%2Barchive/ubuntu/vim) |
| [yet another test ppa](/~juliank/%2Barchive/ubuntu/yatppa) |

* [View source package recipes](https://code.launchpad.net/~juliank/%2Brecipes)

## [All memberships](https://launchpad.net/~juliank/%2Bparticipation) Latest memberships

| [Aptdaemon Developers](/~aptdaemon-developers)  Joined on 2024-11-27 | |
| --- | --- |
| [Germinate hackers](/~germinate-hackers)  Joined on 2023-11-15 | |
| [ucdev](/~ucdev)  Joined on 2023-02-08 | |
| [Development of Ubuntu software for UEFI platforms](/~ubuntu-uefi-team)  Joined on 2023-01-11 | |

## [Recent activities](https://launchpad.net/~juliank/%2Bkarma) Most active in

| [Ubuntu](/ubuntu) |  |  |  |  |
| --- | --- | --- | --- | --- |
| [Release Upgrader](/ubuntu-release-upgrader) |  |  |  |  |
| [Ubuntu Seeds](/ubuntu-seeds) |  |  |  |  |
| [Software Properties](/software-properties) |  |  |  |  |
| [Germinate](/germinate) |  |  |  |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from lists.ubuntu.com_be8ed54b_20250119_132138.html ===


| **ubuntu-hardened -- Ubuntu security discussion** | |
| --- | --- |
|  | |
| **About ubuntu-hardened** | English (USA)   Chinese (Taiwan) |
| Discussion on Ubuntu security updates, development of new security technologies, and general "hardening" of the operating system.  A place to talk about MAC systems (SELinux, AppArmor, Smack) in Ubuntu, about both kernel-level and user-land security improvements and technologies, etc.  To see the collection of prior postings to the list, visit the [ubuntu-hardened Archives](https://lists.ubuntu.com/archives/ubuntu-hardened). | |
| **Using ubuntu-hardened** | |
| To post a message to all the list members, send email to ubuntu-hardened@lists.ubuntu.com. You can subscribe to the list, or change your existing subscription, in the sections below. | |
| **Subscribing to ubuntu-hardened** | |
| Subscribe to ubuntu-hardened by filling out the following form. You will be sent email requesting confirmation, to prevent others from gratuitously subscribing you. This is a hidden list, which means that the list of members is available only to the list administrator.    | Your email address: |  |  | | --- | --- | --- | | Your name (optional): |  |  | | You may enter a privacy password below. This provides only mild security, but should prevent others from messing with your subscription. **Do not use a valuable password** as it will occasionally be emailed back to you in cleartext. If you choose not to enter a password, one will be automatically generated for you, and it will be sent to you once you've confirmed your subscription. You can always request a mail-back of your password when you edit your personal options. | | | | Pick a password: |  |  | | Reenter password to confirm: |  |  | | Which language do you prefer to display your messages? | English (USA)   Chinese (Taiwan) |  | | Would you like to receive list mail batched in a daily digest? | No  Yes | |  | | | | |

| **ubuntu-hardened Subscribers** | |
| (*The subscribers list is only available to the list administrator.*) Enter your admin address and password to visit the subscribers list: Admin address: Password:  To unsubscribe from ubuntu-hardened, get a password reminder, or change your subscription options enter your subscription email address: If you leave the field blank, you will be prompted for your email address | |

---

[ubuntu-hardened](../listinfo/ubuntu-hardened) list run by jamie at ubuntu.com, mdeslaur at ubuntu.com, sbeattie at ubuntu.com, alex.murray at canonical.com
[ubuntu-hardened administrative interface](../admin/ubuntu-hardened) (requires authorization)
[Overview of all lists.ubuntu.com mailing lists](../listinfo)

| [Delivered by Mailmanversion 2.1.20](http://www.gnu.org/software/mailman/index.html) | [Python Powered](http://www.python.org/) | [GNU's Not Unix](http://www.gnu.org/) | [Debian Powered](http://www.debian.org/) |
| --- | --- | --- | --- |

[![](http://tuxedo-es.org/images/hardened_debian.png)](http://www.debian-hardened.org)



=== Content from bugs.launchpad.net_1151b200_20250119_132136.html ===
From 5d6e1ca82a07ef1739dfea20ad17f077ceccfdcf Mon Sep 17 00:00:00 2001
From: Julian Andres Klode
Date: Tue, 1 Dec 2020 12:25:00 +0100
Subject: [PATCH] Check PolicyKit before simulating local install
(CVE-2020-27349)
Given that we are opening a deb here as root that is controlled
by a non-root user, without any authorization, this is a whole
lot of safety issues.
Bug-Ubuntu: https://bugs.launchpad.net/bugs/1899193/
---
aptdaemon/core.py | 2 ++
1 file changed, 2 insertions(+)
diff --git a/aptdaemon/core.py b/aptdaemon/core.py
index 885b30b..6043b17 100644
--- a/aptdaemon/core.py
+++ b/aptdaemon/core.py
@@ -1073,6 +1073,8 @@ class Transaction(DBusObject):
def \_simulate\_real(self):
if self.\_simulated\_cb:
raise errors.TransactionAlreadySimulating()
+ if self.role == enums.ROLE\_INSTALL\_FILE:
+ yield self.\_check\_auth()
self.queue.worker.simulate(self)
deferred = Deferred()
if self.\_idle\_watch is not None:
--
2.29.2


=== Content from bugs.launchpad.net_d159726f_20250119_113004.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[apt package](https://launchpad.net/ubuntu/%2Bsource/apt)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/apt)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/apt)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/apt)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/apt)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/apt)

# local denial of service due to parsing bugs in arfile.cc

Bug #1899193 reported by
[kev](https://launchpad.net/~kbackhouse2000)
on 2020-10-09

[262](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [apt (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/apt "Latest release: 2.9.23, uploaded to main on 2025-01-18 04:27:30.122383+00:00 by APT Development Team (deity), maintained by APT Development Team (deity)") | Fix Released | Undecided | Unassigned |  |
|  | [aptdaemon (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/aptdaemon "Latest release: 2.0.1, uploaded to main on 2024-12-12 08:21:11.486744+00:00 by Julian Andres Klode (juliank), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | Undecided | Unassigned |  |
|  | [python-apt (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/python-apt "Latest release: 2.9.6build1, uploaded to main on 2024-12-29 21:31:12.372272+00:00 by Julian Andres Klode (juliank), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | Undecided | Unassigned |  |

### Bug Description

# GitHub Security Lab (GHSL) Vulnerability Report: `GHSL-2020-168`, `GHSL-2020-169`, `GHSL-2020-170`

The [GitHub Security Lab](<https://securitylab.github.com>) team has identified potential security vulnerabilities in aptd.

We are committed to working with you to help resolve these issues. In this report you will find everything you need to effectively coordinate a resolution of these issues with the GHSL team.

If at any point you have concerns or questions about this process, please do not hesitate to reach out to us at `<email address hidden>` (please include `GHSL-2020-168`, `GHSL-2020-169`, or `GHSL-2020-170` as a reference).

If you are \_NOT\_ the correct point of contact for this report, please let us know!

## Summary

The aptd daemon is a system service for installing and updating packages. It is accessible via [dbus](<https://www.freedesktop.org/wiki/Software/dbus/>) and has a method named "InstallFile" which is used for installing local `.deb` packages. Although polkit is used to prevent an unprivileged user from using "InstallFile" to install a malicious `.deb` package, it does not prevent aptd from parsing the contents of the `.deb` file. The parsing logic is provided by two packages, [libapt-pkg-dev](<https://packages.ubuntu.com/focal/libapt-pkg-dev>) and [python-apt](<https://packages.ubuntu.com/source/focal/python-apt>), and is implemented in C. These two packages contain several bugs, which an unprivileged user can exploit to trigger a local denial of service attack.

## Product

aptd

## Tested Version

\* libapt-pkg-dev: version 2.0.2ubuntu0.1

\* python-apt: 2.0.0ubuntu0.20.04.1

\* Tested on Ubuntu 20.04.1 LTS

## Details

### Issue 1: aptd crash due to integer overflow in arfile.cc (GHSL-2020-168)

A crafted `.deb` package can trigger a negative integer overflow at [arfile.cc, line 116]([https://git.launchpad.net/ubuntu/+source/apt/tree/apt-pkg/contrib/arfile.cc?h=applied/ubuntu/focal-updates&id=4c264e60b524855b211751e1632ba48526f6b44d#n116](https://git.launchpad.net/ubuntu/%2Bsource/apt/tree/apt-pkg/contrib/arfile.cc?h=applied/ubuntu/focal-updates&id=4c264e60b524855b211751e1632ba48526f6b44d#n116)):

```c

Memb->Size -= Len;

```

Due to the integer overflow, the value of `Memb->Size` is `0xFFFFFFFFFFFFFFFF`. This leads to an out-of-memory error at [arfile.cc, line 602]([https://git.launchpad.net/ubuntu/+source/python-apt/tree/python/arfile.cc?h=applied/ubuntu/focal-updates&id=0f7cc93acdb51d943114f1cd79002288c4ca4d24#n602](https://git.launchpad.net/ubuntu/%2Bsource/python-apt/tree/python/arfile.cc?h=applied/ubuntu/focal-updates&id=0f7cc93acdb51d943114f1cd79002288c4ca4d24#n602)):

```c

char\* value = new char[member->Size];

```

The out-of-memory error causes aptd to crash.

Please note that the source locations above refer to two separate files, both named `arfile.cc`. The first is from the libapt-pkg-dev package and the second is from the python-apt package.

To trigger the crash, first use the attached source file named "createdeb.c" to generate the malicious `.deb` file:

```bash

gcc createdeb.c -o createdeb

./createdeb crash test.deb

```

Now use `dbus-send` to send the malicious `.deb` file to aptd:

```bash

$ dbus-send --system --type="method\_call" --print-reply --dest=org.debian.apt /org/debian/apt org.debian.apt.InstallFile string:`realpath test.deb` boolean:true

method return time=1602245339.731762 sender=:1.287 -> destination=:1.288 serial=8 reply\_serial=2

   string "/org/debian/apt/transaction/90f29de930854568964af1918f6ca5eb"

$ dbus-send --system --type="method\_call" --print-reply --dest=org.debian.apt /org/debian/apt/transaction/90f29de930854568964af1918f6ca5eb org.debian.apt.transaction.Run

```

Note that you need to use the "transaction id" returned by the first `dbus-send` in the second `dbus-send` command.

#### Impact

This issue may lead to local denial of service.

#### Resources

I have attached `createdeb.c`, which can be used to generate the malicious `.deb` file.

### Issue 2: aptd infinite loop due to integer overflow in arfile.cc (GHSL-2020-169)

This issue is very similar to issue 1, but is caused by a different bug. This bug occurs during the call to `StrToNum` at [arfile.cc, line 92]([https://git.launchpad.net/ubuntu/+source/apt/tree/apt-pkg/contrib/arfile.cc?h=applied/ubuntu/focal-updates&id=4c264e60b524855b211751e1632ba48526f6b44d#n92](https://git.launchpad.net/ubuntu/%2Bsource/apt/tree/apt-pkg/contrib/arfile.cc?h=applied/ubuntu/focal-updates&id=4c264e60b524855b211751e1632ba48526f6b44d#n92)):

```c

StrToNum(Head.Size,Memb->Size,sizeof(Head.Size)) == false)

```

The bug is due to the use of `strtoul` in [StrToNum]([https://git.launchpad.net/ubuntu/+source/apt/tree/apt-pkg/contrib/strutl.cc?h=applied/ubuntu/focal-updates&id=4c264e60b524855b211751e1632ba48526f6b44d#n1169](https://git.launchpad.net/ubuntu/%2Bsource/apt/tree/apt-pkg/contrib/strutl.cc?h=applied/ubuntu/focal-updates&id=4c264e60b524855b211751e1632ba48526f6b44d#n1169)):

```c

// StrToNum - Convert a fixed length string to a number /\*{{{\*/

// ---------------------------------------------------------------------

/\* This is used in decoding the crazy fixed length string headers in

   tar and ar files. \*/

bool StrToNum(const char \*Str,unsigned long &Res,unsigned Len,unsigned Base)

{

   char S[30];

   if (Len >= sizeof(S))

      return false;

   memcpy(S,Str,Len);

   S[Len] = 0;

// All spaces is a zero

   Res = 0;

   unsigned I;

   for (I = 0; S[I] == ' '; I++);

   if (S[I] == 0)

      return true;

char \*End;

   Res = strtoul(S,&End,Base); <====== negative numbers accepted

   if (End == S)

      return false;

return true;

}

```

The bug is that `strtoul` allows the number to be negative. For example, it will accept the string "-60". I have written a proof-of-concept exploit which uses this to put the parser into an infinite loop.

To run the proof-of-concept, first use the attached source file named "createdeb.c" to generate the malicious `.deb` file:

```bash

gcc createdeb.c -o createdeb

./createdeb loop test.deb

```

Now use `dbus-send` to send the malicious `.deb` file to aptd:

```bash

$ dbus-send --system --type="method\_call" --print-reply --dest=org.debian.apt /org/debian/apt org.debian.apt.InstallFile string:`realpath test.deb` boolean:true

method return time=1602245339.731762 sender=:1.287 -> destination=:1.288 serial=8 reply\_serial=2

   string "/org/debian/apt/transaction/90f29de930854568964af1918f6ca5eb"

$ dbus-send --system --type="method\_call" --print-reply --dest=org.debian.apt /org/debian/apt/transaction/90f29de930854568964af1918f6ca5eb org.debian.apt.transaction.Run

```

Note that you need to use the "transaction id" returned by the first `dbus-send` in the second `dbus-send` command.

#### Impact

This issue may lead to local denial of service.

#### Resources

I have attached `createdeb.c`, which can be used to generate the malicious `.deb` file.

### Issue 3: aptd file descriptor leak (GHSL-2020-170)

There is a file descriptor leak in `debfile\_new` at [arfile.cc, line 588]([https://git.launchpad.net/ubuntu/+source/python-apt/tree/python/arfile.cc?h=applied/ubuntu/focal-updates&id=0f7cc93acdb51d943114f1cd79002288c4ca4d24#n588](https://git.launchpad.net/ubuntu/%2Bsource/python-apt/tree/python/arfile.cc?h=applied/ubuntu/focal-updates&id=0f7cc93acdb51d943114f1cd79002288c4ca4d24#n588)):

```c

static PyObject \*debfile\_new(PyTypeObject \*type, PyObject \*args, PyObject \*kwds)

{

    PyDebFileObject \*self = (PyDebFileObject\*)ararchive\_new(type, args, kwds);

    if (self == NULL)

        return NULL;

// DebFile

    self->control = debfile\_get\_tar(self, "control.tar");

    if (self->control == NULL)

        return NULL; <===== self is not freed, so a file descriptor is leaked

```

If the `.deb` file is invalid, then `debfile\_new()` returns `NULL`, forgetting to free `self`. This means that the file descriptor for the `.deb` file is not closed. An attacker could use this to exhaust the system's file descriptors, causing a local denial of service.

To run the proof-of-concept, first use the attached source file named "createdeb.c" to generate the malicious `.deb` file:

```bash

gcc createdeb.c -o createdeb

./createdeb leakfd test.deb

```

Now use `dbus-send` to send the malicious `.deb` file to aptd:

```bash

$ dbus-send --system --type="method\_call" --print-reply --dest=org.debian.apt /org/debian/apt org.debian.apt.InstallFile string:`realpath test.deb` boolean:true

method return time=1602245339.731762 sender=:1.287 -> destination=:1.288 serial=8 reply\_serial=2

   string "/org/debian/apt/transaction/90f29de930854568964af1918f6ca5eb"

$ dbus-send --system --type="method\_call" --print-reply --dest=org.debian.apt /org/debian/apt/transaction/90f29de930854568964af1918f6ca5eb org.debian.apt.transaction.Run

```

Note that you need to use the "transaction id" returned by the first `dbus-send` in the second `dbus-send` command. Every time you run the PoC, aptd will open another file descriptor to the `.deb` file, which you can observe by running `lsof -p <pid of aptd>`.

#### Impact

This issue may lead to local denial of service.

#### Resources

I have attached `createdeb.c`, which can be used to generate the malicious `.deb` file.

## Credit

These issues were discovered and reported by GHSL team member [@kevinbackhouse (Kevin Backhouse)](<https://github.com/kevinbackhouse>).

## Contact

You can contact the GHSL team at `<email address hidden>`, please include a reference to `GHSL-2020-168`, `GHSL-2020-169`, or `GHSL-2020-170` in any communication regarding these issues.

## Disclosure Policy

This report is subject to our [coordinated disclosure policy](<https://securitylab.github.com/disclosures#policy>).

## CVE References

* [2020-16128](/bugs/cve/2020-16128 "The aptdaemon DBus interface disclose...")
* [2020-27349](/bugs/cve/2020-27349 "Aptdaemon performed policykit checks ...")
* [2020-27350](/bugs/cve/2020-27350 "APT had several integer overflows and...")
* [2020-27351](/bugs/cve/2020-27351 "Various memory and file descriptor le...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kev (kbackhouse2000)](https://launchpad.net/~kbackhouse2000) wrote on 2020-10-09: |  |  | [#1](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/1) |
| --- | --- | --- | --- |

* [createdeb.c](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5420025/%2Bfiles/createdeb.c)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5420025)
  (5.9 KiB,
  text/x-csrc)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2020-10-10: |  |  | [#2](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/2) |
| --- | --- | --- | --- |

Hello Kevin, it's good to hear from you again. Thanks for the excellent report and beautiful reproducer.

Julian, is this something you can look at?

Thanks

Hello Kevin, it's good to hear from you again. Thanks for the excellent report and beautiful reproducer.
Julian, is this something you can look at?
Thanks

| Changed in apt (Ubuntu): | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-10-10: |  |  | [#3](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/3) |
| --- | --- | --- | --- |

I don't understand the focus on aptd here given that none of the bugs are in there, and I'll have to see if I can come up with a reproducer to integrate with the tests, and see if it's all fixable. This also affects package kit and apt itself, likely.

I don't care all that much about denial of services, there are likely easier approaches than using these issues.

Also, shouldn't they only be exploitable as root anyway? If not, we should really be worrying why we read deb files in the root daemon without having done policy kit checking.

I don't understand the focus on aptd here given that none of the bugs are in there, and I'll have to see if I can come up with a reproducer to integrate with the tests, and see if it's all fixable. This also affects package kit and apt itself, likely.
I don't care all that much about denial of services, there are likely easier approaches than using these issues.
Also, shouldn't they only be exploitable as root anyway? If not, we should really be worrying why we read deb files in the root daemon without having done policy kit checking.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kev (kbackhouse2000)](https://launchpad.net/~kbackhouse2000) wrote on 2020-10-12: |  |  | [#4](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/4) |
| --- | --- | --- | --- |

Hi Julian,

I am sorry if reported this bug to the wrong package. I followed the "bug reports" link from this page: <https://packages.ubuntu.com/focal/libapt-pkg-dev>

These bugs do not require any privileges to trigger. As you say, I think part of the problem is that polkit checking is done too late. Although the main problem is, of course, the bugs in the C code.

Thanks,

Kev

Hi Julian,
I am sorry if reported this bug to the wrong package. I followed the "bug reports" link from this page: https://packages.ubuntu.com/focal/libapt-pkg-dev
These bugs do not require any privileges to trigger. As you say, I think part of the problem is that polkit checking is done too late. Although the main problem is, of course, the bugs in the C code.
Thanks,
Kev

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-10-12: |  |  | [#5](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/5) |
| --- | --- | --- | --- |

Don't worry, it's in the right spot, I just thought it's an aptdaemon bug from the messaging, but then it's 3 (well 4) bugs spread all over apt, python-apt, and (policykit) aptdaemon.

Practically speaking, the main problem is the late policykit check, not the bugs in the C code, because once you passed that, you are in the trusted zone anyway. The package scripts run as root a few moments later anyway, and that gives me much better opportunities to do harm. Or you install setuid binaries.

In summary, the input to those daemons (and apt binaries) that run as root must be trusted. Now neither has (had for PK) appropriate checks at the right spot, so well, that's bad. I wonder what QApt does.

Now, aptdaemon isn't used much anymore past 16.04 - only for non-security updates, so the impact of DoS-ing aptdaemon is not the most critical out there, which is good. The rest installs via PackageKit or directly using apt (security updates). And I think aptdaemon does not acquire locks at the point where those issues happen, so security updates would still apply fine.

There is software where I think this is more critical, e.g. archive management like Launchpad and dak uses it to analyse packages, and you can then crash certain queues or hang them. Now Launchpad has some protection by running them separately, but I'm not sure how well it deals with those infinite loops - if one queue "hangs". So basically, you can DoS whatever archive(s) you can upload too.

Don't worry, it's in the right spot, I just thought it's an aptdaemon bug from the messaging, but then it's 3 (well 4) bugs spread all over apt, python-apt, and (policykit) aptdaemon.
Practically speaking, the main problem is the late policykit check, not the bugs in the C code, because once you passed that, you are in the trusted zone anyway. The package scripts run as root a few moments later anyway, and that gives me much better opportunities to do harm. Or you install setuid binaries.
In summary, the input to those daemons (and apt binaries) that run as root must be trusted. Now neither has (had for PK) appropriate checks at the right spot, so well, that's bad. I wonder what QApt does.
Now, aptdaemon isn't used much anymore past 16.04 - only for non-security updates, so the impact of DoS-ing aptdaemon is not the most critical out there, which is good. The rest installs via PackageKit or directly using apt (security updates). And I think aptdaemon does not acquire locks at the point where those issues happen, so security updates would still apply fine.
There is software where I think this is more critical, e.g. archive management like Launchpad and dak uses it to analyse packages, and you can then crash certain queues or hang them. Now Launchpad has some protection by running them separately, but I'm not sure how well it deals with those infinite loops - if one queue "hangs". So basically, you can DoS whatever archive(s) you can upload too.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-10-15: |  |  | [#6](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/6) |
| --- | --- | --- | --- |

#1 and #2 only require fixes in apt:

So #2. Is it really infinite, isn't it basically too big? Similar to when you start reading the file, but the file is truncated.

Now, apparently we do require that we know the size of the arfile (which is stored in Left), so what we should do I guess is

if (Memb->Size > Left) {

    delete Memb;

    return \_error->Error(\_("Invalid archive member header"))

}

which fixes the issue and also detects truncated files. Well, I guess the message could also say the archive is truncated, but everything else uses this message.

Now #1 we know that Memb->Size is as correct as it will get, so the step here seems to be to add

if (Len > Memb->Size) {

    delete Memb;

    return \_error->Error(\_("Invalid archive member header"))

}

This ensures that the length we parse for the long name is shorter than the member, which is correct.

#3 needs wrapping object in a smart pointer so the fd is relased. This also needs similar changes in ararchive\_new, and possibly a whole bunch of other code that opens files on its own. Further investigation is necessary.

The good thing is that we should be able to get unit tests for all of those. For FDs we count open fds before and after an erronous call, and #1#2 we can check that the malicious debs fail with an error :)

#1 and #2 only require fixes in apt:
So #2. Is it really infinite, isn't it basically too big? Similar to when you start reading the file, but the file is truncated.
Now, apparently we do require that we know the size of the arfile (which is stored in Left), so what we should do I guess is
if (Memb->Size > Left) {
delete Memb;
return \_error->Error(\_("Invalid archive member header"))
}
which fixes the issue and also detects truncated files. Well, I guess the message could also say the archive is truncated, but everything else uses this message.
Now #1 we know that Memb->Size is as correct as it will get, so the step here seems to be to add
if (Len > Memb->Size) {
delete Memb;
return \_error->Error(\_("Invalid archive member header"))
}
This ensures that the length we parse for the long name is shorter than the member, which is correct.
#3 needs wrapping object in a smart pointer so the fd is relased. This also needs similar changes in ararchive\_new, and possibly a whole bunch of other code that opens files on its own. Further investigation is necessary.
The good thing is that we should be able to get unit tests for all of those. For FDs we count open fds before and after an erronous call, and #1#2 we can check that the malicious debs fail with an error :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-10-15: |  |  | [#7](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/7) |
| --- | --- | --- | --- |

I'm now also looking into where aptd opens those files in the first place, and how we can move the PolicyKit check before that, as we really don't want untrusted users to be able to parse/decompress random files in a root process, which happens if it's reading the deb.

I'm now also looking into where aptd opens those files in the first place, and how we can move the PolicyKit check before that, as we really don't want untrusted users to be able to parse/decompress random files in a root process, which happens if it's reading the deb.

[Julian Andres Klode (juliank)](https://launchpad.net/~juliank)
on 2020-10-19

| Changed in apt (Ubuntu): | |
| --- | --- |
| **status**: | Confirmed → Triaged |
| Changed in python-apt (Ubuntu): | |
| **status**: | New → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-10-19: |  |  | [#8](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/8) |
| --- | --- | --- | --- |

* [0001-arfile-Integer-overflow-in-parsing-GHSL-2020-168-GHS.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5424168/%2Bfiles/0001-arfile-Integer-overflow-in-parsing-GHSL-2020-168-GHS.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5424168)
  (10.6 KiB,
  text/plain)

Attached patch for the first two issues, the ones in apt. I embedded the provided test creator code (reformatted), I assume it's fine distributing this as GPL-2+ in apt?

The test case shows that the created debs are properly rejected.

This should apply to apt 1.3 and later, older versions (e.g. 1.2 in xenial) need an adjustment for the old buildsystem - replacing the CMakeLists bit with a makefile one (and I vaguely recall helper path lookup worked differently there, need to test)

Please give it a try! Four/six eyes see more than 2.

Attached patch for the first two issues, the ones in apt. I embedded the provided test creator code (reformatted), I assume it's fine distributing this as GPL-2+ in apt?
The test case shows that the created debs are properly rejected.
This should apply to apt 1.3 and later, older versions (e.g. 1.2 in xenial) need an adjustment for the old buildsystem - replacing the CMakeLists bit with a makefile one (and I vaguely recall helper path lookup worked differently there, need to test)
Please give it a try! Four/six eyes see more than 2.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kev (kbackhouse2000)](https://launchpad.net/~kbackhouse2000) wrote on 2020-10-21: |  |  | [#9](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/9) |
| --- | --- | --- | --- |

Patch for issues 1 and 2 looks good. Thanks!

Patch for issues 1 and 2 looks good. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-11-17: |  |  | [#10](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/10) |
| --- | --- | --- | --- |

### Issue 3: aptd file descriptor leak (GHSL-2020-170)

I also found out that if the function returns successfully, the runtime won't immediately deallocate the object once it's reference count reaches zero, so e.g.

def f():

    apt\_inst.DebFile("../apt\_1.9.5\_amd64.deb")

f()

will cause an extra fd to be used, until the cyclic garbage collector ran. I think this is a problem I introduced years ago when I made them subclassable because that somehow required adding GC support or something - I don't remember.

In any case, this means, that these need to become context managers or at least gain a close() method so that they can be closed when no longer needed.

arfile\_new has the same issue FWIW, if there's an error somewhere and the file was opened, it leaks it, as does tagfile\_new; and both of them also have memory leaks as they never free those objects in these error cases.

### Issue 3: aptd file descriptor leak (GHSL-2020-170)
I also found out that if the function returns successfully, the runtime won't immediately deallocate the object once it's reference count reaches zero, so e.g.
def f():
apt\_inst.DebFile("../apt\_1.9.5\_amd64.deb")
f()
will cause an extra fd to be used, until the cyclic garbage collector ran. I think this is a problem I introduced years ago when I made them subclassable because that somehow required adding GC support or something - I don't remember.
In any case, this means, that these need to become context managers or at least gain a close() method so that they can be closed when no longer needed.
arfile\_new has the same issue FWIW, if there's an error somewhere and the file was opened, it leaks it, as does tagfile\_new; and both of them also have memory leaks as they never free those objects in these error cases.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-11-17: |  |  | [#11](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/11) |
| --- | --- | --- | --- |

* [0001-File-descriptor-leaks-in-ArArchive-DebFile-TagFile.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5435161/%2Bfiles/0001-File-descriptor-leaks-in-ArArchive-DebFile-TagFile.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5435161)
  (6.9 KiB,
  text/plain)

Attached is a patch for the error cases in debfile\_new (and ArArchive and TagFile). It works by decreasing the reference count of the object on error paths, and clearing the cycles, so that the object will be collected and the FD released once the function returns.

A test case will be added shortly, that will do os.listdir(/proc/self/fd) before and after calls to ensure that the number of file descriptors is the same.

Because the reason it needed a GC run before was: It turns out I do have cycles in both DebFile and TagFile:

DebFile contains references to data.tar and control.tar members, which in point hold references to the DebFile, so as to make sure that the file stays around while the data needs it.

TagFile links to a TagSection which links back to the TagFile, as the data is actually stored in the tagfile buffer. Oh dear.

I suppose I could fix them both correctly by removing the cycle, e.g. abstracting the File to a FileCommon that both File and Section/member reference, then existing code relying on reference counts will start behaving correctly.

Attached is a patch for the error cases in debfile\_new (and ArArchive and TagFile). It works by decreasing the reference count of the object on error paths, and clearing the cycles, so that the object will be collected and the FD released once the function returns.
A test case will be added shortly, that will do os.listdir(/proc/self/fd) before and after calls to ensure that the number of file descriptors is the same.
Because the reason it needed a GC run before was: It turns out I do have cycles in both DebFile and TagFile:
DebFile contains references to data.tar and control.tar members, which in point hold references to the DebFile, so as to make sure that the file stays around while the data needs it.
TagFile links to a TagSection which links back to the TagFile, as the data is actually stored in the tagfile buffer. Oh dear.
I suppose I could fix them both correctly by removing the cycle, e.g. abstracting the File to a FileCommon that both File and Section/member reference, then existing code relying on reference counts will start behaving correctly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2020-11-18: |  |  | [#12](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/12) |
| --- | --- | --- | --- |

Hello Julian, the file descriptor leak patch has a section that I'm not sure about:

static PyObject \*debfile\_new(PyTypeObject \*type, PyObject \*args, PyObject \*kwds)

 {

- PyDebFileObject \*self = (PyDebFileObject\*)ararchive\_new(type, args, kwds);

+ PyApt\_UniqueObject<PyDebFileObject> self((PyDebFileObject\*)ararchive\_new(type, args, kwds));

     if (self == NULL)

         return NULL;

// DebFile

- self->control = debfile\_get\_tar(self, "control.tar");

+ self->control = debfile\_get\_tar(self.get(), "control.tar");

     if (self->control == NULL)

         return NULL;

- self->data = debfile\_get\_tar(self, "data.tar");

+ self->data = debfile\_get\_tar(self.get(), "data.tar");

     if (self->data == NULL)

         return NULL;

@@ -603,7 +603,7 @@ static PyObject \*debfile\_new(PyTypeObject \*type, PyObject \*args, PyObject \*kwds)

     self->Fd.Read(value, member->Size, true);

     self->debian\_binary = PyBytes\_FromStringAndSize(value, member->Size);

     delete[] value;

- return self;

+ return self.release();

 }

What happens with those return NULL cases if the data.tar or control.tar entries don't exist? Is that a new leak? I expected a self.release() before those cases.

(Or, alternatively, I don't understand the 'return self.release()' idiom.)

There's also a minor typo "file descritor" in the header. Do what you wish with this.

Thanks

Hello Julian, the file descriptor leak patch has a section that I'm not sure about:
static PyObject \*debfile\_new(PyTypeObject \*type, PyObject \*args, PyObject \*kwds)
{
- PyDebFileObject \*self = (PyDebFileObject\*)ararchive\_new(type, args, kwds);
+ PyApt\_UniqueObject<PyDebFileObject> self((PyDebFileObject\*)ararchive\_new(type, args, kwds));
if (self == NULL)
return NULL;
// DebFile
- self->control = debfile\_get\_tar(self, "control.tar");
+ self->control = debfile\_get\_tar(self.get(), "control.tar");
if (self->control == NULL)
return NULL;
- self->data = debfile\_get\_tar(self, "data.tar");
+ self->data = debfile\_get\_tar(self.get(), "data.tar");
if (self->data == NULL)
return NULL;
@@ -603,7 +603,7 @@ static PyObject \*debfile\_new(PyTypeObject \*type, PyObject \*args, PyObject \*kwds)
self->Fd.Read(value, member->Size, true);
self->debian\_binary = PyBytes\_FromStringAndSize(value, member->Size);
delete[] value;
- return self;
+ return self.release();
}
What happens with those return NULL cases if the data.tar or control.tar entries don't exist? Is that a new leak? I expected a self.release() before those cases.
(Or, alternatively, I don't understand the 'return self.release()' idiom.)
There's also a minor typo "file descritor" in the header. Do what you wish with this.
Thanks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2020-11-18: |  |  | [#13](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/13) |
| --- | --- | --- | --- |

Cleaning up the integer overflows and filedescriptor leaks feels like a good idea; however I'm inclined to say there's one CVE (or perhaps one per software package, if it's truly scattered around correctly) for misplaced polkit checks -- does that sound correct?

Thanks

Cleaning up the integer overflows and filedescriptor leaks feels like a good idea; however I'm inclined to say there's one CVE (or perhaps one per software package, if it's truly scattered around correctly) for misplaced polkit checks -- does that sound correct?
Thanks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-11-18: |  |  | [#14](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/14) |
| --- | --- | --- | --- |

We certainly want a CVE for moving the root check earlier I suppose, if that's doable with the API - I've not looked at how that all interacts in practice.

I think we need one CVE for each of these things? The code was not meant for untrusted input, but archive tools like launchpad use it for such (albeit in one process per PPA or so, so you can like only DoS a PPA you have write access to).

We certainly want a CVE for moving the root check earlier I suppose, if that's doable with the API - I've not looked at how that all interacts in practice.
I think we need one CVE for each of these things? The code was not meant for untrusted input, but archive tools like launchpad use it for such (albeit in one process per PPA or so, so you can like only DoS a PPA you have write access to).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-11-18: |  |  | [#15](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/15) |
| --- | --- | --- | --- |

> What happens with those return NULL cases if the data.tar or control.tar entries don't exist? Is that a new leak? I expected a self.release() before those cases.

OK, so release() releases ownership from the smart pointer to the caller (by setting the internal pointer to NULL and returning it).

Just returning NULL without calling release means the smart pointer object will decrement the reference count and hence deallocate it.

See <https://en.cppreference.com/w/cpp/memory/unique_ptr/release> for more information about the origin of the idiom.

> What happens with those return NULL cases if the data.tar or control.tar entries don't exist? Is that a new leak? I expected a self.release() before those cases.
OK, so release() releases ownership from the smart pointer to the caller (by setting the internal pointer to NULL and returning it).
Just returning NULL without calling release means the smart pointer object will decrement the reference count and hence deallocate it.
See https://en.cppreference.com/w/cpp/memory/unique\_ptr/release for more information about the origin of the idiom.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2020-11-20: |  |  | [#16](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/16) |
| --- | --- | --- | --- |

Thanks for the descriptions; I always assumed there was a lot more magic to unique\_ptr. I hadn't expected a dozen-line implementation.

This one's a little complicated:

CVE-2020-27349 (aptdaemon, LP: [#1899193](/bugs/1899193)) -- policykit checks are too late

CVE-2020-27350 (apt, LP: [#1899193](/bugs/1899193)) -- apt-pkg/contrib/arfile.cc missing comparisons GHSL-2020-168 GHSL-2020-169

CVE-2020-27351 (python-apt, LP: [#1899193](/bugs/1899193)) -- python/arfile.cc, python/tag.cc, python/tarfile.cc -- various memory and file descriptor leaks GHSL-2020-170

I'm not 100% sure on lumping together memory leaks (missing free) and file descriptor leaks (missing close) but as they are both missing release of resource, and the same patch addresses both, I don't see a benefit to another CVE in this case.

Thanks

Thanks for the descriptions; I always assumed there was a lot more magic to unique\_ptr. I hadn't expected a dozen-line implementation.
This one's a little complicated:
CVE-2020-27349 (aptdaemon, LP: #1899193) -- policykit checks are too late
CVE-2020-27350 (apt, LP: #1899193) -- apt-pkg/contrib/arfile.cc missing comparisons GHSL-2020-168 GHSL-2020-169
CVE-2020-27351 (python-apt, LP: #1899193) -- python/arfile.cc, python/tag.cc, python/tarfile.cc -- various memory and file descriptor leaks GHSL-2020-170
I'm not 100% sure on lumping together memory leaks (missing free) and file descriptor leaks (missing close) but as they are both missing release of resource, and the same patch addresses both, I don't see a benefit to another CVE in this case.
Thanks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-11-23: |  |  | [#17](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/17) |
| --- | --- | --- | --- |

I still wonder if we also should try to fix aptdaemon to explictly close the files it opens, as we can't rely on Python doing that automatically due to the reference cycles in DebFile, and if that needs a CVE as well - I have no idea if it's practically exploitable.

You need to give it a deb that's valid enough to open, aka has data.tar.xz and control.tar.xz and debian-binary members but then is being rejected by aptdaemon itself after the object is created (e.g. control.tar.xz contains nonsense).

Arguably if we fix the PolicyKit interaction, that's enough to go on the aptdaemon side.

I still wonder if we also should try to fix aptdaemon to explictly close the files it opens, as we can't rely on Python doing that automatically due to the reference cycles in DebFile, and if that needs a CVE as well - I have no idea if it's practically exploitable.
You need to give it a deb that's valid enough to open, aka has data.tar.xz and control.tar.xz and debian-binary members but then is being rejected by aptdaemon itself after the object is created (e.g. control.tar.xz contains nonsense).
Arguably if we fix the PolicyKit interaction, that's enough to go on the aptdaemon side.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-11-24: |  |  | [#18](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/18) |
| --- | --- | --- | --- |

* [0001-apt\_inst.DebFile-Avoid-reference-cycle-with-control-.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5437531/%2Bfiles/0001-apt_inst.DebFile-Avoid-reference-cycle-with-control-.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5437531)
  (9.4 KiB,
  text/plain)

Attached patch addresses the reference loop in apt\_inst.DebFile, ensuring that no longer referencing the object will release it immediately, as opposed to when the cycle GC runs.

Subject: [PATCH] apt\_inst.DebFile: Avoid reference cycle with control,data

 members

apt\_inst.DebFile provides two members `data` and `control` for

easy access to those tarballs. Each of those members stores a

reference to the DebFile as its owner:

    v-----------------\

        control ----\ |

                     -> deb -|

        data ----/ |

           ^-----------------/

This means that whenever a DebFile is successfully constructed,

and no longer needed, it won't be collected until the GC runs,

which is bad, as the DebFile holds an open FileFd.

Introduce a \_\_FileFd wrapper that holds the FileFd and becomes

the owner of both control and data, and replaces the direct use

of the FileFd in ArArchive/DebFile:

   v-----------------------------\

        control ----\ \

                     -> \_\_FileFd <- deb -|

        data ----/ /

          ^-----------------------------/

This avoids the reference cycle, ensuring the memory and file

descriptor are released by the reference counter as soon as

the reference count drops to 0.

A future version should move `apt\_inst.\_\_FileFd` to `apt\_pkg.FileFd`

and expose all the methods, such that people can make use of FileFd's

extensive compression support.

We have a similar cycle in TagFile that we have yet to address,

the problem there is arguably more frustrating, as the buffer

I believe is stored inside the TagFile, and that's really shared

between the TagSection objects.

This is related to LP: [#1899193](/bugs/1899193) and CVE-2020-27351, but an additional

hardening measure - the fix for those bugs was for more direct leaks.

Attached patch addresses the reference loop in apt\_inst.DebFile, ensuring that no longer referencing the object will release it immediately, as opposed to when the cycle GC runs.
Subject: [PATCH] apt\_inst.DebFile: Avoid reference cycle with control,data
members
apt\_inst.DebFile provides two members `data` and `control` for
easy access to those tarballs. Each of those members stores a
reference to the DebFile as its owner:
v-----------------\
control ----\ |
-> deb -|
data ----/ |
^-----------------/
This means that whenever a DebFile is successfully constructed,
and no longer needed, it won't be collected until the GC runs,
which is bad, as the DebFile holds an open FileFd.
Introduce a \_\_FileFd wrapper that holds the FileFd and becomes
the owner of both control and data, and replaces the direct use
of the FileFd in ArArchive/DebFile:
v-----------------------------\
control ----\ \
-> \_\_FileFd <- deb -|
data ----/ /
^-----------------------------/
This avoids the reference cycle, ensuring the memory and file
descriptor are released by the reference counter as soon as
the reference count drops to 0.
A future version should move `apt\_inst.\_\_FileFd` to `apt\_pkg.FileFd`
and expose all the methods, such that people can make use of FileFd's
extensive compression support.
We have a similar cycle in TagFile that we have yet to address,
the problem there is arguably more frustrating, as the buffer
I believe is stored inside the TagFile, and that's really shared
between the TagSection objects.
This is related to LP: #1899193 and CVE-2020-27351, but an additional
hardening measure - the fix for those bugs was for more direct leaks.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-01: |  |  | [#19](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/19) |
| --- | --- | --- | --- |

* [CVE-2020-27349.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5439980/%2Bfiles/CVE-2020-27349.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5439980)
  (1.0 KiB,
  text/plain)

Here is the patch for aptdaemon, just add it to the debian/patches, works back to xenial

Here is the patch for aptdaemon, just add it to the debian/patches, works back to xenial

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-01: |  |  | [#20](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/20) |
| --- | --- | --- | --- |

* [python-apt-focal.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440104/%2Bfiles/python-apt-focal.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440104)
  (38.2 KiB,
  text/plain)

python-apt debdiff for focal.

python-apt debdiff for focal.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-01: |  |  | [#21](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/21) |
| --- | --- | --- | --- |

* [python-apt-bionic.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440105/%2Bfiles/python-apt-bionic.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440105)
  (41.5 KiB,
  text/plain)

python-apt bionic diff

python-apt bionic diff

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-01: |  |  | [#22](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/22) |
| --- | --- | --- | --- |

* [python-apt-xenial.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440106/%2Bfiles/python-apt-xenial.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440106)
  (41.5 KiB,
  text/plain)

python-apt xenial debdiff

python-apt xenial debdiff

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-01: |  |  | [#23](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/23) |
| --- | --- | --- | --- |

* [python-apt-groovy.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440107/%2Bfiles/python-apt-groovy.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440107)
  (49.4 KiB,
  text/plain)

python-apt groovy debdiff

python-apt groovy debdiff

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-06: |  |  | [#24](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/24) |
| --- | --- | --- | --- |

Also subscribing other upstream APT maintainer for visibility.

Also subscribing other upstream APT maintainer for visibility.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-07: |  |  | [#25](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/25) |
| --- | --- | --- | --- |

* [apt-groovy.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441609/%2Bfiles/apt-groovy.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441609)
  (20.5 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-07: |  |  | [#26](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/26) |
| --- | --- | --- | --- |

* [apt-focal.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441610/%2Bfiles/apt-focal.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441610)
  (20.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-07: |  |  | [#27](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/27) |
| --- | --- | --- | --- |

* [apt-bionic.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441618/%2Bfiles/apt-bionic.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441618)
  (20.2 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-07: |  |  | [#28](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/28) |
| --- | --- | --- | --- |

* [apt-xenial.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441619/%2Bfiles/apt-xenial.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441619)
  (50.8 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Julian Andres Klode (juliank)](https://launchpad.net/~juliank) wrote on 2020-12-07: |  |  | [#29](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/29) |
| --- | --- | --- | --- |

Release dates:

2020-12-08:

- CVE-2020-27349 (aptdaemon, LP: [#1899193](/bugs/1899193)) -- policykit checks are too late

2020-12-09:

- CVE-2020-27350 (apt, LP: [#1899193](/bugs/1899193))

- CVE-2020-27351 (python-apt, LP: [#1899193](/bugs/1899193))

Release dates:
2020-12-08:
- CVE-2020-27349 (aptdaemon, LP: #1899193) -- policykit checks are too late
2020-12-09:
- CVE-2020-27350 (apt, LP: #1899193)
- CVE-2020-27351 (python-apt, LP: #1899193)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-08: |  |  | [#30](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/30) |
| --- | --- | --- | --- |

This bug was fixed in the package aptdaemon - 1.1.1+bzr982-0ubuntu34.1

---------------

aptdaemon (1.1.1+bzr982-0ubuntu34.1) groovy-security; urgency=medium

\* SECURITY UPDATE: info disclosure via transaction properties

    (LP: [#1899513](/bugs/1899513))

    - debian/patches/CVE-2020-16128.patch: drop privileges when doing file

      checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,

      aptdaemon/utils.py.

    - CVE-2020-16128

  \* SECURITY UPDATE: policykit checks are too late (LP: [#1899193](/bugs/1899193))

    - debian/patches/CVE-2020-27349.patch: check PolicyKit before

      simulating local install in aptdaemon/core.py.

    - CVE-2020-27349

-- Marc Deslauriers <email address hidden> Tue, 01 Dec 2020 09:23:26 -0500

This bug was fixed in the package aptdaemon - 1.1.1+bzr982-0ubuntu34.1
---------------
aptdaemon (1.1.1+bzr982-0ubuntu34.1) groovy-security; urgency=medium
\* SECURITY UPDATE: info disclosure via transaction properties
(LP: #1899513)
- debian/patches/CVE-2020-16128.patch: drop privileges when doing file
checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,
aptdaemon/utils.py.
- CVE-2020-16128
\* SECURITY UPDATE: policykit checks are too late (LP: #1899193)
- debian/patches/CVE-2020-27349.patch: check PolicyKit before
simulating local install in aptdaemon/core.py.
- CVE-2020-27349
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 01 Dec 2020 09:23:26 -0500

| Changed in aptdaemon (Ubuntu): | |
| --- | --- |
| **status**: | New → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-08: |  |  | [#31](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/31) |
| --- | --- | --- | --- |

This bug was fixed in the package aptdaemon - 1.1.1+bzr982-0ubuntu32.3

---------------

aptdaemon (1.1.1+bzr982-0ubuntu32.3) focal-security; urgency=medium

\* SECURITY UPDATE: info disclosure via transaction properties

    (LP: [#1899513](/bugs/1899513))

    - debian/patches/CVE-2020-16128.patch: drop privileges when doing file

      checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,

      aptdaemon/utils.py.

    - CVE-2020-16128

  \* SECURITY UPDATE: policykit checks are too late (LP: [#1899193](/bugs/1899193))

    - debian/patches/CVE-2020-27349.patch: check PolicyKit before

      simulating local install in aptdaemon/core.py.

    - CVE-2020-27349

-- Marc Deslauriers <email address hidden> Wed, 02 Dec 2020 07:42:52 -0500

This bug was fixed in the package aptdaemon - 1.1.1+bzr982-0ubuntu32.3
---------------
aptdaemon (1.1.1+bzr982-0ubuntu32.3) focal-security; urgency=medium
\* SECURITY UPDATE: info disclosure via transaction properties
(LP: #1899513)
- debian/patches/CVE-2020-16128.patch: drop privileges when doing file
checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,
aptdaemon/utils.py.
- CVE-2020-16128
\* SECURITY UPDATE: policykit checks are too late (LP: #1899193)
- debian/patches/CVE-2020-27349.patch: check PolicyKit before
simulating local install in aptdaemon/core.py.
- CVE-2020-27349
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Wed, 02 Dec 2020 07:42:52 -0500

| Changed in aptdaemon (Ubuntu): | |
| --- | --- |
| **status**: | New → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-08: |  |  | [#32](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/32) |
| --- | --- | --- | --- |

This bug was fixed in the package aptdaemon - 1.1.1+bzr982-0ubuntu19.5

---------------

aptdaemon (1.1.1+bzr982-0ubuntu19.5) bionic-security; urgency=medium

\* SECURITY UPDATE: info disclosure via transaction properties

    (LP: [#1899513](/bugs/1899513))

    - debian/patches/CVE-2020-16128.patch: drop privileges when doing file

      checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,

      aptdaemon/utils.py.

    - CVE-2020-16128

  \* SECURITY UPDATE: policykit checks are too late (LP: [#1899193](/bugs/1899193))

    - debian/patches/CVE-2020-27349.patch: check PolicyKit before

      simulating local install in aptdaemon/core.py.

    - CVE-2020-27349

-- Marc Deslauriers <email address hidden> Wed, 02 Dec 2020 07:43:55 -0500

This bug was fixed in the package aptdaemon - 1.1.1+bzr982-0ubuntu19.5
---------------
aptdaemon (1.1.1+bzr982-0ubuntu19.5) bionic-security; urgency=medium
\* SECURITY UPDATE: info disclosure via transaction properties
(LP: #1899513)
- debian/patches/CVE-2020-16128.patch: drop privileges when doing file
checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,
aptdaemon/utils.py.
- CVE-2020-16128
\* SECURITY UPDATE: policykit checks are too late (LP: #1899193)
- debian/patches/CVE-2020-27349.patch: check PolicyKit before
simulating local install in aptdaemon/core.py.
- CVE-2020-27349
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Wed, 02 Dec 2020 07:43:55 -0500

| Changed in aptdaemon (Ubuntu): | |
| --- | --- |
| **status**: | New → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-09: |  |  | [#33](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/33) |
| --- | --- | --- | --- |

This bug was fixed in the package apt - 2.1.10ubuntu0.1

---------------

apt (2.1.10ubuntu0.1) groovy-security; urgency=high

\* SECURITY UPDATE: Integer overflow in parsing (LP: [#1899193](/bugs/1899193))

    - apt-pkg/contrib/arfile.cc: add extra checks.

    - apt-pkg/contrib/tarfile.cc: limit tar item sizes to 128 GiB

    - apt-pkg/deb/debfile.cc: limit control file sizes to 64 MiB

    - test/\*: add tests.

    - CVE-2020-27350

  \* Additional hardening:

    - apt-pkg/contrib/tarfile.cc: Limit size of long names and links to 1 MiB

  \* .gitlab-ci.yml: Test on groovy, not unstable

-- Julian Andres Klode <email address hidden> Mon, 07 Dec 2020 12:02:40 +0100

This bug was fixed in the package apt - 2.1.10ubuntu0.1
---------------
apt (2.1.10ubuntu0.1) groovy-security; urgency=high
\* SECURITY UPDATE: Integer overflow in parsing (LP: #1899193)
- apt-pkg/contrib/arfile.cc: add extra checks.
- apt-pkg/contrib/tarfile.cc: limit tar item sizes to 128 GiB
- apt-pkg/deb/debfile.cc: limit control file sizes to 64 MiB
- test/\*: add tests.
- CVE-2020-27350
\* Additional hardening:
- apt-pkg/contrib/tarfile.cc: Limit size of long names and links to 1 MiB
\* .gitlab-ci.yml: Test on groovy, not unstable
-- Julian Andres Klode <juliank@ubuntu.com> Mon, 07 Dec 2020 12:02:40 +0100

| Changed in apt (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-09: |  |  | [#34](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/34) |
| --- | --- | --- | --- |

This bug was fixed in the package apt - 2.0.2ubuntu0.2

---------------

apt (2.0.2ubuntu0.2) focal-security; urgency=high

\* SECURITY UPDATE: Integer overflow in parsing (LP: [#1899193](/bugs/1899193))

    - apt-pkg/contrib/arfile.cc: add extra checks.

    - apt-pkg/contrib/tarfile.cc: limit tar item sizes to 128 GiB

    - apt-pkg/deb/debfile.cc: limit control file sizes to 64 MiB

    - test/\*: add tests.

    - CVE-2020-27350

  \* Additional hardening:

    - apt-pkg/contrib/tarfile.cc: Limit size of long names and links to 1 MiB

  \* .gitlab-ci.yml: Test on focal, not unstable

-- Julian Andres Klode <email address hidden> Mon, 07 Dec 2020 12:08:43 +0100

This bug was fixed in the package apt - 2.0.2ubuntu0.2
---------------
apt (2.0.2ubuntu0.2) focal-security; urgency=high
\* SECURITY UPDATE: Integer overflow in parsing (LP: #1899193)
- apt-pkg/contrib/arfile.cc: add extra checks.
- apt-pkg/contrib/tarfile.cc: limit tar item sizes to 128 GiB
- apt-pkg/deb/debfile.cc: limit control file sizes to 64 MiB
- test/\*: add tests.
- CVE-2020-27350
\* Additional hardening:
- apt-pkg/contrib/tarfile.cc: Limit size of long names and links to 1 MiB
\* .gitlab-ci.yml: Test on focal, not unstable
-- Julian Andres Klode <juliank@ubuntu.com> Mon, 07 Dec 2020 12:08:43 +0100

| Changed in apt (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-09: |  |  | [#35](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/35) |
| --- | --- | --- | --- |

This bug was fixed in the package apt - 1.6.12ubuntu0.2

---------------

apt (1.6.12ubuntu0.2) bionic-security; urgency=high

\* SECURITY UPDATE: Integer overflow in parsing (LP: [#1899193](/bugs/1899193))

    - apt-pkg/contrib/arfile.cc: add extra checks.

    - apt-pkg/contrib/tarfile.cc: limit tar item sizes to 128 GiB

    - apt-pkg/deb/debfile.cc: limit control file sizes to 64 MiB

    - test/\*: add tests.

    - CVE-2020-27350

  \* Additional hardening:

    - apt-pkg/contrib/tarfile.cc: Limit size of long names and links to 1 MiB

-- Julian Andres Klode <email address hidden> Mon, 07 Dec 2020 12:13:36 +0100

This bug was fixed in the package apt - 1.6.12ubuntu0.2
---------------
apt (1.6.12ubuntu0.2) bionic-security; urgency=high
\* SECURITY UPDATE: Integer overflow in parsing (LP: #1899193)
- apt-pkg/contrib/arfile.cc: add extra checks.
- apt-pkg/contrib/tarfile.cc: limit tar item sizes to 128 GiB
- apt-pkg/deb/debfile.cc: limit control file sizes to 64 MiB
- test/\*: add tests.
- CVE-2020-27350
\* Additional hardening:
- apt-pkg/contrib/tarfile.cc: Limit size of long names and links to 1 MiB
-- Julian Andres Klode <juliank@ubuntu.com> Mon, 07 Dec 2020 12:13:36 +0100

| Changed in apt (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-09: |  |  | [#36](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/36) |
| --- | --- | --- | --- |

This bug was fixed in the package python-apt - 2.1.3ubuntu1.1

---------------

python-apt (2.1.3ubuntu1.1) groovy-security; urgency=high

\* SECURITY UPDATE: various memory and file descriptor leaks (LP: [#1899193](/bugs/1899193))

    - python/arfile.cc, python/generic.h, python/tag.cc, python/tarfile.cc:

      fix file descriptor and memory leaks

    - python/apt\_instmodule.cc, python/apt\_instmodule.h, python/arfile.h:

      Avoid reference cycle with control,data members in apt\_inst.DebFile

      objects

    - tests/test\_cve\_2020\_27351.py: Test cases for DebFile (others not easily

      testable)

    - CVE-2020-27351

  \* .gitlab-ci.yml: Fix mypy and Ubuntu version for CI

  \* data/templates: Update mirror lists

-- Julian Andres Klode <email address hidden> Tue, 01 Dec 2020 20:25:56 +0100

This bug was fixed in the package python-apt - 2.1.3ubuntu1.1
---------------
python-apt (2.1.3ubuntu1.1) groovy-security; urgency=high
\* SECURITY UPDATE: various memory and file descriptor leaks (LP: #1899193)
- python/arfile.cc, python/generic.h, python/tag.cc, python/tarfile.cc:
fix file descriptor and memory leaks
- python/apt\_instmodule.cc, python/apt\_instmodule.h, python/arfile.h:
Avoid reference cycle with control,data members in apt\_inst.DebFile
objects
- tests/test\_cve\_2020\_27351.py: Test cases for DebFile (others not easily
testable)
- CVE-2020-27351
\* .gitlab-ci.yml: Fix mypy and Ubuntu version for CI
\* data/templates: Update mirror lists
-- Julian Andres Klode <juliank@ubuntu.com> Tue, 01 Dec 2020 20:25:56 +0100

| Changed in python-apt (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-09: |  |  | [#37](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/37) |
| --- | --- | --- | --- |

This bug was fixed in the package python-apt - 2.0.0ubuntu0.20.04.2

---------------

python-apt (2.0.0ubuntu0.20.04.2) focal-security; urgency=high

\* SECURITY UPDATE: various memory and file descriptor leaks (LP: [#1899193](/bugs/1899193))

    - python/arfile.cc, python/generic.h, python/tag.cc, python/tarfile.cc:

      fix file descriptor and memory leaks

    - python/apt\_instmodule.cc, python/apt\_instmodule.h, python/arfile.h:

      Avoid reference cycle with control,data members in apt\_inst.DebFile

      objects

    - tests/test\_cve\_2020\_27351.py: Test cases for DebFile (others not easily

      testable)

    - CVE-2020-27351

  \* .gitlab-ci.yml: Fix mypy version for CI

  \* data/templates: Update mirror lists

-- Julian Andres Klode <email address hidden> Tue, 01 Dec 2020 17:15:01 +0100

This bug was fixed in the package python-apt - 2.0.0ubuntu0.20.04.2
---------------
python-apt (2.0.0ubuntu0.20.04.2) focal-security; urgency=high
\* SECURITY UPDATE: various memory and file descriptor leaks (LP: #1899193)
- python/arfile.cc, python/generic.h, python/tag.cc, python/tarfile.cc:
fix file descriptor and memory leaks
- python/apt\_instmodule.cc, python/apt\_instmodule.h, python/arfile.h:
Avoid reference cycle with control,data members in apt\_inst.DebFile
objects
- tests/test\_cve\_2020\_27351.py: Test cases for DebFile (others not easily
testable)
- CVE-2020-27351
\* .gitlab-ci.yml: Fix mypy version for CI
\* data/templates: Update mirror lists
-- Julian Andres Klode <juliank@ubuntu.com> Tue, 01 Dec 2020 17:15:01 +0100

| Changed in python-apt (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2020-12-09: |  |  | [#38](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/38) |
| --- | --- | --- | --- |

This bug was fixed in the package python-apt - 1.6.5ubuntu0.4

---------------

python-apt (1.6.5ubuntu0.4) bionic-security; urgency=high

\* SECURITY UPDATE: various memory and file descriptor leaks (LP: [#1899193](/bugs/1899193))

    - python/arfile.cc, python/generic.h, python/tag.cc, python/tarfile.cc:

      fix file descriptor and memory leaks

    - python/apt\_instmodule.cc, python/apt\_instmodule.h, python/arfile.h:

      Avoid reference cycle with control,data members in apt\_inst.DebFile

      objects

    - tests/test\_cve\_2020\_27351.py: Test cases for DebFile (others not easily

      testable)

    - CVE-2020-27351

  \* data/templates: Update mirror lists

-- Julian Andres Klode <email address hidden> Tue, 01 Dec 2020 20:16:11 +0100

This bug was fixed in the package python-apt - 1.6.5ubuntu0.4
---------------
python-apt (1.6.5ubuntu0.4) bionic-security; urgency=high
\* SECURITY UPDATE: various memory and file descriptor leaks (LP: #1899193)
- python/arfile.cc, python/generic.h, python/tag.cc, python/tarfile.cc:
fix file descriptor and memory leaks
- python/apt\_instmodule.cc, python/apt\_instmodule.h, python/arfile.h:
Avoid reference cycle with control,data members in apt\_inst.DebFile
objects
- tests/test\_cve\_2020\_27351.py: Test cases for DebFile (others not easily
testable)
- CVE-2020-27351
\* data/templates: Update mirror lists
-- Julian Andres Klode <juliank@ubuntu.com> Tue, 01 Dec 2020 20:16:11 +0100

| Changed in python-apt (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

[Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold)
on 2021-02-27

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [shaun (shaggy183)](https://launchpad.net/~shaggy183) wrote on 2021-06-21: |  |  | [#39](/ubuntu/%2Bsource/apt/%2Bbug/1899193/comments/39) |
| --- | --- | --- | --- |

its laging and not adding my pakadges or exepting my passwords

its laging and not adding my pakadges or exepting my passwords

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/apt/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [0001-arfile-Integer-overflow-in-parsing-GHSL-2020-168-GHS.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5424168/%2Bfiles/0001-arfile-Integer-overflow-in-parsing-GHSL-2020-168-GHS.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5424168 "Change patch details")
* [0001-File-descriptor-leaks-in-ArArchive-DebFile-TagFile.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5435161/%2Bfiles/0001-File-descriptor-leaks-in-ArArchive-DebFile-TagFile.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5435161 "Change patch details")
* [0001-apt\_inst.DebFile-Avoid-reference-cycle-with-control-.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5437531/%2Bfiles/0001-apt_inst.DebFile-Avoid-reference-cycle-with-control-.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5437531 "Change patch details")
* [CVE-2020-27349.patch](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5439980/%2Bfiles/CVE-2020-27349.patch)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5439980 "Change patch details")
* [python-apt-focal.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440104/%2Bfiles/python-apt-focal.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440104 "Change patch details")
* [python-apt-bionic.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440105/%2Bfiles/python-apt-bionic.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440105 "Change patch details")
* [python-apt-xenial.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440106/%2Bfiles/python-apt-xenial.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440106 "Change patch details")
* [python-apt-groovy.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440107/%2Bfiles/python-apt-groovy.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5440107 "Change patch details")
* [apt-groovy.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441609/%2Bfiles/apt-groovy.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441609 "Change patch details")
* [apt-focal.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441610/%2Bfiles/apt-focal.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441610 "Change patch details")
* [apt-bionic.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441618/%2Bfiles/apt-bionic.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441618 "Change patch details")
* [apt-xenial.diff](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441619/%2Bfiles/apt-xenial.diff)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5441619 "Change patch details")

* [Add patch](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Baddcomment?field.patch=on)

## Bug attachments

* [createdeb.c](https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5420025/%2Bfiles/createdeb.c)
  [Edit](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Battachment/5420025 "Change attachment details")

* [Add attachment](/ubuntu/%2Bsource/apt/%2Bbug/1899193/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from usn.ubuntu.com_1a503ff5_20250119_113004.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4664-1: Aptdaemon vulnerabilities

8 December 2020

Several security issues were fixed in Aptdaemon.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 20.10](/security/notices?release=groovy)
* [Ubuntu 20.04 LTS](/security/notices?release=focal)
* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [aptdaemon](/security/cves?package=aptdaemon) - transaction based package management service

## Details

Kevin Backhouse discovered that Aptdaemon incorrectly handled certain

properties. A local attacker could use this issue to test for the presence

of local files. ([CVE-2020-16128](/security/CVE-2020-16128))

Kevin Backhouse discovered that Aptdaemon incorrectly handled permission

checks. A local attacker could possibly use this issue to cause a denial of

service. ([CVE-2020-27349](/security/CVE-2020-27349))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 20.10

* [aptdaemon](https://launchpad.net/ubuntu/%2Bsource/aptdaemon)
  -
  [1.1.1+bzr982-0ubuntu34.1](https://launchpad.net/ubuntu/%2Bsource/aptdaemon/1.1.1%2Bbzr982-0ubuntu34.1)

##### Ubuntu 20.04

* [aptdaemon](https://launchpad.net/ubuntu/%2Bsource/aptdaemon)
  -
  [1.1.1+bzr982-0ubuntu32.3](https://launchpad.net/ubuntu/%2Bsource/aptdaemon/1.1.1%2Bbzr982-0ubuntu32.3)

##### Ubuntu 18.04

* [aptdaemon](https://launchpad.net/ubuntu/%2Bsource/aptdaemon)
  -
  [1.1.1+bzr982-0ubuntu19.5](https://launchpad.net/ubuntu/%2Bsource/aptdaemon/1.1.1%2Bbzr982-0ubuntu19.5)

##### Ubuntu 16.04

* [aptdaemon](https://launchpad.net/ubuntu/%2Bsource/aptdaemon)
  -
  [1.1.1+bzr982-0ubuntu14.5](https://launchpad.net/ubuntu/%2Bsource/aptdaemon/1.1.1%2Bbzr982-0ubuntu14.5)

After a standard system update you need to reboot your computer to make all

the necessary changes.

## References

* [CVE-2020-27349](/security/CVE-2020-27349)
* [CVE-2020-16128](/security/CVE-2020-16128)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from launchpad.net_8009213a_20250119_132137.html ===

[Log in / Register](https://launchpad.net/ubuntu/%2Bsource/aptdaemon/1.1.1%2Bbzr982-0ubuntu14.5/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[aptdaemon package](https://launchpad.net/ubuntu/%2Bsource/aptdaemon)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/aptdaemon)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/aptdaemon)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/aptdaemon)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/aptdaemon)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/aptdaemon)

# aptdaemon 1.1.1+bzr982-0ubuntu14.5 source package in Ubuntu

## Changelog

```
aptdaemon (1.1.1+bzr982-0ubuntu14.5) xenial-security; urgency=medium

  * SECURITY UPDATE: info disclosure via transaction properties
    (LP: [#1899513](/bugs/1899513))
    - debian/patches/CVE-2020-16128.patch: drop privileges when doing file
      checks in aptdaemon/core.py, aptdaemon/worker/aptworker.py,
      aptdaemon/utils.py.
    - CVE-2020-16128
  * SECURITY UPDATE: policykit checks are too late (LP: [#1899193](/bugs/1899193))
    - debian/patches/CVE-2020-27349.patch: check PolicyKit before
      simulating local install in aptdaemon/core.py.
    - CVE-2020-27349

 -- Marc Deslauriers <email address hidden>  Wed, 02 Dec 2020 07:44:28 -0500
```

## Upload details

Uploaded by:
[Marc Deslauriers](/~mdeslaur)
on 2020-12-02

Uploaded to:
[Xenial](/ubuntu/xenial)

Original maintainer:
[Ubuntu Developers](/~ubuntu-devel-discuss-lists)

Architectures:
all

Section:
admin

Urgency:
Medium Urgency

## [See full publishing history](%2Bpublishinghistory) Publishing

| Series | Pocket | Published | Component | Section |
| --- | --- | --- | --- | --- |
| [Xenial](/ubuntu/xenial) | updates | on 2020-12-08 | main | admin |
| [Xenial](/ubuntu/xenial) | security | on 2020-12-08 | main | admin |

## Builds

[Xenial](/ubuntu/xenial):
![[FULLYBUILT]](/@@/build-success "Successfully built")
[amd64](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/20356622)

## Downloads

| File | Size | SHA-256 Checksum |
| --- | --- | --- |
| [aptdaemon\_1.1.1+bzr982.orig.tar.gz](https://launchpad.net/ubuntu/%2Barchive/primary/%2Bsourcefiles/aptdaemon/1.1.1%2Bbzr982-0ubuntu14.5/aptdaemon_1.1.1%2Bbzr982.orig.tar.gz) | 1.2 MiB | 8729ce3163279359d2dfd674aa3a4d8af49ff6a99bfd0ef670ddb7ec50698eb6 |
| [aptdaemon\_1.1.1+bzr982-0ubuntu14.5.debian.tar.xz](https://launchpad.net/ubuntu/%2Barchive/primary/%2Bsourcefiles/aptdaemon/1.1.1%2Bbzr982-0ubuntu14.5/aptdaemon_1.1.1%2Bbzr982-0ubuntu14.5.debian.tar.xz) | 32.0 KiB | 8ccecadacb537c1a79f33a609f9d6e146ef7b2f743fadd0d135e8351af8dfdb2 |
| [aptdaemon\_1.1.1+bzr982-0ubuntu14.5.dsc](https://launchpad.net/ubuntu/%2Barchive/primary/%2Bsourcefiles/aptdaemon/1.1.1%2Bbzr982-0ubuntu14.5/aptdaemon_1.1.1%2Bbzr982-0ubuntu14.5.dsc) | 3.0 KiB | 088b1e1cc8d27e8482f03e31261e7dcdeb015e081fb6f74a1332d33669cfceba |

### Available diffs

* [diff from 1.1.1+bzr982-0ubuntu14.4 to 1.1.1+bzr982-0ubuntu14.5](http://launchpadlibrarian.net/509548289/aptdaemon_1.1.1%2Bbzr982-0ubuntu14.4_1.1.1%2Bbzr982-0ubuntu14.5.diff.gz) (2.7 KiB)

[View changes file](http://launchpadlibrarian.net/509548203/aptdaemon_1.1.1%2Bbzr982-0ubuntu14.5_source.changes)

## Binary packages built by this source

[aptdaemon](/ubuntu/xenial/%2Bpackage/aptdaemon):
transaction based package management service

Aptdaemon allows normal users to perform package management tasks, e.g.

 refreshing the cache, upgrading the system, installing or removing software

 packages.

 .

 Currently it comes with the following main features:

 .

  - Programming language independent D-Bus interface, which allows one to

    write clients in several languages

  - Runs only if required (D-Bus activation)

  - Fine grained privilege management using PolicyKit, e.g. allowing all

    desktop user to query for updates without entering a password

  - Support for media changes during installation from DVD/CDROM

  - Support for debconf (Debian's package configuration system)

  - Support for attaching a terminal to the underlying dpkg call

 .

 This package contains the aptd script and all the data files required to run

 the daemon. Moreover it contains the aptdcon script, which is a command

 line client for aptdaemon. The API is not stable yet.

[aptdaemon-data](/ubuntu/xenial/%2Bpackage/aptdaemon-data):
data files for clients

Aptdaemon is a transaction based package management daemon. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package provides common data files (e.g. icons) for aptdaemon

 clients.

[python-aptdaemon](/ubuntu/xenial/%2Bpackage/python-aptdaemon):
Python 2 module for the server and client of aptdaemon

Aptdaemon is a transaction based package management service. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package provides the Python 2 modules required to run aptdaemon

 and to implement a client. The API is not stable yet.

[python-aptdaemon.gtk3widgets](/ubuntu/xenial/%2Bpackage/python-aptdaemon.gtk3widgets):
Python 2 GTK+ 3 widgets to run an aptdaemon client

Aptdaemon is a transaction based package management daemon. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package provides the Python 2 GTK+ 3 widgets to implement a fully

 working graphical client. The widgets can be used to initiate, to

 monitor and to control a transaction. The API is not stable yet.

[python3-aptdaemon](/ubuntu/xenial/%2Bpackage/python3-aptdaemon):
Python 3 module for the server and client of aptdaemon

Aptdaemon is a transaction based package management service. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package provides the Python 3 modules required to run aptdaemon

 and to implement a client. The API is not stable yet.

[python3-aptdaemon.gtk3widgets](/ubuntu/xenial/%2Bpackage/python3-aptdaemon.gtk3widgets):
Python 3 GTK+ 3 widgets to run an aptdaemon client

Aptdaemon is a transaction based package management daemon. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package provides the Python 3 GTK+ 3 widgets to implement a fully

 working graphical client. The widgets can be used to initiate, to

 monitor and to control a transaction. The API is not stable yet.

[python3-aptdaemon.pkcompat](/ubuntu/xenial/%2Bpackage/python3-aptdaemon.pkcompat):
PackageKit compatibilty for AptDaemon

Aptdaemon is a transaction based package management daemon. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package adds a PackageKit DBus interface to AptDaemon.

[python3-aptdaemon.test](/ubuntu/xenial/%2Bpackage/python3-aptdaemon.test):
Test environment for aptdaemon clients

Aptdaemon is a transaction based package management daemon. It allows

 normal users to perform package management tasks, e.g. refreshing the

 cache, upgrading the system, installing or removing software packages.

 .

 This package provides the aptdaemon.test module and several helper

 scripts and a test repository to write unittests for aptdaemon

 clients.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))


