=== Content from wiki.debian.org_8d48714b_20250119_133343.html ===

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")

[Wiki](/FrontPage "Debian Wiki Homepage")

[Login](/LTS?action=login)

* [FrontPage](/FrontPage)
* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [LTS](/LTS)

Search:

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")
[Wiki](/FrontPage "Debian Wiki Homepage")/

* [Login](/LTS?action=login)
* Comments
* [Info](/LTS?action=info)
* [Attachments](/LTS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  ------------------------
  Load
  Save
  SlideShow

# * [LTS](/LTS)

[Translation(s)](/DebianWiki/EditorGuide#translation): [English](/LTS) - [Deutsch](/de/LTS) - [Español](/es/LTS) - [Français](/fr/LTS) - [Italiano](/it/LTS) - [한국어](/ko/LTS) - [Português](/pt/LTS) - [Português (Brasil)](/pt_BR/LTS) - [Русский](/ru/LTS)

# Debian Long Term Support

Debian Long Term Support (LTS) is a project to extend the lifetime of all Debian stable releases to (at least) 5 years. Debian LTS is not handled by the Debian Security and Release teams, but by a separate group of volunteers and companies interested in making it a success.

Thus the Debian LTS team takes over security maintenance of the various releases once the Debian Security team stops its work.

![/!\](/htdocs/debwiki/img/alert.png "/!\")

LTS ([last modified 2024-08-15 02:46:47](/LTS?action=info))

* Debian [privacy policy](https://www.debian.org/legal/privacy), Wiki [team](/Teams/DebianWiki), [bugs](https://bugs.debian.org/wiki.debian.org) and [config](https://salsa.debian.org/debian/wiki.debian.org).
* Powered by [MoinMoin](https://moinmo.in/ "This site uses the MoinMoin Wiki software.") and [Python](https://moinmo.in/Python "MoinMoin is written in Python."), with hosting provided by [Metropolitan Area Network Darmstadt](https://www.man-da.de/).



=== Content from github.com_e66e263c_20250119_114611.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkamailio%2Fkamailio%2Fcommit%2Fada3701d22b1fd579f06b4f54fa695fa988e685f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkamailio%2Fkamailio%2Fcommit%2Fada3701d22b1fd579f06b4f54fa695fa988e685f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=kamailio%2Fkamailio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kamailio](/kamailio)
/
**[kamailio](/kamailio/kamailio)**
Public

* [Notifications](/login?return_to=%2Fkamailio%2Fkamailio) You must be signed in to change notification settings
* [Fork
  966](/login?return_to=%2Fkamailio%2Fkamailio)
* [Star
   2.4k](/login?return_to=%2Fkamailio%2Fkamailio)

* [Code](/kamailio/kamailio)
* [Issues
  30](/kamailio/kamailio/issues)
* [Pull requests
  15](/kamailio/kamailio/pulls)
* [Actions](/kamailio/kamailio/actions)
* [Projects
  0](/kamailio/kamailio/projects)
* [Wiki](/kamailio/kamailio/wiki)
* [Security](/kamailio/kamailio/security)
* [Insights](/kamailio/kamailio/pulse)

Additional navigation options

* [Code](/kamailio/kamailio)
* [Issues](/kamailio/kamailio/issues)
* [Pull requests](/kamailio/kamailio/pulls)
* [Actions](/kamailio/kamailio/actions)
* [Projects](/kamailio/kamailio/projects)
* [Wiki](/kamailio/kamailio/wiki)
* [Security](/kamailio/kamailio/security)
* [Insights](/kamailio/kamailio/pulse)

## Commit

[Permalink](/kamailio/kamailio/commit/ada3701d22b1fd579f06b4f54fa695fa988e685f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

tm: do not add duplicate headers in local requests

[Browse files](/kamailio/kamailio/tree/ada3701d22b1fd579f06b4f54fa695fa988e685f)
Browse the repository at this point in the history

* Loading branch information

[![@miconda](https://avatars.githubusercontent.com/u/184809?s=40&v=4)](/miconda)

[miconda](/kamailio/kamailio/commits?author=miconda "View all commits by miconda")
committed
Oct 9, 2020

1 parent
[2648eb3](/kamailio/kamailio/commit/2648eb330b133a20f1398d59a28c53532106cad3)

commit ada3701

Showing
**1 changed file**
with
**31 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

31 changes: 31 additions & 0 deletions

31
[src/modules/tm/t\_msgbuilder.c](#diff-13910509f7d70cf104cd95fa4377fb972f86363215b86b9705c99a988da59d52 "src/modules/tm/t_msgbuilder.c")

Show comments

[View file](/kamailio/kamailio/blob/ada3701d22b1fd579f06b4f54fa695fa988e685f/src/modules/tm/t_msgbuilder.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -268,6 +268,7 @@ char \*build\_local\_reparse(tm\_cell\_t \*Trans,unsigned int branch, |
|  |  | struct hdr\_field \*reas1, \*reas\_last, \*hdr; |
|  |  | int hadded = 0; |
|  |  | sr\_cfgenv\_t \*cenv = NULL; |
|  |  | hdr\_flags\_t hdr\_flags = 0; |
|  |  |  |
|  |  | invite\_buf = Trans->uac[branch].request.buffer; |
|  |  | invite\_len = Trans->uac[branch].request.buffer\_len; |
| Expand Down  Expand Up | | @@ -361,6 +362,11 @@ char \*build\_local\_reparse(tm\_cell\_t \*Trans,unsigned int branch, |
|  |  | switch(hf\_type) { |
|  |  | case HDR\_CSEQ\_T: |
|  |  | /\* find the method name and replace it \*/ |
|  |  | if(hdr\_flags & HDR\_CSEQ\_F) { |
|  |  | LM\_DBG("duplicate CSeq header\n"); |
|  |  | goto errorhdr; |
|  |  | } |
|  |  | hdr\_flags |= HDR\_CSEQ\_F; |
|  |  | while ((s < invite\_buf\_end) |
|  |  | && ((\*s == ':') || (\*s == ' ') || (\*s == '\t') || |
|  |  | ((\*s >= '0') && (\*s <= '9'))) |
| Expand All | | @@ -381,6 +387,12 @@ char \*build\_local\_reparse(tm\_cell\_t \*Trans,unsigned int branch, |
|  |  | break; |
|  |  |  |
|  |  | case HDR\_TO\_T: |
|  |  | if(hdr\_flags & HDR\_TO\_F) { |
|  |  | LM\_DBG("duplicate To header\n"); |
|  |  | goto errorhdr; |
|  |  | } |
|  |  | hdr\_flags |= HDR\_TO\_F; |
|  |  |  |
|  |  | if (to\_len == 0) { |
|  |  | /\* there is no To tag required, just copy paste |
|  |  | \* the header \*/ |
| Expand All | | @@ -395,7 +407,25 @@ char \*build\_local\_reparse(tm\_cell\_t \*Trans,unsigned int branch, |
|  |  | break; |
|  |  |  |
|  |  | case HDR\_FROM\_T: |
|  |  | /\* copy hf \*/ |
|  |  | if(hdr\_flags & HDR\_FROM\_F) { |
|  |  | LM\_DBG("duplicate From header\n"); |
|  |  | goto errorhdr; |
|  |  | } |
|  |  | hdr\_flags |= HDR\_FROM\_F; |
|  |  | s = lw\_next\_line(s, invite\_buf\_end); |
|  |  | append\_str(d, s1, s - s1); |
|  |  | break; |
|  |  | case HDR\_CALLID\_T: |
|  |  | /\* copy hf \*/ |
|  |  | if(hdr\_flags & HDR\_CALLID\_F) { |
|  |  | LM\_DBG("duplicate Call-Id header\n"); |
|  |  | goto errorhdr; |
|  |  | } |
|  |  | hdr\_flags |= HDR\_CALLID\_F; |
|  |  | s = lw\_next\_line(s, invite\_buf\_end); |
|  |  | append\_str(d, s1, s - s1); |
|  |  | break; |
|  |  | case HDR\_ROUTE\_T: |
|  |  | case HDR\_MAXFORWARDS\_T: |
|  |  | /\* copy hf \*/ |
| Expand Down  Expand Up | | @@ -495,6 +525,7 @@ char \*build\_local\_reparse(tm\_cell\_t \*Trans,unsigned int branch, |
|  |  | /\* HDR\_EOH\_T was not found in the buffer, the message is corrupt \*/ |
|  |  | LM\_ERR("HDR\_EOH\_T was not found\n"); |
|  |  |  |
|  |  | errorhdr: |
|  |  | shm\_free(cancel\_buf); |
|  |  | error: |
|  |  | LM\_ERR("cannot build %.\*s request\n", method\_len, method); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ada3701`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkamailio%2Fkamailio%2Fcommit%2Fada3701d22b1fd579f06b4f54fa695fa988e685f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.debian.org_f90b9d7b_20250119_114614.html ===


---

[[Date Prev](msg00029.html)][[Date Next](msg00031.html)]
[[Thread Prev](msg00029.html)][[Thread Next](msg00031.html)]
[[Date Index](maillist.html#00030)]
[[Thread Index](threads.html#00030)]

# [SECURITY] [DLA 3438-1] kamailio security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3438-1] kamailio security update
* *From*: "Chris Lamb" <lamby@debian.org>
* *Date*: Tue, 30 May 2023 12:25:22 -0400
* *Message-id*: <[[🔎]](/msgid-search/168545885969.45512.17987937660728791593%40copycat) [168545885969.45512.17987937660728791593@copycat](msg00030.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3438-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                           Chris Lamb
May 30, 2023                                  <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : kamailio
Version        : 5.2.1-1+deb10u1
CVE ID         : CVE-2020-27507

It was discovered that there was a potential denial-of-service (DoS)
attack in the Kamailio SIP telephony server. This was caused by the
Kamailio server mishandling INVITE requests with duplicated fields.

For Debian 10 buster, this problem has been fixed in version
5.2.1-1+deb10u1.

We recommend that you upgrade your kamailio packages.

For the detailed security status of kamailio please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/kamailio>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEwv5L0nHBObhsUz5GHpU+J9QxHlgFAmR2DvAACgkQHpU+J9Qx
HljI7g//bsD28BbX8EWWa2Cc9H5EbM5a+4Mm2p3cSagkxM0gIqSshlUJqVlkx3fR
eMLsiU+Scxj9+Z65SiUboKr7y/Am3Bu4Fr9+1jLIJW+meJB7Cdm77TD8YwujgkHK
wIlsGsOsx8VhWJ3zKPKOWg4+Ux1N+WFKwrItFc/Zc/6kRfPqgtP9FgJFRgSpNROV
bCjxr8wA9CyBoH5mNF75kcymdR3RA0KQ28FmMLwqPXh6vKv5wBUMLQ1CR64ssxT2
IFtEIx1LMX4EmKdmO5VUEPeXmzwpZ7mCR9luSeLhtYULLH2CUEv5Fy33AGHw3y0U
Ae7sUhIHENdZEnpD1nCM6+NLAeWSJ7zXTn6AFU68uoOiB3J/QFvaksSQXh3ezGFj
ZtGLaXMbSBuxb8hDV6RDQulLBO2wk3hKzJ4QoSxImA0dK6K3FTdxqRmyevxNwj+p
8daKNE9Uum2VOQ1PjRugHbX3/OrKlX/383YQnEVKsdkSjVlSgFOOiefMifRW5JXD
P2mzWV4YIDORAOZAXvxqm/rDeCOnLtjmKVtqMhqlIn1Kxi2bHA8WFpxde4wbUwME
2YMbbGiC+uJ6V5JjrY2zL4vBQvdps/G7VcJYPCc2zAnCo0AFYEXXIirzDm6vieLL
tp2nsZ3Y86QCwxhvv5G+bGHWnT4C4AvbNQlSssFe67rYMgcPlRc=
=E+nI
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_9223a181_20250119_114613.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkamailio%2Fkamailio%2Fissues%2F2503)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkamailio%2Fkamailio%2Fissues%2F2503)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=kamailio%2Fkamailio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kamailio](/kamailio)
/
**[kamailio](/kamailio/kamailio)**
Public

* [Notifications](/login?return_to=%2Fkamailio%2Fkamailio) You must be signed in to change notification settings
* [Fork
  966](/login?return_to=%2Fkamailio%2Fkamailio)
* [Star
   2.4k](/login?return_to=%2Fkamailio%2Fkamailio)

* [Code](/kamailio/kamailio)
* [Issues
  30](/kamailio/kamailio/issues)
* [Pull requests
  15](/kamailio/kamailio/pulls)
* [Actions](/kamailio/kamailio/actions)
* [Projects
  0](/kamailio/kamailio/projects)
* [Wiki](/kamailio/kamailio/wiki)
* [Security](/kamailio/kamailio/security)
* [Insights](/kamailio/kamailio/pulse)

Additional navigation options

* [Code](/kamailio/kamailio)
* [Issues](/kamailio/kamailio/issues)
* [Pull requests](/kamailio/kamailio/pulls)
* [Actions](/kamailio/kamailio/actions)
* [Projects](/kamailio/kamailio/projects)
* [Wiki](/kamailio/kamailio/wiki)
* [Security](/kamailio/kamailio/security)
* [Insights](/kamailio/kamailio/pulse)

# Crash on qm\_debug\_check\_frag() on INVITE #2503

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Crash on qm\_debug\_check\_frag() on INVITE](#top)#2503Copy link![@rnatella](https://avatars.githubusercontent.com/u/2117196?u=1ff370f866d766789126c37a55947ed99cb13f1c&v=4&size=80)
## Description

![@rnatella](https://avatars.githubusercontent.com/u/2117196?u=1ff370f866d766789126c37a55947ed99cb13f1c&v=4&size=48)[rnatella](https://github.com/rnatella)opened [on Oct 9, 2020](https://github.com/kamailio/kamailio/issues/2503#issue-718055250)
### Description

I am experimenting with fuzzing on Kamailio SIP. A malformed INVITE (with a long tag) crashes the server, raised by qm\_debug\_check\_frag().

### Troubleshooting

The error message:

```
qm_debug_check_frag(): BUG: qm: fragm. 0x7ffff03642e8 (address 0x7ffff0364320) end overwritten (9191919191919191, 9191919191919191)! Memory allocator was called from tm: t_reply.c:2410. Fragment marked by tm: t_msgbuilder.c:327. Exec from core/mem/q_malloc.c:511.

```

Output from GDB:

```
(gdb) watch *0x7ffff0364320
Hardware watchpoint 1: *0x7ffff0364320
(gdb) run -f kamailio-basic.cfg -L src/modules -Y runtime_dir/ -n 1 -D -E
Starting program: /home/rnatella/workdir-sip/kamailio/src/kamailio -f kamailio-basic.cfg -L src/modules -Y runtime_dir/ -n 1 -D -E
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
 0(29450) INFO: <core> [core/sctp_core.c:75]: sctp_core_check_support(): SCTP API not enabled - if you want to use it, load sctp module
Listening on
             udp: 127.0.0.1 [127.0.0.1]:5060
Aliases:

WARNING: no fork mode
 0(29450) INFO: rr [./../outbound/api.h:52]: ob_load_api(): unable to import bind_ob - maybe module is not loaded
 0(29450) INFO: rr [rr_mod.c:185]: mod_init(): outbound module not available
 0(29450) INFO: <core> [main.c:2841]: main(): processes (at least): 4 - shm size: 67108864 - pkg size: 8388608
 0(29450) INFO: <core> [core/udp_server.c:154]: probe_max_receive_buffer(): SO_RCVBUF is initially 212992
 0(29450) INFO: <core> [core/udp_server.c:206]: probe_max_receive_buffer(): SO_RCVBUF is finally 425984
 0(29450) ERROR: {1 2 INVITE 1-670@127.0.0.1} <core> [core/parser/parse_rr.c:78]: do_parse_rr_body(): Failed parsing name-addr (<sip:127.0"0tttttttttttttttttttttttttttK-670-1-7)
 0(29450) ERROR: {1 2 INVITE 1-670@127.0.0.1} <core> [core/parser/parse_rr.c:140]: do_parse_rr_body(): Failed parsing rr header body [<sip:127.0"0tttttttttttttttttttttttttttK-670-1-7]
 0(29450) ERROR: {1 2 INVITE 1-670@127.0.0.1} rr [loose.c:468]: find_rem_target(): failed to parse last Route HF
 0(29450) ERROR: {1 2 INVITE 1-670@127.0.0.1} rr [loose.c:700]: after_strict(): searching for last Route URI failed

Hardware watchpoint 1: *0x7ffff0364320

Old value = <unreadable>
New value = 4932352
__memmove_sse2_unaligned_erms () at ../sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S:316
316     ../sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S: No such file or directory.
(gdb) bt
#0  __memmove_sse2_unaligned_erms () at ../sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S:316
#1  0x00007ffff602e4ff in build_local_reparse (Trans=<optimized out>, branch=<optimized out>, len=<optimized out>, method=<optimized out>,
    method_len=<optimized out>, to=<optimized out>, reason=<optimized out>) at t_msgbuilder.c:336
#2  0x00007ffff607eaff in build_ack (rpl=<optimized out>, trans=<optimized out>, branch=0, ret_len=<optimized out>) at t_reply.c:360
#3  reply_received (p_msg=<optimized out>) at t_reply.c:2398
#4  0x00000000005a0af3 in do_forward_reply (msg=0x7ffff68eed28, mode=<optimized out>) at core/forward.c:757
#5  0x0000000000688cae in receive_msg (buf=<optimized out>, len=<optimized out>, rcv_info=<optimized out>) at core/receive.c:509
#6  0x00000000004a6b39 in udp_rcv_loop () at core/udp_server.c:543
#7  0x000000000042c938 in main_loop () at main.c:1480
#8  0x000000000043c574 in main (argc=<optimized out>, argv=<optimized out>) at main.c:2863
(gdb) frame 1
#1  0x00007ffff602e4ff in build_local_reparse (Trans=<optimized out>, branch=<optimized out>, len=<optimized out>, method=<optimized out>,
    method_len=<optimized out>, to=<optimized out>, reason=<optimized out>) at t_msgbuilder.c:336
336             append_str(d, method, method_len);
(gdb) print d
$1 = 0x7ffff0364320 ""
(gdb) c
Continuing.

Hardware watchpoint 1: *0x7ffff0364320

Old value = 4932352
New value = 4932417
__memmove_sse2_unaligned_erms () at ../sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S:317
317     ../sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S: No such file or directory.
(gdb) bt
#0  __memmove_sse2_unaligned_erms () at ../sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S:317
#1  0x00007ffff602e4ff in build_local_reparse (Trans=<optimized out>, branch=<optimized out>, len=<optimized out>, method=<optimized out>,
    method_len=<optimized out>, to=<optimized out>, reason=<optimized out>) at t_msgbuilder.c:336
#2  0x00007ffff607eaff in build_ack (rpl=<optimized out>, trans=<optimized out>, branch=0, ret_len=<optimized out>) at t_reply.c:360
#3  reply_received (p_msg=<optimized out>) at t_reply.c:2398
#4  0x00000000005a0af3 in do_forward_reply (msg=0x7ffff68eed28, mode=<optimized out>) at core/forward.c:757
#5  0x0000000000688cae in receive_msg (buf=<optimized out>, len=<optimized out>, rcv_info=<optimized out>) at core/receive.c:509
#6  0x00000000004a6b39 in udp_rcv_loop () at core/udp_server.c:543
#7  0x000000000042c938 in main_loop () at main.c:1480
#8  0x000000000043c574 in main (argc=<optimized out>, argv=<optimized out>) at main.c:2863
(gdb) c
Continuing.

Hardware watchpoint 1: *0x7ffff0364320

Old value = 4932417
New value = 541803329
0x00007ffff602e504 in build_local_reparse (Trans=<optimized out>, branch=<optimized out>, len=<optimized out>, method=<optimized out>,
    method_len=<optimized out>, to=<optimized out>, reason=<optimized out>) at t_msgbuilder.c:337
337             *d = ' ';
(gdb) bt
#0  0x00007ffff602e504 in build_local_reparse (Trans=<optimized out>, branch=<optimized out>, len=<optimized out>, method=<optimized out>,
    method_len=<optimized out>, to=<optimized out>, reason=<optimized out>) at t_msgbuilder.c:337
#1  0x00007ffff607eaff in build_ack (rpl=<optimized out>, trans=<optimized out>, branch=0, ret_len=<optimized out>) at t_reply.c:360
#2  reply_received (p_msg=<optimized out>) at t_reply.c:2398
#3  0x00000000005a0af3 in do_forward_reply (msg=0x7ffff68eed28, mode=<optimized out>) at core/forward.c:757
#4  0x0000000000688cae in receive_msg (buf=<optimized out>, len=<optimized out>, rcv_info=<optimized out>) at core/receive.c:509
#5  0x00000000004a6b39 in udp_rcv_loop () at core/udp_server.c:543
#6  0x000000000042c938 in main_loop () at main.c:1480
#7  0x000000000043c574 in main (argc=<optimized out>, argv=<optimized out>) at main.c:2863
(gdb) c
Continuing.
 0(29450) CRITICAL: {2 2 INVITE 1-670@127.0.0.1} <core> [core/mem/q_malloc.c:138]: qm_debug_check_frag(): BUG: qm: fragm. 0x7ffff03642e8 (address 0x7ffff0364320) end overwritten (9191919191919191, 9191919191919191)! Memory allocator was called from tm: t_reply.c:2410. Fragment marked by tm: t_msgbuilder.c:327. Exec from core/mem/q_malloc.c:511.

Program received signal SIGSEGV, Segmentation fault.
0x000000000082f45f in qm_status (qmp=<optimized out>) at core/mem/q_malloc.c:902
902                                     f!=&(qm->free_hash[h].head); f=f->u.nxt_free, i++, j++){

```
#### Reproduction

I am running the server with a basic configuration (attached kamailio-basic.cfg), using the command:

```
./src/kamailio -f kamailio-basic.cfg -L src/modules -Y runtime_dir/ -n 1 -D -E

```

[kamailio-basic.cfg.txt](https://github.com/kamailio/kamailio/files/5354439/kamailio-basic.cfg.txt)

On the same machine, I am sending the malformed message (also attached):

```
cat sip-crash.txt | nc -4u -w1 localhost 5060

```

[sip-crash.txt](https://github.com/kamailio/kamailio/files/5354468/sip-crash.txt)

You can find more information about my fuzzing setup at: <https://github.com/rnatella/aflnet-kamailio-sip>

#### Debugging Data

See previous section

#### Log Messages

See previous section

#### SIP Traffic

See previos section

### Possible Solutions

### Additional Information

* **Kamailio Version** - output of `kamailio -v`

```
version: kamailio 5.5.0-dev2 (x86_64/linux) 6049a1-dirty
flags: USE_TCP, USE_TLS, USE_SCTP, TLS_HOOKS, USE_RAW_SOCKS, DISABLE_NAGLE, USE_MCAST, DNS_IP_HACK, SHM_MMAP, PKG_MALLOC, Q_MALLOC, F_MALLOC, TLSF_MALLOC, DBG_SR_MEMORY, DBG_QM_MALLOC, USE_FUTEX, FAST_LOCK-ADAPTIVE_WAIT, USE_DNS_CACHE, USE_DNS_FAILOVER, USE_NAPTR, USE_DST_BLACKLIST, HAVE_RESOLV_RES, TLS_PTHREAD_MUTEX_SHARED
ADAPTIVE_WAIT_LOOPS 1024, MAX_RECV_BUFFER_SIZE 262144, MAX_URI_SIZE 1024, BUF_SIZE 65535, DEFAULT PKG_SIZE 8MB
poll method support: poll, epoll_lt, epoll_et, sigio_rt, select.
id: 6049a1 -dirty
compiled on 10:12:13 Oct  9 2020 with /home/rnatella/aflnet/afl-clang-fast 6.0

```

* **Operating System**:

```
Ubuntu 18.04.2 LTS

Linux dockertest1 4.15.0-109-generic #110-Ubuntu SMP Tue Jun 23 02:39:32 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux

```
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


