=== Content from phabricator.wikimedia.org_6bc74c43_20250119_112927.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT266400)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T266400
# RandomGameUnit: Stored XSS (CVE-2020-27957)Closed, Resolved[Public](/policy/explain/PHID-TASK-nzmc2y22xz6pp3ayecxv/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/266400/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/266400/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* [Protect as security issue](/wmf/escalate-task/266400/)
* [Award Token](/token/give/PHID-TASK-nzmc2y22xz6pp3ayecxv/)
* [Flag For Later](/flag/edit/PHID-TASK-nzmc2y22xz6pp3ayecxv/)

Assigned To

|  | [ashley](/p/ashley/) |
| --- | --- |

Authored By

|  | [ashley](/p/ashley/) |
| --- | --- |
| Oct 25 2020, 10:42 AM2020-10-25 10:42:30 (UTC+0) |

Tags

* [Security](/tag/security/)
* [RandomGameUnit](/tag/randomgameunit/) [(Backlog)](/project/board/877/)
* [Vuln-XSS](/tag/vuln-xss/)
* [Social-Tools](/tag/social-tools/) [(RandomGameUnit)](/project/board/1009/)
Referenced Files

|  | [F32412979: xss.patch](/F32412979) |
| --- | --- |
| Oct 25 2020, 10:45 AM2020-10-25 10:45:07 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [ashley](/p/ashley/) |
| --- | --- |

|  | [Isarra](/p/Isarra/) |
| --- | --- |

|  | [lcawte](/p/lcawte/) |
| --- | --- |

|  | [Legoktm](/p/Legoktm/) |
| --- | --- |

# Description

Prerequisites: [social tools](https://www.mediawiki.org/wiki/Social_tools) setup (MW 1.34 with [SocialProfile](https://www.mediawiki.org/wiki/Extension%3ASocialProfile), and for this particular bug, also need [PictureGame](https://www.mediawiki.org/wiki/Extension%3APictureGame), [PollNY](https://www.mediawiki.org/wiki/Extension%3APollNY), [QuizGame](https://www.mediawiki.org/wiki/Extension%3AQuizGame) and [RandomGameUnit](https://www.mediawiki.org/wiki/Extension%3ARandomGameUnit))

1. Create a game (for example, a picture game via Special:PictureGameHome; but the bug also happens with PollNY polls and QuizGame quizzes since RandomGameUnit fails to properly escape titles/options for all three types of games)
2. Have its title contain something like <script>alert('XSS')</script>
3. Save the game to ensure that it's created (obviously!)
4. When using RandomGameUnit, whether directly via adding the parser tag to a wiki page or as a more "fixed" part of the UI (e.g. in the [Nimbus skin](https://www.mediawiki.org/wiki/Skin%3ANimbus)), note how the malicious code gets executed despite that it damn well shouldn't

This is somewhat of a continuation of the fixes done in [fde2cd7a5e9b675e6c78003f47e21bd8634271f9](/rEPGAfde2cd7a5e9b675e6c78003f47e21bd8634271f9) for PictureGame's own creation/editing form.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [[SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data](https://gerrit.wikimedia.org/r/c/636484) | [mediawiki/extensions/RandomGameUnit](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit/%2B/REL1_35) | +10 -10 |
|  | [[SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data](https://gerrit.wikimedia.org/r/c/636488) | [mediawiki/extensions/RandomGameUnit](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit) | [REL1\_34](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit/%2B/REL1_34) | +9 -9 |
|  | [[SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data](https://gerrit.wikimedia.org/r/c/636489) | [mediawiki/extensions/RandomGameUnit](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit) | [REL1\_31](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit/%2B/REL1_31) | +9 -9 |
|  | [[SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data](https://gerrit.wikimedia.org/r/c/636231) | [mediawiki/extensions/RandomGameUnit](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/RandomGameUnit/%2B/master) | +6 -6 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T266400)
# Related Objects

* Mentions

Mentioned In [rERGUb6a3dff8287d: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGUb6a3dff8287d0d6d6c2dc54706f541111374fa0f)
[rERGU47d7729a63e5: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGU47d7729a63e5256880cf07f26caba47888641826)
[rERGU2ff6abc3052d: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGU2ff6abc3052d7d416ccf51b0466b3acdd1c76521)
[T266508: PollNY: Stored XSS (CVE-2020-29003)](/T266508)
[T263810: Write and send supplementary release announcement for extensions and skins with security patches (1.31.11/1.35.1)](/T263810)
[rERGU69bcc1ae9f82: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGU69bcc1ae9f8246f59b626d72348e11bd2ddb2231) Mentioned Here [rEPGAfde2cd7a5e9b: [SECURITY] Fix some obvious XSS holes](/rEPGAfde2cd7a5e9b675e6c78003f47e21bd8634271f9)
### Event Timeline

[ashley](/p/ashley/) created this task.[Oct 25 2020, 10:42 AM2020-10-25 10:42:30 (UTC+0)](#6576502)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/3954434/)[Oct 25 2020, 10:42 AM2020-10-25 10:42:32 (UTC+0)](#6576513)[ashley](/p/ashley/) claimed this task.[Oct 25 2020, 10:43 AM2020-10-25 10:43:19 (UTC+0)](#6576514)[ashley](/p/ashley/) added projects: [RandomGameUnit](/tag/randomgameunit/), [Vuln-XSS](/tag/vuln-xss/).Restricted Application added a project: [Social-Tools](/tag/social-tools/).  · [View Herald Transcript](/herald/transcript/3954435/)[Oct 25 2020, 10:43 AM2020-10-25 10:43:20 (UTC+0)](#6576516)[ashley](/p/ashley/) added a comment.[Oct 25 2020, 10:45 AM2020-10-25 10:45:07 (UTC+0)](#6576517)Comment Actions

xss.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/iae4mrow2daomcmtfqnn/PHID-FILE-g7bvfccfwbnv7nsqhrxa/xss.patch)

Proposed and tested patch which adds relevant, missing htmlspecialchars() calls to all three callback functions to ensure that whatever is stored in the DB is properly sanitized before being sent back.

[ashley](/p/ashley/) moved this task from [Backlog](/project/board/1009/) to [RandomGameUnit](/project/board/1009/) on the [Social-Tools](/tag/social-tools/) board.[Oct 25 2020, 10:45 AM2020-10-25 10:45:34 (UTC+0)](#6576528)[ashley](/p/ashley/) mentioned this in [rERGU69bcc1ae9f82: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGU69bcc1ae9f8246f59b626d72348e11bd2ddb2231).[Oct 26 2020, 4:21 AM2020-10-26 04:21:20 (UTC+0)](#6577128)[ashley](/p/ashley/) closed this task as Resolved.[Oct 26 2020, 4:23 AM2020-10-26 04:23:00 (UTC+0)](#6577129)[ashley](/p/ashley/) added a subscriber: [Legoktm](/p/Legoktm/).Comment Actions

A slightly modified patch, with input from [@Legoktm](/p/Legoktm/), was submitted and merged as [69bcc1ae9f8246f59b626d72348e11bd2ddb2231](https://gerrit.wikimedia.org/g/mediawiki/extensions/RandomGameUnit/%2B/69bcc1ae9f8246f59b626d72348e11bd2ddb2231), which fixes this issue.

[Legoktm](/p/Legoktm/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-b2gkxyvweeyimq5/)" to "Public (No Login Required)".[Oct 26 2020, 4:31 AM2020-10-26 04:31:59 (UTC+0)](#6577135)[Legoktm](/p/Legoktm/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-xduqlwy75kodtlm/)" to "All Users".[Reedy](/p/Reedy/) removed a project: [Security-Team](/tag/security-team/).[Oct 26 2020, 4:35 AM2020-10-26 04:35:17 (UTC+0)](#6577137)[sbassett](/p/sbassett/) mentioned this in [T263810: Write and send supplementary release announcement for extensions and skins with security patches (1.31.11/1.35.1)](/T263810).[Oct 26 2020, 5:05 PM2020-10-26 17:05:36 (UTC+0)](#6579126)[gerritbot](/p/gerritbot/) added a comment.[Oct 26 2020, 7:38 PM2020-10-26 19:38:49 (UTC+0)](#6579833)Comment Actions

Change 636484 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/RandomGameUnit@REL1\_35] [SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data

<https://gerrit.wikimedia.org/r/636484>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Oct 26 2020, 7:38 PM2020-10-26 19:38:49 (UTC+0)](#6579834)[gerritbot](/p/gerritbot/) added a comment.[Oct 26 2020, 7:48 PM2020-10-26 19:48:51 (UTC+0)](#6579863)Comment Actions

Change 636488 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/RandomGameUnit@REL1\_34] [SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data

<https://gerrit.wikimedia.org/r/636488>

[gerritbot](/p/gerritbot/) added a comment.[Oct 26 2020, 7:53 PM2020-10-26 19:53:51 (UTC+0)](#6579871)Comment Actions

Change 636489 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/RandomGameUnit@REL1\_31] [SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data

<https://gerrit.wikimedia.org/r/636489>

[ashley](/p/ashley/) mentioned this in [T266508: PollNY: Stored XSS (CVE-2020-29003)](/T266508).[Oct 26 2020, 8:43 PM2020-10-26 20:43:57 (UTC+0)](#6580023)[sbassett](/p/sbassett/) renamed this task from RandomGameUnit: Stored XSS to RandomGameUnit: Stored XSS (CVE-2020-27957).[Oct 28 2020, 7:35 PM2020-10-28 19:35:11 (UTC+0)](#6586051)[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2020, 7:39 PM2020-10-28 19:39:22 (UTC+0)](#6586057)Comment Actions

Change 636489 **merged** by jenkins-bot:

[mediawiki/extensions/RandomGameUnit@REL1\_31] [SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data

<https://gerrit.wikimedia.org/r/636489>

[sbassett](/p/sbassett/) mentioned this in [rERGU2ff6abc3052d: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGU2ff6abc3052d7d416ccf51b0466b3acdd1c76521).[Oct 28 2020, 7:43 PM2020-10-28 19:43:47 (UTC+0)](#6586071)[gerritbot](/p/gerritbot/) added a comment.[Dec 22 2020, 9:36 PM2020-12-22 21:36:40 (UTC+0)](#6709200)Comment Actions

Change 636488 **merged** by Umherirrender:

[mediawiki/extensions/RandomGameUnit@REL1\_34] [SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data

<https://gerrit.wikimedia.org/r/636488>

[gerritbot](/p/gerritbot/) added a comment.[Dec 22 2020, 9:39 PM2020-12-22 21:39:33 (UTC+0)](#6709205)Comment Actions

Change 636484 **merged** by Umherirrender:

[mediawiki/extensions/RandomGameUnit@REL1\_35] [SECURITY] Run stored, user-generated input from DB through htmlspecialchars() to avoid stored XSS originating from PictureGame/PollNY/QuizGame data

<https://gerrit.wikimedia.org/r/636484>

[sbassett](/p/sbassett/) mentioned this in [rERGU47d7729a63e5: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGU47d7729a63e5256880cf07f26caba47888641826).[Dec 22 2020, 9:54 PM2020-12-22 21:54:46 (UTC+0)](#6709243)[sbassett](/p/sbassett/) mentioned this in [rERGUb6a3dff8287d: [SECURITY] Run stored, user-generated input from DB through htmlspecialchars()…](/rERGUb6a3dff8287d0d6d6c2dc54706f541111374fa0f).[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Dec 22 2020, 10:10 PM2020-12-22 22:10:44 (UTC+0)](#6709311)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from gerrit.wikimedia.org_bf8345ae_20250119_112920.html ===




=== Content from phabricator.wikimedia.org_ddce3aaf_20250119_132039.html ===
[HomePhabricator](/)

* SearchConfigure Global Search
 [Auth](/auth/)  Login

Click the *MediaWiki* button below to connect your [Wikimedia unified account](https://meta.wikimedia.org/wiki/Help%3AUnified_login). Alternatively, click the *Wikitech Account (LDAP)* button to connect your [Developer account](https://www.mediawiki.org/wiki/Developer_account) credentials.

In case of doubt, [check the Phabricator Help](https://www.mediawiki.org/wiki/Phabricator/Help#Creating_your_account).

Log In or RegisterMediaWikiDeveloper Account Log InLDAP Account (IDP)
# Log In or Register with LDAP

LDAP UsernameLDAP PasswordLog In or RegisterTrouble logging in? [Send a login link to your email address.](/login/email/)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
