## Analysis of CVE-2020-4274

Based on the provided documents, here's a breakdown of the vulnerability:

**Root Cause:**
The vulnerability stems from an authorization bypass in the IBM QRadar Forensics web application. The application uses a cookie named `QRIF` to skip a permission check for accessing the Forensics application. If a user provides the `QRIF` cookie with the same value as their session cookie (`SEC`), the permission check that verifies if the user has the necessary access rights is bypassed.

**Weaknesses/Vulnerabilities Present:**

*   **Authorization Bypass:** The primary vulnerability is the ability for any authenticated user, regardless of their assigned permissions, to access the QRadar Forensics web application.
*   **Insufficient Permission Checks:** The application relies on the presence of a specific cookie (`QRIF`) with a matching value to a session token to bypass the permission check, instead of properly verifying user roles/permissions.

**Impact of Exploitation:**

*   **Unauthorized Access:** An attacker can gain access to the QRadar Forensics web application, which they normally would not have permissions to use.
*   **Potential Data Exposure/Manipulation:** Unauthorized access to forensics data could expose sensitive information and allow manipulation of evidence.

**Attack Vectors:**

*   **Web Interface:** The attack vector is through the web application interface of QRadar Forensics.
*   **Cookie Manipulation:** The attacker needs to set the `QRIF` cookie in their browser with a value equal to the session cookie value.

**Required Attacker Capabilities/Position:**

*   **Authenticated User:** The attacker must be an authenticated user with access to the QRadar system.
*   **Web Browser Access:** The attacker needs a web browser to send the malicious cookie.
*   **Knowledge of Session Cookie:** The attacker needs to have knowledge of their current `SEC` session cookie.
*   **No specific user roles or permissions:** The attacker does not need special permissions, only a valid session cookie and the ability to add the malicious cookie.

**Technical Details:**

The vulnerability lies in the `LoginCurrentUser()` method within the `/opt/ibm/forensics/html/DejaVu/qradar_helper.php` file:
```php
public function LoginCurrentUser ($remember, &$errorInfo)
{
[...]
	if(isset($_COOKIE['QRIF']))
	{
		//if the current cookie is the same as the session token that means user hasn't changed
		//just update the expiry time
		if ($_COOKIE['QRIF'] === $this->session_token)
		{
			//if cookie is available that means it hasn't expired yet so we need to update it's expiry time
			//if cookie expiry time is set to 0 (expire with browser) then we don't update it
			if($cookieExpiryTime > 0)
			{
				unset($_COOKIE['QRIF']);
				setcookie("QRIF", $this->session_token, $cookieExpiryTime, "/", $_SERVER['HTTP_HOST'], true, true);
			}
			return true;
		}
		else
		{
			unset($_COOKIE['QRIF']);
		}
	}
	//first time through, login the user and set the cookie
	$loginSuccess = $this->LoginUser($this->session_token, $errorInfo);
	if ($loginSuccess && $remember) {
		setcookie("QRIF", $this->session_token, $cookieExpiryTime, "/", $_SERVER['HTTP_HOST'], true, true);
	}
	return $loginSuccess;
}
```
This code snippet shows that if the `QRIF` cookie is present and matches the session token, the `LoginUser()` method, which performs the Forensics permission check, is skipped, thereby bypassing the access control.

**Affected versions:**

*   IBM QRadar 7.3.0 to 7.3.3 Patch 2
*   QRadar Community Edition version 7.3.1.6 (7.3.1 Build 20180723171558)

**Fixes:**

*   QRadar / QRM / QVM / QNI 7.4.0 GA
*   QRadar / QRM / QVM / QRIF / QNI 7.3.3 Patch 3
*   QRadar / QRM / QVM / QRIF / QNI 7.3.2 Patch 7
*   QRadar Incident Forensics 7.4.0

This information provides a more detailed view of the vulnerability compared to the basic CVE description.