=== Content from github.com_6a8f8c50_20250119_112846.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FwolfSSL%2Fwolfssl%2Freleases%2Ftag%2Fv4.4.0-stable)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FwolfSSL%2Fwolfssl%2Freleases%2Ftag%2Fv4.4.0-stable)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=wolfSSL%2Fwolfssl)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wolfSSL](/wolfSSL)
/
**[wolfssl](/wolfSSL/wolfssl)**
Public

* [Notifications](/login?return_to=%2FwolfSSL%2Fwolfssl) You must be signed in to change notification settings
* [Fork
  837](/login?return_to=%2FwolfSSL%2Fwolfssl)
* [Star
   2.4k](/login?return_to=%2FwolfSSL%2Fwolfssl)

* [Code](/wolfSSL/wolfssl/tree/v4.4.0-stable)
* [Issues
  91](/wolfSSL/wolfssl/issues)
* [Pull requests
  55](/wolfSSL/wolfssl/pulls)
* [Actions](/wolfSSL/wolfssl/actions)
* [Projects
  0](/wolfSSL/wolfssl/projects)
* [Wiki](/wolfSSL/wolfssl/wiki)
* [Security](/wolfSSL/wolfssl/security)
* [Insights](/wolfSSL/wolfssl/pulse)

Additional navigation options

* [Code](/wolfSSL/wolfssl/tree/v4.4.0-stable)
* [Issues](/wolfSSL/wolfssl/issues)
* [Pull requests](/wolfSSL/wolfssl/pulls)
* [Actions](/wolfSSL/wolfssl/actions)
* [Projects](/wolfSSL/wolfssl/projects)
* [Wiki](/wolfSSL/wolfssl/wiki)
* [Security](/wolfSSL/wolfssl/security)
* [Insights](/wolfSSL/wolfssl/pulse)

1. [Releases](/wolfSSL/wolfssl/releases)
2. [v4.4.0-stable](/wolfSSL/wolfssl/releases/tag/v4.4.0-stable)

# wolfSSL Release 4.4.0 (04/22/2020)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/wolfSSL/wolfssl/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v4.4.0-stable)

 Loading

[View all tags](/wolfSSL/wolfssl/tags)

![@ejohnstown](https://avatars.githubusercontent.com/u/896278?s=40&v=4)
[ejohnstown](/ejohnstown)
released this
22 Apr 18:23

·
[13068 commits](/wolfSSL/wolfssl/compare/v4.4.0-stable...master)
to master
since this release

[v4.4.0-stable](/wolfSSL/wolfssl/tree/v4.4.0-stable)

[`e116c89`](/wolfSSL/wolfssl/commit/e116c89a58af750421d82ece13f80516d2bde02e)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# wolfSSL Release 4.4.0 (04/22/2020)

If you have questions about this release, feel free to contact us on our

info@ address.

Release 4.4.0 of wolfSSL embedded TLS has bug fixes and new features including:

## New Feature Additions

* Hexagon support.
* DSP builds to offload ECC verify operations.
* Certificate Manager callback support.
* New APIs for running updates to ChaCha20/Poly1305 AEAD.
* Support for use with Apache.
* Add support for IBM s390x.
* PKCS8 support for ED25519.
* OpenVPN support.
* Add P384 curve support to SP.
* Add BIO and EVP API.
* Add AES-OFB mode.
* Add AES-CFB mode.
* Add Curve448, X448, and Ed448.
* Add Renesas Synergy S7G2 build and hardware acceleration.

## Fixes

* Fix for RSA public encrypt / private sign with RSA key sizes over 2048-bit.
* Correct misspellings.
* Secure renegotiation fix.
* Fix memory leak when using ATECC and non-SECP256R1 curves for sign, verify,

  or shared secret.
* Fix for K64 MMCAU with `WOLFSSL_SMALL_STACK_CACHE`.
* Fix the RSA verify only build.
* Fix in SP C implementation for small stack.
* Fix using the auth key id extension is set, hash might not be present.
* Fix when flattening certificate structure to include the subject alt names.
* Fixes for building with ECC sign/verify only.
* Fix for ECC and no cache resistance.
* Fix memory leak in DSA.
* Fix build on minGW.
* Fix `PemToDer()` call in `ProcessBuffer()` to set more than ECC.
* Fix for using RSA without SHA-512.
* Add some close tags to the echoserver HTTP example output.
* Miscellaneous fixes and updates for static analysis reports.
* Fixes for time structure support.
* Fixes for VxWorks support.
* Fixes for Async crypto support.
* Fix cache resist compile to work with SP C code.
* Fixes for Curve25519 x64 asm.
* Fix for SP x64 div.
* Fix for DTLS edge case where CCS and Finished come out of order and the

  retransmit pool gets flushed.
* Fix for infinite loop in SHA-1 with small inputs. Thanks to Peter W.
* Fix for FIPS Hmac where `wc_HmacInit()` isn't used. `wc_HmacSetKey()` needs

  to initialize the Hmac structure. Type is set to NONE, and checked against

  NONE, not 0.
* Fixes for SP RSA private operations.
* Fixes for Xilinx SDK and Zynq UltraScale+ MPSoC
* Fix leak when building with HAVE\_AESGCM and NO\_AES\_DECRYPT. Thanks G.G.
* Fixes for building ECC without ASN.
* Fix for async TLSv1.3 issues.
* Fix `wc_KeyPemToDer()` with PKCS1 and empty key.
* Omit `-fomit-frame-pointer` from CFLAGS in configure.ac.

## Improvements/Optimizations

* Qt 5.12 and 5.13 support.
* Added more digest types to Cryptocell RSA sign/verify.
* Some memory usage improvements.
* Speed improvements for mp\_rand.
* Improvements to CRL and OCSP support.
* Refactor Poly1305 AEAD/MAC to reduce duplicate code.
* Add blinding to RSA key gen.
* Improvements to blinding.
* Improvement and expansion of OpenSSL Compatibility Layer.
* Improvements to ChaCha20.
* Improvements to X.509 processing.
* Improvements to ECC support.
* Improvement in detecting 64-bit support.
* Refactor to combine duplicate ECC parameter parsing code.
* Improve keyFormat to be set by algId and let later key parsing produce fail.
* Add test cases for 3072-bit and 4096-bit RSA keys.
* Improve signature wrapper and DH test cases.
* Improvements to the configure.ac script.
* Added constant time RSA q modinv p.
* Improve performance of SP Intel 64-bit asm.
* Added a few more functions to the ABI list.
* Improve TLS bidirectional shutdown behavior.
* OpenSSH 8.1 support.
* Improve performance of RSA/DH operations on x64.
* Add support for PKCS7/CMS Enveloped data with fragmented encrypted content.
* Example linker description for FIPS builds to enforce object ordering.
* C# wrapper improvements. Added TLS client example and TLSv1.3 methods.
* Allow setting MTU in DTLS.
* Improve PKCS12 create for outputting encrypted bundles.
* Constant time EC map to affine for private operations.
* Improve performance of RSA public key ops with TFM.
* Smaller table version of AES encrypt/decrypt.
* Support IAR with position independent code (ROPI).
* Improve speed of AArch64 assembly.
* Support AES-CTR with AES-NI.
* Support AES-CTR on esp32.
* Add a no malloc option for small SP math.

## This release of wolfSSL includes fixes for 2 security vulnerabilities.

* For fast math, use a constant time modular inverse when mapping to affine

  when operation involves a private key - keygen, calc shared secret, sign.

  Thank you to Alejandro Cabrera Aldaya, Cesar Pereida García and

  Billy Bob Brumley from the Network and Information Security Group (NISEC)

  at Tampere University for the report.
* Change constant time and cache resistant ECC mulmod. Ensure points being

  operated on change to make constant time. Thank you to Pietro Borrello at

  Sapienza University of Rome.

For additional vulnerability information visit the vulnerability page at

<https://www.wolfssl.com/docs/security-vulnerabilities/>

See INSTALL file for build instructions.

More info can be found on-line at <https://wolfssl.com/wolfSSL/Docs.html>

 Assets
4

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_95c2cf14_20250119_112845.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FwolfSSL%2Fwolfssl%2Fcommit%2F1de07da61f0c8e9926dcbd68119f73230dae283f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FwolfSSL%2Fwolfssl%2Fcommit%2F1de07da61f0c8e9926dcbd68119f73230dae283f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=wolfSSL%2Fwolfssl)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wolfSSL](/wolfSSL)
/
**[wolfssl](/wolfSSL/wolfssl)**
Public

* [Notifications](/login?return_to=%2FwolfSSL%2Fwolfssl) You must be signed in to change notification settings
* [Fork
  837](/login?return_to=%2FwolfSSL%2Fwolfssl)
* [Star
   2.4k](/login?return_to=%2FwolfSSL%2Fwolfssl)

* [Code](/wolfSSL/wolfssl)
* [Issues
  91](/wolfSSL/wolfssl/issues)
* [Pull requests
  55](/wolfSSL/wolfssl/pulls)
* [Actions](/wolfSSL/wolfssl/actions)
* [Projects
  0](/wolfSSL/wolfssl/projects)
* [Wiki](/wolfSSL/wolfssl/wiki)
* [Security](/wolfSSL/wolfssl/security)
* [Insights](/wolfSSL/wolfssl/pulse)

Additional navigation options

* [Code](/wolfSSL/wolfssl)
* [Issues](/wolfSSL/wolfssl/issues)
* [Pull requests](/wolfSSL/wolfssl/pulls)
* [Actions](/wolfSSL/wolfssl/actions)
* [Projects](/wolfSSL/wolfssl/projects)
* [Wiki](/wolfSSL/wolfssl/wiki)
* [Security](/wolfSSL/wolfssl/security)
* [Insights](/wolfSSL/wolfssl/pulse)

## Commit

[Permalink](/wolfSSL/wolfssl/commit/1de07da61f0c8e9926dcbd68119f73230dae283f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Constant time EC map to affine for private operations

[Browse files](/wolfSSL/wolfssl/tree/1de07da61f0c8e9926dcbd68119f73230dae283f)
Browse the repository at this point in the history

```
For fast math, use a constant time modular inverse when mapping to
affine when operation involves a private key - key gen, calc shared
secret, sign.
```

* Loading branch information

[![@SparkiDev](https://avatars.githubusercontent.com/u/17982558?s=40&v=4)](/SparkiDev)

[SparkiDev](/wolfSSL/wolfssl/commits?author=SparkiDev "View all commits by SparkiDev")
committed
Mar 19, 2020

1 parent
[eb6f44e](/wolfSSL/wolfssl/commit/eb6f44e491969bce491971a0be197823d8e5d542)

commit 1de07da

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**124 additions**
and
**8 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* wolfcrypt/src

  + wolfcrypt/src/ecc.c
    [ecc.c](#diff-2d763a3496b29a2ab95941d5809670a4a13de8fa3a00e238170019fc2b40d5b7)
  + wolfcrypt/src/tfm.c
    [tfm.c](#diff-0df873ee2fbc4be2c70560fde38c8ee4e121486259378e22e20d3080e88be750)
* wolfssl/wolfcrypt

  + wolfssl/wolfcrypt/ecc.h
    [ecc.h](#diff-c58a9784ce75fd0f7ba04a288fe44156839d149e6c844b5b9c142dc7ae508de1)
  + wolfssl/wolfcrypt/tfm.h
    [tfm.h](#diff-4e0c1924cc15b9bc0467ce5740a3b05270076c1b7fcacf6d0f8be0d8223bbfb3)

## There are no files selected for viewing

54 changes: 46 additions & 8 deletions

54
[wolfcrypt/src/ecc.c](#diff-2d763a3496b29a2ab95941d5809670a4a13de8fa3a00e238170019fc2b40d5b7 "wolfcrypt/src/ecc.c")

Show comments

[View file](/wolfSSL/wolfssl/blob/1de07da61f0c8e9926dcbd68119f73230dae283f/wolfcrypt/src/ecc.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2285,9 +2285,10 @@ int ecc\_projective\_dbl\_point(ecc\_point \*P, ecc\_point \*R, mp\_int\* a, |
|  |  | P [in/out] The point to map |
|  |  | modulus The modulus of the field the ECC curve is in |
|  |  | mp The "b" value from montgomery\_setup() |
|  |  | ct Operation should be constant time. |
|  |  | return MP\_OKAY on success |
|  |  | \*/ |
|  |  | int ecc\_map(ecc\_point\* P, mp\_int\* modulus, mp\_digit mp) |
|  |  | int ecc\_map\_ex(ecc\_point\* P, mp\_int\* modulus, mp\_digit mp, int ct) |
|  |  | { |
|  |  | #ifndef WOLFSSL\_SP\_MATH |
|  |  | #ifdef WOLFSSL\_SMALL\_STACK |
| Expand All | | @@ -2307,6 +2308,8 @@ int ecc\_map(ecc\_point\* P, mp\_int\* modulus, mp\_digit mp) |
|  |  | mp\_int \*x, \*y, \*z; |
|  |  | int err; |
|  |  |  |
|  |  | (void)ct; |
|  |  |  |
|  |  | if (P == NULL || modulus == NULL) |
|  |  | return ECC\_BAD\_ARG\_E; |
|  |  |  |
| Expand Down  Expand Up | | @@ -2402,12 +2405,23 @@ int ecc\_map(ecc\_point\* P, mp\_int\* modulus, mp\_digit mp) |
|  |  | z = P->z; |
|  |  | #endif |
|  |  |  |
|  |  | /\* first map z back to normal \*/ |
|  |  | err = mp\_montgomery\_reduce(z, modulus, mp); |
|  |  |  |
|  |  | /\* get 1/z \*/ |
|  |  | if (err == MP\_OKAY) |
|  |  | err = mp\_invmod(z, modulus, t1); |
|  |  | if (err == MP\_OKAY) { |
|  |  | #if defined(ECC\_TIMING\_RESISTANT) && defined(USE\_FAST\_MATH) |
|  |  | if (ct) { |
|  |  | err = mp\_invmod\_mont\_ct(z, modulus, t1, mp); |
|  |  | if (err == MP\_OKAY) |
|  |  | err = mp\_montgomery\_reduce(t1, modulus, mp); |
|  |  | } |
|  |  | else |
|  |  | #endif |
|  |  | { |
|  |  | /\* first map z back to normal \*/ |
|  |  | err = mp\_montgomery\_reduce(z, modulus, mp); |
|  |  | if (err == MP\_OKAY) |
|  |  | err = mp\_invmod(z, modulus, t1); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* get 1/z^2 and 1/z^3 \*/ |
|  |  | if (err == MP\_OKAY) |
| Expand Down  Expand Up | | @@ -2484,6 +2498,10 @@ int ecc\_map(ecc\_point\* P, mp\_int\* modulus, mp\_digit mp) |
|  |  | #endif |
|  |  | } |
|  |  |  |
|  |  | int ecc\_map(ecc\_point\* P, mp\_int\* modulus, mp\_digit mp) |
|  |  | { |
|  |  | return ecc\_map\_ex(P, modulus, mp, 0); |
|  |  | } |
|  |  | #endif /\* !WOLFSSL\_SP\_MATH || WOLFSSL\_PUBLIC\_ECC\_ADD\_DBL \*/ |
|  |  |  |
|  |  | #if !defined(FREESCALE\_LTC\_ECC) && !defined(WOLFSSL\_STM32\_PKA) |
| Expand Down  Expand Up | | @@ -3639,6 +3657,8 @@ static int wc\_ecc\_shared\_secret\_gen\_sync(ecc\_key\* private\_key, ecc\_point\* point, |
|  |  | } |
|  |  | #else |
|  |  | { |
|  |  | mp\_digit mp = 0; |
|  |  |  |
|  |  | /\* make new point \*/ |
|  |  | result = wc\_ecc\_new\_point\_h(private\_key->heap); |
|  |  | if (result == NULL) { |
| Expand All | | @@ -3649,8 +3669,16 @@ static int wc\_ecc\_shared\_secret\_gen\_sync(ecc\_key\* private\_key, ecc\_point\* point, |
|  |  | return MEMORY\_E; |
|  |  | } |
|  |  |  |
|  |  | err = wc\_ecc\_mulmod\_ex(k, point, result, curve->Af, curve->prime, 1, |
|  |  | /\* Map in a separate call as this should be constant time \*/ |
|  |  | err = wc\_ecc\_mulmod\_ex(k, point, result, curve->Af, curve->prime, 0, |
|  |  | private\_key->heap); |
|  |  | if (err == MP\_OKAY) { |
|  |  | err = mp\_montgomery\_setup(curve->prime, &mp); |
|  |  | } |
|  |  | if (err == MP\_OKAY) { |
|  |  | /\* Use constant time map if compiled in \*/ |
|  |  | err = ecc\_map\_ex(result, curve->prime, mp, 1); |
|  |  | } |
|  |  | if (err == MP\_OKAY) { |
|  |  | x = mp\_unsigned\_bin\_size(curve->prime); |
|  |  | if (\*outlen < x || (int)x < mp\_unsigned\_bin\_size(result->x)) { |
| Expand Down  Expand Up | | @@ -4008,6 +4036,8 @@ static int wc\_ecc\_make\_pub\_ex(ecc\_key\* key, ecc\_curve\_spec\* curveIn, |
|  |  | err = WC\_KEY\_SIZE\_E; |
|  |  | #else |
|  |  | { |
|  |  | mp\_digit mp; |
|  |  |  |
|  |  | if (err == MP\_OKAY) { |
|  |  | base = wc\_ecc\_new\_point\_h(key->heap); |
|  |  | if (base == NULL) |
| Expand All | | @@ -4023,12 +4053,20 @@ static int wc\_ecc\_make\_pub\_ex(ecc\_key\* key, ecc\_curve\_spec\* curveIn, |
|  |  |  |
|  |  | /\* make the public key \*/ |
|  |  | if (err == MP\_OKAY) { |
|  |  | /\* Map in a separate call as this should be constant time \*/ |
|  |  | err = wc\_ecc\_mulmod\_ex(&key->k, base, pub, curve->Af, curve->prime, |
|  |  | 1, key->heap); |
|  |  | 0, key->heap); |
|  |  | if (err == MP\_MEM) { |
|  |  | err = MEMORY\_E; |
|  |  | } |
|  |  | } |
|  |  | if (err == MP\_OKAY) { |
|  |  | err = mp\_montgomery\_setup(curve->prime, &mp); |
|  |  | } |
|  |  | if (err == MP\_OKAY) { |
|  |  | /\* Use constant time map if compiled in \*/ |
|  |  | err = ecc\_map\_ex(pub, curve->prime, mp, 1); |
|  |  | } |
|  |  |  |
|  |  | wc\_ecc\_del\_point\_h(base, key->heap); |
|  |  | } |
| Expand Down | |  |

75 changes: 75 additions & 0 deletions

75
[wolfcrypt/src/tfm.c](#diff-0df873ee2fbc4be2c70560fde38c8ee4e121486259378e22e20d3080e88be750 "wolfcrypt/src/tfm.c")

Show comments

[View file](/wolfSSL/wolfssl/blob/1de07da61f0c8e9926dcbd68119f73230dae283f/wolfcrypt/src/tfm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1160,6 +1160,75 @@ int fp\_invmod(fp\_int \*a, fp\_int \*b, fp\_int \*c) |
|  |  | return FP\_OKAY; |
|  |  | } |
|  |  |  |
|  |  | #define CT\_INV\_MOD\_PRE\_CNT 8 |
|  |  |  |
|  |  | /\* modulus (b) must be greater than 2 and a prime \*/ |
|  |  | int fp\_invmod\_mont\_ct(fp\_int \*a, fp\_int \*b, fp\_int \*c, fp\_digit mp) |
|  |  | { |
|  |  | int i, j; |
|  |  | #ifndef WOLFSSL\_SMALL\_STACK |
|  |  | fp\_int t[1], e[1]; |
|  |  | fp\_int pre[CT\_INV\_MOD\_PRE\_CNT]; |
|  |  | #else |
|  |  | fp\_int\* t; |
|  |  | fp\_int\* e; |
|  |  | fp\_int\* pre; |
|  |  | #endif |
|  |  |  |
|  |  | #ifdef WOLFSSL\_SMALL\_STACK |
|  |  | t = (fp\_int\*)XMALLOC(sizeof(fp\_int) \* (2 + CT\_INV\_MOD\_PRE\_CNT), NULL, |
|  |  | DYNAMIC\_TYPE\_BIGINT); |
|  |  | if (t == NULL) |
|  |  | return FP\_MEM; |
|  |  | e = t + 1; |
|  |  | pre = t + 2; |
|  |  | #endif |
|  |  |  |
|  |  | fp\_init(t); |
|  |  | fp\_init(e); |
|  |  |  |
|  |  | fp\_init(&pre[0]); |
|  |  | fp\_copy(a, &pre[0]); |
|  |  | for (i = 1; i < CT\_INV\_MOD\_PRE\_CNT; i++) { |
|  |  | fp\_init(&pre[i]); |
|  |  | fp\_sqr(&pre[i-1], &pre[i]); |
|  |  | fp\_montgomery\_reduce(&pre[i], b, mp); |
|  |  | fp\_mul(&pre[i], a, &pre[i]); |
|  |  | fp\_montgomery\_reduce(&pre[i], b, mp); |
|  |  | } |
|  |  |  |
|  |  | fp\_sub\_d(b, 2, e); |
|  |  | /\* Highest bit is always set. \*/ |
|  |  | for (i = fp\_count\_bits(e)-2, j = 1; i >= 0; i--, j++) { |
|  |  | if (!fp\_is\_bit\_set(e, i) || j == CT\_INV\_MOD\_PRE\_CNT) |
|  |  | break; |
|  |  | } |
|  |  | fp\_copy(&pre[j-1], t); |
|  |  | for (j = 0; i >= 0; i--) { |
|  |  | int set = fp\_is\_bit\_set(e, i); |
|  |  |  |
|  |  | if ((j == CT\_INV\_MOD\_PRE\_CNT) || (!set && j > 0)) { |
|  |  | fp\_mul(t, &pre[j-1], t); |
|  |  | fp\_montgomery\_reduce(t, b, mp); |
|  |  | j = 0; |
|  |  | } |
|  |  | fp\_sqr(t, t); |
|  |  | fp\_montgomery\_reduce(t, b, mp); |
|  |  | j += set; |
|  |  | } |
|  |  | if (j > 0) { |
|  |  | fp\_mul(t, &pre[j-1], c); |
|  |  | fp\_montgomery\_reduce(c, b, mp); |
|  |  | } |
|  |  | else |
|  |  | fp\_copy(t, c); |
|  |  |  |
|  |  | #ifdef WOLFSSL\_SMALL\_STACK |
|  |  | XFREE(t, NULL, DYNAMIC\_TYPE\_BIGINT); |
|  |  | #endif |
|  |  | return FP\_OKAY; |
|  |  | } |
|  |  |  |
|  |  | /\* d = a \* b (mod c) \*/ |
|  |  | int fp\_mulmod(fp\_int \*a, fp\_int \*b, fp\_int \*c, fp\_int \*d) |
|  |  | { |
| Expand Down  Expand Up | | @@ -3545,6 +3614,12 @@ int mp\_invmod (mp\_int \* a, mp\_int \* b, mp\_int \* c) |
|  |  | return fp\_invmod(a, b, c); |
|  |  | } |
|  |  |  |
|  |  | /\* hac 14.61, pp608 \*/ |
|  |  | int mp\_invmod\_mont\_ct (mp\_int \* a, mp\_int \* b, mp\_int \* c, mp\_digit mp) |
|  |  | { |
|  |  | return fp\_invmod\_mont\_ct(a, b, c, mp); |
|  |  | } |
|  |  |  |
|  |  | /\* this is a shell function that calls either the normal or Montgomery |
|  |  | \* exptmod functions. Originally the call to the montgomery code was |
|  |  | \* embedded in the normal function but that wasted a lot of stack space |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[wolfssl/wolfcrypt/ecc.h](#diff-c58a9784ce75fd0f7ba04a288fe44156839d149e6c844b5b9c142dc7ae508de1 "wolfssl/wolfcrypt/ecc.h")

Show comments

[View file](/wolfSSL/wolfssl/blob/1de07da61f0c8e9926dcbd68119f73230dae283f/wolfssl/wolfcrypt/ecc.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -439,6 +439,7 @@ ECC\_API int ecc\_mul2add(ecc\_point\* A, mp\_int\* kA, |
|  |  | ecc\_point\* C, mp\_int\* a, mp\_int\* modulus, void\* heap); |
|  |  |  |
|  |  | ECC\_API int ecc\_map(ecc\_point\*, mp\_int\*, mp\_digit); |
|  |  | ECC\_API int ecc\_map\_ex(ecc\_point\*, mp\_int\*, mp\_digit, int ct); |
|  |  | ECC\_API int ecc\_projective\_add\_point(ecc\_point\* P, ecc\_point\* Q, ecc\_point\* R, |
|  |  | mp\_int\* a, mp\_int\* modulus, mp\_digit mp); |
|  |  | ECC\_API int ecc\_projective\_dbl\_point(ecc\_point\* P, ecc\_point\* R, mp\_int\* a, |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[wolfssl/wolfcrypt/tfm.h](#diff-4e0c1924cc15b9bc0467ce5740a3b05270076c1b7fcacf6d0f8be0d8223bbfb3 "wolfssl/wolfcrypt/tfm.h")

Show comments

[View file](/wolfSSL/wolfssl/blob/1de07da61f0c8e9926dcbd68119f73230dae283f/wolfssl/wolfcrypt/tfm.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -535,6 +535,7 @@ int fp\_sqrmod(fp\_int \*a, fp\_int \*b, fp\_int \*c); |
|  |  |  |
|  |  | /\* c = 1/a (mod b) \*/ |
|  |  | int fp\_invmod(fp\_int \*a, fp\_int \*b, fp\_int \*c); |
|  |  | int fp\_invmod\_mont\_ct(fp\_int \*a, fp\_int \*b, fp\_int \*c, fp\_digit mp); |
|  |  |  |
|  |  | /\* c = (a, b) \*/ |
|  |  | /\*int fp\_gcd(fp\_int \*a, fp\_int \*b, fp\_int \*c);\*/ |
| Expand Down  Expand Up | | @@ -743,6 +744,7 @@ MP\_API int mp\_submod (mp\_int\* a, mp\_int\* b, mp\_int\* c, mp\_int\* d); |
|  |  | MP\_API int mp\_addmod (mp\_int\* a, mp\_int\* b, mp\_int\* c, mp\_int\* d); |
|  |  | MP\_API int mp\_mod(mp\_int \*a, mp\_int \*b, mp\_int \*c); |
|  |  | MP\_API int mp\_invmod(mp\_int \*a, mp\_int \*b, mp\_int \*c); |
|  |  | MP\_API int mp\_invmod\_mont\_ct(mp\_int \*a, mp\_int \*b, mp\_int \*c, fp\_digit mp); |
|  |  | MP\_API int mp\_exptmod (mp\_int \* g, mp\_int \* x, mp\_int \* p, mp\_int \* y); |
|  |  | MP\_API int mp\_exptmod\_ex (mp\_int \* g, mp\_int \* x, int minDigits, mp\_int \* p, |
|  |  | mp\_int \* y); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1de07da`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FwolfSSL%2Fwolfssl%2Fcommit%2F1de07da61f0c8e9926dcbd68119f73230dae283f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


