=== Content from github.com_161f29e1_20250119_112452.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=argoproj%2Fargo-cd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-cd](/argoproj/argo-cd)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-cd) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fargoproj%2Fargo-cd)
* [Star
   18.5k](/login?return_to=%2Fargoproj%2Fargo-cd)

* [Code](/argoproj/argo-cd)
* [Issues
  3.1k](/argoproj/argo-cd/issues)
* [Pull requests
  480](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects
  5](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

Additional navigation options

* [Code](/argoproj/argo-cd)
* [Issues](/argoproj/argo-cd/issues)
* [Pull requests](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

## Commit

[Permalink](/argoproj/argo-cd/commit/35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: return 401 error code if username does not exist ([#3369](https://github.com/argoproj/argo-cd/pull/3369))

[Browse files](/argoproj/argo-cd/tree/35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1)
Browse the repository at this point in the history

* Loading branch information

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&v=4)](/alexmt)

Alexander Matyushentsev
authored and
[alexmt](/argoproj/argo-cd/commits?author=alexmt "View all commits by alexmt")
committed
Apr 6, 2020

1 parent
[241e6d0](/argoproj/argo-cd/commit/241e6d0a6e43b040cdaca1b52d73945e893fd741)

commit 35a7350

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**35 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* server/session

  + server/session/session.go
    [session.go](#diff-39ee9a637e234a89e844117ed7203ae07af219b5815b947d6df3110826a3f0d0)
* test/e2e

  + test/e2e/accounts\_test.go
    [accounts\_test.go](#diff-89df7f2c1de74c208158f037ad4bd32eb526e0ccc36d3b808360c8a05c80194b)
* util/session

  + util/session/sessionmanager.go
    [sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[server/session/session.go](#diff-39ee9a637e234a89e844117ed7203ae07af219b5815b947d6df3110826a3f0d0 "server/session/session.go")

Show comments

[View file](/argoproj/argo-cd/blob/35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1/server/session/session.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,7 +27,7 @@ func NewServer(mgr \*sessionmgr.SessionManager, authenticator Authenticator) \*Ser |
|  |  |  |
|  |  | // Create generates a JWT token signed by Argo CD intended for web/CLI logins of the admin user |
|  |  | // using username/password |
|  |  | func (s \*Server) Create(ctx context.Context, q \*session.SessionCreateRequest) (\*session.SessionResponse, error) { |
|  |  | func (s \*Server) Create(\_ context.Context, q \*session.SessionCreateRequest) (\*session.SessionResponse, error) { |
|  |  | if q.Token != "" { |
|  |  | return nil, status.Errorf(codes.Unauthenticated, "token-based session creation no longer supported. please upgrade argocd cli to v0.7+") |
|  |  | } |
| Expand Down | |  |

36 changes: 31 additions & 5 deletions

36
[test/e2e/accounts\_test.go](#diff-89df7f2c1de74c208158f037ad4bd32eb526e0ccc36d3b808360c8a05c80194b "test/e2e/accounts_test.go")

Show comments

[View file](/argoproj/argo-cd/blob/35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1/test/e2e/accounts_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,15 +4,15 @@ import ( |
|  |  | "context" |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/argoproj/argo-cd/pkg/apiclient/session" |
|  |  | "github.com/argoproj/argo-cd/util" |
|  |  |  |
|  |  | argocdclient "github.com/argoproj/argo-cd/pkg/apiclient" |
|  |  |  |
|  |  | "github.com/stretchr/testify/assert" |
|  |  | "google.golang.org/grpc/codes" |
|  |  | "google.golang.org/grpc/status" |
|  |  |  |
|  |  | "github.com/argoproj/argo-cd/errors" |
|  |  | argocdclient "github.com/argoproj/argo-cd/pkg/apiclient" |
|  |  | "github.com/argoproj/argo-cd/pkg/apiclient/session" |
|  |  | . "github.com/argoproj/argo-cd/test/e2e/fixture" |
|  |  | "github.com/argoproj/argo-cd/util" |
|  |  | ) |
|  |  |  |
|  |  | func TestCreateAndUseAccount(t \*testing.T) { |
| Expand Down  Expand Up | | @@ -50,3 +50,29 @@ test true login, apiKey`, output) |
|  |  |  |
|  |  | assert.Equal(t, info.Username, "test") |
|  |  | } |
|  |  |  |
|  |  | func TestLoginBadCredentials(t \*testing.T) { |
|  |  | EnsureCleanState(t) |
|  |  |  |
|  |  | closer, sessionClient := ArgoCDClientset.NewSessionClientOrDie() |
|  |  | defer util.Close(closer) |
|  |  |  |
|  |  | requests := []session.SessionCreateRequest{{ |
|  |  | Username: "user-does-not-exist", Password: "some-password", |
|  |  | }, { |
|  |  | Username: "admin", Password: "bad-password", |
|  |  | }} |
|  |  |  |
|  |  | for \_, r := range requests { |
|  |  | \_, err := sessionClient.Create(context.Background(), &r) |
|  |  | if !assert.Error(t, err) { |
|  |  | return |
|  |  | } |
|  |  | errStatus, ok := status.FromError(err) |
|  |  | if !assert.True(t, ok) { |
|  |  | return |
|  |  | } |
|  |  | assert.Equal(t, codes.Unauthenticated, errStatus.Code()) |
|  |  | assert.Equal(t, "Invalid username or password", errStatus.Message()) |
|  |  | } |
|  |  | } |

3 changes: 3 additions & 0 deletions

3
[util/session/sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656 "util/session/sessionmanager.go")

Show comments

[View file](/argoproj/argo-cd/blob/35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1/util/session/sessionmanager.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -156,6 +156,9 @@ func (mgr \*SessionManager) Parse(tokenString string) (jwt.Claims, error) { |
|  |  | func (mgr \*SessionManager) VerifyUsernamePassword(username string, password string) error { |
|  |  | account, err := mgr.settingsMgr.GetAccount(username) |
|  |  | if err != nil { |
|  |  | if errStatus, ok := status.FromError(err); ok && errStatus.Code() == codes.NotFound { |
|  |  | err = status.Errorf(codes.Unauthenticated, invalidLoginError) |
|  |  | } |
|  |  | return err |
|  |  | } |
|  |  | if !account.Enabled { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `35a7350`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F35a7350b7444bcaf53ee0bb11b9d8e3ae4b717a1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7cedcfce_20250119_112457.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fpull%2F3215)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fpull%2F3215)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=argoproj%2Fargo-cd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-cd](/argoproj/argo-cd)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-cd) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fargoproj%2Fargo-cd)
* [Star
   18.5k](/login?return_to=%2Fargoproj%2Fargo-cd)

* [Code](/argoproj/argo-cd)
* [Issues
  3.1k](/argoproj/argo-cd/issues)
* [Pull requests
  480](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects
  5](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

Additional navigation options

* [Code](/argoproj/argo-cd)
* [Issues](/argoproj/argo-cd/issues)
* [Pull requests](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fargoproj%2Fargo-cd%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fargoproj%2Fargo-cd%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# feat: implement Service Account / Local Users #3215

 Merged

[alexmt](/alexmt)
merged 4 commits into
[argoproj:master](/argoproj/argo-cd/tree/master "argoproj/argo-cd:master")
from
[alexmt:3185-local-users](/alexmt/argo-cd/tree/3185-local-users "alexmt/argo-cd:3185-local-users")

Mar 17, 2020

 Merged

# [feat: implement Service Account / Local Users](#top) #3215

[alexmt](/alexmt)
merged 4 commits into
[argoproj:master](/argoproj/argo-cd/tree/master "argoproj/argo-cd:master")
from
[alexmt:3185-local-users](/alexmt/argo-cd/tree/3185-local-users "alexmt/argo-cd:3185-local-users")

Mar 17, 2020

[Conversation
39](/argoproj/argo-cd/pull/3215)
[Commits
4](/argoproj/argo-cd/pull/3215/commits)
[Checks
0](/argoproj/argo-cd/pull/3215/checks)
[Files changed](/argoproj/argo-cd/pull/3215/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![alexmt](https://avatars.githubusercontent.com/u/426437?s=60&v=4)](/alexmt)

Copy link

Collaborator

### @alexmt **[alexmt](/alexmt)** commented [Mar 10, 2020](#issue-578280040) • edited Loading

Closes [#3185](https://github.com/argoproj/argo-cd/issues/3185)

Closes [#2108](https://github.com/argoproj/argo-cd/issues/2108)

Closes [#3221](https://github.com/argoproj/argo-cd/issues/3221)

PR introduces local users support in Argo CD.

* API changes
* CLI changes
* Unit Tests
* UI
* E2E Tests
* Docs

## CLI commands

* List existing accounts:

```
argocd account list                                                                                                                                                      NAME   ENABLED  CAPABILITIES
admin  true     apiKey, login
test   true     apiKey

```

* get account details:

```
Name:               admin
Enabled:            true
Capabilities:       apiKey, login

Tokens:
ID                                    ISSUED AT                  EXPIRING AT
2b8174fb-5e67-4f34-80d8-511f91422a6a  2020-03-09T14:31:25-07:00  never
c4f53804-0182-4021-b502-09a947f0488f  2020-03-09T14:26:34-07:00  2020-03-09T14:26:34-07:00 (expired)

```

* generate token for an account:

```
argocd account generate-token --account test
xxxxxxxxxxxxxxxxxxxxx

```

* delete existing account token:

```
argocd account delete-token 2b8174fb-5e67-4f34-80d8-511f91422a6a

```

* change local user password:

```
 argocd account update-password --account <name> --current-password <current-user-password> --new-password <new-password-for-localuser>

```
## UI

[![image](https://user-images.githubusercontent.com/426437/76454430-e44ed200-6391-11ea-918f-179f4bcc42d1.png)](https://user-images.githubusercontent.com/426437/76454430-e44ed200-6391-11ea-918f-179f4bcc42d1.png)

[![image](https://user-images.githubusercontent.com/426437/76454455-efa1fd80-6391-11ea-8b04-fe0fa7d65231.png)](https://user-images.githubusercontent.com/426437/76454455-efa1fd80-6391-11ea-8b04-fe0fa7d65231.png)

[![image](https://user-images.githubusercontent.com/426437/76454560-20823280-6392-11ea-87ee-480966632a97.png)](https://user-images.githubusercontent.com/426437/76454560-20823280-6392-11ea-87ee-480966632a97.png)

Sorry, something went wrong.

 ❤️
1
 romaninsh reacted with heart emoji

All reactions

* ❤️
  1 reaction

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
requested a review
from [jessesuen](/jessesuen)
[March 10, 2020 01:29](#event-3112932720)

[![golangcibot](https://avatars.githubusercontent.com/u/42910462?s=60&v=4)](/golangcibot)

**[golangcibot](/golangcibot)**
reviewed
[Mar 10, 2020](#pullrequestreview-371630420)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files)

[util/settings/settings\_test.go](/argoproj/argo-cd/pull/3215/files#diff-450b74ca5090fe496ffae80e53533e2786df3fb9942eb99d46decd6e01e941bc)
Outdated

Show resolved

Hide resolved

[util/settings/settings.go](/argoproj/argo-cd/pull/3215/files#diff-3b21889f7a356a28ebba12c6d339b945d7171a83b4dd603c0902e62cee3051ff)

Show resolved

Hide resolved

[util/settings/settings.go](/argoproj/argo-cd/pull/3215/files#diff-3b21889f7a356a28ebba12c6d339b945d7171a83b4dd603c0902e62cee3051ff)

Show resolved

Hide resolved

[util/settings/accounts\_test.go](/argoproj/argo-cd/pull/3215/files#diff-86306d7592474c28feaa4c43c7425a72d0ecfe6b7f1be257be4dcbf8b73aeb82)

Show resolved

Hide resolved

[cmd/argocd/commands/account.go](/argoproj/argo-cd/pull/3215/files#diff-3d35b930543cd19def7adac33650563b7aa10054353e72d6a08cf7af118f3b4d)
Outdated

Show resolved

Hide resolved

[server/account/account.go](/argoproj/argo-cd/pull/3215/files#diff-682193b77ae620a4fec57033d8701c8f14794a7a8413b4afd7e01ca81feb97b0)
Outdated

Show resolved

Hide resolved

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/5b1e3db20a21f8dd9367a6421c9d23eee2692575..148e925814768084ad14d04011638096d9032b30)
the
3185-local-users

branch
2 times, most recently
from
[`5b1e3db`](/argoproj/argo-cd/commit/5b1e3db20a21f8dd9367a6421c9d23eee2692575) to
[`148e925`](/argoproj/argo-cd/commit/148e925814768084ad14d04011638096d9032b30)  [Compare](/argoproj/argo-cd/compare/5b1e3db20a21f8dd9367a6421c9d23eee2692575..148e925814768084ad14d04011638096d9032b30)
[March 10, 2020 02:51](#event-3113061940)

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Mar 10, 2020](#issuecomment-596874513) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=h1) Report Merging [#3215](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=desc) into [master](https://codecov.io/gh/argoproj/argo-cd/commit/42d572306d252b3ae4b21d3d960fc9d1355c6d5b%26el%3Ddesc) will **increase** coverage by `0.17%`. The diff coverage is `41.39%`.  [Impacted file tree graph](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=tree)  ``` @@            Coverage Diff             @@ ##           master    #3215      +/-   ## ========================================== + Coverage   38.81%   38.99%   +0.17%      ==========================================   Files         169      172       +3        Lines       18321    18764     +443        Branches      272      237      -35      ========================================== + Hits         7112     7317     +205      - Misses      10333    10540     +207      - Partials      876      907      +31      ```  | [Impacted Files](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=tree) | Coverage Δ |  | | --- | --- | --- | | [cmd/argocd/commands/account.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-Y21kL2FyZ29jZC9jb21tYW5kcy9hY2NvdW50Lmdv) | `0.00% <0.00%> (ø)` |  | | [ui/src/app/shared/models.ts](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-dWkvc3JjL2FwcC9zaGFyZWQvbW9kZWxzLnRz) | `100.00% <ø> (ø)` |  | | [util/settings/settings.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-dXRpbC9zZXR0aW5ncy9zZXR0aW5ncy5nbw==) | `38.72% <11.11%> (+0.81%)` | ⬆️ | | [util/session/sessionmanager.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-dXRpbC9zZXNzaW9uL3Nlc3Npb25tYW5hZ2VyLmdv) | `55.94% <55.55%> (-2.46%)` | ⬇️ | | [ui/src/app/shared/services/accounts-service.ts](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-dWkvc3JjL2FwcC9zaGFyZWQvc2VydmljZXMvYWNjb3VudHMtc2VydmljZS50cw==) | `58.33% <58.33%> (ø)` |  | | [server/account/account.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-c2VydmVyL2FjY291bnQvYWNjb3VudC5nbw==) | `63.02% <69.69%> (+19.27%)` | ⬆️ | | [util/settings/accounts.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-dXRpbC9zZXR0aW5ncy9hY2NvdW50cy5nbw==) | `73.33% <73.33%> (ø)` |  | | [server/project/project.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-c2VydmVyL3Byb2plY3QvcHJvamVjdC5nbw==) | `59.43% <100.00%> (ø)` |  | | [server/rbacpolicy/rbacpolicy.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-c2VydmVyL3JiYWNwb2xpY3kvcmJhY3BvbGljeS5nbw==) | `80.30% <100.00%> (+0.61%)` | ⬆️ | | [server/server.go](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree#diff-c2VydmVyL3NlcnZlci5nbw==) | `57.59% <100.00%> (ø)` |  | | ... and [9 more](https://codecov.io/gh/argoproj/argo-cd/pull/3215/diff?src=pr&el=tree-more) |  |  |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=continue).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=footer). Last update [42d5723...0addefc](https://codecov.io/gh/argoproj/argo-cd/pull/3215?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments). |

All reactions

Sorry, something went wrong.

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/13878e6501207fc560335a78a0d32da49216b711..cc73f4f0b52f7c974b2596304edf8f27ac40e20d)
the
3185-local-users

branch
2 times, most recently
from
[`13878e6`](/argoproj/argo-cd/commit/13878e6501207fc560335a78a0d32da49216b711) to
[`cc73f4f`](/argoproj/argo-cd/commit/cc73f4f0b52f7c974b2596304edf8f27ac40e20d)  [Compare](/argoproj/argo-cd/compare/13878e6501207fc560335a78a0d32da49216b711..cc73f4f0b52f7c974b2596304edf8f27ac40e20d)
[March 10, 2020 04:03](#event-3113179603)

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
mentioned this pull request
[Mar 10, 2020](#ref-issue-477271350)

[JWT invalid => Password for superuser has changed since token issued
#2108](/argoproj/argo-cd/issues/2108)

Closed

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/cc73f4f0b52f7c974b2596304edf8f27ac40e20d..feb513b00c1b97ef8e4763d00d480620024def83)
the
3185-local-users

branch
from
[`cc73f4f`](/argoproj/argo-cd/commit/cc73f4f0b52f7c974b2596304edf8f27ac40e20d) to
[`feb513b`](/argoproj/argo-cd/commit/feb513b00c1b97ef8e4763d00d480620024def83)  [Compare](/argoproj/argo-cd/compare/cc73f4f0b52f7c974b2596304edf8f27ac40e20d..feb513b00c1b97ef8e4763d00d480620024def83)
[March 10, 2020 18:05](#event-3115860865)

[![golangcibot](https://avatars.githubusercontent.com/u/42910462?s=60&v=4)](/golangcibot)

**[golangcibot](/golangcibot)**
reviewed
[Mar 10, 2020](#pullrequestreview-372204972)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files)

[server/account/account\_test.go](/argoproj/argo-cd/pull/3215/files#diff-ccc66b058876c1da2b9b46bc6e4eb6a224e45dbbfc62fb8f0d72c2e6dd879c60)
Outdated

Show resolved

Hide resolved

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/cccec64ba50c8647f7924ad87661f3713760a5c5..1f400dbf1f4d7e63a7295232f46e232dcf23522c)
the
3185-local-users

branch
3 times, most recently
from
[`cccec64`](/argoproj/argo-cd/commit/cccec64ba50c8647f7924ad87661f3713760a5c5) to
[`1f400db`](/argoproj/argo-cd/commit/1f400dbf1f4d7e63a7295232f46e232dcf23522c)  [Compare](/argoproj/argo-cd/compare/cccec64ba50c8647f7924ad87661f3713760a5c5..1f400dbf1f4d7e63a7295232f46e232dcf23522c)
[March 10, 2020 20:25](#event-3116321499)

[![golangcibot](https://avatars.githubusercontent.com/u/42910462?s=60&v=4)](/golangcibot)

**[golangcibot](/golangcibot)**
reviewed
[Mar 10, 2020](#pullrequestreview-372305787)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files)

[server/account/account.go](/argoproj/argo-cd/pull/3215/files#diff-682193b77ae620a4fec57033d8701c8f14794a7a8413b4afd7e01ca81feb97b0)
Outdated

Show resolved

Hide resolved

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/1f400dbf1f4d7e63a7295232f46e232dcf23522c..58e0259d482eaff81a9f31c1cefb0bdc2ebc8d9e)
the
3185-local-users

branch
from
[`1f400db`](/argoproj/argo-cd/commit/1f400dbf1f4d7e63a7295232f46e232dcf23522c) to
[`58e0259`](/argoproj/argo-cd/commit/58e0259d482eaff81a9f31c1cefb0bdc2ebc8d9e)  [Compare](/argoproj/argo-cd/compare/1f400dbf1f4d7e63a7295232f46e232dcf23522c..58e0259d482eaff81a9f31c1cefb0bdc2ebc8d9e)
[March 10, 2020 20:52](#event-3116406583)

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
marked this pull request as ready for review
[March 10, 2020 21:22](#event-3116505664)

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/3cbd93f0406623761112b01e542abba5ade86da7..ee02a6e8114e25db6f29bfd5f0ba97d4f3584674)
the
3185-local-users

branch
from
[`3cbd93f`](/argoproj/argo-cd/commit/3cbd93f0406623761112b01e542abba5ade86da7) to
[`ee02a6e`](/argoproj/argo-cd/commit/ee02a6e8114e25db6f29bfd5f0ba97d4f3584674)  [Compare](/argoproj/argo-cd/compare/3cbd93f0406623761112b01e542abba5ade86da7..ee02a6e8114e25db6f29bfd5f0ba97d4f3584674)
[March 11, 2020 19:16](#event-3120184028)

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
requested a review
from [jannfis](/jannfis)
[March 17, 2020 00:31](#event-3135398513)

[![jessesuen](https://avatars.githubusercontent.com/u/12677113?s=60&v=4)](/jessesuen)

**[jessesuen](/jessesuen)**
approved these changes
[Mar 17, 2020](#pullrequestreview-376287076)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files)

[![jannfis](https://avatars.githubusercontent.com/u/3942683?s=60&v=4)](/jannfis)

**[jannfis](/jannfis)**
requested changes
[Mar 17, 2020](#pullrequestreview-375594879)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files)

Copy link

Member

### @jannfis **[jannfis](/jannfis)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Wow, awesome work. Looks good to me so far, I have some minor comments see below.

Sorry, something went wrong.

 👍
2
 alexmt and romaninsh reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

[cmd/argocd/commands/account.go](/argoproj/argo-cd/pull/3215/files#diff-3d35b930543cd19def7adac33650563b7aa10054353e72d6a08cf7af118f3b4d)
Outdated

Comment on lines
263
 to
265

|  |  | Use: "get", |
| --- | --- | --- |
|  |  | Short: "Get account details", |
|  |  | Example: "argocd account get", |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 16, 2020](#discussion_r393320223)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

IMHO should provide information on the argument the command optional takes - i.e. the account name. Also should be made clear in the example that with no parameters, current account will be get, and if parameter given, information for named account will be retrieved.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393961320)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Agree. Updated example of all commands that defaults to the current account.

Sorry, something went wrong.

All reactions

[cmd/argocd/commands/account.go](/argoproj/argo-cd/pull/3215/files#diff-3d35b930543cd19def7adac33650563b7aa10054353e72d6a08cf7af118f3b4d)
Outdated

Comment on lines
329
 to
331

|  |  | Use: "generate-token", |
| --- | --- | --- |
|  |  | Short: "Generate account token", |
|  |  | Example: "argocd account generate-token", |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 16, 2020](#discussion_r393321739)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Same as above, information about the arguments should be given.

Sorry, something went wrong.

All reactions

[cmd/argocd/commands/account.go](/argoproj/argo-cd/pull/3215/files#diff-3d35b930543cd19def7adac33650563b7aa10054353e72d6a08cf7af118f3b4d)
Outdated

Comment on lines
360
 to
362

|  |  | Use: "delete-token", |
| --- | --- | --- |
|  |  | Short: "Deletes account token", |
|  |  | Example: "argocd account delete-token ID", |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 16, 2020](#discussion_r393321956)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Here as well - more information about the parameters, please.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393961379)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

done

Sorry, something went wrong.

All reactions

[common/common.go](/argoproj/argo-cd/pull/3215/files#diff-a70f47b70b2d542f3eaa01a097d0f6d97e1f49cee567e258d4afc2a79f07af92)

|  |  | @@ -38,8 +38,6 @@ const ( | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | // Default paths on the pod's file system |
|  |  | const ( |
|  |  | // The default base path where application config is located |
|  |  | DefaultPathAppConfig = "/app/config" |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 16, 2020](#discussion_r393322241)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hm, is this not used anywhere?

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393961751)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, look like we forgot to delete it after some refactoring.

Sorry, something went wrong.

All reactions

[server/account/account.go](/argoproj/argo-cd/pull/3215/files#diff-682193b77ae620a4fec57033d8701c8f14794a7a8413b4afd7e01ca81feb97b0)
Outdated

|  |  | @@ -28,39 +30,49 @@ type Server struct { | |
| --- | --- | --- | --- |
|  |  | // NewServer returns a new instance of the Session service |
|  |  | func NewServer(sessionMgr \*session.SessionManager, settingsMgr \*settings.SettingsManager, enf \*rbac.Enforcer) \*Server { |
|  |  | return &Server{sessionMgr, settingsMgr, enf} |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | // UpdatePassword updates the password of the local admin superuser. |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 17, 2020](#discussion_r393466842)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This comment should be adapted to reflect reality. Probably there are more

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393961808)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

fixed

Sorry, something went wrong.

All reactions

3 hidden conversations

Load more…

[server/account/account.proto](/argoproj/argo-cd/pull/3215/files#diff-56d089a9b5e998c025d23e2446f5a1e98301bd012710042c184492817ed84c1c)
Outdated

Comment on lines
94
 to
96

|  |  | rpc GetAccount(GetAccountRequest) returns (Account) { |
| --- | --- | --- |
|  |  | option (google.api.http).get = "/api/v1/account/{name}"; |
|  |  | } |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 17, 2020](#discussion_r393686092)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Indentation

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393961855)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

fixed

Sorry, something went wrong.

All reactions

[util/session/sessionmanager.go](/argoproj/argo-cd/pull/3215/files#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656)

|  |  | return &s |
| --- | --- | --- |
|  |  | } |
|  |  |  |
|  |  | // Create creates a new token for a given subject (user) and returns it as a string. |
|  |  | // Passing a value of `0` for secondsBeforeExpiry creates a token that never expires. |
|  |  | func (mgr \*SessionManager) Create(subject string, secondsBeforeExpiry int64) (string, error) { |
|  |  | func (mgr \*SessionManager) Create(subject string, secondsBeforeExpiry int64, id string) (string, error) { |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 17, 2020](#discussion_r393881933)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We should clarify what `id` is used for here.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393961959)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

done. Updated comment

Sorry, something went wrong.

All reactions

[util/settings/accounts.go](/argoproj/argo-cd/pull/3215/files#diff-7b9aae3b833b4739c618a370f928091f7fc4284141fed0766dd9b42c1b4538df)

|  |  | @@ -0,0 +1,307 @@ | |
| --- | --- | --- | --- |
|  |  | package settings |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 17, 2020](#discussion_r393886306)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

General thought on this package - I think all Public methods and types should be rather well commented.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393962083)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Agree. Added missing comments

Sorry, something went wrong.

All reactions

[util/settings/accounts.go](/argoproj/argo-cd/pull/3215/files#diff-7b9aae3b833b4739c618a370f928091f7fc4284141fed0766dd9b42c1b4538df)
Outdated

|  |  | } |
| --- | --- | --- |
|  |  |  |
|  |  | func parseAdminAccount(secret \*v1.Secret, cm \*v1.ConfigMap) (\*Account, error) { |
|  |  | adminAccount := &Account{Enabled: true, Capabilities: []AccountCapability{AccountCapabilityApiKey, AccountCapabilityLogin}} |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 17, 2020](#discussion_r393887741)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hm, do we really want to allow admin account access to API by default? Or is that for backwards compatibility? If so, we should make a deprecation notice, that admin access to API will be disabled from v2 onwards or something similar.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393963299)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Nice catch. Admin account should not be able to generate API keys by default. That functionality does not exist before 1.5 so we are not breaking backward compatibility. Updated the default capabilities.

Sorry, something went wrong.

All reactions

[util/settings/accounts\_test.go](/argoproj/argo-cd/pull/3215/files#diff-86306d7592474c28feaa4c43c7425a72d0ecfe6b7f1be257be4dcbf8b73aeb82)

|  |  | @@ -0,0 +1,67 @@ | |
| --- | --- | --- | --- |
|  |  | package settings |

Copy link

Member

### @jannfis **[jannfis](/jannfis)** [Mar 17, 2020](#discussion_r393889561)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

General thought on this test package. I think we should also test for bad/malformed input data, that would also come up with more code coverage.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @alexmt **[alexmt](/alexmt)** [Mar 17, 2020](#discussion_r393963426)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Done. Added missing tests

Sorry, something went wrong.

All reactions

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/ee02a6e8114e25db6f29bfd5f0ba97d4f3584674..214a6fa964c57f4b56627b94f7be85521aa214dd)
the
3185-local-users

branch
from
[`ee02a6e`](/argoproj/argo-cd/commit/ee02a6e8114e25db6f29bfd5f0ba97d4f3584674) to
[`214a6fa`](/argoproj/argo-cd/commit/214a6fa964c57f4b56627b94f7be85521aa214dd)  [Compare](/argoproj/argo-cd/compare/ee02a6e8114e25db6f29bfd5f0ba97d4f3584674..214a6fa964c57f4b56627b94f7be85521aa214dd)
[March 17, 2020 20:49](#event-3139006098)

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=80&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)

Copy link

Collaborator

Author

### **[alexmt](/alexmt)** commented [Mar 17, 2020](#issuecomment-600291538)

| Thank you for review [@jannfis](https://github.com/jannfis) ! PTAL |
| --- |

All reactions

Sorry, something went wrong.

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/214a6fa964c57f4b56627b94f7be85521aa214dd..0da95f01dc536bf12dfa1431f6c58e6e4580fb1b)
the
3185-local-users

branch
from
[`214a6fa`](/argoproj/argo-cd/commit/214a6fa964c57f4b56627b94f7be85521aa214dd) to
[`0da95f0`](/argoproj/argo-cd/commit/0da95f01dc536bf12dfa1431f6c58e6e4580fb1b)  [Compare](/argoproj/argo-cd/compare/214a6fa964c57f4b56627b94f7be85521aa214dd..0da95f01dc536bf12dfa1431f6c58e6e4580fb1b)
[March 17, 2020 21:09](#event-3139080968)

 [alexmt](/alexmt)
added 3 commits
[March 17, 2020 14:21](#commits-pushed-c59c048)

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&v=4)](/alexmt)

`[feat: implement Service Account / Local Users](/argoproj/argo-cd/pull/3215/commits/c59c048d9e687d32fff25085b085f06cb16aab74 "feat: implement Service Account / Local Users")`

`[c59c048](/argoproj/argo-cd/pull/3215/commits/c59c048d9e687d32fff25085b085f06cb16aab74)`

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&v=4)](/alexmt)

`[add local users documentation](/argoproj/argo-cd/pull/3215/commits/4c9eb2721e38a8122062c858ec4cca4a34f0b47b "add local users documentation")`

`[4c9eb27](/argoproj/argo-cd/pull/3215/commits/4c9eb2721e38a8122062c858ec4cca4a34f0b47b)`

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&v=4)](/alexmt)

`[implement accounts management UI](/argoproj/argo-cd/pull/3215/commits/e47257cdbb8fc211ba24e732cc67b43cec382dc5 "implement accounts management UI")`

`[e47257c](/argoproj/argo-cd/pull/3215/commits/e47257cdbb8fc211ba24e732cc67b43cec382dc5)`

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/0da95f01dc536bf12dfa1431f6c58e6e4580fb1b..536e323ba7326be3147770602c3b6c0ea60ac399)
the
3185-local-users

branch
from
[`0da95f0`](/argoproj/argo-cd/commit/0da95f01dc536bf12dfa1431f6c58e6e4580fb1b) to
[`536e323`](/argoproj/argo-cd/commit/536e323ba7326be3147770602c3b6c0ea60ac399)  [Compare](/argoproj/argo-cd/compare/0da95f01dc536bf12dfa1431f6c58e6e4580fb1b..536e323ba7326be3147770602c3b6c0ea60ac399)
[March 17, 2020 21:21](#event-3139116084)

`[address code review notes](/argoproj/argo-cd/pull/3215/commits/0addefc8d1efaf5701654255602409c33e34adf1 "address code review notes")`

`[0addefc](/argoproj/argo-cd/pull/3215/commits/0addefc8d1efaf5701654255602409c33e34adf1)`

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
[force-pushed](/argoproj/argo-cd/compare/536e323ba7326be3147770602c3b6c0ea60ac399..0addefc8d1efaf5701654255602409c33e34adf1)
the
3185-local-users

branch
from
[`536e323`](/argoproj/argo-cd/commit/536e323ba7326be3147770602c3b6c0ea60ac399) to
[`0addefc`](/argoproj/argo-cd/commit/0addefc8d1efaf5701654255602409c33e34adf1)  [Compare](/argoproj/argo-cd/compare/536e323ba7326be3147770602c3b6c0ea60ac399..0addefc8d1efaf5701654255602409c33e34adf1)
[March 17, 2020 21:37](#event-3139158705)

[![jannfis](https://avatars.githubusercontent.com/u/3942683?s=60&v=4)](/jannfis)

**[jannfis](/jannfis)**
approved these changes
[Mar 17, 2020](#pullrequestreview-376430163)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files/0addefc8d1efaf5701654255602409c33e34adf1)

Copy link

Member

### @jannfis **[jannfis](/jannfis)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM

Sorry, something went wrong.

All reactions

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
merged commit [`3c2be61`](/argoproj/argo-cd/commit/3c2be618276369c0a9e60a49d9b8151f0136fde7)
into
argoproj:master

[Mar 17, 2020](https://github.com/argoproj/argo-cd/pull/3215#event-3139292669)

 [![@alexmt](https://avatars.githubusercontent.com/u/426437?s=40&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)
[alexmt](/alexmt)
deleted the
3185-local-users

branch
[March 17, 2020 22:31](#event-3139292941)

[![@alex1989hu](https://avatars.githubusercontent.com/u/10764100?s=80&u=4374f78998d7b86bb3700a638e8924654b2fc4e1&v=4)](/alex1989hu)

Copy link

### **[alex1989hu](/alex1989hu)** commented [Mar 19, 2020](#issuecomment-601018843)

| [@alexmt](https://github.com/alexmt): thanks for the documentation part |
| --- |

All reactions

Sorry, something went wrong.

[![@alex1989hu](https://avatars.githubusercontent.com/u/10764100?s=40&u=4374f78998d7b86bb3700a638e8924654b2fc4e1&v=4)](/alex1989hu)
[alex1989hu](/alex1989hu)
mentioned this pull request
[Mar 19, 2020](#ref-pullrequest-574167145)

[feat: Disable Admin Login (fixes #3019)
#3179](/argoproj/argo-cd/pull/3179)
 Merged

4 tasks

[![@omerlh](https://avatars.githubusercontent.com/u/6730584?s=80&u=73e093badcb3add810399941696da2732d60baae&v=4)](/omerlh)

Copy link

### **[omerlh](/omerlh)** commented [Mar 25, 2020](#issuecomment-603761471)

| Something unclear to me - look like you can define a token in the config map (by looking on the PR), but how can you use this token? What defined in the PR is claims, how can I sign it? |
| --- |

All reactions

Sorry, something went wrong.

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=80&u=fa4394a0bc2d8d083d91a7f31efdfb73a21cb9eb&v=4)](/alexmt)

Copy link

Collaborator

Author

### **[alexmt](/alexmt)** commented [Mar 26, 2020](#issuecomment-604687856)

| hello [@omerlh](https://github.com/omerlh) ,  User copy generated token and use it same as token generated during normal login process. Only token id, issuedAt and expiringAt time fields are stored in secret. This allows user to know when the token is going to expire and revoke it if necessary |
| --- |

All reactions

Sorry, something went wrong.

[![@omerlh](https://avatars.githubusercontent.com/u/6730584?s=80&u=73e093badcb3add810399941696da2732d60baae&v=4)](/omerlh)

Copy link

### **[omerlh](/omerlh)** commented [Apr 2, 2020](#issuecomment-607622540)

| So there is no declarative way to create tokens? only using the CLI? |
| --- |

All reactions

Sorry, something went wrong.

[![daurnimator](https://avatars.githubusercontent.com/u/127971?s=60&v=4)](/daurnimator)

**[daurnimator](/daurnimator)**
reviewed
[May 26, 2020](#pullrequestreview-418269313)

 [View reviewed changes](/argoproj/argo-cd/pull/3215/files/0addefc8d1efaf5701654255602409c33e34adf1)

[util/settings/accounts.go](/argoproj/argo-cd/pull/3215/files/0addefc8d1efaf5701654255602409c33e34adf1#diff-7b9aae3b833b4739c618a370f928091f7fc4284141fed0766dd9b42c1b4538df)

|  |  | for i := range a.Capabilities { |
| --- | --- | --- |
|  |  | items = append(items, string(a.Capabilities[i])) |
|  |  | } |
|  |  | return strings.Join(items, ",") |

Copy link

### @daurnimator **[daurnimator](/daurnimator)** [May 26, 2020](#discussion_r430390903)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This results in `"apiKey, login"` getting turned into `"apiKey,login"`

Sorry, something went wrong.

All reactions

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fpull%2F3215)

Reviewers

[![@golangcibot](https://avatars.githubusercontent.com/u/42910462?s=40&v=4)](/golangcibot) [golangcibot](/golangcibot)

golangcibot left review comments

[![@daurnimator](https://avatars.githubusercontent.com/u/127971?s=40&v=4)](/daurnimator) [daurnimator](/daurnimator)

daurnimator left review comments

[![@jessesuen](https://avatars.githubusercontent.com/u/12677113?s=40&v=4)](/jessesuen) [jessesuen](/jessesuen)

jessesuen approved these changes

[![@jannfis](https://avatars.githubusercontent.com/u/3942683?s=40&v=4)](/jannfis) [jannfis](/jannfis)

jannfis approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Local users/account UI](https://github.com/argoproj/argo-cd/issues/3221)

 [Argo CD Service Account / Local Users](https://github.com/argoproj/argo-cd/issues/3185)

 [JWT invalid => Password for superuser has changed since token issued](https://github.com/argoproj/argo-cd/issues/2108)

7 participants

[![@alexmt](https://avatars.githubusercontent.com/u/426437?s=52&v=4)](/alexmt) [![@alex1989hu](https://avatars.githubusercontent.com/u/10764100?s=52&v=4)](/alex1989hu) [![@omerlh](https://avatars.githubusercontent.com/u/6730584?s=52&v=4)](/omerlh) [![@daurnimator](https://avatars.githubusercontent.com/u/127971?s=52&v=4)](/daurnimator) [![@jannfis](https://avatars.githubusercontent.com/u/3942683?s=52&v=4)](/jannfis) [![@jessesuen](https://avatars.githubusercontent.com/u/12677113?s=52&v=4)](/jessesuen) [![@golangcibot](https://avatars.githubusercontent.com/u/42910462?s=52&v=4)](/golangcibot)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


