=== Content from github.com_80ac02ca_20250119_124039.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fcommit%2F7ce478a58b4dd29a8d1e6f4e9df2f778613d9202)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fcommit%2F7ce478a58b4dd29a8d1e6f4e9df2f778613d9202)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ntop%2FnDPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ntop](/ntop)
/
**[nDPI](/ntop/nDPI)**
Public

* [Notifications](/login?return_to=%2Fntop%2FnDPI) You must be signed in to change notification settings
* [Fork
  908](/login?return_to=%2Fntop%2FnDPI)
* [Star
   3.9k](/login?return_to=%2Fntop%2FnDPI)

* [Code](/ntop/nDPI)
* [Issues
  68](/ntop/nDPI/issues)
* [Pull requests
  2](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects
  0](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

Additional navigation options

* [Code](/ntop/nDPI)
* [Issues](/ntop/nDPI/issues)
* [Pull requests](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

## Commit

[Permalink](/ntop/nDPI/commit/7ce478a58b4dd29a8d1e6f4e9df2f778613d9202)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

ssh: fixing unsigned overflow leading to heap overflow

[Browse files](/ntop/nDPI/tree/7ce478a58b4dd29a8d1e6f4e9df2f778613d9202)
Browse the repository at this point in the history

```
cf GHSL-2020-051
```

* Loading branch information

[![@catenacyber](https://avatars.githubusercontent.com/u/35799796?s=40&v=4)](/catenacyber)

[catenacyber](/ntop/nDPI/commits?author=catenacyber "View all commits by catenacyber")
committed
Apr 2, 2020

1 parent
[3bbb0cd](/ntop/nDPI/commit/3bbb0cd3296023f6f922c71d21a1c374d2b0a435)

commit 7ce478a

Showing
**1 changed file**
with
**33 additions**
and
**31 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

64 changes: 33 additions & 31 deletions

64
[src/lib/protocols/ssh.c](#diff-89d5589d837a080af6e4eab4e696e8e71bd20ca5a44fa5cf840e08a2e21acc01 "src/lib/protocols/ssh.c")

Show comments

[View file](/ntop/nDPI/blob/7ce478a58b4dd29a8d1e6f4e9df2f778613d9202/src/lib/protocols/ssh.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -95,7 +95,7 @@ static void ndpi\_int\_ssh\_add\_connection(struct ndpi\_detection\_module\_struct |
|  |  |  |
|  |  | static u\_int16\_t concat\_hash\_string(struct ndpi\_packet\_struct \*packet, |
|  |  | char \*buf, u\_int8\_t client\_hash) { |
|  |  | u\_int16\_t offset = 22, buf\_out\_len = 0; |
|  |  | u\_int32\_t offset = 22, buf\_out\_len = 0; |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | u\_int32\_t len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
| Expand All | | @@ -114,113 +114,115 @@ static u\_int16\_t concat\_hash\_string(struct ndpi\_packet\_struct \*packet, |
|  |  | goto invalid\_payload; |
|  |  | /\* ssh.server\_host\_key\_algorithms [None] \*/ |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  | if (len > UINT32\_MAX - 4 - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += 4 + len; |
|  |  |  |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | /\* ssh.encryption\_algorithms\_client\_to\_server [C] \*/ |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  |  |
|  |  | offset += 4; |
|  |  | if(client\_hash) { |
|  |  | offset += 4; |
|  |  |  |
|  |  | if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) |
|  |  | goto invalid\_payload; |
|  |  |  |
|  |  | strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); |
|  |  | buf\_out\_len += len; |
|  |  | buf[buf\_out\_len++] = ';'; |
|  |  | offset += len; |
|  |  | } else |
|  |  | offset += 4 + len; |
|  |  | } |
|  |  | if (len > UINT32\_MAX - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += len; |
|  |  |  |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | /\* ssh.encryption\_algorithms\_server\_to\_client [S] \*/ |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  |  |
|  |  | offset += 4; |
|  |  | if(!client\_hash) { |
|  |  | offset += 4; |
|  |  |  |
|  |  | if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) |
|  |  | goto invalid\_payload; |
|  |  |  |
|  |  | strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); |
|  |  | buf\_out\_len += len; |
|  |  | buf[buf\_out\_len++] = ';'; |
|  |  | offset += len; |
|  |  | } else |
|  |  | offset += 4 + len; |
|  |  | } |
|  |  | if (len > UINT32\_MAX - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += len; |
|  |  |  |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | /\* ssh.mac\_algorithms\_client\_to\_server [C] \*/ |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  |  |
|  |  | offset += 4; |
|  |  | if(client\_hash) { |
|  |  | offset += 4; |
|  |  |  |
|  |  | if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) |
|  |  | goto invalid\_payload; |
|  |  |  |
|  |  | strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); |
|  |  | buf\_out\_len += len; |
|  |  | buf[buf\_out\_len++] = ';'; |
|  |  | offset += len; |
|  |  | } else |
|  |  | offset += 4 + len; |
|  |  | } |
|  |  | if (len > UINT32\_MAX - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += len; |
|  |  |  |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | /\* ssh.mac\_algorithms\_server\_to\_client [S] \*/ |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  |  |
|  |  | offset += 4; |
|  |  | if(!client\_hash) { |
|  |  | offset += 4; |
|  |  |  |
|  |  | if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) |
|  |  | goto invalid\_payload; |
|  |  |  |
|  |  | strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); |
|  |  | buf\_out\_len += len; |
|  |  | buf[buf\_out\_len++] = ';'; |
|  |  | offset += len; |
|  |  | } else |
|  |  | offset += 4 + len; |
|  |  | } |
|  |  | if (len > UINT32\_MAX - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += len; |
|  |  |  |
|  |  | /\* ssh.compression\_algorithms\_client\_to\_server [C] \*/ |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  |  |
|  |  | offset += 4; |
|  |  | if(client\_hash) { |
|  |  | offset += 4; |
|  |  |  |
|  |  | if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) |
|  |  | goto invalid\_payload; |
|  |  |  |
|  |  | strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); |
|  |  | buf\_out\_len += len; |
|  |  | offset += len; |
|  |  | } else |
|  |  | offset += 4 + len; |
|  |  | } |
|  |  | if (len > UINT32\_MAX - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += len; |
|  |  |  |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | /\* ssh.compression\_algorithms\_server\_to\_client [S] \*/ |
|  |  | len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  |  |
|  |  | offset += 4; |
|  |  | if(!client\_hash) { |
|  |  | offset += 4; |
|  |  |  |
|  |  | if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) |
|  |  | goto invalid\_payload; |
|  |  |  |
|  |  | strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); |
|  |  | buf\_out\_len += len; |
|  |  | offset += len; |
|  |  | } else |
|  |  | offset += 4 + len; |
|  |  | } |
|  |  | if (len > UINT32\_MAX - offset) |
|  |  | goto invalid\_payload; |
|  |  | offset += len; |
|  |  |  |
|  |  | /\* ssh.languages\_client\_to\_server [None] \*/ |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7ce478a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fcommit%2F7ce478a58b4dd29a8d1e6f4e9df2f778613d9202) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_83ff71ad_20250119_141350.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fcommit%2Fc6acf97bfbe)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fcommit%2Fc6acf97bfbe)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ntop%2FnDPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ntop](/ntop)
/
**[nDPI](/ntop/nDPI)**
Public

* [Notifications](/login?return_to=%2Fntop%2FnDPI) You must be signed in to change notification settings
* [Fork
  908](/login?return_to=%2Fntop%2FnDPI)
* [Star
   3.9k](/login?return_to=%2Fntop%2FnDPI)

* [Code](/ntop/nDPI)
* [Issues
  68](/ntop/nDPI/issues)
* [Pull requests
  2](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects
  0](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

Additional navigation options

* [Code](/ntop/nDPI)
* [Issues](/ntop/nDPI/issues)
* [Pull requests](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

## Commit

[Permalink](/ntop/nDPI/commit/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Adds different checks against overflows

[Browse files](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3)
Browse the repository at this point in the history

* Loading branch information

[![@catenacyber](https://avatars.githubusercontent.com/u/35799796?s=40&v=4)](/catenacyber)

[catenacyber](/ntop/nDPI/commits?author=catenacyber "View all commits by catenacyber")
committed
Mar 19, 2020

1 parent
[e919558](/ntop/nDPI/commit/e9195589d29d86da1849ad0d195900e6567354cf)

commit c6acf97

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**7 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/lib/protocols

  + src/lib/protocols/dns.c
    [dns.c](#diff-4261c550a6c44fd890c9f7f3f6a0ef78a3864f922c9f3808e3fa2a86b0c5d889)
  + src/lib/protocols/fix.c
    [fix.c](#diff-3ba648673c9929838cd9e82d9bf8639986102864541563374bff668d55f8a700)
  + src/lib/protocols/ssh.c
    [ssh.c](#diff-89d5589d837a080af6e4eab4e696e8e71bd20ca5a44fa5cf840e08a2e21acc01)
  + src/lib/protocols/yahoo.c
    [yahoo.c](#diff-ffcec8bce1663d24028ee80b0148e67e61fe4c05b157fa4baab5989c42dbcdd9)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[src/lib/protocols/dns.c](#diff-4261c550a6c44fd890c9f7f3f6a0ef78a3864f922c9f3808e3fa2a86b0c5d889 "src/lib/protocols/dns.c")

Show comments

[View file](/ntop/nDPI/blob/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/dns.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -141,7 +141,7 @@ static int search\_valid\_dns(struct ndpi\_detection\_module\_struct \*ndpi\_struct, |
|  |  | /\* Leave the statement below commented necessary in case of call to ndpi\_get\_partial\_detection() \*/ |
|  |  | x++; |
|  |  |  |
|  |  | if(flow->packet.payload[x] != '\0') { |
|  |  | if(x < flow->packet.payload\_packet\_len && flow->packet.payload[x] != '\0') { |
|  |  | while((x < flow->packet.payload\_packet\_len) |
|  |  | && (flow->packet.payload[x] != '\0')) { |
|  |  | x++; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/lib/protocols/fix.c](#diff-3ba648673c9929838cd9e82d9bf8639986102864541563374bff668d55f8a700 "src/lib/protocols/fix.c")

Show comments

[View file](/ntop/nDPI/blob/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/fix.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,7 +33,7 @@ void ndpi\_search\_fix(struct ndpi\_detection\_module\_struct \*ndpi\_struct, struct nd |
|  |  | struct ndpi\_packet\_struct \*packet = &flow->packet; |
|  |  |  |
|  |  | NDPI\_LOG\_DBG(ndpi\_struct, "search FIX\n"); |
|  |  | if(packet->tcp) { |
|  |  | if(packet->tcp && packet->payload\_packet\_len > 5) { |
|  |  | // 8= |
|  |  | if(packet->payload[0] == 0x38 && packet->payload[1] == 0x3d) { |
|  |  | // FIX. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[src/lib/protocols/ssh.c](#diff-89d5589d837a080af6e4eab4e696e8e71bd20ca5a44fa5cf840e08a2e21acc01 "src/lib/protocols/ssh.c")

Show comments

[View file](/ntop/nDPI/blob/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/ssh.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,6 +96,8 @@ static void ndpi\_int\_ssh\_add\_connection(struct ndpi\_detection\_module\_struct |
|  |  | static u\_int16\_t concat\_hash\_string(struct ndpi\_packet\_struct \*packet, |
|  |  | char \*buf, u\_int8\_t client\_hash) { |
|  |  | u\_int16\_t offset = 22, buf\_out\_len = 0; |
|  |  | if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) |
|  |  | goto invalid\_payload; |
|  |  | u\_int32\_t len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); |
|  |  | offset += 4; |
|  |  |  |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[src/lib/protocols/yahoo.c](#diff-ffcec8bce1663d24028ee80b0148e67e61fe4c05b157fa4baab5989c42dbcdd9 "src/lib/protocols/yahoo.c")

Show comments

[View file](/ntop/nDPI/blob/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/yahoo.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -76,6 +76,9 @@ u\_int8\_t check\_ymsg(const u\_int8\_t \* payload, u\_int16\_t payload\_packet\_len) |
|  |  | if(ylen >= payload\_packet\_len || yahoo\_len\_parsed >= payload\_packet\_len) |
|  |  | break; |
|  |  |  |
|  |  | if (payload\_packet\_len < yahoo\_len\_parsed + sizeof(struct ndpi\_yahoo\_header)) { |
|  |  | return 0; |
|  |  | } |
|  |  | yahoo = (struct ndpi\_yahoo\_header \*) (payload + yahoo\_len\_parsed); |
|  |  | } |
|  |  | while(memcmp(yahoo->YMSG\_str, "YMSG", 4) == 0); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c6acf97`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fcommit%2Fc6acf97bfbe) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_913ec6ba_20250119_124039.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

April 21, 2020
# GHSL-2020-051, GHSL-2020-052: Multiple vulnerabilities in NTOP nDPI

[![Author avatar](https://avatars.githubusercontent.com/u/13686387)
Bas Alberts](https://github.com/anticomputer)

## Summary

The [NTOP](https://github.com/ntop) Deep Packet Inspection Toolkit is driven in large part by the nDPI library. This library contains a large set of network protocol dissectors intended to parse and analyze packet-captured network traffic.

The nDPI SSH protocol dissector suffers from multiple integer overflow vulnerabilities which result in a controlled remote heap overflow. Due to the granular nature of the overflow primitive and the ability to control both the contents and layout of the nDPI library’s heap memory through remote input, this vulnerability may be abused to achieve full Remote Code Execution (RCE) against any network inspection stack that is linked against nDPI and uses it to perform network traffic analysis.

The nDPI SSH protocol dissector also suffers from an Out Of Bounds (OOB) read vulnerability which may result in a Denial of Service (DoS).

These specific vulnerabilities were introduced in the 3.0-stable release of nDPI.

## CVE

* CVE-2020-11939
* CVE-2020-11940

## Product

NTOP nDPI (https://github.com/ntop/nDPI)

## Tested Version

The development branch of nDPI as of Mar 23, 2020 and commit https://github.com/ntop/nDPI/commit/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3#diff-a3a2b66d47ec1a3eab1b650f55f68ab7

## Details

### Multiple integer overflows in `ssh.c:concat_hash_string` (GHSL-2020-051, CVE-2020-11939)

NOTE: annotated source code based on: https://github.com/ntop/nDPI/blob/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/ssh.c

When dissecting the SSH protocol the nDPI library will actively parse KEXINIT (type: 20) messages in both the server-to-client and client-to-server directions and attempts to extract various descriptive string sets from SSH KEXINIT packets. These string sets include e.g. the key exchange algorithms supported by the client and the server.

The SSH protocol handles string data based on the common `[length][data]` format, where length is a 32bit integer value. As such nDPI extracts these length values, and uses them to pull the actual string data from the SSH KEXINIT packets. nDPI also uses these length values to calculate and maintain a running offset in the captured packet data. This offset is maintained as a 16bit unsigned integer variable.

For example, to pull the key exchange algorithms out of a SSH KEXINIT packet, nDPI performs the following operations:

```
ssh.c:ndpi_search_ssh_tcp
...
    if(msgcode == 20 /* key exchange init */) {
      char *hassh_buf = calloc(packet->payload_packet_len, sizeof(char));
...
    	  len = concat_hash_string(packet, hassh_buf, 0 /* server */);
...

ssh.c:concat_hash_string
...
  u_int16_t offset = 22, buf_out_len = 0;

  if(offset+sizeof(u_int32_t) >= packet->payload_packet_len)
    goto invalid_payload;

  u_int32_t len = ntohl(*(u_int32_t*)&packet->payload[offset]);
  offset += 4;

  /* -1 for ';' */
  if((offset >= packet->payload_packet_len) || (len >= packet->payload_packet_len-offset-1))
    goto invalid_payload;

  /* ssh.kex_algorithms [C/S] */
  strncpy(buf, (const char *)&packet->payload[offset], buf_out_len = len);
  buf[buf_out_len++] = ';';
  offset += len;

```

We initially make 2 observations. First, that the destination buffer `buf` was previously allocated with a `calloc` call that is sized according to `packet->payload_packet_len`, which represents the actual size of the captured SSH packet. Second, that nDPI attempts to make sure that the `offset` and subsequently the `len` variables do not result in data accesses beyond `packet->payload_packet_len`. The intent here is to prevent read or write access outside of the bounds of the allocated `buf` memory region.

However, when examining the `concat_hash_string` function in greater detail, we note the following pattern:

```
ssh.c:concat_hash_string
...
[1]
  /* ssh.encryption_algorithms_client_to_server [C] */
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);

  if(client_hash) {
    offset += 4;

    if((offset >= packet->payload_packet_len) || (len >= packet->payload_packet_len-offset-1))
      goto invalid_payload;

    strncpy(&buf[buf_out_len], (const char *)&packet->payload[offset], len);
    buf_out_len += len;
    buf[buf_out_len++] = ';';
    offset += len;
  } else
[2]
    offset += 4 + len;

  /* ssh.encryption_algorithms_server_to_client [S] */
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);

  if(!client_hash) {
    offset += 4;

    if((offset >= packet->payload_packet_len) || (len >= packet->payload_packet_len-offset-1))
      goto invalid_payload;

    strncpy(&buf[buf_out_len], (const char *)&packet->payload[offset], len);
    buf_out_len += len;
    buf[buf_out_len++] = ';';
    offset += len;
  } else
    offset += 4 + len;

[3]
  /* ssh.mac_algorithms_client_to_server [C] */
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);

  if(client_hash) {
    offset += 4;

[4]
    if((offset >= packet->payload_packet_len) || (len >= packet->payload_packet_len-offset-1))
      goto invalid_payload;
[5]
    strncpy(&buf[buf_out_len], (const char *)&packet->payload[offset], len);
    buf_out_len += len;
    buf[buf_out_len++] = ';';
    offset += len;
  } else
[6]
    offset += 4 + len;

```

The `client_hash` variable decides whether the packet direction is server-to-client or client-to-server, but since the parsing pattern is the same for either direction it does not matter much for the sake of our discussion. For the sake of convenience we will examine the `!client_hash` case, but the same logic holds for the inverse.

At [1] we see that we have full control over a 32bit unsigned length integer. At [2] we see that `offset` is updated according to this controlled length variable based on an integer addition operation (`offset + 4 + len`). This arithmetic expression expands to 32bit integer values and is then truncated back to a 16bit integer value on the final assignment back into `offset`. This means that, given we have full control of the `len` variable, we can effectively integer wrap `offset` to be any value we wish it to be.

For example, to make `offset` become `n` where `n` is any desired 16bit integer value, we would simply set `len` to `0 - offset - 4 + n`.

The practical implication here is that, given at [4] the `offset` variable is used to ensure no out of bounds accesses occur, and given our ability to effectively set (and RESET) `offset` to any desired 16bit integer value, we can pass the intended bounds checks by resetting `offset` to a small enough value.

This integer overflow is the core issue resulting in what ultimately becomes a controlled remote heap overflow. However, to mold this scenario into a RCE-viable situation, some additional context is required.

We’ve established that we can effectively reset `offset` in-between the `strncpy` operations that copy remote controlled data into `buf`. When we examine the copy operation at [5], we note that that destination offset into `buf` is controlled by `buf_out_len`. We also note that `buf_out_len` is adjusted upward based on the `len` variable, which is the length of our remote controlled string.

For practical exploitation of this issue, the fact that `buf_out_len` is maintained as it’s own independent offset into the destination buffer becomes relevant.

Let’s recap:

* We control `offset` through an integer overflow
* We can repeat a pattern of: `strncpy(&buf[buf_out_len], controlled_data, controlled_len)`, adjust `buf_out_len` up by `controlled_len`, reset `offset` to any desired `n`
* We can not directly overflow `buf` based on this controlled len due to the `controlled_len >= packet->payload_packet_len-offset-1` check

Because `packet->payload_packet_len` controls the `buf` memory allocation size, and is directly influenced by our packet size, the intuition that we can simply pack repeated large strings to trigger an offset overwrap here is less than ideal from an attacker perspective. However, what we CAN do is pack a single string into the KEXINIT SSH packet and then copy that string repeatedly. A single string will result in a `calloc` based on the string’s size + some minor SSH protocol overhead and since `buf_out_len` is not bounds checked at any point, we can reset the `offset` variable to point at that initial string data for each subsequent `strncpy` operation.

In other words, using the `offset` integer overflow primitive, we can trick the nDPI SSH dissector into repeatedly copying the same data into `&buf[buf_out_len]`. Since `buf_out_len` is adjusted based on our controlled string length, and not otherwise sanity checked, we can write out of bounds as early as the 2nd repeat of the `strncpy` operation, pending string size vs protocol overhead (which you fully control).

This then becomes a controlled remote heap overflow primitive. Since the nDPI lib has a direct relationship to remotely controlled input, and it will allocate, deallocate, and populate heap memory in a direct 1:1 relationship to said remotely controlled input, this becomes a viable primitive to achieve remote code execution.

### Out of bounds read in `ssh.c:concat_hash_string` (GHSL-2020-052, CVE-2020-11940)

A comparatively minor, but related, repeating issue exists in the form of an OOB read, e.g. when examining the following snippet:

```
ssh.c:concat_hash_string
...
  /* ssh.server_host_key_algorithms [None] */
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);
[1]
  offset += 4 + len;

  /* ssh.encryption_algorithms_client_to_server [C] */
[2]
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);
...

```

We note that at [1], `offset` is calculated per the previously discussed integer arithmetic, which is susceptible to integer overflow. However, beyond that, we also note that at [2] the resulting `offset` value is immediately used as an index into packet data without any bounds check. This may result in an OOB read due to `offset` being fully user controlled.

A very similar pattern is repeated any time a new `offset` is calculated in a path that does not perform an explicit check against the resulting `offset` value, e.g.:

```
  /* ssh.encryption_algorithms_client_to_server [C] */
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);

  if(client_hash) {
    offset += 4;

    if((offset >= packet->payload_packet_len) || (len >= packet->payload_packet_len-offset-1))
      goto invalid_payload;

    strncpy(&buf[buf_out_len], (const char *)&packet->payload[offset], len);
    buf_out_len += len;
    buf[buf_out_len++] = ';';
    offset += len;
  } else
[1]
    offset += 4 + len;

  /* ssh.encryption_algorithms_server_to_client [S] */
[2]
  len = ntohl(*(u_int32_t*)&packet->payload[offset]);

```

Again, at [1] the initial remote controlled `len` variable is used to set `offset`, immediately after at [2] the resulting `offset` is used as an index into packet data without any bounds check. This may result in an OOB read due to `offset` being fully user controlled.

### Impact

These issues may lead to `Remote Code Execution` in the case of `GHSL-2020-051` and `Denial of Service` in the case of `GHSL-2020-052`.

## Remediation

These issues were addressed in the following commit:

<https://github.com/ntop/nDPI/commit/c120cca66272646c4277d71fa769d020b1026b28>

## Coordinated Disclosure Timeline

This report was subject to the GHSL [coordinated disclosure policy](https://securitylab.github.com/advisories/#policy).

* 03/23/2020: initial report sent to ntop team
* 03/24/2020: maintainer acknowledges report receipt and begins triage process
* 03/30/2020: additional findings sent to maintainer
* 04/05/2020: maintainer merges fixes for initial findings
* 04/15/2020: maintainer merges fixes for additional findings
* 04/21/2020: public advisory
* 04/29/2020: additional integer overflow for 32bit systems reported by @rhuizer
* 04/30/2020: revised patch committed by maintainer

## Credit

This issue was discovered and reported by GHSL team member [@anticomputer (Bas Alberts)](https://github.com/anticomputer).

An additional integer overflow issue affecting 32bit platforms was reported by [@rhuizer (Ronald Huizer)](https://github.com/rhuizer).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include `GHSL-2020-051` or `GHSL-2020-052` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_0a93cdd3_20250119_141353.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=ntop%2FnDPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ntop](/ntop)
/
**[nDPI](/ntop/nDPI)**
Public

* [Notifications](/login?return_to=%2Fntop%2FnDPI) You must be signed in to change notification settings
* [Fork
  908](/login?return_to=%2Fntop%2FnDPI)
* [Star
   3.9k](/login?return_to=%2Fntop%2FnDPI)

Open Source Deep Packet Inspection Software Toolkit

[www.ntop.org](http://www.ntop.org "http://www.ntop.org")

### License

[LGPL-3.0 license](/ntop/nDPI/blob/dev/COPYING)

[3.9k
stars](/ntop/nDPI/stargazers) [908
forks](/ntop/nDPI/forks) [Branches](/ntop/nDPI/branches) [Tags](/ntop/nDPI/tags) [Activity](/ntop/nDPI/activity)
 [Star](/login?return_to=%2Fntop%2FnDPI)

 [Notifications](/login?return_to=%2Fntop%2FnDPI) You must be signed in to change notification settings

* [Code](/ntop/nDPI)
* [Issues
  68](/ntop/nDPI/issues)
* [Pull requests
  2](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects
  0](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

Additional navigation options

* [Code](/ntop/nDPI)
* [Issues](/ntop/nDPI/issues)
* [Pull requests](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

# ntop/nDPI

    dev[Branches](/ntop/nDPI/branches)[Tags](/ntop/nDPI/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[5,072 Commits](/ntop/nDPI/commits/dev/) | | |
| [.github](/ntop/nDPI/tree/dev/.github ".github") | | [.github](/ntop/nDPI/tree/dev/.github ".github") |  |  |
| [dga](/ntop/nDPI/tree/dev/dga "dga") | | [dga](/ntop/nDPI/tree/dev/dga "dga") |  |  |
| [doc](/ntop/nDPI/tree/dev/doc "doc") | | [doc](/ntop/nDPI/tree/dev/doc "doc") |  |  |
| [example](/ntop/nDPI/tree/dev/example "example") | | [example](/ntop/nDPI/tree/dev/example "example") |  |  |
| [fuzz](/ntop/nDPI/tree/dev/fuzz "fuzz") | | [fuzz](/ntop/nDPI/tree/dev/fuzz "fuzz") |  |  |
| [influxdb](/ntop/nDPI/tree/dev/influxdb "influxdb") | | [influxdb](/ntop/nDPI/tree/dev/influxdb "influxdb") |  |  |
| [lists](/ntop/nDPI/tree/dev/lists "lists") | | [lists](/ntop/nDPI/tree/dev/lists "lists") |  |  |
| [m4](/ntop/nDPI/tree/dev/m4 "m4") | | [m4](/ntop/nDPI/tree/dev/m4 "m4") |  |  |
| [packages](/ntop/nDPI/tree/dev/packages "packages") | | [packages](/ntop/nDPI/tree/dev/packages "packages") |  |  |
| [python](/ntop/nDPI/tree/dev/python "python") | | [python](/ntop/nDPI/tree/dev/python "python") |  |  |
| [rrdtool](/ntop/nDPI/tree/dev/rrdtool "rrdtool") | | [rrdtool](/ntop/nDPI/tree/dev/rrdtool "rrdtool") |  |  |
| [src](/ntop/nDPI/tree/dev/src "src") | | [src](/ntop/nDPI/tree/dev/src "src") |  |  |
| [tests](/ntop/nDPI/tree/dev/tests "tests") | | [tests](/ntop/nDPI/tree/dev/tests "tests") |  |  |
| [utils](/ntop/nDPI/tree/dev/utils "utils") | | [utils](/ntop/nDPI/tree/dev/utils "utils") |  |  |
| [windows](/ntop/nDPI/tree/dev/windows "windows") | | [windows](/ntop/nDPI/tree/dev/windows "windows") |  |  |
| [wireshark](/ntop/nDPI/tree/dev/wireshark "wireshark") | | [wireshark](/ntop/nDPI/tree/dev/wireshark "wireshark") |  |  |
| [.ci-ignore](/ntop/nDPI/blob/dev/.ci-ignore ".ci-ignore") | | [.ci-ignore](/ntop/nDPI/blob/dev/.ci-ignore ".ci-ignore") |  |  |
| [.gitattributes](/ntop/nDPI/blob/dev/.gitattributes ".gitattributes") | | [.gitattributes](/ntop/nDPI/blob/dev/.gitattributes ".gitattributes") |  |  |
| [.gitignore](/ntop/nDPI/blob/dev/.gitignore ".gitignore") | | [.gitignore](/ntop/nDPI/blob/dev/.gitignore ".gitignore") |  |  |
| [CHANGELOG.md](/ntop/nDPI/blob/dev/CHANGELOG.md "CHANGELOG.md") | | [CHANGELOG.md](/ntop/nDPI/blob/dev/CHANGELOG.md "CHANGELOG.md") |  |  |
| [CONTRIBUTING.md](/ntop/nDPI/blob/dev/CONTRIBUTING.md "CONTRIBUTING.md") | | [CONTRIBUTING.md](/ntop/nDPI/blob/dev/CONTRIBUTING.md "CONTRIBUTING.md") |  |  |
| [COPYING](/ntop/nDPI/blob/dev/COPYING "COPYING") | | [COPYING](/ntop/nDPI/blob/dev/COPYING "COPYING") |  |  |
| [INSTALL](/ntop/nDPI/blob/dev/INSTALL "INSTALL") | | [INSTALL](/ntop/nDPI/blob/dev/INSTALL "INSTALL") |  |  |
| [Makefile.am](/ntop/nDPI/blob/dev/Makefile.am "Makefile.am") | | [Makefile.am](/ntop/nDPI/blob/dev/Makefile.am "Makefile.am") |  |  |
| [README.fuzzer.md](/ntop/nDPI/blob/dev/README.fuzzer.md "README.fuzzer.md") | | [README.fuzzer.md](/ntop/nDPI/blob/dev/README.fuzzer.md "README.fuzzer.md") |  |  |
| [README.md](/ntop/nDPI/blob/dev/README.md "README.md") | | [README.md](/ntop/nDPI/blob/dev/README.md "README.md") |  |  |
| [autogen.sh](/ntop/nDPI/blob/dev/autogen.sh "autogen.sh") | | [autogen.sh](/ntop/nDPI/blob/dev/autogen.sh "autogen.sh") |  |  |
| [configure.ac](/ntop/nDPI/blob/dev/configure.ac "configure.ac") | | [configure.ac](/ntop/nDPI/blob/dev/configure.ac "configure.ac") |  |  |
| [libndpi.pc.in](/ntop/nDPI/blob/dev/libndpi.pc.in "libndpi.pc.in") | | [libndpi.pc.in](/ntop/nDPI/blob/dev/libndpi.pc.in "libndpi.pc.in") |  |  |
| [sonar-project.properties](/ntop/nDPI/blob/dev/sonar-project.properties "sonar-project.properties") | | [sonar-project.properties](/ntop/nDPI/blob/dev/sonar-project.properties "sonar-project.properties") |  |  |
| View all files | | |

## Repository files navigation

* README
* LGPL-3.0 license
# nDPI

[![Build Status](https://camo.githubusercontent.com/66623619b82a5842f517fdcf66602b3805236a14a92620c97959cab297274d3e/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f616374696f6e732f776f726b666c6f772f7374617475732f6e746f702f6e4450492f6275696c642e796d6c3f6272616e63683d646576266c6f676f3d676974687562)](https://github.com/ntop/nDPI/actions?query=workflow%3ABuild)
[![Fuzzing Status](https://camo.githubusercontent.com/ff541a5fe301765886864c110d4ae2ab1ec7bb23a694d1f08a3f5c42dc4261a9/68747470733a2f2f6f73732d66757a7a2d6275696c642d6c6f67732e73746f726167652e676f6f676c65617069732e636f6d2f6261646765732f6e6470692e737667)](https://bugs.chromium.org/p/oss-fuzz/issues/list?sort=-opened&can=1&q=proj:ndpi)

## What is nDPI ?

nDPI® is an open source LGPLv3 library for deep-packet inspection. Based on OpenDPI it includes ntop extensions. We have tried to push them into the OpenDPI source tree but nobody answered emails, so we have decided to create our own source tree

A generic FAQ about nDPI® is available [here](https://github.com/ntop/nDPI/blob/dev/doc/FAQ.md)

### How To Compile nDPI

In order to compile this project do

* ./autogen.sh
* make

To compile the library w/o any tools or tests:

* ./autogen.sh --with-only-libndpi
* make

To run tests do additionally:

* ./tests/do.sh # Generate and check for diff's in PCAP files
* ./tests/do-unit.sh # Run unit tests
* ./tests/do-dga.sh # Run DGA detection test

or run all with: `make check`

Please note that the (minimal) pre-requisites for compilation include:

* GNU tools (autoconf automake libtool pkg-config gettext flex bison)
* GNU C compiler (gcc) or Clang

On Debian/Ubuntu systems do:

* sudo apt-get install build-essential git gettext flex bison libtool autoconf automake pkg-config libpcap-dev libjson-c-dev libnuma-dev libpcre2-dev libmaxminddb-dev librrd-dev

On Arch Linux:

* sudo pacman -S gcc git gettext flex bison libtool autoconf automake pkg-config libpcap json-c numactl pcre2 libmaxminddb rrdtool

On FreeBSD:

* sudo pkg install gcc git gettext flex bison libtool autoconf automake devel/pkgconf gmake libpcap json-c pcre2 libmaxminddb rrdtool

Remember to use `gmake` and not `make` on FreeBSD

On MacOS:

* brew install coreutils gcc git gettext flex bison libtool autoconf automake pkg-config libpcap json-c pcre2 libmaxminddb rrdtool

On Windows:

There are three supported ways to build nDPI:

1. MSYS2 (assuming [MSYS2](https://www.msys2.org/) already installed):

* msys2 -c "pacman --noconfirm -S --needed --overwrite '\*' git mingw-w64-x86\_64-toolchain automake1.16 automake-wrapper autoconf libtool make mingw-w64-x86\_64-json-c mingw-w64-x86\_64-crt-git mingw-w64-x86\_64-pcre2 mingw-w64-x86\_64-libpcap"

2. Mingw-w64
3. Visual Studio (see `windows/nDPI.sln`)

Note: All Windows versions require [npcap](https://npcap.com/#download) with WinPcap compatibility mode enabled.

### How To Build The Documentation

* pip install --upgrade pip
* pip install -r doc/requirements.txt
* make doc

Use the builtin python3 webserver to view documentation:

* make doc-view

### How To Add A New Protocol Dissector

The entire procedure of adding new protocols in detail:

1. Add new protocol together with its unique ID to: `src/include/ndpi_protocol_ids.h`
2. Create a new protocol in: `src/lib/protocols/`
3. Variables to be kept for the duration of the entire flow (as state variables) need to be placed in: `src/include/ndpi_typedefs.h` in `ndpi_flow_tcp_struct` (for TCP only), `ndpi_flow_udp_struct` (for UDP only), or `ndpi_flow_struct` (for both).
4. Add a new entry for the search function for the new protocol in: `src/include/ndpi_protocols.h`
5. Choose (do not change anything) a selection bitmask from: `src/include/ndpi_define.h`
6. Set protocol default ports in `ndpi_init_protocol_defaults` in: `src/lib/ndpi_main.c`
7. Be sure to have nBPF support, cloning `PF_RING` in the same directory where you cloned `nDPI`: `git clone https://github.com/ntop/PF_RING/ && cd PF_RING/userland/nbpf && ./configure && make`. You can ignore the `/bin/sh: 1: ../lib/pfring_config: not found` error
8. From the `nDPI` root directory, `./autogen.sh --with-pcre2` (nBPF and PCRE2 are usually optional, but they are needed to run/update *all* the unit tests)
9. `make`
10. `make check`
11. Update the documentation, adding this new protocol to `doc/protocols.rst`
12. Update the Windows Visual Studio configuration, adding the new c file in `windows/nDPI.vcxproj`

### How to use nDPI to Block Selected Traffic

You can use nDPI to selectively block selected Internet traffic by embedding it onto an application (remember that nDPI is just a library). Both [ntopng](https://github.com/ntop/ntopng) and [nProbe cento](http://www.ntop.org/products/netflow/nprobe-cento/) can do this.

### nDPI Paper Citation

* Deri, Luca, et al. [nDPI: Open-source high-speed deep packet inspection](http://luca.ntop.org/nDPI.pdf) 2014 International Wireless Communications and Mobile Computing Conference (IWCMC). IEEE, 2014.

### Videos and Presentations

* [Using nDPI for Monitoring and Security](https://archive.fosdem.org/2021/schedule/event/nemondpi/)
* [Network Traffic Classification for Cybersecurity and Monitoring](https://fosdem.org/2022/schedule/event/using_ndpi_to_efficiently_classify_network_traffic/)

### nDPI-Related Projects

* [nfstream](https://github.com/aouinizied/nfstream)
* [nDPId](https://github.com/utoni/nDPId)

### DISCLAIMER

While we do our best to detect network protocols, we cannot guarantee that our software is error free and 100% accurate in protocol detection. Please make sure that you respect the privacy of users and you have proper authorization to listen, capture and inspect network traffic.

nDPI is a registered trademark in the US and EU.

## About

Open Source Deep Packet Inspection Software Toolkit

[www.ntop.org](http://www.ntop.org "http://www.ntop.org")

### Topics

[network](/topics/network "Topic: network")
[traffic-analysis](/topics/traffic-analysis "Topic: traffic-analysis")
[dpi](/topics/dpi "Topic: dpi")
[cybersecurity](/topics/cybersecurity "Topic: cybersecurity")
[ndpi](/topics/ndpi "Topic: ndpi")
[deep-packet-inspection](/topics/deep-packet-inspection "Topic: deep-packet-inspection")

### Resources

[Readme](#readme-ov-file)
### License

[LGPL-3.0 license](#LGPL-3.0-1-ov-file)

[Activity](/ntop/nDPI/activity)
[Custom properties](/ntop/nDPI/custom-properties)
### Stars

[**3.9k**
stars](/ntop/nDPI/stargazers)
### Watchers

[**156**
watching](/ntop/nDPI/watchers)
### Forks

[**908**
forks](/ntop/nDPI/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI&report=ntop+%28user%29)

## [Releases 15](/ntop/nDPI/releases)

[4.12 Stable
Latest

Dec 18, 2024](/ntop/nDPI/releases/tag/4.12)
[+ 14 releases](/ntop/nDPI/releases)

## [Packages 0](/orgs/ntop/packages?repo_name=nDPI)

No packages published

## [Contributors 160](/ntop/nDPI/graphs/contributors)

* [![@lucaderi](https://avatars.githubusercontent.com/u/4493366?s=64&v=4)](https://github.com/lucaderi)
* [![@IvanNardi](https://avatars.githubusercontent.com/u/12729895?s=64&v=4)](https://github.com/IvanNardi)
* [![@kYroL01](https://avatars.githubusercontent.com/u/7222956?s=64&v=4)](https://github.com/kYroL01)
* [![@utoni](https://avatars.githubusercontent.com/u/651384?s=64&v=4)](https://github.com/utoni)
* [![@cardigliano](https://avatars.githubusercontent.com/u/7548711?s=64&v=4)](https://github.com/cardigliano)
* [![@emanuele-f](https://avatars.githubusercontent.com/u/5488003?s=64&v=4)](https://github.com/emanuele-f)
* [![@0xA50C1A1](https://avatars.githubusercontent.com/u/105977161?s=64&v=4)](https://github.com/0xA50C1A1)
* [![@catenacyber](https://avatars.githubusercontent.com/u/35799796?s=64&v=4)](https://github.com/catenacyber)
* [![@aouinizied](https://avatars.githubusercontent.com/u/4332251?s=64&v=4)](https://github.com/aouinizied)
* [![@alagoutte](https://avatars.githubusercontent.com/u/1098542?s=64&v=4)](https://github.com/alagoutte)
* [![@simonemainardi](https://avatars.githubusercontent.com/u/3397663?s=64&v=4)](https://github.com/simonemainardi)
* [![@jsoref](https://avatars.githubusercontent.com/u/2119212?s=64&v=4)](https://github.com/jsoref)
* [![@vel21ripn](https://avatars.githubusercontent.com/u/12272965?s=64&v=4)](https://github.com/vel21ripn)
* [![@theirix](https://avatars.githubusercontent.com/u/481351?s=64&v=4)](https://github.com/theirix)

[+ 146 contributors](/ntop/nDPI/graphs/contributors)

## Languages

* [C
  92.1%](/ntop/nDPI/search?l=c)
* [Lua
  2.6%](/ntop/nDPI/search?l=lua)
* [C++
  1.9%](/ntop/nDPI/search?l=c%2B%2B)
* [Makefile
  1.1%](/ntop/nDPI/search?l=makefile)
* [Shell
  0.9%](/ntop/nDPI/search?l=shell)
* [M4
  0.7%](/ntop/nDPI/search?l=m4)
* Other
  0.7%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7995b428_20250119_141352.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fblob%2Fc6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3%2Fsrc%2Flib%2Fprotocols%2Fssh.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fntop%2FnDPI%2Fblob%2Fc6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3%2Fsrc%2Flib%2Fprotocols%2Fssh.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ntop%2FnDPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ntop](/ntop)
/
**[nDPI](/ntop/nDPI)**
Public

* [Notifications](/login?return_to=%2Fntop%2FnDPI) You must be signed in to change notification settings
* [Fork
  908](/login?return_to=%2Fntop%2FnDPI)
* [Star
   3.9k](/login?return_to=%2Fntop%2FnDPI)

* [Code](/ntop/nDPI)
* [Issues
  68](/ntop/nDPI/issues)
* [Pull requests
  2](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects
  0](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

Additional navigation options

* [Code](/ntop/nDPI)
* [Issues](/ntop/nDPI/issues)
* [Pull requests](/ntop/nDPI/pulls)
* [Actions](/ntop/nDPI/actions)
* [Projects](/ntop/nDPI/projects)
* [Wiki](/ntop/nDPI/wiki)
* [Security](/ntop/nDPI/security)
* [Insights](/ntop/nDPI/pulse)

## Files

 c6acf97
## Breadcrumbs

1. [nDPI](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3)
2. /[src](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src)
3. /[lib](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib)
4. /[protocols](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols)
/
# ssh.c

Copy path Blame  Blame
## Latest commit

## History

[History](/ntop/nDPI/commits/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/ssh.c)382 lines (293 loc) · 11.6 KB c6acf97
## Breadcrumbs

1. [nDPI](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3)
2. /[src](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src)
3. /[lib](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib)
4. /[protocols](/ntop/nDPI/tree/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols)
/
# ssh.c

Top
## File metadata and controls

* Code
* Blame

382 lines (293 loc) · 11.6 KB[Raw](https://github.com/ntop/nDPI/raw/c6acf97bfbe5ad26db3c2f5dd4d379ac674d6fb3/src/lib/protocols/ssh.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382/\* \* ssh.c \* \* Copyright (C) 2009-2011 by ipoque GmbH \* Copyright (C) 2011-20 - ntop.org \* \* This file is part of nDPI, an open source deep packet inspection \* library based on the OpenDPI and PACE technology by ipoque GmbH \* \* nDPI is free software: you can redistribute it and/or modify \* it under the terms of the GNU Lesser General Public License as published by \* the Free Software Foundation, either version 3 of the License, or \* (at your option) any later version. \* \* nDPI is distributed in the hope that it will be useful, \* but WITHOUT ANY WARRANTY; without even the implied warranty of \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \* GNU Lesser General Public License for more details. \* \* You should have received a copy of the GNU Lesser General Public License \* along with nDPI. If not, see <http://www.gnu.org/licenses/>. \* \*/
#include "ndpi\_protocol\_ids.h"
#define NDPI\_CURRENT\_PROTO NDPI\_PROTOCOL\_SSH
#include "ndpi\_api.h"#include "ndpi\_md5.h"
/\* HASSH - https://github.com/salesforce/hassh
 https://github.com/salesforce/hassh/blob/master/python/hassh.py
 [server] skex = packet.ssh.kex\_algorithms seastc = packet.ssh.encryption\_algorithms\_server\_to\_client smastc = packet.ssh.mac\_algorithms\_server\_to\_client scastc = packet.ssh.compression\_algorithms\_server\_to\_client hasshs\_str = ';'.join([skex, seastc, smastc, scastc])
 [client] ckex = packet.ssh.kex\_algorithms ceacts = packet.ssh.encryption\_algorithms\_client\_to\_server cmacts = packet.ssh.mac\_algorithms\_client\_to\_server ccacts = packet.ssh.compression\_algorithms\_client\_to\_server hassh\_str = ';'.join([ckex, ceacts, cmacts, ccacts])
 NOTE THe ECDSA key fingerprint is SHA256 -> ssh.kex.h\_sig (wireshark) is in the Message Code: Diffie-Hellman Key Exchange Reply (31)  that usually is packet 14\*/
/\* #define SSH\_DEBUG 1 \*/
static void ndpi\_search\_ssh\_tcp(struct ndpi\_detection\_module\_struct \*ndpi\_struct, struct ndpi\_flow\_struct \*flow); /\* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \*/
static int search\_ssh\_again(struct ndpi\_detection\_module\_struct \*ndpi\_struct, struct ndpi\_flow\_struct \*flow) { ndpi\_search\_ssh\_tcp(ndpi\_struct, flow);
 if((flow->protos.ssh.hassh\_client[0] != '\0') && (flow->protos.ssh.hassh\_server[0] != '\0')) { /\* stop extra processing \*/ flow->extra\_packets\_func = NULL; /\* We're good now \*/ return(0); }
 /\* Possibly more processing \*/ return(1);}
/\* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \*/
static void ndpi\_int\_ssh\_add\_connection(struct ndpi\_detection\_module\_struct \*ndpi\_struct, struct ndpi\_flow\_struct \*flow) { if(flow->extra\_packets\_func != NULL) return;
 flow->guessed\_host\_protocol\_id = flow->guessed\_protocol\_id = NDPI\_PROTOCOL\_SSH;  /\* This is necessary to inform the core to call this dissector again \*/ flow->check\_extra\_packets = 1; flow->max\_extra\_packets\_to\_check = 12; flow->extra\_packets\_func = search\_ssh\_again;  ndpi\_set\_detected\_protocol(ndpi\_struct, flow, NDPI\_PROTOCOL\_SSH, NDPI\_PROTOCOL\_UNKNOWN);}
/\* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \*/
static u\_int16\_t concat\_hash\_string(struct ndpi\_packet\_struct \*packet, char \*buf, u\_int8\_t client\_hash) { u\_int16\_t offset = 22, buf\_out\_len = 0; if(offset+sizeof(u\_int32\_t) >= packet->payload\_packet\_len) goto invalid\_payload; u\_int32\_t len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); offset += 4;
 /\* -1 for ';' \*/ if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 /\* ssh.kex\_algorithms [C/S] \*/ strncpy(buf, (const char \*)&packet->payload[offset], buf\_out\_len = len); buf[buf\_out\_len++] = ';'; offset += len;
 /\* ssh.server\_host\_key\_algorithms [None] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]); offset += 4 + len;
 /\* ssh.encryption\_algorithms\_client\_to\_server [C] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]);
 if(client\_hash) { offset += 4;
 if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); buf\_out\_len += len; buf[buf\_out\_len++] = ';'; offset += len; } else offset += 4 + len;
 /\* ssh.encryption\_algorithms\_server\_to\_client [S] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]);
 if(!client\_hash) { offset += 4;
 if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); buf\_out\_len += len; buf[buf\_out\_len++] = ';'; offset += len; } else offset += 4 + len;
 /\* ssh.mac\_algorithms\_client\_to\_server [C] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]);
 if(client\_hash) { offset += 4;
 if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); buf\_out\_len += len; buf[buf\_out\_len++] = ';'; offset += len; } else offset += 4 + len;
 /\* ssh.mac\_algorithms\_server\_to\_client [S] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]);
 if(!client\_hash) { offset += 4;
 if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); buf\_out\_len += len; buf[buf\_out\_len++] = ';'; offset += len; } else offset += 4 + len;
 /\* ssh.compression\_algorithms\_client\_to\_server [C] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]);
 if(client\_hash) { offset += 4;
 if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); buf\_out\_len += len; offset += len; } else offset += 4 + len;
 /\* ssh.compression\_algorithms\_server\_to\_client [S] \*/ len = ntohl(\*(u\_int32\_t\*)&packet->payload[offset]);
 if(!client\_hash) { offset += 4;
 if((offset >= packet->payload\_packet\_len) || (len >= packet->payload\_packet\_len-offset-1)) goto invalid\_payload;
 strncpy(&buf[buf\_out\_len], (const char \*)&packet->payload[offset], len); buf\_out\_len += len; offset += len; } else offset += 4 + len;
 /\* ssh.languages\_client\_to\_server [None] \*/
 /\* ssh.languages\_server\_to\_client [None] \*/
#ifdef SSH\_DEBUG printf("[SSH] %s\n", buf);#endif
 return(buf\_out\_len);
invalid\_payload:
#ifdef SSH\_DEBUG printf("[SSH] Invalid packet payload\n");#endif
 return(0);}
/\* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \*/
static void ndpi\_ssh\_zap\_cr(char \*str, int len) { len--;
 while(len > 0) { if((str[len] == '\n') || (str[len] == '\r')) { str[len] = '\0'; len--; } else break; }}
/\* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \*/
static void ndpi\_search\_ssh\_tcp(struct ndpi\_detection\_module\_struct \*ndpi\_struct, struct ndpi\_flow\_struct \*flow) { struct ndpi\_packet\_struct \*packet = &flow->packet;
#ifdef SSH\_DEBUG printf("[SSH] %s()\n", \_\_FUNCTION\_\_);#endif
 if(flow->l4.tcp.ssh\_stage == 0) { if(packet->payload\_packet\_len > 7 && packet->payload\_packet\_len < 100 && memcmp(packet->payload, "SSH-", 4) == 0) { int len = ndpi\_min(sizeof(flow->protos.ssh.client\_signature)-1, packet->payload\_packet\_len);  strncpy(flow->protos.ssh.client\_signature, (const char \*)packet->payload, len); flow->protos.ssh.client\_signature[len] = '\0'; ndpi\_ssh\_zap\_cr(flow->protos.ssh.client\_signature, len); #ifdef SSH\_DEBUG printf("[SSH] [client\_signature: %s]\n", flow->protos.ssh.client\_signature);#endif   NDPI\_LOG\_DBG2(ndpi\_struct, "ssh stage 0 passed\n"); flow->l4.tcp.ssh\_stage = 1 + packet->packet\_direction; ndpi\_int\_ssh\_add\_connection(ndpi\_struct, flow); return; } } else if(flow->l4.tcp.ssh\_stage == (2 - packet->packet\_direction)) { if(packet->payload\_packet\_len > 7 && packet->payload\_packet\_len < 500 && memcmp(packet->payload, "SSH-", 4) == 0) { int len = ndpi\_min(sizeof(flow->protos.ssh.server\_signature)-1, packet->payload\_packet\_len);  strncpy(flow->protos.ssh.server\_signature, (const char \*)packet->payload, len); flow->protos.ssh.server\_signature[len] = '\0'; ndpi\_ssh\_zap\_cr(flow->protos.ssh.server\_signature, len); #ifdef SSH\_DEBUG printf("[SSH] [server\_signature: %s]\n", flow->protos.ssh.server\_signature);#endif  NDPI\_LOG\_DBG2(ndpi\_struct, "ssh stage 1 passed\n"); flow->guessed\_host\_protocol\_id = flow->guessed\_protocol\_id = NDPI\_PROTOCOL\_SSH; #ifdef SSH\_DEBUG printf("[SSH] [completed stage: %u]\n", flow->l4.tcp.ssh\_stage);#endif
 flow->l4.tcp.ssh\_stage = 3; return; } } else if(packet->payload\_packet\_len > 5) { u\_int8\_t msgcode = \*(packet->payload + 5); ndpi\_MD5\_CTX ctx;
 if(msgcode == 20 /\* key exchange init \*/) { char \*hassh\_buf = calloc(packet->payload\_packet\_len, sizeof(char)); u\_int i, len;
#ifdef SSH\_DEBUG printf("[SSH] [stage: %u][msg: %u][direction: %u][key exchange init]\n", flow->l4.tcp.ssh\_stage, msgcode, packet->packet\_direction);#endif
 if(hassh\_buf) { if(packet->packet\_direction == 0 /\* client \*/) { u\_char fingerprint\_client[16];
 len = concat\_hash\_string(packet, hassh\_buf, 1 /\* client \*/);
 ndpi\_MD5Init(&ctx); ndpi\_MD5Update(&ctx, (const unsigned char \*)hassh\_buf, len); ndpi\_MD5Final(fingerprint\_client, &ctx);
#ifdef SSH\_DEBUG { printf("[SSH] [client][%s][", hassh\_buf); for(i=0; i<16; i++) printf("%02X", fingerprint\_client[i]); printf("]\n"); }#endif for(i=0; i<16; i++) sprintf(&flow->protos.ssh.hassh\_client[i\*2], "%02X", fingerprint\_client[i] & 0xFF); flow->protos.ssh.hassh\_client[32] = '\0'; } else { u\_char fingerprint\_server[16];
 len = concat\_hash\_string(packet, hassh\_buf, 0 /\* server \*/);
 ndpi\_MD5Init(&ctx); ndpi\_MD5Update(&ctx, (const unsigned char \*)hassh\_buf, len); ndpi\_MD5Final(fingerprint\_server, &ctx);
#ifdef SSH\_DEBUG { printf("[SSH] [server][%s][", hassh\_buf); for(i=0; i<16; i++) printf("%02X", fingerprint\_server[i]); printf("]\n"); }#endif
 for(i=0; i<16; i++) sprintf(&flow->protos.ssh.hassh\_server[i\*2], "%02X", fingerprint\_server[i] & 0xFF); flow->protos.ssh.hassh\_server[32] = '\0'; }
 ndpi\_free(hassh\_buf); }
 ndpi\_int\_ssh\_add\_connection(ndpi\_struct, flow); }
 if((flow->protos.ssh.hassh\_client[0] != '\0') && (flow->protos.ssh.hassh\_server[0] != '\0')) {#ifdef SSH\_DEBUG printf("[SSH] Dissection completed\n");#endif flow->extra\_packets\_func = NULL; /\* We're good now \*/ }
 return; }
#ifdef SSH\_DEBUG printf("[SSH] Excluding SSH");#endif
 NDPI\_LOG\_DBG(ndpi\_struct, "excluding ssh at stage %d\n", flow->l4.tcp.ssh\_stage); NDPI\_ADD\_PROTOCOL\_TO\_BITMASK(flow->excluded\_protocol\_bitmask, NDPI\_PROTOCOL\_SSH);}
/\* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \*/
void init\_ssh\_dissector(struct ndpi\_detection\_module\_struct \*ndpi\_struct, u\_int32\_t \*id, NDPI\_PROTOCOL\_BITMASK \*detection\_bitmask){ ndpi\_set\_bitmask\_protocol\_detection("SSH", ndpi\_struct, detection\_bitmask, \*id, NDPI\_PROTOCOL\_SSH, ndpi\_search\_ssh\_tcp, NDPI\_SELECTION\_BITMASK\_PROTOCOL\_V4\_V6\_TCP\_WITH\_PAYLOAD\_WITHOUT\_RETRANSMISSION, SAVE\_DETECTION\_BITMASK\_AS\_UNKNOWN, ADD\_TO\_DETECTION\_BITMASK);
 \*id += 1;}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


