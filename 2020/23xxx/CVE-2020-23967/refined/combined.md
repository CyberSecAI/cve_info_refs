=== Content from amonitoring.ru_e49f5470_20250119_124020.html ===
![](/8c528003abe70b319a120129a04e9cfb.gif)

[![](/local/templates/amonitoring/img/logo.png)](/)

ПЕРСПЕКТИВНЫЙ
МОНИТОРИНГ

[Сообщить об инциденте](/incident/)

Найти

 +7 495 737-61-97

 info@amonitoring.ru

* [Компания](/about/)
* [Новости](/news/)
* [Услуги](/service/)
* [Продукты](/product/)
* [Статьи](/article/)
* [Карьера](/vacancy/)
* [Контакты](/contact/)

Сообщить об инциденте

Найти

 +7 495 737-61-97

 info@amonitoring.ru

#

[Статьи](/article/)
 > Local privilege escalation in Dr.Web Security Space
![](/upload/iblock/807/a62d2d9039df4829ee6e772fa2be28c2.svg)

07.07.2020
# Local privilege escalation in Dr.Web Security Space

Another article about local privilege escalation. Previously on this series: Steam ([CVE-2019-14743](/article/steamclient-0day/), CVE-2019-15316, [CVE-2019-17180](/article/onemore_steam_eop_0day/)), [Origin](/article/origin_lpe_disclosure/) (CVE-2019-19247, CVE-2019-19248), [ABBYY FineReader](/article/abbyy-lpe/) (CVE-2019-20383).

This is a short paper with technical details of exploitation. A little bit more information about research in Russian article — <https://habr.com/ru/509592/>.

Video of exploitation with time-based comments:

Demo stand for exploitation is Windows 10 x64, active user has no administrative privileges.

0:00-0:12 Open Windows console and check that active user has no administrative privileges

0:12-0:24 Show actual version of installed Dr.Web Security Space

0:24-0:29 There is a file drweb\_eop\_upd\_dll.dll at user’s desktop (this file and its source code were attached to report for vendor)

0:29-0:34 Show that the directory C:\ProgramData\Doctor Web\Updater\etc contains only 3 files.

0:34-0:47 Copy drweb\_eop\_upd\_dll.dll twice. One is renamed to version.dll, another to cryptui.dll

0:47-0:56 Copy an executable file C:\Program Files\Common Files\Doctor Web\Updater\drwupsrv.exe to the directory with dlls.

0:56-1:00 Start the executable.

When drwupsrv.exe starts, it loads version.dll from its startup directory. The dll creates file C:\ProgramData\Doctor Web\Updater\etc\drwupsrv.xml.new. A user is allowed to create files and folders at path C:\ProgramData due to a special permissive ACL. When the user is to create a file manually (for example, from explorer's context menu), it seems that the Dr.Web Security Space mechanisms restricts the operation in that directory. During the attack, all operations are requested from legit Dr.Web executable called drwupsrv.exe, so the restriction might be bypassed.

1:00-1:22 Show created file and its content. This is the same file as C:\ProgramData\Doctor Web\Updater\etc\drwupsrv.xml, but all paths are changed to the user-controlled folder (C:\Users\User\Desktop\dwtest).

1:22-2:00 Nothing happens (awaiting auto-update that happens every 30 minutes by default).

2:00-2:14 It seems that updater reads created file as a config and tries to update product in the user-controlled folder. Since there is no anything related to product, updater starts to copy whole product to the folder.

Among the files, there is a file named dwservice.exe (placed at user-controlled folder), that starts during updating process with NT AUTHORITY\SYSTEM privilege. The file loads cryptui.dll that was planted at the very beginning. The dll just spawns an interactive console. Show rights via whoami command.

**Timeline**:

15.05.2020 – Ask for vendor’s security-contact

20.05.2020 – Vendor permits send report due to support ticket

20.05.2020 – Report sent

14.06.2020 – Vendor says that fix for Dr.Web Security Space 12 are available. Request time for fix Dr.Web Security Space 11.

07.07.2020 – Vendor says that all fixes are released.

## About author

Vasily Kravets, Lead Expert

mailto:xi-tauw@xi-tauw.info

mailto:Vasily.Kravets@amonitoring.ru

<https://twitter.com/PsiDragon>

<https://t.me/xitauw>

 Теги:
[Dr Web](/article/?tag=Dr Web)
[lpe](/article/?tag=lpe)

Поделиться статьей в:

Рекомендуемые статьи
![](/upload/iblock/bc8/a62d2d9039df4829ee6e772fa2be28c2.svg)

19.02.2020
Recognizing local privilege escalation in ABBYY FineReader
[Читать](/article/abbyy-lpe/)

![](/upload/iblock/32f/a62d2d9039df4829ee6e772fa2be28c2.svg)

11.12.2019
Local privilege escalation in EA Windows Origin Client (CVE-2019-19247 & CVE-2019-19248)
[Читать](/article/origin_lpe_disclosure/)

![](/upload/iblock/e75/a62d2d9039df4829ee6e772fa2be28c2.svg)

01.10.2019 09:20:00
Third Steam Windows Client vulnerability, but not 0day
[Читать](/article/steam_vuln_3/)

[О нас](/about/)

* [Компания](/about/)
* [Вакансии](/vacancy/)
* [Контакты](/contact/)
* [Скачать результаты СОУТ](/about/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%A1%D0%9E%D0%A3%D0%A2_%20%D0%90%D0%9E_%D0%9F%D0%9C_2022%D0%B3..pdf)

Услуги

* [Центр мониторинга компьютерных атак](/service/security-operation-center/)
* [Разработка правил Snort IDS](/service/snort/)
* [Расследование компьютерных инцидентов](/service/forensics/)
* [Соответствие требованиям по ИБ](/service/compliance/)
* [Анализ защищённости](/service/security-analysis/)
* [Пентесты](/service/pentest/)
* [Управление инцидентами ИБ](/service/incident-management/)
* [ГосСОПКА](/service/gossopka/)

Написать нам

Имя

Email

Письмо

Введите код с картинки   ![CAPTCHA](/bitrix/tools/captcha.php?captcha_sid=0efa5261a376df0ca0f93309fbff0c6f)

Отправляя данную форму вы соглашаетесь с [политикой конфиденциальности](/privacy-policy/)

 2025

\*Мы не спамим и не подписываем на рассылку

Быстро ответим только с 9 до 18 по Москве.

В противном случае — на следующий день.

Введите код с картинки

![CAPTCHA](/bitrix/tools/captcha.php?captcha_sid=0141e331542b0741174d09650ca8e641)

Отправляя данную форму вы соглашаетесь

Сообщение отправлено.

Спасибо, мы с вами обязательно свяжемся.

OK

![](https://mc.yandex.ru/watch/15525343)



=== Content from habr.com_dfd66a08_20250119_124020.html ===

[Хабр](/ru/)βОткрыть список[Как стать автором](/ru/sandbox/start/)[Моя лента](/ru/feed/)[Все потоки](/ru/articles/)[Разработка](/ru/flows/develop/)[Администрирование](/ru/flows/admin/)[Дизайн](/ru/flows/design/)[Менеджмент](/ru/flows/management/)[Маркетинг](/ru/flows/marketing/)[Научпоп](/ru/flows/popsci/)[Поиск](/ru/search/)Написать публикациюНастройки[Войти](https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/pm/articles/509592/&hl=ru)Обновить[![](//habrastorage.org/getpro/habr/company/08d/44e/4b5/08d44e4b5fe243f4b59b05b2139569fb.png)](/ru/companies/pm/profile/)59.84Рейтинг[Перспективный мониторинг](/ru/companies/pm/profile/)Подписаться[![](https://assets.habr.com/habr-web/img/avatars/120.png)](/ru/users/xi-tauw/ "xi-tauw")[xi-tauw](/ru/users/xi-tauw/) 8 июл 2020 в 11:10
# От комментария на Хабре к уязвимости в антивирусе Dr. Web

Время на прочтение3 минКоличество просмотров24K[Блог компании Перспективный мониторинг](/ru/companies/pm/articles/)[Информационная безопасность\*](/ru/hubs/infosecurity/)Относительно недавно на хабре появилась статья [«Стилер паролей в антивирусном ПО Avira Free Antivirus»](https://habr.com/ru/post/500852/) от пользователя [Veliant](https://habr.com/ru/users/veliant/). Автор обнаружил, что в стандартной поставке упомянутого антивируса присутствует компонент, который позволяет простым образом извлечь пароли из хранилища браузера Chrome.

В комментариях произошла дискуссия, можно ли считать это уязвимостью. Но меня зацепил один комментарий автора:
> нельзя ли это было реализовать например в виде DLL, которая при вызове её API проверяла бы цифровую подпись вызывающей программы?

Дело в том, что буквально перед этим я исследовал несколько программ, которые точно так же полагались на проверку цифровой подписи. И такую проверку было очень легко обойти.

![](https://habrastorage.org/r/w1560/webt/6i/7e/f6/6i7ef6mqbmgqkbn_1a-mdnzpxpq.png)Теги:

* [dr web](/ru/search/?target_type=posts&order=relevance&q=[dr+web])
* [eop](/ru/search/?target_type=posts&order=relevance&q=[eop])
* [lpe](/ru/search/?target_type=posts&order=relevance&q=[lpe])
* [уязвимость](/ru/search/?target_type=posts&order=relevance&q=[%D1%83%D1%8F%D0%B7%D0%B2%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C])
* [антивирус](/ru/search/?target_type=posts&order=relevance&q=[%D0%B0%D0%BD%D1%82%D0%B8%D0%B2%D0%B8%D1%80%D1%83%D1%81])
Хабы:

* [Блог компании Перспективный мониторинг](/ru/companies/pm/articles/)
* [Информационная безопасность](/ru/hubs/infosecurity/)
Всего голосов 79: ↑78 и ↓1+101Добавить в закладки45[Комментарии43](/ru/companies/pm/articles/509592/comments/)[![](//habrastorage.org/getpro/habr/company/08d/44e/4b5/08d44e4b5fe243f4b59b05b2139569fb.png)](/ru/companies/pm/profile/)[Перспективный мониторинг](/ru/companies/pm/profile/)Компания[Сайт](https://amonitoring.ru)[Сайт](https://ampire.team)[Telegram](https://telegram.me/pm_public)[Сайт](https://www.youtube.com/%40AMonitoring)[![](https://assets.habr.com/habr-web/img/avatars/120.png)](/ru/users/xi-tauw/)105Карма0.1РейтингКравец Василий [@xi-tauw](/ru/users/xi-tauw/)

Windows Privilege Escalator

ПодписатьсяОтправить сообщение[ВКонтакте](https://vk.com/xitauw)[Telegram](https://telegram.me/xitauw)[Комментарии Комментарии 43](/ru/companies/pm/articles/509592/comments/)
## Публикации

Лучшие за суткиПохожие

## Информация

Сайт[amonitoring.ru](https://amonitoring.ru)Дата регистрации5 апреля 2017Дата основания11 декабря 2011Численность101–200 человекМестоположениеРоссия
## Истории

Ваш аккаунт

* [Войти](/kek/v1/auth/habrahabr/?back=/ru/companies/pm/articles/509592/&hl=ru)
* [Регистрация](/kek/v1/auth/habrahabr-register/?back=/ru/companies/pm/articles/509592/&hl=ru)

Разделы

* [Статьи](/ru/articles/)
* [Новости](/ru/news/)
* [Хабы](/ru/hubs/)
* [Компании](/ru/companies/)
* [Авторы](/ru/users/)
* [Песочница](/ru/sandbox/)

Информация

* [Устройство сайта](/ru/docs/help/)
* [Для авторов](/ru/docs/authors/codex/)
* [Для компаний](/ru/docs/companies/corpblogs/)
* [Документы](/ru/docs/docs/transparency/)
* [Соглашение](https://account.habr.com/info/agreement/?hl=ru_RU)
* [Конфиденциальность](https://account.habr.com/info/confidential/?hl=ru_RU)

Услуги

* [Корпоративный блог](https://company.habr.com/ru/corporate-blogs/)
* [Медийная реклама](https://company.habr.com/ru/advertising/)
* [Нативные проекты](https://company.habr.com/ru/native-special/)
* [Образовательные программы](https://company.habr.com/ru/education-programs/)
* [Стартапам](https://company.habr.com/ru/hello-startup/)
[Facebook](https://www.facebook.com/habrahabr.ru)[Twitter](https://twitter.com/habr_com)[VK](https://vk.com/habr)[Telegram](https://telegram.me/habr_com)[Youtube](https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w)[Яндекс Дзен](https://dzen.ru/habr) Настройка языка[Техническая поддержка](/ru/feedback/)© 2006–2025, [Habr](https://company.habr.com/)

![](https://mc.yandex.ru/watch/24049213)


