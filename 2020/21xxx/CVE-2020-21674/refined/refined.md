The provided content relates to CVE-2020-21674.

**Root cause of vulnerability:**
- The vulnerability lies in the `archive_string_append_from_wcs()` function in `archive_string.c`. Specifically, when growing the `archive_string` buffer, the code did not ensure that enough space was allocated to accommodate at least one maximum-sized multibyte character, according to the current locale, plus the null terminator.

**Weaknesses/vulnerabilities present:**
- Heap-buffer-overflow: A heap-buffer-overflow occurs when `archive_string_append_from_wcs` attempts to write a null terminator (`\0`) beyond the allocated memory for the archive string buffer. This occurs after appending a wide character string.

**Impact of exploitation:**
- Crash: The heap-buffer-overflow leads to a crash due to an out-of-bounds write.
- Potential for other impacts (not fully elaborated in the issue, but typically possible with heap overflows): Depending on the context, more severe issues like code execution might be achievable.

**Attack vectors:**
- A specially crafted archive file can trigger the vulnerability when processed by `bsdtar` or similar tools using `libarchive`.
- The attacker needs to create a malformed archive with wide character strings that when processed with `archive_string_append_from_wcs()` lead to writing past the allocated buffer.

**Required attacker capabilities/position:**
- The attacker must be able to provide a malicious archive file to the vulnerable `libarchive` library.

**Additional details:**
- The vulnerability was discovered via fuzzing.
- The issue report includes a crash-file.zip containing a file to reproduce the issue.
- The provided code diff shows the fix for the issue where `archive_string_ensure` now uses `max(len * 2, (size_t)MB_CUR_MAX)` to determine the buffer size, ensuring enough space is available for multibyte characters.