=== Content from access.redhat.com_b66c68e6_20250126_101543.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.kernel.org_01259281_20250125_162541.html ===
commit b67be2a5c9ed3f101e1562a9efe160b368000f89
Author: Greg Kroah-Hartman
Date: Sat May 12 10:08:37 2012 -0700
Linux 3.3.6
commit 59da83377222910347425ec225cf3a665e0c8e1b
Author: Alan Stern
Date: Thu Apr 26 11:31:57 2012 -0400
usb: gadget: udc-core: fix incompatibility with dummy-hcd
commit 320cd1e750f1bf3e47eb41209dcb2be07264cb76 upstream.
This patch (as1548) fixes a recently-introduced incompatibility
between the UDC core and the dummy-hcd driver. Commit
8ae8090c82eb407267001f75b3d256b3bd4ae691 (usb: gadget: udc-core: fix
asymmetric calls in remove\_driver) moved the usb\_gadget\_udc\_stop()
call in usb\_gadget\_remove\_driver() below the usb\_gadget\_disconnect()
call.
As a result, usb\_gadget\_disconnect() gets called at a time when the
gadget driver believes it has been unbound but dummy-hcd believes
it has not. A nasty error ensues when dummy-hcd calls the gadget
driver's disconnect method a second time.
To fix the problem, this patch moves the gadget driver's unbind
notification after the usb\_gadget\_disconnect() call. Now nothing
happens between the two unbind notifications, so nothing goes wrong.
Signed-off-by: Alan Stern
Tested-by: Alexander Shishkin
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 804596fcfa2946ea83737346290f806651cd69ea
Author: Felipe Balbi
Date: Fri Apr 27 11:02:15 2012 +0300
usb: gadget: udc-core: fix wrong call order
commit 83a787a71e034244a9fd1d5988fe18f226341417 upstream.
commit 6d258a4 (usb: gadget: udc-core: stop UDC on device-initiated
disconnect) introduced another case of asymmetric calls when issuing
a device-initiated disconnect. Fix it.
Reported-by: Ben Hutchings
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit f3d426d5b791e91a0c515ac8f9dbf9e16dc439e6
Author: Will Deacon
Date: Fri Apr 20 17:22:11 2012 +0100
ARM: 7398/1: l2x0: only write to debug registers on PL310
commit ab4d536890853ab6675ede65db40e2c0980cb0ea upstream.
PL310 errata #588369 and #727915 require writes to the debug registers
of the cache controller to work around known problems. Writing these
registers on L220 may cause deadlock, so ensure that we only perform
this operation when we identify a PL310 at probe time.
Signed-off-by: Will Deacon
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit c2fa9282ae75212b61077b274bf69d89890362e5
Author: Will Deacon
Date: Fri Apr 20 17:21:08 2012 +0100
ARM: 7397/1: l2x0: only apply workaround for erratum #753970 on PL310
commit f154fe9b806574437b47f08e924ad10c0e240b23 upstream.
The workaround for PL310 erratum #753970 can lead to deadlock on systems
with an L220 cache controller.
This patch makes the workaround effective only when the cache controller
is identified as a PL310 at probe time.
Signed-off-by: Will Deacon
Signed-off-by: Russell King
[bwh: Backported to 3.2: adjust context]
Signed-off-by: Ben Hutchings
Signed-off-by: Greg Kroah-Hartman
commit 502fd05d816f4a74a1a7bb45896ba35a33f8da10
Author: J. Bruce Fields
Date: Mon Apr 9 18:06:49 2012 -0400
nfsd: don't fail unchecked creates of non-special files
commit 9dc4e6c4d1182d34604ea40fef641775f5b15456 upstream.
Allow a v3 unchecked open of a non-regular file succeed as if it were a
lookup; typically a client in such a case will want to fall back on a
local open, so succeeding and giving it the filehandle is more useful
than failing with nfserr\_exist, which makes it appear that nothing at
all exists by that name.
Similarly for v4, on an open-create, return the same errors we would on
an attempt to open a non-regular file, instead of returning
nfserr\_exist.
This fixes a problem found doing a v4 open of a symlink with
O\_RDONLY|O\_CREAT, which resulted in the current client returning EEXIST.
Thanks also to Trond for analysis.
Reported-by: Orion Poplawski
Tested-by: Orion Poplawski
Signed-off-by: J. Bruce Fields
[bwh: Backported to 3.2 and 3.3: use &resfh, not resfh]
Signed-off-by: Ben Hutchings
Signed-off-by: Greg Kroah-Hartman
commit b9d36778c87e927d3272b2bb8beadc2c07ee8fa6
Author: Greg Kroah-Hartman
Date: Thu Apr 12 08:47:05 2012 +0200
block: mtip32xx: remove HOTPLUG\_PCI\_PCIE dependancy
commit 63634806519b49bb43f37e53a1e8366eb3e846a4 upstream.
This removes the HOTPLUG\_PCI\_PCIE dependency on the driver and makes it
depend on PCI.
Cc: Sam Bradshaw
Signed-off-by: Greg Kroah-Hartman
Acked-by: Asai Thambi S P
Signed-off-by: Jens Axboe
commit 24041232df8a8e96113ddd1f83a58f552f1f5968
Author: Ryosuke Saito
Date: Thu Apr 5 08:09:34 2012 -0600
mtip32xx: fix error handling in mtip\_init()
commit 6d27f09a6398ee086b11804aa3a16609876f0c7c upstream.
Ensure that block device is properly unregistered, if
pci\_register\_driver() fails.
Signed-off-by: Ryosuke Saito
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 633935add06d8deb9fb2879fd06bbfd9df7e1a89
Author: Asai Thambi S P
Date: Fri Mar 23 12:33:03 2012 +0100
mtip32xx: fix incorrect value set for drv\_cleanup\_done, and re-initialize and start port in mtip\_restart\_port()
commit 22be2e6e13ac09b20000582ac34d47fb0029a6da upstream.
This patch includes two changes:
\* fix incorrect value set for drv\_cleanup\_done
\* re-initialize and start port in mtip\_restart\_port()
Signed-off-by: Asai Thambi S P
Signed-off-by: Sam Bradshaw
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit c6e143d5d46c8c84247c5ca9202c4d677a6162a7
Author: David Gibson
Date: Wed Mar 21 16:34:12 2012 -0700
hugepages: fix use after free bug in "quota" handling
commit 90481622d75715bfcb68501280a917dbfe516029 upstream.
hugetlbfs\_{get,put}\_quota() are badly named. They don't interact with the
general quota handling code, and they don't much resemble its behaviour.
Rather than being about maintaining limits on on-disk block usage by
particular users, they are instead about maintaining limits on in-memory
page usage (including anonymous MAP\_PRIVATE copied-on-write pages)
associated with a particular hugetlbfs filesystem instance.
Worse, they work by having callbacks to the hugetlbfs filesystem code from
the low-level page handling code, in particular from free\_huge\_page().
This is a layering violation of itself, but more importantly, if the
kernel does a get\_user\_pages() on hugepages (which can happen from KVM
amongst others), then the free\_huge\_page() can be delayed until after the
associated inode has already been freed. If an unmount occurs at the
wrong time, even the hugetlbfs superblock where the "quota" limits are
stored may have been freed.
Andrew Barry proposed a patch to fix this by having hugepages, instead of
storing a pointer to their address\_space and reaching the superblock from
there, had the hugepages store pointers directly to the superblock,
bumping the reference count as appropriate to avoid it being freed.
Andrew Morton rejected that version, however, on the grounds that it made
the existing layering violation worse.
This is a reworked version of Andrew's patch, which removes the extra, and
some of the existing, layering violation. It works by introducing the
concept of a hugepage "subpool" at the lower hugepage mm layer - that is a
finite logical pool of hugepages to allocate from. hugetlbfs now creates
a subpool for each filesystem instance with a page limit set, and a
pointer to the subpool gets added to each allocated hugepage, instead of
the address\_space pointer used now. The subpool has its own lifetime and
is only freed once all pages in it \_and\_ all other references to it (i.e.
superblocks) are gone.
subpools are optional - a NULL subpool pointer is taken by the code to
mean that no subpool limits are in effect.
Previous discussion of this bug found in: "Fix refcounting in hugetlbfs
quota handling.". See: https://lkml.org/lkml/2011/8/11/28 or
http://marc.info/?l=linux-mm&m=126928970510627&w=1
v2: Fixed a bug spotted by Hillf Danton, and removed the extra parameter to
alloc\_huge\_page() - since it already takes the vma, it is not necessary.
Signed-off-by: Andrew Barry
Signed-off-by: David Gibson
Cc: Hugh Dickins
Cc: Mel Gorman
Cc: Minchan Kim
Cc: Hillf Danton
Cc: Paul Mackerras
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 0b518e8f62e2e1436c6506fd44f13894dc87b281
Author: Josh Boyer
Date: Wed Nov 2 14:32:00 2011 -0400
sony-laptop: Enable keyboard backlight by default
commit 6fe6ae56a7cebaebc2e6daa11c423e4692f9b592 upstream.
When the keyboard backlight support was originally added, the commit said
to default it to on with a 10 second timeout. That actually wasn't the
case, as the default value is commented out for the kbd\_backlight parameter.
Because it is a static variable, it gets set to 0 by default without some
other form of initialization.
However, it seems the function to set the value wasn't actually called
immediately, so whatever state the keyboard was in initially would remain.
Then commit df410d522410e67660 was introduced during the 2.6.39 timeframe to
immediately set whatever value was present (as well as attempt to
restore/reset the state on module removal or resume). That seems to have
now forced the light off immediately when the module is loaded unless
the option kbd\_backlight=1 is specified.
Let's enable it by default again (for the first time). This should solve
https://bugzilla.redhat.com/show\_bug.cgi?id=728478
Signed-off-by: Josh Boyer
Acked-by: Mattia Dongili
Signed-off-by: Matthew Garrett
Cc: maximilian attems
Signed-off-by: Greg Kroah-Hartman
commit fecc7cbae16b25401cd6d53dda8fb8fcc1b1ec4f
Author: Alex Williamson
Date: Wed May 9 16:10:47 2012 +0300
KVM: lock slots\_lock around device assignment
(cherry picked from commit 21a1416a1c945c5aeaeaf791b63c64926018eb77)
As pointed out by Jason Baron, when assigning a device to a guest
we first set the iommu domain pointer, which enables mapping
and unmapping of memory slots to the iommu. This leaves a window
where this path is enabled, but we haven't synchronized the iommu
mappings to the existing memory slots. Thus a slot being removed
at that point could send us down unexpected code paths removing
non-existent pinnings and iommu mappings. Take the slots\_lock
around creating the iommu domain and initial mappings as well as
around iommu teardown to avoid this race.
Signed-off-by: Alex Williamson
Signed-off-by: Marcelo Tosatti
Signed-off-by: Greg Kroah-Hartman
commit a4dfde33d7f8448d65d066392ecccbbf50d55fd8
Author: Avi Kivity
Date: Wed May 9 16:10:46 2012 +0300
KVM: VMX: Fix kvm\_set\_shared\_msr() called in preemptible context
(cherry picked from commit 2225fd56049643c1a7d645c0ce9d499d43c7974e)
kvm\_set\_shared\_msr() may not be called in preemptible context,
but vmx\_set\_msr() does so:
BUG: using smp\_processor\_id() in preemptible [00000000] code: qemu-kvm/22713
caller is kvm\_set\_shared\_msr+0x32/0xa0 [kvm]
Pid: 22713, comm: qemu-kvm Not tainted 3.4.0-rc3+ #39
Call Trace:
[] debug\_smp\_processor\_id+0xe2/0x100
[] kvm\_set\_shared\_msr+0x32/0xa0 [kvm]
[] vmx\_set\_msr+0x28b/0x2d0 [kvm\_intel]
...
Making kvm\_set\_shared\_msr() work in preemptible is cleaner, but
it's used in the fast path. Making two variants is overkill, so
this patch just disables preemption around the call.
Reported-by: Dave Jones
Signed-off-by: Avi Kivity
Signed-off-by: Marcelo Tosatti
Signed-off-by: Greg Kroah-Hartman
commit 8a4a30bf172a05f53714f0f54af2e044a6ede7a8
Author: Marcelo Tosatti
Date: Wed May 9 16:10:45 2012 +0300
KVM: VMX: vmx\_set\_cr0 expects kvm->srcu locked
(cherry picked from commit 7a4f5ad051e02139a9f1c0f7f4b1acb88915852b)
vmx\_set\_cr0 is called from vcpu run context, therefore it expects
kvm->srcu to be held (for setting up the real-mode TSS).
Signed-off-by: Marcelo Tosatti
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit 8dd2cb2a8d183d59f6d41dd71db550a306cc55eb
Author: Nadav Har'El
Date: Wed May 9 16:10:44 2012 +0300
KVM: nVMX: Fix erroneous exception bitmap check
(cherry picked from commit 9587190107d0c0cbaccbf7bf6b0245d29095a9ae)
The code which checks whether to inject a pagefault to L1 or L2 (in
nested VMX) was wrong, incorrect in how it checked the PF\_VECTOR bit.
Thanks to Dan Carpenter for spotting this.
Signed-off-by: Nadav Har'El
Reported-by: Dan Carpenter
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit 044873c9fc637a88225f0e01bedb9daee04524ed
Author: Avi Kivity
Date: Wed May 9 16:10:43 2012 +0300
KVM: VMX: Fix delayed load of shared MSRs
(cherry picked from commit 9ee73970c03edb68146ceb1ba2a7033c99a5e017)
Shared MSRs (MSR\_\*STAR and related) are stored in both vmx->guest\_msrs
and in the CPU registers, but vmx\_set\_msr() only updated memory. Prior
to 46199f33c2953, this didn't matter, since we called vmx\_load\_host\_state(),
which scheduled a vmx\_save\_host\_state(), which re-synchronized the CPU
state, but now we don't, so the CPU state will not be synchronized until
the next exit to host userspace. This mostly affects nested vmx workloads,
which play with these MSRs a lot.
Fix by loading the MSR eagerly.
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit 9c895160d25a76c21b65bad141b08e8d4f99afef
Author: Avi Kivity
Date: Wed May 9 16:10:42 2012 +0300
KVM: Ensure all vcpus are consistent with in-kernel irqchip settings
(cherry picked from commit 3e515705a1f46beb1c942bb8043c16f8ac7b1e9e)
If some vcpus are created before KVM\_CREATE\_IRQCHIP, then
irqchip\_in\_kernel() and vcpu->arch.apic will be inconsistent, leading
to potential NULL pointer dereferences.
Fix by:
- ensuring that no vcpus are installed when KVM\_CREATE\_IRQCHIP is called
- ensuring that a vcpu has an apic if it is installed after KVM\_CREATE\_IRQCHIP
This is somewhat long winded because vcpu->arch.apic is created without
kvm->lock held.
Based on earlier patch by Michael Ellerman.
Signed-off-by: Michael Ellerman
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit c1cca0b1b79ba339d040793ad70fad254e1af220
Author: Gleb Natapov
Date: Wed May 9 16:10:41 2012 +0300
KVM: x86 emulator: correctly mask pmc index bits in RDPMC instruction emulation
(cherry picked from commit 270c6c79f4e15e599f47174ecedad932463af7a2)
Signed-off-by: Gleb Natapov
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit 6429d8675607e080deb716830f97ee0e78c991df
Author: Takuya Yoshikawa
Date: Wed May 9 16:10:40 2012 +0300
KVM: mmu\_notifier: Flush TLBs before releasing mmu\_lock
(cherry picked from commit 565f3be2174611f364405bbea2d86e153c2e7e78)
Other threads may process the same page in that small window and skip
TLB flush and then return before these functions do flush.
Signed-off-by: Takuya Yoshikawa
Signed-off-by: Marcelo Tosatti
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit 87a6c3e2b97b6556a7184a198d7b862b101c24cd
Author: Takuya Yoshikawa
Date: Wed May 9 16:10:39 2012 +0300
KVM: Fix write protection race during dirty logging
(cherry picked from commit 6dbf79e7164e9a86c1e466062c48498142ae6128)
This patch fixes a race introduced by:
commit 95d4c16ce78cb6b7549a09159c409d52ddd18dae
KVM: Optimize dirty logging by rmap\_write\_protect()
During protecting pages for dirty logging, other threads may also try
to protect a page in mmu\_sync\_children() or kvm\_mmu\_get\_page().
In such a case, because get\_dirty\_log releases mmu\_lock before flushing
TLB's, the following race condition can happen:
A (get\_dirty\_log) B (another thread)
lock(mmu\_lock)
clear pte.w
unlock(mmu\_lock)
lock(mmu\_lock)
pte.w is already cleared
unlock(mmu\_lock)
skip TLB flush
return
...
TLB flush
Though thread B assumes the page has already been protected when it
returns, the remaining TLB entry will break that assumption.
This patch fixes this problem by making get\_dirty\_log hold the mmu\_lock
until it flushes the TLB's.
Signed-off-by: Takuya Yoshikawa
Signed-off-by: Marcelo Tosatti
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit f6a0ce750df3fd54adbdbfbaf9f0736763f4f7ac
Author: Christian Borntraeger
Date: Wed May 9 16:10:38 2012 +0300
KVM: s390: Sanitize fpc registers for KVM\_SET\_FPU
(cherry picked from commit 851755871c1f3184f4124c466e85881f17fa3226)
commit 7eef87dc99e419b1cc051e4417c37e4744d7b661 (KVM: s390: fix
register setting) added a load of the floating point control register
to the KVM\_SET\_FPU path. Lets make sure that the fpc is valid.
Signed-off-by: Christian Borntraeger
Signed-off-by: Marcelo Tosatti
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit bb5f011a9b907e646904289c79f250b3aa17d57a
Author: Jens Freimann
Date: Wed May 9 16:10:37 2012 +0300
KVM: s390: do store status after handling STOP\_ON\_STOP bit
(cherry picked from commit 9e0d5473e2f0ba2d2fe9dab9408edef3060b710e)
In handle\_stop() handle the stop bit before doing the store status as
described for "Stop and Store Status" in the Principles of Operation.
We have to give up the local\_int.lock before calling kvm store status
since it calls gmap\_fault() which might sleep. Since local\_int.lock
only protects local\_int.\* and not guest memory we can give up the lock.
Signed-off-by: Jens Freimann
Signed-off-by: Christian Borntraeger
Signed-off-by: Marcelo Tosatti
Signed-off-by: Avi Kivity
Signed-off-by: Greg Kroah-Hartman
commit 3b50cf3c908f2d025617f3e593c132fdfbc0eb4b
Author: Alexander Duyck
Date: Tue Feb 7 02:29:01 2012 +0000
net: Fix issue with netdev\_tx\_reset\_queue not resetting queue from XOFF state
[ Upstream commit 5c4903549c05bbb373479e0ce2992573c120654a ]
We are seeing dev\_watchdog hangs on several drivers. I suspect this is due
to the \_\_QUEUE\_STATE\_STACK\_XOFF bit being set prior to a reset for link
change, and then not being cleared by netdev\_tx\_reset\_queue. This change
corrects that.
In addition we were seeing dev\_watchdog hangs on igb after running the
ethtool tests. We found this to be due to the fact that the ethtool test
runs the same logic as ndo\_start\_xmit, but we were never clearing the XOFF
flag since the loopback test in ethtool does not do byte queue accounting.
Signed-off-by: Alexander Duyck
Tested-by: Stephen Ko
Signed-off-by: Jeff Kirsher
Signed-off-by: Greg Kroah-Hartman
commit 4680d7ad59b1aeab6bd04d326523cf8e6b305f02
Author: Alexander Duyck
Date: Tue Feb 7 02:29:06 2012 +0000
net: Add memory barriers to prevent possible race in byte queue limits
[ Upstream commit b37c0fbe3f6dfba1f8ad2aed47fb40578a254635 ]
This change adds a memory barrier to the byte queue limit code to address a
possible race as has been seen in the past with the
netif\_stop\_queue/netif\_wake\_queue logic.
Signed-off-by: Alexander Duyck
Tested-by: Stephen Ko
Signed-off-by: Jeff Kirsher
Signed-off-by: Greg Kroah-Hartman
commit 4f3f1e28d64084bae113cf9d3ca516bdc43046ad
Author: Eric Dumazet
Date: Wed May 2 02:28:41 2012 +0000
tcp: change tcp\_adv\_win\_scale and tcp\_rmem[2]
[ Upstream commit b49960a05e32121d29316cfdf653894b88ac9190 ]
tcp\_adv\_win\_scale default value is 2, meaning we expect a good citizen
skb to have skb->len / skb->truesize ratio of 75% (3/4)
In 2.6 kernels we (mis)accounted for typical MSS=1460 frame :
1536 + 64 + 256 = 1856 'estimated truesize', and 1856 \* 3/4 = 1392.
So these skbs were considered as not bloated.
With recent truesize fixes, a typical MSS=1460 frame truesize is now the
more precise :
2048 + 256 = 2304. But 2304 \* 3/4 = 1728.
So these skb are not good citizen anymore, because 1460 < 1728
(GRO can escape this problem because it build skbs with a too low
truesize.)
This also means tcp advertises a too optimistic window for a given
allocated rcvspace : When receiving frames, sk\_rmem\_alloc can hit
sk\_rcvbuf limit and we call tcp\_prune\_queue()/tcp\_collapse() too often,
especially when application is slow to drain its receive queue or in
case of losses (netperf is fast, scp is slow). This is a major latency
source.
We should adjust the len/truesize ratio to 50% instead of 75%
This patch :
1) changes tcp\_adv\_win\_scale default to 1 instead of 2
2) increase tcp\_rmem[2] limit from 4MB to 6MB to take into account
better truesize tracking and to allow autotuning tcp receive window to
reach same value than before. Note that same amount of kernel memory is
consumed compared to 2.6 kernels.
Signed-off-by: Eric Dumazet
Cc: Neal Cardwell
Cc: Tom Herbert
Cc: Yuchung Cheng
Acked-by: Neal Cardwell
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 28a3d46497af5da64dd88110bf03d99cf181d5f9
Author: Yuchung Cheng
Date: Mon Apr 30 06:00:18 2012 +0000
tcp: fix infinite cwnd in tcp\_complete\_cwr()
[ Upstream commit 1cebce36d660c83bd1353e41f3e66abd4686f215 ]
When the cwnd reduction is done, ssthresh may be infinite
if TCP enters CWR via ECN or F-RTO. If cwnd is not undone, i.e.,
undo\_marker is set, tcp\_complete\_cwr() falsely set cwnd to the
infinite ssthresh value. The correct operation is to keep cwnd
intact because it has been updated in ECN or F-RTO.
Signed-off-by: Yuchung Cheng
Acked-by: Neal Cardwell
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ac931e2df86c0f7e69df21001832ad63ffe3d1c9
Author: Matt Carlson
Date: Tue Apr 24 13:37:01 2012 +0000
tg3: Avoid panic from reserved statblk field access
[ Upstream commit f891ea1634ce41f5f47ae40d8594809f4cd2ca66 ]
When RSS is enabled, interrupt vector 0 does not receive any rx traffic.
The rx producer index fields for vector 0's status block should be
considered reserved in this case. This patch changes the code to
respect these reserved fields, which avoids a kernel panic when these
fields take on non-zero values.
Signed-off-by: Matt Carlson
Signed-off-by: Michael Chan
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 2b4a884ae39037f4f340e1249ae944d25b00c025
Author: Gerard Lledo
Date: Sat Apr 28 08:52:37 2012 +0000
sungem: Fix WakeOnLan
[ Upstream commit 5a8887d39e1ba5ee2d4ccb94b14d6f2dce5ddfca ]
WakeOnLan was broken in this driver because gp->asleep\_wol is a 1-bit
bitfield and it was being assigned WAKE\_MAGIC, which is (1 << 5).
gp->asleep\_wol remains 0 and the machine never wakes up. Fixed by casting
gp->wake\_on\_lan to bool. Tested on an iBook G4.
Signed-off-by: Gerard Lledo
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit bff12743574b49347d43393c29cb7c5e8dc8af5a
Author: stephen hemminger
Date: Mon Apr 30 06:47:37 2012 +0000
sky2: fix receive length error in mixed non-VLAN/VLAN traffic
[ Upstream commit e072b3fad5f3915102c94628b4971f52ff99dd05 ]
Bug: The VLAN bit of the MAC RX Status Word is unreliable in several older
supported chips. Sometimes the VLAN bit is not set for valid VLAN packets
and also sometimes the VLAN bit is set for non-VLAN packets that came after
a VLAN packet. This results in a receive length error when VLAN hardware
tagging is enabled.
Fix: Variation on original fix proposed by Mirko.
The VLAN information is decoded in the status loop, and can be
applied to the received SKB there. This eliminates the need for the
separate tag field in the interface data structure. The tag has to
be copied and cleared if packet is copied. This version checked out
with vlan and normal traffic.
Note: vlan\_tx\_tag\_present should be renamed vlan\_tag\_present, but that
is outside scope of this.
Reported-by: Mirko Lindner
Signed-off-by: Stephen Hemminger
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit bd920c58f390f5e76e5456d395adeccd3fb1e53d
Author: stephen hemminger
Date: Mon Apr 30 05:49:45 2012 +0000
sky2: propogate rx hash when packet is copied
[ Upstream commit 3f42941b5d1d13542b1a755a9e4f633aa72e4d3e ]
When a small packet is received, the driver copies it to a new skb to allow
reusing the full size Rx buffer. The copy was propogating the checksum offload
but not the receive hash information. The bug is impact was mostly harmless
and therefore not observed until reviewing this area of code.
Signed-off-by: Stephen Hemminger
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit e6a23eedf2cd344f36a6f634212d4b0913f485fe
Author: Sasha Levin
Date: Wed May 2 03:58:43 2012 +0000
net: l2tp: unlock socket lock before returning from l2tp\_ip\_sendmsg
[ Upstream commit 84768edbb2721637620b2d84501bb0d5aed603f1 ]
l2tp\_ip\_sendmsg could return without releasing socket lock, making it all the
way to userspace, and generating the following warning:
[ 130.891594] ================================================
[ 130.894569] [ BUG: lock held when returning to user space! ]
[ 130.897257] 3.4.0-rc5-next-20120501-sasha #104 Tainted: G W
[ 130.900336] ------------------------------------------------
[ 130.902996] trinity/8384 is leaving the kernel with locks still held!
[ 130.906106] 1 lock held by trinity/8384:
[ 130.907924] #0: (sk\_lock-AF\_INET){+.+.+.}, at: [] l2tp\_ip\_sendmsg+0x2f/0x550
Introduced by commit 2f16270 ("l2tp: Fix locking in l2tp\_ip.c").
Signed-off-by: Sasha Levin
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a3aea3c511888bf0b1261a5414051e43b69a5ebd
Author: Eric W. Biederman
Date: Fri Apr 6 15:33:35 2012 +0000
net: In unregister\_netdevice\_notifier unregister the netdevices.
[ Upstream commit 7d3d43dab4e978d8d9ad1acf8af15c9b1c4b0f0f ]
We already synthesize events in register\_netdevice\_notifier and synthesizing
events in unregister\_netdevice\_notifier allows to us remove the need for
special case cleanup code.
This change should be safe as it adds no new cases for existing callers
of unregiser\_netdevice\_notifier to handle.
Signed-off-by: Eric W. Biederman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 51cfc3b6927a21512fddeb3ab07065295657fde8
Author: Eric Dumazet
Date: Sun Apr 29 09:08:22 2012 +0000
netem: fix possible skb leak
[ Upstream commit 116a0fc31c6c9b8fc821be5a96e5bf0b43260131 ]
skb\_checksum\_help(skb) can return an error, we must free skb in this
case. qdisc\_drop(skb, sch) can also be feeded with a NULL skb (if
skb\_unshare() failed), so lets use this generic helper.
Signed-off-by: Eric Dumazet
Cc: Stephen Hemminger
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7a519993790a09fd6410bdeb0a049e96d11a2324
Author: Ingo van Lil
Date: Mon Apr 23 22:05:38 2012 +0000
asix: Fix tx transfer padding for full-speed USB
[ Upstream commit 2a5809499e35b53a6044fd34e72b242688b7a862 ]
The asix.c USB Ethernet driver avoids ending a tx transfer with a zero-
length packet by appending a four-byte padding to transfers whose length
is a multiple of maxpacket. However, the hard-coded 512 byte maxpacket
length is valid for high-speed USB only; full-speed USB uses 64 byte
packets.
Signed-off-by: Ingo van Lil
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f4fad1b66f36116d8ac4f58c357ea077179c8e84
Author: Archit Taneja
Date: Thu Apr 19 17:39:16 2012 +0530
ARM: OMAP: Revert "ARM: OMAP: ctrl: Fix CONTROL\_DSIPHY register fields"
commit 08ca7444f589bedf9ad5d82883e5d0754852d73b upstream.
This reverts commit 46f8c3c7e95c0d30d95911e7975ddc4f93b3e237.
The commit above swapped the DSI1\_PPID and DSI2\_PPID register fields in
CONTROL\_DSIPHY to be in sync with the newer public OMAP TRMs(after version V).
With this commit, contention errors were reported on DSI lanes some OMAP4 SDPs.
After probing the DSI lanes on OMAP4 SDP, it was seen that setting bits in the
DSI2\_PPID field was pulling up voltage on DSI1 lanes, and DSI1\_PPID field was
pulling up voltage on DSI2 lanes.
This proves that the current version of OMAP4 TRM is incorrect, swap the
position of register fields according to the older TRM versions as they were
correct.
Acked-by: Tomi Valkeinen
Signed-off-by: Archit Taneja
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit ddfe373c202b9d3a079365040855a0d297421bce
Author: Ben Hutchings
Date: Sun Apr 8 05:18:53 2012 +0100
ARM: orion5x: Fix GPIO enable bits for MPP9
commit 48d99f47a81a66bdd61a348c7fe8df5a7afdf5f3 upstream.
Commit 554cdaefd1cf7bb54b209c4e68c7cec87ce442a9 ('ARM: orion5x: Refactor
mpp code to use common orion platform mpp.') seems to have accidentally
inverted the GPIO valid bits for MPP9 (only). For the mv2120 platform
which uses MPP9 as a GPIO LED device, this results in the error:
[ 12.711476] leds-gpio: probe of leds-gpio failed with error -22
Reported-by: Henry von Tresckow
References: http://bugs.debian.org/667446
Signed-off-by: Ben Hutchings
Tested-by: Hans Henry von Tresckow
Signed-off-by: Jason Cooper
Signed-off-by: Greg Kroah-Hartman
commit 89ec66f87f76f389887b04a415f6dd53305bb9d0
Author: Axel Lin
Date: Wed Apr 11 20:53:58 2012 +0800
regulator: Fix the logic to ensure new voltage setting in valid range
commit f55205f4d4a8823a11bb8b37ef2ecbd78fb09463 upstream.
I think this is a typo.
To ensure new voltage setting won't greater than desc->max,
the equation should be desc->min + desc->step \* new\_val <= desc->max.
Signed-off-by: Axel Lin
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit c35fda8ad637d6f86fad00139f7faaf3d1133302
Author: Colin Cross
Date: Sat May 5 20:58:13 2012 +0100
ARM: 7414/1: SMP: prevent use of the console when using idmap\_pgd
commit fde165b2a29673aabf18ceff14dea1f1cfb0daad upstream.
Commit 4e8ee7de227e3ab9a72040b448ad728c5428a042 (ARM: SMP: use
idmap\_pgd for mapping MMU enable during secondary booting)
switched secondary boot to use idmap\_pgd, which is initialized
during early\_initcall, instead of a page table initialized during
\_\_cpu\_up. This causes idmap\_pgd to contain the static mappings
but be missing all dynamic mappings.
If a console is registered that creates a dynamic mapping, the
printk in secondary\_start\_kernel will trigger a data abort on
the missing mapping before the exception handlers have been
initialized, leading to a hang. Initial boot is not affected
because no consoles have been registered, and resume is usually
not affected because the offending console is suspended.
Onlining a cpu with hotplug triggers the problem.
A workaround is to the printk in secondary\_start\_kernel until
after the page tables have been switched back to init\_mm.
Signed-off-by: Colin Cross
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 246301f454256967c5845a3e076c05ce488ff910
Author: Will Deacon
Date: Fri May 4 17:53:52 2012 +0100
ARM: 7412/1: audit: use only AUDIT\_ARCH\_ARM regardless of endianness
commit 2f978366984a418f38fcf44137be1fbc5a89cfd9 upstream.
The machine endianness has no direct correspondence to the syscall ABI,
so use only AUDIT\_ARCH\_ARM when identifying the ABI to the audit tools
in userspace.
Signed-off-by: Will Deacon
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 50f764acf24996dc3fd845f837f88a80b80b7d53
Author: Will Deacon
Date: Fri May 4 17:52:02 2012 +0100
ARM: 7411/1: audit: fix treatment of saved ip register during syscall tracing
commit 6a68b6f574c8ad2c1d90f0db8fd95b8abe8a0a73 upstream.
The ARM audit code incorrectly uses the saved application ip register
value to infer syscall entry or exit. Additionally, the saved value will
be clobbered if the current task is not being traced, which can lead to
libc corruption if ip is live (apparently glibc uses it for the TLS
pointer).
This patch fixes the syscall tracing code so that the why parameter is
used to infer the syscall direction and the saved ip is only updated if
we know that we will be signalling a ptrace trap.
Reported-and-Tested-by: Jon Masters
Cc: Eric Paris
Signed-off-by: Will Deacon
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit acfee6ae4cf54e4afb10252c86dc72ca3472eec7
Author: Tim Bird
Date: Wed May 2 22:55:39 2012 +0100
ARM: 7410/1: Add extra clobber registers for assembly in kernel\_execve
commit e787ec1376e862fcea1bfd523feb7c5fb43ecdb9 upstream.
The inline assembly in kernel\_execve() uses r8 and r9. Since this
code sequence does not return, it usually doesn't matter if the
register clobber list is accurate. However, I saw a case where a
particular version of gcc used r8 as an intermediate for the value
eventually passed to r9. Because r8 is used in the inline
assembly, and not mentioned in the clobber list, r9 was set
to an incorrect value.
This resulted in a kernel panic on execution of the first user-space
program in the system. r9 is used in ret\_to\_user as the thread\_info
pointer, and if it's wrong, bad things happen.
Signed-off-by: Tim Bird
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 15e8eae4f13da852c0ed0a8b85af5ba62c46a56b
Author: Linus Torvalds
Date: Fri May 4 14:46:02 2012 -0700
Fix \_\_read\_seqcount\_begin() to use ACCESS\_ONCE for sequence value read
commit 2f624278626677bfaf73fef97f86b37981621f5c upstream.
We really need to use a ACCESS\_ONCE() on the sequence value read in
\_\_read\_seqcount\_begin(), because otherwise the compiler might end up
reloading the value in between the test and the return of it. As a
result, it might end up returning an odd value (which means that a write
is in progress).
If the reader is then fast enough that that odd value is still the
current one when the read\_seqcount\_retry() is done, we might end up with
a "successful" read sequence, even despite the concurrent write being
active.
In practice this probably never really happens - there just isn't
anything else going on around the read of the sequence count, and the
common case is that we end up having a read barrier immediately
afterwards.
So the code sequence in which gcc might decide to reaload from memory is
small, and there's no reason to believe it would ever actually do the
reload. But if the compiler ever were to decide to do so, it would be
incredibly annoying to debug. Let's just make sure.
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5a3f30217f703a1e2124766bc2c5e4e4c8b57813
Author: H. Peter Anvin
Date: Thu Apr 26 11:45:16 2012 -0700
asm-generic: Use \_\_BITS\_PER\_LONG in statfs.h
commit f5c2347ee20a8d6964d6a6b1ad04f200f8d4dfa7 upstream.
 is exported to userspace, so using
BITS\_PER\_LONG is invalid. We need to use \_\_BITS\_PER\_LONG instead.
This is kernel bugzilla 43165.
Reported-by: H.J. Lu
Signed-off-by: H. Peter Anvin
Link: http://lkml.kernel.org/r/1335465916-16965-1-git-send-email-hpa@linux.intel.com
Acked-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit 4f9b82ae13a482026a83eafa307ca037131a54b3
Author: Tejun Heo
Date: Fri Apr 27 10:54:35 2012 -0700
percpu, x86: don't use PMD\_SIZE as embedded atom\_size on 32bit
commit d5e28005a1d2e67833852f4c9ea8ec206ea3ff85 upstream.
With the embed percpu first chunk allocator, x86 uses either PAGE\_SIZE
or PMD\_SIZE for atom\_size. PMD\_SIZE is used when CPU supports PSE so
that percpu areas are aligned to PMD mappings and possibly allow using
PMD mappings in vmalloc areas in the future. Using larger atom\_size
doesn't waste actual memory; however, it does require larger vmalloc
space allocation later on for !first chunks.
With reasonably sized vmalloc area, PMD\_SIZE shouldn't be a problem
but x86\_32 at this point is anything but reasonable in terms of
address space and using larger atom\_size reportedly leads to frequent
percpu allocation failures on certain setups.
As there is no reason to not use PMD\_SIZE on x86\_64 as vmalloc space
is aplenty and most x86\_64 configurations support PSE, fix the issue
by always using PMD\_SIZE on x86\_64 and PAGE\_SIZE on x86\_32.
v2: drop cpu\_has\_pse test and make x86\_64 always use PMD\_SIZE and
x86\_32 PAGE\_SIZE as suggested by hpa.
Signed-off-by: Tejun Heo
Reported-by: Yanmin Zhang
Reported-by: ShuoX Liu
Acked-by: H. Peter Anvin
LKML-Reference: <4F97BA98.6010001@intel.com>
Signed-off-by: Greg Kroah-Hartman
commit 318c686eb39d8587b67be613a652ea55dc701a58
Author: Kusanagi Kouichi
Date: Sun Apr 1 17:29:32 2012 +0900
x86, relocs: Remove an unused variable
commit 7c77cda0fe742ed07622827ce80963bbeebd1e3f upstream.
sh\_symtab is set but not used.
[ hpa: putting this in urgent because of the sheer harmlessness of the patch:
it quiets a build warning but does not change any generated code. ]
Signed-off-by: Kusanagi Kouichi
Link: http://lkml.kernel.org/r/20120401082932.D5E066FC03D@msa105.auone-net.jp
Signed-off-by: H. Peter Anvin
Signed-off-by: Greg Kroah-Hartman
commit 800aaea4c2da2c2022c48a10c2e80ab68c6eb790
Author: Stefan Metzmacher
Date: Fri May 4 00:19:28 2012 +0200
fs/cifs: fix parsing of dfs referrals
commit d8f2799b105a24bb0bbd3380a0d56e6348484058 upstream.
The problem was that the first referral was parsed more than once
and so the caller tried the same referrals multiple times.
The problem was introduced partly by commit
066ce6899484d9026acd6ba3a8dbbedb33d7ae1b,
where 'ref += le16\_to\_cpu(ref->Size);' got lost,
but that was also wrong...
Signed-off-by: Stefan Metzmacher
Tested-by: Björn Jacke
Reviewed-by: Jeff Layton
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 9e52d84a9ac037d47e8c3f2db9e0a453237966f8
Author: Eric Bénard
Date: Sun Apr 29 17:37:57 2012 +0200
ASoC: tlv312aic23: unbreak resume
commit e875c1e3e758447ba81ca450d89434b3b0496d37 upstream.
\* commit f9dfbf9 "ASoC: tlv320aic23: convert to soc-cache" leads to
a bug preventing resumeof the codec as regmap expects a 9 bits data
register but 0xFFFF is passed in tlv320aic23\_set\_bias\_level and this
values gets cached preventing any write to the TLV320AIC23\_PWR
register as the final value produced by regmap is (register << 9) | value
\* this patch solves the problem by only working on the 9 bits the
register contains.
Signed-off-by: Eric Bénard
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 35cdf78c44dc54a6262ebbfc745f46bd3b813f94
Author: Richard Zhao
Date: Tue Apr 24 15:24:43 2012 +0800
ASoC: core: check of\_property\_count\_strings failure
commit c34ce320d9fe328e3272def20b152f39ccfa045e upstream.
Signed-off-by: Richard Zhao
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit e7bcb4bafa9bb05db987601067c2f9da45d2678c
Author: Daniel Vetter
Date: Sun May 6 16:50:24 2012 +0200
drm/i915: Do no set Stencil Cache eviction LRA w/a on gen7+
commit 2e7a44814d802c8ba479164b8924070cd908d6b5 upstream.
I've flagged this while reviewing the first version and Ken Graunke
fixed it up in v2, but unfortunately Dave Airlie picked up the wrong
version.
Cc: Dave Airlie
Cc: Kenneth Graunke
Signed-Off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit fc737b6c5fb5e3d9f5562c1db8c8a73af2304cd4
Author: Daniel Vetter
Date: Fri May 4 11:29:56 2012 +0200
drm/i915: disable sdvo hotplug on i945g/gm
commit 768b107e4b3be0acf6f58e914afe4f337c00932b upstream.
Chris Wilson dug out a hw erratum saying that there's noise on the
interrupt line on i945G chips. We also have a bug report from a i945GM
chip with an sdvo hotplug interrupt storm (and no apparent cause).
Play it safe and disable sdvo hotplug on all i945 variants.
Note that this is a regression that has been introduced in 3.1,
when we've enabled sdvo hotplug support with
commit cc68c81aed7d892deaf12d720d5455208e94cd0a
Author: Simon Farnsworth
Date: Wed Sep 21 17:13:30 2011 +0100
drm/i915: Enable SDVO hotplug interrupts for HDMI and DVI
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=38442
Reported-and-tested-by: Dominik Köppl
Reviewed-by: Chris Wilson
Signed-Off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit 381c2fc9d4012983065c39f0fc50cac9ec32b0be
Author: David Vrabel
Date: Fri May 4 14:29:46 2012 +0100
xen/pci: don't use PCI BIOS service for configuration space accesses
commit 76a8df7b49168509df02461f83fab117a4a86e08 upstream.
The accessing PCI configuration space with the PCI BIOS32 service does
not work in PV guests.
On systems without MMCONFIG or where the BIOS hasn't marked the
MMCONFIG region as reserved in the e820 map, the BIOS service is
probed (even though direct access is preferred) and this hangs.
Acked-by: Jan Beulich
Signed-off-by: David Vrabel
[v1: Fixed compile error when CONFIG\_PCI is not set]
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit 3d018683171461ac7effa05fdecf296f4ab442a5
Author: Konrad Rzeszutek Wilk
Date: Thu May 3 16:14:14 2012 -0400
xen/pte: Fix crashes when trying to see non-existent PGD/PMD/PUD/PTEs
commit b7e5ffe5d83fa40d702976d77452004abbe35791 upstream.
If I try to do "cat /sys/kernel/debug/kernel\_page\_tables"
I end up with:
BUG: unable to handle kernel paging request at ffffc7fffffff000
IP: [] ptdump\_show+0x221/0x480
PGD 0
Oops: 0000 [#1] SMP
CPU 0
.. snip..
RAX: 0000000000000000 RBX: ffffc00000000fff RCX: 0000000000000000
RDX: 0000800000000000 RSI: 0000000000000000 RDI: ffffc7fffffff000
which is due to the fact we are trying to access a PFN that is not
accessible to us. The reason (at least in this case) was that
PGD[256] is set to \_\_HYPERVISOR\_VIRT\_START which was setup (by the
hypervisor) to point to a read-only linear map of the MFN->PFN array.
During our parsing we would get the MFN (a valid one), try to look
it up in the MFN->PFN tree and find it invalid and return ~0 as PFN.
Then pte\_mfn\_to\_pfn would happilly feed that in, attach the flags
and return it back to the caller. 'ptdump\_show' bitshifts it and
gets and invalid value that it tries to dereference.
Instead of doing all of that, we detect the ~0 case and just
return !\_PAGE\_PRESENT.
This bug has been in existence .. at least until 2.6.37 (yikes!)
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit c820fc19273c7be987fd0e0963311fbf53b484bf
Author: Jiri Pirko
Date: Tue Mar 20 18:10:01 2012 +0000
e1000: fix vlan processing regression
commit 52f5509fe8ccb607ff9b84ad618f244262336475 upstream.
This patch fixes a regression introduced by commit "e1000: do vlan
cleanup (799d531)".
Apparently some e1000 chips (not mine) are sensitive about the order of
setting vlan filter and vlan stripping/inserting functionality. So this
patch changes the order so it's the same as before vlan cleanup.
Reported-by: Ben Greear
Signed-off-by: Jiri Pirko
Tested-by: Ben Greear
Tested-by: Aaron Brown
Signed-off-by: Jeff Kirsher
Cc: David Ward
Signed-off-by: Greg Kroah-Hartman
commit 3cb41a56a8dbe5df16c1a6e451dfaef6c387ead5
Author: Paolo Pisati
Date: Mon Apr 23 04:05:20 2012 +0000
smsc95xx: mark link down on startup and let PHY interrupt deal with carrier changes
commit 07d69d4238418746a7b85c5d05ec17c658a2a390 upstream.
Without this patch sysfs reports the cable as present
flag@flag-desktop:~$ cat /sys/class/net/eth0/carrier
1
while it's not:
flag@flag-desktop:~$ sudo mii-tool eth0
eth0: no link
Tested on my Beagle XM.
v2: added mantainer to the list of recipient
Signed-off-by: Paolo Pisati
Acked-by: Steve Glendinning
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ab83a1346bc7877973e501c323df83e880a82ffb
Author: Paulo Zanoni
Date: Wed May 2 22:55:43 2012 -0300
drm/i915: enable dip before writing data on gen4
commit c1230df7e19e0f27655c0eb9d966c7e03be7cc50 upstream.
While testing with the intel\_infoframes tool on gen4, I see that when
video DIP is disabled, what we write to the DATA memory is not exactly
what we read back later.
This regression has been introduce in
commit 64a8fc0145a1d0fdc25fc9367c2e6c621955fb3b
Author: Jesse Barnes
Date: Thu Sep 22 11:16:00 2011 +0530
drm/i915: fix ILK+ infoframe support
That commit was setting VIDEO\_DIP\_CTL to 0 when initializing, which
caused the problem.
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=43947
Tested-by: Yang Guang
Signed-off-by: Paulo Zanoni
Reviewed-by: Eugeni Dodonov
[danvet: Pimped commit message by using the usual commit citation
layout.]
Signed-off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman


=== Content from github.com_73469a7e_20250125_162550.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F90481622d75715bfcb68501280a917dbfe516029)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F90481622d75715bfcb68501280a917dbfe516029)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/90481622d75715bfcb68501280a917dbfe516029)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

hugepages: fix use after free bug in "quota" handling

[Browse files](/torvalds/linux/tree/90481622d75715bfcb68501280a917dbfe516029)
Browse the repository at this point in the history

```
hugetlbfs_{get,put}_quota() are badly named.  They don't interact with the
general quota handling code, and they don't much resemble its behaviour.
Rather than being about maintaining limits on on-disk block usage by
particular users, they are instead about maintaining limits on in-memory
page usage (including anonymous MAP_PRIVATE copied-on-write pages)
associated with a particular hugetlbfs filesystem instance.

Worse, they work by having callbacks to the hugetlbfs filesystem code from
the low-level page handling code, in particular from free_huge_page().
This is a layering violation of itself, but more importantly, if the
kernel does a get_user_pages() on hugepages (which can happen from KVM
amongst others), then the free_huge_page() can be delayed until after the
associated inode has already been freed.  If an unmount occurs at the
wrong time, even the hugetlbfs superblock where the "quota" limits are
stored may have been freed.

Andrew Barry proposed a patch to fix this by having hugepages, instead of
storing a pointer to their address_space and reaching the superblock from
there, had the hugepages store pointers directly to the superblock,
bumping the reference count as appropriate to avoid it being freed.
Andrew Morton rejected that version, however, on the grounds that it made
the existing layering violation worse.

This is a reworked version of Andrew's patch, which removes the extra, and
some of the existing, layering violation.  It works by introducing the
concept of a hugepage "subpool" at the lower hugepage mm layer - that is a
finite logical pool of hugepages to allocate from.  hugetlbfs now creates
a subpool for each filesystem instance with a page limit set, and a
pointer to the subpool gets added to each allocated hugepage, instead of
the address_space pointer used now.  The subpool has its own lifetime and
is only freed once all pages in it _and_ all other references to it (i.e.
superblocks) are gone.

subpools are optional - a NULL subpool pointer is taken by the code to
mean that no subpool limits are in effect.

Previous discussion of this bug found in:  "Fix refcounting in hugetlbfs
quota handling.". See:  <https://lkml.org/lkml/2011/8/11/28> or
<http://marc.info/?l=linux-mm&m=126928970510627&w=1>

v2: Fixed a bug spotted by Hillf Danton, and removed the extra parameter to
alloc_huge_page() - since it already takes the vma, it is not necessary.

Signed-off-by: Andrew Barry <abarry@cray.com>
Signed-off-by: David Gibson <david@gibson.dropbear.id.au>
Cc: Hugh Dickins <hughd@google.com>
Cc: Mel Gorman <mgorman@suse.de>
Cc: Minchan Kim <minchan.kim@gmail.com>
Cc: Hillf Danton <dhillf@gmail.com>
Cc: Paul Mackerras <paulus@samba.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
```

* Loading branch information

[![@dgibson](https://avatars.githubusercontent.com/u/676485?s=40&v=4)](/dgibson) [![@torvalds](https://avatars.githubusercontent.com/u/1024025?s=40&v=4)](/torvalds)

[dgibson](/torvalds/linux/commits?author=dgibson "View all commits by dgibson")
authored and
[torvalds](/torvalds/linux/commits?author=torvalds "View all commits by torvalds")
committed
Mar 22, 2012

1 parent
[a1d776e](/torvalds/linux/commit/a1d776ee3147cec2a54a645e92eb2e3e2f65a137)

commit 9048162

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**139 additions**
and
**64 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* fs/hugetlbfs

  + fs/hugetlbfs/inode.c
    [inode.c](#diff-f34c69b26b019c0285ce7e646a157d94bd1e84225dbbfbd63fc0153e8bd66929)
* include/linux

  + include/linux/hugetlb.h
    [hugetlb.h](#diff-07fb758e47d40b32444ed23b09a3ded5f870028d21421896134a3e12f1fa7c97)
* mm

  + mm/hugetlb.c
    [hugetlb.c](#diff-fb6066ca63d9afdc2e3660c85e2dcc04cf31b37900ca9df2a1019ee8fa80dce0)

## There are no files selected for viewing

54 changes: 21 additions & 33 deletions

54
[fs/hugetlbfs/inode.c](#diff-f34c69b26b019c0285ce7e646a157d94bd1e84225dbbfbd63fc0153e8bd66929 "fs/hugetlbfs/inode.c")

Show comments

[View file](/torvalds/linux/blob/90481622d75715bfcb68501280a917dbfe516029/fs/hugetlbfs/inode.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -626,9 +626,15 @@ static int hugetlbfs\_statfs(struct dentry \*dentry, struct kstatfs \*buf) |
|  |  | spin\_lock(&sbinfo->stat\_lock); |
|  |  | /\* If no limits set, just report 0 for max/free/used |
|  |  | \* blocks, like simple\_statfs() \*/ |
|  |  | if (sbinfo->max\_blocks >= 0) { |
|  |  | buf->f\_blocks = sbinfo->max\_blocks; |
|  |  | buf->f\_bavail = buf->f\_bfree = sbinfo->free\_blocks; |
|  |  | if (sbinfo->spool) { |
|  |  | long free\_pages; |
|  |  |  |
|  |  | spin\_lock(&sbinfo->spool->lock); |
|  |  | buf->f\_blocks = sbinfo->spool->max\_hpages; |
|  |  | free\_pages = sbinfo->spool->max\_hpages |
|  |  | - sbinfo->spool->used\_hpages; |
|  |  | buf->f\_bavail = buf->f\_bfree = free\_pages; |
|  |  | spin\_unlock(&sbinfo->spool->lock); |
|  |  | buf->f\_files = sbinfo->max\_inodes; |
|  |  | buf->f\_ffree = sbinfo->free\_inodes; |
|  |  | } |
| Expand All | | @@ -644,6 +650,10 @@ static void hugetlbfs\_put\_super(struct super\_block \*sb) |
|  |  |  |
|  |  | if (sbi) { |
|  |  | sb->s\_fs\_info = NULL; |
|  |  |  |
|  |  | if (sbi->spool) |
|  |  | hugepage\_put\_subpool(sbi->spool); |
|  |  |  |
|  |  | kfree(sbi); |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -874,10 +884,14 @@ hugetlbfs\_fill\_super(struct super\_block \*sb, void \*data, int silent) |
|  |  | sb->s\_fs\_info = sbinfo; |
|  |  | sbinfo->hstate = config.hstate; |
|  |  | spin\_lock\_init(&sbinfo->stat\_lock); |
|  |  | sbinfo->max\_blocks = config.nr\_blocks; |
|  |  | sbinfo->free\_blocks = config.nr\_blocks; |
|  |  | sbinfo->max\_inodes = config.nr\_inodes; |
|  |  | sbinfo->free\_inodes = config.nr\_inodes; |
|  |  | sbinfo->spool = NULL; |
|  |  | if (config.nr\_blocks != -1) { |
|  |  | sbinfo->spool = hugepage\_new\_subpool(config.nr\_blocks); |
|  |  | if (!sbinfo->spool) |
|  |  | goto out\_free; |
|  |  | } |
|  |  | sb->s\_maxbytes = MAX\_LFS\_FILESIZE; |
|  |  | sb->s\_blocksize = huge\_page\_size(config.hstate); |
|  |  | sb->s\_blocksize\_bits = huge\_page\_shift(config.hstate); |
| Expand All | | @@ -896,38 +910,12 @@ hugetlbfs\_fill\_super(struct super\_block \*sb, void \*data, int silent) |
|  |  | sb->s\_root = root; |
|  |  | return 0; |
|  |  | out\_free: |
|  |  | if (sbinfo->spool) |
|  |  | kfree(sbinfo->spool); |
|  |  | kfree(sbinfo); |
|  |  | return -ENOMEM; |
|  |  | } |
|  |  |  |
|  |  | int hugetlb\_get\_quota(struct address\_space \*mapping, long delta) |
|  |  | { |
|  |  | int ret = 0; |
|  |  | struct hugetlbfs\_sb\_info \*sbinfo = HUGETLBFS\_SB(mapping->host->i\_sb); |
|  |  |  |
|  |  | if (sbinfo->free\_blocks > -1) { |
|  |  | spin\_lock(&sbinfo->stat\_lock); |
|  |  | if (sbinfo->free\_blocks - delta >= 0) |
|  |  | sbinfo->free\_blocks -= delta; |
|  |  | else |
|  |  | ret = -ENOMEM; |
|  |  | spin\_unlock(&sbinfo->stat\_lock); |
|  |  | } |
|  |  |  |
|  |  | return ret; |
|  |  | } |
|  |  |  |
|  |  | void hugetlb\_put\_quota(struct address\_space \*mapping, long delta) |
|  |  | { |
|  |  | struct hugetlbfs\_sb\_info \*sbinfo = HUGETLBFS\_SB(mapping->host->i\_sb); |
|  |  |  |
|  |  | if (sbinfo->free\_blocks > -1) { |
|  |  | spin\_lock(&sbinfo->stat\_lock); |
|  |  | sbinfo->free\_blocks += delta; |
|  |  | spin\_unlock(&sbinfo->stat\_lock); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | static struct dentry \*hugetlbfs\_mount(struct file\_system\_type \*fs\_type, |
|  |  | int flags, const char \*dev\_name, void \*data) |
|  |  | { |
| Expand Down | |  |

14 changes: 10 additions & 4 deletions

14
[include/linux/hugetlb.h](#diff-07fb758e47d40b32444ed23b09a3ded5f870028d21421896134a3e12f1fa7c97 "include/linux/hugetlb.h")

Show comments

[View file](/torvalds/linux/blob/90481622d75715bfcb68501280a917dbfe516029/include/linux/hugetlb.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,6 +14,15 @@ struct user\_struct; |
|  |  | #include <linux/shm.h> |
|  |  | #include <asm/tlbflush.h> |
|  |  |  |
|  |  | struct hugepage\_subpool { |
|  |  | spinlock\_t lock; |
|  |  | long count; |
|  |  | long max\_hpages, used\_hpages; |
|  |  | }; |
|  |  |  |
|  |  | struct hugepage\_subpool \*hugepage\_new\_subpool(long nr\_blocks); |
|  |  | void hugepage\_put\_subpool(struct hugepage\_subpool \*spool); |
|  |  |  |
|  |  | int PageHuge(struct page \*page); |
|  |  |  |
|  |  | void reset\_vma\_resv\_huge\_pages(struct vm\_area\_struct \*vma); |
| Expand Down  Expand Up | | @@ -129,12 +138,11 @@ enum { |
|  |  |  |
|  |  | #ifdef CONFIG\_HUGETLBFS |
|  |  | struct hugetlbfs\_sb\_info { |
|  |  | long max\_blocks; /\* blocks allowed \*/ |
|  |  | long free\_blocks; /\* blocks free \*/ |
|  |  | long max\_inodes; /\* inodes allowed \*/ |
|  |  | long free\_inodes; /\* inodes free \*/ |
|  |  | spinlock\_t stat\_lock; |
|  |  | struct hstate \*hstate; |
|  |  | struct hugepage\_subpool \*spool; |
|  |  | }; |
|  |  |  |
|  |  | static inline struct hugetlbfs\_sb\_info \*HUGETLBFS\_SB(struct super\_block \*sb) |
| Expand All | | @@ -146,8 +154,6 @@ extern const struct file\_operations hugetlbfs\_file\_operations; |
|  |  | extern const struct vm\_operations\_struct hugetlb\_vm\_ops; |
|  |  | struct file \*hugetlb\_file\_setup(const char \*name, size\_t size, vm\_flags\_t acct, |
|  |  | struct user\_struct \*\*user, int creat\_flags); |
|  |  | int hugetlb\_get\_quota(struct address\_space \*mapping, long delta); |
|  |  | void hugetlb\_put\_quota(struct address\_space \*mapping, long delta); |
|  |  |  |
|  |  | static inline int is\_file\_hugepages(struct file \*file) |
|  |  | { |
| Expand Down | |  |

135 changes: 108 additions & 27 deletions

135
[mm/hugetlb.c](#diff-fb6066ca63d9afdc2e3660c85e2dcc04cf31b37900ca9df2a1019ee8fa80dce0 "mm/hugetlb.c")

Show comments

[View file](/torvalds/linux/blob/90481622d75715bfcb68501280a917dbfe516029/mm/hugetlb.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,6 +53,84 @@ static unsigned long \_\_initdata default\_hstate\_size; |
|  |  | \*/ |
|  |  | static DEFINE\_SPINLOCK(hugetlb\_lock); |
|  |  |  |
|  |  | static inline void unlock\_or\_release\_subpool(struct hugepage\_subpool \*spool) |
|  |  | { |
|  |  | bool free = (spool->count == 0) && (spool->used\_hpages == 0); |
|  |  |  |
|  |  | spin\_unlock(&spool->lock); |
|  |  |  |
|  |  | /\* If no pages are used, and no other handles to the subpool |
|  |  | \* remain, free the subpool the subpool remain \*/ |
|  |  | if (free) |
|  |  | kfree(spool); |
|  |  | } |
|  |  |  |
|  |  | struct hugepage\_subpool \*hugepage\_new\_subpool(long nr\_blocks) |
|  |  | { |
|  |  | struct hugepage\_subpool \*spool; |
|  |  |  |
|  |  | spool = kmalloc(sizeof(\*spool), GFP\_KERNEL); |
|  |  | if (!spool) |
|  |  | return NULL; |
|  |  |  |
|  |  | spin\_lock\_init(&spool->lock); |
|  |  | spool->count = 1; |
|  |  | spool->max\_hpages = nr\_blocks; |
|  |  | spool->used\_hpages = 0; |
|  |  |  |
|  |  | return spool; |
|  |  | } |
|  |  |  |
|  |  | void hugepage\_put\_subpool(struct hugepage\_subpool \*spool) |
|  |  | { |
|  |  | spin\_lock(&spool->lock); |
|  |  | BUG\_ON(!spool->count); |
|  |  | spool->count--; |
|  |  | unlock\_or\_release\_subpool(spool); |
|  |  | } |
|  |  |  |
|  |  | static int hugepage\_subpool\_get\_pages(struct hugepage\_subpool \*spool, |
|  |  | long delta) |
|  |  | { |
|  |  | int ret = 0; |
|  |  |  |
|  |  | if (!spool) |
|  |  | return 0; |
|  |  |  |
|  |  | spin\_lock(&spool->lock); |
|  |  | if ((spool->used\_hpages + delta) <= spool->max\_hpages) { |
|  |  | spool->used\_hpages += delta; |
|  |  | } else { |
|  |  | ret = -ENOMEM; |
|  |  | } |
|  |  | spin\_unlock(&spool->lock); |
|  |  |  |
|  |  | return ret; |
|  |  | } |
|  |  |  |
|  |  | static void hugepage\_subpool\_put\_pages(struct hugepage\_subpool \*spool, |
|  |  | long delta) |
|  |  | { |
|  |  | if (!spool) |
|  |  | return; |
|  |  |  |
|  |  | spin\_lock(&spool->lock); |
|  |  | spool->used\_hpages -= delta; |
|  |  | /\* If hugetlbfs\_put\_super couldn't free spool due to |
|  |  | \* an outstanding quota reference, free it now. \*/ |
|  |  | unlock\_or\_release\_subpool(spool); |
|  |  | } |
|  |  |  |
|  |  | static inline struct hugepage\_subpool \*subpool\_inode(struct inode \*inode) |
|  |  | { |
|  |  | return HUGETLBFS\_SB(inode->i\_sb)->spool; |
|  |  | } |
|  |  |  |
|  |  | static inline struct hugepage\_subpool \*subpool\_vma(struct vm\_area\_struct \*vma) |
|  |  | { |
|  |  | return subpool\_inode(vma->vm\_file->f\_dentry->d\_inode); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Region tracking -- allows tracking of reservations and instantiated pages |
|  |  | \* across the pages in a mapping. |
| Expand Down  Expand Up | | @@ -540,9 +618,9 @@ static void free\_huge\_page(struct page \*page) |
|  |  | \*/ |
|  |  | struct hstate \*h = page\_hstate(page); |
|  |  | int nid = page\_to\_nid(page); |
|  |  | struct address\_space \*mapping; |
|  |  | struct hugepage\_subpool \*spool = |
|  |  | (struct hugepage\_subpool \*)page\_private(page); |
|  |  |  |
|  |  | mapping = (struct address\_space \*) page\_private(page); |
|  |  | set\_page\_private(page, 0); |
|  |  | page->mapping = NULL; |
|  |  | BUG\_ON(page\_count(page)); |
| Expand All | | @@ -558,8 +636,7 @@ static void free\_huge\_page(struct page \*page) |
|  |  | enqueue\_huge\_page(h, page); |
|  |  | } |
|  |  | spin\_unlock(&hugetlb\_lock); |
|  |  | if (mapping) |
|  |  | hugetlb\_put\_quota(mapping, 1); |
|  |  | hugepage\_subpool\_put\_pages(spool, 1); |
|  |  | } |
|  |  |  |
|  |  | static void prep\_new\_huge\_page(struct hstate \*h, struct page \*page, int nid) |
| Expand Down  Expand Up | | @@ -977,11 +1054,12 @@ static void return\_unused\_surplus\_pages(struct hstate \*h, |
|  |  | /\* |
|  |  | \* Determine if the huge page at addr within the vma has an associated |
|  |  | \* reservation. Where it does not we will need to logically increase |
|  |  | \* reservation and actually increase quota before an allocation can occur. |
|  |  | \* Where any new reservation would be required the reservation change is |
|  |  | \* prepared, but not committed. Once the page has been quota'd allocated |
|  |  | \* an instantiated the change should be committed via vma\_commit\_reservation. |
|  |  | \* No action is required on failure. |
|  |  | \* reservation and actually increase subpool usage before an allocation |
|  |  | \* can occur. Where any new reservation would be required the |
|  |  | \* reservation change is prepared, but not committed. Once the page |
|  |  | \* has been allocated from the subpool and instantiated the change should |
|  |  | \* be committed via vma\_commit\_reservation. No action is required on |
|  |  | \* failure. |
|  |  | \*/ |
|  |  | static long vma\_needs\_reservation(struct hstate \*h, |
|  |  | struct vm\_area\_struct \*vma, unsigned long addr) |
| Expand Down  Expand Up | | @@ -1030,24 +1108,24 @@ static void vma\_commit\_reservation(struct hstate \*h, |
|  |  | static struct page \*alloc\_huge\_page(struct vm\_area\_struct \*vma, |
|  |  | unsigned long addr, int avoid\_reserve) |
|  |  | { |
|  |  | struct hugepage\_subpool \*spool = subpool\_vma(vma); |
|  |  | struct hstate \*h = hstate\_vma(vma); |
|  |  | struct page \*page; |
|  |  | struct address\_space \*mapping = vma->vm\_file->f\_mapping; |
|  |  | struct inode \*inode = mapping->host; |
|  |  | long chg; |
|  |  |  |
|  |  | /\* |
|  |  | \* Processes that did not create the mapping will have no reserves and |
|  |  | \* will not have accounted against quota. Check that the quota can be |
|  |  | \* made before satisfying the allocation |
|  |  | \* MAP\_NORESERVE mappings may also need pages and quota allocated |
|  |  | \* if no reserve mapping overlaps. |
|  |  | \* Processes that did not create the mapping will have no |
|  |  | \* reserves and will not have accounted against subpool |
|  |  | \* limit. Check that the subpool limit can be made before |
|  |  | \* satisfying the allocation MAP\_NORESERVE mappings may also |
|  |  | \* need pages and subpool limit allocated allocated if no reserve |
|  |  | \* mapping overlaps. |
|  |  | \*/ |
|  |  | chg = vma\_needs\_reservation(h, vma, addr); |
|  |  | if (chg < 0) |
|  |  | return ERR\_PTR(-VM\_FAULT\_OOM); |
|  |  | if (chg) |
|  |  | if (hugetlb\_get\_quota(inode->i\_mapping, chg)) |
|  |  | if (hugepage\_subpool\_get\_pages(spool, chg)) |
|  |  | return ERR\_PTR(-VM\_FAULT\_SIGBUS); |
|  |  |  |
|  |  | spin\_lock(&hugetlb\_lock); |
| Expand All | | @@ -1057,12 +1135,12 @@ static struct page \*alloc\_huge\_page(struct vm\_area\_struct \*vma, |
|  |  | if (!page) { |
|  |  | page = alloc\_buddy\_huge\_page(h, NUMA\_NO\_NODE); |
|  |  | if (!page) { |
|  |  | hugetlb\_put\_quota(inode->i\_mapping, chg); |
|  |  | hugepage\_subpool\_put\_pages(spool, chg); |
|  |  | return ERR\_PTR(-VM\_FAULT\_SIGBUS); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | set\_page\_private(page, (unsigned long) mapping); |
|  |  | set\_page\_private(page, (unsigned long)spool); |
|  |  |  |
|  |  | vma\_commit\_reservation(h, vma, addr); |
|  |  |  |
| Expand Down  Expand Up | | @@ -2083,6 +2161,7 @@ static void hugetlb\_vm\_op\_close(struct vm\_area\_struct \*vma) |
|  |  | { |
|  |  | struct hstate \*h = hstate\_vma(vma); |
|  |  | struct resv\_map \*reservations = vma\_resv\_map(vma); |
|  |  | struct hugepage\_subpool \*spool = subpool\_vma(vma); |
|  |  | unsigned long reserve; |
|  |  | unsigned long start; |
|  |  | unsigned long end; |
| Expand All | | @@ -2098,7 +2177,7 @@ static void hugetlb\_vm\_op\_close(struct vm\_area\_struct \*vma) |
|  |  |  |
|  |  | if (reserve) { |
|  |  | hugetlb\_acct\_memory(h, -reserve); |
|  |  | hugetlb\_put\_quota(vma->vm\_file->f\_mapping, reserve); |
|  |  | hugepage\_subpool\_put\_pages(spool, reserve); |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -2331,7 +2410,7 @@ static int unmap\_ref\_private(struct mm\_struct \*mm, struct vm\_area\_struct \*vma, |
|  |  | \*/ |
|  |  | address = address & huge\_page\_mask(h); |
|  |  | pgoff = vma\_hugecache\_offset(h, vma, address); |
|  |  | mapping = (struct address\_space \*)page\_private(page); |
|  |  | mapping = vma->vm\_file->f\_dentry->d\_inode->i\_mapping; |
|  |  |  |
|  |  | /\* |
|  |  | \* Take the mapping lock for the duration of the table walk. As |
| Expand Down  Expand Up | | @@ -2884,11 +2963,12 @@ int hugetlb\_reserve\_pages(struct inode \*inode, |
|  |  | { |
|  |  | long ret, chg; |
|  |  | struct hstate \*h = hstate\_inode(inode); |
|  |  | struct hugepage\_subpool \*spool = subpool\_inode(inode); |
|  |  |  |
|  |  | /\* |
|  |  | \* Only apply hugepage reservation if asked. At fault time, an |
|  |  | \* attempt will be made for VM\_NORESERVE to allocate a page |
|  |  | \* and filesystem quota without using reserves |
|  |  | \* without using reserves |
|  |  | \*/ |
|  |  | if (vm\_flags & VM\_NORESERVE) |
|  |  | return 0; |
| Expand All | | @@ -2915,17 +2995,17 @@ int hugetlb\_reserve\_pages(struct inode \*inode, |
|  |  | if (chg < 0) |
|  |  | return chg; |
|  |  |  |
|  |  | /\* There must be enough filesystem quota for the mapping \*/ |
|  |  | if (hugetlb\_get\_quota(inode->i\_mapping, chg)) |
|  |  | /\* There must be enough pages in the subpool for the mapping \*/ |
|  |  | if (hugepage\_subpool\_get\_pages(spool, chg)) |
|  |  | return -ENOSPC; |
|  |  |  |
|  |  | /\* |
|  |  | \* Check enough hugepages are available for the reservation. |
|  |  | \* Hand back the quota if there are not |
|  |  | \* Hand the pages back to the subpool if there are not |
|  |  | \*/ |
|  |  | ret = hugetlb\_acct\_memory(h, chg); |
|  |  | if (ret < 0) { |
|  |  | hugetlb\_put\_quota(inode->i\_mapping, chg); |
|  |  | hugepage\_subpool\_put\_pages(spool, chg); |
|  |  | return ret; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -2949,12 +3029,13 @@ void hugetlb\_unreserve\_pages(struct inode \*inode, long offset, long freed) |
|  |  | { |
|  |  | struct hstate \*h = hstate\_inode(inode); |
|  |  | long chg = region\_truncate(&inode->i\_mapping->private\_list, offset); |
|  |  | struct hugepage\_subpool \*spool = subpool\_inode(inode); |
|  |  |  |
|  |  | spin\_lock(&inode->i\_lock); |
|  |  | inode->i\_blocks -= (blocks\_per\_huge\_page(h) \* freed); |
|  |  | spin\_unlock(&inode->i\_lock); |
|  |  |  |
|  |  | hugetlb\_put\_quota(inode->i\_mapping, (chg - freed)); |
|  |  | hugepage\_subpool\_put\_pages(spool, (chg - freed)); |
|  |  | hugetlb\_acct\_memory(h, -(chg - freed)); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9048162`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F90481622d75715bfcb68501280a917dbfe516029) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.opensuse.org_a6dc7c12_20250125_162538.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/#7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH)

# [security-announce] SUSE-SU-2012:0616-1: important: Security update for Linux kernel

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

14 May
2012

14 May
'12

14:08

SUSE Security Update: Security update for Linux kernel
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2012:0616-1
Rating: important
References: #611264 #617344 #624072 #652942 #668194 #676204
#688079 #693639 #697920 #700449 #704280 #713148
#714507 #716850 #717994 #719793 #720374 #721366
#727834 #729247 #731809 #733761 #734300 #734900
#737326 #738210 #738503 #738528 #738679 #740180
#740895 #740969 #742210 #742358 #743209 #743619
#744163 #744658 #745422 #745699 #745832 #745929
#746980 #747028 #747430 #747445 #748112 #748279
#748812 #749342 #749569 #749886 #750079 #750171
#751322 #751844 #751880 #752491 #752634 #752972
#755178 #755537 #756448 #756840 #757917 #758532
#758813 #759544
Cross-References: CVE-2011-1083 CVE-2011-4086 CVE-2011-4622
CVE-2012-0045 CVE-2012-0879 CVE-2012-1090
CVE-2012-1097 CVE-2012-2133
Affected Products:
SUSE Linux Enterprise Server 11 SP2
SUSE Linux Enterprise Server 11 SP1 for VMware
SUSE Linux Enterprise Server 11 SP1
SUSE Linux Enterprise High Availability Extension 11 SP1
SUSE Linux Enterprise Desktop 11 SP2
SUSE Linux Enterprise Desktop 11 SP1
SLE 11 SERVER Unsupported Extras
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves 8 vulnerabilities and has 60 fixes is
now available. It includes one version update.
Description:
The SUSE Linux Enterprise 11 SP1 kernel have been updated
to the 2.6.32.59 stable release to fix a lot of bugs and
security issues.
The following security issues have been fixed:
\* CVE-2012-2133: A use after free bug in hugetlb
support could be used by local attackers to crash the
system.
\* CVE-2012-1097: A null pointer dereference bug in the
regsets proc file could be used by local attackers to
perhaps crash the system. With mmap\_min\_addr is set and
enabled, exploitation is unlikely.
\* CVE-2012-0879: A reference counting issue in CLONE\_IO
could be used by local attackers to cause a denial of
service (out of memory).
\* CVE-2012-1090: A file handle leak in CIFS code could
be used by local attackers to crash the system.
\* CVE-2011-1083: Large nested epoll chains could be
used by local attackers to cause a denial of service
(excessive CPU consumption).
\* CVE-2011-4622: When using KVM, programming a PIT
timer without a irqchip configuration, can be used to crash
the kvm guest. This likely can be done only by a privileged
guest user.
\* CVE-2012-0045: A KVM 32bit guest crash in "syscall"
opcode handling was fixed that could be caused by local
attackers.
\* CVE-2011-4086: Fixed a oops in jbd/jbd2 that could be
caused by specific filesystem access patterns.
The following non-security issues have been fixed:
X86:
\* x86: fix the initialization of physnode\_map
(bnc#748112).
\* x86: Allow bootmem reserves at greater than 8G node
offset within a node (bnc#740895).
\* x86, tsc: Fix SMI induced variation in
quick\_pit\_calibrate(). (bnc#751322)
\* x86, efi: Work around broken firmware. (bnc#714507)
BONDING:
\* bonding: update speed/duplex for NETDEV\_CHANGE
(bnc#752634).
\* bonding: comparing a u8 with -1 is always false
(bnc#752634).
\* bonding: start slaves with link down for ARP monitor
(bnc#752634).
\* bonding: send gratuitous ARP for all addresses
(bnc#752491).
XFS:
\* xfs: Fix excessive inode syncing when project quota
is exceeded (bnc#756448).
\* xfs: Fix oops on IO error during
xlog\_recover\_process\_iunlinks() (bnc#716850).
SCSI:
\* scsi/ses: Handle non-unique element descriptors
(bnc#749342, bnc#617344).
\* scsi/sd: mark busy sd majors as allocated
(bug#744658).
\* scsi: Check for invalid sdev in
scsi\_prep\_state\_check() (bnc#734300).
MD/RAID:
\* md: fix possible corruption of array metadata on
shutdown.
\* md: ensure changes to write-mostly are reflected in
metadata (bnc#755178).
\* md: do not set md arrays to readonly on shutdown
(bnc#740180, bnc#713148, bnc#734900).
XEN:
\* smpboot: adjust ordering of operations.
\* x86-64: provide a memset() that can deal with 4Gb or
above at a time (bnc#738528).
\* blkfront: properly fail packet requests (bnc#745929).
\* Update Xen patches to 2.6.32.57.
\* xenbus: Reject replies with payload >
XENSTORE\_PAYLOAD\_MAX.
\* xenbus\_dev: add missing error checks to watch
handling.
\* Refresh other Xen patches (bnc#652942, bnc#668194,
bnc#688079).
\* fix Xen-specific kABI issue in Linux 2.6.19.
NFS:
\* NFSD: Fill in WCC data for REMOVE, RMDIR, MKNOD, and
MKDIR (bnc#751880).
\* nfs: Include SYNC flag when comparing mount options
with NOAC flag (bnc#745422).
\* NFS returns EIO for EDQUOT and others (bnc#747028).
\* lockd: fix arg parsing for grace\_period and timeout
(bnc#733761).
\* nfs: allow nfs4leasetime to be set before starting
servers (bnc#733761).
\* nfs: handle d\_revalidate of dot correctly
(bnc#731809).
S/390:
\* ctcmpc: use correct idal word list for ctcmpc
(bnc#750171,LTC#79264).
\* qeth: synchronize discipline module loading
(bnc#747430,LTC#78788).
\* qdio: avoid race leading to stall when tolerating CQ
(bnc#737326,LTC#76599).
\* kernel: no storage key operations for invalid page
table entries (bnc#737326,LTC#77697).
OTHER:
\* tlan: add cast needed for proper 64 bit operation
(bnc#756840).
\* dl2k: Tighten ioctl permissions (bnc#758813).
\* tg3: Fix RSS ring refill race condition (bnc#757917).
\* usbhid: fix error handling of not enough bandwidth
(bnc#704280).
\* pagecache limit: Fix the shmem deadlock (bnc#755537).
\* tty\_audit: fix tty\_audit\_add\_data live lock on audit
disabled (bnc#721366).
\* ixgbe: driver sets all WOL flags upon initialization
so that machine is powered on as soon at it is switched off
(bnc#693639)
\* PCI: Set device power state to PCI\_D0 for device
without native PM support (bnc#752972).
\* dlm: Do not allocate a fd for peeloff (bnc#729247).
\* sctp: Export sctp\_do\_peeloff (bnc#729247).
\* epoll: Do not limit non-nested epoll paths
(bnc#676204).
\* mlx4: Limit MSI-X vector allocation (bnc#624072).
\* mlx4: Changing interrupt scheme (bnc#624072).
\* mlx4\_en: Assigning TX irq per ring (bnc#624072).
\* mlx4\_en: Restoring RX buffer pointer in case of
failure (bnc#624072).
\* mlx4\_en: using new mlx4 interrupt scheme (bnc#624072).
\* igb: Fix for Alt MAC Address feature on 82580 and
later devices (bnc#746980).
\* igb: Power down link when interface is down
(bnc#745699).
\* igb: use correct bits to identify if managability is
enabled (bnc#743209).
\* intel\_agp: Do not oops with zero stolen memory
(bnc#738679).
\* agp: fix scratch page cleanup (bnc#738679).
\* hugetlb: add generic definition of NUMA\_NO\_NODE
(bnc#751844).
\* sched: Fix proc\_sched\_set\_task() (bnc#717994).
\* PM: Print a warning if firmware is requested when
tasks are frozen (bnc#749886).
\* PM / Sleep: Fix freezer failures due to racy
usermodehelper\_is\_disabled() (bnc#749886).
\* PM / Sleep: Fix read\_unlock\_usermodehelper() call
(bnc#749886).
\* firmware loader: allow builtin firmware load even if
usermodehelper is disabled (bnc#749886).
\* PM / Hibernate: Enable usermodehelpers in
software\_resume() error path (bnc#744163).
\* ipv6: Allow inet6\_dump\_addr() to handle more than 64
addresses (bnc#748279).
\* ipv6: fix refcnt problem related to POSTDAD state
(bnc#743619).
\* be2net: change to show correct physical link status
(bnc#727834).
\* be2net: changes to properly provide phy details
(bnc#727834).
\* aio: fix race between io\_destroy() and io\_submit()
(bnc#747445 bnc#611264).
\* intel-iommu: Check for identity mapping candidate
using system dma mask (bnc#700449).
\* intel-iommu: Dont cache iova above 32bit (bnc#700449).
\* intel-iommu: Add domain check in
domain\_remove\_one\_dev\_info (bnc#700449).
\* intel-iommu: Provide option to enable 64-bit IOMMU
pass through mode (bnc#700449).
\* intel-iommu: Remove Host Bridge devices from identity
mapping (bnc#700449).
\* intel-iommu: Speed up processing of the
identity\_mapping function (bnc#700449).
\* intel-iommu: Use coherent DMA mask when requested
(bnc#700449).
\* 1: Fix accounting of softirq time when idle
(bnc#719793).
\* driver-core: fix race between device\_register and
driver\_register (bnc#742358).
\* dcache:
patches.fixes/large-hash-dcache\_init-fix.patch: Fix oops
when initializing large hash on > 16TB machine (bnc#742210).
\* kdump: Save PG\_compound or PG\_head value in
VMCOREINFO (bnc#738503).
\* Update config files: disable NET\_9P\_RDMA (bnc#720374).
\* cdc-wdm: fix race leading leading to memory
corruption (bnc#759544).
Security Issue references:
\* CVE-2011-1083
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1083>

...

\* CVE-2011-4086
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4086>

...

\* CVE-2011-4622
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4622>

...

\* CVE-2012-0045
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0045>

...

\* CVE-2012-0879
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0879>

...

\* CVE-2012-1090
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1090>

...

\* CVE-2012-1097
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1097>

...

\* CVE-2012-2133
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-2133>

...

Indications:
Everyone using the Linux Kernel on x86\_64 architecture should update.
Special Instructions and Notes:
Please reboot the system after installing this update.
Patch Instructions:
To install this SUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- SUSE Linux Enterprise Server 11 SP2:
zypper in -t patch slessp1-kernel-6227 slessp1-kernel-6228 slessp1-kernel-6229 slessp1-kernel-6238
- SUSE Linux Enterprise Server 11 SP1 for VMware:
zypper in -t patch slessp1-kernel-6227 slessp1-kernel-6230
- SUSE Linux Enterprise Server 11 SP1:
zypper in -t patch slessp1-kernel-6227 slessp1-kernel-6228 slessp1-kernel-6229 slessp1-kernel-6230 slessp1-kernel-6238
- SUSE Linux Enterprise High Availability Extension 11 SP1:
zypper in -t patch sleshasp1-kernel-6227 sleshasp1-kernel-6228 sleshasp1-kernel-6229 sleshasp1-kernel-6230 sleshasp1-kernel-6238
- SUSE Linux Enterprise Desktop 11 SP2:
zypper in -t patch sledsp1-kernel-6227
- SUSE Linux Enterprise Desktop 11 SP1:
zypper in -t patch sledsp1-kernel-6227 sledsp1-kernel-6230
To bring your system up-to-date, use "zypper patch".
Package List:
- SUSE Linux Enterprise Server 11 SP2 (i586 ia64 ppc64 s390x):
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-default-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-trace-0\_2.6.32.59\_0.3-7.9.59
- SUSE Linux Enterprise Server 11 SP2 (ppc64):
ext4dev-kmp-ppc64-0\_2.6.32.59\_0.3-7.9.59
- SUSE Linux Enterprise Server 11 SP2 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-pae-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-xen-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-trace-0\_2.6.32.59\_0.3-0.18.16
kernel-ec2-2.6.32.59-0.3.1
kernel-ec2-base-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (i586 x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-default-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-trace-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-trace-0\_2.6.32.59\_0.3-0.18.16
kernel-default-2.6.32.59-0.3.1
kernel-default-base-2.6.32.59-0.3.1
kernel-default-devel-2.6.32.59-0.3.1
kernel-source-2.6.32.59-0.3.1
kernel-syms-2.6.32.59-0.3.1
kernel-trace-2.6.32.59-0.3.1
kernel-trace-base-2.6.32.59-0.3.1
kernel-trace-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-pae-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-pae-2.6.32.59-0.3.1
kernel-pae-base-2.6.32.59-0.3.1
kernel-pae-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586 ia64 ppc64 s390x x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-default-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-trace-0\_2.6.32.59\_0.3-7.9.59
kernel-default-2.6.32.59-0.3.1
kernel-default-base-2.6.32.59-0.3.1
kernel-default-devel-2.6.32.59-0.3.1
kernel-source-2.6.32.59-0.3.1
kernel-syms-2.6.32.59-0.3.1
kernel-trace-2.6.32.59-0.3.1
kernel-trace-base-2.6.32.59-0.3.1
kernel-trace-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586 x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-xen-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-trace-0\_2.6.32.59\_0.3-0.18.16
kernel-ec2-2.6.32.59-0.3.1
kernel-ec2-base-2.6.32.59-0.3.1
kernel-ec2-devel-2.6.32.59-0.3.1
kernel-xen-2.6.32.59-0.3.1
kernel-xen-base-2.6.32.59-0.3.1
kernel-xen-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (s390x) [New Version: 2.6.32.59]:
kernel-default-man-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (ppc64) [New Version: 2.6.32.59]:
ext4dev-kmp-ppc64-0\_2.6.32.59\_0.3-7.9.59
kernel-ppc64-2.6.32.59-0.3.1
kernel-ppc64-base-2.6.32.59-0.3.1
kernel-ppc64-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-pae-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-pae-2.6.32.59-0.3.1
kernel-pae-base-2.6.32.59-0.3.1
kernel-pae-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise High Availability Extension 11 SP1 (i586 ia64 ppc64 s390x x86\_64):
cluster-network-kmp-default-1.4\_2.6.32.59\_0.3-2.5.45
cluster-network-kmp-trace-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-default-2\_2.6.32.59\_0.3-0.2.91
gfs2-kmp-trace-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-default-1.6\_2.6.32.59\_0.3-0.4.2.45
ocfs2-kmp-trace-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise High Availability Extension 11 SP1 (i586 x86\_64):
cluster-network-kmp-xen-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-xen-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-xen-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise High Availability Extension 11 SP1 (ppc64):
cluster-network-kmp-ppc64-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-ppc64-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-ppc64-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise High Availability Extension 11 SP1 (i586):
cluster-network-kmp-pae-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-pae-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-pae-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise Desktop 11 SP2 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-desktop-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Desktop 11 SP1 (i586 x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
kernel-default-2.6.32.59-0.3.1
kernel-default-base-2.6.32.59-0.3.1
kernel-default-devel-2.6.32.59-0.3.1
kernel-default-extra-2.6.32.59-0.3.1
kernel-desktop-devel-2.6.32.59-0.3.1
kernel-source-2.6.32.59-0.3.1
kernel-syms-2.6.32.59-0.3.1
kernel-trace-devel-2.6.32.59-0.3.1
kernel-xen-2.6.32.59-0.3.1
kernel-xen-base-2.6.32.59-0.3.1
kernel-xen-devel-2.6.32.59-0.3.1
kernel-xen-extra-2.6.32.59-0.3.1
- SUSE Linux Enterprise Desktop 11 SP1 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-pae-2.6.32.59-0.3.1
kernel-pae-base-2.6.32.59-0.3.1
kernel-pae-devel-2.6.32.59-0.3.1
kernel-pae-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (i586 ia64 ppc64 s390x x86\_64):
kernel-default-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (i586 x86\_64):
kernel-xen-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (ppc64):
kernel-ppc64-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (i586):
kernel-pae-extra-2.6.32.59-0.3.1
References:
<http://support.novell.com/security/cve/CVE-2011-1083.html>
<http://support.novell.com/security/cve/CVE-2011-4086.html>
<http://support.novell.com/security/cve/CVE-2011-4622.html>
<http://support.novell.com/security/cve/CVE-2012-0045.html>
<http://support.novell.com/security/cve/CVE-2012-0879.html>
<http://support.novell.com/security/cve/CVE-2012-1090.html>
<http://support.novell.com/security/cve/CVE-2012-1097.html>
<http://support.novell.com/security/cve/CVE-2012-2133.html>
<https://bugzilla.novell.com/611264>
<https://bugzilla.novell.com/617344>
<https://bugzilla.novell.com/624072>
<https://bugzilla.novell.com/652942>
<https://bugzilla.novell.com/668194>
<https://bugzilla.novell.com/676204>
<https://bugzilla.novell.com/688079>
<https://bugzilla.novell.com/693639>
<https://bugzilla.novell.com/697920>
<https://bugzilla.novell.com/700449>
<https://bugzilla.novell.com/704280>
<https://bugzilla.novell.com/713148>
<https://bugzilla.novell.com/714507>
<https://bugzilla.novell.com/716850>
<https://bugzilla.novell.com/717994>
<https://bugzilla.novell.com/719793>
<https://bugzilla.novell.com/720374>
<https://bugzilla.novell.com/721366>
<https://bugzilla.novell.com/727834>
<https://bugzilla.novell.com/729247>
<https://bugzilla.novell.com/731809>
<https://bugzilla.novell.com/733761>
<https://bugzilla.novell.com/734300>
<https://bugzilla.novell.com/734900>
<https://bugzilla.novell.com/737326>
<https://bugzilla.novell.com/738210>
<https://bugzilla.novell.com/738503>
<https://bugzilla.novell.com/738528>
<https://bugzilla.novell.com/738679>
<https://bugzilla.novell.com/740180>
<https://bugzilla.novell.com/740895>
<https://bugzilla.novell.com/740969>
<https://bugzilla.novell.com/742210>
<https://bugzilla.novell.com/742358>
<https://bugzilla.novell.com/743209>
<https://bugzilla.novell.com/743619>
<https://bugzilla.novell.com/744163>
<https://bugzilla.novell.com/744658>
<https://bugzilla.novell.com/745422>
<https://bugzilla.novell.com/745699>
<https://bugzilla.novell.com/745832>
<https://bugzilla.novell.com/745929>
<https://bugzilla.novell.com/746980>
<https://bugzilla.novell.com/747028>
<https://bugzilla.novell.com/747430>
<https://bugzilla.novell.com/747445>
<https://bugzilla.novell.com/748112>
<https://bugzilla.novell.com/748279>
<https://bugzilla.novell.com/748812>
<https://bugzilla.novell.com/749342>
<https://bugzilla.novell.com/749569>
<https://bugzilla.novell.com/749886>
<https://bugzilla.novell.com/750079>
<https://bugzilla.novell.com/750171>
<https://bugzilla.novell.com/751322>
<https://bugzilla.novell.com/751844>
<https://bugzilla.novell.com/751880>
<https://bugzilla.novell.com/752491>
<https://bugzilla.novell.com/752634>
<https://bugzilla.novell.com/752972>
<https://bugzilla.novell.com/755178>
<https://bugzilla.novell.com/755537>
<https://bugzilla.novell.com/756448>
<https://bugzilla.novell.com/756840>
<https://bugzilla.novell.com/757917>
<https://bugzilla.novell.com/758532>
<https://bugzilla.novell.com/758813>
<https://bugzilla.novell.com/759544>
[http://download.novell.com/patch/finder/?keywords=1e4adcc13979f6e0edae89a1f8...](http://download.novell.com/patch/finder/?keywords=1e4adcc13979f6e0edae89a1f83efe4b)
[http://download.novell.com/patch/finder/?keywords=53329dfb9cc84e6d2bc6d1f418...](http://download.novell.com/patch/finder/?keywords=53329dfb9cc84e6d2bc6d1f418dd371c)
[http://download.novell.com/patch/finder/?keywords=58369efceea971820d4fcd4d5a...](http://download.novell.com/patch/finder/?keywords=58369efceea971820d4fcd4d5a7c2ef6)
[http://download.novell.com/patch/finder/?keywords=59f23e0836e0df248ae14c769e...](http://download.novell.com/patch/finder/?keywords=59f23e0836e0df248ae14c769ecdd7d3)
[http://download.novell.com/patch/finder/?keywords=763d59c2691aa9de51f489118d...](http://download.novell.com/patch/finder/?keywords=763d59c2691aa9de51f489118dbe394c)
[http://download.novell.com/patch/finder/?keywords=a1f901b5aa53a2ebe1c8ee72b5...](http://download.novell.com/patch/finder/?keywords=a1f901b5aa53a2ebe1c8ee72b5bf4f77)
[http://download.novell.com/patch/finder/?keywords=aec0b832ae76838da3b2076f7d...](http://download.novell.com/patch/finder/?keywords=aec0b832ae76838da3b2076f7d59e991)
[http://download.novell.com/patch/finder/?keywords=c9182ab9f8793390d728336608...](http://download.novell.com/patch/finder/?keywords=c9182ab9f8793390d7283366086c5f96)
[http://download.novell.com/patch/finder/?keywords=eb828a35b91422d320f8c3f2f8...](http://download.novell.com/patch/finder/?keywords=eb828a35b91422d320f8c3f2f81d2876)
[http://download.novell.com/patch/finder/?keywords=efd514eca66da8be4a95dffed7...](http://download.novell.com/patch/finder/?keywords=efd514eca66da8be4a95dffed72779e5)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/#7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.openwall.com_3c4878df_20250125_162547.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](11) [[next>]](13) [[<thread-prev]](10) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4F96C564.9040003@redhat.com>
Date: Tue, 24 Apr 2012 09:23:16 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
CC: Marcus Meissner <meissner@...e.de>
Subject: Re: CVE Request: use after free bug in "quota" handling
 in hugetlb code

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 04/24/2012 08:34 AM, Marcus Meissner wrote:
> Hi,
>
> Reported by Schacher Raindel, quoting his report:
>
> There is a use after free bug in the kernel hugetlb code. The bug
> can allow an authenticated, unprivileged local attacker to crash
> the system (and possibly gain higher privileges) if huge pages are
> enabled in the system.
>
> A fix has been committed to upstream, commit
> 90481622d75715bfcb68501280a917dbfe516029 "hugepages: fix use after
> free bug in "quota" handling"
>
> Version-Release number of selected component (if applicable): The
> bug exists in kernel versions 2.6.24 and above.
>
> References: <https://bugzilla.novell.com/show_bug.cgi?id=758532>
> <https://bugzilla.redhat.com/show_bug.cgi?id=815065>
> <http://git.kernel.org/?p=linux/kernel/git/torvalds/linux.git;a=commit;h=90481622d75715bfcb68501280a917dbfe516029>
>
>  Ciao, Marcus

Please use CVE-2012-2133 for this issue.

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iQIcBAEBAgAGBQJPlsVkAAoJEBYNRVNeJnmTvF4QAJoyBiApjksbSQdkbJgfiO9w
AmGLaMxu/6krtEFmn8u3nwbguBn2QnERXuvtq+vC+/9LWieNIadt4pfbULFXd9Sz
PtBfc87p1xiQsZ9KZbbDMCSsWLkjQSTuqIvaD0imL4O9oYRr2tA7+Khxd1WYd+pI
fqciAWiixZ+Au6Bw+pXXZycWqBXNC9sCMD5f2lbJwMyBJGQLsfI/zyrmqS0IDhE4
aLW5s6DJ1KmfuopQo0U+H9Yr2kyjIVTgj4CBzcXE6pJQ3sXWKyupEEHd2jCGv5ss
jgPC/sSgvgTKWk+XIZNxjazFnjB/dXOhI3/FTwdAtjZFoKRqSjBKmPz0Z/fUZVox
BP3uC6Ff56hhuKYFDWN+FZpftlKidzTej4/oKNtM8+TXVUfoFnJzKlHWyIuMG2/5
jp3EYHRQnrDcrdrgiQVApegzPbDCsyyVfoo9h7GDDpVjEQnbFRYywa3gZCwyLKIT
tYGPcNUTMD1S6IRwh5axtKfm/rS6+0i08soUBZAPAglEmMIkmtCeT0ljSG4A7yoz
U4+hheWQILGBvSImwnD5Iql2FonZoNH0rInrwv+6agUz63z+ScFpoAAQ8h2gTiEG
oo8xMW/mMPvBVBXse3NEbzsnko6LjuH3CUF4qJLOLUni3tPAbWvmUMYH1TZ/s/28
BblHDRUQsCrcN8NcGmyz
=l5QG
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from bugzilla.redhat.com_5438b164_20250125_162549.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D817430)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D817430)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D817430)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 817430

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 817430**](show_bug.cgi?id=817430)
(CVE-2012-2133)
- [CVE-2012-2133](https://access.redhat.com/security/cve/CVE-2012-2133) kernel: use after free bug in "quota" handling

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-2133 kernel: use after free bug in "quota" handling

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-2133 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (1): | [815065](show_bug.cgi?id=815065 "CLOSED DUPLICATE - CVE-2012-2133 kernel: use after free bug in \"quota\" handling")  ([view as bug list](buglist.cgi?bug_id=815065)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [843034](show_bug.cgi?id=843034) [843035](show_bug.cgi?id=843035) [843036](show_bug.cgi?id=843036) [843037](show_bug.cgi?id=843037) [843038](show_bug.cgi?id=843038 "CLOSED CURRENTRELEASE - CVE-2012-2133 kernel: use after free bug in \"quota\" handling [fedora-all]") [927272](show_bug.cgi?id=927272) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [815174](show_bug.cgi?id=815174) | | TreeView+ | [depends on](buglist.cgi?bug_id=817430&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=817430&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-04-30 01:05 UTC by Eugene Teo (Security Response) | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-05-11 19:00 UTC ([History](show_activity.cgi?id=817430)) | | [CC List:](page.cgi?id=fields.html#cclist) | 19 users (show)  aiyengar davej dhoward fweisbec gansalmon itamar jforbes jonathan jrusnack jwboyer kernel-maint kernel-mgr lwang madhu.chinakonda pmatouse raindel rwheeler sforsber vgoyal | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2013-04-16 19:19:16 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2012:1426](https://access.redhat.com/errata/RHSA-2012%3A1426) | 0 | normal | SHIPPED\_LIVE | Moderate: kernel security and bug fix update | 2012-11-06 23:14:35 UTC | | Red Hat Product Errata | [RHSA-2012:1491](https://access.redhat.com/errata/RHSA-2012%3A1491) | 0 | normal | SHIPPED\_LIVE | Important: kernel-rt security and bug fix update | 2012-12-05 00:50:25 UTC | | Red Hat Product Errata | [RHSA-2013:0741](https://access.redhat.com/errata/RHSA-2013%3A0741) | 0 | normal | SHIPPED\_LIVE | Important: kernel security and bug fix update | 2013-04-16 22:33:36 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=817430#c0)  Eugene Teo (Security Response)    2012-04-30 01:05:57 UTC  ``` There is a use after free bug in the kernel hugetlb code. The bug can allow an authenticated, unprivileged local attacker to crash the system (and possibly gain higher privileges) if huge pages are enabled in the system.  A fix has been committed to upstream, commit 90481622d75715bfcb68501280a917dbfe516029 "hugepages: fix use after free bug in "quota" handling"  Version-Release number of selected component (if applicable): The bug exists in kernel versions 2.6.24 and above.  How reproducible: The attached tarball includes an example code which utilizes a fuse mount with O_DIRECT flag to reproduce the issue. The code will work only on kernels 2.6.32 and above since it uses the new "anonymous mapping" API for getting huge pages.  Similar reproduction is possible when using the shmem API or the hugetlbfs API.  Stock kernel might not crash, debug kernel will detect the corruption and kill the process.  Steps to Reproduce: 1. Untar the attached file 2. Run run_test.sh. The fuse-devel package and sudo rights are required for the fuse mount. Sudo rights are also required for enabling huge pages. 3. Observe the kernel crash when running debug kernel. Normal kernels will (usually) not crash, as the slab allocator will not return the memory blocks to the system general pool for a while.  Actual results: A general protection fault message is printed, and the server is frozen.  Expected results: The process should exit without the kernel crashing.  Additional info: Verified on RHEL 6.0 with Dell PowerEdge 2950, should exist also on RHEL 6.2 and 6.1.  Upstream commit: <http://git.kernel.org/linus/90481622d75715bfcb68501280a917dbfe516029>  Acknowledgements:  Red Hat would like to thank Shachar Raindel for reporting this issue.   ```  [Comment 2](show_bug.cgi?id=817430#c2)  Eugene Teo (Security Response)    2012-04-30 01:08:50 UTC  ``` *** [Bug 815065](show_bug.cgi?id=815065 "CLOSED DUPLICATE - CVE-2012-2133 kernel: use after free bug in \"quota\" handling") has been marked as a duplicate of this bug. ***   ```  [Comment 3](show_bug.cgi?id=817430#c3)  Petr Matousek    2012-07-25 11:52:45 UTC  ``` Statement:  This issue did not affect the versions of the Linux kernel as shipped with Red Hat Enterprise Linux 5. Future kernel updates for Red Hat Enterprise Linux 6 and Red Hat Enterprise Linux MRG 2 may address this issue.   ```  [Comment 6](show_bug.cgi?id=817430#c6)  Petr Matousek    2012-07-25 11:55:10 UTC  ``` Created kernel tracking bugs for this issue  Affects: fedora-all [[bug 843038](show_bug.cgi?id=843038 "CLOSED CURRENTRELEASE - CVE-2012-2133 kernel: use after free bug in \"quota\" handling [fedora-all]")]   ```  [Comment 7](show_bug.cgi?id=817430#c7)  Frederic Weisbecker    2012-08-01 13:49:26 UTC  ``` (In reply to [comment #0](show_bug.cgi?id=817430#c0)) > There is a use after free bug in the kernel hugetlb code. The bug can allow > an authenticated, unprivileged local attacker to crash the system (and > possibly gain higher privileges) if huge pages are enabled in the system. >  > A fix has been committed to upstream, commit > 90481622d75715bfcb68501280a917dbfe516029 "hugepages: fix use after free bug > in "quota" handling" >  > Version-Release number of selected component (if applicable): > The bug exists in kernel versions 2.6.24 and above. >  > How reproducible: > The attached tarball includes an example code which utilizes a fuse mount > with O_DIRECT flag to reproduce the issue. The code will work only on > kernels 2.6.32 and above since it uses the new "anonymous mapping" API for > getting huge pages.  Similar reproduction is possible when using the shmem > API or the hugetlbfs API.  Stock kernel might not crash, debug kernel will > detect the corruption and kill the process. >  > Steps to Reproduce: > 1. Untar the attached file > 2. Run run_test.sh. The fuse-devel package and sudo rights are required for > the fuse mount. Sudo rights are also required for enabling huge pages. > 3. Observe the kernel crash when running debug kernel. Normal kernels will > (usually) not crash, as the slab allocator will not return the memory blocks > to the system general pool for a while.  Hi Eugene.  The proposed testcase seem to be missing in attachment.   ```  [Comment 8](show_bug.cgi?id=817430#c8)  Petr Matousek    2012-08-01 14:01:58 UTC  ``` (In reply to [comment #7](show_bug.cgi?id=817430#c7)) > Hi Eugene. >  > The proposed testcase seem to be missing in attachment.  Please see [bug 815065 comment #0](show_bug.cgi?id=815065#c0 "CLOSED DUPLICATE - CVE-2012-2133 kernel: use after free bug in \"quota\" handling")   ```  [Comment 10](show_bug.cgi?id=817430#c10)  errata-xmlrpc    2012-11-06 18:17:41 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2012:1426 <https://rhn.redhat.com/errata/RHSA-2012-1426.html>   ```  [Comment 11](show_bug.cgi?id=817430#c11)  errata-xmlrpc    2012-12-04 19:58:13 UTC  ``` This issue has been addressed in following products:    MRG for RHEL-6 v.2  Via RHSA-2012:1491 <https://rhn.redhat.com/errata/RHSA-2012-1491.html>   ```  [Comment 13](show_bug.cgi?id=817430#c13)  errata-xmlrpc    2013-04-16 18:33:55 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6.2 EUS - Server Only  Via RHSA-2013:0741 <https://rhn.redhat.com/errata/RHSA-2013-0741.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=817430&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugzilla.redhat.com_67ccef12_20250126_101542.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D815065)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D815065)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D815065)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 815065

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 815065**](show_bug.cgi?id=815065)
- [CVE-2012-2133](https://access.redhat.com/security/cve/CVE-2012-2133) kernel: use after free bug in "quota" handling

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-2133 kernel: use after free bug in "quota" handling

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED DUPLICATE of [bug 817430](show_bug.cgi?id=817430 "CLOSED ERRATA - CVE-2012-2133 kernel: use after free bug in \"quota\" handling") | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | unspecified | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [815174](show_bug.cgi?id=815174) | | TreeView+ | [depends on](buglist.cgi?bug_id=815065&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=815065&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-04-22 10:11 UTC by Shachar Raindel | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2012-06-04 14:35 UTC ([History](show_activity.cgi?id=815065)) | | [CC List:](page.cgi?id=fields.html#cclist) | 4 users (show)  dledford ogerlitz security-response-team yishaih | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2012-04-30 01:08:50 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=815065#c0)  Shachar Raindel    2012-04-22 10:11:53 UTC  ``` Created [attachment 579274](attachment.cgi?id=579274) [[details]](attachment.cgi?id=579274&action=edit) Example code - will crash a machine running a debug kernel  Description of problem:  There is a use after free bug in the kernel hugetlb code. The bug can allow an authenticated, unprivileged local attacker to crash the system (and possibly gain higher privileges) if huge pages are enabled in the system.  A fix has been committed to upstream, commit 90481622d75715bfcb68501280a917dbfe516029 "hugepages: fix use after free bug in "quota" handling"  Version-Release number of selected component (if applicable): The bug exists in kernel versions 2.6.24 and above.   How reproducible:  The attached tarball includes an example code which utilizes a fuse mount with O_DIRECT flag to reproduce the issue. The code will work only on kernels 2.6.32 and above since it uses the new "anonymous mapping" API for getting huge pages. Similar reproduction is possible when using the shmem API or the hugetlbfs API.  Stock kernel might not crash, debug kernel will detect the corruption and kill the process.  Steps to Reproduce: 1. Untar the attached file 2. Run run_test.sh. The fuse-devel package and sudo rights are required for the fuse mount. Sudo rights are also required for enabling huge pages. 3. Observe the kernel crash when running debug kernel. Normal kernels will (usually) not crash, as the slab allocator will not return the memory blocks to the system general pool for a while.    Actual results:  A general protection fault message is printed, and the server is frozen.  Expected results:  The process should exit without the kernel crashing.  Additional info:  Verified on RHEL 6.0 with Dell PowerEdge 2950, should exist also on RHEL 6.2 and 6.1.   ```  [Comment 3](show_bug.cgi?id=815065#c3)  Kurt Seifried    2012-04-24 15:23:56 UTC  ``` Added CVE as per <http://www.openwall.com/lists/oss-security/2012/04/24/12>   ```  [Comment 4](show_bug.cgi?id=815065#c4)  Doug Ledford    2012-04-24 16:37:29 UTC  ``` I'm not sure why myself and Mellanox were added to this bug, but it is totally unrelated to code we take care of.  Removing us from the Cc: list.   ```  [Comment 5](show_bug.cgi?id=815065#c5)  Eugene Teo (Security Response)    2012-04-30 01:08:50 UTC  ```   *** This bug has been marked as a duplicate of [bug 817430](show_bug.cgi?id=817430 "CLOSED ERRATA - CVE-2012-2133 kernel: use after free bug in \"quota\" handling") ***   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=815065&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.debian.org_9914a453_20250125_162540.html ===


---

[[Date Prev](msg00104.html)][[Date Next](msg00106.html)]
[[Thread Prev](msg00104.html)][[Thread Next](msg00106.html)]
[[Date Index](maillist.html#00105)]
[[Thread Index](threads.html#00105)]

# [SECURITY] [DSA 2469-1] linux-2.6 security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 2469-1] linux-2.6 security update
* *From*: dann frazier <dannf@debian.org>
* *Date*: Thu, 10 May 2012 08:48:18 -0700
* *Message-id*: <[[🔎]](/msgid-search/20120510154818.GA4067%40dannf.org) [20120510154818.GA4067@dannf.org](msg00105.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- ----------------------------------------------------------------------
Debian Security Advisory DSA-2469-1                security@debian.org
<http://www.debian.org/security/>                           Dann Frazier
May 10, 2012                        <http://www.debian.org/security/faq>
- ----------------------------------------------------------------------

Package        : linux-2.6
Vulnerability  : privilege escalation/denial of service
Problem type   : local
Debian-specific: no
CVE Id(s)      : CVE-2011-4086 CVE-2012-0879 CVE-2012-1601 CVE-2012-2123
                 CVE-2012-2133

Several vulnerabilities have been discovered in the Linux kernel that may lead
to a denial of service or privilege escalation. The Common Vulnerabilities and
Exposures project identifies the following problems:

CVE-2011-4086

    Eric Sandeen reported an issue in the journaling layer for EXT4 filesystems
    (jbd2). Local users can cause buffers to be accessed after they have been
    torn down, resulting in a denial of service (DoS) due to a system crash.

CVE-2012-0879

    Louis Rilling reported two reference counting issues in the CLONE_IO
    feature of the kernel. Local users can prevent io context structures
    from being freed, resulting in a denial of service.

CVE-2012-1601

    Michael Ellerman reported an issue in the KVM subsystem. Local users could
    cause a denial of service (NULL pointer dereference) by creating VCPUs
    before a call to KVM_CREATE_IRQCHIP.

CVE-2012-2123

    Steve Grubb reported in an issue in fcaps, a filesystem-based capabilities
    system. Personality flags set using this mechanism, such as the disabling
    of address space randomization, may persist across suid calls.

CVE-2012-2133

    Shachar Raindel discovered a use-after-free bug in the hugepages
    quota implementation. Local users with permission to use hugepages
    via the hugetlbfs implementation may be able to cause a denial of
    service (system crash).

For the stable distribution (squeeze), this problem has been fixed in version
2.6.32-44. Updates are currently only available for the amd64, i386 and sparc
ports.

NOTE: Updated linux-2.6 packages will also be made available in the release
of Debian 6.0.5, scheduled to take place the weekend of 2012.05.12. This
pending update will be version 2.6.32-45, and provides an additional fix for
build failures on some architectures. Users for whom this update is not
critical, and who may wish to avoid multiple reboots, should consider waiting
for the 6.0.5 release before updating, or installing the 2.6.32-45 version
ahead of time from proposed-updates.

The following matrix lists additional source packages that were rebuilt for
compatibility with or to take advantage of this update:

                                             Debian 6.0 (squeeze)
     user-mode-linux                         2.6.32-1um-4+44

We recommend that you upgrade your linux-2.6 and user-mode-linux packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <http://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQIcBAEBAgAGBQJPq+L0AAoJEBv4PF5U/IZAif4P/37pRiZO/yTy5yZfIUUJFc25
THOrPGJfioLuFocGgd84+3YdC1tIPR4mFZLJbYWVmpD94x9d13Pdowt5kyaofmye
UYGl6Z5RPYQuwY1W4dFq29wEpcte1kwFXqmiCr14uEx6H0T2FAzvgN9YjTtQCt9t
r/6gkjn0NfzLnhVlER6RjMJGABW1hTUf9lME1urUCD/D8hBJwP5snjCFxjZgbeHt
NNp1vOV7pkj8DTKmSlCpmQFm1QpPM9Ix+4tCvmBG5S2pKDWtQ0O9oZlk0/e9grMU
CDUxtQy95NfSX2vIcHyNv8fwVMjtu6PxsgQPU/x6H7MPcn45Ys8Yf0ztmYilltAc
HNCswIF1hH62DOssX46JlTjcRhtNGOuGEyvzqL0sQyLbJB7xNuqQ7jYpGVyXuWCY
zAyN2OzgTeMoLzly+ZRT/m8lHh58WCXPC5lNtgU0ICxmdwudTEYa1J2HOaCvPWwd
Lki/t2c4Zv8Cs0o1BFd1OYwgTetOa2hFxAX61+Hr2TKeIayBgruX/VWZmd/m6S0v
fR+5JwiiRxh7YXLgTOZf+4rBeYHi/XBmcKMOiB/RQYUnq1+kWH46kOowqq2WbaTN
SBFTCxQNI1rwjdJ4YrL5NwOixzCwypp4MYzhw58/+pLsuUfpUqBp88GRkiS2DqNm
rGAnURG2dPbD6A/7UiVE
=ztHh
-----END PGP SIGNATURE-----

```

---


