=== Content from github.com_ccb3a1e1_20250124_150632.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femeryberger%2FHoard%2Fblob%2Fmaster%2FNEWS)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femeryberger%2FHoard%2Fblob%2Fmaster%2FNEWS)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=emeryberger%2FHoard)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[emeryberger](/emeryberger)
/
**[Hoard](/emeryberger/Hoard)**
Public

* [Notifications](/login?return_to=%2Femeryberger%2FHoard) You must be signed in to change notification settings
* [Fork
  131](/login?return_to=%2Femeryberger%2FHoard)
* [Star
   1.1k](/login?return_to=%2Femeryberger%2FHoard)

* [Code](/emeryberger/Hoard)
* [Issues
  11](/emeryberger/Hoard/issues)
* [Pull requests
  0](/emeryberger/Hoard/pulls)
* [Actions](/emeryberger/Hoard/actions)
* [Projects
  0](/emeryberger/Hoard/projects)
* [Wiki](/emeryberger/Hoard/wiki)
* [Security](/emeryberger/Hoard/security)
* [Insights](/emeryberger/Hoard/pulse)

Additional navigation options

* [Code](/emeryberger/Hoard)
* [Issues](/emeryberger/Hoard/issues)
* [Pull requests](/emeryberger/Hoard/pulls)
* [Actions](/emeryberger/Hoard/actions)
* [Projects](/emeryberger/Hoard/projects)
* [Wiki](/emeryberger/Hoard/wiki)
* [Security](/emeryberger/Hoard/security)
* [Insights](/emeryberger/Hoard/pulse)

## Files

 master
## Breadcrumbs

1. [Hoard](/emeryberger/Hoard/tree/master)
/
# NEWS

Copy path Blame  Blame
## Latest commit

## History

[History](/emeryberger/Hoard/commits/master/NEWS)301 lines (205 loc) · 9.23 KB master
## Breadcrumbs

1. [Hoard](/emeryberger/Hoard/tree/master)
/
# NEWS

Top
## File metadata and controls

* Code
* Blame

301 lines (205 loc) · 9.23 KB[Raw](https://github.com/emeryberger/Hoard/raw/refs/heads/master/NEWS)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300
 The Hoard Multiprocessor Memory Allocator <http://www.hoard.org>
 Version Information -------------------
Since 2012, all commit information has been publicly accessible in theHoard github repository (https://github.com/emeryberger/Hoard); thisinformation is preserved here for historical reasons only.
--------------------------------------------------------------------------------
version 3.9 (June 10, 2012): \* Overhauled Heap Layers and cleaned up directory structure. \* Fixed allocator to eliminate integer overflow (CVE-2012-2676). See also http://www.openwall.com/lists/oss-security/2012/06/07/13.
version 3.8.1: \* Vastly improved Mac support: works for a wide range of applications without the need to declare "flat namespaces."
version 3.8 (Nov 9, 2009): \* Refactored and fixed TLAB support to do appropriate cleanup. \* Added interception of Solaris threads API (thr\_\*). \* Moved createKey out of critical path, improving speed for Unix platforms that do not support \_\_thread. \* Added a lock to AlignedMmap to prevent a possible race condition. \* Changed hooks to use GNU-supported hooks on platforms with glibc (especially Linux). \* Changed all code to include C++ headers (e.g., <cassert> instead of <assert.h>). \* Improved Mac support. \* Added robustness, checking for heap corruption or other errors. \* Improved Windows support (added \_recalloc interception). \* Fixed incorrect handling of a (highly unlikely) out-of-memory condition in bumpalloc.h.
version 3.7.1 (Feb. 20, 2008): \* Fixed a serious bug for Windows in thread reclamation. \* Fixed a small memory leak in thread creation. \* Substantially increased performance for small objects on 64-bit platforms. \* Initial port to Windows 64.
version 3.7 (Sept. 18, 2007): \* Streamlined fast path for allocation, speeding 32 and 64-bit code. \* Use pthread\_\* based thread-specific data for x86-64, where it's faster.
version 3.6.2 (May 25, 2007): \* Fixed build for Mac OS X (Darwin). \* Fixed to support older versions of Sun compilers. \* Added FreeBSD ("freebsd") as a target.
version 3.6.1 (May 21, 2007): \* Added x86-64 target for Linux/gcc. \* Added support for posix\_memalign (for Unix systems). \* Added static library build option for Linux.
version 3.6 (May 10, 2007): \* Improved performance, especially from thread-specific heap allocation. \* Revised algorithm for large objects to reduce mmap fragmentation. \* Added support for Solaris x86 (32 and 64 bit). \* Fixed a problem for 64-bit builds. \* Removed support for Detours. \* Restored to top-level status (moved heaplayers to a directory). \* Changed thread-specific data for Windows to support use in DLLs. \* Build now fully supports Mac OS X (Darwin).
version 3.5.1 (May 22, 2006): \* Eliminated a (rare) memory error.
version 3.5.0 (May 18, 2006): \* Resolved some cross-platform memory leaks, notably for Windows due to surprising VirtualFree API (which doesn't reclaim memory unless size argument is 0).
version 3.4.0 (December 28, 2005):
 \* Added support for X86-64, Apple OS-X, and Microsoft's Visual Studio 2005.
 \* Restored Detours version, but with thread-specific local heaps disabled.
 \* Removed all dependencies on STL.
version 3.3.0 (May 27, 2005):
 \* Added thread-specific local heaps, which substantially improve performance by eliminating most atomic operations.
version 3.2.3:
 \* Bug fix for Unix platforms, now allowing calls to pthread\_create with a NULL attribute.
 \* Added support for ARM architectures.
version 3.2.2 (Dec 13, 2004):
 \* Reduces memory consumption for large objects (Windows).
version 3.2.1 (Dec 3, 2004):
 \* Maintenance release: fixes a bug for 64-bit versions and changes the Windows build (for winhoard) slightly.
version 3.2 (Nov 28, 2004):
 \* An improved Windows build (see NOTES.windows). \* An algorithmic change (essentially a variant of thread-local allocation buffers) that boosts performance by avoiding atomic operations.
version 3.1 (Nov 14, 2004):
 \* Several performance optimizations. \* A minor bug fix for non-Windows platforms.
version 3 (Nov 21, 2003):
 \* Switched over to Heap Layers-based implementation. \* Added single-threaded optimization (if no threads spawned, no locks).
version 2.1.2 (April 7, 2003):
 \* Made the code 64-bit clean. \* Fixed a bug in recycling free memory on uniprocessors.
version 2.1.1:
 \* Added Debian distribution support. \* Fixed a Linux compilation bug in a benchmark. \* Added automake-produced Makefiles for all benchmarks. \* Added pthread\_atfork handlers to avoid deadlocks when using fork().
version 2.1.0 (December 24, 2001):
 \* Now ships as a DLL for Windows. \* Reduced internal fragmentation for small objects. \* A variety of performance improvements. \* Patched to work on 64-bit Solaris. \* Removed BeOS support. \* Simplified user-level locking. \* Incorporated Doug Lea's malloc as a faster backing store than mmap(), for non-Windows execution.
version 2.0.6 (July 10, 2001):
 \* Fix to allow Hoard to work with MFC under Windows.
version 2.0.5 (Mar 17, 2001):
 \* Fix to work with the new Sun WorkShop compiler.
version 2.0.4 (Mar 14, 2001):
 \* Fix to allow Hoard to work with Debug builds under Windows.
version 2.0.3 (Feb 17, 2001):
 \* Added a fix for better fragmentation on uniprocessors, added a "winprojects" directory for easier building on Windows under Visual Studio, improved realloc performance, and fixed a bug for out-of-memory conditions.
version 2.0.2 (Apr 6, 2000):
 \* Fixed a memory leak for SGI.
version 2.0.1:
 \* Fixed compilation on AIX with xlC (IBM).
version 2.0 (Mar 24, 2000):
 \* Added very aggressive superblock recycling. Now an empty superblock is immediately available for reuse for another size class. This can dramatically reduce fragmentation.
 \* We now preferentially allocate from recently-touched superblocks to improve page locality.
 \* Incorporated a protocol to guarantee swift superblock 'acquisition' by free().
version 1.5.3: (not generally released)
 \* Miscellaneous bug fixes.
version 1.5.2 (Feb 24, 2000):
 \* Fixed a problem on some Linux systems that caused many large allocations to fail. \* Fixed a call to VirtualFree which didn't actually release memory back to the system.
version 1.5.1 (Feb 21, 2000):
 \* Changed initialization of the process heap to fix a problem with Visual C++.
version 1.5 (Feb 18, 2000):
 \* Large blocks (> 4K) are now immediately returned to the system when they are freed.
 \* Made a number of improvements to the algorithm that ensure O(1) cost for malloc & free and guarantee low contention for free's. (These will be discussed in a paper currently in progress.) Also added a method that further reduces the number of system calls when allocating memory.
 \* Added superblock recycling to reduce fragmentation.
 \* Hoard now compiles with Sun's Workshop compilers (version 5.0) on SPARCs. (Thanks to Ganesan Rajagopal of Novell for the undocumented .il trick for inlining assembly.)
 \* Ported to AIX (IBM, PowerPC-based).
version 1.4.2 (Jan 16, 2000):
 \* A bug fix -- corrects a subtle problem with memalign. Hoard now successfully passes Wolfram Gloger's malloc-test (included with the distribution).
version 1.4.1 (Jan 12, 2000):
 \* A few fixes for backward compatibility with Solaris 2.6.
version 1.4 (Jan 11, 2000):
 \* Doubled the speed of calls to free(). \* Further improved scalability, especially on Solaris. \* Reduced memory consumption and improved performance on uniprocessors. \* Changed the lock implementation for Windows from spin to spin-yield, as in the UNIX implementations (thanks to Paul Larson of Microsoft Research for pointing out how to do this). \* Removed the shbench benchmark from the distribution, per request from MicroQuill, Inc.
version 1.3.3:
 \* Changed some casts of pointers to unsigned longs to allow Hoard to work on 64-bit machines (read: SGI O2K).
version 1.3.2 (Nov 23, 1999):
 \* Minor modifications for the Windows NT port, along with workspace and project files for Visual C++ (thanks to Arnd Bohm).
version 1.3.1:
 \* Included a customized version of 'atexit' for Linux, since the newest version of libc (2.1.2) caused Hoard to deadlock (it called malloc internally).
version 1.3 (Nov 18, 1999):
 \* Ported to the BeOS (thanks to Trey Boudreau of Be). \* Replaced the per-sizeclass locks with per-heap locks, since this has no impact on scalability and reduces Hoard's static footprint.
version 1.2 (Oct 29, 1999):
 \* Dramatically improved performance with fast user-level locks for SPARC, x86, and the SGI. \* Added sproc support (for the SGI). \* Hoard can now be built under Visual C++ (thanks to John Hickin).
version 1.1 (Oct 13, 1999):
 \* Added autoconf and automake scripts to facilitate compilation and installation (including shared libraries). (thanks to Ganesan Rajagopal of Novell for submitting the scripts)
version 1.0.3 (Oct 4, 1999):
 \* Hoard now scales on OS's besides Linux and Solaris. (the thread ID hash function was pathological for other OS's)
version 1.0.2 (Oct 4, 1999):
 \* Ported to Windows NT. \* Added in the benchmark suite (larson, linux-scalability, shbench).
version 1.0.1 (Sep 30, 1999):
 \* Fixed a build problem.
version 1.0 (Sep 29, 1999):
 \* Initial release.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_bec6d3ac_20250124_150632.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](12) [[next>]](../../../2012/06/08/1) [[<thread-prev]](9) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4FD0FD34.2050201@redhat.com>
Date: Thu, 07 Jun 2012 13:12:52 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
CC: Xi Wang <xi.wang@...il.com>, boost@...ts.boost.org, emery@...umass.edu,
        ivmai@...l.ru, webmaster2@...prod.com
Subject: Re: memory allocator upstream patches

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 06/04/2012 11:54 PM, Xi Wang wrote:
> Hi,
>
> I would like to share some upstream patches of two specific types
> of memory allocator vulnerabilities.
>
> * malloc(n) size overflow.
>
> Consider the following code pattern.
>
> 	n = read_from_input();
> 	p = malloc(n);
> 	if (p)
> 		memcpy(p, input_buffer, n);
>
> Some malloc() implementations internally perform alignment/padding
> for a large n, and the allocation size wraps around to a small
> integer.  That means they would allocate a smaller buffer than
> expected, leading to buffer overflow.
>
> * calloc(n, size) size overflow.
>
> Some calloc() implementations don't check for n * size multiplication
> overflow, and would allocate a smaller buffer than expected,
> leading to buffer overflow.
>
> The two types of vulnerabilities can be easily reproduced using
> malloc(-1) and calloc(BIG-VALUE, BIG-VALUE).  If the return values
> are non-null, the implementations are likely to be problematic.
>
> See a more complete list at:
>
> <http://kqueue.org/blog/2012/03/05/memory-allocator-security-revisited/>
>
> Below are some recent upstream fixes.
>
>
> Boehm-Demers-Weiser GC (libgc)
> ==============================
>
> malloc() size overflow, upstream patch (revised by the developers):
>
>
<https://github.com/ivmai/bdwgc/commit/be9df82919960214ee4b9d3313523bff44fd99e1>
>
> The bug in mallocx.c was found by Ivan Maidanski.
>
> calloc() size overflow, upstream patch (revised by the developers):
>
>
<https://github.com/ivmai/bdwgc/commit/e10c1eb9908c2774c16b3148b30d2f3823d66a9a>
>
<https://github.com/ivmai/bdwgc/commit/6a93f8e5bcad22137f41b6c60a1c7384baaec2b3>
>
<https://github.com/ivmai/bdwgc/commit/83231d0ab5ed60015797c3d1ad9056295ac3b2bb>

<https://github.com/ivmai/bdwgc/blob/master/malloc.c>
<https://github.com/ivmai/bdwgc/blob/master/mallocx.c>

Please use CVE-2012-2673 for this issue

> bionic (Android libc)
> =====================
>
> malloc() size overflow, upstream patch (revised by the developers):
>
>
<https://github.com/android/platform_bionic/commit/7f5aa4f35e23fd37425b3a5041737cdf58f87385>
>
> NB: this vulnerability could only be triggered in debug mode, the
> same as CVE-2009-0607, calloc() size overflow.

<https://github.com/android/platform_bionic/blob/master/libc/bionic/malloc_debug_leak.c>

Please use CVE-2012-2674 for this issue

> nedmalloc
> =========
>
> malloc() size overflow, upstream patch:
>
>
<https://github.com/ned14/nedmalloc/commit/1a759756639ab7543b650a10c2d77a0ffc7a2000>
>
> calloc() size overflow, upstream patch:
>
>
<https://github.com/ned14/nedmalloc/commit/2965eca30c408c13473c4146a9d47d547d288db1>

<https://github.com/ned14/nedmalloc/blob/master/nedmalloc.c>

Please use CVE-2012-2675 for this issue

> Hoard
> =====
>
> <http://www.hoard.org/>
>
> malloc() size overflow, confirmed by the developers via email in
> this March, no upstream patch available (since 3.8).
>
> calloc() size overflow, which should only happen on non-glibc
> platforms (e.g., Mac OS X).  It has not been confirmed by the
> developers, but one can easily reproduce it.

hoard-38/src/tlab.h

Please use CVE-2012-2676 for this issue

> boost::pool
> ===========
>
> ordered_malloc() (similar to calloc()) size overflow, upstream patch:
>
> <https://svn.boost.org/trac/boost/changeset/78326>

<http://www.boost.org/doc/libs/1_49_0/boost/pool/poolfwd.hpp>

Please use CVE-2012-2677 for this issue

> - xi

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iQIcBAEBAgAGBQJP0P00AAoJEBYNRVNeJnmTegUP/RzPWBuDk5uc5VX7GfNwl2bV
Tj6vK8eR3PqC0eWZ9J84Ak1Rr/sArq7+eF2jQzB2y5nazrvq8+CbLG45+aG/tc/k
/s1WgQlPf0/cSdG5KtXqQAot/DNwBr91gzPiXzLhH4VriglZkmyYnQoatUq7qg+X
95dlGcDiA9MZBs8/Y9hffUQpT6A59RBR1Js/wIuKxgVuvR6FHr5K6kT8ugj7u5n6
4gsvpL16rpAqUtaDrbrYS/E1wde0X4X++mwdMe+Qnjh4ZmVINPcF845QMmPUKKzN
ub2q/aibzI3c7UxHVW6yPO4kY14dWHQIJkIB4r6nPNkUlkHEsCageMYqUA+iK8d8
/c0xbUjEk6Lq9mWjduHCTdXxgSJcZRl5+v64qAAkGXn2Iry1t0LxLUvQagyG/YYl
laYogHq57jS7gl5bWnPNRFiWo5/zS5n7t6F+T2s98Oly9guNTOZXqe3bzHkJDBO3
Wcv6GNZ+awN0XVLHgBIzky5LCDHbCQrjr/JZvD55HNt9gCmsJzgg0C4iXda86hUd
+yLPQ7tzPIXaruco5GdBh24k6pHuvXfUoeIitRHdb/a1lUqY+9Prcrn0/uC9O6H9
i6RZ7Oki4mE4LBOWP4C/2CxR87tqNmMv2/NKvlMhBVM7IdIxtinXHmwZZGS2aywo
/9xo9gM88fT2SmjREZu3
=Zv9/
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from kqueue.org_0b37f494_20250124_150631.html ===

[kqueue.org](/)

[About](/about/)

# Memory allocator security revisited

Mar 5, 2012
•
Xi Wang

C/C++ 101:

* What does `malloc(n)` return if `n` is a big number (e.g., `-1` or `SIZE_MAX`)?
* What does `calloc(n, size)` return if `n` and `size` are big numbers?
* What does `new T[n]` return if `n` is a big number (assuming `-fno-exception`)?

I believe everyone expects the answer `NULL` for all the questions,
as `NULL` is used to indicate out of memory.
Unfortunately, in reality many memory allocators break (or used to
break) these expectations, which could lead to memory corruption and
security vulnerabilities, especially if the allocation size
can be controlled by an adversary.

Here goes a summary of some known and unknown vulnerabilities
(notably multiplication, rounding, and pointer overflows)
in popular memory allocators.

## GLIBC malloc

An infamous multiplication overflow used to exist in the `calloc`
implementation in GNU libc and Microsoft’s C runtime, as detailed
in
[RUS-CERT Advisory 2002-08:02](https://seclists.org/bugtraq/2002/Aug/91).
This overflow vulnerability can be easily misused to mount buffer
overflow attacks. It was
[fixed](http://sourceware.org/git/?p=glibc.git;a=commit;h=0950889b810736fe7ad340a13a5ecf76672e1a84)
in GLIBC in 2002.

## Hoard

I cannot find the revision log of the [Hoard](http://www.hoard.org/)
allocator, so it’s hard to say what vulnerabilities it used to have.
Though it’s easy to exploit the current version (3.8) via a rounding
overflow. Below is the buggy code snippet in `tlab.h`.

```
// ThreadLocalAllocationBuffer::malloc(size_t sz)
sz = align (sz); // (sz + (sizeof(double) - 1)) & ~(sizeof(double) - 1);
// Get memory from the local heap,
// and deduct that amount from the local heap bytes counter.
if (sz <= LargestObject) {
  int c = getSizeClass (sz);
  void * ptr = _localHeap(c).get();
  if (ptr) {
    assert (_localHeapBytes >= sz);
    _localHeapBytes -= sz;
    assert (getSize(ptr) >= sz);
    return ptr;
  }
}

```

When `sz` is `(size_t)-1`, a big value, the `align` call overflows
and rounds `sz` up to 0. Thus, `malloc(-1)` is basically `malloc(0)`,
which could lead to a buffer overflow.

Hoard’s `calloc` implementation is also vulnerable to multiplication
overflow. With glibc Hoard is injected via `__malloc_hook`,
and its `calloc` won’t be used. However, the vulnerability can
be triggered on platforms that do not use glibc, such as Mac OS X.

## jemalloc

The [jemalloc](http://www.canonware.com/jemalloc/) allocator is
used by the libc of FreeBSD and NetBSD, as well as Mozilla Firefox.

It used to have the `calloc` multiplication overflow vulnerability.
The bug was
[fixed](http://svnweb.freebsd.org/base?view=revision&revision=161263) in 2006.

A rounding overflow bug was
[fixed](http://svnweb.freebsd.org/base?view=revision&revision=167872)
in 2007.

Another interesting signedness bug was
[fixed](http://svnweb.freebsd.org/base?diff_format=l&view=revision&revision=178645)
in 2008. Below is the simplified code snippet in `jemalloc.c`.

```
/* chunk_alloc_dss(size_t size) */
/* assert(size != 0);                    */
/* assert((size & chunksize_mask) == 0); */
intptr_t incr;
void *ret;

/* Get the current end of the DSS. */
dss_max = sbrk(0);

/*
 * Calculate how much padding is necessary to
 * chunk-align the end of the DSS.
 */
incr = (intptr_t)size - (intptr_t)CHUNK_ADDR2OFFSET(dss_max);
if (incr == (intptr_t)size)
    ret = dss_max;
else {
    ret = (void *)((intptr_t)dss_max + incr);
    incr += size;
}

sbrk(incr);
return (ret);

```

Note that `size` is unsigned and `incr` is signed.
When `size` is big enough, `incr` is misinterpreted as negative
and causes the `sbrk` system call to shrink the memory.

## Bionic malloc

Bionic, the Android libc, is derived from the BSD libc. When
`libc.debug.malloc` is set, allocation calls will be rerouted to
its own debugging library.

Again, the debugging library had `calloc` multiplication overflows
([CVE-2009-0607](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-0607)).

Also, its `malloc` implementation still has multiple rounding
overflows, at least in in `chk_malloc` and `leak_malloc`.

Hope that no production phone ships the debugging library.

## TCMalloc

Google’s [TCMalloc](http://goog-perftools.sourceforge.net/doc/tcmalloc.html)
repeated the `calloc` multiplication overflow bug and got it
[fixed](http://code.google.com/p/gperftools/source/detail?r=15&path=/trunk/src/tcmalloc.cc)
in 2005.

I didn’t spot any serious rounding issues in TCMalloc,
but just a slip in `ReportLargeAlloc`:
the error message says “tcmalloc: large alloc *0* bytes == (nil)”
given `malloc(-1)`, because the size to be output overflows.

## APR pool

[APR pool](http://apr.apache.org/docs/apr/group__apr__pools.html) is
developed for the Apache web server. It is also adopted by other
projects such as Subversion. The interface is similar to
allocate-and-free allocators, but takes one extra parameter specifying
which pool to allocate from.

APR pool had a series of interesting pointer arithmetic fixes,
listed as follows.

In Aug 2002, the sanity check `p + size < q` was
[changed](http://svn.apache.org/viewvc?view=revision&revision=63806)
to `size < q - p`, where
the two pointers `p` (i.e., `node->first_evail`) and `q` (i.e.,
`node->endp`) point to the start and the end of a memory block,
respectively.

```
-    endp = node->first_avail + size;
-    if (endp < node->endp) {
+    if (size < node->endp - node->first_avail) {

```

Over a month later (Sep 2002), the check was
[reverted](http://svn.apache.org/viewvc?view=revision&revision=63887)
to `p + size < q`.

```
-    if (size < node->endp - node->first_avail) {
+    if (node->first_avail + size < node->endp) {

```

One week later (Oct 2002), the check was again
[changed](http://svn.apache.org/viewvc?view=revision&revision=63894)
to `size < q - p`.

```
-    if (node->first_avail + size < node->endp) {
+    if (size < (apr_size_t)(node->endp - node->first_avail)) {

```

After over five years (Apr 2008), the check was
[revised](http://svn.apache.org/viewvc?view=revision&revision=645436)
to `size <= q - p` with an off-by-one fix.

```
+/* Returns the amount of free space in the given node. */
+#define node_free_space(node_) ((apr_size_t)(node_->endp - node_->first_avail))
...
-    if (size < (apr_size_t)(node->endp - node->first_avail)) {
+    if (size <= node_free_space(node)) {

```

Here `p + size < q` is more dangerous than `size < q - p`. One obvious
reason is that `p + size` could wrap around to a small pointer given
a big `size`, while the latter check doesn’t have the pointer
overflow issue.

But how about adding a wrap check `p + size < p`? A subtle
problem is that pointer overflow (or more precisely, out-of-bounds
pointer) is undefined in C, which means that the compiler can do
anything to the wrap check `p + size < p`, such as optimizing it
away ([VU#162289](http://www.kb.cert.org/vuls/id/162289)).
I tried to compile the wrap check using GCC 4.6 and Clang 3.0 on x86:
it’s optimized as extracting the sign of `size`, without even looking
at the value of `p`.

```
movl	8(%esp), %eax
shrl	$31, %eax
ret

```

The size rounding vulnerability was also discovered and fixed in APR pool
([CVE-2009-2412](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2412))
in 2009.

## boost::pool

[Boost Pool](http://www.boost.org/libs/pool/) has the multiplication overflow
issue in its `ordered_malloc` implementation.

```
template <typename UserAllocator>
void * pool<UserAllocator>::ordered_malloc(const size_type n)
{
  const size_type partition_size = alloc_size();
  const size_type total_req_size = n * requested_size;
  const size_type num_chunks = total_req_size / partition_size +
      ((total_req_size % partition_size) ? true : false);

  void * ret = store().malloc_n(num_chunks, partition_size);
  ...
]

```

We can see that `total_req_size` may wrap around to a small number
given a big `n`.

## Boehm GC

[Boehm GC](http://www.hpl.hp.com/personal/Hans_Boehm/gc/) is probably
the most popular open-source garbage collector. It provides C
allocation calls and overloads the C++ `new` operator.

Boehm GC’s `calloc` implementation, in both `malloc.c` and its
[documentation](http://www.hpl.hp.com/personal/Hans_Boehm/gc/leak.html),
simply redirects `calloc(n, size)` to `GC_MALLOC((n) * (size))`,
thus is vulnerable to multiplication overflow.

It also has the size rounding vulnerability, so `GC_MALLOC(-1)`
doesn’t return a null pointer either.

## Safe by Design

Some allocators are designed to be used in “safe”
environment. For example, LLVM’s `BumpPtrAllocator`
doesn’t consider out-of-memory or overflow issues.

[kLIBC](http://git.kernel.org/?p=libs/klibc/klibc.git;a=blob;f=usr/klibc/calloc.c;hb=HEAD) is another example.

```
/* FIXME: This should look for multiplication overflow */

void *calloc(size_t nmemb, size_t size)
{
	void *ptr;

	size *= nmemb;
	ptr = malloc(size);
	if (ptr)
		memset(ptr, 0, size);

	return ptr;
}

```
## Compiler

The C++ array allocation `new T[n]` has a potential integer overflow
vulnerability if `n` is not limited correctly, which could lead to
a buffer overflow. This is similar to `calloc(n, sizeof(T))`.

The code generated by GCC simply calculates the
allocation size as `n * sizeof(T)` without any overflow checks,
though GCC developers have been
[discussing the problem](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=19351)
for a long time.

Clang
[generates “safe” code](http://blog.llvm.org/2011/05/what-every-c-programmer-should-know_21.html)
that defends against integer overflow attacks, via setting the
allocation size to -1 if any multiplication overflow happens. This
implies an assumption that the underlying allocator must return a
null pointer given a large size. As we have seen, this assumption
doesn’t hold well in practice.

[Subscribe](/feed.xml)



=== Content from www.openwall.com_ac36f5f6_20250124_150631.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2012/06/04/6) [[next>]](2) [[thread-next>]](../../../2012/06/07/9) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <36617FD3-6265-4329-9138-6203268449D1@gmail.com>
Date: Tue, 5 Jun 2012 01:54:17 -0400
From: Xi Wang <xi.wang@...il.com>
To: oss-security@...ts.openwall.com
Subject: memory allocator upstream patches

Hi,

I would like to share some upstream patches of two specific types
of memory allocator vulnerabilities.

* malloc(n) size overflow.

Consider the following code pattern.

	n = read_from_input();
	p = malloc(n);
	if (p)
		memcpy(p, input_buffer, n);

Some malloc() implementations internally perform alignment/padding
for a large n, and the allocation size wraps around to a small
integer.  That means they would allocate a smaller buffer than
expected, leading to buffer overflow.

* calloc(n, size) size overflow.

Some calloc() implementations don't check for n * size multiplication
overflow, and would allocate a smaller buffer than expected,
leading to buffer overflow.

The two types of vulnerabilities can be easily reproduced using
malloc(-1) and calloc(BIG-VALUE, BIG-VALUE).  If the return values
are non-null, the implementations are likely to be problematic.

See a more complete list at:

<http://kqueue.org/blog/2012/03/05/memory-allocator-security-revisited/>

Below are some recent upstream fixes.

Boehm-Demers-Weiser GC (libgc)
==============================

malloc() size overflow, upstream patch (revised by the developers):

<https://github.com/ivmai/bdwgc/commit/be9df82919960214ee4b9d3313523bff44fd99e1>

The bug in mallocx.c was found by Ivan Maidanski.

calloc() size overflow, upstream patch (revised by the developers):

<https://github.com/ivmai/bdwgc/commit/e10c1eb9908c2774c16b3148b30d2f3823d66a9a>
<https://github.com/ivmai/bdwgc/commit/6a93f8e5bcad22137f41b6c60a1c7384baaec2b3>
<https://github.com/ivmai/bdwgc/commit/83231d0ab5ed60015797c3d1ad9056295ac3b2bb>

bionic (Android libc)
=====================

malloc() size overflow, upstream patch (revised by the developers):

<https://github.com/android/platform_bionic/commit/7f5aa4f35e23fd37425b3a5041737cdf58f87385>

NB: this vulnerability could only be triggered in debug mode, the
same as CVE-2009-0607, calloc() size overflow.

nedmalloc
=========

malloc() size overflow, upstream patch:

<https://github.com/ned14/nedmalloc/commit/1a759756639ab7543b650a10c2d77a0ffc7a2000>

calloc() size overflow, upstream patch:

<https://github.com/ned14/nedmalloc/commit/2965eca30c408c13473c4146a9d47d547d288db1>

Hoard
=====

<http://www.hoard.org/>

malloc() size overflow, confirmed by the developers via email in
this March, no upstream patch available (since 3.8).

calloc() size overflow, which should only happen on non-glibc
platforms (e.g., Mac OS X).  It has not been confirmed by the
developers, but one can easily reproduce it.

boost::pool
===========

ordered_malloc() (similar to calloc()) size overflow, upstream patch:

<https://svn.boost.org/trac/boost/changeset/78326>

- xi
```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


