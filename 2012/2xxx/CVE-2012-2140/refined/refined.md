```
Message-ID: <20120425210610.GR3020@redhat.com>
Date: Wed, 25 Apr 2012 15:06:10 -0600
From: Vincent Danen <vdanen@...hat.com>
To: oss-security@...ts.openwall.com
Cc: mikel@...nteractive.net
Subject: CVE request: two flaws fixed in rubygem-mail 2.4.4

Two flaws were corrected in rubygem-mail version 2.4.4:

A file system traversal in file_delivery method [1].

Arbitrary command execution when using exim or sendmail from the commandline [2],[3].

[1] <https://github.com/mikel/mail/commit/29aca25218e4c82991400eb9b0c933626aefc98f>
[2] <https://github.com/mikel/mail/commit/36b7fa23d38cb59dd79b7efa258ef0e7ddab5a11>
[3] <https://github.com/mikel/mail/commit/ac56f03bdfc30b379aeecd4ff317d08fdaa328c2>

Other references:

<https://bugzilla.novell.com/show_bug.cgi?id=759092>
<https://bugzilla.redhat.com/show_bug.cgi?id=816352>

Could two CVEs be assigned for these flaws please?

--
Vincent Danen / Red Hat Security Response Team
```
```
Message-ID: <4F98C5C9.3060200@redhat.com>
Date: Wed, 25 Apr 2012 21:49:29 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
CC: Vincent Danen <vdanen@...hat.com>, mikel@...nteractive.net
Subject: Re: CVE request: two flaws fixed in rubygem-mail 2.4.4

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 04/25/2012 03:06 PM, Vincent Danen wrote:
>
> Two flaws were corrected in rubygem-mail version 2.4.4:
>
> A file system traversal in file_delivery method [1]. [1]
> <https://github.com/mikel/mail/commit/29aca25218e4c82991400eb9b0c933626aefc98f>

Please
>
use CVE-2012-2139 for this issue.

> Arbitrary command execution when using exim or sendmail from the
> commandline [2],[3]. [2]
> <https://github.com/mikel/mail/commit/36b7fa23d38cb59dd79b7efa258ef0e7ddab5a11>
>
>  [3]
> <https://github.com/mikel/mail/commit/ac56f03bdfc30b379aeecd4ff317d08fdaa328c2>

Please
>
use CVE-2012-2140 for this issue.

> Other references:
>
> <https://bugzilla.novell.com/show_bug.cgi?id=759092>
> <https://bugzilla.redhat.com/show_bug.cgi?id=816352>
>
> Could two CVEs be assigned for these flaws please?

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iQIcBAEBAgAGBQJPmMXJAAoJEBYNRVNeJnmTL5YQALbtZ9HL5chg/IUsD8S6q2ce
6x6gCd3ArghuKBfOQd2X6nATcdJ6NFmoyt35ebSpbKILXg8XHlWopDqf8Y7nmrFV
kD8E7FQ5w36aRdis8Enl/mYDPRsXg8NOTfUOQxjQq6IlS3zFWnClh6/eGV/UrKrZ
LYXX2dGP698yAtyvITvBR1T2jaCUqlndQgU24mW+3PmhkhhZU8MxVskMwU90VqVp
Vy80b8lXqnMj4eUHHqgISJQGPReb+7tNCo5yUeegg7Fv/Oe5XPIckOJB+68bVoeT
0fHBLfDH3NDF1jQZJO2zshKD0obTrBko9SmNzz5jX6m8WsIpUKzuT65Y+P3l7c1O
o60wfi7iCeC2hu870wJ13qUlwE+vUWuImTr16kOJu9fSODtg/1aPKnTham+0yqk9
UFgkFrI/SkLcJY0I7JsuFaP73poPOI4j1cwiuhFzIF2phbdgZeuemfy8kF88WiaP
qiFh4A7jtNf6wxxW7gEGyiafu2JRX8TjuhTGW7juZZP/1jwiFv8FkEAeRPpNo5jn
lGkt5oWbMfdOh6RJMwvahkCskd2J1Recp1pDywVTGpgbkgjipUuZqD597iQjRBRU
gEXrmzz9eqbtP/chDx+2ZY+5L6j4C24HIFeYyhUWiv4sSf5jGPDwfVlH/vsqnZD6
IYqIpcNHML0er2MPWdNv
=0z+y
-----END PGP SIGNATURE-----
```
```
  [Permalink](/mikel/mail/commit/ac56f03bdfc30b379aeecd4ff317d08fdaa328c2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix security vulnerability allowing command line exploit when using e…

[Browse files](/mikel/mail/tree/ac56f03bdfc30b379aeecd4ff317d08fdaa328c2)
Browse the repository at this point in the history

```
…xim or sendmail from the command line
```
```
  [Permalink](/mikel/mail/commit/39b590ddb08f90ddbe445837359a2c8843e533d0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Making sure that destinations are also properly escaped in all versio…
```
```
[Permalink](/mikel/mail/commit/36b7fa23d38cb59dd79b7efa258ef0e7ddab5a11)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix security vulnerability allowing command line exploit when using f…
```
```
## Version 2.4.3 - Tue Mar 6 19:38:00 UTC 2012 Mikel Lindsaar <mikel@reinteractive.net>
* Fix security vulnerability allowing command line exploit when using exim or sendmail from the command line
```
```
## Version 2.4.4 - Wed Mar 14 22:44:00 +1100 2012 Mikel Lindsaar <mikel@reinteractive.net>
* Fix security vulnerability allowing command line exploit when using file delivery method
```
```
[**Bug 816352**](show_bug.cgi?id=816352)
(CVE-2012-2140)
- [CVE-2012-2140](https://access.redhat.com/security/cve/CVE-2012-2140) rubygem-mail: arbitrary command execution when using exim or sendmail from commandline
```
Based on the provided information, here's an analysis of the vulnerability associated with CVE-2012-2140:

**Root Cause of Vulnerability:**
The vulnerability stems from insufficient sanitization of user-supplied input when the `rubygem-mail` library uses the `exim` or `sendmail` delivery methods. Specifically, the library constructs command-line arguments by concatenating user-provided email addresses and other parameters, which are then passed to the shell for execution. Without proper escaping, a malicious user could inject shell commands within these email addresses, leading to arbitrary command execution on the server.

**Weaknesses/Vulnerabilities Present:**
- **Command Injection:** The core weakness is the failure to properly sanitize user-controlled data before using it in shell commands.
- **Insecure Use of `IO.popen`:** The `IO.popen` method is used to execute a shell command, which directly interprets shell metacharacters.
- **Lack of Input Validation:** The `rubygem-mail` library doesn't validate email addresses before incorporating them into the shell command.

**Impact of Exploitation:**
- **Arbitrary Command Execution:** Successful exploitation allows an attacker to execute arbitrary shell commands on the server running the vulnerable application. This can lead to a complete compromise of the server, including data theft, data manipulation, denial of service, and installation of malware.

**Attack Vectors:**
- **Email Address Injection:** An attacker can inject malicious code within email addresses (e.g., the `from`, `to`, `sender` or `return-path` fields of an email) sent via the `exim` or `sendmail` delivery methods.
- **Specifically crafted emails:** By crafting a malicious email with a shell payload embedded in the address field, an attacker can trigger the vulnerability.

**Required Attacker Capabilities/Position:**
- **Ability to Send Emails:** The attacker must be able to send emails via an application using the vulnerable `rubygem-mail` library, with either the `exim` or `sendmail` delivery method enabled.
- **No Special Access Needed:** No prior access to the system or specific privileges are required to exploit this vulnerability, just the ability to send emails, if the system is exposed.