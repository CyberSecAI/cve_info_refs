=== Content from github.com_20a051f5_20250124_171215.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fcommit%2F2e3a64d07daac4c757cc57620f2288e865a09b90)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fcommit%2F2e3a64d07daac4c757cc57620f2288e865a09b90)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=rtomayko%2Frack-cache)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rtomayko](/rtomayko)
/
**[rack-cache](/rtomayko/rack-cache)**
Public

* [Notifications](/login?return_to=%2Frtomayko%2Frack-cache) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Frtomayko%2Frack-cache)
* [Star
   822](/login?return_to=%2Frtomayko%2Frack-cache)

* [Code](/rtomayko/rack-cache)
* [Issues
  34](/rtomayko/rack-cache/issues)
* [Pull requests
  1](/rtomayko/rack-cache/pulls)
* [Actions](/rtomayko/rack-cache/actions)
* [Projects
  0](/rtomayko/rack-cache/projects)
* [Security](/rtomayko/rack-cache/security)
* [Insights](/rtomayko/rack-cache/pulse)

Additional navigation options

* [Code](/rtomayko/rack-cache)
* [Issues](/rtomayko/rack-cache/issues)
* [Pull requests](/rtomayko/rack-cache/pulls)
* [Actions](/rtomayko/rack-cache/actions)
* [Projects](/rtomayko/rack-cache/projects)
* [Security](/rtomayko/rack-cache/security)
* [Insights](/rtomayko/rack-cache/pulse)

## Commit

[Permalink](/rtomayko/rack-cache/commit/2e3a64d07daac4c757cc57620f2288e865a09b90)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#52](https://github.com/rtomayko/rack-cache/pull/52) from rmm5t/strip\_set\_cookie

[Browse files](/rtomayko/rack-cache/tree/2e3a64d07daac4c757cc57620f2288e865a09b90)
Browse the repository at this point in the history

```
Rack::Cache caches Set-Cookie response headers yielding potential security holes in apps
```

* Loading branch information

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=40&v=4)](/rtomayko)

[rtomayko](/rtomayko/rack-cache/commits?author=rtomayko "View all commits by rtomayko")
committed
Feb 15, 2012

2 parents
[8ecd5b4](/rtomayko/rack-cache/commit/8ecd5b4a02af3c19568c9089830de83ede8051f8)
+
[6379364](/rtomayko/rack-cache/commit/6379364deb62fade14c1268806d3ccae5811947a)

commit 2e3a64d

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**51 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/rack/cache

  + lib/rack/cache/context.rb
    [context.rb](#diff-c1962e1d0bd541be539d865ecbc82e0a68e637d52e3decb46050bcaac51106a0)
  + lib/rack/cache/options.rb
    [options.rb](#diff-f56df6d7b08515af97a4799d9a65ebf7c4e3a1d347b558b3c6380c9d1e3fb9b2)
* test

  + test/context\_test.rb
    [context\_test.rb](#diff-a26afe2d084fec4de164c385d3edb6c60157de0c69f4bc9b6c9c54634a968f3b)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[lib/rack/cache/context.rb](#diff-c1962e1d0bd541be539d865ecbc82e0a68e637d52e3decb46050bcaac51106a0 "lib/rack/cache/context.rb")

Show comments

[View file](/rtomayko/rack-cache/blob/2e3a64d07daac4c757cc57620f2288e865a09b90/lib/rack/cache/context.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -260,6 +260,7 @@ def fetch |
|  |  |  |
|  |  | # Write the response to the cache. |
|  |  | def store(response) |
|  |  | strip\_ignore\_headers(response) |
|  |  | metastore.store(@request, response, entitystore) |
|  |  | response.headers['Age'] = response.age.to\_s |
|  |  | rescue Exception => e |
| Expand All | | @@ -269,6 +270,12 @@ def store(response) |
|  |  | record :store |
|  |  | end |
|  |  |  |
|  |  | # Remove all ignored response headers before writing to the cache. |
|  |  | def strip\_ignore\_headers(response) |
|  |  | stripped\_values = ignore\_headers.map { |name| response.headers.delete(name) } |
|  |  | record :ignore if stripped\_values.any? |
|  |  | end |
|  |  |  |
|  |  | def log\_error(exception) |
|  |  | @env['rack.errors'].write("cache error: #{exception.message}\n#{exception.backtrace.join("\n")}\n") |
|  |  | end |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[lib/rack/cache/options.rb](#diff-f56df6d7b08515af97a4799d9a65ebf7c4e3a1d347b558b3c6380c9d1e3fb9b2 "lib/rack/cache/options.rb")

Show comments

[View file](/rtomayko/rack-cache/blob/2e3a64d07daac4c757cc57620f2288e865a09b90/lib/rack/cache/options.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -78,6 +78,14 @@ def option\_name(key) |
|  |  | # Default: 0 |
|  |  | option\_accessor :default\_ttl |
|  |  |  |
|  |  | # Set of response headers that are removed before storing them in the |
|  |  | # cache. These headers are only removed for cacheable responses. For |
|  |  | # example, in most cases, it makes sense to prevent cookies from being |
|  |  | # stored in the cache. |
|  |  | # |
|  |  | # Default: ['Set-Cookie'] |
|  |  | option\_accessor :ignore\_headers |
|  |  |  |
|  |  | # Set of request headers that trigger "private" cache-control behavior |
|  |  | # on responses that don't explicitly state whether the response is |
|  |  | # public or private via a Cache-Control directive. Applications that use |
| Expand Down  Expand Up | | @@ -138,6 +146,7 @@ def initialize\_options(options={}) |
|  |  | 'rack-cache.metastore' => 'heap:/', |
|  |  | 'rack-cache.entitystore' => 'heap:/', |
|  |  | 'rack-cache.default\_ttl' => 0, |
|  |  | 'rack-cache.ignore\_headers' => ['Set-Cookie'], |
|  |  | 'rack-cache.private\_headers' => ['Authorization', 'Cookie'], |
|  |  | 'rack-cache.allow\_reload' => false, |
|  |  | 'rack-cache.allow\_revalidate' => false, |
| Expand Down | |  |

35 changes: 35 additions & 0 deletions

35
[test/context\_test.rb](#diff-a26afe2d084fec4de164c385d3edb6c60157de0c69f4bc9b6c9c54634a968f3b "test/context_test.rb")

Show comments

[View file](/rtomayko/rack-cache/blob/2e3a64d07daac4c757cc57620f2288e865a09b90/test/context_test.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,6 +57,7 @@ |
|  |  | response.should.be.ok |
|  |  | cache.trace.should.include :miss |
|  |  | cache.trace.should.include :store |
|  |  | cache.trace.should.not.include :ignore |
|  |  | response.headers.should.include 'Age' |
|  |  | response.headers['Cache-Control'].should.equal 'public' |
|  |  | end |
| Expand Down  Expand Up | | @@ -85,6 +86,40 @@ |
|  |  | response.headers['Cache-Control'].should.equal 'private' |
|  |  | end |
|  |  |  |
|  |  | it 'does remove Set-Cookie response header from a cacheable response' do |
|  |  | respond\_with 200, 'Cache-Control' => 'public', 'ETag' => '"FOO"', 'Set-Cookie' => 'TestCookie=OK' |
|  |  | get '/' |
|  |  |  |
|  |  | app.should.be.called |
|  |  | response.should.be.ok |
|  |  | cache.trace.should.include :store |
|  |  | cache.trace.should.include :ignore |
|  |  | response.headers['Set-Cookie'].should.be.nil |
|  |  | end |
|  |  |  |
|  |  | it 'does remove all configured ignore\_headers from a cacheable response' do |
|  |  | respond\_with 200, 'Cache-Control' => 'public', 'ETag' => '"FOO"', 'SET-COOKIE' => 'TestCookie=OK', 'X-Strip-Me' => 'Secret' |
|  |  | get '/', 'rack-cache.ignore\_headers' => ['set-cookie', 'x-strip-me'] |
|  |  |  |
|  |  | app.should.be.called |
|  |  | response.should.be.ok |
|  |  | cache.trace.should.include :store |
|  |  | cache.trace.should.include :ignore |
|  |  | response.headers['Set-Cookie'].should.be.nil |
|  |  | response.headers['x-strip-me'].should.be.nil |
|  |  | end |
|  |  |  |
|  |  | it 'does not remove Set-Cookie response header from a private response' do |
|  |  | respond\_with 200, 'Cache-Control' => 'private', 'Set-Cookie' => 'TestCookie=OK' |
|  |  | get '/' |
|  |  |  |
|  |  | app.should.be.called |
|  |  | response.should.be.ok |
|  |  | cache.trace.should.not.include :store |
|  |  | cache.trace.should.not.include :ignore |
|  |  | response.headers['Set-Cookie'].should.equal 'TestCookie=OK' |
|  |  | end |
|  |  |  |
|  |  | it 'responds with 304 when If-Modified-Since matches Last-Modified' do |
|  |  | timestamp = Time.now.httpdate |
|  |  | respond\_with do |req,res| |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2e3a64d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fcommit%2F2e3a64d07daac4c757cc57620f2288e865a09b90) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugzilla.novell.com_0de992fa_20250124_171211.html ===




=== Content from access.redhat.com_179eca79_20250126_022951.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from github.com_1cb70928_20250124_171214.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fblob%2Fmaster%2FCHANGES)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fblob%2Fmaster%2FCHANGES)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=rtomayko%2Frack-cache)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rtomayko](/rtomayko)
/
**[rack-cache](/rtomayko/rack-cache)**
Public

* [Notifications](/login?return_to=%2Frtomayko%2Frack-cache) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Frtomayko%2Frack-cache)
* [Star
   822](/login?return_to=%2Frtomayko%2Frack-cache)

* [Code](/rtomayko/rack-cache)
* [Issues
  34](/rtomayko/rack-cache/issues)
* [Pull requests
  1](/rtomayko/rack-cache/pulls)
* [Actions](/rtomayko/rack-cache/actions)
* [Projects
  0](/rtomayko/rack-cache/projects)
* [Security](/rtomayko/rack-cache/security)
* [Insights](/rtomayko/rack-cache/pulse)

Additional navigation options

* [Code](/rtomayko/rack-cache)
* [Issues](/rtomayko/rack-cache/issues)
* [Pull requests](/rtomayko/rack-cache/pulls)
* [Actions](/rtomayko/rack-cache/actions)
* [Projects](/rtomayko/rack-cache/projects)
* [Security](/rtomayko/rack-cache/security)
* [Insights](/rtomayko/rack-cache/pulse)

## Files

 master
## Breadcrumbs

1. [rack-cache](/rtomayko/rack-cache/tree/master)
/
# CHANGES

Copy path Blame  Blame
## Latest commit

## History

[History](/rtomayko/rack-cache/commits/master/CHANGES)322 lines (222 loc) · 11.8 KB master
## Breadcrumbs

1. [rack-cache](/rtomayko/rack-cache/tree/master)
/
# CHANGES

Top
## File metadata and controls

* Code
* Blame

322 lines (222 loc) · 11.8 KB[Raw](https://github.com/rtomayko/rack-cache/raw/refs/heads/master/CHANGES)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322## 1.13.0
 \* Support lowercase Vary and Age headers
## 1.12.0
 \* Add a fault\_tolerant flag to fail-over to stale cache
## 1.11.1
 \* when ignoring parts of the query, remove query in key when all params are ignored
## 1.11.0
 \* Add a proc to allow ignoring parts of the query string in the key
## 1.10.0
 \* Pass Options To Underlying Storage Driver \* bump required ruby version to 2.3
## 1.9.0
 \* make purge not raise when not implemented
## 1.8.0
 \* Meta stores will purge keys when no entity store entries are found
## 1.7.2
 \* Fix key generation for requests with no query strings
## 1.7.0
 \* Meta stores now receive a third ttl argument to write when use\_native\_ttl is used.
## 1.6.1
 \* Revert 'No longer read responses from cache when we already have them'
## 1.6.0
 \* Noop backend \* No longer read responses from cache when we already have them \* renamed files from entitystore -> entity\_store (metastore/cachecontrol/appengine) and added warns for old ones
## 1.5.1
 \* fix key generation for query strings that include encoded equals
## 1.5.0
 \* only catch StandardError and not Exception
## 1.4.3
 \* After overriding the REQUEST\_METHOD, store the original request method in "rack.methodoverride.original\_method"
## 1.4.1
 \* Ignore invalid Expires date as per RFC
## 1.4.0
 \* Not invalidating the cache for preflight CORS request
## 1.3.1 / October 2015
 \* Support Ruby 1.9
## 1.3 / Octorber 2015
 \* Ruby 2.0 only
 \* Gracefully degrade when cache store goes offline
 \* allow\_reload/revalidate is not enabled by default
 \* Make Rack::Cache multithread friendly
## 1.2 / March 2012
 \* Fix a cookie leak vulnerability effecting large numbers of Rails 3.x installs: https://github.com/rtomayko/rack-cache/pull/52
 \* Never 304 on PUT or POST requests.
 \* Misc bundler and test tooling fixes.
## 1.1 / September 2011
 \* Allow (INM/IMS) validation requests through to backend on miss. Makes it possible to use validation for private / uncacheable responses. A number of people using Rails's stale?() helper reported that their validation logic was never kicking in.
 \* Add rack env rack-cache.force-pass option to bypass rack-cache on per request basis
 \* Fix an issue with memcache namespace not being set when using the :namespace option instead of :prefix\_key.
 \* Fix test failures due to MockResponse changes in recent Rack version (issue #34)
## 1.0.3 / August 2011
 \* Fix bug passing options to memcached and dalli
 \* Document cache\_key
## 1.0.1 / April 2011
 \* Added lib/rack-cache.rb to match package name for auto-requiring machinery.
 \* Fixed a number of issues caused by Rack::Cache not closing the body received from the application. Rack::Lock and other middleware use body.close to signal the true end of request processing so failure to call this method can result in strange issues (e.g., "ThreadError: deadlock; recursive locking")
 \* Fixed a bug where Rack::Cache would blow up writing the rack env to the meta store when the env contained an all uppercase key whose value wasn't marshalable. Passenger and some other stuff write such keys apparently.
 \* The test suite has moved from test-spec to bacon. This is a short term solution to the problem of not being able to run tests under Ruby 1.9.x. The test suite will be moved to basic Test::Unit style sometime in the future.
## 1.0 / December 2010
 \* Rack::Cache is 1.0 and will now maintain semantic versioning <http://semver.org/>
 \* Add Dalli memcache client support and removed support for the unmaintained memcache-client library. You will need to move your apps to Dalli before upgrading rack-cache to 1.0.
## 0.5.3 / September 2010
 \* A matching If-Modified-Since is ignored if an If-None-Match is also provided and doesn't match. This is in line with RFC 2616.
 \* Converts string status codes to integers before returns to workaround bad behaving rack middleware and apps.
 \* Misc doc clean up.
## 0.5.2 / September 2009
 \* Exceptions raised from the metastore are not fatal. This makes a lot of sense in most cases because its okay for the cache to be down - it shouldn't blow up your app.
## 0.5.1 / June 2009
 \* Added support for memcached clusters and other advanced configuration provided by the memcache-client and memcached libraries. The "metastore" and "entitystore" options can now be set to a MemCache object or Memcached object:
 memcache = MemCache.new(['127.1.1.1', '127.1.1.2'], :namespace => "/foo") use Rack::Cache, :metastore => memcache, :entitystore => memcache
 \* Fix "memcached://" metastore URL handling. The "memcached" variation blew up, the "memcache" version was fine.
## 0.5.0 / May 2009
 \* Added meta and entity store implementations based on the memcache-client library. These are the default unless the memcached library has already been required.
 \* The "allow\_reload" and "allow\_revalidate" options now default to false instead of true. This means we break with RFC 2616 out of the box but this is the expected configuration in a huge majority of gateway cache scenarios. See the docs on configuration options for more information on these options: http://tomayko.com/src/rack-cache/configuration
 \* Added Google AppEngine memcache entity store and metastore implementations. To use GAE's memcache with rack-cache, set the "metastore" and "entitystore" options as follows:
 use Rack::Cache, :metastore => 'gae://cache-meta', :entitystore => 'gae://cache-body'
 The 'cache-meta' and 'cache-body' parts are memcache namespace prefixes and should be set to different values.
## 0.4.0 / March 2009
 \* Ruby 1.9.1 / Rack 1.0 compatible.
 \* Invalidate cache entries that match the request URL on non-GET/HEAD requests. i.e., POST, PUT, DELETE cause matching cache entries to be invalidated. The cache entry is validated with the backend using a conditional GET the next time it's requested.
 \* Implement "Cache-Control: max-age=N" request directive by forcing validation when the max-age provided exceeds the age of the cache entry. This can be disabled by setting the "allow\_revalidate" option to false.
 \* Properly implement "Cache-Control: no-cache" request directive by performing a full reload. RFC 2616 states that when "no-cache" is present in the request, the cache MUST NOT serve a stored response even after successful validation. This is slightly different from the "no-cache" directive in responses, which indicates that the cache must first validate its entry with the origin. Previously, we implemented "no-cache" on requests by passing so no new cache entry would be stored based on the response. Now we treat it as a forced miss and enter the response into the cache if it's cacheable. This can be disabled by setting the "allow\_reload" option to false.
 \* Assume identical semantics for the "Pragma: no-cache" request header as the "Cache-Control: no-cache" directive described above.
 \* Less crazy logging. When the verbose option is set, a single log entry is written with a comma separated list of trace events. For example, if the cache was stale but validated, the following log entry would be written: "cache: stale, valid, store". When the verbose option is false, no logging occurs.
 \* Added "X-Rack-Cache" response header with the same comma separated trace value as described above. This gives some visibility into how the cache processed the request.
 \* Add support for canonicalized cache keys, as well as custom cache key generators, which are specified in the options as :cache\_key as either any object that has a call() or as a block. Cache key generators get passed a request object and return a cache key string.
## 0.3.0 / December 2008
 \* Add support for public and private cache control directives. Responses marked as explicitly public are cached even when the request includes an Authorization or Cookie header. Responses marked as explicitly private are considered uncacheable.
 \* Added a "private\_headers" option that dictates which request headers trigger default "private" cache control processing. By default, the Cookie and Authorization headers are included. Headers may be added or removed as necessary to change the default private logic.
 \* Adhere to must-revalidate/proxy-revalidate cache control directives by not assigning the default\_ttl to responses that don't include freshness information. This should let us begin using default\_ttl more liberally since we can control it using the must-revalidate/proxy-revalidate directives.
 \* Use the s-maxage Cache-Control value in preference to max-age when present. The ttl= method now sets the s-maxage value instead of max-age. Code that used ttl= to control freshness at the client needs to change to set the max-age directive explicitly.
 \* Enable support for X-Sendfile middleware by responding to #to\_path on bodies served from disk storage. Adding the Rack::Sendfile component upstream from Rack::Cache will result in cached bodies being served directly by the web server (instead of being read in Ruby).
 \* BUG: MetaStore hits but EntityStore misses. This would 500 previously; now we detect it and act as if the MetaStore missed as well.
 \* Implement low level #purge method on all concrete entity store classes -- removes the entity body corresponding to the SHA1 key provided and returns nil.
 \* Basically sane handling of HEAD requests. A HEAD request is never passed through to the backend except when transitioning with pass!. This means that the cache responds to HEAD requests without invoking the backend at all when the cached entry is fresh. When no cache entry exists, or the cached entry is stale and can be validated, the backend is invoked with a GET request and the HEAD is handled right before the response is delivered upstream.
 \* BUG: The Age response header was not being set properly when a stale entry was validated. This would result in Age values that exceeded the freshness lifetime in responses.
 \* BUG: A cached entry in a heap meta store could be unintentionally modified by request processing since the cached objects were being returned directly. The result was typically missing/incorrect header values (e.g., missing Content-Type header). [dkubb]
 \* BUG: 304 responses should not include entity headers (especially Content-Length). This is causing Safari/WebKit weirdness on 304 responses.
 \* BUG: The If-None-Match header was being ignored, causing the cache to send 200 responses to matching conditional GET requests.
## 0.2.0 / 2008-10-24 / Initial Release
 \* Document events and transitions in `rack/cache/config/default.rb` \* Basic logging support (`trace`, `warn`, `info`, `error` from within Context) \* EntityStore: store entity bodies keyed by SHA \* MetaStore: store response headers keyed by URL \* Last-Modified/ETag validation \* Vary support \* Implement error! transition \* New Rack::Cache::Core \* memcached meta and entity store implementations \* URI based storage configuration \* Read options from Rack env if present (rack-cache.XXX keys) \* `object` is now `entry` \* Documentation framework and website \* Document storage areas and implementations \* Document configuration/events
## 0.1.0 / 2008-07-21 / Proof of concept (unreleased)
 \* Basic core with event support \* `#import` method for bringing in config files \* Freshness based expiration \* RFC 2616 If-Modified-Since based validation \* A horribly shitty storage back-end (Hash in mem) \* Don't cache hop-by-hop headers: Connection, Keep-Alive, Proxy-Authenticate, Proxy-Authorization, TE, Trailers, Transfer-Encoding, Upgrade

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugzilla.redhat.com_c640cd9d_20250126_022952.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D824520)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D824520)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D824520)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 824520

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 824520**](show_bug.cgi?id=824520)
(CVE-2012-2671)
- [CVE-2012-2671](https://access.redhat.com/security/cve/CVE-2012-2671) rubygem-rack-cache: caches sensitive headers (such as Set-Cookie)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-2671 rubygem-rack-cache: caches sensitive headers (such as Set-Cookie)

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED UPSTREAM | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-2671 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [824523](show_bug.cgi?id=824523 "CLOSED ERRATA - rubygem-rack-cache: caches sensitive headers (such as Set-Cookie) [fedora-17]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=824520&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=824520&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-05-23 16:27 UTC by Vincent Danen | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2019-09-29 12:53 UTC ([History](show_activity.cgi?id=824520)) | | [CC List:](page.cgi?id=fields.html#cclist) | 2 users (show)  jlieskov vondruch | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2019-06-10 10:58:37 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=824520#c0)  Vincent Danen    2012-05-23 16:27:44 UTC  ``` The Rack::Cache rubygem has a flaw where it will cache sensitive headers (such as Set-Cookie response headers), which could leak potentially sensitive information.  This has been corrected in upstream git [1].  [1] <https://github.com/rtomayko/rack-cache/commit/2e3a64d07daac4c757cc57620f2288e865a09b90>   ```  [Comment 1](show_bug.cgi?id=824520#c1)  Vincent Danen    2012-05-23 16:34:40 UTC  ``` Created rubygem-rack-cache tracking bugs for this issue  Affects: fedora-17 [[bug 824523](show_bug.cgi?id=824523 "CLOSED ERRATA - rubygem-rack-cache: caches sensitive headers (such as Set-Cookie) [fedora-17]")]   ```  [Comment 2](show_bug.cgi?id=824520#c2)  Fedora Update System    2012-06-05 23:02:31 UTC  ``` rubygem-rack-cache-1.2-1.fc17 has been pushed to the Fedora 17 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 3](show_bug.cgi?id=824520#c3)  Jan Lieskovsky    2012-06-06 09:26:45 UTC  ``` References: [2] <http://www.openwall.com/lists/oss-security/2012/06/06/4> [3] <https://bugzilla.novell.com/show_bug.cgi?id=763650>   ```  [Comment 4](show_bug.cgi?id=824520#c4)  Kurt Seifried    2012-06-06 16:57:43 UTC  ``` Added CVE as per <http://www.openwall.com/lists/oss-security/2012/06/06/8>   ```  [Comment 5](show_bug.cgi?id=824520#c5)  Product Security DevOps Team    2019-06-10 10:58:37 UTC  ``` This CVE Bugzilla entry is for community support informational purposes only as it does not affect a package in a commercially supported Red Hat product. Refer to the dependent bugs for status of those individual community products.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=824520&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from github.com_227f8f78_20250124_171218.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fpull%2F52)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fpull%2F52)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rtomayko%2Frack-cache)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rtomayko](/rtomayko)
/
**[rack-cache](/rtomayko/rack-cache)**
Public

* [Notifications](/login?return_to=%2Frtomayko%2Frack-cache) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Frtomayko%2Frack-cache)
* [Star
   822](/login?return_to=%2Frtomayko%2Frack-cache)

* [Code](/rtomayko/rack-cache)
* [Issues
  34](/rtomayko/rack-cache/issues)
* [Pull requests
  1](/rtomayko/rack-cache/pulls)
* [Actions](/rtomayko/rack-cache/actions)
* [Projects
  0](/rtomayko/rack-cache/projects)
* [Security](/rtomayko/rack-cache/security)
* [Insights](/rtomayko/rack-cache/pulse)

Additional navigation options

* [Code](/rtomayko/rack-cache)
* [Issues](/rtomayko/rack-cache/issues)
* [Pull requests](/rtomayko/rack-cache/pulls)
* [Actions](/rtomayko/rack-cache/actions)
* [Projects](/rtomayko/rack-cache/projects)
* [Security](/rtomayko/rack-cache/security)
* [Insights](/rtomayko/rack-cache/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frtomayko%2Frack-cache%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frtomayko%2Frack-cache%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Rack::Cache caches Set-Cookie response headers yielding potential security holes in apps #52

 Merged

[rtomayko](/rtomayko)
merged 7 commits into
[rtomayko:master](/rtomayko/rack-cache/tree/master "rtomayko/rack-cache:master")
from
[rmm5t:strip\_set\_cookie](/rmm5t/rack-cache/tree/strip_set_cookie "rmm5t/rack-cache:strip_set_cookie")

Feb 15, 2012

 Merged

# [Rack::Cache caches Set-Cookie response headers yielding potential security holes in apps](#top) #52

[rtomayko](/rtomayko)
merged 7 commits into
[rtomayko:master](/rtomayko/rack-cache/tree/master "rtomayko/rack-cache:master")
from
[rmm5t:strip\_set\_cookie](/rmm5t/rack-cache/tree/strip_set_cookie "rmm5t/rack-cache:strip_set_cookie")

Feb 15, 2012

[Conversation
44](/rtomayko/rack-cache/pull/52)
[Commits
7](/rtomayko/rack-cache/pull/52/commits)
[Checks
0](/rtomayko/rack-cache/pull/52/checks)
[Files changed](/rtomayko/rack-cache/pull/52/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![rmm5t](https://avatars.githubusercontent.com/u/740?s=60&v=4)](/rmm5t)

Copy link

Contributor

### @rmm5t **[rmm5t](/rmm5t)** commented [Feb 10, 2012](#issue-3069901)

Rack::Cache v0.3.0 (see [changelog](https://github.com/rtomayko/rack-cache/blob/master/CHANGES)) introduced the behavior such that it will cache "responses marked as explicitly public even when the request includes an Authorization or Cookie header."

We're having a difficult time understanding why a `Set-Cookie` header should ever be cached.

We have a Rails application that has a few `fresh_when` and `stale?` checks that also happen to have a Cookie header sent in the request because the cookie's domain matches. Specifically, this cookie is our Rails session\_store, and we started to experience hijacked sessions between users.

These resources that end up getting a public cache control as part of the response also have the Set-Cookie header set and Rack::Cache will cache the cookies because the response was set explicitly public.

We'd like to propose preventing Rack::Cache from ever caching a Set-Cookie header. [@rtomayko](https://github.com/rtomayko) [touched on this as a potential solution to a related problem](https://github.com/rails/rails/issues/476#issuecomment-1180999) that dealt with cached assets.

Sorry, something went wrong.

All reactions

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Feb 2, 2012](#issuecomment-3787592)

| Yeah, let's just special case `Set-Cookie` and be done with it. There's no case where it's useful to cache. |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Feb 2, 2012](#issuecomment-3788464)

| [@rtomayko](https://github.com/rtomayko) Great. Are you leaning towards stripping the `Set-Cookie` header before writing the response to the cache or towards not caching anything with a `Set-Cookie` header?  Personally, I think I lean towards stripping the `Set-Cookie` header, but for comparison, the default behavior of Varnish is to avoid caching any response with a `Set-Cookie` header (though Varnish is [configurable](https://www.varnish-cache.org/trac/wiki/VCLExampleCacheCookies) to strip the header before writing the response to the cache).  We just wrote a small piece of middleware today to strip the `Set-Cookie` header on cacheable resources, and it would be great to throw that away in favor of Rack::Cache working more securely out of the box. |
| --- |

All reactions

Sorry, something went wrong.

[![@mloughran](https://avatars.githubusercontent.com/u/214?s=80&v=4)](/mloughran)

Copy link

### **[mloughran](/mloughran)** commented [Feb 3, 2012](#issuecomment-3789734)

| +1 for stripping `Set-Cookie` – this has bitten me far too many times already.  I would say strip rather than replicating Varnish's behaviour (not caching) simply because Rails makes controlling the Set-Cookie header so very difficult. |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Feb 3, 2012](#issuecomment-3791732)

| Definitely going to strip it out, most likely before it's written to cache storage.  FWIW, Varnish isn't a very good thing to base behavior on because it doesn't even attempt to conform to RFC 2616's definition of a cache. It only handles caching on expiration and is very much optimized for serving static content. Not that it isn't absolutely wonderful for that, but rack-cache has always tried to follow RFC 2616 to the letter. Not caching responses that have an explicit "Cache-Control: public" definitely feels like it goes against the spec. That header basically translates to "please cache me all over the place".  I'd be much more interested in how squid, akamai, and other spec loving caches handle this. |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Feb 3, 2012](#issuecomment-3801214)

| [@rtomayko](https://github.com/rtomayko), I did some limited research -- hoping it helps for future onlookers.  **Squid:** "*The* [*proper way*](http://wiki.squid-cache.org/SquidFaq/InnerWorkings#How_does_Squid_deal_with_Cookies.3F) *to deal with Set-Cookie reply headers, according to RFC 2109 is to cache the whole object, EXCEPT the Set-Cookie header lines.*" In fairness, [RFC 2109](http://www.ietf.org/rfc/rfc2109.txt) muddies the water with a `Cache-control: no-cache="set-cookie"`, which seems like more hassle than the correct approach. I would have written that spec to always strip the Set-Cookie header unless the Cache-control had something to explicitly state that you want the cookie cached.  **Akamai:** I had trouble finding a definitive answer here about their default behavior, but it looks like stripping the Set-Cookie header is at least configurable.  **Nginx proxy\_cache:** Responses with a Set-Cookie header [are uncacheable](http://wiki.nginx.org/HttpProxyModule#proxy_cache) unless the header is configured as "ignored."  **Apache mod\_cache:** Seems to [default to caching Set-Cookie](http://httpd.apache.org/docs/2.1/mod/mod_cache.html#cacheignoreheaders) headers, but is configurable. The typical (and presumably recommended) configuration is to set it to ignore (i.e. strip) the Set-Cookie header.  In summary, stripping the Set-Cookie looks like the correct approach, and I think it's certainly the best default for a cache layer like Rack::Cache to take. |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Feb 4, 2012](#issuecomment-3808552)

| Thanks for running that down. It definitely looks like stripping before going into cache is the way to go.  I'm not sure how soon I'll be able to look at this. If someone wants to take a crack at a patch it'd be greatly appreciated. |
| --- |

All reactions

Sorry, something went wrong.

 [rmm5t](/rmm5t)
added 5 commits
[February 10, 2012 11:23](#commits-pushed-c01c0a9)

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Removed Gemfile.lock](/rtomayko/rack-cache/pull/52/commits/c01c0a99803fa43ee6b49e56a7d204c7d7ddb0ec "Removed Gemfile.lock

Gemfile.lock was correctly in the .gitignore file, but was also committed to the
repository.  See
http://yehudakatz.com/2010/12/16/clarifying-the-roles-of-the-gemspec-and-gemfile/

Furthermore, it was locked to a version of memcached that I could get to compile
on Lion.")`
 …

`[c01c0a9](/rtomayko/rack-cache/pull/52/commits/c01c0a99803fa43ee6b49e56a7d204c7d7ddb0ec)`

```
Gemfile.lock was correctly in the .gitignore file, but was also committed to the
repository.  See
<http://yehudakatz.com/2010/12/16/clarifying-the-roles-of-the-gemspec-and-gemfile/>

Furthermore, it was locked to a version of memcached that I could get to compile
on Lion.
```

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Added bundle exec to the bacon calls for test and spec tasks](/rtomayko/rack-cache/pull/52/commits/13a41c384eaa585227bee5126169f64b2d06d41d "Added `bundle exec` to the `bacon` calls for test and spec tasks")`

`[13a41c3](/rtomayko/rack-cache/pull/52/commits/13a41c384eaa585227bee5126169f64b2d06d41d)`

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Added ignore_headers configuration option](/rtomayko/rack-cache/pull/52/commits/566f5d5a938c161abbfb06457df29fc90c4cb668 "Added ignore_headers configuration option

Defaults to ['Set-Cookie'] thereby stripping cookies from cacheable responses")`
 …

`[566f5d5](/rtomayko/rack-cache/pull/52/commits/566f5d5a938c161abbfb06457df29fc90c4cb668)`

```
Defaults to ['Set-Cookie'] thereby stripping cookies from cacheable responses
```

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Removed all ignore_headers before writing to the cache](/rtomayko/rack-cache/pull/52/commits/d668c883e93c556a1ef02f019ebfcb78df3fe75e "Removed all ignore_headers before writing to the cache

By default, this will strip the Set-Cookie response header before storing a
cacheable response.")`
 …

`[d668c88](/rtomayko/rack-cache/pull/52/commits/d668c883e93c556a1ef02f019ebfcb78df3fe75e)`

```
By default, this will strip the Set-Cookie response header before storing a
cacheable response.
```

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Added 'ignore' to the trace if a response header was stripped](/rtomayko/rack-cache/pull/52/commits/0ed9a12e4563dcf4e82a4e2543e0df862b22fbe2 "Added 'ignore' to the trace if a response header was stripped")`

`[0ed9a12](/rtomayko/rack-cache/pull/52/commits/0ed9a12e4563dcf4e82a4e2543e0df862b22fbe2)`

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Feb 10, 2012](#issuecomment-3910961)

| [@rtomayko](https://github.com/rtomayko) Please have a look at this pull-request to strip the `Set-Cookie` header on cacheable responses. Note, it was built upon pull request [#53](https://github.com/rtomayko/rack-cache/pull/53) (which was necessary before I could get the test suite working in my environment). |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Feb 10, 2012](#issuecomment-3911179)

| I should also mention that I'm not entirely happy the the trace name "ignore" that I used in [0ed9a12](https://github.com/rtomayko/rack-cache/commit/0ed9a12e4563dcf4e82a4e2543e0df862b22fbe2). I was trying to stick to what seemed like a convention of using one-word trace names. I'm open to suggestions. |
| --- |

All reactions

Sorry, something went wrong.

[![@saturnflyer](https://avatars.githubusercontent.com/u/4271?s=80&v=4)](/saturnflyer)

Copy link

### **[saturnflyer](/saturnflyer)** commented [Feb 10, 2012](#issuecomment-3911526)

| +1 thanks [@rmm5t](https://github.com/rmm5t). radiant is bitten by this problem and I haven't had time to track it down. |
| --- |

All reactions

Sorry, something went wrong.

![nbibler](https://avatars.githubusercontent.com/u/3775?s=60&v=4)

 **[nbibler](/nbibler)**
reviewed
[Feb 10, 2012](#discussion-diff-439114)
 [View reviewed changes](/rtomayko/rack-cache/pull/52/files/0ed9a12e4563dcf4e82a4e2543e0df862b22fbe2#diff-c1962e1d0bd541be539d865ecbc82e0a68e637d52e3decb46050bcaac51106a0)

[lib/rack/cache/context.rb](/rtomayko/rack-cache/pull/52/files#diff-c1962e1d0bd541be539d865ecbc82e0a68e637d52e3decb46050bcaac51106a0)

|  |  | stripped ||= response.headers.delete(name) |
| --- | --- | --- |
|  |  | response.headers.delete(name) |
|  |  | end |
|  |  | record :ignore if stripped |

Copy link

### @nbibler **[nbibler](/nbibler)** [Feb 10, 2012](#discussion_r439114)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The seemingly double-call to `response.headers.delete` reads very strangely. I understand that it only gets called for the first time that it passes through (in theory, because the header should have a truthy value which would be returned and set, although for a nil header value that catch / logic would fail).

I think something more like:

```
def strip_ignore_headers(response)
  record :ignore if response.headers.reject! { |k,v| ignore_headers.include? k }
end
```

See [the Hash#reject! docs](http://rubydoc.info/stdlib/core/1.9.3/Hash#reject%21-instance_method) for more info.

There may be some issues with String comparisons on the `include?` call since the ignore headers are set by a developer and therefore may be either symbols or strings, not to mention casing issues may arrise. But that's probably beyond the scope of this issue.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @rmm5t **[rmm5t](/rmm5t)** [Feb 10, 2012](#discussion_r439191)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Whoops. Good catch [@nbibler](https://github.com/nbibler). That was the result of a messy/botched refactor on my part after getting the tests to pass. Cleanup forthcoming.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @rmm5t **[rmm5t](/rmm5t)** [Feb 10, 2012](#discussion_r439349)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@nbibler](https://github.com/nbibler), Oh, I just realized that the reject! doesn't cover everything because the headers hash is a case-insensitive HeaderHash object from Rack::Utils. New test and another refactor coming.

Sorry, something went wrong.

All reactions

Copy link

### @nbibler **[nbibler](/nbibler)** [Feb 10, 2012](#discussion_r439354)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hah! Yikes. Good catch.

Sorry, something went wrong.

All reactions

[![@nbibler](https://avatars.githubusercontent.com/u/3775?s=80&v=4)](/nbibler)

Copy link

### **[nbibler](/nbibler)** commented [Feb 10, 2012](#issuecomment-3912068)

| 👍 for the pull request. My code comment is more of a clarity / maintenance / readability comment or thought than a "THIS [request] SHALL NOT PASS" statement. :)  Regarding the question of recording an `:ignore` activity: it could probably be named something more interesting, but since that's basically internal, I don't know that it's a significant problem than needs to be solved, immediately. |
| --- |

All reactions

Sorry, something went wrong.

[![@joemsak](https://avatars.githubusercontent.com/u/98936?s=80&u=1acb57fce70a8686c5376bc9163757c4612dda0f&v=4)](/joemsak)

Copy link

### **[joemsak](/joemsak)** commented [Feb 10, 2012](#issuecomment-3912119)

| Should I still see Set-Cookie: in the curl 304 response when using this branch?  example:  curl -I <http://www.theydrawandtravel.com> -c cookies.txt curl -I <http://www.theydrawandtravel.com> -b cookies.txt --header 'If-Modified-Since: Fri, 10 Feb 2012 18:24:07 GMT' |
| --- |

All reactions

Sorry, something went wrong.

[![@nbibler](https://avatars.githubusercontent.com/u/3775?s=80&v=4)](/nbibler)

Copy link

### **[nbibler](/nbibler)** commented [Feb 10, 2012](#issuecomment-3912185)

| [@joemsak](https://github.com/joemsak) I believe with this update you will still see the Set-Cookie header in the response, if you make an uncached query, but that header would not be cached - Set-Cookie is specifically stripped out - and therefore not served to the next client. |
| --- |

All reactions

Sorry, something went wrong.

[![@joemsak](https://avatars.githubusercontent.com/u/98936?s=80&u=1acb57fce70a8686c5376bc9163757c4612dda0f&v=4)](/joemsak)

Copy link

### **[joemsak](/joemsak)** commented [Feb 10, 2012](#issuecomment-3912218)

| Is there a reliable test to be sure this is working correctly? |
| --- |

All reactions

Sorry, something went wrong.

[![@nbibler](https://avatars.githubusercontent.com/u/3775?s=80&v=4)](/nbibler)

Copy link

### **[nbibler](/nbibler)** commented [Feb 10, 2012](#issuecomment-3912298)

| [@joemsak](https://github.com/joemsak) Sure. If you make the first request with a cookie, which in theory would've been cached, previously. Then make a subsequent request from a new cookie-less session. That new request should not contain the previous session's Set-Cookie header. Of course, it may send a *new* Set-Cookie header, depending on your system configuration... but if it's served purely from cache, then there should be no cookie header, at all, for the new requester. |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Refactored Context#strip_ignore_headers (thanks](/rtomayko/rack-cache/pull/52/commits/12ae92d16b5c1c7bbd1b1db5600909485a7e673c "Refactored Context#strip_ignore_headers (thanks @nbibler)") [@nbibler](https://github.com/nbibler)[)](/rtomayko/rack-cache/pull/52/commits/12ae92d16b5c1c7bbd1b1db5600909485a7e673c "Refactored Context#strip_ignore_headers (thanks @nbibler)")`

`[12ae92d](/rtomayko/rack-cache/pull/52/commits/12ae92d16b5c1c7bbd1b1db5600909485a7e673c)`

[![@joemsak](https://avatars.githubusercontent.com/u/98936?s=80&u=1acb57fce70a8686c5376bc9163757c4612dda0f&v=4)](/joemsak)

Copy link

### **[joemsak](/joemsak)** commented [Feb 10, 2012](#issuecomment-3912475)

| I see this in firebug:  No "set-cookie" -- does that confirm this is resolved for me? (no more crossed user sessions?)  Response Headers From Cache Cache-Control max-age=300, public Content-Length 507535 Content-Type text/html; charset=utf-8 Date Fri, 10 Feb 2012 19:09:43 GMT Last-Modified Fri, 10 Feb 2012 18:53:50 GMT Server thin 1.3.1 codename Triple Espresso X-Rack-Cache pass X-Runtime 0.378382 X-Ua-Compatible IE=Edge,chrome=1 |
| --- |

All reactions

Sorry, something went wrong.

[![@nbibler](https://avatars.githubusercontent.com/u/3775?s=80&v=4)](/nbibler)

Copy link

### **[nbibler](/nbibler)** commented [Feb 10, 2012](#issuecomment-3912508)

| As another point of reference: Amazon CloudFront (the Amazon CDN) originally intended to strip Set-Cookie headers, but they accidentally disabled the cookie header removal in a bug released along with the [custom origins](http://aws.typepad.com/aws/2010/11/amazon-cloudfront-support-for-custom-origins.html) update - Nov 2010. Only "recently" (about 2 months ago) did they [deploy a fix](https://forums.aws.amazon.com/thread.jspa?threadID=78063) for it.  Caching is so much fun. |
| --- |

All reactions

Sorry, something went wrong.

[![@nbibler](https://avatars.githubusercontent.com/u/3775?s=80&v=4)](/nbibler)

Copy link

### **[nbibler](/nbibler)** commented [Feb 10, 2012](#issuecomment-3912544)

| [@joemsak](https://github.com/joemsak) Yeah, if no `Set-Cookie` header is being transmitted, then user sessions cannot be crossed/mixed up from that end point. :) |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Feb 10, 2012](#issuecomment-3912648)

| [@joemsak](https://github.com/joemsak) The curl responses in your example are getting bypassed by Rack::Cache for other reasons. Note the `X-Rack-Cache: pass` header. Your responses are not being cached by Rack::Cache. This is sometimes caused by an error with the entitystore. Do you have any errors in the logs? |
| --- |

All reactions

Sorry, something went wrong.

[![@joemsak](https://avatars.githubusercontent.com/u/98936?s=80&u=1acb57fce70a8686c5376bc9163757c4612dda0f&v=4)](/joemsak)

Copy link

### **[joemsak](/joemsak)** commented [Feb 10, 2012](#issuecomment-3912871)

| [@rmm5t](https://github.com/rmm5t) based on [@nbibler](https://github.com/nbibler)'s response to my latest question (demonstrating that Set-Cookie is not in my cached response), I want to say we are out of the woods with the crisis we've been having for 2 days over this, thanks to your strip\_set\_cookie branch... tentatively... ; ) I've been claiming to be out of the woods a little too frequently with this client |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=40&v=4)](/rmm5t)

`[Fixed the case-insensitive nature of ignored response headers](/rtomayko/rack-cache/pull/52/commits/6379364deb62fade14c1268806d3ccae5811947a "Fixed the case-insensitive nature of ignored response headers")`

`[6379364](/rtomayko/rack-cache/pull/52/commits/6379364deb62fade14c1268806d3ccae5811947a)`

![nbibler](https://avatars.githubusercontent.com/u/3775?s=60&v=4)

 **[nbibler](/nbibler)**
reviewed
[Feb 11, 2012](#discussion-diff-440602)
 [View reviewed changes](/rtomayko/rack-cache/pull/52/files/91fdcbcdf94df9e8be2913560b65a99324f6b0dd#diff-c1962e1d0bd541be539d865ecbc82e0a68e637d52e3decb46050bcaac51106a0)

[lib/rack/cache/context.rb](/rtomayko/rack-cache/pull/52/files#diff-c1962e1d0bd541be539d865ecbc82e0a68e637d52e3decb46050bcaac51106a0)

|  |  | @@ -269,6 +270,12 @@ def store(response) | |
| --- | --- | --- | --- |
|  |  | record :store |
|  |  | end |
|  |  |  |
|  |  | # Remove all ignored response headers before writing to the cache. |
|  |  | def strip\_ignore\_headers(response) |
|  |  | stripped\_values = ignore\_headers.map { |name, value| response.headers.delete(name) } |

Copy link

### @nbibler **[nbibler](/nbibler)** [Feb 11, 2012](#discussion_r440602)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm afraid you might've been right the first time through (before the "fix" commit). You're mapping an Array instance (ignore\_headers, as seen in cache/options.rb line 149, is an array). So, it should just be:

```
def strip_ignore_headers(response)
  record :ignore if ignore_headers.map { |h| response.headers.delete(h) }.any?
end
```

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @rmm5t **[rmm5t](/rmm5t)** [Feb 11, 2012](#discussion_r440804)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks. Brain fart on that one. Will reset and force push that commit away.

Sorry, something went wrong.

All reactions

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Feb 15, 2012](#issuecomment-3989816)

| This looks great guys. Thanks so much. Merging. |
| --- |

All reactions

Sorry, something went wrong.

[rtomayko](/rtomayko)
added a commit
that referenced
this pull request
[Feb 15, 2012](#ref-commit-2e3a64d)
[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=40&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

`[Merge pull request](/rtomayko/rack-cache/commit/2e3a64d07daac4c757cc57620f2288e865a09b90 "Merge pull request #52 from rmm5t/strip_set_cookie

Rack::Cache caches Set-Cookie response headers yielding potential security holes in apps") [#52](https://github.com/rtomayko/rack-cache/pull/52) [from rmm5t/strip_set_cookie](/rtomayko/rack-cache/commit/2e3a64d07daac4c757cc57620f2288e865a09b90 "Merge pull request #52 from rmm5t/strip_set_cookie

Rack::Cache caches Set-Cookie response headers yielding potential security holes in apps")`
…

`[2e3a64d](/rtomayko/rack-cache/commit/2e3a64d07daac4c757cc57620f2288e865a09b90)`

```
Rack::Cache caches Set-Cookie response headers yielding potential security holes in apps
```

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=40&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)
[rtomayko](/rtomayko)
merged commit [`2e3a64d`](/rtomayko/rack-cache/commit/2e3a64d07daac4c757cc57620f2288e865a09b90)
into
rtomayko:master

[Feb 15, 2012](https://github.com/rtomayko/rack-cache/pull/52#event-9625316)

[![@chanks](https://avatars.githubusercontent.com/u/300058?s=80&u=041ccee611eefa3acce46829c25e7f9e9bac6a61&v=4)](/chanks)

Copy link

### **[chanks](/chanks)** commented [Feb 15, 2012](#issuecomment-3990793)

| Am I reading this right that the Set-Cookie header is stripped not only from the response set in the cache, but the response passed back to the client? This seems like a bad idea to me. I mean, it's inadvisable for a developer to change the session in an action that's intended to be publically cached, but if they do, that information should probably still make it back to the initial client (the one who caused the cache to be populated). |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Feb 17, 2012](#issuecomment-4013018)

| That's a damn good point. Hmmmm. |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Feb 20, 2012](#issuecomment-4062215)

| [@chanks](https://github.com/chanks), [@rtomayko](https://github.com/rtomayko), True. That's the current behavior, but I figured it wasn't an issue. I figured that if the response can be served from the cache for everyone else without the Cookie, then it should be able to be delivered without a Cookie to the original request. I do understand and empathize with [@chanks](https://github.com/chanks)'s concern though.  The main reason stripping Set-Cookie headers was necessary in the first place is because Rails will aggressively include Set-Cookie responses on all responses after a session has been initiated. It does this with middleware making it somewhat of a burden to ensure public cacheable content does not have a Set-Cookie header. If nothing else, the automatic inclusion of Rack-Cache in production was potentially introducing an unexpected session security hole -- one that most people would not expect until it was too late. I feel that if you're explicitly setting a cacheable response, there probably shouldn't have been a Set-Cookie header there in the first place. This new feature in Rack-Cache just enforces that behavior by default. |
| --- |

All reactions

Sorry, something went wrong.

[![@chanks](https://avatars.githubusercontent.com/u/300058?s=80&u=041ccee611eefa3acce46829c25e7f9e9bac6a61&v=4)](/chanks)

Copy link

### **[chanks](/chanks)** commented [Feb 20, 2012](#issuecomment-4064326)

| [@rmm5t](https://github.com/rmm5t) [@rtomayko](https://github.com/rtomayko) I've been considering this more. I think it's reasonable (and perhaps common?) for a developer to use a before/after filter across the entire app that affects the session (as a part of their authentication system, for example - think of checking and updating a user-specific token in the session and DB on each request, or after a given length of time has passed). It would, of course, also fire during actions that are intended to be publically cached.  Maybe it's fair to say that the developer should go out of their way to skip filters like that on publically-cached actions, but if they're unaware of the issue (or they forget) I think this will lead to strange bugs in production that they won't be able to reproduce in the development or test environments (since I believe Rails doesn't include Rack::Cache there by default). |
| --- |

All reactions

Sorry, something went wrong.

[![@barttenbrinke](https://avatars.githubusercontent.com/u/8935?s=80&v=4)](/barttenbrinke)

Copy link

### **[barttenbrinke](/barttenbrinke)** commented [Feb 24, 2012](#issuecomment-4153967)

| We encountered this yesterday in production. As this is a MAJOR security issue, why hasn't there been a gem release yet? And I assume this will be back ported to all old versions of the gem?  As for the response filtering of the active cache: we currently actively strip set cookie headers from anything coming from /asset with apache until this is resolved. |
| --- |

All reactions

Sorry, something went wrong.

[![@thisduck](https://avatars.githubusercontent.com/u/293689?s=80&v=4)](/thisduck)

Copy link

Contributor

### **[thisduck](/thisduck)** commented [Feb 29, 2012](#issuecomment-4231873)

| [@barttenbrinke](https://github.com/barttenbrinke) I've back ported this to 1.0(.3) here: <https://github.com/thisduck/rack-cache/tree/backport_set_cookie_fix_to_1.0> |
| --- |

All reactions

Sorry, something went wrong.

[![@barttenbrinke](https://avatars.githubusercontent.com/u/8935?s=80&v=4)](/barttenbrinke)

Copy link

### **[barttenbrinke](/barttenbrinke)** commented [Mar 2, 2012](#issuecomment-4287862)

| [@thisduck](https://github.com/thisduck) \0/ Thank you! |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Mar 2, 2012](#issuecomment-4288383)

| [@barttenbrinke](https://github.com/barttenbrinke) [@thisduck](https://github.com/thisduck) I'm not sure back porting is the best idea. Caching cookies was a known and documented feature of Rack::Cache before this change. I'd argue that this change is a backwards-incompatibility and needs to at least be part of a minor version bump.  At the end of the day, it's up to [@rtomayko](https://github.com/rtomayko). |
| --- |

All reactions

Sorry, something went wrong.

[![@thisduck](https://avatars.githubusercontent.com/u/293689?s=80&v=4)](/thisduck)

Copy link

Contributor

### **[thisduck](/thisduck)** commented [Mar 2, 2012](#issuecomment-4288708)

| [@rmm5t](https://github.com/rmm5t) [@barttenbrinke](https://github.com/barttenbrinke) [@rtomayko](https://github.com/rtomayko)  There is a slight issue here with documentation and expectation. I'm also not sure that this is a well known feature.  The problem with caching cookies on a session based site is that the cookie sends the browser your session id. If this is cached for certain resources, then you have a major issue where your session id is being sent to every browser that is requesting the cached resource.  I would assume the default expectation is that any cached resources don't potentially exploit the session id. Seems like a fairly major issue. It's further complicated because it's very hard to debug. The default expectation (at least that I had) was that any caching layer along the way should strip cookies, precisely because of the session issue.  If you're on Heroku on Rails 3.1, rack-cache is enabled by default using 1.0.x. If I know this, I can scan for cached resources that return a Set-Cookie header and potentially steal someone's session. If you're using rail's default with entire cookie sessions, then I have your entire session data.  So even if it's a documented feature, in practice it's a major hole.  EDIT: of course you touched upon this in the initial post up there. But if I'm on Rails 3.1 and not updating any time soon to 3.2, then I might have a hijacking issue on my hands. |
| --- |

All reactions

Sorry, something went wrong.

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=80&u=075b9bae1671f27ec88c3a469235fc20c6b16a2a&v=4)](/rmm5t)

Copy link

Contributor

Author

### **[rmm5t](/rmm5t)** commented [Mar 2, 2012](#issuecomment-4293894)

| [@thisduck](https://github.com/thisduck), Correct me if I'm mistaken, but Heroku doesn't enable rack-cache. Rails 3.1.3 (specifically actionpack) depends on rack-cache. Furthermore, actionpack 3.1.3 depends on `rack-cache ~> 1.1`. which means that you'll be able to use rack-cache 1.2+ (assuming that this change doesn't get pushed into a major version bump). After a new rack-cache release, all you will need to do is `bundle update rack-cache` in your app and redeploy. Actually, in theory, you should be able to do that now by specifying the following in your Gemfile:  ``` gem "rack-cache", :git => "https://github.com/rtomayko/rack-cache.git"  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@thisduck](https://avatars.githubusercontent.com/u/293689?s=80&v=4)](/thisduck)

Copy link

Contributor

### **[thisduck](/thisduck)** commented [Mar 2, 2012](#issuecomment-4293941)

| [@rmm5t](https://github.com/rmm5t)  Aah, okay. Didn't know about rails 3.1.3.  But Rails 3.1 on Heroku does use rack-cache by default for action caching. You can see this in action by turned action caching on in dev or running in production mode. |
| --- |

All reactions

Sorry, something went wrong.

[![@barttenbrinke](https://avatars.githubusercontent.com/u/8935?s=80&v=4)](/barttenbrinke)

Copy link

### **[barttenbrinke](/barttenbrinke)** commented [Mar 5, 2012](#issuecomment-4318377)

| All I'm asking is to release a new gem as soon as possible, as 99% of the developers will not be aware of this issue. Please try to prevent another Github/rails drama like we had this weekend. |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Mar 5, 2012](#issuecomment-4318668)

| Yep. I'm dealing with this right now. |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Mar 5, 2012](#issuecomment-4318816)

| Kind of not happy with this solution still to be honest. It fixes the cookie leak but doesn't address [@chanks](https://github.com/chanks) comment here:  [#52 (comment)](https://github.com/rtomayko/rack-cache/pull/52#issuecomment-3990793)  I'm going ahead with a 1.2 release because I'm more concerned about the cookie leak but I'm almost positive this solution will change in a 1.3 or 2.0 release. |
| --- |

All reactions

Sorry, something went wrong.

[![@barttenbrinke](https://avatars.githubusercontent.com/u/8935?s=80&v=4)](/barttenbrinke)

Copy link

### **[barttenbrinke](/barttenbrinke)** commented [Mar 5, 2012](#issuecomment-4318865)

| +1 for [@chanks](https://github.com/chanks) comment. Maybe a warning in the 1.2 release notes to flush all cache would also help a lot. |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=80&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)

Copy link

Owner

### **[rtomayko](/rtomayko)** commented [Mar 5, 2012](#issuecomment-4318904)

| Alright, rack-cache 1.2 is now available on rubygems.org. Please let me know if this plugs all holes for you. |
| --- |

All reactions

Sorry, something went wrong.

[![@foeken](https://avatars.githubusercontent.com/u/13864?s=80&v=4)](/foeken)

Copy link

### **[foeken](/foeken)** commented [Mar 5, 2012](#issuecomment-4327652)

| So no backport in older versions? Hope people update those gems... |
| --- |

All reactions

Sorry, something went wrong.

[![@rtomayko](https://avatars.githubusercontent.com/u/404?s=40&u=0cbf4de715964a71b997b8eb0593521c985aa558&v=4)](/rtomayko)
[rtomayko](/rtomayko)
mentioned this pull request
[Mar 5, 2012](#ref-pullrequest-3487683)

[Use rack.logger if it's avaiable
#58](/rtomayko/rack-cache/pull/58)
 Merged

[![@barttenbrinke](https://avatars.githubusercontent.com/u/8935?s=40&v=4)](/barttenbrinke)
[barttenbrinke](/barttenbrinke)
mentioned this pull request
[Oct 1, 2012](#ref-pullrequest-7243314)

[Use Rack::Cache middleware only if is in Gemfile
rails/rails#7794](/rails/rails/pull/7794)
 Merged

[![@jfahrenkrug](https://avatars.githubusercontent.com/u/16358?s=40&v=4)](/jfahrenkrug)
[jfahrenkrug](/jfahrenkrug)
mentioned this pull request
[Feb 6, 2013](#ref-issue-10688387)

[Inform about fixed Rack-Cache Session Crossing Bug in 1.1.1
radiant/radiant#361](/radiant/radiant/issues/361)

Open

[jperkin](/jperkin)
pushed a commit
to TritonDataCenter/pkgsrc-legacy
that referenced
this pull request
[Dec 9, 2013](#ref-commit-194868d)

`[Update ruby-rack-cache package to 1.2.](/TritonDataCenter/pkgsrc-legacy/commit/194868d77733261f8a2b5456314998ca5e28c8d5 "Update ruby-rack-cache package to 1.2.

## 1.2 / March 2012

  * Fix a cookie leak vulnerability effecting large numbers of Rails 3.x
    installs: https://github.com/rtomayko/rack-cache/pull/52

  * Never 304 on PUT or POST requests.

  * Misc bundler and test tooling fixes.")`
…

`[194868d](/TritonDataCenter/pkgsrc-legacy/commit/194868d77733261f8a2b5456314998ca5e28c8d5)`

```
## 1.2 / March 2012

  * Fix a cookie leak vulnerability effecting large numbers of Rails 3.x
    installs: [rtomayko/rack-cache#52](https://github.com/rtomayko/rack-cache/pull/52)

  * Never 304 on PUT or POST requests.

  * Misc bundler and test tooling fixes.
```

[jsonn](/jsonn)
pushed a commit
to jsonn/pkgsrc
that referenced
this pull request
[Oct 11, 2014](#ref-commit-f8be9b6)

`[Update ruby-rack-cache package to 1.2.](/jsonn/pkgsrc/commit/f8be9b62df0206451e6e2cb7d19d712e4761b6d9 "Update ruby-rack-cache package to 1.2.

## 1.2 / March 2012

  * Fix a cookie leak vulnerability effecting large numbers of Rails 3.x
    installs: https://github.com/rtomayko/rack-cache/pull/52

  * Never 304 on PUT or POST requests.

  * Misc bundler and test tooling fixes.")`
…

`[f8be9b6](/jsonn/pkgsrc/commit/f8be9b62df0206451e6e2cb7d19d712e4761b6d9)`

```
## 1.2 / March 2012

  * Fix a cookie leak vulnerability effecting large numbers of Rails 3.x
    installs: [rtomayko/rack-cache#52](https://github.com/rtomayko/rack-cache/pull/52)

  * Never 304 on PUT or POST requests.

  * Misc bundler and test tooling fixes.
```

[![@DawidJanczak](https://avatars.githubusercontent.com/u/1292568?s=40&v=4)](/DawidJanczak)
[DawidJanczak](/DawidJanczak)
mentioned this pull request
[Sep 22, 2020](#ref-issue-706305930)

[Question about clearing `Set-Cookie` behaviour
#170](/rtomayko/rack-cache/issues/170)

Open

[![@Matt-Yorkley](https://avatars.githubusercontent.com/u/9029026?s=40&v=4)](/Matt-Yorkley)
[Matt-Yorkley](/Matt-Yorkley)
mentioned this pull request
[Aug 20, 2023](#ref-pullrequest-1858118019)

[Allow custom options for transferable headers and non-cached headers
rack/rack-cache#16](/rack/rack-cache/pull/16)
 Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frtomayko%2Frack-cache%2Fpull%2F52)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

10 participants

[![@rmm5t](https://avatars.githubusercontent.com/u/740?s=52&v=4)](/rmm5t) [![@rtomayko](https://avatars.githubusercontent.com/u/404?s=52&v=4)](/rtomayko) [![@mloughran](https://avatars.githubusercontent.com/u/214?s=52&v=4)](/mloughran) [![@saturnflyer](https://avatars.githubusercontent.com/u/4271?s=52&v=4)](/saturnflyer) [![@nbibler](https://avatars.githubusercontent.com/u/3775?s=52&v=4)](/nbibler) [![@joemsak](https://avatars.githubusercontent.com/u/98936?s=52&v=4)](/joemsak) [![@chanks](https://avatars.githubusercontent.com/u/300058?s=52&v=4)](/chanks) [![@barttenbrinke](https://avatars.githubusercontent.com/u/8935?s=52&v=4)](/barttenbrinke) [![@thisduck](https://avatars.githubusercontent.com/u/293689?s=52&v=4)](/thisduck) [![@foeken](https://avatars.githubusercontent.com/u/13864?s=52&v=4)](/foeken)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_077a52f0_20250124_171208.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](7) [[next>]](9) [[<thread-prev]](5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4FCF8BA2.2030406@redhat.com>
Date: Wed, 06 Jun 2012 10:56:02 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: Jan Lieskovsky <jlieskov@...hat.com>
CC: oss-security@...ts.openwall.com, Matthias Weckbecker <mweckbecker@...e.de>
Subject: Re: CVE request: rack-cache caches sensitive headers
 (Set-Cookie)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 06/06/2012 03:29 AM, Jan Lieskovsky wrote:
> Thanks for your report, Matthias.
>
> On 06/06/2012 11:09 AM, Matthias Weckbecker wrote:
>> Hi Kurt, Steve, vendors,
>>
>> rake-cache caches sensitive response headers such as Set-Cookie.
>> Attackers
>> with access to the cache could possibly obtain other user's cookies to
>> e.g.
>> bypass authentication.
>>
>> More information (including patch) available at our bugzilla:
>>    <https://bugzilla.novell.com/show_bug.cgi?id=763650>
>>
>> Kurt, could you possibly assign a CVE for this issue, please? Thank
>> you in
>> advance!
>
> Kurt, once assigned please note it in our bug:
> <https://bugzilla.redhat.com/show_bug.cgi?id=824520>
>
> too.
>
> Thank you && Regards, Jan.
> --
> Jan iankko Lieskovsky / Red Hat Security Response Team
>
>>
>> Matthias
>>

Please use CVE-2012-2671 for this issue.

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iQIcBAEBAgAGBQJPz4uhAAoJEBYNRVNeJnmTKzcP+we7VUVdFw3LqAfqRFmGE1zY
0gq+Sd/ReM0GITRiDbtMOXGqy7DT6ivvuvaQ5T7skIWbNkvanSiv+6F+YeTgIQsX
U9rkk4FeEkrmP5f7vVxPuhNSRWec8gjPkuxCzlQaBLlXmW21xP0fdGJ6wwxwGJAr
SBsL/5MbsvO+R4WjChTio8fZ5aky8o+DWK1ShSN61FVciX+nSvCdvsL40OOki0TF
6Enw/Cod5uccYsQgLNSfC0opWuLlHW/wZn2IcpZdL+Mp5cE69qy9dHLs8RS0uu/O
TuWbzzgZZdt/aZPj6DE7mqWoW0n82H8eSK8HQPeA0K2e4U1q7CKgdiW8U/LR76Yp
5xaUKvhyDWoqsYiP6UXIGYE30nRtHOuFFXxBbmE4kM/wAJtywrLmeD8yZIrRd4Kd
2oJ4NLvfZkRz4nbhhWN+JI9AmoMn0NgG4KfXcK788Ve99MpNGp4Ym3V3b7TR78R3
1awyCtjbCiQbGdmFKUKTToBNQ3DYFh9LOFzmksoOwdCfVJ8JhLmaUNkKCohmzH+Z
8QxklQy39u148ZDNLS1CvIPT+R6oQtotHltLot+nGbAXoL6L4+uzQe58/GYnVnpl
aJeC+R8acTRyMfCv8713bSeqZzt2U3M0QGEEePPPLq2sluAWIMC/hD1W8aI2RfiN
T1pdH/XovTCpR35FCGut
=ijcr
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_6591fead_20250124_171208.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](3) [[next>]](5) [[thread-next>]](5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <201206061109.19639.mweckbecker@suse.de>
Date: Wed, 6 Jun 2012 11:09:19 +0200
From: Matthias Weckbecker <mweckbecker@...e.de>
To: oss-security@...ts.openwall.com
Subject: CVE request: rack-cache caches sensitive headers (Set-Cookie)

Hi Kurt, Steve, vendors,

rake-cache caches sensitive response headers such as Set-Cookie. Attackers
with access to the cache could possibly obtain other user's cookies to e.g.
bypass authentication.

More information (including patch) available at our bugzilla:
  <https://bugzilla.novell.com/show_bug.cgi?id=763650>

Kurt, could you possibly assign a CVE for this issue, please? Thank you in
advance!

Matthias

--
Matthias Weckbecker, Junior Security Engineer, SUSE Security Team
SUSE LINUX Products GmbH, Maxfeldstr. 5, D-90409 Nuernberg, Germany
Tel: +49-911-74053-0;  <http://suse.com/>
SUSE LINUX Products GmbH, GF: Jeff Hawn, HRB 16746 (AG Nuernberg)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


