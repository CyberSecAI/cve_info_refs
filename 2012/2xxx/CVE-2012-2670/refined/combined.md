=== Content from www.openwall.com_d961b45a_20250125_062005.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](5) [[next>]](7) [[thread-next>]](9) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4FCF54CB.4030502@xync.org>
Date: Wed, 06 Jun 2012 09:02:03 -0400
From: Mark Hoopes <xync@...c.org>
To: oss-security@...ts.openwall.com
Subject: Arbitrary File Upload/Execution in Collabtive

This disclosure was posted to Bugtraq yesterday
(<http://www.securityfocus.com/archive/1/522973/30/0/threaded>).  I am
submitting it to oss-security as a request to have a CVE ID assigned.

TITLE: Arbitrary File Upload/Execution in Collabtive
DATE: 06-04-2012
PRODUCT: Collabtive Web-Based Project Management Software
(<http://collabtive.o-dyn.de/>)
VERSIONS: 0.7.5, 0.6.1 confirmed.  All versions <= 0.7.5 probable
RESEARCHER: Mark Hoopes (xync@...c.org/)
ADDITIONAL INFORMATION:
<http://xync.org/2012/06/04/Arbitrary-File-Upload-in-Collabtive.html>

Vulnerability:
During the upload of an avatar image for a Collabtive user, the
manageuser.php script checks the file type using the MIME type provided
in the POST request (via the $_FILES['userfile']['type'] variable)
rather than by extension.  This MIME type can be spoofed via an
intercepting proxy or custom POST script allowing a malicious user to
upload an arbitrary file.  This file will be placed in a predictable web
accessible path with an easily determined name.  In most installations,
execution from this directory is not restricted which allows a remote
attacker to execute a PHP script uploaded this way with the privileges
of the web user.

Access to the avatar upload function is restricted to logged in users,
but because of Collabtive's design decisions in implementing OpenID
support, this is easily accomplished.  If an unknown user supplies a
valid OpenID v1.0 URL as the username on the login page, Collabtive will
automatically create a new user based on the referenced credentials.
That new user is not authorized to access any projects, but is
authorized to upload an avatar image.  This allows an attacker with no
other knowledge of the host site or its users to exploit the vulnerability.

Fix:
Upgrade to Collabtive v0.7.6 or greater
Source:
<http://sourceforge.net/projects/collabtive/files/collabtive/0.7.6/collabtive076.zip/download>
Release Notes: <http://www.collabtive.o-dyn.de/blog/?p=426>

Workaround:
Disable script execution of the upload directory via .htaccess for
Apache or similar web servers.  This should apply at minimum to the
/files/[template]/avatar directory but can safely be applied to the
entire /files directory.

Sample contents of the .htaccess file are:
   Options -Indexes
   Options -ExecCGI
   AddHandler cgi-script .php .php3 .php4 .phtml .pl .py .jsp .asp .htm
.shtml .sh .cgi

Note 'AllowOverride Options AddHandler' or 'AllowOverride All' must be
enabled in the main httpd.conf file for this directory or inherited from
a parent directory.
See <http://www.mysql-apache-php.com/fileupload-security.htm>

Additional References:
<http://xync.org/2012/06/04/Arbitrary-File-Upload-in-Collabtive.html>

<http://www.php.net/manual/en/features.file-upload.post-method.php> see
comments for $_FILES['userfile']['type']

TIMELINE:
   April 18, 2012 - Issue reported to developers
   April 19, 2012 - Fix committed to Collabtive github
   May 30,  2012 - Collabtive version 0.7.6 released w/ fix
   June 4, 2012 - Vulnerability published

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from xync.org_daf6f174_20250125_062006.html ===

![Xync.org Header Image from Garden of the Gods CO](/images/headerimage.jpg)

### Site Sampler

Maker Inspired

[Hackaday](http://hackaday.com/)

[CNC Zone](http://cnczone.com/)

[Maker Faire - NC](http://makerfairenc.com/)

[EEVBlog](http://www.eevblog.com/)

[Dino Segovis's Hack a Week](http://hackaweek.com/hacks/)

[Jeri Ellsworth's YouTube](http://www.youtube.com/user/jeriellsworth)

Information Security

[ISD Podcast](http://isdpodcast.com/)

[Dark Reading](http://darkreading.com)

[CVE Details](http://cvedetails.com)

[PacketStorm](http://packetstormsecurity.org)

[Shodan DB](http://www.shodanhq.com)

[CarolinaCon](http://carolinacon.org)

[OWASP Top Ten](http://www.owasp.org/index.php/Category%3AOWASP_Top_Ten_Project)

Cheap Materials

[Deal Extreme](http://dx.com)

[Tayda Electronics](http://www.taydaelectronics.com/)

[SparkFun Electronics](http://sparkfun.com)

[Futurlec Electronics](http://futurlec.com/)

## An Easy Way to Mess Up File Type Verification

## Background

Recently I wanted to try my skills at code review. Fortunately, there’s lots of open source code out there just looking for some new contributor to find bugs. Rather than go after WordPress, Joomla, or one of the other common targets I decided to go for something less popular without being totally obscure. In the end the magic selection dart landed on a web based project management application called [Collabtive](http://collabtive.o-dyn.de/).

In general Collabtive has a [good security track record](http://www.cvedetails.com/vendor/9333/Collabtive.html). Variables in SQL statements are properly sanitized, session IDs are checked nearly everywhere, and it is obvious that thought was given to good security practices. However, there was one small mistake and one feature with unintended consequences that combined to produce a significant vulnerability.

## Details

The mistake is an oldie, but not so common as to be on the OWASP top 10. Simply put, the file type check in the avatar image upload feature can be bypassed which allows a malicious user to upload any file, including a script based shell and then execute it as the web user.

The code involved is found in the manageuser.php file, lines 204 and 217:

```
$typ = $_FILES['userfile']['type'];
...
if ($typ != "image/jpeg" and $typ != "image/png" and $typ != "image/gif"
and $typ != "image/pjpeg")
// if the type is one of the types listed above abort the upload
// otherwise continue.
```

Seems like a good test, but the trouble comes from how they are using the PHP provided `$_FILES['userfile']['type']` variable. Referring to the [PHP documentation](http://www.php.net/manual/en/features.file-upload.post-method.php), and scrolling down to the notes on ‘type’ we see:

```
The mime type of the file, if the browser provided this information. An example
would be "image/gif". This mime type is however not checked on the PHP side and
therefore don't take its value for granted.
```

Collabtive unfortunately takes that value for granted here. One way for a malicious user to take advantage of the fact is to write a script that creates the POST request manually and forces an ‘image/xxxx’ mime type label to be provided for a malicious script payload. Since I’m more interested in proof of concept than automation, I’ll opt for a second method and use [my favorite intercepting proxy](http://www.portswigger.net/burp/proxy.html) to change it at submit time.

Below is the image of the post request that is submitted when a new user avatar image is uploaded to Collabtive. Instead of an image, I’m uploading a php script and then modifying the mime type to hide the fact. In this case I’m using a harmless phpinfo script, but a malicious user would choose a web shell or any other custom script.

[![Screenshot from Burp showing text to modify](/images/Security/file-post-type-manip-sml.png)](/images/Security/file-post-type-manip.png)

Once uploaded, a random number is appended to the script name (before the extension) and the file is placed in a world readable directory “[collabtive root]/files/standard/avatar”. Since the avatar image is displayed many places, a quick view of the source or “page info” will show you the URL to the file.

## Mitigation

If the web admin has been extremely conscientious and disabled script execution from the “files” directory tree or at least to this directory then a malicious user could be foiled. That could be done through the .htaccess file for Apache or similar web servers.

Sample contents of the .htaccess file are:

```
Options -Indexes
Options -ExecCGI
AddHandler cgi-script .php .php3 .php4 .phtml .pl .py .jsp .asp .htm .shtml .sh .cgi
```

Note ‘AllowOverride Options AddHandler’ or ‘AllowOverride All’ must be enabled in the main httpd.conf file for this directory or inherited from a parent directory. See <http://www.mysql-apache-php.com/fileupload-security.htm> for more information.

## Double Whammy

The manageuser.php script requires a valid session ID to execute it, which essentially limits exploitation to people who already have valid user credentials. However, the way Collabtive has structured their OpenID support gives an attacker the foothold they need. This is not a frequently used feature as evidenced by the lack of support for the current version of the OpenID protocol (2.0). However, when a valid OpenID 1.0 URL is provided as the userid on the login pgae, Collabtive will check for an existing user with that URL and if none exists, *will automatically create a new one*. This new user will not have access to any projects or project files, but they will be able to access their own user settings page and upload an avatar image which gives them the ability to exploit the previous vulnerability.

## Conclusion

The combination of these two flaws allows a remote attacker to gain web-shell access to most servers hosting Collabtive versions less than 0.7.6. Since the database credentials would be visible via that shell, database exploitation is almost guaranteed. User information as well as all project files would be exposed in addition to giving the attacker a foothold to launch further attacks.

The Collabtive team was notified of the issue on April 18, 2012 and had committed patches for these vulnerabilities the next day. There were some unrelated delays in the [next official release (0.7.6)](http://www.collabtive.o-dyn.de/blog/?p=426#more-426) which was not published until May 30, 2012.



=== Content from www.openwall.com_f0be6f0d_20250125_062006.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](8) [[next>]](10) [[<thread-prev]](6) [[thread-next>]](10) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4FCF8B67.2090202@redhat.com>
Date: Wed, 06 Jun 2012 10:55:03 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
CC: Mark Hoopes <xync@...c.org>
Subject: Re: Arbitrary File Upload/Execution in Collabtive

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 06/06/2012 07:02 AM, Mark Hoopes wrote:
> This disclosure was posted to Bugtraq yesterday
> (<http://www.securityfocus.com/archive/1/522973/30/0/threaded>).  I
> am submitting it to oss-security as a request to have a CVE ID
> assigned.
>
> TITLE: Arbitrary File Upload/Execution in Collabtive DATE:
> 06-04-2012 PRODUCT: Collabtive Web-Based Project Management
> Software (<http://collabtive.o-dyn.de/>) VERSIONS: 0.7.5, 0.6.1
> confirmed.  All versions <= 0.7.5 probable RESEARCHER: Mark Hoopes
> (xync@...c.org/) ADDITIONAL INFORMATION:
> <http://xync.org/2012/06/04/Arbitrary-File-Upload-in-Collabtive.html>
>
>  Vulnerability: During the upload of an avatar image for a
> Collabtive user, the manageuser.php script checks the file type
> using the MIME type provided in the POST request (via the
> $_FILES['userfile']['type'] variable) rather than by extension.
> This MIME type can be spoofed via an intercepting proxy or custom
> POST script allowing a malicious user to upload an arbitrary file.
> This file will be placed in a predictable web accessible path with
> an easily determined name.  In most installations, execution from
> this directory is not restricted which allows a remote attacker to
> execute a PHP script uploaded this way with the privileges of the
> web user.
>
> Access to the avatar upload function is restricted to logged in
> users, but because of Collabtive's design decisions in implementing
> OpenID support, this is easily accomplished.  If an unknown user
> supplies a valid OpenID v1.0 URL as the username on the login page,
> Collabtive will automatically create a new user based on the
> referenced credentials. That new user is not authorized to access
> any projects, but is authorized to upload an avatar image.  This
> allows an attacker with no other knowledge of the host site or its
> users to exploit the vulnerability.
>
> Fix: Upgrade to Collabtive v0.7.6 or greater Source:
> <http://sourceforge.net/projects/collabtive/files/collabtive/0.7.6/collabtive076.zip/download>
>
>  Release Notes: <http://www.collabtive.o-dyn.de/blog/?p=426>
>
> Workaround: Disable script execution of the upload directory via
> .htaccess for Apache or similar web servers.  This should apply at
> minimum to the /files/[template]/avatar directory but can safely be
> applied to the entire /files directory.
>
> Sample contents of the .htaccess file are: Options -Indexes Options
> -ExecCGI AddHandler cgi-script .php .php3 .php4 .phtml .pl .py .jsp
> .asp .htm .shtml .sh .cgi
>
> Note 'AllowOverride Options AddHandler' or 'AllowOverride All' must
> be enabled in the main httpd.conf file for this directory or
> inherited from a parent directory. See
> <http://www.mysql-apache-php.com/fileupload-security.htm>
>
> Additional References:
> <http://xync.org/2012/06/04/Arbitrary-File-Upload-in-Collabtive.html>
>
>  <http://www.php.net/manual/en/features.file-upload.post-method.php>
> see comments for $_FILES['userfile']['type']
>
>
> TIMELINE: April 18, 2012 - Issue reported to developers April 19,
> 2012 - Fix committed to Collabtive github May 30,  2012 -
> Collabtive version 0.7.6 released w/ fix June 4, 2012 -
> Vulnerability published
>

Please use CVE-2012-2670 for this issue.

BTW very nicely formatted/informative email, well done. Also bonus
points for offering a workaround =).

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iQIcBAEBAgAGBQJPz4tnAAoJEBYNRVNeJnmTfgEQAJK6aOlQx3XH2JB1NZ2kFUn2
XVvk8aF9fFmo2fIz0hvIhiNSwy8dhbrgisw35Cg8GfnMWQncgI/gTJUbcYKw76mb
SsDf1iZDAFGEJYRdqyXijrbHCfFG27ZoOkEyZ1lmwDb10nIngZUt6RQBDI3dnWUn
YVGG6EbV9a9HJjcDuKf3dsnMy8p/hXap3TNDM8p32N36KvUBAcGKEdvTmL0u9oIu
R8bBOEqm0+Awd7a3KkmwQWar5QpcQGHrob9Gp5XG1muoeNC+CGbjvenbeWzzSVr4
tDub2Sh3Wx61w5Ff5ppqPjd2haeV5ZOaiimGoht9E0+mrSJPY4NOCMRxIvUfd2IR
E6Avj2bpATxBEfU5JBloh9UbqLR37WItAU49idIwDr9zqVKKG/wgUSWOTzS+47oU
h4+eLtFovS3rNJxNZBh0OTk0uUJ3735N5LArje45SIiyxnUT0Wi7gcUV9JlV203K
/mEVRMI/0Jvd0FYKzEeXbvRV+4HcMTiSCG6OP4SZsbIDRFMUEsQ30Nw950IN+gTb
vcHUQEBxumK5zdBZ+zDEidEsKLjkPDiJSQ2Ng8VGSDy2rqUl9ACJnX27BSsqqZJA
iooyA0yMbXKwTs1LjYZulDu5l11mRtAXF331QbIG4AtnD2tvE2QPjk1CMJouPE40
ihjZQBiBHTEFTlzB8rCO
=NwJS
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


