=== Content from www.openwall.com_462f20c1_20250125_160216.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](13) [[next>]](15) [[<thread-prev]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4FBD265C.2020403@redhat.com>
Date: Wed, 23 May 2012 12:03:08 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE Request -- kernel: huge pages: memory leak
 on mmap failure

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 05/23/2012 04:35 AM, Petr Matousek wrote:
> Description of problem: When called for anonymous (non-shared)
> mappings, hugetlb_reserve_pages() does a resv_map_alloc(). It
> depends on code in hugetlbfs's vm_ops->close() to release that
> allocation.
>
> However, in the mmap() failure path, we do a plain unmap_region()
> without the remove_vma() which actually calls vm_ops->close().
>
> An unprivileged local user could use this flaw to crash the
> system.
>
> References: <https://bugzilla.redhat.com/show_bug.cgi?id=824345>
> <http://www.spinics.net/lists/linux-mm/msg34763.html>
>
> Proposed upstream fix: <https://lkml.org/lkml/2012/5/21/385>
>
> Thanks,

Please use CVE-2012-2390 for this issue.

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iQIcBAEBAgAGBQJPvSZcAAoJEBYNRVNeJnmTr8oQANqp/NZct0rBOM4TjvWZZGNy
htHC5hF9dBCkSLV1Kvn97kmLjFJkyV3Uk733/JF3nPHdQGY5C1toUTT0XFC0tvMU
Pq1y2o6feaxn65pQW6vu4b2a7HJrOw2LNw6/SFNIG6oSg3uomhhhMUi2cNZ8gB5S
R3qy56sdmhzKkeTon20ql9ZNHORYH5n9Ig6zliqqjJa217H2kz6JQRItFvNS2hp8
bEFLx8JAVdBVILgPSQ9cIrA7G2rNn2DpisW7++2J0JDMYTqHmDcAN4ZEiXvcd7ZO
0hHTsR8Qx1rey0EjPL+40tG6h7B5e96B8Waj0ZEfuL4/XK1CWcp+VlA61WRrRNvM
D2OeUzDKMCDqkyP4ZHCS/5Pr+OTuU2bm8jkDETn1lomIh64mFRlpJbD6riRZrCV3
z3MQPT817gELvKYPEtmtGfI+SAgoTCh5ky7j0O8YzkXZHqWzux5qcx6RN+dewFsd
NMm7tbDrep+nKbnqKDdWautDPch90I0lxBq82XnPVdUq2u+XEP7pgJUbp9iHWw17
6zDWNh0X4P//qfXTTZVLxBds4Xj6McvQs8M9NdubG8ZFKaOFtV22uff0PWZO3mbi
3qlEXElSrBx/h91RfC3qgcgGse9jwpGdWzQGUrqgZPV9lQJr1Je3KvHIPYgObJOd
BTvTwY/Y/lYD/2bmuh/9
=BPUl
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.ubuntu.com_ef903863_20250125_160218.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1535-1: Linux kernel vulnerabilities

10 August 2012

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 10.04](/security/notices?release=lucid)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel

## Details

An error was discovered in the Linux kernel's network TUN/TAP device

implementation. A local user with access to the TUN/TAP interface (which is

not available to unprivileged users until granted by a root user) could

exploit this flaw to crash the system or potential gain administrative

privileges. ([CVE-2012-2136](/security/CVE-2012-2136))

An error was discovered in the Linux kernel's memory subsystem (hugetlb).

An unprivileged local user could exploit this flaw to cause a denial of

service (crash the system). ([CVE-2012-2390](/security/CVE-2012-2390))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 10.04

* [linux-image-2.6.32-42-386](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-powerpc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-generic-pae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-sparc64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-versatile](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-server](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-ia64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-sparc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-preempt](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)
* [linux-image-2.6.32-42-lpia](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-42.95](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-42.95)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2012-2136](/security/CVE-2012-2136)
* [CVE-2012-2390](/security/CVE-2012-2390)

## Related notices

* [USN-1531-1](/security/notices/USN-1531-1)
* [USN-1533-1](/security/notices/USN-1533-1)
* [USN-1539-1](/security/notices/USN-1539-1)
* [USN-1529-1](/security/notices/USN-1529-1)
* [USN-1534-1](/security/notices/USN-1534-1)
* [USN-1514-1](/security/notices/USN-1514-1)
* [USN-1598-1](/security/notices/USN-1598-1)
* [USN-1532-1](/security/notices/USN-1532-1)
* [USN-1538-1](/security/notices/USN-1538-1)
* [USN-1530-1](/security/notices/USN-1530-1)
* [USN-1515-1](/security/notices/USN-1515-1)
* [USN-1508-1](/security/notices/USN-1508-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugzilla.redhat.com_52055bd4_20250126_100804.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D824345)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D824345)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D824345)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 824345

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 824345**](show_bug.cgi?id=824345)
(CVE-2012-2390)
- [CVE-2012-2390](https://access.redhat.com/security/cve/CVE-2012-2390) kernel: huge pages: memory leak on mmap failure

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-2390 kernel: huge pages: memory leak on mmap failure

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-2390 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [824350](show_bug.cgi?id=824350) [824351](show_bug.cgi?id=824351) [824352](show_bug.cgi?id=824352 "CLOSED ERRATA - CVE-2012-2390 kernel: huge pages: memory leak on mmap failure [fedora-all]") [824353](show_bug.cgi?id=824353) [824354](show_bug.cgi?id=824354) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [824358](show_bug.cgi?id=824358) | | TreeView+ | [depends on](buglist.cgi?bug_id=824345&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=824345&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-05-23 10:18 UTC by Petr Matousek | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-23 14:44 UTC ([History](show_activity.cgi?id=824345)) | | [CC List:](page.cgi?id=fields.html#cclist) | 15 users (show)  anton arozansk bhu dhoward fhrbata jackkim jkacur kernel-mgr lgoncalv lwang mmilgram mrg-program-list security-response-team sforsber williams | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2013-08-24 12:45:29 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2012:1150](https://access.redhat.com/errata/RHSA-2012%3A1150) | 0 | normal | SHIPPED\_LIVE | Moderate: kernel-rt security and bug fix update | 2012-08-08 20:31:44 UTC | | Red Hat Product Errata | [RHSA-2012:1304](https://access.redhat.com/errata/RHSA-2012%3A1304) | 0 | normal | SHIPPED\_LIVE | Moderate: kernel security and bug fix update | 2012-09-25 22:58:04 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=824345#c0)  Petr Matousek    2012-05-23 10:18:19 UTC  ``` Description of problem: When called for anonymous (non-shared) mappings, hugetlb_reserve_pages() does a resv_map_alloc().  It depends on code in hugetlbfs's vm_ops->close() to release that allocation.  However, in the mmap() failure path, we do a plain unmap_region() without the remove_vma() which actually calls vm_ops->close().   An unprivileged local user could use this flaw to crash the system.  References: <http://www.spinics.net/lists/linux-mm/msg34763.html>  Proposed upstream fix: <https://lkml.org/lkml/2012/5/21/385>   ```  [Comment 3](show_bug.cgi?id=824345#c3)  Petr Matousek    2012-05-23 10:24:08 UTC  ``` Created kernel tracking bugs for this issue  Affects: fedora-all [[bug 824352](show_bug.cgi?id=824352 "CLOSED ERRATA - CVE-2012-2390 kernel: huge pages: memory leak on mmap failure [fedora-all]")]   ```  [Comment 4](show_bug.cgi?id=824345#c4)  Kurt Seifried    2012-05-23 18:05:10 UTC  ``` Added CVE as per <http://www.openwall.com/lists/oss-security/2012/05/23/14>   ```  [Comment 5](show_bug.cgi?id=824345#c5)  Petr Matousek    2012-05-30 11:01:45 UTC  ``` Upstream commits:  c50ac050811d6485616a193eb0f37bfbd191cc89  4523e1458566a0e8ecfaff90f380dd23acc44d27   ```  [Comment 9](show_bug.cgi?id=824345#c9)  Fedora Update System    2012-06-07 02:33:21 UTC  ``` kernel-3.4.0-1.fc17 has been pushed to the Fedora 17 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 10](show_bug.cgi?id=824345#c10)  Fedora Update System    2012-06-13 21:30:08 UTC  ``` kernel-3.3.8-1.fc16 has been pushed to the Fedora 16 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 11](show_bug.cgi?id=824345#c11)  Fedora Update System    2012-06-22 08:37:59 UTC  ``` kernel-2.6.43.8-1.fc15 has been pushed to the Fedora 15 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 12](show_bug.cgi?id=824345#c12)  Petr Matousek    2012-07-04 05:30:12 UTC  ``` Statement:  This issue did not affect the versions of the Linux kernel as shipped with Red Hat Enterprise Linux 5 as they did not include the upstream commit 84afd99b that introduced this issue. Future kernel updates for Red Hat Enterprise Linux 6 may address this issue.  This has been addressed in Red Hat Enterprise Linux Red Hat Enterprise MRG 2 via <https://rhn.redhat.com/errata/RHSA-2012-1150.html>   ```  [Comment 13](show_bug.cgi?id=824345#c13)  errata-xmlrpc    2012-08-08 16:35:17 UTC  ``` This issue has been addressed in following products:    MRG for RHEL-6 v.2  Via RHSA-2012:1150 <https://rhn.redhat.com/errata/RHSA-2012-1150.html>   ```  [Comment 14](show_bug.cgi?id=824345#c14)  errata-xmlrpc    2012-09-25 18:59:58 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2012:1304 <https://rhn.redhat.com/errata/RHSA-2012-1304.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=824345&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.kernel.org_cb6c3803_20250125_160216.html ===
commit 1f5547c7f183363eabe07e5d202a49f2e94e995a
Author: Greg Kroah-Hartman
Date: Sun Jun 10 00:36:33 2012 +0900
Linux 3.4.2
commit 6ab997e0b5440eee1bc76bb9d83aa86e3966adb2
Author: Tao Ma
Date: Thu Jun 7 19:04:19 2012 -0400
ext4: don't set i\_flags in EXT4\_IOC\_SETFLAGS
commit b22b1f178f6799278d3178d894f37facb2085765 upstream.
Commit 7990696 uses the ext4\_{set,clear}\_inode\_flags() functions to
change the i\_flags automatically but fails to remove the error setting
of i\_flags. So we still have the problem of trashing state flags.
Fix this by removing the assignment.
Signed-off-by: Tao Ma
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit dadce2efa18e448bb42678efdc72a819bceaa9b7
Author: maximilian attems
Date: Wed May 16 09:46:30 2012 +0200
IA64: Add cmpxchg.h to exported userspace headers
commit 98e4cff73a18af27f0d40d0b0d37f105dfc1994a upstream.
Fixes klibc build on ia64 after 85f8f7759e418c814ee2ceacf73eddb9bed39492.
Cc: Paul Gortmaker
Signed-off-by: maximilian attems
Signed-off-by: Tony Luck
Cc: Ben Hutchings
Signed-off-by: Greg Kroah-Hartman
commit 9b660f3019d6fe55be99d85bacf28fe74fb14c1c
Author: Daniel Vetter
Date: Sun May 20 17:14:50 2012 +0200
drm/i915: enable vdd when switching off the eDP panel
commit 6cb49835da0426f69a2931bc2a0a8156344b0e41 upstream.
We have one bug report from a validation team that we get the eDP
panel sequencing still somewhat wrong: We need to enable VDD while
switching off the panel and backlight. Unfortunately that reporter
seems to have fallen off the earth :(
For another reporter this actually fixes a black panel issue because
without this the backlight/panel gets confused and doesn't light up
again.
v2: I've forgotten to remove the vdd\_off call in panel\_off which is
now bogus. This essentially reverts
commit 17038de5f16569a25343cf68668f3b657eafb00e
Author: Chris Wilson
Date: Mon Apr 16 22:43:42 2012 +0100
drm/i915/dp: Flush any outstanding work to turn the VDD off
v3: the current panel\_off code forces off the vdd power, too. Which is
bogus and resulted in some funny warnings later on when we've tried to
do aux channel communications with just the vdd forced on. Fix this,
too.
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=46312
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=43163
Tested-by: Vincent Frentzel
Reviewed-by: Jesse Barnes
Signed-Off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit 546230dfa483f6d1f188d1a1a20122ecabf82816
Author: Chris Wilson
Date: Mon Apr 16 22:43:42 2012 +0100
drm/i915/dp: Flush any outstanding work to turn the VDD off
commit 17038de5f16569a25343cf68668f3b657eafb00e upstream.
As we may kick off a delayed workqueue task to switch of the VDD lines, we
need to complete that task prior to turning off the panel (which itself
depends upon VDD being off).
v2: Don't cancel the outstanding work as this may trigger a deadlock
Signed-off-by: Chris Wilson
Cc: Keith Packard
Signed-off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit b522dbf26fe08158348773c36dbf88e8147dcc66
Author: Jesse Barnes
Date: Tue May 22 09:30:33 2012 -0700
drm/i915: always use RPNSWREQ for turbo change requests
commit 89ba829e38bd500f438bc08af4229204c8ed7f35 upstream.
Media turbo requests can either use RPVSWREQ or RPNSWREQ to indicate
what the interrupt handler should do. Since we only deal with the
latter in our turbo code, make the media engine use that for turbo
requests.
Tested-by: Joe Bloggsian
Signed-off-by: Jesse Barnes
Reviewed-by: Eugeni Dodonov
Signed-off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit ee9c8a04666ba15762f736f9030e6e8df02ca1a5
Author: Grazvydas Ignotas
Date: Fri May 18 03:04:08 2012 +0300
wl1251: fix oops on early interrupt
commit f380f2c4a12e913356bd49f8790ec1063c4fe9f8 upstream.
This driver disables interrupt just after requesting it and enables it
later, after interface is up. However currently there is a time window
between request\_irq() and disable\_irq() where if interrupt arrives, the
driver oopses because it's not yet ready to process it. This can be
reproduced by inserting the module, associating and removing the module
multiple times.
Eliminate this race by setting IRQF\_NOAUTOEN flag before request\_irq().
Signed-off-by: Grazvydas Ignotas
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 584b886aee3aff5fe7eb21e30f779eb5cd1daa36
Author: NeilBrown
Date: Thu May 31 15:39:11 2012 +1000
md: raid1/raid10: fix problem with merge\_bvec\_fn
commit aba336bd1d46d6b0404b06f6915ed76150739057 upstream.
The new merge\_bvec\_fn which calls the corresponding function
in subsidiary devices requires that mddev->merge\_check\_needed
be set if any child has a merge\_bvec\_fn.
However were were only setting that when a device was hot-added,
not when a device was present from the start.
This bug was introduced in 3.4 so patch is suitable for 3.4.y
kernels. However that are conflicts in raid10.c so a separate
patch will be needed for 3.4.y.
Reported-by: Sebastian Riemer
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit cf9ab4c62be7837c2f007cd51ab3604ca0620070
Author: Linus Torvalds
Date: Mon Jun 4 11:00:45 2012 -0700
vfs: Fix /proc//fdinfo/ file handling
commit 0640113be25d283e0ff77a9f041e1242182387f0 upstream.
Cyrill Gorcunov reports that I broke the fdinfo files with commit
30a08bf2d31d ("proc: move fd symlink i\_mode calculations into
tid\_fd\_revalidate()"), and he's quite right.
The tid\_fd\_revalidate() function is not just used for the /fd
symlinks, it's also used for the /fdinfo/ files, and the
permission model for those are different.
So do the dynamic symlink permission handling just for symlinks, making
the fdinfo files once more appear as the proper regular files they are.
Of course, Al Viro argued (probably correctly) that we shouldn't do the
symlink permission games at all, and make the symlinks always just be
the normal 'lrwxrwxrwx'. That would have avoided this issue too, but
since somebody noticed that the permissions had changed (which was the
reason for that original commit 30a08bf2d31d in the first place), people
do apparently use this feature.
[ Basically, you can use the symlink permission data as a cheap "fdinfo"
replacement, since you see whether the file is open for reading and/or
writing by just looking at st\_mode of the symlink. So the feature
does make sense, even if the pain it has caused means we probably
shouldn't have done it to begin with. ]
Reported-and-tested-by: Cyrill Gorcunov
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit cd08f77d07306f1294a78f13de5f55348c21df5b
Author: Andy Whitcroft
Date: Thu May 3 14:48:26 2012 +0100
ACPI battery: only refresh the sysfs files when pertinent information changes
commit c5971456964290da7e98222892797b71ef793e62 upstream.
We only need to regenerate the sysfs files when the capacity units
change, avoid the update otherwise.
The origin of this issue is dates way back to 2.6.38:
da8aeb92d4853f37e281f11fddf61f9c7d84c3cd
(ACPI / Battery: Update information on info notification and resume)
Signed-off-by: Andy Whitcroft
Tested-by: Ralf Jung
Signed-off-by: Len Brown
Signed-off-by: Greg Kroah-Hartman
commit 3e743873ed23bed0ab24ed33a92d960887ccfafa
Author: Joerg Roedel
Date: Fri Jun 1 15:20:23 2012 +0200
iommu/amd: Fix deadlock in ppr-handling error path
commit eee53537c476c947bf7faa1c916d2f5a0ae8ec93 upstream.
In the error path of the ppr\_notifer it can happen that the
iommu->lock is taken recursivly. This patch fixes the
problem by releasing the iommu->lock before any notifier is
invoked. This also requires to move the erratum workaround
for the ppr-log (interrupt may be faster than data in the log)
one function up.
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 98e69566e80c4de231456dbf4e6735ddfeb599db
Author: Joerg Roedel
Date: Thu May 31 17:38:11 2012 +0200
iommu/amd: Cache pdev pointer to root-bridge
commit c1bf94ec1e12d76838ad485158aecf208ebd8fb9 upstream.
At some point pci\_get\_bus\_and\_slot started to enable
interrupts. Since this function is used in the
amd\_iommu\_resume path it will enable interrupts on resume
which causes a warning. The fix will use a cached pointer
to the root-bridge to re-enable the IOMMU in case the BIOS
is broken.
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit fab83a044aa7d4b968f466f4eb3946388528497a
Author: Alex Deucher
Date: Tue Jun 5 09:50:31 2012 -0400
drm/radeon/kms: add new SI PCI ids
commit 7aaa61b3476462b69f1ac7669fcca8d608ce3cb5 upstream.
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit b1840525b3af198ada9f60fc25c980e97e189933
Author: Alex Deucher
Date: Tue Jun 5 09:50:30 2012 -0400
drm/radeon/kms: add new BTC PCI ids
commit a2bef8ce826dd1e787fd8ad9b6e0566ba59dab43 upstream.
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 36fbcdf64a3c15a8a98adb5ea018ce1913215e25
Author: Alex Deucher
Date: Tue Jun 5 09:50:29 2012 -0400
drm/radeon/kms: add new Palm, Sumo PCI ids
commit 4a6991cc1fad514745b79181df3ace72d561e7aa upstream.
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit d16ba207028eac4f38b908507d731ca894a91744
Author: Alex Deucher
Date: Tue Jun 5 09:50:28 2012 -0400
drm/radeon/kms: add new Trinity PCI ids
commit d430f7dbf7bd6aaaa40c0660b3204df8cf07b22b upstream.
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit ce58755a4fe65790a2e80559e0c585ba610b5f62
Author: Christian König
Date: Sun Jun 3 16:09:43 2012 +0200
drm/radeon: fix vm deadlocks on cayman
commit bb4091558228ff4a3e02328c931e683fc7f08722 upstream.
Locking mutex in different orders just screams for
deadlocks, and some testing showed that it is actually
quite easy to trigger them.
Signed-off-by: Christian König
Reviewed-by: Jerome Glisse
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 346327670c51ea6741eee95874fbcca4ff69c383
Author: Rafał Miłecki
Date: Mon Jun 4 18:36:58 2012 +0200
drm/radeon/audio: don't hardcode CRTC id
commit 0aecb5a4ba1ea4167f31d1790eec027f1e658f2d upstream.
This is based on info released by AMD, should allow using audio in much
more cases.
Signed-off-by: Rafał Miłecki
Reviewed-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit b642cb6a143da812f188307c2661c0357776a9d0
Author: Konstantin Khlebnikov
Date: Tue Jun 5 21:36:33 2012 +0400
radix-tree: fix contiguous iterator
commit fffaee365fded09f9ebf2db19066065fa54323c3 upstream.
This patch fixes bug in macro radix\_tree\_for\_each\_contig().
If radix\_tree\_next\_slot() sees NULL in next slot it returns NULL, but following
radix\_tree\_next\_chunk() switches iterating into next chunk. As result iterating
becomes non-contiguous and breaks vfs "splice" and all its users.
Signed-off-by: Konstantin Khlebnikov
Reported-and-bisected-by: Hans de Bruin
Reported-and-bisected-by: Ondrej Zary
Reported-bisected-and-tested-by: Toralf Förster
Link: https://lkml.org/lkml/2012/6/5/64
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f940c5366eaaea9630ba643a036c2df321f66db3
Author: Salman Qazi
Date: Thu May 31 23:52:14 2012 -0400
ext4: remove mb\_groups before tearing down the buddy\_cache
commit 95599968d19db175829fb580baa6b68939b320fb upstream.
We can't have references held on pages in the s\_buddy\_cache while we are
trying to truncate its pages and put the inode. All the pages must be
gone before we reach clear\_inode. This can only be gauranteed if we
can prevent new users from grabbing references to s\_buddy\_cache's pages.
The original bug can be reproduced and the bug fix can be verified by:
while true; do mount -t ext4 /dev/ram0 /export/hda3/ram0; \
umount /export/hda3/ram0; done &
while true; do cat /proc/fs/ext4/ram0/mb\_groups; done
Signed-off-by: Salman Qazi
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit d2e926777a97fc29ebfa409584ed4e790f2e68bf
Author: Salman Qazi
Date: Thu May 31 23:51:27 2012 -0400
ext4: add ext4\_mb\_unload\_buddy in the error path
commit 02b7831019ea4e7994968c84b5826fa8b248ffc8 upstream.
ext4\_free\_blocks fails to pair an ext4\_mb\_load\_buddy with a matching
ext4\_mb\_unload\_buddy when it fails a memory allocation.
Signed-off-by: Salman Qazi
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 5720f8de251bbf23fc9f4191d6ed5734110b7d67
Author: Theodore Ts'o
Date: Thu May 31 23:46:01 2012 -0400
ext4: don't trash state flags in EXT4\_IOC\_SETFLAGS
commit 79906964a187c405db72a3abc60eb9b50d804fbc upstream.
In commit 353eb83c we removed i\_state\_flags with 64-bit longs, But
when handling the EXT4\_IOC\_SETFLAGS ioctl, we replace i\_flags
directly, which trashes the state flags which are stored in the high
32-bits of i\_flags on 64-bit platforms. So use the the
ext4\_{set,clear}\_inode\_flags() functions which use atomic bit
manipulation functions instead.
Reported-by: Tao Ma
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit d7286a55eb1088df8f8d8c1bde34e0342c63804c
Author: Theodore Ts'o
Date: Wed May 30 23:00:16 2012 -0400
ext4: add missing save\_error\_info() to ext4\_error()
commit f3fc0210c0fc91900766c995f089c39170e68305 upstream.
The ext4\_error() function is missing a call to save\_error\_info().
Since this is the function which marks the file system as containing
an error, this oversight (which was introduced in 2.6.36) is quite
significant, and should be backported to older stable kernels with
high urgency.
Reported-by: Ken Sumrall
Signed-off-by: "Theodore Ts'o"
Cc: ksumrall@google.com
Signed-off-by: Greg Kroah-Hartman
commit c40a4bd1e80db2b3af7b064b6eece0e689be60a9
Author: Andreas Dilger
Date: Mon May 28 17:02:25 2012 -0400
ext4: disallow hard-linked directory in ext4\_lookup
commit 7e936b737211e6b54e34b71a827e56b872e958d8 upstream.
A hard-linked directory to its parent can cause the VFS to deadlock,
and is a sign of a corrupted file system. So detect this case in
ext4\_lookup(), before the rmdir() lockup scenario can take place.
Signed-off-by: Andreas Dilger
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit a9ea4481033197d29c606a935b24336a96cb3082
Author: Haogang Chen
Date: Mon May 28 14:21:55 2012 -0400
ext4: fix potential integer overflow in alloc\_flex\_gd()
commit 967ac8af4475ce45474800709b12137aa7634c77 upstream.
In alloc\_flex\_gd(), when flexbg\_size is large, kmalloc size would
overflow and flex\_gd->groups would point to a buffer smaller than
expected, causing OOB accesses when it is used.
Note that in ext4\_resize\_fs(), flexbg\_size is calculated using
sbi->s\_log\_groups\_per\_flex, which is read from the disk and only bounded
to [1, 31]. The patch returns NULL for too large flexbg\_size.
Reviewed-by: Eric Sandeen
Signed-off-by: Haogang Chen
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 3c7f096206323ae4c9ad3db62fece0b19df21532
Author: Eric Sandeen
Date: Mon May 28 14:17:25 2012 -0400
ext4: force ro mount if ext4\_setup\_super() fails
commit 7e84b6216467b84cd332c8e567bf5aa113fd2f38 upstream.
If ext4\_setup\_super() fails i.e. due to a too-high revision,
the error is logged in dmesg but the fs is not mounted RO as
indicated.
Tested by:
# mkfs.ext4 -r 4 /dev/sdb6
# mount /dev/sdb6 /mnt/test
# dmesg | grep "too high"
[164919.759248] EXT4-fs (sdb6): revision level too high, forcing read-only mode
# grep sdb6 /proc/mounts
/dev/sdb6 /mnt/test2 ext4 rw,seclabel,relatime,data=ordered 0 0
Reviewed-by: Andreas Dilger
Signed-off-by: Eric Sandeen
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 2c693b1d2fd1789a8b52f3644d41547b1ba9a26e
Author: Dan Carpenter
Date: Mon May 28 14:16:57 2012 -0400
ext4: fix potential NULL dereference in ext4\_free\_inodes\_counts()
commit bb3d132a24cd8bf5e7773b2d9f9baa58b07a7dae upstream.
The ext4\_get\_group\_desc() function returns NULL on error, and
ext4\_free\_inodes\_count() function dereferences it without checking.
There is a check on the next line, but it's too late.
Reviewed-by: Jan Kara
Signed-off-by: Dan Carpenter
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 978041f2a946a4616f7cdb60f6d453ffa83298c1
Author: Benjamin Poirier
Date: Thu May 24 11:32:38 2012 +0000
xfrm: take net hdr len into account for esp payload size calculation
[ Upstream commit 91657eafb64b4cb53ec3a2fbc4afc3497f735788 ]
Corrects the function that determines the esp payload size. The calculations
done in esp{4,6}\_get\_mtu() lead to overlength frames in transport mode for
certain mtu values and suboptimal frames for others.
According to what is done, mainly in esp{,6}\_output() and tcp\_mtu\_to\_mss(),
net\_header\_len must be taken into account before doing the alignment
calculation.
Signed-off-by: Benjamin Poirier
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 010589e2bce841733dc989fd56c5c3aba41a759c
Author: Felix Fietkau
Date: Tue May 29 03:35:08 2012 +0000
skb: avoid unnecessary reallocations in \_\_skb\_cow
[ Upstream commit 617c8c11236716dcbda877e764b7bf37c6fd8063 ]
At the beginning of \_\_skb\_cow, headroom gets set to a minimum of
NET\_SKB\_PAD. This causes unnecessary reallocations if the buffer was not
cloned and the headroom is just below NET\_SKB\_PAD, but still more than the
amount requested by the caller.
This was showing up frequently in my tests on VLAN tx, where
vlan\_insert\_tag calls skb\_cow\_head(skb, VLAN\_HLEN).
Locally generated packets should have enough headroom, and for forward
paths, we already have NET\_SKB\_PAD bytes of headroom, so we don't need to
add any extra space here.
Signed-off-by: Felix Fietkau
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ea1ae37f4a2c41ea684f2e725332147eb6496026
Author: James Chapman
Date: Tue May 29 23:13:23 2012 +0000
l2tp: fix oops in L2TP IP sockets for connect() AF\_UNSPEC case
[ Upstream commit c51ce49735c183ef2592db70f918ee698716276b ]
An application may call connect() to disconnect a socket using an
address with family AF\_UNSPEC. The L2TP IP sockets were not handling
this case when the socket is not bound and an attempt to connect()
using AF\_UNSPEC in such cases would result in an oops. This patch
addresses the problem by protecting the sk\_prot->disconnect() call
against trying to unhash the socket before it is bound.
The patch also adds more checks that the sockaddr supplied to bind()
and connect() calls is valid.
RIP: 0010:[] [] inet\_unhash+0x50/0xd0
RSP: 0018:ffff88001989be28 EFLAGS: 00010293
Stack:
ffff8800407a8000 0000000000000000 ffff88001989be78 ffffffff82e3a249
ffffffff82e3a050 ffff88001989bec8 ffff88001989be88 ffff8800407a8000
0000000000000010 ffff88001989bec8 ffff88001989bea8 ffffffff82e42639
Call Trace:
[] udp\_disconnect+0x1f9/0x290
[] inet\_dgram\_connect+0x29/0x80
[] sys\_connect+0x9c/0x100
Reported-by: Sasha Levin
Signed-off-by: James Chapman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit be078c8003469b75aa9119254c163b2961321744
Author: Gao feng
Date: Sat May 26 01:30:53 2012 +0000
ipv6: fix incorrect ipsec fragment
[ Upstream commit 0c1833797a5a6ec23ea9261d979aa18078720b74 ]
Since commit ad0081e43a
"ipv6: Fragment locally generated tunnel-mode IPSec6 packets as needed"
the fragment of packets is incorrect.
because tunnel mode needs IPsec headers and trailer for all fragments,
while on transport mode it is sufficient to add the headers to the
first fragment and the trailer to the last.
so modify mtu and maxfraglen base on ipsec mode and if fragment is first
or last.
with my test,it work well(every fragment's size is the mtu)
and does not trigger slow fragment path.
Changes from v1:
though optimization, mtu\_prev and maxfraglen\_prev can be delete.
replace xfrm mode codes with dst\_entry's new frag DST\_XFRM\_TUNNEL.
add fuction ip6\_append\_data\_mtu to make codes clearer.
Signed-off-by: Gao feng
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 86a2569c810dff80fc7ba16dd77bc2697c28317a
Author: Yanmin Zhang
Date: Wed May 23 15:39:45 2012 +0000
ipv4: fix the rcu race between free\_fib\_info and ip\_route\_output\_slow
[ Upstream commit e49cc0da7283088c5e03d475ffe2fdcb24a6d5b1 ]
We hit a kernel OOPS.
<3>[23898.789643] BUG: sleeping function called from invalid context at
/data/buildbot/workdir/ics/hardware/intel/linux-2.6/arch/x86/mm/fault.c:1103
<3>[23898.862215] in\_atomic(): 0, irqs\_disabled(): 0, pid: 10526, name:
Thread-6683
<4>[23898.967805] HSU serial 0000:00:05.1: 0000:00:05.2:HSU serial prevented me
to suspend...
<4>[23899.258526] Pid: 10526, comm: Thread-6683 Tainted: G W
3.0.8-137685-ge7742f9 #1
<4>[23899.357404] HSU serial 0000:00:05.1: 0000:00:05.2:HSU serial prevented me
to suspend...
<4>[23899.904225] Call Trace:
<4>[23899.989209] [] ? pgtable\_bad+0x130/0x130
<4>[23900.000416] [] \_\_might\_sleep+0x10a/0x110
<4>[23900.007357] [] do\_page\_fault+0xd1/0x3c0
<4>[23900.013764] [] ? restore\_all+0xf/0xf
<4>[23900.024024] [] ? napi\_complete+0x8b/0x690
<4>[23900.029297] [] ? pgtable\_bad+0x130/0x130
<4>[23900.123739] [] ? pgtable\_bad+0x130/0x130
<4>[23900.128955] [] error\_code+0x5f/0x64
<4>[23900.133466] [] ? pgtable\_bad+0x130/0x130
<4>[23900.138450] [] ? \_\_ip\_route\_output\_key+0x698/0x7c0
<4>[23900.144312] [] ? \_\_ip\_route\_output\_key+0x38d/0x7c0
<4>[23900.150730] [] ip\_route\_output\_flow+0x1f/0x60
<4>[23900.156261] [] ip4\_datagram\_connect+0x188/0x2b0
<4>[23900.161960] [] ? \_raw\_spin\_unlock\_bh+0x1f/0x30
<4>[23900.167834] [] inet\_dgram\_connect+0x36/0x80
<4>[23900.173224] [] ? \_copy\_from\_user+0x48/0x140
<4>[23900.178817] [] sys\_connect+0x9a/0xd0
<4>[23900.183538] [] ? alloc\_file+0xdc/0x240
<4>[23900.189111] [] ? sub\_preempt\_count+0x3d/0x50
Function free\_fib\_info resets nexthop\_nh->nh\_dev to NULL before releasing
fi. Other cpu might be accessing fi. Fixing it by delaying the releasing.
With the patch, we ran MTBF testing on Android mobile for 12 hours
and didn't trigger the issue.
Thank Eric for very detailed review/checking the issue.
Signed-off-by: Yanmin Zhang
Signed-off-by: Kun Jiang
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 630ec1481b8aa0f6f66d521f04feacd74bfc19f5
Author: Eric Dumazet
Date: Mon May 28 22:31:41 2012 +0000
asix: allow full size 8021Q frames to be received
[ Upstream commit 9dae31009b1a00d926c6fe032d5a88099620adc3 ]
asix driver drops 8021Q full size frames because it doesn't take into
account VLAN header size.
Tested on AX88772 adapter.
Signed-off-by: Eric Dumazet
CC: Greg Kroah-Hartman
CC: Allan Chou
CC: Trond Wuellner
CC: Grant Grundler
CC: Paul Stewart
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7e9f6a5a90c6c261247fbd9dbd38bf6f78779af6
Author: Thomas Hellstrom
Date: Fri Jun 1 15:48:04 2012 +0200
drm/vmwgfx: Fix nasty write past alloced memory area
commit 0824db38e515644f8d1bfd64adbd7cb2c6ea7c62 upstream.
Signed-off-by: Thomas Hellstrom
Reviewed-by: Jakob Bornecrantz
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 71a47b9b18398fb55ab48865c0886a5b0ded6253
Author: Thomas Hellstrom
Date: Fri Jun 1 15:39:11 2012 +0200
drm/ttm: Fix spinlock imbalance
commit a8ff3ee211fccf708e1911bbc096625453ebf759 upstream.
This imbalance may cause hangs when TTM is trying to swap out a buffer
that is already on the delayed delete list.
Signed-off-by: Thomas Hellstrom
Reviewed-by: Jakob Bornecrantz
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 888e4b9df23905c6e29e6f26727349c3a81da844
Author: Jerome Glisse
Date: Thu May 31 19:00:24 2012 -0400
drm/radeon: fix HD6790, HD6570 backend programming
commit 95c4b23ec4e2fa5604df229ddf134e31d7b3b378 upstream.
Without this bit sets we get broken rendering and
lockups.
fglrx sets this bit.
Bugs that should be fixed by this patch :
https://bugs.freedesktop.org/show\_bug.cgi?id=49792
https://bugzilla.kernel.org/show\_bug.cgi?id=43207
https://bugs.freedesktop.org/show\_bug.cgi?id=39282
Signed-off-by: Jerome Glisse
Acked-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit fe3777aab674403f6da7f168b28b5ef5d369e426
Author: Alex Deucher
Date: Thu May 31 18:54:43 2012 -0400
drm/radeon: properly program gart on rv740, juniper, cypress, barts, hemlock
commit 0b8c30bc4943137a4a36b9cb059b1cc684f5d702 upstream.
Need to program an additional VM register. This doesn't not currently
cause any problems, but allows us to program the proper backend
map in a subsequent patch which should improve performance on these
asics.
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit d8d09befb4156f23d50a607c75e99dd06e8bccf8
Author: Alex Deucher
Date: Thu May 31 18:53:36 2012 -0400
drm/radeon: fix bank information in tiling config
commit 29d654067a98c1cb8874c774e5fd799a038af8a6 upstream.
While there are cards with more than 8 mem banks, the max
number of banks from a tiling perspective is 8, so cap
the tiling config at 8 banks.
Fixes:
https://bugs.freedesktop.org/show\_bug.cgi?id=43448
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 44920b1991d9182bc3ff8f90df71b0e5311448dc
Author: Alex Deucher
Date: Wed May 30 10:09:30 2012 -0400
drm/radeon: fix regression in UMS CS ioctl
commit 9b00147d9f2ba137ce74b66b768a8312be0b6781 upstream.
radeon\_cs\_parser\_init is called by both the legacy UMS
CS ioctl and the KMS CS ioctl. Protect KMS specific
pieces of the code by checking that rdev is not NULL.
Reported-by: Michael Burian
Signed-off-by: Alex Deucher
Reviewed-by: Jerome Glisse
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 1e98ce80a4493f32b44f227d6050318462ca9d5d
Author: Sascha Hauer
Date: Fri May 25 16:22:42 2012 +0200
mtd: mxc\_nand: move ecc strengh setup before nand\_scan\_tail
commit 4a43faf54e9173b6acce37cf7f053fc9515a2cdf upstream.
Since commit 6a918bade9dab40aaef80559bd1169c69e8d69cb, the mxc\_nand driver
fails with:
Driver must set ecc.strength when using hardware ECC
This is because nand\_scan\_tail checks for correct ecc strength
settings, so we must set them up before nand\_scan\_tail.
Signed-off-by: Sascha Hauer
Signed-off-by: Artem Bityutskiy
Signed-off-by: David Woodhouse
Signed-off-by: Greg Kroah-Hartman
commit 29924c0318327d0444e0317587faf4a0693527a8
Author: Gabor Juhos
Date: Thu May 24 00:17:23 2012 +0200
mtd: block2mtd: fix recursive call of mtd\_writev
commit 2e24e32e2759348c9290404abad4f729f791bfad upstream.
The 'mtd\_writev' interface calls the function assigned
to the '\_write' field of a given mtd device if that is
not NULL. The block2mtd driver sets the '\_writev' field
to the 'mtd\_writev' function itself and thus causes a
endless loop.
This is caused by 1dbebd32562b3c2caeca35960e5cb00bfcc12900
(mtd: harmonize mtd\_writev usage).
Remove the assignment from the block2mtd driver to fix the
issue.
Signed-off-by: Gabor Juhos
Signed-off-by: Artem Bityutskiy
Signed-off-by: David Woodhouse
Signed-off-by: Greg Kroah-Hartman
commit bdcefb1987edb1c62828d6c79f93e4b7af8734e2
Author: Frank Svendsboe
Date: Thu May 17 22:43:09 2012 +0200
mtd: of\_parts: fix breakage in Kconfig
commit 2e929d001e85126d9267de373d4b76014789661d upstream.
MTD\_OF\_PARTS and the default setting is not working due to using 'Y'
instead of 'y', introduced in commit
d6137badeff1ef64b4e0092ec249ebdeaeb3ff37. This made our board, and
possibly other boards using DTS defined partitions and not having
CONFIG\_MTD\_OF\_PARTS=y defined in the defconfig, fail to mount root.
Signed-off-by: Frank Svendsboe
Signed-off-by: Artem Bityutskiy
Signed-off-by: David Woodhouse
Signed-off-by: Greg Kroah-Hartman
commit a5b57cd820528f863d519ac5a0f6a94e5e8b3a0e
Author: Dmitry Maluka
Date: Fri May 11 20:51:51 2012 +0300
mtd: nand: fix scan\_read\_raw\_oob
commit 34a5704d91d6f8376a4c0a0143a1dd3eb3ccb37e upstream.
It seems there is a bug in scan\_read\_raw\_oob() in nand\_bbt.c which
should cause wrong functioning of NAND\_BBT\_SCANALLPAGES option.
Artem: the patch did not apply and I had to amend it a bit.
Signed-off-by: Artem Bityutskiy
Signed-off-by: Greg Kroah-Hartman
commit d961b4e3f741d32fb5fe96fe1123c96a3025a1db
Author: Steven Rostedt
Date: Wed May 30 11:43:19 2012 -0400
x86: Reset the debug\_stack update counter
commit c0525a6972d3f1fb83058ef503e183475d6e4e26 upstream.
When an NMI goes off and it sees that it preempted the debug stack,
to keep the debug stack safe, it changes the IDT to point to one that
does not modify the stack on breakpoint (to allow breakpoints in NMIs).
But the variable that gets set to know to undo it on exit never gets
cleared on exit. Thus every NMI will reset it on exit the first time
it is done even if it does not need to be reset.
[ Added H. Peter Anvin's suggestion to use this\_cpu\_read/write ]
Signed-off-by: Steven Rostedt
Signed-off-by: Greg Kroah-Hartman
commit cdd5479bf6cfbaf84308beda5b76037dbea471b1
Author: H.J. Lu
Date: Mon May 21 20:29:45 2012 -0700
x86, x32, ptrace: Remove PTRACE\_ARCH\_PRCTL for x32
commit bad1a753d4d4deb09d4bc0bac1dd4fc3298502e9 upstream.
When I added x32 ptrace to 3.4 kernel, I also include PTRACE\_ARCH\_PRCTL
support for x32 GDB For ARCH\_GET\_FS/GS, it takes a pointer to int64. But
at user level, ARCH\_GET\_FS/GS takes a pointer to int32. So I have to add
x32 ptrace to glibc to handle it with a temporary int64 passed to kernel and
copy it back to GDB as int32. Roland suggested that PTRACE\_ARCH\_PRCTL
is obsolete and x32 GDB should use fs\_base and gs\_base fields of
user\_regs\_struct instead.
Accordingly, remove PTRACE\_ARCH\_PRCTL completely from the x32 code to
avoid possible memory overrun when pointer to int32 is passed to
kernel.
Link: http://lkml.kernel.org/r/CAMe9rOpDzHfS7NH7m1vmD9QRw8SSj4Sc%2BaNOgcWm\_WJME2eRsQ@mail.gmail.com
Signed-off-by: H. Peter Anvin
Signed-off-by: Greg Kroah-Hartman
commit fd62fa971584007e612be6e531101842de97715a
Author: Stephan Gatzka
Date: Sat Jun 2 03:04:06 2012 +0000
fec\_mpc52xx: fix timestamp filtering
commit 9ca3cc6f3026946ba655e863ca2096339e667639 upstream.
skb\_defer\_rx\_timestamp was called with a freshly allocated skb but must
be called with rskb instead.
Signed-off-by: Stephan Gatzka
Acked-by: Richard Cochran
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c8c0b91569f01d7713c843245c538b51f733646a
Author: Dmitry Kasatkin
Date: Tue May 29 11:02:21 2012 -0700
vfs: increment iversion when a file is truncated
commit 799243a389bde0de10fa21ca1ca453d2fe538b85 upstream.
When a file is truncated with truncate()/ftruncate() and then closed,
iversion is not updated. This patch uses ATTR\_SIZE flag as an indication
to increment iversion.
Mimi said:
On fput(), i\_version is used to detect and flag files that have changed
and need to be re-measured in the IMA measurement policy. When a file
is truncated with truncate()/ftruncate() and then closed, i\_version is
not updated. As a result, although the file has changed, it will not be
re-measured and added to the IMA measurement list on subsequent access.
Signed-off-by: Dmitry Kasatkin
Acked-by: Mimi Zohar
Cc: Al Viro
Signed-off-by: Andrew Morton
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 15de0eade174f9aade57a4080f1bac1a36e45e83
Author: Al Viro
Date: Tue May 29 22:03:48 2012 -0400
vfs: umount\_tree() might be called on subtree that had never made it
commit 63d37a84ab6004c235314ffd7a76c5eb28c2fae0 upstream.
\_\_mnt\_make\_shortterm() in there undoes the effect of \_\_mnt\_make\_longterm()
we'd done back when we set ->mnt\_ns non-NULL; it should not be done to
vfsmounts that had never gone through commit\_tree() and friends. Kudos to
lczerner for catching that one...
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 75df3ae2060eb00b909ac65fc4d2798c4e53969a
Author: Joonsoo Kim
Date: Thu May 17 00:13:02 2012 +0900
slub: fix a memory leak in get\_partial\_node()
commit 02d7633fa567be7bf55a993b79d2a31b95ce2227 upstream.
In the case which is below,
1. acquire slab for cpu partial list
2. free object to it by remote cpu
3. page->freelist = t
then memory leak is occurred.
Change acquire\_slab() not to zap freelist when it works for cpu partial list.
I think it is a sufficient solution for fixing a memory leak.
Below is output of 'slabinfo -r kmalloc-256'
when './perf stat -r 30 hackbench 50 process 4000 > /dev/null' is done.
\*\*\*Vanilla\*\*\*
Sizes (bytes) Slabs Debug Memory
------------------------------------------------------------------------
Object : 256 Total : 468 Sanity Checks : Off Total: 3833856
SlabObj: 256 Full : 111 Redzoning : Off Used : 2004992
SlabSiz: 8192 Partial: 302 Poisoning : Off Loss : 1828864
Loss : 0 CpuSlab: 55 Tracking : Off Lalig: 0
Align : 8 Objects: 32 Tracing : Off Lpadd: 0
\*\*\*Patched\*\*\*
Sizes (bytes) Slabs Debug Memory
------------------------------------------------------------------------
Object : 256 Total : 300 Sanity Checks : Off Total: 2457600
SlabObj: 256 Full : 204 Redzoning : Off Used : 2348800
SlabSiz: 8192 Partial: 33 Poisoning : Off Loss : 108800
Loss : 0 CpuSlab: 63 Tracking : Off Lalig: 0
Align : 8 Objects: 32 Tracing : Off Lpadd: 0
Total and loss number is the impact of this patch.
Acked-by: Christoph Lameter
Signed-off-by: Joonsoo Kim
Signed-off-by: Pekka Enberg
Signed-off-by: Greg Kroah-Hartman
commit 22aca500eb55daf5c84bffb001d3cce14da08b08
Author: Clemens Ladisch
Date: Fri May 18 18:00:43 2012 +0200
ALSA: usb-audio: fix rate\_list memory leak
commit 5cd5d7c44990658df6ab49f6253c39617c53b03d upstream.
The array of sample rates is reallocated every time when opening
the PCM device, but was freed only once when unplugging the device.
Reported-by: "Alexander E. Patrakov"
Signed-off-by: Clemens Ladisch
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 58f9c9764228f69ef523dcf5f87d5b587464fb52
Author: Dave Hansen
Date: Wed May 30 07:51:07 2012 -0700
mm: fix vma\_resv\_map() NULL pointer
commit 4523e1458566a0e8ecfaff90f380dd23acc44d27 upstream.
hugetlb\_reserve\_pages() can be used for either normal file-backed
hugetlbfs mappings, or MAP\_HUGETLB. In the MAP\_HUGETLB, semi-anonymous
mode, there is not a VMA around. The new call to resv\_map\_put() assumed
that there was, and resulted in a NULL pointer dereference:
BUG: unable to handle kernel NULL pointer dereference at 0000000000000030
IP: vma\_resv\_map+0x9/0x30
PGD 141453067 PUD 1421e1067 PMD 0
Oops: 0000 [#1] PREEMPT SMP
...
Pid: 14006, comm: trinity-child6 Not tainted 3.4.0+ #36
RIP: vma\_resv\_map+0x9/0x30
...
Process trinity-child6 (pid: 14006, threadinfo ffff8801414e0000, task ffff8801414f26b0)
Call Trace:
resv\_map\_put+0xe/0x40
hugetlb\_reserve\_pages+0xa6/0x1d0
hugetlb\_file\_setup+0x102/0x2c0
newseg+0x115/0x360
ipcget+0x1ce/0x310
sys\_shmget+0x5a/0x60
system\_call\_fastpath+0x16/0x1b
This was reported by Dave Jones, but was reproducible with the
libhugetlbfs test cases, so shame on me for not running them in the
first place.
With this, the oops is gone, and the output of libhugetlbfs's
run\_tests.py is identical to plain 3.4 again.
[ Marked for stable, since this was introduced by commit c50ac050811d
("hugetlb: fix resv\_map leak in error path") which was also marked for
stable ]
Reported-by: Dave Jones
Cc: Mel Gorman
Cc: KOSAKI Motohiro
Cc: Christoph Lameter
Cc: Andrea Arcangeli
Cc: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 08c372db1aa0a65e0b2135e8556be35e1175f9b9
Author: Ulrich Drepper
Date: Tue May 29 15:06:30 2012 -0700
kbuild: install kernel-page-flags.h
commit 9295b7a07c859a42346221b5839be0ae612333b0 upstream.
Programs using /proc/kpageflags need to know about the various flags. The
 provides them and the comments in the file
indicate that it is supposed to be used by user-level code. But the file
is not installed.
Install the headers and mark the unstable flags as out-of-bounds. The
page-type tool is also adjusted to not duplicate the definitions
Signed-off-by: Ulrich Drepper
Acked-by: KOSAKI Motohiro
Acked-by: Fengguang Wu
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit e552a3bfe0c60c65d35cc3ee6a5f20d9702ebc9a
Author: Jan-Benedict Glaw
Date: Tue May 22 15:21:53 2012 +0200
drm/i915: no lvds quirk for HP t5740e Thin Client
commit 3347111999870c37eab1b969e90af9fdaf0334ba upstream.
This box has DisplayPort and VGA, but no LVDS. Product specs are at
http://h10010.www1.hp.com/wwpc/us/en/sm/WF25a/12454-12454-321959-338927-3640406-4282707.html?dnr=1
and dmidecode output can be found at http://www.getslash.de/bug\_attachments/dmidecode-t5740e.txt
Signed-off-by: Jan-Benedict Glaw
Signed-off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit 46790988c91cc239152996c9ed4b4c3dcd2703d8
Author: Daniel Vetter
Date: Tue May 22 21:41:25 2012 +0200
drm/i915: wait for a vblank to pass after tv detect
commit bf2125e2f7e931b50a6c76ba0435ba001409ccbf upstream.
Otherwise the hw will get confused and result in a black screen.
This regression has been most likely introduce in
commit 974b93315b2213b74a42a87e8a9d4fc8c0dbe90c
Author: Chris Wilson
Date: Sun Sep 5 00:44:20 2010 +0100
drm/i915/tv: Poll for DAC state change
That commit replace the first msleep(20) with a busy-loop, but failed
to keep the 2nd msleep around. Later on we've replaced all these
msleep(20) by proper vblanks.
For reference also see the commit in xf86-video-intel:
commit 1142be53eb8d2ee8a9b60ace5d49f0ba27332275
Author: Jesse Barnes
Date: Mon Jun 9 08:52:59 2008 -0700
Fix TV programming: add vblank wait after TV\_CTL writes
Fxies FDO bug #14000; we need to wait for vblank after
writing TV\_CTL or following "DPMS on" calls may not actually enable the output.
v2: As suggested by Chris Wilson, add a small comment to ensure that
no one accidentally removes this vblank wait again - there really
seems to be no sane explanation for why we need it, but it is
required.
Launchpad: https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/763688
Reported-and-Tested-by: Robert Lowery
Cc: Rodrigo Vivi
Acked-by: Chris Wilson
Signed-Off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit 3baa3206a209b224d1265665d6f969fdbd99c08d
Author: Rodrigo Vivi
Date: Tue May 22 15:23:24 2012 -0300
drm/i915: Adding TV Out Missing modes.
commit 9589919fb3d269d4202a112b197468c7db1f97a3 upstream.
These 2 modes were removed by mistake during a clean up.
So, now it is time to add them back. For further info about
supported mode and standard timing table please check:
VOL\_3\_display\_registers\_updated.pdf at intellinuxgraphics.org.
Note that this regression has been introduce in
commit 55a6713b3f30a5024056027e9dbf03ac8f13bfc9
Author: Rodrigo Vivi
Date: Thu Dec 15 14:47:33 2011 -0200
drm/i915: Removing TV Out modes.
and this commit partially reverts it by re-adding the wrongly removed
modes.
Reported-by: Robert Lowery
Signed-off-by: Rodrigo Vivi
[danvet: Pimped commit message to cite the commit that introduced this
regression.]
Signed-off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit ae6bfcca08d692defdbde53e36963752211b6c03
Author: Daniel Vetter
Date: Sat May 12 22:22:58 2012 +0200
drm/i915: properly handle interlaced bit for sdvo dtd conversion
commit 59d92bfa5f0cdf57f82f5181b0ad6af75c3fdf41 upstream.
We've simply ignored this, which isn't too great. With this, interlaced
1080i works on my HDMI screen connected through sdvo. For no apparent
reason anything else still doesn't work as it should.
While at it, give these magic numbers in the dtd proper names and
add a comment that they match with EDID detailed timings.
v2: Actually use the right bit for interlaced.
Tested-by: Peter Ross
Reviewed-by: Paulo Zanoni
Signed-Off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit 772605e73b1f07be3736cc3fc0bc0ce0c56db773
Author: Alex Deucher
Date: Thu May 24 22:55:15 2012 -0400
drm/radeon: fix typo in trinity tiling setup
commit 1f73cca799d29df80de3e8f1f1c488485467577a upstream.
Using the wrong union.
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 70838c4536517458c38249763311ff56727cd293
Author: Alex Deucher
Date: Wed May 23 11:48:59 2012 -0400
drm/radeon: fix XFX quirk
commit 1ebf169ad4dc68f18cc0dab35163b0f324fc6c41 upstream.
Only override the ddc bus if the connector doesn't have
a valid one. The existing code overrode the ddc bus for
all connectors even if it had ddc bus.
Fixes ddc on another XFX card with the same pci ids that
was broken by the quirk overwriting the correct ddc bus.
Reported-by: Mehdi Aqadjani Memar
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit c2fcf3a04bc4c9a9b97962b3b71c86ba393672e3
Author: Joerg Roedel
Date: Thu Apr 12 14:12:00 2012 +0200
iommu/amd: Add workaround for event log erratum
commit 3d06fca8d2aa3543030e40b95f1d62f9f5a03540 upstream.
Due to a recent erratum it can happen that the head pointer
of the event-log is updated before the actual event-log
entry is written. This patch implements the recommended
workaround.
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit f9a07f3089169d943ba0e61e7670e61199020870
Author: Joerg Roedel
Date: Thu Apr 12 12:49:26 2012 +0200
iommu/amd: Check for the right TLP prefix bit
commit a3b93121430c7b46c2895a7744261be107ccdf7f upstream.
Unfortunatly the PRI spec changed and moved the
TLP-prefix-required bit to a different location. This patch
makes the necessary change in the AMD IOMMU driver.
Regressions are not expected because all hardware
implementing the PRI capability sets this bit to zero
anyway.
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit c7faf5bbaeba30053627de3b333d3c17e051ba80
Author: Trond Myklebust
Date: Sat May 19 12:12:53 2012 -0400
sunrpc: fix loss of task->tk\_status after rpc\_delay call in xprt\_alloc\_slot
commit 1afeaf5c29aa07db25760d2fbed5c08a3aec3498 upstream.
xprt\_alloc\_slot will call rpc\_delay() to make the task wait a bit before
retrying when it gets back an -ENOMEM error from xprt\_dynamic\_alloc\_slot.
The problem is that rpc\_delay will clear the task->tk\_status, causing
call\_reserveresult to abort the task.
The solution is simply to let call\_reserveresult handle the ENOMEM error
directly.
Reported-by: Jeff Layton
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 7a0786dcc32e5d16721449d43cfb90d7869d08ea
Author: Dave Hansen
Date: Tue May 29 15:06:46 2012 -0700
hugetlb: fix resv\_map leak in error path
commit c50ac050811d6485616a193eb0f37bfbd191cc89 upstream.
When called for anonymous (non-shared) mappings, hugetlb\_reserve\_pages()
does a resv\_map\_alloc(). It depends on code in hugetlbfs's
vm\_ops->close() to release that allocation.
However, in the mmap() failure path, we do a plain unmap\_region() without
the remove\_vma() which actually calls vm\_ops->close().
This is a decent fix. This leak could get reintroduced if new code (say,
after hugetlb\_reserve\_pages() in hugetlbfs\_file\_mmap()) decides to return
an error. But, I think it would have to unroll the reservation anyway.
Christoph's test case:
http://marc.info/?l=linux-mm&m=133728900729735
This patch applies to 3.4 and later. A version for earlier kernels is at
https://lkml.org/lkml/2012/5/22/418.
Signed-off-by: Dave Hansen
Acked-by: Mel Gorman
Acked-by: KOSAKI Motohiro
Reported-by: Christoph Lameter
Tested-by: Christoph Lameter
Cc: Andrea Arcangeli
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 27b0a5338ea769a35f1c8346cd07a3c938c919e7
Author: Trond Myklebust
Date: Mon May 28 11:36:28 2012 -0400
NFSv4: Map NFS4ERR\_SHARE\_DENIED into an EACCES error instead of EIO
commit fb13bfa7e1bcfdcfdece47c24b62f1a1cad957e9 upstream.
If a file OPEN is denied due to a share lock, the resulting
NFS4ERR\_SHARE\_DENIED is currently mapped to the default EIO.
This patch adds a more appropriate mapping, and brings Linux
into line with what Solaris 10 does.
See https://bugzilla.kernel.org/show\_bug.cgi?id=43286
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit c780682d113ef97164359897f4463585b4c27524
Author: Dan Carpenter
Date: Mon May 14 22:45:28 2012 +0300
NFS: kmalloc() doesn't return an ERR\_PTR()
commit 5abc03cd919535c61b813f2319cb38326a41e810 upstream.
Obviously we should check for NULL here instead of IS\_ERR().
Signed-off-by: Dan Carpenter
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 2b06dfb55b78e57734a696324ce7d593b1c084be
Author: Konrad Rzeszutek Wilk
Date: Wed May 30 18:23:56 2012 -0400
x86, amd, xen: Avoid NULL pointer paravirt references
commit 1ab46fd319bcf1fcd9fb6311727d532b580e4eba upstream.
Stub out MSR methods that aren't actually needed. This fixes a crash
as Xen Dom0 on AMD Trinity systems. A bigger patch should be added to
remove the paravirt machinery completely for the methods which
apparently have no users!
Reported-by: Andre Przywara
Link: http://lkml.kernel.org/r/20120530222356.GA28417@andromeda.dapyr.net
Signed-off-by: H. Peter Anvin
Signed-off-by: Greg Kroah-Hartman
commit c163f56463e26f771e3dc7e67921f268053ad8e6
Author: Felix Fietkau
Date: Thu May 24 14:32:20 2012 +0200
ath9k: fix a use-after-free-bug when ath\_tx\_setup\_buffer() fails
commit 81357a281dcc454841532c46b30e6f2ba12b73ea upstream.
ath\_tx\_setup\_buffer() can fail if there is no ath\_buf left, or if mapping DMA
failed. In this case it frees the skb passed to it.
If ath\_tx\_setup\_buffer is called from ath\_tx\_form\_aggr, the skb is still
linked into the tid buffer list and must be dequeued before being released.
Signed-off-by: Felix Fietkau
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 27e73d90ba0c26397eaeed7119553e77ae5bb486
Author: Richard Cochran
Date: Wed May 23 18:19:51 2012 +0200
ixp4xx: fix compilation by adding gpiolib support
commit 9dde0ae3769875ec1370cb316e50c54b57d52c1a upstream.
Once again, ixp4xx no longer even compiles. This patch fixes the issue
by converting over to gpiolib. This patch was first made by Imre and
posted by Marc, and I added in Russell's suggestion to empty the gpio
header file.
This fix should also go for 3.1, 3.2, 3.3, and 3.4.
Signed-off-by: Richard Cochran
Signed-off-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit 74b31d2a64a49ce8dbf8620eba0a116a892d4d0b
Author: Eyal Shapira
Date: Tue May 29 02:00:22 2012 -0700
mac80211: fix ADDBA declined after suspend with wowlan
commit 7b21aea04d084916ac4e0e8852dcc9cd60ec0d1d upstream.
WLAN\_STA\_BLOCK\_BA is set while suspending but doesn't get cleared
when resuming in case of wowlan. This causes further ADDBA requests
received to be rejected. Fix it by clearing it in the wowlan path
as well.
Signed-off-by: Eyal Shapira
Reviewed-by: Johannes Berg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 6ea90b39f492460884b218ffe066210f129771fb
Author: Jonas Gorski
Date: Tue May 15 17:47:52 2012 +0200
MIPS: BCM63XX: Add missing include for bcm63xx\_gpio.h
commit 442209f31dafef9fde852858e1ce566b675b720d upstream.
bcm63xx\_gpio.h uses macros defined in bcm63xx\_cpu.h without including it,
leading to the following build failure:
CC [M] drivers/mmc/core/cd-gpio.o
In file included from arch/mips/include/asm/mach-bcm63xx/gpio.h:4:0,
from arch/mips/include/asm/gpio.h:4,
from include/linux/gpio.h:30,
from drivers/mmc/core/cd-gpio.c:12:
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h: In function 'bcm63xx\_gpio\_count':
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:10:2: error: implicit declaration of function 'bcm63xx\_get\_cpu\_id'
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:11:7: error: 'BCM6358\_CPU\_ID' undeclared (first use in this function)
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:11:7: note: each undeclared identifier is reported only once for each function it appears in
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:13:7: error: 'BCM6338\_CPU\_ID' undeclared (first use in this function)
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:15:7: error: 'BCM6345\_CPU\_ID' undeclared (first use in this function)
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:17:7: error: 'BCM6368\_CPU\_ID' undeclared (first use in this function)
arch/mips/include/asm/mach-bcm63xx/bcm63xx\_gpio.h:19:7: error: 'BCM6348\_CPU\_ID' undeclared (first use in this function)
make[7]: \*\*\* [drivers/mmc/core/cd-gpio.o] Error 1
Signed-off-by: Jonas Gorski
Cc: linux-mips@linux-mips.org
Cc: Maxime Bizon
Cc: Florian Fainelli
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit c6fb8b4e362693c4d4864de46607c558852a570a
Author: David Woodhouse
Date: Thu May 24 04:58:27 2012 +0000
solos-pci: Fix DMA support
commit b4bd8ad9bb311e8536f726f7a633620ccd358cde upstream.
DMA support has finally made its way to the top of the TODO list, having
realised that a Geode using MMIO can't keep up with two ADSL2+ lines
each running at 21Mb/s.
This patch fixes a couple of bugs in the DMA support in the driver, so
once the corresponding FPGA update is complete and tested everything
should work properly.
We weren't storing the currently-transmitting skb, so we were never
unmapping it and never freeing/popping it when the TX was done.
And the addition of pci\_set\_master() is fairly self-explanatory.
Signed-off-by: David Woodhouse
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit dab0a045b4ff1689617a0fdbd4e8060770effa58
Author: James Bottomley
Date: Mon May 21 07:49:01 2012 +0100
PARISC: fix TLB fault path on PA2.0 narrow systems
commit 2f649c1f6f0fef445ce79a19b79e5ce8fe9d7f19 upstream.
commit 5e185581d7c46ddd33cd9c01106d1fc86efb9376
Author: James Bottomley
[PARISC] fix PA1.1 oops on boot
Didn't quite fix the crash on boot. It moved it from PA1.1 processors to
PA2.0 narrow kernels. The final fix is to make sure the [id]tlb\_miss\_20 paths
also work. Even on narrow systems, these paths require using the wide
instructions becuase the tlb insertion format is wide. Fix this by
conditioning the dep[wd],z on whether we're being called from \_11 or \_20[w]
paths.
Tested-by: Helge Deller
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit e01b7f872913f583b5c043b99c8f5af2eb44d051
Author: John David Anglin
Date: Thu May 17 10:34:34 2012 -0400
PARISC: fix boot failure on 32-bit systems caused by branch stubs placed before .text
commit ed5fb2471b7060767957fb964eb1aaec71533ab1 upstream.
In certain configurations, the resulting kernel becomes too large to boot
because the linker places the long branch stubs for the merged .text section
at the very start of the image. As a result, the initial transfer of control
jumps to an unexpected location. Fix this by placing the head text in a
separate section so the stubs for .text are not at the start of the image.
Signed-off-by: John David Anglin
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 27ab30eb965b9d26c5811f5505d95c8ede08c580
Author: Shirish Pargaonkar
Date: Mon May 21 09:20:12 2012 -0500
cifs: fix oops while traversing open file list (try #4)
commit 2c0c2a08bed7a3b791f88d09d16ace56acb3dd98 upstream.
While traversing the linked list of open file handles, if the identfied
file handle is invalid, a reopen is attempted and if it fails, we
resume traversing where we stopped and cifs can oops while accessing
invalid next element, for list might have changed.
So mark the invalid file handle and attempt reopen if no
valid file handle is found in rest of the list.
If reopen fails, move the invalid file handle to the end of the list
and start traversing the list again from the begining.
Repeat this four times before giving up and returning an error if
file reopen keeps failing.
Signed-off-by: Shirish Pargaonkar
Reviewed-by: Jeff Layton
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 444b7bce3152cc6ef1fb599331d053c9c40eb374
Author: Shirish Pargaonkar
Date: Tue May 15 10:19:16 2012 -0500
cifs: Include backup intent search flags during searches {try #2)
commit 2608bee744a92d60d15ff4e6e0b913d8b406aedd upstream.
As observed and suggested by Tushar Gosavi...
---------
readdir calls these function to send TRANS2\_FIND\_FIRST and
TRANS2\_FIND\_NEXT command to the server. The current cifs module is
not specifying CIFS\_SEARCH\_BACKUP\_SEARCH flag while sending these
command when backupuid/backupgid is specified. This can be resolved
by specifying CIFS\_SEARCH\_BACKUP\_SEARCH flag.
---------
Reported-and-Tested-by: Tushar Gosavi
Signed-off-by: Shirish Pargaonkar
Acked-by: Jeff Layton
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 784c9700444d2ebbace0a1d3a3ac48c3d5852164
Author: Meenakshi Venkataraman
Date: Wed May 16 22:35:59 2012 +0200
iwlwifi: do not use shadow registers by default
commit 66a770729a5cdd24efed8afa5258f81232d8bba2 upstream.
Shadow registers in the device are meant to
allow the driver to update certain device
registers without needing to wake up all
components of the device. However, using
this feature in the device causes
communication between the driver and the
device to become unreliable, resulting in
host command timeouts.
Disable this feature by default till a fix is
available for the bug.
Signed-off-by: Meenakshi Venkataraman
Signed-off-by: Johannes Berg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 75713d3f1b75e0054d47b258895225e152e638cb
Author: Meenakshi Venkataraman
Date: Wed May 16 22:35:57 2012 +0200
iwlwifi: update BT traffic load states correctly
commit 882dde8eb0d49ce0f853f8f4084dde56a21fe55f upstream.
When BT traffic load changes from its
previous state, a new LQ command needs to be
sent down to the firmware. This needs to
be done only once per change. The state
variable that keeps track of this change is
last\_bt\_traffic\_load. However, it was not
being updated when the change had been
handled. Not updating this variable was
causing a flood of advanced BT config
commands to be sent to the firmware. Fix
this.
Signed-off-by: Meenakshi Venkataraman
Signed-off-by: Wey-Yi Guy
Signed-off-by: Johannes Berg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit e42adb30f43ce5aa3f362c45328209f95bf9d519
Author: KyongHo
Date: Tue May 29 15:06:49 2012 -0700
mm: fix faulty initialization in vmalloc\_init()
commit dbda591d920b4c7692725b13e3f68ecb251e9080 upstream.
The transfer of ->flags causes some of the static mapping virtual
addresses to be prematurely freed (before the mapping is removed) because
VM\_LAZY\_FREE gets "set" if tmp->flags has VM\_IOREMAP set. This might
cause subsequent vmalloc/ioremap calls to fail because it might allocate
one of the freed virtual address ranges that aren't unmapped.
va->flags has different types of flags from tmp->flags. If a region with
VM\_IOREMAP set is registered with vm\_area\_add\_early(), it will be removed
by \_\_purge\_vmap\_area\_lazy().
Fix vmalloc\_init() to correctly initialize vmap\_area for the given
vm\_struct.
Also initialise va->vm. If it is not set, find\_vm\_area() for the early
vm regions will always fail.
Signed-off-by: KyongHo Cho
Cc: "Olav Haugan"
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 319b5641660fb09660c6faaaa99af9ddff973737
Author: Michal Hocko
Date: Tue May 29 15:06:45 2012 -0700
mm: consider all swapped back pages in used-once logic
commit e48982734ea0500d1eba4f9d96195acc5406cad6 upstream.
Commit 645747462435 ("vmscan: detect mapped file pages used only once")
made mapped pages have another round in inactive list because they might
be just short lived and so we could consider them again next time. This
heuristic helps to reduce pressure on the active list with a streaming
IO worklods.
This patch fixes a regression introduced by this commit for heavy shmem
based workloads because unlike Anon pages, which are excluded from this
heuristic because they are usually long lived, shmem pages are handled
as a regular page cache.
This doesn't work quite well, unfortunately, if the workload is mostly
backed by shmem (in memory database sitting on 80% of memory) with a
streaming IO in the background (backup - up to 20% of memory). Anon
inactive list is full of (dirty) shmem pages when watermarks are hit.
Shmem pages are kept in the inactive list (they are referenced) in the
first round and it is hard to reclaim anything else so we reach lower
scanning priorities very quickly which leads to an excessive swap out.
Let's fix this by excluding all swap backed pages (they tend to be long
lived wrt. the regular page cache anyway) from used-once heuristic and
rather activate them if they are referenced.
The customer's workload is shmem backed database (80% of RAM) and they
are measuring transactions/s with an IO in the background (20%).
Transactions touch more or less random rows in the table. The
transaction rate fell by a factor of 3 (in the worst case) because of
commit 64574746. This patch restores the previous numbers.
Signed-off-by: Michal Hocko
Acked-by: Johannes Weiner
Cc: Mel Gorman
Cc: Minchan Kim
Cc: KAMEZAWA Hiroyuki
Reviewed-by: Rik van Riel
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 3634d6fec1f80012110962d58dbd396aaa99d960
Author: Sasha Levin
Date: Tue May 29 15:06:15 2012 -0700
mm: fix NULL ptr deref when walking hugepages
commit 08fa29d916c6e271ad13978cd993e7238c68db97 upstream.
A missing validation of the value returned by find\_vma() could cause a
NULL ptr dereference when walking the pagetable.
This is triggerable from usermode by a simple user by trying to read a
page info out of /proc/pid/pagemap which doesn't exist.
Introduced by commit 025c5b2451e4 ("thp: optimize away unnecessary page
table locking").
Signed-off-by: Sasha Levin
Reviewed-by: Naoya Horiguchi
Cc: David Rientjes
Cc: Andi Kleen
Cc: Andrea Arcangeli
Cc: KOSAKI Motohiro
Cc: KAMEZAWA Hiroyuki
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 3876c722319d9b8463b9e82394d81f6d0c45021e
Author: Siddhesh Poyarekar
Date: Tue May 29 15:06:22 2012 -0700
mm/fork: fix overflow in vma length when copying mmap on clone
commit 7edc8b0ac16cbaed7cb4ea4c6b95ce98d2997e84 upstream.
The vma length in dup\_mmap is calculated and stored in a unsigned int,
which is insufficient and hence overflows for very large maps (beyond
16TB). The following program demonstrates this:
#include
#include
#include
#define GIG 1024 \* 1024 \* 1024L
#define EXTENT 16393
int main(void)
{
int i, r;
void \*m;
char buf[1024];
for (i = 0; i < EXTENT; i++) {
m = mmap(NULL, (size\_t) 1 \* 1024 \* 1024 \* 1024L,
PROT\_READ | PROT\_WRITE, MAP\_PRIVATE | MAP\_ANONYMOUS, 0, 0);
if (m == (void \*)-1)
printf("MMAP Failed: %d\n", m);
else
printf("%d : MMAP returned %p\n", i, m);
r = fork();
if (r == 0) {
printf("%d: successed\n", i);
return 0;
} else if (r < 0)
printf("FORK Failed: %d\n", r);
else if (r > 0)
wait(NULL);
}
return 0;
}
Increase the storage size of the result to unsigned long, which is
sufficient for storing the difference between addresses.
Signed-off-by: Siddhesh Poyarekar
Cc: Tejun Heo
Cc: Oleg Nesterov
Cc: Jens Axboe
Cc: Peter Zijlstra
Acked-by: Hugh Dickins
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 798a1aaef46a15208ff6974679ed63cc542feebd
Author: Jun'ichi Nomura
Date: Tue May 22 18:57:17 2012 +0900
SCSI: Fix dm-multipath starvation when scsi host is busy
commit b7e94a1686c5daef4f649f7f4f839cc294f07710 upstream.
block congestion control doesn't have any concept of fairness across
multiple queues. This means that if SCSI reports the host as busy in
the queue congestion control it can result in an unfair starvation
situation in dm-mp if there are multiple multipath devices on the same
host. For example:
http://www.redhat.com/archives/dm-devel/2012-May/msg00123.html
The fix for this is to report only the sdev busy state (and ignore the
host busy state) in the block congestion control call back.
The host is still congested, but the SCSI subsystem will sort out the
congestion in a fair way because it knows the relation between the
queues and the host.
[jejb: fixed up trailing whitespace]
Reported-by: Bernd Schubert
Tested-by: Bernd Schubert
Signed-off-by: Jun'ichi Nomura
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit e6157b97c60f1a9243a57563895a8eb81dbf3117
Author: James Bottomley
Date: Wed May 30 09:45:39 2012 +0000
SCSI: fix scsi\_wait\_scan
commit 1ff2f40305772b159a91c19590ee159d3a504afc upstream.
Commit c751085943362143f84346d274e0011419c84202
Author: Rafael J. Wysocki
Date: Sun Apr 12 20:06:56 2009 +0200
PM/Hibernate: Wait for SCSI devices scan to complete during resume
Broke the scsi\_wait\_scan module in 2.6.30. Apparently debian still uses it so
fix it and backport to stable before removing it in 3.6.
The breakage is caused because the function template in
include/scsi/scsi\_scan.h is defined to be a nop unless SCSI is built in.
That means that in the modular case (which is every distro), the
scsi\_wait\_scan module does a simple async\_synchronize\_full() instead of
waiting for scans.
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit c18577564bf53876695646432e34e2e86c69a4b8
Author: Lars-Peter Clausen
Date: Mon Apr 9 15:05:44 2012 +0200
microblaze: Do not select GENERIC\_GPIO by default
commit 59516b07b4ffa7e607a5787674ea3c405f1b390c upstream.
The microblaze architecture does not provide a native GPIO API implementation
nor requires GPIOLIB, but still selects GENERIC\_GPIO by default. As a result the
following build error occurs, if GPIOLIB is not selected:
include/asm-generic/gpio.h: In function 'gpio\_get\_value\_cansleep':
include/asm-generic/gpio.h:218: error: implicit declaration of function '\_\_gpio\_get\_value'
include/asm-generic/gpio.h: In function 'gpio\_set\_value\_cansleep':
include/asm-generic/gpio.h:224: error: implicit declaration of function '\_\_gpio\_set\_value'
This patch addresses the issue by not selecting GENERIC\_GPIO by default. This
causes the GPIO API to be stubbed out if no implementation is provided.
Signed-off-by: Lars-Peter Clausen
Tested-by: Michal Simek
Signed-off-by: Greg Kroah-Hartman
commit edb302ba464c6151ddb24ba4fb18c8e0a0ef9f7c
Author: Boaz Harrosh
Date: Wed May 16 14:22:21 2012 +0300
exofs: Fix CRASH on very early IO errors.
commit 6abe4a87f7bc7978705c386dbba0ca0c7790b3ec upstream.
If at exofs\_fill\_super() we had an early termination
do to any error, like an IO error while reading the
super-block. We would crash inside exofs\_free\_sbi().
This is because sbi->oc.numdevs was set to 1, before
we actually have a device table at all.
Fix it by moving the sbi->oc.numdevs = 1 to after the
allocation of the device table.
Reported-by: Johannes Schild
Signed-off-by: Boaz Harrosh
Signed-off-by: Greg Kroah-Hartman


=== Content from www.ubuntu.com_ac6a8a9c_20250125_160218.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1515-1: Linux kernel vulnerability

23 July 2012

The system could be made to crash under certain conditions.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel

## Details

An error was discovered in the Linux kernel's memory subsystem (hugetlb).

An unprivileged local user could exploit this flaw to cause a denial of

service (crash the system).

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [linux-image-3.2.0-27-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)
* [linux-image-3.2.0-27-generic-pae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)
* [linux-image-3.2.0-27-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)
* [linux-image-3.2.0-27-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)
* [linux-image-3.2.0-27-omap](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)
* [linux-image-3.2.0-27-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)
* [linux-image-3.2.0-27-highbank](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-27.43](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-27.43)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2012-2390](/security/CVE-2012-2390)

## Related notices

* [USN-1531-1](/security/notices/USN-1531-1)
* [USN-1533-1](/security/notices/USN-1533-1)
* [USN-1539-1](/security/notices/USN-1539-1)
* [USN-1535-1](/security/notices/USN-1535-1)
* [USN-1508-1](/security/notices/USN-1508-1)
* [USN-1534-1](/security/notices/USN-1534-1)
* [USN-1538-1](/security/notices/USN-1538-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from lkml.org_59fe06eb_20250126_100804.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2012]](/lkml/2012) Â  [[May]](/lkml/2012/5) Â  [[21]](/lkml/2012/5/21) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2012/5/21/385)Â  [[forward]](/lkml/bounce/2012/5/21/385)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2012/5/21/385) * [Dave Hansen](/lkml/2012/5/21/432)   + [KOSAKI Motohiro](/lkml/2012/5/21/432)   + [Andrew Morton](/lkml/2012/5/22/410)     - [Christoph Lameter](/lkml/2012/5/22/418)       * [Andrew Morton](/lkml/2012/5/22/421)  Patch in this message  * [Get diff 1](/lkml/diff/2012/5/21/385/1) | / | | | Subject | [PATCH] hugetlb: fix resv\_map leak in error path | | --- | --- | | From | Dave Hansen <> | | Date | Mon, 21 May 2012 13:28:14 -0700 | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` When called for anonymous (non-shared) mappings,hugetlb_reserve_pages() does a resv_map_alloc().  It depends oncode in hugetlbfs's vm_ops->close() to release that allocation.However, in the mmap() failure path, we do a plain unmap_region()without the remove_vma() which actually calls vm_ops->close().This is a decent fix.  This leak could get reintroduced ifnew code (say, after hugetlb_reserve_pages() inhugetlbfs_file_mmap()) decides to return an error.  But, I thinkit would have to unroll the reservation anyway.This hasn't been extensively tested.  Pretty much compile andboot tested along with Christoph's test case:	[http://marc.info/?l=linux-mm&m=133728900729735](https://marc.info/?l=linux-mm&m=133728900729735)Signed-off-by: Dave Hansen <dave@linux.vnet.ibm.com>Acked-by: Mel Gorman <mel@csn.ul.ie>ecked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>Reported/tested-by: Christoph Lameter <cl@linux.com>--- linux-2.6.git-dave/mm/hugetlb.c |   28 ++++++++++++++++++++++------ 1 file changed, 22 insertions(+), 6 deletions(-)diff -puN mm/hugetlb.c~hugetlb-fix-leak mm/hugetlb.c--- linux-2.6.git/mm/hugetlb.c~hugetlb-fix-leak	2012-05-21 13:24:38.369857759 -0700+++ linux-2.6.git-dave/mm/hugetlb.c	2012-05-21 13:24:38.377857849 -0700@@ -2157,6 +2157,15 @@ static void hugetlb_vm_op_open(struct vm 		kref_get(&reservations->refs); } +static void resv_map_put(struct vm_area_struct *vma)+{+	struct resv_map *reservations = vma_resv_map(vma);++	if (!reservations)+		return;+	kref_put(&reservations->refs, resv_map_release);+}+ static void hugetlb_vm_op_close(struct vm_area_struct *vma) { 	struct hstate *h = hstate_vma(vma);@@ -2173,7 +2182,7 @@ static void hugetlb_vm_op_close(struct v 		reserve = (end - start) - 			region_count(&reservations->regions, start, end); -		kref_put(&reservations->refs, resv_map_release);+		resv_map_put(vma);  		if (reserve) { 			hugetlb_acct_memory(h, -reserve);@@ -2990,12 +2999,16 @@ int hugetlb_reserve_pages(struct inode * 		set_vma_resv_flags(vma, HPAGE_RESV_OWNER); 	} -	if (chg < 0)-		return chg;+	if (chg < 0) {+		ret = chg;+		goto out_err;+	}  	/* There must be enough pages in the subpool for the mapping */-	if (hugepage_subpool_get_pages(spool, chg))-		return -ENOSPC;+	if (hugepage_subpool_get_pages(spool, chg)) {+		ret = -ENOSPC;+		goto out_err;+	}  	/* 	 * Check enough hugepages are available for the reservation.@@ -3004,7 +3017,7 @@ int hugetlb_reserve_pages(struct inode * 	ret = hugetlb_acct_memory(h, chg); 	if (ret < 0) { 		hugepage_subpool_put_pages(spool, chg);-		return ret;+		goto out_err; 	}  	/*@@ -3021,6 +3034,9 @@ int hugetlb_reserve_pages(struct inode * 	if (!vma || vma->vm_flags & VM_MAYSHARE) 		region_add(&inode->i_mapping->private_list, from, to); 	return 0;+out_err:+	resv_map_put(vma);+	return ret; }  void hugetlb_unreserve_pages(struct inode *inode, long offset, long freed)diff -puN Documentation/stable_kernel_rules.txt~hugetlb-fix-leak Documentation/stable_kernel_rules.txt_ ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2012-05-21 23:21 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |



=== Content from github.com_5e9ed1b6_20250125_160220.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc50ac050811d6485616a193eb0f37bfbd191cc89)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc50ac050811d6485616a193eb0f37bfbd191cc89)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/c50ac050811d6485616a193eb0f37bfbd191cc89)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

hugetlb: fix resv\_map leak in error path

[Browse files](/torvalds/linux/tree/c50ac050811d6485616a193eb0f37bfbd191cc89)
Browse the repository at this point in the history

```
When called for anonymous (non-shared) mappings, hugetlb_reserve_pages()
does a resv_map_alloc().  It depends on code in hugetlbfs's
vm_ops->close() to release that allocation.

However, in the mmap() failure path, we do a plain unmap_region() without
the remove_vma() which actually calls vm_ops->close().

This is a decent fix.  This leak could get reintroduced if new code (say,
after hugetlb_reserve_pages() in hugetlbfs_file_mmap()) decides to return
an error.  But, I think it would have to unroll the reservation anyway.

Christoph's test case:

	<http://marc.info/?l=linux-mm&m=133728900729735>

This patch applies to 3.4 and later.  A version for earlier kernels is at
<https://lkml.org/lkml/2012/5/22/418>.

Signed-off-by: Dave Hansen <dave@linux.vnet.ibm.com>
Acked-by: Mel Gorman <mel@csn.ul.ie>
Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
Reported-by: Christoph Lameter <cl@linux.com>
Tested-by: Christoph Lameter <cl@linux.com>
Cc: Andrea Arcangeli <aarcange@redhat.com>
Cc: <stable@vger.kernel.org>	[2.6.32+]
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
```

* Loading branch information

[![@torvalds](https://avatars.githubusercontent.com/u/1024025?s=40&v=4)](/torvalds)

Dave Hansen
authored and
[torvalds](/torvalds/linux/commits?author=torvalds "View all commits by torvalds")
committed
May 29, 2012

1 parent
[5c2b8a1](/torvalds/linux/commit/5c2b8a162b5f8616f709bf20d5ec88f709485522)

commit c50ac05

Showing
**1 changed file**
with
**22 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

28 changes: 22 additions & 6 deletions

28
[mm/hugetlb.c](#diff-fb6066ca63d9afdc2e3660c85e2dcc04cf31b37900ca9df2a1019ee8fa80dce0 "mm/hugetlb.c")

Show comments

[View file](/torvalds/linux/blob/c50ac050811d6485616a193eb0f37bfbd191cc89/mm/hugetlb.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2157,6 +2157,15 @@ static void hugetlb\_vm\_op\_open(struct vm\_area\_struct \*vma) |
|  |  | kref\_get(&reservations->refs); |
|  |  | } |
|  |  |  |
|  |  | static void resv\_map\_put(struct vm\_area\_struct \*vma) |
|  |  | { |
|  |  | struct resv\_map \*reservations = vma\_resv\_map(vma); |
|  |  |  |
|  |  | if (!reservations) |
|  |  | return; |
|  |  | kref\_put(&reservations->refs, resv\_map\_release); |
|  |  | } |
|  |  |  |
|  |  | static void hugetlb\_vm\_op\_close(struct vm\_area\_struct \*vma) |
|  |  | { |
|  |  | struct hstate \*h = hstate\_vma(vma); |
| Expand All | | @@ -2173,7 +2182,7 @@ static void hugetlb\_vm\_op\_close(struct vm\_area\_struct \*vma) |
|  |  | reserve = (end - start) - |
|  |  | region\_count(&reservations->regions, start, end); |
|  |  |  |
|  |  | kref\_put(&reservations->refs, resv\_map\_release); |
|  |  | resv\_map\_put(vma); |
|  |  |  |
|  |  | if (reserve) { |
|  |  | hugetlb\_acct\_memory(h, -reserve); |
| Expand Down  Expand Up | | @@ -2991,12 +3000,16 @@ int hugetlb\_reserve\_pages(struct inode \*inode, |
|  |  | set\_vma\_resv\_flags(vma, HPAGE\_RESV\_OWNER); |
|  |  | } |
|  |  |  |
|  |  | if (chg < 0) |
|  |  | return chg; |
|  |  | if (chg < 0) { |
|  |  | ret = chg; |
|  |  | goto out\_err; |
|  |  | } |
|  |  |  |
|  |  | /\* There must be enough pages in the subpool for the mapping \*/ |
|  |  | if (hugepage\_subpool\_get\_pages(spool, chg)) |
|  |  | return -ENOSPC; |
|  |  | if (hugepage\_subpool\_get\_pages(spool, chg)) { |
|  |  | ret = -ENOSPC; |
|  |  | goto out\_err; |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Check enough hugepages are available for the reservation. |
| Expand All | | @@ -3005,7 +3018,7 @@ int hugetlb\_reserve\_pages(struct inode \*inode, |
|  |  | ret = hugetlb\_acct\_memory(h, chg); |
|  |  | if (ret < 0) { |
|  |  | hugepage\_subpool\_put\_pages(spool, chg); |
|  |  | return ret; |
|  |  | goto out\_err; |
|  |  | } |
|  |  |  |
|  |  | /\* |
| Expand All | | @@ -3022,6 +3035,9 @@ int hugetlb\_reserve\_pages(struct inode \*inode, |
|  |  | if (!vma || vma->vm\_flags & VM\_MAYSHARE) |
|  |  | region\_add(&inode->i\_mapping->private\_list, from, to); |
|  |  | return 0; |
|  |  | out\_err: |
|  |  | resv\_map\_put(vma); |
|  |  | return ret; |
|  |  | } |
|  |  |  |
|  |  | void hugetlb\_unreserve\_pages(struct inode \*inode, long offset, long freed) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c50ac05`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc50ac050811d6485616a193eb0f37bfbd191cc89) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_f3401ad2_20250126_100805.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


