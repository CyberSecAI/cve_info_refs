=== Content from bugs.launchpad.net_544f86a4_20250126_103235.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1063480/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# Reflected XSS in user/group bulk CSV upload

Bug #1063480 reported by
[Hugh Davenport](https://launchpad.net/~hugh-davenport)
on 2012-10-08

[258](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | High | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.6.0](https://launchpad.net/mahara/%2Bmilestone/1.6.0) |
|  | [1.4](https://bugs.launchpad.net/mahara/1.4) | Fix Released | High | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.4.5](https://launchpad.net/mahara/%2Bmilestone/1.4.5) |
|  | [1.5](https://bugs.launchpad.net/mahara/1.5) | Fix Released | High | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.5.4](https://launchpad.net/mahara/%2Bmilestone/1.5.4) |

### Bug Description

Affects the bulk user upload, as well as the group and group member CSV uploads.

If the CSV header has unknown fields, these are displayed as an error with no sanatization. This is done through pieforms error

displaying. This means it may affect other areas where pieform errors are returned based on user data.

It affects versions atleast back to 1.2 with the bulk user upload.

Tags:

[security](/mahara/%2Bbugs?field.tag=security)

## CVE References

* [2012-2243](/bugs/cve/2012-2243 "Cross-site scripting (XSS) vulnerabil...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-10-09: |  |  | [#1](/mahara/%2Bbug/1063480/comments/1) |
| --- | --- | --- | --- |

* [bug-1063480.patch](https://bugs.launchpad.net/mahara/%2Bbug/1063480/%2Battachment/3391077/%2Bfiles/bug-1063480.patch)
  [Edit](/mahara/%2Bbug/1063480/%2Battachment/3391077)
  (2.4 KiB,
  text/plain)

| Changed in mahara: | |
| --- | --- |
| **status**: | Triaged â†’ Confirmed |
| **status**: | Confirmed â†’ In Progress |

[Melissa Draper (melissa)](https://launchpad.net/~melissa)
on 2012-10-10

| **visibility**: | private â†’ public |
| --- | --- |

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-10-23

| Changed in mahara: | |
| --- | --- |
| **status**: | In Progress â†’ Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-11-08: |  |  | [#2](/mahara/%2Bbug/1063480/comments/2) |
| --- | --- | --- | --- |

-----BEGIN PGP SIGNED MESSAGE-----

Hash: SHA1

status fixreleased

-----BEGIN PGP SIGNATURE-----

Version: GnuPG v1.4.12 (GNU/Linux)

Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iJwEAQECAAYFAlCbHO8ACgkQuMoJ2LQ3zxH8TAP/YN4BiCJZsn5a899/0UzV31Qg

lM8LXAwZWa6zFv6t0BQUHCqe6eFK9wPp51qgCWWXjUZ3vvvVcsyeWp6626aBFKSU

pCQXI9E7huPw802nJQ9WcZXRBUmgw87ww72Tx4mybnu7SPSrkZgXdnPGSMwDs89N

oWvTpl7Xuac48e6p0lU=

=ouU+

-----END PGP SIGNATURE-----

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
status fixreleased
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
iJwEAQECAAYFAlCbHO8ACgkQuMoJ2LQ3zxH8TAP/YN4BiCJZsn5a899/0UzV31Qg
lM8LXAwZWa6zFv6t0BQUHCqe6eFK9wPp51qgCWWXjUZ3vvvVcsyeWp6626aBFKSU
pCQXI9E7huPw802nJQ9WcZXRBUmgw87ww72Tx4mybnu7SPSrkZgXdnPGSMwDs89N
oWvTpl7Xuac48e6p0lU=
=ouU+
-----END PGP SIGNATURE-----

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1063480/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1063480/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1063480/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1063480/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1063480.patch](https://bugs.launchpad.net/mahara/%2Bbug/1063480/%2Battachment/3391077/%2Bfiles/bug-1063480.patch)
  [Edit](/mahara/%2Bbug/1063480/%2Battachment/3391077 "Change patch details")

* [Add patch](/mahara/%2Bbug/1063480/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
Â â€¢
[Take the tour](https://launchpad.net/%2Btour)
Â â€¢
[Read the guide](https://help.launchpad.net/)

Â© 2004
[CanonicalÂ Ltd.](http://canonical.com/)
Â â€¢
[Terms of use](https://launchpad.net/legal)
Â â€¢
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
Â â€¢
[Contact Launchpad Support](/feedback)
Â â€¢
[Blog](http://blog.launchpad.net/)
Â â€¢
[Careers](https://canonical.com/careers)
Â â€¢
[System status](https://ubuntu.social/%40launchpadstatus)
Â â€¢
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.debian.org_7f35fb66_20250125_171646.html ===


---

[[Date Prev](msg00234.html)][[Date Next](msg00236.html)]
[[Thread Prev](msg00234.html)][[Thread Next](msg00236.html)]
[[Date Index](maillist.html#00235)]
[[Thread Index](threads.html#00235)]

# [SECURITY] [DSA 2591-1] mahara security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 2591-1] mahara security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Fri, 28 Dec 2012 02:08:41 +0100
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20121228010841.GA18216%40pisco.westfalen.local)Â [20121228010841.GA18216@pisco.westfalen.local](msg00235.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- -------------------------------------------------------------------------
Debian Security Advisory DSA-2591-1                   security@debian.org
<http://www.debian.org/security/>                        Moritz Muehlenhoff
December 27, 2012                      <http://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : mahara
Vulnerability  : several
Problem type   : remote
Debian-specific: no
CVE ID         : CVE-2012-2239 CVE-2012-2243 CVE-2012-2244 CVE-2012-2246
                 CVE-2012-2247 CVE-2012-2253 CVE-2012-6037

Multiple security issues have been found in Mahara - an electronic
portfolio, weblog, and resume builder -, which can result in cross-site
scripting, clickjacking or arbitrary file execution.

For the stable distribution (squeeze), these problems have been fixed in
version 1.2.6-2+squeeze6.

For the unstable distribution (sid), these problems have been fixed in
version 1.5.1-3.1.

We recommend that you upgrade your mahara packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <http://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAlDc1IMACgkQXm3vHE4uylqMPgCg5dS6sguZrMHSYcBwOKfBL2N+
j2wAn36pxjwQBWzicqcDoQhMnxzZM+PZ
=6mgD
-----END PGP SIGNATURE-----

```

---



=== Content from mahara.org_71c1b0c0_20250125_171649.html ===

[Skip to main content](#header-main)

* [Login](https://mahara.org/?login)

Show search

SearchGo

[![Mahara ePortfolio System](https://mahara.org/theme/mahara-org/images/site-logo.svg?v=4171)](https://mahara.org/)
[![Mahara ePortfolio System](https://mahara.org/theme/raw/images/site-logo-small.svg?v=4171)](https://mahara.org/)
Show main menu

* [Home](https://mahara.org/)
* [Subscription](https://mahara.org/subscription)
* [Demo](https://mahara.org/demo)
* About

  + [About Mahara](https://mahara.org/about)
  + [About open source](https://mahara.org/about/opensource)
  + [Features](https://mahara.org/features)
  + [What is an ePortfolio?](https://mahara.org/about/eportfolios)
  + [Who is using Mahara?](https://mahara.org/showcase)
  + [News and announcements](https://mahara.org/news)
  + [Newsletter](https://mahara.org/newsletter)
  + [Podcast 'Create. Share. Engage.'](https://podcast.mahara.org)
* Community

  + [Community](https://mahara.org/community)
  + [Forums](https://mahara.org/forums)
  + [Mahara manual](https://mahara.org/documentation)
  + [Wiki](https://mahara.org/wiki)
  + [Bug / feature tracker](https://mahara.org/tracker)
  + [Release notes](https://mahara.org/releasenotes)
  + [Security](https://mahara.org/security)
  + [Contributors](https://mahara.org/community/contributors)
  + [Branding](https://mahara.org/branding)
  + [Events](https://mahara.org/events)
* Partners

  + [Partners](https://mahara.org/partners)
  + [Business Partners](https://mahara.org/business-partners)
  + [Supporters](https://mahara.org/supporters)

# Portfolios for your learning community

SearchGo

[Try out Mahara](http://demo.mahara.org/)

![Continuous single line drawing of a puhutukawa tree with a tui on the branches](https://mahara.org/theme/mahara-org/images/dashboard-tree-desktop-full.svg)

![Continuous single line drawing of a person working on a laptop](https://mahara.org/theme/mahara-org/images/dashboard-person-desktop.svg)

## Create portfolios

Using Mahara, students and staff create their personal learning stories by uploading evidence of activities they have participated in, and embedding publicly accessible content they have previously put online. They can write reflections on their experiences that frame this evidence, map it to competencies or registration requirements, and provide necessary context.

Mahara can be used for many different portfolio purposes, such as study, professional development, work-integrated learning, assessment, showcase and presentation, and employability.

[Learn about the portfolio options](https://mahara.org/view/view.php?id=137010)

## Share work

Mahara allows portfolios to be shared flexibly with one person, a specific group of people, or the entire world. Access can be further restricted to a particular time frame or just within an assessment task.

[Find out about sharing portfolios](https://mahara.org/view/view.php?id=137011)

![Continuous single line drawing of a paper plane in flight](https://mahara.org/theme/mahara-org/images/dashboard-paperplane-desktop.svg)

![Continuous single line drawing of a group of people sitting around a laptop in discussion](https://mahara.org/theme/mahara-org/images/dashboard-group-desktop.svg)

## Engage with others

Mahara makes it easy to comment and give feedback. Portfolios can also be submitted to learning management systems via LTI (Learning Tools Interoperability) for marking.

Groups in Mahara allow people to create portfolios collaboratively and engage in forum discussions.

[Learn about collaborating in Mahara](https://mahara.org/view/view.php?id=137012)

## Listen to portfolio stories

In our podcast 'Create. Share. Engage.' portfolio practitioners, researchers, learning designers, and portfolio authors share their journey. Learn how they navigate the many different facets of portfolios in general, and Mahara specifically.

[Listen on the podcast website or in your favourite app](https://podcast.mahara.org/)

![Continuous single line drawing of a speech bubble with the words 'Create. Share. Engage. Portfolios for learning and more'](https://mahara.org/theme/mahara-org/images/dashboard-podcast-desktop.svg)

![Continuous single line drawing of a speech bubble with the words 'Create. Share. Engage. Portfolios for learning and more'](https://mahara.org/theme/mahara-org/images/dashboard-podcast-logo.svg)

Mahara Community

* [About
  (tab)](https://mahara.org/group/mahara-community)
* [Members
  (tab)](https://mahara.org/group/members.php?id=1)
* [Forums
  (tab selected)](https://mahara.org/interaction/forum/index.php?group=1)
* [Portfolios
  (tab)](https://mahara.org/view/groupviews.php?group=1)

# Forums | Mahara Community

## [Security Announcements](https://mahara.org/interaction/forum/view.php?id=43) / Multiple Cross-site Scripting Vulnerabilities

---

This topic is closed. Only moderators and the group administrators can post new replies.

![anonymous profile picture](https://mahara.org/theme/raw/images/no_userphoto40.png)
Account deleted

Posts: 48

09 October 2012, 23:16

Multiple Cross-site Scripting Vulnerabilities

Category: Cross-site Scripting
Severity: Critical
Versions affected: < 1.4.5, < 1.5.4
Reported by: Mike Haworth, Ajay Singh Negi
Identifier: CVE-2012-2243
Bug report: [https://bugs.launchpad.net/mahara/+bug/1055232](https://bugs.launchpad.net/mahara/%2Bbug/1055232), [https://bugs.launchpad.net/mahara/+bug/1063480](https://bugs.launchpad.net/mahara/%2Bbug/1063480)

As part of the now endedÂ [Mahara Security Bug Bounty Program](https://wiki.mahara.org/index.php/Security#Mahara_Security_Bug_Bounty_Program "Mahara Security Bug Bounty Program"), several cross-site scripting vulnerabilities were discovered. The vulnerabilities have been fixed by the Mahara core developers.

Upgrading to Mahara 1.4.5 or 1.5.4 is strongly recommended.

Download links for fixed versions:
Â Â Â Â [https://launchpad.net/mahara/+milestone/1.4.5](https://launchpad.net/mahara/%2Bmilestone/1.4.5)
[https://launchpad.net/mahara/+milestone/1.5.4](https://launchpad.net/mahara/%2Bmilestone/1.5.4)

1 result

## Subscribe to our monthly newsletter

Do you want to stay updated on the latest news from Mahara and wider portfolio community? Subscribe to the monthly Mahara newsletter from Catalyst, the maintainers of Mahara.

[Sign up for the newsletter](https://zcu.nz/wpPM)

Create. Share. Engage.
[Try out Mahara](http://demo.mahara.org/)
[Support Mahara](https://mahara.org/subscription)

#### [Support](https://mahara.org/community)

* [Community forums](https://mahara.org/forums)
* [Mahara manual](https://mahara.org/documentation)
* [Wiki](https://mahara.org/wiki)
* [Bug / feature tracker](https://mahara.org/tracker)
* [Extended security support](https://mahara.org/extended-security-support)

#### [Get involved](https://mahara.org/community)

* [Community forums](https://mahara.org/forums)
* [Code repository](https://mahara.org/repository)
* [Contribute](https://mahara.org/contribute)
* [Release notes](https://mahara.org/releasenotes)
* [Events](https://mahara.org/events)

#### [About](https://mahara.org/about)

* [News and announcements](https://mahara.org/news)
* [Podcast 'Create. Share. Engage.'](https://podcast.mahara.org)
* [Contributors](https://mahara.org/community/contributors)
* [Security](https://mahara.org/security)
* [Accessibility](https://mahara.org/accessibility)

#### [Home](https://mahara.org/)

#### [Partners](https://mahara.org/partners)

#### [Subscription](https://mahara.org/subscription)

#### [Demo site](https://mahara.org/demo)

[![Powered by Mahara](https://mahara.org/theme/mahara-org/images/powered_by_mahara.svg?v=4171)](https://mahara.org/)

* [Legal](https://mahara.org/legal.php)
* [Contact us](https://mahara.org/contact.php)
* [Help](https://manual.mahara.org/en/24.04/)

[![Developed and maintained by Catalyst](https://mahara.org/theme/mahara-org/images/maintained-by-catalyst.png)](https://catalyst.net.nz/)

[Follow us on LinkedIn](https://www.linkedin.com/company/1845966)

[Find us on Mastodon](https://mastodon.nzoss.nz/%40mahara)



=== Content from bugs.launchpad.net_f1dea33d_20250126_103234.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# XSS using user uploaded XHTML files

Bug #1055232 reported by
[Hugh Davenport](https://launchpad.net/~hugh-davenport)
on 2012-09-24

[258](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.6.0](https://launchpad.net/mahara/%2Bmilestone/1.6.0) |
|  | [1.4](https://bugs.launchpad.net/mahara/1.4) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.4.5](https://launchpad.net/mahara/%2Bmilestone/1.4.5) |
|  | [1.5](https://bugs.launchpad.net/mahara/1.5) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.5.4](https://launchpad.net/mahara/%2Bmilestone/1.5.4) |

### Bug Description

Hello Maraha people,

Issues:

I have discovered 2 issues that in combination could result in remote

code exec on a Mahara site.

To get remote code exec the administrator would have to visit a page

created on the site by a malicious user.

In my opinion both issues would qualify as "Critical", obviously that

judgement is up to you :)

1. The first issue is an XSS caused by inline display of files

uploaded with the xhtml extension. An XML file can be uploaded with

the extension xhtml and it will be displayed inline, without the

sanitisation that is applied to html. This XML file can reference an

XSL style that causes the XML to be rendered as HTML and the XSL can

include JavaScript, resulting in XSS.

2. The ability of the administrator to set the path to clamav can be

abused. For instance changing the path to clamav from '/path/to/av' to

'/path/to/maharadata/artefact/file/originals/9/9' can cause a

malicious uploaded file to be executed.

This second bug is under [bug #1057238](/bugs/1057238)

Proof of concept, (example files attached):

1. attacker uploads revshell.sh, notes its file-id (as generated by mahara)

2. attacker edits the XSL file so the payload will set the clamav path

to the location of previously uploaded revshell.sh

3. attacker uploads XSL, notes its file-id

4. attacker edits the XML file, setting it to reference the file-id of

the previously uploaded XSL

5. attacker uploads XML file

5. admin views the malicious XML page

6. path to clamav has now been set via XSS, to the attackers script

7. when attacker uploads a new file, the attackers script is run and

attacker gets a reverse shell as www-data

Fixes:

1. For the XSS, make sure only files that can be sanitized are displayed inline.

2. Because installing antivirus will require shell access to the

server it seems reasonable to require setting the path to the AV be

done in a configuration file rather than a settings page. It could be

argued that in web applications generally, admin web access should not

be equivalent to shell access, due to relatively ease of session

compromise (as compared to shell access).

3. Uploaded files should not be set to executable.

4. Uploaded files should ideally be in a non-predicable location.

Errata:

1. In the PoC the uploaded file is executed but another method could

be to simply set the clamav path to /bin/bash so that any uploaded

file would effectively be run as though it were a bash script. This

would eliminate the need for an attacker to know the path to the

maharadata directory and eliminate the need for the uploaded file to

be executable.

2. Tested on Mahara 1.5.3 and Ubuntu Lucid

Cheers,

Mike

See [original description](comments/0)

## CVE References

* [2012-2243](/bugs/cve/2012-2243 "Cross-site scripting (XSS) vulnerabil...")

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-09-24

| Changed in mahara: | |
| --- | --- |
| **milestone**: | none â†’ 1.6.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-09-24: |  |  | [#4](/mahara/%2Bbug/1055232/comments/4) |
| --- | --- | --- | --- |

I have confirmed this for all versions back to 1.2, database independant.

I have also tested using the /bin/bash approach (there was a bug with modern browsers using multifile uploads, which will be a seperate patch), and this also allows remote code execution.

For point 2, I would suggest the fixes 2 and 3. Fix 3 is enough for the revshell uploaded file, but not enough for the /bin/bash (or other shell) approach. Fix 2 solves this, as only allows an administrator with access to the config.php file to change the path to this file (as with pathtozip and pathtounzip, and since 1.5 pathtoaspell).

For the XSS, fix 1 should be sufficient.

I would avoid fix 4 at this stage, as the file layout has been this way for a long time, and doesn't have any direct impact to the fixing of the other bugs

Cheers,

Hugh

I have confirmed this for all versions back to 1.2, database independant.
I have also tested using the /bin/bash approach (there was a bug with modern browsers using multifile uploads, which will be a seperate patch), and this also allows remote code execution.
For point 2, I would suggest the fixes 2 and 3. Fix 3 is enough for the revshell uploaded file, but not enough for the /bin/bash (or other shell) approach. Fix 2 solves this, as only allows an administrator with access to the config.php file to change the path to this file (as with pathtozip and pathtounzip, and since 1.5 pathtoaspell).
For the XSS, fix 1 should be sufficient.
I would avoid fix 4 at this stage, as the file layout has been this way for a long time, and doesn't have any direct impact to the fixing of the other bugs
Cheers,
Hugh

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-09-24: |  |  | [#8](/mahara/%2Bbug/1055232/comments/8) |
| --- | --- | --- | --- |

* [bug-1055232-1.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336480/%2Bfiles/bug-1055232-1.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336480)
  (1.4 KiB,
  text/plain)

This patch disables automatic displaying of inline XHTML files, and instead escaped them with an option to download the original.

This patch disables automatic displaying of inline XHTML files, and instead escaped them with an option to download the original.

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-09-27

| **description**: | updated |
| --- | --- |
| **summary**: | - XSS + design flaw = remote code exec+ XSS using user uploaded XHTML files |
| Changed in mahara: | |
| **importance**: | Undecided â†’ Critical |
| **status**: | Confirmed â†’ In Progress |

[Melissa Draper (melissa)](https://launchpad.net/~melissa)
on 2012-10-10

| **visibility**: | private â†’ public |
| --- | --- |

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-10-23

| Changed in mahara: | |
| --- | --- |
| **status**: | In Progress â†’ Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-11-08: |  |  | [#18](/mahara/%2Bbug/1055232/comments/18) |
| --- | --- | --- | --- |

-----BEGIN PGP SIGNED MESSAGE-----

Hash: SHA1

status fixreleased

-----BEGIN PGP SIGNATURE-----

Version: GnuPG v1.4.12 (GNU/Linux)

Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iJwEAQECAAYFAlCbHO8ACgkQuMoJ2LQ3zxH8TAP/YN4BiCJZsn5a899/0UzV31Qg

lM8LXAwZWa6zFv6t0BQUHCqe6eFK9wPp51qgCWWXjUZ3vvvVcsyeWp6626aBFKSU

pCQXI9E7huPw802nJQ9WcZXRBUmgw87ww72Tx4mybnu7SPSrkZgXdnPGSMwDs89N

oWvTpl7Xuac48e6p0lU=

=ouU+

-----END PGP SIGNATURE-----

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
status fixreleased
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
iJwEAQECAAYFAlCbHO8ACgkQuMoJ2LQ3zxH8TAP/YN4BiCJZsn5a899/0UzV31Qg
lM8LXAwZWa6zFv6t0BQUHCqe6eFK9wPp51qgCWWXjUZ3vvvVcsyeWp6626aBFKSU
pCQXI9E7huPw802nJQ9WcZXRBUmgw87ww72Tx4mybnu7SPSrkZgXdnPGSMwDs89N
oWvTpl7Xuac48e6p0lU=
=ouU+
-----END PGP SIGNATURE-----

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1055232/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1055232-2.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336352/%2Bfiles/bug-1055232-2.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336352 "Change patch details")
* [bug-1055232-3.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336372/%2Bfiles/bug-1055232-3.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336372 "Change patch details")
* [bug-1055232-1.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336480/%2Bfiles/bug-1055232-1.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336480 "Change patch details")
* [bug-1055232-2-14.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336522/%2Bfiles/bug-1055232-2-14.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336522 "Change patch details")
* [bug-1055232-3-14.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336523/%2Bfiles/bug-1055232-3-14.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336523 "Change patch details")
* [bug-1055232-2-12.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336524/%2Bfiles/bug-1055232-2-12.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336524 "Change patch details")
* [bug-1055232-3-master-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336615/%2Bfiles/bug-1055232-3-master-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336615 "Change patch details")
* [bug-1055232-3-16-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336616/%2Bfiles/bug-1055232-3-16-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336616 "Change patch details")
* [bug-1055232-3-15-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336617/%2Bfiles/bug-1055232-3-15-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336617 "Change patch details")
* [bug-1055232-3-14-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336618/%2Bfiles/bug-1055232-3-14-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336618 "Change patch details")
* [bug-1055232-3-12-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336619/%2Bfiles/bug-1055232-3-12-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336619 "Change patch details")

* [Add patch](/mahara/%2Bbug/1055232/%2Baddcomment?field.patch=on)

## Bug attachments

* [revshell.sh](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336298/%2Bfiles/revshell.sh)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336298 "Change attachment details")
* [change-clampath-xsl.xhtml](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336299/%2Bfiles/change-clampath-xsl.xhtml)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336299 "Change attachment details")
* [change-clampath-xml.xhtml](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336300/%2Bfiles/change-clampath-xml.xhtml)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336300 "Change attachment details")

* [Add attachment](/mahara/%2Bbug/1055232/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
Â â€¢
[Take the tour](https://launchpad.net/%2Btour)
Â â€¢
[Read the guide](https://help.launchpad.net/)

Â© 2004
[CanonicalÂ Ltd.](http://canonical.com/)
Â â€¢
[Terms of use](https://launchpad.net/legal)
Â â€¢
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
Â â€¢
[Contact Launchpad Support](/feedback)
Â â€¢
[Blog](http://blog.launchpad.net/)
Â â€¢
[Careers](https://canonical.com/careers)
Â â€¢
[System status](https://ubuntu.social/%40launchpadstatus)
Â â€¢
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_67bb2da5_20250126_103234.html ===

[Log in / Register](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Blogin)

[![](https://launchpadlibrarian.net/302557383/mahara_64x64.png)](https://launchpad.net/mahara)

## [Mahara](https://launchpad.net/mahara)

* [Overview](https://launchpad.net/mahara)
* [Code](https://code.launchpad.net/mahara)
* [Bugs](https://bugs.launchpad.net/mahara)
* [Blueprints](https://blueprints.launchpad.net/mahara)
* [Translations](https://translations.launchpad.net/mahara)
* [Answers](https://answers.launchpad.net/mahara)

# XSS using user uploaded XHTML files

Bug #1055232 reported by
[Hugh Davenport](https://launchpad.net/~hugh-davenport)
on 2012-09-24

[258](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mahara](https://bugs.launchpad.net/mahara) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.6.0](https://launchpad.net/mahara/%2Bmilestone/1.6.0) |
|  | [1.4](https://bugs.launchpad.net/mahara/1.4) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.4.5](https://launchpad.net/mahara/%2Bmilestone/1.4.5) |
|  | [1.5](https://bugs.launchpad.net/mahara/1.5) | Fix Released | Critical | [Hugh Davenport](https://launchpad.net/~hugh-davenport) | [Mahara 1.5.4](https://launchpad.net/mahara/%2Bmilestone/1.5.4) |

### Bug Description

Hello Maraha people,

Issues:

I have discovered 2 issues that in combination could result in remote

code exec on a Mahara site.

To get remote code exec the administrator would have to visit a page

created on the site by a malicious user.

In my opinion both issues would qualify as "Critical", obviously that

judgement is up to you :)

1. The first issue is an XSS caused by inline display of files

uploaded with the xhtml extension. An XML file can be uploaded with

the extension xhtml and it will be displayed inline, without the

sanitisation that is applied to html. This XML file can reference an

XSL style that causes the XML to be rendered as HTML and the XSL can

include JavaScript, resulting in XSS.

2. The ability of the administrator to set the path to clamav can be

abused. For instance changing the path to clamav from '/path/to/av' to

'/path/to/maharadata/artefact/file/originals/9/9' can cause a

malicious uploaded file to be executed.

This second bug is under [bug #1057238](/bugs/1057238)

Proof of concept, (example files attached):

1. attacker uploads revshell.sh, notes its file-id (as generated by mahara)

2. attacker edits the XSL file so the payload will set the clamav path

to the location of previously uploaded revshell.sh

3. attacker uploads XSL, notes its file-id

4. attacker edits the XML file, setting it to reference the file-id of

the previously uploaded XSL

5. attacker uploads XML file

5. admin views the malicious XML page

6. path to clamav has now been set via XSS, to the attackers script

7. when attacker uploads a new file, the attackers script is run and

attacker gets a reverse shell as www-data

Fixes:

1. For the XSS, make sure only files that can be sanitized are displayed inline.

2. Because installing antivirus will require shell access to the

server it seems reasonable to require setting the path to the AV be

done in a configuration file rather than a settings page. It could be

argued that in web applications generally, admin web access should not

be equivalent to shell access, due to relatively ease of session

compromise (as compared to shell access).

3. Uploaded files should not be set to executable.

4. Uploaded files should ideally be in a non-predicable location.

Errata:

1. In the PoC the uploaded file is executed but another method could

be to simply set the clamav path to /bin/bash so that any uploaded

file would effectively be run as though it were a bash script. This

would eliminate the need for an attacker to know the path to the

maharadata directory and eliminate the need for the uploaded file to

be executable.

2. Tested on Mahara 1.5.3 and Ubuntu Lucid

Cheers,

Mike

See [original description](comments/0)

## CVE References

* [2012-2243](/bugs/cve/2012-2243 "Cross-site scripting (XSS) vulnerabil...")

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-09-24

| Changed in mahara: | |
| --- | --- |
| **milestone**: | none â†’ 1.6.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-09-24: |  |  | [#4](/mahara/%2Bbug/1055232/comments/4) |
| --- | --- | --- | --- |

I have confirmed this for all versions back to 1.2, database independant.

I have also tested using the /bin/bash approach (there was a bug with modern browsers using multifile uploads, which will be a seperate patch), and this also allows remote code execution.

For point 2, I would suggest the fixes 2 and 3. Fix 3 is enough for the revshell uploaded file, but not enough for the /bin/bash (or other shell) approach. Fix 2 solves this, as only allows an administrator with access to the config.php file to change the path to this file (as with pathtozip and pathtounzip, and since 1.5 pathtoaspell).

For the XSS, fix 1 should be sufficient.

I would avoid fix 4 at this stage, as the file layout has been this way for a long time, and doesn't have any direct impact to the fixing of the other bugs

Cheers,

Hugh

I have confirmed this for all versions back to 1.2, database independant.
I have also tested using the /bin/bash approach (there was a bug with modern browsers using multifile uploads, which will be a seperate patch), and this also allows remote code execution.
For point 2, I would suggest the fixes 2 and 3. Fix 3 is enough for the revshell uploaded file, but not enough for the /bin/bash (or other shell) approach. Fix 2 solves this, as only allows an administrator with access to the config.php file to change the path to this file (as with pathtozip and pathtounzip, and since 1.5 pathtoaspell).
For the XSS, fix 1 should be sufficient.
I would avoid fix 4 at this stage, as the file layout has been this way for a long time, and doesn't have any direct impact to the fixing of the other bugs
Cheers,
Hugh

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-09-24: |  |  | [#8](/mahara/%2Bbug/1055232/comments/8) |
| --- | --- | --- | --- |

* [bug-1055232-1.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336480/%2Bfiles/bug-1055232-1.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336480)
  (1.4 KiB,
  text/plain)

This patch disables automatic displaying of inline XHTML files, and instead escaped them with an option to download the original.

This patch disables automatic displaying of inline XHTML files, and instead escaped them with an option to download the original.

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-09-27

| **description**: | updated |
| --- | --- |
| **summary**: | - XSS + design flaw = remote code exec+ XSS using user uploaded XHTML files |
| Changed in mahara: | |
| **importance**: | Undecided â†’ Critical |
| **status**: | Confirmed â†’ In Progress |

[Melissa Draper (melissa)](https://launchpad.net/~melissa)
on 2012-10-10

| **visibility**: | private â†’ public |
| --- | --- |

[Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport)
on 2012-10-23

| Changed in mahara: | |
| --- | --- |
| **status**: | In Progress â†’ Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hugh Davenport (hugh-davenport)](https://launchpad.net/~hugh-davenport) wrote on 2012-11-08: |  |  | [#18](/mahara/%2Bbug/1055232/comments/18) |
| --- | --- | --- | --- |

-----BEGIN PGP SIGNED MESSAGE-----

Hash: SHA1

status fixreleased

-----BEGIN PGP SIGNATURE-----

Version: GnuPG v1.4.12 (GNU/Linux)

Comment: Using GnuPG with Mozilla - <http://enigmail.mozdev.org/>

iJwEAQECAAYFAlCbHO8ACgkQuMoJ2LQ3zxH8TAP/YN4BiCJZsn5a899/0UzV31Qg

lM8LXAwZWa6zFv6t0BQUHCqe6eFK9wPp51qgCWWXjUZ3vvvVcsyeWp6626aBFKSU

pCQXI9E7huPw802nJQ9WcZXRBUmgw87ww72Tx4mybnu7SPSrkZgXdnPGSMwDs89N

oWvTpl7Xuac48e6p0lU=

=ouU+

-----END PGP SIGNATURE-----

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
status fixreleased
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
iJwEAQECAAYFAlCbHO8ACgkQuMoJ2LQ3zxH8TAP/YN4BiCJZsn5a899/0UzV31Qg
lM8LXAwZWa6zFv6t0BQUHCqe6eFK9wPp51qgCWWXjUZ3vvvVcsyeWp6626aBFKSU
pCQXI9E7huPw802nJQ9WcZXRBUmgw87ww72Tx4mybnu7SPSrkZgXdnPGSMwDs89N
oWvTpl7Xuac48e6p0lU=
=ouU+
-----END PGP SIGNATURE-----

[See full activity log](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/mahara/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/mahara/%2Bbug/1055232/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1055232-2.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336352/%2Bfiles/bug-1055232-2.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336352 "Change patch details")
* [bug-1055232-3.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336372/%2Bfiles/bug-1055232-3.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336372 "Change patch details")
* [bug-1055232-1.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336480/%2Bfiles/bug-1055232-1.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336480 "Change patch details")
* [bug-1055232-2-14.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336522/%2Bfiles/bug-1055232-2-14.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336522 "Change patch details")
* [bug-1055232-3-14.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336523/%2Bfiles/bug-1055232-3-14.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336523 "Change patch details")
* [bug-1055232-2-12.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336524/%2Bfiles/bug-1055232-2-12.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336524 "Change patch details")
* [bug-1055232-3-master-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336615/%2Bfiles/bug-1055232-3-master-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336615 "Change patch details")
* [bug-1055232-3-16-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336616/%2Bfiles/bug-1055232-3-16-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336616 "Change patch details")
* [bug-1055232-3-15-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336617/%2Bfiles/bug-1055232-3-15-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336617 "Change patch details")
* [bug-1055232-3-14-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336618/%2Bfiles/bug-1055232-3-14-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336618 "Change patch details")
* [bug-1055232-3-12-upgrade.patch](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336619/%2Bfiles/bug-1055232-3-12-upgrade.patch)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336619 "Change patch details")

* [Add patch](/mahara/%2Bbug/1055232/%2Baddcomment?field.patch=on)

## Bug attachments

* [revshell.sh](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336298/%2Bfiles/revshell.sh)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336298 "Change attachment details")
* [change-clampath-xsl.xhtml](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336299/%2Bfiles/change-clampath-xsl.xhtml)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336299 "Change attachment details")
* [change-clampath-xml.xhtml](https://bugs.launchpad.net/mahara/%2Bbug/1055232/%2Battachment/3336300/%2Bfiles/change-clampath-xml.xhtml)
  [Edit](/mahara/%2Bbug/1055232/%2Battachment/3336300 "Change attachment details")

* [Add attachment](/mahara/%2Bbug/1055232/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
Â â€¢
[Take the tour](https://launchpad.net/%2Btour)
Â â€¢
[Read the guide](https://help.launchpad.net/)

Â© 2004
[CanonicalÂ Ltd.](http://canonical.com/)
Â â€¢
[Terms of use](https://launchpad.net/legal)
Â â€¢
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
Â â€¢
[Contact Launchpad Support](/feedback)
Â â€¢
[Blog](http://blog.launchpad.net/)
Â â€¢
[Careers](https://canonical.com/careers)
Â â€¢
[System status](https://ubuntu.social/%40launchpadstatus)
Â â€¢
4d55102
([Get the code!](https://dev.launchpad.net/))


