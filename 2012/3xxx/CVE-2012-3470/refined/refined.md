Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2012-3470:

**Root Cause of Vulnerability:**

*   The vulnerability is a SQL injection flaw.
*   The `incident_id` was not sanitized before being used in a geometry query.

**Weaknesses/Vulnerabilities Present:**

*   **SQL Injection:** The code directly concatenates the unsanitized `incident_id` into a SQL query string, leading to a SQL injection vulnerability. Specifically, the following code was vulnerable:
    ```php
    $sql = "SELECT AsText(geometry) as geometry, geometry_label,
    geometry_comment, geometry_color, geometry_strokewidth
    FROM ".Kohana::config('database.default.table_prefix')."geometry
    WHERE incident_id=".$id;
    $query = $db->query($sql);
    ```
    This was in both `application/controllers/admin/reports.php` and `application/controllers/members/reports.php`.

**Impact of Exploitation:**

*   An attacker could inject malicious SQL code through the `incident_id` parameter.
*   This could allow the attacker to:
    *   Read sensitive data from the database
    *   Modify or delete data in the database
    *   Potentially gain further access to the system, depending on the database user permissions.

**Attack Vectors:**

*   The attack vector is through HTTP requests to the `/admin/reports/edit` and `/members/reports/edit` endpoints.
*   The attacker needs to manipulate the `incident_id` parameter in the request.

**Required Attacker Capabilities/Position:**

*   The attacker needs to be able to send HTTP requests to the application.
*   The attacker does not need to be authenticated for the members endpoint (based on the patch).
*   The attacker needs to be an administrator for the admin endpoint (based on the patch).

**Additional Details:**

*   The fix implemented for this vulnerability involved using parameterized queries with prepared statements, which correctly sanitize the input:

    ```php
    $sql = "SELECT AsText(geometry) as geometry, geometry_label,
        geometry_comment, geometry_color, geometry_strokewidth
        FROM ".Kohana::config('database.default.table_prefix')."geometry
        WHERE incident_id = ?";
    $query = $db->query($sql, $id);
    ```
    The `?` is a placeholder for the `$id` variable, which is then passed as a parameter to the `query()` function, effectively escaping the input and preventing SQL injection.

*   The fix was applied to both the admin and member reports edit controllers.

*   This CVE is specifically associated with the commit [3f14fa0](https://github.com/ushahidi/Ushahidi_Web/commit/3f14fa0d09ac7e6ad69f5fa1443a7ea4df327381).