```
Message-ID: <50CF54D8.50003@redhat.com>
Date: Mon, 17 Dec 2012 10:22:32 -0700
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
CC: Vincent Danen <vdanen@...hat.com>
Subject: Re: CVE request: fail2ban 0.8.8 fixes an input variable
 quoting flaw on <matches> content

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 12/17/2012 08:41 AM, Vincent Danen wrote:
> Could a CVE be assigned to this issue please?
>
> The release notes for fail2ban 0.8.8 indicate:
>
> * [83109bc] IMPORTANT: escape the content of <matches> (if used in
> custom action files) since its value could contain arbitrary
> symbols.  Thanks for discovery go to the NBS System security team
>
> This could cause issues on the system running fail2ban as it scans
> log files, depending on what content is matched.  There isn't much
> more detail about this issue than what is described above, so I
> think it may largely depend on the type of regexp used (what it
> matches) and the contents of the log file being scanned (whether or
> not an attacher could insert something that could be used in a
> malicious way).
>
> References:
>
> <https://raw.github.com/fail2ban/fail2ban/master/ChangeLog>
> <http://sourceforge.net/mailarchive/message.php?msg_id=30193056>
> <https://github.com/fail2ban/fail2ban/commit/83109bc>
> <https://bugzilla.redhat.com/show_bug.cgi?id=887914>
> <https://bugs.gentoo.org/show_bug.cgi?id=447572>
>

Please use CVE-2012-5642 for this issue.

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iQIcBAEBAgAGBQJQz1TYAAoJEBYNRVNeJnmTQdgP/jRbo8ReeQJzUxAqsc0JiJ1a
fC6e4hnTeYw1y8007NZkxbmdnvsgZvtFvUiBe6ovuGidIKXSWqYH3LjoC/0Oim4T
NNTnL1wG8Ri93akY56/pyyHeZGamo1Ss1Kv4BgM0MXFfOOWTJmGPz1jn52E4VtBC
gnVHIZ/gNxVbIVj0QVaj3tDJOhweg9ACkunVwDasMTRi1MgQKmT3i8IVgWsVGaAo
xzxE1T1RXygjtbJNpMlBDmZP4+OjSeAzavAw81OP4j/Tse68PcBA2givh0SNG97T
neEDyWtL8IvMxYPelgUyWi0jWHv96ymuKwfzkST81+yjSYc2JqN0FnOSa2kCjCtb
tCG3K/Y2AKCbi8JozTjgDj1wTSh5I6z9DXiARan9m+JfZYChoESiQ960H1VGEd3t
qJL43vr2FnWTHpClwp4O/CQyQ4XeN8ttxTgZdvZbYUZraSFxpNZfdW1dGVwrR4Kg
opg06obA4B22o/JZmC7ZRFhFr/idY8IDXtRuuUJPnY9C6UazfP/Zv4EnylTMuYCY
CvvL58t3SnruoJHplr8d6uZWrPgSqdK7XRFGIm/L7ISuNMe67swXa3SF8+gshpXu
IIFa8qOK6QIejFMAT2BW5Xlp0Q/m3RB2cnVmEK000rLkuFlj2eYZr0aftD8uJ3Ub
vZg8/UeljGebpb7n+7w3
=mKR4
-----END PGP SIGNATURE-----
```
```
Red Hat Bugzilla – Bug 887914

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 887914**](show_bug.cgi?id=887914)
(CVE-2012-5642)
- [CVE-2012-5642](https://access.redhat.com/security/cve/CVE-2012-5642) fail2ban: does not escape the content of <matches>

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-5642 fail2ban: does not escape the content of <matches>
```
```
Gentoo's Bugzilla – Bug 447572
<net-analyzer/fail2ban-0.8.8: input variable quoting vulnerability (CVE-2012-5642)
```
```
CVE-2012-5642 (<http://nvd.nist.gov/nvd.cfm?cvename=CVE-2012-5642>):   server/action.py in Fail2ban before 0.8.8 does not properly handle the   content of the matches tag, which might allow remote attackers to trigger   unsafe behavior in a custom action file via unspecified symbols in this   content.
```
```
openSUSE Security Update: fail2ban: fixed a startup and security issue
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0567-1
Rating: low
References: #790557 #794953
Cross-References: CVE-2012-5642
Affected Products:
openSUSE 11.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves one vulnerability and has one errata
is now available.
Description:
This update of fail2ban fixes a startup related
startup-problem and a security problem fixed upstream
(CVE-2012-5642).
```
```
openSUSE Security Update: fail2ban: fixed a startup and security issue
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0566-1
Rating: low
References: #790557 #794953
Cross-References: CVE-2012-5642
Affected Products:
openSUSE 12.3
openSUSE 12.2
openSUSE 12.1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves one vulnerability and has one errata
is now available.
Description:
This update of fail2ban fixes a startup related
startup-problem and a security problem fixed upstream
(CVE-2012-5642).
```
```
BF: escape the content of <matches> since its value could contain arb…

…itrary symbols
```
```
  |  | for tag, value in aInfo.iteritems():
  |  | value = str(value) # assure string
  |  | if tag == 'matches':
  |  | # That one needs to be escaped since its content is
  |  | # out of our control
  |  | value = escapeTag(value)
```
```
### Fixes
* [83109bc] IMPORTANT: escape the content of <matches> (if used in
custom action files) since its value could contain arbitrary
symbols.  Thanks for discovery go to the NBS System security team
```
Based on the provided information, here's a breakdown of the vulnerability:

**Root cause of vulnerability:**

The vulnerability stems from the `fail2ban` application not properly sanitizing or escaping the content of the `<matches>` tag within custom action files. This tag's value could be populated with arbitrary symbols originating from log files that `fail2ban` monitors.

**Weaknesses/vulnerabilities present:**

- **Lack of input sanitization:** The core issue is that the application does not sanitize or encode special characters present in the `<matches>` tag before using it in system commands.
- **Command Injection:** This can result in command injection, as attacker controlled strings, if crafted carefully, could allow for arbitrary command execution on the system running fail2ban.

**Impact of exploitation:**

- **Arbitrary command execution:** An attacker could potentially inject malicious commands into the log files, which would then be processed by fail2ban and executed on the system with fail2ban's privileges.
- **System compromise:** Successful command injection could lead to a compromise of the server hosting fail2ban.

**Attack vectors:**

- **Log file manipulation:** An attacker needs to be able to insert specific strings into log files that are being monitored by fail2ban.
- **Custom action file:** The attack requires a custom action file that leverages the `<matches>` tag.

**Required attacker capabilities/position:**

- **Log injection capability:** An attacker must be able to insert malicious strings into log files that are being monitored by `fail2ban`. This can be achieved by exploiting vulnerabilities in services or applications that write to these logs, or by having direct access to modify the files.
- **Knowledge of fail2ban configuration:** A successful attack is easier if the attacker knows which log files are being monitored and how the custom action files are setup
- **Custom Action Definition:** The attacker must be able to define or control a custom action that leverages the  `<matches>` tag.

The fix implemented in fail2ban 0.8.8 addresses this vulnerability by properly escaping the content of the `<matches>` tag, thus preventing command injection.