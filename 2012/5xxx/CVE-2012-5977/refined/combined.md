=== Content from www.debian.org_e2607eb0_20250125_001843.html ===


---

[[Date Prev](msg00008.html)][[Date Next](msg00010.html)]
[[Thread Prev](msg00008.html)][[Thread Next](msg00010.html)]
[[Date Index](maillist.html#00009)]
[[Thread Index](threads.html#00009)]

# [SECURITY] [DSA 2605-1] asterisk security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 2605-1] asterisk security update
* *From*: Thijs Kinkhorst <thijs@debian.org>
* *Date*: Sun, 13 Jan 2013 21:36:39 +0100 (CET)
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20130113203639.F0FFE5AA3F%40kinkhorst.com)Â [20130113203639.F0FFE5AA3F@kinkhorst.com](msg00009.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- -------------------------------------------------------------------------
Debian Security Advisory DSA-2605-1                   security@debian.org
<http://www.debian.org/security/>                           Thijs Kinkhorst
January 13, 2013                       <http://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : asterisk
Vulnerability  : several issues
Problem type   : remote
Debian-specific: no
CVE ID         : CVE-2012-5976 CVE-2012-5977
Debian Bug     : 697230

Several vulnerabilities were discovered in Asterisk, a PBX and telephony
toolkit, that allow remote attackers to perform denial of service
attacks.

For the stable distribution (squeeze), these problems have been fixed in
version 1:1.6.2.9-2+squeeze9.

For the testing distribution (wheezy) and unstable distribution (sid),
these problems will be fixed soon.

We recommend that you upgrade your asterisk packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <http://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iQEcBAEBAgAGBQJQ8xjvAAoJEFb2GnlAHawEJtMH/juZ6GQKigBsTRUfv00AEoo6
RRCVmPtusaNzSBmyIA+PWqprLtl8JuWwWIJzF4x4UdddxFtaGemge74CJwWmuolp
r+V2qt4MsTSulEjoVn1GiR3anSQapWom+yMASYkCBsoqGKTg/zge0VOLaPgXUMZh
KFaQPTPPOE62uPs7bktUMaKO8xc+l7DPQ7TBk6dl8511Xr/CQZ5XnhirtZrcfLBb
BIrokrl8qPMUzL9f0RPOVyHN9qOPhpLtGvy/hi+MdkxHfNJI/m0DTgnHMY1xkwS7
o/xaKAvNo7lI//V3eoAf9iQ/gYgrPZqxTzuCKzI9uNJtpKFXtY3EFVVI6NK/fNU=
=BUfb
-----END PGP SIGNATURE-----

```

---



=== Content from issues.asterisk.org_05de4fe1_20250125_001844.html ===

[[Home](/)]

| Summary: | ASTERISK-20175: Security Vulnerability: denial of service attack through exploitation of device state caching | | |
| --- | --- | --- | --- |
| Reporter: | Matt Jordan (mjordan) | Labels: |  |
| Date Opened: | 2012-07-26 14:39:57 | Date Closed: | 2013-01-02 14:30:53.000-0600 |
| Priority: | Major | Regression? | No |
| Status: | Closed/Complete | Components: | Core/General |
| Versions: | 1.8.14.1 10.6.1 10.6.1-digiumphones | Frequency ofOccurrence |  |
| RelatedIssues: | | must be completed before resolving | [ASTERISK-20807](/ASTERISK-20807) 1.8.20.0 Blockers | | --- | --- | | must be completed before resolving | [ASTERISK-20808](/ASTERISK-20808) 10.12.0 Blockers | | must be completed before resolving | [ASTERISK-20809](/ASTERISK-20809) 11.2.0 Blockers | | causes | [ASTERISK-21069](/ASTERISK-21069) xmpp distributed device states aggregation update fails | | causes | [ASTERISK-21164](/ASTERISK-21164) Need clarification on distributed device state behavior and whether this behavior is a possible regression | | causes | [ASTERISK-21429](/ASTERISK-21429) Distributed Device State using JABBER/XMPP not working since Secuity Advisory AST-2012-015 | | | |
| Environment: |  | Attachments: | ( 0) [event-cachability-3.diff](../attachments/20/ASTERISK-20175/00-event-cachability-3.diff) |
| Description: | From Russell:  I have been working with someone on some performance issues with their Asterisk cluster that uses distributed device state. Â One of the problems that we identified was that the size of the device state cache was growing out of control. Â To view the cache, you can do:  {noformat} Â  Â \*CLI> event dump cache DeviceState {noformat}  In particular, the states that were causing the problem on these systems were things like:  {noformat} Â  Â Local/12341234@whatever Â  Â DAHDI/i8/12341234 {noformat}  Certain "device states" like this are useless to cache. Â Imagine an outbound call center that uses Local channels in their dialplan and PRIs for doing outbound calls. Â They get entries in the cache for every number they dial. Â Ouch. Â That's a bug that needs to be addressed and I'm not quite sure how to fix it in a good generic way yet. Â However, that's not the vulnerability. Â It's just the background that led me to the vulnerability.  I started thinking about how far this problem really reaches. Â I wondered, can I remotely grow the cache, causing performance problems and eventually running out of RAM? Â Unfortunately, yes. Â I have verified this with SIP. Â I imagine the same issue exists with IAX2.  In chan\_sip, if you allow anonymous calls, the channel name is based on the domain in the From header. Â I verified this vulnerability by doing the following:  {noformat} Â  ; sip.conf  Â  Â [someserver] Â  Â type=peer Â  Â host=someserver.com Â  Â fromdomain=example.com Â  Â fromuser=foo {noformat}  I then used a call file:  {noformat} Â  Â Channel: SIP/foo@someserver Â  Â CallerID: "My Name" <1111111> Â  Â Application: Playback Â  Â Data: beep {noformat}  The domain in the From header should be "example.com". Â The channel name on the remote server should be "SIP/example.com-<something>". Â An entry will be added to the cache for "SIP/example.com". Â This means that I can very easily continue to send calls with different domains and fill up the cache.  The public server that I tested this against happened to be running Asterisk 10. Â I believe that this affects all versions that have the device state cache, which would be 1.6.something and up.  This is a nasty problem and I'm not sure what the fix should be. Â It's an architectural problem. Â The cache needs to only consist of things that are defined locally, and not things that are dynamically generated, but there's not a good generic way to determine that given a "device" name. Â I'd be happy to brainstorm with others on this.  While the original report came from me, I'd like to credit Leif Madsen and Joshua Colp for their assistance with verifying the vulnerability.  Thanks,  -- Russell Bryant | | |
| Comments: | By: Kinsey Moore (kmoore) 2012-08-02 13:59:08.375-0500Consumers for further state distribution:  res\_xmpp  res\_jabber  res\_corosync   Direct consumers of device state:  app\_queue  CCSS  pbx hints  devicestate   All of these seem to hook device state unconditionally except CCSS which hooks information for specific devices as they require CCSS.  ---   By: Kinsey Moore (kmoore) 2012-08-02 15:11:30.255-0500It also appears that main/devicestate.c is the only consumer of cached device state events.  ---   By: Kinsey Moore (kmoore) 2012-08-09 09:33:03.952-0500I finally got a chance to talk with Russell and this is going to be pretty nasty to fix. Â Only the channel driver that creates the channel can know whether its state should be cached. Â This information has to live with the channel (probably a flag) as its state changes so that created events can be marked as cacheable. Â This flag already exists on ast\_event\_ref instead of the event itself (see \_ast\_event\_queue in main/event.c) but is not used/exposed so as to be easily usable and will require a small API change (or may be easier to put on the event itself via a new IE). Â Device state changes that are distributed must also have this cacheable flag so that remote systems can know whether the new state should be cached or discarded after any receivers have taken appropriate action. Â I have not yet determined if this can be backwards compatible with existing event state distribution architecture.  ---   By: Matt Jordan (mjordan) 2012-08-09 16:11:52.165-0500So, first you should probably keep in mind that whatever is done has to be done in the context of 1.8+. Â \_ast\_event\_queue doesn't exist in 1.8, and the ast\_event\_ref object does not have a cache attribute in 1.8.   That being said, that doesn't mean that can't be backported to 1.8.   Something Kevin suggested was to think about making this configurable in each channel driver. Â The default would be to 'save state' for each device, but then allow for 'guest' devices to not have their state saved, as well as any particular configurable device. Â In the case of local channels, you'd probably never have their device state cached.   Ideally then, each device would mark whether or not they want their event to be cached when they raise the event. Â This would allow a system administrator the ability to configure the system such that they can prevent the situation Russell ran into, while keeping the current behavior (cache stuff) if they so desire.   As far as the distributed architecture goes, if we have to convey the cachce information in the event, then it won't be 'purely' backwards compatible. Â However, if all we've done is embed a new IE into the event, then 'old' systems should be okay, since they can pull information out of the event based on the identifier of each IE.  ---   By: Kinsey Moore (kmoore) 2012-08-14 16:23:20.384-0500List of items to complete:  \* Identify all event generation that would need to determine cachability of the event being generated and determine in what cases these events are cachable. (needs a lot of research)  \* Per-channel-driver implementation of options to change caching behavior with cachability flag on channel.  \*\* Maybe this would be better as a global option to make all events cachable vs some not cachable? (would still require per-channel flag)  \* Change internal generation/usage of cache flag to be an IE on the ast\_event instead of a flag on the ast\_event\_ref.  \* Update all instances of event generation to use this IE appropriately in conjunction with the flag on the channel or the global option, whichever is chosen.  \*\* Events without the IE should be considered cachable since they would be coming from a legacy system that expects them to be cachable. Â Otherwise, all events should have the cachability IE.  \* Change distributed generation/usage of events to serialize/deserialize the IE describing cachability.  \*\* res\_ais/res\_corosync: Transparent since the event is sent as binary data. Â An unknown field in the event should not cause problems to legacy Asterisk systems running res\_ais/res\_corosync.  \*\* res\_xmpp/res\_jabber: The persist\_items configuration field is a per-subscription configuration and not a per-event configuration. Â This will be inserted as an item in aji\_build\_publish\_skeleton.  \*\*\* The cachability item should always come last so as not to disturb the parsing of legacy implementations. Â This should assume cachability by default and the additional information should negate cachability to prevent incorrect interpretation of events from legacy systems.   Note 1: There do not appear to be any event comparison functions in event.h that would choke on an additional/unknown IE.   Note 2: Porting from 1.8 forward should not be much of an issue, but the existing cachability flags should be removed from the ast\_event\_ref in 10, 11, and trunk and the differences between 1.8 and 10 should be smoothed out as far as ast\_event\_queue vs ast\_event\_queue\_and\_cache.    Does this need to be done for core, core+extended, or all modules?   Edit: clarification on configuration option as per-subscription and not per-event as published.  ---   By: Kinsey Moore (kmoore) 2012-08-21 16:43:30.637-0500Event-related areas needing evaluation:  \* Code that uses ast\_event\_queue\_and\_cache with AST\_EVENT\_DEVICE\_STATE[\_CHANGE]  \*\* res\_jabber/res\_xmpp  \*\* res\_corosync/res\_ais  \*\* devicestate.c  \* Code that uses ast\_event\_subscribe[\_new] with any cachable event types  \*\* res\_jabber/res\_xmpp  \*\* res\_corosync/res\_ais  \*\* devicestate.c  \* Code that consumes cached AST\_EVENT\_DEVICE\_STATE[\_CHANGE] events  \*\* devicestate.c  \* Code that uses ast\_devstate\_changed or ast\_devstate\_changed\_literal  \*\* channels: dahdi, sip, agent, iax2, skinny  \*\* main: channel, devicestate(needs to pass through the new cache parameter), features  \*\* apps: confbridge, meetme  \*\* res: calendar  \*\* funcs: devstate  --- | | |


