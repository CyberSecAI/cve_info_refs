=== Content from bugzilla.redhat.com_fcca99be_20250126_100757.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D828051)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D828051)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D828051)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 828051

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 828051**](show_bug.cgi?id=828051)
(CVE-2012-2688)
- [CVE-2012-2688](https://access.redhat.com/security/cve/CVE-2012-2688) php: Integer Signedness issues in \_php\_stream\_scandir

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-2688 php: Integer Signedness issues in \_php\_stream\_scandir

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-2688 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [865986](show_bug.cgi?id=865986) [958614](show_bug.cgi?id=958614) [1037490](show_bug.cgi?id=1037490) [1037491](show_bug.cgi?id=1037491) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [828053](show_bug.cgi?id=828053) [855229](show_bug.cgi?id=855229) [952520](show_bug.cgi?id=952520) | | TreeView+ | [depends on](buglist.cgi?bug_id=828051&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=828051&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-06-04 06:59 UTC by Jan Lieskovsky | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-23 14:36 UTC ([History](show_activity.cgi?id=828051)) | | [CC List:](page.cgi?id=fields.html#cclist) | 7 users (show)  btotty erich hkim jacobgodin jorton ldimaggi security-response-team | | Fixed In Version: | php 5.4.5, php 5.3.15 | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2013-12-11 10:33:21 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2013:0514](https://access.redhat.com/errata/RHSA-2013%3A0514) | 0 | normal | SHIPPED\_LIVE | Moderate: php security, bug fix and enhancement update | 2013-02-20 21:29:20 UTC | | Red Hat Product Errata | [RHSA-2013:1307](https://access.redhat.com/errata/RHSA-2013%3A1307) | 0 | normal | SHIPPED\_LIVE | Moderate: php53 security, bug fix and enhancement update | 2013-10-01 00:31:22 UTC | | Red Hat Product Errata | [RHSA-2013:1814](https://access.redhat.com/errata/RHSA-2013%3A1814) | 0 | normal | SHIPPED\_LIVE | Critical: php security update | 2013-12-11 07:25:07 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=828051#c0)  Jan Lieskovsky    2012-06-04 06:59:52 UTC  ``` An integer signedness issue leading to a heap-based buffer overflow was found in the way PHP implemented its scandir() function. If scandir() was used to list files and directories from a directory containing a large number of files, it could cause PHP to crash to under some conditions execute arbitrary code with the permissions of the user running PHP.   ```  [Comment 3](show_bug.cgi?id=828051#c3)  Huzaifa S. Sidhpurwala    2012-06-08 09:33:48 UTC  ``` Upstream commit for 5.3/5.4:  <https://github.com/php/php-src/commit/fc74503792b1ee92e4b813690890f3ed38fa3ad5>   ```  [Comment 4](show_bug.cgi?id=828051#c4)  Tomas Hoger    2012-06-08 09:36:38 UTC  ``` (In reply to [comment #3](show_bug.cgi?id=828051#c3)) > <https://github.com/php/php-src/commit/> > fc74503792b1ee92e4b813690890f3ed38fa3ad5  <http://git.php.net/?p=php-src.git;a=commitdiff;h=fc74503792b1ee92e4b813690890f3ed38fa3ad5>   ```  [Comment 8](show_bug.cgi?id=828051#c8)  Vincent Danen    2012-07-20 17:32:40 UTC  ``` This is public and fixed in 5.4.5 and 5.3.15:  Fixed potential overflow in _php_stream_scandir ([CVE-2012-2688](https://access.redhat.com/security/cve/CVE-2012-2688))  (<http://www.php.net/ChangeLog-5.php#5.3.15>)   ```  [Comment 10](show_bug.cgi?id=828051#c10)  Vincent Danen    2012-07-23 14:38:17 UTC  ``` Currently 5.3.15 and 5.4.5 are in testing for Fedora 16 and 17 respectively.   ```  [Comment 11](show_bug.cgi?id=828051#c11)  Eric Rich    2012-08-21 19:08:51 UTC  ``` <https://access.redhat.com/security/cve/CVE-2012-2688> states that a fix may be coming for this issue but based on comments in this bug I do not see any movement for any of the Red Hat provided packages, is there any update that can be made.   I know of several RHEL customer show are looking for a fix to this issues.   ```  [Comment 12](show_bug.cgi?id=828051#c12)  Vincent Danen    2012-09-06 01:34:45 UTC  ``` To clarify, because the description does not indicate the requisite number of files to trigger this flaw.  The number of files required in the directory that the PHP scan() function is run on is what PHP defines as INT_MAX, which is defined (in RHEL6):  main/php.h:229:#define INT_MAX 2147483647  That means you need to have more than 2,147,483,647 files in the directory being scanned for this to be a problem.  One way to mitigate this is to check, before adding or uploading files to this directory, how many are in it.  Set an upper limit of one million or even ten million files (I suspect this will cause severe performance issues before you even hit these limits), and refuse to add new files to the directory if the limit is reached, which will prevent any scripts from scanning them with too many files (although I do not believe it will be easy to get that number of files in a directory without someone noticing some severe performance degradation first).   ```  [Comment 14](show_bug.cgi?id=828051#c14)  swat30    2012-11-26 19:59:13 UTC  ``` This bug is now being flagged as "high severity" in PCI-DSS. Running CentOS 6 and haven't seen this one fixed yet.   ```  [Comment 15](show_bug.cgi?id=828051#c15)  Jan Lieskovsky    2012-11-27 10:56:00 UTC  ``` (In reply to [comment #14](show_bug.cgi?id=828051#c14)) > This bug is now being flagged as "high severity" in PCI-DSS. Running CentOS > 6 and haven't seen this one fixed yet.  See statement in c#9 of this bug / <https://access.redhat.com/security/cve/CVE-2012-2688>.   ```  [Comment 16](show_bug.cgi?id=828051#c16)  errata-xmlrpc    2013-02-21 10:14:09 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2013:0514 <https://rhn.redhat.com/errata/RHSA-2013-0514.html>   ```  [Comment 20](show_bug.cgi?id=828051#c20)  errata-xmlrpc    2013-09-30 22:12:11 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 5  Via RHSA-2013:1307 <https://rhn.redhat.com/errata/RHSA-2013-1307.html>   ```  [Comment 22](show_bug.cgi?id=828051#c22)  Huzaifa S. Sidhpurwala    2013-10-03 10:58:03 UTC  ``` Statement:  (none)   ```  [Comment 25](show_bug.cgi?id=828051#c25)  errata-xmlrpc    2013-12-11 02:25:51 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 5  Via RHSA-2013:1814 <https://rhn.redhat.com/errata/RHSA-2013-1814.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=828051&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugzilla.novell.com_0d2b523b_20250126_100729.html ===




=== Content from bugzilla.redhat.com_6c68617f_20250126_100753.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D789468)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D789468)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D789468)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 789468

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 789468**](show_bug.cgi?id=789468)
(CVE-2012-0831)
- [CVE-2012-0831](https://access.redhat.com/security/cve/CVE-2012-0831) php: PG(magic\_quote\_gpc) was not restored on shutdown

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-0831 php: PG(magic\_quote\_gpc) was not restored on shutdown

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-0831 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [790676](show_bug.cgi?id=790676 "CLOSED CURRENTRELEASE - CVE-2012-0831 php: PG(magic_quote_gpc) was not restored on shutdown [fedora-all]") [865986](show_bug.cgi?id=865986) [958614](show_bug.cgi?id=958614) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [789479](show_bug.cgi?id=789479) [855229](show_bug.cgi?id=855229) [952520](show_bug.cgi?id=952520) | | TreeView+ | [depends on](buglist.cgi?bug_id=789468&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=789468&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-02-10 20:39 UTC by Vincent Danen | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-24 13:10 UTC ([History](show_activity.cgi?id=789468)) | | [CC List:](page.cgi?id=fields.html#cclist) | 4 users (show)  btotty fedora jorton rpm | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2013-12-09 08:32:46 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2013:0514](https://access.redhat.com/errata/RHSA-2013%3A0514) | 0 | normal | SHIPPED\_LIVE | Moderate: php security, bug fix and enhancement update | 2013-02-20 21:29:20 UTC | | Red Hat Product Errata | [RHSA-2013:1307](https://access.redhat.com/errata/RHSA-2013%3A1307) | 0 | normal | SHIPPED\_LIVE | Moderate: php53 security, bug fix and enhancement update | 2013-10-01 00:31:22 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=789468#c0)  Vincent Danen    2012-02-10 20:39:37 UTC  ``` Common Vulnerabilities and Exposures assigned an identifier [CVE-2012-0831](https://access.redhat.com/security/cve/CVE-2012-0831) to the following vulnerability:  Name: [CVE-2012-0831](https://access.redhat.com/security/cve/CVE-2012-0831) URL: <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0831> Assigned: 20120119 Reference: <http://svn.php.net/viewvc?view=revision&revision=323016> Reference: <https://launchpadlibrarian.net/92454212/php5_5.3.2-1ubuntu4.13.diff.gz> Reference: UBUNTU:USN-1358-1 Reference: <http://www.ubuntu.com/usn/USN-1358-1> Reference: <http://www.securityfocus.com/bid/51954>  PHP before 5.3.10 does not properly perform a temporary change to the magic_quotes_gpc directive during the importing of environment variables, which makes it easier for remote attackers to conduct SQL injection attacks via a crafted request, related to main/php_variables.c, sapi/cgi/cgi_main.c, and sapi/fpm/fpm/fpm_main.c.   ```  [Comment 2](show_bug.cgi?id=789468#c2)  Huzaifa S. Sidhpurwala    2012-02-15 07:07:16 UTC  ``` There was a regression in the fix, which was released with php-5.3.10, more details at:  <https://bugs.php.net/bug.php?id=61043>   ```  [Comment 3](show_bug.cgi?id=789468#c3)  Huzaifa S. Sidhpurwala    2012-02-15 07:10:37 UTC  ``` Created php tracking bugs for this issue  Affects: fedora-all [[bug 790676](show_bug.cgi?id=790676 "CLOSED CURRENTRELEASE - CVE-2012-0831 php: PG(magic_quote_gpc) was not restored on shutdown [fedora-all]")]   ```  [Comment 6](show_bug.cgi?id=789468#c6)  Vincent Danen    2012-04-26 15:13:18 UTC  ``` PHP 5.3.11 fixed the regression noted in [comment #2](show_bug.cgi?id=789468#c2):  * Fixed [bug #61043](show_bug.cgi?id=61043 "CLOSED DUPLICATE - \"kmod: failed to exec /sbin/modprobe\" during hampton beta2 bootup") (Regression in magic_quotes_gpc fix for [CVE-2012-0831](https://access.redhat.com/security/cve/CVE-2012-0831)).  as per:  <http://www.php.net/archive/2012.php#id2012-04-26-1>   ```  [Comment 7](show_bug.cgi?id=789468#c7)  Fedora Update System    2012-05-07 02:48:42 UTC  ``` php-5.3.11-1.fc15, php-eaccelerator-0.9.6.1-9.fc15.3, maniadrive-1.2-32.fc15.3 has been pushed to the Fedora 15 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 8](show_bug.cgi?id=789468#c8)  Fedora Update System    2012-05-07 02:49:38 UTC  ``` php-5.3.11-1.fc16, php-eaccelerator-0.9.6.1-9.fc16.3, maniadrive-1.2-32.fc16.3 has been pushed to the Fedora 16 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 10](show_bug.cgi?id=789468#c10)  errata-xmlrpc    2013-02-21 10:13:51 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2013:0514 <https://rhn.redhat.com/errata/RHSA-2013-0514.html>   ```  [Comment 13](show_bug.cgi?id=789468#c13)  errata-xmlrpc    2013-09-30 22:12:03 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 5  Via RHSA-2013:1307 <https://rhn.redhat.com/errata/RHSA-2013-1307.html>   ```  [Comment 15](show_bug.cgi?id=789468#c15)  Huzaifa S. Sidhpurwala    2013-10-03 10:57:46 UTC  ``` Statement:  This issue does not affect the version of php as shipped with Red Hat Enterprise Linux 5.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=789468&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from lists.opensuse.org_e5b51d3b_20250125_160224.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/#B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW)

# [security-announce] SUSE-SU-2012:0472-1: important: Security update for PHP5

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

6 Apr
2012

6 Apr
'12

01:08

SUSE Security Update: Security update for PHP5
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2012:0472-1
Rating: important
References: #741520 #741859 #743308 #746661 #749111
Cross-References: CVE-2011-4153 CVE-2012-0057 CVE-2012-0807
CVE-2012-0831
Affected Products:
SUSE Linux Enterprise Software Development Kit 11 SP2
SUSE Linux Enterprise Server 11 SP2 for VMware
SUSE Linux Enterprise Server 11 SP2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves four vulnerabilities and has one
errata is now available.
Description:
This update of PHP5 fixes multiple security flaws:
\* CVE-2011-4153, missing checks of return values could
allow remote attackers to cause a denial of service (NULL
pointer dereference)
\* CVE-2012-0057, specially crafted XSLT stylesheets
could allow remote attackers to create arbitrary files with
arbitrary content
\* CVE-2012-0807, a stack based buffer overflow in
php5's Suhosin extension could allow remote attackers to
execute arbitrary code via a long string that is used in a
Set-Cookie HTTP header
\* CVE-2012-0831, temporary changes to the
magic\_quotes\_gpc directive during the importing of
environment variables is not properly performed which makes
it easier for remote attackers to conduct SQL injections
Security Issue references:
\* CVE-2011-4153
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4153>

...

\* CVE-2012-0057
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0057>

...

\* CVE-2012-0807
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0807>

...

\* CVE-2012-0831
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0831>

...

Patch Instructions:
To install this SUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- SUSE Linux Enterprise Software Development Kit 11 SP2:
zypper in -t patch sdksp2-apache2-mod\_php53-5958
- SUSE Linux Enterprise Server 11 SP2 for VMware:
zypper in -t patch slessp2-apache2-mod\_php53-5958
- SUSE Linux Enterprise Server 11 SP2:
zypper in -t patch slessp2-apache2-mod\_php53-5958
To bring your system up-to-date, use "zypper patch".
Package List:
- SUSE Linux Enterprise Software Development Kit 11 SP2 (i586 ia64 ppc64 s390x x86\_64):
php53-devel-5.3.8-0.23.1
php53-imap-5.3.8-0.23.1
php53-posix-5.3.8-0.23.1
php53-readline-5.3.8-0.23.1
php53-sockets-5.3.8-0.23.1
php53-sqlite-5.3.8-0.23.1
php53-tidy-5.3.8-0.23.1
- SUSE Linux Enterprise Server 11 SP2 for VMware (i586 x86\_64):
apache2-mod\_php53-5.3.8-0.23.1
php53-5.3.8-0.23.1
php53-bcmath-5.3.8-0.23.1
php53-bz2-5.3.8-0.23.1
php53-calendar-5.3.8-0.23.1
php53-ctype-5.3.8-0.23.1
php53-curl-5.3.8-0.23.1
php53-dba-5.3.8-0.23.1
php53-dom-5.3.8-0.23.1
php53-exif-5.3.8-0.23.1
php53-fastcgi-5.3.8-0.23.1
php53-fileinfo-5.3.8-0.23.1
php53-ftp-5.3.8-0.23.1
php53-gd-5.3.8-0.23.1
php53-gettext-5.3.8-0.23.1
php53-gmp-5.3.8-0.23.1
php53-iconv-5.3.8-0.23.1
php53-intl-5.3.8-0.23.1
php53-json-5.3.8-0.23.1
php53-ldap-5.3.8-0.23.1
php53-mbstring-5.3.8-0.23.1
php53-mcrypt-5.3.8-0.23.1
php53-mysql-5.3.8-0.23.1
php53-odbc-5.3.8-0.23.1
php53-openssl-5.3.8-0.23.1
php53-pcntl-5.3.8-0.23.1
php53-pdo-5.3.8-0.23.1
php53-pear-5.3.8-0.23.1
php53-pgsql-5.3.8-0.23.1
php53-pspell-5.3.8-0.23.1
php53-shmop-5.3.8-0.23.1
php53-snmp-5.3.8-0.23.1
php53-soap-5.3.8-0.23.1
php53-suhosin-5.3.8-0.23.1
php53-sysvmsg-5.3.8-0.23.1
php53-sysvsem-5.3.8-0.23.1
php53-sysvshm-5.3.8-0.23.1
php53-tokenizer-5.3.8-0.23.1
php53-wddx-5.3.8-0.23.1
php53-xmlreader-5.3.8-0.23.1
php53-xmlrpc-5.3.8-0.23.1
php53-xmlwriter-5.3.8-0.23.1
php53-xsl-5.3.8-0.23.1
php53-zip-5.3.8-0.23.1
php53-zlib-5.3.8-0.23.1
- SUSE Linux Enterprise Server 11 SP2 (i586 ia64 ppc64 s390x x86\_64):
apache2-mod\_php53-5.3.8-0.23.1
php53-5.3.8-0.23.1
php53-bcmath-5.3.8-0.23.1
php53-bz2-5.3.8-0.23.1
php53-calendar-5.3.8-0.23.1
php53-ctype-5.3.8-0.23.1
php53-curl-5.3.8-0.23.1
php53-dba-5.3.8-0.23.1
php53-dom-5.3.8-0.23.1
php53-exif-5.3.8-0.23.1
php53-fastcgi-5.3.8-0.23.1
php53-fileinfo-5.3.8-0.23.1
php53-ftp-5.3.8-0.23.1
php53-gd-5.3.8-0.23.1
php53-gettext-5.3.8-0.23.1
php53-gmp-5.3.8-0.23.1
php53-iconv-5.3.8-0.23.1
php53-intl-5.3.8-0.23.1
php53-json-5.3.8-0.23.1
php53-ldap-5.3.8-0.23.1
php53-mbstring-5.3.8-0.23.1
php53-mcrypt-5.3.8-0.23.1
php53-mysql-5.3.8-0.23.1
php53-odbc-5.3.8-0.23.1
php53-openssl-5.3.8-0.23.1
php53-pcntl-5.3.8-0.23.1
php53-pdo-5.3.8-0.23.1
php53-pear-5.3.8-0.23.1
php53-pgsql-5.3.8-0.23.1
php53-pspell-5.3.8-0.23.1
php53-shmop-5.3.8-0.23.1
php53-snmp-5.3.8-0.23.1
php53-soap-5.3.8-0.23.1
php53-suhosin-5.3.8-0.23.1
php53-sysvmsg-5.3.8-0.23.1
php53-sysvsem-5.3.8-0.23.1
php53-sysvshm-5.3.8-0.23.1
php53-tokenizer-5.3.8-0.23.1
php53-wddx-5.3.8-0.23.1
php53-xmlreader-5.3.8-0.23.1
php53-xmlrpc-5.3.8-0.23.1
php53-xmlwriter-5.3.8-0.23.1
php53-xsl-5.3.8-0.23.1
php53-zip-5.3.8-0.23.1
php53-zlib-5.3.8-0.23.1
References:
<http://support.novell.com/security/cve/CVE-2011-4153.html>
<http://support.novell.com/security/cve/CVE-2012-0057.html>
<http://support.novell.com/security/cve/CVE-2012-0807.html>
<http://support.novell.com/security/cve/CVE-2012-0831.html>
<https://bugzilla.novell.com/741520>
<https://bugzilla.novell.com/741859>
<https://bugzilla.novell.com/743308>
<https://bugzilla.novell.com/746661>
<https://bugzilla.novell.com/749111>
[http://download.novell.com/patch/finder/?keywords=5921434f37058d8a8c22718620...](http://download.novell.com/patch/finder/?keywords=5921434f37058d8a8c2271862091b332)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW/#B7GG5OPNT4NLVTVMJ5OHPPOH4CTI7FMW)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from launchpad.net_b63fbe3c_20250126_100751.html ===

[Log in / Register](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[php5 package](https://launchpad.net/ubuntu/%2Bsource/php5)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/php5)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/php5)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/php5)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/php5)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/php5)

# php5 5.3.2-1ubuntu4.13 source package in Ubuntu

## Changelog

```
php5 (5.3.2-1ubuntu4.13) lucid-security; urgency=low

  * SECURITY UPDATE: memory allocation failure denial of service
    - debian/patches/php5-CVE-2011-4153.patch: check result of
      zend_strdup() and calloc() for failed allocations
    - CVE-2011-4153
  * SECURITY UPDATE: predictable hash collision denial of service
    (LP: [#910296](/bugs/910296))
    - debian/patches/php5-CVE-2011-4885.patch: add max_input_vars
      directive with default limit of 1000
    - ATTENTION: this update changes previous php5 behavior by
      limiting the number of external input variables to 1000.
      This may be increased by adding a "max_input_vars"
      directive to the php.ini configuration file. See
      http://www.php.net/manual/en/info.configuration.php#ini.max-input-vars
      for more information.
    - CVE-2011-4885
  * SECURITY UPDATE: remote code execution vulnerability introduced by
    the fix for CVE-2011-4885 (LP: [#925772](/bugs/925772))
    - debian/patches/php5-CVE-2012-0830.patch: return rather than
      continuing if max_input_vars limit is reached
    - CVE-2012-0830
  * SECURITY UPDATE: XSLT arbitrary file overwrite attack
    - debian/patches/php5-CVE-2012-0057.patch: add xsl.security_prefs
      ini option to define forbidden operations within XSLT stylesheets
    - CVE-2012-0057
  * SECURITY UPDATE: PDORow session denial of service
    - debian/patches/php5-CVE-2012-0788.patch: fail gracefully when
      attempting to serialize PDORow instances
    - CVE-2012-0788
  * SECURITY UPDATE: magic_quotes_gpc remote disable vulnerability
    - debian/patches/php5-CVE-2012-0831.patch: always restore
      magic_quote_gpc on request shutdown
    - CVE-2012-0831
  * SECURITY UPDATE: arbitrary files removal via cronjob
    - debian/php5-common.php5.cron.d: take greater care when removing
      session files (overlooked in a previous update).
    - http://git.debian.org/?p=pkg-php%2Fphp.git;a=commitdiff_plain;h=d09fd04ed7bfcf7f008360c6a42025108925df09
    - CVE-2011-0441
 -- Steve Beattie <email address hidden>   Wed, 08 Feb 2012 20:55:57 -0800
```

## Upload details

Uploaded by:
[Steve Beattie](/~sbeattie)
on 2012-02-09

Uploaded to:
[Lucid](/ubuntu/lucid)

Original maintainer:
[Ubuntu Developers](/~ubuntu-devel-discuss-lists)

Architectures:
any

Section:
php

Urgency:
Low Urgency

## [See full publishing history](%2Bpublishinghistory) Publishing

| Series | Pocket | Published | Component | Section |
| --- | --- | --- | --- | --- |

## Builds

[Lucid](/ubuntu/lucid):
![[FULLYBUILT]](/@@/build-success "Successfully built")
[amd64](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/3198012)
![[FULLYBUILT]](/@@/build-success "Successfully built")
[armel](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/3198013)
![[FULLYBUILT]](/@@/build-success "Successfully built")
[i386](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/3198014)
![[FULLYBUILT]](/@@/build-success "Successfully built")
[ia64](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/3198015)
![[FULLYBUILT]](/@@/build-success "Successfully built")
[powerpc](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/3198016)
![[FULLYBUILT]](/@@/build-success "Successfully built")
[sparc](/~ubuntu-security/%2Barchive/ubuntu/ppa/%2Bbuild/3198017)

## Downloads

| File | Size | SHA-256 Checksum |
| --- | --- | --- |
| [php5\_5.3.2.orig.tar.gz](https://launchpad.net/ubuntu/%2Barchive/primary/%2Bsourcefiles/php5/5.3.2-1ubuntu4.13/php5_5.3.2.orig.tar.gz) | 13.1 MiB | a61f02b3b0a83c5a5b8b71a55c5760d1fb7290f1ec84eef1bdb8e8850a828f2f |
| [php5\_5.3.2-1ubuntu4.13.diff.gz](https://launchpad.net/ubuntu/%2Barchive/primary/%2Bsourcefiles/php5/5.3.2-1ubuntu4.13/php5_5.3.2-1ubuntu4.13.diff.gz) | 239.6 KiB | c8728c24d71d415eed090c02cdb48cf5459159048afb5e83792338ef5f66e662 |
| [php5\_5.3.2-1ubuntu4.13.dsc](https://launchpad.net/ubuntu/%2Barchive/primary/%2Bsourcefiles/php5/5.3.2-1ubuntu4.13/php5_5.3.2-1ubuntu4.13.dsc) | 3.1 KiB | cab3eb0cc1523b0a738ba1670809ddcc292a1376619bffb2699730f725533cbd |

### Available diffs

* [diff from 5.3.2-1ubuntu4.12 to 5.3.2-1ubuntu4.13](http://launchpadlibrarian.net/92454215/php5_5.3.2-1ubuntu4.12_5.3.2-1ubuntu4.13.diff.gz) (1.2 KiB)

[View changes file](http://launchpadlibrarian.net/92454216/php5_5.3.2-1ubuntu4.13_source.changes)

## Binary packages built by this source

[libapache2-mod-php5](/ubuntu/lucid/%2Bpackage/libapache2-mod-php5):
No summary available for libapache2-mod-php5 in ubuntu lucid.

No description available for libapache2-mod-php5 in ubuntu lucid.

[libapache2-mod-php5filter](/ubuntu/lucid/%2Bpackage/libapache2-mod-php5filter):
No summary available for libapache2-mod-php5filter in ubuntu lucid.

No description available for libapache2-mod-php5filter in ubuntu lucid.

[php-pear](/ubuntu/lucid/%2Bpackage/php-pear):
No summary available for php-pear in ubuntu lucid.

No description available for php-pear in ubuntu lucid.

[php5](/ubuntu/lucid/%2Bpackage/php5):
No summary available for php5 in ubuntu lucid.

No description available for php5 in ubuntu lucid.

[php5-cgi](/ubuntu/lucid/%2Bpackage/php5-cgi):
No summary available for php5-cgi in ubuntu lucid.

No description available for php5-cgi in ubuntu lucid.

[php5-cli](/ubuntu/lucid/%2Bpackage/php5-cli):
No summary available for php5-cli in ubuntu lucid.

No description available for php5-cli in ubuntu lucid.

[php5-common](/ubuntu/lucid/%2Bpackage/php5-common):
No summary available for php5-common in ubuntu lucid.

No description available for php5-common in ubuntu lucid.

[php5-curl](/ubuntu/lucid/%2Bpackage/php5-curl):
No summary available for php5-curl in ubuntu lucid.

No description available for php5-curl in ubuntu lucid.

[php5-dbg](/ubuntu/lucid/%2Bpackage/php5-dbg):
No summary available for php5-dbg in ubuntu lucid.

No description available for php5-dbg in ubuntu lucid.

[php5-dev](/ubuntu/lucid/%2Bpackage/php5-dev):
No summary available for php5-dev in ubuntu lucid.

No description available for php5-dev in ubuntu lucid.

[php5-enchant](/ubuntu/lucid/%2Bpackage/php5-enchant):
No summary available for php5-enchant in ubuntu lucid.

No description available for php5-enchant in ubuntu lucid.

[php5-gd](/ubuntu/lucid/%2Bpackage/php5-gd):
No summary available for php5-gd in ubuntu lucid.

No description available for php5-gd in ubuntu lucid.

[php5-gmp](/ubuntu/lucid/%2Bpackage/php5-gmp):
No summary available for php5-gmp in ubuntu lucid.

No description available for php5-gmp in ubuntu lucid.

[php5-intl](/ubuntu/lucid/%2Bpackage/php5-intl):
No summary available for php5-intl in ubuntu lucid.

No description available for php5-intl in ubuntu lucid.

[php5-ldap](/ubuntu/lucid/%2Bpackage/php5-ldap):
No summary available for php5-ldap in ubuntu lucid.

No description available for php5-ldap in ubuntu lucid.

[php5-mysql](/ubuntu/lucid/%2Bpackage/php5-mysql):
No summary available for php5-mysql in ubuntu lucid.

No description available for php5-mysql in ubuntu lucid.

[php5-odbc](/ubuntu/lucid/%2Bpackage/php5-odbc):
No summary available for php5-odbc in ubuntu lucid.

No description available for php5-odbc in ubuntu lucid.

[php5-pgsql](/ubuntu/lucid/%2Bpackage/php5-pgsql):
No summary available for php5-pgsql in ubuntu lucid.

No description available for php5-pgsql in ubuntu lucid.

[php5-pspell](/ubuntu/lucid/%2Bpackage/php5-pspell):
No summary available for php5-pspell in ubuntu lucid.

No description available for php5-pspell in ubuntu lucid.

[php5-recode](/ubuntu/lucid/%2Bpackage/php5-recode):
No summary available for php5-recode in ubuntu lucid.

No description available for php5-recode in ubuntu lucid.

[php5-snmp](/ubuntu/lucid/%2Bpackage/php5-snmp):
No summary available for php5-snmp in ubuntu lucid.

No description available for php5-snmp in ubuntu lucid.

[php5-sqlite](/ubuntu/lucid/%2Bpackage/php5-sqlite):
No summary available for php5-sqlite in ubuntu lucid.

No description available for php5-sqlite in ubuntu lucid.

[php5-sybase](/ubuntu/lucid/%2Bpackage/php5-sybase):
No summary available for php5-sybase in ubuntu lucid.

No description available for php5-sybase in ubuntu lucid.

[php5-tidy](/ubuntu/lucid/%2Bpackage/php5-tidy):
No summary available for php5-tidy in ubuntu lucid.

No description available for php5-tidy in ubuntu lucid.

[php5-xmlrpc](/ubuntu/lucid/%2Bpackage/php5-xmlrpc):
No summary available for php5-xmlrpc in ubuntu lucid.

No description available for php5-xmlrpc in ubuntu lucid.

[php5-xsl](/ubuntu/lucid/%2Bpackage/php5-xsl):
No summary available for php5-xsl in ubuntu lucid.

No description available for php5-xsl in ubuntu lucid.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from support.apple.com_92ee511a_20250125_160231.html ===


* [Apple](https://www.apple.com/)
* + [Store](https://www.apple.com/us/shop/goto/store)
  + [Mac](https://www.apple.com/mac/)
  + [iPad](https://www.apple.com/ipad/)
  + [iPhone](https://www.apple.com/iphone/)
  + [Watch](https://www.apple.com/watch/)
  + [Vision](https://www.apple.com/apple-vision-pro/)
  + [AirPods](https://www.apple.com/airpods/)
  + [TV & Home](https://www.apple.com/tv-home/)
  + [Entertainment](https://www.apple.com/entertainment/)
  + [Accessories](https://www.apple.com/us/shop/goto/buy_accessories)
  + [Support](https://support.apple.com/?cid=gn-ols-home-hp-tab)
* 0+

# About the security content of OS X Mountain Lion v10.8.2, OS X Lion v10.7.5 and Security Update 2012-004

Learn about the security content of OS X Mountain Lion v10.8.2, OS X Lion v10.7.5 and Security Update 2012-004.

This document describes the security content of OS X Mountain Lion v10.8.2, OS X Lion v10.7.5, and Security Update 2012-004.

For the protection of our customers, Apple does not disclose, discuss, or confirm security issues until a full investigation has occurred and any necessary patches or releases are available. To learn more about Apple Product Security, see the [Apple Product Security](http://www.apple.com/support/security/) website.

For information about the Apple Product Security PGP Key, see "[How to use the Apple Product Security PGP Key](http://support.apple.com/kb/HT1620)."

Where possible, [CVE IDs](http://cve.mitre.org/about/) are used to reference the vulnerabilities for further information.

To learn about other Security Updates, see "[Apple Security Updates](http://support.apple.com/kb/HT1222)".

## OS X Mountain Lion v10.8.2, OS X Lion v10.7.5 and Security Update 2012-004

**Note**: OS X Mountain Lion v10.8.2 includes the content of Safari 6.0.1. For further details see [About the security content of Safari 6.0.1](http://support.apple.com/kb/HT5502).

* **Apache**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Multiple vulnerabilities in Apache

  Description: Apache is updated to version 2.2.22 to address several vulnerabilities, the most serious of which may lead to a denial of service. Further information is available via the Apache web site at <http://httpd.apache.org/>. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2011-3368

  CVE-2011-3607

  CVE-2011-4317

  CVE-2012-0021

  CVE-2012-0031

  CVE-2012-0053

* **BIND**

  Available for: OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: A remote attacker may be able to cause a denial of service in systems configured to run BIND as a DNS nameserver

  Description: A reachable assertion issue existed in the handling of DNS records. This issue was addressed by updating to BIND 9.7.6-P1. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2011-4313

* **BIND**

  Available for: OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4, OS X Mountain Lion v10.8 and v10.8.1

  Impact: A remote attacker may be able to cause a denial of service, data corruption, or obtain sensitive information from process memory in systems configured to run BIND as a DNS nameserver

  Description: A memory management issue existed in the handling of DNS records. This issue was addressed by updating to BIND 9.7.6-P1 on OS X Lion systems, and BIND 9.8.3-P1 on OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-1667

* **CoreText**

  Available for: OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Applications that use CoreText may be vulnerable to an unexpected application termination or arbitrary code execution

  Description: A bounds checking issue existed in the handling of text glyphs, which may lead to out of bounds memory reads or writes. This issue was addressed through improved bounds checking. This issue does not affect Mac OS X v10.6 or OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-3716 : Jesse Ruderman of Mozilla Corporation

* **Data Security**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4, OS X Mountain Lion v10.8 and v10.8.1

  Impact: An attacker with a privileged network position may intercept user credentials or other sensitive information

  Description: TrustWave, a trusted root CA, has issued, and subsequently revoked, a sub-CA certificate from one of its trusted anchors. This sub-CA facilitated the interception of communications secured by Transport Layer Security (TLS). This update adds the involved sub-CA certificate to OS X's list of untrusted certificates.

* **DirectoryService**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8

  Impact: If the DirectoryService Proxy is used, a remote attacker may cause a denial of service or arbitrary code execution

  Description: A buffer overflow existed in the DirectoryService Proxy. This issue was addressed through improved bounds checking. This issue does not affect OS X Lion and Mountain Lion systems.

  CVE-ID

  CVE-2012-0650 : aazubel working with HP's Zero Day Initiative

* **ImageIO**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing a maliciously crafted PNG image may lead to an unexpected application termination or arbitrary code execution

  Description: Multiple memory corruption issues existed in libpng's handling of PNG images. These issues were addressed through improved validation of PNG images. These issues do not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2011-3026 : Jüri Aedla

  CVE-2011-3048

* **ImageIO**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing a maliciously crafted TIFF image may lead to an unexpected application termination or arbitrary code execution

  Description: An integer overflow issue existed in libTIFF's handling of TIFF images. This issue was addressed through improved validation of TIFF images. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-1173 : Alexander Gavrun working with HP's Zero Day Initiative

* **Installer**

  Available for: OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Remote admins and persons with physical access to the system may obtain account information

  Description: The fix for CVE-2012-0652 in OS X Lion 10.7.4 prevented user passwords from being recorded in the system log, but did not remove the old log entries. This issue was addressed by deleting log files that contained passwords. This issue does not affect Mac OS X 10.6 or OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-0652

* **International Components for Unicode**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Applications that use ICU may be vulnerable to an unexpected application termination or arbitrary code execution

  Description: A stack buffer overflow existed in the handling of ICU locale IDs. This issue was addressed through improved bounds checking. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2011-4599

* **Kernel**

  Available for: OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: A malicious program could bypass sandbox restrictions

  Description: A logic issue existed in the handling of debug system calls. This may allow a malicious program to gain code execution in other programs with the same user privileges. This issue was addressed by disabling handling of addresses in PT\_STEP and PT\_CONTINUE. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-0643 : iOS Jailbreak Dream Team

* **LoginWindow**

  Available for: OS X Mountain Lion v10.8 and v10.8.1

  Impact: A local user may be able to obtain other user's login passwords

  Description: A user-installed input method could intercept password keystrokes from Login Window or Screen Saver Unlock. This issue was addressed by preventing user-installed methods from being used when the system is handling login information.

  CVE-ID

  CVE-2012-3718: Lukhnos Liu

* **Mail**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing an e-mail message may lead to execution of web plugins

  Description: An input validation error existed in Mail's handling of embedded web plugins. This issue was addressed by disabling third-party plug-ins in Mail. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-3719 : Will Dormann of the CERT/CC

* **Mobile Accounts**

  Available for: OS X Mountain Lion v10.8 and v10.8.1

  Impact: A user with access to the contents of a mobile account may obtain the account password

  Description: Creating a mobile account saved a hash of the password in the account, which was used to login when the mobile account was used as an external account. The password hash could be used to determine the user's password. This issue was addressed by creating the password hash only if external accounts are enabled on the system where the mobile account is created.

  CVE-ID

  CVE-2012-3720 : Harald Wagener of Google, Inc.

* **PHP**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4, OS X Mountain Lion v10.8 and v10.8.1

  Impact: Multiple vulnerabilities in PHP

  Description: >PHP is updated to version 5.3.15 to address multiple vulnerabilities, the most serious of which may lead to arbitrary code execution. Further information is available via the PHP web site at <http://www.php.net>

  CVE-ID

  CVE-2012-0831

  CVE-2012-1172

  CVE-2012-1823

  CVE-2012-2143

  CVE-2012-2311

  CVE-2012-2386

  CVE-2012-2688

* **PHP**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: PHP scripts which use libpng may be vulnerable to an unexpected application termination or arbitrary code execution

  Description: A memory corruption issue existed in the handling of PNG files. This issue was addressed by updating PHP's copy of libpng to version 1.5.10. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2011-3048

* **Profile Manager**

  Available for: OS X Lion Server v10.7 to v10.7.4

  Impact: An unauthenticated user could enumerate managed devices

  Description: An authentication issue existed in the Device Management private interface. This issue was addressed by removing the interface.

  This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-3721 : Derick Cassidy of XEquals Corporation

* **QuickLook**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing a maliciously crafted .pict file may lead to an unexpected application termination or arbitrary code execution

  Description: A memory corruption issue existed in the handling of .pict files. This issue was addressed through improved validation of .pict files. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-0671 : Rodrigo Rubira Branco (twitter.com/bsdaemon) from the Qualys Vulnerability & Malware Research Labs (VMRL)

* **QuickTime**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing a maliciously crafted movie file may lead to an unexpected application termination or arbitrary code execution

  Description: An integer overflow existed in QuickTime's handling of sean atoms. This issue was addressed through improved bounds checking. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-0670 : Tom Gallagher (Microsoft) and Paul Bates (Microsoft) working with HP's Zero Day Initiative

* **QuickTime**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing a maliciously crafted movie file may lead to an unexpected application termination or arbitrary code execution

  Description: An uninitialized memory access existed in the handling of Sorenson encoded movie files. This issue was addressed through improved memory initialization. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-3722 : Will Dormann of the CERT/CC

* **QuickTime**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Viewing a maliciously crafted movie file may lead to an unexpected application termination or arbitrary code execution

  Description: A buffer overflow existed in the handling of RLE encoded movie files. This issue was addressed through improved bounds checking. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-0668 : Luigi Auriemma working with HP's Zero Day Initiative

* **Ruby**

  Available for: Mac OS X v10.6.8, Mac OS X Server v10.6.8, OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: An attacker may be able to decrypt data protected by SSL

  Description: There are known attacks on the confidentiality of SSL 3.0 and TLS 1.0 when a cipher suite uses a block cipher in CBC mode. The Ruby OpenSSL module disabled the 'empty fragment' countermeasure which prevented these attacks. This issue was addressed by enabling empty fragments. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2011-3389

* **USB**

  Available for: OS X Lion v10.7 to v10.7.4, OS X Lion Server v10.7 to v10.7.4

  Impact: Attaching a USB device may lead to an unexpected system termination or arbitrary code execution

  Description: A memory corruption issue existed in the handling of USB hub descriptors. This issue was addressed through improved handling of the bNbrPorts descriptor field. This issue does not affect OS X Mountain Lion systems.

  CVE-ID

  CVE-2012-3723 : Andy Davis of NGS Secure

Information about products not manufactured by Apple, or independent websites not controlled or tested by Apple, is provided without recommendation or endorsement. Apple assumes no responsibility with regard to the selection, performance, or use of third-party websites or products. Apple makes no representations regarding third-party website accuracy or reliability. [Contact the vendor](https://support.apple.com/103190) for additional information.

Published Date: November 03, 2023

Helpful?

Yes

No

Character limit:
250

Maximum character limit is 250.

Please don’t include any personal information in your comment.
Submit

Thanks for your feedback.

## Apple Footer

[
Apple](https://www.apple.com)

1. [Support](https://support.apple.com)
2. About the security content of OS X Mountain Lion v10.8.2, OS X Lion v10.7.5 and Security Update 2012-004

[United States](https://support.apple.com/en-us/103357/localeselector "Choose your country or region")

Copyright © 2025 Apple Inc. All rights reserved.
 [Privacy Policy](https://www.apple.com/legal/privacy/en-ww/) [Terms of Use](https://www.apple.com/legal/internet-services/terms/site.html) [Sales and Refunds](https://www.apple.com/shop/goto/help/sales_refunds) [Site Map](https://www.apple.com/sitemap/)



=== Content from secunia.com_0a4da5a9_20250125_160228.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.novell.com_61bddca7_20250126_100710.html ===




=== Content from secunia.com_cbe07115_20250125_160226.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.novell.com_6e1fbaea_20250126_100737.html ===




=== Content from lists.opensuse.org_5fcee49f_20250125_160223.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/#Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN)

# [security-announce] SUSE-SU-2012:0411-1: important: Security update for PHP5

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

24 Mar
2012

24 Mar
'12

02:08

SUSE Security Update: Security update for PHP5
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2012:0411-1
Rating: important
References: #741520 #741859 #742273 #742806 #743308 #744966
#746661 #749111
Cross-References: CVE-2011-4153 CVE-2011-4885 CVE-2012-0057
CVE-2012-0781 CVE-2012-0788 CVE-2012-0789
CVE-2012-0807 CVE-2012-0830 CVE-2012-0831
Affected Products:
SUSE Linux Enterprise Server 10 SP4
SLE SDK 10 SP4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 9 vulnerabilities is now available.
Description:
This update of php5 fixes multiple security flaws:
\* CVE-2011-4153, missing checks of return values could
allow remote attackers to cause a denial of service (NULL
pointer dereference)
\* CVE-2011-4885, denial of service via hash collisions
\* CVE-2012-0057, specially crafted XSLT stylesheets
could allow remote attackers to create arbitrary files with
arbitrary content
\* CVE-2012-0781, remote attackers can cause a denial of
service via specially crafted input to an application that
attempts to perform Tidy::diagnose operations
\* CVE-2012-0788, applications that use a PDO driver
were prone to denial of service flaws which could be
exploited remotely
\* CVE-2012-0789, memory leak in the timezone
functionality could allow remote attackers to cause a
denial of service (memory consumption)
\* CVE-2012-0807, a stack based buffer overflow in
php5's Suhosin extension could allow remote attackers to
execute arbitrary code via a long string that is used in a
Set-Cookie HTTP header
\* CVE-2012-0830, this fixes an incorrect fix for
CVE-2011-4885 which could allow remote attackers to execute
arbitrary code via a request containing a large number of
variables
\* CVE-2012-0831, temporary changes to the
magic\_quotes\_gpc directive during the importing of
environment variables is not properly performed which makes
it easier for remote attackers to conduct SQL injections
Security Issue references:
\* CVE-2011-4153
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4153>

...

\* CVE-2011-4885
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4885>

...

\* CVE-2012-0057
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0057>

...

\* CVE-2012-0781
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0781>

...

\* CVE-2012-0788
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0788>

...

\* CVE-2012-0789
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0789>

...

\* CVE-2012-0807
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0807>

...

\* CVE-2012-0830
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0830>

...

\* CVE-2012-0831
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0831>

...

Package List:
- SUSE Linux Enterprise Server 10 SP4 (i586 ia64 ppc s390x x86\_64):
apache2-mod\_php5-5.2.14-0.26.3
php5-5.2.14-0.26.3
php5-bcmath-5.2.14-0.26.3
php5-bz2-5.2.14-0.26.3
php5-calendar-5.2.14-0.26.3
php5-ctype-5.2.14-0.26.3
php5-curl-5.2.14-0.26.3
php5-dba-5.2.14-0.26.3
php5-dbase-5.2.14-0.26.3
php5-devel-5.2.14-0.26.3
php5-dom-5.2.14-0.26.3
php5-exif-5.2.14-0.26.3
php5-fastcgi-5.2.14-0.26.3
php5-ftp-5.2.14-0.26.3
php5-gd-5.2.14-0.26.3
php5-gettext-5.2.14-0.26.3
php5-gmp-5.2.14-0.26.3
php5-hash-5.2.14-0.26.3
php5-iconv-5.2.14-0.26.3
php5-imap-5.2.14-0.26.3
php5-json-5.2.14-0.26.3
php5-ldap-5.2.14-0.26.3
php5-mbstring-5.2.14-0.26.3
php5-mcrypt-5.2.14-0.26.3
php5-mhash-5.2.14-0.26.3
php5-mysql-5.2.14-0.26.3
php5-ncurses-5.2.14-0.26.3
php5-odbc-5.2.14-0.26.3
php5-openssl-5.2.14-0.26.3
php5-pcntl-5.2.14-0.26.3
php5-pdo-5.2.14-0.26.3
php5-pear-5.2.14-0.26.3
php5-pgsql-5.2.14-0.26.3
php5-posix-5.2.14-0.26.3
php5-pspell-5.2.14-0.26.3
php5-shmop-5.2.14-0.26.3
php5-snmp-5.2.14-0.26.3
php5-soap-5.2.14-0.26.3
php5-sockets-5.2.14-0.26.3
php5-sqlite-5.2.14-0.26.3
php5-suhosin-5.2.14-0.26.3
php5-sysvmsg-5.2.14-0.26.3
php5-sysvsem-5.2.14-0.26.3
php5-sysvshm-5.2.14-0.26.3
php5-tokenizer-5.2.14-0.26.3
php5-wddx-5.2.14-0.26.3
php5-xmlreader-5.2.14-0.26.3
php5-xmlrpc-5.2.14-0.26.3
php5-xsl-5.2.14-0.26.3
php5-zlib-5.2.14-0.26.3
- SLE SDK 10 SP4 (i586 ia64 ppc s390x x86\_64):
apache2-mod\_php5-5.2.14-0.26.3
php5-5.2.14-0.26.3
php5-bcmath-5.2.14-0.26.3
php5-bz2-5.2.14-0.26.3
php5-calendar-5.2.14-0.26.3
php5-ctype-5.2.14-0.26.3
php5-curl-5.2.14-0.26.3
php5-dba-5.2.14-0.26.3
php5-dbase-5.2.14-0.26.3
php5-devel-5.2.14-0.26.3
php5-dom-5.2.14-0.26.3
php5-exif-5.2.14-0.26.3
php5-fastcgi-5.2.14-0.26.3
php5-ftp-5.2.14-0.26.3
php5-gd-5.2.14-0.26.3
php5-gettext-5.2.14-0.26.3
php5-gmp-5.2.14-0.26.3
php5-hash-5.2.14-0.26.3
php5-iconv-5.2.14-0.26.3
php5-imap-5.2.14-0.26.3
php5-ldap-5.2.14-0.26.3
php5-mbstring-5.2.14-0.26.3
php5-mcrypt-5.2.14-0.26.3
php5-mhash-5.2.14-0.26.3
php5-mysql-5.2.14-0.26.3
php5-ncurses-5.2.14-0.26.3
php5-odbc-5.2.14-0.26.3
php5-openssl-5.2.14-0.26.3
php5-pcntl-5.2.14-0.26.3
php5-pdo-5.2.14-0.26.3
php5-pear-5.2.14-0.26.3
php5-pgsql-5.2.14-0.26.3
php5-posix-5.2.14-0.26.3
php5-pspell-5.2.14-0.26.3
php5-shmop-5.2.14-0.26.3
php5-snmp-5.2.14-0.26.3
php5-soap-5.2.14-0.26.3
php5-sockets-5.2.14-0.26.3
php5-sqlite-5.2.14-0.26.3
php5-suhosin-5.2.14-0.26.3
php5-sysvmsg-5.2.14-0.26.3
php5-sysvsem-5.2.14-0.26.3
php5-sysvshm-5.2.14-0.26.3
php5-tidy-5.2.14-0.26.3
php5-tokenizer-5.2.14-0.26.3
php5-wddx-5.2.14-0.26.3
php5-xmlreader-5.2.14-0.26.3
php5-xmlrpc-5.2.14-0.26.3
php5-xsl-5.2.14-0.26.3
php5-zlib-5.2.14-0.26.3
References:
<http://support.novell.com/security/cve/CVE-2011-4153.html>
<http://support.novell.com/security/cve/CVE-2011-4885.html>
<http://support.novell.com/security/cve/CVE-2012-0057.html>
<http://support.novell.com/security/cve/CVE-2012-0781.html>
<http://support.novell.com/security/cve/CVE-2012-0788.html>
<http://support.novell.com/security/cve/CVE-2012-0789.html>
<http://support.novell.com/security/cve/CVE-2012-0807.html>
<http://support.novell.com/security/cve/CVE-2012-0830.html>
<http://support.novell.com/security/cve/CVE-2012-0831.html>
<https://bugzilla.novell.com/741520>
<https://bugzilla.novell.com/741859>
<https://bugzilla.novell.com/742273>
<https://bugzilla.novell.com/742806>
<https://bugzilla.novell.com/743308>
<https://bugzilla.novell.com/744966>
<https://bugzilla.novell.com/746661>
<https://bugzilla.novell.com/749111>
[http://download.novell.com/patch/finder/?keywords=12fa3ee1e0074dc69ed195ba32...](http://download.novell.com/patch/finder/?keywords=12fa3ee1e0074dc69ed195ba32ed4339)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN/#Y3CWPIVCCW2544Z2G7KUI57DDYDNW6XN)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.novell.com_32bd5869_20250126_100750.html ===




=== Content from www.redhat.com_603c86d1_20250126_100755.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.novell.com_f13978b4_20250126_100734.html ===




=== Content from www.redhat.com_bd97fa53_20250126_100759.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from launchpadlibrarian.net_60004a66_20250125_160239.html ===
--- php5-5.3.2.orig/main/php\_version.h
+++ php5-5.3.2/main/php\_version.h
@@ -4,5 +4,5 @@
#define PHP\_MINOR\_VERSION 3
#define PHP\_RELEASE\_VERSION 2
#define PHP\_EXTRA\_VERSION ""
-#define PHP\_VERSION "5.3.2"
+#define PHP\_VERSION "5.3.2-1ubuntu1"
#define PHP\_VERSION\_ID 50302
--- php5-5.3.2.orig/debian/php5-sybase.postrm
+++ php5-5.3.2/debian/php5-sybase.postrm
@@ -0,0 +1,10 @@
+#!/bin/sh
+set -e
+
+NEW\_CONFFILE=/etc/php5/conf.d/mssql.ini
+if [ "$1" = "upgrade" ] && dpkg --compare-versions "$2" lt 5.2.3-2
+then
+ rm $NEW\_CONFFILE
+fi
+
+#DEBHELPER#
--- php5-5.3.2.orig/debian/php5-dev.files
+++ php5-5.3.2/debian/php5-dev.files
@@ -0,0 +1,6 @@
+usr/bin/php-config
+usr/bin/phpize
+usr/share/man/man1/php-config.1
+usr/share/man/man1/phpize.1
+usr/include
+usr/lib/php5/build
--- php5-5.3.2.orig/debian/source\_php5.py
+++ php5-5.3.2/debian/source\_php5.py
@@ -0,0 +1,57 @@
+#!/usr/bin/python
+
+'''PHP5 Apport interface
+
+Copyright (C) 2010 Canonical Ltd.
+Author: Chuck Short
+
+This program is free software; you can redistribute it and/or modify it
+under the terms of the GNU General Public License as published by the
+Free Software Foundation; either version 2 of the License, or (at your
+option) any later version. See http://www.gnu.org/copyleft/gpl.html for
+the full text of the license.
+'''
+
+import os
+import subprocess
+from apport.hookutils import \*
+
+def \_add\_my\_conf\_files(report, filename):
+ if not os.path.exists(filename):
+ return
+
+ key = 'PHPConf' + path\_to\_key(filename)
+ report[key] = ""
+ for line in read\_file(filename).split('\n'):
+ try:
+ if 'mysql.default\_password ' in line.split('=')[0]:
+ line = "%s = @@APPORTREPLACED@@" % (line.split('=')[0])
+ if 'mysqli.default\_pw ' in line.split('=')[0]:
+ line = "%s = @@APPORTREPLACED@@" % (line.split('=')[0])
+ if 'ifx.default\_password ' in line.split('=')[0]:
+ line = "%s = @@APPORTREPLACED@@" % (line.split('=')[0])
+ report[key] += line + '\n'
+ except IndexError:
+ continue
+
+def add\_info(report):
+ \_add\_my\_conf\_files(report, '/etc/php5/apache2/php.ini')
+ \_add\_my\_conf\_files(report, '/etc/php5/cli/php5.ini')
+
+ # packages in main
+ packages=['php5', 'php-common', 'libapache2-mod-php5', 'libapache2-mod-php5filter'
+ 'php5-cgi', 'php5-cli', 'php5-dev', 'php5-dbg', 'php-pear', 'php5-curl', 'php5-gd'
+ 'php5-gmp', 'php5-ldap', 'php5-mhash', 'php5-mysql', 'php5-odbc', 'php5-pgsql',
+ 'php5-pspell', 'php5-recode', 'php5-snmp', 'php5-sqlite', 'php5-sybase', 'php5-tidy',
+ 'php5-xmlrpc', 'php5-xsl']
+
+ versions = ''
+ for package in packages:
+ try:
+ version = packaging.get\_version(package)
+ except ValueError:
+ version = 'N/A'
+ if version is None:
+ version = 'N/A'
+ versions += '%s %s\n' %(package, version)
+ report['PHPInstalledModules'] = versions
--- php5-5.3.2.orig/debian/libapache2-mod-php5.postinst
+++ php5-5.3.2/debian/libapache2-mod-php5.postinst
@@ -0,0 +1,48 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+reload\_apache()
+{
+ if apache2ctl configtest 2>/dev/null; then
+ invoke-rc.d apache2 force-reload || true
+ else
+ echo "Your apache2 configuration is broken, so we're not restarting it for you."
+ fi
+}
+
+# we've registered a trigger to handle extension updates.
+if [ "$1" = "triggered" ] && [ "$2" = "/etc/php5/conf.d" ]; then
+ reload\_apache
+ exit 0
+elif [ "$1" != "configure" ]; then
+ exit 0
+fi
+
+phpini="/etc/php5/apache2/php.ini"
+
+ucf /usr/share/php5/php.ini-production $phpini
+
+if [ -n "$2" ]; then
+ # recover the previous state
+ if [ -e /etc/php5/apache2/.start ]; then
+ a2enmod php5 >/dev/null || true
+ rm -f /etc/php5/apache2/.start
+ fi
+# we're upgrading. test if we're enabled, and if so, restart to reload the module.
+ if [ -e /etc/apache2/mods-enabled/php5.load ]; then
+ reload\_apache
+ fi
+ exit 0
+fi
+
+if [ -e /etc/apache2/apache2.conf ]; then
+# Enable the module, but hide a2enmod's misleading message about apachectl
+# and force-reload the thing ourselves.
+ a2enmod php5 >/dev/null || true
+ reload\_apache
+fi
+
+exit 0
--- php5-5.3.2.orig/debian/php5-module.ini
+++ php5-5.3.2/debian/php5-module.ini
@@ -0,0 +1,2 @@
+; configuration for php @extname@ module
+extension=@dsoname@.so
--- php5-5.3.2.orig/debian/gbp.conf
+++ php5-5.3.2/debian/gbp.conf
@@ -0,0 +1,8 @@
+[DEFAULT]
+debian-branch = debian-sid
+debian-tag = debian/%(version)s
+upstream-branch = upstream-sid
+upstream-tag = upstream/%(version)s
+
+[git-dch]
+meta = 1
--- php5-5.3.2.orig/debian/php5-sapi.lintian-overrides
+++ php5-5.3.2/debian/php5-sapi.lintian-overrides
@@ -0,0 +1,6 @@
+# The extensions directory must exist, even if empty
+@sapi@: package-contains-empty-directory @extdir@/
+# Not a spelling mistake, just a compilation curiosity
+@sapi@: spelling-error-in-binary \* ment meant
+# Not a spelling mistake, tz code for Tahiti
+@sapi@: spelling-error-in-binary \* taht that
--- php5-5.3.2.orig/debian/php5-dev.dirs
+++ php5-5.3.2/debian/php5-dev.dirs
@@ -0,0 +1,2 @@
+/usr/bin
+/usr/share/lintian/overrides
--- php5-5.3.2.orig/debian/php5-sapi.links
+++ php5-5.3.2/debian/php5-sapi.links
@@ -0,0 +1 @@
+etc/php5/conf.d etc/php5/@sapi@/conf.d
--- php5-5.3.2.orig/debian/extramodulelist
+++ php5-5.3.2/debian/extramodulelist
@@ -0,0 +1,9 @@
+mysql MySQL mysqli
+mysql MySQL pdo\_mysql
+interbase InterBase/Firebird pdo\_firebird
+common PDO pdo
+odbc ODBC pdo\_odbc
+pgsql PostgreSQL pdo\_pgsql
+sqlite SQLite pdo\_sqlite
+sqlite SQLite3 sqlite3
+sybase Sybase pdo\_dblib
--- php5-5.3.2.orig/debian/libapache2-mod-php5.dirs
+++ php5-5.3.2/debian/libapache2-mod-php5.dirs
@@ -0,0 +1,3 @@
+/etc/apache2/mods-available
+/etc/php5/apache2
+/usr/lib/apache2/modules
--- php5-5.3.2.orig/debian/libapache2-mod-php5filter.prerm
+++ php5-5.3.2/debian/libapache2-mod-php5filter.prerm
@@ -0,0 +1,20 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "remove" -a "$1" != "purge" ]; then
+ exit 0
+fi
+
+if [ -e /etc/apache2/apache2.conf ]; then
+ if [ -e /etc/apache2/mods-enabled/php5.load ] && [ "$1" != "purge" ]; then
+ # set a flag to remember the original state
+ # useful when reinstalling the same version.
+ touch /etc/php5/apache2filter/.start
+ fi
+ a2dismod php5filter || true
+fi
+
+exit 0
--- php5-5.3.2.orig/debian/php5-common.docs
+++ php5-5.3.2/debian/php5-common.docs
@@ -0,0 +1,10 @@
+CREDITS
+EXTENSIONS
+TODO
+CODING\_STANDARDS
+README.SVN-RULES
+README.EXT\_SKEL
+README.SELF-CONTAINED-EXTENSIONS
+README.Zeus
+README.PHP4-TO-PHP5-THIN-CHANGES
+debian/README.Debian.security
--- php5-5.3.2.orig/debian/php5-common.dirs
+++ php5-5.3.2/debian/php5-common.dirs
@@ -0,0 +1,7 @@
+/usr/lib/php5/libexec
+/usr/share/lintian/overrides
+/usr/share/doc/php5-common/examples
+/usr/share/php5
+/var/lib/php5
+/usr/lib/php5
+/etc/php5/conf.d
--- php5-5.3.2.orig/debian/php-pear.dirs
+++ php5-5.3.2/debian/php-pear.dirs
@@ -0,0 +1 @@
+/usr/share/doc/php-pear/PEAR
--- php5-5.3.2.orig/debian/rules
+++ php5-5.3.2/debian/rules
@@ -0,0 +1,640 @@
+#!/usr/bin/make -f
+# Sample debian/rules that uses debhelper.
+# GNU copyright 1997 by Joey Hess.
+#
+# This version is for a hypothetical package that builds an
+# architecture-dependant package, as well as an architecture-independent
+# package.
+
+# Uncomment this to turn on verbose mode.
+#export DH\_VERBOSE=1
+
+# This has to be exported to make some magic below work.
+export DH\_OPTIONS
+
+# Set this flag to 'yes' if you want to disable all modifications breaking abi
+# compatibility to upstream
+PHP5\_COMPAT=no
+
+DEB\_HOST\_GNU\_TYPE ?= $(shell dpkg-architecture -qDEB\_HOST\_GNU\_TYPE)
+DEB\_BUILD\_GNU\_TYPE ?= $(shell dpkg-architecture -qDEB\_BUILD\_GNU\_TYPE)
+DEB\_HOST\_ARCH ?= $(shell dpkg-architecture -qDEB\_HOST\_ARCH)
+
+PHP5\_HOST\_GNU\_TYPE = $(subst gnulp,gnu,$(DEB\_HOST\_GNU\_TYPE))
+PHP5\_BUILD\_GNU\_TYPE = $(subst gnulp,gnu,$(DEB\_BUILD\_GNU\_TYPE))
+
+PHP5\_HOST\_GNU\_TYPE := $(shell echo $(PHP5\_HOST\_GNU\_TYPE) | sed 's/-gnu$$//')
+PHP5\_BUILD\_GNU\_TYPE := $(shell echo $(PHP5\_BUILD\_GNU\_TYPE) | sed 's/-gnu$$//')
+
+PHP5\_SOURCE\_VERSION = $(shell dpkg-parsechangelog | grep ^Version | sed "s/Version: //")
+PHP5\_UPSTREAM\_VERSION = $(shell echo $(PHP5\_SOURCE\_VERSION) | sed -e "s/-.\*//" -e "s/.\*://")
+PHP5\_DEBIAN\_REVISION = $(shell echo $(PHP5\_SOURCE\_VERSION) | sed "s/.\*-//")
+
+# specify some options to our patch system
+QUILT\_DIFF\_OPTS=-p
+QUILT\_NO\_DIFF\_TIMESTAMPS=1
+export QUILT\_DIFF\_OPTS QUILT\_NO\_DIFF\_TIMESTAMPS
+
+PROG\_SENDMAIL = /usr/sbin/sendmail
+ifeq (,$(findstring noopt,$(DEB\_BUILD\_OPTIONS)))
+ CFLAGS += -O2
+else
+ CFLAGS += -O0
+endif
+CFLAGS += -Wall -fsigned-char -fno-strict-aliasing
+# LFS support
+ifneq (yes,$(PHP5\_COMPAT))
+ CFLAGS += $(shell getconf LFS\_CFLAGS)
+endif
+
+# Enable IEEE-conformant floating point math on alphas (not the default)
+ifeq (alpha-linux-gnu,$(DEB\_HOST\_GNU\_TYPE))
+ CFLAGS += -mieee
+endif
+
+ifeq ($(DEB\_HOST\_GNU\_TYPE), $(findstring $(DEB\_HOST\_GNU\_TYPE), ia64-linux-gnu powerpc64-linux-gnu avr32-linux-gnu))
+ CFLAGS += -g
+else
+ CFLAGS += -gstabs
+endif
+
+# some other helpful (for readability at least) shorthand variables
+PHPIZE\_BUILDDIR = debian/php5-dev/usr/lib/php5/build
+
+# support new (>= 2.2) and older versions of libtool for backporting ease
+LIBTOOL\_DIRS = /usr/share/libtool/config /usr/share/libtool
+LTMAIN = $(firstword $(wildcard $(foreach d,$(LIBTOOL\_DIRS),$d/ltmain.sh)))
+LTMAIN\_DIR = $(dir $(LTMAIN))
+
+ifeq ($(LTMAIN\_DIR), /usr/share/libtool/)
+LIBTOOL\_CONFLICTS:=libtool (>= 2.2)
+else ifeq ($(LTMAIN\_DIR), /usr/share/libtool/config/)
+LIBTOOL\_CONFLICTS:=libtool (<< 2.2)
+else
+LIBTOOL\_CONFLICTS:=$(error "could not resolve path to ltmain.sh")
+endif
+
+ifneq (,$(filter parallel=%,$(DEB\_BUILD\_OPTIONS)))
+ NUMJOBS = $(patsubst parallel=%,%,$(filter parallel=%,$(DEB\_BUILD\_OPTIONS)))
+ MAKEFLAGS += -j$(NUMJOBS)
+endif
+
+# enable the hardening wrapper
+DEB\_BUILD\_HARDENING = 1
+# but disable PIE
+DEB\_BUILD\_HARDENING\_PIE = 0
+export DEB\_BUILD\_HARDENING DEB\_BUILD\_HARDENING\_PIE
+
+COMMON\_CONFIG=--build=$(DEB\_BUILD\_GNU\_TYPE) \
+ --host=$(DEB\_HOST\_GNU\_TYPE) \
+ --sysconfdir=/etc \
+ --mandir=/usr/share/man \
+ --disable-debug \
+ --with-regex=php \
+ --disable-rpath \
+ --disable-static \
+ --with-pic \
+ --with-layout=GNU \
+ --with-pear=/usr/share/php \
+ --enable-calendar \
+ --enable-sysvsem \
+ --enable-sysvshm \
+ --enable-sysvmsg \
+ --enable-bcmath \
+ --with-bz2 \
+ --enable-ctype \
+ --with-db4 \
+ --without-gdbm \
+ --with-iconv \
+ --enable-exif \
+ --enable-ftp \
+ --with-gettext \
+ --enable-mbstring \
+ --with-pcre-regex=/usr \
+ --enable-shmop \
+ --enable-sockets \
+ --enable-wddx \
+ --with-libxml-dir=/usr \
+ --with-zlib \
+ --with-kerberos=/usr \
+ --with-openssl=/usr \
+ --enable-soap \
+ --enable-zip \
+ --with-mhash=yes \
+ --with-exec-dir=/usr/lib/php5/libexec \
+ --with-system-tzdata
+
+BUILTIN\_EXTENSION\_CHECK=$$e=get\_loaded\_extensions(); natcasesort($$e); \
+ $$s="The following extensions are built in:"; \
+ foreach($$e as $$i) { $$s .= " $$i"; } \
+ echo("php:Extensions=" . wordwrap($$s . ".\n", 75, "\$${Newline} "));
+
+# include the patch/unpatch rules from quilt
+include /usr/share/quilt/quilt.make
+
+prepared: prepared-stamp
+prepared-stamp: $(QUILT\_STAMPFN)
+ dh\_testdir
+ sed -i -e 's/EXTRA\_VERSION=""/EXTRA\_VERSION="-$(PHP5\_DEBIAN\_REVISION)"/' configure.in
+ ./buildconf --force
+ touch prepared-stamp
+
+unprepared:
+ dh\_testdir
+ sed -i -e 's/EXTRA\_VERSION="-$(PHP5\_DEBIAN\_REVISION)"/EXTRA\_VERSION=""/' configure.in
+ rm -f prepared-stamp
+
+test-results.txt: build-apache2-stamp build-cli-stamp build-cgi-stamp
+ifeq (,$(findstring nocheck,$(DEB\_BUILD\_OPTIONS)))
+ mkdir -p temp\_session\_store
+ extensions=""; \
+ for f in $(CURDIR)/apache2-build/modules/\*.so; do \
+ ext=`basename "$$f"`; \
+ test -d "$(CURDIR)/ext/$${ext%.so}/tests" || continue; \
+ test ! -f "$(CURDIR)/ext/$${ext%.so}/tests/config.inc" || continue; \
+ test ! -f "$(CURDIR)/ext/$${ext%.so}/tests/README" || continue; \
+ test "$${ext#pdo}" = "$$ext" || test "$${ext#pdo}" = ".so" || continue; \
+ test "$$ext" != "mysql.so" || continue; \
+ test "$$ext" != "mysqli.so" || continue; \
+ test "$$ext" != "snmp.so" || continue; \
+ test "$$ext" != "interbase.so" || continue; \
+ extensions="$$extensions -d extension=$$ext"; \
+ done; \
+ [ "$$extensions" ] || { echo "extensions list is empty"; exit 1; }; \
+ env NO\_INTERACTION=1 TEST\_PHP\_CGI\_EXECUTABLE=$(CURDIR)/cgi-build/sapi/cgi/cgi-bin.php5 TEST\_PHP\_EXECUTABLE=$(CURDIR)/cli-build/sapi/cli/php $(CURDIR)/cli-build/sapi/cli/php run-tests.php -d extension\_dir=$(CURDIR)/apache2-build/modules/ $$extensions| tee test-results.txt
+ rm -rf temp\_session\_store
+ @for test in `find . -name '\*.log' -a '!' -name 'config.log'`; do \
+ echo; \
+ echo -n "$${test#./}:"; \
+ cat $$test; \
+ echo; \
+ done | tee -a test-results.txt
+else
+ echo 'nocheck found in DEB\_BUILD\_OPTIONS' | tee test-results.txt
+endif
+
+build: build-apache2-stamp build-apache2filter-stamp build-cgi-stamp build-cli-stamp build-pear-stamp test-results.txt
+
+build-apache2-stamp: configure-apache2-stamp
+ dh\_testdir
+ cd apache2-build && $(MAKE)
+
+ touch build-apache2-stamp
+
+build-apache2filter-stamp: configure-apache2filter-stamp
+ dh\_testdir
+ cd apache2filter-build && $(MAKE)
+
+ touch build-apache2filter-stamp
+
+build-cli-stamp: configure-cli-stamp
+ dh\_testdir
+ cd cli-build && $(MAKE)
+
+ touch build-cli-stamp
+
+
+build-cgi-stamp: configure-cgi-stamp
+ dh\_testdir
+ cd cgi-build && $(MAKE) && mv sapi/cgi/php-cgi sapi/cgi/cgi-bin.php5
+
+ # Dirty hack to not rebuild everything twice
+ cd cgi-build/main && \
+ sed -i -e 's/FORCE\_CGI\_REDIRECT 1/FORCE\_CGI\_REDIRECT 0/' \
+ -e 's/DISCARD\_PATH 0/DISCARD\_PATH 1/' php\_config.h && \
+ sed -i -e 's/--enable-force-cgi-redirect/--enable-discard-path/' build-defs.h && \
+ touch ../../ext/standard/info.c && \
+ touch ../../sapi/cgi/cgi\_main.c
+
+ cd cgi-build && $(MAKE) && mv sapi/cgi/php-cgi sapi/cgi/usr.bin.php5-cgi
+
+ touch build-cgi-stamp
+
+build-pear-stamp: build-cgi-stamp
+ dh\_testdir
+ -mkdir pear-build
+ -mkdir pear-build-download
+ cd cgi-build && PHP\_PEAR\_DOWNLOAD\_DIR=$(CURDIR)/pear-build-download $(MAKE) install-pear PHP\_PEAR\_PHP\_BIN=/usr/bin/php PHP\_PEAR\_INSTALL\_DIR=/usr/share/php PHP\_PEAR\_SYSCONF\_DIR=/etc/pear PHP\_PEAR\_SIG\_BIN=/usr/bin/gpg INSTALL\_ROOT=$(CURDIR)/pear-build
+ sed -i -e 's/-d output\_buffering=1 -d open\_basedir="" -d safe\_mode=0/-d output\_buffering=1 -d open\_basedir="" -d safe\_mode=0 -d memory\_limit="-1"/' \
+ $(CURDIR)/pear-build/usr/bin/pear && \
+ sed -i -e 's/-d output\_buffering=1 -d safe\_mode=0/-d output\_buffering=1 -d open\_basedir="" -d safe\_mode=0 -d memory\_limit="-1"/' \
+ $(CURDIR)/pear-build/usr/bin/pecl && \
+ sed -i -e 's/-d memory\_limit="-1"//' \
+ -e 's/-d output\_buffering=1 -d open\_basedir="" -d safe\_mode=0/-d output\_buffering=1 -d open\_basedir="" -d safe\_mode=0 -d memory\_limit="-1"/' \
+ $(CURDIR)/pear-build/usr/bin/peardev
+ sed -i -re "s#('PEAR\_CONFIG\_SYSCONFDIR', PHP\_SYSCONFDIR)#\1 . '/pear'#" $(CURDIR)/pear-build/usr/share/php/PEAR/Config.php
+ patch -s -d $(CURDIR)/pear-build/usr/share/php/ -p0 -i $(CURDIR)/debian/patches/php5-pear-CVE-2011-1072.patch
+ patch -s -d $(CURDIR)/pear-build/usr/share/php/ -p0 -i $(CURDIR)/debian/patches/php5-pear-CVE-2011-1144.patch
+ patch -s -d $(CURDIR)/pear-build/usr/share/php/ -p0 -i $(CURDIR)/debian/patches/php5-pear-CVE-2011-1144-regression.patch
+ touch build-pear-stamp
+
+configure: configure-apache2-stamp configure-apache2filter-stamp configure-cli-stamp configure-cgi-stamp
+
+configure-apache2-stamp: prepared-stamp
+ dh\_testdir
+ if [ -d apache2-build ]; then rm -rf apache2-build; fi
+ -mkdir apache2-build
+ cd apache2-build && \
+ CFLAGS="$(CFLAGS)" PROG\_SENDMAIL="$(PROG\_SENDMAIL)" ../configure \
+ --prefix=/usr --with-apxs2=/usr/bin/apxs2 \
+ --with-config-file-path=/etc/php5/apache2 \
+ --with-config-file-scan-dir=/etc/php5/apache2/conf.d \
+ $(COMMON\_CONFIG) \
+ --without-mm \
+ --with-curl=shared,/usr \
+ --with-enchant=shared,/usr \
+ --with-zlib-dir=/usr \
+ --with-gd=shared,/usr --enable-gd-native-ttf \
+ --with-gmp=shared,/usr \
+ --with-jpeg-dir=shared,/usr \
+ --with-xpm-dir=shared,/usr/X11R6 \
+ --with-png-dir=shared,/usr \
+ --with-freetype-dir=shared,/usr \
+ --enable-intl=shared \
+ --with-ttf=shared,/usr \
+ --with-t1lib=shared,/usr \
+ --with-ldap=shared,/usr \
+ --with-ldap-sasl=/usr \
+ --with-mysql=shared,/usr \
+ --with-mysqli=shared,/usr/bin/mysql\_config \
+ --with-pspell=shared,/usr \
+ --with-unixODBC=shared,/usr \
+ --with-recode=shared,/usr \
+ --with-xsl=shared,/usr \
+ --with-snmp=shared,/usr \
+ --with-sqlite=shared,/usr \
+ --with-sqlite3=shared,/usr \
+ --with-mssql=shared,/usr \
+ --with-tidy=shared,/usr \
+ --with-xmlrpc=shared \
+ --with-pgsql=shared,/usr PGSQL\_INCLUDE=`pg\_config --includedir` \
+ --enable-pdo=shared \
+ --without-pdo-dblib \
+ --with-pdo-mysql=shared,/usr \
+ --with-pdo-odbc=shared,unixODBC,/usr \
+ --with-pdo-pgsql=shared,/usr/bin/pg\_config \
+ --with-pdo-sqlite=shared,/usr \
+ --with-pdo-dblib=shared,/usr
+ cd apache2-build && \
+ cp ../Zend/zend\_ini\_scanner.c ../Zend/zend\_language\_scanner.c \
+ ../Zend/zend\_ini\_parser.h ../Zend/zend\_language\_parser.h \
+ ../Zend/zend\_ini\_parser.c ../Zend/zend\_language\_parser.c \
+ Zend/
+ touch configure-apache2-stamp
+
+configure-apache2filter-stamp: prepared-stamp
+ dh\_testdir
+ if [ -d apache2filter-build ]; then rm -rf apache2filter-build; fi
+ -mkdir apache2filter-build
+ cd apache2filter-build && \
+ CFLAGS="$(CFLAGS)" PROG\_SENDMAIL="$(PROG\_SENDMAIL)" ../configure \
+ --prefix=/usr --with-apxs2filter=/usr/bin/apxs2 \
+ --with-config-file-path=/etc/php5/apache2filter \
+ --with-config-file-scan-dir=/etc/php5/apache2filter/conf.d \
+ $(COMMON\_CONFIG) \
+ --without-mm \
+ --disable-pdo \
+ --without-mysql --without-sybase-ct --without-mssql \
+ --without-sqlite --without-sqlite3
+ cd apache2filter-build && \
+ cp ../Zend/zend\_ini\_scanner.c ../Zend/zend\_language\_scanner.c \
+ ../Zend/zend\_ini\_parser.h ../Zend/zend\_language\_parser.h \
+ ../Zend/zend\_ini\_parser.c ../Zend/zend\_language\_parser.c \
+ Zend/
+ touch configure-apache2filter-stamp
+
+configure-cgi-stamp: prepared-stamp
+ dh\_testdir
+ if [ -d cgi-build ]; then rm -rf cgi-build; fi
+ -mkdir cgi-build
+ cd cgi-build && \
+ CFLAGS="$(CFLAGS)" PROG\_SENDMAIL="$(PROG\_SENDMAIL)" ../configure \
+ --prefix=/usr --enable-force-cgi-redirect --enable-fastcgi \
+ --with-config-file-path=/etc/php5/cgi \
+ --with-config-file-scan-dir=/etc/php5/cgi/conf.d \
+ $(COMMON\_CONFIG) \
+ --without-mm \
+ --disable-pdo \
+ --without-mysql --without-sybase-ct --without-mssql \
+ --without-sqlite --without-sqlite3
+ cd cgi-build && \
+ cp ../Zend/zend\_ini\_scanner.c ../Zend/zend\_language\_scanner.c \
+ ../Zend/zend\_ini\_parser.h ../Zend/zend\_language\_parser.h \
+ ../Zend/zend\_ini\_parser.c ../Zend/zend\_language\_parser.c \
+ Zend/
+ touch configure-cgi-stamp
+
+configure-cli-stamp: prepared-stamp
+ dh\_testdir
+ if [ -d cli-build ]; then rm -rf cli-build; fi
+ -mkdir cli-build
+ cd cli-build && \
+ CFLAGS="$(CFLAGS)" PROG\_SENDMAIL="$(PROG\_SENDMAIL)" ../configure \
+ --prefix=/usr --disable-cgi \
+ --with-config-file-path=/etc/php5/cli \
+ --with-config-file-scan-dir=/etc/php5/cli/conf.d \
+ $(COMMON\_CONFIG) \
+ --with-libedit \
+ --without-mm \
+ --disable-pdo \
+ --without-mysql --without-sybase-ct --without-sqlite \
+ --without-mssql --without-sqlite3 --enable-pcntl
+ cd cli-build && \
+ cp ../Zend/zend\_ini\_scanner.c ../Zend/zend\_language\_scanner.c \
+ ../Zend/zend\_ini\_parser.h ../Zend/zend\_language\_parser.h \
+ ../Zend/zend\_ini\_parser.c ../Zend/zend\_language\_parser.c \
+ Zend/
+ touch configure-cli-stamp
+
+clean: unprepared unpatch
+ dh\_testdir
+ dh\_testroot
+
+
+ rm -f configure-apache2-stamp build-apache2-stamp
+ rm -f configure-apache2filter-stamp build-apache2filter-stamp
+ rm -f configure-cgi-stamp build-cgi-stamp
+ rm -f configure-cli-stamp build-cli-stamp
+ rm -f build-pear-stamp
+ rm -f install-stamp
+ rm -rf apache2-build
+ rm -rf apache2filter-build
+ rm -rf cgi-build
+ rm -rf cli-build
+ rm -rf pear-build pear-build-download
+ rm -f debian/copyright
+ rm -f test-results.txt
+ dh\_clean -Xorig
+
+ # clean up autogenerated cruft
+ cat debian/modulelist | while read package extname dsoname; do \
+ rm -f debian/php5-$$package.postinst; \
+ done
+ for sapi in libapache2-mod-php5 libapache2-mod-php5filter php5-cgi php5-cli; do \
+ for cruft in postrm links; do \
+ rm -f debian/$${sapi}.$${cruft}; \
+ done; \
+ done
+
+install: DH\_OPTIONS=
+install: build
+ dh\_testdir
+ dh\_testroot
+ dh\_clean -k
+ dh\_installdirs
+
+ chmod 01733 debian/php5-common/var/lib/php5
+
+ # Add here commands to install the package into debian/php5.
+ # install apache2 DSO module
+ cp apache2-build/.libs/libphp5.so \
+ debian/libapache2-mod-php5/`apxs2 -q LIBEXECDIR`/
+ cp debian/libapache2-mod-php5.load \
+ debian/libapache2-mod-php5/etc/apache2/mods-available/php5.load
+ cp debian/libapache2-mod-php5.conf \
+ debian/libapache2-mod-php5/etc/apache2/mods-available/php5.conf
+
+ # Add here commands to install the package into debian/php5.
+ # install apache2 DSO filter module
+ cp apache2filter-build/.libs/libphp5.so \
+ debian/libapache2-mod-php5filter/`apxs2 -q LIBEXECDIR`/libphp5filter.so
+ cp debian/libapache2-mod-php5filter.load \
+ debian/libapache2-mod-php5filter/etc/apache2/mods-available/php5filter.load
+ cp debian/libapache2-mod-php5filter.conf \
+ debian/libapache2-mod-php5filter/etc/apache2/mods-available/php5filter.conf
+
+ # sanitize php.ini file
+ cat php.ini-production | tr "\t" " " | sed -e'/short\_open\_tag =/ s/Off/On/g' > debian/php5-common/usr/share/php5/php.ini-production
+ # memory\_limit: 16M for cgi/apache; 32M for cli
+ cat php.ini-production | tr "\t" " " | sed -e'/memory\_limit =/ s/128M/32M/g' > debian/php5-common/usr/share/php5/php.ini-production-dist
+ cat php.ini-production | tr "\t" " " | sed -e'/memory\_limit =/ s/128M/-1/g;/short\_open\_tag =/ s/Off/On/g' > debian/php5-common/usr/share/php5/php.ini-production.cli
+ cat php.ini-production | tr "\t" " " > debian/php5-common/usr/share/doc/php5-common/examples/php.ini-production
+ cat php.ini-development | tr "\t" " " > debian/php5-common/usr/share/doc/php5-common/examples/php.ini-development
+ cp test-results.txt debian/php5-common/usr/share/doc/php5-common/
+
+ # install the apache modules' files
+ cd apache2-build && $(MAKE) install-headers install-build install-modules install-programs INSTALL\_ROOT=$(CURDIR)/debian/libapache2-mod-php5
+ # remove netware and win32 headers that we don't want
+ cd debian/libapache2-mod-php5/usr/include/php5/ && \
+ $(RM) TSRM/readdir.h \
+ TSRM/tsrm\_config.nw.h TSRM/tsrm\_config.w32.h\
+ TSRM/tsrm\_nw.h TSRM/tsrm\_win32.h\
+ Zend/zend\_config.nw.h Zend/zend\_config.w32.h\
+ main/config.nw.h main/config.w32.h\
+ main/win95nt.h
+
+ # install PEAR
+ cp -a pear-build/\* debian/php-pear/
+
+ # everything under usr/share/php/data except 'PEAR' is b0rken
+ # and actually needs to be fixed
+ [ ! -f debian/php-pear/usr/share/php/data/Structures\_Graph/LICENSE ] || \
+ $(RM) debian/php-pear/usr/share/php/data/Structures\_Graph/LICENSE
+ [ ! -f debian/php-pear/usr/share/php/doc/PEAR/INSTALL ] || \
+ $(RM) debian/php-pear/usr/share/php/doc/PEAR/INSTALL
+ [ ! -f debian/php-pear/usr/share/php/doc/Structures\_Graph/docs/generate.sh ] || \
+ $(RM) debian/php-pear/usr/share/php/doc/Structures\_Graph/docs/generate.sh
+ for f in Structures\_Graph/publish.sh Structures\_Graph/package.sh \
+ Structures\_Graph/genpackage.xml.pl; do \
+ $(RM) debian/php-pear/usr/share/php/data/$$f; \
+ done
+ # we don't want test suites
+ $(RM) -r debian/php-pear/usr/share/php/test/
+ [ -d debian/php-pear/usr/share/php/doc ] && { \
+ mkdir -p debian/php-pear/usr/share/doc/php5-common/PEAR; \
+ mv debian/php-pear/usr/share/php/doc/\* \
+ debian/php-pear/usr/share/doc/php5-common/PEAR/; \
+ $(RM) -r debian/php-pear/usr/share/php/doc; \
+ ln -s ../doc/php-pear/PEAR debian/php-pear/usr/share/php/doc; \
+ echo "Dummy placeholder to prevent the directory's deletion" > \
+ debian/php-pear/usr/share/doc/php5-common/PEAR/.placeholder; \
+ }
+
+ # install extensions
+ ext=`./debian/libapache2-mod-php5/usr/bin/php-config --extension-dir`;\
+ for i in libapache2-mod-php5 libapache2-mod-php5filter php5-cgi php5-cli; do \
+ mkdir -p debian/$$i/$${ext}; \
+ done; \
+ cat debian/modulelist debian/extramodulelist | while read package extname dsoname; do \
+ if [ -z "$$dsoname" ]; then dsoname=$$package; fi; \
+ mkdir -p debian/php5-$$package$${ext}; \
+ chrpath debian/libapache2-mod-php5/$${ext}/$$dsoname.so; \
+ chrpath -d debian/libapache2-mod-php5/$${ext}/$$dsoname.so; \
+ install -m 644 -o root -g root \
+ debian/libapache2-mod-php5/$${ext}/$$dsoname.so \
+ debian/php5-$$package$${ext}/$$dsoname.so; \
+ rm debian/libapache2-mod-php5/$${ext}/$$dsoname.so; \
+ done
+
+ # install CGI
+ cp cgi-build/sapi/cgi/cgi-bin.php5 debian/php5-cgi/usr/lib/cgi-bin/php5
+ cp cgi-build/sapi/cgi/usr.bin.php5-cgi debian/php5-cgi/usr/bin/php5-cgi
+ cp cli-build/sapi/cli/php.1 debian/php5-cgi/usr/share/man/man1/php5-cgi.1
+
+ # install CLI
+ cp cli-build/sapi/cli/php debian/php5-cli/usr/bin/php5
+ cp cli-build/sapi/cli/php.1 debian/php5-cli/usr/share/man/man1/php5.1
+
+ # move and install -dev files
+ dh\_movefiles --sourcedir=debian/libapache2-mod-php5
+ rm -rf debian/libapache2-mod-php5/usr/lib/php5/build/ \
+ debian/libapache2-mod-php5/usr/include/ \
+ debian/libapache2-mod-php5/usr/bin/
+ rm -rf debian/libapache2-mod-php5filter/usr/lib/php5/build/ \
+ debian/libapache2-mod-php5filter/usr/include/ \
+ debian/libapache2-mod-php5filter/usr/bin/
+ for i in Makefile.global acinclude.m4 mkdep.awk phpize.m4 scan\_makefile\_in.awk; do \
+ chmod 644 debian/php5-dev/usr/lib/php5/build/$$i; \
+ done
+ # shipping duplicate files from other packages is hell for security audits
+ ln -sf /usr/share/misc/config.guess $(PHPIZE\_BUILDDIR)/config.guess
+ ln -sf /usr/share/misc/config.sub $(PHPIZE\_BUILDDIR)/config.sub
+ ln -sf /usr/share/aclocal/libtool.m4 $(PHPIZE\_BUILDDIR)/libtool.m4
+ ln -sf $(LTMAIN\_DIR)ltmain.sh $(PHPIZE\_BUILDDIR)/ltmain.sh
+ ln -sf /usr/bin/shtool $(PHPIZE\_BUILDDIR)/shtool
+ # make php-dev stuff versioned
+ for i in php-config phpize; do \
+ mv debian/php5-dev/usr/bin/$$i debian/php5-dev/usr/bin/"$$i"5; \
+ mv debian/php5-dev/usr/share/man/man1/"$$i".1 debian/php5-dev/usr/share/man/man1/"$$i"5.1; \
+ done
+
+ # install common files
+ install -m755 debian/maxlifetime debian/php5-common/usr/lib/php5
+
+ # install lintian overrides
+ cp debian/php5.lintian-overrides $(CURDIR)/debian/php5-common/usr/share/lintian/overrides/php5-common
+ cp debian/php5-dev.lintian-overrides $(CURDIR)/debian/php5-dev/usr/share/lintian/overrides/php5-dev
+
+ # install the apport hook
+ install -D -m 644 debian/source\_php5.py debian/php5-common/usr/share/apport/package-hooks/source\_php5.py
+
+ # install some generic lintian overrides
+ ext=`debian/php5-dev/usr/bin/php-config5 --extension-dir | cut -b2- `; \
+ for sapi in php5-cli php5-cgi libapache2-mod-php5 libapache2-mod-php5filter; do \
+ mkdir -p $(CURDIR)/debian/"$$sapi"/usr/share/lintian/overrides/; \
+ sed "s/@sapi@/$$sapi/g;s,@extdir@,$$ext,g" \
+ < $(CURDIR)/debian/php5-sapi.lintian-overrides \
+ >> $(CURDIR)/debian/"$$sapi"/usr/share/lintian/overrides/"$$sapi"; \
+ done
+
+ # directories cleanup:
+ -rmdir -p debian/libapache2-mod-php5/usr/share/man/man1
+ -find debian/php-pear -type d -exec rmdir --ignore-fail-on-non-empty -p '{}' \; >/dev/null 2>&1
+
+ touch install-stamp
+
+# Build architecture-independent files here.
+# Pass -i to all debhelper commands in this target to reduce clutter.
+binary-indep: DH\_OPTIONS=-i
+binary-indep: build install
+ # Need this version of debhelper for DH\_OPTIONS to work.
+ dh\_testdir
+ dh\_testroot
+ cat debian/copyright.header LICENSE Zend/LICENSE > debian/copyright
+
+ dh\_installdocs
+
+ for package in php5 php-pear; do \
+ rm -rf debian/$$package/usr/share/doc/$$package; \
+ ln -s php5-common debian/$$package/usr/share/doc/$$package; \
+ done
+
+ dh\_link
+ dh\_compress -Xphp.ini
+ dh\_fixperms
+ dh\_installdeb
+ dh\_gencontrol
+ dh\_md5sums
+ dh\_builddeb
+
+# Build architecture-dependent files here.
+binary-arch: build install
+ # Need this version of debhelper for DH\_OPTIONS to work.
+ dh\_testdir
+ dh\_testroot
+ # Do this first so we don't overwrite any debhelper-generated files
+ #
+ # generate the maintscripts for various php
+ # modules from the templates.
+ cat debian/modulelist | while read package extname dsoname; do \
+ if [ -z "$$dsoname" ]; then dsoname=$$package; fi; \
+ sed -e"s/@extname@/$$extname/g; s/@dsoname@/$$dsoname/g; \
+ /#EXTRA#/ r debian/php5-$${package}.postinst.extra" \
+ < debian/php5-module.postinst \
+ | sed -e'/#EXTRA#/ d' \
+ > debian/php5-$${package}.postinst; \
+ c=`grep -vE '^(#|set|$$)' < debian/php5-$${package}.postinst | wc -l`; \
+ [ "$$c" != "0" ] || $(RM) debian/php5-$${package}.postinst; \
+ done
+
+ # generate the config snippets for various php
+ # modules from the templates.
+ cat debian/modulelist debian/extramodulelist | while read package extname dsoname; do \
+ if [ -z "$$dsoname" ]; then dsoname=$$package; fi; \
+ mkdir -p debian/php5-$$package/etc/php5/conf.d; \
+ sed -e"s/@extname@/$$extname/g; s/@dsoname@/$$dsoname/g" \
+ < debian/php5-module.ini \
+ > debian/php5-$${package}/etc/php5/conf.d/$${dsoname}.ini; \
+ done
+
+ # likewise, for the different sapi implementations
+ for tmpl in postrm links; do \
+ for sapi in apache2 apache2filter cgi cli; do \
+ sed -e "s/@sapi@/$$sapi/g" \
+ < debian/php5-sapi.$$tmpl \
+ > debian/php5-$${sapi}.$$tmpl; \
+ done; \
+ mv debian/php5-apache2.$$tmpl debian/libapache2-mod-php5.$$tmpl; \
+ mv debian/php5-apache2filter.$$tmpl debian/libapache2-mod-php5filter.$$tmpl; \
+ done
+
+ cat debian/copyright.header LICENSE Zend/LICENSE > debian/copyright
+ dh\_installdocs -s
+
+ cat debian/modulelist | while read package extname dsoname; do \
+ rm -rf debian/php5-$$package/usr/share/doc/php5-$$package; \
+ ln -s php5-common debian/php5-$$package/usr/share/doc/php5-$$package; \
+ done
+
+ for package in php5-dbg php5-dev php5-cgi php5-cli libapache2-mod-php5 libapache2-mod-php5filter; do \
+ rm -rf debian/$$package/usr/share/doc/$$package; \
+ ln -s php5-common debian/$$package/usr/share/doc/$$package; \
+ done
+ dh\_installcron -pphp5-common --name=php5
+ dh\_installchangelogs -pphp5-common NEWS
+ dh\_strip -s --dbg-package=php5-dbg
+ dh\_link -s
+ dh\_compress -s -Xphp.ini
+ dh\_fixperms -s -X /var/lib/php5
+ dh\_installdeb -s
+ dh\_shlibdeps -s
+
+ phpapi=`./debian/php5-dev/usr/bin/php-config5 --phpapi`; \
+ for i in libapache2-mod-php5 libapache2-mod-php5filter php5-cgi php5-cli; do \
+ echo "php:Provides=phpapi-$${phpapi}" >> debian/$$i.substvars; \
+ done; \
+ cat debian/modulelist | while read package extname dsoname; do \
+ echo "php:Depends=phpapi-$${phpapi}" >> debian/php5-$$package.substvars; \
+ done
+
+ for i in cgi cli; do \
+ "$$i"-build/sapi/cli/php -n -r '$(BUILTIN\_EXTENSION\_CHECK)' \
+ >> debian/php5-"$$i".substvars; \
+ done
+ for i in apache2; do \
+ "$$i"-build/sapi/cli/php -n -r '$(BUILTIN\_EXTENSION\_CHECK)' \
+ >> debian/lib"$$i"-mod-php5.substvars; \
+ "$$i"filter-build/sapi/cli/php -n -r '$(BUILTIN\_EXTENSION\_CHECK)' \
+ >> debian/lib"$$i"-mod-php5filter.substvars; \
+ done
+
+ echo "apache2:Depends=apache2-mpm-prefork (>> 2.0.52) | apache2-mpm-itk, apache2.2-common" >>debian/libapache2-mod-php5.substvars
+ echo "apache2:Depends=apache2-mpm-prefork (>> 2.0.52) | apache2-mpm-itk, apache2.2-common" >>debian/libapache2-mod-php5filter.substvars
+
+ echo "libtool:Conflicts=$(LIBTOOL\_CONFLICTS)" >>debian/php5-dev.substvars
+ dh\_gencontrol -s
+ dh\_md5sums -s
+ dh\_builddeb -s
+
+binary: binary-arch binary-indep
+.PHONY: build clean binary-indep binary-arch binary install configure
--- php5-5.3.2.orig/debian/php5-cli.postinst
+++ php5-5.3.2/debian/php5-cli.postinst
@@ -0,0 +1,19 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "configure" ]; then
+ exit 0
+fi
+
+phpini="/etc/php5/cli/php.ini"
+
+ucf /usr/share/php5/php.ini-production.cli $phpini
+
+update-alternatives \
+ --install /usr/bin/php php /usr/bin/php5 50 \
+ --slave /usr/share/man/man1/php.1.gz php.1.gz /usr/share/man/man1/php5.1.gz
+
+exit 0
--- php5-5.3.2.orig/debian/php5-dev.prerm
+++ php5-5.3.2/debian/php5-dev.prerm
@@ -0,0 +1,15 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "remove" -a "$1" != "purge" ]; then
+ exit 0
+fi
+
+for i in php-config phpize; do
+ update-alternatives --remove $i /usr/bin/"$i"5
+done
+
+exit 0
--- php5-5.3.2.orig/debian/README.Debian.security
+++ php5-5.3.2/debian/README.Debian.security
@@ -0,0 +1,22 @@
+the Debian stable security team does not provide security support
+for certain configurations known to be inherently insecure. Most
+specifically, the security team will not provide support for flaws in:
+
+- problems which are not flaws in the design of php but can be problematic
+ when used by sloppy developers (for example, not checking the contents
+ of a tar file before extracting it).
+
+- vulnerabilities involving register\_globals being activated, unless
+ specifically the vulnerability activates this setting when it was
+ configured as deactivated.
+
+- vulnerabilities involving any kind of safe\_mode or open\_basedir
+ violation, as these are security models flawed by design and no longer
+ have upstream support either.
+
+- any "works as expected" vulnerabilities, such as "user can cause php
+ to crash by writing a malcious php script", unless such vulnerabilities
+ involve some kind of higher-level DoS or privilege escalation that would
+ not otherwise be available.
+
+ -- sean finney  Tue, 10 Oct 2006 12:42:06 +0200
--- php5-5.3.2.orig/debian/php5-cgi.dirs
+++ php5-5.3.2/debian/php5-cgi.dirs
@@ -0,0 +1,4 @@
+/etc/php5/cgi
+/usr/lib/cgi-bin
+/usr/bin
+/usr/share/man/man1
--- php5-5.3.2.orig/debian/libapache2-mod-php5filter.load
+++ php5-5.3.2/debian/libapache2-mod-php5filter.load
@@ -0,0 +1 @@
+LoadModule php5\_module /usr/lib/apache2/modules/libphp5filter.so
--- php5-5.3.2.orig/debian/libapache2-mod-php5.triggers
+++ php5-5.3.2/debian/libapache2-mod-php5.triggers
@@ -0,0 +1 @@
+interest /etc/php5/conf.d
--- php5-5.3.2.orig/debian/libapache2-mod-php5filter.postinst
+++ php5-5.3.2/debian/libapache2-mod-php5filter.postinst
@@ -0,0 +1,47 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+reload\_apache()
+{
+ if apache2ctl configtest 2>/dev/null; then
+ invoke-rc.d apache2 force-reload || true
+ else
+ echo "Your apache2 configuration is broken, so we're not restarting it for you."
+ fi
+}
+
+# we've registered a trigger to handle extension updates.
+if [ "$1" = "triggered" ] && [ "$2" = "/etc/php5/conf.d" ]; then
+ reload\_apache
+ exit 0
+elif [ "$1" != "configure" ]; then
+ exit 0
+fi
+
+phpini="/etc/php5/apache2filter/php.ini"
+
+ucf /usr/share/php5/php.ini-production $phpini
+
+if [ -n "$2" ]; then
+ # recover the previous state
+ if [ -e /etc/php5/apache2filter/.start ]; then
+ a2enmod php5filter >/dev/null || true
+ fi
+# we're upgrading. test if we're enabled, and if so, restart to reload the module.
+ if [ -e /etc/apache2/mods-enabled/php5filter.load ]; then
+ reload\_apache
+ fi
+ exit 0
+fi
+
+if [ -e /etc/apache2/apache2.conf ]; then
+# Enable the module, but hide a2enmod's misleading message about apachectl
+# and force-reload the thing ourselves.
+ a2enmod php5filter >/dev/null || true
+ reload\_apache
+fi
+
+exit 0
--- php5-5.3.2.orig/debian/php5-cli.prerm
+++ php5-5.3.2/debian/php5-cli.prerm
@@ -0,0 +1,11 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" = "remove" -o "$1" = "deconfigure" ]; then
+ update-alternatives --remove php /usr/bin/php5
+fi
+
+exit 0
--- php5-5.3.2.orig/debian/php5-cli.dirs
+++ php5-5.3.2/debian/php5-cli.dirs
@@ -0,0 +1,3 @@
+/etc/php5/cli
+/usr/bin
+/usr/share/man/man1
--- php5-5.3.2.orig/debian/maxlifetime
+++ php5-5.3.2/debian/maxlifetime
@@ -0,0 +1,13 @@
+#!/bin/sh -e
+
+max=1440
+
+for ini in /etc/php5/\*/php.ini; do
+ cur=$(sed -n -e 's/^[[:space:]]\*session.gc\_maxlifetime[[:space:]]\*=[[:space:]]\*\([0-9]\+\).\*$/\1/p' $ini 2>/dev/null || true);
+ [ -z "$cur" ] && cur=0
+ [ "$cur" -gt "$max" ] && max=$cur
+done
+
+echo $(($max/60))
+
+exit 0
--- php5-5.3.2.orig/debian/README.source
+++ php5-5.3.2/debian/README.source
@@ -0,0 +1,51 @@
+ == Generation of the php5-dbg package Depends ==
+
+The following command can be used to generate a heuristic list of
+packages the php5-dbg package probably needs to Depend on:
+
+dh\_testdir && egrep '^Package' debian/control | cut '-d ' -f2 | \
+ egrep -v '(^php5|dbg|dev|common|pear)$' | tr "\n" "|" | sed 's/|$//' |\
+ sed -r 's/([^|]+)(\||$)/ \1 (= ${binary:Version}) \2/g'; echo
+
+ == Used patch system ==
+
+This package uses quilt to manage all modifications to the upstream
+source. Changes are stored in the source package as diffs in
+debian/patches and applied during the build.
+
+See /usr/share/doc/quilt/README.source for a detailed explanation.
+
+ == Making some sense out of the configure options ==
+
+The COMMON\_CONFIG variable contains the configure options that are to
+be used on all the SAPIs. Built-in extensions and other general options
+should be set here.
+The shared extensions are built when building the apache2 SAPI and as
+such they need to be specified there.
+The calls to configure for the other SAPIs usually only need
+--without-foo when the extension or feature is otherwise enabled by
+default.
+
+ == The \*modulelist files ==
+
+When building a new module (or extension) on an individual binary
+package, it must be added to the debian/modulelist file. However, if
+the extension is to be included in an existing binary package, it
+must be added to the debian/extramodulelist file.
+
+The format of these files is:
+"  "
+
+E.g. for, if we want the mysql extension to be shipped in the
+php5-mysql package we use:
+"mysql MySQL mysql"
+But we also want mysqli and the PDO in the same package, so we add the
+following lines to extramoduleslist:
+"mysql MySQLi mysqli
+mysql MySQL\_PDO pdo\_mysql"
+
+ == More debian/rules foo ==
+
+\* The shared extensions are built under the apache2 target (see above).
+\* The CLI SAPI is built on the build-cli-stamp AND build-cgi-stamp, with
+ different configure options.
--- php5-5.3.2.orig/debian/libapache2-mod-php5filter.triggers
+++ php5-5.3.2/debian/libapache2-mod-php5filter.triggers
@@ -0,0 +1 @@
+interest /etc/php5/conf.d
--- php5-5.3.2.orig/debian/php5.lintian-overrides
+++ php5-5.3.2/debian/php5.lintian-overrides
@@ -0,0 +1,2 @@
+php5-common: non-standard-dir-perm var/lib/php5/ 1733 != 0755
+php5-common: package-contains-empty-directory usr/lib/php5/libexec/
--- php5-5.3.2.orig/debian/libapache2-mod-php5.load
+++ php5-5.3.2/debian/libapache2-mod-php5.load
@@ -0,0 +1 @@
+LoadModule php5\_module /usr/lib/apache2/modules/libphp5.so
--- php5-5.3.2.orig/debian/changelog
+++ php5-5.3.2/debian/changelog
@@ -0,0 +1,3584 @@
+php5 (5.3.2-1ubuntu4.13) lucid-security; urgency=low
+
+ \* SECURITY UPDATE: memory allocation failure denial of service
+ - debian/patches/php5-CVE-2011-4153.patch: check result of
+ zend\_strdup() and calloc() for failed allocations
+ - CVE-2011-4153
+ \* SECURITY UPDATE: predictable hash collision denial of service
+ (LP: #910296)
+ - debian/patches/php5-CVE-2011-4885.patch: add max\_input\_vars
+ directive with default limit of 1000
+ - ATTENTION: this update changes previous php5 behavior by
+ limiting the number of external input variables to 1000.
+ This may be increased by adding a "max\_input\_vars"
+ directive to the php.ini configuration file. See
+ http://www.php.net/manual/en/info.configuration.php#ini.max-input-vars
+ for more information.
+ - CVE-2011-4885
+ \* SECURITY UPDATE: remote code execution vulnerability introduced by
+ the fix for CVE-2011-4885 (LP: #925772)
+ - debian/patches/php5-CVE-2012-0830.patch: return rather than
+ continuing if max\_input\_vars limit is reached
+ - CVE-2012-0830
+ \* SECURITY UPDATE: XSLT arbitrary file overwrite attack
+ - debian/patches/php5-CVE-2012-0057.patch: add xsl.security\_prefs
+ ini option to define forbidden operations within XSLT stylesheets
+ - CVE-2012-0057
+ \* SECURITY UPDATE: PDORow session denial of service
+ - debian/patches/php5-CVE-2012-0788.patch: fail gracefully when
+ attempting to serialize PDORow instances
+ - CVE-2012-0788
+ \* SECURITY UPDATE: magic\_quotes\_gpc remote disable vulnerability
+ - debian/patches/php5-CVE-2012-0831.patch: always restore
+ magic\_quote\_gpc on request shutdown
+ - CVE-2012-0831
+ \* SECURITY UPDATE: arbitrary files removal via cronjob
+ - debian/php5-common.php5.cron.d: take greater care when removing
+ session files (overlooked in a previous update).
+ - http://git.debian.org/?p=pkg-php%2Fphp.git;a=commitdiff\_plain;h=d09fd04ed7bfcf7f008360c6a42025108925df09
+ - CVE-2011-0441
+
+ -- Steve Beattie  Wed, 08 Feb 2012 20:55:57 -0800
+
+php5 (5.3.2-1ubuntu4.11) lucid-security; urgency=low
+
+ \* SECURITY UPDATE: Denial of service and possible information disclosure
+ via exif integer overflow
+ - debian/patches/php5-CVE-2011-4566.patch: fix count checks in
+ ext/exif/exif.c.
+ - CVE-2011-4566
+
+ -- Marc Deslauriers  Tue, 13 Dec 2011 09:16:21 -0500
+
+php5 (5.3.2-1ubuntu4.10) lucid-security; urgency=low
+
+ [ Angel Abad ]
+ \* SECURITY UPDATE: File path injection vulnerability in RFC1867 File
+ upload filename (LP: #813115)
+ - debian/patches/php5-CVE-2011-2202.patch:
+ - CVE-2011-2202
+ \* SECURITY UPDATE: Fixed stack buffer overflow in socket\_connect()
+ (LP: #813110)
+ - debian/patches/php5-CVE-2011-1938.patch:
+ - CVE-2011-1938
+
+ [ Steve Beattie ]
+ \* SECURITY UPDATE: DoS in zip handling due to addGlob() crashing
+ on invalid flags
+ - debian/patches/php5-CVE-2011-1657.patch: check for valid flags
+ - CVE-2011-1657
+ \* SECURITY UPDATE: crypt\_blowfish doesn't properly handle 8-bit
+ (non-ascii) passwords leading to a smaller collision space
+ - debian/patches/php5-CVE-2011-2483.patch: update crypt\_blowfish
+ to 1.2 to correct handling of passwords containing 8-bit
+ (non-ascii) characters.
+ CVE-2011-2483
+ \* SECURITY UPDATE: DoS due to failure to check for memory allocation errors
+ - debian/patches/php5-CVE-2011-3182.patch: check the return values
+ of the malloc, calloc, and realloc functions
+ - CVE-2011-3182
+ \* SECURITY UPDATE: DoS in errorlog() when passed NULL
+ - debian/patches/php5-CVE-2011-3267.patch: fix NULL pointer crash in
+ errorlog()
+ - CVE-2011-3267
+ \* SECURITY UPDATE: information leak via handler interrupt (LP: #852871)
+ - debian/patches/php5-CVE-2010-1914.patch: grab references before
+ calling zendi\_convert\_to\_long()
+ - CVE-2010-1914
+
+ -- Steve Beattie  Fri, 14 Oct 2011 14:24:59 -0700
+
+php5 (5.3.2-1ubuntu4.9) lucid-security; urgency=low
+
+ \* debian/patches/php5-pear-CVE-2011-1144-regression.patch: fix
+ mkdir parenthesis issue and PEAR::raiseErro typo (LP: #774452)
+
+ -- Steve Beattie  Mon, 02 May 2011 09:21:53 -0700
+
+php5 (5.3.2-1ubuntu4.8) lucid-security; urgency=low
+
+ \* SECURITY UPDATE: arbitrary files removal via cronjob
+ - debian/php5-common.php5.cron.d: take greater care when removing
+ session files.
+ - http://git.debian.org/?p=pkg-php%2Fphp.git;a=commitdiff\_plain;h=d09fd04ed7bfcf7f008360c6a42025108925df09
+ - CVE-2011-0441
+ \* SECURITY UPDATE: symlink tmp races in pear install
+ - debian/patches/php5-pear-CVE-2011-1072.patch: improved
+ tempfile handling.
+ - debian/rules: apply patch manually after unpacking PEAR phar
+ archive.
+ - CVE-2011-1072
+ \* SECURITY UPDATE: more symlink races in pear install
+ - debian/patches/php5-pear-CVE-2011-1144.patch: add TOCTOU save
+ file handler.
+ - debian/rules: apply patch manually after unpacking PEAR phar
+ archive.
+ - CVE-2011-1144
+ \* SECURITY UPDATE: pathname restriction bypass vulnerability
+ - debian/patches/php5-CVE-2006-7243.patch: check for passed
+ filenames containing NULL bytes.
+ - CVE-2006-7243
+ \* SECURITY UPDATE: use-after-free vulnerability
+ - debian/patches/php5-CVE-2010-4697.patch: retain reference to
+ object until getter/setter are done.
+ - CVE-2010-4697
+ \* SECURITY UPDATE: denial of service through application crash with
+ invalid images
+ - debian/patches/php5-CVE-2010-4698.patch: verify anti-aliasing
+ steps are either 4 or 16.
+ - CVE-2010-4698
+ \* SECURITY UPDATE: denial of service through application crash
+ - debian/patches/php5-CVE-2011-0420.patch: improve grapheme\_extract()
+ argument validation.
+ - CVE-2011-0420
+ \* SECURITY UPDATE: denial of service through application crash
+ - debian/patches/php5-CVE-2011-0421.patch: fail operation gracefully
+ when handling zero sized zipfile with the FL\_UNCHANGED argument
+ - CVE-2011-0421
+ \* SECURITY UPDATE: denial of service through application crash when
+ handling images with invalid exif tags
+ - debian/patches/php5-CVE-2011-0708.patch: stricter exif checking
+ - CVE-2011-0708
+ \* SECURITY UPDATE: denial of service and possible data disclosure
+ through integer overflow
+ - debian/patches/php5-CVE-2011-1092.patch: better boundary
+ condition checks in shmop\_read()
+ - CVE-2011-1092
+ \* SECURITY UPDATE: use-after-free vulnerability
+ - debian/patches/php5-CVE-2011-1148.patch: improve reference
+ counting
+ - CVE-2011-1148
+ \* SECURITY UPDATE: format string vulnerability
+ - debian/patches/php5-CVE-2011-1153.patch: correctly quote format
+ strings
+ - CVE-2011-1153
+ \* SECURITY UPDATE: denial of service through buffer overflow crash
+ (code execution mitigated by compilation with Fortify Source)
+ - debian/patches/php5-CVE-2011-1464.patch: limit amount of precision
+ to ensure fitting within MAX\_BUF\_SIZE
+ - CVE-2011-1464
+ \* SECURITY UPDATE: denial of service through application crash via
+ integer overflow.
+ - debian/patches/php5-CVE-2011-1466.patch: improve boundary
+ condition checking in SdnToJulian()
+ - CVE-2011-1466
+ \* SECURITY UPDATE: denial of service through application crash
+ - debian/patches/php5-CVE-2011-1467.patch: check for invalid
+ attribute symbols in NumberFormatter::setSymbol()
+ - CVE-2011-1467
+ \* SECURITY UPDATE: denial of service through memory leak
+ - debian/patches/php5-CVE-2011-1468.patch: fix memory leak of
+ openssl contexts
+ - CVE-2011-1468
+ \* SECURITY UPDATE: denial of service through application crash
+ when using HTTP proxy with the FTP wrapper
+ - debian/patches/php5-CVE-2011-1469.patch: improve pointer handling
+ - CVE-2011-1469
+ \* SECURITY UPDATE: denial of service through application crash when
+ handling ziparchive streams
+ - debian/patches/php5-CVE-2011-1470.patch: set necessary elements of
+ the meta data structure
+ - CVE-2011-1470
+ \* SECURITY UPDATE: denial of service through application crash when
+ handling malformed zip files
+ - debian/patches/php5-CVE-2011-1471.patch: correct integer
+ signedness error when handling zip\_fread() return value.
+ - CVE-2011-1471
+
+ -- Steve Beattie  Thu, 21 Apr 2011 11:07:40 -0700
+
+php5 (5.3.2-1ubuntu4.7) lucid-security; urgency=low
+
+ \* debian/patches/php5-CVE-2010-3436-regression.patch: update
+ main/fopen\_wrappers.c to include fix for open\_basedir restriction
+ regression (LP: #701896)
+
+ -- Steve Beattie  Wed, 12 Jan 2011 07:28:55 -0800
+
+php5 (5.3.2-1ubuntu4.6) lucid-security; urgency=low
+
+ \* SECURITY UPDATE: open\_basedir bypass
+ - debian/patches/php5-CVE-2010-3436.patch: more strict checking in
+ php\_check\_specific\_open\_basedir()
+ - CVE-2010-3436
+ \* SECURITY UPDATE: NULL pointer dereference crash
+ - debian/patches/php5-CVE-2010-3709.patch: check for NULL when
+ getting zip comment
+ - CVE-2010-3709
+ \* SECURITY UPDATE: memory consumption denial of service
+ - debian/patches/php5-CVE-2010-3710.patch: check for email address
+ longer than RFC 2821 allows
+ - CVE-2010-3710
+ \* SECURITY UPDATE: xml decode bypass
+ - debian/patches/php5-CVE-2010-3870.patch: improve utf8 decoding
+ - CVE-2010-3870
+ \* SECURITY UPDATE: integer overflow can cause an application crash
+ - debian/patches/php5-CVE-2010-4409.patch: fix invalid args in
+ NumberFormatter::getSymbol()
+ - CVE-2010-4409
+ \* SECURITY UPDATE: infinite loop/denial of service when dealing with
+ certain textual forms of MAX\_FLOAT (LP: #697181)
+ - debian/patches/php5-CVE-2010-4645.patch: treat local doubles
+ as volatile to avoid x87 registers in zend\_strtod()
+ - CVE-2010-4645
+
+ -- Steve Beattie  Fri, 07 Jan 2011 10:56:23 -0800
+
+php5 (5.3.2-1ubuntu4.5) lucid-security; urgency=low
+
+ \* SECURITY UPDATE: denial of service and possible memory corruption via
+ negative size in HTTP chunked encoding stream
+ - debian/patches/CVE-2010-1866.patch: prevent chunk\_size from
+ overflowing in ext/standard/filters.c.
+ - CVE-2010-1866
+ \* SECURITY UPDATE: arbitrary code execution via empty SQL query
+ - debian/patches/CVE-2010-1868.patch: use ecalloc instead of emalloc in
+ ext/sqlite/sqlite.c.
+ - CVE-2010-1868
+ \* SECURITY UPDATE: denial of service via fnmatch stack consumption
+ - debian/patches/CVE-2010-1917.patch: limit size of pattern in
+ ext/standard/file.c.
+ - CVE-2010-1917
+ \* SECURITY UPDATE: arbitrary memory disclosure and possible code
+ execution via phar extension
+ - debian/patches/CVE-2010-2094.patch: use correct format string in
+ ext/phar/dirstream.c, ext/phar/stream.c.
+ - CVE-2010-2094
+ - CVE-2010-2950
+ \* SECURITY UPDATE: sensitive information disclosure or arbitrary code
+ execution via use-after-free in SplObjectStorage unserializer
+ - debian/patches/CVE-2010-2225.patch: fix logic in
+ ext/spl/spl\_observer.c, ext/standard/{php\_var.h,var\_unserializer.\*},
+ add tests to ext/spl/tests.
+ - CVE-2010-2225
+ \* SECURITY UPDATE: sensitive information disclosure via error messages
+ - debian/patches/CVE-2010-2531.patch: don't display data when flushing
+ output buffer in ext/standard/{var.c,php\_var.h}, fix tests in
+ ext/standard/tests/general\_functions.
+ - CVE-2010-2531
+ \* SECURITY UPDATE: arbitrary session variable modification via crafted
+ session variable name
+ - debian/patches/CVE-2010-3065.patch: handle PS\_UNDEF\_MARKER marker in
+ ext/session/session.c.
+ - CVE-2010-3065
+ \* debian/patches/lp564920-fix-big-files.patch: Fix downloading of large
+ files (LP: #564920)
+
+ -- Marc Deslauriers  Fri, 17 Sep 2010 08:14:26 -0400
+
+php5 (5.3.2-1ubuntu4.2) lucid-proposed; urgency=low
+
+ \* debian/patches/session\_save\_path.patch: Save PHP sessions to
+ /var/lib/php rather than /tmp (LP: #573222)
+
+ -- Chuck Short  Mon, 10 May 2010 04:00:03 -0400
+
+php5 (5.3.2-1ubuntu4.1) lucid-proposed; urgency=low
+
+ \* debian/patches/fix-mysql-badmem.patch: Fix mysql crash when using php5-cgi. (LP: #567043)
+
+ -- Chuck Short  Mon, 03 May 2010 11:23:43 -0400
+
+php5 (5.3.2-1ubuntu4) lucid; urgency=low
+
+ \* debian/control, debian/rules: Re-enable libedit-dev. (LP: #548823)
+
+ -- Chuck Short  Mon, 05 Apr 2010 15:33:21 -0400
+
+php5 (5.3.2-1ubuntu3) lucid; urgency=low
+
+ \* debian/control: Fix upgrade of php5-ldap from 5.3.1. (LP: #)
+
+ -- Chuck Short  Sun, 28 Mar 2010 15:41:34 -0400
+
+php5 (5.3.2-1ubuntu2) lucid; urgency=low
+
+ \* debian/control: Dont build with libmcrypt-dev.
+
+ -- Chuck Short  Fri, 26 Mar 2010 14:39:36 -0400
+
+php5 (5.3.2-1ubuntu1) lucid; urgency=low
+
+ \* Merge from debian unstable:
+ - debian/control:
+ \* Dropped firebird2.1-dev, libc-client-dev, libmcrypt-dev as it is in universe.
+ \* Dropped libmysqlclient15-dev, build against mysql 5.1.
+ \* Dropped libcurl-dev not in the archive.
+ \* Suggest php5-suhosin rather than recommends.
+ \* Dropped php5-imap, php5-interbase, php5-mcrypt since we have versions already in
+ universe.
+ \* Dropped libonig-dev and libqgdbm since its in universe. (will be re-added in lucid+1)
+ \* Dropped locales-all.
+ - modulelist: Drop imap, interbase, and mcrypt.
+ - debian/rules:
+ \* Dropped building of mcrypt, imap, and interbase.
+ \* Install apport hook for php5.
+ - Dropped debian/patches/libedit\_is\_editline.patch.
+
+ -- Chuck Short  Tue, 16 Mar 2010 09:09:50 -0400
+
+php5 (5.3.2-1) unstable; urgency=high
+
+ [ Sean Finney ]
+ \* Fix improper signed overflow detection in filter extension
+ (Closes: #570287)
+ \* Another integer overflow/underflow logic fix. (Closes: #570144)
+ \* new debian patch fix\_filter\_var\_email\_test.patch (Closes: #571764)
+ \* New debian patch fix\_var\_dump\_64bit.phpt.patch (Closes: #571772)
+ \* New debian patch use\_embedded\_timezonedb\_fixes.patch (Closes: #571762)
+
+ [ Raphael Geissert ]
+ \* Build with qdbm support
+ \* Really run extensions' tests
+ \* Add a note about user\_dirs in apache conf file (Closes: #571714)
+ \* Fix typo in debian/NEWS
+ \* Don't install a(nother) useless Structures\_Graph sh script
+ \* Re-enable short\_open\_tag for CLI too (Closes: #573367)
+ \* Disable memory limit in CLI, letting ulimit do its job (Closes: #407425)
+ \* Fix the locale name in some tests (Closes: #573511)
+ \* Fix some gd tests that need the bundled library
+ \* Fix a null pointer dereference when processing invalid XML-RPC
+ requests (CVE-2010-0397, Closes: #573573)
+ \* Fix an unaligned memory access in enchant\_dict\_suggest()
+ \* Fix another unaligned memory access in enchant
+ \* Test that the list of extensions to test is never empty
+ \* Update the list of alternative dependencies of php5-dbg
+ \* debian/rules cleanup
+ \* debian/control cleanup
+ \* Build against the system oniguruma library
+ \* Add libjpeg-dev as an alternative to libjpeg62-dev for future
+ transitions
+
+ [ OndÅej SurÃ½ ]
+ \* Imported Upstream version 5.3.2
+ \* Updated suhosin patch to 0.9.9.1 version.
+ \* Removed debian/patches/suhosin\_page\_size\_fixes.patch. (Closes: #571974)
+ \* Refreshed debian/patches/001-libtool\_fixes.patch
+ \* Refreshed debian/patches/006-debian\_quirks.patch
+ \* Adapt debian patches to 5.3.2.
+ \* Remove "binary" contents from
+ debian/patches/fix\_var\_dump\_64bit.phpt.patch
+ \* New debian patch fix\_broken\_sha2\_test.patch
+ \* New debian patch always\_use\_system\_crypt.patch (Closes: #572601)
+ \* New debian patch php\_crypt\_revamped.patch (Closes: #572601)
+
+ -- Raphael Geissert  Sat, 13 Mar 2010 15:11:48 -0600
+
+php5 (5.3.1-5) unstable; urgency=low
+
+ [ Sean Finney ]
+ \* Pass full path to php cli executable for unit tests
+ \* dont-gitclean-in-build.patch: Don't run git-clean via buildconf
+ \* update debian patch page\_size\_fixes.patch with upstream bug ref
+ \* new debian patch broken\_5.3\_test-posix\_uname.patch (Closes: #570286)
+
+ [ Raphael Geissert ]
+ \* Add build-dependency on netbase to fix a test (Closes: #570291)
+ \* Suhosin PAGE\_SIZE fixes have been already forwarded
+ \* Fix a race condition on shtool's mkdir -p (Closes: #570111)
+ \* Actually test the binary that is to be shipped in the -cli package
+ \* Add some more documentation about the build system
+ \* Documentation updates
+ \* Update the suhosin patch version information
+ \* Build-dep on locales-all to enable multiple tests
+ \* Don't ship empty maintainer scripts
+ \* Add patch to allow building with qdbm
+ \* Test the extensions that don't require a special setup
+ \* Get the correct list of built-in extensions of apache2filter
+
+ -- Raphael Geissert  Mon, 22 Feb 2010 10:41:51 -0600
+
+php5 (5.3.1-4) unstable; urgency=low
+
+ [ Raphael Geissert ]
+ \* Pass -O0 when using 'noopt' to actually disable any optimization
+ \* Add patch to use sysconf() to determine the page size
+ \* Add patch to remove PAGE\_SIZE assumptions in suhosin code
+ \* Fix an unaligned memory access in the phar extension
+ \* Fix another unaligned memory access
+ \* Print the expected/actual output of failed test
+ \* Add missing PEAR directory (Closes: #542483)
+ \* Build sqlite3 as shared (Closes: #568956)
+ \* Add some more documentation about the source package
+
+ [ Sean Finney ]
+ \* New debian patch fix\_broken\_5.3\_tests.patch
+
+ -- Raphael Geissert  Thu, 11 Feb 2010 02:22:47 -0600
+
+php5 (5.3.1-3) unstable; urgency=low
+
+ [ OndÅej SurÃ½ ]
+ \* get rid of php4 dependencies
+ \* Enable short\_open\_tag again (Closes: #537099)
+ \* fix dependency on automake1.4 in php5-dev package
+ \* fix typo s/firefox/firebird/ in changelog
+ \* Removed long inactive Adam Conrad and Jeroen van Wolffelaar from uploaders
+
+ [ Raphael Geissert ]
+ \* Fix maintainer scripts to use php.ini-production (Closes: #565130)
+ \* Revert b22a350: Turn the phpapi dependencies into php5 | phpapi
+ \* Allow parallel building via parallel=n
+ \* Build with the hardening wrapper
+ \* Remove no-longer-needed dfsg-repack script
+ \* Add DEP-3-format metadata to some of the patches
+ \* Build the intl extension
+ \* Drop exif\_read\_data-segfault patch, merged upstream
+ \* Build the enchant extension
+ \* Add ${misc:Depends} where missing
+ \* Disable mod\_php in user directories (Closes: #555606)
+ \* Add missing comment character to php.ini-paranoid (Closes: #564622)
+ \* Build the interbase extension on all the supported architectures
+
+ [ Sean Finney ]
+ \* 5.3 upload for unstable.
+ - Includes backported fix for "ref converted to value" (Closes: #556237).
+
+ -- Raphael Geissert  Sun, 07 Feb 2010 23:31:51 -0600
+
+php5 (5.3.1-2) experimental; urgency=low
+
+ \* Merged changes from 5.2.x sid branch.
+ \* Adapt mssql-null-exception.patch and sybase-alias.patch to 5.3.1
+ \* Update strcmp\_null-OnUpdateErrorLog.patch; merged upstream, leave a
+ patch with a test case
+ \* Removed check\_ini\_on\_modify\_status.patch and gentoo/117-
+ 4\_digit\_year\_big\_endian.patch; merged upstream
+ \* Removed max\_file\_uploads.patch; no need for backwards compatibility
+ between major releases
+ \* Refreshed 112-proc\_open.patch,exif\_read\_data-segfault.patch
+ \* Fix duplicate Provides: in debian/control introduced by cherry-
+ picking 94f0ec3
+ \* Update sybase aliases to include correct arguments, needed for 5.3.x
+ \* Update Build-Depends: to include firebird2.1-dev as preferred
+ alternative (Closes: #564691)
+ \* Reformat Build-Depends: to one-dependency-per-line
+ \* Reduce number of libdb\*-dev to include only version in
+ stable/testing/unstable
+ \* Switch to automake (>= 1.11) | automake1.11, depend on autoconf >=
+ 2.63 (Closes: #549148)
+
+ -- OndÅej SurÃ½  Mon, 11 Jan 2010 16:56:01 +0100
+
+php5 (5.3.1-1) experimental; urgency=low
+
+ \* Imported Upstream version 5.3.1
+ \* Change dependcy to libdb-dev instead on arbitrary version of
+ libdb4.x-dev
+ \* Refreshed 006-debian\_quirks patch to apply cleanly.
+ \* Removed 114-php\_gd\_segfault.patch, merged upstream.
+ \* Refreshed 115-autoconf\_ftbfs.patch to apply cleanly
+ \* Updated suhosin.patch to 0.9.8 version for php-5.3.1
+ \* Refreshed 001-libtool\_fixes.patch
+ \* Refreshed 004-ldap\_fix.patch
+ \* Refreshed 013-force\_getaddrinfo.patch
+ \* Refreshed 036-fd\_setsize\_fix.patch
+ \* Refreshed 052-phpinfo\_no\_configure.patch
+ \* Refreshed 053-extension\_api.patch
+ \* Refreshed 108-64\_bit\_datetime.patch
+ \* Refreshed 113-php.ini\_securitynotes.patch
+ \* Refreshed 116-posixness\_fix.patch
+ \* Refreshed gentoo/006\_ext-curl-set\_opt-crash.patch
+ \* Refreshed gentoo/009\_ob-memory-leaks.patch
+ \* Refreshed libedit\_is\_editline.patch
+ \* Refreshed suhosin.patch
+ \* Add .gitignore file to ignore .pc/ directory
+ \* Removed README.CVS-RULES from debian/php5-common.docs, file is no
+ longer shipped by upstream.
+
+ -- OndÅej SurÃ½  Thu, 07 Jan 2010 17:21:47 +0100
+
+php5 (5.3.0-3) experimental; urgency=low
+
+ \* Fix segmentation fault in php-gd (Closes: #543496)
+ \* Update suhosin patch to 0.9.8 \*BETA\* and enable it again
+ \* Fix FTBFS with current autoconf/automake (Closes: #542906, #542088)
+ \* Add avr32-linux-gnu to no -gstabs toolchains (Closes: #543278)
+ \* Fix FTBFS on Debian Hurd (Closes: #530281)
+ \* Use updated (v7) version of use\_embedded\_timezonedb.patch (Closes: #535770)
+
+ -- OndÅej SurÃ½  Tue, 25 Aug 2009 16:12:13 +0200
+
+php5 (5.2.12.dfsg.1-2) unstable; urgency=low
+
+ \* Update Build-Depends: to include firebird2.1-dev as preferred
+ alternative (Closes: #564691)
+ \* Reformat Build-Depends: to one-dependency-per-line
+ \* Reduce number of firebird\*-dev to include only version in
+ stable/testing/unstable
+ \* Reduce number of libdb\*-dev to include only version in
+ stable/testing/unstable
+ \* Switch to automake (>= 1.11) | automake1.11, depend on autoconf
+ (>= 2.63) (Closes: #549148)
+
+ -- OndÅej SurÃ½  Mon, 11 Jan 2010 17:31:33 +0100
+
+php5 (5.2.12.dfsg.1-1) unstable; urgency=low
+
+ [ Thijs Kinkhorst ]
+ \* Change comment in module .ini snippets from # to ; to avoid deprecation
+ warnings with PHP 5.3.0.
+
+ [ OndÅej SurÃ½ ]
+ \* Imported Upstream version 5.2.12.dfsg.1
+ \* Removed manpage\_spelling.patch, merged upstream.
+ \* Removed libedit\_is\_editline.patch, merged upstream.
+ \* Refreshed max\_file\_uploads.patch, patch can be removed, it's kept to
+ raise max\_file\_uploads to 50.
+ \* Refreshed and updated suhosin.patch
+ \* Refreshed 001-libtool\_fixes.patch, 004-ldap\_fix.patch,
+ 006-debian\_quirks.patch, 013-force\_getaddrinfo.patch,
+ 034-apache2\_umask\_fix.patch, 053-extension\_api.patch,
+ 056-mime\_magic\_liberal.patch, 115-autoconf\_ftbfs.patch,
+ gentoo/009\_ob-memory-leaks.patch, mssql-null-exception.patch,
+ use\_embedded\_timezonedb.patch
+ \* Removed autogenerated main/php\_config.h.in from suhosin.patch
+ (Ubuntu: #493761)
+ \* Short open tags are On again in php.ini-dist (Closes: #537099)
+ \* Don't leave .start if we are purging (Closes: #561739)
+ \* Add README.Debian file to /usr/share/doc/php-pear/PEAR, so the
+ directory is not deleted (Closes: #563437, #542483)
+
+ [ Upstream ]
+ \* Fix default pear.php.net channel definitions (Closes: #559029)
+
+ -- OndÅej SurÃ½  Fri, 08 Jan 2010 18:18:43 +0100
+
+php5 (5.2.11.dfsg.1-2) unstable; urgency=high
+
+ \* max\_file\_uploads: limit the maximum number of file uploads to 50
+ + Reduces the chances of a temporary file exhaustion DoS
+ \* Add libdb4.8-dev as an alternative dependency (Closes: #555945)
+ \* Add libdb-dev as another alternative, hopefully the last one
+ (Closes: #548486)
+ \* Add a versioned dependency on libtool 2.2 (Closes: #548015)
+ \* Use FilesMatch and SetHandler on apache setups (Closes: #491928)
+ \* Gentoo patch ext-curl-set\_opt-crash has already been merged upstream
+ \* Drop unused lintian override
+
+ -- Raphael Geissert  Sat, 21 Nov 2009 13:37:51 -0600
+
+php5 (5.2.11.dfsg.1-1) unstable; urgency=low
+
+ \* New upstream release
+
+ [ Fixes incorporated upstream ]
+ \* Fix 4-year digit year on big-endian platforms (Closes: #542301)
+ \* patch curl\_streams\_sleep.patch
+ \* patch strcmp\_null-OnUpdateErrorLog.patch (partially addresses #540605)
+ \* patch check\_ini\_on\_modify\_status.patch
+
+ [ Raphael Geissert ]
+ \* Add aliases to the mssql functions on the sybase extension (Closes: #523073)
+ \* Fix the rows\_affected alias, it should be affected\_rows
+ \* Avoid possible memory dumps via PG on restored ini values (Closes: #540605)
+
+ [ Ondrej Sury ]
+ \* Fix FTBFS with current autoconf/automake (Closes: #542906, #542088)
+ \* Add avr32-linux-gnu to no -gstabs toolchains (Closes: #543278)
+ \* Fix FTBFS on Debian Hurd (Closes: #530281)
+ \* fix whitespace in libapache2-mod-php5.postinst
+
+ [ Sean Finney ]
+ \* incorporate/ack previous NMU's, thanks Andreas.
+ \* update debian patch 115-autoconf\_ftbfs.patch for new upstream version
+ \* update debian patch fix\_broken\_upstream\_tests.patch
+ \* update debian patch mssql-null-exception.patch
+ \* refresh various quilt patches against new upstream version
+ \* remove no longer needed "legacy" support for conffile migration
+ \* add dpkg trigger in the apache2 and apache2filter sapis for reloading
+ apache2 on extension updates (Closes: #490023, #524206)
+ \* let libmysqlclient15-dev be a fallback alternative for libmysqlclient-dev
+ in case someone wants to backport the package.
+ \* update list of installed documentation
+
+ -- Sean Finney  Sun, 20 Sep 2009 11:05:35 +0200
+
+php5 (5.2.10.dfsg.1-2.2) unstable; urgency=medium
+
+ \* Non-maintainer upload.
+ \* Drop hand-crafted dependency on libmysqlclient15.
+
+ -- Andreas Barth  Mon, 31 Aug 2009 09:22:16 +0200
+
+php5 (5.2.10.dfsg.1-2.1) unstable; urgency=medium
+
+ \* Non-maintainer upload.
+ \* Fix FTBFS with new autoconf. Thanks to Russ Allbery for the patch.
+ Closes: #542906
+
+ -- Andreas Barth  Sun, 30 Aug 2009 13:49:40 +0200
+
+php5 (5.2.10.dfsg.1-2) unstable; urgency=low
+
+ \* Declare that PEAR replaces XML\_UTIL (Closes: #534621)
+ \* Bump standards-version, no change needed
+ \* Fix an unconditional limit on dblib\_driver.c (Closes: #534881)
+ \* Fix a segfault on exif\_data\_read with corrupted jpg files (Closes: #535888)
+ \* Recommend php5-suhosin, as suggested by Thijs (Closes: #529760)
+ \* Set sysconfig to /etc, to avoid getting /usr/etc in PHP\_SYSCONFDIR
+ \* Add myself to uploaders
+ \* Fix the path to PEAR's config, directly in rules (Closes: #507762)
+
+ -- Raphael Geissert  Thu, 09 Jul 2009 18:25:48 -0500
+
+php5 (5.3.0-2) experimental; urgency=low
+
+ \* update configuration file names to new upstream naming convention
+
+ -- Sean Finney  Wed, 01 Jul 2009 09:12:10 +0200
+
+php5 (5.3.0-1) experimental; urgency=low
+
+ \* New Upstream Version
+
+ [ Sean Finney ]
+ \* use ';' instead of '#' as comments in module ini files
+ \* remove binary package for php5-mhash which is now built-in
+ \* update removed windows modules in 006-debian\_quirks.patch
+ \* quilt refresh for new upstream release
+
+ -- Sean Finney  Tue, 30 Jun 2009 20:09:07 +0200
+
+php5 (5.3.0~RC4-1) UNRELEASED; urgency=low
+
+ \* New Upstream Version
+
+ [ Sean Finney ]
+ \* (temporarily) disable suhosin patch while it does not apply to 5.3
+ \* refresh various debian patches, fixing whitespace and offsets
+ \* copy the gbp.conf from debian-sid and adapt it for experimental
+ \* cherry-pick relevant gentoo patches from unstable
+ \* cherry-pick debian fixes in libtool2.2.patch from unstable
+ \* Update package sections to match override.
+
+ [ Raphael Geissert ]
+ \* Detect the path to ltmain.sh at build time and set conflicts
+ appropriately
+ \* Add libdb4.7-dev as an ORed build dependency to fix FTBFS
+ \* Update the Vcs-\* fields to reflect the move from svn to git
+ \* Turn the phpapi dependencies into php5 | phpapi to fix
+ installability issues
+ \* Bump Standards-Version to 3.8.1, no change needed
+ \* Add a set of lintian overrides for some FP spelling-error-in-binary
+
+ [ Thijs Kinkhorst ]
+ \* Update php5-cli package description to make it more neutral
+
+ -- Sean Finney  Mon, 29 Jun 2009 07:54:51 +0200
+
+php5 (5.3.0~RC1-1) unstable; urgency=low
+
+ \* New Upstream Version
+
+ -- Mark A. Hershberger  Wed, 25 Mar 2009 19:39:48 -0400
+
+php5 (5.2.9.dfsg.1-1) unstable; urgency=low
+
+ \* New upstream release (closes: #520538).
+ - fixes regressions with parsing via libxml2 (closes: #520246, #520423).
+
+ [ Sean Finney ]
+ \* Refresh all patches.
+ \* Update suhosin patch to 5.2.9, remove autotools-generated files (configure,
+ php\_config.h.in) and .dsp files from patch.
+ \* remove obsolete configure options from ./configure: --enable-memory-limit,
+ --enable-track-vars, --enable-trans-sid, --enable-filepro and --enable-dbx.
+ \* Remove obsoleted patches which have been incorporated upstream:
+ - snmp\_leaks.patch
+ - BG-initializing-fix.patch
+ - CVE-2008-2829.patch
+ - CVE-2008-3658.patch
+ - CVE-2008-3659.patch
+ - CVE-2008-3660.patch
+ - CVE-2008-5557.patch
+ - CVE-2008-5658.patch
+ - pdo-fetchobject-prototype-error.patch
+ - zend\_object\_handlers-invalid-write.patch
+ - dba-inifile-truncation.patch
+ - gentoo/freetds-compat.patch
+ - gentoo/010\_ticks-zts-crashes.patch
+ - gentoo/019\_new-memory-corruption.patch
+ - gentoo/009\_array-function-crashes.patch
+ - gentoo/015\_CVE-2008-2665-wrapper-safemode-bypass.patch
+ - gentoo/017\_xmlrpc-invalid-callback-crash.patch
+ - gentoo/007\_dom-setAttributeNode-crash.patch
+ - gentoo/006\_PDORow-crash.patch
+ - gentoo/005\_stream\_context\_set\_params-crash.patch
+ \* Update fix\_broken\_upstream\_tests.patch, one of the tests is fixed.
+
+ -- Sean Finney  Tue, 24 Mar 2009 19:05:09 +0100
+
+php5 (5.2.6.dfsg.1-3) unstable; urgency=low
+
+ [ Sean Finney ]
+ \* Do not add -O2 to CFLAGS if DEB\_BUILD\_OPTIONS contains noopt.
+ \* Security related fixes:
+ - php: inifile handler for the dba functions can be used to truncate a file
+ Patch: dba-inifile-truncation.patch (closes: #507101).
+ - CVE-2008-5658.patch: ZipArchive::extractTo directory traversal
+ Patch: CVE-2008-5658.patch (closes: #507857).
+ Thanks to Pierre Joye for help with the patch.
+
+ [ Raphael Geissert ]
+ \* Picked up some patches from Gentoo (most included in PHP 5.2.7 and later):
+ + patches/gentoo/005\_stream\_context\_set\_params-crash.patch
+ + patches/gentoo/006\_PDORow-crash.patch
+ + patches/gentoo/007\_dom-setAttributeNode-crash.patch
+ + patches/gentoo/009\_array-function-crashes.patch
+ + patches/gentoo/010\_ticks-zts-crashes.patch
+ + patches/gentoo/015\_CVE-2008-2665-wrapper-safemode-bypass.patch
+ + patches/gentoo/017\_xmlrpc-invalid-callback-crash.patch
+ + patches/gentoo/019\_new-memory-corruption.patch
+ + patches/gentoo/freetds-compat.patch
+ - was deprecated\_freetds\_check.patch
+
+ -- Sean Finney  Sat, 24 Jan 2009 21:17:13 +0100
+
+php5 (5.2.6.dfsg.1-2) unstable; urgency=low
+
+ [ Sean Finney ]
+ \* Make sure a file used to track state is properly removed in the
+ postinst, thanks Raphael (closes: #511049).
+
+ [ Thijs Kinkhorst ]
+ \* Fix watch file to mangle version.
+
+ [ Raphael Geissert ]
+ \* Ship script used to take an upstream tarball and remove the non
+ DFSG-free stuff, update watch file accordingly.
+
+ -- Sean Finney  Tue, 13 Jan 2009 08:24:36 +0100
+
+php5 (5.2.6.dfsg.1-1) unstable; urgency=high
+
+ [ Sean Finney ]
+ \* Incorporate previous NMU.
+ \* Updated system tzdata patch from Joe Orton.
+ \* Removed tzdb-nofree\_ents\_ifnotzdata.patch, which is now incorporated
+ into Joe's patch.
+ \* Two backported fixes from 5.2.8, thanks to Olivier Bonvalet for looking
+ them up.
+ - Upstream bug #46157 (PDOStatement::fetchObject prototype error)
+ Patch: pdo-fetchobject-prototype-error.patch
+ - Upstream bug #46308 (Invalid write in zend object handler / getter)
+ Patch: zend\_object\_handlers-invalid-write.patch
+ \* Security related fixes:
+ - CVE-2008-5624: Incorporate fix from 5.3 for proper initialization of
+ uid/gid for apache2 sapi.
+ Patch: BG-initializing-fix.patch
+ - CVE-2008-5557: heap overflows in the mbstring extension.
+ Patch: CVE-2008-5557.patch (closes: #511493).
+
+ [ Thijs Kinkhorst ]
+ \* Correct description typo, thanks Mathias Brodala (Closes: #508989).
+
+ -- Sean Finney  Mon, 12 Jan 2009 12:12:36 +0100
+
+php5 (5.2.6.dfsg.1-0.1) unstable; urgency=low
+
+ \* Non-maintainer upload.
+ \* Remove exts/dbase from orig tarball (Closes: #341420)
+
+ -- Ben Hutchings  Sat, 29 Nov 2008 19:19:28 +0000
+
+php5 (5.2.6-5) unstable; urgency=high
+
+ \* Update debian/copyright to document that the DFSG-unfree email
+ requirement in ext/standard/rand.c has been rescinded by the
+ copyrightholder (Closes: #498621).
+
+ -- Thijs Kinkhorst  Sun, 05 Oct 2008 11:32:35 +0200
+
+php5 (5.2.6-4) unstable; urgency=high
+
+ [ Sean Finney ]
+ \* Take three unreleased fixes from upstream CVS:
+ - CVE-2008-3658: Buffer overflow in the imageloadfont function.
+ Patch: CVE-2008-3658.patch (closes: #499989)
+ - CVE-2008-3659: Buffer overflow in the memnstr function.
+ Patch: CVE-2008-3659.patch (closes: #499988)
+ - CVE-2008-3660: Remote DoS in fastcgi module
+ Patch: CVE-2008-3660.patch (closes: #499987)
+
+ [ Raphael Geissert ]
+ \* snmp\_leaks.patch: fixes memory leaks in the snmp extension (Closes: #423296)
+ - Thanks to Rodrigo Campos  for the follow up
+ - Thanks to Federico Cuello for the original patch
+ \* php5-dev.lintian-override: fix it so it actually works
+
+ -- Sean Finney  Sun, 14 Sep 2008 14:25:11 +0200
+
+php5 (5.2.6-3) unstable; urgency=high
+
+ [ Thijs Kinkhorst ]
+ \* Drop unneeded php5-timezonedb Suggests and obsolete php3 Conflicts.
+ \* Add documentation about the timezonedb change (Closes: #492025).
+
+ [ Adam Conrad ]
+ \* Modify 033-we\_WANT\_libtool.patch to cope with newer versions of
+ libtool that only copy auxilliary files when --install is used,
+ while still working with older versions that DTRT without.
+
+ [ Raphael Geissert ]
+ \* debian/rules:
+ + Avoid installing useless test suites in php-pear (Closes: #478995)
+ + Remove any empty directory in php-pear
+ + Also get rid of usr/share/php/data/Structures\_Graph/\*
+ - Those were meant to be used by upstream maintainer
+ \* debian/php5-dev.lintian-overrides:
+ - usr/lib/php5/build/run-tests.php is not meant to be used directly
+ \* debian/control: bumped Standards Version to 3.8.0, no changes needed
+ \* bad\_whatis\_entries.patch: fixes the whatis entries of all the manpages
+ \* deprecated\_freetds\_check.patch: fixes the freetds detection routine
+ + Closes: #494230
+ - Thanks to jklowden@freetds.org and the Gentoo folks for the patch
+ (RC bugfix, upload urgency bumped)
+ \* debian/libapache2-mod-php5\*-{prerm,postinst}:
+ - Create a status file when removing the package (but not purging)
+ while having the mod enabled so reinstallation of the package
+ does not end up disabling the module (Closes: #471548)
+
+ [ Sean Finney ]
+ \* Bump dependency on libmysqlclient15off to require the version from
+ lenny or later, in order to avoid subtle problems not previously detected
+ with libmysqlclient\_r on mixed etch/lenny/sid systems (closes: #495575).
+
+ -- Sean Finney  Wed, 20 Aug 2008 19:32:02 +0200
+
+php5 (5.2.6-2) unstable; urgency=high
+
+ [ Raphael Geissert ]
+ \* Lintian-based changes:
+ - also install a lintian override for libapache2-mod-php5filter
+ - fixed the generic lintian overrides so they are meaningful
+ - dropping linda overrides, linda is gone now
+ - s/meta-package/metapackage
+ \* debian/control:
+ - Updated php5's description so it mentions three instead of
+ only two server-side SAPIs
+ - Depend on php5-cli in php-pear (Closes: #482517)
+ + Previous change reverted because of PEAR packages FTBFS
+ - {B-,}Depend on tzdata to avoid crashes caused by the tz ext patch
+ - Dropped some versioned {b-,}dependencies that are satisified
+ even on sarge
+ \* php.ini-\*: state that when using a custom save\_path,
+ gc\_probability should also be set (Closes: #388808, #321460)
+ \* tzdb-nofree\_ents\_ifnotzdata.patch: avoid free'ing ents when the tz dir does
+ not exist (Closes: #483461)
+
+ [ Sean Finney ]
+ \* Fix for CVE-2008-2829: unsafe usage of deprecated imap functions
+ Patch: CVE-2008-2829.patch
+ \* Modifications to suhosin.patch due to alignment problems on some
+ architectures. Thanks to Stefan Esser for the initial suggestion.
+ (Closes: #481737).
+ \* Rename the apache2 filter module to libphp5filter.so, to prevent
+ conflicting filenames for symbols in the debug package.
+
+ -- Sean Finney  Thu, 03 Jul 2008 08:14:45 +0200
+
+php5 (5.2.6-1) unstable; urgency=medium
+
+ \* New upstream release. Fixes several security issues of unknown impact:
+ + possible stack buffer overflow in the FastCGI SAPI
+ + integer overflow in printf()
+ + unknown issue CVE-2008-0599
+ + a safe\_mode bypass in cURL
+ + incomplete multibyte chars inside escapeshellcmd()
+
+ [ Sean Finney ]
+ \* New patch (use\_embedded\_timezonedb.patch) allows us to default to
+ using the system provided timezone database instead of the one bundled
+ with PHP. Many thanks to Joe Orten from Red Hat for the patch!
+ (closes: #447174, #471104).
+ \* Updated the Suhosin patch to v0.9.6 (5.2.6).
+ \* New patch: force\_libmysqlclient\_r.patch, forcing the build system
+ to link against the threadsafe libmysqlclient without having to enable
+ the other zts features in php. This is required since the apr libraries
+ are now linking against this as well and mysql exports the same symbols
+ from both libraries. Thanks to Stefan Fritsch (closes: #469081).
+ \* Massaged/updated various other patches in debian/patches
+ \* Update copyright information to have information about non-trivial
+ patches worthy of copyright attributions, and update information about
+ current debian maintainers.
+ \* Add some useful quilt settings in debian/rules to lower the amount of
+ noise in future quilt updates.
+ \* Now building a php5 apache2 module with filter-module support in a new
+ libapache2-mod-php5filter package (closes: #438120).
+
+ [ Thijs Kinkhorst ]
+ \* Checked for policy 3.7.3, no changes.
+
+ [ Raphael Geissert ]
+ \* Build a php5-dbg package with the debug symbols of the SAPIs & extensions
+ + Bump debhelper dependency to >= 5 as dh\_strip behaves differently.
+ \* debian/watch: refactored so it can actually be used to download the tarball
+ \* debian/rules: removed bashisms (Closes: #478613)
+ \* debian/control: add a notice about Suhosin being applied (Closes: #471324)
+ + Additionally make sure the PHP boilerplate is the same for each package
+ \* debian/patches/manpage\_spelling.patch:
+ - fix spelling mistakes in man page (Closes: #413712)
+ \* debian/NEWS: s/suhosin/Suhosin (Closes: #434351)
+ \* debian/control: removed ORed postgresql-dev build-dep (Closes: #429981)
+ + postgresql-dev is a transitional package since etch
+ \* Override the following lintian messages:
+ + SAPI packages package-contains-empty-directory usr/lib/php5/20060613+lfs/
+ + php5-common package-contains-empty-directory usr/lib/php5/libexec/
+ \* Set our custom PHP\_PEAR\_DOWNLOAD\_DIR when building the pear stuff
+ + Avoids the creation of /tmp/pear (Closes: #463979)
+ \* Replaced all 'make' with '$(MAKE)' so any extra flag is preserved
+ \* debian/rules: s/DEB\_BUILD\_ARCH/DEB\_HOST\_ARCH
+ + HOST is the machine the package is built for.
+ \* Recommend php5-cli instead of depending on it in php-pear (Closes: #243214)
+ + php5-cli is only needed by the, rearely used, pear installer
+ \* debian/README.source: inform how to generate php5-dbg's Depends
+ \* debian/patches/029-php.ini\_paranoid.patch: updated (Closes: #459814)
+ + Thanks to Javier FernÃ¡ndez-Sanguino PeÃ±a
+ Changes:
+ - includes some variables which were no present in the first version and
+ removes modules not available in PHP5. Also fixes typos in comments which
+ have since been fixed in php.ini-dist
+ - adds notes (Debian-specific) of which security features applications
+ should not rely on
+ - add more information of why some variables were enabled
+ - reorder the description of changes to suit the location in the config file
+ - add notes of deprecated features in PHP6
+ - add more (suggested) changes to the session module to make a more secure
+ use and storage of session IDs.
+ - remove the 'include' function from the list of disabled functions as it
+ is quite common for most applications
+ - modify the valid 'include\_path' to make it really paranoid ('.' is not
+ allowed anymore)
+ - adjust locations of directories, including the upload dir and session dir
+ - proper definition for sql.safe\_mode and description (missing in
+ php.ini-dist of what it is really for)
+ - added session configuration variables which are not available in
+ php.ini-dist together with recommended paranoid values
+ (session.referer\_check, session.entropy\_file, session.entropy\_length)
+ - added more information to session configuration (not available in php.ini)
+ based on the information at php.net
+ \* Lintian-based changes:
+ - debian/php5-common.dirs: do NOT create usr/share/doc/php5-common/PEAR/
+ - fixed a hyphen-used-as-minus-sign in php5(1):319
+ - get rid of usr/share/php/data/Structures\_Graph/LICENSE in php-pear
+ \* Move /usr/share/php/docs to /usr/share/doc/pear-php/PEAR (Closes: #331034)
+
+ [ Steve Langasek ]
+ \* Step down from the PHP maintenance team, removing myself from uploaders.
+ So long, and thanks for all the fish!
+
+ -- Sean Finney  Sun, 04 May 2008 21:15:47 +0200
+
+php5 (5.2.5-3) unstable; urgency=high
+
+ \* zend\_parse\_parameters does not handle size\_t's, causing issues with
+ 043-recode\_size\_t.patch and segmentation faults for recode-using pages.
+ changed problematic parameters back to "int" and added an overflow check.
+ thanks to Thomas Stegbauer, Tim Dijkstra, Bart Cortooms, Sebastian GÃ¶bel,
+ and Vincent Tondellier for their reports. closes: #459020.
+
+ -- Sean Finney  Thu, 21 Feb 2008 00:59:21 +0100
+
+php5 (5.2.5-2) unstable; urgency=low
+
+ \* debian/patches/libdb\_is\_-ldb: reorder the search for db4 instances to
+ give precedence to -ldb, so that we always get the version that matches
+ the installed -dev package instead of whichever most recent version php
+ upstream currently knows about. Closes: #463397.
+ \* Update suhosin patch to not patch .dsp files (and config.w32), which
+ are irrelevant to Unix builds and seem to cause problems for clean
+ patching/unpatching.
+
+ -- Steve Langasek  Fri, 01 Feb 2008 18:46:15 +0000
+
+php5 (5.2.5-1) unstable; urgency=low
+
+ [ Sean Finney ]
+ \* New upstream release
+ \* Updated suhosin patch for 5.2.5 minus ./configure as before.
+ \* Workaround for xargs not handling extra long cmdlines in session
+ cleanup script (Closes: #461755).
+ \* Remove unneccesary DEB\_BUILD\_GNU\_TYPE fudging (Closes: #429066). Thanks
+ to Riku Voipio for the report/patch.
+
+ [ Raphael Geissert ]
+ \* debian/rules: now DEB\_BUILD\_OPTIONS=nocheck aware
+ \* Updated description of the php5 meta-package to reflect removal of apache
+ (Closes: #418038)
+ \* Capitalise apache where needed (Closes: #439575)
+ \* Homepage is now a control entry (moved from Description), Closes: #439578
+ \* Fixed test-results.txt target so parallel package building doesn't fail
+ \* Added Suggests: php5-timezonedb to all the SAPIs
+
+ [ Steve Langasek ]
+ \* Add ${shlibs:Depends} to php5-common, since it does build ELF objects now
+ (pdo.so)
+ \* Update build-deps to libdb4.6-dev now that libaprutil1-dev has switched.
+ Closes: #461192.
+
+ -- Steve Langasek  Thu, 17 Jan 2008 13:39:17 -0800
+
+php5 (5.2.4-2) unstable; urgency=low
+
+ [ sean finney ]
+ \* for posterity revised previous changelog to reference the CVE id's
+ of security issues resolved by the latest upstream release.
+ \* lintian: use debian/compat instead of DH\_COMPAT in debian/rules.
+ \* lintian: use source:Version and binary:Version where appropriate,
+ instead of Source-Version
+ \* lintian: remove a couple pieces of cruft in the changelog that were causing
+ false-postive wrong-bug-number-in-closes, but were generally useless
+ anyway.
+
+ [ Raphael Geissert ]
+ \* Using test-results.txt as a target
+ \* cronjob now checks for existance of /usr/lib/php5/maxlifetime (Closes: #439286)
+ \* Fixed memory limit of 1232M in php.ini for cli (Closes: #440624)
+ \* Build the interbase extension using firebird2.0-dev (Closes: #433736)
+ \* Unapply patches with debian/rules clean
+
+ [ Steve Langasek ]
+ \* Don't patch configure or php\_config.h.in in suhosin.patch, as these are
+ auto-generated and including them in the patch results in a race
+ condition for the necessary build-time regeneration. Thanks to Daniel
+ Schepler for reporting, and to Damyan Ivanov for helping to sort out the
+ fix. Closes: #443637.
+ \* Also remove the modified auto-generated files in the clean target,
+ which triggers a warning about disappearing files when building the
+ source package but avoids carrying irrelevant diffs to these files
+ in the Debian diff.
+ \* Now that the testsuite is being run at build time, test failures cause
+ a bunch of junk files to be left around in the Debian diff. So clean up
+ several false-positive failures:
+ - 052-phpinfo\_no\_configure.patch: we're patching the output of phpinfo(),
+ so patch the test as well
+ - fix\_broken\_upstream\_tests.patch: use a local directory for tests that
+ use sessions, skip the phpinfo test after all because it doesn't appear
+ to be compatible with current testsuite behavior, and disable the
+ moneyformat test if en\_US locale is not available.
+ There are still several other failing tests, but these are not false
+ positives and remain enabled pending investigation.
+
+ -- sean finney  Wed, 24 Oct 2007 21:51:14 +0200
+
+php5 (5.2.4-1) unstable; urgency=low
+
+ \* New upstream release.
+ \* Security issues resolved in the latest release:
+ - CVE-2007-2519 - Directory traversal vulnerability in PEAR
+
+
+ [ sean finney ]
+ \* patch from Jan Wagner to be able to conditionally disable any
+ patches that break binary-compatibility with official php
+ binary-only extensions. see debian/rules for more information.
+ \* now incorporate the php unit tests into the build process. for
+ those interested the output is stored in the file
+ /usr/share/doc/php5-common/test-results.txt .
+ \* by default we now ship with enable\_dl = Off, as there are some
+ fairly significant ramifications security-wise to having it on.
+ \* we shipping with the suhosin patch enabled by default.
+ special thanks to Blars Blarson for providing a sparc machine for
+ testing purposes with 5.2.3 (closes: #397179).
+ \* new binary package php5-gmp, with the newly enabled gmp extension,
+ since whatever reason for not doing so either never existed or no
+ no longer exists (closes: #344137). Build-Depends added for libgmp3-dev.
+
+ [ Steve Langasek ]
+ \* php5-module.postinst: don't assume that the postinst is only relevant
+ when called with 'configure' as an argument, some future debhelper code
+ could apply in the case of other methods of invocation.
+ \* Clean up build dependencies for recent library transitions:
+ - libsnmp-dev is now the real package name, and is supported as a virtual
+ package for backports.
+ - re-add firebird2-dev as an alternative to firebird1.5-dev, to support
+ backports.
+ - the curl -dev package name has changed from libcurl3-openssl-dev to
+ libcurl4-openssl-dev; update to the proper name, with libcurl-dev as
+ an alternative.
+ \* Switch php5-sybase to use the mssql extension instead of the sybase\_ct
+ extension. Closes: #418734, #329065.
+
+ -- sean finney  Sun, 16 Sep 2007 14:46:06 +0200
+
+php5 (5.2.3-1) unstable; urgency=low
+
+ \* new upstream release.
+ \* upstream has incorporated the last of the recent CVE fixes, so
+ the patches have been removed.
+ \* change build dependencies for firebird2-dev -> firebird1.5-dev,
+ as the firebird maintainer has changed names in order to provide
+ more clarity since there's also a firebird2.0 now (closes: #427181).
+ \* now include, but do not apply by default, the suhosin patch. see
+ NEWS.Debian for more information.
+
+ -- sean finney  Mon, 04 Jun 2007 22:02:10 +0200
+
+php5 (5.2.2-2) unstable; urgency=low
+
+ [sean finney]
+ - build with --with-ldap-sasl and modify build-depends to include
+ libsasl2-dev in order to get the ldap\_sasl\_bind function (closes: #422490).
+ - the json extension is now on by default in php builds, so there's
+ no need for the php5-json package. added a Provides/Conflicts to
+ help set an upgrade path.
+ - apache 1.x support is soon disappearing. as a consequence we are
+ no longer building the libapache-mod-php5 module. the php5 metapackage
+ should as a result bring in libapache2-mod-php5 by default for those who
+ already have it installed.
+
+ -- sean finney  Sun, 20 May 2007 21:59:56 +0200
+
+php5 (5.2.2-1) unstable; urgency=low
+
+ [ sean finney ]
+ \* new upstream release (closes: #422405).
+ \* /most/ of the previous CVE patches have been committed upstream, though:
+ - the patch for MOPB-41 was fixed in a different way and we'll be keeping
+ our fix for the time being.
+ - it doesn't seem like MOPB-45 has been fixed yet.
+ \* remove build-dependency option on libmysqlclient12-dev, since the mysqli
+ option requires it, and 15 is in stable now anyway. thanks to
+ Henk van de kamer for finding this (closes: #422224).
+ \* now includes requested fix for mysql row counts (closes: #418471).
+ \* needle/haystack issues are reported fixed (closes: #399924).
+ \* oh yeah, because we're using quilt now: (closes: #338315).
+ \* update build-deps to libdb4.5-dev | libdb4.4-dev (closes: #421929).
+ note that the resulting php packages won't actually build against
+ libdb4.5 until all of our build-dependant packages do too.
+
+ -- sean finney  Sat, 05 May 2007 19:56:30 +0200
+
+php5 (5.2.0-12) unstable; urgency=high
+
+ [ sean finney ]
+ \* modify the build-depends to play more nicely when the net-snmp
+ maintainers decide to change their package names (closes: #421061).
+
+ -- sean finney  Tue, 01 May 2007 14:24:01 +0200
+
+php5 (5.2.0-11) unstable; urgency=high
+
+ [ sean finney ]
+ \* The following security issues are addressed with this update:
+ - CVE-2007-0910/MOPB-32 session\_decode() Double Free Vulnerability
+ \* note that this is an update to the previous version of the upstream
+ fix for CVE-2007-0910, which introduced a seperate exploit path.
+ - CVE-2007-1286/MOPB-04 unserialize() ZVAL Reference Counter Overflow
+ - CVE-2007-1380/MOPB-10 php\_binary Session Deserialization Information Leak
+ - CVE-2007-1375/MOPB-14 substr\_compare() Information Leak Vulnerability
+ - CVE-2007-1376/MOPB-15 shmop Functions Resource Verification Vulnerability
+ - CVE-2007-1453/MOPB-18 ext/filter HTML Tag Stripping Bypass Vulnerability
+ - CVE-2007-1453/MOPB-19 ext/filter Space Trimming Buffer Underflow Vuln.
+ - CVE-2007-1521/MOPB-22 session\_regenerate\_id() Double Free Vulnerability
+ - CVE-2007-1583/MOPB-26 mb\_parse\_str() register\_globals Activation Vuln.
+ - CVE-2007-1700/MOPB-30 \_SESSION unset() Vulnerability
+ - CVE-2007-1718/MOPB-34 mail() Header Injection
+ - CVE-2007-1777/MOPB-35 zip\_entry\_read() Integer Overflow Vulnerability
+ - CVE-2007-1887-1888/MOPB-41 sqlite\_udf\_decode\_binary() Buffer Overflow
+ - CVE-2007-1824/MOPB-42 php\_stream\_filter\_create() Off By One Vulnerablity
+ - CVE-2007-1889/MOPB-44 Memory Manager Signed Comparision Vulnerability
+ - CVE-2007-1900/MOPB-45 ext/filter Email Validation Vulnerability
+ \* The other security issues resulting from the "Month of PHP bugs" either
+ did not affect the version of php5 shipped in unstable, or did not merit
+ a security update according to the established security policy for php
+ in debian. You are encouraged to verify that your configuration is not
+ affected by any of the other vulnerabilities by visiting:
+ http://www.php-security.org/
+ \* other, less interesting changes:
+ - now use quilt for managing local patches.
+ - massage all of the patches, eliminating fuzz and offsets.
+
+ -- sean finney  Mon, 23 Apr 2007 19:02:51 +0200
+
+php5 (5.2.0-10) unstable; urgency=high
+
+ [ sean finney ]
+ \* The php security update contained a regression in the streams
+ module. this version contains an updated version of the patch
+ for CVE-2007-0906 (116-CVE-2007-0906\_streams.patch), which should
+ fix the regression. Thanks to Martin Pitt for noticing this.
+ \* Fix the patch names in the previous changelog entry, and fix a factual
+ inaccuracy that was accidentally pasted from the php4 changelog.
+ \* The previous update was missing two fixes from CVE-2007-0906:
+ \* interbase: (116-CVE-2007-0906\_interbase.patch)
+ \* zip: (116-CVE-2007-0906\_zip.patch)
+
+ -- sean finney  Wed, 07 Mar 2007 23:11:29 +0100
+
+php5 (5.2.0-9) unstable; urgency=high
+
+ [ sean finney ]
+ \* The following security issues are addressed with this update:
+ - CVE-2007-0906: Multiple buffer overflows in various code:
+ \* session (116-CVE-2007-0906\_session.patch)
+ \* imap (116-CVE-2007-0906\_imap.patch)
+ \* str\_replace: (116-CVE-2007-0906\_string.patch)
+ \* the sqlite and mail related vulnerabilities in this CVE do not
+ affect the php5 source packages.
+ - CVE-2007-0907: sapi\_header\_op buffer underflow (116-CVE-2007-0907.patch)
+ - CVE-2007-0908: wddx information disclosure (116-CVE-2007-0908.patch)
+ - CVE-2007-0909: More buffer overflows:
+ \* the odbc\_result\_all function (116-CVE-2007-0909\_odbc.patch)
+ \* various formatted print functions (116-CVE-2007-0909\_print.patch)
+ - CVE-2007-0910: Clobbering of super-globals (116-CVE-2007-0910.patch)
+ - CVE-2007-0988: 64bit unserialize DoS (116-CVE-2007-0988.patch)
+ Closes: #410995.
+ \* The package maintainers would like to thank Joe Orton from redhat and
+ Martin Pitt from ubuntu for their help in preparation of this update.
+ \* backport upstream fix for AUTH PLAIN support in imap extension
+ Closes: #401712.
+
+ -- sean finney  Sat, 03 Mar 2007 11:13:33 +0100
+
+php5 (5.2.0-8) unstable; urgency=high
+
+ [ sean finney ]
+ \* Update package information to say simply "Apache 2" instead
+ of "Apache 2.0" (ref: #400306).
+ \* Update package description for php-pear to mention needing
+ phpN-dev for building PECL extensions (closes: #401825).
+ \* Add mention of Freetype fonts to php5-gd package description,
+ thanks to Ole Laursen for the suggestion (closes: #387881).
+ \* Include a backported version of upstream's fix for
+ alignment calculatations which cause FTBFS problems for
+ some arches. Thanks to Roman Zippel for finding this (closes: #401129).
+ patch: 114-zend\_alloc.c\_m68k\_alignment.patch
+ \* Remove --enable-yp, as it's no longer used and seperately
+ packaged. Thanks to Martijn Grendelman for mentioning this
+ (closes: #402161).
+ \* Add mention to README.Debian of needing to restart apache when
+ installing modules (closes: #392249).
+ \* Don't strip the DSO modules if building with DEB\_BUILD\_OPTIONS
+ containing nostrip
+ \* Backported a patch from upstream CVS to fix a rather nasty
+ memory leak in zend\_alloc (closes: #402506).
+ patch: 115-zend\_alloc.c\_memleak.patch
+ \* The memleak and FTBFS are targeted at etch, and there aren't
+ any other significant changes, so priority=high.
+
+ -- sean finney  Sun, 17 Dec 2006 16:49:35 +0100
+
+php5 (5.2.0-7) unstable; urgency=high
+
+ [ Steve Langasek ]
+ \* Also disable firebird in the PDO config for archs other than
+ i386/amd64.
+
+ -- sean finney  Fri, 24 Nov 2006 15:20:53 +0100
+
+php5 (5.2.0-6) unstable; urgency=high
+
+ [ sean finney ]
+ \* firebird2-dev (and thus php5-interbase) is only available on
+ i386/amd64, so update the control/rules information accordingly.
+ thanks to Bastian Blank for reporting this (closes: #399558).
+
+ -- sean finney  Wed, 22 Nov 2006 19:04:04 +0100
+
+php5 (5.2.0-5) unstable; urgency=high
+
+ [ sean finney ]
+ \* bring some of the mainline php4 modules back into the php source
+ package instead of distributing them in independant source packages:
+ - php5-imap
+ - php5-interbase
+ - php5-mcrypt
+ - php5-pspell
+ - php5-tidy
+ these modules are still provided in the same binary packages as
+ before, but will now be built in tandem with the core php packages.
+ \* fix for pdo.so duplicate loading warnings, thanks to Jan Wagner
+ (closes: #398367, #399248).
+
+ -- sean finney  Mon, 20 Nov 2006 12:41:37 +0100
+
+php5 (5.2.0-4) unstable; urgency=high
+
+ \* Re-re-enable LFS support, forward-porting vorlon's fixes in
+ the php4 tree.
+ \* Add a bit of support in upgrade scripts to avoid unnecessary
+ ucf prompting during upgrades (closes: #398363).
+ \* Update build-dependencies to reflect that libpcre3-dev >= 6.6
+ is required. Thanks to Jan Wagner for pointing this out.
+ \* loosen dependencys for libapache2-mod-php5 to allow usage with
+ apache2-mpm-itk as an alternative to prefork.
+ Closes: #398580, #398481.
+
+ -- sean finney  Wed, 15 Nov 2006 08:33:28 +0100
+
+php5 (5.2.0-3) unstable; urgency=high
+
+ \* Unify PHP options for pear binaries to:
+ -d output\_buffering=1 -d open\_basedir="" -d safe\_mode=0 -d memory\_limit="-1"
+ (Closes: #397625)
+ \* [debian/rules]: Enable PDO building only in apache2 build.
+
+ -- OndÅej SurÃ½  Fri, 10 Nov 2006 14:09:00 +0100
+
+php5 (5.2.0-2) unstable; urgency=high
+
+ [ OndÅej SurÃ½ ]
+ \* Revert Large File Support for this moment. We will try to found
+ root of the problem for etch, but we do not promise anything.
+ (Closes: #397465)
+
+ -- OndÅej SurÃ½  Wed, 8 Nov 2006 01:13:48 +0100
+
+php5 (5.2.0-1) unstable; urgency=high
+
+ [ sean finney ]
+ \* new upstream release. since this means the 5.1 series is deadware
+ in the eyes of its developers, we better get on this train before
+ it's too late. Note: this also fixes the htmlentities() exploit.
+ Reference: CVE-2006-5465.
+ Closes: #396766.
+ \* s/postinst/postrm/ on one critical line in debian/rules. whoops.
+ Thanks to Bart Martens for finding this (closes: #396873).
+ \* as a pennance i've enabled LFS support (closes: #359686).
+ \* new version now includes all mbstring headers (closes: #391368).
+ \* enable new built-in zip support.
+ \* enable pdo support for currently supported db types, and place the
+ extensions in the respective extension packages. future db
+ types will be added, but probably post-etch as they will probably
+ introduce new packages/dependencies (closes: #348882).
+ \* move the mysqli module into the mysql module's package, and remove
+ the no longer necessary mysqli package.
+ \* massaging/removal of various patches to upstream changes:
+ D patches/106-strptime\_xopen.patch
+ D patches/110-CVE-2006-4812\_zend\_alloc.patch
+ M patches/006-debian\_quirks.patch
+ D patches/111-mbstring-headers.patch
+ M patches/053-extension\_api.patch
+
+ [ OndÅej SurÃ½ ]
+ \* Package checked, upload to unstable.
+
+ -- OndÅej SurÃ½  Tue, 7 Nov 2006 09:26:51 +0100
+
+php5 (5.1.6-6) unstable; urgency=high
+
+ [ sean finney ]
+ \* add notes to php.ini(-dist) about "unsupported" security features.
+ patch: 113-php.ini\_securitynotes.patch
+
+ [ OndÅej SurÃ½ ]
+ \* SECURITY: include patch for html buffer overflows in ext/standard/html.c
+ Reference: CVE-2006-5465
+ Patch: 114-CVE-2006-5465\_htmlentities.patch
+ Closes: #396766
+
+ -- OndÅej SurÃ½  Fri, 3 Nov 2006 12:32:50 +0100
+
+php5 (5.1.6-5) unstable; urgency=high
+
+ [sean finney]
+ \* add a README.Debian.security to clarify how we handle/respond
+ to security problems in stable releases.
+ \* SECURITY: include patch for integer overflow in zend\_alloc.c.
+ Reference: CVE-2006-04812 (closes: #391586).
+ patch: 110-CVE-2006-4812\_zend\_alloc.patch
+ \* bump the debhelper compatibility level to 4.
+ \* remove cyclic depends for mysql/mysqli.
+ \* the long overdue rework of configuration file handling. this also
+ removes the need for debconf and template translations
+ (closes: #361211, #393788, #388697).
+ \* start using ucf to manage the the various SAPI php.ini files.
+ \* cleanup and consolidation of a few things in the ./debian dir
+ \* bump the memory limit to 32M for the cli API (closes: #375070, #340586).
+ \* include a fix for missing mbstring headers reported by Jan Wagner
+ (closes: #391368).
+ patch: 111-mbstring-headers.patch.
+ \* include support for PTY's in proc\_open, as reported by Eike Dehling.
+ according to php's BTS (http://bugs.php.net/bug.php?id=39224) the
+ feature was disabled only because the configure script couldn't
+ accurately determine whether the feature was available, and we know
+ it is :) (closes: #381438).
+ patch: 112-proc\_open.patch.
+ \* update standards-version to 3.7.2
+
+ -- sean finney  Sat, 28 Oct 2006 14:29:44 +0200
+
+php5 (5.1.6-4) unstable; urgency=high
+
+ [sean finney]
+ \* no longer build against GPL'd gdbm library (closes: #390452).
+ \* updated apache2 module dependencies to build against and coexist
+ with apache2.2 (closes: #390455).
+
+ -- sean finney  Sat, 07 Oct 2006 12:06:09 +0200
+
+php5 (5.1.6-3) unstable; urgency=low
+
+ [ sean finney ]
+ \* php5 was building against db4.3 even though db4.4 headers were
+ installed. fix applied to ./ext/dba/config.m4 while we wait
+ for a real fix from upstream (closes: #388601).
+
+ -- sean finney  Mon, 02 Oct 2006 17:42:50 +0200
+
+php5 (5.1.6-2) unstable; urgency=low
+
+ [ sean finney ]
+ \* enable the mysqli extension (closes: #320835).
+
+ -- sean finney  Tue, 19 Sep 2006 19:31:27 +0200
+
+php5 (5.1.6-1) unstable; urgency=high
+
+ [ Adam Conrad ]
+ \* Drop 041-shut\_up\_snmp.patch, which was no longer needed as of 5.1.0.
+
+ [ OndÅej SurÃ½ ]
+ \* Acknowledge NMU.
+ \* New upstream release (Closes: #383596)
+ - Added missing safe\_mode/open\_basedir checks inside the error\_log(),
+ file\_exists(), imap\_open() and imap\_reopen() functions.
+ - Fixed overflows inside str\_repeat() and wordwrap() functions on 64bit
+ systems.
+ - Fixed possible open\_basedir/safe\_mode bypass in cURL extension and
+ with realpath cache. (CVE-2006-2563) (Closes: #370165)
+ - Fixed overflow in GD extension on invalid GIF images.
+ - Fixed a buffer overflow inside sscanf() function. (CVE-2006-4020)
+ (Closes: #382256)
+ - Fixed an out of bounds read inside stripos() function.
+ - Fixed memory\_limit restriction on 64 bit system (really with 5.1.6).
+ \* Bump libdb build-dep from libdb4.3 to libdb4.4, to match with apache.
+
+ -- OndÅej SurÃ½  Sat, 19 Aug 2006 14:41:43 +0200
+
+php5 (5.1.4-0.1) unstable; urgency=high
+
+ \* Non-maintainer upload.
+ \* New upstream release. (Closes: #366109)
+ \* Fixes information leak in html\_entity\_decode() (CVE-2006-1490).
+ (Closes: #359907)
+ \* Fixes phpinfo() XSS (CVE-2006-0996). (Closes: #361914)
+ \* Fixes copy() safe mode bypass (CVE-2006-1608). (Closes: #361915)
+ \* Fixes tempnam() open\_basedir bypass (CVE-2006-1494). (Closes: #361916)
+ \* Fixes wordwrap() buffer overflow (CVE-2006-1990). (Closes: #365312)
+ \* Fixes substr\_compare() DoS condition (CVE-2006-1991).
+ \* Fixes crash during too deep recursion (CVE-2006-1549). (Closes: #361917)
+ \* Fixes injection in mb\_send\_mail() (CVE-2006-1014, CVE-2006-1015); not
+ mentioned in upstream changelog. (Closes: #368595)
+ \* 044-strtod\_arm\_fix.patch: Adapted for new upstream; pulled in from
+ Piotr Roszatycki's packages.
+ \* 108-64bit\_datetime.patch: Patch to fix possible segfault on systems where
+ sizeof(void\*) > sizeof(int); patch from David Mosberger-Tang.
+
+ -- Steinar H. Gunderson  Tue, 13 Jun 2006 22:38:33 +0200
+
+php5 (5.1.2-1) unstable; urgency=low
+
+ \* New upstream bugfix and security update release (closes: #347894)
+ - Fixes multiple cross-site-scripting vulnerabilities; CVE-2006-0208
+ - Resolves multiple HTTP response splitting vulnerabilities, allowing
+ arbitrary header injection via Set-Cookie headers; see CVE-2006-0207
+ - While we don't currently build it, this release also fixes a format
+ string vulnerability in the mysqli extension; see CVE-2006-0200
+ - Includes a new version of the PEAR installer that seems to have a
+ slightly better clue about the difference between INSTALL\_ROOT and
+ PHP\_PEAR\_INSTALL\_DIR, fixing pear.conf (closes: #346479, #346501)
+ \* While the above is partially true, the PEAR installer is still a bit
+ broken (it won't install correctly under fakeroot anymore, YAY), so
+ shuffle debian/rules to have a build-pear-stamp target, as a stopgap.
+ \* Add 106-strptime\_xopen.patch, moving the \_XOPEN\_SOURCE definition down
+ in ext/standard/datetime.c, below the php.h include (closes: #346550)
+ \* Add 107-reflection\_is\_ext.patch, munging ext/reflection/config.m4 to
+ properly call the PHP\_ARG\_ENABLE macro for an extension, not built-in.
+ \* Stop php-pear from Replacing and Conflicting with php-html-template-it,
+ as we only now ship the bare essential to make the pear installer go.
+
+ -- Adam Conrad  Mon, 16 Jan 2006 16:12:31 +1100
+
+php5 (5.1.1-1) unstable; urgency=low
+
+ \* New upstream bugfix release, skipping the problematic 5.1.0 release:
+ - Fixes a zend.ze1\_compatibility\_mode segfault (closes: #333374)
+ - Remove libtool patch from acinclude.m4, now integrated upstream.
+ - Remove 038-round\_test\_fix.patch, now integrated upstream.
+ - Remove 049-exported-headers.patch, as upstream's build system has
+ gotten more clever about what they should and shouldn't export.
+ - Remove 054-open\_basedir\_slash.patch, now integrated upstream.
+ - Remove 055-gd\_safe\_mode\_checks.patch, fixed differently upstream.
+ - Mangle 101-sqlite\_is\_shared.patch, to deal with upstream changes.
+ - Remove 104-64\_bit\_serialize.patch, now integrated upstream.
+ - Remove 105-64\_bit\_imagettftext.patch, now integrated upstream.
+ \* Many security vulnerabilities fixed (closes: #341368, #336005, #336654):
+ - Resolves a local denial of service in the apache2 SAPI, which can
+ be triggered by using session.save\_path in .htaccess; CVE-2005-3319
+ - Resolves an infinite loop in the exif\_read\_data function which can
+ be triggered with a specially-crafted JPEG image; CVE-2005-3353
+ - Resolves a vulnerability in the parse\_str function whereby a remote
+ attacker can fool PHP into turning on register\_globals, thus making
+ applications vulnerable to global variable injections; CVE-2005-3389
+ - Resolves a vulnerability in the RFC1867 file upload feature where, if
+ register\_globals is enabled, a remote attacker can modify the GLOBALS
+ array with a multipart/form-data POST request; see CVE-2005-3390
+ - Resolves numerous safe\_mode and open\_basedir bypasses; CVE-2005-3391
+ - Resolves INI settings leaks in the apache2 SAPI, leading to safe\_mode
+ and open\_basedir bypasses between virtual hosts; CVE-2005-3392
+ - Resolves a CRLF injection vulnerability in the mb\_send\_mail function,
+ allowing injection of arbitrary mail headers; see CVE-2005-3883
+ - Includes PEAR 1.4.5, resolving a vulnerability in the pear installer
+ which could lead to arbitrary code execution; see CVE-2005-4154
+ \* Bump libdb build-dep from libdb4.2 to libdb4.3, to match with apache.
+ \* Bump our MySQL build-dep to 5.0's libmysqlclient15-dev (closes: #343793)
+ \* Automate the process of getting the list of built-in modules into the
+ package descriptions, so it stays fresh in the future (closes: #341867)
+ \* Intentionally disable PDO support until I've sorted out the best way to
+ deal with shipping this shiny new feature that won't break the world.
+ \* The new PEAR happens to fix the Command.php greedy match bug filed in
+ Debian as part of the fix for the wider security issue (closes: #334969)
+ \* Create 056-mime\_magic\_strings.patch, making the mime\_magic extension
+ more liberal about what mime-types is accepts, as well as making it skip
+ over ones it dislikes, rather than disabling itself (closes: #335674)
+ \* Add 057-no\_apache\_installed.patch, to stop spewing a mess of errors in
+ configure because we don't have the apache binaries in the build chroot.
+ \* Fix small typo in the php5-xsl package description (closes: #344816)
+
+ -- Adam Conrad  Thu, 15 Dec 2005 14:46:56 +1100
+
+php5 (5.0.5-3) unstable; urgency=low
+
+ \* Build-Depend on libcurl3-openssl-dev, since libcurl3-dev is going away
+ soon. Keep libcurl3-dev as an alternate for backporting (see: #334367)
+ \* Switch from libmysqlclient12 to libmysqlclient14; this puts us on the
+ \*other\* side of the line regarding which combinations of DSOs cause
+ segfaults, so hopefully the others catch up with us soon (closes: #332453)
+ \* Look for magic.mime in /usr/share/file now instead of /usr/share/misc/file,
+ as the path has been changed to comply with the FHS (see: #334510)
+ \* Make the above backportable as well, by searching for both files, and
+ picking the one that's currently installed on the user's system.
+ \* Include swedish debconf translation from Daniel Nylander (closes: #330763)
+ \* Make pear use '/usr/bin/php' instead of just 'php' to make sure we don't
+ get some random binary on $PATH that won't work right (closes: #329415)
+ \* Set PHP\_PEAR\_SIG\_BIN to /usr/bin/gpg, and have php-pear Recommends: gnupg
+
+ -- Adam Conrad  Fri, 21 Oct 2005 02:30:19 +1000
+
+php5 (5.0.5-2) unstable; urgency=medium
+
+ \* Remove Andres Salomon from the Uploaders field, at his request. Thanks
+ for all your work on the PHP packages, Andres, now fix our kernel bugs.
+ \* Add 054-open\_basedir\_slash.patch, which fixes a bug where if open\_basedir
+ is set to "/foo/", users can access files in "/foobar/", which is not the
+ documented behaviour; this addresses CAN-2005-3054 (see: #323585)
+ \* Add 104-64\_bit\_serialize.patch from Joe Orton, resolving a segfault when
+ serializing objects on all 64-bit architectures (closes: #329768)
+ \* Add 105-64\_bit\_imagettftext.patch, fixing a type mismatch in the GD
+ extension, causing memory corruption on 64-bit arches (closes: #331001)
+ \* Add 055-gd\_safe\_mode\_checks.patch from PHP CVS, adding missing safe\_mode
+ checks to the \_php\_image\_output and \_php\_image\_output\_ctx GD functions.
+ \* Make php-pear Provide, Replace, and Conflict php-html-template-it, which
+ we appear to have absorbed into the main PEAR packaging (closes: #332393)
+
+ -- Adam Conrad  Tue, 27 Sep 2005 16:09:29 +1000
+
+php5 (5.0.5-1) unstable; urgency=low
+
+ \* New upstream release, adjust patch offsets and fuzz, and drop patches:
+ - Drop 009-snmp-int-sizes.patch, finally fixed upstream.
+ - Drop 051-gcc-4.0.patch, fixed differently upstream.
+ - Drop 102-php\_streams.patch, fixed upstream.
+ - Drop 103-catch\_segv.patch, also fixed upstream.
+ - Includes PEAR XML\_RPC fix for CAN-2005-2498.
+ - Includes phpinfo() XSS fix for CVE-2005-3388.
+ \* Distribute the shiny new manpages for php-config and phpize.
+
+ -- Adam Conrad  Mon, 12 Sep 2005 02:29:24 +1000
+
+php5 (5.0.4-4) unstable; urgency=low
+
+ \* OndÅej SurÃ½ :
+ - Add patch from CVS to fix regression in PHP 5.0.4, where file related
+ functions all stop reading at 2,000,000 bytes (closes: #321930)
+ \* Adam Conrad :
+ - Enable support for gdbm files in the dba handler; half the base system
+ already appears to depend on libgdm, so we can't make things worse.
+ - Add another patch from CVS to fix a segfault in the catch/throw
+ handler under interesting nesting cases (closes: #322507)
+ - Rebuild against libsnmp9-dev for new libsnmp SOVER (closes: #327107)
+
+ -- Adam Conrad  Thu, 8 Sep 2005 00:36:36 +1000
+
+php5 (5.0.4-3) unstable; urgency=low
+
+ \* And fix the module/extension API situation one last time, this time
+ we read ZEND\_EXTENSION\_API\_NO, ZEND\_MODULE\_API\_NO, and PHP\_API\_VERSION,
+ pick the most recent of the three, assume things broke in ways we're
+ not willing to cope with, and both change the extension directory to
+ use that value, as well as setting it to the provides/depends for the
+ various SAPI and extension packages.
+ \* Add a new option to php-config, 'php-config --phpapi', which extension
+ packagers should now be using to get the current phpapi they're building
+ against and set their dependencies accordingly.
+ \* Strip the -gnu off the end of the DEB\_\*\_\* variables and drop the
+ versioned dpkg-dev build-dep to ease backporting to sarge and hoary;
+ doing so in such a way as to still allow for easy cross-compiling.
+ \* Add postgresql-dev build-dep alternate for easy hoary/sarge backports.
+ \* Make libapache2-mod-php5 the default alternate dependency for the php5
+ metapackage, since we really do want to encourage the apache upgrade.
+ \* Make php5-dev stop shipping copies of files from autotools-dev, shtool,
+ and libtool, and instead symlink to them and depend on those packages,
+ thus avoiding the shtool issues from CAN-2005-1751 and CAN-2005-1759.
+
+ -- Adam Conrad  Sun, 31 Jul 2005 03:05:08 +1000
+
+php5 (5.0.4-2) unstable; urgency=low
+
+ \* We now have a mailing list. Set the maintainer to the list, and move
+ myself to Uploaders where, apparently, I belong.
+ \* Use ZEND\_MODULE\_API\_NO rather than PHP\_API\_VERSION for extension deps,
+ as recent upstream ABI breakage in 4.4.0 leads me to believe this is
+ the only constant they actually bother to update on ABI changes.
+ \* Bring back some concflicts that went missing (libapache-mod-php5 needs
+ to conflict with libapache-mod-php4 and older versions of php4, while
+ the two libapache2-mod-php[45] modules also need to conflict).
+ \* Adjust debian/watch to not match on upstream's alpha/beta/rc releases.
+
+ -- Adam Conrad  Wed, 27 Jul 2005 22:30:42 +1000
+
+php5 (5.0.4-1) unstable; urgency=low
+
+ \* Initial PHP5 release; packaging forked from php4 4:4.3.11-1.
+ - Closes: #262977, #293832
+ \* Ondrej Sury :
+ - Removed some obsolete cruft, since there wasn't any previous php5
+ packages there is no need, to check /usr/share/doc/\*, etc.
+ - Removed apache2 IfModule hack, it's been fixed in php5.
+ - Updated patches to php5, removing those which are obsolete.
+ - Changes xslt extension to xsl (using libxslt).
+ - Updated debian/\* including changelog.
+ - Raised update-alternatives priority to 50.
+ \* Adam Conrad :
+ - Merged with php4 4:4.4.0-1 packaging.
+ - Re-roll upstream tarball to include PEAR::XML\_RPC 1.3.3, which
+ includes a security fix for CVE CAN-2005-1921.
+ - Bump to Standards-Version 3.6.2, with no source changes.
+ - Stop distributing the phpextdist binary, as upstream has stopped.
+ - Drop the ext\_skel binary and skeleton dir from php5-dev, as it has
+ been deemed obsolete upstream and the version in the tarball is not
+ considered useful anymore. PEAR::PECL\_Gen upstream will replace it.
+ - Fix longstanding broken shebang lines in debconf config scripts.
+ - Remove lintian overrides for modules; lintian no longer complains
+ about missing shlibs for libraries outside the linker path.
+ - Add a linda override for the non-standard directory permissions on
+ /var/lib/php5 in php5-common.
+ - Rename php5-pear to php-pear, have it replace php4-pear, and depend
+ on php5-cli OR php4-cli; make sure it works with both.
+ - Compile in SOAP extension (closes: #307580)
+ - Enable SQLite extension as shared, make the xmlrpc extension shared.
+ - Enabled the pgsql extension, and disabled the imap extension (which
+ will be moving to another source package and become the example
+ package for out-of-tree builds).
+
+ -- Adam Conrad  Sat, 16 Jul 2005 23:42:36 +1000
+
+php4 (4:4.3.11-1) unstable; urgency=low
+
+ \* New upstream release (closes: #304052)
+ - Drop CVS patches, we're back in step with upstream versions.
+ - Remove 048-x509\_multiple\_orgUnits.patch, incorporated in 4.3.11.
+ - Remove 050-4.3.11\_file\_copy\_fix.patch, incorporated in 4.3.11.
+ - Remove 040-curl\_open\_basedir.patch, as upstream has solved this
+ in a different fashion.
+ - Adjust patches for offset and fuzz.
+ - Remove bits from debian/rules dealing with the DB PEAR extension,
+ since it's no longer shipped in the php4-pear package.
+ \* Rebuild against newer version of freetds library (closes: #317369)
+ \* Add 052-phpinfo\_no\_configure.patch, which disables the display of our
+ "Configure Command" in phpinfo(), which was the source of many bogus
+ bug reports over the years, due to people misinterpreting its meaning.
+ \* New translations to Vietnamese and Russian (closes: #316821, #310199)
+ - vi.po contributed by Clytie Siddall
+ - ru.po contributed by Yuriy Talakan'
+ \* Mention FastCGI in the description of php4-cgi (closes: #310810)
+
+ -- Adam Conrad  Mon, 4 Jul 2005 17:47:32 +1000
+
+php4 (4:4.3.10-15) unstable; urgency=low
+
+ \* Bring back the shipping of /usr/share/doc symlinks in our packages,
+ as this, in concert with moving the migration detection from preinst
+ to postinst (which was done in the last upload), seems to give us the
+ sanest upgrade path. Thanks to Steve Langasek for smacking me around
+ with unpack/upgrade scenarios for a while to convince me of this.
+
+ -- Adam Conrad  Mon, 9 May 2005 02:13:19 -0600
+
+php4 (4:4.3.10-14) unstable; urgency=high
+
+ \* Revert the directory->symlink magic to work how it used to, since the
+ new behaviour broke hideously on upgrades from Woody, causing certain
+ files (like the changelog) to mysteriously go missing (closes: #307591)
+ \* Move our template php.ini to /usr/share/php4, so we stop violating
+ policy by using files from /usr/share/doc (as seen in #307591)
+ \* Remove 'readline' from the php4-cli package description, since we don't
+ actually build with readline support enabled anymore (closes: #306571)
+
+ -- Adam Conrad  Wed, 4 May 2005 01:48:19 -0600
+
+php4 (4:4.3.10-13) unstable; urgency=low
+
+ \* Update email address for Andres Salomon
+ \* Add Portuguese translation from Miguel Figueiredo (closes: #305038)
+ \* Include 051-gcc-4.0.patch, which resolves a build failure in
+ libxmlrpc (from the xmlrpc extension) with gcc-4.0 (closes: #287956)
+
+ -- Adam Conrad  Mon, 18 Apr 2005 00:29:54 -0600
+
+php4 (4:4.3.10-12) unstable; urgency=low
+
+ \* Add 050-4.3.11\_file\_copy\_fix.patch, which reverts a broken 'fix'
+ made to the copy() function, causing it to fail in particularly
+ spectacular ways when used on remote files (closes: #304601)
+ \* Use -g instead of -gstabs on powerpc64-linux (closes: #301571)
+
+ -- Adam Conrad  Thu, 14 Apr 2005 03:53:27 -0600
+
+php4 (4:4.3.10-11) unstable; urgency=medium
+
+ \* Address an FTBFS waiting to happen in the php4-dev package:
+ - Remove Win32 and Netware specific headers.
+ - Stop shipping php4-pgsql headers.
+ - Stop shipping the expat headers, since we don't even
+ use the bundled expat library.
+ - Make php4-dev depend on libssl-dev, since it wants to include
+ ssl.h when you use it to build network-using extensions.
+ \* Stop building extensions twice; we don't need two copies.
+
+ -- Adam Conrad  Tue, 12 Apr 2005 03:14:03 -0600
+
+php4 (4:4.3.10-10) unstable; urgency=low
+
+ \* Update to 200503131325 CVS (AKA: 4.3.11RC1), fixing several bugs
+ including a segfault in mysql\_fetch\_field() (closes: #299608)
+ \* Remove 042-remove\_windows\_paths.patch, incorporated upstream.
+ \* Add 048-x509\_multiple\_orgUnits.patch to bring the openssl extension
+ in line with the upcoming 4.3.11 behaviour of listing multiple
+ Organisational Units in an x509 cert as an array, rather than only
+ listing the last in the list.
+ \* After much talk with upstream, revert the ZTS changes. We are no
+ longer building a thread-safe PHP. (closes: #299820, #297223, #297679)
+ \* ZTS was breaking file search paths, leading to errors loading files
+ from the cwd (closes: #298282, #298518, #299089, #299356)
+ \* Stop building caudium-php4 (closes: #294718, #297702, #295100)
+ - We can't link against the GPL pike7.2, which we've been doing. Oops.
+ - Even if the above weren't true, upstream has insisted that ZTS is a
+ horribly broken solution, slated for eventual removal, and should
+ never, ever be used. In light of that, caudium users should instead
+ use php4-cgi, either as a plain CGI, or as a FastCGI backend.
+ - Not even attempting to provide an upgrade path, as it would be
+ needlessly complex, and caudium-php4 in previous stable releases
+ was nothing more than a useless toy, given that it had nearly no
+ useful extensions built-in or supported.
+ \* Rewrite 041-shut\_up\_snmp.patch to take a different approach, this time
+ regrettably reverting a fix for a memory leak, in the name of making
+ things work properly, including squashing the putenv() intecaction
+ bug between PHP and other apache modules (closes: #298511, #300628)
+ \* On sidegrades from distributions where different modules may be built
+ from their own source, and thus have their own doc directories, bad
+ things happen when we try to replace those with symlinks, so now we
+ check for this in preinst, and fix stuff up magically to Just Work.
+ \* Add Jeroen van Wolffelaar  to Uploaders.
+ \* Fix up modules regexes to use "\.so" instead of ".so" (cf: #300998)
+
+ -- Adam Conrad  Wed, 16 Mar 2005 22:46:05 -0700
+
+php4 (4:4.3.10-9) unstable; urgency=low
+
+ \* Update 040-curl\_open\_basedir.patch once more to make sure it doesn't
+ segfault when fed a null or uninitialised URL (closes: #295447)
+ \* Add 047-zts\_with\_dl.patch, courtesy of Steve Langasek to re-enable the
+ dl() function in our builds, despite upstream's claim that it "might
+ not be threadsafe on all platforms"; it is on ours (closes: #297839)
+ \* Make the php4-dev binaries versioned with alternatives (closes: #295903)
+ \* Update build-deps to libmysqlclient12-dev (closes: #290989, #227549)
+
+ -- Adam Conrad  Sun, 6 Mar 2005 07:30:35 -0700
+
+php4 (4:4.3.10-8) unstable; urgency=high
+
+ \* Add 046-zend\_plist\_buggery.patch which unrolls the changes made to
+ zend.c in CVS post-4.3.10. The memory leaks fixed by these changes
+ seem to not have been hurting us terribly so far, while the "fix"
+ (breaking persistent lists) was, uhm, bad (closes: #295998, #296694)
+ \* Revise 041-shut\_up\_snmp.patch to call init\_snmp with 'snmpapp' as the
+ appname, rather than 'php', to maintain backward compatibility, and to
+ wrap our setenv/unsetenv magic only around snmp\_shutdown, which seems to
+ solve a segfault when php4-snmp is loaded with mod\_perl (closes: #296282)
+ \* Fix 042-remove\_windows\_paths.patch to catch both cases where windows
+ path stripping should occur (closes: #296406)
+
+ -- Adam Conrad  Tue, 22 Feb 2005 07:49:32 -0700
+
+php4 (4:4.3.10-7) unstable; urgency=high
+
+ \* Rewrite 040-curl\_open\_basedir.patch, so it now does what it's supposed
+ to (addressing CAN-2004-1392) and no longer segfaults (closes: #295447)
+
+ -- Adam Conrad  Thu, 17 Feb 2005 00:06:36 -0700
+
+php4 (4:4.3.10-6) unstable; urgency=high
+
+ \* Add 044-strtod\_arm\_fix.patch to fix the FPU confusion FTBFS on arm.
+ \* Add 045-exif\_nesting\_level.patch to bump the exif header parsing max
+ nesting level to something that actually works with most JPEG images.
+
+ -- Adam Conrad  Mon, 14 Feb 2005 16:04:28 -0700
+
+php4 (4:4.3.10-5) unstable; urgency=low
+
+ \* Add 043-recode\_size\_t.patch to fix 32/64-bit issues causing the recode
+ extension to segfault on alpha/amd64/ia64 (closes: #294986)
+ \* Move the ./buildconf stuff in the unpatch target inside the test
+ for patch-stamp, as it's uselss unless we're unpatching.
+
+ -- Adam Conrad  Sun, 13 Feb 2005 19:09:39 -0700
+
+php4 (4:4.3.10-4) unstable; urgency=medium
+
+ \* Make php4-dev arch:any, as it contains some arch-specific defines.
+ \* Add 042-remove\_windows\_paths.patch, a patch to rfc1867.c to strip Windows
+ paths from uploaded filenames, like it used to. (closes: #294305)
+ \* Fix up caudium description to reflect the fact that caudium it is no
+ longer restricted from sharing extensions with other SAPIs.
+ \* Build-dep on apache2-threaded-dev (>= 2.0.53-3) to make sure we
+ get a version with non-broken headers.
+
+ -- Adam Conrad  Wed, 9 Feb 2005 11:52:10 -0700
+
+php4 (4:4.3.10-3) unstable; urgency=medium
+
+ \* Update to CVS, as of 200502060530 (closes: #288672)
+ - Fixes two vulnerabilities in exif.c, CAN-2005-1042 and CAN-2005-1043
+ - Fixes two vulnerabilities in image.c, CAN-2005-0524 and CAN-2005-0525
+ - File uploads with "'" in them aren't cut off anymore (closes: #288679)
+ - unserialize() is no longer ridiculously slow (closes: #291392)
+ - Add 000-200502060530\_CVS.patch
+ - Adapt debian/rules to the realities of upstream's new buildconf
+ - Add 033-we\_WANT\_libtool.patch, to force relibtoolizing with Debian's
+ libtool, rather than using upstream's broken bundled libtool
+ - Drop 031\_zend\_strtod\_1.1.2.10.patch and 032\_zend\_strtod\_debian.patch
+ - Adjust patches for offsets and fuzz
+ - Force --with-pic, as policy demands it, and the build system doesn't
+ \* Added several patches, yanked from the Fedora PHP sources:
+ - 034-apache2\_umask\_fix.patch, fixes umask not being properly reset
+ after each request (closes: #286225)
+ - 036-fd\_setsize\_fix.patch, fixes misuse of FD\_SET()
+ - 038-round\_test\_fix.patch, makes the rounding test work on gcc-3.3
+ \* Removed --with-libedit, as being able to background php is more useful,
+ in my opinion, than using readline functions (see #286356)
+ \* Include zip support in all SAPIs (closes: #288534, #288909)
+ \* Enable Zend Thread Safety for all SAPIs, meaning that our modules
+ are now compiled for ZTS APIs as well. (closes: #278212, #264015)
+ - Make sure caudium-php4 now provides phpapi-$(ver), and modules can
+ be configured with the caudium SAPI.
+ - Add 039-reentrant\_libs.patch to link to the reentrant versions of
+ libldap and libmysqlclient
+ \* Stop suggesting phpdoc, as it's undistributable anyway.
+ \* Add 040-curl\_open\_basedir.patch, to make php4-curl respect the value
+ of open\_basedir, thanks to Martin Pitt (closes: #291410)
+ \* Add 041-shut\_up\_snmp.patch, to prevent libsnmp5 from attempting (and
+ failing) to write persistent data every time it shuts down. Ugh.
+
+ -- Adam Conrad  Sun, 6 Feb 2005 05:32:11 -0700
+
+php4 (4:4.3.10-2) unstable; urgency=high
+
+ \* Patch Zend/zend\_strtod.c twice:
+ - Patch from upstream CVS to fix FTBFS on Sparc/Linux systems
+ - Patch from me to fix FTBFS on \_\_mc68000\_\_, \_\_ia64\_\_, and \_\_s390\_\_
+
+ -- Adam Conrad  Sat, 18 Dec 2004 19:35:30 -0700
+
+php4 (4:4.3.10-1) unstable; urgency=high
+
+ \* New upstream release, including the following security fixes:
+ - CAN-2004-1018 - shmop\_write() out of bounds memory write access.
+ - CAN-2004-1018 - integer overflow/underflow in pack() and unpack()
+ functions.
+ - CAN-2004-1019 - possible information disclosure, double free and
+ negative reference index array underflow in deserialization code.
+ - CAN-2004-1020 - addslashes() not escaping \0 correctly.
+ - CAN-2004-1063 - safe\_mode execution directory bypass.
+ - CAN-2004-1064 - arbitrary file access through path truncation.
+ - CAN-2004-1065 - exif\_read\_data() overflow on long sectionname.
+ - magic\_quotes\_gpc could lead to one level directory traversal with
+ file uploads.
+ \* Adjust patch offsets for new upstream, fix 013-force\_getaddrinfo.patch
+ to match with new configure.in and drop 026-4.3.10\_session\_fixes.patch
+ which is included in 4.3.10.
+
+ -- Adam Conrad  Wed, 15 Dec 2004 17:17:40 -0700
+
+php4 (4:4.3.9-2) unstable; urgency=low
+
+ \* Adam Conrad :
+ - Add -fno-strict-aliasing to CFLAGS, as the (several thousand)
+ warnings I'm getting from GCC are frightening me a tad.
+ - Remove the php-cgi alternative in php4-cgi's prerm, to avoid
+ leaving dangling symlinks (closes: #275962, #282315)
+ - Include 030-imap\_getacl.patch, adding the imap\_getacl() function
+ required by the GOsa project (closes: #282484)
+ - Include php.ini-paranoid in doc/examples, provided and maintained
+ by Javier FernÃ¡ndez-Sanguino PeÃ±a (closes: #274374)
+ - Make /cgi-bin/php4 an alternative for /cgi-bin/php (closes: #282464)
+ - Remove obsolete info from README.Debian relating to session\_mm,
+ since we stopped building with libmm a while back.
+ - Reintroduce /usr/lib/php4/libexec that went missing in a previous
+ upload, since the build uses it as the default safe\_mode exec dir.
+ \* Andres Salomon :
+ - Add patch to include gd headers in php4-dev, as some PECL modules
+ (notably, pdflib) expect it; 028-export\_gd\_headers.patch.
+ - Lintian fix: Add missing #DEBHELPER# token to php4-common.postrm.
+
+ -- Adam Conrad  Wed, 01 Dec 2004 18:48:13 -0700
+
+php4 (4:4.3.9-1) unstable; urgency=high
+
+ \* New upstream release, removed the following patches fixed upstream:
+ 014-apache2handler\_CVS\_fixes.patch, 015-gdNewDynamicCtx\_Add\_Ex.patch,
+ 018-unix\_socket\_fd\_leak.patch, 020-4.3.9\_overflow\_fixes.patch,
+ 021-4.3.9\_sybase\_ct\_fixes.patch, 022-4.3.9\_sprintf\_fixes.patch,
+ 023-4.3.9\_array\_fixes.patch, 024-4.3.9\_glob\_fix.patch,
+ and 025-4.3.9\_domxml\_segfaults.patch
+ \* Resolves undiscolsed vulnerabilities in GPC processing and rfc1867
+ handling of file uploads via the $\_FILES array; these have since
+ been assigned CVE CAN-2004-0958 and CAN-2004-0959 (closes: #274206)
+ \* After some fairly heavy testing from several users and developers,
+ finally update php4-snmp to use libsnmp5 (closes: #195929)
+ \* Add 026-4.3.10\_session\_fixes.patch from CVS, which prevents PHP
+ from segfaulting when a nonexistant or unsupported save\_handler or
+ serialize\_handler is specified in php.ini.
+ \* Add /etc/apache/conf.d/php4.conf, setting up our mime-types, on the
+ off chance that the user's /etc/mime.types is broken (closes: #271171)
+ \* Reintroduce a CGI binary at /usr/bin/php4-cgi, so people who can't
+ make use of the --force-cgi-redirect CGI binary in /usr/lib/cgi-bin
+ can instead use #!/usr/bin/php4-cgi scripts (closes: #273143)
+ \* Enable FastCGI for both CGI binaries, now that it no longer conflicts
+ with, but rather complements, the CGI SAPI (closes: #233849)
+ \* Bump libgd2 build-dep a notch to make sure we build against a version
+ that actually has XPM support built in (closes: #270435)
+ \* Finally drop the bogus libapache-mod-ssl dependency from the apache1.3
+ php4 module, as glibc (>= 2.3.2.ds1-17) has fixed the dlopen refcount
+ bug that we were hacking around (closes: #205553, #230956, #271000)
+ \* Remove the mm session handler from the apache1.3 build. Since the
+ files handler now works on all arches, and is configured to be secure
+ by default, mm seems to have outlived its usefulness.
+ (closes: #119902, #149430, #166811, #272463, #232840)
+ \* Rename sapi/apache2handler/sapi\_apache2.c to mod\_php4.c so that
+  directives aren't ambiguous between php4 and php5.
+ \* Add Czech translation, thanks to Miroslav Kure (closes: #274038)
+ \* Configure CLI with --with-libedit for readline support, and add
+ 027-readline\_is\_editline.patch, since Debian's libedit headers are
+ not installed in /usr/include/readline (closes: #274031)
+ \* libcurl grew a new SONAME somewhere along the way, and upgrading
+ doesn't seem to cause regressions in php4-curl, so upgrade we shall,
+ changing build-deps accordingly (closes: #260389)
+
+ -- Adam Conrad  Mon, 4 Oct 2004 22:57:37 -0600
+
+php4 (4:4.3.8-12) unstable; urgency=high
+
+ \* On new php4-cli installations, if php4-cgi is installed, we copy its
+ php.ini as a starting reference, so that command line scripts that
+ used to work don't start mysteriously failing (closes: #270153)
+ \* php4-common has grown a postrm script to make sure we completely
+ clean out and remove /var/lib/php4 during the purge phase.
+ \* Optimize garbage collection cronjob to use 'xargs -r -0 rm', so we
+ aren't forking for every session file we delete (closes: #268918)
+
+ -- Adam Conrad  Sun, 5 Sep 2004 19:17:42 -0600
+
+php4 (4:4.3.8-11) unstable; urgency=high
+
+ \* Andres Salomon :
+ - Fix bashism in maxlifetime script (closes: #270015)
+ \* Adam Conrad :
+ - Clarify setup instructions in README.Debian for using php4-cgi
+ with the apache and apache2 packages (closes: #228342, #228343)
+
+ -- Adam Conrad  Sat, 04 Sep 2004 23:21:21 -0600
+
+php4 (4:4.3.8-10) unstable; urgency=high
+
+ \* Andres Salomon :
+ - Change frequency of session file cleansing, based on the maximum value
+ of session.gc\_maxlifetime from all php.ini files (closes: #269688).
+ - Update README.Debian to mention session cleaning cron job.
+ \* Adam Conrad :
+ - Drop php4-cgi from the list of alternate dependencies for the php4
+ metpackage to smooth upgrades for woody users who have both php4 and
+ php4-cgi installed (closes: #269628, #269348, #269377)
+ - Fix cut-n-paste issue in php4-cli postinst (closes: #269466)
+ - Add 023-4.3.9\_array\_fixes.patch, which fixes problems with the
+ extract() function misbehaving with multiple element references.
+ - Add 024-4.3.9\_glob\_fix.patch to fix broken return values from glob()
+ when it succeeds with no matches (closes: #269287)
+ - Add 025-4.3.9\_domxml\_segfaults.patch, fixing segfaults in the domxml
+ extension when it shares memory space with other libxml2-using libs.
+ - Update the comments in php.ini to point out that, due to dilinger's
+ changes above, session.gc\_maxlifetime is honoured by the gc cronjob.
+
+ -- Adam Conrad  Fri, 03 Sep 2004 20:42:56 -0600
+
+php4 (4:4.3.8-9) unstable; urgency=high
+
+ \* Re-introduce the changelog.Debian that went missing in the last
+ upload due to the php4-common move from arch:all to arch:any
+ \* Clean up lintian warnings regarding scripts that weren't executable
+ and executables that weren't scripts.
+ \* Add a lintian override for the non-standard-dir-perm of /var/lib/php4
+ \* Update to Standards-Version 3.6.1 (no changes, other than the above)
+
+ -- Adam Conrad  Thu, 26 Aug 2004 21:53:27 -0600
+
+php4 (4:4.3.8-8) unstable; urgency=low
+
+ \* Default session.save\_path is now compiled in to php4, allowing
+ us to, again, comment out the value in php.ini.
+ \* Comment out session.gc\_probability in the default php.ini, as we've
+ now compiled in a default of 0, allowing the cronjob to do the
+ garbage collection for us instead. (closes: #267720)
+ \* Make the 5 SAPI postinsts smarter, allowing them to poke around in
+ people's configs and make sure that sessions won't be broken
+ after we upgraded them from a perfectly functional system.
+ \* Add 022-4.3.9\_sprintf\_fixes.patch, fixing incorrect formatting of
+ floats with padding by sprintf().
+ \* Make php4-common arch:any, and loosen up some of the other any->all
+ package dependencies to make sure binNMUs won't break.
+
+ -- Adam Conrad  Tue, 24 Aug 2004 03:09:43 -0600
+
+php4 (4:4.3.8-7) unstable; urgency=high
+
+ \* Back out LFS support AGAIN, as we're disabling LFS in apache2 for
+ the Sarge release. (closes: #266869)
+ \* Add 021-4.3.9\_sybase\_ct\_fixes.patch, backporting several fixes
+ for the sybase\_ct extension from 4.3.9rc1.
+ \* Tidy up descriptions a fair bit:
+ - Disambiguate short descriptions of SAPIs. (closes: #244571)
+ - Refresh the (now much longer) lists of built-in modules for each SAPI.
+ - Explain why caudium-php4 can't use any loadable extensions.
+ - Remove silly advertising blurb for Zend, since very few people are
+ still using php3, and those who are can't be convinced to upgrade
+ just by telling them "Hey, it's faster!".
+ - Add Homepage URI to each SAPI description.
+ - Fix typo in php4-domxml description. (closes: #146124)
+ \* Make caudium-php4 provide php4-mysql and php4-pgsql, so it can be used
+ with packages that depend on something like "php4, php4-mysql".
+ \* Enable --with-mime-magic and make sure all SAPIs depend on libmagic1
+ to pull in /usr/share/misc/file/magic.mime (closes: #175136)
+
+ -- Adam Conrad  Thu, 19 Aug 2004 18:27:17 -0600
+
+php4 (4:4.3.8-6) unstable; urgency=high
+
+ \* Add libgcrypt11-dev to the build-depends, as something seems to be
+ pulling it in and causing an FTBFS (closes: #265952)
+ \* Add 020-4.3.9\_overflow\_fixes, backporting fix for integer overflows
+ in array\_slice(), array\_splice(), substr(), substr\_replace(),
+ strspn() and strcspn().
+ \* Bump the apache2 build-dep to (>= 2.0.50-9) to ensure we're building
+ against the new ABI-incompatble libapr0, which brings in proper
+ large file support. Bump the apache2 binary dependency as well.
+ (closes: #266210, #266192)
+ \* Enable large file support on all SAPIs except for caudium, as I'm not
+ sure how caudium will react to the change, and I don't want to
+ destabilise anything just before release. This change has been
+ heavily tested with apache2/apache/cgi/cli, and all is well there.
+ \* Re-enable 019-z\_off\_t\_as\_long.patch, which is needed to make sure
+ that LFS-enabled SAPIs can still use zlib file functions correctly.
+ \* Rework the apache2 restarting logic to only restart apache2 if
+ apache2ctl configtest succeeds, otherwise kick out a warning to
+ the user. Even then, we run force-reload with ||true, in case
+ apache2 fails to start for other reasons (closes: #264958)
+ \* Make php4-gd Provide php4-gd2, so packages which still depend on
+ php4-gd2 are installable (and so packaging frontends can take the
+ provides/conflicts/replaces hint and DTRT with it)
+ \* Split php4-cgi to php4-cgi and php4-cli (closes: #227915)
+ - Add php4-cli to debian/control, replaces older php4-cgi versions
+ - php4-cgi depends on php4-cli for smooth transitions
+ - php4-pear now depends on php4-cli (closes: #243214, #221434)
+ - Add php4-cli to list of SAPIs configurable for modules
+ - Munge php.1 manpage to include -cli info
+ - Enable pcntl and ncurses in -cli (closes: #135861, #190947, #241806)
+ \* Move all of php4's files to libapache-mod-php4, and make php4 a
+ metapackage that depends on libapache-mod-php4 | libapache2-mod-php4 |
+ php4-cgi | caudium-php4 (closes: #244573, #246654, #244571, #266517)
+ \* Include skeleton directory in php4-dev (closes: #95832, #211338)
+ \* Include php.ini-recommended in php4-common's examples (closes: #181396)
+ \* Move /var/lib/php4 to php4-common and install a cronjob that cleans
+ out old sessions every 30 minutes (closes: #256831, #257111)
+ \* Move the libapache-mod-ssl dependency from php4-imap to
+ libapache-mod-php4 to stop irritating users of other SAPIs
+ (closes: #240003, #246887, #263381)
+ \* Compile pgsql and mysql support into the caudium SAPI, so it's
+ slightly less useless (closes: #181175)
+
+ -- Adam Conrad  Sun, 15 Aug 2004 19:56:14 -0600
+
+php4 (4:4.3.8-5) unstable; urgency=low
+
+ \* Build-depend on chrpath and use it to nuke rpath from modules
+ during the install target of debian/rules.
+ \* Add 018-unix\_socket\_fd\_leak.patch to get rid of UNIX socket file
+ descriptor leak on failed fsockopen() calls. (closes: #257269)
+ \* It would seem that if we want LFS support, all SAPIs and all extensions
+ that do file access need to be built with LFS support, and since
+ apache2 currently doesn't have LFS, this presents a problem. As
+ such, I'm disabling LFS accross the board until apache2 supports it.
+ (closes: #263962)
+ \* Add 019-z\_off\_t\_as\_long.patch, including local headers for zlib,
+ forcing off\_t = long for gzip file functions, however disable it
+ for now, as we'll only need it if we reenable LFS (closes: #208608)
+ \* Add the Debian package revision as EXTRAVERSION to PHP, so one can
+ more easily tell what version is currently running (for instance,
+ if a user fails to restart Apache after an upgrade of php4, this
+ would become obvious to them in the version banner and in phpinfo()
+ \* Fixed up debian/patches, adjusting offsets and adding newlines,
+ so patch stops complaining and applies them cleanly.
+ \* libapache2-mod-php4 postinst now forces a reload of apache2, which
+ should get the module properly working in all cases where people
+ previously thought 'apachectl graceful' would cut it.
+ (closes: #241352, #263424, #228343)
+ \* debian/rules explicitly sets PROG\_SENDMAIL during configure so
+ that builds on buildds with no sendmail installed don't get the
+ mail() function disabled. (closes: #180734)
+ \* Enable XMLRPC-EPI support for all SAPIs (closes: #228825, #249368)
+ \* Enable sysvmsg support for all SAPIs (closes: #236190)
+ \* Enable dbx support for all SAPIs (closes: #229508, #249797)
+ \* Nuke aclocal.m4 before we run ./buildconf to ensure we get it
+ regenerated correctly, and we get an up-to-date libtoolization.
+
+ -- Adam Conrad  Mon, 9 Aug 2004 07:47:46 -0600
+
+php4 (4:4.3.8-4) unstable; urgency=low
+
+ \* Drop 016-pread\_pwrite\_XOPEN\_SOURCE\_500.patch, as it didn't seem to
+ solve anything, really, and add 017-pread\_pwrite\_disable.patch,
+ wich completely disables pread/pwrite usage, fixing session support
+ on sparc, and pread/pwrite usage on amd64. (closes: #261311)
+
+ -- Adam Conrad  Mon, 26 Jul 2004 06:15:59 -0600
+
+php4 (4:4.3.8-3) unstable; urgency=low
+
+ \* Steve Langasek :
+ - Give php4-pear a versioned dependency on php4-cgi, due to
+ backwards-compatibility issues (closes: #260924).
+
+ \* Adam Conrad :
+ - Added a debian/watch file for the curious, or people running
+ automated uscan scripts over the entire archive.
+ - Bump libgd2 build-dep to 2.0.28 to buy us guaranteed GIF
+ support in php4-gd (closes: #66293)
+ - Add 015-gdNewDynamicCtx\_Add\_Ex.patch, which fixes three double-free
+ errors in php4-gd. This, in concert with the librrd0 update
+ (see #261323) should clear up all known segfaults in php4-gd
+ (closes: #220196, #234571, #241270, #246833, #251220, #260790)
+ Thanks to Klaus Reimer  for the tip.
+ - Add 016-pread\_pwrite\_XOPEN\_SOURCE\_500.patch, which fixes use of
+ pread/pwrite in conjunction with LFS64. This should fix the files
+ session handler on sparc, as well as the amd64 build failure.
+ (closes: #234766, #239420, #261311, #248765)
+ - Clean up debian/rules to remove a bunch of obsolete cruft, as well
+ as introducing an LFSFLAGS, allowing us to easily turn LFS support
+ on and off for each SAPI.
+ - Re-enable LFS for apache 1.3, as it was enable in Woody and we should
+ remain backward compatible.
+
+ -- Adam Conrad  Sun, 25 Jul 2004 18:49:31 -0600
+
+php4 (4:4.3.8-2) unstable; urgency=high
+
+ \* Urgency "high" to make up for the last upload which contained
+ security fixes but was uploaded urgency "low".
+
+ \* Adam Conrad :
+ - Bump debhelper build-dep to >= 3, as we were using DH\_COMPAT=3
+ in debian/rules. Not sure how this was missed for so long.
+ - Add 014-apache2handler\_CVS\_fixes.patch, which fixes a memory
+ leak in the apache2handler SAPI, as well as a logical mishandling
+ of fatal errors during activation.
+
+ \* Steve Langasek :
+ - Revert large file support, which appears to cause
+ ABI-incompatibilities (and therefore segfaults) for apache2
+ (closes: #259659).
+
+ -- Adam Conrad  Mon, 19 Jul 2004 20:44:00 -0600
+
+php4 (4:4.3.8-1) unstable; urgency=low
+
+ \* Adam Conrad :
+ - New upstream release (4.3.8). Fixes several security issues:
+ + Fixed strip\_tags() to correctly handle '\0' characters.
+ + Improved stability during startup when memory\_limit is used.
+ + Replace alloca() with emalloc() for better stack protection.
+ + Added missing safe\_mode checks inside ftok and itpc.
+ + Fixed address allocation routine in IMAP extension.
+ + Prevent open\_basedir bypass via MySQL's LOAD DATA LOCAL.
+ + Fixes DoS in readfile() function, see CAN-2005-0596.
+ - php4-pear now includes PEAR::Mail 1.1.3 (closes: #257688)
+ - debian/control: change libpng3-dev build-dep to libpng12-dev
+ - Add Turkish debconf translation, thanks to Osman Yuksel.
+ (closes: #252940)
+
+ \* Andres Salomon :
+ - New upstream release (4.3.7). The following patches are dropped:
+ 007-dba\_fix.patch
+ 008-xbithack.patch
+ 011-curl\_api\_update.patch
+ 012-curl\_deprecated\_opts.patch.
+ - Add 013-force\_getaddrinfo.patch, so that getaddrinfo support is
+ always enabled (instead of doing check during build).
+
+ \* Steve Langasek :
+ - Enumerate supported SAPIs in both the module postinst and the module
+ config script, to avoid "question not found" errors from debconf.
+ This doesn't give us automatic support for new SAPIs as they're
+ added, but it avoids trying to configure SAPIs that we don't support
+ (e.g., caudium), and it also sidesteps shell syntax errors caused by
+ strangely-named subdirectories.
+ - Remove apache2 from the TODO list, because it's done
+ (closes: #243793).
+ - Add /var/lib/php4 to the list of directories for the apache2 module,
+ so we don't end up with a missing session dir (closes: #240962).
+ - s/modules-config/apache-modconf/, now that the canonical name of the
+ apache-common tool has changed
+ - Drop references to php3 in README.Debian, and document the
+ simplified process for enabling php4 in apache 1.3 (closes: #244564).
+ - Enable large files support for all SAPIs (closes: #249500).
+ - Fix commented-out default include path in php.ini (closes: #250274).
+
+ -- Adam Conrad  Wed, 14 Jul 2004 18:06:42 -0600
+
+php4 (4:4.3.4-4) unstable; urgency=low
+
+ \* Drop apache2 work-around patch and add build-dep on apache2 2.0.48-8,
+ now that #228840 is fixed.
+ \* Fix FTBFS problem caused by curl api changes, adding patches 011 and
+ 012 (closes: #239159).
+ \* Add phpapi Provides for libapache2-mod-php4 (closes: #240386).
+ \* Add versioned build-dep for pcre, as apache2 has proven that pcre-3.9
+ and older won't work (closes: #215069).
+ \* Tighten build-dep versions to match upstream's autoconf version checks
+ (closes: #214060).
+
+ -- Andres Salomon  Fri, 26 Mar 2004 23:27:27 -0500
+
+php4 (4:4.3.4-3) unstable; urgency=low
+
+ \* Andres Salomon :
+ - Fix incorrect php.ini path in CLI manpage (closes: #233757).
+ - Add libapache2-mod-php4 module (closes: #214611).
+ \* Updated Japanese debconf translation; thanks to Kenshi Muto
+  (closes: #222424).
+ \* Build php4-gd against libgd2-xpm, removing the need for a separate
+ php4-gd2 package (closes: #235390, #206045, #135664).
+ \* Add new Catalan debconf translation; thanks to Aleix Badia i Bosch
+  (closes: #236630).
+ \* Add new Spanish debconf translation; thanks to Carlos Valdivia
+ YagÃ¼e  (closes: #235052).
+
+ -- Steve Langasek  Sat, 28 Feb 2004 12:11:57 -0600
+
+php4 (4:4.3.4-2) unstable; urgency=low
+
+ \* Add build-depends on autoconf, missed earlier (closes: #235012).
+ \* Minor updates to README.Debian list of supported extensions.
+ \* Fix integer size mismatch in snmp extension affecting 64-bit
+ platforms
+
+ -- Steve Langasek  Thu, 26 Feb 2004 22:25:27 -0600
+
+php4 (4:4.3.4-1) unstable; urgency=low
+
+ \* New upstream version. Update local patch set accordingly, with help
+ from Andres Salomon .
+ - includes fix for snmpget() not closing its socket
+ (closes: #207363).
+ \* Update build-depends to libdb4.2-dev, to match apache-dev
+ (closes: #231692).
+ \* Drop translations of stale templates, and add new German debconf
+ translation; thanks to Alwin Meschede
+ (closes: #232270).
+ \* Add new Danish debconf translation; thanks to Claus Hindsgaul
+  (closes: #233887).
+ \* Move local patches into debian/patches/ for easier management, and
+ add debian/rules targets for build-time application of patches.
+ \* Fix a problem with PHP "xbithack" causing ini scope leakage
+ (closes: #230047).
+ \* Re-enable the openssl extension statically, since we now know for
+ sure that the php4-imap problems are a glibc bug (closes: #197450).
+ \* Fix pear to set /usr/bin/php4 instead of /usr/bin/php for the value
+ of php\_bin, so PEAR-managed scripts work correctly
+ (closes: #228381). In addition, use alternatives for /usr/bin/php
+ for the benefit of user scripts (closes: #185283).
+ \* Set the default session save\_path to /var/lib/php4 instead of to
+ /tmp, and create this directory such that all users (for php4-cgi)
+ can create files there and access their own files once created, but
+ not see the names of other files in the directory (closes: #139810).
+ \* Drop our override of upstream's register\_globals default
+ (closes: #230878).
+
+ -- Steve Langasek  Sat, 14 Feb 2004 10:23:24 -0600
+
+php4 (4:4.3.3-5) unstable; urgency=low
+
+ \* Have php4-pear Suggest: php4-dev, for PECL extensions
+ (closes: #225969).
+ \* Recompiled against the new version of libxslt, to get rid of the
+ dependency on libxsltbreakpoint (closes: #224806).
+ \* Also recompiled against the new version of libc-client (closes: #227347).
+ \* Fix pear to not expect to be able to twiddle locks when running as
+ non-root, which also seems to fix a memory utilization problem
+ (closes: #225026).
+ \* Make php4-imap depend on libapache-mod-ssl, since this seems to be
+ the only reliable way of getting apache to stop segfaulting.
+ \* Build-depend on libt1-dev, which replaces t1lib-dev.
+
+ -- Steve Langasek  Mon, 5 Jan 2004 22:53:18 -0600
+
+php4 (4:4.3.3-4) unstable; urgency=low
+
+ \* Fix prerm script to remove mod\_php4, \*not\* mod\_perl, from the
+ config (Closes: #216889).
+ \* Use /etc/$i/httpd.conf instead of /etc/$i to decide whether to
+ call modules-config.
+ \* Don't invoke debconf unless we have to in the postinst, to reduce
+ the risk of interactions between modules-config and our questions.
+ \* Add Dutch debconf translation; thanks to Tim Dijkstra
+  (closes: #221439).
+ \* Sync dba lock handling against upstream CVS HEAD, to fix a bug with
+ truncating db4 files when opening with 'c' (create).
+ (Closes: #221559).
+
+ -- Steve Langasek  Tue, 21 Oct 2003 16:49:03 -0500
+
+php4 (4:4.3.3-3) unstable; urgency=low
+
+ \* Disable -gstabs on ia64, since this debugging symbol type is
+ apparently unknown there; we should now have clean builds (with
+ appropriate debugging symbols) on all archs.
+
+ -- Steve Langasek  Mon, 20 Oct 2003 19:07:40 -0500
+
+php4 (4:4.3.3-2) unstable; urgency=low
+
+ \* Don't call db\_stop in the postinst, as this seems to cause problems
+ for modules-config (closes: #215663, #215584).
+ \* Remove duplicate -prefer-pic flag on caudium build, in hope of
+ making libtool do something sensible on ia64,hppa (closes: #216020).
+ \* Always build with debugging symbols, per current policy.
+ \* Unconditionally call dh\_strip, which knows about DEB\_BUILD\_OPTIONS;
+ and call install -s when installing shared extensions by hand.
+ \* Fix upstream build rules to not call libtool --silent.
+
+ -- Steve Langasek  Wed, 15 Oct 2003 23:19:55 -0500
+
+php4 (4:4.3.3-1) unstable; urgency=low
+
+ \* New upstream release.
+ \* Add Japanese debconf translation; thanks to Kenshi Muto
+  (closes: #211961).
+ \* Fix caudium handling to always grab the current pike version from
+ dpkg when constructing include paths (closes: #212585).
+ \* Bump the c-client build dependencies to use the new -dev package
+ name.
+ \* Convert php4 postinst/prerm scripts to use the new apache
+ modules-config interface.
+
+ -- Steve Langasek  Sun, 21 Sep 2003 17:26:31 -0500
+
+php4 (4:4.3.2+rc3-6) unstable; urgency=low
+
+ \* Add Brazilian Portuguese debconf translation; thanks to AndrÃ© LuÃ­s
+ Lopes  (closes: #207078).
+ \* Catch debian/control up with debian/rules for the zendapi -> phpapi
+ transition.
+
+ -- Steve Langasek  Sun, 31 Aug 2003 20:35:57 -0500
+
+php4 (4:4.3.2+rc3-5) unstable; urgency=low
+
+ \* Kill the lintian warning on the grammar in the copyright file.
+ \* Redirect apacheconfig I/O to /dev/tty, to work around debconf
+ behavior (for real this time). Closes: #207468, #206404.
+ \* Replace 'zendapi' with 'phpapi', since the former does not
+ accurately describe the ABI changes that affect modules and can
+ leave some packages installable but broken (closes: #208020). Also,
+ remove the versioned conflicts with php4-{mysql,pgsql}, since this
+ now supersedes.
+ \* Add French debconf translation; thanks to Michel Grentzinger
+  (closes: #207662).
+
+ -- Steve Langasek  Sat, 23 Aug 2003 21:43:24 -0500
+
+php4 (4:4.3.2+rc3-4) unstable; urgency=low
+
+ \* Have all php extensions automatically detect and configure for any
+ installed SAPIs (closes: #143436).
+ \* Remove spurious dependencies from php4-dev, and replace autoconf2.13
+ with autoconf (closes: #180497).
+ \* Conflict with old php4-pgsql as we do with php4-mysql, as it
+ manifests the same bug.
+ \* Add preliminary rules for building apache2 SAPI, but don't enable.
+ \* Call db\_stop before trying to run apacheconfig (closes: #206404).
+ \* Check for the existence of /etc/php4 before trying to rmdir it,
+ since there are apparently those who remove such directories
+ prematurely (closes: #206120).
+
+ -- Steve Langasek  Sun, 17 Aug 2003 00:19:38 -0500
+
+php4 (4:4.3.2+rc3-3) unstable; urgency=low
+
+ \* Fixes for spurious package dependencies
+ \* Fix the paths emitted by php-config, so we can build php4-pgsql et al.
+
+ -- Steve Langasek  Fri, 15 Aug 2003 23:44:55 -0500
+
+php4 (4:4.3.2+rc3-2) unstable; urgency=low
+
+ \* Make sure pear.conf is properly marked as a conffile, by bumping
+ DH\_COMPAT to 3.
+ \* Generate all per-extension postinsts/prerms at build time, instead
+ of managing them by hand.
+ \* Get rid of bogus, non-FHS directories from the caudium build.
+ \* Install the upstream php manpage in the php4-cgi package
+ (closes: #175836).
+ \* Prevent null dereferencing in ldap\_explode\_dn() (closes: #205405).
+ \* Hard-code /usr/share/pear at the end of the include path, for
+ backwards compatibility.
+ \* Debconf support for PHP extension registration, including
+ po-debconf support (closes: #122353).
+ \* Fix interpreter path in /usr/bin/pear.
+ \* Make php4-pear depends: php4-cgi (closes: #182393).
+
+ -- Steve Langasek  Wed, 13 Aug 2003 22:39:08 -0500
+
+php4 (4:4.3.2+rc3-1) unstable; urgency=low
+
+ \* New upstream version.
+ - includes fix for buffer overflow crashes in imap module
+ (closes: #191640)
+ - includes fix for dysfunctional open\_basedir directive
+ (closes: #197803)
+ - include fix for various XSS vulnerabilities (closes: #200736)
+ \* Recompile against newest libc-client libs, following another soname
+ change (closes: #199049)
+ \* Replace db2 with db4.
+ \* Trim down the cgi sapi rules, since it will now build both cli and
+ cgi for us by default.
+ \* Kludge the caudium sapi, by hard-coding the include path we need for
+ pike headers.
+ \* Copy the lex/yacc-generated .c and .h files into the build
+ directories, since generating them at build time gives wildly
+ different, and undisputably broken, results.
+ \* Update the install rules so they're compatible with current upstream
+ handling of pear and the various SAPIs.
+ \* Add '=shared' to the --enable-xslt option, to get the right results
+ for that extension.
+ \* Move PEAR extensions from /usr/share/pear to /usr/share/php.
+ \* Conflict with php4-mysql=4:4.2.3-14, due to bizarre Zend errors.
+
+ -- Steve Langasek  Wed, 6 Aug 2003 22:43:28 -0500
+
+php4 (4:4.2.3-14) unstable; urgency=low
+
+ \* Disable openssl extensions AGAIN. It appears that this double-linking mess
+ is still causing nasty segfaults.
+ (closes: #188014, #188025, #188058, #189202, #189653)
+
+ -- Adam Conrad  Sun, 20 Apr 2003 17:31:59 -0600
+
+php4 (4:4.2.3-13) unstable; urgency=low
+
+ \* Revert NET-SNMP patch and build php4-snmp against UCD-SNMP again
+ (closes: #185534)
+ \* Build against libmm13, as libmm12 no longer exists (closes: #187401)
+ \* Rebuild caudium-php4 against latest caudium-dev
+ \* Re-enable openssl linking and functions, now that our glibc 2.3
+ problems appear to be ironed out.
+ \* Enable xslt and exslt support in php4-domxml (closes: #172881)
+
+ -- Adam Conrad  Thu, 3 Apr 2003 05:53:24 -0700
+
+php4 (4:4.2.3-12) unstable; urgency=low
+
+ \* Rebuild php4-sybase against libct1 (closes: #184461)
+
+ -- Steve Langasek  Sat, 8 Mar 2003 20:03:33 -0600
+
+php4 (4:4.2.3-11) unstable; urgency=low
+
+ \* Remove pike header location detection from debian/rules and do it
+ properly in sapi/caudium/config.m4, using pike7.2-config --version
+
+ -- Adam Conrad  Mon, 3 Mar 2003 23:33:26 -0700
+
+php4 (4:4.2.3-10) unstable; urgency=low
+
+ \* Added patch to build with NET-SNMP 5.x
+ \* Updated build-dep for libc-client to 2003debian
+ (closes: #181565, #182854, #169886)
+ \* Updated build-dep for libcurl to libcurl2-dev (closes: #179722)
+ \* Added -mieee to alpha build to solve FPE errors (closes: #180656)
+ \* Removed arch-specific logic to build with gcc-3.2 on arm, since gcc-3.2
+ is now the default compiler on all architectures.
+ \* Add libwrap0-dev to the end of the build-depends to work around #183041.
+ Someone remember to remove this later when the bug is fixed. :)
+ \* Build against newer libsablot0-dev (closes: #179886, #181550)
+ \* Introduce ugly hack in debian/rules to get the pike includes
+ directory right for the caudium SAPI.
+
+ -- Adam Conrad  Sun, 2 Mar 2003 12:49:07 -0700
+
+php4 (4:4.2.3-9) unstable; urgency=low
+
+ \* Fix caudium-php4 to not conflict with php4-pear (closes: #175415).
+
+ -- Steve Langasek  Sun, 5 Jan 2003 16:40:20 -0600
+
+php4 (4:4.2.3-8) unstable; urgency=low
+
+ \* Fix typo in debian/rules
+ \* Rebuild to bring in sync with latest caudium packages
+
+ -- Adam Conrad  Wed, 25 Dec 2002 20:00:59 -0700
+
+php4 (4:4.2.3-7) unstable; urgency=low
+
+ \* Set a sane default for safe\_mode\_exec\_dir (closes: #122920).
+ \* Rebuild against libmm-dev on i386, instead of against the
+ no-longer-available libmm11-dev which Provides: the same
+ (closes: #173509).
+
+ -- Steve Langasek  Mon, 16 Dec 2002 22:48:40 -0600
+
+php4 (4:4.2.3-6) unstable; urgency=low
+
+ \* Build with PEAR for all SAPIs, so that the built-in include\_path is
+ set correctly (overkill?). Closes: #169786, #172321
+ \* Change section of php4-dev package to devel.
+ \* Add libkrb5-dev to build-depends, since libc-client2002-dev doesn't
+ pull it in (closes: #173313).
+ \* Depend on coreutils instead of fileutils, since the latter is now an
+ empty package (closes: #171265).
+
+ -- Steve Langasek  Sun, 15 Dec 2002 23:20:30 -0600
+
+php4 (4:4.2.3-5) unstable; urgency=low
+
+ \* Fix (snip, snip) the upstream build scripts, so that libphp4.so
+ isn't worthlessly linked against the problematic openssl libs
+ (closes: #165699, #165718, #165719, #166414).
+ \* Update config.{sub,guess} so that the package builds on mips
+ platforms (closes #173218)
+ \* Replace libc-client-ssl2001-dev with libc-client2002-dev in build
+ dependencies, fixing various php4-imap segfaults (closes: #169610,
+ #169769).
+
+ -- Steve Langasek  Sun, 15 Dec 2002 19:42:43 -0600
+
+php4 (4:4.2.3-4) unstable; urgency=low
+
+ \* Remove build dependency on non-extant libmagick5-dev, which is no
+ longer used anyway (closes: #169829, #172402).
+ \* Add myself to the Uploaders: field of the control file.
+
+ -- Steve Langasek  Sat, 14 Dec 2002 12:52:06 -0600
+
+php4 (4:4.2.3-3) unstable; urgency=low
+
+ \* Backport a patch from CVS to sanitize control characters in php\_url\_parse()
+ to prevent ASCII control injection in fopen() calls.
+
+ -- Adam Conrad  Thu, 12 Sep 2002 16:29:46 -0600
+
+php4 (4:4.2.3-2) unstable; urgency=low
+
+ \* I'm a moron (thanks to James Troup for pointing this out).
+ \* Change gcc-3.1 references in debian/rules to gcc-3.2.
+ \* Change GD build-dep to libgd-xpm-dev until GD package mess is worked out.
+
+ -- Adam Conrad  Tue, 10 Sep 2002 12:18:21 -0600
+
+php4 (4:4.2.3-1) unstable; urgency=low
+
+ \* New upstream version
+ \* Added a patch from Ginger Alliance to eliminate warnings in xslt compile
+ \* Messed with the php4-imap build:
+ - compiling with SSL support (closes: #122700)
+ - commented out the static-on-i386 hack, libc-client is now linked dynamically
+ \* Sessions should finally be fixed, however I won't tag the bugs "woody"
+ until I know for sure. (if you were affected, please test and send
+ followups to me)
+ \* Updated arm build-dep to use gcc-3.2 since gcc-3.1 is gone now.
+
+ -- Adam Conrad  Tue, 10 Sep 2002 09:02:51 -0600
+
+php4 (4:4.2.2-3) unstable; urgency=low
+
+ \* Fix typo resulting in php4-odbc not having a postinst
+ (closes: #157116, #157927)
+ \* Build against latest caudium-dev to made caudium-php4 installable
+ again. (closes: #158247)
+ \* Update build-deps to swap libpng3 for libpng2. (closes: #158908)
+
+ -- Adam Conrad  Sat, 7 Sep 2002 01:22:57 -0600
+
+php4 (4:4.2.2-2) unstable; urgency=low
+
+ \* Pulled --with-ndbm out of ./configure, as libc6 no longer ships with
+ headers or the library for db1 (closes: #156141, #155889)
+ \* Update build deps to build against libmm12 (closes: #155042)
+ \* php4-curl no longer depends on libcurl2-ssl (closes: #155015)
+
+ -- Adam Conrad  Sat, 10 Aug 2002 01:12:47 -0600
+
+php4 (4:4.2.2-1) unstable; urgency=medium
+
+ \* New upstream
+ \* Fixes input validation vulnerability in rfc1867.c (closes: #153850)
+ \* Added missing prerm/postinst for php4-xslt (oops)
+
+ -- Adam Conrad  Mon, 22 Jul 2002 11:58:53 -0600
+
+php4 (4:4.2.1-3) unstable; urgency=low
+
+ \* Yet more build fixes. This time, bump the arm build-dep from gcc-3.0 to
+ gcc-3.1 to avoid compiler errors. I love the arm toolchain. No, really.
+
+ -- Adam Conrad  Wed, 29 May 2002 17:40:30 -0600
+
+php4 (4:4.2.1-2) unstable; urgency=low
+
+ \* Applied small patch to fix building on non-32-bit architectures
+ (closes: #148231)
+ \* Added still /more/ documentation about the unserializer, sessions,
+ and the session.save\_handler php.ini option.
+
+ -- Adam Conrad  Sun, 26 May 2002 14:43:55 -0600
+
+php4 (4:4.2.1-1) unstable; urgency=low
+
+ \* The "When is Debian going to have new software like XF^H^HPHP 4.2?" release.
+ \* Probably the last update (barring huge packaging bugs or plain broken
+ binaries) before starting on a complete reorg of the PHP packages.
+ \* Deserializer now works on big-endian architectures (addresses bug #121391
+ and probably others)
+ \* This release probably fixes a whole bunch of bugs. Will be going through
+ the bug list and playing the reproducibility game after the upload.
+ \* Default include\_path in php.ini now set to include pear.
+ \* Upstream default for register\_globals HAS CHANGED. In the Debian php.ini
+ we are still using "register\_globals = On" for compatibility reasons,
+ however our packages will change too. This is a warning for anyone
+ packaging PHP scripts and applications to make sure you'll be compatible
+ with the new default once it's set.
+
+ -- Adam Conrad  Sun, 26 May 2002 06:24:21 -0600
+
+php4 (4:4.1.2-4) unstable; urgency=high
+
+ \* No binaries were harmed in the making up this upload.
+ \* Updated README.Debian and changelog. All other files untouched,
+ as the binaries were merely unpacked and repacked.
+ - Added a note to README.Debian about how to properly set up
+ Apache for use with php4, if the installation didn't (and it usually
+ doesn't ) get it right.
+ - Added a note to README.Debian about the unserializer (and sessions)
+ being messed up on big endian architectures. It's too late to try
+ to get a proper fix in for this, so we're just going to have to cope.
+
+ -- Adam Conrad  Fri, 26 Apr 2002 12:27:40 -0600
+
+php4 (4:4.1.2-3.1) unstable; urgency=low
+
+ \* The 'I broke it, I have to take credit for it' release.
+ \* Rebuild the package to get proper binary dependencies on alpha.
+
+ -- Steve Langasek  Sun, 31 Mar 2002 17:13:09 -0600
+
+php4 (4:4.1.2-3) unstable; urgency=low
+
+ \* Switched to --with-regex=php (from =system). This fixes all the
+ problems with eregi/parse\_url/fopen/etc on Alpha.
+ \* Cleaned up long descriptions (closes: #130977, #130954)
+
+ -- Adam Conrad  Wed, 27 Mar 2002 15:11:43 -0700
+
+php4 (4:4.1.2-2) unstable; urgency=low
+
+ \* New maintainer (closes: #132980)
+ \* Enabling unixodbc support (closes: #107201)
+ \* Changed the install-modules target in build/rules\_pear.mk so that
+ it will error out in the case of an empty modules directory or
+ failure to install modules (closes: #135304)
+
+ -- Adam Conrad  Tue, 12 Mar 2002 00:25:41 -0700
+
+php4 (4:4.1.2-1) unstable; urgency=high
+
+ \* New upstream version with a security fix. This
+ supercedes 4.1.1-2.2 from Steve Langasek:
+ \* Fix an error in the handling of MIME file upload headers, which left
+ open a potential security hole. (Closes: #136063)
+ \* Fixed gcc-3.0 fix :-)
+ \* Thanks for fixing apache-common fix
+ \* This version should fix session bugs with upstream fix (closes: #133877)
+ \* With a brutal change to main/SAPI.c try to fix(?) authorize bugs
+
+ -- Petr Cech  Thu, 28 Feb 2002 11:14:26 +0100
+
+php4 (4:4.1.1-2.1) unstable; urgency=low
+
+ \* Non-maintainer upload.
+ \* loosen apache-common dependency to make us forwards-compatible, as
+ recommended by the apache maintainer.
+ \* use gcc-3.0 when building on arm, because the default toolchain on
+ that arch has Issues (closes: #135906, #135913).
+
+ -- Steve Langasek  Tue, 26 Feb 2002 09:59:49 -0600
+
+php4 (4:4.1.1-2) unstable; urgency=medium
+
+ \* Rebuild with apache 1.3.23.
+ \* This package is in maintainer change mode. Though I orphaned it I'm not
+ going to change maintainer to QA, because we already have fresh blood.
+ \* ext/gd/gd.c: s/HAVE\_GD\_GIF/HAVE\_GD\_GIF\_CREATE/ to build correctly with
+ libgd which has GIF support (fixed included upstream)
+ \* debian/control:
+ - Build-Depends: s/libgd1g-dev/libgd-dev/
+ also libc-client at least version 4:2001adebian-6 to fix some segfaults
+ \* ext/standard/head.c: make the setcookie() thingie test more simple
+
+ -- Petr Cech  Mon, 11 Feb 2002 20:07:22 +0100
+
+php4 (4:4.1.1-1) unstable; urgency=high
+
+ \* New upstream bugfix release.
+ \* debian/control: php4-gd - Conflicts/Replaces: php4-gd2 if I ever get
+ to upload it
+ \* debian/rules: Correctly supply modified CFLAGS to build process
+
+ -- Petr Cech  Fri, 28 Dec 2001 23:23:47 +0100
+
+php4 (4:4.1.0-2) unstable; urgency=low
+
+ \* debian/php4-cgi.README.Debian: fix typo (closes: #123866)
+ \* debian/rules: remove --enable-mbstr-enc-trans as it breaks parametr
+ parsing (closes: #121403)
+ \* debian/README.Debian: document shmmax increase (closes: #119688)
+
+ -- Petr Cech  Fri, 14 Dec 2001 09:59:59 +0100
+
+php4 (4:4.1.0-1) unstable; urgency=high
+
+ \* Finally final 4.1.0
+ \* Urgency to reflect previous version
+ \* debian/control: php4-pear depends on php4-cgi
+
+ -- Petr Cech  Thu, 13 Dec 2001 23:09:54 +0100
+
+php4 (3:4.1-2) unstable; urgency=high
+
+ \* FIxes from CSV 4.1.0RC5. Looks like it was not the release after all.
+ \* ext/exif/exif.c: MFH
+ \* ext/ldap/ldap.c: small crash fix from HEAD
+ \* and misc tiny changes. Really :-)
+ \* ext/imap/php\_imap.c: HIGH. fix from CVS (imap\_rfc822\_parse\_adrlist) changing
+ the argument
+
+ -- Petr Cech  Sun, 9 Dec 2001 00:01:37 +0100
+
+php4 (3:4.1-1) unstable; urgency=medium
+
+ \* Final 4.1.0 (not released)
+ \* NEWS: s/4.0/4.1/
+ \* Build with GD1. It should fix some GD bugs, as gd 2.0.1 is supposed to be
+ a beta version with known bugs. How should I know.
+ \* sablot extension removed upstream. So use XSLT (C/R in place)
+ \* Apply fix for file\_exists() from tilo (closes: #114409)
+ \* "Cannot redeclare" were fixed in previous RCs (closes: #112341)
+ \* previous version is build in hppa and ia64, so I assume it
+ (closes: #115391)
+ \* Add note to sybase\_ct, that it conflicts with mod\_gzip folowing a user
+ report.
+ \* This should fix the "final HTML> stripped" bug that was introduced
+ in 4.0.6-3. (closes: #110415).
+ \* add --enable-ucd-snmp-hack to try to fix segfaults with ucd-snmp
+
+ -- Petr Cech  Mon, 26 Nov 2001 14:56:50 +0100
+
+php4 (3:4.0.100-1) unstable; urgency=low
+
+ \* Really a 4.1.0RC2
+ \* Remove hack for apache 1.3.14, as we build-depends on 1.3.22 anyway
+ \* Build-depends: libexpat1 (>= 1.95.2-2.1) for the .1
+ \* Added Provides: zendapi-$version to php4 and php4-cgi
+ \* Made modules depend on zendapi-$version instead of php4|php4-cgi.
+ Please use this in your php4-$module packages
+ \* Apply c-client hack only to i386 most architectures don't support linking
+ both PIC and non-PIC code. I'm still affrai to do this on i386, as it
+ crashes a lot more :(
+ \* Apply some CVS patches
+
+ -- Petr Cech  Wed, 14 Nov 2001 20:50:19 +0100
+
+php4 (3:4.0.99-4) unstable; urgency=medium
+
+ \* Recompile because of new version of caudium.
+ (I really hope this gets into testing soon as php in testing
+ now doesn't do apache 1.3.22)
+
+ -- Petr Cech  Fri, 9 Nov 2001 11:11:46 +0100
+
+php4 (3:4.0.99-3) unstable; urgency=medium
+
+ \* Recompile for new libexpat1 (closes: #116623 and others)
+ \* upstream: ext/gd/gd.c, ext/iconv/iconv.c
+ \* crypt(): defalt to using DES crypt() (closes: #117092)
+ \* debian/rules: disable libmm in -cgi build. Will lesser the impact
+ of the infamous /tmp/session\_mm.reg
+ \* apply patch to Zend, which should fix the "cannot redeclare" error.
+ It's still a bug in your code though (use include\_once). More changes
+ to this are comming (upstream).
+ \* Add some documentation to sybase
+
+ -- Petr Cech  Mon, 22 Oct 2001 11:20:46 +0200
+
+php4 (3:4.0.99-2) unstable; urgency=low
+
+ \* "Some days are just no good" release.
+ \* Recompile with apache 1.3.22 from Incoming
+ \* Deal with automake going to 1:1.4 and automake1.5
+
+ -- Petr Cech  Fri, 19 Oct 2001 15:02:00 +0200
+
+php4 (3:4.0.99-1) unstable; urgency=low
+
+ \* This is really 4.1.0RC1, but ...
+ \* Applied setcookie(), which is not in upstream yet
+
+ -- Petr Cech  Fri, 19 Oct 2001 12:05:20 +0200
+
+php4 (3:4.0.6.7rc3-3) unstable; urgency=medium
+
+ \* Fix dependency in caudium-php4. Sorry for this
+
+ -- Petr Cech  Fri, 19 Oct 2001 11:28:07 +0200
+
+php4 (3:4.0.6.7rc3-2) unstable; urgency=medium
+
+ \* Recompile with recent caudium/pike. Please, no new version so it can get
+ into testing :)
+ \* debian/control: move php4-pear to suggests
+ \* Fix setcookie() again. I really hate this bug
+ \* Build-Depends: re2c - it's usually not needed, but if you make some
+ strange changes to the parser ...
+ \* FIx automake 1.5 build problems (I hope)
+
+ -- Petr Cech  Thu, 18 Oct 2001 12:03:39 +0200
+
+php4 (3:4.0.6.7rc3-1) unstable; urgency=low
+
+ \* New upstream test release.
+
+ -- Petr Cech  Fri, 5 Oct 2001 09:23:35 +0000
+
+php4 (3:4.0.6.7rc2-3) unstable; urgency=low
+
+ \* "Let's try to fix some bugs" release.
+ \* Add some patches: ldap (does this fix things?), pgsql,
+ domxml
+ \* Build-Conflicts: automake (>= 1.5) for now
+
+ -- Petr Cech  Tue, 2 Oct 2001 10:55:23 +0200
+
+php4 (3:4.0.6.7rc2-2) unstable; urgency=low
+
+ \* Enable recode extension (the library is LGPL) - shared
+ \* Enable iconv extension - in main php4. Experimental
+ \* Build-Depends: s/libgd-dev/libgd2-dev/
+ \* Build-Depends: libxml2-dev (>= 2.4.2) (Closes: #112304)
+ and fix autoconf macros (Closes: #113980)
+ \* Improve?? description of PEAR (Closes: #112432)
+
+ -- Petr Cech  Sat, 22 Sep 2001 10:37:42 +0200
+
+php4 (3:4.0.6.7rc2-1) unstable; urgency=medium
+
+ \* 2nd release candidate
+ \* ext/mbstring: fix compile (cp1252)
+ \* ext/standard/url\_scanner\_ex: off by one
+ \* WARNING: caudium builds with Zend Threading enabled, but other
+ modules don't. So you cannot safely use DSO with caudium
+ \* Added some Build-Conflicts - with broken libmysqlclient
+ - with libtool 1.4b
+
+ -- Petr Cech  Mon, 10 Sep 2001 18:04:27 +0200
+
+php4 (3:4.0.6-6) unstable; urgency=medium
+
+ \* The "Paul Hampson fixes release".
+ \* Closed those atexit() bugs. Now to find out, how to make libtool link with
+ gcc instead of ld :((
+ \* ext/standard/head.c: Fix setcookie("bla) (closes: #109524, #109697)
+ Thanks to Paul Hampson for finding the cause, though I've used another
+ fix - fixed changes in CVS made in -3 I think. Silly me to think, that
+ all "small" changes are fixes.
+ \* libc-client2001 was fixed in -5, so add a (closes: #109202) here
+ \* Conflicts: only with libtool 1.4b-{1,2,3}. libtool 1.4.1 is OK
+
+ -- Petr Cech  Sat, 1 Sep 2001 20:59:40 +0200
+
+php4 (3:4.0.6-5) unstable; urgency=low
+
+ \* Recompile for libc-client2001 (I hope it doesn't break anything else)
+ And many other libraries.
+ \* ATTENTION. php4 still doesn't work with autoconf 2.52 and thus libtool 1.4b!!
+ You have to get libtool 1.4 to be able to use phpize.
+
+ -- Petr Cech  Wed, 22 Aug 2001 23:26:08 +0200
+
+php4 (3:4.0.6-4) unstable; urgency=high
+
+ \* Add pear/CODING\_STANDARDS into php4-pear (fixes 105574. closed too early. sorry)
+ \* Fix the nasty segfaults with mail(). That'll teach me taking upstream
+ changes without looking. Thanks Cvetan Ivanov for the correct fix (also upstream now)
+ (closes: #105686, #105878).
+
+ -- Petr Cech  Fri, 20 Jul 2001 23:07:30 +0200
+
+php4 (3:4.0.6-3) unstable; urgency=high
+
+ \* ext/standard/mail.c: security fix
+ \* debian/control: Build-Depends: libtool (>= 1.4)
+ \* ext/curl/curl.c: fix typo
+ \* ext/gd/config.m4: fix typo
+ \* ext/mcrypt/mcrypt.c: upstream buffer overflow fix
+ \* ext/mhash/mhash.c: upstream buffer overflow fix
+ \* ext/pgsql/pgsql.c: fix
+ \* ext/posix/config.m4: check for getpgid
+ \* ext/sablot/sablot.c: fix leaks
+ \* ext/standard/url\* : fixes
+ \* ext/sysvshm/sysvshm.c: fixes
+ \* Zend/\*: small fixes
+
+ -- Petr Cech  Fri, 13 Jul 2001 16:21:04 +0200
+
+php4 (3:4.0.6-2) unstable; urgency=low
+
+ \* pear/Makefile.in: add IT\_Error.php to installed files (closes: #103087)
+ \* debian/control: - allow also libcurl-ssl-dev as Build-Depends (closes: #103618)
+ - libfreetype6-dev to Build-Depends
+ - add auto\* suite to php4-dev depends (closes: #104199)
+ \* debian/rules: - build gd module with freetype2 support
+ - move common ./configure flags to COMMON\_CONFIG
+ - build with mbstring support
+
+ -- Petr Cech  Fri, 13 Jul 2001 08:22:02 +0200
+
+php4 (3:4.0.6-1) unstable; urgency=medium
+
+ \* New upstream release.
+ \* NOTE: new extension will probably be in another upload, to get this
+ into testing ...
+
+ -- Petr Cech  Mon, 25 Jun 2001 20:43:24 +0200
+
+php4 (3:4.0.5.6rc3-3) unstable; urgency=low
+
+ \* The "I hate sablot release". Recompile with 0.60
+ \* debian/php4-domxml.postrm: also fix the :: (closes: #101306)
+ \* debian/rules: --enable-ctype - still EXPERIMENTAL!!! Bug upstream
+
+ -- Petr Cech  Mon, 18 Jun 2001 09:46:17 +0200
+
+php4 (3:4.0.5.6rc3-2) unstable; urgency=low
+
+ \* ext/sablot/config.m4: link sablot.so with -lsablot, not main php4
+ \* build/ ... : upstream fix for building with automake 1.4-pX
+ \* don't fail, when libssl-dev is not installed. sigh
+
+ -- Petr Cech  Thu, 14 Jun 2001 23:36:34 +0200
+
+php4 (3:4.0.5.6rc3-1) unstable; urgency=low
+
+ \* New upstream test release.
+ \* Recompile with apache 1.3.20
+ \* debian/control:
+ - php4-dev: Depends: bison, flex (closes: #100634)
+ - Build-Depends: libcurl-dev (>=7.8)
+ \* debian/rules:
+ - add --enable-bcmath to all rules (closes: #100491)
+ \* Zend/zend.c: apply upstream fix to allow building of caudium
+
+ -- Petr Cech  Tue, 12 Jun 2001 22:27:26 +0200
+
+php4 (3:4.0.5.6rc2-1) unstable; urgency=low
+
+ \* New upstream test release.
+ \* FIx regex/regex.h (int regoff\_t)
+ \* fix php4-cgi build with pcre - don't use supplied pcre
+ \* Fix wddx support (closes: #99468)
+ \* Add missing $(INSTALL\_ROOT) to sapi/caudium/config.m4
+
+ -- Petr Cech  Fri, 8 Jun 2001 11:37:07 +0200
+
+php4 (3:4.0.5.6rc1-1) unstable; urgency=low
+
+ \* New upstream test release with new bugs :))
+ \* moved pear from /usr/lib/php4 to /usr/share/php4
+ \* Whups. Sorry about the epoch 3: . It somehow slipped in, so I'll
+ have to live with it
+
+ -- Petr Cech  Wed, 16 May 2001 14:14:04 +0200
+
+php4 (3:4.0.5-2) unstable; urgency=low
+
+ \* Build-Depend on newer libmhash-dev, as it supposedly doesn't
+ compile on current woody (closes: #96555)
+ \* Build-Depends: s/freetype2/libttf-dev/
+ \* Stop building php4-pgsql - move to non-US
+ \* Build-Deps on new libsablot0
+
+ -- Petr Cech  Thu, 10 May 2001 10:43:02 +0200
+
+php4 (3:4.0.5-1) unstable; urgency=medium
+
+ \* New upstream release.
+ \* recompile with new sablot - how I hate this (closes: #95401)
+ \* Merge XML into main php4
+ \* Reword README.Debian (closes: #89667)
+ \* Enable wddx
+ \* debian/\*.postinst: \* only ask upon first install, not upgrade (closes: #93452)
+ \* fix typos (closes: #94118)
+ \* Added support for Sybase/MS SQL Server (using FreeTDS)
+ using patch from:
+ http://rpms.arvin.dk/php/source/patches/php-sybase\_ct.patch
+ thanks to Bradley Bell  for the patch
+ \* ext/pcre : two upstream fixes
+ \* ext/sablot/sablot.c: small upstream fix
+ \* build/buildcheck.sh : fixes to allow compile with libtool 1.4
+ \* ext/standard/exec.c: upstream fixes
+ \* sapi/apache/mod\_php4.c: off by one fix
+ \* sapi/cgi/cgi\_main.c: fix POST bug
+ \* main/snprintf.c: upstream fix
+
+ -- Petr Cech  Wed, 3 May 2001 22:17:10 +0200
+
+php4 (4.0.4.5rc6-2) unstable; urgency=low
+
+ \* Build-depends: libcurl-dev will pull libcurl2 (closes: #92994)
+ \* TSRM/TSRM.c: upstream fix
+ \* ext/pgsql: upstream fix
+
+ -- Petr Cech  Thu, 5 Apr 2001 17:51:09 +0200
+
+php4 (4.0.4.5rc6-1) unstable; urgency=low
+
+ \* New upstream test release.
+ \* Don't mention CGI support, as it's not so for a long time.
+
+ -- Petr Cech  Wed, 4 Apr 2001 13:47:45 +0200
+
+php4 (4.0.4.5rc5-1) unstable; urgency=low
+
+ \* New upstream test release.
+ \* ask about /etc/php4/cgi/php.ini also
+ \* It's really recompiled for 1.3.19 (closes: #91901, #91822)
+ \* problems with modules documented (closes: #81141, #82611)
+
+ -- Petr Cech  Mon, 2 Apr 2001 09:38:16 +0200
+
+php4 (4.0.4.5rc3-1) unstable; urgency=low
+
+ \* New upstream RC release
+ \* debian/rules: s/with-yp/enable-yp/ to really enable YP support. Discovered
+ on broken potato upload. -0potato2 is fixed
+ \* Looks like there was a bug in latest build, this should fix it (closes: #92018)
+ \* remove libmcal0 workaround
+
+ -- Petr Cech  Wed, 28 Mar 2001 21:15:36 +0200
+
+php4 (4.0.4.5rc2-1) unstable; urgency=low
+
+ \* New upstream release test release 4.0.5RC2.
+ \* debian/rules: Add lintian overrides
+ \* debian/control: \* add libexpat1-dev to Build-Depends
+ \* add libmcal0 to Build-Depends since libmcal0-dev is
+ missing this dependancy :(( Bug filled
+ \* ext/socket/socket.c: minor upstream patch
+
+ -- Petr Cech  Mon, 26 Mar 2001 20:43:49 +0200
+
+php4 (4.0.4pl1-6) unstable; urgency=low
+
+ \* NEVER RELEASED
+ \* Build-depends on libcurl1-dev (>= 7.6.1-5), which fixes the libcurl1 or
+ libcurl1-ssl problem.
+ \* remove dh\_testversion and use versioned Build-depends instead
+
+ -- Petr Cech  Tue, 13 Mar 2001 23:20:58 +0100
+
+php4 (4.0.4pl1-5) unstable; urgency=low
+
+ \* Add lintian overrides
+ \* Rebuild with correct libgd-dev installed. Sorry
+ (closes: #88490, #88255, #88371, #88619, #88635)
+ \* Closed by fixed libjpeg (closes: #85865, #88141)
+
+ -- Petr Cech  Tue, 6 Mar 2001 17:26:41 +0100
+
+php4 (4.0.4pl1-4) unstable; urgency=low
+
+ \* The "Enable what you can" release.
+ \* Enable sablot extension (many files) (closes: #84073)
+ \* Enable mcal extension (finaly closes: #65688, #85925)
+ \* Build-Conflicts: bind-dev - this supposedly causes unresolved symbols.
+ Why?
+ \* ext/pgsql/pgsql.c: apply tiny patch, which should fix postgres
+ problems. There is a better patch in CVS, but it needs changes to Zend
+ \* pear/pear.in: binary is php4 no php (closes: #87848)
+ \* ext/domxml/config.m4: link with -lxml2 (closes: #87457)
+ \* debian/README.Debian: add notes about ldap, imap and mhash extensions
+ \* debian/{control,rules}: activate bz2 extension
+ \* php4.ini-dist: comment out include\_path so php will use compiled in
+ path (closes 2nd part of 87848)
+
+ -- Petr Cech  Wed, 28 Feb 2001 10:18:11 +0100
+
+php4 (4.0.4pl1-3) unstable; urgency=medium
+
+ \* Fixed postrm issues. Sorry
+
+ -- Petr Cech  Sun, 4 Feb 2001 06:13:00 +0100
+
+php4 (4.0.4pl1-2) unstable; urgency=medium
+
+ \* debian/control: Build-depends: xlibs-dev (seems it's missing and causes
+ failed builds for arm, m68k and powerpc)
+ s/libsnmp4.1/libsnmp4.2/ (closes: #84139)
+ \* debian/php4.\*: make LoadModule matching case insensitive (fixes 83641
+ for unstable)
+
+ -- Petr Cech  Wed, 31 Jan 2001 10:14:29 +0100
+
+php4 (4.0.4pl1-1) unstable; urgency=high
+
+ \* New upstream version.
+ \* This release fixes some security problems.
+ \* Some patches from previous versions are not here.
+ \* debian/control: Build-depends on newer libcurl1-dev, remove librecode-dev
+ \* debian/control: add libjpeg62-dev to build-depends from powerpc buildlog
+ (hmm. Where ir Roman?)
+ \* debian/php4{,-cgi}.postinst: don't mark php.ini as conffile and install it
+ when it doesn't already exist. I should find a way to check, that the default
+ php.ini changed and user should update it.
+ \* debian/php4{,-cgi}.postrm: cleanup the /etc/php4 dir after purge
+ \* fix xml.so not working with php4-cgi
+
+ -- Petr Cech  Thu, 23 Jan 2001 11:12:59 +0100
+
+php4 (4.0.4final-6) unstable; urgency=medium
+
+ \* OK. Now also fix the prerm issues (closes: #81418) and to ease
+ that thanks for submiting bugs (closes: #81818, #81819)
+ \* some upstream updates: browsercap, php-config
+
+ -- Petr Cech  Wed, 10 Jan 2001 14:04:19 +0100
+
+php4 (4.0.4final-5) unstable; urgency=medium
+
+ \* OK. Take a deep breath and fix those bloody postinst
+ bugs - fix it and rewrite from ed -> sed, because ed is not essential :(
+ closes: #80801.
+ \* apply some upstream fixes.
+ \* disable ctype extension - not yet ready
+
+ -- Petr Cech  Tue, 2 Jan 2001 13:40:35 +0100
+
+php4 (4.0.4final-4) unstable; urgency=low
+
+ \* debian/libc-client.la: add -lpam -ldl -lcrypt
+ \* fix php4-cgi.postinst bugs (closes: #80817, #80805, #80801)
+
+ -- Petr Cech  Fri, 29 Dec 2000 11:40:43 +0100
+
+php4 (4.0.4final-3) unstable; urgency=low
+
+ \* Brown Xmas Sock Release
+ \* Grr. correctly fix the php4 postinst error
+ (closes: #80303, #80324, #80326, #80359)
+ NMU by Wichert Akkerman (closes: #80381)
+ \* also fix php4-cgi. NMU by Marcelo E. Magallon
+ (closes: #80406).
+ \* fix fix for php4-cgi postinst s/apache/cgi/
+ \* apply some upstream fixes to ext/session/
+ \* domxml/config.m4: fix my -Lshared,/usr/lib error
+ \* debian/rules:
+ \* add --enable-ctype to both targets
+ \* --diable-pear to CGI target
+ \* generate Depends: php4 (=ver) | php4-cgi (=ver)
+
+ -- Petr Cech  Wed, 27 Dec 2000 15:29:56 +0100
+
+php4 (4.0.4final-2) unstable; urgency=low
+
+ \* Run apacheconfig with --force-modules.
+ \* Fix stupid bug in php4 and php4-cgi postinst.
+ \* ext/sysvshm/sysvshm.c : upstream fix
+
+ -- Petr Cech  Thu, 21 Dec 2000 22:58:27 +0100
+
+php4 (4.0.4final-1) unstable; urgency=low
+
+ \* New upstream version.
+ \* Sorry for the version, but da-katie doesn't allow overwriting of files, notably
+ .orig.tar.gz. It's my fault I know, but it worked till now.
+
+ -- Petr Cech  Wed, 20 Dec 2000 01:32:34 +0100
+
+php4 (4.0.4-0RC6.1) unstable; urgency=low
+
+ \* OK. Final final RC for 4.0.4.
+ \* Build-depends on libxml2-dev (>= 2.2.7) because php needs this.
+ \* Activate ndbm dba driver.
+
+ -- Petr Cech  Sun, 17 Dec 2000 19:43:51 +0100
+
+php4 (4.0.4-0RC5.1) unstable; urgency=low
+
+ \* UNRELEASED.
+ \* Final RC for 4.0.4.
+ \* Some mods to README.Debian and TODO
+
+ -- Petr Cech  Wed, 13 Dec 2000 00:01:08 +0100
+
+php4 (4.0.4-0RC4.1) unstable; urgency=low
+
+ \* New upstream beta release. Let's stabilize things now and add new
+ modules after final release of 4.0.4.
+
+ -- Petr Cech  Thu, 7 Dec 2000 10:12:11 +0100
+
+php4 (4.0.4-0RC3.2) unstable; urgency=low
+
+ \* recompile with new libc-client200-dev.
+ \* fix source recompile
+ \* depend on fixed apache 1.3.14-2
+
+ -- Petr Cech  Thu, 7 Dec 2000 00:49:14 +0100
+
+php4 (4.0.4-0RC3.1) unstable; urgency=low
+
+ \* New upstream beta release.
+ \* Add libxml2-dev to build-depends (closes: #78479).
+ \* implement DEB\_BUILD\_OPTIONS
+ \* fix apache build wrt. apxs
+ \* fix typo in description of curl modules (closes: #78828)
+
+ -- Petr Cech  Tue, 5 Dec 2000 14:22:30 +0100
+
+php4 (4.0.3pl1-7) unstable; urgency=low
+
+ \* Rebuild with apache 1.3.14-1
+
+ -- Petr Cech  Fri, 1 Dec 2000 01:41:41 +0100
+
+php4 (4.0.3pl1-6) unstable; urgency=low
+
+ \* add --enable-memory-limit
+ \* add --enable-exif per request from William Ono.
+ \* Add Suggests: phpdoc (yes. it's here).
+ \* ext/standard/crypt.c - fix from CVS.
+ \* ext/ftp/ftp.{c,h} - fix mkdir() and RETR, STOR
+ \* ext/gd/gd.c - add format string
+ - add XBM to phpinfo()
+ \* ext/imap/php\_imap.{c,h} - CVS fixes
+ \* main/main.c - fix CGI crash
+ - add HTTP\_SERVER\_VARS in CGI mode
+ \* and many more. Taken from php4.srpm (thanks :))
+ \* recompile with apache 1.3.12-2.2
+ \* and hack large files support into DSO module. php4 doesn't use it now :((
+
+ -- Petr Cech  Thu, 30 Nov 2000 00:01:39 +0100
+
+php4 (4.0.3pl1-5) unstable; urgency=low
+
+ \* Back out changes about --enable-versioning
+ \* ext/domxml/php\_domxml.c : fix compilation with recent libxml2 (>=2.2.7)
+
+ -- Petr Cech  Tue, 21 Nov 2000 18:03:56 +0100
+
+php4 (4.0.3pl1-4) unstable; urgency=low
+
+ \* Clarify README.Debian about the DB change a bit (dbm\_ -> dba\_\*)
+ \* Remove aliasing hack - deprecated upstream. (closes: #76558)
+ \* Compile with libgd-dev again (Write 100x always reinstall libgd-dev).
+ \* --enable-versioning and tweak debian/control a bit, let's see, what breaks
+
+ -- Petr Cech  Tue, 14 Nov 2000 10:00:54 +0100
+
+php4 (4.0.3pl1-3) unstable; urgency=low
+
+ \* Activate curl module.
+ \* Really enable shmop module.
+ \* Fix include paths in phpize. Now everyone should be able to easilly build
+ php4 extension modules (php4-dbase anyone?).
+
+ -- Petr Cech  Mon, 6 Nov 2000 23:17:41 +0100
+
+php4 (4.0.3pl1-2) unstable; urgency=low
+
+ \* Build with libgd-dev installed (NOT libgd-gif).
+
+ -- Petr Cech  Tue, 17 Oct 2000 02:08:36 +0200
+
+php4 (4.0.3pl1-1) unstable; urgency=medium
+
+ \* New upstream bugfix release.
+ \* Depend on libopenldap1 as with the newer ldap module crashes php&apache.
+
+ -- Petr Cech  Mon, 16 Oct 2000 15:30:55 +0200
+
+php4 (4.0.3-2) unstable; urgency=high
+
+ \* Urgency=high because last upload didn't have it ad it fixes some
+ security holes.
+ \* ext/domxml/config.m4: don't try to build then --without-domxml
+
+ -- Petr Cech  Thu, 12 Oct 2000 12:50:17 +0200
+
+php4 (4.0.3-1) unstable; urgency=low
+
+ \* New upstream release.
+ - fixes also some string format bugs
+ \* Build with fixed libmysqlclient10-dev.
+
+ -- Petr Cech  Thu, 12 Oct 2000 00:00:07 +0200
+
+php4 (4.0.2-7) unstable; urgency=low
+
+ \* Really, really install libldap2-dev.
+ \* Workaround broken libmysqlclient9-dev. It has broken (again) .so symlink.
+
+ -- Petr Cech  Tue, 10 Oct 2000 22:28:48 +0200
+
+php4 (4.0.2-6) unstable; urgency=low
+
+ \* Again fix description a little bit.
+ \* Correct build-depends.
+ \* Sic. Recompile, because I've busted (libopenldap-dev instead of
+ libldap2-dev was installed).
+ \* While at it install also new apache glibc NMU and recompile with it.
+ \* Move PEAR from php4-dev to php4 and install ALL of PEAR.
+ \* add --prefix=/usr
+ \* debhelper v2
+ \* prepare for CURL module
+ \* Updated README.Debian
+ \* updated XML module from php4 CVS to close: #72360
+
+ -- Petr Cech  Mon, 2 Oct 2000 14:36:35 +0200
+
+php4 (4.0.2-5) unstable; urgency=low
+
+ \* Correct build-depends (libgd1-dev -> libgd-dev). Where is Roman? :)
+ \* Add libdb2-dev (>= 2:2.7.7-2.1) to build-depends for glibc 2.1.94.
+ \* and recompile with glibc 2.1.94 to fix it.
+
+ -- Petr Cech  Wed, 27 Sep 2000 09:00:27 +0200
+
+php4 (4.0.2-4) unstable; urgency=low
+
+ \* Tweak description a little bit more.
+
+ -- Petr Cech  Sun, 24 Sep 2000 23:58:15 +0200
+
+php4 (4.0.2-3) unstable; urgency=low
+
+ \* Add info about what modules and why are enabled/disabled
+ into README.Debian.
+ \* Install not so many docs (only in -dev now).
+ \* Enable calendar and sockets modules.
+ \* Rearange package descriptions so module-specific comments
+ go first.
+ \* Create domxml module aka xmlv2.
+ \* Fix spelling wan't -> want (closes: #70544).
+ \* Add libraries for gd module only when linking this one
+ and not globaly (closes: #71623).
+ \* Say that we wait for ENTER (closes: #71769).
+ \* Fix logic in prerm script (closes: #71770).
+
+ -- Petr Cech  Sun, 24 Sep 2000 17:54:52 +0000
+
+php4 (4.0.2-2) unstable; urgency=low
+
+ \* Add info about what modules and why are enabled/disabled
+ into README.Debian.
+ \* Install not so many docs (only in -dev now).
+ \* Enable calendar and sockets modules.
+ \* Rearange package descriptions so module-specific comments
+ go first.
+ \* Create domxml module aka xmlv2.
+ \* Fix building (small typo).
+ \* Compile with libmysqlclient9-dev installed.
+
+ -- Petr Cech  Mon, 18 Sep 2000 23:46:40 +0200
+
+php4 (4.0.2-1) unstable; urgency=low
+
+ \* The "Back from vacation" release.
+ \* New upstream fixed (and bugs).
+ \* Correct postm script (only cosmetic) closes: #67350, #68541
+ \* build with libpcre3, libldap2
+ \* Use modified patch from -3 (remove #define XML\_... php\_XML\_...)
+
+ -- Petr Cech  Thu, 7 Sep 2000 23:17:59 +0200
+
+php4 (4.0.1pl2-3) unstable; urgency=low
+
+ \* UNRELEASED
+ \* Fixed the XML packages.
+
+ -- Norman Jordan  Thu, 10 Aug 2000 21:45:15 +0000
+
+php4 (4.0.1pl2-2) unstable; urgency=low
+
+ \* Fix source archive.
+
+ -- Petr Cech  Tue, 11 Jul 2000 11:04:48 +0000
+
+php4 (4.0.1pl2-1) unstable; urgency=low
+
+ \* New upstream bug fix release (variation of the patches in -2)
+ \* Build with new libgd1 library (maybe still in Incoming)
+ \* Move PEAR stuff to php4 package (closes: #66897).
+
+ -- Petr Cech  Sun, 9 Jul 2000 09:01:06 +0000
+
+php4 (4.0.1-2) unstable; urgency=low
+
+ \* Apply some CVS diffs in an attempt to fix opendir() problems.
+
+ -- Petr Cech  Fri, 30 Jun 2000 09:04:24 +0000
+
+php4 (4.0.1-1) unstable; urgency=low
+
+ \* New upstream release (taken from CVS tag php\_4\_0\_1).
+ \* --with-regex=system else it plays havoc. Dunno why ...
+ \* remove autoconf,automake,aclocal from configure rules.
+ \* Fix description of XML --help message (no, it's not MySQL).
+
+ -- Petr Cech  Wed, 28 Jun 2000 22:55:16 +0200
+
+php4 (4.0.0-4) unstable; urgency=low
+
+ \* Add -dev package (closes: #65907).
+ \* Add -cgi and -cgi-\* packages (closes: #51097, #52855).
+ \* --enable-filepro
+ \* Tweak copyright file a bit.
+ \* Generate mhash module (closes part of 63186).
+ \* Ask to remove libphp4 from httpd.conf upon remove/purge.
+ \* Fixed build-depends, thanks to Roman Hodek (closes: #65938).
+ (I told you the first time it won't work :))
+ \* Mark /etc/php4/cgi/php.ini as conffile.
+ \* Every module now ask if it should be enabled on install
+ (if it's not already) and disabled on remove/purge.
+
+ -- Petr Cech  Tue, 20 Jun 2000 14:29:01 +0200
+
+php4 (4.0.0-3) unstable; urgency=low
+
+ \* Ship correct php.ini (extension\_dir=/usr/lib/php4/apache).
+ \* Don't use included libmysqlclient and use system one (fixes
+ wrong location of mysqld.sock)
+ \* link XML module dynamicly with system xmlparse and xmltok.
+
+ -- Petr Cech  Wed, 14 Jun 2000 22:30:07 +0000
+
+php4 (4.0.0-2) unstable; urgency=low
+
+ \* fix the IS\_SLASH bug (closes: #65625 and probably others as well).
+ \* Really change the maintainer field.
+
+ -- Petr Cech  Wed, 14 Jun 2000 07:44:05 +0000
+
+php4 (4.0.0-1) unstable; urgency=low
+
+ \* New maintainer.
+ \* New upstream release.
+ \* Fix dynamic module loading.
+ \* Added Build-Depends (I wonder, if I got them right)
+ \* Standards-Version: 3.1.1
+
+ -- Petr Cech  Tue, 13 Jun 2000 13:40:56 +0000
+
+php4 (4.0rc1-2) unstable; urgency=low
+
+ \* Compile with latest apache and libraries from woody
+ (Closes: #62631, #62640)
+
+ -- Gergely Madarasz  Wed, 19 Apr 2000 14:39:25 +0200
+
+php4 (4.0rc1-1) unstable; urgency=low
+
+ \* New upstream version
+ \* Fix db2 support (Closes: #61709)
+ \* Fix gd support (Closes: #61708)
+ \* Remove ucd-snmp-hack from config options
+
+ -- Gergely Madarasz  Sun, 16 Apr 2000 17:04:05 +0200
+
+php4 (4.0b4pl1-2) unstable; urgency=low
+
+ \* Build with --disable-debug so it should work with the zend
+ optimizer (Closes: #60265)
+ \* Build with --enable-trans-sid (Closes: #60430)
+ \* Write some more about php4/php3 differences in the description
+ (Closes: #60155)
+
+ -- Gergely Madarasz  Fri, 17 Mar 2000 17:35:29 +0100
+
+php4 (4.0b4pl1-1) unstable; urgency=low
+
+ \* New upstream version
+ \* Upstream reorganized the build system quite a bit, lots of patches
+ removed
+
+ -- Gergely Madarasz  Wed, 23 Feb 2000 17:16:00 +0100
+
+php4 (4.0b3-4) unstable; urgency=low
+
+ \* Add /etc/php4/apache/php.ini to conffiles (Closes: #54194)
+ \* Add info file for apacheconfig
+ \* Offer to run apacheconfig and/or apache-sslconfig in postinst
+ \* Comment out sendmail\_path from php.ini so the default sendmail path
+ should work (Closes: #51355)
+
+ -- Gergely Madarasz  Thu, 6 Jan 2000 14:38:20 +0100
+
+php4 (4.0b3-3) unstable; urgency=low
+
+ \* Compile with libgd instead of libgd-gif
+
+ -- Gergely Madarasz  Tue, 4 Jan 2000 18:07:56 +0100
+
+php4 (4.0b3-2) unstable; urgency=low
+
+ \* Build imap and ldap modules
+ \* Fix rm -f in rules file (Closes: #51623)
+
+ -- Gergely Madarasz  Mon, 3 Jan 2000 16:54:19 +0100
+
+php4 (4.0b3-1) unstable; urgency=low
+
+ \* Initial Release.
+
+ -- Gergely Madarasz  Tue, 16 Nov 1999 19:33:42 +0100
--- php5-5.3.2.orig/debian/NEWS
+++ php5-5.3.2/debian/NEWS
@@ -0,0 +1,80 @@
+php5 (5.3.1-3) unstable; urgency=low
+
+ \* mod\_php disabled in userdirs.
+
+ The default Debian libapache2-mod-php5 package now disables the PHP
+ engine on ~/public\_html directories when mod\_userdir is enabled, for
+ security reasons. Although discouraged, it can be re-enabled by
+ commenting the  block in
+ /etc/apache2/mods-available/php5.conf
+
+ \* PHP 5.2 compatibility settings
+
+ Given the short time to the Squeeze release freeze, the
+ short\_open\_tag setting has been turned On again (upstream now
+ defaults to Off on the php.ini files.) However, the request\_order and
+ auto\_globals\_jit settings continue to be the default from upstream
+ ("GP" and On, respectively.)
+
+ -- Raphael Geissert  Mon, 11 Jan 2010 16:49:28 -0600
+
+php5 (5.2.11.dfsg.1-2) unstable; urgency=high
+
+ \* Maximum number of file uploads per request limited
+
+ To prevent Denial of Service attacks by exhausting the number of
+ available temporary file names, upstream introduced the max\_file\_uploads
+ option in 5.3.1 and 5.2.12.
+
+ Due to the nature of this new option a default limit has been set
+ to 50, hoping it is sensible enough to not to cause disruptions on
+ existing services.
+ The value of this new limit can be changed in the php.ini file.
+
+ If you installed the php5-suhosin extension there was a limiting
+ mechanism in place already. In this case you may want to make sure
+ the new limit imposed by PHP itself is not smaller than suhosin's.
+
+ -- Raphael Geissert  Sat, 21 Nov 2009 13:37:51 -0600
+
+php5 (5.2.6-1) unstable; urgency=medium
+
+ \* Now uses system timezone database.
+
+ Debian PHP now makes use of the system wide timezone database from the
+ tzdata package, making sure any updates there are automatically used
+ by PHP aswell. Note that this requires that the PHP process has access
+ to /etc/localtime and /usr/share/zoneinfo (this is usually the case).
+
+ \* New php5-dbg package.
+
+ We are now shipping a php5-dgb package which will greatly aid in finding
+ the cause of many crashes that you may experience. So if you are going to
+ report a bug for a reproducible crash, please install this package before
+ sending a backtrace.
+
+ \* New libapache2-mod-php5filter package.
+
+ We are now also shipping a new libapache2-mod-php5filter package which
+ uses the "Apache 2.0 filter-module support via DSO through APXS".
+
+ -- Thijs Kinkhorst  Wed, 23 Jul 2008 17:42:06 +0200
+
+php5 (5.2.3-2) unstable; urgency=low
+
+ The Suhosin patch is now enabled by default!
+
+ For more information, see
+ .
+
+ Special thanks to Blars Blarson for providing a sparc machine for testing
+ that the patch seems to work okay on that architecture. If you experience
+ otherwise let us know!
+
+ Suggestions are welcome for default configuration options, examples,
+ documentation, etc.
+
+ In any event please report successes and/or failures to us at
+ pkg-php-maint@lists.alioth.debian.org.
+
+ -- sean finney  Thu, 12 Jul 2007 23:38:43 +0200
--- php5-5.3.2.orig/debian/php5-cgi.postinst
+++ php5-5.3.2/debian/php5-cgi.postinst
@@ -0,0 +1,22 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "configure" ]; then
+ exit 0
+fi
+
+phpini="/etc/php5/cgi/php.ini"
+
+ucf /usr/share/php5/php.ini-production $phpini
+
+update-alternatives \
+ --install /usr/bin/php-cgi php-cgi /usr/bin/php5-cgi 50 \
+ --slave /usr/share/man/man1/php-cgi.1.gz php-cgi.1.gz /usr/share/man/man1/php5-cgi.1.gz
+
+update-alternatives \
+ --install /usr/lib/cgi-bin/php php-cgi-bin /usr/lib/cgi-bin/php5 50
+
+exit 0
--- php5-5.3.2.orig/debian/control
+++ php5-5.3.2/debian/control
@@ -0,0 +1,430 @@
+Source: php5
+Section: php
+Priority: optional
+Maintainer: Ubuntu Developers
+XSBC-Original-Maintainer: Debian PHP Maintainers
+Uploaders: OndÅej SurÃ½ ,
+ Sean Finney ,
+ Thijs Kinkhorst ,
+ Raphael Geissert
+Build-Depends: apache2-prefork-dev,
+ autoconf (>= 2.63),
+ automake (>= 1.11) | automake1.11,
+ bison,
+ chrpath,
+ debhelper (>= 5),
+ flex,
+ freetds-dev,
+ hardening-wrapper,
+ libapr1-dev (>= 1.2.7-8),
+ libbz2-dev,
+ libcurl4-openssl-dev,
+ libdb-dev (>= 4.7) | libdb4.8-dev | libdb4.6-dev,
+ libenchant-dev,
+ libexpat1-dev (>= 1.95.2-2.1),
+ libfreetype6-dev,
+ libgcrypt11-dev,
+ libgd2-xpm-dev,
+ libglib2.0-dev,
+ libgmp3-dev,
+ libicu-dev,
+ libjpeg-dev | libjpeg62-dev,
+ libkrb5-dev,
+ libldap2-dev,
+ libmhash-dev (>= 0.8.8),
+ libmysqlclient-dev,
+ libpam0g-dev,
+ libpcre3-dev (>= 6.6),
+ libpng12-dev,
+ libpq-dev,
+ libpspell-dev,
+ librecode-dev,
+ libsasl2-dev,
+ libsnmp-dev,
+ libsqlite0-dev,
+ libsqlite3-dev,
+ libssl-dev,
+ libt1-dev,
+ libtidy-dev,
+ libtool (>= 2.2),
+ libwrap0-dev,
+ libxmltok1-dev,
+ libxml2-dev,
+ libxslt1-dev (>= 1.0.18),
+ netbase,
+ quilt,
+ re2c,
+ unixodbc-dev,
+ zlib1g-dev,
+ libedit-dev,
+ tzdata
+Build-Conflicts: bind-dev
+Standards-Version: 3.8.2
+Vcs-Git: git://git.debian.org/pkg-php/php.git
+Vcs-Browser: http://git.debian.org/?p=pkg-php/php.git
+Homepage: http://www.php.net/
+
+Package: php5
+Architecture: all
+Depends: ${misc:Depends}, libapache2-mod-php5 (>= ${source:Version}) | libapache2-mod-php5filter (>= ${source:Version}) | php5-cgi (>= ${source:Version}), php5-common (>= ${source:Version})
+Description: server-side, HTML-embedded scripting language (metapackage)
+ This package is a metapackage that, when installed, guarantees that you
+ have at least one of the three server-side versions of the PHP5 interpreter
+ installed. Removing this package won't remove PHP5 from your system, however
+ it may remove other packages that depend on this one.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-common
+Architecture: any
+Depends: ${misc:Depends}, sed (>= 4.1.1-1), ${shlibs:Depends}
+Suggests: php5-suhosin
+Provides: php5-json, php5-mhash
+Conflicts: php5-json, php5-mhash
+Description: Common files for packages built from the php5 source
+ This package contains the documentation and example files relevant to all
+ the other packages built from the php5 source.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: libapache2-mod-php5
+Section: httpd
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, mime-support, ${apache2:Depends}, php5-common (= ${binary:Version}), libmagic1, ucf, tzdata
+Conflicts: libapache2-mod-php4, libapache2-mod-php5filter
+Provides: ${php:Provides}
+Suggests: php-pear
+Description: server-side, HTML-embedded scripting language (Apache 2 module)
+ This package provides the PHP5 module for the Apache 2 webserver (as
+ found in the apache2-mpm-prefork package). Please note that this package
+ ONLY works with Apache's prefork MPM, as it is not compiled thread-safe.
+ .
+ ${php:Extensions}
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: libapache2-mod-php5filter
+Section: httpd
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, mime-support, ${apache2:Depends}, php5-common (= ${binary:Version}), libmagic1, ucf, tzdata
+Conflicts: libapache2-mod-php4, libapache2-mod-php5
+Provides: ${php:Provides}
+Suggests: php-pear
+Description: server-side, HTML-embedded scripting language (apache 2 filter module)
+ This package provides the PHP5 Filter module for the Apache 2 webserver (as
+ found in the apache2-mpm-prefork package). Please note that this package
+ ONLY works with Apache's prefork MPM, as it is not compiled thread-safe.
+ .
+ Unless you specifically need filter-module support, you most likely
+ should instead install libapache2-mod-php5.
+ .
+ ${php:Extensions}
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-cgi
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, mime-support, php5-common (= ${binary:Version}), libmagic1, ucf, tzdata
+Provides: ${php:Provides}
+Suggests: php-pear
+Description: server-side, HTML-embedded scripting language (CGI binary)
+ This package provides the /usr/lib/cgi-bin/php5 CGI interpreter built
+ for use in Apache 2 with mod\_actions, or any other CGI httpd that
+ supports a similar mechanism. Note that MOST Apache users probably
+ want the libapache2-mod-php5 package.
+ .
+ ${php:Extensions}
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-cli
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, mime-support, php5-common (= ${binary:Version}), libmagic1, ucf, tzdata
+Provides: ${php:Provides}
+Suggests: php-pear
+Description: command-line interpreter for the php5 scripting language
+ This package provides the /usr/bin/php5 command interpreter, useful for
+ testing PHP scripts from a shell or performing general shell scripting tasks.
+ .
+ ${php:Extensions}
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-dev
+Depends: ${misc:Depends}, autoconf (>= 2.63), automake (>= 1.11), libssl-dev, libtool (>= 2.2), shtool, php5-common (>= ${binary:Version})
+Conflicts: ${libtool:Conflicts}
+Architecture: any
+Description: Files for PHP5 module development
+ This package provides the files from the PHP5 source needed for compiling
+ additional modules.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-dbg
+Depends: ${misc:Depends}, php5-common (= ${binary:Version}), libapache2-mod-php5 (= ${binary:Version}) | libapache2-mod-php5filter (= ${binary:Version}) | php5-cgi (= ${binary:Version}) | php5-cli (= ${binary:Version}) | php5-curl (= ${binary:Version}) | php5-enchant (= ${binary:Version}) | php5-gd (= ${binary:Version}) | php5-gmp (= ${binary:Version}) | php5-intl (= ${binary:Version}) | php5-ldap (= ${binary:Version}) | php5-mcrypt (= ${binary:Version}) | php5-mysql (= ${binary:Version}) | php5-odbc (= ${binary:Version}) | php5-pgsql (= ${binary:Version}) | php5-pspell (= ${binary:Version}) | php5-recode (= ${binary:Version}) | php5-snmp (= ${binary:Version}) | php5-sqlite (= ${binary:Version}) | php5-sybase (= ${binary:Version}) | php5-tidy (= ${binary:Version}) | php5-xmlrpc (= ${binary:Version}) | php5-xsl (= ${binary:Version})
+Recommends: gdb
+Section: debug
+Priority: extra
+Architecture: any
+Description: Debug symbols for PHP5
+ This package provides the debug symbols for PHP5 needed for properly
+ debugging errors in PHP5 with gdb.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php-pear
+Architecture: all
+Depends: ${misc:Depends}, php5-common (>= ${source:Version}), php5-cli
+Recommends: gnupg
+Conflicts: php-xml-util
+Suggests: php5-dev
+Replaces: php4-pear (<< 4:4.4.0-0), php-xml-util
+Provides: php-xml-util
+Description: PEAR - PHP Extension and Application Repository
+ This package contains the base PEAR classes for PHP, as well as the PEAR
+ installer. Many PEAR classes are already packaged for Debian, and can be
+ easily identified by names beginning with "php-", such as php-db and
+ php-auth. Note: to build and install precompiled PECL extensions, you
+ will need one of the php development packages installed.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-curl
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: CURL module for php5
+ CURL is a library for getting files from FTP, GOPHER, HTTP server.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-enchant
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: Enchant module for php5
+ This package provides a module for the generic spell checking library
+ Enchant, which can use engines such as ispell, aspell and myspells.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-gd
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: GD module for php5
+ This package provides a module for handling graphics directly from PHP
+ scripts. It supports the PNG, JPEG, XPM formats as well as Freetype/ttf fonts.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-gmp
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: GMP module for php5
+ This package provides a module for arbitrary precision arithmetic via the
+ GNU Multiple Precision (GMP) Arithmetic Library.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-intl
+Architecture: any
+Depends: ${shlibs:Depends}, ${php:Depends}, ${misc:Depends}, php5-common (= ${binary:Version})
+Description: internationalisation module for php5
+ This package provides a module to ease internationalisation of PHP scripts.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-ldap
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Replaces: libapache2-mod-php5 (<< 5.3.1-1~)
+Conflicts: libapache2-mod-php5 (<< 5.3.1-1~)
+Description: LDAP module for php5
+ This package provides a module for LDAP functions in PHP scripts.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-mysql
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Conflicts: php5-mysqli
+Replaces: php5-mysqli
+Description: MySQL module for php5
+ This package provides modules for MySQL database connections directly from
+ PHP scripts. It includes the generic "mysql" module which can be used
+ to connect to all versions of MySQL, an improved "mysqli" module for
+ MySQL version 4.1 or later, and the pdo\_mysql module for use with
+ the PHP Data Object extension.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-odbc
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: ODBC module for php5
+ This package provides a module for database access through ODBC drivers.
+ It uses the unixODBC library as an ODBC provider. It also contains the
+ pdo\_odbc module, for use with the PHP Data Object extension.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-pgsql
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: PostgreSQL module for php5
+ This package provides a module for PostgreSQL database connections
+ directly from PHP scripts. It also includes the pdo\_pgsql module for
+ use with the PHP Data Object extension.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-pspell
+Architecture: any
+Depends: ${shlibs:Depends}, ${php:Depends}, ${misc:Depends}, php5-common (= ${binary:Version})
+Description: pspell module for php5
+ This package provides a module for pspell functions in PHP scripts.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-recode
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: recode module for php5
+ This package provides a module for recode - character set recoding.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-snmp
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: SNMP module for php5
+ This package provides a module for SNMP functions in PHP scripts.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-sqlite
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: SQLite module for php5
+ This package provides a module allowing you to use the SQLite self-contained
+ database engine from within your PHP scripts, eliminating the need for a full
+ SQL server installation like MySQL or PostgreSQL. It also includes the
+ pdo\_sqlite module, for use with the PHP Data Object extension.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-sybase
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Provides: php5-mssql
+Description: Sybase / MS SQL Server module for php5
+ This package provides a module for Sybase and Microsoft SQL Server
+ database connections directly from PHP scripts. It also includes the
+ pdo\_dblib module for use with the PHP Data Object extension.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-tidy
+Architecture: any
+Depends: ${shlibs:Depends}, ${php:Depends}, ${misc:Depends}, php5-common (= ${binary:Version})
+Description: tidy module for php5
+ This package provides a module for tidy functions in PHP scripts.
+ .
+ Tidy is an extension based on Libtidy (http://tidy.sf.net/) and allows
+ a PHP developer to clean, repair, and traverse HTML, XHTML, and XML
+ documents -- including ones with embedded scripting languages such as PHP
+ or ASP within them using OO constructs.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-xmlrpc
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: XML-RPC module for php5
+ This package provides a module for XML-RPC functions in PHP scripts.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
+
+Package: php5-xsl
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, ${php:Depends}, php5-common (= ${binary:Version})
+Description: XSL module for php5
+ This package provides a module for XSL using the libxslt XSL parser.
+ .
+ PHP5 is an HTML-embedded scripting language. Much of its syntax is borrowed
+ from C, Java and Perl with a couple of unique PHP-specific features thrown
+ in. The goal of the language is to allow web developers to write dynamically
+ generated pages quickly. This version of PHP5 was built with the Suhosin patch.
--- php5-5.3.2.orig/debian/libapache2-mod-php5filter.conf
+++ php5-5.3.2/debian/libapache2-mod-php5filter.conf
@@ -0,0 +1,6 @@
+
+
+ SetInputFilter PHP
+ SetOutputFilter PHP
+
+
--- php5-5.3.2.orig/debian/php5-module.postinst
+++ php5-5.3.2/debian/php5-module.postinst
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+#DEBHELPER#
--- php5-5.3.2.orig/debian/libapache2-mod-php5.prerm
+++ php5-5.3.2/debian/libapache2-mod-php5.prerm
@@ -0,0 +1,20 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "remove" -a "$1" != "purge" ]; then
+ exit 0
+fi
+
+if [ -e /etc/apache2/apache2.conf ]; then
+ if [ -e /etc/apache2/mods-enabled/php5.load ] && [ "$1" != "purge" ]; then
+ # set a flag to remember the original state
+ # useful when reinstalling the same version.
+ touch /etc/php5/apache2/.start
+ fi
+ a2dismod php5 || true
+fi
+
+exit 0
--- php5-5.3.2.orig/debian/php5-common.php5.cron.d
+++ php5-5.3.2/debian/php5-common.php5.cron.d
@@ -0,0 +1,7 @@
+# /etc/cron.d/php5: crontab fragment for php5
+# This purges session files older than X, where X is defined in seconds
+# as the largest value of session.gc\_maxlifetime from all your php.ini
+# files, or 24 minutes if not defined. See /usr/lib/php5/maxlifetime
+
+# Look for and purge old sessions every 30 minutes
+09,39 \* \* \* \* root [ -x /usr/lib/php5/maxlifetime ] && [ -d /var/lib/php5 ] && find /var/lib/php5/ -depth -mindepth 1 -maxdepth 1 -type f -cmin +$(/usr/lib/php5/maxlifetime) -delete
--- php5-5.3.2.orig/debian/php5-dev.lintian-overrides
+++ php5-5.3.2/debian/php5-dev.lintian-overrides
@@ -0,0 +1 @@
+php5-dev: script-not-executable ./usr/lib/php5/build/run-tests.php
--- php5-5.3.2.orig/debian/modulelist
+++ php5-5.3.2/debian/modulelist
@@ -0,0 +1,17 @@
+curl CURL
+enchant Enchant
+gd GD
+gmp GMP
+intl Internationalisation
+ldap LDAP
+mysql MySQL
+odbc ODBC
+pgsql PostgreSQL
+pspell pspell
+recode recode
+snmp SNMP
+sqlite SQLite
+sybase Sybase mssql
+tidy tidy
+xmlrpc XML-RPC
+xsl XSL
--- php5-5.3.2.orig/debian/php5-dev.postinst
+++ php5-5.3.2/debian/php5-dev.postinst
@@ -0,0 +1,17 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "configure" ]; then
+ exit 0
+fi
+
+for i in php-config phpize; do
+ update-alternatives \
+ --install /usr/bin/"$i" $i /usr/bin/"$i"5 50 \
+ --slave /usr/share/man/man1/"$i".1.gz "$i".1.gz /usr/share/man/man1/"$i"5.1.gz
+done
+
+exit 0
--- php5-5.3.2.orig/debian/libapache2-mod-php5filter.dirs
+++ php5-5.3.2/debian/libapache2-mod-php5filter.dirs
@@ -0,0 +1,3 @@
+/etc/apache2/mods-available
+/etc/php5/apache2filter
+/usr/lib/apache2/modules
--- php5-5.3.2.orig/debian/libapache2-mod-php5.conf
+++ php5-5.3.2/debian/libapache2-mod-php5.conf
@@ -0,0 +1,16 @@
+
+
+ SetHandler application/x-httpd-php
+
+
+ SetHandler application/x-httpd-php-source
+
+ # To re-enable php in user directories comment the following lines
+ # (from  to .) Do NOT set it to On as it
+ # prevents .htaccess files from disabling it.
+
+
+ php\_admin\_value engine Off
+
+
+
--- php5-5.3.2.orig/debian/php5-cgi.prerm
+++ php5-5.3.2/debian/php5-cgi.prerm
@@ -0,0 +1,14 @@
+#!/bin/sh
+
+set -e
+
+#DEBHELPER#
+
+if [ "$1" != "remove" -a "$1" != "purge" ]; then
+ exit 0
+fi
+
+update-alternatives --remove php-cgi /usr/bin/php5-cgi
+update-alternatives --remove php-cgi-bin /usr/lib/cgi-bin/php5
+
+exit 0
--- php5-5.3.2.orig/debian/php5-common.README.Debian
+++ php5-5.3.2/debian/php5-common.README.Debian
@@ -0,0 +1,148 @@
+Table of Contents:
+---------------------------------------------------------------------
+\* Using php5 with threaded webservers (eg. apache2-mpm-worker, caudium)
+\* Problems starting apache2 with php5
+\* Session storage
+\* Other caveats
+\* php5-cgi and apache2
+\* Restarting your web server after installing modules
+\* Configuration layout
+\* Timezone data from system timezone database
+\* Further documentation, errata, etc
+
+
+Using php5 with threaded webservers (eg. apache2-mpm-worker, caudium)
+---------------------------------------------------------------------
+
+ After much back-and-forth with upstream (and even building our
+ packages thread-safe for a while), we're currently admitting defeat
+ on that front, and are NOT building any thread-safe versions of
+ PHP for any webservers. Our recommendation is that, if you need
+ to use a threaded webserver, you should use php5-cgi in either
+ 'normal' CGI mode, or in FastCGI mode.
+
+Adam Conrad  Sun, 06 Feb 2005 08:24:56 -0700
+
+
+Problems starting apache2 with php5
+----------------------------------
+
+ At the time of writing, there are no \*known\* incompatibilities
+ between any of the php5 modules we ship. However, there have been
+ many bug reports in the past due to dynamically-loaded extensions,
+ and it's possible there are still bugs in the released packages. If
+ Apache fails to start after you install php5, check your list of
+ enabled extensions at the bottom of /etc/php5/apache2/php.ini (and in
+ the per-sapi configuration directory), and try commenting out or
+ reordering the extensions until you find a combination that works.
+
+ For example, in the past the mhash extension was incompatible with
+ some other common extensions. To work around this, you could list
+ the mhash extension first in php.ini.
+
+ If you find an extension-related bug in the Debian packages, and you
+ are willing to help debug the problem, please send us a bug report
+ that lists all enabled PHP5 extensions (extension=), in the order
+ in which they appear in php.ini, as well as all enabled Apache modules
+ (LoadModule), with version numbers where possible.
+
+Steve Langasek  Fri, 26 Apr 2002 13:39:00 -0500
+
+
+Session storage
+---------------
+
+ Session files are stored in /var/lib/php5. For security purposes, this
+ directory is unreadable by non-root users. This means that php5 running
+ from apache2, for example, will not be able to clean up stale session
+ files. Instead, we have a cron job run every 30 mins that cleans up
+ stale session files; /etc/cron.d/php5. You may need to modify how
+ often this runs, if you've modified session.gc\_maxlifetime in your
+ php.ini; otherwise, it may be too lax or overly aggressive in cleaning
+ out stale session files.
+
+Andres Salomon  Fri, 03 Sep 2004 03:12:54 -0400
+
+
+Other caveats
+-------------
+
+ \* extension\_dir and include\_path should be commented out, if you don't need
+ special settings for them so php will look in compiled-in paths. If you set
+ them, you should also add appropriate php install directories there.
+
+php5-cgi and apache2
+---------------------------
+
+In 99% of cases, what you probably want isn't php5-cgi at all, but rather
+the libapache2-mod-php5 package, which will configure itself on
+installation and Just Work(tm). If, however, you have a need to use
+the CGI version of php5 with apache2, the following should help
+get you going, though there are dozens of different ways to do this.
+
+Please note that this process will never be made automatic, as php5-cgi
+is meant to be a webserver-agnostic package that can be used with any
+httpd, and we don't want it to conflict with the httpd-specific packages
+such as libapache2-mod-php5. If both were installed side-by-side and both
+were automatically enabled, the results would be a bit confusing, obviously.
+
+To use php5-cgi with apache2
+ 1) activate CGI (it's on by default in default debian setups)
+ a) If using the prefork MPM, use 'a2enmod cgi'
+ b) If using a threaded MPM, use 'a2enmod cgid'
+ 2) activate mod\_actions (a2enmod actions)
+ 3) Add the following to a config snippet in /etc/apache2/conf.d
+
+ Action application/x-httpd-php /cgi-bin/php5
+
+
+Adam Conrad  Sat, 04 Sep 2004 23:04:26 -0600
+
+Configuration Layout
+---------------------------------------------------------------------
+
+Each of the 3 SAPI's (apache2/cgi/cli) have a different
+central configuration file /etc/php5/$SAPI/php.ini.
+
+Additionally, each SAPI is configured with the compile-time option
+
+ --with-config-file-scan-dir=/etc/php5/$SAPI/conf.d
+
+which for all SAPI's is actually a symlink pointing to a central
+directory /etc/php5/conf.d. Any file found in this directory ending
+in .ini will be treated as a configuration file by the php SAPI.
+
+The rationale with this method is that each SAPI can thus be
+identically configured with a minimal amount of conffile handling,
+but at the same time if you want to have SAPI-specific configuration,
+you can just remove the symlink.
+
+sean finney  Thu, 19 Oct 2006 23:33:05 +0200
+
+Timezone data from system timezone database
+---------------------------------------------------------------------
+
+Debian PHP has been patched to use of the system wide timezone database
+from the tzdata package, making sure any updates there are automatically
+used by PHP aswell.
+
+Note that this requires that the PHP process has access to /etc/localtime
+and /usr/share/zoneinfo. For any regular installation this should be the
+case, but in specific secured environments when reading the timezone
+database is impossible PHP will give a "Timezone database is corrupt -
+this should \*never\* happen!" error.
+
+Thijs Kinkhorst  Wed, 23 Jul 2008 17:42:06 +0200
+
+Further documentation, errata, etc
+---------------------------------------------------------------------
+
+Errata and other general information about PHP in Debian can be found
+in the debian wiki at:
+
+ http://wiki.debian.org/PHP
+
+If after reading the documentation in this file you still have unanswered
+questions, that's a good next place to go.
+
+sean finney  Thu, 19 Oct 2006 22:57:52 +0200
--- php5-5.3.2.orig/debian/watch
+++ php5-5.3.2/debian/watch
@@ -0,0 +1,5 @@
+version=3
+opts=downloadurlmangle=s#/a/#/this/#,\
+filenamemangle=s#/get/(php-(5\.[0-9\.]\*)\.tar\.gz)/.\*#$1#,\
+dversionmangle=s/\.dfsg\.\d+// \
+http://www.php.net/downloads.php /get/php-(5\.[0-9\.]\*)\.tar\.gz/from/a/mirror debian
--- php5-5.3.2.orig/debian/compat
+++ php5-5.3.2/debian/compat
@@ -0,0 +1 @@
+5
--- php5-5.3.2.orig/debian/suhosin\_patch.watch
+++ php5-5.3.2/debian/suhosin\_patch.watch
@@ -0,0 +1,8 @@
+# Check for new versions with:
+# uscan --watchfile debian/suhosin\_patch.watch --package suhosin-patch
+# don't forget to update the version in this file when updating the patch!
+version=3
+
+opts=uversionmangle=s/RC/~RC/ \
+http://www.hardened-php.net/suhosin/download.html \
+ http://download.suhosin.org/suhosin-patch-(.\*)\.patch\.gz 5.3.1-0.9.8
--- php5-5.3.2.orig/debian/php5-common.TODO
+++ php5-5.3.2/debian/php5-common.TODO
@@ -0,0 +1,7 @@
+- Debconf: support removing of extension lines from php.ini on
+ dpkg-reconfigure, not just adding. Adjust wording of debconf template
+ to match.
+- move default config files out of /usr/share/doc/php5/examples, per
+ policy
+- more modules
+- roxen support (oh my)
--- php5-5.3.2.orig/debian/php5-sapi.postrm
+++ php5-5.3.2/debian/php5-sapi.postrm
@@ -0,0 +1,18 @@
+#! /bin/sh
+
+set -e
+
+phpini=/etc/php5/@sapi@/php.ini
+
+case "$1" in
+purge)
+ if which ucf >/dev/null 2>&1; then
+ ucf --purge $phpini
+ fi
+ rm -f $phpini
+ ;;
+esac
+
+#DEBHELPER#
+
+exit 0
--- php5-5.3.2.orig/debian/copyright.header
+++ php5-5.3.2/debian/copyright.header
@@ -0,0 +1,42 @@
+This package was debianized by Gergely Madarasz  on
+Tue, 16 Nov 1999 19:33:42 +0100.
+
+Previous maintainers of the package also include:
+ Petr Cech , who did a LOT of work on these packages.
+ Adam Conrad , who got a significant chunk of input and
+ help from Steve Langasek  and
+ Andres Salomon .
+
+The current maintainers can be contacted via the debian php packaging list:
+ pkg-php-maint@lists.alioth.debian.org
+
+It was downloaded from www.php.net/version5/downloads
+Changes: removed ext/dbase dir (non-free)
+
+Noteworthy/non-trivial patches:
+ patch: suhosin.patch
+ contributor: http://www.hardened-php.net/
+ copyright Â© 2006-2007 Stefan Esser
+ may be used/modified/redistributed under the terms of PHP itself
+
+ patch: use\_embedded\_timezonedb.patch
+ contributor: Joe Orton
+ copyright Â© 2008 Red Hat, Inc.
+ may be used/modified/redistributed under the terms of PHP itself
+
+Upstream Authors: The PHP group for PHP5, Andi Gutmans and Zeev Suraski
+for libzend
+
+The file ext/standard/rand.c contains the following clause with a statement
+that isn't compatible with the DFSG:
+ "The code as Shawn received it included the following notice:
+
+ Copyright (C) 1997 Makoto Matsumoto and Takuji Nishimura. When
+ you use this, send an e-mail to  with
+ an appropriate reference to your work."
+However, this requirement has been rescinded by the copyright holder in
+message <48E334A2.6050301@math.sci.hiroshima-u.ac.jp> to bug #498621.
+
+Two different licences apply to this package, one for PHP5, the other for
+libzend. Both licences are shown here below.
+
--- php5-5.3.2.orig/debian/php5-common.postrm
+++ php5-5.3.2/debian/php5-common.postrm
@@ -0,0 +1,12 @@
+#! /bin/bash
+
+set -e
+
+if [ "$1" = "purge" ]
+then
+ rm -rf /var/lib/php5
+fi
+
+#DEBHELPER#
+
+exit 0
--- php5-5.3.2.orig/debian/patches/fix\_broken\_locale\_tests.patch
+++ php5-5.3.2/debian/patches/fix\_broken\_locale\_tests.patch
@@ -0,0 +1,29 @@
+Description: Backport upstream fix for tests with incorrect locale name
+Origin: upstream
+
+Index: php/ext/standard/tests/strings/strtolower.phpt
+===================================================================
+--- php.orig/ext/standard/tests/strings/strtolower.phpt
++++ php/ext/standard/tests/strings/strtolower.phpt
+@@ -22,7 +22,7 @@ if( substr(PHP\_OS, 0, 3) == 'WIN') {
+ if( substr(PHP\_OS, 0, 3) == 'WIN') {
+ setlocale(LC\_ALL, 'C');
+ } else {
+- setlocale(LC\_ALL, 'en-US.UTF-8');
++ setlocale(LC\_ALL, 'en\_US.UTF-8');
+ }
+
+ echo "\*\*\* Testing strtolower() with all 256 chars \*\*\*\n";
+Index: php/ext/standard/tests/strings/strtoupper1.phpt
+===================================================================
+--- php.orig/ext/standard/tests/strings/strtoupper1.phpt
++++ php/ext/standard/tests/strings/strtoupper1.phpt
+@@ -22,7 +22,7 @@ if( substr(PHP\_OS, 0, 3) == 'WIN') {
+ if( substr(PHP\_OS, 0, 3) == 'WIN') {
+ setlocale(LC\_ALL, 'C');
+ } else {
+- setlocale(LC\_ALL, 'en-US.UTF-8');
++ setlocale(LC\_ALL, 'en\_US.UTF-8');
+ }
+
+ echo "\*\*\* Testing strtoupper() with all 256 chars \*\*\*\n";
--- php5-5.3.2.orig/debian/patches/fix\_broken\_gd\_bundled-specific\_tests.patch
+++ php5-5.3.2/debian/patches/fix\_broken\_gd\_bundled-specific\_tests.patch
@@ -0,0 +1,92 @@
+Description: Backport upstream fix for tests that require the bundled
+ gd library but are not skipped in case the external library is used.
+Origin: upstream
+
+Index: php/ext/gd/tests/bug42434.phpt
+===================================================================
+--- php.orig/ext/gd/tests/bug42434.phpt
++++ php/ext/gd/tests/bug42434.phpt
+@@ -5,6 +5,7 @@ Bug #42434 (ImageLine w/ antialias = 1px
+ if (!extension\_loaded('gd')) {
+ die('skip gd extension not available');
+ }
++if (!GD\_BUNDLED) die("skip requires bundled GD library\n");
+ ?>
+ --FILE--
+ php
+Index: php/ext/gd/tests/imageantialias\_error1.phpt
+===================================================================
+--- php.orig/ext/gd/tests/imageantialias\_error1.phpt
++++ php/ext/gd/tests/imageantialias\_error1.phpt
+@@ -6,6 +6,7 @@ Guilherme Blanco <guilhermeblanco [at] h
+ --SKIPIF--
+ <?php
+ if (!extension\_loaded("gd")) die("skip GD not present");
++if (!GD\_BUNDLED) die("skip requires bundled GD library\n");
+ ?
+ --FILE--
+ php
+Index: php/ext/gd/tests/imageantialias\_error2.phpt
+===================================================================
+--- php.orig/ext/gd/tests/imageantialias\_error2.phpt
++++ php/ext/gd/tests/imageantialias\_error2.phpt
+@@ -6,6 +6,7 @@ Guilherme Blanco <guilhermeblanco [at] h
+ --SKIPIF--
+ <?php
+ if (!extension\_loaded("gd")) die("skip GD not present");
++if (!GD\_BUNDLED) die("skip requires bundled GD library\n");
+ ?
+ --FILE--
+ php
+Index: php/ext/gd/tests/imagelayereffect\_basic.phpt
+===================================================================
+--- php.orig/ext/gd/tests/imagelayereffect\_basic.phpt
++++ php/ext/gd/tests/imagelayereffect\_basic.phpt
+@@ -6,7 +6,7 @@ Rafael Dohms <rdohms [at] gmail [dot] co
+ --SKIPIF--
+ <?php
+ if (!extension\_loaded("gd")) die("skip GD not present");
+- if (!GD\_BUNDLED) die('function only available in bundled, external GD detected');
++ if (!GD\_BUNDLED) die('skip function only available in bundled, external GD detected');
+ ?
+ --FILE--
+ php
+Index: php/ext/gd/tests/imagelayereffect\_error1.phpt
+===================================================================
+--- php.orig/ext/gd/tests/imagelayereffect\_error1.phpt
++++ php/ext/gd/tests/imagelayereffect\_error1.phpt
+@@ -6,7 +6,7 @@ Rafael Dohms <rdohms [at] gmail [dot] co
+ --SKIPIF--
+ <?php
+ if (!extension\_loaded("gd")) die("skip GD not present");
+- if (!GD\_BUNDLED) die('function only available in bundled, external GD detected');
++ if (!GD\_BUNDLED) die('skip function only available in bundled, external GD detected');
+ ?
+ --FILE--
+ php
+Index: php/ext/gd/tests/imagelayereffect\_error2.phpt
+===================================================================
+--- php.orig/ext/gd/tests/imagelayereffect\_error2.phpt
++++ php/ext/gd/tests/imagelayereffect\_error2.phpt
+@@ -6,7 +6,7 @@ Rafael Dohms <rdohms [at] gmail [dot] co
+ --SKIPIF--
+ <?php
+ if (!extension\_loaded("gd")) die("skip GD not present");
+- if (!GD\_BUNDLED) die('function only available in bundled, external GD detected');
++ if (!GD\_BUNDLED) die('skip function only available in bundled, external GD detected');
+ ?
+ --FILE--
+ php
+Index: php/ext/gd/tests/imagelayereffect\_error3.phpt
+===================================================================
+--- php.orig/ext/gd/tests/imagelayereffect\_error3.phpt
++++ php/ext/gd/tests/imagelayereffect\_error3.phpt
+@@ -6,7 +6,7 @@ Rafael Dohms <rdohms [at] gmail [dot] co
+ --SKIPIF--
+ <?php
+ if (!extension\_loaded("gd")) die("skip GD not present");
+- if (!GD\_BUNDLED) die('function only available in bundled, external GD detected');
++ if (!GD\_BUNDLED) die('skip function only available in bundled, external GD detected');
+ ?
+ --FILE--
+ php
--- php5-5.3.2.orig/debian/patches/033-we\_WANT\_libtool.patch
+++ php5-5.3.2/debian/patches/033-we\_WANT\_libtool.patch
@@ -0,0 +1,25 @@
+Description:
+ upstream ships an out of date version of libtool. this ensures that
+ we build against an up-to-date version of libtool by running libtoolize
+ as part of our build process (this is called indirectly via ./buildconf.sh
+ from debian/rules)
+ .
+ note that we don't touch the libtool.m4 that they ship here, and this file
+ gets included in the build process as part of the phpize stuff. however,
+ this is solved in ./debian/rules where it's overwritten with a symlink.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/build/build2.mk
++++ pkg-php/build/build2.mk
+@@ -52,7 +52,8 @@ $(TOUCH\_FILES):
+
+ aclocal.m4: configure.in acinclude.m4
+ @echo rebuilding $@
+- cat acinclude.m4 ./build/libtool.m4  $@
++ libtoolize --copy --install --automake --force
++ aclocal
+
+ configure: aclocal.m4 configure.in $(config\_m4\_files)
+ @echo rebuilding $@
--- php5-5.3.2.orig/debian/patches/force\_libmysqlclient\_r.patch
+++ php5-5.3.2/debian/patches/force\_libmysqlclient\_r.patch
@@ -0,0 +1,41 @@
+Description: Force linking to mysqlclient\_r to avoid symbol conflicts.
+ apr-util's mysql driver is linked against that version of the library
+ but due to missing proper symbols versioning we are forced to link to
+ the re-entrant library too.
+Origin: other, http://bugs.debian.org/469081
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- a/ext/mysql/config.m4
++++ b/ext/mysql/config.m4
+@@ -78,7 +78,7 @@ elif test "$PHP\_MYSQL" != "no"; then
+ Note that the MySQL client library is not bundled anymore!])
+ fi
+
+- if test "$enable\_maintainer\_zts" = "yes"; then
++ if true || test "$enable\_maintainer\_zts" = "yes"; then
+ MYSQL\_LIBNAME=mysqlclient\_r
+ else
+ MYSQL\_LIBNAME=mysqlclient
+--- a/ext/mysqli/config.m4
++++ b/ext/mysqli/config.m4
+@@ -29,7 +29,7 @@ elif test "$PHP\_MYSQLI" != "no"; then
+ MYSQL\_LIB\_CFG='--libmysqld-libs'
+ dnl mysqlnd doesn't support embedded, so we have to add some extra stuff
+ mysqli\_extra\_sources="mysqli\_embedded.c"
+- elif test "$enable\_maintainer\_zts" = "yes"; then
++ elif true || test "$enable\_maintainer\_zts" = "yes"; then
+ MYSQL\_LIB\_CFG='--libs\_r'
+ MYSQL\_LIB\_NAME='mysqlclient\_r'
+ else
+--- a/ext/pdo\_mysql/config.m4
++++ b/ext/pdo\_mysql/config.m4
+@@ -64,7 +64,7 @@ if test "$PHP\_PDO\_MYSQL" != "no"; then
+ if test "x$SED" = "x"; then
+ AC\_PATH\_PROG(SED, sed)
+ fi
+- if test "$enable\_maintainer\_zts" = "yes"; then
++ if true || test "$enable\_maintainer\_zts" = "yes"; then
+ PDO\_MYSQL\_LIBNAME=mysqlclient\_r
+ PDO\_MYSQL\_LIBS=`$PDO\_MYSQL\_CONFIG --libs\_r | $SED -e "s/'//g"`
+ else
--- php5-5.3.2.orig/debian/patches/libdb\_is\_-ldb
+++ php5-5.3.2/debian/patches/libdb\_is\_-ldb
@@ -0,0 +1,17 @@
+Description: Let configure check detect version-less libdbs to support
+ newer versions without patching the configure code.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/ext/dba/config.m4
++++ pkg-php/ext/dba/config.m4
+@@ -306,7 +306,7 @@ if test "$PHP\_DB4" != "no"; then
+ break
+ fi
+ done
+- PHP\_DBA\_DB\_CHECK(4, db-4.6 db-4.5 db-4.4 db-4.3 db-4.2 db-4.1 db-4.0 db-4 db4 db, [(void)db\_create((DB\*\*)0, (DB\_ENV\*)0, 0)])
++ PHP\_DBA\_DB\_CHECK(4, db db-4.6 db-4.5 db-4.4 db-4.3 db-4.2 db-4.1 db-4.0 db-4 db4, [(void)db\_create((DB\*\*)0, (DB\_ENV\*)0, 0)])
+ fi
+ PHP\_DBA\_STD\_RESULT(db4,Berkeley DB4)
+
--- php5-5.3.2.orig/debian/patches/113-php.ini\_securitynotes.patch
+++ php5-5.3.2/debian/patches/113-php.ini\_securitynotes.patch
@@ -0,0 +1,44 @@
+Description: Adds security notices to php.ini settings
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- a/php.ini-development
++++ b/php.ini-development
+@@ -335,6 +335,11 @@ allow\_call\_time\_pass\_reference = Off
+
+ ; Safe Mode
+ ; http://php.net/safe-mode
++; NOTE: this is considered a "broken" security measure.
++; Applications relying on this feature will not recieve full
++; support by the security team. For more information please
++; see /usr/share/doc/php5-common/README.Debian.security
++;
+ safe\_mode = Off
+
+ ; By default, Safe Mode does a UID compare check when
+@@ -376,6 +381,12 @@ safe\_mode\_protected\_env\_vars = LD\_LIBRAR
+ ; or per-virtualhost web server configuration file. This directive is
+ ; \*NOT\* affected by whether Safe Mode is turned On or Off.
+ ; http://php.net/open-basedir
++
++; NOTE: this is considered a "broken" security measure.
++; Applications relying on this feature will not recieve full
++; support by the security team. For more information please
++; see /usr/share/doc/php5-common/README.Debian.security
++;
+ ;open\_basedir =
+
+ ; This directive allows you to disable certain functions for security reasons.
+@@ -688,6 +699,11 @@ request\_order = "GP"
+ ; register\_globals to be on; Using form variables as globals can easily lead
+ ; to possible security problems, if the code is not very well thought of.
+ ; http://php.net/register-globals
++
++; NOTE: applications relying on this feature will not recieve full
++; support by the security team. For more information please
++; see /usr/share/doc/php5-common/README.Debian.security
++;
+ register\_globals = Off
+
+ ; Determines whether the deprecated long $HTTP\_\*\_VARS type predefined variables
--- php5-5.3.2.orig/debian/patches/strcmp\_null-OnUpdateErrorLog.patch
+++ php5-5.3.2/debian/patches/strcmp\_null-OnUpdateErrorLog.patch
@@ -0,0 +1,13 @@
+--- /dev/null
++++ b/tests/func/null-new\_val.phpt
+@@ -0,0 +1,10 @@
++--TEST--
++ini\_restore strcmp NULL new\_val
++--FILE--
++php
++
++ini\_set('error\_log','ini\_set\_works');
++ini\_restore('error\_log');
++
++?
++--EXPECT--
--- php5-5.3.2.orig/debian/patches/017-pread\_pwrite\_disable.patch
+++ php5-5.3.2/debian/patches/017-pread\_pwrite\_disable.patch
@@ -0,0 +1,28 @@
+Description: Completely disable the usage of pread/pwrite
+ .
+ This is an old patch and should be re-checked.
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/261311
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/acinclude.m4
++++ pkg-php/acinclude.m4
+@@ -1219,7 +1219,7 @@ $1
+ }
+
+ ],[
+- ac\_cv\_pwrite=yes
++ ac\_cv\_pwrite=no
+ ],[
+ ac\_cv\_pwrite=no
+ ],[
+@@ -1248,7 +1248,7 @@ $1
+ exit(0);
+ }
+ ],[
+- ac\_cv\_pread=yes
++ ac\_cv\_pread=no
+ ],[
+ ac\_cv\_pread=no
+ ],[
--- php5-5.3.2.orig/debian/patches/shtool\_mkdir\_-p\_-race-condition.patch
+++ php5-5.3.2/debian/patches/shtool\_mkdir\_-p\_-race-condition.patch
@@ -0,0 +1,27 @@
+Description: Workaround a race condition in shtool's mkdir -p
+ This workaround can be affected by another race condition where a
+ different process running under a different user creates the directory,
+ which would make the chown/chmod calls fail.
+ .
+ This is the version of the patch sent to shtool upstream.
+Origin: vendor
+Forwarded: yes
+Last-Update: 2010-02-18
+
+Index: php/build/shtool
+===================================================================
+--- php.orig/build/shtool
++++ php/build/shtool
+@@ -991,7 +991,11 @@ mkdir )
+ if [ ".$opt\_t" = .yes ]; then
+ echo "mkdir $pathcomp" 1>&2
+ fi
+- mkdir $pathcomp || errstatus=$?
++ mkdir $pathcomp || {
++ \_errstatus=$?
++ [ -d "$pathcomp" ] || errstatus=${\_errstatus}
++ unset \_errstatus
++ }
+ if [ ".$opt\_o" != . ]; then
+ if [ ".$opt\_t" = .yes ]; then
+ echo "chown $opt\_o $pathcomp" 1>&2
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1092.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1092.patch
@@ -0,0 +1,21 @@
+Subject: Fixed bug #54193 (Integer overflow in shmop\_read())
+Origin: http://svn.php.net/viewvc/?view=revision&revision=309018
+
+CVE-2011-1092
+
+Patch differs from upstream commit in that the change to the NEWS file
+was removed to reduce conflicts.
+
+Index: ext/shmop/shmop.c
+===================================================================
+--- ext/shmop/shmop.c (revision 309017)
++++ ext/shmop/shmop.c (revision 309018)
+@@ -256,7 +256,7 @@
+ RETURN\_FALSE;
+ }
+
+- if (start + count > shmop->size || count < 0) {
++ if (count < 0 || start > (INT\_MAX - count) || start + count > shmop->size) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "count is out of range");
+ RETURN\_FALSE;
+ }
--- php5-5.3.2.orig/debian/patches/qdbm-is-usr\_include\_qdbm.patch
+++ php5-5.3.2/debian/patches/qdbm-is-usr\_include\_qdbm.patch
@@ -0,0 +1,22 @@
+Description: Look for qdbm under $prefix/include/qdbm too.
+ The Debian package ships the header files under that directory, for
+ unknown reasons.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-02-21
+
+Index: php/ext/dba/config.m4
+===================================================================
+--- php.orig/ext/dba/config.m4
++++ php/ext/dba/config.m4
+@@ -109,6 +109,10 @@ if test "$PHP\_QDBM" != "no"; then
+ THIS\_PREFIX=$i
+ THIS\_INCLUDE=$i/include/depot.h
+ break
++ elif test -f "$i/include/qdbm/depot.h"; then
++ THIS\_PREFIX=$i
++ THIS\_INCLUDE=$i/include/qdbm/depot.h
++ break
+ fi
+ done
+
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-1914.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-1914.patch
@@ -0,0 +1,139 @@
+Subject: Fixed a possible information leak because of interruption of XOR operator
+Origin: http://svn.php.net/viewvc?view=revision&revision=299280
+
+CVE-2010-1914
+
+[Ubuntu note: patch differs from upstream in that the changes to the
+ NEWS file have been dropped to reduce the possibility of patch
+ conflicts. --sbeattie]
+
+---
+ Zend/zend\_operators.c | 28 +++++++++++++++++++++-------
+ 1 file changed, 21 insertions(+), 7 deletions(-)
+
+Index: b/Zend/zend\_operators.c
+===================================================================
+--- a/Zend/zend\_operators.c
++++ b/Zend/zend\_operators.c
+@@ -988,8 +988,10 @@ ZEND\_API int div\_function(zval \*result,
+ ZEND\_API int mod\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ zendi\_convert\_to\_long(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_long(op2, op2\_copy, result);
+
+ if (Z\_LVAL\_P(op2) == 0) {
+@@ -1004,7 +1006,7 @@ ZEND\_API int mod\_function(zval \*result,
+ return SUCCESS;
+ }
+
+- ZVAL\_LONG(result, Z\_LVAL\_P(op1) % Z\_LVAL\_P(op2));
++ ZVAL\_LONG(result, op1\_lval % Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -1012,10 +1014,12 @@ ZEND\_API int mod\_function(zval \*result,
+ ZEND\_API int boolean\_xor\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ zendi\_convert\_to\_boolean(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_boolean(op2, op2\_copy, result);
+- ZVAL\_BOOL(result, Z\_LVAL\_P(op1) ^ Z\_LVAL\_P(op2));
++ ZVAL\_BOOL(result, op1\_lval ^ Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -1061,6 +1065,7 @@ ZEND\_API int bitwise\_not\_function(zval \*
+ ZEND\_API int bitwise\_or\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ if (Z\_TYPE\_P(op1) == IS\_STRING && Z\_TYPE\_P(op2) == IS\_STRING) {
+ zval \*longer, \*shorter;
+@@ -1089,9 +1094,10 @@ ZEND\_API int bitwise\_or\_function(zval \*r
+ return SUCCESS;
+ }
+ zendi\_convert\_to\_long(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_long(op2, op2\_copy, result);
+
+- ZVAL\_LONG(result, Z\_LVAL\_P(op1) | Z\_LVAL\_P(op2));
++ ZVAL\_LONG(result, op1\_lval | Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -1099,6 +1105,7 @@ ZEND\_API int bitwise\_or\_function(zval \*r
+ ZEND\_API int bitwise\_and\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ if (Z\_TYPE\_P(op1) == IS\_STRING && Z\_TYPE\_P(op2) == IS\_STRING) {
+ zval \*longer, \*shorter;
+@@ -1129,9 +1136,10 @@ ZEND\_API int bitwise\_and\_function(zval \*
+
+
+ zendi\_convert\_to\_long(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_long(op2, op2\_copy, result);
+
+- ZVAL\_LONG(result, Z\_LVAL\_P(op1) & Z\_LVAL\_P(op2));
++ ZVAL\_LONG(result, op1\_lval & Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -1139,6 +1147,7 @@ ZEND\_API int bitwise\_and\_function(zval \*
+ ZEND\_API int bitwise\_xor\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ if (Z\_TYPE\_P(op1) == IS\_STRING && Z\_TYPE\_P(op2) == IS\_STRING) {
+ zval \*longer, \*shorter;
+@@ -1168,9 +1177,10 @@ ZEND\_API int bitwise\_xor\_function(zval \*
+ }
+
+ zendi\_convert\_to\_long(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_long(op2, op2\_copy, result);
+
+- ZVAL\_LONG(result, Z\_LVAL\_P(op1) ^ Z\_LVAL\_P(op2));
++ ZVAL\_LONG(result, op1\_lval ^ Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -1178,10 +1188,12 @@ ZEND\_API int bitwise\_xor\_function(zval \*
+ ZEND\_API int shift\_left\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ zendi\_convert\_to\_long(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_long(op2, op2\_copy, result);
+- ZVAL\_LONG(result, Z\_LVAL\_P(op1) << Z\_LVAL\_P(op2));
++ ZVAL\_LONG(result, op1\_lval << Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -1189,10 +1201,12 @@ ZEND\_API int shift\_left\_function(zval \*r
+ ZEND\_API int shift\_right\_function(zval \*result, zval \*op1, zval \*op2 TSRMLS\_DC) /\* {{{ \*/
+ {
+ zval op1\_copy, op2\_copy;
++ long op1\_lval;
+
+ zendi\_convert\_to\_long(op1, op1\_copy, result);
++ op1\_lval = Z\_LVAL\_P(op1);
+ zendi\_convert\_to\_long(op2, op2\_copy, result);
+- ZVAL\_LONG(result, Z\_LVAL\_P(op1) >> Z\_LVAL\_P(op2));
++ ZVAL\_LONG(result, op1\_lval >> Z\_LVAL\_P(op2));
+ return SUCCESS;
+ }
+ /\* }}} \*/
--- php5-5.3.2.orig/debian/patches/043-recode\_size\_t.patch
+++ php5-5.3.2/debian/patches/043-recode\_size\_t.patch
@@ -0,0 +1,17 @@
+Description: Check for possible overflows in recode\_string()
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/294986, http://bugs.debian.org/459020
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/ext/recode/recode.c
++++ pkg-php/ext/recode/recode.c
+@@ -149,7 +149,7 @@ PHP\_FUNCTION(recode\_string)
+ int req\_len, str\_len;
+ char \*req, \*str;
+
+- if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "ss", &req, &req\_len, &str, &str\_len) == FAILURE) {
++ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "ss", &req, &req\_len, &str, &str\_len) == FAILURE || str\_len < 0) {
+ return;
+ }
+
--- php5-5.3.2.orig/debian/patches/php5-CVE-2012-0831.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2012-0831.patch
@@ -0,0 +1,53 @@
+Origin: http://svn.php.net/viewvc?view=revision&revision=323016
+Subject: Always restore PG(magic\_quote\_gpc) on request shutdown
+
+CVE-2012-0831
+
+---
+ main/php\_variables.c | 9 +++++++--
+ sapi/cgi/cgi\_main.c | 4 +++-
+ sapi/fpm/fpm/fpm\_main.c | 4 +++-
+ 3 files changed, 13 insertions(+), 4 deletions(-)
+
+Index: b/sapi/cgi/cgi\_main.c
+===================================================================
+--- a/sapi/cgi/cgi\_main.c
++++ b/sapi/cgi/cgi\_main.c
+@@ -624,7 +624,9 @@ void cgi\_php\_import\_environment\_variable
+ int filter\_arg = (array\_ptr == PG(http\_globals)[TRACK\_VARS\_ENV])?PARSE\_ENV:PARSE\_SERVER;
+
+ /\* turn off magic\_quotes while importing environment variables \*/
+- PG(magic\_quotes\_gpc) = 0;
++ if (PG(magic\_quotes\_gpc)) {
++ zend\_alter\_ini\_entry\_ex("magic\_quotes\_gpc", sizeof("magic\_quotes\_gpc"), "0", 1, ZEND\_INI\_SYSTEM, ZEND\_INI\_STAGE\_ACTIVATE, 1 TSRMLS\_CC);
++ }
+ for (zend\_hash\_internal\_pointer\_reset\_ex(request->env, &pos);
+ zend\_hash\_get\_current\_key\_ex(request->env, &var, &var\_len, &idx, 0, &pos) == HASH\_KEY\_IS\_STRING &&
+ zend\_hash\_get\_current\_data\_ex(request->env, (void \*\*) &val, &pos) == SUCCESS;
+Index: b/main/php\_variables.c
+===================================================================
+--- a/main/php\_variables.c
++++ b/main/php\_variables.c
+@@ -457,7 +457,10 @@ void \_php\_import\_environment\_variables(z
+
+ /\* turn off magic\_quotes while importing environment variables \*/
+ int magic\_quotes\_gpc = PG(magic\_quotes\_gpc);
+- PG(magic\_quotes\_gpc) = 0;
++
++ if (PG(magic\_quotes\_gpc)) {
++ zend\_alter\_ini\_entry\_ex("magic\_quotes\_gpc", sizeof("magic\_quotes\_gpc"), "0", 1, ZEND\_INI\_SYSTEM, ZEND\_INI\_STAGE\_ACTIVATE, 1 TSRMLS\_CC);
++ }
+
+ for (env = environ; env != NULL && \*env != NULL; env++) {
+ p = strchr(\*env, '=');
+@@ -600,7 +603,9 @@ static inline void php\_register\_server\_v
+ zval\_ptr\_dtor(&PG(http\_globals)[TRACK\_VARS\_SERVER]);
+ }
+ PG(http\_globals)[TRACK\_VARS\_SERVER] = array\_ptr;
+- PG(magic\_quotes\_gpc) = 0;
++ if (PG(magic\_quotes\_gpc)) {
++ zend\_alter\_ini\_entry\_ex("magic\_quotes\_gpc", sizeof("magic\_quotes\_gpc"), "0", 1, ZEND\_INI\_SYSTEM, ZEND\_INI\_STAGE\_ACTIVATE, 1 TSRMLS\_CC);
++ }
+
+ /\* Server variables \*/
+ if (sapi\_module.register\_server\_variables) {
--- php5-5.3.2.orig/debian/patches/115-autoconf\_ftbfs.patch
+++ php5-5.3.2/debian/patches/115-autoconf\_ftbfs.patch
@@ -0,0 +1,76 @@
+--- a/configure.in
++++ b/configure.in
+@@ -1,7 +1,7 @@
+ ## $Id: configure.in 295792 2010-03-03 16:36:07Z johannes $ -\*- autoconf -\*-
+ dnl ## Process this file with autoconf to produce a configure script.
+
+-divert(1)
++dnl divert(1)
+
+ dnl ## Diversion 1 is the autoconf + automake setup phase. We also
+ dnl ## set the PHP version, deal with platform-specific compile
+@@ -290,7 +290,7 @@ sinclude(TSRM/threads.m4)
+ sinclude(TSRM/tsrm.m4)
+
+
+-divert(2)
++dnl divert(2)
+
+ dnl ## Diversion 2 is where we set PHP-specific options and come up
+ dnl ## with reasonable default values for them. We check for pthreads here
+@@ -329,7 +329,7 @@ if test "$enable\_maintainer\_zts" = "yes"
+ PTHREADS\_FLAGS
+ fi
+
+-divert(3)
++dnl divert(3)
+
+ dnl ## In diversion 3 we check for compile-time options to the PHP
+ dnl ## core and how to deal with different system dependencies.
+@@ -675,7 +675,7 @@ if test "x$php\_crypt\_r" = "x1"; then
+ PHP\_CRYPT\_R\_STYLE
+ fi
+
+-divert(4)
++dnl divert(4)
+
+ dnl ## In diversion 4 we check user-configurable general settings.
+
+@@ -916,7 +916,7 @@ else
+ AC\_MSG\_RESULT([using system default])
+ fi
+
+-divert(5)
++dnl divert(5)
+
+ dnl ## In diversion 5 we check which extensions should be compiled.
+ dnl ## All of these are normally in the extension directories.
+--- a/ext/standard/config.m4
++++ b/ext/standard/config.m4
+@@ -1,6 +1,6 @@
+ dnl $Id: config.m4 295350 2010-02-22 00:34:22Z pajoye $ -\*- autoconf -\*-
+
+-divert(3)dnl
++dnl divert(3)dnl
+
+ dnl
+ dnl Check if flush should be called explicitly after buffered io
+@@ -333,7 +333,7 @@ dnl
+ AC\_CHECK\_FUNCS(getcwd getwd asinh acosh atanh log1p hypot glob strfmon nice fpclass isinf isnan mempcpy strpncpy)
+ AC\_FUNC\_FNMATCH
+
+-divert(5)dnl
++dnl divert(5)dnl
+
+ dnl
+ dnl Check if there is a support means of creating a new process
+--- a/scripts/phpize.m4
++++ b/scripts/phpize.m4
+@@ -1,6 +1,6 @@
+ dnl This file becomes configure.in for self-contained extensions.
+
+-divert(1)
++dnl divert(1)
+
+ AC\_PREREQ(2.13)
+ AC\_INIT(config.m4)
--- php5-5.3.2.orig/debian/patches/052-phpinfo\_no\_configure.patch
+++ php5-5.3.2/debian/patches/052-phpinfo\_no\_configure.patch
@@ -0,0 +1,33 @@
+Description: Disable configure parameters on phpinfo() output
+ .
+ Patch needs to be discussed with upstream and the issues that lead to
+ its addition re-checked. Quoting changelog entry:
+ .
+ Add [...], which disables the display of our "Configure Command" in
+ phpinfo(), which was the source of many bogus bug reports over the
+ years, due to people misinterpreting its meaning.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/ext/standard/info.c
++++ b/ext/standard/info.c
+@@ -693,7 +693,7 @@ PHPAPI void php\_print\_info(int flag TSRM
+ #ifdef ARCHITECTURE
+ php\_info\_print\_table\_row(2, "Architecture", ARCHITECTURE);
+ #endif
+-#ifdef CONFIGURE\_COMMAND
++#if 0
+ php\_info\_print\_table\_row(2, "Configure Command", CONFIGURE\_COMMAND );
+ #endif
+
+--- a/ext/standard/tests/general\_functions/phpinfo.phpt
++++ b/ext/standard/tests/general\_functions/phpinfo.phpt
+@@ -20,7 +20,6 @@ PHP Version => %s
+
+ System => %s
+ Build Date => %s%a
+-Configure Command => %s
+ Server API => Command Line Interface
+ Virtual Directory Support => %s
+ Configuration File (php.ini) Path => %s
--- php5-5.3.2.orig/debian/patches/100-recode\_is\_shared.patch
+++ php5-5.3.2/debian/patches/100-recode\_is\_shared.patch
@@ -0,0 +1,16 @@
+Description: Turn recode conflicts error message into a warning. The
+ recode extension is packaged as a shared library in Debian.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/ext/recode/config9.m4
++++ pkg-php/ext/recode/config9.m4
+@@ -13,6 +13,6 @@ if test "$PHP\_RECODE" != "no"; then
+ fi
+
+ if test -n "$recode\_conflict"; then
+- AC\_MSG\_ERROR([recode extension can not be configured together with:$recode\_conflict])
++ AC\_MSG\_WARN([recode extension can not be used together with:$recode\_conflict])
+ fi
+ fi
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1153.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1153.patch
@@ -0,0 +1,253 @@
+Subject: Fixed bug #54247 (format-string vulnerability on Phar)
+Origin: http://svn.php.net/viewvc?view=revision&revision=309221
+Bug: http://bugs.php.net/bug.php?id=54247
+
+CVE-2011-1153
+
+Index: ext/phar/phar\_object.c
+===================================================================
+--- ext/phar/phar\_object.c (revision 309220)
++++ ext/phar/phar\_object.c (revision 309221)
+@@ -1141,7 +1141,7 @@
+ RETVAL\_BOOL(phar\_open\_from\_filename(fname, fname\_len, alias, alias\_len, REPORT\_ERRORS, NULL, &error TSRMLS\_CC) == SUCCESS);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ } /\* }}} \*/
+@@ -2007,7 +2007,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -2070,7 +2070,7 @@
+ phar\_obj->arc.archive->ufp = pass.fp;
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ } else {
+@@ -2327,7 +2327,7 @@
+ phar\_flush(phar, 0, 0, 1, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(spl\_ce\_BadMethodCallException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(spl\_ce\_BadMethodCallException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ efree(oldpath);
+ return NULL;
+@@ -2787,7 +2787,7 @@
+
+ phar\_flush(phar\_obj->arc.archive, NULL, 0, 0, &error TSRMLS\_CC);
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -2862,7 +2862,7 @@
+ efree(error);
+ goto valid\_alias;
+ }
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ RETURN\_FALSE;
+ }
+@@ -2899,7 +2899,7 @@
+ phar\_obj->arc.archive->alias = oldalias;
+ phar\_obj->arc.archive->alias\_len = oldalias\_len;
+ phar\_obj->arc.archive->is\_temporary\_alias = old\_temp;
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ if (readd) {
+ zend\_hash\_add(&(PHAR\_GLOBALS->phar\_alias\_map), oldalias, oldalias\_len, (void\*)&(phar\_obj->arc.archive), sizeof(phar\_archive\_data\*), NULL);
+ }
+@@ -2972,7 +2972,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -3021,7 +3021,7 @@
+ }
+ phar\_flush(phar\_obj->arc.archive, (char \*) &zstub, len, 0, &error TSRMLS\_CC);
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ RETURN\_TRUE;
+@@ -3037,7 +3037,7 @@
+ phar\_flush(phar\_obj->arc.archive, stub, stub\_len, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -3098,7 +3098,7 @@
+ stub = phar\_create\_default\_stub(index, webindex, &stub\_len, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(spl\_ce\_UnexpectedValueException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(spl\_ce\_UnexpectedValueException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ if (stub) {
+ efree(stub);
+@@ -3120,7 +3120,7 @@
+ }
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ RETURN\_FALSE;
+ }
+@@ -3175,7 +3175,7 @@
+
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ break;
+@@ -3477,7 +3477,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(spl\_ce\_BadMethodCallException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(spl\_ce\_BadMethodCallException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -3517,7 +3517,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(spl\_ce\_BadMethodCallException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(spl\_ce\_BadMethodCallException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -3617,7 +3617,7 @@
+ if (FAILURE == phar\_copy\_entry\_fp(oldentry, &newentry, &error TSRMLS\_CC)) {
+ efree(newentry.filename);
+ php\_stream\_close(newentry.fp);
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ return;
+ }
+@@ -3628,7 +3628,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -3774,7 +3774,7 @@
+ phar\_flush(\*pphar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -3810,7 +3810,7 @@
+ phar\_flush(\*pphar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -3896,7 +3896,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -4152,7 +4152,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -4179,7 +4179,7 @@
+ phar\_flush(phar\_obj->arc.archive, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ RETURN\_FALSE;
+ } else {
+@@ -4727,7 +4727,7 @@
+ phar\_flush(entry\_obj->ent.entry->phar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -4813,7 +4813,7 @@
+ phar\_flush(entry\_obj->ent.entry->phar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ }
+@@ -4858,7 +4858,7 @@
+ phar\_flush(entry\_obj->ent.entry->phar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ RETURN\_FALSE;
+ } else {
+@@ -5040,7 +5040,7 @@
+ phar\_flush(entry\_obj->ent.entry->phar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+
+@@ -5115,7 +5115,7 @@
+ phar\_flush(entry\_obj->ent.entry->phar, 0, 0, 0, &error TSRMLS\_CC);
+
+ if (error) {
+- zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, error);
++ zend\_throw\_exception\_ex(phar\_ce\_PharException, 0 TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ RETURN\_TRUE;
--- php5-5.3.2.orig/debian/patches/fix\_var\_dump\_64bit.phpt.patch
+++ php5-5.3.2/debian/patches/fix\_var\_dump\_64bit.phpt.patch
@@ -0,0 +1,25 @@
+Description: Backport upstream fix for broken var\_dump test
+Origin: http://svn.php.net/viewvc/php/php-src/trunk/ext/standard/tests/general\_functions/var\_dump\_64bit.phpt?r1=279276&r2=295009&view=patch
+Bug-Debian: http://bugs.debian.org/571772
+--- php.orig/ext/standard/tests/general\_functions/var\_dump\_64bit.phpt
++++ php/ext/standard/tests/general\_functions/var\_dump\_64bit.phpt
+@@ -462,8 +462,7 @@
+ -- Iteration 14 --
+ string(22) "1234
+ 5678
+- 9100
+-abcda"
++ 9100
abcda"
+
+ \*\*\* Testing var\_dump() on boolean variables \*\*\*
+ -- Iteration 1 --
+@@ -1303,8 +1302,7 @@ array(14) {
+ [13]=>
+ string(22) "1234
+ 5678
+- 9100
+-abcda"
++ 9100
abcda"
+ }
+ array(15) {
+ [0]=>
--- php5-5.3.2.orig/debian/patches/057-no\_apache\_installed.patch
+++ php5-5.3.2/debian/patches/057-no\_apache\_installed.patch
@@ -0,0 +1,89 @@
+Description: Disable installed-apache configure check
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/sapi/apache2handler/config.m4
++++ pkg-php/sapi/apache2handler/config.m4
+@@ -59,13 +59,13 @@ if test "$PHP\_APXS2" != "no"; then
+
+ APACHE\_CFLAGS="$APACHE\_CPPFLAGS -I$APXS\_INCLUDEDIR $APR\_CFLAGS $APU\_CFLAGS"
+
+- # Test that we're trying to configure with apache 2.x
+- PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
+- if test "$APACHE\_VERSION" -le 2000000; then
+- AC\_MSG\_ERROR([You have enabled Apache 2 support while your server is Apache 1.3. Please use the appropiate switch --with-apxs (without the 2)])
+- elif test "$APACHE\_VERSION" -lt 2000044; then
+- AC\_MSG\_ERROR([Please note that Apache version >= 2.0.44 is required])
+- fi
++dnl # Test that we're trying to configure with apache 2.x
++dnl PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
++dnl if test "$APACHE\_VERSION" -le 2000000; then
++dnl AC\_MSG\_ERROR([You have enabled Apache 2 support while your server is Apache 1.3. Please use the appropiate switch --with-apxs (without the 2)])
++dnl elif test "$APACHE\_VERSION" -lt 2000044; then
++dnl AC\_MSG\_ERROR([Please note that Apache version >= 2.0.44 is required])
++dnl fi
+
+ APXS\_LIBEXECDIR='$(INSTALL\_ROOT)'`$APXS -q LIBEXECDIR`
+ if test -z `$APXS -q SYSCONFDIR`; then
+--- pkg-php.orig/sapi/apache/config.m4
++++ pkg-php/sapi/apache/config.m4
+@@ -56,11 +56,11 @@ if test "$PHP\_APXS" != "no"; then
+ APXS\_HTTPD=`$APXS -q SBINDIR`/`$APXS -q TARGET`
+ APACHE\_INCLUDE=-I$APXS\_INCLUDEDIR
+
+- # Test that we're trying to configure with apache 1.x
+- PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
+- if test "$APACHE\_VERSION" -ge 2000000; then
+- AC\_MSG\_ERROR([You have enabled Apache 1.3 support while your server is Apache 2. Please use the appropiate switch --with-apxs2])
+- fi
++dnl # Test that we're trying to configure with apache 1.x
++dnl PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
++dnl if test "$APACHE\_VERSION" -ge 2000000; then
++dnl AC\_MSG\_ERROR([You have enabled Apache 1.3 support while your server is Apache 2. Please use the appropiate switch --with-apxs2])
++dnl fi
+
+ for flag in $APXS\_CFLAGS; do
+ case $flag in
+--- pkg-php.orig/sapi/apache2filter/config.m4
++++ pkg-php/sapi/apache2filter/config.m4
+@@ -60,13 +60,13 @@ if test "$PHP\_APXS2FILTER" != "no"; then
+
+ APACHE\_CFLAGS="$APACHE\_CPPFLAGS -I$APXS\_INCLUDEDIR $APR\_CFLAGS $APU\_CFLAGS"
+
+- # Test that we're trying to configure with apache 2.x
+- PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
+- if test "$APACHE\_VERSION" -le 2000000; then
+- AC\_MSG\_ERROR([You have enabled Apache 2 support while your server is Apache 1.3. Please use the appropiate switch --with-apxs (without the 2)])
+- elif test "$APACHE\_VERSION" -lt 2000040; then
+- AC\_MSG\_ERROR([Please note that Apache version >= 2.0.40 is required])
+- fi
++dnl # Test that we're trying to configure with apache 2.x
++dnl PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
++dnl if test "$APACHE\_VERSION" -le 2000000; then
++dnl AC\_MSG\_ERROR([You have enabled Apache 2 support while your server is Apache 1.3. Please use the appropiate switch --with-apxs (without the 2)])
++dnl elif test "$APACHE\_VERSION" -lt 2000040; then
++dnl AC\_MSG\_ERROR([Please note that Apache version >= 2.0.40 is required])
++dnl fi
+
+ APXS\_LIBEXECDIR='$(INSTALL\_ROOT)'`$APXS -q LIBEXECDIR`
+ if test -z `$APXS -q SYSCONFDIR`; then
+--- pkg-php.orig/sapi/apache\_hooks/config.m4
++++ pkg-php/sapi/apache\_hooks/config.m4
+@@ -57,11 +57,11 @@ if test "$PHP\_APACHE\_HOOKS" != "no"; the
+ APXS\_HTTPD=`$APXS -q SBINDIR`/`$APXS -q TARGET`
+ APACHE\_INCLUDE=-I$APXS\_INCLUDEDIR
+
+- # Test that we're trying to configure with apache 1.x
+- PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
+- if test "$APACHE\_VERSION" -ge 2000000; then
+- AC\_MSG\_ERROR([You have enabled Apache 1.3 support while your server is Apache 2. Please use the appropiate switch --with-apxs2])
+- fi
++dnl # Test that we're trying to configure with apache 1.x
++dnl PHP\_AP\_EXTRACT\_VERSION($APXS\_HTTPD)
++dnl if test "$APACHE\_VERSION" -ge 2000000; then
++dnl AC\_MSG\_ERROR([You have enabled Apache 1.3 support while your server is Apache 2. Please use the appropiate switch --with-apxs2])
++dnl fi
+
+ for flag in $APXS\_CFLAGS; do
+ case $flag in
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1471.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1471.patch
@@ -0,0 +1,46 @@
+Subject: Fixed bug #49072 (feof never returns true for damaged file in zip).
+Origin: http://svn.php.net/viewvc?view=revision&revision=307917
+Bug: http://bugs.php.net/bug.php?id=49072
+
+CVE-2011-1471
+
+Patch differs from upstream commit in that it drops the add NEWS file
+entry to reduce patch conflicts and is backported to earlier versions of
+php.
+
+Index: ext/zip/zip\_stream.c
+===================================================================
+--- ext/zip/zip\_stream.c (revision 307916)
++++ ext/zip/zip\_stream.c (revision 307917)
+@@ -30,11 +30,11 @@
+ /\* {{{ php\_zip\_ops\_read \*/
+ static size\_t php\_zip\_ops\_read(php\_stream \*stream, char \*buf, size\_t count TSRMLS\_DC)
+ {
+- int n = 0;
++ ssize\_t n = 0;
+ STREAM\_DATA\_FROM\_STREAM();
+
+ if (self->za && self->zf) {
+- n = (size\_t)zip\_fread(self->zf, buf, (int)count);
++ n = zip\_fread(self->zf, buf, count);
+ if (n < 0) {
+ int ze, se;
+ zip\_file\_error\_get(self->zf, &ze, &se);
+@@ -42,13 +42,15 @@
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Zip stream error: %s", zip\_file\_strerror(self->zf));
+ return 0;
+ }
+- if (n == 0 || n < count) {
++ /\* cast count to signed value to avoid possibly negative n
++ \* being cast to unsigned value \*/
++ if (n == 0 || n < (ssize\_t)count) {
+ stream->eof = 1;
+ } else {
+ self->cursor += n;
+ }
+ }
+- return (n < 1 ? 0 : n);
++ return (n < 1 ? 0 : (size\_t)n);
+ }
+ /\* }}} \*/
+
--- php5-5.3.2.orig/debian/patches/bad\_whatis\_entries.patch
+++ php5-5.3.2/debian/patches/bad\_whatis\_entries.patch
@@ -0,0 +1,34 @@
+Description: Fix whatis entries of the man pages
+Origin: vendor
+Forwarded: http://bugs.php.net/50795
+Last-Update: 2010-01-18
+
+--- a/sapi/cli/php.1.in
++++ b/sapi/cli/php.1.in
+@@ -1,6 +1,5 @@
+ .TH PHP 1 "2010" "The PHP Group" "Scripting Language"
+ .SH NAME
+-.TP 15
+ php \- PHP Command Line Interface 'CLI'
+ .SH SYNOPSIS
+ .B php
+--- a/scripts/man1/php-config.1.in
++++ b/scripts/man1/php-config.1.in
+@@ -1,6 +1,5 @@
+ .TH php\-config 1 "2006" "The PHP Group" "Scripting Language"
+ .SH NAME
+-.TP 15
+ php\-config \- get information about PHP configuration and compile options
+ .SH SYNOPSIS
+ .B php\-config
+--- a/scripts/man1/phpize.1.in
++++ b/scripts/man1/phpize.1.in
+@@ -1,7 +1,6 @@
+ .TH phpize 1 "2006" "The PHP Group" "Scripting Language"
+ .SH NAME
+-.TP 15
+-phpize - prepare a PHP extension for compiling
++phpize \- prepare a PHP extension for compiling
+ .SH SYNOPSIS
+ .B phpize
+ [options]
--- php5-5.3.2.orig/debian/patches/002-static\_openssl.patch
+++ php5-5.3.2/debian/patches/002-static\_openssl.patch
@@ -0,0 +1,13 @@
+--- pkg-php.orig/acinclude.m4
++++ pkg-php/acinclude.m4
+@@ -2373,9 +2373,7 @@ AC\_DEFUN([PHP\_SETUP\_OPENSSL],[
+
+ PHP\_ADD\_INCLUDE($OPENSSL\_INCDIR)
+
+- PHP\_CHECK\_LIBRARY(crypto, CRYPTO\_free, [
+- PHP\_ADD\_LIBRARY(crypto,,$1)
+- ],[
++ PHP\_CHECK\_LIBRARY(crypto, CRYPTO\_free, [:],[
+ AC\_MSG\_ERROR([libcrypto not found!])
+ ],[
+ -L$OPENSSL\_LIBDIR
--- php5-5.3.2.orig/debian/patches/CVE-2010-2225.patch
+++ php5-5.3.2/debian/patches/CVE-2010-2225.patch
@@ -0,0 +1,192 @@
+Description: fix sensitive information disclosure or arbitrary code
+ execution via use-after-free in SplObjectStorage unserializer
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=300843
+
+diff -Nur php5-5.3.2/ext/spl/spl\_observer.c php5-5.3.2.new/ext/spl/spl\_observer.c
+--- php5-5.3.2/ext/spl/spl\_observer.c 2010-01-03 04:23:27.000000000 -0500
++++ php5-5.3.2.new/ext/spl/spl\_observer.c 2010-09-14 10:56:54.000000000 -0400
+@@ -115,6 +115,7 @@
+ zval\_ptr\_dtor(&element->inf);
+ } /\* }}} \*/
+
++
+ spl\_SplObjectStorageElement\* spl\_object\_storage\_get(spl\_SplObjectStorage \*intern, zval \*obj TSRMLS\_DC) /\* {{{ \*/
+ {
+ spl\_SplObjectStorageElement \*element;
+@@ -632,15 +633,24 @@
+ zval\_ptr\_dtor(&pcount);
+
+ while(count-- > 0) {
++ spl\_SplObjectStorageElement \*pelement;
++
+ if (\*p != ';') {
+ goto outexcept;
+ }
+ ++p;
++ if(\*p != 'O' && \*p != 'C' && \*p != 'r') {
++ goto outexcept;
++ }
+ ALLOC\_INIT\_ZVAL(pentry);
+ if (!php\_var\_unserialize(&pentry, &p, s + buf\_len, &var\_hash TSRMLS\_CC)) {
+ zval\_ptr\_dtor(&pentry);
+ goto outexcept;
+ }
++ if(Z\_TYPE\_P(pentry) != IS\_OBJECT) {
++ zval\_ptr\_dtor(&pentry);
++ goto outexcept;
++ }
+ ALLOC\_INIT\_ZVAL(pinf);
+ if (\*p == ',') { /\* new version has inf \*/
+ ++p;
+@@ -649,6 +659,16 @@
+ goto outexcept;
+ }
+ }
++
++ pelement = spl\_object\_storage\_get(intern, pentry TSRMLS\_CC);
++ if(pelement) {
++ if(pelement->inf) {
++ var\_push\_dtor(&var\_hash, &pelement->inf);
++ }
++ if(pelement->obj) {
++ var\_push\_dtor(&var\_hash, &pelement->obj);
++ }
++ }
+ spl\_object\_storage\_attach(intern, pentry, pinf TSRMLS\_CC);
+ zval\_ptr\_dtor(&pentry);
+ zval\_ptr\_dtor(&pinf);
+diff -Nur php5-5.3.2/ext/spl/tests/SplObjectStorage\_unserialize\_bad.phpt php5-5.3.2.new/ext/spl/tests/SplObjectStorage\_unserialize\_bad.phpt
+--- php5-5.3.2/ext/spl/tests/SplObjectStorage\_unserialize\_bad.phpt 1969-12-31 19:00:00.000000000 -0500
++++ php5-5.3.2.new/ext/spl/tests/SplObjectStorage\_unserialize\_bad.phpt 2010-09-14 10:58:30.000000000 -0400
+@@ -0,0 +1,45 @@
++--TEST--
++SPL: Test that serialized blob contains unique elements (CVE-2010-2225)
++--FILE--
++php
++
++$badblobs = array(
++'x:i:2;i:0;,i:1;;i:0;,i:2;;m:a:0:{}',
++'x:i:3;O:8:"stdClass":0:{},O:8:"stdClass":0:{};R:1;,i:1;;O:8:"stdClass":0:{},r:2;;m:a:0:{}',
++'x:i:3;O:8:"stdClass":0:{},O:8:"stdClass":0:{};r:1;,i:1;;O:8:"stdClass":0:{},r:2;;m:a:0:{}',
++);
++foreach($badblobs as $blob) {
++try {
++ $so = new SplObjectStorage();
++ $so-unserialize($blob);
++ var\_dump($so);
++} catch(UnexpectedValueException $e) {
++ echo $e->getMessage()."\n";
++}
++}
++--EXPECTF--
++Error at offset 6 of 34 bytes
++Error at offset 46 of 89 bytes
++object(SplObjectStorage)#2 (1) {
++ ["storage":"SplObjectStorage":private]=>
++ array(2) {
++ ["%s"]=>
++ array(2) {
++ ["obj"]=>
++ object(stdClass)#3 (0) {
++ }
++ ["inf"]=>
++ int(1)
++ }
++ ["%s"]=>
++ array(2) {
++ ["obj"]=>
++ object(stdClass)#1 (0) {
++ }
++ ["inf"]=>
++ object(stdClass)#4 (0) {
++ }
++ }
++ }
++}
++
+diff -Nur php5-5.3.2/ext/spl/tests/SplObjectStorage\_unserialize\_nested.phpt php5-5.3.2.new/ext/spl/tests/SplObjectStorage\_unserialize\_nested.phpt
+--- php5-5.3.2/ext/spl/tests/SplObjectStorage\_unserialize\_nested.phpt 1969-12-31 19:00:00.000000000 -0500
++++ php5-5.3.2.new/ext/spl/tests/SplObjectStorage\_unserialize\_nested.phpt 2010-09-14 10:58:30.000000000 -0400
+@@ -0,0 +1,47 @@
++--TEST--
++SPL: Test unserializing tested & linked storage
++--FILE--
++php
++$o = new StdClass();
++$a = new StdClass();
++
++$o-a = $a;
++
++$so = new SplObjectStorage();
++
++$so[$o] = 1;
++$so[$a] = 2;
++
++$s = serialize($so);
++echo $s."\n";
++
++$so1 = unserialize($s);
++var\_dump($so1);
++
++--EXPECTF--
++C:16:"SplObjectStorage":76:{x:i:2;O:8:"stdClass":1:{s:1:"a";O:8:"stdClass":0:{}},i:1;;r:2;,i:2;;m:a:0:{}}
++object(SplObjectStorage)#4 (1) {
++ ["storage":"SplObjectStorage":private]=>
++ array(2) {
++ ["%s"]=>
++ array(2) {
++ ["obj"]=>
++ object(stdClass)#5 (1) {
++ ["a"]=>
++ object(stdClass)#6 (0) {
++ }
++ }
++ ["inf"]=>
++ int(1)
++ }
++ ["%s"]=>
++ array(2) {
++ ["obj"]=>
++ object(stdClass)#6 (0) {
++ }
++ ["inf"]=>
++ int(2)
++ }
++ }
++}
++
+diff -Nur php5-5.3.2/ext/standard/php\_var.h php5-5.3.2.new/ext/standard/php\_var.h
+--- php5-5.3.2/ext/standard/php\_var.h 2010-01-03 04:23:27.000000000 -0500
++++ php5-5.3.2.new/ext/standard/php\_var.h 2010-09-14 10:56:57.000000000 -0400
+@@ -60,6 +60,7 @@
+ var\_destroy(&(var\_hash))
+
+ PHPAPI void var\_replace(php\_unserialize\_data\_t \*var\_hash, zval \*ozval, zval \*\*nzval);
++PHPAPI void var\_push\_dtor(php\_unserialize\_data\_t \*var\_hash, zval \*\*val);
+ PHPAPI void var\_destroy(php\_unserialize\_data\_t \*var\_hash);
+
+ #define PHP\_VAR\_UNSERIALIZE\_ZVAL\_CHANGED(var\_hash, ozval, nzval) \
+diff -Nur php5-5.3.2/ext/standard/var\_unserializer.c php5-5.3.2.new/ext/standard/var\_unserializer.c
+--- php5-5.3.2/ext/standard/var\_unserializer.c 2010-03-03 11:52:40.000000000 -0500
++++ php5-5.3.2.new/ext/standard/var\_unserializer.c 2010-09-14 10:56:59.000000000 -0400
+@@ -55,7 +55,7 @@
+ var\_hash->data[var\_hash->used\_slots++] = \*rval;
+ }
+
+-static inline void var\_push\_dtor(php\_unserialize\_data\_t \*var\_hashx, zval \*\*rval)
++PHPAPI void var\_push\_dtor(php\_unserialize\_data\_t \*var\_hashx, zval \*\*rval)
+ {
+ var\_entries \*var\_hash = var\_hashx->first\_dtor, \*prev = NULL;
+
+diff -Nur php5-5.3.2/ext/standard/var\_unserializer.re php5-5.3.2.new/ext/standard/var\_unserializer.re
+--- php5-5.3.2/ext/standard/var\_unserializer.re 2010-01-03 03:22:14.000000000 -0500
++++ php5-5.3.2.new/ext/standard/var\_unserializer.re 2010-09-14 10:58:08.000000000 -0400
+@@ -54,7 +54,7 @@
+ var\_hash->data[var\_hash->used\_slots++] = \*rval;
+ }
+
+-static inline void var\_push\_dtor(php\_unserialize\_data\_t \*var\_hashx, zval \*\*rval)
++PHPAPI void var\_push\_dtor(php\_unserialize\_data\_t \*var\_hashx, zval \*\*rval)
+ {
+ var\_entries \*var\_hash = var\_hashx->first\_dtor, \*prev = NULL;
+
--- php5-5.3.2.orig/debian/patches/CVE-2010-2531.patch
+++ php5-5.3.2/debian/patches/CVE-2010-2531.patch
@@ -0,0 +1,283 @@
+Description: fix sensitive information disclosure via error messages
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=301144
+
+diff -Nur php5-5.3.2/ext/standard/php\_var.h php5-5.3.2.new/ext/standard/php\_var.h
+--- php5-5.3.2/ext/standard/php\_var.h 2010-09-14 11:00:31.000000000 -0400
++++ php5-5.3.2.new/ext/standard/php\_var.h 2010-09-14 11:00:38.000000000 -0400
+@@ -33,6 +33,8 @@
+
+ PHPAPI void php\_var\_dump(zval \*\*struc, int level TSRMLS\_DC);
+ PHPAPI void php\_var\_export(zval \*\*struc, int level TSRMLS\_DC);
++PHPAPI void php\_var\_export\_ex(zval \*\*struc, int level, smart\_str \*buf TSRMLS\_DC);
++
+ PHPAPI void php\_debug\_zval\_dump(zval \*\*struc, int level TSRMLS\_DC);
+
+ /\* typdef HashTable php\_serialize\_data\_t; \*/
+diff -Nur php5-5.3.2/ext/standard/tests/general\_functions/var\_export\_error2.phpt php5-5.3.2.new/ext/standard/tests/general\_functions/var\_export\_error2.phpt
+--- php5-5.3.2/ext/standard/tests/general\_functions/var\_export\_error2.phpt 2009-01-26 17:27:03.000000000 -0500
++++ php5-5.3.2.new/ext/standard/tests/general\_functions/var\_export\_error2.phpt 2010-09-14 11:00:41.000000000 -0400
+@@ -14,12 +14,5 @@
+ ?>
+ ===DONE===
+ --EXPECTF--
+-stdClass::\_\_set\_state(array(
+- 'p' =>
+- stdClass::\_\_set\_state(array(
+- 'p' =>
+- stdClass::\_\_set\_state(array(
+- 'p' =>
+- stdClass::\_\_set\_state(array(
+
+ Fatal error: Nesting level too deep - recursive dependency? in %s on line 9
+\ No newline at end of file
+diff -Nur php5-5.3.2/ext/standard/tests/general\_functions/var\_export\_error3.phpt php5-5.3.2.new/ext/standard/tests/general\_functions/var\_export\_error3.phpt
+--- php5-5.3.2/ext/standard/tests/general\_functions/var\_export\_error3.phpt 2009-01-26 17:27:03.000000000 -0500
++++ php5-5.3.2.new/ext/standard/tests/general\_functions/var\_export\_error3.phpt 2010-09-14 11:00:43.000000000 -0400
+@@ -14,14 +14,5 @@
+ ?>
+ ===DONE===
+ --EXPECTF--
+-array (
+- 0 =>
+- array (
+- 0 =>
+- array (
+- 0 =>
+- array (
+- 0 =>
+- array (
+
+ Fatal error: Nesting level too deep - recursive dependency? in %s on line 9
+\ No newline at end of file
+diff -Nur php5-5.3.2/ext/standard/var.c php5-5.3.2.new/ext/standard/var.c
+--- php5-5.3.2/ext/standard/var.c 2010-01-03 04:23:27.000000000 -0500
++++ php5-5.3.2.new/ext/standard/var.c 2010-09-14 11:00:46.000000000 -0400
+@@ -331,27 +331,47 @@
+ }
+ /\* }}} \*/
+
++#define buffer\_append\_spaces(buf, num\_spaces) \
++ do { \
++ char \*tmp\_spaces; \
++ int tmp\_spaces\_len; \
++ tmp\_spaces\_len = spprintf(&tmp\_spaces, 0,"%\*c", num\_spaces, ' '); \
++ smart\_str\_appendl(buf, tmp\_spaces, tmp\_spaces\_len); \
++ efree(tmp\_spaces); \
++ } while(0);
++
+ static int php\_array\_element\_export(zval \*\*zv TSRMLS\_DC, int num\_args, va\_list args, zend\_hash\_key \*hash\_key) /\* {{{ \*/
+ {
+ int level;
++ smart\_str \*buf;
+
+ level = va\_arg(args, int);
++ buf = va\_arg(args, smart\_str \*);
+
+ if (hash\_key->nKeyLength == 0) { /\* numeric key \*/
+- php\_printf("%\*c%ld => ", level + 1, ' ', hash\_key->h);
++ buffer\_append\_spaces(buf, level+1);
++ smart\_str\_append\_long(buf, hash\_key->h);
++ smart\_str\_appendl(buf, " => ", 4);
+ } else { /\* string key \*/
+ char \*key, \*tmp\_str;
+ int key\_len, tmp\_len;
+ key = php\_addcslashes(hash\_key->arKey, hash\_key->nKeyLength - 1, &key\_len, 0, "'\\", 2 TSRMLS\_CC);
+ tmp\_str = php\_str\_to\_str\_ex(key, key\_len, "\0", 1, "' . \"\\0\" . '", 12, &tmp\_len, 0, NULL);
+- php\_printf("%\*c'", level + 1, ' ');
+- PHPWRITE(tmp\_str, tmp\_len);
+- php\_printf("' => ");
++
++ buffer\_append\_spaces(buf, level + 1);
++
++ smart\_str\_appendc(buf, '\'');
++ smart\_str\_appendl(buf, tmp\_str, tmp\_len);
++ smart\_str\_appendl(buf, "' => ", 5);
++
+ efree(key);
+ efree(tmp\_str);
+ }
+- php\_var\_export(zv, level + 2 TSRMLS\_CC);
+- PUTS (",\n");
++ php\_var\_export\_ex(zv, level + 2, buf TSRMLS\_CC);
++
++ smart\_str\_appendc(buf, ',');
++ smart\_str\_appendc(buf, '\n');
++
+ return 0;
+ }
+ /\* }}} \*/
+@@ -359,24 +379,33 @@
+ static int php\_object\_element\_export(zval \*\*zv TSRMLS\_DC, int num\_args, va\_list args, zend\_hash\_key \*hash\_key) /\* {{{ \*/
+ {
+ int level;
++ smart\_str \*buf;
+ char \*prop\_name, \*class\_name;
+
+ level = va\_arg(args, int);
++ buf = va\_arg(args, smart\_str \*);
+
+- php\_printf("%\*c", level + 1, ' ');
++ buffer\_append\_spaces(buf, level + 2);
+ if (hash\_key->nKeyLength != 0) {
+ zend\_unmangle\_property\_name(hash\_key->arKey, hash\_key->nKeyLength - 1, &class\_name, ∝\_name);
+- php\_printf(" '%s' => ", prop\_name);
++
++ smart\_str\_appendc(buf, '\'');
++ smart\_str\_appends(buf, prop\_name);
++ smart\_str\_appendc(buf, '\'');
+ } else {
+- php\_printf(" %ld => ", hash\_key->h);
++ smart\_str\_append\_long(buf, hash\_key->h);
+ }
+- php\_var\_export(zv, level + 2 TSRMLS\_CC);
+- PUTS (",\n");
++
++ smart\_str\_appendl(buf, " => ", 4);
++ php\_var\_export\_ex(zv, level + 2, buf TSRMLS\_CC);
++ smart\_str\_appendc(buf, ',');
++ smart\_str\_appendc(buf, '\n');
++
+ return 0;
+ }
+ /\* }}} \*/
+
+-PHPAPI void php\_var\_export(zval \*\*struc, int level TSRMLS\_DC) /\* {{{ \*/
++PHPAPI void php\_var\_export\_ex(zval \*\*struc, int level, smart\_str \*buf TSRMLS\_DC) /\* {{{ \*/
+ {
+ HashTable \*myht;
+ char \*tmp\_str, \*tmp\_str2;
+@@ -386,82 +415,109 @@
+
+ switch (Z\_TYPE\_PP(struc)) {
+ case IS\_BOOL:
+- php\_printf("%s", Z\_LVAL\_PP(struc) ? "true" : "false");
++ if (Z\_LVAL\_PP(struc)) {
++ smart\_str\_appendl(buf, "true", 4);
++ } else {
++ smart\_str\_appendl(buf, "false", 5);
++ }
+ break;
+ case IS\_NULL:
+- php\_printf("NULL");
++ smart\_str\_appendl(buf, "NULL", 4);
+ break;
+ case IS\_LONG:
+- php\_printf("%ld", Z\_LVAL\_PP(struc));
++ smart\_str\_append\_long(buf, Z\_LVAL\_PP(struc));
+ break;
+ case IS\_DOUBLE:
+- php\_printf("%.\*H", (int) EG(precision), Z\_DVAL\_PP(struc));
++ tmp\_len = spprintf(&tmp\_str, 0,"%.\*H", (int) EG(precision), Z\_DVAL\_PP(struc));
++ smart\_str\_appendl(buf, tmp\_str, tmp\_len);
++ efree(tmp\_str);
+ break;
+ case IS\_STRING:
+ tmp\_str = php\_addcslashes(Z\_STRVAL\_PP(struc), Z\_STRLEN\_PP(struc), &tmp\_len, 0, "'\\", 2 TSRMLS\_CC);
+ tmp\_str2 = php\_str\_to\_str\_ex(tmp\_str, tmp\_len, "\0", 1, "' . \"\\0\" . '", 12, &tmp\_len2, 0, NULL);
+- PUTS ("'");
+- PHPWRITE(tmp\_str2, tmp\_len2);
+- PUTS ("'");
++
++ smart\_str\_appendc(buf, '\'');
++ smart\_str\_appendl(buf, tmp\_str2, tmp\_len2);
++ smart\_str\_appendc(buf, '\'');
++
+ efree(tmp\_str2);
+ efree(tmp\_str);
+ break;
+ case IS\_ARRAY:
+ myht = Z\_ARRVAL\_PP(struc);
+ if (level > 1) {
+- php\_printf("\n%\*c", level - 1, ' ');
++ smart\_str\_appendc(buf, '\n');
++ buffer\_append\_spaces(buf, level - 1);
+ }
+- PUTS ("array (\n");
+- zend\_hash\_apply\_with\_arguments(myht TSRMLS\_CC, (apply\_func\_args\_t) php\_array\_element\_export, 1, level, 0);
++ smart\_str\_appendl(buf, "array (\n", 8);
++ zend\_hash\_apply\_with\_arguments(myht TSRMLS\_CC, (apply\_func\_args\_t) php\_array\_element\_export, 2, level, buf);
++
+ if (level > 1) {
+- php\_printf("%\*c", level - 1, ' ');
++ buffer\_append\_spaces(buf, level - 1);
+ }
+- PUTS(")");
++ smart\_str\_appendc(buf, ')');
++
+ break;
+ case IS\_OBJECT:
+ myht = Z\_OBJPROP\_PP(struc);
+ if (level > 1) {
+- php\_printf("\n%\*c", level - 1, ' ');
++ smart\_str\_appendc(buf, '\n');
++ buffer\_append\_spaces(buf, level - 1);
+ }
+ Z\_OBJ\_HANDLER(\*\*struc, get\_class\_name)(\*struc, &class\_name, &class\_name\_len, 0 TSRMLS\_CC);
+- php\_printf ("%s::\_\_set\_state(array(\n", class\_name);
++
++ smart\_str\_appendl(buf, class\_name, class\_name\_len);
++ smart\_str\_appendl(buf, "::\_\_set\_state(array(\n", 21);
++
+ efree(class\_name);
+ if (myht) {
+- zend\_hash\_apply\_with\_arguments(myht TSRMLS\_CC, (apply\_func\_args\_t) php\_object\_element\_export, 1, level);
++ zend\_hash\_apply\_with\_arguments(myht TSRMLS\_CC, (apply\_func\_args\_t) php\_object\_element\_export, 2, level, buf);
+ }
+ if (level > 1) {
+- php\_printf("%\*c", level - 1, ' ');
++ buffer\_append\_spaces(buf, level - 1);
+ }
+- php\_printf ("))");
++ smart\_str\_appendl(buf, "))", 2);
++
+ break;
+ default:
+- PUTS ("NULL");
++ smart\_str\_appendl(buf, "NULL", 4);
+ break;
+ }
+ }
+ /\* }}} \*/
+
++/\* FOR BC reasons, this will always perform and then print \*/
++PHPAPI void php\_var\_export(zval \*\*struc, int level TSRMLS\_DC) /\* {{{ \*/
++{
++ smart\_str buf = {0};
++ php\_var\_export\_ex(struc, level, &buf TSRMLS\_CC);
++ smart\_str\_0 (&buf);
++ PHPWRITE(buf.c, buf.len);
++ smart\_str\_free(&buf);
++}
++/\* }}} \*/
++
+ /\* {{{ proto mixed var\_export(mixed var [, bool return])
+ Outputs or returns a string representation of a variable \*/
+ PHP\_FUNCTION(var\_export)
+ {
+ zval \*var;
+ zend\_bool return\_output = 0;
++ smart\_str buf = {0};
+
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "z|b", &var, &return\_output) == FAILURE) {
+ return;
+ }
+
+- if (return\_output) {
+- php\_start\_ob\_buffer (NULL, 0, 1 TSRMLS\_CC);
+- }
+-
+- php\_var\_export(&var, 1 TSRMLS\_CC);
++ php\_var\_export\_ex(&var, 1, &buf TSRMLS\_CC);
++ smart\_str\_0 (&buf);
+
+ if (return\_output) {
+- php\_ob\_get\_buffer (return\_value TSRMLS\_CC);
+- php\_end\_ob\_buffer (0, 0 TSRMLS\_CC);
++ RETVAL\_STRINGL(buf.c, buf.len, 1);
++ } else {
++ PHPWRITE(buf.c, buf.len);
+ }
++ smart\_str\_free(&buf);
+ }
+ /\* }}} \*/
+
--- php5-5.3.2.orig/debian/patches/CVE-2010-1866.patch
+++ php5-5.3.2/debian/patches/CVE-2010-1866.patch
@@ -0,0 +1,25 @@
+Description: fix denial of service and possible memory corruption via
+ negative size in HTTP chunked encoding stream
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=298700
+
+diff -Nur php5-5.3.2/ext/standard/filters.c php5-5.3.2.new/ext/standard/filters.c
+--- php5-5.3.2/ext/standard/filters.c 2010-01-03 04:23:27.000000000 -0500
++++ php5-5.3.2.new/ext/standard/filters.c 2010-09-14 10:53:58.000000000 -0400
+@@ -1914,7 +1914,7 @@
+
+ typedef struct \_php\_chunked\_filter\_data {
+ php\_chunked\_filter\_state state;
+- int chunk\_size;
++ size\_t chunk\_size;
+ int persistent;
+ } php\_chunked\_filter\_data;
+
+@@ -1991,7 +1991,7 @@
+ continue;
+ }
+ case CHUNK\_BODY:
+- if (end - p >= data->chunk\_size) {
++ if ((size\_t) (end - p) >= data->chunk\_size) {
+ if (p != out) {
+ memmove(out, p, data->chunk\_size);
+ }
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1657.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1657.patch
@@ -0,0 +1,64 @@
+Subject: Fixed bug #54681 (addGlob() crashes on invalid flags)
+Origin: http://svn.php.net/viewvc/?view=revision&revision=310814
+
+Fixed bug #54681 (addGlob() crashes on invalid flags)
+
+CVE-2011-1657
+
+[Ubuntu note: this patch has been slightly modified to apply to older
+ versions of php. - sbeattie]
+
+---
+ ext/zip/php\_zip.c | 32 ++++++++++++++++++++++++++++++++
+ 1 file changed, 32 insertions(+)
+
+Index: b/ext/zip/php\_zip.c
+===================================================================
+--- a/ext/zip/php\_zip.c
++++ b/ext/zip/php\_zip.c
+@@ -470,6 +470,28 @@ static char \* php\_zipobj\_get\_zip\_comment
+ #define GLOB\_FLAGMASK (~GLOB\_ONLYDIR)
+ #else
+ #define GLOB\_FLAGMASK (~0)
++#ifndef GLOB\_BRACE
++# define GLOB\_BRACE 0
++#endif
++#ifndef GLOB\_MARK
++# define GLOB\_MARK 0
++#endif
++#ifndef GLOB\_NOSORT
++# define GLOB\_NOSORT 0
++#endif
++#ifndef GLOB\_NOCHECK
++# define GLOB\_NOCHECK 0
++#endif
++#ifndef GLOB\_NOESCAPE
++# define GLOB\_NOESCAPE 0
++#endif
++#ifndef GLOB\_ERR
++# define GLOB\_ERR 0
++#endif
++
++/\* This is used for checking validity of passed flags (passing invalid flags causes segfault in glob()!! \*/
++#define GLOB\_AVAILABLE\_FLAGS (0 | GLOB\_BRACE | GLOB\_MARK | GLOB\_NOSORT | GLOB\_NOCHECK | GLOB\_NOESCAPE | GLOB\_ERR | GLOB\_ONLYDIR)
++
+ #endif /\* }}} \*/
+
+ int php\_zip\_glob(char \*pattern, int pattern\_len, long flags, zval \*return\_value TSRMLS\_DC) /\* {{{ \*/
+@@ -483,6 +505,16 @@ int php\_zip\_glob(char \*pattern, int patt
+ glob\_t globbuf;
+ int n;
+ int ret;
++
++ if (pattern\_len >= MAXPATHLEN) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Pattern exceeds the maximum allowed length of %d characters", MAXPATHLEN);
++ return -1;
++ }
++
++ if ((GLOB\_AVAILABLE\_FLAGS & flags) != flags) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "At least one of the passed flags is invalid or not supported on this platform");
++ return -1;
++ }
+
+ #ifdef ZTS
+ if (!IS\_ABSOLUTE\_PATH(pattern, pattern\_len)) {
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-0420.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-0420.patch
@@ -0,0 +1,38 @@
+Subject: Fix bad args to grapheme\_extract(), reported by Maksymilian Arciemowicz
+Origin: http://svn.php.net/viewvc?view=revision&revision=306449
+
+CVE-2011-0420
+
+Index: ext/intl/grapheme/grapheme\_string.c
+===================================================================
+--- ext/intl/grapheme/grapheme\_string.c (revision 306448)
++++ ext/intl/grapheme/grapheme\_string.c (revision 306449)
+@@ -799,7 +799,7 @@
+
+ if ( NULL != next ) {
+ if ( !PZVAL\_IS\_REF(next) ) {
+- intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR,
++ intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR,
+ "grapheme\_extract: 'next' was not passed by reference", 0 TSRMLS\_CC );
+
+ RETURN\_FALSE;
+@@ -819,11 +819,17 @@
+ }
+
+ if ( lstart > INT32\_MAX || lstart < 0 || lstart >= str\_len ) {
++ intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR, "grapheme\_extract: start not contained in string", 0 TSRMLS\_CC );
++ RETURN\_FALSE;
++ }
+
+- intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR, "grapheme\_extract: start not contained in string", 1 TSRMLS\_CC );
+-
++ if ( size > INT32\_MAX || size < 0) {
++ intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR, "grapheme\_extract: size is invalid", 0 TSRMLS\_CC );
+ RETURN\_FALSE;
+ }
++ if (size == 0) {
++ RETURN\_EMPTY\_STRING();
++ }
+
+ /\* we checked that it will fit: \*/
+ start = (int32\_t) lstart;
--- php5-5.3.2.orig/debian/patches/php5-pear-CVE-2011-1144.patch
+++ php5-5.3.2/debian/patches/php5-pear-CVE-2011-1144.patch
@@ -0,0 +1,131 @@
+Subject: Introduce a time-of-check-time-of-use (TOCTOU) save file
+ handler, this makes sure that from the time we check it is available
+ until we get the file handler that no one attempted to put in a
+ soft / hard link instead of what we checked for.
+Origin: http://svn.php.net/viewvc?view=revision&revision=309042
+
+CVE-2011-1144
+
+Index: PEAR/REST.php
+===================================================================
+--- PEAR/REST.php (revision 309041)
++++ PEAR/REST.php (revision 309042)
+@@ -228,59 +228,75 @@
+ $cacheidfile = $d . 'rest.cacheid';
+ $cachefile = $d . 'rest.cachefile';
+
++ if (!is\_dir($cache\_dir)) {
++ if (System::mkdir(array('-p', $cache\_dir) === false)) {
++ return PEAR::raiseError("The value of config option cache\_dir ($cache\_dir) is not a directory and attempts to create the directory failed.");
++ }
++ }
++
+ if ($cacheid === null && $nochange) {
+ $cacheid = unserialize(implode('', file($cacheidfile)));
+ }
+
+- if (is\_link($cacheidfile)) {
+- return PEAR::raiseError('SECURITY ERROR: Will not write to ' . $cacheidfile . ' as it is symlinked to ' . readlink($cacheidfile) . ' - Possible symlink attack');
+- }
++ $idData = serialize(array(
++ 'age' => time(),
++ 'lastChange' => ($nochange ? $cacheid['lastChange'] : $lastmodified),
++ ));
+
+- if (is\_link($cachefile)) {
+- return PEAR::raiseError('SECURITY ERROR: Will not write to ' . $cacheidfile . ' as it is symlinked to ' . readlink($cacheidfile) . ' - Possible symlink attack');
++ $result = $this->saveCacheFile($cacheidfile, $idData);
++ if (PEAR::isError($result)) {
++ return $result;
++ } elseif ($nochange) {
++ return true;
+ }
+
+- $cacheidfile\_fp = @fopen($cacheidfile, 'wb');
+- if (!$cacheidfile\_fp) {
+- if (is\_dir($cache\_dir)) {
+- return PEAR::raiseError("The value of config option cache\_dir ($cache\_dir) is not a directory. ");
++ $result = $this->saveCacheFile($cachefile, serialize($contents));
++ if (PEAR::isError($result)) {
++ if (file\_exists($cacheidfile)) {
++ @unlink($cacheidfile);
+ }
+
+- System::mkdir(array('-p', $cache\_dir));
+- $cacheidfile\_fp = @fopen($cacheidfile, 'wb');
+- if (!$cacheidfile\_fp) {
+- return PEAR::raiseError("Could not open $cacheidfile for writing.");
+- }
++ return $result;
+ }
+
+- if ($nochange) {
+- fwrite($cacheidfile\_fp, serialize(array(
+- 'age' => time(),
+- 'lastChange' => $cacheid['lastChange'],
+- ))
+- );
++ return true;
++ }
+
+- fclose($cacheidfile\_fp);
+- return true;
+- }
++ function saveCacheFile($file, $contents)
++ {
++ $len = strlen($contents);
+
+- fwrite($cacheidfile\_fp, serialize(array(
+- 'age' => time(),
+- 'lastChange' => $lastmodified,
+- ))
+- );
+- fclose($cacheidfile\_fp);
++ $cachefile\_fp = @fopen($file, 'xb'); // x is the O\_CREAT|O\_EXCL mode
++ if ($cachefile\_fp !== false) { // create file
++ if (fwrite($cachefile\_fp, $contents, $len) < $len) {
++ fclose($cachefile\_fp);
++ return PEAR::raiseError("Could not write $file.");
++ }
++ } else { // update file
++ $cachefile\_lstat = lstat($file);
++ $cachefile\_fp = @fopen($file, 'wb');
++ if (!$cachefile\_fp) {
++ return PEAR::raiseError("Could not open $file for writing.");
++ }
+
+- $cachefile\_fp = @fopen($cachefile, 'wb');
+- if (!$cachefile\_fp) {
+- if (file\_exists($cacheidfile)) {
+- @unlink($cacheidfile);
++ $cachefile\_fstat = fstat($cachefile\_fp);
++ if (
++ $cachefile\_lstat['mode'] == $cachefile\_fstat['mode'] &&
++ $cachefile\_lstat['ino'] == $cachefile\_fstat['ino'] &&
++ $cachefile\_lstat['dev'] == $cachefile\_fstat['dev'] &&
++ $cachefile\_fstat['nlink'] === 1
++ ) {
++ if (fwrite($cachefile\_fp, $contents, $len) < $len) {
++ fclose($cachefile\_fp);
++ return PEAR::raiseError("Could not write $file.");
++ }
++ } else {
++ fclose($cachefile\_fp);
++ $link = function\_exists('readlink') ? readlink($file) : $file;
++ return PEAR::raiseError('SECURITY ERROR: Will not write to ' . $file . ' as it is symlinked to ' . $link . ' - Possible symlink attack');
+ }
+-
+- return PEAR::raiseError("Could not open $cacheidfile for writing.");
+ }
+
+- fwrite($cachefile\_fp, serialize($contents));
+ fclose($cachefile\_fp);
+ return true;
+ }
+@@ -464,4 +480,4 @@
+
+ return $data;
+ }
+-}
+\ No newline at end of file
++}
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-4566.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-4566.patch
@@ -0,0 +1,23 @@
+Description: fix denial of service and possible information disclosure
+ via exif integer overflow
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=319535
+Bug: https://bugs.php.net/bug.php?id=60150
+
+Index: php5-5.3.8.0/ext/exif/exif.c
+===================================================================
+--- php5-5.3.8.0.orig/ext/exif/exif.c 2011-12-12 15:13:43.006064337 -0500
++++ php5-5.3.8.0/ext/exif/exif.c 2011-12-12 15:13:58.910064186 -0500
+@@ -2874,11 +2874,11 @@
+ offset\_val = php\_ifd\_get32u(dir\_entry+8, ImageInfo->motorola\_intel);
+ /\* If its bigger than 4 bytes, the dir entry contains an offset. \*/
+ value\_ptr = offset\_base+offset\_val;
+- if (offset\_val+byte\_count > IFDlength || value\_ptr < dir\_entry) {
++ if (byte\_count > IFDlength || offset\_val > IFDlength-byte\_count || value\_ptr < dir\_entry) {
+ /\* It is important to check for IMAGE\_FILETYPE\_TIFF
+ \* JPEG does not use absolute pointers instead its pointers are
+ \* relative to the start of the TIFF header in APP1 section. \*/
+- if (offset\_val+byte\_count>ImageInfo->FileSize || (ImageInfo->FileType!=IMAGE\_FILETYPE\_TIFF\_II && ImageInfo->FileType!=IMAGE\_FILETYPE\_TIFF\_MM && ImageInfo->FileType!=IMAGE\_FILETYPE\_JPEG)) {
++ if (byte\_count > ImageInfo->FileSize || offset\_val>ImageInfo->FileSize-byte\_count || (ImageInfo->FileType!=IMAGE\_FILETYPE\_TIFF\_II && ImageInfo->FileType!=IMAGE\_FILETYPE\_TIFF\_MM && ImageInfo->FileType!=IMAGE\_FILETYPE\_JPEG)) {
+ if (value\_ptr < dir\_entry) {
+ /\* we can read this if offset\_val > 0 \*/
+ /\* some files have their values in other parts of the file \*/
--- php5-5.3.2.orig/debian/patches/fix\_broken\_5.3\_tests.patch
+++ php5-5.3.2/debian/patches/fix\_broken\_5.3\_tests.patch
@@ -0,0 +1,45 @@
+Author: Sean Finney
+Description: Fix another small batch of broken test cases
+ \* ext/standard/tests/php\_ini\_loaded\_file.phpt: this test only works if
+ you call run-tests directly, but the included Makefile invokes the
+ test in such a way that it fails (it explicitly loads an ini file,
+ and the test assumes that none are loaded). since it therefore seems
+ like a somewhat useless test it has been removed.
+ \* cli/tests/006.phpt: $subject is  according to the docs for
+ the two pcre functions that report it as such, so the expected string has
+ been updated to match the output.
+ \* php.orig/ext/posix/tests/posix\_errno\_variation2.phpt: SIGKILL is not
+ a defined constant unless the pcntl extension is loaded. As was
+ done elsewhere (posix\_kill\_basic.phpt, which oddly seems to do the
+ same \*incredibly sketchy\* test that's done here), it's passed as a
+ variable hardcoded to 9 instead. Did i mention that this test is
+ sketchy?
+Origin: vendor
+--- a/ext/posix/tests/posix\_errno\_variation2.phpt
++++ b/ext/posix/tests/posix\_errno\_variation2.phpt
+@@ -21,7 +21,9 @@ do {
+ $result = shell\_exec("ps -p " . $pid);
+ } while (strstr($pid, $result));
+
+-posix\_kill($pid, SIGKILL);
++/\* don't depend on SIGKILL being defined (pcntl might not not be loaded) \*/
++$SIGKILL = 9;
++posix\_kill($pid, $SIGKILL);
+ var\_dump(posix\_errno());
+
+ ?>
+--- a/ext/standard/tests/php\_ini\_loaded\_file.phpt
++++ /dev/null
+@@ -1,12 +0,0 @@
+---TEST--
+-Check the php\_ini\_loaded\_file() function. No file is loaded in test, so false ins returned
+---CREDITS--
+-Sebastian SchÃ¼rmann
+-sschuermann@chip.de
+-Testfest 2009 Munich
+---FILE--
+-php
+-var\_dump(php\_ini\_loaded\_file());
+-?
+---EXPECTF--
+-string(%d) "%s/tmp-php.ini"
--- php5-5.3.2.orig/debian/patches/series
+++ php5-5.3.2/debian/patches/series
@@ -0,0 +1,101 @@
+001-libtool\_fixes.patch
+002-static\_openssl.patch
+004-ldap\_fix.patch
+006-debian\_quirks.patch
+libtool2.2.patch
+013-force\_getaddrinfo.patch
+017-pread\_pwrite\_disable.patch
+019-z\_off\_t\_as\_long.patch
+029-php.ini\_paranoid.patch
+033-we\_WANT\_libtool.patch
+034-apache2\_umask\_fix.patch
+036-fd\_setsize\_fix.patch
+043-recode\_size\_t.patch
+044-strtod\_arm\_fix.patch
+045-exif\_nesting\_level.patch
+047-zts\_with\_dl.patch
+052-phpinfo\_no\_configure.patch
+053-extension\_api.patch
+057-no\_apache\_installed.patch
+100-recode\_is\_shared.patch
+101-sqlite\_is\_shared.patch
+108-64\_bit\_datetime.patch
+112-proc\_open.patch
+113-php.ini\_securitynotes.patch
+115-autoconf\_ftbfs.patch
+116-posixness\_fix.patch
+libdb\_is\_-ldb
+page\_size\_fixes.patch
+suhosin.patch
+fix\_broken\_upstream\_tests.patch
+use\_embedded\_timezonedb.patch
+force\_libmysqlclient\_r.patch
+bad\_whatis\_entries.patch
+gentoo/009\_ob-memory-leaks.patch
+mssql-null-exception.patch
+sybase-alias.patch
+strcmp\_null-OnUpdateErrorLog.patch
+#deprecate\_short\_open\_tag
+unaligned\_memory\_access.patch
+fix\_broken\_5.3\_tests.patch
+dont-gitclean-in-build.patch
+broken\_5.3\_test-posix\_uname.patch
+shtool\_mkdir\_-p\_-race-condition.patch
+qdbm-is-usr\_include\_qdbm.patch
+filter\_validate\_int.patch
+zend\_int\_overflow.patch
+fix\_var\_dump\_64bit.phpt.patch
+use\_embedded\_timezonedb\_fixes.patch
+fix\_broken\_sha2\_test.patch
+php\_crypt\_revamped.patch
+fix\_broken\_locale\_tests.patch
+fix\_broken\_gd\_bundled-specific\_tests.patch
+CVE-2010-0397.patch
+enchant\_unaligned\_memory\_access.patch
+fix-mysql-badmem.patch
+session\_save\_path.patch
+lp564920-fix-big-files.patch
+CVE-2010-1866.patch
+CVE-2010-1868.patch
+CVE-2010-1917.patch
+CVE-2010-2094.patch
+CVE-2010-2225.patch
+CVE-2010-2531.patch
+CVE-2010-3065.patch
+php5-CVE-2010-3436.patch
+php5-CVE-2010-3709.patch
+php5-CVE-2010-3710.patch
+php5-CVE-2010-3870.patch
+php5-CVE-2010-4409.patch
+php5-CVE-2010-4645.patch
+php5-CVE-2010-3436-regression.patch
+php5-CVE-2006-7243.patch -p0
+php5-CVE-2010-4697.patch -p0
+php5-CVE-2010-4698.patch -p0
+php5-CVE-2011-0420.patch -p0
+php5-CVE-2011-0421.patch -p0
+php5-CVE-2011-0708.patch -p0
+php5-CVE-2011-1092.patch -p0
+php5-CVE-2011-1148.patch -p0
+php5-CVE-2011-1153.patch -p0
+php5-CVE-2011-1464.patch -p0
+php5-CVE-2011-1466.patch -p0
+php5-CVE-2011-1467.patch -p0
+php5-CVE-2011-1468.patch -p0
+php5-CVE-2011-1469.patch -p0
+php5-CVE-2011-1470.patch -p0
+php5-CVE-2011-1471.patch -p0
+php5-CVE-2011-2202.patch
+php5-CVE-2011-1657.patch
+php5-CVE-2010-1914.patch
+php5-CVE-2011-1938.patch
+php5-CVE-2011-2483.patch
+php5-CVE-2011-3182.patch
+php5-CVE-2011-3267.patch
+php5-CVE-2011-4566.patch
+php5-CVE-2011-4153.patch
+php5-CVE-2011-4885.patch
+php5-CVE-2012-0057.patch
+php5-CVE-2012-0788.patch
+php5-CVE-2012-0830.patch
+php5-CVE-2012-0831.patch
--- php5-5.3.2.orig/debian/patches/dont-gitclean-in-build.patch
+++ php5-5.3.2/debian/patches/dont-gitclean-in-build.patch
@@ -0,0 +1,18 @@
+Author: Sean Finney
+Description: Don't run git-clean via buildconf
+ Calling buildconf indirectly invokes vcsclean, which calls the gitclean-work
+ target of build/build.mk, which calls among other things git clean -X -f -d,
+ which in turn nukes the quilt .pc directory making life quite difficult for
+ us.
+ .
+ This patch doesn't need to go upstream, as they likely don't want to support
+ having a patch system on top of their source.
+--- php.orig/build/build.mk
++++ php/build/build.mk
+@@ -76,6 +76,5 @@ gitclean-work:
+ @if (test ! -f '.git/info/exclude' || grep -s "git-ls-files" .git/info/exclude); then \
+ (echo "Rebuild .git/info/exclude" && echo '\*.o' > .git/info/exclude && git svn propget svn:ignore | grep -v config.nice >> .git/info/exclude); \
+ fi; \
+- git clean -X -f -d;
+
+ .PHONY: $(ALWAYS) snapshot
--- php5-5.3.2.orig/debian/patches/filter\_validate\_int.patch
+++ php5-5.3.2/debian/patches/filter\_validate\_int.patch
@@ -0,0 +1,124 @@
+From: Sean Finney
+Subject: Fix improper signed overflow detection in filter extension
+
+The existing filter code relied on detecting invalid long integers by
+examining computed values for wraparound. This is not defined behavior
+in any C standard, and in fact recent versions of gcc will optimize out
+such checks resulting in invalid code.
+
+This patch therefore changes how the overflow/underflow conditions are
+detected, using more reliable arithmetic. It also fixes another bug, that
+the minimum integer value (-PHP\_INT\_MAX)-1 could not be detected properly.
+
+This patch also includes an update to the test case that detects such
+overflows, adding much more thorough and descriptive checking.
+
+Bug: http://bugs.php.net/bug.php?id=51023
+Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=570287
+--- php.orig/ext/filter/logical\_filters.c
++++ php/ext/filter/logical\_filters.c
+@@ -68,7 +68,7 @@
+
+ static int php\_filter\_parse\_int(const char \*str, unsigned int str\_len, long \*ret TSRMLS\_DC) { /\* {{{ \*/
+ long ctx\_value;
+- int sign = 0;
++ int sign = 0, digit = 0;
+ const char \*end = str + str\_len;
+
+ switch (\*str) {
+@@ -82,7 +82,7 @@ static int php\_filter\_parse\_int(const ch
+
+ /\* must start with 1..9\*/
+ if (str < end && \*str >= '1' && \*str <= '9') {
+- ctx\_value = ((\*(str++)) - '0');
++ ctx\_value = ((sign)?-1:1) \* ((\*(str++)) - '0');
+ } else {
+ return -1;
+ }
+@@ -95,19 +95,18 @@ static int php\_filter\_parse\_int(const ch
+
+ while (str < end) {
+ if (\*str >= '0' && \*str <= '9') {
+- ctx\_value = (ctx\_value \* 10) + (\*(str++) - '0');
++ digit = (\*(str++) - '0');
++ if ( (!sign) && ctx\_value <= (LONG\_MAX-digit)/10 ) {
++ ctx\_value = (ctx\_value \* 10) + digit;
++ } else if ( sign && ctx\_value >= (LONG\_MIN+digit)/10) {
++ ctx\_value = (ctx\_value \* 10) - digit;
++ } else {
++ return -1;
++ }
+ } else {
+ return -1;
+ }
+ }
+- if (sign) {
+- ctx\_value = -ctx\_value;
+- if (ctx\_value > 0) { /\* overflow \*/
+- return -1;
+- }
+- } else if (ctx\_value < 0) { /\* overflow \*/
+- return -1;
+- }
+
+ \*ret = ctx\_value;
+ return 1;
+--- php.orig/ext/filter/tests/046.phpt
++++ php/ext/filter/tests/046.phpt
+@@ -4,16 +4,46 @@ Integer overflow
+ php if (!extension\_loaded("filter")) die("skip"); ?
+ --FILE--
+ php
+-$s = sprintf("%d", PHP\_INT\_MAX);
+-var\_dump(is\_long(filter\_var($s, FILTER\_VALIDATE\_INT)));
++$max = sprintf("%d", PHP\_INT\_MAX);
++switch($max) {
++case "2147483647": /\* 32-bit systems \*/
++ $min = "-2147483648";
++ $overflow = "2147483648";
++ $underflow = "-2147483649";
++ break;
++case "9223372036854775807": /\* 64-bit systems \*/
++ $min = "-9223372036854775808";
++ $overflow = "9223372036854775808";
++ $underflow = "-9223372036854775809";
++ break;
++default:
++ die("failed: unknown value for PHP\_MAX\_INT");
++ break;
++}
+
+-$s = sprintf("%.0f", PHP\_INT\_MAX+1);
+-var\_dump(filter\_var($s, FILTER\_VALIDATE\_INT));
++function test\_validation($val, $msg) {
++ $f = filter\_var($val, FILTER\_VALIDATE\_INT);
++ echo "$msg filtered: "; var\_dump($f); // filtered value (or false)
++ echo "$msg is\_long: "; var\_dump(is\_long($f)); // test validation
++ echo "$msg equal: "; var\_dump($val == $f); // test equality of result
++}
+
+-$s = sprintf("%d", -PHP\_INT\_MAX);
+-var\_dump(is\_long(filter\_var($s, FILTER\_VALIDATE\_INT)));
++// PHP\_INT\_MAX
++test\_validation($max, "max");
++test\_validation($overflow, "overflow");
++test\_validation($min, "min");
++test\_validation($underflow, "underflow");
+ ?
+---EXPECT--
+-bool(true)
+-bool(false)
+-bool(true)
++--EXPECTF--
++max filtered: int(%d)
++max is\_long: bool(true)
++max equal: bool(true)
++overflow filtered: bool(false)
++overflow is\_long: bool(false)
++overflow equal: bool(false)
++min filtered: int(-%d)
++min is\_long: bool(true)
++min equal: bool(true)
++underflow filtered: bool(false)
++underflow is\_long: bool(false)
++underflow equal: bool(false)
--- php5-5.3.2.orig/debian/patches/029-php.ini\_paranoid.patch
+++ php5-5.3.2/debian/patches/029-php.ini\_paranoid.patch
@@ -0,0 +1,1512 @@
+Description: php.ini with paranoid settings
+Origin: other
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- /dev/null
++++ pkg-php/php.ini-paranoid
+@@ -0,0 +1,1504 @@
++[PHP]
++
++;;;;;;;;;;;
++; WARNING ;
++;;;;;;;;;;;
++; This file enables many features in the PHP configuration that will
++; break applications that rely on this. Make sure you test applications
++; with this configuration file before enabling it on production.
++
++;;;;;;;;;;;;;;;;;;;
++; About php.ini ;
++;;;;;;;;;;;;;;;;;;;
++; This file controls many aspects of PHP's behavior. In order for PHP to
++; read it, it must be named 'php.ini'. PHP looks for it in the current
++; working directory, in the path designated by the environment variable
++; PHPRC, and in the path that was defined in compile time (in that order).
++; Under Windows, the compile-time path is the Windows directory. The
++; path in which the php.ini file is looked for can be overridden using
++; the -c argument in command line mode.
++;
++; The syntax of the file is extremely simple. Whitespace and Lines
++; beginning with a semicolon are silently ignored (as you probably guessed).
++; Section headers (e.g. [Foo]) are also silently ignored, even though
++; they might mean something in the future.
++;
++; Directives are specified using the following syntax:
++; directive = value
++; Directive names are \*case sensitive\* - foo=bar is different from FOO=bar.
++;
++; The value can be a string, a number, a PHP constant (e.g. E\_ALL or M\_PI), one
++; of the INI constants (On, Off, True, False, Yes, No and None) or an expression
++; (e.g. E\_ALL & ~E\_NOTICE), or a quoted string ("foo").
++;
++; Expressions in the INI file are limited to bitwise operators and parentheses:
++; | bitwise OR
++; & bitwise AND
++; ~ bitwise NOT
++; ! boolean NOT
++;
++; Boolean flags can be turned on using the values 1, On, True or Yes.
++; They can be turned off using the values 0, Off, False or No.
++;
++; An empty string can be denoted by simply not writing anything after the equal
++; sign, or by using the None keyword:
++;
++; foo = ; sets foo to an empty string
++; foo = none ; sets foo to an empty string
++; foo = "none" ; sets foo to the string 'none'
++;
++; If you use constants in your value, and these constants belong to a
++; dynamically loaded extension (either a PHP extension or a Zend extension),
++; you may only use these constants \*after\* the line that loads the extension.
++;
++;
++;;;;;;;;;;;;;;;;;;;
++; About this file ;
++;;;;;;;;;;;;;;;;;;;
++;
++; This is the paranoid, PHP version of the php.ini-dist file. It
++; sets some non standard settings, that make PHP more efficient, more secure
++; in a very paranoid way. Note that these security settings will make some
++; applications not work properly.
++;
++; The price is that with these settings, PHP may be incompatible with some
++; applications, and sometimes, more difficult to develop with. Using this
++; file is recommended for production sites which want a high degree of
++; security. As all of the changes from the standard settings are thoroughly
++; documented, you can go over each one,
++; and decide whether you want to use it or not.
++;
++; For general information about the php.ini file, please consult the
++; php.ini-dist file, included in your PHP distribution.
++;
++; For further information see
++; http://www.php.net/features.safe-mode
++; http://www.phpsecure.info/
++;
++; This file is different from the php.ini-dist file in the fact that it features
++; different values for several directives, in order to improve performance, while
++; possibly breaking compatibility with the standard out-of-the-box behavior of
++; PHP 3. Please make sure you read what's different, and modify your scripts
++; accordingly, if you decide to use this file instead.
++;
++; Notice that the paranoid configuration file might not be fully up-to-date
++; with the latest variables available so the diff will catch both the changes
++; to the default variable values as well as the variables that are missing in
++; the paranoid configuration file)
++;
++; This version was generated using the version 5.2.4-2 as a basis.
++;
++; Debian users can find the differences between both configurations might
++; be found by running:
++;
++; $ diff -u /usr/share/doc/php5-common/examples/php.ini-dist \
++; /usr/share/doc/php5-common/examples/php.ini-paranoid |less
++;
++;
++; This is a (not complete) list of some of the changes introduced in this file:
++;
++; - safe\_mode = On [Security, Performance loss]
++; Do UID checks when opening files. Enabling safe\_mode also enables
++; other functions related to this mode. For more information read:
++; http://www.php.net/features.safe-mode
++;
++; However, this feature by itself cannot be relied on to protect all applications.
++; It is worthwhile reading also:
++; http://ilia.ws/archives/18\_PHPs\_safe\_mode\_or\_how\_not\_to\_implement\_security.html
++; Bottomline: Do not trust that safe\_mode will drive all your security vulnerabilities
++; away.
++;
++; - safe\_mode\_protected\_env\_vars = LD\_LIBRARY\_PATH, PATH [Security]
++; Environment variables that users will not be able to modify through
++; putenv(). PATH is added so that scripts cannot overwrite it
++;
++; - open\_basedir = /var/www/:/usr/lib/php4/ [Security, Performance loss]
++; Limits the files that PHP can access to the directories specified.
++; This includes the webroot and the usual location of PHP libraries
++; (e.g. PEAR). Since all file locations are checked against this list
++; before any access is allowed, this impacts in the performance of all
++; file operations.
++;
++; - disable\_functions = dl, phpinfo, system, .... [Security]
++; Some functions can be used by attackers and can be malversed by
++; applications, the list (not complete) of functions disabled includes
++; functions which might have a severe impact to the system if wrongly used
++; in scripts or subverted remotely by attackers.
++;
++; - expose\_php = Off [?Security?]
++; Not exposing that PHP is used in the site (nor its version) can affect
++; how some dumb worms attempt to attack the site. Many might
++; not check this and attempt to compromise the server nevertheless,
++; however. This setting is just 'security by obscurity' so no real
++; security at all (save vs. the dumbest attackers)
++;
++; - error\_log = syslog [Security, Performance log]
++; All errors are reported to syslog so that the errors can be easily
++; sent outsite the site to a syslog server. This prevents an intruder
++; from tampering with them in an attempt to hide his tracks since the
++; logs are stored in a different location. It also helps in forensic
++; investigation or when using automatic tools to produce reports or
++; generate alarms based on the syslog information.
++;
++; - error\_reporting = E\_ALL [Code Cleanliness, Security(?)]
++; By default, PHP surpresses errors of type E\_NOTICE. These error messages
++; are emitted for non-critical errors, but that could be a symptom of a bigger
++; problem. Most notably, this will cause error messages about the use
++; of uninitialized variables to be displayed.
++;
++; - display\_errors = Off [Security]
++; With this directive set to off, errors that occur during the execution of
++; scripts will no longer be displayed as a part of the script output, and thus,
++; will no longer be exposed to remote users. With some errors, the error message
++; content may expose information about your script, web server, or database
++; server that may be exploitable for hacking. Production sites should have this
++; directive set to off.
++; - log\_errors = On [Security]
++; This directive complements the above one. Any errors that occur during the
++; execution of your script will be logged (typically, to your server's error log,
++; but can be configured in several ways). Along with setting display\_errors to off,
++; this setup gives you the ability to fully understand what may have gone wrong,
++; without exposing any sensitive information to remote users.
++; - output\_buffering = 4096 [Performance]
++; Set a 4KB output buffer. Enabling output buffering typically results in less
++; writes, and sometimes less packets sent on the wire, which can often lead to
++; better performance. The gain this directive actually yields greatly depends
++; on which Web server you're working with, and what kind of scripts you're using.
++; - register\_globals = Off [Security, Performance]
++; Global variables are no longer registered for input data (POST, GET, cookies,
++; environment and other server variables). Instead of using $foo, you must use
++; you can use $\_REQUEST["foo"] (includes any variable that arrives through the
++; request, namely, POST, GET and cookie variables), or use one of the specific
++; $\_GET["foo"], $\_POST["foo"], $\_COOKIE["foo"] or $\_FILES["foo"], depending
++; on where the input originates. Also, you can look at the
++; import\_request\_variables() function.
++; Note that register\_globals is deprecated in PHP 6.0, because it often
++; leads to security bugs.
++; Read http://php.net/manual/en/security.registerglobals.php for further
++; information.
++; Also notice that applications should not rely on this feature being turned Off
++; to remain secure.
++; - register\_long\_arrays = Off [Performance]
++; Disables registration of HTTP\_GET\_VARS
++; - register\_argc\_argv = Off [Performance]
++; Disables registration of the somewhat redundant $argv and $argc global
++; variables.
++; - include\_path = "/usr/share/php" [Security]
++; Only files under /usr can be included, this prevents applications from
++; including files from the same directory they are running in.
++; - magic\_quotes\_gpc = On [Security]
++; Input data is escaped with slashes so that applications that do
++; not use addslashes() are not so easily subjected to SQL injection
++; when talking to SQL databases.
++; This features is deprecated in PHP 6.0, applications should be fixed to
++; prevent SQL injection attacks through input data and not rely on this feature.
++; - magic\_quotes\_runtime = On [Security]
++; Quotes in data returned from functions that access external data sources (such as
++; databases) are escapted with a backslash.
++; This features is deprecated in PHP 6.0, applications should be fixed to
++; prevent SQL injection attacks through input data and not rely on this feature.
++;
++; - variables\_order = "GPCS" [Performance]
++; The environment variables are not hashed into the $HTTP\_ENV\_VARS[]. To access
++; environment variables, you can use getenv() instead.
++; - allow\_call\_time\_pass\_reference = Off [Code cleanliness]
++; It's not possible to decide to force a variable to be passed by reference
++; when calling a function. The PHP 4 style to do this is by making the
++; function require the relevant argument by reference.
++;
++; - enable\_dl = Off [Security]
++; The dl() function is not needed in most environments and does introduce
++; a number of security issues.
++; - file\_uploads = Off [Security]
++; File uploads should not be allowed to the server.
++; - allow\_url\_fopen = Off [Security]
++; File calls should not transparently retrieve files from the network
++; since this could be subverted by attackers in poorly coded scripts
++; by forcing them to download (and execute) malicious remote content
++; from compromised hosts. This behaviour has been observed in automatic
++; worms/tools that use it to scan and propagate through badly written
++; applications (in conjuntion with other unsafe features)
++; http://myhost/myapplication.php?include=http://roguesever/rogueapp.php
++;
++; - session.save\_path = /var/lib/php5 [Security]
++; This is defined to a non-world readable directory so users cannot
++; hihack sessions of other users by getting a list of the files.
++;
++; Notice that on on shared servers on a per application basis, otherwise
++; other users would be able to get access to other applications' data by
++; setting a proper session id in a different application. If session paths
++; are not shared sessions of one application will be invalid on another.
++; For more information see:
++; http://php.net/manual/en/ref.session.php#ini.session.save-path
++; and
++; http://php.net/manual/en/function.session-save-path.php
++; - session.cookie\_secure = 1 [Security]
++; Cookies will only be sent through secure (SSL) connections.
++; - session.use\_only\_cookies = 1 [Security]
++; Session ids are not allowed in URLs which make it more difficult for
++; cross site scripting (XSS) attacks to be succesfull and also has the
++; advantaged that session ids will not be stored in the server's logs making
++; them vulnerable to reuse by people with access to the server logs.
++; - session.cookie\_httponly = 1 [Security]
++; Cookies can only be set through the HTTP protocol, JavaScript can not
++; modify them, making applications less vulnerable to XSS attacks. This is
++; not supported, however, by all browsers.
++; - session.hash\_function = 1 [Security, Performance loss]
++; Use SHA-1 instead of MD5 which is not (yet) broken but there are some known
++; attacks. Slight performance loss as it takes more time to compute.
++;
++;
++; This file is maintained by Javier Fernandez-Sanguino
++; please forward him any suggestions or changes you believe might be appropiate
++
++
++;;;;;;;;;;;;;;;;;;;;
++; Language Options ;
++;;;;;;;;;;;;;;;;;;;;
++
++; Enable the PHP scripting language engine under Apache.
++engine = On
++
++; Enable compatibility mode with Zend Engine 1 (PHP 4.x)
++zend.ze1\_compatibility\_mode = Off
++
++; Allow the  tag. Otherwise, only <?php and <script tags are recognized.
++; NOTE: Using short tags should be avoided when developing applications or
++; libraries that are meant for redistribution, or deployment on PHP
++; servers which are not under your control, because short tags may not
++; be supported on the target server. For portable, redistributable code,
++; be sure not to use short tags.
++short\_open\_tag = On
++
++; Allow ASP-style <% %> tags.
++asp\_tags = Off
++
++; The number of significant digits displayed in floating point numbers.
++precision = 12
++
++; Enforce year 2000 compliance (will cause problems with non-compliant browsers)
++y2k\_compliance = On
++
++; Output buffering allows you to send header lines (including cookies) even
++; after you send body content, at the price of slowing PHP's output layer a
++; bit. You can enable output buffering during runtime by calling the output
++; buffering functions. You can also enable output buffering for all files by
++; setting this directive to On. If you wish to limit the size of the buffer
++; to a certain size - you can use a maximum number of bytes instead of 'On', as
++; a value for this directive (e.g., output\_buffering=4096).
++output\_buffering = 4096
++
++; You can redirect all of the output of your scripts to a function. For
++; example, if you set output\_handler to "mb\_output\_handler", character
++; encoding will be transparently converted to the specified encoding.
++; Setting any output handler automatically turns on output buffering.
++; Note: People who wrote portable scripts should not depend on this ini
++; directive. Instead, explicitly set the output handler using ob\_start().
++; Using this ini directive may cause problems unless you know what script
++; is doing.
++; Note: You cannot use both "mb\_output\_handler" with "ob\_iconv\_handler"
++; and you cannot use both "ob\_gzhandler" and "zlib.output\_compression".
++; Note: output\_handler must be empty if this is set 'On' !!!!
++; Instead you must use zlib.output\_handler.
++;output\_handler =
++
++; Transparent output compression using the zlib library
++; Valid values for this option are 'off', 'on', or a specific buffer size
++; to be used for compression (default is 4KB)
++; Note: Resulting chunk size may vary due to nature of compression. PHP
++; outputs chunks that are few hundreds bytes each as a result of
++; compression. If you prefer a larger chunk size for better
++; performance, enable output\_buffering in addition.
++; Note: You need to use zlib.output\_handler instead of the standard
++; output\_handler, or otherwise the output will be corrupted.
++zlib.output\_compression = Off
++
++; You cannot specify additional output handlers if zlib.output\_compression
++; is activated here. This setting does the same as output\_handler but in
++; a different order.
++;zlib.output\_handler =
++
++; Implicit flush tells PHP to tell the output layer to flush itself
++; automatically after every output block. This is equivalent to calling the
++; PHP function flush() after each and every call to print() or echo() and each
++; and every HTML block. Turning this option on has serious performance
++; implications and is generally recommended for debugging purposes only.
++implicit\_flush = Off
++
++; The unserialize callback function will be called (with the undefined class'
++; name as parameter), if the unserializer finds an undefined class
++; which should be instantiated.
++; A warning appears if the specified function is not defined, or if the
++; function doesn't include/implement the missing class.
++; So only set this entry, if you really want to implement such a
++; callback-function.
++unserialize\_callback\_func=
++
++; When floats & doubles are serialized store serialize\_precision significant
++; digits after the floating point. The default value ensures that when floats
++; are decoded with unserialize, the data will remain the same.
++serialize\_precision = 100
++
++; Whether to enable the ability to force arguments to be passed by reference
++; at function call time. This method is deprecated and is likely to be
++; unsupported in future versions of PHP/Zend. The encouraged method of
++; specifying which arguments should be passed by reference is in the function
++; declaration. You're encouraged to try and turn this option Off and make
++; sure your scripts work properly with it in order to ensure they will work
++; with future versions of the language (you will receive a warning each time
++; you use this feature, and the argument will be passed by value instead of by
++; reference).
++allow\_call\_time\_pass\_reference = Off
++
++;
++; Safe Mode
++;
++; Notice that with this mode on PHP will not create new files in
++; directories which have different owner than the owner of the script. This
++; typically applies to /tmp, so contrary to Unix intuition, you will not be able
++; to create new files there (even if the /tmp rights are set correctly).
++;
++; NOTE: this is considered a "broken" security measure.
++; Applications relying on this feature will not recieve full
++; support by the security team. For more information please
++; see /usr/share/doc/php5-common/README.Debian.security
++;
++safe\_mode = On
++
++; By default, Safe Mode does a UID compare check when
++; opening files. If you want to relax this to a GID compare,
++; then turn on safe\_mode\_gid.
++safe\_mode\_gid = Off
++
++; When safe\_mode is on, UID/GID checks are bypassed when
++; including files from this directory and its subdirectories.
++; (directory must also be in include\_path or full path must
++; be used when including)
++safe\_mode\_include\_dir =
++
++; When safe\_mode is on, only executables located in the safe\_mode\_exec\_dir
++; will be allowed to be executed via the exec family of functions.
++;
++; Note: This should be customised per site (if exec is permitted)
++safe\_mode\_exec\_dir =
++
++; Setting certain environment variables may be a potential security breach.
++; This directive contains a comma-delimited list of prefixes. In Safe Mode,
++; the user may only alter environment variables whose names begin with the
++; prefixes supplied here. By default, users will only be able to set
++; environment variables that begin with PHP\_ (e.g. PHP\_FOO=BAR).
++;
++; Note: If this directive is empty, PHP will let the user modify ANY
++; environment variable!
++safe\_mode\_allowed\_env\_vars = PHP\_
++
++; This directive contains a comma-delimited list of environment variables that
++; the end user won't be able to change using putenv(). These variables will be
++; protected even if safe\_mode\_allowed\_env\_vars is set to allow to change them.
++safe\_mode\_protected\_env\_vars = LD\_LIBRARY\_PATH,PATH
++
++; open\_basedir, if set, limits all file operations to the defined directory
++; and below. This directive makes most sense if used in a per-directory
++; or per-virtualhost web server configuration file. This directive is
++; \*NOT\* affected by whether Safe Mode is turned On or Off.
++;
++; In Debian, the WebRoot is /var/www/ so we limit file operations to it.
++;
++; NOTE: this is considered a "broken" security measure.
++; Applications relying on this feature will not recieve full
++; support by the security team. For more information please
++; see /usr/share/doc/php5-common/README.Debian.security
++open\_basedir = /var/www/:/usr/lib/php4/
++
++; This directive allows you to disable certain functions for security reasons.
++; It receives a comma-delimited list of function names. This directive is
++; \*NOT\* affected by whether Safe Mode is turned On or Off.
++;
++; Notes:
++; - The list of functions disabled here might break some applications
++; however, they are considered dangerous and often subverted by attackers
++; remotely.
++; - 'include' is not in the list, if your applications do not depend on it
++; make sure you add it here too.
++disable\_functions = dl, phpinfo, system, mail, shell\_exec, exec, escapeshellarg, escapeshellcmd, passthru, proc\_close, proc\_open, proc\_get\_status, proc\_nice, proc\_open, proc\_terminate, popen, pclose, chown, disk\_free\_space, disk\_total\_space, diskfreespace, fileinode, max\_execution\_time, set\_time\_limit, highlight\_file, show\_source
++
++; This directive allows you to disable certain classes for security reasons.
++; It receives a comma-delimited list of class names. This directive is
++; \*NOT\* affected by whether Safe Mode is turned On or Off.
++disable\_classes =
++
++; Colors for Syntax Highlighting mode. Anything that's acceptable in
++;  would work.
++;highlight.string = #DD0000
++;highlight.comment = #FF9900
++;highlight.keyword = #007700
++;highlight.bg = #FFFFFF
++;highlight.default = #0000BB
++;highlight.html = #000000
++
++; If enabled, the request will be allowed to complete even if the user aborts
++; the request. Consider enabling it if executing long request, which may end up
++; being interrupted by the user or a browser timing out.
++; ignore\_user\_abort = On
++
++; Determines the size of the realpath cache to be used by PHP. This value should
++; be increased on systems where PHP opens many files to reflect the quantity of
++; the file operations performed.
++; realpath\_cache\_size=16k
++
++; Duration of time, in seconds for which to cache realpath information for a given
++; file or directory. For systems with rarely changing files, consider increasing this
++; value.
++; realpath\_cache\_ttl=120
++
++;
++; Misc
++;
++; Decides whether PHP may expose the fact that it is installed on the server
++; (e.g. by adding its signature to the Web server header). It is no security
++; threat in any way, but it makes it possible to determine whether you use PHP
++; on your server or not.
++expose\_php = Off
++
++
++;;;;;;;;;;;;;;;;;;;
++; Resource Limits ;
++;;;;;;;;;;;;;;;;;;;
++
++max\_execution\_time = 30 ; Maximum execution time of each script, in seconds
++max\_input\_time = 60 ; Maximum amount of time each script may spend parsing request data
++max\_input\_nesting\_level = 64 ; Maximum input variable nesting level
++memory\_limit = 8M ; Maximum amount of memory a script may consume (8MB)
++
++
++;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
++; Error handling and logging ;
++;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
++
++; error\_reporting is a bit-field. Or each number up to get desired error
++; reporting level
++; E\_ALL - All errors and warnings (doesn't include E\_STRICT)
++; E\_ERROR - fatal run-time errors
++; E\_RECOVERABLE\_ERROR - almost fatal run-time errors
++; E\_WARNING - run-time warnings (non-fatal errors)
++; E\_PARSE - compile-time parse errors
++; E\_NOTICE - run-time notices (these are warnings which often result
++; from a bug in your code, but it's possible that it was
++; intentional (e.g., using an uninitialized variable and
++; relying on the fact it's automatically initialized to an
++; empty string)
++; E\_STRICT - run-time notices, enable to have PHP suggest changes
++; to your code which will ensure the best interoperability
++; and forward compatibility of your code
++; E\_CORE\_ERROR - fatal errors that occur during PHP's initial startup
++; E\_CORE\_WARNING - warnings (non-fatal errors) that occur during PHP's
++; initial startup
++; E\_COMPILE\_ERROR - fatal compile-time errors
++; E\_COMPILE\_WARNING - compile-time warnings (non-fatal errors)
++; E\_USER\_ERROR - user-generated error message
++; E\_USER\_WARNING - user-generated warning message
++; E\_USER\_NOTICE - user-generated notice message
++;
++; Examples:
++;
++; - Show all errors, except for notices and coding standards warnings
++;
++;error\_reporting = E\_ALL & ~E\_NOTICE
++;
++; - Show all errors, except for notices
++;
++;error\_reporting = E\_ALL & ~E\_NOTICE | E\_STRICT
++;
++; - Show only errors
++;
++;error\_reporting = E\_COMPILE\_ERROR|E\_RECOVERABLE\_ERROR|E\_ERROR|E\_CORE\_ERROR
++;
++; - Show all errors
++;
++error\_reporting = E\_ALL
++
++; Print out errors (as a part of the output). For production web sites,
++; you're strongly encouraged to turn this feature off, and use error logging
++; instead (see below). Keeping display\_errors enabled on a production web site
++; may reveal security information to end users, such as file paths on your Web
++; server, your database schema or other information.
++;
++; possible values for display\_errors:
++;
++; Off - Do not display any errors
++; stderr - Display errors to STDERR (affects only CGI/CLI binaries!)
++; stdout (On) - Display errors to STDOUT
++;
++display\_errors = Off
++
++; Even when display\_errors is on, errors that occur during PHP's startup
++; sequence are not displayed. It's strongly recommended to keep
++; display\_startup\_errors off, except for when debugging.
++display\_startup\_errors = Off
++
++; Log errors into a log file (server-specific log, stderr, or error\_log (below))
++; As stated above, you're strongly advised to use error logging in place of
++; error displaying on production web sites.
++log\_errors = On
++
++; Set maximum length of log\_errors. In error\_log information about the source is
++; added. The default is 1024 and 0 allows to not apply any maximum length at all.
++log\_errors\_max\_len = 1024
++
++; Do not log repeated messages. Repeated errors must occur in same file on same
++; line until ignore\_repeated\_source is set true.
++ignore\_repeated\_errors = Off
++
++; Ignore source of message when ignoring repeated messages. When this setting
++; is On you will not log errors with repeated messages from different files or
++; source lines.
++ignore\_repeated\_source = Off
++
++; If this parameter is set to Off, then memory leaks will not be shown (on
++; stdout or in the log). This has only effect in a debug compile, and if
++; error reporting includes E\_WARNING in the allowed list
++report\_memleaks = On
++
++;report\_zend\_debug = 0
++
++; Store the last error/warning message in $php\_errormsg (boolean).
++track\_errors = Off
++
++; Disable the inclusion of HTML tags in error messages.
++; Note: Never use this feature for production boxes.
++html\_errors = Off
++
++; If html\_errors is set On PHP produces clickable error messages that direct
++; to a page describing the error or function causing the error in detail.
++; You can download a copy of the PHP manual from http://www.php.net/docs.php
++; and change docref\_root to the base URL of your local copy including the
++; leading '/'. You must also specify the file extension being used including
++; the dot.
++; Note: Never use this feature for production boxes.
++;docref\_root = "/phpmanual/"
++;docref\_ext = .html
++
++; String to output before an error message.
++;error\_prepend\_string = ""
++
++; String to output after an error message.
++;error\_append\_string = ""
++
++; Log errors to specified file.
++;error\_log = filename
++
++; Log errors to syslog (Event Log on NT, not valid in Windows 95).
++error\_log = syslog
++
++
++;;;;;;;;;;;;;;;;;
++; Data Handling ;
++;;;;;;;;;;;;;;;;;
++;
++; Note - track\_vars is ALWAYS enabled as of PHP 4.0.3
++
++; The separator used in PHP generated URLs to separate arguments.
++; Default is "&".
++;arg\_separator.output = "&"
++
++; List of separator(s) used by PHP to parse input URLs into variables.
++; Default is "&".
++; NOTE: Every character in this directive is considered as separator!
++;arg\_separator.input = ";&"
++
++; This directive describes the order in which PHP registers GET, POST, Cookie,
++; Environment and Built-in variables (G, P, C, E & S respectively, often
++; referred to as EGPCS or GPC). Registration is done from left to right, newer
++; values override older values.
++variables\_order = "GPCS"
++
++; Whether or not to register the EGPCS variables as global variables. You may
++; want to turn this off if you don't want to clutter your scripts' global scope
++; with user data. This makes most sense when coupled with track\_vars - in which
++; case you can access all of the GPC variables through the $HTTP\_\*\_VARS[],
++; variables.
++;
++; You should do your best to write your scripts so that they do not require
++; register\_globals to be on; Using form variables as globals can easily lead
++; to possible security problems, if the code is not very well thought of.
++
++; NOTE: applications relying on this feature will not recieve full
++; support by the security team. For more information please
++; see /usr/share/doc/php5-common/README.Debian.security
++;
++register\_globals = Off
++
++; Whether or not to register the old-style input arrays, HTTP\_GET\_VARS
++; and friends. If you're not using them, it's recommended to turn them off,
++; for performance reasons.
++register\_long\_arrays = Off
++
++; This directive tells PHP whether to declare the argv&argc variables (that
++; would contain the GET information). If you don't use these variables, you
++; should turn it off for increased performance.
++register\_argc\_argv = Off
++
++; When enabled, the SERVER and ENV variables are created when they're first
++; used (Just In Time) instead of when the script starts. If these variables
++; are not used within a script, having this directive on will result in a
++; performance gain. The PHP directives register\_globals, register\_long\_arrays,
++; and register\_argc\_argv must be disabled for this directive to have any affect.
++auto\_globals\_jit = On
++
++; Maximum size of POST data that PHP will accept.
++post\_max\_size = 8M
++
++; Magic quotes
++;
++
++; Magic quotes for incoming GET/POST/Cookie data.
++; Note: This feature is deprecated in PHP 6.0. Applications should not rely
++; on this feature to prevent security attacks.
++magic\_quotes\_gpc = On
++
++; Magic quotes for runtime-generated data, e.g. data from SQL, from exec(), etc.
++; Note: This feature is deprecated in PHP 6.0. Applications should not rely
++; on this feature to prevent security attacks.
++magic\_quotes\_runtime = On
++
++; Use Sybase-style magic quotes (escape ' with '' instead of \').
++magic\_quotes\_sybase = Off
++
++; Automatically add files before or after any PHP document.
++auto\_prepend\_file =
++auto\_append\_file =
++
++; As of 4.0b4, PHP always outputs a character encoding by default in
++; the Content-type: header. To disable sending of the charset, simply
++; set it to be empty.
++;
++; PHP's built-in default is text/html
++default\_mimetype = "text/html"
++;default\_charset = "iso-8859-1"
++
++; Always populate the $HTTP\_RAW\_POST\_DATA variable.
++;always\_populate\_raw\_post\_data = On
++
++
++;;;;;;;;;;;;;;;;;;;;;;;;;
++; Paths and Directories ;
++;;;;;;;;;;;;;;;;;;;;;;;;;
++
++; UNIX: "/path1:/path2"
++; Note (paranoid):
++; - '.' (the default) is not allowed here, applications that rely on it
++; need to be modified
++; - /usr is allowed, but files there should be protected against being
++; overwritten by mounting the filesystem read-only and should be
++; monitored with a system integrity check tool.
++include\_path = "/usr/share/php"
++
++; Windows: "\path1;\path2"
++;include\_path = ".;c:\php\includes"
++
++; The root of the PHP pages, used only if nonempty.
++; if PHP was not compiled with FORCE\_REDIRECT, you SHOULD set doc\_root
++; if you are running php as a CGI under any web server (other than IIS)
++; see documentation for security issues. The alternate is to use the
++; cgi.force\_redirect configuration below
++doc\_root =
++
++; The directory under which PHP opens the script using /~username used only
++; if nonempty.
++user\_dir =
++
++; Directory in which the loadable extensions (modules) reside.
++; extension\_dir = "./"
++
++; Whether or not to enable the dl() function. The dl() function does NOT work
++; properly in multithreaded servers, such as IIS or Zeus, and is automatically
++; disabled on them.
++;
++; NOTE: this is a potential security hole and is disabled by default in debian
++enable\_dl = Off
++
++; cgi.force\_redirect is necessary to provide security running PHP as a CGI under
++; most web servers. Left undefined, PHP turns this on by default. You can
++; turn it off here AT YOUR OWN RISK
++; \*\*You CAN safely turn this off for IIS, in fact, you MUST.\*\*
++; cgi.force\_redirect = 1
++
++; if cgi.nph is enabled it will force cgi to always sent Status: 200 with
++; every request.
++; cgi.nph = 1
++
++; if cgi.force\_redirect is turned on, and you are not running under Apache or Netscape
++; (iPlanet) web servers, you MAY need to set an environment variable name that PHP
++; will look for to know it is OK to continue execution. Setting this variable MAY
++; cause security issues, KNOW WHAT YOU ARE DOING FIRST.
++; cgi.redirect\_status\_env = ;
++
++; cgi.fix\_pathinfo provides \*real\* PATH\_INFO/PATH\_TRANSLATED support for CGI. PHP's
++; previous behaviour was to set PATH\_TRANSLATED to SCRIPT\_FILENAME, and to not grok
++; what PATH\_INFO is. For more information on PATH\_INFO, see the cgi specs. Setting
++; this to 1 will cause PHP CGI to fix it's paths to conform to the spec. A setting
++; of zero causes PHP to behave as before. Default is 1. You should fix your scripts
++; to use SCRIPT\_FILENAME rather than PATH\_TRANSLATED.
++cgi.fix\_pathinfo=1
++
++; FastCGI under IIS (on WINNT based OS) supports the ability to impersonate
++; security tokens of the calling client. This allows IIS to define the
++; security context that the request runs under. mod\_fastcgi under Apache
++; does not currently support this feature (03/17/2002)
++; Set to 1 if running under IIS. Default is zero.
++; fastcgi.impersonate = 1;
++
++; Disable logging through FastCGI connection
++; fastcgi.logging = 0
++
++; cgi.rfc2616\_headers configuration option tells PHP what type of headers to
++; use when sending HTTP response code. If it's set 0 PHP sends Status: header that
++; is supported by Apache. When this option is set to 1 PHP will send
++; RFC2616 compliant header.
++; Default is zero.
++;cgi.rfc2616\_headers = 0
++
++
++;;;;;;;;;;;;;;;;
++; File Uploads ;
++;;;;;;;;;;;;;;;;
++
++; Whether to allow HTTP file uploads.
++file\_uploads = Off
++
++; Temporary directory for HTTP uploaded files (will use system default if not
++; specified).
++;
++; Note: If enabled above you have to create this directory and set appropiate
++; permissions. The default (/tmp) is insecure since other users might be able
++; to access upload files or make symlink tricks.
++upload\_tmp\_dir = /var/lib/php5/uploads
++
++; Maximum allowed size for uploaded files.
++upload\_max\_filesize = 2M
++
++
++;;;;;;;;;;;;;;;;;;
++; Fopen wrappers ;
++;;;;;;;;;;;;;;;;;;
++
++; Whether to allow the treatment of URLs (like http:// or ftp://) as files.
++;
++; This is turned off to avoid variable redefinition by remote attacker
++; that attempts to have the server download (and execute) a remote file
++; from a compromised host. This behaviour has been observed in automatic
++; scanning against badly written applications:
++; http://myhost/myapplication.php?include=http://roguesever/rogueapp.php
++allow\_url\_fopen = Off
++
++; Whether to allow include/require to open URLs (like http:// or ftp://) as files.
++allow\_url\_include = Off
++
++; Define the anonymous ftp password (your email address)
++;from="john@doe.com"
++
++; Define the User-Agent string
++; user\_agent="PHP"
++
++; Default timeout for socket based streams (seconds)
++default\_socket\_timeout = 60
++
++; If your scripts have to deal with files from Macintosh systems,
++; or you are running on a Mac and need to deal with files from
++; unix or win32 systems, setting this flag will cause PHP to
++; automatically detect the EOL character in those files so that
++; fgets() and file() will work regardless of the source of the file.
++; auto\_detect\_line\_endings = Off
++
++
++;;;;;;;;;;;;;;;;;;;;;;
++; Dynamic Extensions ;
++;;;;;;;;;;;;;;;;;;;;;;
++;
++; If you wish to have an extension loaded automatically, use the following
++; syntax:
++;
++; extension=modulename.extension
++;
++; For example, on Windows:
++;
++; extension=msql.dll
++;
++; ... or under UNIX:
++;
++; extension=msql.so
++;
++; Note that it should be the name of the module only; no directory information
++; needs to go here. Specify the location of the extension with the
++; extension\_dir directive above.
++
++
++;;;;;;;;;;;;;;;;;;;
++; Module Settings ;
++;;;;;;;;;;;;;;;;;;;
++
++[Date]
++; Defines the default timezone used by the date functions
++;date.timezone =
++
++;date.default\_latitude = 31.7667
++;date.default\_longitude = 35.2333
++
++;date.sunrise\_zenith = 90.583333
++;date.sunset\_zenith = 90.583333
++
++[filter]
++;filter.default = unsafe\_raw
++;filter.default\_flags =
++
++[iconv]
++;iconv.input\_encoding = ISO-8859-1
++;iconv.internal\_encoding = ISO-8859-1
++;iconv.output\_encoding = ISO-8859-1
++
++[sqlite]
++;sqlite.assoc\_case = 0
++
++[xmlrpc]
++;xmlrpc\_error\_number = 0
++;xmlrpc\_errors = 0
++
++[Pcre]
++;PCRE library backtracking limit.
++;pcre.backtrack\_limit=100000
++
++;PCRE library recursion limit.
++;Please note that if you set this value to a high number you may consume all
++;the available process stack and eventually crash PHP (due to reaching the
++;stack size limit imposed by the Operating System).
++;pcre.recursion\_limit=100000
++
++[Syslog]
++; Whether or not to define the various syslog variables (e.g. $LOG\_PID,
++; $LOG\_CRON, etc.). Turning it off is a good idea performance-wise. In
++; runtime, you can define these variables by calling define\_syslog\_variables().
++define\_syslog\_variables = Off
++
++[mail function]
++; For Win32 only.
++SMTP = localhost
++smtp\_port = 25
++
++; For Win32 only.
++;sendmail\_from = me@example.com
++
++; For Unix only. You may supply arguments as well (default: "sendmail -t -i").
++;sendmail\_path =
++
++; Force the addition of the specified parameters to be passed as extra parameters
++; to the sendmail binary. These parameters will always replace the value of
++; the 5th parameter to mail(), even in safe mode.
++;mail.force\_extra\_parameters =
++
++[SQL]
++; This configuration directive is unrelated to safe\_mode.
++; If enabled, connections to databases (like mysql\_connect() or mysql\_pconnect())
++; will ignore the arguments provided (which include username and password) and
++; will attempt to connect always using default values. These default values
++; are typically host=localhost, user=the script owner,password=empty password.
++;
++; Note (paranoid): This is disabled as it is not actually a security measure, unless
++; you want script to not have users and passwords hardcoded in them.
++sql.safe\_mode = Off
++
++[ODBC]
++;odbc.default\_db = Not yet implemented
++;odbc.default\_user = Not yet implemented
++;odbc.default\_pw = Not yet implemented
++
++; Allow or prevent persistent links.
++odbc.allow\_persistent = On
++
++; Check that a connection is still valid before reuse.
++odbc.check\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++odbc.max\_persistent = -1
++
++; Maximum number of links (persistent + non-persistent). -1 means no limit.
++odbc.max\_links = -1
++
++; Handling of LONG fields. Returns number of bytes to variables. 0 means
++; passthru.
++odbc.defaultlrl = 4096
++
++; Handling of binary data. 0 means passthru, 1 return as is, 2 convert to char.
++; See the documentation on odbc\_binmode and odbc\_longreadlen for an explanation
++; of uodbc.defaultlrl and uodbc.defaultbinmode
++odbc.defaultbinmode = 1
++
++[MySQL]
++; Allow or prevent persistent links.
++mysql.allow\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++mysql.max\_persistent = -1
++
++; Maximum number of links (persistent + non-persistent). -1 means no limit.
++mysql.max\_links = -1
++
++; Default port number for mysql\_connect(). If unset, mysql\_connect() will use
++; the $MYSQL\_TCP\_PORT or the mysql-tcp entry in /etc/services or the
++; compile-time value defined MYSQL\_PORT (in that order). Win32 will only look
++; at MYSQL\_PORT.
++mysql.default\_port =
++
++; Default socket name for local MySQL connects. If empty, uses the built-in
++; MySQL defaults.
++mysql.default\_socket =
++
++; Default host for mysql\_connect() (doesn't apply in safe mode).
++mysql.default\_host =
++
++; Default user for mysql\_connect() (doesn't apply in safe mode).
++mysql.default\_user =
++
++; Default password for mysql\_connect() (doesn't apply in safe mode).
++; Note that this is generally a \*bad\* idea to store passwords in this file.
++; \*Any\* user with PHP access can run 'echo get\_cfg\_var("mysql.default\_password")
++; and reveal this password! And of course, any users with read access to this
++; file will be able to reveal the password as well.
++mysql.default\_password =
++
++; Maximum time (in seconds) for connect timeout. -1 means no limit
++mysql.connect\_timeout = 60
++
++; Trace mode. When trace\_mode is active (=On), warnings for table/index scans and
++; SQL-Errors will be displayed.
++mysql.trace\_mode = Off
++
++[MySQLi]
++
++; Maximum number of links. -1 means no limit.
++mysqli.max\_links = -1
++
++; Default port number for mysqli\_connect(). If unset, mysqli\_connect() will use
++; the $MYSQL\_TCP\_PORT or the mysql-tcp entry in /etc/services or the
++; compile-time value defined MYSQL\_PORT (in that order). Win32 will only look
++; at MYSQL\_PORT.
++mysqli.default\_port = 3306
++
++; Default socket name for local MySQL connects. If empty, uses the built-in
++; MySQL defaults.
++mysqli.default\_socket =
++
++; Default host for mysql\_connect() (doesn't apply in safe mode).
++mysqli.default\_host =
++
++; Default user for mysql\_connect() (doesn't apply in safe mode).
++mysqli.default\_user =
++
++; Default password for mysqli\_connect() (doesn't apply in safe mode).
++; Note that this is generally a \*bad\* idea to store passwords in this file.
++; \*Any\* user with PHP access can run 'echo get\_cfg\_var("mysqli.default\_pw")
++; and reveal this password! And of course, any users with read access to this
++; file will be able to reveal the password as well.
++mysqli.default\_pw =
++
++; Allow or prevent reconnect
++mysqli.reconnect = Off
++
++[mSQL]
++; Allow or prevent persistent links.
++msql.allow\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++msql.max\_persistent = -1
++
++; Maximum number of links (persistent+non persistent). -1 means no limit.
++msql.max\_links = -1
++
++[OCI8]
++; enables privileged connections using external credentials (OCI\_SYSOPER, OCI\_SYSDBA)
++;oci8.privileged\_connect = Off
++
++; Connection: The maximum number of persistent OCI8 connections per
++; process. Using -1 means no limit.
++;oci8.max\_persistent = -1
++
++; Connection: The maximum number of seconds a process is allowed to
++; maintain an idle persistent connection. Using -1 means idle
++; persistent connections will be maintained forever.
++;oci8.persistent\_timeout = -1
++
++; Connection: The number of seconds that must pass before issuing a
++; ping during oci\_pconnect() to check the connection validity. When
++; set to 0, each oci\_pconnect() will cause a ping. Using -1 disables
++; pings completely.
++;oci8.ping\_interval = 60
++
++; Tuning: This option enables statement caching, and specifies how
++; many statements to cache. Using 0 disables statement caching.
++;oci8.statement\_cache\_size = 20
++
++; Tuning: Enables statement prefetching and sets the default number of
++; rows that will be fetched automatically after statement execution.
++;oci8.default\_prefetch = 10
++
++; Compatibility. Using On means oci\_close() will not close
++; oci\_connect() and oci\_new\_connect() connections.
++;oci8.old\_oci\_close\_semantics = Off
++
++[PostgresSQL]
++; Allow or prevent persistent links.
++pgsql.allow\_persistent = On
++
++; Detect broken persistent links always with pg\_pconnect().
++; Auto reset feature requires a little overheads.
++pgsql.auto\_reset\_persistent = Off
++
++; Maximum number of persistent links. -1 means no limit.
++pgsql.max\_persistent = -1
++
++; Maximum number of links (persistent+non persistent). -1 means no limit.
++pgsql.max\_links = -1
++
++; Ignore PostgreSQL backends Notice message or not.
++; Notice message logging require a little overheads.
++pgsql.ignore\_notice = 0
++
++; Log PostgreSQL backends Noitce message or not.
++; Unless pgsql.ignore\_notice=0, module cannot log notice message.
++pgsql.log\_notice = 0
++
++[Sybase]
++; Allow or prevent persistent links.
++sybase.allow\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++sybase.max\_persistent = -1
++
++; Maximum number of links (persistent + non-persistent). -1 means no limit.
++sybase.max\_links = -1
++
++;sybase.interface\_file = "/usr/sybase/interfaces"
++
++; Minimum error severity to display.
++sybase.min\_error\_severity = 10
++
++; Minimum message severity to display.
++sybase.min\_message\_severity = 10
++
++; Compatibility mode with old versions of PHP 3.0.
++; If on, this will cause PHP to automatically assign types to results according
++; to their Sybase type, instead of treating them all as strings. This
++; compatibility mode will probably not stay around forever, so try applying
++; whatever necessary changes to your code, and turn it off.
++sybase.compatability\_mode = Off
++
++[Sybase-CT]
++; Allow or prevent persistent links.
++sybct.allow\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++sybct.max\_persistent = -1
++
++; Maximum number of links (persistent + non-persistent). -1 means no limit.
++sybct.max\_links = -1
++
++; Minimum server message severity to display.
++sybct.min\_server\_severity = 10
++
++; Minimum client message severity to display.
++sybct.min\_client\_severity = 10
++
++[bcmath]
++; Number of decimal digits for all bcmath functions.
++bcmath.scale = 0
++
++[browscap]
++;browscap = extra/browscap.ini
++
++[Informix]
++; Default host for ifx\_connect() (doesn't apply in safe mode).
++ifx.default\_host =
++
++; Default user for ifx\_connect() (doesn't apply in safe mode).
++ifx.default\_user =
++
++; Default password for ifx\_connect() (doesn't apply in safe mode).
++ifx.default\_password =
++
++; Allow or prevent persistent links.
++ifx.allow\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++ifx.max\_persistent = -1
++
++; Maximum number of links (persistent + non-persistent). -1 means no limit.
++ifx.max\_links = -1
++
++; If on, select statements return the contents of a text blob instead of its id.
++ifx.textasvarchar = 0
++
++; If on, select statements return the contents of a byte blob instead of its id.
++ifx.byteasvarchar = 0
++
++; Trailing blanks are stripped from fixed-length char columns. May help the
++; life of Informix SE users.
++ifx.charasvarchar = 0
++
++; If on, the contents of text and byte blobs are dumped to a file instead of
++; keeping them in memory.
++ifx.blobinfile = 0
++
++; NULL's are returned as empty strings, unless this is set to 1. In that case,
++; NULL's are returned as string 'NULL'.
++ifx.nullformat = 0
++
++[Session]
++; Handler used to store/retrieve data.
++session.save\_handler = files
++
++; Argument passed to save\_handler. In the case of files, this is the path
++; where data files are stored. Note: Windows users have to change this
++; variable in order to use PHP's session functions.
++;
++; As of PHP 4.0.1, you can define the path as:
++;
++; session.save\_path = "N;/path"
++;
++; where N is an integer. Instead of storing all the session files in
++; /path, what this will do is use subdirectories N-levels deep, and
++; store the session data in those directories. This is useful if you
++; or your OS have problems with lots of files in one directory, and is
++; a more efficient layout for servers that handle lots of sessions.
++;
++; NOTE 1: PHP will not create this directory structure automatically.
++; You can use the script in the ext/session dir for that purpose.
++; NOTE 2: See the section on garbage collection below if you choose to
++; use subdirectories for session storage
++;
++; The file storage module creates files using mode 600 by default.
++; You can change that by using
++;
++; session.save\_path = "N;MODE;/path"
++;
++; where MODE is the octal representation of the mode. Note that this
++; does not overwrite the process's umask.
++session.save\_path = /var/lib/php5
++
++; Substring to check each HTTP Referer for. If the Referer was sent by the
++; client and the substring was not found, the embedded session id will be marked
++; as invalid. Defaults to the empty string.
++; Note (paranoid): to prevent some XSS attacks should be defined to the server's URI
++; session.referer\_check =
++
++
++; Path to an external resource (file) which will be used as an additional
++; entropy source in the session id creation process.
++; Note (paranoid): /dev/urandom is not fully random but if /dev/random is used
++; the entropy pool could be exhaused by constantly asking for session ids and
++; would compromise other applications relying on randomness
++session.entropy\_file = "/dev/urandom"
++
++; Number of bytes which will be read from the file specified above.
++; Defaults to 0 (disabled).
++session.entropy\_length = 6
++
++; Whether to use cookies.
++session.use\_cookies = 1
++
++; If this option is enabled cookies are only sent through secure (SSL)
++; connections and, consequently, are more difficult to intercept.
++; (disabled by default)
++session.cookie\_secure = 1
++
++; This option enables administrators to make their users invulnerable to
++; attacks which involve passing session ids in URLs; defaults to 1 (since PHP 6.0).
++session.use\_only\_cookies = 1
++
++; Name of the session (used as cookie name).
++session.name = PHPSESSID
++
++; Initialize session on request startup.
++session.auto\_start = 0
++
++; Lifetime in seconds of cookie or, if 0, until browser is restarted.
++session.cookie\_lifetime = 0
++
++; The path for which the cookie is valid.
++; Note (paranoid): Applications should restrict the path where the cookie
++; is valid through use of session\_set\_cookie\_params().
++session.cookie\_path = /
++
++; The domain for which the cookie is valid.
++; Note (paranoid): Make sure you configure this for your site
++session.cookie\_domain =
++
++; Whether or not to add the httpOnly flag to the cookie, which makes it inaccessible to browser scripting languages such as JavaScript.
++session.cookie\_httponly = 1
++
++; Handler used to serialize data. php is the standard serializer of PHP.
++session.serialize\_handler = php
++
++; Define the probability that the 'garbage collection' process is started
++; on every session initialization.
++; The probability is calculated by using gc\_probability/gc\_divisor,
++; e.g. 1/100 means there is a 1% chance that the GC process starts
++; on each request.
++
++; This is disabled in the Debian packages, due to the strict permissions
++; on /var/lib/php5. Instead of setting this here, see the cronjob at
++; /etc/cron.d/php5, which uses the session.gc\_maxlifetime setting below
++;session.gc\_probability = 0
++session.gc\_divisor = 100
++
++; After this number of seconds, stored data will be seen as 'garbage' and
++; cleaned up by the garbage collection process.
++session.gc\_maxlifetime = 1440
++
++; NOTE: If you are using the subdirectory option for storing session files
++; (see session.save\_path above), then garbage collection does \*not\*
++; happen automatically. You will need to do your own garbage
++; collection through a shell script, cron entry, or some other method.
++; For example, the following script would is the equivalent of
++; setting session.gc\_maxlifetime to 1440 (1440 seconds = 24 minutes):
++; cd /path/to/sessions; find -cmin +24 | xargs rm
++
++; PHP 4.2 and less have an undocumented feature/bug that allows you to
++; to initialize a session variable in the global scope, albeit register\_globals
++; is disabled. PHP 4.3 and later will warn you, if this feature is used.
++; You can disable the feature and the warning separately. At this time,
++; the warning is only displayed, if bug\_compat\_42 is enabled.
++
++session.bug\_compat\_42 = 0
++session.bug\_compat\_warn = 1
++
++; Check HTTP Referer to invalidate externally stored URLs containing ids.
++; HTTP\_REFERER has to contain this substring for the session to be
++; considered as valid.
++session.referer\_check =
++
++; How many bytes to read from the file.
++session.entropy\_length = 0
++
++; Specified here to create the session id.
++session.entropy\_file =
++
++;session.entropy\_length = 16
++
++;session.entropy\_file = /dev/urandom
++
++; Set to {nocache,private,public,} to determine HTTP caching aspects
++; or leave this empty to avoid sending anti-caching headers.
++session.cache\_limiter = nocache
++
++; Document expires after n minutes.
++session.cache\_expire = 180
++
++; trans sid support is disabled by default.
++; Use of trans sid may risk your users security.
++; Use this option with caution.
++; - User may send URL contains active session ID
++; to other person via. email/irc/etc.
++; - URL that contains active session ID may be stored
++; in publically accessible computer.
++; - User may access your site with the same session ID
++; always using URL stored in browser's history or bookmarks.
++session.use\_trans\_sid = 0
++
++; Select a hash function
++; 0: MD5 (128 bits)
++; 1: SHA-1 (160 bits)
++; Note (paranoic): Set to SHA-1 since there are known attacks against MD5
++; although the algorithm is not yet broken)
++session.hash\_function = 1
++
++; Define how many bits are stored in each character when converting
++; the binary hash data to something readable.
++;
++; 4 bits: 0-9, a-f
++; 5 bits: 0-9, a-v
++; 6 bits: 0-9, a-z, A-Z, "-", ","
++session.hash\_bits\_per\_character = 4
++
++; The URL rewriter will look for URLs in a defined set of HTML tags.
++; form/fieldset are special; if you include them here, the rewriter will
++; add a hidden  field with the info which is otherwise appended
++; to URLs. If you want XHTML conformity, remove the form entry.
++; Note that all valid entries require a "=", even if no value follows.
++url\_rewriter.tags = "a=href,area=href,frame=src,input=src,form=fakeentry,fieldset="
++
++[MSSQL]
++; Allow or prevent persistent links.
++mssql.allow\_persistent = On
++
++; Maximum number of persistent links. -1 means no limit.
++mssql.max\_persistent = -1
++
++; Maximum number of links (persistent+non persistent). -1 means no limit.
++mssql.max\_links = -1
++
++; Minimum error severity to display.
++mssql.min\_error\_severity = 10
++
++; Minimum message severity to display.
++mssql.min\_message\_severity = 10
++
++; Compatibility mode with old versions of PHP 3.0.
++mssql.compatability\_mode = Off
++
++; Connect timeout
++;mssql.connect\_timeout = 5
++
++; Query timeout
++;mssql.timeout = 60
++
++; Valid range 0 - 2147483647. Default = 4096.
++;mssql.textlimit = 4096
++
++; Valid range 0 - 2147483647. Default = 4096.
++;mssql.textsize = 4096
++
++; Limits the number of records in each batch. 0 = all records in one batch.
++;mssql.batchsize = 0
++
++; Specify how datetime and datetim4 columns are returned
++; On => Returns data converted to SQL server settings
++; Off => Returns values as YYYY-MM-DD hh:mm:ss
++;mssql.datetimeconvert = On
++
++; Use NT authentication when connecting to the server
++mssql.secure\_connection = On
++
++; Specify max number of processes. -1 = library default
++; msdlib defaults to 25
++; FreeTDS defaults to 4096
++;mssql.max\_procs = -1
++
++; Specify client character set.
++; If empty or not set the client charset from freetds.comf is used
++; This is only used when compiled with FreeTDS
++;mssql.charset = "ISO-8859-1"
++
++[Assertion]
++; Assert(expr); active by default.
++;assert.active = On
++
++; Issue a PHP warning for each failed assertion.
++;assert.warning = On
++
++; Don't bail out by default.
++;assert.bail = Off
++
++; User-function to be called if an assertion fails.
++;assert.callback = 0
++
++; Eval the expression with current error\_reporting(). Set to true if you want
++; error\_reporting(0) around the eval().
++;assert.quiet\_eval = 0
++
++[COM]
++; path to a file containing GUIDs, IIDs or filenames of files with TypeLibs
++;com.typelib\_file =
++; allow Distributed-COM calls
++;com.allow\_dcom = true
++; autoregister constants of a components typlib on com\_load()
++;com.autoregister\_typelib = true
++; register constants casesensitive
++;com.autoregister\_casesensitive = false
++; show warnings on duplicate constant registrations
++;com.autoregister\_verbose = true
++
++[mbstring]
++; language for internal character representation.
++;mbstring.language = Japanese
++
++; internal/script encoding.
++; Some encoding cannot work as internal encoding.
++; (e.g. SJIS, BIG5, ISO-2022-\*)
++;mbstring.internal\_encoding = EUC-JP
++
++; http input encoding.
++;mbstring.http\_input = auto
++
++; http output encoding. mb\_output\_handler must be
++; registered as output buffer to function
++;mbstring.http\_output = SJIS
++
++; enable automatic encoding translation according to
++; mbstring.internal\_encoding setting. Input chars are
++; converted to internal encoding by setting this to On.
++; Note: Do \_not\_ use automatic encoding translation for
++; portable libs/applications.
++;mbstring.encoding\_translation = Off
++
++; automatic encoding detection order.
++; auto means
++;mbstring.detect\_order = auto
++
++; substitute\_character used when character cannot be converted
++; one from another
++;mbstring.substitute\_character = none;
++
++; overload(replace) single byte functions by mbstring functions.
++; mail(), ereg(), etc are overloaded by mb\_send\_mail(), mb\_ereg(),
++; etc. Possible values are 0,1,2,4 or combination of them.
++; For example, 7 for overload everything.
++; 0: No overload
++; 1: Overload mail() function
++; 2: Overload str\*() functions
++; 4: Overload ereg\*() functions
++;mbstring.func\_overload = 0
++
++[FrontBase]
++;fbsql.allow\_persistent = On
++;fbsql.autocommit = On
++;fbsql.show\_timestamp\_decimals = Off
++;fbsql.default\_database =
++;fbsql.default\_database\_password =
++;fbsql.default\_host =
++;fbsql.default\_password =
++;fbsql.default\_user = "\_SYSTEM"
++;fbsql.generate\_warnings = Off
++;fbsql.max\_connections = 128
++;fbsql.max\_links = 128
++;fbsql.max\_persistent = -1
++;fbsql.max\_results = 128
++
++[gd]
++; Tell the jpeg decode to libjpeg warnings and try to create
++; a gd image. The warning will then be displayed as notices
++; disabled by default
++;gd.jpeg\_ignore\_warning = 0
++
++[exif]
++; Exif UNICODE user comments are handled as UCS-2BE/UCS-2LE and JIS as JIS.
++; With mbstring support this will automatically be converted into the encoding
++; given by corresponding encode setting. When empty mbstring.internal\_encoding
++; is used. For the decode settings you can distinguish between motorola and
++; intel byte order. A decode setting cannot be empty.
++;exif.encode\_unicode = ISO-8859-15
++;exif.decode\_unicode\_motorola = UCS-2BE
++;exif.decode\_unicode\_intel = UCS-2LE
++;exif.encode\_jis =
++;exif.decode\_jis\_motorola = JIS
++;exif.decode\_jis\_intel = JIS
++
++[Tidy]
++; The path to a default tidy configuration file to use when using tidy
++;tidy.default\_config = /usr/local/lib/php/default.tcfg
++
++; Should tidy clean and repair output automatically?
++; WARNING: Do not use this option if you are generating non-html content
++; such as dynamic images
++tidy.clean\_output = Off
++
++[soap]
++; Enables or disables WSDL caching feature.
++soap.wsdl\_cache\_enabled=1
++; Sets the directory name where SOAP extension will put cache files.
++soap.wsdl\_cache\_dir="/var/lib/php5/soap-cache"
++; (time to live) Sets the number of second while cached file will be used
++; instead of original one.
++soap.wsdl\_cache\_ttl=86400
++
++; Local Variables:
++; tab-width: 4
++; End:
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-4697.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-4697.patch
@@ -0,0 +1,94 @@
+Subject: Fixed bug #52879 (Objects unreferenced in \_\_get, \_\_set, \_\_isset or \_\_unset can be freed too early).
+Author: mail\_ben\_schmidt at yahoo dot com dot au
+Origin: http://svn.php.net/viewvc?view=revision&revision=303913
+Bug: http://bugs.php.net/52879
+
+CVE-2010-4697
+
+Patch is modified from upstream commit to remove edits to the NEWS file,
+to reduce conflicts when applying patches and backported to apply to
+earlier releases of php.
+
+Index: Zend/zend\_object\_handlers.c
+===================================================================
+--- Zend/zend\_object\_handlers.c (revision 303912)
++++ Zend/zend\_object\_handlers.c (revision 303913)
+@@ -347,6 +347,9 @@
+ !guard->in\_get) {
+ /\* have getter - try with it! \*/
+ Z\_ADDREF\_P(object);
++ if (PZVAL\_IS\_REF(object)) {
++ SEPARATE\_ZVAL(&object);
++ }
+ guard->in\_get = 1; /\* prevent circular getting \*/
+ rv = zend\_std\_call\_getter(object, member TSRMLS\_CC);
+ guard->in\_get = 0;
+@@ -445,22 +448,22 @@
+ }
+ }
+ } else {
+- int setter\_done = 0;
+- zend\_guard \*guard;
++ zend\_guard \*guard = NULL;
+
+ if (zobj->ce->\_\_set &&
+ zend\_get\_property\_guard(zobj, property\_info, member, &guard) == SUCCESS &&
+ !guard->in\_set) {
+ Z\_ADDREF\_P(object);
++ if (PZVAL\_IS\_REF(object)) {
++ SEPARATE\_ZVAL(&object);
++ }
+ guard->in\_set = 1; /\* prevent circular setting \*/
+ if (zend\_std\_call\_setter(object, member, value TSRMLS\_CC) != SUCCESS) {
+ /\* for now, just ignore it - \_\_set should take care of warnings, etc. \*/
+ }
+- setter\_done = 1;
+ guard->in\_set = 0;
+ zval\_ptr\_dtor(&object);
+- }
+- if (!setter\_done && property\_info) {
++ } else if (property\_info) {
+ zval \*\*foo;
+
+ /\* if we assign referenced variable, we should separate it \*/
+@@ -643,6 +646,9 @@
+ !guard->in\_unset) {
+ /\* have unseter - try with it! \*/
+ Z\_ADDREF\_P(object);
++ if (PZVAL\_IS\_REF(object)) {
++ SEPARATE\_ZVAL(&object);
++ }
+ guard->in\_unset = 1; /\* prevent circular unsetting \*/
+ zend\_std\_call\_unsetter(object, member TSRMLS\_CC);
+ guard->in\_unset = 0;
+@@ -1169,6 +1175,9 @@
+
+ /\* have issetter - try with it! \*/
+ Z\_ADDREF\_P(object);
++ if (PZVAL\_IS\_REF(object)) {
++ SEPARATE\_ZVAL(&object);
++ }
+ guard->in\_isset = 1; /\* prevent circular getting \*/
+ rv = zend\_std\_call\_issetter(object, member TSRMLS\_CC);
+ if (rv) {
+Index: Zend/tests/bug52879.phpt
+===================================================================
+--- Zend/tests/bug52879.phpt (revision 0)
++++ Zend/tests/bug52879.phpt (revision 303913)
+@@ -0,0 +1,16 @@
++--TEST--
++Bug #52879 (Objects unreferenced in \_\_get, \_\_set, \_\_isset or \_\_unset can be freed too early)
++--FILE--
++php
++class MyClass {
++ public $myRef;
++ public function \_\_set($property,$value) {
++ $this-myRef = $value;
++ }
++}
++$myGlobal=new MyClass($myGlobal);
++$myGlobal->myRef=&$myGlobal;
++$myGlobal->myNonExistentProperty="ok\n";
++echo $myGlobal;
++--EXPECT--
++ok
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1469.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1469.patch
@@ -0,0 +1,123 @@
+Subject: Fixed bug #54092 (Segmentation fault when using HTTP proxy with the FTP wrapper).
+Origin: http://svn.php.net/viewvc?view=revision&revision=308734
+
+#php\_stream->wrapperdata should hold an array zval (like its zval\* type
+#indicates...), it's not a place where the wrapper can drop an arbitrary
+#pointer. For that, .wrapperthis should be used.
+#Also, since the ftp dir wrapper defines its own stream type, it's more
+#appropriate to use .abstract to store the stream instance specific data.
+
+CVE-2011-1469
+
+Patch differs from upstream commit in that it drops the added NEWS file
+entry to reduce patch conflicts, and adjusted for earlier versions of
+php.
+
+Index: ext/standard/ftp\_fopen\_wrapper.c
+===================================================================
+--- ext/standard/ftp\_fopen\_wrapper.c (revision 308733)
++++ ext/standard/ftp\_fopen\_wrapper.c (revision 308734)
+@@ -72,6 +72,12 @@
+ #define FTPS\_ENCRYPT\_DATA 1
+ #define GET\_FTP\_RESULT(stream) get\_ftp\_result((stream), tmp\_line, sizeof(tmp\_line) TSRMLS\_CC)
+
++typedef struct \_php\_ftp\_dirstream\_data {
++ php\_stream \*datastream;
++ php\_stream \*controlstream;
++ php\_stream \*dirstream;
++} php\_ftp\_dirstream\_data;
++
+ /\* {{{ get\_ftp\_result
+ \*/
+ static inline int get\_ftp\_result(php\_stream \*stream, char \*buffer, size\_t buffer\_size TSRMLS\_DC)
+@@ -97,12 +103,12 @@
+ \*/
+ static int php\_stream\_ftp\_stream\_close(php\_stream\_wrapper \*wrapper, php\_stream \*stream TSRMLS\_DC)
+ {
+- php\_stream \*controlstream = (php\_stream \*)stream->wrapperdata;
++ php\_stream \*controlstream = stream->wrapperthis;
+
+ if (controlstream) {
+ php\_stream\_write\_string(controlstream, "QUIT\r\n");
+ php\_stream\_close(controlstream);
+- stream->wrapperdata = NULL;
++ stream->wrapperthis = NULL;
+ }
+ return 0;
+ }
+@@ -584,7 +584,7 @@
+ }
+
+ /\* remember control stream \*/
+- datastream->wrapperdata = (zval \*)stream;
++ datastream->wrapperthis = stream;
+
+ php\_url\_free(resource);
+ return datastream;
+@@ -608,11 +608,13 @@
+ static size\_t php\_ftp\_dirstream\_read(php\_stream \*stream, char \*buf, size\_t count TSRMLS\_DC)
+ {
+ php\_stream\_dirent \*ent = (php\_stream\_dirent \*)buf;
+- php\_stream \*innerstream = (php\_stream \*)stream->abstract;
++ php\_stream \*innerstream;
+ size\_t tmp\_len;
+ char \*basename;
+ size\_t basename\_len;
+
++ innerstream = ((php\_ftp\_dirstream\_data \*)stream->abstract)->datastream;
++
+ if (count != sizeof(php\_stream\_dirent)) {
+ return 0;
+ }
+@@ -656,13 +658,18 @@
+ \*/
+ static int php\_ftp\_dirstream\_close(php\_stream \*stream, int close\_handle TSRMLS\_DC)
+ {
+- php\_stream \*innerstream = (php\_stream \*)stream->abstract;
++ php\_ftp\_dirstream\_data \*data = stream->abstract;
+
+- if (innerstream->wrapperdata) {
+- php\_stream\_close((php\_stream \*)innerstream->wrapperdata);
+- innerstream->wrapperdata = NULL;
++ /\* close control connection \*/
++ if (data->controlstream) {
++ php\_stream\_close(data->controlstream);
++ data->controlstream = NULL;
+ }
+- php\_stream\_close((php\_stream \*)stream->abstract);
++ /\* close data connection \*/
++ php\_stream\_close(data->datastream);
++ data->datastream = NULL;
++
++ efree(data);
+ stream->abstract = NULL;
+
+ return 0;
+@@ -688,6 +695,7 @@
+ php\_stream \* php\_stream\_ftp\_opendir(php\_stream\_wrapper \*wrapper, char \*path, char \*mode, int options, char \*\*opened\_path, php\_stream\_context \*context STREAMS\_DC TSRMLS\_DC)
+ {
+ php\_stream \*stream, \*reuseid, \*datastream = NULL;
++ php\_ftp\_dirstream\_data \*dirsdata;
+ php\_url \*resource = NULL;
+ int result = 0, use\_ssl, use\_ssl\_on\_data = 0;
+ char \*hoststart = NULL, tmp\_line[512];
+@@ -747,12 +755,15 @@
+ goto opendir\_errexit;
+ }
+
+- /\* remember control stream \*/
+- datastream->wrapperdata = (zval \*)stream;
+-
+ php\_url\_free(resource);
+- return php\_stream\_alloc(&php\_ftp\_dirstream\_ops, datastream, 0, mode);
+
++ dirsdata = emalloc(sizeof \*dirsdata);
++ dirsdata->datastream = datastream;
++ dirsdata->controlstream = stream;
++ dirsdata->dirstream = php\_stream\_alloc(&php\_ftp\_dirstream\_ops, dirsdata, 0, mode);
++
++ return dirsdata->dirstream;
++
+ opendir\_errexit:
+ if (resource) {
+ php\_url\_free(resource);
--- php5-5.3.2.orig/debian/patches/max\_file\_uploads.patch
+++ php5-5.3.2/debian/patches/max\_file\_uploads.patch
@@ -0,0 +1,33 @@
+--- a/php.ini-dist
++++ b/php.ini-dist
+@@ -571,7 +571,7 @@ upload\_max\_filesize = 2M
+
+
+ ; Maximum number of files that can be uploaded via a single request
+-max\_file\_uploads = 20
++max\_file\_uploads = 50
+
+ ;;;;;;;;;;;;;;;;;;
+ ; Fopen wrappers ;
+--- a/php.ini-recommended
++++ b/php.ini-recommended
+@@ -606,7 +606,7 @@ upload\_max\_filesize = 2M
+
+
+ ; Maximum number of files that can be uploaded via a single request
+-max\_file\_uploads = 20
++max\_file\_uploads = 50
+
+ ;;;;;;;;;;;;;;;;;;
+ ; Fopen wrappers ;
+--- a/main/main.c
++++ b/main/main.c
+@@ -456,7 +456,7 @@ PHP\_INI\_BEGIN()
+ PHP\_INI\_ENTRY("mail.force\_extra\_parameters",NULL, PHP\_INI\_SYSTEM|PHP\_INI\_PERDIR, OnChangeMailForceExtra)
+ PHP\_INI\_ENTRY("disable\_functions", "", PHP\_INI\_SYSTEM, NULL)
+ PHP\_INI\_ENTRY("disable\_classes", "", PHP\_INI\_SYSTEM, NULL)
+- PHP\_INI\_ENTRY("max\_file\_uploads", "20", PHP\_INI\_SYSTEM, NULL)
++ PHP\_INI\_ENTRY("max\_file\_uploads", "50", PHP\_INI\_SYSTEM, NULL)
+
+ STD\_PHP\_INI\_BOOLEAN("allow\_url\_fopen", "1", PHP\_INI\_SYSTEM, OnUpdateBool, allow\_url\_fopen, php\_core\_globals, core\_globals)
+ STD\_PHP\_INI\_BOOLEAN("allow\_url\_include", "0", PHP\_INI\_SYSTEM, OnUpdateBool, allow\_url\_include, php\_core\_globals, core\_globals)
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-3436.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-3436.patch
@@ -0,0 +1,29 @@
+Subject: Fixed possible flaw in open\_basedir allowing basedir bypass
+Origin: http://svn.php.net/viewvc?view=revision&revision=303824
+
+CVE-2010-3436
+
+---
+ main/fopen\_wrappers.c | 9 +++++++--
+ 1 file changed, 7 insertions(+), 2 deletions(-)
+
+Index: b/main/fopen\_wrappers.c
+===================================================================
+--- a/main/fopen\_wrappers.c
++++ b/main/fopen\_wrappers.c
+@@ -239,8 +239,13 @@ PHPAPI int php\_check\_specific\_open\_based
+ #else
+ if (strncmp(resolved\_basedir, resolved\_name, resolved\_basedir\_len) == 0) {
+ #endif
+- /\* File is in the right directory \*/
+- return 0;
++ if (resolved\_name\_len > resolved\_basedir\_len &&
++ resolved\_name[resolved\_basedir\_len] != PHP\_DIR\_SEPARATOR) {
++ return -1;
++ } else {
++ /\* File is in the right directory \*/
++ return 0;
++ }
+ } else {
+ /\* /openbasedir/ and /openbasedir are the same directory \*/
+ if (resolved\_basedir\_len == (resolved\_name\_len + 1) && resolved\_basedir[resolved\_basedir\_len - 1] == PHP\_DIR\_SEPARATOR) {
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-2202.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-2202.patch
@@ -0,0 +1,31 @@
+Description: Fixed bug #54939 (File path injection vulnerability in RFC1867 File upload filename)
+Reviewed-By: Angel Abad
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=312103
+Bug-Ubuntu: https://launchpad.net/bugs/813115
+
+CVE-2011-2202
+
+Patch differs from upstream commit in that it drops the added NEWS file
+entry to reduce patch conflicts, and adjusted for earlier versions of
+php.
+
+--- a/main/rfc1867.c
++++ b/main/rfc1867.c
+@@ -1214,7 +1214,7 @@
+ #endif
+
+ if (!is\_anonymous) {
+- if (s && s > filename) {
++ if (s && s >= filename) {
+ safe\_php\_register\_variable(lbuf, s+1, strlen(s+1), NULL, 0 TSRMLS\_CC);
+ } else {
+ safe\_php\_register\_variable(lbuf, filename, strlen(filename), NULL, 0 TSRMLS\_CC);
+@@ -1227,7 +1227,7 @@
+ } else {
+ snprintf(lbuf, llen, "%s[name]", param);
+ }
+- if (s && s > filename) {
++ if (s && s >= filename) {
+ register\_http\_post\_files\_variable(lbuf, s+1, http\_post\_files, 0 TSRMLS\_CC);
+ } else {
+ register\_http\_post\_files\_variable(lbuf, filename, http\_post\_files, 0 TSRMLS\_CC);
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-4645.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-4645.patch
@@ -0,0 +1,25 @@
+Subject: Fixed Bug #53632 (infinite loop with x87 fpu). (Scott, Rasmus)
+Origin: http://svn.php.net/viewvc?view=revision&revision=307095
+Bug: http://bugs.php.net/53632
+Bug-Ubuntu: https://bugs.launchpad.net/bugs/697181
+
+[Ubuntu note: removed NEWS file change from commit diff to ease
+ application of patch. - sbeattie]
+
+---
+ Zend/zend\_strtod.c | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+Index: b/Zend/zend\_strtod.c
+===================================================================
+--- a/Zend/zend\_strtod.c
++++ b/Zend/zend\_strtod.c
+@@ -2045,7 +2045,7 @@ ZEND\_API double zend\_strtod (CONST char
+ int bb2, bb5, bbe, bd2, bd5, bbbits, bs2, c, dsign,
+ e, e1, esign, i, j, k, nd, nd0, nf, nz, nz0, sign;
+ CONST char \*s, \*s0, \*s1;
+- double aadj, aadj1, adj;
++ volatile double aadj, aadj1, adj;
+ volatile \_double rv, rv0;
+ Long L;
+ ULong y, z;
--- php5-5.3.2.orig/debian/patches/sybase-alias.patch
+++ php5-5.3.2/debian/patches/sybase-alias.patch
@@ -0,0 +1,41 @@
+--- a/ext/mssql/php\_mssql.c
++++ b/ext/mssql/php\_mssql.c
+@@ -178,6 +178,38 @@ const zend\_function\_entry mssql\_function
+ PHP\_FE(mssql\_execute, arginfo\_mssql\_execute)
+ PHP\_FE(mssql\_free\_statement, arginfo\_mssql\_free\_statement)
+ PHP\_FE(mssql\_guid\_string, arginfo\_mssql\_guid\_string)
++#if !defined(PHP\_WIN32) && !defined(HAVE\_SYBASE\_CT)
++ PHP\_FALIAS(sybase\_connect, mssql\_connect, arginfo\_mssql\_connect)
++ PHP\_FALIAS(sybase\_pconnect, mssql\_pconnect, arginfo\_mssql\_connect)
++ PHP\_FALIAS(sybase\_close, mssql\_close, arginfo\_mssql\_close)
++ PHP\_FALIAS(sybase\_select\_db, mssql\_select\_db, arginfo\_mssql\_select\_db)
++ PHP\_FALIAS(sybase\_query, mssql\_query, arginfo\_mssql\_query)
++ PHP\_FALIAS(sybase\_fetch\_batch, mssql\_fetch\_batch, arginfo\_mssql\_fetch\_batch)
++ PHP\_FALIAS(sybase\_affected\_rows, mssql\_rows\_affected, arginfo\_mssql\_rows\_affected)
++ PHP\_FALIAS(sybase\_free\_result, mssql\_free\_result, arginfo\_mssql\_fetch\_batch)
++ PHP\_FALIAS(sybase\_get\_last\_message, mssql\_get\_last\_message, arginfo\_mssql\_get\_last\_message)
++ PHP\_FALIAS(sybase\_num\_rows, mssql\_num\_rows, arginfo\_mssql\_fetch\_batch)
++ PHP\_FALIAS(sybase\_num\_fields, mssql\_num\_fields, arginfo\_mssql\_fetch\_batch)
++ PHP\_FALIAS(sybase\_fetch\_field, mssql\_fetch\_field, arginfo\_mssql\_fetch\_field)
++ PHP\_FALIAS(sybase\_fetch\_row, mssql\_fetch\_row, arginfo\_mssql\_fetch\_batch)
++ PHP\_FALIAS(sybase\_fetch\_array, mssql\_fetch\_array, arginfo\_mssql\_fetch\_array)
++ PHP\_FALIAS(sybase\_fetch\_assoc, mssql\_fetch\_assoc, arginfo\_mssql\_fetch\_assoc)
++ PHP\_FALIAS(sybase\_fetch\_object, mssql\_fetch\_object, arginfo\_mssql\_fetch\_batch)
++ PHP\_FALIAS(sybase\_field\_length, mssql\_field\_length, arginfo\_mssql\_field\_length)
++ PHP\_FALIAS(sybase\_field\_name, mssql\_field\_name, arginfo\_mssql\_field\_length)
++ PHP\_FALIAS(sybase\_field\_type, mssql\_field\_type, arginfo\_mssql\_field\_length)
++ PHP\_FALIAS(sybase\_data\_seek, mssql\_data\_seek, arginfo\_mssql\_data\_seek)
++ PHP\_FALIAS(sybase\_field\_seek, mssql\_field\_seek, arginfo\_mssql\_fetch\_field)
++ PHP\_FALIAS(sybase\_result, mssql\_result, arginfo\_mssql\_result)
++ PHP\_FALIAS(sybase\_next\_result, mssql\_next\_result, arginfo\_mssql\_fetch\_assoc)
++ PHP\_FALIAS(sybase\_min\_error\_severity, mssql\_min\_error\_severity, arginfo\_mssql\_min\_error\_severity)
++ PHP\_FALIAS(sybase\_min\_message\_severity, mssql\_min\_message\_severity, arginfo\_mssql\_min\_error\_severity)
++ PHP\_FALIAS(sybase\_init, mssql\_init, arginfo\_mssql\_init)
++ PHP\_FALIAS(sybase\_bind, mssql\_bind, arginfo\_mssql\_bind)
++ PHP\_FALIAS(sybase\_execute, mssql\_execute, arginfo\_mssql\_execute)
++ PHP\_FALIAS(sybase\_free\_statement, mssql\_free\_statement, arginfo\_mssql\_free\_statement)
++ PHP\_FALIAS(sybase\_guid\_string, mssql\_guid\_string, arginfo\_mssql\_guid\_string)
++#endif
+ {NULL, NULL, NULL}
+ };
+ /\* }}} \*/
--- php5-5.3.2.orig/debian/patches/019-z\_off\_t\_as\_long.patch
+++ php5-5.3.2/debian/patches/019-z\_off\_t\_as\_long.patch
@@ -0,0 +1,1541 @@
+Description: Include some zlib headers to make sure z\_off\_t is a long on
+ the gzip file functions. Issue caused by LFS support.
+ .
+ Needs to be re-checked.
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/208608
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- /dev/null
++++ pkg-php/ext/zlib/zconf.h
+@@ -0,0 +1,326 @@
++/\* zconf.h -- configuration of the zlib compression library
++ \* Copyright (C) 1995-2003 Jean-loup Gailly.
++ \* For conditions of distribution and use, see copyright notice in zlib.h
++ \*/
++
++/\* @(#) $Id: 019-z\_off\_t\_as\_long.patch.disabled,v 1.3 2004/08/23 07:48:56 adconrad Exp $ \*/
++
++#ifndef ZCONF\_H
++#define ZCONF\_H
++
++#warning Including local zconf.h instead of system zconf.h
++
++/\*
++ \* If you \*really\* need a unique prefix for all types and library functions,
++ \* compile with -DZ\_PREFIX. The "standard" zlib should be compiled without it.
++ \*/
++#ifdef Z\_PREFIX
++# define deflateInit\_ z\_deflateInit\_
++# define deflate z\_deflate
++# define deflateEnd z\_deflateEnd
++# define inflateInit\_ z\_inflateInit\_
++# define inflate z\_inflate
++# define inflateEnd z\_inflateEnd
++# define deflateInit2\_ z\_deflateInit2\_
++# define deflateSetDictionary z\_deflateSetDictionary
++# define deflateCopy z\_deflateCopy
++# define deflateReset z\_deflateReset
++# define deflatePrime z\_deflatePrime
++# define deflateParams z\_deflateParams
++# define deflateBound z\_deflateBound
++# define inflateInit2\_ z\_inflateInit2\_
++# define inflateSetDictionary z\_inflateSetDictionary
++# define inflateSync z\_inflateSync
++# define inflateSyncPoint z\_inflateSyncPoint
++# define inflateCopy z\_inflateCopy
++# define inflateReset z\_inflateReset
++# define compress z\_compress
++# define compress2 z\_compress2
++# define compressBound z\_compressBound
++# define uncompress z\_uncompress
++# define adler32 z\_adler32
++# define crc32 z\_crc32
++# define get\_crc\_table z\_get\_crc\_table
++
++# define Byte z\_Byte
++# define uInt z\_uInt
++# define uLong z\_uLong
++# define Bytef z\_Bytef
++# define charf z\_charf
++# define intf z\_intf
++# define uIntf z\_uIntf
++# define uLongf z\_uLongf
++# define voidpf z\_voidpf
++# define voidp z\_voidp
++#endif
++
++#if defined(\_\_MSDOS\_\_) && !defined(MSDOS)
++# define MSDOS
++#endif
++#if (defined(OS\_2) || defined(\_\_OS2\_\_)) && !defined(OS2)
++# define OS2
++#endif
++#if defined(\_WINDOWS) && !defined(WINDOWS)
++# define WINDOWS
++#endif
++#if (defined(\_WIN32) || defined(\_\_WIN32\_\_)) && !defined(WIN32)
++# define WIN32
++#endif
++#if (defined(MSDOS) || defined(OS2) || defined(WINDOWS)) && !defined(WIN32)
++# if !defined(\_\_GNUC\_\_) && !defined(\_\_FLAT\_\_) && !defined(\_\_386\_\_)
++# ifndef SYS16BIT
++# define SYS16BIT
++# endif
++# endif
++#endif
++
++/\*
++ \* Compile with -DMAXSEG\_64K if the alloc function cannot allocate more
++ \* than 64k bytes at a time (needed on systems with 16-bit int).
++ \*/
++#ifdef SYS16BIT
++# define MAXSEG\_64K
++#endif
++#ifdef MSDOS
++# define UNALIGNED\_OK
++#endif
++
++#ifdef \_\_STDC\_VERSION\_\_
++# ifndef STDC
++# define STDC
++# endif
++# if \_\_STDC\_VERSION\_\_ >= 199901L
++# ifndef STDC99
++# define STDC99
++# endif
++# endif
++#endif
++#if !defined(STDC) && (defined(\_\_STDC\_\_) || defined(\_\_cplusplus))
++# define STDC
++#endif
++#if !defined(STDC) && (defined(\_\_GNUC\_\_) || defined(\_\_BORLANDC\_\_))
++# define STDC
++#endif
++#if !defined(STDC) && (defined(MSDOS) || defined(WINDOWS) || defined(WIN32))
++# define STDC
++#endif
++#if !defined(STDC) && (defined(OS2) || defined(\_\_HOS\_AIX\_\_))
++# define STDC
++#endif
++
++#if defined(\_\_OS400\_\_) && !defined(STDC) /\* iSeries (formerly AS/400). \*/
++# define STDC
++#endif
++
++#ifndef STDC
++# ifndef const /\* cannot use !defined(STDC) && !defined(const) on Mac \*/
++# define const /\* note: need a more gentle solution here \*/
++# endif
++#endif
++
++/\* Some Mac compilers merge all .h files incorrectly: \*/
++#if defined(\_\_MWERKS\_\_)||defined(applec)||defined(THINK\_C)||defined(\_\_SC\_\_)
++# define NO\_DUMMY\_DECL
++#endif
++
++/\* Maximum value for memLevel in deflateInit2 \*/
++#ifndef MAX\_MEM\_LEVEL
++# ifdef MAXSEG\_64K
++# define MAX\_MEM\_LEVEL 8
++# else
++# define MAX\_MEM\_LEVEL 9
++# endif
++#endif
++
++/\* Maximum value for windowBits in deflateInit2 and inflateInit2.
++ \* WARNING: reducing MAX\_WBITS makes minigzip unable to extract .gz files
++ \* created by gzip. (Files created by minigzip can still be extracted by
++ \* gzip.)
++ \*/
++#ifndef MAX\_WBITS
++# define MAX\_WBITS 15 /\* 32K LZ77 window \*/
++#endif
++
++/\* The memory requirements for deflate are (in bytes):
++ (1 << (windowBits+2)) + (1 << (memLevel+9))
++ that is: 128K for windowBits=15 + 128K for memLevel = 8 (default values)
++ plus a few kilobytes for small objects. For example, if you want to reduce
++ the default memory requirements from 256K to 128K, compile with
++ make CFLAGS="-O -DMAX\_WBITS=14 -DMAX\_MEM\_LEVEL=7"
++ Of course this will generally degrade compression (there's no free lunch).
++
++ The memory requirements for inflate are (in bytes) 1 << windowBits
++ that is, 32K for windowBits=15 (default value) plus a few kilobytes
++ for small objects.
++\*/
++
++ /\* Type declarations \*/
++
++#ifndef OF /\* function prototypes \*/
++# ifdef STDC
++# define OF(args) args
++# else
++# define OF(args) ()
++# endif
++#endif
++
++/\* The following definitions for FAR are needed only for MSDOS mixed
++ \* model programming (small or medium model with some far allocations).
++ \* This was tested only with MSC; for other MSDOS compilers you may have
++ \* to define NO\_MEMCPY in zutil.h. If you don't need the mixed model,
++ \* just define FAR to be empty.
++ \*/
++#ifdef SYS16BIT
++# if defined(M\_I86SM) || defined(M\_I86MM)
++ /\* MSC small or medium model \*/
++# define SMALL\_MEDIUM
++# ifdef \_MSC\_VER
++# define FAR \_far
++# else
++# define FAR far
++# endif
++# endif
++# if (defined(\_\_SMALL\_\_) || defined(\_\_MEDIUM\_\_))
++ /\* Turbo C small or medium model \*/
++# define SMALL\_MEDIUM
++# ifdef \_\_BORLANDC\_\_
++# define FAR \_far
++# else
++# define FAR far
++# endif
++# endif
++#endif
++
++#if defined(WINDOWS) || defined(WIN32)
++ /\* If building or using zlib as a DLL, define ZLIB\_DLL.
++ \* This is not mandatory, but it offers a little performance increase.
++ \*/
++# ifdef ZLIB\_DLL
++# if defined(WIN32) && (!defined(\_\_BORLANDC\_\_) || (\_\_BORLANDC\_\_ >= 0x500))
++# ifdef ZLIB\_INTERNAL
++# define ZEXTERN extern \_\_declspec(dllexport)
++# else
++# define ZEXTERN extern \_\_declspec(dllimport)
++# endif
++# endif
++# endif /\* ZLIB\_DLL \*/
++ /\* If building or using zlib with the WINAPI/WINAPIV calling convention,
++ \* define ZLIB\_WINAPI.
++ \* Caution: the standard ZLIB1.DLL is NOT compiled using ZLIB\_WINAPI.
++ \*/
++# ifdef ZLIB\_WINAPI
++# ifdef FAR
++# undef FAR
++# endif
++# include
++ /\* No need for \_export, use ZLIB.DEF instead. \*/
++ /\* For complete Windows compatibility, use WINAPI, not \_\_stdcall. \*/
++# define ZEXPORT WINAPI
++# ifdef WIN32
++# define ZEXPORTVA WINAPIV
++# else
++# define ZEXPORTVA FAR CDECL
++# endif
++# endif
++#endif
++
++#if defined (\_\_BEOS\_\_)
++# ifdef ZLIB\_DLL
++# ifdef ZLIB\_INTERNAL
++# define ZEXPORT \_\_declspec(dllexport)
++# define ZEXPORTVA \_\_declspec(dllexport)
++# else
++# define ZEXPORT \_\_declspec(dllimport)
++# define ZEXPORTVA \_\_declspec(dllimport)
++# endif
++# endif
++#endif
++
++#ifndef ZEXTERN
++# define ZEXTERN extern
++#endif
++#ifndef ZEXPORT
++# define ZEXPORT
++#endif
++#ifndef ZEXPORTVA
++# define ZEXPORTVA
++#endif
++
++#ifndef FAR
++# define FAR
++#endif
++
++#if !defined(\_\_MACTYPES\_\_)
++typedef unsigned char Byte; /\* 8 bits \*/
++#endif
++typedef unsigned int uInt; /\* 16 bits or more \*/
++typedef unsigned long uLong; /\* 32 bits or more \*/
++
++#ifdef SMALL\_MEDIUM
++ /\* Borland C/C++ and some old MSC versions ignore FAR inside typedef \*/
++# define Bytef Byte FAR
++#else
++ typedef Byte FAR Bytef;
++#endif
++typedef char FAR charf;
++typedef int FAR intf;
++typedef uInt FAR uIntf;
++typedef uLong FAR uLongf;
++
++#ifdef STDC
++ typedef void const \*voidpc;
++ typedef void FAR \*voidpf;
++ typedef void \*voidp;
++#else
++ typedef Byte const \*voidpc;
++ typedef Byte FAR \*voidpf;
++ typedef Byte \*voidp;
++#endif
++
++#if 1 /\* HAVE\_UNISTD\_H -- this line is updated by ./configure \*/
++# include  /\* for off\_t \*/
++# include  /\* for SEEK\_\* and off\_t \*/
++# ifdef VMS
++# include  /\* for off\_t \*/
++# endif
++/\* # define z\_off\_t off\_t \*/
++#endif
++#ifndef SEEK\_SET
++# define SEEK\_SET 0 /\* Seek from beginning of file. \*/
++# define SEEK\_CUR 1 /\* Seek from current position. \*/
++# define SEEK\_END 2 /\* Set file pointer to EOF plus "offset" \*/
++#endif
++#ifndef z\_off\_t
++# warning Defining z\_off\_t as 'long' rather than 'off\_t'
++# define z\_off\_t long
++#endif
++
++#if defined(\_\_OS400\_\_)
++#define NO\_vsnprintf
++#endif
++
++#if defined(\_\_MVS\_\_)
++# define NO\_vsnprintf
++# ifdef FAR
++# undef FAR
++# endif
++#endif
++
++/\* MVS linker does not support external names larger than 8 bytes \*/
++#if defined(\_\_MVS\_\_)
++# pragma map(deflateInit\_,"DEIN")
++# pragma map(deflateInit2\_,"DEIN2")
++# pragma map(deflateEnd,"DEEND")
++# pragma map(deflateBound,"DEBND")
++# pragma map(inflateInit\_,"ININ")
++# pragma map(inflateInit2\_,"ININ2")
++# pragma map(inflateEnd,"INEND")
++# pragma map(inflateSync,"INSY")
++# pragma map(inflateSetDictionary,"INSEDI")
++# pragma map(compressBound,"CMBND")
++# pragma map(inflate\_table,"INTABL")
++# pragma map(inflate\_fast,"INFA")
++# pragma map(inflate\_copyright,"INCOPY")
++#endif
++
++#endif /\* ZCONF\_H \*/
+--- /dev/null
++++ pkg-php/ext/zlib/zlib.h
+@@ -0,0 +1,1200 @@
++/\* zlib.h -- interface of the 'zlib' general purpose compression library
++ version 1.2.1.1, January 9th, 2004
++
++ Copyright (C) 1995-2004 Jean-loup Gailly and Mark Adler
++
++ This software is provided 'as-is', without any express or implied
++ warranty. In no event will the authors be held liable for any damages
++ arising from the use of this software.
++
++ Permission is granted to anyone to use this software for any purpose,
++ including commercial applications, and to alter it and redistribute it
++ freely, subject to the following restrictions:
++
++ 1. The origin of this software must not be misrepresented; you must not
++ claim that you wrote the original software. If you use this software
++ in a product, an acknowledgment in the product documentation would be
++ appreciated but is not required.
++ 2. Altered source versions must be plainly marked as such, and must not be
++ misrepresented as being the original software.
++ 3. This notice may not be removed or altered from any source distribution.
++
++ Jean-loup Gailly Mark Adler
++ jloup@gzip.org madler@alumni.caltech.edu
++
++
++ The data format used by the zlib library is described by RFCs (Request for
++ Comments) 1950 to 1952 in the files http://www.ietf.org/rfc/rfc1950.txt
++ (zlib format), rfc1951.txt (deflate format) and rfc1952.txt (gzip format).
++\*/
++
++#ifndef ZLIB\_H
++#define ZLIB\_H
++
++#include "zconf.h"
++
++#ifdef \_\_cplusplus
++extern "C" {
++#endif
++
++#define ZLIB\_VERSION "1.2.1.1"
++#define ZLIB\_VERNUM 0x1211
++
++/\*
++ The 'zlib' compression library provides in-memory compression and
++ decompression functions, including integrity checks of the uncompressed
++ data. This version of the library supports only one compression method
++ (deflation) but other algorithms will be added later and will have the same
++ stream interface.
++
++ Compression can be done in a single step if the buffers are large
++ enough (for example if an input file is mmap'ed), or can be done by
++ repeated calls of the compression function. In the latter case, the
++ application must provide more input and/or consume the output
++ (providing more output space) before each call.
++
++ The compressed data format used by the in-memory functions is the zlib
++ format, which is a zlib wrapper documented in RFC 1950, wrapped around a
++ deflate stream, which is itself documented in RFC 1951.
++
++ The library also supports reading and writing files in gzip (.gz) format
++ with an interface similar to that of stdio using the functions that start
++ with "gz". The gzip format is different from the zlib format. gzip is a
++ gzip wrapper, documented in RFC 1952, wrapped around a deflate stream.
++
++ The zlib format was designed to be compact and fast for use in memory
++ and on communications channels. The gzip format was designed for single-
++ file compression on file systems, has a larger header than zlib to maintain
++ directory information, and uses a different, slower check method than zlib.
++
++ This library does not provide any functions to write gzip files in memory.
++ However such functions could be easily written using zlib's deflate function,
++ the documentation in the gzip RFC, and the examples in gzio.c.
++
++ The library does not install any signal handler. The decoder checks
++ the consistency of the compressed data, so the library should never
++ crash even in case of corrupted input.
++\*/
++
++typedef voidpf (\*alloc\_func) OF((voidpf opaque, uInt items, uInt size));
++typedef void (\*free\_func) OF((voidpf opaque, voidpf address));
++
++struct internal\_state;
++
++typedef struct z\_stream\_s {
++ Bytef \*next\_in; /\* next input byte \*/
++ uInt avail\_in; /\* number of bytes available at next\_in \*/
++ uLong total\_in; /\* total nb of input bytes read so far \*/
++
++ Bytef \*next\_out; /\* next output byte should be put there \*/
++ uInt avail\_out; /\* remaining free space at next\_out \*/
++ uLong total\_out; /\* total nb of bytes output so far \*/
++
++ char \*msg; /\* last error message, NULL if no error \*/
++ struct internal\_state FAR \*state; /\* not visible by applications \*/
++
++ alloc\_func zalloc; /\* used to allocate the internal state \*/
++ free\_func zfree; /\* used to free the internal state \*/
++ voidpf opaque; /\* private data object passed to zalloc and zfree \*/
++
++ int data\_type; /\* best guess about the data type: ascii or binary \*/
++ uLong adler; /\* adler32 value of the uncompressed data \*/
++ uLong reserved; /\* reserved for future use \*/
++} z\_stream;
++
++typedef z\_stream FAR \*z\_streamp;
++
++/\*
++ The application must update next\_in and avail\_in when avail\_in has
++ dropped to zero. It must update next\_out and avail\_out when avail\_out
++ has dropped to zero. The application must initialize zalloc, zfree and
++ opaque before calling the init function. All other fields are set by the
++ compression library and must not be updated by the application.
++
++ The opaque value provided by the application will be passed as the first
++ parameter for calls of zalloc and zfree. This can be useful for custom
++ memory management. The compression library attaches no meaning to the
++ opaque value.
++
++ zalloc must return Z\_NULL if there is not enough memory for the object.
++ If zlib is used in a multi-threaded application, zalloc and zfree must be
++ thread safe.
++
++ On 16-bit systems, the functions zalloc and zfree must be able to allocate
++ exactly 65536 bytes, but will not be required to allocate more than this
++ if the symbol MAXSEG\_64K is defined (see zconf.h). WARNING: On MSDOS,
++ pointers returned by zalloc for objects of exactly 65536 bytes \*must\*
++ have their offset normalized to zero. The default allocation function
++ provided by this library ensures this (see zutil.c). To reduce memory
++ requirements and avoid any allocation of 64K objects, at the expense of
++ compression ratio, compile the library with -DMAX\_WBITS=14 (see zconf.h).
++
++ The fields total\_in and total\_out can be used for statistics or
++ progress reports. After compression, total\_in holds the total size of
++ the uncompressed data and may be saved for use in the decompressor
++ (particularly if the decompressor wants to decompress everything in
++ a single step).
++\*/
++
++ /\* constants \*/
++
++#define Z\_NO\_FLUSH 0
++#define Z\_PARTIAL\_FLUSH 1 /\* will be removed, use Z\_SYNC\_FLUSH instead \*/
++#define Z\_SYNC\_FLUSH 2
++#define Z\_FULL\_FLUSH 3
++#define Z\_FINISH 4
++#define Z\_BLOCK 5
++/\* Allowed flush values; see deflate() and inflate() below for details \*/
++
++#define Z\_OK 0
++#define Z\_STREAM\_END 1
++#define Z\_NEED\_DICT 2
++#define Z\_ERRNO (-1)
++#define Z\_STREAM\_ERROR (-2)
++#define Z\_DATA\_ERROR (-3)
++#define Z\_MEM\_ERROR (-4)
++#define Z\_BUF\_ERROR (-5)
++#define Z\_VERSION\_ERROR (-6)
++/\* Return codes for the compression/decompression functions. Negative
++ \* values are errors, positive values are used for special but normal events.
++ \*/
++
++#define Z\_NO\_COMPRESSION 0
++#define Z\_BEST\_SPEED 1
++#define Z\_BEST\_COMPRESSION 9
++#define Z\_DEFAULT\_COMPRESSION (-1)
++/\* compression levels \*/
++
++#define Z\_FILTERED 1
++#define Z\_HUFFMAN\_ONLY 2
++#define Z\_RLE 3
++#define Z\_DEFAULT\_STRATEGY 0
++/\* compression strategy; see deflateInit2() below for details \*/
++
++#define Z\_BINARY 0
++#define Z\_ASCII 1
++#define Z\_UNKNOWN 2
++/\* Possible values of the data\_type field (though see inflate()) \*/
++
++#define Z\_DEFLATED 8
++/\* The deflate compression method (the only one supported in this version) \*/
++
++#define Z\_NULL 0 /\* for initializing zalloc, zfree, opaque \*/
++
++#define zlib\_version zlibVersion()
++/\* for compatibility with versions < 1.0.2 \*/
++
++ /\* basic functions \*/
++
++ZEXTERN const char \* ZEXPORT zlibVersion OF((void));
++/\* The application can compare zlibVersion and ZLIB\_VERSION for consistency.
++ If the first character differs, the library code actually used is
++ not compatible with the zlib.h header file used by the application.
++ This check is automatically made by deflateInit and inflateInit.
++ \*/
++
++/\*
++ZEXTERN int ZEXPORT deflateInit OF((z\_streamp strm, int level));
++
++ Initializes the internal stream state for compression. The fields
++ zalloc, zfree and opaque must be initialized before by the caller.
++ If zalloc and zfree are set to Z\_NULL, deflateInit updates them to
++ use default allocation functions.
++
++ The compression level must be Z\_DEFAULT\_COMPRESSION, or between 0 and 9:
++ 1 gives best speed, 9 gives best compression, 0 gives no compression at
++ all (the input data is simply copied a block at a time).
++ Z\_DEFAULT\_COMPRESSION requests a default compromise between speed and
++ compression (currently equivalent to level 6).
++
++ deflateInit returns Z\_OK if success, Z\_MEM\_ERROR if there was not
++ enough memory, Z\_STREAM\_ERROR if level is not a valid compression level,
++ Z\_VERSION\_ERROR if the zlib library version (zlib\_version) is incompatible
++ with the version assumed by the caller (ZLIB\_VERSION).
++ msg is set to null if there is no error message. deflateInit does not
++ perform any compression: this will be done by deflate().
++\*/
++
++
++ZEXTERN int ZEXPORT deflate OF((z\_streamp strm, int flush));
++/\*
++ deflate compresses as much data as possible, and stops when the input
++ buffer becomes empty or the output buffer becomes full. It may introduce some
++ output latency (reading input without producing any output) except when
++ forced to flush.
++
++ The detailed semantics are as follows. deflate performs one or both of the
++ following actions:
++
++ - Compress more input starting at next\_in and update next\_in and avail\_in
++ accordingly. If not all input can be processed (because there is not
++ enough room in the output buffer), next\_in and avail\_in are updated and
++ processing will resume at this point for the next call of deflate().
++
++ - Provide more output starting at next\_out and update next\_out and avail\_out
++ accordingly. This action is forced if the parameter flush is non zero.
++ Forcing flush frequently degrades the compression ratio, so this parameter
++ should be set only when necessary (in interactive applications).
++ Some output may be provided even if flush is not set.
++
++ Before the call of deflate(), the application should ensure that at least
++ one of the actions is possible, by providing more input and/or consuming
++ more output, and updating avail\_in or avail\_out accordingly; avail\_out
++ should never be zero before the call. The application can consume the
++ compressed output when it wants, for example when the output buffer is full
++ (avail\_out == 0), or after each call of deflate(). If deflate returns Z\_OK
++ and with zero avail\_out, it must be called again after making room in the
++ output buffer because there might be more output pending.
++
++ If the parameter flush is set to Z\_SYNC\_FLUSH, all pending output is
++ flushed to the output buffer and the output is aligned on a byte boundary, so
++ that the decompressor can get all input data available so far. (In particular
++ avail\_in is zero after the call if enough output space has been provided
++ before the call.) Flushing may degrade compression for some compression
++ algorithms and so it should be used only when necessary.
++
++ If flush is set to Z\_FULL\_FLUSH, all output is flushed as with
++ Z\_SYNC\_FLUSH, and the compression state is reset so that decompression can
++ restart from this point if previous compressed data has been damaged or if
++ random access is desired. Using Z\_FULL\_FLUSH too often can seriously degrade
++ the compression.
++
++ If deflate returns with avail\_out == 0, this function must be called again
++ with the same value of the flush parameter and more output space (updated
++ avail\_out), until the flush is complete (deflate returns with non-zero
++ avail\_out). In the case of a Z\_FULL\_FLUSH or Z\_SYNC\_FLUSH, make sure that
++ avail\_out is greater than six to avoid repeated flush markers due to
++ avail\_out == 0 on return.
++
++ If the parameter flush is set to Z\_FINISH, pending input is processed,
++ pending output is flushed and deflate returns with Z\_STREAM\_END if there
++ was enough output space; if deflate returns with Z\_OK, this function must be
++ called again with Z\_FINISH and more output space (updated avail\_out) but no
++ more input data, until it returns with Z\_STREAM\_END or an error. After
++ deflate has returned Z\_STREAM\_END, the only possible operations on the
++ stream are deflateReset or deflateEnd.
++
++ Z\_FINISH can be used immediately after deflateInit if all the compression
++ is to be done in a single step. In this case, avail\_out must be at least
++ the value returned by deflateBound (see below). If deflate does not return
++ Z\_STREAM\_END, then it must be called again as described above.
++
++ deflate() sets strm->adler to the adler32 checksum of all input read
++ so far (that is, total\_in bytes).
++
++ deflate() may update data\_type if it can make a good guess about
++ the input data type (Z\_ASCII or Z\_BINARY). In doubt, the data is considered
++ binary. This field is only for information purposes and does not affect
++ the compression algorithm in any manner.
++
++ deflate() returns Z\_OK if some progress has been made (more input
++ processed or more output produced), Z\_STREAM\_END if all input has been
++ consumed and all output has been produced (only when flush is set to
++ Z\_FINISH), Z\_STREAM\_ERROR if the stream state was inconsistent (for example
++ if next\_in or next\_out was NULL), Z\_BUF\_ERROR if no progress is possible
++ (for example avail\_in or avail\_out was zero). Note that Z\_BUF\_ERROR is not
++ fatal, and deflate() can be called again with more input and more output
++ space to continue compressing.
++\*/
++
++
++ZEXTERN int ZEXPORT deflateEnd OF((z\_streamp strm));
++/\*
++ All dynamically allocated data structures for this stream are freed.
++ This function discards any unprocessed input and does not flush any
++ pending output.
++
++ deflateEnd returns Z\_OK if success, Z\_STREAM\_ERROR if the
++ stream state was inconsistent, Z\_DATA\_ERROR if the stream was freed
++ prematurely (some input or output was discarded). In the error case,
++ msg may be set but then points to a static string (which must not be
++ deallocated).
++\*/
++
++
++/\*
++ZEXTERN int ZEXPORT inflateInit OF((z\_streamp strm));
++
++ Initializes the internal stream state for decompression. The fields
++ next\_in, avail\_in, zalloc, zfree and opaque must be initialized before by
++ the caller. If next\_in is not Z\_NULL and avail\_in is large enough (the exact
++ value depends on the compression method), inflateInit determines the
++ compression method from the zlib header and allocates all data structures
++ accordingly; otherwise the allocation will be deferred to the first call of
++ inflate. If zalloc and zfree are set to Z\_NULL, inflateInit updates them to
++ use default allocation functions.
++
++ inflateInit returns Z\_OK if success, Z\_MEM\_ERROR if there was not enough
++ memory, Z\_VERSION\_ERROR if the zlib library version is incompatible with the
++ version assumed by the caller. msg is set to null if there is no error
++ message. inflateInit does not perform any decompression apart from reading
++ the zlib header if present: this will be done by inflate(). (So next\_in and
++ avail\_in may be modified, but next\_out and avail\_out are unchanged.)
++\*/
++
++
++ZEXTERN int ZEXPORT inflate OF((z\_streamp strm, int flush));
++/\*
++ inflate decompresses as much data as possible, and stops when the input
++ buffer becomes empty or the output buffer becomes full. It may introduce
++ some output latency (reading input without producing any output) except when
++ forced to flush.
++
++ The detailed semantics are as follows. inflate performs one or both of the
++ following actions:
++
++ - Decompress more input starting at next\_in and update next\_in and avail\_in
++ accordingly. If not all input can be processed (because there is not
++ enough room in the output buffer), next\_in is updated and processing
++ will resume at this point for the next call of inflate().
++
++ - Provide more output starting at next\_out and update next\_out and avail\_out
++ accordingly. inflate() provides as much output as possible, until there
++ is no more input data or no more space in the output buffer (see below
++ about the flush parameter).
++
++ Before the call of inflate(), the application should ensure that at least
++ one of the actions is possible, by providing more input and/or consuming
++ more output, and updating the next\_\* and avail\_\* values accordingly.
++ The application can consume the uncompressed output when it wants, for
++ example when the output buffer is full (avail\_out == 0), or after each
++ call of inflate(). If inflate returns Z\_OK and with zero avail\_out, it
++ must be called again after making room in the output buffer because there
++ might be more output pending.
++
++ The flush parameter of inflate() can be Z\_NO\_FLUSH, Z\_SYNC\_FLUSH,
++ Z\_FINISH, or Z\_BLOCK. Z\_SYNC\_FLUSH requests that inflate() flush as much
++ output as possible to the output buffer. Z\_BLOCK requests that inflate() stop
++ if and when it get to the next deflate block boundary. When decoding the zlib
++ or gzip format, this will cause inflate() to return immediately after the
++ header and before the first block. When doing a raw inflate, inflate() will
++ go ahead and process the first block, and will return when it gets to the end
++ of that block, or when it runs out of data.
++
++ The Z\_BLOCK option assists in appending to or combining deflate streams.
++ Also to assist in this, on return inflate() will set strm->data\_type to the
++ number of unused bits in the last byte taken from strm->next\_in, plus 64
++ if inflate() is currently decoding the last block in the deflate stream,
++ plus 128 if inflate() returned immediately after decoding an end-of-block
++ code or decoding the complete header up to just before the first byte of the
++ deflate stream. The end-of-block will not be indicated until all of the
++ uncompressed data from that block has been written to strm->next\_out. The
++ number of unused bits may in general be greater than seven, except when
++ bit 7 of data\_type is set, in which case the number of unused bits will be
++ less than eight.
++
++ inflate() should normally be called until it returns Z\_STREAM\_END or an
++ error. However if all decompression is to be performed in a single step
++ (a single call of inflate), the parameter flush should be set to
++ Z\_FINISH. In this case all pending input is processed and all pending
++ output is flushed; avail\_out must be large enough to hold all the
++ uncompressed data. (The size of the uncompressed data may have been saved
++ by the compressor for this purpose.) The next operation on this stream must
++ be inflateEnd to deallocate the decompression state. The use of Z\_FINISH
++ is never required, but can be used to inform inflate that a faster approach
++ may be used for the single inflate() call.
++
++ In this implementation, inflate() always flushes as much output as
++ possible to the output buffer, and always uses the faster approach on the
++ first call. So the only effect of the flush parameter in this implementation
++ is on the return value of inflate(), as noted below, or when it returns early
++ because Z\_BLOCK is used.
++
++ If a preset dictionary is needed after this call (see inflateSetDictionary
++ below), inflate sets strm-adler to the adler32 checksum of the dictionary
++ chosen by the compressor and returns Z\_NEED\_DICT; otherwise it sets
++ strm->adler to the adler32 checksum of all output produced so far (that is,
++ total\_out bytes) and returns Z\_OK, Z\_STREAM\_END or an error code as described
++ below. At the end of the stream, inflate() checks that its computed adler32
++ checksum is equal to that saved by the compressor and returns Z\_STREAM\_END
++ only if the checksum is correct.
++
++ inflate() will decompress and check either zlib-wrapped or gzip-wrapped
++ deflate data. The header type is detected automatically. Any information
++ contained in the gzip header is not retained, so applications that need that
++ information should instead use raw inflate, see inflateInit2() below, or
++ inflateBack() and perform their own processing of the gzip header and
++ trailer.
++
++ inflate() returns Z\_OK if some progress has been made (more input processed
++ or more output produced), Z\_STREAM\_END if the end of the compressed data has
++ been reached and all uncompressed output has been produced, Z\_NEED\_DICT if a
++ preset dictionary is needed at this point, Z\_DATA\_ERROR if the input data was
++ corrupted (input stream not conforming to the zlib format or incorrect check
++ value), Z\_STREAM\_ERROR if the stream structure was inconsistent (for example
++ if next\_in or next\_out was NULL), Z\_MEM\_ERROR if there was not enough memory,
++ Z\_BUF\_ERROR if no progress is possible or if there was not enough room in the
++ output buffer when Z\_FINISH is used. Note that Z\_BUF\_ERROR is not fatal, and
++ inflate() can be called again with more input and more output space to
++ continue decompressing. If Z\_DATA\_ERROR is returned, the application may then
++ call inflateSync() to look for a good compression block if a partial recovery
++ of the data is desired.
++\*/
++
++
++ZEXTERN int ZEXPORT inflateEnd OF((z\_streamp strm));
++/\*
++ All dynamically allocated data structures for this stream are freed.
++ This function discards any unprocessed input and does not flush any
++ pending output.
++
++ inflateEnd returns Z\_OK if success, Z\_STREAM\_ERROR if the stream state
++ was inconsistent. In the error case, msg may be set but then points to a
++ static string (which must not be deallocated).
++\*/
++
++ /\* Advanced functions \*/
++
++/\*
++ The following functions are needed only in some special applications.
++\*/
++
++/\*
++ZEXTERN int ZEXPORT deflateInit2 OF((z\_streamp strm,
++ int level,
++ int method,
++ int windowBits,
++ int memLevel,
++ int strategy));
++
++ This is another version of deflateInit with more compression options. The
++ fields next\_in, zalloc, zfree and opaque must be initialized before by
++ the caller.
++
++ The method parameter is the compression method. It must be Z\_DEFLATED in
++ this version of the library.
++
++ The windowBits parameter is the base two logarithm of the window size
++ (the size of the history buffer). It should be in the range 8..15 for this
++ version of the library. Larger values of this parameter result in better
++ compression at the expense of memory usage. The default value is 15 if
++ deflateInit is used instead.
++
++ windowBits can also be -8..-15 for raw deflate. In this case, -windowBits
++ determines the window size. deflate() will then generate raw deflate data
++ with no zlib header or trailer, and will not compute an adler32 check value.
++
++ windowBits can also be greater than 15 for optional gzip encoding. Add
++ 16 to windowBits to write a simple gzip header and trailer around the
++ compressed data instead of a zlib wrapper. The gzip header will have no
++ file name, no extra data, no comment, no modification time (set to zero),
++ no header crc, and the operating system will be set to 255 (unknown).
++
++ The memLevel parameter specifies how much memory should be allocated
++ for the internal compression state. memLevel=1 uses minimum memory but
++ is slow and reduces compression ratio; memLevel=9 uses maximum memory
++ for optimal speed. The default value is 8. See zconf.h for total memory
++ usage as a function of windowBits and memLevel.
++
++ The strategy parameter is used to tune the compression algorithm. Use the
++ value Z\_DEFAULT\_STRATEGY for normal data, Z\_FILTERED for data produced by a
++ filter (or predictor), Z\_HUFFMAN\_ONLY to force Huffman encoding only (no
++ string match), or Z\_RLE to limit match distances to one (run-length
++ encoding). Filtered data consists mostly of small values with a somewhat
++ random distribution. In this case, the compression algorithm is tuned to
++ compress them better. The effect of Z\_FILTERED is to force more Huffman
++ coding and less string matching; it is somewhat intermediate between
++ Z\_DEFAULT and Z\_HUFFMAN\_ONLY. Z\_RLE is designed to be almost as fast as
++ Z\_HUFFMAN\_ONLY, but give better compression for PNG image data. The strategy
++ parameter only affects the compression ratio but not the correctness of the
++ compressed output even if it is not set appropriately.
++
++ deflateInit2 returns Z\_OK if success, Z\_MEM\_ERROR if there was not enough
++ memory, Z\_STREAM\_ERROR if a parameter is invalid (such as an invalid
++ method). msg is set to null if there is no error message. deflateInit2 does
++ not perform any compression: this will be done by deflate().
++\*/
++
++ZEXTERN int ZEXPORT deflateSetDictionary OF((z\_streamp strm,
++ const Bytef \*dictionary,
++ uInt dictLength));
++/\*
++ Initializes the compression dictionary from the given byte sequence
++ without producing any compressed output. This function must be called
++ immediately after deflateInit, deflateInit2 or deflateReset, before any
++ call of deflate. The compressor and decompressor must use exactly the same
++ dictionary (see inflateSetDictionary).
++
++ The dictionary should consist of strings (byte sequences) that are likely
++ to be encountered later in the data to be compressed, with the most commonly
++ used strings preferably put towards the end of the dictionary. Using a
++ dictionary is most useful when the data to be compressed is short and can be
++ predicted with good accuracy; the data can then be compressed better than
++ with the default empty dictionary.
++
++ Depending on the size of the compression data structures selected by
++ deflateInit or deflateInit2, a part of the dictionary may in effect be
++ discarded, for example if the dictionary is larger than the window size in
++ deflate or deflate2. Thus the strings most likely to be useful should be
++ put at the end of the dictionary, not at the front.
++
++ Upon return of this function, strm->adler is set to the adler32 value
++ of the dictionary; the decompressor may later use this value to determine
++ which dictionary has been used by the compressor. (The adler32 value
++ applies to the whole dictionary even if only a subset of the dictionary is
++ actually used by the compressor.) If a raw deflate was requested, then the
++ adler32 value is not computed and strm->adler is not set.
++
++ deflateSetDictionary returns Z\_OK if success, or Z\_STREAM\_ERROR if a
++ parameter is invalid (such as NULL dictionary) or the stream state is
++ inconsistent (for example if deflate has already been called for this stream
++ or if the compression method is bsort). deflateSetDictionary does not
++ perform any compression: this will be done by deflate().
++\*/
++
++ZEXTERN int ZEXPORT deflateCopy OF((z\_streamp dest,
++ z\_streamp source));
++/\*
++ Sets the destination stream as a complete copy of the source stream.
++
++ This function can be useful when several compression strategies will be
++ tried, for example when there are several ways of pre-processing the input
++ data with a filter. The streams that will be discarded should then be freed
++ by calling deflateEnd. Note that deflateCopy duplicates the internal
++ compression state which can be quite large, so this strategy is slow and
++ can consume lots of memory.
++
++ deflateCopy returns Z\_OK if success, Z\_MEM\_ERROR if there was not
++ enough memory, Z\_STREAM\_ERROR if the source stream state was inconsistent
++ (such as zalloc being NULL). msg is left unchanged in both source and
++ destination.
++\*/
++
++ZEXTERN int ZEXPORT deflateReset OF((z\_streamp strm));
++/\*
++ This function is equivalent to deflateEnd followed by deflateInit,
++ but does not free and reallocate all the internal compression state.
++ The stream will keep the same compression level and any other attributes
++ that may have been set by deflateInit2.
++
++ deflateReset returns Z\_OK if success, or Z\_STREAM\_ERROR if the source
++ stream state was inconsistent (such as zalloc or state being NULL).
++\*/
++
++ZEXTERN int ZEXPORT deflateParams OF((z\_streamp strm,
++ int level,
++ int strategy));
++/\*
++ Dynamically update the compression level and compression strategy. The
++ interpretation of level and strategy is as in deflateInit2. This can be
++ used to switch between compression and straight copy of the input data, or
++ to switch to a different kind of input data requiring a different
++ strategy. If the compression level is changed, the input available so far
++ is compressed with the old level (and may be flushed); the new level will
++ take effect only at the next call of deflate().
++
++ Before the call of deflateParams, the stream state must be set as for
++ a call of deflate(), since the currently available input may have to
++ be compressed and flushed. In particular, strm->avail\_out must be non-zero.
++
++ deflateParams returns Z\_OK if success, Z\_STREAM\_ERROR if the source
++ stream state was inconsistent or if a parameter was invalid, Z\_BUF\_ERROR
++ if strm->avail\_out was zero.
++\*/
++
++ZEXTERN uLong ZEXPORT deflateBound OF((z\_streamp strm,
++ uLong sourceLen));
++/\*
++ deflateBound() returns an upper bound on the compressed size after
++ deflation of sourceLen bytes. It must be called after deflateInit()
++ or deflateInit2(). This would be used to allocate an output buffer
++ for deflation in a single pass, and so would be called before deflate().
++\*/
++
++ZEXTERN int ZEXPORT deflatePrime OF((z\_streamp strm,
++ int bits,
++ int value));
++/\*
++ deflatePrime() inserts bits in the deflate output stream. The intent
++ is that this function is used to start off the deflate output with the
++ bits leftover from a previous deflate stream when appending to it. As such,
++ this function can only be used for raw deflate, and must be used before the
++ first deflate() call after a deflateInit2() or deflateReset(). bits must be
++ less than or equal to 16, and that many of the least significant bits of
++ value will be inserted in the output.
++
++ deflatePrime returns Z\_OK if success, or Z\_STREAM\_ERROR if the source
++ stream state was inconsistent.
++\*/
++
++/\*
++ZEXTERN int ZEXPORT inflateInit2 OF((z\_streamp strm,
++ int windowBits));
++
++ This is another version of inflateInit with an extra parameter. The
++ fields next\_in, avail\_in, zalloc, zfree and opaque must be initialized
++ before by the caller.
++
++ The windowBits parameter is the base two logarithm of the maximum window
++ size (the size of the history buffer). It should be in the range 8..15 for
++ this version of the library. The default value is 15 if inflateInit is used
++ instead. windowBits must be greater than or equal to the windowBits value
++ provided to deflateInit2() while compressing, or it must be equal to 15 if
++ deflateInit2() was not used. If a compressed stream with a larger window
++ size is given as input, inflate() will return with the error code
++ Z\_DATA\_ERROR instead of trying to allocate a larger window.
++
++ windowBits can also be -8..-15 for raw inflate. In this case, -windowBits
++ determines the window size. inflate() will then process raw deflate data,
++ not looking for a zlib or gzip header, not generating a check value, and not
++ looking for any check values for comparison at the end of the stream. This
++ is for use with other formats that use the deflate compressed data format
++ such as zip. Those formats provide their own check values. If a custom
++ format is developed using the raw deflate format for compressed data, it is
++ recommended that a check value such as an adler32 or a crc32 be applied to
++ the uncompressed data as is done in the zlib, gzip, and zip formats. For
++ most applications, the zlib format should be used as is. Note that comments
++ above on the use in deflateInit2() applies to the magnitude of windowBits.
++
++ windowBits can also be greater than 15 for optional gzip decoding. Add
++ 32 to windowBits to enable zlib and gzip decoding with automatic header
++ detection, or add 16 to decode only the gzip format (the zlib format will
++ return a Z\_DATA\_ERROR).
++
++ inflateInit2 returns Z\_OK if success, Z\_MEM\_ERROR if there was not enough
++ memory, Z\_STREAM\_ERROR if a parameter is invalid (such as a negative
++ memLevel). msg is set to null if there is no error message. inflateInit2
++ does not perform any decompression apart from reading the zlib header if
++ present: this will be done by inflate(). (So next\_in and avail\_in may be
++ modified, but next\_out and avail\_out are unchanged.)
++\*/
++
++ZEXTERN int ZEXPORT inflateSetDictionary OF((z\_streamp strm,
++ const Bytef \*dictionary,
++ uInt dictLength));
++/\*
++ Initializes the decompression dictionary from the given uncompressed byte
++ sequence. This function must be called immediately after a call of inflate
++ if this call returned Z\_NEED\_DICT. The dictionary chosen by the compressor
++ can be determined from the adler32 value returned by this call of
++ inflate. The compressor and decompressor must use exactly the same
++ dictionary (see deflateSetDictionary).
++
++ inflateSetDictionary returns Z\_OK if success, Z\_STREAM\_ERROR if a
++ parameter is invalid (such as NULL dictionary) or the stream state is
++ inconsistent, Z\_DATA\_ERROR if the given dictionary doesn't match the
++ expected one (incorrect adler32 value). inflateSetDictionary does not
++ perform any decompression: this will be done by subsequent calls of
++ inflate().
++\*/
++
++ZEXTERN int ZEXPORT inflateSync OF((z\_streamp strm));
++/\*
++ Skips invalid compressed data until a full flush point (see above the
++ description of deflate with Z\_FULL\_FLUSH) can be found, or until all
++ available input is skipped. No output is provided.
++
++ inflateSync returns Z\_OK if a full flush point has been found, Z\_BUF\_ERROR
++ if no more input was provided, Z\_DATA\_ERROR if no flush point has been found,
++ or Z\_STREAM\_ERROR if the stream structure was inconsistent. In the success
++ case, the application may save the current current value of total\_in which
++ indicates where valid compressed data was found. In the error case, the
++ application may repeatedly call inflateSync, providing more input each time,
++ until success or end of the input data.
++\*/
++
++ZEXTERN int ZEXPORT inflateCopy OF((z\_streamp dest,
++ z\_streamp source));
++/\*
++ Sets the destination stream as a complete copy of the source stream.
++
++ This function can be useful when randomly accessing a large stream. The
++ first pass through the stream can periodically record the inflate state,
++ allowing restarting inflate at those points when randomly accessing the
++ stream.
++
++ inflateCopy returns Z\_OK if success, Z\_MEM\_ERROR if there was not
++ enough memory, Z\_STREAM\_ERROR if the source stream state was inconsistent
++ (such as zalloc being NULL). msg is left unchanged in both source and
++ destination.
++\*/
++
++ZEXTERN int ZEXPORT inflateReset OF((z\_streamp strm));
++/\*
++ This function is equivalent to inflateEnd followed by inflateInit,
++ but does not free and reallocate all the internal decompression state.
++ The stream will keep attributes that may have been set by inflateInit2.
++
++ inflateReset returns Z\_OK if success, or Z\_STREAM\_ERROR if the source
++ stream state was inconsistent (such as zalloc or state being NULL).
++\*/
++
++/\*
++ZEXTERN int ZEXPORT inflateBackInit OF((z\_stream FAR \*strm, int windowBits,
++ unsigned char FAR \*window));
++
++ Initialize the internal stream state for decompression using inflateBack()
++ calls. The fields zalloc, zfree and opaque in strm must be initialized
++ before the call. If zalloc and zfree are Z\_NULL, then the default library-
++ derived memory allocation routines are used. windowBits is the base two
++ logarithm of the window size, in the range 8..15. window is a caller
++ supplied buffer of that size. Except for special applications where it is
++ assured that deflate was used with small window sizes, windowBits must be 15
++ and a 32K byte window must be supplied to be able to decompress general
++ deflate streams.
++
++ See inflateBack() for the usage of these routines.
++
++ inflateBackInit will return Z\_OK on success, Z\_STREAM\_ERROR if any of
++ the paramaters are invalid, Z\_MEM\_ERROR if the internal state could not
++ be allocated, or Z\_VERSION\_ERROR if the version of the library does not
++ match the version of the header file.
++\*/
++
++typedef unsigned (\*in\_func) OF((void FAR \*, unsigned char FAR \* FAR \*));
++typedef int (\*out\_func) OF((void FAR \*, unsigned char FAR \*, unsigned));
++
++ZEXTERN int ZEXPORT inflateBack OF((z\_stream FAR \*strm,
++ in\_func in, void FAR \*in\_desc,
++ out\_func out, void FAR \*out\_desc));
++/\*
++ inflateBack() does a raw inflate with a single call using a call-back
++ interface for input and output. This is more efficient than inflate() for
++ file i/o applications in that it avoids copying between the output and the
++ sliding window by simply making the window itself the output buffer. This
++ function trusts the application to not change the output buffer passed by
++ the output function, at least until inflateBack() returns.
++
++ inflateBackInit() must be called first to allocate the internal state
++ and to initialize the state with the user-provided window buffer.
++ inflateBack() may then be used multiple times to inflate a complete, raw
++ deflate stream with each call. inflateBackEnd() is then called to free
++ the allocated state.
++
++ A raw deflate stream is one with no zlib or gzip header or trailer.
++ This routine would normally be used in a utility that reads zip or gzip
++ files and writes out uncompressed files. The utility would decode the
++ header and process the trailer on its own, hence this routine expects
++ only the raw deflate stream to decompress. This is different from the
++ normal behavior of inflate(), which expects either a zlib or gzip header and
++ trailer around the deflate stream.
++
++ inflateBack() uses two subroutines supplied by the caller that are then
++ called by inflateBack() for input and output. inflateBack() calls those
++ routines until it reads a complete deflate stream and writes out all of the
++ uncompressed data, or until it encounters an error. The function's
++ parameters and return types are defined above in the in\_func and out\_func
++ typedefs. inflateBack() will call in(in\_desc, &buf) which should return the
++ number of bytes of provided input, and a pointer to that input in buf. If
++ there is no input available, in() must return zero--buf is ignored in that
++ case--and inflateBack() will return a buffer error. inflateBack() will call
++ out(out\_desc, buf, len) to write the uncompressed data buf[0..len-1]. out()
++ should return zero on success, or non-zero on failure. If out() returns
++ non-zero, inflateBack() will return with an error. Neither in() nor out()
++ are permitted to change the contents of the window provided to
++ inflateBackInit(), which is also the buffer that out() uses to write from.
++ The length written by out() will be at most the window size. Any non-zero
++ amount of input may be provided by in().
++
++ For convenience, inflateBack() can be provided input on the first call by
++ setting strm->next\_in and strm->avail\_in. If that input is exhausted, then
++ in() will be called. Therefore strm->next\_in must be initialized before
++ calling inflateBack(). If strm->next\_in is Z\_NULL, then in() will be called
++ immediately for input. If strm->next\_in is not Z\_NULL, then strm->avail\_in
++ must also be initialized, and then if strm->avail\_in is not zero, input will
++ initially be taken from strm->next\_in[0 .. strm->avail\_in - 1].
++
++ The in\_desc and out\_desc parameters of inflateBack() is passed as the
++ first parameter of in() and out() respectively when they are called. These
++ descriptors can be optionally used to pass any information that the caller-
++ supplied in() and out() functions need to do their job.
++
++ On return, inflateBack() will set strm->next\_in and strm->avail\_in to
++ pass back any unused input that was provided by the last in() call. The
++ return values of inflateBack() can be Z\_STREAM\_END on success, Z\_BUF\_ERROR
++ if in() or out() returned an error, Z\_DATA\_ERROR if there was a format
++ error in the deflate stream (in which case strm->msg is set to indicate the
++ nature of the error), or Z\_STREAM\_ERROR if the stream was not properly
++ initialized. In the case of Z\_BUF\_ERROR, an input or output error can be
++ distinguished using strm->next\_in which will be Z\_NULL only if in() returned
++ an error. If strm->next is not Z\_NULL, then the Z\_BUF\_ERROR was due to
++ out() returning non-zero. (in() will always be called before out(), so
++ strm->next\_in is assured to be defined if out() returns non-zero.) Note
++ that inflateBack() cannot return Z\_OK.
++\*/
++
++ZEXTERN int ZEXPORT inflateBackEnd OF((z\_stream FAR \*strm));
++/\*
++ All memory allocated by inflateBackInit() is freed.
++
++ inflateBackEnd() returns Z\_OK on success, or Z\_STREAM\_ERROR if the stream
++ state was inconsistent.
++\*/
++
++ZEXTERN uLong ZEXPORT zlibCompileFlags OF((void));
++/\* Return flags indicating compile-time options.
++
++ Type sizes, two bits each, 00 = 16 bits, 01 = 32, 10 = 64, 11 = other:
++ 1.0: size of uInt
++ 3.2: size of uLong
++ 5.4: size of voidpf (pointer)
++ 7.6: size of z\_off\_t
++
++ Compiler, assembler, and debug options:
++ 8: DEBUG
++ 9: ASMV or ASMINF -- use ASM code
++ 10: ZLIB\_WINAPI -- exported functions use the WINAPI calling convention
++ 11: 0 (reserved)
++
++ One-time table building (smaller code, but not thread-safe if true):
++ 12: BUILDFIXED -- build static block decoding tables when needed
++ 13: DYNAMIC\_CRC\_TABLE -- build CRC calculation tables when needed
++ 14,15: 0 (reserved)
++
++ Library content (indicates missing functionality):
++ 16: NO\_GZCOMPRESS -- gz\* functions cannot compress (to avoid linking
++ deflate code when not needed)
++ 17: NO\_GZIP -- deflate can't write gzip streams, and inflate can't detect
++ and decode gzip streams (to avoid linking crc code)
++ 18-19: 0 (reserved)
++
++ Operation variations (changes in library functionality):
++ 20: PKZIP\_BUG\_WORKAROUND -- slightly more permissive inflate
++ 21: FASTEST -- deflate algorithm with only one, lowest compression level
++ 22,23: 0 (reserved)
++
++ The sprintf variant used by gzprintf (zero is best):
++ 24: 0 = vs\*, 1 = s\* -- 1 means limited to 20 arguments after the format
++ 25: 0 = \*nprintf, 1 = \*printf -- 1 means gzprintf() not secure!
++ 26: 0 = returns value, 1 = void -- 1 means inferred string length returned
++
++ Remainder:
++ 27-31: 0 (reserved)
++ \*/
++
++
++ /\* utility functions \*/
++
++/\*
++ The following utility functions are implemented on top of the
++ basic stream-oriented functions. To simplify the interface, some
++ default options are assumed (compression level and memory usage,
++ standard memory allocation functions). The source code of these
++ utility functions can easily be modified if you need special options.
++\*/
++
++ZEXTERN int ZEXPORT compress OF((Bytef \*dest, uLongf \*destLen,
++ const Bytef \*source, uLong sourceLen));
++/\*
++ Compresses the source buffer into the destination buffer. sourceLen is
++ the byte length of the source buffer. Upon entry, destLen is the total
++ size of the destination buffer, which must be at least the value returned
++ by compressBound(sourceLen). Upon exit, destLen is the actual size of the
++ compressed buffer.
++ This function can be used to compress a whole file at once if the
++ input file is mmap'ed.
++ compress returns Z\_OK if success, Z\_MEM\_ERROR if there was not
++ enough memory, Z\_BUF\_ERROR if there was not enough room in the output
++ buffer.
++\*/
++
++ZEXTERN int ZEXPORT compress2 OF((Bytef \*dest, uLongf \*destLen,
++ const Bytef \*source, uLong sourceLen,
++ int level));
++/\*
++ Compresses the source buffer into the destination buffer. The level
++ parameter has the same meaning as in deflateInit. sourceLen is the byte
++ length of the source buffer. Upon entry, destLen is the total size of the
++ destination buffer, which must be at least the value returned by
++ compressBound(sourceLen). Upon exit, destLen is the actual size of the
++ compressed buffer.
++
++ compress2 returns Z\_OK if success, Z\_MEM\_ERROR if there was not enough
++ memory, Z\_BUF\_ERROR if there was not enough room in the output buffer,
++ Z\_STREAM\_ERROR if the level parameter is invalid.
++\*/
++
++ZEXTERN uLong ZEXPORT compressBound OF((uLong sourceLen));
++/\*
++ compressBound() returns an upper bound on the compressed size after
++ compress() or compress2() on sourceLen bytes. It would be used before
++ a compress() or compress2() call to allocate the destination buffer.
++\*/
++
++ZEXTERN int ZEXPORT uncompress OF((Bytef \*dest, uLongf \*destLen,
++ const Bytef \*source, uLong sourceLen));
++/\*
++ Decompresses the source buffer into the destination buffer. sourceLen is
++ the byte length of the source buffer. Upon entry, destLen is the total
++ size of the destination buffer, which must be large enough to hold the
++ entire uncompressed data. (The size of the uncompressed data must have
++ been saved previously by the compressor and transmitted to the decompressor
++ by some mechanism outside the scope of this compression library.)
++ Upon exit, destLen is the actual size of the compressed buffer.
++ This function can be used to decompress a whole file at once if the
++ input file is mmap'ed.
++
++ uncompress returns Z\_OK if success, Z\_MEM\_ERROR if there was not
++ enough memory, Z\_BUF\_ERROR if there was not enough room in the output
++ buffer, or Z\_DATA\_ERROR if the input data was corrupted or incomplete.
++\*/
++
++
++typedef voidp gzFile;
++
++ZEXTERN gzFile ZEXPORT gzopen OF((const char \*path, const char \*mode));
++/\*
++ Opens a gzip (.gz) file for reading or writing. The mode parameter
++ is as in fopen ("rb" or "wb") but can also include a compression level
++ ("wb9") or a strategy: 'f' for filtered data as in "wb6f", 'h' for
++ Huffman only compression as in "wb1h", or 'R' for run-length encoding
++ as in "wb1R". (See the description of deflateInit2 for more information
++ about the strategy parameter.)
++
++ gzopen can be used to read a file which is not in gzip format; in this
++ case gzread will directly read from the file without decompression.
++
++ gzopen returns NULL if the file could not be opened or if there was
++ insufficient memory to allocate the (de)compression state; errno
++ can be checked to distinguish the two cases (if errno is zero, the
++ zlib error is Z\_MEM\_ERROR). \*/
++
++ZEXTERN gzFile ZEXPORT gzdopen OF((int fd, const char \*mode));
++/\*
++ gzdopen() associates a gzFile with the file descriptor fd. File
++ descriptors are obtained from calls like open, dup, creat, pipe or
++ fileno (in the file has been previously opened with fopen).
++ The mode parameter is as in gzopen.
++ The next call of gzclose on the returned gzFile will also close the
++ file descriptor fd, just like fclose(fdopen(fd), mode) closes the file
++ descriptor fd. If you want to keep fd open, use gzdopen(dup(fd), mode).
++ gzdopen returns NULL if there was insufficient memory to allocate
++ the (de)compression state.
++\*/
++
++ZEXTERN int ZEXPORT gzsetparams OF((gzFile file, int level, int strategy));
++/\*
++ Dynamically update the compression level or strategy. See the description
++ of deflateInit2 for the meaning of these parameters.
++ gzsetparams returns Z\_OK if success, or Z\_STREAM\_ERROR if the file was not
++ opened for writing.
++\*/
++
++ZEXTERN int ZEXPORT gzread OF((gzFile file, voidp buf, unsigned len));
++/\*
++ Reads the given number of uncompressed bytes from the compressed file.
++ If the input file was not in gzip format, gzread copies the given number
++ of bytes into the buffer.
++ gzread returns the number of uncompressed bytes actually read (0 for
++ end of file, -1 for error). \*/
++
++ZEXTERN int ZEXPORT gzwrite OF((gzFile file,
++ voidpc buf, unsigned len));
++/\*
++ Writes the given number of uncompressed bytes into the compressed file.
++ gzwrite returns the number of uncompressed bytes actually written
++ (0 in case of error).
++\*/
++
++ZEXTERN int ZEXPORTVA gzprintf OF((gzFile file, const char \*format, ...));
++/\*
++ Converts, formats, and writes the args to the compressed file under
++ control of the format string, as in fprintf. gzprintf returns the number of
++ uncompressed bytes actually written (0 in case of error). The number of
++ uncompressed bytes written is limited to 4095. The caller should assure that
++ this limit is not exceeded. If it is exceeded, then gzprintf() will return
++ return an error (0) with nothing written. In this case, there may also be a
++ buffer overflow with unpredictable consequences, which is possible only if
++ zlib was compiled with the insecure functions sprintf() or vsprintf()
++ because the secure snprintf() or vsnprintf() functions were not available.
++\*/
++
++ZEXTERN int ZEXPORT gzputs OF((gzFile file, const char \*s));
++/\*
++ Writes the given null-terminated string to the compressed file, excluding
++ the terminating null character.
++ gzputs returns the number of characters written, or -1 in case of error.
++\*/
++
++ZEXTERN char \* ZEXPORT gzgets OF((gzFile file, char \*buf, int len));
++/\*
++ Reads bytes from the compressed file until len-1 characters are read, or
++ a newline character is read and transferred to buf, or an end-of-file
++ condition is encountered. The string is then terminated with a null
++ character.
++ gzgets returns buf, or Z\_NULL in case of error.
++\*/
++
++ZEXTERN int ZEXPORT gzputc OF((gzFile file, int c));
++/\*
++ Writes c, converted to an unsigned char, into the compressed file.
++ gzputc returns the value that was written, or -1 in case of error.
++\*/
++
++ZEXTERN int ZEXPORT gzgetc OF((gzFile file));
++/\*
++ Reads one byte from the compressed file. gzgetc returns this byte
++ or -1 in case of end of file or error.
++\*/
++
++ZEXTERN int ZEXPORT gzungetc OF((int c, gzFile file));
++/\*
++ Push one character back onto the stream to be read again later.
++ Only one character of push-back is allowed. gzungetc() returns the
++ character pushed, or -1 on failure. gzungetc() will fail if a
++ character has been pushed but not read yet, or if c is -1. The pushed
++ character will be discarded if the stream is repositioned with gzseek()
++ or gzrewind().
++\*/
++
++ZEXTERN int ZEXPORT gzflush OF((gzFile file, int flush));
++/\*
++ Flushes all pending output into the compressed file. The parameter
++ flush is as in the deflate() function. The return value is the zlib
++ error number (see function gzerror below). gzflush returns Z\_OK if
++ the flush parameter is Z\_FINISH and all output could be flushed.
++ gzflush should be called only when strictly necessary because it can
++ degrade compression.
++\*/
++
++ZEXTERN z\_off\_t ZEXPORT gzseek OF((gzFile file,
++ z\_off\_t offset, int whence));
++/\*
++ Sets the starting position for the next gzread or gzwrite on the
++ given compressed file. The offset represents a number of bytes in the
++ uncompressed data stream. The whence parameter is defined as in lseek(2);
++ the value SEEK\_END is not supported.
++ If the file is opened for reading, this function is emulated but can be
++ extremely slow. If the file is opened for writing, only forward seeks are
++ supported; gzseek then compresses a sequence of zeroes up to the new
++ starting position.
++
++ gzseek returns the resulting offset location as measured in bytes from
++ the beginning of the uncompressed stream, or -1 in case of error, in
++ particular if the file is opened for writing and the new starting position
++ would be before the current position.
++\*/
++
++ZEXTERN int ZEXPORT gzrewind OF((gzFile file));
++/\*
++ Rewinds the given file. This function is supported only for reading.
++
++ gzrewind(file) is equivalent to (int)gzseek(file, 0L, SEEK\_SET)
++\*/
++
++ZEXTERN z\_off\_t ZEXPORT gztell OF((gzFile file));
++/\*
++ Returns the starting position for the next gzread or gzwrite on the
++ given compressed file. This position represents a number of bytes in the
++ uncompressed data stream.
++
++ gztell(file) is equivalent to gzseek(file, 0L, SEEK\_CUR)
++\*/
++
++ZEXTERN int ZEXPORT gzeof OF((gzFile file));
++/\*
++ Returns 1 when EOF has previously been detected reading the given
++ input stream, otherwise zero.
++\*/
++
++ZEXTERN int ZEXPORT gzclose OF((gzFile file));
++/\*
++ Flushes all pending output if necessary, closes the compressed file
++ and deallocates all the (de)compression state. The return value is the zlib
++ error number (see function gzerror below).
++\*/
++
++ZEXTERN const char \* ZEXPORT gzerror OF((gzFile file, int \*errnum));
++/\*
++ Returns the error message for the last error which occurred on the
++ given compressed file. errnum is set to zlib error number. If an
++ error occurred in the file system and not in the compression library,
++ errnum is set to Z\_ERRNO and the application may consult errno
++ to get the exact error code.
++\*/
++
++ZEXTERN void ZEXPORT gzclearerr OF((gzFile file));
++/\*
++ Clears the error and end-of-file flags for file. This is analogous to the
++ clearerr() function in stdio. This is useful for continuing to read a gzip
++ file that is being written concurrently.
++\*/
++
++ /\* checksum functions \*/
++
++/\*
++ These functions are not related to compression but are exported
++ anyway because they might be useful in applications using the
++ compression library.
++\*/
++
++ZEXTERN uLong ZEXPORT adler32 OF((uLong adler, const Bytef \*buf, uInt len));
++
++/\*
++ Update a running Adler-32 checksum with the bytes buf[0..len-1] and
++ return the updated checksum. If buf is NULL, this function returns
++ the required initial value for the checksum.
++ An Adler-32 checksum is almost as reliable as a CRC32 but can be computed
++ much faster. Usage example:
++
++ uLong adler = adler32(0L, Z\_NULL, 0);
++
++ while (read\_buffer(buffer, length) != EOF) {
++ adler = adler32(adler, buffer, length);
++ }
++ if (adler != original\_adler) error();
++\*/
++
++ZEXTERN uLong ZEXPORT crc32 OF((uLong crc, const Bytef \*buf, uInt len));
++/\*
++ Update a running crc with the bytes buf[0..len-1] and return the updated
++ crc. If buf is NULL, this function returns the required initial value
++ for the crc. Pre- and post-conditioning (one's complement) is performed
++ within this function so it shouldn't be done by the application.
++ Usage example:
++
++ uLong crc = crc32(0L, Z\_NULL, 0);
++
++ while (read\_buffer(buffer, length) != EOF) {
++ crc = crc32(crc, buffer, length);
++ }
++ if (crc != original\_crc) error();
++\*/
++
++
++ /\* various hacks, don't look :) \*/
++
++/\* deflateInit and inflateInit are macros to allow checking the zlib version
++ \* and the compiler's view of z\_stream:
++ \*/
++ZEXTERN int ZEXPORT deflateInit\_ OF((z\_streamp strm, int level,
++ const char \*version, int stream\_size));
++ZEXTERN int ZEXPORT inflateInit\_ OF((z\_streamp strm,
++ const char \*version, int stream\_size));
++ZEXTERN int ZEXPORT deflateInit2\_ OF((z\_streamp strm, int level, int method,
++ int windowBits, int memLevel,
++ int strategy, const char \*version,
++ int stream\_size));
++ZEXTERN int ZEXPORT inflateInit2\_ OF((z\_streamp strm, int windowBits,
++ const char \*version, int stream\_size));
++ZEXTERN int ZEXPORT inflateBackInit\_ OF((z\_stream FAR \*strm, int windowBits,
++ unsigned char FAR \*window,
++ const char \*version,
++ int stream\_size));
++#define deflateInit(strm, level) \
++ deflateInit\_((strm), (level), ZLIB\_VERSION, sizeof(z\_stream))
++#define inflateInit(strm) \
++ inflateInit\_((strm), ZLIB\_VERSION, sizeof(z\_stream))
++#define deflateInit2(strm, level, method, windowBits, memLevel, strategy) \
++ deflateInit2\_((strm),(level),(method),(windowBits),(memLevel),\
++ (strategy), ZLIB\_VERSION, sizeof(z\_stream))
++#define inflateInit2(strm, windowBits) \
++ inflateInit2\_((strm), (windowBits), ZLIB\_VERSION, sizeof(z\_stream))
++#define inflateBackInit(strm, windowBits, window) \
++ inflateBackInit\_((strm), (windowBits), (window), \
++ ZLIB\_VERSION, sizeof(z\_stream))
++
++
++#if !defined(ZUTIL\_H) && !defined(NO\_DUMMY\_DECL)
++ struct internal\_state {int dummy;}; /\* hack for buggy compilers \*/
++#endif
++
++ZEXTERN const char \* ZEXPORT zError OF((int err));
++ZEXTERN int ZEXPORT inflateSyncPoint OF((z\_streamp z));
++ZEXTERN const uLongf \* ZEXPORT get\_crc\_table OF((void));
++
++#ifdef \_\_cplusplus
++}
++#endif
++
++#endif /\* ZLIB\_H \*/
--- php5-5.3.2.orig/debian/patches/php5-pear-CVE-2011-1144-regression.patch
+++ php5-5.3.2/debian/patches/php5-pear-CVE-2011-1144-regression.patch
@@ -0,0 +1,45 @@
+Subject: Bug #18340raiseErro typo
+Origin: http://svn.php.net/viewvc?view=revision&revision=308983
+
+Also includes http://svn.php.net/viewvc?view=revision&revision=309593
+
+ Fixed Bug #18388: Parenteses error in REST.php line 232 [dufuz]
+
+--- PEAR/REST.php.old 2011-03-18 16:33:00.000000000 -0300
++++ PEAR/REST.php 2011-03-22 18:46:25.000000000 -0300
+@@ -102,7 +102,7 @@
+ // reset the age of the cache if the server says it was unmodified
+ $result = $this->saveCache($url, $ret, null, true, $cacheId);
+ if (PEAR::isError($result)) {
+- return PEAR::raiseErro($result->getMessage());
++ return PEAR::raiseError($result->getMessage());
+ }
+ }
+
+@@ -122,7 +122,7 @@
+ if ($forcestring) {
+ $result = $this->saveCache($url, $content, $lastmodified, false, $cacheId);
+ if (PEAR::isError($result)) {
+- return PEAR::raiseErro($result->getMessage());
++ return PEAR::raiseError($result->getMessage());
+ }
+
+ return $content;
+@@ -162,7 +162,7 @@
+
+ $result = $this->saveCache($url, $content, $lastmodified, false, $cacheId);
+ if (PEAR::isError($result)) {
+- return PEAR::raiseErro($result->getMessage());
++ return PEAR::raiseError($result->getMessage());
+ }
+
+ return $content;
+@@ -229,7 +229,7 @@
+ $cachefile = $d . 'rest.cachefile';
+
+ if (!is\_dir($cache\_dir)) {
+- if (System::mkdir(array('-p', $cache\_dir) === false)) {
++ if (System::mkdir(array('-p', $cache\_dir)) === false) {
+ return PEAR::raiseError("The value of config option cache\_dir ($cache\_dir) is not a directory and attempts to create the directory failed.");
+ }
+ }
--- php5-5.3.2.orig/debian/patches/mssql-null-exception.patch
+++ php5-5.3.2/debian/patches/mssql-null-exception.patch
@@ -0,0 +1,13 @@
+--- a/ext/pdo\_dblib/dblib\_driver.c
++++ b/ext/pdo\_dblib/dblib\_driver.c
+@@ -230,8 +230,10 @@ static int pdo\_dblib\_handle\_factory(pdo\_
+ goto cleanup;
+ }
+
++#if PHP\_DBLIB\_IS\_MSSQL
+ /\* dblib do not return more than this length from text/image \*/
+ DBSETOPT(H->link, DBTEXTLIMIT, "2147483647");
++#endif
+
+ /\* limit text/image from network \*/
+ DBSETOPT(H->link, DBTEXTSIZE, "2147483647");
--- php5-5.3.2.orig/debian/patches/enchant\_unaligned\_memory\_access.patch
+++ php5-5.3.2/debian/patches/enchant\_unaligned\_memory\_access.patch
@@ -0,0 +1,45 @@
+Description: Fix an unaligned memory access in enchant\_dict\_suggest()
+Origin: vendor
+Forwarded: http://bugs.php.net/51289
+Last-Update: 2010-03-12
+
+Index: php/ext/enchant/enchant.c
+===================================================================
+--- php.orig/ext/enchant/enchant.c
++++ php/ext/enchant/enchant.c
+@@ -724,6 +724,7 @@ PHP\_FUNCTION(enchant\_dict\_quick\_check)
+
+ if (enchant\_dict\_check(pdict->pdict, word, wordlen) > 0) {
+ int n\_sugg;
++ size\_t n\_sugg\_st;
+ char \*\*suggs;
+
+ if (!sugg && ZEND\_NUM\_ARGS() == 2) {
+@@ -732,7 +733,8 @@ PHP\_FUNCTION(enchant\_dict\_quick\_check)
+
+ array\_init(sugg);
+
+- suggs = enchant\_dict\_suggest(pdict->pdict, word, wordlen, (size\_t \*) &n\_sugg);
++ suggs = enchant\_dict\_suggest(pdict->pdict, word, wordlen, n\_sugg\_st);
++ memcpy(&n\_sugg, &n\_sugg\_st, sizeof(n\_sugg));
+ if (suggs && n\_sugg) {
+ int i;
+ for (i = 0; i < n\_sugg; i++) {
+@@ -777,6 +779,7 @@ PHP\_FUNCTION(enchant\_dict\_suggest)
+ char \*\*suggs;
+ enchant\_dict \*pdict;
+ int n\_sugg;
++ size\_t n\_sugg\_st;
+
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "rs", &dict, &word, &wordlen) == FAILURE) {
+ RETURN\_FALSE;
+@@ -784,7 +787,8 @@ PHP\_FUNCTION(enchant\_dict\_suggest)
+
+ PHP\_ENCHANT\_GET\_DICT;
+
+- suggs = enchant\_dict\_suggest(pdict->pdict, word, wordlen, (size\_t \*)&n\_sugg);
++ suggs = enchant\_dict\_suggest(pdict->pdict, word, wordlen, &n\_sugg\_st);
++ memcpy(&n\_sugg, &n\_sugg\_st, sizeof(n\_sugg));
+ if (suggs && n\_sugg) {
+ int i;
+
--- php5-5.3.2.orig/debian/patches/fix-mysql-badmem.patch
+++ php5-5.3.2/debian/patches/fix-mysql-badmem.patch
@@ -0,0 +1,49 @@
+diff -Naurp php-5.3.2.orig/ext/mysqli/mysqli\_api.c php-5.3.2/ext/mysqli/mysqli\_api.c
+--- php-5.3.2.orig/ext/mysqli/mysqli\_api.c 2010-02-04 15:28:55.000000000 -0500
++++ php-5.3.2/ext/mysqli/mysqli\_api.c 2010-04-26 08:20:20.735030470 -0400
+@@ -1665,13 +1665,13 @@ PHP\_FUNCTION(mysqli\_options)
+ {
+ MY\_MYSQL \*mysql;
+ zval \*mysql\_link = NULL;
+- zval \*mysql\_value;
++ zval \*\*mysql\_value;
+ long mysql\_option;
+ unsigned int l\_value;
+ long ret;
+ int expected\_type;
+
+- if (zend\_parse\_method\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, getThis(), "Olz", &mysql\_link, mysqli\_link\_class\_entry, &mysql\_option, &mysql\_value) == FAILURE) {
++ if (zend\_parse\_method\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, getThis(), "OlZ", &mysql\_link, mysqli\_link\_class\_entry, &mysql\_option, &mysql\_value) == FAILURE) {
+ return;
+ }
+ MYSQLI\_FETCH\_RESOURCE(mysql, MY\_MYSQL \*, &mysql\_link, "mysqli\_link", MYSQLI\_STATUS\_INITIALIZED);
+@@ -1682,13 +1682,13 @@ PHP\_FUNCTION(mysqli\_options)
+ }
+ }
+ expected\_type = mysqli\_options\_get\_option\_zval\_type(mysql\_option);
+- if (expected\_type != Z\_TYPE\_P(mysql\_value)) {
++ if (expected\_type != Z\_TYPE\_PP(mysql\_value)) {
+ switch (expected\_type) {
+ case IS\_STRING:
+- convert\_to\_string\_ex(&mysql\_value);
++ convert\_to\_string\_ex(mysql\_value);
+ break;
+ case IS\_LONG:
+- convert\_to\_long\_ex(&mysql\_value);
++ convert\_to\_long\_ex(mysql\_value);
+ break;
+ default:
+ break;
+@@ -1696,10 +1696,10 @@ PHP\_FUNCTION(mysqli\_options)
+ }
+ switch (expected\_type) {
+ case IS\_STRING:
+- ret = mysql\_options(mysql->mysql, mysql\_option, Z\_STRVAL\_PP(&mysql\_value));
++ ret = mysql\_options(mysql->mysql, mysql\_option, Z\_STRVAL\_PP(mysql\_value));
+ break;
+ case IS\_LONG:
+- l\_value = Z\_LVAL\_PP(&mysql\_value);
++ l\_value = Z\_LVAL\_PP(mysql\_value);
+ ret = mysql\_options(mysql->mysql, mysql\_option, (char \*)&l\_value);
+ break;
+ default:
--- php5-5.3.2.orig/debian/patches/004-ldap\_fix.patch
+++ php5-5.3.2/debian/patches/004-ldap\_fix.patch
@@ -0,0 +1,27 @@
+Description: Prevent null dereferencing in ldap\_explode\_dn()
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/205405
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/ext/ldap/ldap.c
++++ b/ext/ldap/ldap.c
+@@ -1211,7 +1211,7 @@ PHP\_FUNCTION(ldap\_explode\_dn)
+ }
+
+ i=0;
+- while (ldap\_value[i] != NULL) i++;
++ while (ldap\_value && ldap\_value[i] != NULL) i++;
+ count = i;
+
+ array\_init(return\_value);
+@@ -1221,7 +1221,8 @@ PHP\_FUNCTION(ldap\_explode\_dn)
+ add\_index\_string(return\_value, i, ldap\_value[i], 1);
+ }
+
+- ldap\_value\_free(ldap\_value);
++ if (ldap\_value)
++ ldap\_value\_free(ldap\_value);
+ }
+ /\* }}} \*/
+
--- php5-5.3.2.orig/debian/patches/php5-CVE-2012-0830.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2012-0830.patch
@@ -0,0 +1,55 @@
+Origin: http://svn.php.net/viewvc?view=revision&revision=323007
+ and http://svn.php.net/viewvc?view=revision&revision=323013
+Subject: fix UMR in php\_register\_variable\_ex, reported by Stefan Esser
+
+Fixed memory leaks
+
+CVE-2012-0830
+
+---
+ main/php\_variables.c | 27 +++++++++++++++++++++++----
+ 1 file changed, 23 insertions(+), 4 deletions(-)
+
+Index: b/main/php\_variables.c
+===================================================================
+--- a/main/php\_variables.c
++++ b/main/php\_variables.c
+@@ -182,7 +182,12 @@ PHPAPI void php\_register\_variable\_ex(cha
+ if (!index) {
+ MAKE\_STD\_ZVAL(gpc\_element);
+ array\_init(gpc\_element);
+- zend\_hash\_next\_index\_insert(symtable1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ if (zend\_hash\_next\_index\_insert(symtable1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p) == FAILURE) {
++ zval\_ptr\_dtor(&gpc\_element);
++ zval\_dtor(val);
++ efree(var\_orig);
++ return;
++ }
+ } else {
+ if (PG(magic\_quotes\_gpc)) {
+ escaped\_index = php\_addslashes(index, index\_len, &index\_len, 0 TSRMLS\_CC);
+@@ -198,6 +203,13 @@ PHPAPI void php\_register\_variable\_ex(cha
+ MAKE\_STD\_ZVAL(gpc\_element);
+ array\_init(gpc\_element);
+ zend\_symtable\_update(symtable1, escaped\_index, index\_len + 1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ } else {
++ if (index != escaped\_index) {
++ efree(escaped\_index);
++ }
++ zval\_dtor(val);
++ efree(var\_orig);
++ return;
+ }
+ }
+ if (index != escaped\_index) {
+@@ -223,7 +235,9 @@ plain\_var:
+ gpc\_element->value = val->value;
+ Z\_TYPE\_P(gpc\_element) = Z\_TYPE\_P(val);
+ if (!index) {
+- zend\_hash\_next\_index\_insert(symtable1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ if (zend\_hash\_next\_index\_insert(symtable1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p) == FAILURE) {
++ zval\_ptr\_dtor(&gpc\_element);
++ }
+ } else {
+ if (PG(magic\_quotes\_gpc)) {
+ escaped\_index = php\_addslashes(index, index\_len, &index\_len, 0 TSRMLS\_CC);
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-4885.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-4885.patch
@@ -0,0 +1,81 @@
+Origin: http://svn.php.net/viewvc?view=revision&revision=321038
+ and http://svn.php.net/viewvc?view=revision&revision=321040
+ and http://svn.php.net/viewvc?view=revision&revision=321335
+Subject: Added max\_input\_vars directive to prevent attacks based on
+ hash collisions
+
+Fixes CVE-2011-4885; note that this introduces CVE-2012-0830
+
+Ubuntu Note: this patch differs upstream in that we drop the changes to
+the default php.ini configuration files, to eliminate prompting of the
+admin when upgrading the package.
+
+---
+ main/main.c | 1 +
+ main/php\_globals.h | 2 ++
+ main/php\_variables.c | 20 ++++++++++++++++----
+ 3 files changed, 19 insertions(+), 4 deletions(-)
+
+Index: b/main/php\_globals.h
+===================================================================
+--- a/main/php\_globals.h
++++ b/main/php\_globals.h
+@@ -170,6 +170,8 @@ struct \_php\_core\_globals {
+ char \*mail\_log;
+
+ zend\_bool in\_error\_log;
++
++ long max\_input\_vars;
+ };
+
+
+Index: b/main/php\_variables.c
+===================================================================
+--- a/main/php\_variables.c
++++ b/main/php\_variables.c
+@@ -191,9 +191,14 @@ PHPAPI void php\_register\_variable\_ex(cha
+ }
+ if (zend\_symtable\_find(symtable1, escaped\_index, index\_len + 1, (void \*\*) &gpc\_element\_p) == FAILURE
+ || Z\_TYPE\_PP(gpc\_element\_p) != IS\_ARRAY) {
+- MAKE\_STD\_ZVAL(gpc\_element);
+- array\_init(gpc\_element);
+- zend\_symtable\_update(symtable1, escaped\_index, index\_len + 1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ if (zend\_hash\_num\_elements(symtable1) <= PG(max\_input\_vars)) {
++ if (zend\_hash\_num\_elements(symtable1) == PG(max\_input\_vars)) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Input variables exceeded %ld. To increase the limit change max\_input\_vars in php.ini.", PG(max\_input\_vars));
++ }
++ MAKE\_STD\_ZVAL(gpc\_element);
++ array\_init(gpc\_element);
++ zend\_symtable\_update(symtable1, escaped\_index, index\_len + 1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ }
+ }
+ if (index != escaped\_index) {
+ efree(escaped\_index);
+@@ -236,7 +241,14 @@ plain\_var:
+ zend\_symtable\_exists(symtable1, escaped\_index, index\_len + 1)) {
+ zval\_ptr\_dtor(&gpc\_element);
+ } else {
+- zend\_symtable\_update(symtable1, escaped\_index, index\_len + 1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ if (zend\_hash\_num\_elements(symtable1) <= PG(max\_input\_vars)) {
++ if (zend\_hash\_num\_elements(symtable1) == PG(max\_input\_vars)) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Input variables exceeded %ld. To increase the limit change max\_input\_vars in php.ini.", PG(max\_input\_vars));
++ }
++ zend\_symtable\_update(symtable1, escaped\_index, index\_len + 1, &gpc\_element, sizeof(zval \*), (void \*\*) &gpc\_element\_p);
++ } else {
++ zval\_ptr\_dtor(&gpc\_element);
++ }
+ }
+ if (escaped\_index != index) {
+ efree(escaped\_index);
+Index: b/main/main.c
+===================================================================
+--- a/main/main.c
++++ b/main/main.c
+@@ -503,6 +503,7 @@ PHP\_INI\_BEGIN()
+ STD\_PHP\_INI\_ENTRY("post\_max\_size", "8M", PHP\_INI\_SYSTEM|PHP\_INI\_PERDIR, OnUpdateLong, post\_max\_size, sapi\_globals\_struct,sapi\_globals)
+ STD\_PHP\_INI\_ENTRY("upload\_tmp\_dir", NULL, PHP\_INI\_SYSTEM, OnUpdateStringUnempty, upload\_tmp\_dir, php\_core\_globals, core\_globals)
+ STD\_PHP\_INI\_ENTRY("max\_input\_nesting\_level", "64", PHP\_INI\_SYSTEM|PHP\_INI\_PERDIR, OnUpdateLongGEZero, max\_input\_nesting\_level, php\_core\_globals, core\_globals)
++ STD\_PHP\_INI\_ENTRY("max\_input\_vars", "1000", PHP\_INI\_SYSTEM|PHP\_INI\_PERDIR, OnUpdateLongGEZero, max\_input\_vars, php\_core\_globals, core\_globals)
+
+ STD\_PHP\_INI\_ENTRY("user\_dir", NULL, PHP\_INI\_SYSTEM, OnUpdateString, user\_dir, php\_core\_globals, core\_globals)
+ STD\_PHP\_INI\_ENTRY("variables\_order", "EGPCS", PHP\_INI\_SYSTEM|PHP\_INI\_PERDIR, OnUpdateStringUnempty, variables\_order, php\_core\_globals, core\_globals)
--- php5-5.3.2.orig/debian/patches/php\_crypt\_revamped.patch
+++ php5-5.3.2/debian/patches/php\_crypt\_revamped.patch
@@ -0,0 +1,571 @@
+--- a/ext/standard/config.m4
++++ b/ext/standard/config.m4
+@@ -60,6 +60,12 @@ if test "$ac\_cv\_func\_crypt" = "no"; then
+ AC\_DEFINE(HAVE\_CRYPT, 1, [ ])
+ ])
+ fi
++
++AC\_CHECK\_FUNCS(crypt\_r, [ php\_crypt\_r="1" ], [ php\_crypt\_r="0" ])
++if test "x$php\_crypt\_r" = "x1"; then
++ PHP\_CRYPT\_R\_STYLE
++ AC\_DEFINE(HAVE\_CRYPT\_R, 1, [ ])
++fi
+
+ AC\_CACHE\_CHECK(for standard DES crypt, ac\_cv\_crypt\_des,[
+ AC\_TRY\_RUN([
+@@ -231,11 +237,68 @@ main() {
+ ac\_cv\_crypt\_SHA256=no
+ ])])
+
++dnl
++dnl Define PHP\_\*\_CRYPT according to system
++dnl
++
++if test "$ac\_cv\_crypt\_des" = "yes"; then
++ ac\_result=1
++ ac\_crypt\_des=1
++else
++ ac\_result=0
++ ac\_crypt\_des=0
++fi
++AC\_DEFINE\_UNQUOTED(PHP\_STD\_DES\_CRYPT, $ac\_result, [Whether the system supports standard DES salt])
++
++if test "$ac\_cv\_crypt\_md5" = "yes"; then
++ ac\_result=1
++ ac\_crypt\_md5=1
++else
++ ac\_result=0
++ ac\_crypt\_md5=0
++fi
++AC\_DEFINE\_UNQUOTED(PHP\_MD5\_CRYPT, $ac\_result, [Whether the system supports MD5 salt])
++
++if test "$ac\_cv\_crypt\_blowfish" = "yes"; then
++ ac\_result=1
++ ac\_crypt\_blowfish=1
++else
++ ac\_result=0
++ ac\_crypt\_blowfish=0
++fi
++AC\_DEFINE\_UNQUOTED(PHP\_BLOWFISH\_CRYPT, $ac\_result, [Whether the system supports BlowFish salt])
++
++if test "$ac\_cv\_crypt\_ext\_des" = "yes"; then
++ ac\_result=1
++ ac\_crypt\_edes=1
++else
++ ac\_result=0
++ ac\_crypt\_edes=0
++fi
++AC\_DEFINE\_UNQUOTED(PHP\_EXT\_DES\_CRYPT, $ac\_result, [Whether the system supports extended DES salt])
++
++if test "$ac\_cv\_crypt\_SHA512" = "yes"; then
++ ac\_result=1
++ ac\_crypt\_sha512=1
++else
++ ac\_result=0
++ ac\_crypt\_sha512=0
++fi
++AC\_DEFINE\_UNQUOTED(PHP\_SHA512\_CRYPT, $ac\_result, [Whether the system supports SHA512 salt])
++
++if test "$ac\_cv\_crypt\_SHA256" = "yes"; then
++ ac\_result=1
++ ac\_crypt\_sha256=1
++else
++ ac\_result=0
++ ac\_crypt\_sha256=0
++fi
++AC\_DEFINE\_UNQUOTED(PHP\_SHA256\_CRYPT, $ac\_result, [Whether the system supports SHA256 salt])
+
+ dnl
+ dnl If one of them is missing, use our own implementation, portable code is then possible
+ dnl
+-if test "$ac\_cv\_crypt\_blowfish" = "no" || test "$ac\_cv\_crypt\_des" = "no" || test "$ac\_cv\_crypt\_ext\_des" = "no" || test "x$php\_crypt\_r" = "x0"; then
++if test "$ac\_cv\_crypt\_SHA512" = no || test "$ac\_cv\_crypt\_SHA256" = "no" || test "$ac\_cv\_crypt\_blowfish" = "no" || test "$ac\_cv\_crypt\_des" = "no" || test "$ac\_cv\_crypt\_md5" = "no" || test "$ac\_cv\_crypt\_ext\_des" = "no" || test "x$php\_crypt\_r" = "x0"; then
+
+ dnl
+ dnl Check for \_\_alignof\_\_ support in the compiler
+@@ -268,66 +331,16 @@ if test "$ac\_cv\_crypt\_blowfish" = "no" |
+ if test "$ac\_cv\_attribute\_aligned" = "yes"; then
+ AC\_DEFINE([HAVE\_ATTRIBUTE\_ALIGNED], 1, [whether the compiler supports \_\_attribute\_\_ ((\_\_aligned\_\_))])
+ fi
+-
+
+- AC\_DEFINE\_UNQUOTED(PHP\_USE\_PHP\_CRYPT\_R, 1, [Whether PHP has to use its own crypt\_r for blowfish, des, ext des and md5])
+- AC\_DEFINE\_UNQUOTED(PHP\_STD\_DES\_CRYPT, 1, [Whether the system supports standard DES salt])
+- AC\_DEFINE\_UNQUOTED(PHP\_BLOWFISH\_CRYPT, 1, [Whether the system supports BlowFish salt])
+- AC\_DEFINE\_UNQUOTED(PHP\_EXT\_DES\_CRYPT, 1, [Whether the system supports extended DES salt])
+- AC\_DEFINE\_UNQUOTED(PHP\_MD5\_CRYPT, 1, [Whether the system supports MD5 salt])
+- AC\_DEFINE\_UNQUOTED(PHP\_SHA512\_CRYPT, 1, [Whether the system supports SHA512 salt])
+- AC\_DEFINE\_UNQUOTED(PHP\_SHA256\_CRYPT, 1, [Whether the system supports SHA256 salt])
++ ac\_result=1
+
+ PHP\_ADD\_SOURCES(PHP\_EXT\_DIR(standard), crypt\_freesec.c crypt\_blowfish.c crypt\_sha512.c crypt\_sha256.c php\_crypt\_r.c)
+ else
+- if test "$ac\_cv\_crypt\_des" = "yes"; then
+- ac\_result=1
+- ac\_crypt\_des=1
+- else
+- ac\_result=0
+- ac\_crypt\_des=0
+- fi
+- AC\_DEFINE\_UNQUOTED(PHP\_STD\_DES\_CRYPT, $ac\_result, [Whether the system supports standard DES salt])
+-
+- if test "$ac\_cv\_crypt\_blowfish" = "yes"; then
+- ac\_result=1
+- ac\_crypt\_blowfish=1
+- else
+- ac\_result=0
+- ac\_crypt\_blowfish=0
+- fi
+- AC\_DEFINE\_UNQUOTED(PHP\_BLOWFISH\_CRYPT, $ac\_result, [Whether the system supports BlowFish salt])
+-
+- if test "$ac\_cv\_crypt\_ext\_des" = "yes"; then
+- ac\_result=1
+- ac\_crypt\_edes=1
+- else
+- ac\_result=0
+- ac\_crypt\_edes=0
+- fi
+- AC\_DEFINE\_UNQUOTED(PHP\_EXT\_DES\_CRYPT, $ac\_result, [Whether the system supports extended DES salt])
+-
+- if test "$ac\_cv\_crypt\_sha512" = "yes"; then
+- ac\_result=1
+- ac\_crypt\_sha512=1
+- else
+- ac\_result=0
+- ac\_crypt\_sha512=0
+- fi
+- AC\_DEFINE\_UNQUOTED(PHP\_EXT\_SHA512\_CRYPT, $ac\_result, [Whether the system supports SHA512 salt])
+-
+- if test "$ac\_cv\_crypt\_sha256" = "yes"; then
+- ac\_result=1
+- ac\_crypt\_sha256=1
+- else
+- ac\_result=0
+- ac\_crypt\_sha256=0
+- fi
+- AC\_DEFINE\_UNQUOTED(PHP\_EXT\_SHA256\_CRYPT, $ac\_result, [Whether the system supports SHA256 salt])
+-
+- AC\_DEFINE\_UNQUOTED(PHP\_USE\_PHP\_CRYPT\_R, 0, [Whether PHP has to use its own crypt\_r for blowfish, des and ext des])
++ ac\_result=0
+ fi
+
++AC\_DEFINE\_UNQUOTED(PHP\_USE\_PHP\_CRYPT\_R, $ac\_result, [Whether PHP has to use its own crypt\_r for blowfish, des and ext des])
++
+ dnl
+ dnl Check for available functions
+ dnl
+--- a/ext/standard/crypt.c
++++ b/ext/standard/crypt.c
+@@ -32,13 +32,12 @@
+ #ifdef PHP\_USE\_PHP\_CRYPT\_R
+ # include "php\_crypt\_r.h"
+ # include "crypt\_freesec.h"
+-#else
+-# if HAVE\_CRYPT\_H
+-# if defined(CRYPT\_R\_GNU\_SOURCE) && !defined(\_GNU\_SOURCE)
+-# define \_GNU\_SOURCE
+-# endif
+-# include
++#endif
++#if HAVE\_CRYPT\_H
++# if defined(CRYPT\_R\_GNU\_SOURCE) && !defined(\_GNU\_SOURCE)
++# define \_GNU\_SOURCE
+ # endif
++# include
+ #endif
+ #if TM\_IN\_SYS\_TIME
+ #include
+@@ -64,51 +63,46 @@
+ \* PHP\_EXT\_DES\_CRYPT, PHP\_MD5\_CRYPT and PHP\_BLOWFISH\_CRYPT as appropriate
+ \* for the target platform. \*/
+
+-#if PHP\_STD\_DES\_CRYPT
+-#define PHP\_MAX\_SALT\_LEN 2
++#if defined(HAVE\_CRYPT\_R) && (defined(\_REENTRANT) || defined(\_THREAD\_SAFE))
++# define PHP\_USE\_SYSTEM\_CRYPT\_R
+ #endif
+
+-#if PHP\_EXT\_DES\_CRYPT
+-#undef PHP\_MAX\_SALT\_LEN
+-#define PHP\_MAX\_SALT\_LEN 9
+-#endif
++#define PHP\_MAX\_STD\_DES\_SALT\_LEN 2
++#define PHP\_MAX\_STD\_DES\_HASH\_LEN 11
+
+-#if PHP\_MD5\_CRYPT
+-#undef PHP\_MAX\_SALT\_LEN
+-#define PHP\_MAX\_SALT\_LEN 12
+-#endif
++#define PHP\_MAX\_EXT\_DES\_SALT\_LEN 9
++#define PHP\_MAX\_EXT\_DES\_HASH\_LEN 11
+
+-#if PHP\_BLOWFISH\_CRYPT
+-#undef PHP\_MAX\_SALT\_LEN
+-#define PHP\_MAX\_SALT\_LEN 60
+-#endif
++#define PHP\_MAX\_MD5\_SALT\_LEN 12
++#define PHP\_MAX\_MD5\_HASH\_LEN 22
+
+-#if PHP\_SHA512\_CRYPT
+-#undef PHP\_MAX\_SALT\_LEN
+-#define PHP\_MAX\_SALT\_LEN 123
+-#endif
++#define PHP\_MAX\_BLOWFISH\_SALT\_LEN 29
++#define PHP\_MAX\_BLOWFISH\_HASH\_LEN 31
+
++#define PHP\_MAX\_SHA256\_SALT\_LEN 37
++#define PHP\_MAX\_SHA256\_HASH\_LEN 43
+
+-/\* If the configure-time checks fail, we provide DES.
+- \* XXX: This is a hack. Fix the real problem! \*/
++#define PHP\_MAX\_SHA512\_SALT\_LEN 37
++#define PHP\_MAX\_SHA512\_HASH\_LEN 86
+
+-#ifndef PHP\_MAX\_SALT\_LEN
+-#define PHP\_MAX\_SALT\_LEN 2
+-#undef PHP\_STD\_DES\_CRYPT
+-#define PHP\_STD\_DES\_CRYPT 1
+-#endif
++/\*
++ \* Maximum salt length is from Blowfish
++ \* Maximum hash length is from SHA512
++ \*/
++#define PHP\_MAX\_SALT\_LEN 37
++#define PHP\_MAX\_HASH\_LEN 86
+
+ #define PHP\_CRYPT\_RAND php\_rand(TSRMLS\_C)
+
+ PHP\_MINIT\_FUNCTION(crypt) /\* {{{ \*/
+ {
+ REGISTER\_LONG\_CONSTANT("CRYPT\_SALT\_LENGTH", PHP\_MAX\_SALT\_LEN, CONST\_CS | CONST\_PERSISTENT);
+- REGISTER\_LONG\_CONSTANT("CRYPT\_STD\_DES", PHP\_STD\_DES\_CRYPT, CONST\_CS | CONST\_PERSISTENT);
+- REGISTER\_LONG\_CONSTANT("CRYPT\_EXT\_DES", PHP\_EXT\_DES\_CRYPT, CONST\_CS | CONST\_PERSISTENT);
+- REGISTER\_LONG\_CONSTANT("CRYPT\_MD5", PHP\_MD5\_CRYPT, CONST\_CS | CONST\_PERSISTENT);
+- REGISTER\_LONG\_CONSTANT("CRYPT\_BLOWFISH", PHP\_BLOWFISH\_CRYPT, CONST\_CS | CONST\_PERSISTENT);
+- REGISTER\_LONG\_CONSTANT("CRYPT\_SHA256", PHP\_SHA256\_CRYPT, CONST\_CS | CONST\_PERSISTENT);
+- REGISTER\_LONG\_CONSTANT("CRYPT\_SHA512", PHP\_SHA512\_CRYPT, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("CRYPT\_STD\_DES", PHP\_STD\_DES\_CRYPT | PHP\_USE\_PHP\_CRYPT\_R, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("CRYPT\_EXT\_DES", PHP\_EXT\_DES\_CRYPT | PHP\_USE\_PHP\_CRYPT\_R, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("CRYPT\_MD5", PHP\_MD5\_CRYPT | PHP\_USE\_PHP\_CRYPT\_R, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("CRYPT\_BLOWFISH", PHP\_BLOWFISH\_CRYPT | PHP\_USE\_PHP\_CRYPT\_R, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("CRYPT\_SHA256", PHP\_SHA256\_CRYPT | PHP\_USE\_PHP\_CRYPT\_R, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("CRYPT\_SHA512", PHP\_SHA512\_CRYPT | PHP\_USE\_PHP\_CRYPT\_R, CONST\_CS | CONST\_PERSISTENT);
+
+
+ #ifdef PHP\_USE\_PHP\_CRYPT\_R
+@@ -119,15 +113,15 @@ PHP\_MINIT\_FUNCTION(crypt) /\* {{{ \*/
+ }
+ /\* }}} \*/
+
++#ifdef PHP\_USE\_PHP\_CRYPT\_R
+ PHP\_MSHUTDOWN\_FUNCTION(crypt) /\* {{{ \*/
+ {
+-#ifdef PHP\_USE\_PHP\_CRYPT\_R
+ php\_shutdown\_crypt\_r();
+-#endif
+
+ return SUCCESS;
+ }
+ /\* }}} \*/
++#endif
+
+ static unsigned char itoa64[] = "./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
+
+@@ -145,158 +139,171 @@ static void php\_to64(char \*s, long v, in
+ PHP\_FUNCTION(crypt)
+ {
+ char salt[PHP\_MAX\_SALT\_LEN + 1];
++ int salt\_len = 0;
++ char output[PHP\_MAX\_SALT\_LEN + PHP\_MAX\_HASH\_LEN + 1];
+ char \*str, \*salt\_in = NULL;
+ int str\_len, salt\_in\_len = 0;
+- char \*crypt\_res;
+- salt[0] = salt[PHP\_MAX\_SALT\_LEN] = '\0';
++ char \*crypt\_res = NULL;
++#if PHP\_USE\_PHP\_CRYPT\_R
++ struct php\_crypt\_extended\_data extended\_buffer;
++#endif
++#if PHP\_USE\_SYSTEM\_CRYPT\_R
++# if defined(CRYPT\_R\_STRUCT\_CRYPT\_DATA)
++ struct crypt\_data buffer;
++# elif defined(CRYPT\_R\_CRYPTD)
++ CRYPTD buffer;
++# else
++# error Data struct used by crypt\_r() is unknown. Please report.
++# endif
++#endif
+
+- /\* This will produce suitable results if people depend on DES-encryption
+- \* available (passing always 2-character salt). At least for glibc6.1 \*/
+- memset(&salt[1], '$', PHP\_MAX\_SALT\_LEN - 1);
++ salt[0] = salt[PHP\_MAX\_SALT\_LEN] = '\0';
+
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "s|s", &str, &str\_len, &salt\_in, &salt\_in\_len) == FAILURE) {
+ return;
+ }
+
+ if (salt\_in) {
+- memcpy(salt, salt\_in, MIN(PHP\_MAX\_SALT\_LEN, salt\_in\_len));
+- }
+-
+- /\* The automatic salt generation covers standard DES, md5-crypt and Blowfish (simple) \*/
+- if (!\*salt) {
++ salt\_len = MIN(PHP\_MAX\_SALT\_LEN, salt\_in\_len);
++ memcpy(salt, salt\_in, salt\_len);
++ salt[salt\_len] = '\0';
++ } else {
+ #if PHP\_MD5\_CRYPT
+- strcpy(salt, "$1$");
++ salt[0] = '$'; salt[1] = '1'; salt[2] = '$';
+ php\_to64(&salt[3], PHP\_CRYPT\_RAND, 4);
+ php\_to64(&salt[7], PHP\_CRYPT\_RAND, 4);
+- strcpy(&salt[11], "$");
++ salt[11] = '$'; salt[12] = '\0';
++ salt\_len = PHP\_MAX\_MD5\_SALT\_LEN;
+ #elif PHP\_STD\_DES\_CRYPT
+ php\_to64(&salt[0], PHP\_CRYPT\_RAND, 2);
+ salt[2] = '\0';
++ salt\_len = PHP\_MAX\_STD\_DES\_SALT\_LEN;
+ #endif
+- salt\_in\_len = strlen(salt);
+ }
+
+ /\* Windows (win32/crypt) has a stripped down version of libxcrypt and
+ a CryptoApi md5\_crypt implementation \*/
+-#if PHP\_USE\_PHP\_CRYPT\_R
+ {
+- struct php\_crypt\_extended\_data buffer;
++#if PHP\_USE\_PHP\_CRYPT\_R
++ memset(&extended\_buffer, 0, sizeof(extended\_buffer));
++#endif
++#if PHP\_USE\_SYSTEM\_CRYPT\_R
++# if defined(CRYPT\_R\_STRUCT\_CRYPT\_DATA)
++ buffer->initialized = 0
++# else
++ memset(&buffer, 0, sizeof(buffer));
++# endif
++#endif
+
+ if (salt[0]=='$' && salt[1]=='1' && salt[2]=='$') {
+- char output[MD5\_HASH\_MAX\_LEN];
+-
+- RETURN\_STRING(php\_md5\_crypt\_r(str, salt, output), 1);
++ /\* CRYPT\_MD5 \*/
++#if PHP\_MD5\_CRYPT
++# warning Using system MD5 crypt function, which is OK on Debian system
++# if PHP\_USE\_SYSTEM\_CRYPT\_R
++ crypt\_res = crypt\_r(str, salt, &buffer);
++# else
++ crypt\_res = crypt(str, salt);
++# endif
++#elif PHP\_USE\_PHP\_CRYPT\_R
++# error Using PHP MD5 crypt function, should not happen on Debian system
++ crypt\_res = php\_md5\_crypt\_r(str, salt, output);
++#endif
+ } else if (salt[0]=='$' && salt[1]=='6' && salt[2]=='$') {
+- const char sha512\_salt\_prefix[] = "$6$";
+- const char sha512\_rounds\_prefix[] = "rounds=";
+- char \*output;
+- int needed = (sizeof(sha512\_salt\_prefix) - 1
+- + sizeof(sha512\_rounds\_prefix) + 9 + 1
+- + strlen(salt) + 1 + 43 + 1);
+- output = emalloc(needed \* sizeof(char \*));
+- salt[salt\_in\_len] = '\0';
+-
+- crypt\_res = php\_sha512\_crypt\_r(str, salt, output, needed);
+- if (!crypt\_res) {
+- if (salt[0]=='\*' && salt[1]=='0') {
+- RETVAL\_STRING("\*1", 1);
+- } else {
+- RETVAL\_STRING("\*0", 1);
+- }
+- } else {
+- RETVAL\_STRING(output, 1);
+- }
+-
+- memset(output, 0, PHP\_MAX\_SALT\_LEN + 1);
+- efree(output);
++ /\* CRYPT\_SHA512 \*/
++#if PHP\_SHA512\_CRYPT
++# warning Using system SHA512 crypt function, which is OK on Debian system
++# if PHP\_USE\_SYSTEM\_CRYPT\_R
++ crypt\_res = crypt\_r(str, salt, &buffer);
++# else
++ crypt\_res = crypt(str, salt);
++# endif
++#elif PHP\_USE\_PHP\_CRYPT\_R
++# error Using PHP SHA512 crypt function, should not happen on Debian system
++ crypt\_res = php\_sha512\_crypt\_r(str, salt, output, sizeof(output));
++#endif
+ } else if (salt[0]=='$' && salt[1]=='5' && salt[2]=='$') {
+- const char sha256\_salt\_prefix[] = "$5$";
+- const char sha256\_rounds\_prefix[] = "rounds=";
+- char \*output;
+- int needed = (sizeof(sha256\_salt\_prefix) - 1
+- + sizeof(sha256\_rounds\_prefix) + 9 + 1
+- + strlen(salt) + 1 + 43 + 1);
+- output = emalloc(needed \* sizeof(char \*));
+- salt[salt\_in\_len] = '\0';
+-
+- crypt\_res = php\_sha256\_crypt\_r(str, salt, output, needed);
+- if (!crypt\_res) {
+- if (salt[0]=='\*' && salt[1]=='0') {
+- RETVAL\_STRING("\*1", 1);
+- } else {
+- RETVAL\_STRING("\*0", 1);
+- }
+- } else {
+- RETVAL\_STRING(output, 1);
+- }
+-
+- memset(output, 0, PHP\_MAX\_SALT\_LEN + 1);
+- efree(output);
++ /\* CRYPT\_SHA256 \*/
++#if PHP\_SHA256\_CRYPT
++# warning Using system SHA256 crypt function, which is OK on Debian system
++# if PHP\_USE\_SYSTEM\_CRYPT\_R
++ crypt\_res = crypt\_r(str, salt, &buffer);
++# else
++ crypt\_res = crypt(str, salt);
++# endif
++#elif PHP\_USE\_PHP\_CRYPT\_R
++# error Using PHP SHA256 crypt function, should not happen on Debian system
++ crypt\_res = php\_sha256\_crypt\_r(str, salt, output, sizeof(output));
++#endif
+ } else if (
+ salt[0] == '$' &&
+ salt[1] == '2' &&
+ salt[2] == 'a' &&
+ salt[3] == '$' &&
+- salt[4] >= '0' && salt[4] <= '3' &&
+- salt[5] >= '0' && salt[5] <= '9' &&
+- salt[6] == '$') {
+- char output[PHP\_MAX\_SALT\_LEN + 1];
+-
+- memset(output, 0, PHP\_MAX\_SALT\_LEN + 1);
+-
++ salt[6] == '$' &&
++ ((salt[4] == '0' &&
++ salt[5] >= '4' && salt[5] <= '9') ||
++ (salt[4] >= '1' && salt[4] <= '2' &&
++ salt[5] >= '0' && salt[5] <= '9') ||
++ (salt[4] == '3' &&
++ salt[5] >= '0' && salt[5] <= '1'))) {
++ /\* CRYPT\_BLOWFISH \*/
++#if PHP\_BLOWFISH\_CRYPT
++# error Using system BlowFish crypt function, should not happen on Debian system
++# if PHP\_USE\_SYSTEM\_CRYPT\_R
++ crypt\_res = crypt\_r(str, salt, &buffer);
++# else
++ crypt\_res = crypt(str, salt);
++# endif
++#elif PHP\_USE\_PHP\_CRYPT\_R
++# warning Using PHP BlowFish crypt function, which is OK on Debian system
+ crypt\_res = php\_crypt\_blowfish\_rn(str, salt, output, sizeof(output));
+- if (!crypt\_res) {
+- if (salt[0]=='\*' && salt[1]=='0') {
+- RETVAL\_STRING("\*1", 1);
+- } else {
+- RETVAL\_STRING("\*0", 1);
+- }
+- } else {
+- RETVAL\_STRING(output, 1);
+- }
+-
+- memset(output, 0, PHP\_MAX\_SALT\_LEN + 1);
++#endif
++ } else if (salt[0]=='\_' &&
++ salt\_len == 9) {
++ /\* CRYPT\_EXT\_DES \*/
++#if PHP\_EXT\_DES\_CRYPT
++# error Using system extended DES crypt function, should not happen on Debian system
++# if PHP\_USE\_SYSTEM\_CRYPT\_R
++ crypt\_res = crypt\_r(str, salt, &buffer);
++# else
++ crypt\_res = crypt(str, salt);
++# endif
++#elif PHP\_USE\_PHP\_CRYPT\_R
++# warning Using PHP extended DES crypt function, which is OK on Debian system
++ \_crypt\_extended\_init\_r();
++ crypt\_res = \_crypt\_extended\_r(str, salt, &extended\_buffer);
++#endif
+ } else {
+- memset(&buffer, 0, sizeof(buffer));
++ /\* CRYPT\_STD\_DES \*/
++#if PHP\_STD\_DES\_CRYPT
++# warning Using system standard DES crypt function, which is OK on Debian system
++# if PHP\_USE\_SYSTEM\_CRYPT\_R
++ crypt\_res = crypt\_r(str, salt, &buffer);
++# else
++ crypt\_res = crypt(str, salt);
++# endif
++#elif PHP\_USE\_PHP\_CRYPT\_R
++# error Using PHP standard DES crypt function, should not happen on Debian system
+ \_crypt\_extended\_init\_r();
++ crypt\_res = \_crypt\_extended\_r(str, salt, &extended\_buffer);
++#endif
++ }
+
+- crypt\_res = \_crypt\_extended\_r(str, salt, &buffer);
+- if (!crypt\_res) {
+- if (salt[0]=='\*' && salt[1]=='0') {
+- RETURN\_STRING("\*1", 1);
+- } else {
+- RETURN\_STRING("\*0", 1);
+- }
++ if (!crypt\_res) {
++ if (salt[0]=='\*' && salt[1]=='0') {
++ RETVAL\_STRING("\*1", 1);
+ } else {
+- RETURN\_STRING(crypt\_res, 1);
++ RETVAL\_STRING("\*0", 1);
+ }
++ } else {
++ RETVAL\_STRING(crypt\_res, 1);
+ }
+- }
+-#else
+
+-# if defined(HAVE\_CRYPT\_R) && (defined(\_REENTRANT) || defined(\_THREAD\_SAFE))
+- {
+-# if defined(CRYPT\_R\_STRUCT\_CRYPT\_DATA)
+- struct crypt\_data buffer;
+- memset(&buffer, 0, sizeof(buffer));
+-# elif defined(CRYPT\_R\_CRYPTD)
+- CRYPTD buffer;
+-# else
+-# error Data struct used by crypt\_r() is unknown. Please report.
+-# endif
+- crypt\_res = crypt\_r(str, salt, &buffer);
+- if (!crypt\_res) {
+- if (salt[0]=='\*' && salt[1]=='0') {
+- RETURN\_STRING("\*1", 1);
+- } else {
+- RETURN\_STRING("\*0", 1);
+- }
+- } else {
+- RETURN\_STRING(crypt\_res, 1);
++ memset(salt, 0, sizeof(salt));
++ if (output[0]!='\0') {
++ memset(output, 0, sizeof(output));
+ }
+ }
+-# endif
+-#endif
+ }
+ /\* }}} \*/
+ #endif
+--- a/configure.in
++++ b/configure.in
+@@ -671,11 +671,6 @@ PHP\_TIME\_R\_TYPE
+ PHP\_READDIR\_R\_TYPE
+ PHP\_CHECK\_IN\_ADDR\_T
+
+-AC\_CHECK\_FUNCS(crypt\_r, [ php\_crypt\_r="1" ], [ php\_crypt\_r="0" ])
+-if test "x$php\_crypt\_r" = "x1"; then
+- PHP\_CRYPT\_R\_STYLE
+-fi
+-
+ dnl divert(4)
+
+ dnl ## In diversion 4 we check user-configurable general settings.
--- php5-5.3.2.orig/debian/patches/101-sqlite\_is\_shared.patch
+++ php5-5.3.2/debian/patches/101-sqlite\_is\_shared.patch
@@ -0,0 +1,11 @@
+--- pkg-php.orig/ext/sqlite/config.m4
++++ pkg-php/ext/sqlite/config.m4
+@@ -84,7 +84,7 @@ if test "$PHP\_SQLITE" != "no"; then
+ ])
+ SQLITE\_MODULE\_TYPE=external
+ PHP\_SQLITE\_CFLAGS=$pdo\_inc\_path
+- sqlite\_extra\_sources="libsqlite/src/encode.c"
++ sqlite\_extra\_sources=""
+ else
+ # use bundled library
+ PHP\_PROG\_LEMON
--- php5-5.3.2.orig/debian/patches/CVE-2010-1868.patch
+++ php5-5.3.2/debian/patches/CVE-2010-1868.patch
@@ -0,0 +1,24 @@
+Description: fix arbitrary code execution via empty SQL query
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=298697
+
+diff -Nur php5-5.3.2/ext/sqlite/sqlite.c php5-5.3.2.new/ext/sqlite/sqlite.c
+--- php5-5.3.2/ext/sqlite/sqlite.c 2010-01-03 04:23:27.000000000 -0500
++++ php5-5.3.2.new/ext/sqlite/sqlite.c 2010-09-14 10:54:29.000000000 -0400
+@@ -2508,7 +2508,7 @@
+ return;
+ }
+
+- rres = (struct php\_sqlite\_result \*)emalloc(sizeof(\*rres));
++ rres = (struct php\_sqlite\_result \*)ecalloc(1, sizeof(\*rres));
+ sqlite\_query(NULL, db, sql, sql\_len, (int)mode, 0, NULL, &rres, NULL TSRMLS\_CC);
+ if (db->last\_err\_code != SQLITE\_OK) {
+ if (rres) {
+@@ -2624,7 +2624,7 @@
+ return;
+ }
+
+- rres = (struct php\_sqlite\_result \*)emalloc(sizeof(\*rres));
++ rres = (struct php\_sqlite\_result \*)ecalloc(1, sizeof(\*rres));
+ sqlite\_query(NULL, db, sql, sql\_len, PHPSQLITE\_NUM, 0, NULL, &rres, NULL TSRMLS\_CC);
+ if (db->last\_err\_code != SQLITE\_OK) {
+ if (rres) {
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1938.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1938.patch
@@ -0,0 +1,43 @@
+Subject: Fixed stack buffer overflow in socket\_connect().
+Origin: http://svn.php.net/viewvc?view=revision&revision=311379 and
+ http://svn.php.net/viewvc?view=revision&revision=311370
+
+------------------------------------------------------------------------
+r311369 | felipe | 2011-05-23 17:05:50 -0700 (Mon, 23 May 2011) | 3 lines
+
+- Fixed stack buffer overflow in socket\_connect().
+ Found by: Mateusz Kocielski, Marek Kroemeke and Filip Palian
+
+------------------------------------------------------------------------
+r311370 | felipe | 2011-05-23 17:10:00 -0700 (Mon, 23 May 2011) | 3 lines
+
+- Fix the fix
+ Arghh, copy and paste error :(
+
+------------------------------------------------------------------------
+
+CVE-2011-1938
+
+[Ubuntu note: patch differs from upstream in that that changes to the
+ NEWS file have been dropped to reduce conflicts. - sbeattie]
+
+---
+ ext/sockets/sockets.c | 5 +++++
+ 1 file changed, 5 insertions(+)
+
+Index: b/ext/sockets/sockets.c
+===================================================================
+--- a/ext/sockets/sockets.c
++++ b/ext/sockets/sockets.c
+@@ -1334,6 +1334,11 @@ PHP\_FUNCTION(socket\_connect)
+ break;
+
+ case AF\_UNIX:
++ if (addr\_len >= sizeof(s\_un.sun\_path)) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Path too long");
++ RETURN\_FALSE;
++ }
++
+ memset(&s\_un, 0, sizeof(struct sockaddr\_un));
+
+ s\_un.sun\_family = AF\_UNIX;
--- php5-5.3.2.orig/debian/patches/php5-CVE-2006-7243.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2006-7243.patch
@@ -0,0 +1,1994 @@
+Subject: fix #39863, do not accept paths with NULL in them. See
+ http://news.php.net/php.internals/50191, trunk will have the patch
+ later (adding a macro and/or changing (some) APIs. Patch by Rasmus
+Origin: http://svn.php.net/viewvc?view=revision&revision=305507
+Bug: http://bugs.php.net/39863
+
+Patch also includes http://svn.php.net/viewvc?view=revision&revision=305412
+
+ Protect against null bytes in LOB filenames (rasmus)
+
+and http://svn.php.net/viewvc?view=revision&revision=305635
+
+ Fix tests for \0 patch in PHP 5.3.
+ Fix constants\_error\_004.phpt (closes bug #51901)
+
+CVE-2006-7243
+
+Patch differs from upstream in that it drops the adjustment to the
+PHP\_OCI8\_VERSION macro definition as well as the meta information
+update in the ext/oci8/package.xml to reduce patch conflicts.
+It also has been adjusted to apply to prior versions of php. Patch also
+drops edit to tests/classes/constants\_error\_004.phpt from commit 305635
+as it's not necessary.
+
+Index: ext/oci8/tests/null\_byte\_1.phpt
+===================================================================
+--- ext/oci8/tests/null\_byte\_1.phpt (revision 0)
++++ ext/oci8/tests/null\_byte\_1.phpt (revision 305412)
+@@ -0,0 +1,38 @@
++--TEST--
++Protect against null bytes in LOB filenames (http://news.php.net/php.internals/50202)
++--SKIPIF--
++php if (!extension\_loaded('oci8')) die ("skip no oci8 extension"); ?
++--INI--
++display\_errors = On
++error\_reporting = E\_WARNING
++--FILE--
++php
++
++require(dirname(\_\_FILE\_\_).'/connect.inc');
++
++// Run Test
++
++echo "Test 1: Import\n";
++
++$lob = oci\_new\_descriptor($c, OCI\_D\_LOB);
++$r = $lob-savefile("/tmp/abc\0def");
++var\_dump($r);
++
++echo "Test 2: Export\n";
++
++$r = $lob->export("/tmp/abc\0def");
++var\_dump($r);
++
++?>
++===DONE===
++php exit(0); ?
++--EXPECTF--
++Test 1: Import
++
++Warning: OCI-Lob::savefile(): Filename cannot contain null bytes in %snull\_byte\_1.php on line %d
++bool(false)
++Test 2: Export
++
++Warning: OCI-Lob::export(): Filename cannot contain null bytes in %snull\_byte\_1.php on line %d
++bool(false)
++===DONE===
+Index: ext/oci8/tests/null\_byte\_2.phpt
+===================================================================
+--- ext/oci8/tests/null\_byte\_2.phpt (revision 0)
++++ ext/oci8/tests/null\_byte\_2.phpt (revision 305412)
+@@ -0,0 +1,69 @@
++--TEST--
++Null bytes in SQL statements
++--SKIPIF--
++php if (!extension\_loaded('oci8')) die ("skip no oci8 extension"); ?
++--INI--
++display\_errors = On
++error\_reporting = E\_WARNING
++--FILE--
++php
++
++require(dirname(\_\_FILE\_\_).'/connect.inc');
++
++// Run Test
++
++echo "Test 1: Valid use of a null byte\n";
++
++$s = oci\_parse($c, "select \* \0from dual");
++oci\_execute($s);
++oci\_fetch\_all($s, $res);
++var\_dump($res);
++
++echo "Test 2: Invalid use of a null byte\n";
++
++$s = oci\_parse($c, "select \* from du\0al");
++oci\_execute($s);
++
++echo "Test 3: Using a null byte in a bind variable name\n";
++
++$s = oci\_parse($c, "select \* from dual where :bv = 1");
++$bv = 1;
++oci\_bind\_by\_name($s, ":bv\0:bv", $bv);
++oci\_execute($s);
++
++echo "Test 4: Using a null byte in a bind variable value causing WHERE clause to fail\n";
++
++$s = oci\_parse($c, "select \* from dual where :bv = 'abc'");
++$bv = 'abc\0abc';
++oci\_bind\_by\_name($s, ":bv", $bv);
++oci\_execute($s);
++oci\_fetch\_all($s, $res);
++var\_dump($res);
++
++?
++===DONE===
++php exit(0); ?
++--EXPECTF--
++Test 1: Valid use of a null byte
++array(1) {
++ ["DUMMY"]=>
++ array(1) {
++ [0]=>
++ string(1) "X"
++ }
++}
++Test 2: Invalid use of a null byte
++
++Warning: oci\_execute(): ORA-00942: %s in %snull\_byte\_2.php on line %d
++Test 3: Using a null byte in a bind variable name
++
++Warning: oci\_bind\_by\_name(): ORA-01036: %s in %snull\_byte\_2.php on line %d
++
++Warning: oci\_execute(): ORA-01008: %s in %snull\_byte\_2.php on line %d
++Test 4: Using a null byte in a bind variable value causing WHERE clause to fail
++array(1) {
++ ["DUMMY"]=>
++ array(0) {
++ }
++}
++===DONE===
+Index: ext/oci8/oci8\_interface.c
+===================================================================
+--- ext/oci8/oci8\_interface.c (revision 305411)
++++ ext/oci8/oci8\_interface.c (revision 305412)
+@@ -242,7 +242,12 @@
+ return;
+ }
+ }
+-
++
++ if (strlen(filename) != filename\_len) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Filename cannot contain null bytes");
++ RETURN\_FALSE;
++ }
++
+ if (zend\_hash\_find(Z\_OBJPROP\_P(z\_descriptor), "descriptor", sizeof("descriptor"), (void \*\*)&tmp) == FAILURE) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Unable to find descriptor property");
+ RETURN\_FALSE;
+@@ -894,7 +899,12 @@
+ RETURN\_FALSE;
+ }
+ }
+-
++
++ if (strlen(filename) != filename\_len) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Filename cannot contain null bytes");
++ RETURN\_FALSE;
++ }
++
+ if (zend\_hash\_find(Z\_OBJPROP\_P(z\_descriptor), "descriptor", sizeof("descriptor"), (void \*\*)&tmp) == FAILURE) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Unable to find descriptor property");
+ RETURN\_FALSE;
+@@ -1666,8 +1676,8 @@
+ }
+ /\* }}} \*/
+
+-/\* {{{ proto resource oci\_parse(resource connection, string query)
+- Parse a query and return a statement \*/
++/\* {{{ proto resource oci\_parse(resource connection, string statement)
++ Parse a SQL or PL/SQL statement and return a statement resource \*/
+ PHP\_FUNCTION(oci\_parse)
+ {
+ zval \*z\_connection;
+Index: ext/oci8/package.xml
+===================================================================
+--- ext/oci8/package.xml (revision 305411)
++++ ext/oci8/package.xml (revision 305412)
+@@ -306,6 +305,8 @@
+
+
+
++
++
+
+
+
+Index: ext/standard/ftok.c
+===================================================================
+--- ext/standard/ftok.c (revision 305506)
++++ ext/standard/ftok.c (revision 305507)
+@@ -39,6 +39,10 @@
+ return;
+ }
+
++ if (strlen(pathname) != pathname\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (pathname\_len == 0){
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Pathname is invalid");
+ RETURN\_LONG(-1);
+Index: ext/standard/basic\_functions.c
+===================================================================
+--- ext/standard/basic\_functions.c (revision 305506)
++++ ext/standard/basic\_functions.c (revision 305507)
+@@ -4673,6 +4673,12 @@
+ opt\_err = erropt;
+ }
+
++ if (opt\_err == 3) {
++ if (strlen(opt) != opt\_len) {
++ RETURN\_FALSE;
++ }
++ }
++
+ if (\_php\_error\_log\_ex(opt\_err, message, message\_len, opt, headers TSRMLS\_CC) == FAILURE) {
+ RETURN\_FALSE;
+ }
+@@ -5161,6 +5167,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (i) {
+ php\_start\_ob\_buffer (NULL, 0, 1 TSRMLS\_CC);
+ }
+@@ -5207,6 +5217,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ file\_handle.type = ZEND\_HANDLE\_FILENAME;
+ file\_handle.filename = filename;
+ file\_handle.free\_filename = 0;
+@@ -5467,6 +5481,11 @@
+ return;
+ }
+
++ /\* No nulls allowed in paths \*/
++ if (strlen(new\_value) != new\_value\_len) {
++ RETURN\_FALSE;
++ }
++
+ old\_value = zend\_ini\_string("include\_path", sizeof("include\_path"), 0);
+ /\* copy to return here, because alter might free it! \*/
+ if (old\_value) {
+@@ -5777,6 +5796,10 @@
+ return;
+ }
+
++ if (strlen(path) != path\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (zend\_hash\_exists(SG(rfc1867\_uploaded\_files), path, path\_len + 1)) {
+ RETURN\_TRUE;
+ } else {
+@@ -5817,6 +5840,14 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(path) != path\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(new\_path) != new\_path\_len) {
++ RETURN\_FALSE;
++ }
++
+ VCWD\_UNLINK(new\_path);
+ if (VCWD\_RENAME(path, new\_path) == 0) {
+ successful = 1;
+@@ -5960,6 +5991,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ /\* Set callback function \*/
+ if (process\_sections) {
+ BG(active\_ini\_file\_section) = NULL;
+Index: ext/standard/dir.c
+===================================================================
+--- ext/standard/dir.c (revision 305506)
++++ ext/standard/dir.c (revision 305507)
+@@ -325,6 +325,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(str) != str\_len) {
++ RETURN\_FALSE;
++ }
++
+ if ((PG(safe\_mode) && !php\_checkuid(str, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR)) || php\_check\_open\_basedir(str TSRMLS\_CC)) {
+ RETURN\_FALSE;
+ }
+@@ -436,6 +440,10 @@
+ return;
+ }
+
++ if (strlen(pattern) != pattern\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (pattern\_len >= MAXPATHLEN) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Pattern exceeds the maximum allowed length of %d characters", MAXPATHLEN);
+ RETURN\_FALSE;
+@@ -557,6 +565,10 @@
+ return;
+ }
+
++ if (strlen(dirn) != dirn\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (dirn\_len < 1) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Directory name cannot be empty");
+ RETURN\_FALSE;
+Index: ext/standard/iptc.c
+===================================================================
+--- ext/standard/iptc.c (revision 305506)
++++ ext/standard/iptc.c (revision 305507)
+@@ -190,6 +190,10 @@
+ return;
+ }
+
++ if (strlen(jpeg\_file) != jpeg\_file\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) && (!php\_checkuid(jpeg\_file, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+ }
+Index: ext/standard/filestat.c
+===================================================================
+--- ext/standard/filestat.c (revision 305506)
++++ ext/standard/filestat.c (revision 305507)
+@@ -379,6 +379,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(path) != path\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (php\_disk\_free\_space(path, &bytesfree TSRMLS\_CC) == SUCCESS) {
+ RETURN\_DOUBLE(bytesfree);
+ }
+@@ -399,6 +403,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (Z\_TYPE\_P(group) == IS\_LONG) {
+ gid = (gid\_t)Z\_LVAL\_P(group);
+ } else if (Z\_TYPE\_P(group) == IS\_STRING) {
+@@ -500,6 +508,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (Z\_TYPE\_P(user) == IS\_LONG) {
+ uid = (uid\_t)Z\_LVAL\_P(user);
+ } else if (Z\_TYPE\_P(user) == IS\_STRING) {
+@@ -607,6 +619,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ /\* Check the basedir \*/
+ if (php\_check\_open\_basedir(filename TSRMLS\_CC)) {
+ RETURN\_FALSE;
+@@ -660,6 +676,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ switch (argc) {
+ case 1:
+ #ifdef HAVE\_UTIME\_NULL
+@@ -715,8 +735,9 @@
+ PHPAPI void php\_clear\_stat\_cache(zend\_bool clear\_realpath\_cache, const char \*filename, int filename\_len TSRMLS\_DC)
+ {
+ /\* always clear CurrentStatFile and CurrentLStatFile even if filename is not NULL
+- \* as it may contains outdated data (e.g. "nlink" for a directory when deleting a file
++ \* as it may contain outdated data (e.g. "nlink" for a directory when deleting a file
+ \* in this directory, as shown by lstat\_stat\_variation9.phpt) \*/
++
+ if (BG(CurrentStatFile)) {
+ efree(BG(CurrentStatFile));
+ BG(CurrentStatFile) = NULL;
+@@ -777,6 +798,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_length) {
++ RETURN\_FALSE;
++ }
++
+ if ((wrapper = php\_stream\_locate\_url\_wrapper(filename, &local, 0 TSRMLS\_CC)) == &php\_plain\_files\_wrapper) {
+ if (php\_check\_open\_basedir(local TSRMLS\_CC)) {
+ RETURN\_FALSE;
+Index: ext/standard/file.c
+===================================================================
+--- ext/standard/file.c (revision 305506)
++++ ext/standard/file.c (revision 305507)
+@@ -386,6 +386,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ md.stream = php\_stream\_open\_wrapper(filename, "rb",
+ (use\_include\_path ? USE\_PATH : 0) | ENFORCE\_SAFE\_MODE | REPORT\_ERRORS,
+ NULL);
+@@ -539,6 +543,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (ZEND\_NUM\_ARGS() == 5 && maxlen < 0) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "length must be greater than or equal to zero");
+ RETURN\_FALSE;
+@@ -595,6 +603,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (Z\_TYPE\_P(data) == IS\_RESOURCE) {
+ php\_stream\_from\_zval(srcstream, &data);
+ }
+@@ -739,6 +751,11 @@
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "s|lr!", &filename, &filename\_len, &flags, &zcontext) == FAILURE) {
+ return;
+ }
++
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (flags < 0 || flags > (PHP\_FILE\_USE\_INCLUDE\_PATH | PHP\_FILE\_IGNORE\_NEW\_LINES | PHP\_FILE\_SKIP\_EMPTY\_LINES | PHP\_FILE\_NO\_DEFAULT\_CONTEXT)) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "'%ld' flag is not supported", flags);
+ RETURN\_FALSE;
+@@ -836,6 +853,14 @@
+ return;
+ }
+
++ if (strlen(dir) != dir\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(prefix) != prefix\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) &&(!php\_checkuid(dir, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+ }
+@@ -894,6 +919,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ context = php\_stream\_context\_from\_zval(zcontext, 0);
+
+ stream = php\_stream\_open\_wrapper\_ex(filename, mode, (use\_include\_path ? USE\_PATH : 0) | ENFORCE\_SAFE\_MODE | REPORT\_ERRORS, NULL, context);
+@@ -1397,6 +1426,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(dir) != dir\_len) {
++ RETURN\_FALSE;
++ }
++
+ context = php\_stream\_context\_from\_zval(zcontext, 0);
+
+ RETURN\_BOOL(php\_stream\_mkdir(dir, mode, (recursive ? PHP\_STREAM\_MKDIR\_RECURSIVE : 0) | REPORT\_ERRORS, context));
+@@ -1416,6 +1449,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(dir) != dir\_len) {
++ RETURN\_FALSE;
++ }
++
+ context = php\_stream\_context\_from\_zval(zcontext, 0);
+
+ RETURN\_BOOL(php\_stream\_rmdir(dir, REPORT\_ERRORS, context));
+@@ -1438,6 +1475,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ context = php\_stream\_context\_from\_zval(zcontext, 0);
+
+ stream = php\_stream\_open\_wrapper\_ex(filename, "rb", (use\_include\_path ? USE\_PATH : 0) | ENFORCE\_SAFE\_MODE | REPORT\_ERRORS, NULL, context);
+@@ -1511,6 +1552,14 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(old\_name) != old\_name\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(new\_name) != new\_name\_len) {
++ RETURN\_FALSE;
++ }
++
+ wrapper = php\_stream\_locate\_url\_wrapper(old\_name, NULL, 0 TSRMLS\_CC);
+
+ if (!wrapper || !wrapper->wops) {
+@@ -1548,6 +1597,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ context = php\_stream\_context\_from\_zval(zcontext, 0);
+
+ wrapper = php\_stream\_locate\_url\_wrapper(filename, NULL, 0 TSRMLS\_CC);
+@@ -1684,6 +1737,14 @@
+ return;
+ }
+
++ if (strlen(source) != source\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(target) != target\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) &&(!php\_checkuid(source, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+ }
+@@ -2385,6 +2446,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (VCWD\_REALPATH(filename, resolved\_path\_buff)) {
+ if (PG(safe\_mode) && (!php\_checkuid(resolved\_path\_buff, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+@@ -2527,6 +2592,14 @@
+ return;
+ }
+
++ if (strlen(pattern) != pattern\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (filename\_len >= MAXPATHLEN) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Filename exceeds the maximum allowed length of %d characters", MAXPATHLEN);
+ RETURN\_FALSE;
+Index: ext/standard/link.c
+===================================================================
+--- ext/standard/link.c (revision 305506)
++++ ext/standard/link.c (revision 305507)
+@@ -64,6 +64,10 @@
+ return;
+ }
+
++ if (strlen(link) != link\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) && !php\_checkuid(link, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR)) {
+ RETURN\_FALSE;
+ }
+@@ -123,6 +127,14 @@
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "ss", &topath, &topath\_len, &frompath, &frompath\_len) == FAILURE) {
+ return;
+ }
++
++ if (strlen(topath) != topath\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(frompath) != frompath\_len) {
++ RETURN\_FALSE;
++ }
+
+ if (!expand\_filepath(frompath, source\_p TSRMLS\_CC)) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "No such file or directory");
+@@ -188,6 +200,14 @@
+ return;
+ }
+
++ if (strlen(topath) != topath\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(frompath) != frompath\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (!expand\_filepath(frompath, source\_p TSRMLS\_CC) || !expand\_filepath(topath, dest\_p TSRMLS\_CC)) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "No such file or directory");
+ RETURN\_FALSE;
+Index: ext/openssl/openssl.c
+===================================================================
+--- ext/openssl/openssl.c (revision 305506)
++++ ext/openssl/openssl.c (revision 305507)
+@@ -1771,6 +1771,10 @@
+ return;
+
+ RETVAL\_FALSE;
++
++ if (strlen(filename) != filename\_len) {
++ return;
++ }
+
+ cert = php\_openssl\_x509\_from\_zval(zcert, 0, &certresource TSRMLS\_CC);
+ if (cert == NULL) {
+@@ -2219,6 +2223,10 @@
+ }
+ RETVAL\_FALSE;
+
++ if (strlen(filename) != filename\_len) {
++ return;
++ }
++
+ csr = php\_openssl\_csr\_from\_zval(&zcsr, 0, &csr\_resource TSRMLS\_CC);
+ if (csr == NULL) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "cannot get CSR from parameter 1");
+@@ -3003,6 +3011,10 @@
+ }
+ RETVAL\_FALSE;
+
++ if (strlen(filename) != filename\_len) {
++ return;
++ }
++
+ key = php\_openssl\_evp\_from\_zval(zpkey, 0, passphrase, 0, &key\_resource TSRMLS\_CC);
+
+ if (key == NULL) {
+@@ -3395,7 +3407,14 @@
+ &outfilename, &outfilename\_len, &zrecipcerts, &zheaders, &flags, &cipherid) == FAILURE)
+ return;
+
+-
++ if (strlen(infilename) != infilename\_len) {
++ return;
++ }
++
++ if (strlen(outfilename) != outfilename\_len) {
++ return;
++ }
++
+ if (php\_openssl\_safe\_mode\_chk(infilename TSRMLS\_CC) || php\_openssl\_safe\_mode\_chk(outfilename TSRMLS\_CC)) {
+ return;
+ }
+@@ -3527,15 +3546,23 @@
+ char \* outfilename; int outfilename\_len;
+ char \* extracertsfilename = NULL; int extracertsfilename\_len;
+
++ RETVAL\_FALSE;
++
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "ssZZa!|ls",
+ &infilename, &infilename\_len, &outfilename, &outfilename\_len,
+ &zcert, &zprivkey, &zheaders, &flags, &extracertsfilename,
+ &extracertsfilename\_len) == FAILURE) {
+ return;
+ }
+-
+- RETVAL\_FALSE;
+
++ if (strlen(infilename) != infilename\_len) {
++ return;
++ }
++
++ if (strlen(outfilename) != outfilename\_len) {
++ return;
++ }
++
+ if (extracertsfilename) {
+ others = load\_all\_certs\_from\_file(extracertsfilename);
+ if (others == NULL) {
+@@ -3631,13 +3658,21 @@
+ char \* infilename; int infilename\_len;
+ char \* outfilename; int outfilename\_len;
+
++ RETVAL\_FALSE;
++
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "ssZ|Z", &infilename, &infilename\_len,
+ &outfilename, &outfilename\_len, &recipcert, &recipkey) == FAILURE) {
+ return;
+ }
+
+- RETVAL\_FALSE;
++ if (strlen(infilename) != infilename\_len) {
++ return;
++ }
+
++ if (strlen(outfilename) != outfilename\_len) {
++ return;
++ }
++
+ cert = php\_openssl\_x509\_from\_zval(recipcert, 0, &certresval TSRMLS\_CC);
+ if (cert == NULL) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "unable to coerce parameter 3 to x509 cert");
+Index: ext/sqlite3/sqlite3.c
+===================================================================
+--- ext/sqlite3/sqlite3.c (revision 305506)
++++ ext/sqlite3/sqlite3.c (revision 305507)
+@@ -114,6 +114,9 @@
+ zend\_throw\_exception(zend\_exception\_get\_default(TSRMLS\_C), "Already initialised DB Object", 0 TSRMLS\_CC);
+ }
+
++ if (strlen(filename) != filename\_len) {
++ return;
++ }
+ if (strncmp(filename, ":memory:", 8) != 0) {
+ if (!(fullpath = expand\_filepath(filename, NULL TSRMLS\_CC))) {
+ zend\_throw\_exception(zend\_exception\_get\_default(TSRMLS\_C), "Unable to expand filepath", 0 TSRMLS\_CC);
+Index: ext/pgsql/pgsql.c
+===================================================================
+--- ext/pgsql/pgsql.c (revision 305506)
++++ ext/pgsql/pgsql.c (revision 305507)
+@@ -3339,6 +3339,10 @@
+ WRONG\_PARAM\_COUNT;
+ }
+
++ if (strlen(file\_in) != name\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) &&(!php\_checkuid(file\_in, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+ }
+@@ -3476,6 +3480,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(file\_out) != name\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) &&(!php\_checkuid(file\_out, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+ }
+Index: ext/gd/gd\_ctx.c
+===================================================================
+--- ext/gd/gd\_ctx.c (revision 305506)
++++ ext/gd/gd\_ctx.c (revision 305507)
+@@ -91,6 +91,9 @@
+ }
+
+ if (argc > 1 && file\_len) {
++ if (strlen(file) != file\_len) {
++ RETURN\_FALSE;
++ }
+ PHP\_GD\_CHECK\_OPEN\_BASEDIR(file, "Invalid filename");
+
+ fp = VCWD\_FOPEN(file, "wb");
+Index: ext/gd/gd.c
+===================================================================
+--- ext/gd/gd.c (revision 305506)
++++ ext/gd/gd.c (revision 305507)
+@@ -2642,6 +2642,9 @@
+ }
+
+ if (argc >= 2 && file\_len) {
++ if (strlen(file) != file\_len) {
++ RETURN\_FALSE;
++ }
+ PHP\_GD\_CHECK\_OPEN\_BASEDIR(fn, "Invalid filename");
+
+ fp = VCWD\_FOPEN(fn, "wb");
+@@ -4552,6 +4555,14 @@
+ dest\_width = width;
+ int\_threshold = threshold;
+
++ if (strlen(f\_org) != f\_org\_len) {
++ RETURN\_FALSE;
++ }
++
++ if (strlen(f\_dest) != f\_dest\_len) {
++ RETURN\_FALSE;
++ }
++
+ /\* Check threshold value \*/
+ if (int\_threshold < 0 || int\_threshold > 8) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Invalid threshold value '%d'", int\_threshold);
+Index: ext/sqlite/sqlite.c
+===================================================================
+--- ext/sqlite/sqlite.c (revision 305506)
++++ ext/sqlite/sqlite.c (revision 305507)
+@@ -1560,6 +1560,9 @@
+ ZVAL\_NULL(errmsg);
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
+ if (strncmp(filename, ":memory:", sizeof(":memory:") - 1)) {
+ /\* resolve the fully-qualified path name to use as the hash key \*/
+ if (!(fullpath = expand\_filepath(filename, NULL TSRMLS\_CC))) {
+@@ -1637,6 +1640,9 @@
+ ZVAL\_NULL(errmsg);
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
+ if (strncmp(filename, ":memory:", sizeof(":memory:") - 1)) {
+ /\* resolve the fully-qualified path name to use as the hash key \*/
+ if (!(fullpath = expand\_filepath(filename, NULL TSRMLS\_CC))) {
+@@ -1690,6 +1696,10 @@
+ ZVAL\_NULL(errmsg);
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (strncmp(filename, ":memory:", sizeof(":memory:") - 1)) {
+ /\* resolve the fully-qualified path name to use as the hash key \*/
+ if (!(fullpath = expand\_filepath(filename, NULL TSRMLS\_CC))) {
+Index: ext/posix/posix.c
+===================================================================
+--- ext/posix/posix.c (revision 305506)
++++ ext/posix/posix.c (revision 305507)
+@@ -842,6 +842,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(path) != path\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (php\_check\_open\_basedir\_ex(path, 0 TSRMLS\_CC) ||
+ (PG(safe\_mode) && (!php\_checkuid(path, NULL, CHECKUID\_ALLOW\_ONLY\_DIR)))) {
+ RETURN\_FALSE;
+@@ -877,6 +881,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(path) != path\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (php\_check\_open\_basedir\_ex(path, 0 TSRMLS\_CC) ||
+ (PG(safe\_mode) && (!php\_checkuid(path, NULL, CHECKUID\_ALLOW\_ONLY\_DIR)))) {
+ RETURN\_FALSE;
+@@ -957,6 +965,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ path = expand\_filepath(filename, NULL TSRMLS\_CC);
+ if (!path) {
+ POSIX\_G(last\_error) = EIO;
+Index: ext/xsl/xsltprocessor.c
+===================================================================
+--- ext/xsl/xsltprocessor.c (revision 305506)
++++ ext/xsl/xsltprocessor.c (revision 305507)
+@@ -642,6 +642,9 @@
+
+ ret = -1;
+ if (newdocp) {
++ if (strlen(uri) != uri\_len) {
++ RETURN\_FALSE;
++ }
+ ret = xsltSaveResultToFilename(uri, newdocp, sheetp, 0);
+ xmlFreeDoc(newdocp);
+ }
+@@ -845,7 +848,7 @@
+ if (intern->profiling) {
+ efree(intern->profiling);
+ }
+- if (filename != NULL) {
++ if (filename != NULL && strlen(filename) == filename\_len) {
+ intern->profiling = estrndup(filename,filename\_len);
+ } else {
+ intern->profiling = NULL;
+Index: ext/com\_dotnet/com\_persist.c
+===================================================================
+--- ext/com\_dotnet/com\_persist.c (revision 305506)
++++ ext/com\_dotnet/com\_persist.c (revision 305507)
+@@ -389,6 +389,9 @@
+ }
+
+ if (filename) {
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
+ fullpath = expand\_filepath(filename, NULL TSRMLS\_CC);
+ if (!fullpath) {
+ RETURN\_FALSE;
+@@ -453,6 +456,10 @@
+ return;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (!(fullpath = expand\_filepath(filename, NULL TSRMLS\_CC))) {
+ RETURN\_FALSE;
+ }
+Index: ext/bz2/bz2.c
+===================================================================
+--- ext/bz2/bz2.c (revision 305506)
++++ ext/bz2/bz2.c (revision 305507)
+@@ -387,6 +387,9 @@
+ if (Z\_TYPE\_PP(file) == IS\_STRING) {
+ convert\_to\_string\_ex(file);
+
++ if (strlen(Z\_STRVAL\_PP(file)) != Z\_STRLEN\_PP(file)) {
++ RETURN\_FALSE;
++ }
+ if (Z\_STRLEN\_PP(file) == 0) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "filename cannot be empty");
+ RETURN\_FALSE;
+Index: ext/pspell/pspell.c
+===================================================================
+--- ext/pspell/pspell.c (revision 305506)
++++ ext/pspell/pspell.c (revision 305507)
+@@ -402,6 +402,10 @@
+ }
+ #endif
+
++ if (strlen(personal) != personal\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) && (!php\_checkuid(personal, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ delete\_pspell\_config(config);
+ RETURN\_FALSE;
+@@ -834,6 +838,10 @@
+ return;
+ }
+
++ if (strlen(value) != value\_len) {
++ RETURN\_FALSE;
++ }
++
+ PSPELL\_FETCH\_CONFIG;
+
+ if (PG(safe\_mode) && (!php\_checkuid(value, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+@@ -891,6 +899,10 @@
+
+ pspell\_config\_replace(config, "save-repl", "true");
+
++ if (strlen(repl) != repl\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (PG(safe\_mode) && (!php\_checkuid(repl, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+ }
+Index: ext/enchant/enchant.c
+===================================================================
+--- ext/enchant/enchant.c (revision 305506)
++++ ext/enchant/enchant.c (revision 305507)
+@@ -591,6 +591,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(pwl) != pwllen) {
++ RETURN\_FALSE;
++ }
++
+ if ((PG(safe\_mode) && (!php\_checkuid(pwl, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) || php\_check\_open\_basedir(pwl TSRMLS\_CC)) {
+ RETURN\_FALSE;
+ }
+Index: ext/imap/php\_imap.c
+===================================================================
+--- ext/imap/php\_imap.c (revision 305506)
++++ ext/imap/php\_imap.c (revision 305507)
+@@ -1218,10 +1218,14 @@
+ }
+
+ /\* local filename, need to perform open\_basedir and safe\_mode checks \*/
+- if (mailbox[0] != '{' &&
+- (php\_check\_open\_basedir(mailbox TSRMLS\_CC) ||
+- (PG(safe\_mode) && !php\_checkuid(mailbox, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR)))) {
+- RETURN\_FALSE;
++ if (mailbox[0] != '{') {
++ if (strlen(mailbox) != mailbox\_len) {
++ RETURN\_FALSE;
++ }
++ if (php\_check\_open\_basedir(mailbox TSRMLS\_CC) ||
++ (PG(safe\_mode) && !php\_checkuid(mailbox, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
++ RETURN\_FALSE;
++ }
+ }
+
+ IMAPG(imap\_user) = estrndup(user, user\_len);
+Index: ext/fileinfo/fileinfo.c
+===================================================================
+--- ext/fileinfo/fileinfo.c (revision 305506)
++++ ext/fileinfo/fileinfo.c (revision 305507)
+@@ -294,6 +294,9 @@
+ }
+
+ if (file && \*file) { /\* user specified file, perform open\_basedir checks \*/
++ if (strlen(file) != file\_len) {
++ RETURN\_FALSE;
++ }
+ if (!VCWD\_REALPATH(file, resolved\_path)) {
+ RETURN\_FALSE;
+ }
+Index: ext/oci8/oci8\_interface.c
+===================================================================
+--- ext/oci8/oci8\_interface.c (revision 305506)
++++ ext/oci8/oci8\_interface.c (revision 305507)
+@@ -276,6 +276,10 @@
+ return;
+ }
+ }
++
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
+
+ if (zend\_hash\_find(Z\_OBJPROP\_P(z\_descriptor), "descriptor", sizeof("descriptor"), (void \*\*)&tmp) == FAILURE) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Unable to find descriptor property");
+@@ -667,7 +671,7 @@
+ RETURN\_FALSE;
+ }
+ }
+-
++
+ if (zend\_hash\_find(Z\_OBJPROP\_P(z\_descriptor), "descriptor", sizeof("descriptor"), (void \*\*)&tmp) == FAILURE) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Unable to find descriptor property");
+ RETURN\_FALSE;
+@@ -928,6 +932,10 @@
+ /\* nothing to write, fail silently \*/
+ RETURN\_FALSE;
+ }
++
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
+
+ if (PG(safe\_mode) && (!php\_checkuid(filename, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+ RETURN\_FALSE;
+Index: ext/zip/php\_zip.c
+===================================================================
+--- ext/zip/php\_zip.c (revision 305506)
++++ ext/zip/php\_zip.c (revision 305507)
+@@ -1148,6 +1148,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (OPENBASEDIR\_CHECKPATH(filename)) {
+ RETURN\_FALSE;
+ }
+@@ -1437,6 +1441,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(filename) != filename\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (OPENBASEDIR\_CHECKPATH(filename)) {
+ RETURN\_FALSE;
+ }
+@@ -2363,6 +2371,10 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(pathto) != pathto\_len) {
++ RETURN\_FALSE;
++ }
++
+ if (php\_stream\_stat\_path(pathto, &ssb) < 0) {
+ ret = php\_stream\_mkdir(pathto, 0777, PHP\_STREAM\_MKDIR\_RECURSIVE, NULL);
+ if (!ret) {
+@@ -2449,6 +2461,9 @@
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "s|ll", &filename, &filename\_len, &len, &flags) == FAILURE) {
+ return;
+ }
++ if (strlen(filename) != filename\_len) {
++ return;
++ }
+ PHP\_ZIP\_STAT\_PATH(intern, filename, filename\_len, flags, sb);
+ } else {
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "l|ll", &index, &len, &flags) == FAILURE) {
+Index: ext/odbc/php\_odbc.c
+===================================================================
+--- ext/odbc/php\_odbc.c (revision 305506)
++++ ext/odbc/php\_odbc.c (revision 305507)
+@@ -1317,8 +1317,11 @@
+ if (Z\_STRLEN\_PP(tmp) > 2 &&
+ Z\_STRVAL\_PP(tmp)[0] == '\'' &&
+ Z\_STRVAL\_PP(tmp)[Z\_STRLEN\_PP(tmp) - 1] == '\'') {
++ if (strlen(tmp) != Z\_STRLEN\_PP(tmp)) {
++ RETURN\_FALSE;
++ }
++
+ filename = estrndup(&Z\_STRVAL\_PP(tmp)[1], Z\_STRLEN\_PP(tmp) - 2);
+- filename[strlen(filename)] = '\0';
+
+ /\* Check for safe mode. \*/
+ if (PG(safe\_mode) && (!php\_checkuid(filename, NULL, CHECKUID\_CHECK\_FILE\_AND\_DIR))) {
+Index: ext/tidy/tidy.c
+===================================================================
+--- ext/tidy/tidy.c (revision 305506)
++++ ext/tidy/tidy.c (revision 305507)
+@@ -567,6 +567,9 @@
+ }
+
+ if (is\_file) {
++ if (strlen(arg1) != arg1\_len) {
++ RETURN\_FALSE;
++ }
+ if (!(data = php\_tidy\_file\_to\_mem(arg1, use\_include\_path, &data\_len TSRMLS\_CC))) {
+ RETURN\_FALSE;
+ }
+@@ -1221,6 +1224,9 @@
+ RETURN\_FALSE;
+ }
+
++ if (strlen(inputfile) != input\_len) {
++ RETURN\_FALSE;
++ }
+ tidy\_instanciate(tidy\_ce\_doc, return\_value TSRMLS\_CC);
+ obj = (PHPTidyObj \*) zend\_object\_store\_get\_object(return\_value TSRMLS\_CC);
+
+@@ -1534,10 +1540,13 @@
+ &options, &enc, &enc\_len, &use\_include\_path) == FAILURE) {
+ RETURN\_FALSE;
+ }
+-
++
+ obj = (PHPTidyObj \*)zend\_object\_store\_get\_object(object TSRMLS\_CC);
+
+ if (inputfile) {
++ if (strlen(inputfile) != input\_len) {
++ RETURN\_FALSE;
++ }
+ if (!(contents = php\_tidy\_file\_to\_mem(inputfile, use\_include\_path, &contents\_len TSRMLS\_CC))) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Cannot Load '%s' into memory %s", inputfile, (use\_include\_path) ? "(Using include path)" : "");
+ return;
+@@ -1568,7 +1577,10 @@
+ &options, &enc, &enc\_len, &use\_include\_path) == FAILURE) {
+ RETURN\_FALSE;
+ }
+-
++
++ if (strlen(inputfile) != input\_len) {
++ RETURN\_FALSE;
++ }
+ if (!(contents = php\_tidy\_file\_to\_mem(inputfile, use\_include\_path, &contents\_len TSRMLS\_CC))) {
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Cannot Load '%s' into memory %s", inputfile, (use\_include\_path) ? "(Using include path)" : "");
+ RETURN\_FALSE;
+Index: Zend/zend\_vm\_execute.h
+===================================================================
+--- Zend/zend\_vm\_execute.h (revision 305506)
++++ Zend/zend\_vm\_execute.h (revision 305507)
+@@ -1880,6 +1880,16 @@
+
+ return\_value\_used = RETURN\_VALUE\_USED(opline);
+
++ if (Z\_LVAL(opline->op2.u.constant) != ZEND\_EVAL && strlen(Z\_STRVAL\_P(inc\_filename)) != Z\_STRLEN\_P(inc\_filename)) {
++ if (Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE\_ONCE ||
++ Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE) {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_INCLUDE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ } else {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_REQUIRE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ }
++ goto done;
++ }
++
+ switch (Z\_LVAL(opline->op2.u.constant)) {
+ case ZEND\_INCLUDE\_ONCE:
+ case ZEND\_REQUIRE\_ONCE: {
+@@ -1933,6 +1943,7 @@
+ break;
+ EMPTY\_SWITCH\_DEFAULT\_CASE()
+ }
++done:
+ if (inc\_filename==&tmp\_inc\_filename) {
+ zval\_dtor(&tmp\_inc\_filename);
+ }
+@@ -5154,6 +5165,16 @@
+
+ return\_value\_used = RETURN\_VALUE\_USED(opline);
+
++ if (Z\_LVAL(opline->op2.u.constant) != ZEND\_EVAL && strlen(Z\_STRVAL\_P(inc\_filename)) != Z\_STRLEN\_P(inc\_filename)) {
++ if (Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE\_ONCE ||
++ Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE) {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_INCLUDE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ } else {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_REQUIRE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ }
++ goto done;
++ }
++
+ switch (Z\_LVAL(opline->op2.u.constant)) {
+ case ZEND\_INCLUDE\_ONCE:
+ case ZEND\_REQUIRE\_ONCE: {
+@@ -5207,6 +5228,7 @@
+ break;
+ EMPTY\_SWITCH\_DEFAULT\_CASE()
+ }
++done:
+ if (inc\_filename==&tmp\_inc\_filename) {
+ zval\_dtor(&tmp\_inc\_filename);
+ }
+@@ -8524,6 +8546,16 @@
+
+ return\_value\_used = RETURN\_VALUE\_USED(opline);
+
++ if (Z\_LVAL(opline->op2.u.constant) != ZEND\_EVAL && strlen(Z\_STRVAL\_P(inc\_filename)) != Z\_STRLEN\_P(inc\_filename)) {
++ if (Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE\_ONCE ||
++ Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE) {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_INCLUDE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ } else {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_REQUIRE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ }
++ goto done;
++ }
++
+ switch (Z\_LVAL(opline->op2.u.constant)) {
+ case ZEND\_INCLUDE\_ONCE:
+ case ZEND\_REQUIRE\_ONCE: {
+@@ -8577,6 +8609,7 @@
+ break;
+ EMPTY\_SWITCH\_DEFAULT\_CASE()
+ }
++done:
+ if (inc\_filename==&tmp\_inc\_filename) {
+ zval\_dtor(&tmp\_inc\_filename);
+ }
+@@ -22387,6 +22420,16 @@
+
+ return\_value\_used = RETURN\_VALUE\_USED(opline);
+
++ if (Z\_LVAL(opline->op2.u.constant) != ZEND\_EVAL && strlen(Z\_STRVAL\_P(inc\_filename)) != Z\_STRLEN\_P(inc\_filename)) {
++ if (Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE\_ONCE ||
++ Z\_LVAL(opline->op2.u.constant)==ZEND\_INCLUDE) {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_INCLUDE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ } else {
++ zend\_message\_dispatcher(ZMSG\_FAILED\_REQUIRE\_FOPEN, Z\_STRVAL\_P(inc\_filename) TSRMLS\_CC);
++ }
++ goto done;
++ }
++
+ switch (Z\_LVAL(opline->op2.u.constant)) {
+ case ZEND\_INCLUDE\_ONCE:
+ case ZEND\_REQUIRE\_ONCE: {
+@@ -22440,6 +22483,7 @@
+ break;
+ EMPTY\_SWITCH\_DEFAULT\_CASE()
+ }
++done:
+ if (inc\_filename==&tmp\_inc\_filename) {
+ zval\_dtor(&tmp\_inc\_filename);
+ }
+Index: main/fopen\_wrappers.c
+===================================================================
+--- main/fopen\_wrappers.c (revision 305506)
++++ main/fopen\_wrappers.c (revision 305507)
+@@ -538,6 +538,10 @@
+ return NULL;
+ }
+
++ if (strlen(filename) != filename\_length) {
++ return NULL;
++ }
++
+ /\* Don't resolve paths which contain protocol (except of file://) \*/
+ for (p = filename; isalnum((int)\*p) || \*p == '+' || \*p == '-' || \*p == '.'; p++);
+ if ((\*p == ':') && (p - filename > 1) && (p[1] == '/') && (p[2] == '/')) {
+Index: ext/standard/tests/file/file\_put\_contents\_variation8.phpt
+===================================================================
+--- ext/standard/tests/file/file\_put\_contents\_variation8.phpt (revision 305634)
++++ ext/standard/tests/file/file\_put\_contents\_variation8.phpt (revision 305635)
+@@ -70,9 +70,7 @@
+ -- Iteration 5 --
+ 9 bytes written to:
+ -- Iteration 6 --
+-
+-Warning: file\_put\_contents(): Filename cannot be empty in %s on line %d
+-Failed to write data to:  
++Failed to write data to:
+ -- Iteration 7 --
+
+ Warning: file\_put\_contents() expects parameter 1 to be string, array given in %s on line %d
+Index: ext/standard/tests/file/glob\_variation.phpt
+===================================================================
+--- ext/standard/tests/file/glob\_variation.phpt (revision 305634)
++++ ext/standard/tests/file/glob\_variation.phpt (revision 305635)
+@@ -325,20 +325,12 @@
+ }
+
+ -- Iteration 8 --
+-array(0) {
+-}
+-array(0) {
+-}
+-array(0) {
+-}
+-array(1) {
+- [0]=>
+- string(%d) "%s/glob\_variation/WONDER5"
+-}
+-array(0) {
+-}
+-array(0) {
+-}
++bool(false)
++bool(false)
++bool(false)
++bool(false)
++bool(false)
++bool(false)
+
+ -- Iteration 9 --
+ array(0) {
+@@ -441,8 +433,7 @@
+ array(0) {
+ }
+ -- Iteration 8 --
+-array(0) {
+-}
++bool(false)
+ -- Iteration 9 --
+ array(0) {
+ }
+Index: ext/standard/tests/file/copy\_variation4.phpt
+===================================================================
+--- ext/standard/tests/file/copy\_variation4.phpt (revision 305634)
++++ ext/standard/tests/file/copy\_variation4.phpt (revision 305635)
+@@ -2,9 +2,6 @@
+ Test copy() function: usage variations - destination file names(empty string, nulls & bools)
+ --SKIPIF--
+ php
+-if(substr(PHP\_OS, 0, 3) == "WIN")
+- die("skip Do not run on Windows");
+-
+ if(substr(PHP\_OS, 0, 3) == "AIX")
+ die("skip Do not run on AIX");
+ ?
+@@ -22,7 +19,7 @@
+ echo "\*\*\* Test copy() function: destination file names with empty string, nulls & bools \*\*\*\n";
+ $file\_path = dirname(\_\_FILE\_\_);
+ $src\_file\_name = $file\_path."/copy\_variation4.tmp";
+-$file\_handle = fopen($src\_file\_name, "w");
++$file\_handle = fopen($src\_file\_name, "wb");
+ fwrite( $file\_handle, str\_repeat(b"Hello2World...\n", 100) );
+ fclose($file\_handle);
+
+@@ -114,17 +111,13 @@
+ Warning: unlink(%s): %s
+
+ -- Iteration 3 --
+-Existence of destination file before copy => bool(true)
+-Copy operation =>
+-Warning: copy(): The second argument to copy() function cannot be a directory in %s on line %d
+-bool(false)
+-Existence of destination file => bool(true)
+-Destination file name => %s/ 
++Existence of destination file before copy => bool(false)
++Copy operation => bool(false)
++Existence of destination file => bool(false)
++Destination file name => %s/
+ Size of source file => int(1500)
+-Size of destination file => int(%d)
++Size of destination file => bool(false)
+
+-Warning: unlink(%s): %s
+-
+ -- Iteration 4 --
+ Existence of destination file before copy => bool(true)
+ Copy operation =>
+Index: ext/standard/tests/file/stream\_rfc2397\_006.phpt
+===================================================================
+--- ext/standard/tests/file/stream\_rfc2397\_006.phpt (revision 305634)
++++ ext/standard/tests/file/stream\_rfc2397\_006.phpt (revision 305635)
+@@ -21,8 +21,8 @@
+ ===DONE===
+ php exit(0); ?
+ --EXPECTF--
+-string(0) ""
+-string(6) "foobar"
++bool(false)
++bool(false)
+ string(13) "foobar foobar"
+
+ Warning: file\_get\_contents(data:;base64,#Zm9vYmFyIGZvb2Jhc=): failed to open stream: rfc2397: unable to decode in %sstream\_rfc2397\_006.php on line %d
+Index: ext/standard/tests/file/file\_get\_contents\_variation8-win32.phpt
+===================================================================
+--- ext/standard/tests/file/file\_get\_contents\_variation8-win32.phpt (revision 305634)
++++ ext/standard/tests/file/file\_get\_contents\_variation8-win32.phpt (revision 305635)
+@@ -76,8 +76,6 @@
+ bool(false)
+
+ -- Filename: \0 --
+-
+-Warning: file\_get\_contents(): Filename cannot be empty in %s on line %d
+ bool(false)
+
+ -- Filename: array() --
+Index: ext/standard/tests/file/readfile\_variation10.phpt
+===================================================================
+--- ext/standard/tests/file/readfile\_variation10.phpt (revision 305634)
++++ ext/standard/tests/file/readfile\_variation10.phpt (revision 305635)
+@@ -39,7 +39,7 @@
+ for( $i=0; $i 100600
+ File created in => temp dir
+ -- Iteration 6 --
+-File name is => %s%etempnam\_variation3.tmp%s
+-File permissions are => 100600
+-File created in => temp dir
++-- File is not created --
++
++Warning: unlink(): %s in %s on line %d
+ -- Iteration 7 --
+
+ Warning: tempnam() expects parameter 1 to be string, array given in %s on line %d
+Index: ext/standard/tests/file/fileperms\_variation3.phpt
+===================================================================
+--- ext/standard/tests/file/fileperms\_variation3.phpt (revision 305634)
++++ ext/standard/tests/file/fileperms\_variation3.phpt (revision 305635)
+@@ -74,8 +74,8 @@
+ Warning: fileperms(): stat failed for %s/fileperms\_variation3/fileperms\*.tmp in %s on line %d
+ bool(false)
+ - Iteration 7 -
+-int(%d)
++bool(false)
+ - Iteration 8 -
+-int(%d)
++bool(false)
+
+ \*\*\* Done \*\*\*
+Index: ext/standard/tests/file/is\_dir\_variation4.phpt
+===================================================================
+--- ext/standard/tests/file/is\_dir\_variation4.phpt (revision 305634)
++++ ext/standard/tests/file/is\_dir\_variation4.phpt (revision 305635)
+@@ -77,9 +77,9 @@
+ bool(false)
+
+ -- Iteration 9 --
+-bool(true)
++bool(false)
+
+ -- Iteration 10 --
+-bool(true)
++bool(false)
+
+ \*\*\* Done \*\*\*
+Index: ext/standard/tests/file/disk\_free\_space\_variation.phpt
+===================================================================
+--- ext/standard/tests/file/disk\_free\_space\_variation.phpt (revision 305634)
++++ ext/standard/tests/file/disk\_free\_space\_variation.phpt (revision 305635)
+@@ -105,19 +105,19 @@
+ float(%d)
+
+ -- Iteration 9 --
+-float(%d)
+-float(%d)
++bool(false)
++bool(false)
+
+ -- Iteration 10 --
+-float(%d)
+-float(%d)
++bool(false)
++bool(false)
+
+ -- Iteration 11 --
+-float(%d)
+-float(%d)
++bool(false)
++bool(false)
+
+ -- Iteration 12 --
+-float(%d)
+-float(%d)
++bool(false)
++bool(false)
+
+ --- Done ---
+Index: ext/standard/tests/file/fileowner\_variation3.phpt
+===================================================================
+--- ext/standard/tests/file/fileowner\_variation3.phpt (revision 305634)
++++ ext/standard/tests/file/fileowner\_variation3.phpt (revision 305635)
+@@ -75,8 +75,8 @@
+ Warning: fileowner(): stat failed for %s/fileowner\_variation3/fileowner\*.tmp in %s on line %d
+ bool(false)
+ - Iteration 7 -
+-int(%d)
++bool(false)
+ - Iteration 8 -
+-int(%d)
++bool(false)
+
+ \*\*\* Done \*\*\*
+Index: ext/standard/tests/file/filegroup\_variation3.phpt
+===================================================================
+--- ext/standard/tests/file/filegroup\_variation3.phpt (revision 305634)
++++ ext/standard/tests/file/filegroup\_variation3.phpt (revision 305635)
+@@ -74,8 +74,8 @@
+ Warning: filegroup(): stat failed for %s/filegroup\_variation3/filegroup\*.tmp in %s on line %d
+ bool(false)
+ - Iteration 7 -
+-int(%d)
++bool(false)
+ - Iteration 8 -
+-int(%d)
++bool(false)
+
+ \*\*\* Done \*\*\*
+Index: ext/standard/tests/file/file\_get\_contents\_variation8.phpt
+===================================================================
+--- ext/standard/tests/file/file\_get\_contents\_variation8.phpt (revision 305634)
++++ ext/standard/tests/file/file\_get\_contents\_variation8.phpt (revision 305635)
+@@ -68,8 +68,6 @@
+ Warning: file\_get\_contents( ): failed to open stream: No such file or directory in %s on line %d
+ bool(false)
+ -- Iteration 6 --
+-
+-Warning: file\_get\_contents(): Filename cannot be empty in %s on line %d
+ bool(false)
+ -- Iteration 7 --
+
+Index: ext/standard/tests/file/is\_writable\_variation1.phpt
+===================================================================
+--- ext/standard/tests/file/is\_writable\_variation1.phpt (revision 305634)
++++ ext/standard/tests/file/is\_writable\_variation1.phpt (revision 305635)
+@@ -96,14 +96,14 @@
+ bool(false)
+ bool(false)
+ -- Iteration 7 --
+-bool(true)
+-bool(true)
++bool(false)
++bool(false)
+ -- Iteration 8 --
+-bool(true)
+-bool(true)
++bool(false)
++bool(false)
+ -- Iteration 9 --
+-bool(true)
+-bool(true)
++bool(false)
++bool(false)
+ -- Iteration 10 --
+ bool(true)
+ bool(true)
+Index: ext/standard/tests/file/fnmatch\_variation.phpt
+===================================================================
+--- ext/standard/tests/file/fnmatch\_variation.phpt (revision 305634)
++++ ext/standard/tests/file/fnmatch\_variation.phpt (revision 305635)
+@@ -259,22 +259,22 @@
+ --- With Strings ---
+ -- Iteration 0 --
+ bool(true)
++bool(false)
+ bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
+ bool(true)
+ -- Iteration 1 --
+-bool(true)
+-bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
+-bool(true)
++bool(false)
++bool(false)
++bool(false)
++bool(false)
+ -- Iteration 2 --
+ bool(true)
++bool(false)
+ bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
+ bool(true)
+@@ -282,9 +282,9 @@
+ bool(false)
+ bool(false)
+ bool(false)
+-bool(true)
+ bool(false)
+ bool(false)
++bool(false)
+ -- Iteration 4 --
+ bool(false)
+ bool(false)
+@@ -294,8 +294,8 @@
+ bool(false)
+ -- Iteration 5 --
+ bool(true)
++bool(false)
+ bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
+ bool(true)
+@@ -397,30 +397,30 @@
+ bool(true)
+ bool(true)
+ bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
++bool(false)
+ -- Iteration 1 --
+ bool(true)
+ bool(true)
+ bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
++bool(false)
+ -- Iteration 2 --
+ bool(true)
+ bool(true)
+ bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
++bool(false)
+ -- Iteration 3 --
+-bool(true)
+-bool(true)
+-bool(true)
+-bool(true)
+ bool(false)
+ bool(false)
++bool(false)
++bool(false)
++bool(false)
++bool(false)
+ -- Iteration 4 --
+ bool(false)
+ bool(false)
+Index: ext/standard/tests/file/tempnam\_variation3-win32.phpt
+===================================================================
+--- ext/standard/tests/file/tempnam\_variation3-win32.phpt (revision 305634)
++++ ext/standard/tests/file/tempnam\_variation3-win32.phpt (revision 305635)
+@@ -31,8 +31,8 @@
+ NULL,
+ "",
+ " ",
++ /\* Invalid args \*/
+ "\0",
+- /\* Invalid args \*/
+ array(),
+
+ /\* Valid args\*/
+@@ -102,7 +102,8 @@
+ Failed, not created in the correct directory %s vs %s
+ 0
+ -- Iteration 6 --
+-OK
++Failed, not created in the correct directory %s vs %s
++0
+ -- Iteration 7 --
+
+ Warning: tempnam() expects parameter 2 to be string, array given in %s\ext\standard\tests\file\tempnam\_variation3-win32.php on line %d
+Index: ext/standard/tests/file/rename\_variation13.phpt
+===================================================================
+--- ext/standard/tests/file/rename\_variation13.phpt (revision 305634)
++++ ext/standard/tests/file/rename\_variation13.phpt (revision 305635)
+@@ -98,11 +98,7 @@
+ Warning: rename( ,%s/renameVar13/afile.tmp): No such file or directory in %s on line %d
+ bool(false)
+ -- testing '%s' --
+-
+-Warning: rename(%s/renameVar13/afile.tmp,): %s in %s on line %d
+ bool(false)
+-
+-Warning: rename(,%s/renameVar13/afile.tmp): %s in %s on line %d
+ bool(false)
+ -- testing 'Array' --
+
+Index: ext/standard/tests/file/readfile\_variation10-win32.phpt
+===================================================================
+--- ext/standard/tests/file/readfile\_variation10-win32.phpt (revision 305634)
++++ ext/standard/tests/file/readfile\_variation10-win32.phpt (revision 305635)
+@@ -37,7 +37,7 @@
+
+ foreach($names\_arr as $key => $value) {
+ echo "\n-- Filename: $key --\n";
+- readfile($value);
++ var\_dump(readfile($value));
+ };
+
+ ?>
+@@ -48,40 +48,48 @@
+ -- Filename: -1 --
+
+ Warning: readfile(-1): failed to open stream: No such file or directory in %s on line %d
++bool(false)
+
+ -- Filename: TRUE --
+
+ Warning: readfile(1): failed to open stream: No such file or directory in %s on line %d
++bool(false)
+
+ -- Filename: FALSE --
+
+ Warning: readfile(): Filename cannot be empty in %s on line %d
++bool(false)
+
+ -- Filename: NULL --
+
+ Warning: readfile(): Filename cannot be empty in %s on line %d
++bool(false)
+
+ -- Filename: "" --
+
+ Warning: readfile(): Filename cannot be empty in %s on line %d
++bool(false)
+
+ -- Filename: " " --
+
+ Warning: readfile( ): failed to open stream: Permission denied in %s on line %d
++bool(false)
+
+ -- Filename: \0 --
++bool(false)
+
+-Warning: readfile(): Filename cannot be empty in %s on line %d
+-
+ -- Filename: array() --
+
+ Warning: readfile() expects parameter 1 to be string, array given in %s on line %d
++bool(false)
+
+ -- Filename: /no/such/file/dir --
+
+ Warning: readfile(/no/such/file/dir): failed to open stream: No such file or directory in %s on line %d
++bool(false)
+
+ -- Filename: php/php --
+
+ Warning: readfile(php/php): failed to open stream: No such file or directory in %s on line %d
++bool(false)
+ ===Done===
+\ No newline at end of file
+Index: ext/standard/tests/file/tempnam\_variation3.phpt
+===================================================================
+--- ext/standard/tests/file/tempnam\_variation3.phpt (revision 305634)
++++ ext/standard/tests/file/tempnam\_variation3.phpt (revision 305635)
+@@ -100,9 +100,9 @@
+ File permissions are => 100600
+ File created in => directory specified
+ -- Iteration 6 --
+-File name is => %s/%s
+-File permissions are => 100600
+-File created in => directory specified
++-- File is not created --
++
++Warning: unlink(): %s in %s on line %d
+ -- Iteration 7 --
+
+ Warning: tempnam() expects parameter 2 to be string, array given in %s on line %d
+Index: ext/standard/tests/file/is\_readable\_variation1.phpt
+===================================================================
+--- ext/standard/tests/file/is\_readable\_variation1.phpt (revision 305634)
++++ ext/standard/tests/file/is\_readable\_variation1.phpt (revision 305635)
+@@ -87,11 +87,11 @@
+ -- Iteration 6 --
+ bool(false)
+ -- Iteration 7 --
+-bool(true)
++bool(false)
+ -- Iteration 8 --
+-bool(true)
++bool(false)
+ -- Iteration 9 --
+-bool(true)
++bool(false)
+ -- Iteration 10 --
+ bool(true)
+ -- Iteration 11 --
+Index: ext/standard/tests/file/mkdir\_rmdir\_variation2.phpt
+===================================================================
+--- ext/standard/tests/file/mkdir\_rmdir\_variation2.phpt (revision 305634)
++++ ext/standard/tests/file/mkdir\_rmdir\_variation2.phpt (revision 305635)
+@@ -64,8 +64,8 @@
+ bool(false)
+
+ \*\*\* Testing mkdir() and rmdir() for binary safe functionality \*\*\*
+-bool(true)
+-bool(true)
++bool(false)
++bool(false)
+
+ \*\*\* Testing mkdir() with miscelleneous input \*\*\*
+ bool(true)
+Index: ext/standard/tests/file/rename\_variation13-win32.phpt
+===================================================================
+--- ext/standard/tests/file/rename\_variation13-win32.phpt (revision 305634)
++++ ext/standard/tests/file/rename\_variation13-win32.phpt (revision 305635)
+@@ -106,12 +106,8 @@
+
+ Warning: rename( ,%s/renameVar13/afile.tmp): The filename, directory name, or volume label syntax is incorrect. (code: 123) in %s on line %d
+ bool(false)
+--- 6 testing ' ' string --
+-
+-Warning: rename(%s/renameVar13/afile.tmp,): %s in %s on line %d
++-- 6 testing '
+ bool(false)
+-
+-Warning: rename(,%s/renameVar13/afile.tmp): %s in %s on line %d
+ bool(false)
+ -- 7 testing 'Array' array --
+
+Index: ext/standard/tests/file/is\_file\_variation4.phpt
+===================================================================
+--- ext/standard/tests/file/is\_file\_variation4.phpt (revision 305634)
++++ ext/standard/tests/file/is\_file\_variation4.phpt (revision 305635)
+@@ -67,8 +67,8 @@
+ - Iteration 6 -
+ bool(false)
+ - Iteration 7 -
+-bool(true)
++bool(false)
+ - Iteration 8 -
+-bool(true)
++bool(false)
+
+ \*\*\* Done \*\*\*
+Index: ext/standard/tests/file/fileinode\_variation3.phpt
+===================================================================
+--- ext/standard/tests/file/fileinode\_variation3.phpt (revision 305634)
++++ ext/standard/tests/file/fileinode\_variation3.phpt (revision 305635)
+@@ -75,8 +75,8 @@
+ Warning: fileinode(): stat failed for %s/fileinode\_variation3/fileinode\*.tmp in %s on line %d
+ bool(false)
+ - Iteration 7 -
+-int(%d)
++bool(false)
+ - Iteration 8 -
+-int(%d)
++bool(false)
+
+ \*\*\* Done \*\*\*
+Index: ext/standard/tests/file/tempnam\_variation7-win32.phpt
+===================================================================
+--- ext/standard/tests/file/tempnam\_variation7-win32.phpt (revision 305634)
++++ ext/standard/tests/file/tempnam\_variation7-win32.phpt (revision 305635)
+@@ -89,9 +89,9 @@
+ File permissions are => 100666
+ File created in => temp dir
+ -- Iteration 6 --
+-File name is => %s%et%s
+-File permissions are => 100666
+-File created in => temp dir
++-- File is not created --
++
++Warning: unlink(): %s in %s on line %d
+ -- Iteration 7 --
+
+ Warning: tempnam() expects parameter 1 to be string, array given in %s on line %d
+Index: ext/standard/tests/file/is\_executable\_variation1.phpt
+===================================================================
+--- ext/standard/tests/file/is\_executable\_variation1.phpt (revision 305634)
++++ ext/standard/tests/file/is\_executable\_variation1.phpt (revision 305635)
+@@ -76,9 +76,9 @@
+ -- Iteration 5 --
+ bool(false)
+ -- Iteration 6 --
+-bool(true)
++bool(false)
+ -- Iteration 7 --
+-bool(true)
++bool(false)
+ -- Iteration 8 --
+ bool(false)
+ -- Iteration 9 --
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1470.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1470.patch
@@ -0,0 +1,70 @@
+Subject: Fixed bug#53579 (stream\_get\_contents() segfaults on ziparchive streams)
+ Also added the filename being access to the stream\_get\_meta\_data() array
+Origin: http://svn.php.net/viewvc?view=revision&revision=306493
+
+CVE-2011-1470
+
+Patch differs from upstream commit in that it drops the added entry to
+the NEWS file to reduce patch conflicts.
+
+Index: ext/zip/tests/bug53579.phpt
+===================================================================
+--- ext/zip/tests/bug53579.phpt (revision 0)
++++ ext/zip/tests/bug53579.phpt (revision 306493)
+@@ -0,0 +1,44 @@
++--TEST--
++Bug #53579 (stream\_get\_contents() segfaults on ziparchive streams)
++--SKIPIF--
++php
++/\* $Id: oo\_stream.phpt 260091 2008-05-21 09:27:41Z pajoye $ \*/
++if(!extension\_loaded('zip')) die('skip');
++?
++--FILE--
++php
++$dirname = dirname(\_\_FILE\_\_) . '/';
++$file = $dirname . 'test\_with\_comment.zip';
++include $dirname . 'utils.inc';
++$zip = new ZipArchive;
++if (!$zip-open($file)) {
++ exit('failed');
++}
++$fp = $zip->getStream('foo');
++
++var\_dump($fp);
++if(!$fp) exit("\n");
++$contents = stream\_get\_contents($fp);
++
++fclose($fp);
++$zip->close();
++var\_dump($contents);
++
++
++$fp = fopen('zip://' . dirname(\_\_FILE\_\_) . '/test\_with\_comment.zip#foo', 'rb');
++if (!$fp) {
++ exit("cannot open\n");
++}
++$contents = stream\_get\_contents($fp);
++var\_dump($contents);
++fclose($fp);
++
++?>
++--EXPECTF--
++resource(%d) of type (stream)
++string(5) "foo
++
++"
++string(5) "foo
++
++"
+Index: ext/zip/zip\_stream.c
+===================================================================
+--- ext/zip/zip\_stream.c (revision 306492)
++++ ext/zip/zip\_stream.c (revision 306493)
+@@ -216,6 +216,7 @@
+ self->stream = NULL;
+ self->cursor = 0;
+ stream = php\_stream\_alloc(&php\_stream\_zipio\_ops, self, NULL, mode);
++ stream->orig\_path = estrdup(path);
+ } else {
+ zip\_close(stream\_za);
+ }
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1468.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1468.patch
@@ -0,0 +1,100 @@
+Subject: fix bug #54060, memory leak in openssl\_encrypt
+Origin: http://svn.php.net/viewvc?view=revision&revision=308531
+
+Also includes http://svn.php.net/viewvc?view=revision&revision=308532
+
+ - fix test 025
+
+http://svn.php.net/viewvc?view=revision&revision=308534
+
+ - fix bug #54061, memory leak in openssl\_decrypt
+
+and http://svn.php.net/viewvc?view=revision&revision=308535 which adds a
+testcase for #54061
+
+CVE-2011-1468
+
+Patch differs from upstream commits in that the addition to the NEWS
+file was dropped to reduce patch conflicts. It was also modified to more
+cleanly apply to older versions of php.
+
+Index: ext/openssl/tests/bug54061.phpt
+===================================================================
+--- ext/openssl/tests/bug54061.phpt (revision 0)
++++ ext/openssl/tests/bug54061.phpt (revision 308535)
+@@ -0,0 +1,17 @@
++--TEST--
++Bug #54061 (Memory leak in openssl\_decrypt)
++--SKIPIF--
++php if (!extension\_loaded("openssl")) die("skip"); ?
++--FILE--
++php
++$data = "jfdslkjvflsdkjvlkfjvlkjfvlkdm,4w 043920r 9234r 32904r 09243
++r7-89437 r892374 r894372 r894 7289r7 f frwerfh i iurf iuryw uyrfouiwy ruy
++972439 8478942 yrhfjkdhls";
++$pass = "r23498rui324hjbnkj";
++
++$cr = openssl\_encrypt($data, 'des3', $pass, false);
++$dcr = openssl\_decrypt($cr, 'des3', $pass, false);
++echo "Done";
++?
++--EXPECT--
++Done
+Index: ext/openssl/tests/bug54060.phpt
+===================================================================
+--- ext/openssl/tests/bug54060.phpt (revision 0)
++++ ext/openssl/tests/bug54060.phpt (revision 308535)
+@@ -0,0 +1,17 @@
++--TEST--
++Bug #54060 (Memory leak in openssl\_encrypt)
++--SKIPIF--
++php if (!extension\_loaded("openssl")) die("skip"); ?
++--FILE--
++php
++
++$data = "jfdslkjvflsdkjvlkfjvlkjfvlkdm,4w 043920r 9234r 32904r 09243
++r7-89437 r892374 r894372 r894 7289r7 f frwerfh i iurf iuryw uyrfouiwy ruy
++972439 8478942 yrhfjkdhls";
++$pass = "r23498rui324hjbnkj";
++
++openssl\_encrypt($data, 'des3', $pass, false);
++echo "Done";
++?
++--EXPECT--
++Done
+Index: ext/openssl/openssl.c
+===================================================================
+--- ext/openssl/openssl.c (revision 308530)
++++ ext/openssl/openssl.c (revision 308535)
+@@ -3543,14 +3543,13 @@
+ char \* outfilename; int outfilename\_len;
+ char \* extracertsfilename = NULL; int extracertsfilename\_len;
+
+- RETVAL\_FALSE;
+-
+ if (zend\_parse\_parameters(ZEND\_NUM\_ARGS() TSRMLS\_CC, "ssZZa!|ls",
+ &infilename, &infilename\_len, &outfilename, &outfilename\_len,
+ &zcert, &zprivkey, &zheaders, &flags, &extracertsfilename,
+ &extracertsfilename\_len) == FAILURE) {
+ return;
+ }
++ RETVAL\_FALSE;
+
+ if (strlen(infilename) != infilename\_len) {
+ return;
+@@ -4731,6 +4730,7 @@
+ efree(key);
+ }
+ efree(iv);
++ EVP\_CIPHER\_CTX\_cleanup(&cipher\_ctx);
+ }
+ /\* }}} \*/
+
+@@ -4804,6 +4804,7 @@
+ if (base64\_str) {
+ efree(base64\_str);
+ }
++ EVP\_CIPHER\_CTX\_cleanup(&cipher\_ctx);
+ }
+ /\* }}} \*/
+
--- php5-5.3.2.orig/debian/patches/check\_ini\_on\_modify\_status.patch
+++ php5-5.3.2/debian/patches/check\_ini\_on\_modify\_status.patch
@@ -0,0 +1,26 @@
+Index: php/Zend/zend\_ini.c
+===================================================================
+--- php.orig/Zend/zend\_ini.c
++++ php/Zend/zend\_ini.c
+@@ -46,15 +46,20 @@ static int zend\_remove\_ini\_entries(zend\_
+
+ static int zend\_restore\_ini\_entry\_cb(zend\_ini\_entry \*ini\_entry, int stage TSRMLS\_DC) /\* {{{ \*/
+ {
++ int result = FAILURE;
+ if (ini\_entry->modified) {
+ if (ini\_entry->on\_modify) {
+ zend\_try {
+ /\* even if on\_modify bails out, we have to continue on with restoring,
+ since there can be allocated variables that would be freed on MM shutdown
+ and would lead to memory corruption later ini entry is modified again \*/
+- ini\_entry->on\_modify(ini\_entry, ini\_entry->orig\_value, ini\_entry->orig\_value\_length, ini\_entry->mh\_arg1, ini\_entry->mh\_arg2, ini\_entry->mh\_arg3, stage TSRMLS\_CC);
++ result = ini\_entry->on\_modify(ini\_entry, ini\_entry->orig\_value, ini\_entry->orig\_value\_length, ini\_entry->mh\_arg1, ini\_entry->mh\_arg2, ini\_entry->mh\_arg3, stage TSRMLS\_CC);
+ } zend\_end\_try();
+ }
++ if(stage == ZEND\_INI\_STAGE\_RUNTIME && result == FAILURE) {
++ /\* runtime failure is OK \*/
++ return 1;
++ }
+ if (ini\_entry->value != ini\_entry->orig\_value) {
+ efree(ini\_entry->value);
+ }
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-3870.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-3870.patch
@@ -0,0 +1,204 @@
+Subject: utf8\_decode vulnerabilities and deficiencies in the number
+ of reported malformed sequences. (Gustavo)
+Origin: http://svn.php.net/viewvc/?view=revision&revision=304959
+Bug: http://bugs.php.net/bug.php?id=49687
+
+[Ubuntu note: patch differs from above commit in that the NEWS entry has
+ been removed to reduce conflicts when applying - sbeattie]
+
+---
+ ext/xml/tests/bug49687.phpt | 24 +++++++
+ ext/xml/xml.c | 140 ++++++++++++++++++++++++++++++++++----------
+ 2 files changed, 134 insertions(+), 30 deletions(-)
+
+Index: b/ext/xml/xml.c
+===================================================================
+--- a/ext/xml/xml.c
++++ b/ext/xml/xml.c
+@@ -659,10 +659,111 @@ PHPAPI char \*xml\_utf8\_encode(const char
+ }
+ /\* }}} \*/
+
++/\* copied from trunk's implementation of get\_next\_char in ext/standard/html.c \*/
++#define MB\_FAILURE(pos, advance) do { \
++ \*cursor = pos + (advance); \
++ \*status = FAILURE; \
++ return 0; \
++} while (0)
++
++#define CHECK\_LEN(pos, chars\_need) ((str\_len - (pos)) >= (chars\_need))
++#define utf8\_lead(c) ((c) < 0x80 || ((c) >= 0xC2 && (c) <= 0xF4))
++#define utf8\_trail(c) ((c) >= 0x80 && (c) <= 0xBF)
++
++/\* {{{ php\_next\_utf8\_char
++ \*/
++static inline unsigned int php\_next\_utf8\_char(
++ const unsigned char \*str,
++ size\_t str\_len,
++ size\_t \*cursor,
++ int \*status)
++{
++ size\_t pos = \*cursor;
++ unsigned int this\_char = 0;
++ unsigned char c;
++
++ \*status = SUCCESS;
++
++ if (!CHECK\_LEN(pos, 1))
++ MB\_FAILURE(pos, 1);
++
++ /\* We'll follow strategy 2. from section 3.6.1 of UTR #36:
++ \* "In a reported illegal byte sequence, do not include any
++ \* non-initial byte that encodes a valid character or is a leading
++ \* byte for a valid sequence.» \*/
++ c = str[pos];
++ if (c < 0x80) {
++ this\_char = c;
++ pos++;
++ } else if (c < 0xc2) {
++ MB\_FAILURE(pos, 1);
++ } else if (c < 0xe0) {
++ if (!CHECK\_LEN(pos, 2))
++ MB\_FAILURE(pos, 1);
++
++ if (!utf8\_trail(str[pos + 1])) {
++ MB\_FAILURE(pos, utf8\_lead(str[pos + 1]) ? 1 : 2);
++ }
++ this\_char = ((c & 0x1f) << 6) | (str[pos + 1] & 0x3f);
++ if (this\_char < 0x80) { /\* non-shortest form \*/
++ MB\_FAILURE(pos, 2);
++ }
++ pos += 2;
++ } else if (c < 0xf0) {
++ size\_t avail = str\_len - pos;
++
++ if (avail < 3 ||
++ !utf8\_trail(str[pos + 1]) || !utf8\_trail(str[pos + 2])) {
++ if (avail < 2 || utf8\_lead(str[pos + 1]))
++ MB\_FAILURE(pos, 1);
++ else if (avail < 3 || utf8\_lead(str[pos + 2]))
++ MB\_FAILURE(pos, 2);
++ else
++ MB\_FAILURE(pos, 3);
++ }
++
++ this\_char = ((c & 0x0f) << 12) | ((str[pos + 1] & 0x3f) << 6) | (str[pos + 2] & 0x3f);
++ if (this\_char < 0x800) { /\* non-shortest form \*/
++ MB\_FAILURE(pos, 3);
++ } else if (this\_char >= 0xd800 && this\_char <= 0xdfff) { /\* surrogate \*/
++ MB\_FAILURE(pos, 3);
++ }
++ pos += 3;
++ } else if (c < 0xf5) {
++ size\_t avail = str\_len - pos;
++
++ if (avail < 4 ||
++ !utf8\_trail(str[pos + 1]) || !utf8\_trail(str[pos + 2]) ||
++ !utf8\_trail(str[pos + 3])) {
++ if (avail < 2 || utf8\_lead(str[pos + 1]))
++ MB\_FAILURE(pos, 1);
++ else if (avail < 3 || utf8\_lead(str[pos + 2]))
++ MB\_FAILURE(pos, 2);
++ else if (avail < 4 || utf8\_lead(str[pos + 3]))
++ MB\_FAILURE(pos, 3);
++ else
++ MB\_FAILURE(pos, 4);
++ }
++
++ this\_char = ((c & 0x07) << 18) | ((str[pos + 1] & 0x3f) << 12) | ((str[pos + 2] & 0x3f) << 6) | (str[pos + 3] & 0x3f);
++ if (this\_char < 0x10000 || this\_char > 0x10FFFF) { /\* non-shortest form or outside range \*/
++ MB\_FAILURE(pos, 4);
++ }
++ pos += 4;
++ } else {
++ MB\_FAILURE(pos, 1);
++ }
++
++ \*cursor = pos;
++ return this\_char;
++}
++/\* }}} \*/
++
++
+ /\* {{{ xml\_utf8\_decode \*/
+ PHPAPI char \*xml\_utf8\_decode(const XML\_Char \*s, int len, int \*newlen, const XML\_Char \*encoding)
+ {
+- int pos = len;
++ size\_t pos = 0;
+ char \*newbuf = emalloc(len + 1);
+ unsigned int c;
+ char (\*decoder)(unsigned short) = NULL;
+@@ -681,36 +782,15 @@ PHPAPI char \*xml\_utf8\_decode(const XML\_C
+ newbuf[\*newlen] = '\0';
+ return newbuf;
+ }
+- while (pos > 0) {
+- c = (unsigned char)(\*s);
+- if (c >= 0xf0) { /\* four bytes encoded, 21 bits \*/
+- if(pos-4 >= 0) {
+- c = ((s[0]&7)<<18) | ((s[1]&63)<<12) | ((s[2]&63)<<6) | (s[3]&63);
+- } else {
+- c = '?';
+- }
+- s += 4;
+- pos -= 4;
+- } else if (c >= 0xe0) { /\* three bytes encoded, 16 bits \*/
+- if(pos-3 >= 0) {
+- c = ((s[0]&63)<<12) | ((s[1]&63)<<6) | (s[2]&63);
+- } else {
+- c = '?';
+- }
+- s += 3;
+- pos -= 3;
+- } else if (c >= 0xc0) { /\* two bytes encoded, 11 bits \*/
+- if(pos-2 >= 0) {
+- c = ((s[0]&63)<<6) | (s[1]&63);
+- } else {
+- c = '?';
+- }
+- s += 2;
+- pos -= 2;
+- } else {
+- s++;
+- pos--;
++
++ while (pos < (size\_t)len) {
++ int status = FAILURE;
++ c = php\_next\_utf8\_char((const unsigned char\*)s, (size\_t) len, &pos, &status);
++
++ if (status == FAILURE || c > 0xFFU) {
++ c = '?';
+ }
++
+ newbuf[\*newlen] = decoder ? decoder(c) : c;
+ ++\*newlen;
+ }
+Index: b/ext/xml/tests/bug49687.phpt
+===================================================================
+--- /dev/null
++++ b/ext/xml/tests/bug49687.phpt
+@@ -0,0 +1,24 @@
++--TEST--
++Bug #49687 Several utf8\_decode deficiencies and vulnerabilities
++--SKIPIF--
++php
++require\_once("skipif.inc");
++if (!extension\_loaded('xml')) die ("skip xml extension not available");
++?
++--FILE--
++php
++
++$tests = array(
++ "\x41\xC2\x3E\x42",
++ "\xE3\x80\x22",
++ "\x41\x98\xBA\x42\xE2\x98\x43\xE2\x98\xBA\xE2\x98",
++);
++foreach ($tests as $t) {
++ echo bin2hex(utf8\_decode($t)), "\n";
++}
++echo "Done.\n";
++--EXPECT--
++413f3e42
++3f22
++413f3f423f433f3f
++Done.
--- php5-5.3.2.orig/debian/patches/lp564920-fix-big-files.patch
+++ php5-5.3.2/debian/patches/lp564920-fix-big-files.patch
@@ -0,0 +1,23 @@
+Description: don't mmap large files
+Author: Marc Deslauriers <marc.deslauriers@ubuntu.com
+Bug: http://bugs.php.net/bug.php?id=52102
+Ubuntu-Bug: https://bugs.edge.launchpad.net/ubuntu/+source/php5/+bug/564920
+
+diff -Nur php5-5.3.2/main/streams/plain\_wrapper.c php5-5.3.2.new/main/streams/plain\_wrapper.c
+--- php5-5.3.2/main/streams/plain\_wrapper.c 2010-02-23 10:04:29.000000000 -0500
++++ php5-5.3.2.new/main/streams/plain\_wrapper.c 2010-07-14 18:24:13.000000000 -0400
+@@ -627,7 +627,13 @@
+
+ switch (value) {
+ case PHP\_STREAM\_MMAP\_SUPPORTED:
+- return fd == -1 ? PHP\_STREAM\_OPTION\_RETURN\_ERR : PHP\_STREAM\_OPTION\_RETURN\_OK;
++ if (fd == -1)
++ return PHP\_STREAM\_OPTION\_RETURN\_ERR;
++ /\* Don't mmap large files \*/
++ do\_fstat(data, 1);
++ if (data->sb.st\_size > 4 \* 1024 \* 1024)
++ return PHP\_STREAM\_OPTION\_RETURN\_ERR;
++ return PHP\_STREAM\_OPTION\_RETURN\_OK;
+
+ case PHP\_STREAM\_MMAP\_MAP\_RANGE:
+ do\_fstat(data, 1);
--- php5-5.3.2.orig/debian/patches/broken\_5.3\_test-posix\_uname.patch
+++ php5-5.3.2/debian/patches/broken\_5.3\_test-posix\_uname.patch
@@ -0,0 +1,53 @@
+Author: Sean Finney
+Description: Fix two failing tests
+ \* ext/posix/tests/posix\_uname.phpt: removed
+ \* ext/posix/tests/posix\_uname\_basic.phpt: backported fix from upstream.
+Bug: http://bugs.php.net/bug.php?id=50982
+Bug-Debian: http://bugs.debian.org/570286
+--- a/ext/posix/tests/posix\_uname.phpt
++++ /dev/null
+@@ -1,35 +0,0 @@
+---TEST--
+-Test posix\_uname()
+---DESCRIPTION--
+-Gets information about the system.
+-Source code: ext/posix/posix.c
+---CREDITS--
+-Falko Menge, mail at falko-menge dot de
+-PHP Testfest Berlin 2009-05-10
+---SKIPIF--
+-php
+- if (!extension\_loaded('posix')) {
+- die('SKIP - POSIX extension not available');
+- }
+-?
+---FILE--
+-php
+- $uname = posix\_uname();
+- unset($uname['domainname']);
+- var\_dump($uname);
+-?
+-===DONE===
+---EXPECTF--
+-array(5) {
+- ["sysname"]=>
+- string(%d) "%s"
+- ["nodename"]=>
+- string(%d) "%s"
+- ["release"]=>
+- string(%d) "%s"
+- ["version"]=>
+- string(%d) "%s"
+- ["machine"]=>
+- string(%d) "%s"
+-}
+-===DONE===
+--- a/ext/posix/tests/posix\_uname\_basic.phpt
++++ b/ext/posix/tests/posix\_uname\_basic.phpt
+@@ -25,4 +25,4 @@ Array
+ [machine] => %s
+ )
+ ===DONE====
+-
+\ No newline at end of file
++
--- php5-5.3.2.orig/debian/patches/013-force\_getaddrinfo.patch
+++ php5-5.3.2/debian/patches/013-force\_getaddrinfo.patch
@@ -0,0 +1,103 @@
+Description: Always use getaddrinfo
+ .
+ The patch should probably be dropped and the configure check verified.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/configure.in
++++ b/configure.in
+@@ -615,50 +615,50 @@ AC\_CACHE\_CHECK([for nanosleep], ac\_cv\_fu
+
+ dnl Check for getaddrinfo, should be a better way, but...
+ dnl Also check for working getaddrinfo
+-AC\_CACHE\_CHECK([for getaddrinfo], ac\_cv\_func\_getaddrinfo,
+-[AC\_TRY\_LINK([#include ],
+- [struct addrinfo \*g,h;g=&hgetaddrinfo("","",g,&g);],
+- AC\_TRY\_RUN([
+-#include
+-#include
+-#ifndef AF\_INET
+-# include
+-#endif
+-int main(void) {
+- struct addrinfo \*ai, \*pai, hints;
+-
+- memset(&hints, 0, sizeof(hints));
+- hints.ai\_flags = AI\_NUMERICHOST;
+-
+- if (getaddrinfo("127.0.0.1", 0, &hints, &ai) < 0) {
+- exit(1);
+- }
+-
+- if (ai == 0) {
+- exit(1);
+- }
+-
+- pai = ai;
+-
+- while (pai) {
+- if (pai->ai\_family != AF\_INET) {
+- /\* 127.0.0.1/NUMERICHOST should only resolve ONE way \*/
+- exit(1);
+- }
+- if (pai->ai\_addr->sa\_family != AF\_INET) {
+- /\* 127.0.0.1/NUMERICHOST should only resolve ONE way \*/
+- exit(1);
+- }
+- pai = pai->ai\_next;
+- }
+- freeaddrinfo(ai);
+- exit(0);
+-}
+- ],ac\_cv\_func\_getaddrinfo=yes, ac\_cv\_func\_getaddrinfo=no, ac\_cv\_func\_getaddrinfo=no),
+-ac\_cv\_func\_getaddrinfo=no)])
+-if test "$ac\_cv\_func\_getaddrinfo" = yes; then
++dnl AC\_CACHE\_CHECK([for getaddrinfo], ac\_cv\_func\_getaddrinfo,
++dnl [AC\_TRY\_LINK([#include ],
++dnl [struct addrinfo \*g,h;g=&hgetaddrinfo("","",g,&g);],
++dnl AC\_TRY\_RUN([
++dnl #include
++dnl #include
++dnl #ifndef AF\_INET
++dnl # include
++dnl #endif
++dnl int main(void) {
++dnl struct addrinfo \*ai, \*pai, hints;
++dnl
++dnl memset(&hints, 0, sizeof(hints));
++dnl hints.ai\_flags = AI\_NUMERICHOST;
++dnl
++dnl if (getaddrinfo("127.0.0.1", 0, &hints, &ai) < 0) {
++dnl exit(1);
++dnl }
++dnl
++dnl if (ai == 0) {
++dnl exit(1);
++dnl }
++dnl
++dnl pai = ai;
++dnl
++dnl while (pai) {
++dnl if (pai->ai\_family != AF\_INET) {
++dnl /\* 127.0.0.1/NUMERICHOST should only resolve ONE way \*/
++dnl exit(1);
++dnl }
++dnl if (pai->ai\_addr->sa\_family != AF\_INET) {
++dnl /\* 127.0.0.1/NUMERICHOST should only resolve ONE way \*/
++dnl exit(1);
++dnl }
++dnl pai = pai->ai\_next;
++dnl }
++dnl freeaddrinfo(ai);
++dnl exit(0);
++dnl }
++dnl ],ac\_cv\_func\_getaddrinfo=yes, ac\_cv\_func\_getaddrinfo=no, ac\_cv\_func\_getaddrinfo=no),
++dnl ac\_cv\_func\_getaddrinfo=no)])
++dnl if test "$ac\_cv\_func\_getaddrinfo" = yes; then
+ AC\_DEFINE(HAVE\_GETADDRINFO,1,[Define if you have the getaddrinfo function])
+-fi
++dnl fi
+
+ AC\_REPLACE\_FUNCS(strlcat strlcpy getopt)
+ AC\_FUNC\_UTIME\_NULL
--- php5-5.3.2.orig/debian/patches/deprecate\_short\_open\_tag
+++ php5-5.3.2/debian/patches/deprecate\_short\_open\_tag
@@ -0,0 +1,36 @@
+--- a/Zend/zend\_language\_scanner.l
++++ b/Zend/zend\_language\_scanner.l
+@@ -1513,6 +1513,7 @@ NEWLINE ("\r"|"\n"|"\r\n")
+
+ "=" {
+ if (CG(short\_tags)) {
++ zend\_error(E\_DEPRECATED, "Usage of short open tag <? is not recommended and will be disabled by default in future versions of PHP");
+ zendlval-value.str.val = yytext; /\* no copying - intentional \*/
+ zendlval->value.str.len = yyleng;
+ zendlval->type = IS\_STRING;
+@@ -1549,6 +1550,7 @@ NEWLINE ("\r"|"\n"|"\r\n")
+
+ "" {
+ if (CG(short\_tags)) {
++ zend\_error(E\_DEPRECATED, "Usage of short open tag <? is not recommended and will be disabled by default in future versions of PHP");
+ zendlval-value.str.val = yytext; /\* no copying - intentional \*/
+ zendlval->value.str.len = yyleng;
+ zendlval->type = IS\_STRING;
+--- a/Zend/zend\_language\_scanner.c
++++ b/Zend/zend\_language\_scanner.c
+@@ -1019,6 +1019,7 @@ yy6:
+ #line 1550 "Zend/zend\_language\_scanner.l"
+ {
+ if (CG(short\_tags)) {
++ zend\_error(E\_DEPRECATED, "Usage of short open tag  is not recommended and will be disabled by default in future versions of PHP");
+ zendlval-value.str.val = yytext; /\* no copying - intentional \*/
+ zendlval->value.str.len = yyleng;
+ zendlval->type = IS\_STRING;
+@@ -1298,6 +1299,7 @@ yy45:
+ #line 1514 "Zend/zend\_language\_scanner.l"
+ {
+ if (CG(short\_tags)) {
++ zend\_error(E\_DEPRECATED, "Usage of short open tag  is not recommended and will be disabled by default in future versions of PHP");
+ zendlval-value.str.val = yytext; /\* no copying - intentional \*/
+ zendlval->value.str.len = yyleng;
+ zendlval->type = IS\_STRING;
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-3436-regression.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-3436-regression.patch
@@ -0,0 +1,32 @@
+Subject: fix regression introduced by fix for CVE-2010-3436
+Origin: http://svn.php.net/viewvc?view=revision&revision=305698
+Bug: http://bugs.php.net/bug.php?id=53352
+Bug-Ubuntu: https://bugs.launchpad.net/ubuntu/+source/ntp/+bug/701896
+
+---
+ main/fopen\_wrappers.c | 5 ++++-
+ 1 file changed, 4 insertions(+), 1 deletion(-)
+
+Index: b/main/fopen\_wrappers.c
+===================================================================
+--- a/main/fopen\_wrappers.c
++++ b/main/fopen\_wrappers.c
+@@ -223,6 +223,9 @@ PHPAPI int php\_check\_specific\_open\_based
+ resolved\_basedir[resolved\_basedir\_len] = PHP\_DIR\_SEPARATOR;
+ resolved\_basedir[++resolved\_basedir\_len] = '\0';
+ }
++ } else {
++ resolved\_basedir[resolved\_basedir\_len++] = PHP\_DIR\_SEPARATOR;
++ resolved\_basedir[resolved\_basedir\_len] = '\0';
+ }
+
+ resolved\_name\_len = strlen(resolved\_name);
+@@ -240,7 +243,7 @@ PHPAPI int php\_check\_specific\_open\_based
+ if (strncmp(resolved\_basedir, resolved\_name, resolved\_basedir\_len) == 0) {
+ #endif
+ if (resolved\_name\_len > resolved\_basedir\_len &&
+- resolved\_name[resolved\_basedir\_len] != PHP\_DIR\_SEPARATOR) {
++ resolved\_name[resolved\_basedir\_len - 1] != PHP\_DIR\_SEPARATOR) {
+ return -1;
+ } else {
+ /\* File is in the right directory \*/
--- php5-5.3.2.orig/debian/patches/CVE-2010-1917.patch
+++ php5-5.3.2/debian/patches/CVE-2010-1917.patch
@@ -0,0 +1,17 @@
+Description: fix denial of service via fnmatch stack consumption
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=298881
+
+diff -Nur php5-5.3.2/ext/standard/file.c php5-5.3.2.new/ext/standard/file.c
+--- php5-5.3.2/ext/standard/file.c 2010-02-11 13:03:57.000000000 -0500
++++ php5-5.3.2.new/ext/standard/file.c 2010-09-14 10:55:01.000000000 -0400
+@@ -2521,6 +2506,10 @@
+ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Filename exceeds the maximum allowed length of %d characters", MAXPATHLEN);
+ RETURN\_FALSE;
+ }
++ if (pattern\_len >= MAXPATHLEN) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Pattern exceeds the maximum allowed length of %d characters", MAXPATHLEN);
++ RETURN\_FALSE;
++ }
+
+ RETURN\_BOOL( ! fnmatch( pattern, filename, flags ));
+ }
--- php5-5.3.2.orig/debian/patches/044-strtod\_arm\_fix.patch
+++ php5-5.3.2/debian/patches/044-strtod\_arm\_fix.patch
@@ -0,0 +1,54 @@
+--- pkg-php.orig/Zend/zend\_strtod.c
++++ pkg-php/Zend/zend\_strtod.c
+@@ -152,14 +152,25 @@ typedef unsigned long int uint32\_t;
+ #define IEEE\_LITTLE\_ENDIAN
+ #endif
+
+-#if defined(\_\_arm\_\_) && !defined(\_\_VFP\_FP\_\_)
+-/\*
+- \* \* Although the CPU is little endian the FP has different
+- \* \* byte and word endianness. The byte order is still little endian
+- \* \* but the word order is big endian.
+- \* \*/
+-#define IEEE\_BIG\_ENDIAN
++#if defined(\_\_arm\_\_) || defined(\_\_thumb\_\_)
++/\* ARM traditionally used big-endian words; and within those words the
++ byte ordering was big or little endian depending upon the target.
++ Modern floating-point formats are naturally ordered; in this case
++ \_\_VFP\_FP\_\_ will be defined, even if soft-float. \*/
+ #undef IEEE\_LITTLE\_ENDIAN
++#undef IEEE\_BIG\_ENDIAN
++#if defined(\_\_VFP\_FP\_\_) || defined(\_\_MAVERICK\_\_)
++# ifdef \_\_ARMEL\_\_
++# define IEEE\_LITTLE\_ENDIAN
++# else
++# define IEEE\_BIG\_ENDIAN
++# endif
++#else
++# define IEEE\_BIG\_ENDIAN
++# ifdef \_\_ARMEL\_\_
++# define IEEE\_BYTES\_LITTLE\_ENDIAN
++# endif
++#endif
+ #endif
+
+ #ifdef \_\_vax\_\_
+@@ -266,8 +277,7 @@ BEGIN\_EXTERN\_C()
+
+ #if defined(IEEE\_LITTLE\_ENDIAN) + defined(IEEE\_BIG\_ENDIAN) + defined(VAX) + \
+ defined(IBM) != 1
+- Exactly one of IEEE\_LITTLE\_ENDIAN IEEE\_BIG\_ENDIAN, VAX, or
+- IBM should be defined.
++#error "Exactly one of IEEE\_LITTLE\_ENDIAN IEEE\_BIG\_ENDIAN, VAX, or IBM should be defined."
+ #endif
+
+ typedef union {
+@@ -287,7 +297,7 @@ BEGIN\_EXTERN\_C()
+ \* An alternative that might be better on some machines is
+ \* #define Storeinc(a,b,c) (\*a++ = b << 16 | c & 0xffff)
+ \*/
+-#if defined(IEEE\_LITTLE\_ENDIAN) + defined(VAX) + defined(\_\_arm\_\_)
++#if defined(IEEE\_LITTLE\_ENDIAN) + defined(VAX) + defined(IEEE\_BYTES\_LITTLE\_ENDIAN)
+ #define Storeinc(a,b,c) (((unsigned short \*)a)[1] = (unsigned short)b, \
+ ((unsigned short \*)a)[0] = (unsigned short)c, a++)
+ #else
--- php5-5.3.2.orig/debian/patches/CVE-2010-2094.patch
+++ php5-5.3.2/debian/patches/CVE-2010-2094.patch
@@ -0,0 +1,92 @@
+Description: fix arbitrary memory disclosure and possible code
+ execution via phar extension
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=298667
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=302565
+
+diff -Nur php5-5.3.2/ext/phar/dirstream.c php5-5.3.2.new/ext/phar/dirstream.c
+--- php5-5.3.2/ext/phar/dirstream.c 2009-07-24 19:53:24.000000000 -0400
++++ php5-5.3.2.new/ext/phar/dirstream.c 2010-09-14 10:55:48.000000000 -0400
+@@ -360,7 +360,7 @@
+
+ if (FAILURE == phar\_get\_archive(&phar, resource->host, host\_len, NULL, 0, &error TSRMLS\_CC)) {
+ if (error) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ efree(error);
+ } else {
+ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "phar file \"%s\" is unknown", resource->host);
+diff -Nur php5-5.3.2/ext/phar/stream.c php5-5.3.2.new/ext/phar/stream.c
+--- php5-5.3.2/ext/phar/stream.c 2009-07-25 21:24:12.000000000 -0400
++++ php5-5.3.2.new/ext/phar/stream.c 2010-09-14 10:55:53.000000000 -0400
+@@ -117,7 +117,7 @@
+ {
+ if (error) {
+ if (!(options & PHP\_STREAM\_URL\_STAT\_QUIET)) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ }
+ efree(error);
+ }
+@@ -128,7 +128,7 @@
+ if (error) {
+ spprintf(&error, 0, "Cannot open cached phar '%s' as writeable, copy on write failed", resource->host);
+ if (!(options & PHP\_STREAM\_URL\_STAT\_QUIET)) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ }
+ efree(error);
+ }
+@@ -140,7 +140,7 @@
+ {
+ if (error) {
+ if (!(options & PHP\_STREAM\_URL\_STAT\_QUIET)) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ }
+ efree(error);
+ }
+@@ -192,7 +192,7 @@
+ if (mode[0] == 'w' || (mode[0] == 'r' && mode[1] == '+')) {
+ if (NULL == (idata = phar\_get\_or\_create\_entry\_data(resource->host, host\_len, internal\_file, strlen(internal\_file), mode, 0, &error, 1 TSRMLS\_CC))) {
+ if (error) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ efree(error);
+ } else {
+ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "phar error: file \"%s\" could not be created in phar \"%s\"", internal\_file, resource->host);
+@@ -297,7 +297,7 @@
+ if ((FAILURE == phar\_get\_entry\_data(&idata, resource->host, host\_len, internal\_file, strlen(internal\_file), "r", 0, &error, 0 TSRMLS\_CC)) || !idata) {
+ idata\_error:
+ if (error) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ efree(error);
+ } else {
+ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "phar error: \"%s\" is not a file in phar \"%s\"", internal\_file, resource->host);
+@@ -320,7 +320,7 @@
+
+ /\* check length, crc32 \*/
+ if (!idata->internal\_file->is\_crc\_checked && phar\_postprocess\_file(idata, idata->internal\_file->crc32, &error, 2 TSRMLS\_CC) != SUCCESS) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ efree(error);
+ phar\_entry\_delref(idata TSRMLS\_CC);
+ efree(internal\_file);
+@@ -470,7 +470,7 @@
+ if (stream->mode[0] == 'w' || (stream->mode[0] == 'r' && stream->mode[1] == '+')) {
+ ret = phar\_flush(((phar\_entry\_data \*)stream->abstract)->phar, 0, 0, 0, &error TSRMLS\_CC);
+ if (error) {
+- php\_stream\_wrapper\_log\_error(stream->wrapper, REPORT\_ERRORS TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(stream->wrapper, REPORT\_ERRORS TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ return ret;
+@@ -761,7 +761,7 @@
+ efree(internal\_file);
+ phar\_entry\_remove(idata, &error TSRMLS\_CC);
+ if (error) {
+- php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, error);
++ php\_stream\_wrapper\_log\_error(wrapper, options TSRMLS\_CC, "%s", error);
+ efree(error);
+ }
+ return 1;
--- php5-5.3.2.orig/debian/patches/zend\_int\_overflow.patch
+++ php5-5.3.2/debian/patches/zend\_int\_overflow.patch
@@ -0,0 +1,110 @@
+Author: Sean Finney
+Description: Another integer overflow/underflow logic fix.
+ Once again, don't rely on undefined behavior and instead detect
+ the overflow/underflow conditions intelligently.
+Bug: http://bugs.php.net/bug.php?id=51008
+Bug-Debian: http://bugs.debian.org/570144
+--- php.orig/Zend/zend\_hash.h
++++ php/Zend/zend\_hash.h
+@@ -306,9 +306,11 @@ END\_EXTERN\_C()
+
+ #define ZEND\_HANDLE\_NUMERIC(key, length, func) do { \
+ register const char \*tmp = key; \
++ int negative = 0; \
+ \
+ if (\*tmp == '-') { \
+ tmp++; \
++ negative = 1; \
+ } \
+ if (\*tmp >= '0' && \*tmp <= '9') { /\* possibly a numeric index \*/ \
+ const char \*end = key + length - 1; \
+@@ -322,19 +324,19 @@ END\_EXTERN\_C()
+ \*tmp > '2')) { /\* overflow \*/ \
+ break; \
+ } \
+- idx = (\*tmp - '0'); \
++ idx = ((negative)?-1:1) \* (\*tmp - '0'); \
+ while (++tmp != end && \*tmp >= '0' && \*tmp <= '9') { \
+- idx = (idx \* 10) + (\*tmp - '0'); \
++ int digit = (\*tmp - '0'); \
++ if ( (!negative) && idx <= (LONG\_MAX-digit)/10 ) { \
++ idx = (idx \* 10) + digit; \
++ } else if ( (negative) && idx >= (LONG\_MIN+digit)/10 ) { \
++ idx = (idx \* 10) - digit; \
++ } else { \
++ --tmp; /\* overflow or underflow, make sure tmp != end \*/ \
++ break; \
++ } \
+ } \
+ if (tmp == end) { \
+- if (\*key == '-') { \
+- idx = -idx; \
+- if (idx > 0) { /\* overflow \*/ \
+- break; \
+- } \
+- } else if (idx < 0) { /\* overflow \*/ \
+- break; \
+- } \
+ return func; \
+ } \
+ } \
+--- php.orig/Zend/tests/bug45877.phpt
++++ php/Zend/tests/bug45877.phpt
+@@ -1,23 +1,40 @@
+ --TEST--
+ Bug #45877 (Array key '2147483647' left as string)
+---INI--
+-precision=20
+ --FILE--
+ php
+-$keys = array(PHP\_INT\_MAX,
+- (string) PHP\_INT\_MAX,
+- (string) (-PHP\_INT\_MAX - 1),
+- -PHP\_INT\_MAX - 1,
+- (string) (PHP\_INT\_MAX + 1));
++$max = sprintf("%d", PHP\_INT\_MAX);
++switch($max) {
++case "2147483647": /\* 32-bit systems \*/
++ $min = "-2147483648";
++ $overflow = "2147483648";
++ $underflow = "-2147483649";
++ break;
++case "9223372036854775807": /\* 64-bit systems \*/
++ $min = "-9223372036854775808";
++ $overflow = "9223372036854775808";
++ $underflow = "-9223372036854775809";
++ break;
++default:
++ die("failed: unknown value for PHP\_MAX\_INT");
++ break;
++}
+
+-var\_dump(array\_fill\_keys($keys, 1));
+-?
+---EXPECTF--
+-array(3) {
+- [%d7]=>
+- int(1)
+- [-%d8]=>
+- int(1)
+- ["%d8"]=>
+- int(1)
++function test\_value($val, $msg) {
++ $a = array($val => 1);
++ $keys = array\_keys($a);
++ if ($val == $keys[0]) $result = "ok";
++ else $result = "failed ($val != $keys[0])";
++ echo "$msg: $result\n";
+ }
++
++test\_value($max, "max");
++test\_value($overflow, "overflow");
++test\_value($min, "min");
++test\_value($underflow, "underflow");
++
++?>
++--EXPECT--
++max: ok
++overflow: ok
++min: ok
++underflow: ok
--- php5-5.3.2.orig/debian/patches/php5-pear-CVE-2011-1072.patch
+++ php5-5.3.2/debian/patches/php5-pear-CVE-2011-1072.patch
@@ -0,0 +1,713 @@
+Subject: Fixed Bug #18056 [SECURITY]: Symlink attack in PEAR install [dufuz]
+Origin: http://svn.php.net/viewvc?view=revision&revision=308687
+
+This feature is implemented as a result of the above fix
+\* Implemented Request #16648: Use TMPDIR for builds instead of /var/tmp [dufuz]
+
+CVE-2011-1072
+
+This patch differs from the upstream commit in that the packages.xml
+and packages2.xml edits containing only information about the commits
+were removed to reduce conflicts.
+
+Index: PEAR/PackageFile.php
+===================================================================
+--- PEAR/PackageFile.php (revision 308686)
++++ PEAR/PackageFile.php (revision 308687)
+@@ -46,11 +46,7 @@
+ \*/
+ var $\_config;
+ var $\_debug;
+- /\*\*
+- \* Temp directory for uncompressing tgz files.
+- \* @var string|false
+- \*/
+- var $\_tmpdir;
++
+ var $\_logger = false;
+ /\*\*
+ \* @var boolean
+@@ -58,17 +54,23 @@
+ var $\_rawReturn = false;
+
+ /\*\*
++ \* helper for extracting Archive\_Tar errors
++ \* @var array
++ \* @access private
++ \*/
++ var $\_extractErrors = array();
++
++ /\*\*
+ \*
+ \* @param PEAR\_Config $config
+ \* @param ? $debug
+ \* @param string @tmpdir Optional temporary directory for uncompressing
+ \* files
+ \*/
+- function PEAR\_PackageFile(&$config, $debug = false, $tmpdir = false)
++ function PEAR\_PackageFile(&$config, $debug = false)
+ {
+ $this->\_config = $config;
+ $this->\_debug = $debug;
+- $this->\_tmpdir = $tmpdir;
+ }
+
+ /\*\*
+@@ -349,20 +351,17 @@
+ }
+ }
+
+- if ($this->\_tmpdir) {
+- $tmpdir = $this->\_tmpdir;
+- } else {
+- $tmpdir = System::mkTemp(array('-t', $this->\_config->get('temp\_dir'), '-d', 'pear'));
+- if ($tmpdir === false) {
+- $ret = PEAR::raiseError("there was a problem with getting the configured temp directory");
+- return $ret;
+- }
+-
+- PEAR\_PackageFile::addTempFile($tmpdir);
++ $tmpdir = System::mktemp('-t ' . $this->\_config->get('temp\_dir') . ' -d pear');
++ if ($tmpdir === false) {
++ $ret = PEAR::raiseError("there was a problem with getting the configured temp directory");
++ return $ret;
+ }
+
++ PEAR\_PackageFile::addTempFile($tmpdir);
++
+ $this->\_extractErrors();
+ PEAR::staticPushErrorHandling(PEAR\_ERROR\_CALLBACK, array($this, '\_extractErrors'));
++
+ if (!$xml || !$tar->extractList(array($xml), $tmpdir)) {
+ $extra = implode("\n", $this->\_extractErrors());
+ if ($extra) {
+@@ -381,13 +380,6 @@
+ }
+
+ /\*\*
+- \* helper for extracting Archive\_Tar errors
+- \* @var array
+- \* @access private
+- \*/
+- var $\_extractErrors = array();
+-
+- /\*\*
+ \* helper callback for extracting Archive\_Tar errors
+ \*
+ \* @param PEAR\_Error|null $err
+Index: PEAR/Installer.php
+===================================================================
+--- PEAR/Installer.php (revision 308686)
++++ PEAR/Installer.php (revision 308687)
+@@ -1036,25 +1036,10 @@
+ // }}}
+ // {{{ \_parsePackageXml()
+
+- function \_parsePackageXml(&$descfile, &$tmpdir)
++ function \_parsePackageXml(&$descfile)
+ {
+- if (substr($descfile, -4) == '.xml') {
+- $tmpdir = false;
+- } else {
+- // {{{ Decompress pack in tmp dir -------------------------------------
+-
+- // To allow relative package file names
+- $descfile = realpath($descfile);
+-
+- if (PEAR::isError($tmpdir = System::mktemp('-d'))) {
+- return $tmpdir;
+- }
+- $this->log(3, '+ tmp dir created at ' . $tmpdir);
+- // }}}
+- }
+-
+ // Parse xml file -----------------------------------------------
+- $pkg = new PEAR\_PackageFile($this->config, $this->debug, $tmpdir);
++ $pkg = new PEAR\_PackageFile($this->config, $this->debug);
+ PEAR::staticPushErrorHandling(PEAR\_ERROR\_RETURN);
+ $p = &$pkg->fromAnyFile($descfile, PEAR\_VALIDATE\_INSTALLING);
+ PEAR::staticPopErrorHandling();
+@@ -1135,17 +1120,20 @@
+ $pkg = $pkgfile->getPackageFile();
+ $pkgfile = $pkg->getArchiveFile();
+ $descfile = $pkg->getPackageFile();
+- $tmpdir = dirname($descfile);
+ } else {
+ $descfile = $pkgfile;
+- $tmpdir = '';
+- $pkg = $this->\_parsePackageXml($descfile, $tmpdir);
++ $pkg = $this->\_parsePackageXml($descfile);
+ if (PEAR::isError($pkg)) {
+ return $pkg;
+ }
+ }
+
++ $tmpdir = dirname($descfile);
+ if (realpath($descfile) != realpath($pkgfile)) {
++ // Use the temp\_dir since $descfile can contain the download dir path
++ $tmpdir = $this->config->get('temp\_dir', null, 'pear.php.net');
++ $tmpdir = System::mktemp("-d -t $tmpdir");
++
+ $tar = new Archive\_Tar($pkgfile);
+ if (!$tar->extract($tmpdir)) {
+ return $this->raiseError("unable to unpack $pkgfile");
+@@ -1373,9 +1361,8 @@
+ }
+ }
+
+- $tmp\_path = dirname($descfile);
+ if (substr($pkgfile, -4) != '.xml') {
+- $tmp\_path .= DIRECTORY\_SEPARATOR . $pkgname . '-' . $pkg->getVersion();
++ $tmpdir .= DIRECTORY\_SEPARATOR . $pkgname . '-' . $pkg->getVersion();
+ }
+
+ $this->configSet('default\_channel', $channel);
+@@ -1401,9 +1388,9 @@
+ foreach ($filelist as $file => $atts) {
+ $this->expectError(PEAR\_INSTALLER\_FAILED);
+ if ($pkg->getPackagexmlVersion() == '1.0') {
+- $res = $this->\_installFile($file, $atts, $tmp\_path, $options);
++ $res = $this->\_installFile($file, $atts, $tmpdir, $options);
+ } else {
+- $res = $this->\_installFile2($pkg, $file, $atts, $tmp\_path, $options);
++ $res = $this->\_installFile2($pkg, $file, $atts, $tmpdir, $options);
+ }
+ $this->popExpect();
+
+Index: PEAR/Downloader.php
+===================================================================
+--- PEAR/Downloader.php (revision 308686)
++++ PEAR/Downloader.php (revision 308687)
+@@ -189,7 +189,8 @@
+ require\_once 'System.php';
+ }
+
+- $tmp = System::mktemp(array('-d'));
++ $tmpdir = $this->config->get('temp\_dir');
++ $tmp = System::mktemp("-d -t $tmpdir");
+ $a = $this->downloadHttp('http://' . $channel . '/channel.xml', $this->ui, $tmp, $callback, false);
+ PEAR::popErrorHandling();
+ if (PEAR::isError($a)) {
+@@ -493,14 +494,13 @@
+ \*/
+ function analyzeDependencies(&$params, $force = false)
+ {
+- $hasfailed = $failed = false;
+ if (isset($this->\_options['downloadonly'])) {
+ return;
+ }
+
+ PEAR::staticPushErrorHandling(PEAR\_ERROR\_RETURN);
+ $redo = true;
+- $reset = false;
++ $reset = $hasfailed = $failed = false;
+ while ($redo) {
+ $redo = false;
+ foreach ($params as $i => $param) {
+@@ -698,6 +698,7 @@
+ }
+ }
+ }
++
+ PEAR::staticPopErrorHandling();
+ if ($hasfailed && (isset($this->\_options['ignore-errors']) ||
+ isset($this->\_options['nodeps']))) {
+@@ -718,6 +719,7 @@
+ if (isset($this->\_downloadDir)) {
+ return $this->\_downloadDir;
+ }
++
+ $downloaddir = $this->config->get('download\_dir');
+ if (empty($downloaddir) || (is\_dir($downloaddir) && !is\_writable($downloaddir))) {
+ if (is\_dir($downloaddir) && !is\_writable($downloaddir)) {
+@@ -725,14 +727,17 @@
+ '" is not writeable. Change download\_dir config variable to ' .
+ 'a writeable dir to avoid this warning');
+ }
++
+ if (!class\_exists('System')) {
+ require\_once 'System.php';
+ }
++
+ if (PEAR::isError($downloaddir = System::mktemp('-d'))) {
+ return $downloaddir;
+ }
+ $this->log(3, '+ tmp dir created at ' . $downloaddir);
+ }
++
+ if (!is\_writable($downloaddir)) {
+ if (PEAR::isError(System::mkdir(array('-p', $downloaddir))) ||
+ !is\_writable($downloaddir)) {
+@@ -741,6 +746,7 @@
+ 'a writeable dir');
+ }
+ }
++
+ return $this->\_downloadDir = $downloaddir;
+ }
+
+@@ -771,27 +777,11 @@
+ $this->\_options = $options;
+ }
+
+- // }}}
+- // {{{ setOptions()
+ function getOptions()
+ {
+ return $this->\_options;
+ }
+
+- /\*\*
+- \* For simpler unit-testing
+- \* @param PEAR\_Config
+- \* @param int
+- \* @param string
+- \*/
+- function &getPackagefileObject(&$c, $d, $t = false)
+- {
+- if (!class\_exists('PEAR\_PackageFile')) {
+- require\_once 'PEAR/PackageFile.php';
+- }
+- $a = &new PEAR\_PackageFile($c, $d, $t);
+- return $a;
+- }
+
+ /\*\*
+ \* @param array output of {@link parsePackageName()}
+@@ -1000,9 +990,20 @@
+ }
+ return $info;
+ } elseif ($chan->supportsREST($this->config->get('preferred\_mirror'))
+- && $base = $chan->getBaseURL('REST1.0', $this->config->get('preferred\_mirror'))
++ &&
++ (
++ ($base2 = $chan->getBaseURL('REST1.3', $this->config->get('preferred\_mirror')))
++ ||
++ ($base = $chan->getBaseURL('REST1.0', $this->config->get('preferred\_mirror')))
++ )
+ ) {
+- $rest = &$this->config->getREST('1.0', $this->\_options);
++ if ($base2) {
++ $base = $base2;
++ $rest = &$this->config->getREST('1.3', $this->\_options);
++ } else {
++ $rest = &$this->config->getREST('1.0', $this->\_options);
++ }
++
+ $url = $rest->getDepDownloadURL($base, $xsdversion, $dep, $parr,
+ $state, $version, $chan->getName());
+ if (PEAR::isError($url)) {
+@@ -1707,6 +1708,10 @@
+ }
+
+ $dest\_file = $save\_dir . DIRECTORY\_SEPARATOR . $save\_as;
++ if (is\_link($dest\_file)) {
++ return PEAR::raiseError('SECURITY ERROR: Will not write to ' . $dest\_file . ' as it is symlinked to ' . readlink($dest\_file) . ' - Possible symlink attack');
++ }
++
+ if (!$wp = @fopen($dest\_file, 'wb')) {
+ fclose($fp);
+ if ($callback) {
+@@ -1758,5 +1763,4 @@
+ }
+ return $dest\_file;
+ }
+-}
+-// }}}
+\ No newline at end of file
++}
+\ No newline at end of file
+Index: PEAR/Downloader/Package.php
+===================================================================
+--- PEAR/Downloader/Package.php (revision 308686)
++++ PEAR/Downloader/Package.php (revision 308687)
+@@ -1376,6 +1376,8 @@
+ continue;
+ }
+
++ // FIXME do symlink check
++
+ fwrite($fp, $filecontents, strlen($filecontents));
+ fclose($fp);
+ if ($s = $params[$i]->explicitState()) {
+@@ -1497,13 +1499,12 @@
+ \* @param int
+ \* @param string
+ \*/
+- function &getPackagefileObject(&$c, $d, $t = false)
++ function &getPackagefileObject(&$c, $d)
+ {
+- $a = &new PEAR\_PackageFile($c, $d, $t);
++ $a = &new PEAR\_PackageFile($c, $d);
+ return $a;
+ }
+
+-
+ /\*\*
+ \* This will retrieve from a local file if possible, and parse out
+ \* a group name as well. The original parameter will be modified to reflect this.
+@@ -1527,16 +1528,7 @@
+ if (@is\_file($param)) {
+ $this->\_type = 'local';
+ $options = $this->\_downloader->getOptions();
+- if (isset($options['downloadonly'])) {
+- $pkg = &$this->getPackagefileObject($this->\_config,
+- $this->\_downloader->\_debug);
+- } else {
+- if (PEAR::isError($dir = $this->\_downloader->getDownloadDir())) {
+- return $dir;
+- }
+- $pkg = &$this->getPackagefileObject($this->\_config,
+- $this->\_downloader->\_debug, $dir);
+- }
++ $pkg = &$this->getPackagefileObject($this->\_config, $this->\_downloader->\_debug);
+ PEAR::pushErrorHandling(PEAR\_ERROR\_RETURN);
+ $pf = &$pkg->fromAnyFile($param, PEAR\_VALIDATE\_INSTALLING);
+ PEAR::popErrorHandling();
+@@ -1608,15 +1600,7 @@
+ }
+
+ // whew, download worked!
+- if (isset($options['downloadonly'])) {
+- $pkg = &$this->getPackagefileObject($this->\_config, $this->\_downloader->debug);
+- } else {
+- $dir = $this->\_downloader->getDownloadDir();
+- if (PEAR::isError($dir)) {
+- return $dir;
+- }
+- $pkg = &$this->getPackagefileObject($this->\_config, $this->\_downloader->debug, $dir);
+- }
++ $pkg = &$this->getPackagefileObject($this->\_config, $this->\_downloader->debug);
+
+ PEAR::pushErrorHandling(PEAR\_ERROR\_RETURN);
+ $pf = &$pkg->fromAnyFile($file, PEAR\_VALIDATE\_INSTALLING);
+Index: PEAR/REST.php
+===================================================================
+--- PEAR/REST.php (revision 308686)
++++ PEAR/REST.php (revision 308687)
+@@ -100,7 +100,10 @@
+ $ret = $this->getCache($url);
+ if (!PEAR::isError($ret) && $trieddownload) {
+ // reset the age of the cache if the server says it was unmodified
+- $this->saveCache($url, $ret, null, true, $cacheId);
++ $result = $this->saveCache($url, $ret, null, true, $cacheId);
++ if (PEAR::isError($result)) {
++ return PEAR::raiseErro($result->getMessage());
++ }
+ }
+
+ return $ret;
+@@ -117,7 +120,11 @@
+ }
+
+ if ($forcestring) {
+- $this->saveCache($url, $content, $lastmodified, false, $cacheId);
++ $result = $this->saveCache($url, $content, $lastmodified, false, $cacheId);
++ if (PEAR::isError($result)) {
++ return PEAR::raiseErro($result->getMessage());
++ }
++
+ return $content;
+ }
+
+@@ -153,7 +160,11 @@
+ $content = $parser->getData();
+ }
+
+- $this->saveCache($url, $content, $lastmodified, false, $cacheId);
++ $result = $this->saveCache($url, $content, $lastmodified, false, $cacheId);
++ if (PEAR::isError($result)) {
++ return PEAR::raiseErro($result->getMessage());
++ }
++
+ return $content;
+ }
+
+@@ -212,57 +223,65 @@
+ \*/
+ function saveCache($url, $contents, $lastmodified, $nochange = false, $cacheid = null)
+ {
+- $cachedir = $this->config->get('cache\_dir') . DIRECTORY\_SEPARATOR . md5($url);
+- $cacheidfile = $cachedir . 'rest.cacheid';
+- $cachefile = $cachedir . 'rest.cachefile';
++ $cache\_dir = $this->config->get('cache\_dir');
++ $d = $cache\_dir . DIRECTORY\_SEPARATOR . md5($url);
++ $cacheidfile = $d . 'rest.cacheid';
++ $cachefile = $d . 'rest.cachefile';
+
+ if ($cacheid === null && $nochange) {
+ $cacheid = unserialize(implode('', file($cacheidfile)));
+ }
+
+- $fp = @fopen($cacheidfile, 'wb');
+- if (!$fp) {
+- $cache\_dir = $this->config->get('cache\_dir');
++ if (is\_link($cacheidfile)) {
++ return PEAR::raiseError('SECURITY ERROR: Will not write to ' . $cacheidfile . ' as it is symlinked to ' . readlink($cacheidfile) . ' - Possible symlink attack');
++ }
++
++ if (is\_link($cachefile)) {
++ return PEAR::raiseError('SECURITY ERROR: Will not write to ' . $cacheidfile . ' as it is symlinked to ' . readlink($cacheidfile) . ' - Possible symlink attack');
++ }
++
++ $cacheidfile\_fp = @fopen($cacheidfile, 'wb');
++ if (!$cacheidfile\_fp) {
+ if (is\_dir($cache\_dir)) {
+- return false;
++ return PEAR::raiseError("The value of config option cache\_dir ($cache\_dir) is not a directory. ");
+ }
+
+ System::mkdir(array('-p', $cache\_dir));
+- $fp = @fopen($cacheidfile, 'wb');
+- if (!$fp) {
+- return false;
++ $cacheidfile\_fp = @fopen($cacheidfile, 'wb');
++ if (!$cacheidfile\_fp) {
++ return PEAR::raiseError("Could not open $cacheidfile for writing.");
+ }
+ }
+
+ if ($nochange) {
+- fwrite($fp, serialize(array(
++ fwrite($cacheidfile\_fp, serialize(array(
+ 'age' => time(),
+ 'lastChange' => $cacheid['lastChange'],
+ ))
+ );
+
+- fclose($fp);
++ fclose($cacheidfile\_fp);
+ return true;
+ }
+
+- fwrite($fp, serialize(array(
++ fwrite($cacheidfile\_fp, serialize(array(
+ 'age' => time(),
+ 'lastChange' => $lastmodified,
+ ))
+ );
++ fclose($cacheidfile\_fp);
+
+- fclose($fp);
+- $fp = @fopen($cachefile, 'wb');
+- if (!$fp) {
++ $cachefile\_fp = @fopen($cachefile, 'wb');
++ if (!$cachefile\_fp) {
+ if (file\_exists($cacheidfile)) {
+ @unlink($cacheidfile);
+ }
+
+- return false;
++ return PEAR::raiseError("Could not open $cacheidfile for writing.");
+ }
+
+- fwrite($fp, serialize($contents));
+- fclose($fp);
++ fwrite($cachefile\_fp, serialize($contents));
++ fclose($cachefile\_fp);
+ return true;
+ }
+
+Index: PEAR/Builder.php
+===================================================================
+--- PEAR/Builder.php (revision 308686)
++++ PEAR/Builder.php (revision 308687)
+@@ -220,7 +220,7 @@
+ /\*\*
+ \* Build an extension from source. Runs "phpize" in the source
+ \* directory, but compiles in a temporary directory
+- \* (/var/tmp/pear-build-USER/PACKAGE-VERSION).
++ \* (TMPDIR/pear-build-USER/PACKAGE-VERSION).
+ \*
+ \* @param string|PEAR\_PackageFile\_v\* $descfile path to XML package description file, or
+ \* a PEAR\_PackageFile object
+@@ -250,6 +250,7 @@
+ ' appears to have a prefix ' . $matches[2] . ', but' .
+ ' config variable php\_prefix does not match');
+ }
++
+ if (isset($matches[3]) && strlen($matches[3]) &&
+ trim($matches[3]) != trim($this->config->get('php\_suffix'))) {
+ $this->log(0, 'WARNING: php\_bin ' . $this->config->get('php\_bin') .
+@@ -258,14 +259,15 @@
+ }
+ }
+
+-
+ $this->current\_callback = $callback;
+ if (PEAR\_OS == "Windows") {
+ return $this->\_build\_win32($descfile, $callback);
+ }
++
+ if (PEAR\_OS != 'Unix') {
+ return $this->raiseError("building extensions not supported on this platform");
+ }
++
+ if (is\_object($descfile)) {
+ $pkg = $descfile;
+ $descfile = $pkg->getPackageFile();
+@@ -284,14 +286,17 @@
+ }
+ $dir = dirname($descfile);
+ }
++
+ $old\_cwd = getcwd();
+ if (!file\_exists($dir) || !is\_dir($dir) || !chdir($dir)) {
+ return $this->raiseError("could not chdir to $dir");
+ }
++
+ $vdir = $pkg->getPackage() . '-' . $pkg->getVersion();
+ if (is\_dir($vdir)) {
+ chdir($vdir);
+ }
++
+ $dir = getcwd();
+ $this->log(2, "building in $dir");
+ putenv('PATH=' . $this->config->get('bin\_dir') . ':' . getenv('PATH'));
+@@ -302,6 +307,7 @@
+ if (PEAR::isError($err)) {
+ return $err;
+ }
++
+ if (!$err) {
+ return $this->raiseError("`phpize' failed");
+ }
+@@ -327,30 +333,31 @@
+ // }}} end of interactive part
+
+ // FIXME make configurable
+- if(!$user=getenv('USER')){
++ if (!$user=getenv('USER')) {
+ $user='defaultuser';
+ }
+- $build\_basedir = "/var/tmp/pear-build-$user";
++
++ $tmpdir = $this->config->get('temp\_dir');
++ $build\_basedir = System::mktemp(" -t $tmpdir -d pear-build-$user");
+ $build\_dir = "$build\_basedir/$vdir";
+ $inst\_dir = "$build\_basedir/install-$vdir";
+ $this->log(1, "building in $build\_dir");
+ if (is\_dir($build\_dir)) {
+ System::rm(array('-rf', $build\_dir));
+ }
++
+ if (!System::mkDir(array('-p', $build\_dir))) {
+ return $this->raiseError("could not create build dir: $build\_dir");
+ }
++
+ $this->addTempFile($build\_dir);
+ if (!System::mkDir(array('-p', $inst\_dir))) {
+ return $this->raiseError("could not create temporary install dir: $inst\_dir");
+ }
+ $this->addTempFile($inst\_dir);
+
+- if (getenv('MAKE')) {
+- $make\_command = getenv('MAKE');
+- } else {
+- $make\_command = 'make';
+- }
++ $make\_command = getenv('MAKE') ? getenv('MAKE') : 'make';
++
+ $to\_run = array(
+ $configure\_command,
+ $make\_command,
+Index: PEAR/Command/Remote.php
+===================================================================
+--- PEAR/Command/Remote.php (revision 308686)
++++ PEAR/Command/Remote.php (revision 308687)
+@@ -144,7 +144,7 @@
+ 'shortcut' => 'cc',
+ 'options' => array(),
+ 'doc' => '
+-Clear the XML-RPC/REST cache. See also the cache\_ttl configuration
++Clear the REST cache. See also the cache\_ttl configuration
+ parameter.
+ ',
+ ),
+@@ -776,6 +776,7 @@
+ if ($verbose >= 1) {
+ $output .= "reading directory $cache\_dir\n";
+ }
++
+ $num = 0;
+ while ($ent = readdir($dp)) {
+ if (preg\_match('/rest.cache(file|id)\\z/', $ent)) {
+Index: PEAR/Command/Package.php
+===================================================================
+--- PEAR/Command/Package.php (revision 308686)
++++ PEAR/Command/Package.php (revision 308687)
+@@ -314,7 +314,7 @@
+ return $a;
+ }
+
+- function &getPackageFile($config, $debug = false, $tmpdir = null)
++ function &getPackageFile($config, $debug = false)
+ {
+ if (!class\_exists('PEAR\_Common')) {
+ require\_once 'PEAR/Common.php';
+@@ -322,7 +322,7 @@
+ if (!class\_exists('PEAR\_PackageFile')) {
+ require\_once 'PEAR/PackageFile.php';
+ }
+- $a = &new PEAR\_PackageFile($config, $debug, $tmpdir);
++ $a = &new PEAR\_PackageFile($config, $debug);
+ $common = new PEAR\_Common;
+ $common->ui = $this->ui;
+ $a->setLogger($common);
+@@ -969,7 +969,9 @@
+ }
+
+ $tar = new Archive\_Tar($params[0]);
+- $tmpdir = System::mktemp('-d pearsign');
++
++ $tmpdir = $this->config->get('temp\_dir');
++ $tmpdir = System::mktemp(" -t $tmpdir -d pearsign");
+ if (!$tar->extractList('package2.xml package.xml package.sig', $tmpdir)) {
+ return $this->raiseError("failed to extract tar file");
+ }
+Index: PEAR/Command/Install.php
+===================================================================
+--- PEAR/Command/Install.php (revision 308686)
++++ PEAR/Command/Install.php (revision 308687)
+@@ -730,7 +730,8 @@
+ if ($param->getPackageType() == 'extsrc' ||
+ $param->getPackageType() == 'extbin' ||
+ $param->getPackageType() == 'zendextsrc' ||
+- $param->getPackageType() == 'zendextbin') {
++ $param->getPackageType() == 'zendextbin'
++ ) {
+ $pkg = &$param->getPackageFile();
+ if ($instbin = $pkg->getInstalledBinary()) {
+ $instpkg = &$instreg->getPackage($instbin, $pkg->getChannel());
+@@ -741,7 +742,8 @@
+ foreach ($instpkg->getFilelist() as $name => $atts) {
+ $pinfo = pathinfo($atts['installed\_as']);
+ if (!isset($pinfo['extension']) ||
+- in\_array($pinfo['extension'], array('c', 'h'))) {
++ in\_array($pinfo['extension'], array('c', 'h'))
++ ) {
+ continue; // make sure we don't match php\_blah.h
+ }
+
+Index: PEAR/Command/Pickle.php
+===================================================================
+--- PEAR/Command/Pickle.php (revision 308686)
++++ PEAR/Command/Pickle.php (revision 308687)
+@@ -104,7 +104,7 @@
+ \* @param string|null $tmpdir
+ \* @return PEAR\_PackageFile
+ \*/
+- function &getPackageFile($config, $debug = false, $tmpdir = null)
++ function &getPackageFile($config, $debug = false)
+ {
+ if (!class\_exists('PEAR\_Common')) {
+ require\_once 'PEAR/Common.php';
+@@ -114,7 +114,7 @@
+ require\_once 'PEAR/PackageFile.php';
+ }
+
+- $a = &new PEAR\_PackageFile($config, $debug, $tmpdir);
++ $a = &new PEAR\_PackageFile($config, $debug);
+ $common = new PEAR\_Common;
+ $common->ui = $this->ui;
+ $a->setLogger($common);
--- php5-5.3.2.orig/debian/patches/CVE-2010-0397.patch
+++ php5-5.3.2/debian/patches/CVE-2010-0397.patch
@@ -0,0 +1,58 @@
+Description: Fix a null pointer dereference when processing invalid
+ XML-RPC requests.
+Origin: vendor
+Forwarded: http://bugs.php.net/51288
+Last-Update: 2010-03-12
+
+Index: php/ext/xmlrpc/xmlrpc-epi-php.c
+===================================================================
+--- php.orig/ext/xmlrpc/xmlrpc-epi-php.c
++++ php/ext/xmlrpc/xmlrpc-epi-php.c
+@@ -778,6 +778,7 @@ zval\* decode\_request\_worker(char \*xml\_in
+ zval\* retval = NULL;
+ XMLRPC\_REQUEST response;
+ STRUCT\_XMLRPC\_REQUEST\_INPUT\_OPTIONS opts = {{0}};
++ const char \*method\_name;
+ opts.xml\_elem\_opts.encoding = encoding\_in ? utf8\_get\_encoding\_id\_from\_string(encoding\_in) : ENCODING\_DEFAULT;
+
+ /\* generate XMLRPC\_REQUEST from raw xml \*/
+@@ -788,10 +789,16 @@ zval\* decode\_request\_worker(char \*xml\_in
+
+ if (XMLRPC\_RequestGetRequestType(response) == xmlrpc\_request\_call) {
+ if (method\_name\_out) {
+- zval\_dtor(method\_name\_out);
+- Z\_TYPE\_P(method\_name\_out) = IS\_STRING;
+- Z\_STRVAL\_P(method\_name\_out) = estrdup(XMLRPC\_RequestGetMethodName(response));
+- Z\_STRLEN\_P(method\_name\_out) = strlen(Z\_STRVAL\_P(method\_name\_out));
++ method\_name = XMLRPC\_RequestGetMethodName(response);
++ if (method\_name) {
++ zval\_dtor(method\_name\_out);
++ Z\_TYPE\_P(method\_name\_out) = IS\_STRING;
++ Z\_STRVAL\_P(method\_name\_out) = estrdup(method\_name);
++ Z\_STRLEN\_P(method\_name\_out) = strlen(Z\_STRVAL\_P(method\_name\_out));
++ } else if (retval) {
++ zval\_ptr\_dtor(&retval);
++ retval = NULL;
++ }
+ }
+ }
+
+Index: php/ext/xmlrpc/tests/bug51288.phpt
+===================================================================
+--- /dev/null
++++ php/ext/xmlrpc/tests/bug51288.phpt
+@@ -0,0 +1,14 @@
++--TEST--
++Bug #51288 (CVE-2010-0397, NULL pointer deref when no  in request)
++--FILE--
++php
++$method = NULL;
++$req = '<?xml version="1.0"?';
++var\_dump(xmlrpc\_decode\_request($req, $method));
++var\_dump($method);
++echo "Done\n";
++?>
++--EXPECT--
++NULL
++NULL
++Done
--- php5-5.3.2.orig/debian/patches/php5-CVE-2012-0788.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2012-0788.patch
@@ -0,0 +1,42 @@
+Origin: http://svn.php.net/viewvc?view=revision&revision=317272
+Subject: Fix bug #55776 (PDORow to session bug)
+
+CVE-2012-0788
+
+---
+ ext/pdo/pdo\_stmt.c | 8 ++++++++
+ 1 file changed, 8 insertions(+)
+
+Index: b/ext/pdo/pdo\_stmt.c
+===================================================================
+--- a/ext/pdo/pdo\_stmt.c
++++ b/ext/pdo/pdo\_stmt.c
+@@ -2345,6 +2345,7 @@ static zend\_object\_value dbstmt\_clone\_ob
+ }
+
+ zend\_object\_handlers pdo\_dbstmt\_object\_handlers;
++static int pdo\_row\_serialize(zval \*object, unsigned char \*\*buffer, zend\_uint \*buf\_len, zend\_serialize\_data \*data TSRMLS\_DC);
+
+ void pdo\_stmt\_init(TSRMLS\_D)
+ {
+@@ -2368,6 +2369,7 @@ void pdo\_stmt\_init(TSRMLS\_D)
+ pdo\_row\_ce = zend\_register\_internal\_class(&ce TSRMLS\_CC);
+ pdo\_row\_ce->ce\_flags |= ZEND\_ACC\_FINAL\_CLASS; /\* when removing this a lot of handlers need to be redone \*/
+ pdo\_row\_ce->create\_object = pdo\_row\_new;
++ pdo\_row\_ce->serialize = pdo\_row\_serialize;
+ }
+
+ static void free\_statement(pdo\_stmt\_t \*stmt TSRMLS\_DC)
+@@ -2791,6 +2793,12 @@ zend\_object\_value pdo\_row\_new(zend\_class
+
+ return retval;
+ }
++
++static int pdo\_row\_serialize(zval \*object, unsigned char \*\*buffer, zend\_uint \*buf\_len, zend\_serialize\_data \*data TSRMLS\_DC)
++{
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "PDORow instances may not be serialized");
++ return FAILURE;
++}
+ /\* }}} \*/
+
+ /\*
--- php5-5.3.2.orig/debian/patches/116-posixness\_fix.patch
+++ php5-5.3.2/debian/patches/116-posixness\_fix.patch
@@ -0,0 +1,52 @@
+--- a/TSRM/tsrm\_config\_common.h
++++ b/TSRM/tsrm\_config\_common.h
+@@ -1,6 +1,10 @@
+ #ifndef TSRM\_CONFIG\_COMMON\_H
+ #define TSRM\_CONFIG\_COMMON\_H
+
++#ifndef PATH\_MAX
++#define PATH\_MAX 4096
++#endif
++
+ #ifndef \_\_CYGWIN\_\_
+ # if WINNT|WIN32
+ # define TSRM\_WIN32
+--- a/ext/date/lib/parse\_tz.c
++++ b/ext/date/lib/parse\_tz.c
+@@ -18,6 +18,10 @@
+
+ /\* $Id: parse\_tz.c 293036 2010-01-03 09:23:27Z sebastian $ \*/
+
++#ifndef PATH\_MAX
++#define PATH\_MAX 4096
++#endif
++
+ #include "timelib.h"
+
+ #include
+--- a/ext/standard/proc\_open.c
++++ b/ext/standard/proc\_open.c
+@@ -24,6 +24,10 @@
+ # define \_\_EXTENSIONS\_\_ 1 /\* Solaris: uint \*/
+ #endif
+
++#ifndef PATH\_MAX
++#define PATH\_MAX 4096
++#endif
++
+ #include "php.h"
+ #include
+ #include
+--- a/main/php.h
++++ b/main/php.h
+@@ -248,6 +248,10 @@ END\_EXTERN\_C()
+ /\* macros \*/
+ #define STR\_PRINT(str) ((str)?(str):"")
+
++#ifndef PATH\_MAX
++#define PATH\_MAX 4096
++#endif
++
+ #ifndef MAXPATHLEN
+ # ifdef PATH\_MAX
+ # define MAXPATHLEN PATH\_MAX
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-4698.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-4698.patch
@@ -0,0 +1,45 @@
+Subject: Fix #53492, fix crash if aa steps are invalid
+Origin: http://svn.php.net/viewvc?view=revision&revision=306075
+Bug: http://bugs.php.net/53492
+
+Patch also includes
+http://svn.php.net/viewvc?view=revision&revision=306236
+
+ Merge from trunk:
+ \* Fixed parameter check introduced with the recent fix for bug #53492.
+ \* Improved the error message along the way.
+
+Patch is modified from upstream commits to remove edits to the NEWS
+file, to reduce conflicts when patching.
+
+Index: ext/gd/gd.c
+===================================================================
+--- ext/gd/gd.c (revision 306074)
++++ ext/gd/gd.c (revision 306075)
+@@ -4228,6 +4228,11 @@
+ return;
+ }
+
++ if (aa\_steps != 4 || aa\_steps != 16) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "AA steps must be 4 or 16");
++ RETURN\_FALSE;
++ }
++
+ ZEND\_FETCH\_RESOURCE(bg\_img, gdImagePtr, &img, -1, "Image", le\_gd);
+ ZEND\_FETCH\_RESOURCE(f\_ind, int \*, &fnt, -1, "Type 1 font", le\_ps\_font);
+
+Index: ext/gd/gd.c
+===================================================================
+--- ext/gd/gd.c (revision 306235)
++++ ext/gd/gd.c (revision 306236)
+@@ -4228,8 +4228,8 @@
+ return;
+ }
+
+- if (aa\_steps != 4 || aa\_steps != 16) {
+- php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "AA steps must be 4 or 16");
++ if (aa\_steps != 4 && aa\_steps != 16) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Antialias steps must be 4 or 16");
+ RETURN\_FALSE;
+ }
+
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-2483.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-2483.patch
@@ -0,0 +1,592 @@
+From: Solar Designer
+Origin: http://svn.php.net/viewvc?view=revision&revision=313406
+Subject: update crypt\_blowfish to 1.2. (CVE-2011-2483) (Solar Designer)
+
+- update blowfish to 1.2 (Solar Designer)
+
+CVE-2011-2483
+
+[Ubuntu note: patch differs from upstream commit in that the added
+ header crypt\_blowfish.h has been dropped, to prevent possible 3rd
+ party build problems by introducing the new header. Also, the changes
+ to the News file have been dropped to reduce conflicts. --sbeattie]
+
+---
+ README.REDIST.BINS | 27 ++
+ ext/standard/crypt\_blowfish.c | 379 +++++++++++++++++++++++++++++-------------
+ ext/standard/crypt\_blowfish.h | 32 +++
+ ext/standard/php\_crypt\_r.h | 4
+ 4 files changed, 320 insertions(+), 122 deletions(-)
+
+Index: b/README.REDIST.BINS
+===================================================================
+--- a/README.REDIST.BINS
++++ b/README.REDIST.BINS
+@@ -51,27 +51,40 @@ SUCH DAMAGE.
+
+ 6. ext/standard crypt's blowfish implementation
+
++The crypt\_blowfish homepage is:
++
++http://www.openwall.com/crypt/
++
+ This code comes from John the Ripper password cracker, with reentrant
+ and crypt(3) interfaces added, but optimizations specific to password
+ cracking removed.
+
+-Written by Solar Designer  in 1998-2002 and
+-placed in the public domain.
++Written by Solar Designer  in 1998-2011.
++No copyright is claimed, and the software is hereby placed in the public
++domain. In case this attempt to disclaim copyright and place the software
++in the public domain is deemed null and void, then the software is
++Copyright (c) 1998-2011 Solar Designer and it is hereby released to the
++general public under the following terms:
++
++Redistribution and use in source and binary forms, with or without
++modification, are permitted.
+
+-There's absolutely no warranty.
++There's ABSOLUTELY NO WARRANTY, express or implied.
+
+ It is my intent that you should be able to use this on your system,
+-as a part of a software package, or anywhere else to improve security,
++as part of a software package, or anywhere else to improve security,
+ ensure compatibility, or for any other purpose. I would appreciate
+ it if you give credit where it is due and keep your modifications in
+ the public domain as well, but I don't require that in order to let
+ you place this code and any modifications you make under a license
+ of your choice.
+
+-This implementation is compatible with OpenBSD bcrypt.c (version 2a)
+-by Niels Provos , and uses some of his
++This implementation is mostly compatible with OpenBSD's bcrypt.c (prefix
++"$2a$") by Niels Provos , and uses some of his
+ ideas. The password hashing algorithm was designed by David Mazieres
+-.
++. For more information on the level of compatibility,
++please refer to the comments in BF\_set\_key() and to the crypt(3) man page
++included in the crypt\_blowfish tarball.
+
+ There's a paper on the algorithm that explains its design decisions:
+
+Index: b/ext/standard/crypt\_blowfish.c
+===================================================================
+--- a/ext/standard/crypt\_blowfish.c
++++ b/ext/standard/crypt\_blowfish.c
+@@ -1,28 +1,39 @@
++/\* $Id: crypt\_blowfish.c 313406 2011-07-18 21:26:29Z pajoye $ \*/
+ /\*
+- $Id: crypt\_blowfish.c 295350 2010-02-22 00:34:22Z pajoye $
+-\*/
+-/\*
++ \* The crypt\_blowfish homepage is:
++ \*
++ \* http://www.openwall.com/crypt/
++ \*
+ \* This code comes from John the Ripper password cracker, with reentrant
+ \* and crypt(3) interfaces added, but optimizations specific to password
+ \* cracking removed.
+ \*
+- \* Written by Solar Designer  in 1998-2002 and
+- \* placed in the public domain.
++ \* Written by Solar Designer  in 1998-2011.
++ \* No copyright is claimed, and the software is hereby placed in the public
++ \* domain. In case this attempt to disclaim copyright and place the software
++ \* in the public domain is deemed null and void, then the software is
++ \* Copyright (c) 1998-2011 Solar Designer and it is hereby released to the
++ \* general public under the following terms:
+ \*
+- \* There's absolutely no warranty.
++ \* Redistribution and use in source and binary forms, with or without
++ \* modification, are permitted.
++ \*
++ \* There's ABSOLUTELY NO WARRANTY, express or implied.
+ \*
+ \* It is my intent that you should be able to use this on your system,
+- \* as a part of a software package, or anywhere else to improve security,
++ \* as part of a software package, or anywhere else to improve security,
+ \* ensure compatibility, or for any other purpose. I would appreciate
+ \* it if you give credit where it is due and keep your modifications in
+ \* the public domain as well, but I don't require that in order to let
+ \* you place this code and any modifications you make under a license
+ \* of your choice.
+ \*
+- \* This implementation is compatible with OpenBSD bcrypt.c (version 2a)
+- \* by Niels Provos , and uses some of his
++ \* This implementation is mostly compatible with OpenBSD's bcrypt.c (prefix
++ \* "$2a$") by Niels Provos , and uses some of his
+ \* ideas. The password hashing algorithm was designed by David Mazieres
+- \* .
++ \* . For more information on the level of compatibility,
++ \* please refer to the comments in BF\_set\_key() below and to the crypt(3)
++ \* man page included in the crypt\_blowfish tarball.
+ \*
+ \* There's a paper on the algorithm that explains its design decisions:
+ \*
+@@ -40,16 +51,8 @@
+ #define \_\_set\_errno(val) errno = (val)
+ #endif
+
+-
+-#ifndef \_\_const
+-#ifdef \_\_GNUC\_\_
+-#define \_\_CONST \_\_const
+-#else
+-#define \_\_CONST
+-#endif
+-#else
+-#define \_\_CONST \_\_const
+-#endif
++/\* Just to make sure the prototypes match the actual definitions \*/
++// skip including "crypt\_blowfish.h" as it's been dropped -sbeattie
+
+ #ifdef \_\_i386\_\_
+ #define BF\_ASM 0
+@@ -63,6 +66,7 @@
+ #endif
+
+ typedef unsigned int BF\_word;
++typedef signed int BF\_word\_signed;
+
+ /\* Number of Blowfish rounds, this is also hardcoded into a few places \*/
+ #define BF\_N 16
+@@ -370,35 +374,21 @@ static unsigned char BF\_atoi64[0x60] = {
+ 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 64, 64, 64, 64, 64
+ };
+
+-/\*
+- \* This may be optimized out if built with function inlining and no BF\_ASM.
+- \*/
+-static void clean(void \*data, int size)
+-{
+-#if BF\_ASM
+- extern void \_BF\_clean(void \*data);
+-#endif
+- memset(data, 0, size);
+-#if BF\_ASM
+- \_BF\_clean(data);
+-#endif
+-}
+-
+ #define BF\_safe\_atoi64(dst, src) \
+ { \
+ tmp = (unsigned char)(src); \
+- if (tmp == '$') break; \
++ if (tmp == '$') break; /\* PHP hack \*/ \
+ if ((unsigned int)(tmp -= 0x20) >= 0x60) return -1; \
+ tmp = BF\_atoi64[tmp]; \
+ if (tmp > 63) return -1; \
+ (dst) = tmp; \
+ }
+
+-static int BF\_decode(BF\_word \*dst, \_\_CONST char \*src, int size)
++static int BF\_decode(BF\_word \*dst, const char \*src, int size)
+ {
+ unsigned char \*dptr = (unsigned char \*)dst;
+ unsigned char \*end = dptr + size;
+- unsigned char \*sptr = (unsigned char \*)src;
++ const unsigned char \*sptr = (const unsigned char \*)src;
+ unsigned int tmp, c1, c2, c3, c4;
+
+ do {
+@@ -415,16 +405,16 @@ static int BF\_decode(BF\_word \*dst, \_\_CON
+ \*dptr++ = ((c3 & 0x03) << 6) | c4;
+ } while (dptr < end);
+
+- while (dptr < end)
++ while (dptr < end) /\* PHP hack \*/
+ \*dptr++ = 0;
+
+ return 0;
+ }
+
+-static void BF\_encode(char \*dst, \_\_CONST BF\_word \*src, int size)
++static void BF\_encode(char \*dst, const BF\_word \*src, int size)
+ {
+- unsigned char \*sptr = (unsigned char \*)src;
+- unsigned char \*end = sptr + size;
++ const unsigned char \*sptr = (const unsigned char \*)src;
++ const unsigned char \*end = sptr + size;
+ unsigned char \*dptr = (unsigned char \*)dst;
+ unsigned int c1, c2;
+
+@@ -555,32 +545,117 @@ static void BF\_swap(BF\_word \*x, int coun
+ } while (ptr < &data.ctx.S[3][0xFF]);
+ #endif
+
+-static void BF\_set\_key(\_\_CONST char \*key, BF\_key expanded, BF\_key initial)
++static void BF\_set\_key(const char \*key, BF\_key expanded, BF\_key initial,
++ unsigned char flags)
+ {
+- \_\_CONST char \*ptr = key;
+- int i, j;
+- BF\_word tmp;
++ const char \*ptr = key;
++ unsigned int bug, i, j;
++ BF\_word safety, sign, diff, tmp[2];
++
++/\*
++ \* There was a sign extension bug in older revisions of this function. While
++ \* we would have liked to simply fix the bug and move on, we have to provide
++ \* a backwards compatibility feature (essentially the bug) for some systems and
++ \* a safety measure for some others. The latter is needed because for certain
++ \* multiple inputs to the buggy algorithm there exist easily found inputs to
++ \* the correct algorithm that produce the same hash. Thus, we optionally
++ \* deviate from the correct algorithm just enough to avoid such collisions.
++ \* While the bug itself affected the majority of passwords containing
++ \* characters with the 8th bit set (although only a percentage of those in a
++ \* collision-producing way), the anti-collision safety measure affects
++ \* only a subset of passwords containing the '\xff' character (not even all of
++ \* those passwords, just some of them). This character is not found in valid
++ \* UTF-8 sequences and is rarely used in popular 8-bit character encodings.
++ \* Thus, the safety measure is unlikely to cause much annoyance, and is a
++ \* reasonable tradeoff to use when authenticating against existing hashes that
++ \* are not reliably known to have been computed with the correct algorithm.
++ \*
++ \* We use an approach that tries to minimize side-channel leaks of password
++ \* information - that is, we mostly use fixed-cost bitwise operations instead
++ \* of branches or table lookups. (One conditional branch based on password
++ \* length remains. It is not part of the bug aftermath, though, and is
++ \* difficult and possibly unreasonable to avoid given the use of C strings by
++ \* the caller, which results in similar timing leaks anyway.)
++ \*
++ \* For actual implementation, we set an array index in the variable "bug"
++ \* (0 means no bug, 1 means sign extension bug emulation) and a flag in the
++ \* variable "safety" (bit 16 is set when the safety measure is requested).
++ \* Valid combinations of settings are:
++ \*
++ \* Prefix "$2a$": bug = 0, safety = 0x10000
++ \* Prefix "$2x$": bug = 1, safety = 0
++ \* Prefix "$2y$": bug = 0, safety = 0
++ \*/
++ bug = (unsigned int)flags & 1;
++ safety = ((BF\_word)flags & 2) << 15;
++
++ sign = diff = 0;
+
+ for (i = 0; i < BF\_N + 2; i++) {
+- tmp = 0;
++ tmp[0] = tmp[1] = 0;
+ for (j = 0; j < 4; j++) {
+- tmp <<= 8;
+- tmp |= \*ptr;
+-
+- if (!\*ptr) ptr = key; else ptr++;
++ tmp[0] <<= 8;
++ tmp[0] |= (unsigned char)\*ptr; /\* correct \*/
++ tmp[1] <<= 8;
++ tmp[1] |= (BF\_word\_signed)(signed char)\*ptr; /\* bug \*/
++/\*
++ \* Sign extension in the first char has no effect - nothing to overwrite yet,
++ \* and those extra 24 bits will be fully shifted out of the 32-bit word. For
++ \* chars 2, 3, 4 in each four-char block, we set bit 7 of "sign" if sign
++ \* extension in tmp[1] occurs. Once this flag is set, it remains set.
++ \*/
++ if (j)
++ sign |= tmp[1] & 0x80;
++ if (!\*ptr)
++ ptr = key;
++ else
++ ptr++;
+ }
++ diff |= tmp[0] ^ tmp[1]; /\* Non-zero on any differences \*/
+
+- expanded[i] = tmp;
+- initial[i] = BF\_init\_state.P[i] ^ tmp;
++ expanded[i] = tmp[bug];
++ initial[i] = BF\_init\_state.P[i] ^ tmp[bug];
+ }
++
++/\*
++ \* At this point, "diff" is zero iff the correct and buggy algorithms produced
++ \* exactly the same result. If so and if "sign" is non-zero, which indicates
++ \* that there was a non-benign sign extension, this means that we have a
++ \* collision between the correctly computed hash for this password and a set of
++ \* passwords that could be supplied to the buggy algorithm. Our safety measure
++ \* is meant to protect from such many-buggy to one-correct collisions, by
++ \* deviating from the correct algorithm in such cases. Let's check for this.
++ \*/
++ diff |= diff >> 16; /\* still zero iff exact match \*/
++ diff &= 0xffff; /\* ditto \*/
++ diff += 0xffff; /\* bit 16 set iff "diff" was non-zero (on non-match) \*/
++ sign <<= 9; /\* move the non-benign sign extension flag to bit 16 \*/
++ sign &= ~diff & safety; /\* action needed? \*/
++
++/\*
++ \* If we have determined that we need to deviate from the correct algorithm,
++ \* flip bit 16 in initial expanded key. (The choice of 16 is arbitrary, but
++ \* let's stick to it now. It came out of the approach we used above, and it's
++ \* not any worse than any other choice we could make.)
++ \*
++ \* It is crucial that we don't do the same to the expanded key used in the main
++ \* Eksblowfish loop. By doing it to only one of these two, we deviate from a
++ \* state that could be directly specified by a password to the buggy algorithm
++ \* (and to the fully correct one as well, but that's a side-effect).
++ \*/
++ initial[0] ^= sign;
+ }
+
+-char \*php\_crypt\_blowfish\_rn(\_\_CONST char \*key, \_\_CONST char \*setting,
+- char \*output, int size)
++static char \*BF\_crypt(const char \*key, const char \*setting,
++ char \*output, int size,
++ BF\_word min)
+ {
+ #if BF\_ASM
+ extern void \_BF\_body\_r(BF\_ctx \*ctx);
+ #endif
++ static const unsigned char flags\_by\_subtype[26] =
++ {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
++ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 4, 0};
+ struct {
+ BF\_ctx ctx;
+ BF\_key expanded\_key;
+@@ -602,7 +677,8 @@ char \*php\_crypt\_blowfish\_rn(\_\_CONST char
+
+ if (setting[0] != '$' ||
+ setting[1] != '2' ||
+- setting[2] != 'a' ||
++ setting[2] < 'a' || setting[2] > 'z' ||
++ !flags\_by\_subtype[(unsigned int)(unsigned char)setting[2] - 'a'] ||
+ setting[3] != '$' ||
+ setting[4] < '0' || setting[4] > '3' ||
+ setting[5] < '0' || setting[5] > '9' ||
+@@ -613,15 +689,14 @@ char \*php\_crypt\_blowfish\_rn(\_\_CONST char
+ }
+
+ count = (BF\_word)1 << ((setting[4] - '0') \* 10 + (setting[5] - '0'));
+- if (count < 16 || BF\_decode(data.binary.salt, &setting[7], 16)) {
+- clean(data.binary.salt, sizeof(data.binary.salt));
++ if (count < min || BF\_decode(data.binary.salt, &setting[7], 16)) {
+ \_\_set\_errno(EINVAL);
+ return NULL;
+ }
+-
+ BF\_swap(data.binary.salt, 4);
+
+- BF\_set\_key(key, data.expanded\_key, data.ctx.P);
++ BF\_set\_key(key, data.expanded\_key, data.ctx.P,
++ flags\_by\_subtype[(unsigned int)(unsigned char)setting[2] - 'a']);
+
+ memcpy(data.ctx.S, BF\_init\_state.S, sizeof(data.ctx.S));
+
+@@ -651,51 +726,33 @@ char \*php\_crypt\_blowfish\_rn(\_\_CONST char
+ } while (ptr < &data.ctx.S[3][0xFF]);
+
+ do {
+- data.ctx.P[0] ^= data.expanded\_key[0];
+- data.ctx.P[1] ^= data.expanded\_key[1];
+- data.ctx.P[2] ^= data.expanded\_key[2];
+- data.ctx.P[3] ^= data.expanded\_key[3];
+- data.ctx.P[4] ^= data.expanded\_key[4];
+- data.ctx.P[5] ^= data.expanded\_key[5];
+- data.ctx.P[6] ^= data.expanded\_key[6];
+- data.ctx.P[7] ^= data.expanded\_key[7];
+- data.ctx.P[8] ^= data.expanded\_key[8];
+- data.ctx.P[9] ^= data.expanded\_key[9];
+- data.ctx.P[10] ^= data.expanded\_key[10];
+- data.ctx.P[11] ^= data.expanded\_key[11];
+- data.ctx.P[12] ^= data.expanded\_key[12];
+- data.ctx.P[13] ^= data.expanded\_key[13];
+- data.ctx.P[14] ^= data.expanded\_key[14];
+- data.ctx.P[15] ^= data.expanded\_key[15];
+- data.ctx.P[16] ^= data.expanded\_key[16];
+- data.ctx.P[17] ^= data.expanded\_key[17];
+-
+- BF\_body();
+-
+- tmp1 = data.binary.salt[0];
+- tmp2 = data.binary.salt[1];
+- tmp3 = data.binary.salt[2];
+- tmp4 = data.binary.salt[3];
+- data.ctx.P[0] ^= tmp1;
+- data.ctx.P[1] ^= tmp2;
+- data.ctx.P[2] ^= tmp3;
+- data.ctx.P[3] ^= tmp4;
+- data.ctx.P[4] ^= tmp1;
+- data.ctx.P[5] ^= tmp2;
+- data.ctx.P[6] ^= tmp3;
+- data.ctx.P[7] ^= tmp4;
+- data.ctx.P[8] ^= tmp1;
+- data.ctx.P[9] ^= tmp2;
+- data.ctx.P[10] ^= tmp3;
+- data.ctx.P[11] ^= tmp4;
+- data.ctx.P[12] ^= tmp1;
+- data.ctx.P[13] ^= tmp2;
+- data.ctx.P[14] ^= tmp3;
+- data.ctx.P[15] ^= tmp4;
+- data.ctx.P[16] ^= tmp1;
+- data.ctx.P[17] ^= tmp2;
++ int done;
+
+- BF\_body();
++ for (i = 0; i < BF\_N + 2; i += 2) {
++ data.ctx.P[i] ^= data.expanded\_key[i];
++ data.ctx.P[i + 1] ^= data.expanded\_key[i + 1];
++ }
++
++ done = 0;
++ do {
++ BF\_body();
++ if (done)
++ break;
++ done = 1;
++
++ tmp1 = data.binary.salt[0];
++ tmp2 = data.binary.salt[1];
++ tmp3 = data.binary.salt[2];
++ tmp4 = data.binary.salt[3];
++ for (i = 0; i < BF\_N; i += 4) {
++ data.ctx.P[i] ^= tmp1;
++ data.ctx.P[i + 1] ^= tmp2;
++ data.ctx.P[i + 2] ^= tmp3;
++ data.ctx.P[i + 3] ^= tmp4;
++ }
++ data.ctx.P[16] ^= tmp1;
++ data.ctx.P[17] ^= tmp2;
++ } while (1);
+ } while (--count);
+
+ for (i = 0; i < 6; i += 2) {
+@@ -721,19 +778,114 @@ char \*php\_crypt\_blowfish\_rn(\_\_CONST char
+ BF\_encode(&output[7 + 22], data.binary.output, 23);
+ output[7 + 22 + 31] = '\0';
+
+-/\* Overwrite the most obvious sensitive data we have on the stack. Note
+- \* that this does not guarantee there's no sensitive data left on the
+- \* stack and/or in registers; I'm not aware of portable code that does. \*/
+- clean(&data, sizeof(data));
+-
+ return output;
+ }
+
+-char \*php\_crypt\_gensalt\_blowfish\_rn(unsigned long count,
+- \_\_CONST char \*input, int size, char \*output, int output\_size)
++static int \_crypt\_output\_magic(const char \*setting, char \*output, int size)
++{
++ if (size < 3)
++ return -1;
++
++ output[0] = '\*';
++ output[1] = '0';
++ output[2] = '\0';
++
++ if (setting[0] == '\*' && setting[1] == '0')
++ output[1] = '1';
++
++ return 0;
++}
++
++/\*
++ \* Please preserve the runtime self-test. It serves two purposes at once:
++ \*
++ \* 1. We really can't afford the risk of producing incompatible hashes e.g.
++ \* when there's something like gcc bug 26587 again, whereas an application or
++ \* library integrating this code might not also integrate our external tests or
++ \* it might not run them after every build. Even if it does, the miscompile
++ \* might only occur on the production build, but not on a testing build (such
++ \* as because of different optimization settings). It is painful to recover
++ \* from incorrectly-computed hashes - merely fixing whatever broke is not
++ \* enough. Thus, a proactive measure like this self-test is needed.
++ \*
++ \* 2. We don't want to leave sensitive data from our actual password hash
++ \* computation on the stack or in registers. Previous revisions of the code
++ \* would do explicit cleanups, but simply running the self-test after hash
++ \* computation is more reliable.
++ \*
++ \* The performance cost of this quick self-test is around 0.6% at the "$2a$08"
++ \* setting.
++ \*/
++char \*php\_crypt\_blowfish\_rn(const char \*key, const char \*setting,
++ char \*output, int size)
++{
++ const char \*test\_key = "8b \xd0\xc1\xd2\xcf\xcc\xd8";
++ const char \*test\_setting = "$2a$00$abcdefghijklmnopqrstuu";
++ static const char \* const test\_hash[2] =
++ {"VUrPmXD6q/nVSSp7pNDhCR9071IfIRe\0\x55", /\* $2x$ \*/
++ "i1D709vfamulimlGcq0qq3UvuUasvEa\0\x55"}; /\* $2a$, $2y$ \*/
++ char \*retval;
++ const char \*p;
++ int save\_errno, ok;
++ struct {
++ char s[7 + 22 + 1];
++ char o[7 + 22 + 31 + 1 + 1 + 1];
++ } buf;
++
++/\* Hash the supplied password \*/
++ \_crypt\_output\_magic(setting, output, size);
++ retval = BF\_crypt(key, setting, output, size, 16);
++ save\_errno = errno;
++
++/\*
++ \* Do a quick self-test. It is important that we make both calls to BF\_crypt()
++ \* from the same scope such that they likely use the same stack locations,
++ \* which makes the second call overwrite the first call's sensitive data on the
++ \* stack and makes it more likely that any alignment related issues would be
++ \* detected by the self-test.
++ \*/
++ memcpy(buf.s, test\_setting, sizeof(buf.s));
++ if (retval)
++ buf.s[2] = setting[2];
++ memset(buf.o, 0x55, sizeof(buf.o));
++ buf.o[sizeof(buf.o) - 1] = 0;
++ p = BF\_crypt(test\_key, buf.s, buf.o, sizeof(buf.o) - (1 + 1), 1);
++
++ ok = (p == buf.o &&
++ !memcmp(p, buf.s, 7 + 22) &&
++ !memcmp(p + (7 + 22),
++ test\_hash[(unsigned int)(unsigned char)buf.s[2] & 1],
++ 31 + 1 + 1 + 1));
++
++ {
++ const char \*k = "\xff\xa3" "34" "\xff\xff\xff\xa3" "345";
++ BF\_key ae, ai, ye, yi;
++ BF\_set\_key(k, ae, ai, 2); /\* $2a$ \*/
++ BF\_set\_key(k, ye, yi, 4); /\* $2y$ \*/
++ ai[0] ^= 0x10000; /\* undo the safety (for comparison) \*/
++ ok = ok && ai[0] == 0xdb9c59bc && ye[17] == 0x33343500 &&
++ !memcmp(ae, ye, sizeof(ae)) &&
++ !memcmp(ai, yi, sizeof(ai));
++ }
++
++ \_\_set\_errno(save\_errno);
++ if (ok)
++ return retval;
++
++/\* Should not happen \*/
++ \_crypt\_output\_magic(setting, output, size);
++ \_\_set\_errno(EINVAL); /\* pretend we don't support this hash type \*/
++ return NULL;
++}
++
++#if 0
++char \*\_crypt\_gensalt\_blowfish\_rn(const char \*prefix, unsigned long count,
++ const char \*input, int size, char \*output, int output\_size)
+ {
+ if (size < 16 || output\_size < 7 + 22 + 1 ||
+- (count && (count < 4 || count > 31))) {
++ (count && (count < 4 || count > 31)) ||
++ prefix[0] != '$' || prefix[1] != '2' ||
++ (prefix[2] != 'a' && prefix[2] != 'y')) {
+ if (output\_size > 0) output[0] = '\0';
+ \_\_set\_errno((output\_size < 7 + 22 + 1) ? ERANGE : EINVAL);
+ return NULL;
+@@ -743,14 +895,15 @@ char \*php\_crypt\_gensalt\_blowfish\_rn(unsi
+
+ output[0] = '$';
+ output[1] = '2';
+- output[2] = 'a';
++ output[2] = prefix[2];
+ output[3] = '$';
+ output[4] = '0' + count / 10;
+ output[5] = '0' + count % 10;
+ output[6] = '$';
+
+- BF\_encode(&output[7], (BF\_word \*)input, 16);
++ BF\_encode(&output[7], (const BF\_word \*)input, 16);
+ output[7 + 22] = '\0';
+
+ return output;
+ }
++#endif
--- php5-5.3.2.orig/debian/patches/use\_embedded\_timezonedb\_fixes.patch
+++ php5-5.3.2/debian/patches/use\_embedded\_timezonedb\_fixes.patch
@@ -0,0 +1,64 @@
+Author: Sean Finney
+Forwarded: no (upstream doesn't want it)
+Description: Silence warnings about using the default system timezone info
+ In vanilla upstream php, this is considered an error (i.e. the user must
+ set the timezone explicitly), though with our use of the system timezonedb
+ patch, we actually feel quite comfortable using the default timezone info.
+Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=571762
+--- a/ext/date/php\_date.c
++++ b/ext/date/php\_date.c
+@@ -879,7 +879,7 @@ static char\* guess\_timezone(const timeli
+ tzid = "UTC";
+ }
+
+- php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, DATE\_TZ\_ERRMSG "We selected '%s' for '%s/%.1f/%s' instead", tzid, ta ? ta->tm\_zone : "Unknown", ta ? (float) (ta->tm\_gmtoff / 3600) : 0, ta ? (ta->tm\_isdst ? "DST" : "no DST") : "Unknown");
++ // php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, DATE\_TZ\_ERRMSG "We selected '%s' for '%s/%.1f/%s' instead", tzid, ta ? ta->tm\_zone : "Unknown", ta ? (float) (ta->tm\_gmtoff / 3600) : 0, ta ? (ta->tm\_isdst ? "DST" : "no DST") : "Unknown");
+ return tzid;
+ }
+ #endif
+--- a/ext/date/tests/date\_default\_timezone\_get-1.phpt
++++ /dev/null
+@@ -1,16 +0,0 @@
+---TEST--
+-date\_default\_timezone\_get() function [1]
+---INI--
+-date.timezone=
+---FILE--
+-php
+- putenv('TZ=');
+- echo date\_default\_timezone\_get(), "\n";
+- echo date('e'), "\n";
+-?
+---EXPECTF--
+-Warning: date\_default\_timezone\_get(): It is not safe to rely on the system's timezone settings. You are \*required\* to use the date.timezone setting or the date\_default\_timezone\_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'UTC' for 'UTC/0.0/no DST' instead in %sdate\_default\_timezone\_get-1.php on line 3
+-UTC
+-
+-Warning: date(): It is not safe to rely on the system's timezone settings. You are \*required\* to use the date.timezone setting or the date\_default\_timezone\_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'UTC' for 'UTC/0.0/no DST' instead in %sdate\_default\_timezone\_get-1.php on line 4
+-UTC
+--- a/ext/date/tests/date\_default\_timezone\_get-2.phpt
++++ /dev/null
+@@ -1,12 +0,0 @@
+---TEST--
+-date\_default\_timezone\_get() function [2]
+---INI--
+-date.timezone=
+---FILE--
+-php
+- putenv('TZ=');
+- echo date\_default\_timezone\_get(), "\n";
+-?
+---EXPECTF--
+-Warning: date\_default\_timezone\_get(): It is not safe to rely on the system's timezone settings. You are \*required\* to use the date.timezone setting or the date\_default\_timezone\_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'UTC' for 'UTC/0.0/no DST' instead in %sdate\_default\_timezone\_get-2.php on line 3
+-UTC
+--- a/ext/date/tests/date\_default\_timezone\_set-1.phpt
++++ b/ext/date/tests/date\_default\_timezone\_set-1.phpt
+@@ -18,9 +18,6 @@ date.timezone=
+ echo date(DATE\_ISO8601, $date4), "\n";
+ ?>
+ --EXPECTF--
+-Warning: strtotime(): It is not safe to rely on the system's timezone settings. You are \*required\* to use the date.timezone setting or the date\_default\_timezone\_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'UTC' for 'UTC/0.0/no DST' instead in %sdate\_default\_timezone\_set-1.php on line 3
+-
+-Warning: strtotime(): It is not safe to rely on the system's timezone settings. You are \*required\* to use the date.timezone setting or the date\_default\_timezone\_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'UTC' for 'UTC/0.0/no DST' instead in %sdate\_default\_timezone\_set-1.php on line 4
+ America/Indiana/Knox
+ 2005-01-12T03:00:00-0500
+ 2005-07-12T03:00:00-0500
--- php5-5.3.2.orig/debian/patches/unaligned\_memory\_access.patch
+++ php5-5.3.2/debian/patches/unaligned\_memory\_access.patch
@@ -0,0 +1,27 @@
+Description: Fix unaligned memory access.
+Origin: vendor
+Forwarded: http://bugs.php.net/50987
+Last-Update: 2010-02-09
+
+Index: php/ext/phar/phar.c
+===================================================================
+--- php.orig/ext/phar/phar.c
++++ php/ext/phar/phar.c
+@@ -512,7 +512,7 @@ void phar\_entry\_remove(phar\_entry\_data \*
+ (buffer) += 2
+ #else
+ # define PHAR\_GET\_32(buffer, var) \
+- var = \*(php\_uint32\*)(buffer); \
++ memcpy(&var, buffer, sizeof(var)); \
+ buffer += 4
+ # define PHAR\_GET\_16(buffer, var) \
+ var = \*(php\_uint16\*)(buffer); \
+@@ -2491,7 +2491,7 @@ static inline void phar\_set\_32(char \*buf
+ \*((buffer) + 1) = (unsigned char) (((var) >> 8) & 0xFF);
+ \*((buffer) + 0) = (unsigned char) ((var) & 0xFF);
+ #else
+- \*(php\_uint32 \*)(buffer) = (php\_uint32)(var);
++ memcpy(buffer, &var, sizeof(var));
+ #endif
+ } /\* }}} \*/
+
--- php5-5.3.2.orig/debian/patches/php.ini-compatibility.patch
+++ php5-5.3.2/debian/patches/php.ini-compatibility.patch
@@ -0,0 +1,28 @@
+Description: Change the default php.ini settings to be more compatible
+ with older releases.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-19
+
+Index: php/php.ini-production
+===================================================================
+--- php.orig/php.ini-production
++++ php/php.ini-production
+@@ -223,7 +223,7 @@ engine = On
+ ; Development Value: Off
+ ; Production Value: Off
+ ; http://php.net/short-open-tag
+-short\_open\_tag = Off
++short\_open\_tag = On
+
+ ; Allow ASP-style <% %> tags.
+ ; http://php.net/asp-tags
+@@ -679,7 +679,7 @@ variables\_order = "GPCS"
+ ; Development Value: "GP"
+ ; Production Value: "GP"
+ ; http://php.net/request-order
+-request\_order = "GP"
++request\_order = "GPC"
+
+ ; Whether or not to register the EGPCS variables as global variables. You may
+ ; want to turn this off if you don't want to clutter your scripts' global scope
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-4153.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-4153.patch
@@ -0,0 +1,102 @@
+Origin: http://svn.php.net/viewvc?view=revision&revision=319457
+ and http://svn.php.net/viewvc?view=revision&revision=319442
+ and http://svn.php.net/viewvc?view=revision&revision=314527
+Subject: fixes for bug #55748 (fail to check zend\_strndup for failures)
+
+fixes for bug #55748
+Sync to 5.3 and check additional cases for #55748
+Fix typo
+
+CVE-2011-4153
+
+---
+ Zend/zend\_builtin\_functions.c | 3 +++
+ ext/com\_dotnet/com\_typeinfo.c | 4 ++++
+ ext/oci8/oci8.c | 17 ++++++++++++++++-
+ ext/standard/syslog.c | 3 +++
+ 4 files changed, 26 insertions(+), 1 deletion(-)
+
+Index: b/ext/oci8/oci8.c
+===================================================================
+--- a/ext/oci8/oci8.c
++++ b/ext/oci8/oci8.c
+@@ -2003,7 +2003,14 @@ php\_oci\_connection \*php\_oci\_do\_connect\_e
+ connection->is\_persistent = 0;
+ } else {
+ connection = (php\_oci\_connection \*) calloc(1, sizeof(php\_oci\_connection));
++ if (connection == NULL) {
++ return NULL;
++ }
+ connection->hash\_key = zend\_strndup(hashed\_details.c, hashed\_details.len);
++ if (connection->hash\_key == NULL) {
++ free(connection);
++ return NULL;
++ }
+ connection->is\_persistent = 1;
+ }
+ } else {
+@@ -2617,12 +2624,20 @@ static php\_oci\_spool \*php\_oci\_create\_spo
+ ub4 poolmode = OCI\_DEFAULT; /\* Mode to be passed to OCISessionPoolCreate \*/
+ OCIAuthInfo \*spoolAuth = NULL;
+
+- /\*Allocate sessionpool out of persistent memory \*/
++ /\* Allocate sessionpool out of persistent memory \*/
+ session\_pool = (php\_oci\_spool \*) calloc(1, sizeof(php\_oci\_spool));
++ if (session\_pool == NULL) {
++ iserror = 1;
++ goto exit\_create\_spool;
++ }
+
+ /\* Populate key if passed \*/
+ if (hash\_key\_len) {
+ session\_pool->spool\_hash\_key = zend\_strndup(hash\_key, hash\_key\_len);
++ if (session\_pool->spool\_hash\_key == NULL) {
++ iserror = 1;
++ goto exit\_create\_spool;
++ }
+ }
+
+ /\* Create the session pool's env \*/
+Index: b/ext/standard/syslog.c
+===================================================================
+--- a/ext/standard/syslog.c
++++ b/ext/standard/syslog.c
+@@ -236,6 +236,9 @@ PHP\_FUNCTION(openlog)
+ free(BG(syslog\_device));
+ }
+ BG(syslog\_device) = zend\_strndup(ident, ident\_len);
++ if(BG(syslog\_device) == NULL) {
++ RETURN\_FALSE;
++ }
+ openlog(BG(syslog\_device), option, facility);
+ RETURN\_TRUE;
+ }
+Index: b/ext/com\_dotnet/com\_typeinfo.c
+===================================================================
+--- a/ext/com\_dotnet/com\_typeinfo.c
++++ b/ext/com\_dotnet/com\_typeinfo.c
+@@ -187,6 +187,10 @@ PHPAPI int php\_com\_import\_typelib(ITypeL
+ const\_name = php\_com\_olestring\_to\_string(bstr\_ids, &c.name\_len, codepage TSRMLS\_CC);
+ c.name = zend\_strndup(const\_name, c.name\_len);
+ efree(const\_name);
++ if(c.name == NULL) {
++ ITypeInfo\_ReleaseVarDesc(TypeInfo, pVarDesc);
++ continue;
++ }
+ c.name\_len++; /\* include NUL \*/
+ SysFreeString(bstr\_ids);
+
+Index: b/Zend/zend\_builtin\_functions.c
+===================================================================
+--- a/Zend/zend\_builtin\_functions.c
++++ b/Zend/zend\_builtin\_functions.c
+@@ -683,6 +683,9 @@ repeat:
+ }
+ c.flags = case\_sensitive; /\* non persistent \*/
+ c.name = zend\_strndup(name, name\_len);
++ if(c.name == NULL) {
++ RETURN\_FALSE;
++ }
+ c.name\_len = name\_len+1;
+ c.module\_number = PHP\_USER\_CONSTANT;
+ if (zend\_register\_constant(&c TSRMLS\_CC) == SUCCESS) {
--- php5-5.3.2.orig/debian/patches/034-apache2\_umask\_fix.patch
+++ php5-5.3.2/debian/patches/034-apache2\_umask\_fix.patch
@@ -0,0 +1,50 @@
+Description: Save and restore umask across requests correctly.
+ .
+ Check if this is still an issue not addressed by upstream in some
+ other way already.
+Origin: other
+Bug-Debian: http://bugs.debian.org/286225
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/sapi/apache2handler/sapi\_apache2.c
++++ b/sapi/apache2handler/sapi\_apache2.c
+@@ -455,6 +455,19 @@ static apr\_status\_t php\_server\_context\_c
+ return APR\_SUCCESS;
+ }
+
++static int saved\_umask;
++
++static void php\_save\_umask(void)
++{
++ saved\_umask = umask(077);
++ umask(saved\_umask);
++}
++
++static void php\_restore\_umask(void)
++{
++ umask(saved\_umask);
++}
++
+ static int php\_apache\_request\_ctor(request\_rec \*r, php\_struct \*ctx TSRMLS\_DC)
+ {
+ char \*content\_length;
+@@ -646,6 +659,8 @@ zend\_first\_try {
+ } else {
+ zend\_file\_handle zfd;
+
++ php\_save\_umask();
++
+ zfd.type = ZEND\_HANDLE\_FILENAME;
+ zfd.filename = (char \*) r->filename;
+ zfd.free\_filename = 0;
+@@ -657,6 +672,9 @@ zend\_first\_try {
+ zend\_execute\_scripts(ZEND\_INCLUDE TSRMLS\_CC, NULL, 1, &zfd);
+ }
+
++ php\_restore\_umask();
++
++
+ apr\_table\_set(r->notes, "mod\_php\_memory\_usage",
+ apr\_psprintf(ctx->r->pool, "%u", zend\_memory\_peak\_usage(1 TSRMLS\_CC)));
+ }
--- php5-5.3.2.orig/debian/patches/053-extension\_api.patch
+++ php5-5.3.2/debian/patches/053-extension\_api.patch
@@ -0,0 +1,59 @@
+Description: Adds --phpapi argument to php-config(1)
+ .
+ TODO: make it more generic and add it to the man page.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/configure.in
++++ b/configure.in
+@@ -1114,8 +1114,13 @@ dnl Build extension directory path
+
+ ZEND\_MODULE\_API\_NO=`$EGREP '#define ZEND\_MODULE\_API\_NO ' $srcdir/Zend/zend\_modules.h|$SED 's/#define ZEND\_MODULE\_API\_NO //'`
+
++DEBIAN\_PHP\_API=`egrep -h '^#define ZEND\_EXTENSION\_API\_NO|^#define ZEND\_MODULE\_API\_NO|#define PHP\_API\_VERSION' $srcdir/Zend/zend\_extensions.h $srcdir/Zend/zend\_modules.h $srcdir/main/php.h | awk '{print $3}' | sed -e 's/^2200/200/' | sort -n | tail -n 1`
++if echo "$CPPFLAGS $CFLAGS" | grep -q -- -D\_FILE\_OFFSET\_BITS=64; then
++ DEBIAN\_PHP\_API="${DEBIAN\_PHP\_API}+lfs"
++fi
++
+ if test -z "$EXTENSION\_DIR"; then
+- extbasedir=$ZEND\_MODULE\_API\_NO
++ extbasedir=$DEBIAN\_PHP\_API
+ if test "$oldstyleextdir" = "yes"; then
+ if test "$PHP\_DEBUG" = "1"; then
+ part1=debug
+@@ -1265,6 +1270,7 @@ PHP\_SUBST(CXX)
+ PHP\_SUBST(CXXFLAGS)
+ PHP\_SUBST(CXXFLAGS\_CLEAN)
+ PHP\_SUBST\_OLD(DEBUG\_CFLAGS)
++PHP\_SUBST\_OLD(DEBIAN\_PHP\_API)
+ PHP\_SUBST\_OLD(EXTENSION\_DIR)
+ PHP\_SUBST\_OLD(EXTRA\_LDFLAGS)
+ PHP\_SUBST\_OLD(EXTRA\_LDFLAGS\_PROGRAM)
+--- a/scripts/php-config.in
++++ b/scripts/php-config.in
+@@ -17,6 +17,7 @@ php\_cli\_binary=NONE
+ php\_cgi\_binary=NONE
+ configure\_options="@CONFIGURE\_OPTIONS@"
+ php\_sapis="@PHP\_INSTALLED\_SAPIS@"
++phpapi="@DEBIAN\_PHP\_API@"
+
+ # Set php\_cli\_binary and php\_cgi\_binary if available
+ for sapi in $php\_sapis; do
+@@ -55,6 +56,8 @@ case "$1" in
+ echo $include\_dir;;
+ --php-binary)
+ echo $php\_binary;;
++--phpapi)
++ echo $phpapi;;
+ --php-sapis)
+ echo $php\_sapis;;
+ --configure-options)
+@@ -75,6 +78,7 @@ Options:
+ --include-dir [$include\_dir]
+ --php-binary [$php\_binary]
+ --php-sapis [$php\_sapis]
++ --phpapi [$phpapi]
+ --configure-options [$configure\_options]
+ --version [$version]
+ --vernum [$vernum]
--- php5-5.3.2.orig/debian/patches/CVE-2010-3065.patch
+++ php5-5.3.2/debian/patches/CVE-2010-3065.patch
@@ -0,0 +1,16 @@
+Description: fix arbitrary session variable modification via crafted
+ session variable name
+Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=298608
+
+diff -Nur php5-5.3.2/ext/session/session.c php5-5.3.2.new/ext/session/session.c
+--- php5-5.3.2/ext/session/session.c 2010-09-14 11:01:08.000000000 -0400
++++ php5-5.3.2.new/ext/session/session.c 2010-09-14 11:01:15.000000000 -0400
+@@ -895,7 +895,7 @@
+
+ PS\_ENCODE\_LOOP(
+ smart\_str\_appendl(&buf, key, key\_length);
+- if (memchr(key, PS\_DELIMITER, key\_length)) {
++ if (memchr(key, PS\_DELIMITER, key\_length) || memchr(key, PS\_UNDEF\_MARKER, key\_length)) {
+ PHP\_VAR\_SERIALIZE\_DESTROY(var\_hash);
+ smart\_str\_free(&buf);
+ return FAILURE;
--- php5-5.3.2.orig/debian/patches/047-zts\_with\_dl.patch
+++ php5-5.3.2/debian/patches/047-zts\_with\_dl.patch
@@ -0,0 +1,15 @@
+--- pkg-php.orig/ext/standard/dl.c
++++ pkg-php/ext/standard/dl.c
+@@ -77,12 +77,7 @@ PHPAPI PHP\_FUNCTION(dl)
+ (strcmp(sapi\_module.name, "cli") != 0) &&
+ (strncmp(sapi\_module.name, "embed", 5) != 0)
+ ) {
+-#ifdef ZTS
+- php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Not supported in multithreaded Web servers - use extension=%s in your php.ini", filename);
+- RETURN\_FALSE;
+-#else
+ php\_error\_docref(NULL TSRMLS\_CC, E\_DEPRECATED, "dl() is deprecated - use extension=%s in your php.ini", filename);
+-#endif
+ }
+
+ php\_dl(filename, MODULE\_TEMPORARY, return\_value, 0 TSRMLS\_CC);
--- php5-5.3.2.orig/debian/patches/114-php\_gd\_segfault.patch
+++ php5-5.3.2/debian/patches/114-php\_gd\_segfault.patch
@@ -0,0 +1,22 @@
+--- pkg-php.orig/ext/gd/libgd/gd\_compat.c
++++ pkg-php/ext/gd/libgd/gd\_compat.c
+@@ -14,7 +14,7 @@ int gdJpegGetVersionInt()
+ return JPEG\_LIB\_VERSION;
+ }
+
+-int gdJpegGetVersionString()
++const char \* gdJpegGetVersionString()
+ {
+ switch(JPEG\_LIB\_VERSION) {
+ case 62:
+--- pkg-php.orig/ext/gd/libgd/gd\_compat.h
++++ pkg-php/ext/gd/libgd/gd\_compat.h
+@@ -8,7 +8,7 @@
+ #endif
+
+ const char \* gdPngGetVersionString();
+-int gdJpegGetVersionString();
++const char \* gdJpegGetVersionString();
+ int gdJpegGetVersionInt();
+ int overflow2(int a, int b);
+
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-3182.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-3182.patch
@@ -0,0 +1,216 @@
+Subject: check the return values of the malloc, calloc, and realloc
+ library functions
+Origin: upstream commits r313782, r313826, r313827, r313828, r313830,
+ r313831, r313832, r313833, r313835, r313903
+Bug-upstream: http://svn.php.net/viewvc?view=revision&revision=313903
+
+r313782 | pajoye | 2011-07-27 07:23:06 -0700 (Wed, 27 Jul 2011) | 1 line
+- Fix #55295, check if malloc failed
+r313826 | pajoye | 2011-07-28 03:31:34 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (curl part) check if malloc succeded
+r313827 | pajoye | 2011-07-28 03:34:16 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (com\_dotnet part) check if malloc succeded
+r313828 | pajoye | 2011-07-28 03:37:04 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (pdo\_odbc part) check if malloc succeded
+r313830 | pajoye | 2011-07-28 03:39:19 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (interbase part) check if malloc succeded
+r313831 | pajoye | 2011-07-28 03:42:45 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (readline part) check if malloc succeded
+r313832 | pajoye | 2011-07-28 03:52:45 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (url scanner part) check if malloc succeded
+r313833 | pajoye | 2011-07-28 03:57:31 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (sybase part) check if malloc succeded
+r313835 | pajoye | 2011-07-28 04:01:04 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (mssql part) check if malloc succeded
+r313903 | pajoye | 2011-07-28 14:16:51 -0700 (Thu, 28 Jul 2011) | 1 line
+- Fix #55301 (sybase part, take #2) check if malloc succeded
+
+CVE-2011-3182
+
+---
+ TSRM/tsrm\_win32.c | 4 ++++
+ ext/com\_dotnet/com\_dotnet.c | 3 +++
+ ext/curl/interface.c | 3 +++
+ ext/interbase/interbase.c | 7 +++++--
+ ext/mssql/php\_mssql.c | 7 +++++++
+ ext/pdo\_odbc/pdo\_odbc.c | 3 +++
+ ext/readline/readline.c | 8 +++++++-
+ ext/standard/url\_scanner\_ex.c | 7 +++++--
+ ext/standard/url\_scanner\_ex.re | 8 ++++++--
+ ext/sybase\_ct/php\_sybase\_ct.c | 4 ++++
+ 10 files changed, 47 insertions(+), 7 deletions(-)
+
+Index: b/TSRM/tsrm\_win32.c
+===================================================================
+--- a/TSRM/tsrm\_win32.c
++++ b/TSRM/tsrm\_win32.c
+@@ -532,6 +532,10 @@ TSRM\_API FILE \*popen\_ex(const char \*comm
+ }
+
+ cmd = (char\*)malloc(strlen(command)+strlen(TWG(comspec))+sizeof(" /c ")+2);
++ if (!cmd) {
++ return NULL;
++ }
++
+ sprintf(cmd, "%s /c \"%s\"", TWG(comspec), command);
+ if (asuser) {
+ res = CreateProcessAsUser(token\_user, NULL, cmd, &security, &security, security.bInheritHandle, dwCreateFlags, env, cwd, &startup, &process);
+Index: b/ext/curl/interface.c
+===================================================================
+--- a/ext/curl/interface.c
++++ b/ext/curl/interface.c
+@@ -803,6 +803,9 @@ PHP\_MINIT\_FUNCTION(curl)
+ int i, c = CRYPTO\_num\_locks();
+
+ php\_curl\_openssl\_tsl = malloc(c \* sizeof(MUTEX\_T));
++ if (!php\_curl\_openssl\_tsl) {
++ return FAILURE;
++ }
+
+ for (i = 0; i < c; ++i) {
+ php\_curl\_openssl\_tsl[i] = tsrm\_mutex\_alloc();
+Index: b/ext/com\_dotnet/com\_dotnet.c
+===================================================================
+--- a/ext/com\_dotnet/com\_dotnet.c
++++ b/ext/com\_dotnet/com\_dotnet.c
+@@ -129,6 +129,9 @@ static HRESULT dotnet\_init(char \*\*p\_wher
+ char \*where = "";
+
+ stuff = malloc(sizeof(\*stuff));
++ if (!stuff) {
++ return S\_FALSE;
++ }
+ memset(stuff, 0, sizeof(\*stuff));
+
+ where = "CoCreateInstance";
+Index: b/ext/pdo\_odbc/pdo\_odbc.c
+===================================================================
+--- a/ext/pdo\_odbc/pdo\_odbc.c
++++ b/ext/pdo\_odbc/pdo\_odbc.c
+@@ -98,6 +98,9 @@ PHP\_MINIT\_FUNCTION(pdo\_odbc)
+ char \*instance = INI\_STR("pdo\_odbc.db2\_instance\_name");
+ if (instance) {
+ char \*env = malloc(sizeof("DB2INSTANCE=") + strlen(instance));
++ if (!env) {
++ return FAILURE;
++ }
+ strcpy(env, "DB2INSTANCE=");
+ strcat(env, instance);
+ putenv(env);
+Index: b/ext/interbase/interbase.c
+===================================================================
+--- a/ext/interbase/interbase.c
++++ b/ext/interbase/interbase.c
+@@ -998,9 +998,12 @@ static void \_php\_ibase\_connect(INTERNAL\_
+ ZEND\_REGISTER\_RESOURCE(return\_value, ib\_link, le\_link);
+ } else {
+ zend\_rsrc\_list\_entry new\_le;
+-
++
+ ib\_link = (ibase\_db\_link \*) malloc(sizeof(ibase\_db\_link));
+-
++ if (!ib\_link) {
++ RETURN\_FALSE;
++ }
++
+ /\* hash it up \*/
+ Z\_TYPE(new\_le) = le\_plink;
+ new\_le.ptr = ib\_link;
+Index: b/ext/readline/readline.c
+===================================================================
+--- a/ext/readline/readline.c
++++ b/ext/readline/readline.c
+@@ -465,6 +465,9 @@ static char \*\*\_readline\_completion\_cb(co
+ matches = rl\_completion\_matches(text,\_readline\_command\_generator);
+ } else {
+ matches = malloc(sizeof(char \*) \* 2);
++ if (!matches) {
++ return NULL;
++ }
+ matches[0] = strdup("");
+ matches[1] = '\0';
+ }
+@@ -505,7 +508,10 @@ PHP\_FUNCTION(readline\_completion\_functio
+ zval\_copy\_ctor(\_readline\_completion);
+
+ rl\_attempted\_completion\_function = \_readline\_completion\_cb;
+-
++ if (rl\_attempted\_completion\_function == NULL) {
++ efree(name);
++ RETURN\_FALSE;
++ }
+ RETURN\_TRUE;
+ }
+
+Index: b/ext/standard/url\_scanner\_ex.re
+===================================================================
+--- a/ext/standard/url\_scanner\_ex.re
++++ b/ext/standard/url\_scanner\_ex.re
+@@ -55,9 +55,13 @@ static PHP\_INI\_MH(OnUpdateTags)
+
+ if (ctx->tags)
+ zend\_hash\_destroy(ctx->tags);
+- else
++ else {
+ ctx->tags = malloc(sizeof(HashTable));
+-
++ if (!ctx->tags) {
++ return FAILURE;
++ }
++ }
++
+ zend\_hash\_init(ctx->tags, 0, NULL, NULL, 1);
+
+ for (key = php\_strtok\_r(tmp, ",", &lasts);
+Index: b/ext/standard/url\_scanner\_ex.c
+===================================================================
+--- a/ext/standard/url\_scanner\_ex.c
++++ b/ext/standard/url\_scanner\_ex.c
+@@ -56,9 +56,12 @@ static PHP\_INI\_MH(OnUpdateTags)
+
+ if (ctx->tags)
+ zend\_hash\_destroy(ctx->tags);
+- else
++ else {
+ ctx->tags = malloc(sizeof(HashTable));
+-
++ if (!ctx->tags) {
++ return FAILURE;
++ }
++ }
+ zend\_hash\_init(ctx->tags, 0, NULL, NULL, 1);
+
+ for (key = php\_strtok\_r(tmp, ",", &lasts);
+Index: b/ext/sybase\_ct/php\_sybase\_ct.c
+===================================================================
+--- a/ext/sybase\_ct/php\_sybase\_ct.c
++++ b/ext/sybase\_ct/php\_sybase\_ct.c
+@@ -777,6 +777,10 @@ static void php\_sybase\_do\_connect(INTERN
+ }
+
+ sybase\_ptr = (sybase\_link \*) malloc(sizeof(sybase\_link));
++ if (!sybase\_ptr) {
++ efree(hashed\_details);
++ RETURN\_FALSE;
++ }
+ if (!php\_sybase\_do\_connect\_internal(sybase\_ptr, host, user, passwd, charset, appname TSRMLS\_CC)) {
+ free(sybase\_ptr);
+ efree(hashed\_details);
+Index: b/ext/mssql/php\_mssql.c
+===================================================================
+--- a/ext/mssql/php\_mssql.c
++++ b/ext/mssql/php\_mssql.c
+@@ -717,6 +717,13 @@ static void php\_mssql\_do\_connect(INTERNA
+
+ /\* hash it up \*/
+ mssql\_ptr = (mssql\_link \*) malloc(sizeof(mssql\_link));
++ if (!mssql\_ptr) {
++ efree(hashed\_details);
++ dbfreelogin(mssql.login);
++ dbclose(mssql.link);
++ RETURN\_FALSE;
++ }
++
+ memcpy(mssql\_ptr, &mssql, sizeof(mssql\_link));
+ Z\_TYPE(new\_le) = le\_plink;
+ new\_le.ptr = mssql\_ptr;
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1467.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1467.patch
@@ -0,0 +1,59 @@
+Subject: Fixed bug #53512 (NumberFormatter::setSymbol crash on bogus $attr values)
+Origin: http://svn.php.net/viewvc?view=revision&revision=306154
+
+CVE-2011-1467
+
+Also includes http://svn.php.net/viewvc?view=revision&revision=306157
+
+ - Added test for bug #53512
+
+Patch differs from commits in that the NEWS file addition has been
+removed to reduce patch conflicts.
+
+Index: ext/intl/tests/bug53512.phpt
+===================================================================
+--- ext/intl/tests/bug53512.phpt (revision 0)
++++ ext/intl/tests/bug53512.phpt (revision 306157)
+@@ -0,0 +1,25 @@
++--TEST--
++Bug #53512 (NumberFormatter::setSymbol crash on bogus $attr values)
++--SKIPIF--
++php if( !extension\_loaded( 'intl' ) ) print 'skip'; ?
++--FILE--
++php
++
++$badvals = array(4294901761, 2147483648, -2147483648, -1);
++
++foreach ($badvals as $val) {
++ $x = numfmt\_create("en", NumberFormatter::PATTERN\_DECIMAL);
++ var\_dump(numfmt\_set\_symbol($x, $val, ""));
++ var\_dump(intl\_get\_error\_message());
++}
++
++?
++--EXPECTF--
++bool(false)
++string(65) "numfmt\_set\_symbol: invalid symbol value: U\_ILLEGAL\_ARGUMENT\_ERROR"
++bool(false)
++string(65) "numfmt\_set\_symbol: invalid symbol value: U\_ILLEGAL\_ARGUMENT\_ERROR"
++bool(false)
++string(65) "numfmt\_set\_symbol: invalid symbol value: U\_ILLEGAL\_ARGUMENT\_ERROR"
++bool(false)
++string(65) "numfmt\_set\_symbol: invalid symbol value: U\_ILLEGAL\_ARGUMENT\_ERROR"
+
+Index: ext/intl/formatter/formatter\_attr.c
+===================================================================
+--- ext/intl/formatter/formatter\_attr.c (revision 306153)
++++ ext/intl/formatter/formatter\_attr.c (revision 306157)
+@@ -311,6 +311,11 @@
+
+ RETURN\_FALSE;
+ }
++
++ if (symbol >= UNUM\_FORMAT\_SYMBOL\_COUNT || symbol < 0) {
++ intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR, "numfmt\_set\_symbol: invalid symbol value", 0 TSRMLS\_CC );
++ RETURN\_FALSE;
++ }
+
+ /\* Fetch the object. \*/
+ FORMATTER\_METHOD\_FETCH\_OBJECT;
--- php5-5.3.2.orig/debian/patches/page\_size\_fixes.patch
+++ php5-5.3.2/debian/patches/page\_size\_fixes.patch
@@ -0,0 +1,104 @@
+Description: Don't assume value of PAGE\_SIZE if sys/mman.h does not
+ define it. Instead, use sysconf() at runtime if available.
+Origin: vendor
+Bug: http://bugs.php.net/bug.php?id=50982
+Last-Update: 2010-02-17
+
+--- a/Zend/zend\_stream.c
++++ b/Zend/zend\_stream.c
+@@ -27,10 +27,15 @@
+
+ #include
+ #include
+-#if HAVE\_SYS\_MMAN\_H
+-# include
+-# ifndef PAGE\_SIZE
+-# define PAGE\_SIZE 4096
++#if HAVE\_UNISTD\_H
++# include
++#endif
++#if !HAVE\_UNISTD\_H || (!defined(\_SC\_PAGESIZE) && !defined(\_SC\_PAGE\_SIZE))
++# if HAVE\_SYS\_MMAN\_H
++# include
++# ifndef PAGE\_SIZE
++# define PAGE\_SIZE 4096
++# endif
+ # endif
+ #endif
+
+@@ -215,9 +220,21 @@ ZEND\_API int zend\_stream\_fixup(zend\_file
+
+ if (old\_type == ZEND\_HANDLE\_FP && !file\_handle->handle.stream.isatty && size) {
+ #if HAVE\_MMAP
++ long page\_size = 0;
++
++# if HAVE\_UNISTD\_H
++# ifdef \_SC\_PAGESIZE
++ page\_size = sysconf(\_SC\_PAGESIZE);
++# else
++ page\_size = sysconf(\_SC\_PAGE\_SIZE);
++# endif
++# else
++ page\_size = PAGE\_SIZE;
++# endif
++
+ if (file\_handle->handle.fp &&
+ size != 0 &&
+- ((size - 1) % PAGE\_SIZE) <= PAGE\_SIZE - ZEND\_MMAP\_AHEAD) {
++ ((size - 1) % page\_size) <= page\_size - ZEND\_MMAP\_AHEAD) {
+ /\* \*buf[size] is zeroed automatically by the kernel \*/
+ \*buf = mmap(0, size + ZEND\_MMAP\_AHEAD, PROT\_READ, MAP\_PRIVATE, fileno(file\_handle->handle.fp), 0);
+ if (\*buf != MAP\_FAILED) {
+--- a/main/main.c
++++ b/main/main.c
+@@ -91,15 +91,17 @@
+ #include "SAPI.h"
+ #include "rfc1867.h"
+
+-#if HAVE\_SYS\_MMAN\_H
+-# include
+-# ifndef PAGE\_SIZE
++#if !HAVE\_UNISTD\_H || (!defined(\_SC\_PAGESIZE) && !defined(\_SC\_PAGE\_SIZE))
++# if HAVE\_SYS\_MMAN\_H
++# include
++# ifndef PAGE\_SIZE
++# define PAGE\_SIZE 4096
++# endif
++# endif
++# ifdef PHP\_WIN32
+ # define PAGE\_SIZE 4096
+ # endif
+ #endif
+-#ifdef PHP\_WIN32
+-# define PAGE\_SIZE 4096
+-#endif
+ /\* }}} \*/
+
+ PHPAPI int (\*php\_register\_internal\_extensions\_func)(TSRMLS\_D) = php\_register\_internal\_extensions;
+@@ -1192,6 +1194,17 @@ PHPAPI int php\_stream\_open\_for\_zend\_ex(c
+ char \*p;
+ size\_t len, mapped\_len;
+ php\_stream \*stream = php\_stream\_open\_wrapper((char \*)filename, "rb", mode, &handle->opened\_path);
++ long page\_size = 0;
++
++#if HAVE\_UNISTD\_H
++# ifdef \_SC\_PAGESIZE
++ page\_size = sysconf(\_SC\_PAGESIZE);
++# else
++ page\_size = sysconf(\_SC\_PAGE\_SIZE);
++# endif
++#else
++ page\_size = PAGE\_SIZE;
++#endif
+
+ if (stream) {
+ handle->filename = (char\*)filename;
+@@ -1204,7 +1217,7 @@ PHPAPI int php\_stream\_open\_for\_zend\_ex(c
+ memset(&handle->handle.stream.mmap, 0, sizeof(handle->handle.stream.mmap));
+ len = php\_zend\_stream\_fsizer(stream TSRMLS\_CC);
+ if (len != 0
+- && ((len - 1) % PAGE\_SIZE) <= PAGE\_SIZE - ZEND\_MMAP\_AHEAD
++ && ((len - 1) % page\_size) <= page\_size - ZEND\_MMAP\_AHEAD
+ && php\_stream\_mmap\_possible(stream)
+ && (p = php\_stream\_mmap\_range(stream, 0, len, PHP\_STREAM\_MAP\_MODE\_SHARED\_READONLY, &mapped\_len)) != NULL) {
+ handle->handle.stream.closer = php\_zend\_stream\_mmap\_closer;
--- php5-5.3.2.orig/debian/patches/libedit\_is\_editline.patch
+++ php5-5.3.2/debian/patches/libedit\_is\_editline.patch
@@ -0,0 +1,25 @@
+--- a/ext/readline/config.m4
++++ b/ext/readline/config.m4
+@@ -65,7 +65,7 @@ if test "$PHP\_READLINE" && test "$PHP\_RE
+ elif test "$PHP\_LIBEDIT" != "no"; then
+
+ for i in $PHP\_LIBEDIT /usr/local /usr; do
+- test -f $i/include/readline/readline.h && LIBEDIT\_DIR=$i && break
++ test -f $i/include/editline/readline.h && LIBEDIT\_DIR=$i && break
+ done
+
+ if test -z "$LIBEDIT\_DIR"; then
+--- a/ext/readline/readline.c
++++ b/ext/readline/readline.c
+@@ -33,8 +33,10 @@
+ #define rl\_completion\_matches completion\_matches
+ #endif
+
++#ifdef HAVE\_LIBEDIT
++#include
++#else
+ #include
+-#ifndef HAVE\_LIBEDIT
+ #include
+ #endif
+
--- php5-5.3.2.orig/debian/patches/libtool2.2.patch
+++ php5-5.3.2/debian/patches/libtool2.2.patch
@@ -0,0 +1,31 @@
+--- pkg-php.orig/scripts/phpize.in
++++ pkg-php/scripts/phpize.in
+@@ -5,10 +5,16 @@ prefix='@prefix@'
+ exec\_prefix="`eval echo @exec\_prefix@`"
+ phpdir="$prefix/lib/php5/build"
+ includedir="$prefix/include/php5"
++aclocaldir="$prefix/share/aclocal"
+ builddir="`pwd`"
+ SED="@SED@"
+
+-FILES\_BUILD="mkdep.awk scan\_makefile\_in.awk shtool libtool.m4"
++FILES\_BUILD="mkdep.awk scan\_makefile\_in.awk shtool"
++if [ -f "$aclocaldir/ltsugar.m4" ]; then
++ LIBTOOL\_FILES="libtool.m4 ltoptions.m4 ltsugar.m4 ltversion.m4 lt~obsolete.m4"
++else
++ LIBTOOL\_FILES="libtool.m4"
++fi
+ FILES="acinclude.m4 Makefile.global config.sub config.guess ltmain.sh run-tests\*.php"
+ CLEAN\_FILES="$FILES \*.o \*.lo \*.la .deps .libs/ build/ include/ modules/ install-sh \
+ mkinstalldirs missing config.nice config.sub config.guess configure configure.in \
+@@ -144,8 +150,9 @@ phpize\_copy\_files()
+ test -d build || mkdir build
+
+ (cd "$phpdir" && cp $FILES\_BUILD "$builddir"/build)
++ (cd "$aclocaldir" && cp $LIBTOOL\_FILES "$builddir"/build)
+ (cd "$phpdir" && cp $FILES "$builddir")
+- (cd "$builddir" && cat acinclude.m4 ./build/libtool.m4 > aclocal.m4)
++ (cd "$builddir/build" && cat ../acinclude.m4 $LIBTOOL\_FILES > ../aclocal.m4)
+ }
+
+ phpize\_replace\_prefix()
--- php5-5.3.2.orig/debian/patches/manpage\_spelling.patch
+++ php5-5.3.2/debian/patches/manpage\_spelling.patch
@@ -0,0 +1,29 @@
+--- pkg-php.orig/sapi/cli/php.1.in
++++ pkg-php/sapi/cli/php.1.in
+@@ -69,7 +69,7 @@ specified by \-F to be executed.
+ You can access the input line by \fB$argn\fP. While processing the input lines
+ .B $argi
+ contains the number of the actual line being processed. Further more
+-the paramters \-B and \-E can be used to execute
++the parameters \-B and \-E can be used to execute
+ .IR code
+ (see \-r) before and
+ after all input lines have been processed respectively. Notice that the
+@@ -316,7 +316,7 @@ The configuration file for the CGI versi
+ The configuration file for the version of PHP that apache2 uses.
+ .SH EXAMPLES
+ .TP 5
+-\fIphp -r 'echo "Hello World\\n";'\fP
++\fIphp \-r 'echo "Hello World\\n";'\fP
+ This command simply writes the text "Hello World" to standard out.
+ .TP
+ \fIphp \-r 'print\_r(gd\_info());'\fP
+@@ -340,7 +340,7 @@ configuration information. If you then c
+ Using this PHP command you can count the lines being input.
+ .TP
+ \fIphp \-R '@$l+=count(file($argn));' \-E 'echo "Lines:$l\\n";'\fP
+-In this example PHP expects each input line beeing a file. It counts all lines
++In this example PHP expects each input line being a file. It counts all lines
+ of the files specified by each input line and shows the summarized result.
+ You may combine this with tools like find and change the php scriptlet.
+ .TP
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-0708.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-0708.patch
@@ -0,0 +1,132 @@
+Subject: fix bug #54002, exif\_read\_data crashes on crafted tags
+Origin: http://svn.php.net/viewvc?view=revision&revision=308316
+Bug: http://bugs.php.net/bug.php?id=54002
+
+Patch also includes
+http://svn.php.net/viewvc?view=revision&revision=308317
+
+ Bug #54002, fix windows build, use the relevant values in the
+ warnings
+
+and http://svn.php.net/viewvc?view=revision&revision=308362
+
+ fix the fix (Dmitry) and ensure that it builds everywhere, can
+ someone test on solaris&co pls?
+
+Patch is also modified to drop the added testcases as they contained
+jpegs and not-representable in diffs. They have been added to the
+lp:qa-regression-testing tree instead.
+
+Index: ext/exif/exif.c
+===================================================================
+--- ext/exif/exif.c (revision 308315)
++++ ext/exif/exif.c (revision 308316)
+@@ -40,6 +40,10 @@
+ #include "php.h"
+ #include "ext/standard/file.h"
+
++#ifdef PHP\_WIN32
++include "win32/php\_stdint.h"
++#endif
++
+ #if HAVE\_EXIF
+
+ /\* When EXIF\_DEBUG is defined the module generates a lot of debug messages
+@@ -2821,6 +2825,7 @@
+ int tag, format, components;
+ char \*value\_ptr, tagname[64], cbuf[32], \*outside=NULL;
+ size\_t byte\_count, offset\_val, fpos, fgot;
++ int64\_t byte\_count\_signed;
+ xp\_field\_type \*tmp\_xp;
+ #ifdef EXIF\_DEBUG
+ char \*dump\_data;
+@@ -2845,13 +2850,20 @@
+ /\*return TRUE;\*/
+ }
+
+- byte\_count = components \* php\_tiff\_bytes\_per\_format[format];
++ if (components < 0) {
++ exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal byte\_count(%ld)", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC), byte\_count);
++ return FALSE;
++ }
+
+- if ((ssize\_t)byte\_count < 0) {
++ byte\_count\_signed = (int64\_t)components \* php\_tiff\_bytes\_per\_format[format];
++
++ if (byte\_count\_signed < 0 || (byte\_count\_signed > 2147483648)) {
+ exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal byte\_count(%ld)", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC), byte\_count);
+ return FALSE;
+ }
+
++ byte\_count = (size\_t)byte\_count\_signed;
++
+ if (byte\_count > 4) {
+ offset\_val = php\_ifd\_get32u(dir\_entry+8, ImageInfo->motorola\_intel);
+ /\* If its bigger than 4 bytes, the dir entry contains an offset. \*/
+@@ -2916,6 +2928,7 @@
+ efree(dump\_data);
+ }
+ #endif
++
+ if (section\_index==SECTION\_THUMBNAIL) {
+ if (!ImageInfo->Thumbnail.data) {
+ switch(tag) {
+Index: ext/exif/exif.c
+===================================================================
+--- ext/exif/exif.c (revision 308316)
++++ ext/exif/exif.c (revision 308317)
+@@ -41,7 +41,7 @@
+ #include "ext/standard/file.h"
+
+ #ifdef PHP\_WIN32
+-include "win32/php\_stdint.h"
++#include "win32/php\_stdint.h"
+ #endif
+
+ #if HAVE\_EXIF
+@@ -2851,14 +2851,14 @@
+ }
+
+ if (components < 0) {
+- exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal byte\_count(%ld)", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC), byte\_count);
++ exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal components(%ld)", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC), components);
+ return FALSE;
+ }
+
+ byte\_count\_signed = (int64\_t)components \* php\_tiff\_bytes\_per\_format[format];
+
+ if (byte\_count\_signed < 0 || (byte\_count\_signed > 2147483648)) {
+- exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal byte\_count(%ld)", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC), byte\_count);
++ exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal byte\_count", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC));
+ return FALSE;
+ }
+
+Index: ext/exif/exif.c
+===================================================================
+--- ext/exif/exif.c (revision 308361)
++++ ext/exif/exif.c (revision 308362)
+@@ -40,8 +40,14 @@
+ #include "php.h"
+ #include "ext/standard/file.h"
+
++#ifdef HAVE\_STDINT\_H
++# include
++#endif
++#ifdef HAVE\_INTTYPES\_H
++# include
++#endif
+ #ifdef PHP\_WIN32
+-#include "win32/php\_stdint.h"
++# include "win32/php\_stdint.h"
+ #endif
+
+ #if HAVE\_EXIF
+@@ -2857,7 +2863,7 @@
+
+ byte\_count\_signed = (int64\_t)components \* php\_tiff\_bytes\_per\_format[format];
+
+- if (byte\_count\_signed < 0 || (byte\_count\_signed > 2147483648)) {
++ if (byte\_count\_signed < 0 || (byte\_count\_signed > INT32\_MAX)) {
+ exif\_error\_docref("exif\_read\_data#error\_ifd" EXIFERR\_CC, ImageInfo, E\_WARNING, "Process tag(x%04X=%s): Illegal byte\_count", tag, exif\_get\_tagname(tag, tagname, -12, tag\_table TSRMLS\_CC));
+ return FALSE;
+ }
--- php5-5.3.2.orig/debian/patches/036-fd\_setsize\_fix.patch
+++ php5-5.3.2/debian/patches/036-fd\_setsize\_fix.patch
@@ -0,0 +1,27 @@
+Description: Fixes misuse of FD\_SET()
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/ext/sockets/sockets.c
++++ b/ext/sockets/sockets.c
+@@ -720,6 +720,7 @@ static int php\_sock\_array\_to\_fd\_set(zval
+
+ php\_sock = (php\_socket\*) zend\_fetch\_resource(element TSRMLS\_CC, -1, le\_socket\_name, NULL, 1, le\_socket);
+ if (!php\_sock) continue; /\* If element is not a resource, skip it \*/
++ if (php\_sock->bsd\_socket > FD\_SETSIZE) continue; /\* must ignore it \*/
+
+ PHP\_SAFE\_FD\_SET(php\_sock->bsd\_socket, fds);
+ if (php\_sock->bsd\_socket > \*max\_fd) {
+--- a/ext/standard/streamsfuncs.c
++++ b/ext/standard/streamsfuncs.c
+@@ -610,6 +610,9 @@ static int stream\_array\_to\_fd\_set(zval \*
+ \* is not displayed.
+ \* \*/
+ if (SUCCESS == php\_stream\_cast(stream, PHP\_STREAM\_AS\_FD\_FOR\_SELECT | PHP\_STREAM\_CAST\_INTERNAL, (void\*)&this\_fd, 1) && this\_fd >= 0) {
++ if (this\_fd > FD\_SETSIZE)
++ continue;
++
+
+ PHP\_SAFE\_FD\_SET(this\_fd, fds);
+
--- php5-5.3.2.orig/debian/patches/use\_embedded\_timezonedb.patch
+++ php5-5.3.2/debian/patches/use\_embedded\_timezonedb.patch
@@ -0,0 +1,655 @@
+
+Add support for use of the system timezone database, rather
+than embedding a copy. Discussed upstream but was not desired.
+
+History:
+r7: per Sean Finney's review: simpler lat/long rounding,
+ use stat() not access() to check existence of timezone,
+ improve comments throughout.
+r6: fix fd leak in r5, fix country code/BC flag use in
+ timezone\_identifiers\_list() using system db,
+ fix use of PECL timezonedb to override system db,
+r5: reverts addition of "System/Localtime" fake tzname.
+ updated for 5.3.0, parses zone.tab to pick up mapping between
+ timezone name, country code and long/lat coords
+r4: added "System/Localtime" tzname which uses /etc/localtime
+r3: fix a crash if /usr/share/zoneinfo doesn't exist (Raphael Geissert)
+r2: add filesystem trawl to set up name alias index
+r1: initial revision
+
+--- pkg-php.orig/ext/date/lib/parse\_tz.c
++++ pkg-php/ext/date/lib/parse\_tz.c
+@@ -24,6 +24,16 @@
+
+ #include "timelib.h"
+
++#ifdef HAVE\_SYSTEM\_TZDATA
++#include
++#include
++#include
++#include
++#include
++
++#include "php\_scandir.h"
++#endif
++
+ #include
+
+ #ifdef HAVE\_LOCALE\_H
+@@ -35,7 +45,12 @@
+ #else
+ #include
+ #endif
++
++#ifndef HAVE\_SYSTEM\_TZDATA
+ #include "timezonedb.h"
++#endif
++
++#include
+
+ #if (defined(\_\_APPLE\_\_) || defined(\_\_APPLE\_CC\_\_)) && (defined(\_\_BIG\_ENDIAN\_\_) || defined(\_\_LITTLE\_ENDIAN\_\_))
+ # if defined(\_\_LITTLE\_ENDIAN\_\_)
+@@ -55,6 +70,11 @@
+
+ static void read\_preamble(const unsigned char \*\*tzf, timelib\_tzinfo \*tz)
+ {
++ if (memcmp(tzf, "TZif", 4) == 0) {
++ \*tzf += 20;
++ return;
++ }
++
+ /\* skip ID \*/
+ \*tzf += 4;
+
+@@ -257,7 +277,435 @@ void timelib\_dump\_tzinfo(timelib\_tzinfo
+ }
+ }
+
+-static int seek\_to\_tz\_position(const unsigned char \*\*tzf, char \*timezone, const timelib\_tzdb \*tzdb)
++#ifdef HAVE\_SYSTEM\_TZDATA
++
++#ifdef HAVE\_SYSTEM\_TZDATA\_PREFIX
++#define ZONEINFO\_PREFIX HAVE\_SYSTEM\_TZDATA\_PREFIX
++#else
++#define ZONEINFO\_PREFIX "/usr/share/zoneinfo"
++#endif
++
++/\* Hash table entry for the cache of the zone.tab mapping table. \*/
++struct location\_info {
++ char code[2]; /\* Country code. \*/
++ double latitude, longitude;
++ char name[64];
++ char \*comment;
++ struct location\_info \*next;
++};
++
++/\* System timezone database pointer. \*/
++static const timelib\_tzdb \*timezonedb\_system = NULL;
++
++/\* Cache of zone.tab location data. \*/
++static struct location\_info \*\*system\_location\_table;
++
++/\* Size of the zone.tab hash table; a random-ish prime big enough to
++ \* prevent too many collisions. \*/
++#define LOCINFO\_HASH\_SIZE (1021)
++
++/\* Hash function for indexing the location\_info hash table. \*/
++static uint32\_t tz\_hash(const char \*str)
++{
++ const unsigned char \*p = (const unsigned char \*)str;
++ uint32\_t hash = 5381;
++ int c;
++
++ while ((c = \*p++) != '\0') {
++ hash = (hash << 5) ^ hash ^ c;
++ }
++
++ return hash % LOCINFO\_HASH\_SIZE;
++}
++
++/\* Parse an ISO-6709 co-ordinate as used in zone.tab. Returns end of
++ \* the parsed string on success, or NULL on parse error. On success,
++ \* writes the parsed number to \*result. \*/
++static char \*parse\_iso6709(char \*p, double \*result)
++{
++ double v, sign;
++ char \*pend;
++ size\_t len;
++
++ if (\*p == '+')
++ sign = 1.0;
++ else if (\*p == '-')
++ sign = -1.0;
++ else
++ return NULL;
++
++ p++;
++ for (pend = p; \*pend >= '0' && \*pend <= '9'; pend++)
++ ;;
++
++ /\* Annoying encoding used by zone.tab has no decimal point, so use
++ \* the length to determine the format:
++ \*
++ \* 4 = DDMM
++ \* 5 = DDDMM
++ \* 6 = DDMMSS
++ \* 7 = DDDMMSS
++ \*/
++ len = pend - p;
++ if (len < 4 || len > 7) {
++ return NULL;
++ }
++
++ /\* p => [D]DD \*/
++ v = (p[0] - '0') \* 10.0 + (p[1] - '0');
++ p += 2;
++ if (len == 5 || len == 7)
++ v = v \* 10.0 + (\*p++ - '0');
++ /\* p => MM[SS] \*/
++ v += (10.0 \* (p[0] - '0')
++ + p[1] - '0') / 60.0;
++ p += 2;
++ /\* p => [SS] \*/
++ if (len > 5) {
++ v += (10.0 \* (p[0] - '0')
++ + p[1] - '0') / 3600.0;
++ p += 2;
++ }
++
++ /\* Round to five decimal place, not because it's a good idea,
++ \* but, because the builtin data uses rounded data, so, match
++ \* that. \*/
++ \*result = sign \* (int)(v \* 100000.0 + 0.5) / 100000.0;
++
++ return p;
++}
++
++/\* This function parses the zone.tab file to build up the mapping of
++ \* timezone to country code and geographic location, and returns a
++ \* hash table. The hash table is indexed by the function:
++ \*
++ \* tz\_hash(timezone-name)
++ \*/
++static struct location\_info \*\*create\_location\_table(void)
++{
++ struct location\_info \*\*li, \*i;
++ char zone\_tab[PATH\_MAX];
++ char line[512];
++ FILE \*fp;
++
++ strncpy(zone\_tab, ZONEINFO\_PREFIX "/zone.tab", sizeof zone\_tab);
++
++ fp = fopen(zone\_tab, "r");
++ if (!fp) {
++ return NULL;
++ }
++
++ li = calloc(LOCINFO\_HASH\_SIZE, sizeof \*li);
++
++ while (fgets(line, sizeof line, fp)) {
++ char \*p = line, \*code, \*name, \*comment;
++ uint32\_t hash;
++ double latitude, longitude;
++
++ while (isspace(\*p))
++ p++;
++
++ if (\*p == '#' || \*p == '\0' || \*p == '\n')
++ continue;
++
++ if (!isalpha(p[0]) || !isalpha(p[1]) || p[2] != '\t')
++ continue;
++
++ /\* code => AA \*/
++ code = p;
++ p[2] = 0;
++ p += 3;
++
++ /\* coords => [+-][D]DDMM[SS][+-][D]DDMM[SS] \*/
++ p = parse\_iso6709(p, &latitude);
++ if (!p) {
++ continue;
++ }
++ p = parse\_iso6709(p, &longitude);
++ if (!p) {
++ continue;
++ }
++
++ if (!p || \*p != '\t') {
++ continue;
++ }
++
++ /\* name = string \*/
++ name = ++p;
++ while (\*p != '\t' && \*p && \*p != '\n')
++ p++;
++
++ \*p++ = '\0';
++
++ /\* comment = string \*/
++ comment = p;
++ while (\*p != '\t' && \*p && \*p != '\n')
++ p++;
++
++ if (\*p == '\n' || \*p == '\t')
++ \*p = '\0';
++
++ hash = tz\_hash(name);
++ i = malloc(sizeof \*i);
++ memcpy(i->code, code, 2);
++ strncpy(i->name, name, sizeof i->name);
++ i->comment = strdup(comment);
++ i->longitude = longitude;
++ i->latitude = latitude;
++ i->next = li[hash];
++ li[hash] = i;
++ /\* printf("%s [%u, %f, %f]\n", name, hash, latitude, longitude); \*/
++ }
++
++ fclose(fp);
++
++ return li;
++}
++
++/\* Return location info from hash table, using given timezone name.
++ \* Returns NULL if the name could not be found. \*/
++const struct location\_info \*find\_zone\_info(struct location\_info \*\*li,
++ const char \*name)
++{
++ uint32\_t hash = tz\_hash(name);
++ const struct location\_info \*l;
++
++ if (!li) {
++ return NULL;
++ }
++
++ for (l = li[hash]; l; l = l->next) {
++ if (strcasecmp(l->name, name) == 0)
++ return l;
++ }
++
++ return NULL;
++}
++
++/\* Filter out some non-tzdata files and the posix/right databases, if
++ \* present. \*/
++static int index\_filter(const struct dirent \*ent)
++{
++ return strcmp(ent->d\_name, ".") != 0
++ && strcmp(ent->d\_name, "..") != 0
++ && strcmp(ent->d\_name, "posix") != 0
++ && strcmp(ent->d\_name, "posixrules") != 0
++ && strcmp(ent->d\_name, "right") != 0
++ && strstr(ent->d\_name, ".tab") == NULL;
++}
++
++/\* Comparison callback for qsort(), used to alpha-sort the index
++ \* array by timezone name. \*/
++static int sysdbcmp(const void \*first, const void \*second)
++{
++ const timelib\_tzdb\_index\_entry \*alpha = first, \*beta = second;
++
++ return strcmp(alpha->id, beta->id);
++}
++
++
++/\* Create the zone identifier index by trawling the filesystem. \*/
++static void create\_zone\_index(timelib\_tzdb \*db)
++{
++ size\_t dirstack\_size, dirstack\_top;
++ size\_t index\_size, index\_next;
++ timelib\_tzdb\_index\_entry \*db\_index;
++ char \*\*dirstack;
++
++ /\* LIFO stack to hold directory entries to scan; each slot is a
++ \* directory name relative to the zoneinfo prefix. \*/
++ dirstack\_size = 32;
++ dirstack = malloc(dirstack\_size \* sizeof \*dirstack);
++ dirstack\_top = 1;
++ dirstack[0] = strdup("");
++
++ /\* Index array. \*/
++ index\_size = 64;
++ db\_index = malloc(index\_size \* sizeof \*db\_index);
++ index\_next = 0;
++
++ do {
++ struct dirent \*\*ents;
++ char name[PATH\_MAX], \*top;
++ int count;
++
++ /\* Pop the top stack entry, and iterate through its contents. \*/
++ top = dirstack[--dirstack\_top];
++ snprintf(name, sizeof name, ZONEINFO\_PREFIX "/%s", top);
++
++ count = php\_scandir(name, &ents, index\_filter, php\_alphasort);
++
++ while (count > 0) {
++ struct stat st;
++ const char \*leaf = ents[count - 1]->d\_name;
++
++ snprintf(name, sizeof name, ZONEINFO\_PREFIX "/%s/%s",
++ top, leaf);
++
++ if (strlen(name) && stat(name, &st) == 0) {
++ /\* Name, relative to the zoneinfo prefix. \*/
++ const char \*root = top;
++
++ if (root[0] == '/') root++;
++
++ snprintf(name, sizeof name, "%s%s%s", root,
++ \*root ? "/": "", leaf);
++
++ if (S\_ISDIR(st.st\_mode)) {
++ if (dirstack\_top == dirstack\_size) {
++ dirstack\_size \*= 2;
++ dirstack = realloc(dirstack,
++ dirstack\_size \* sizeof \*dirstack);
++ }
++ dirstack[dirstack\_top++] = strdup(name);
++ }
++ else {
++ if (index\_next == index\_size) {
++ index\_size \*= 2;
++ db\_index = realloc(db\_index,
++ index\_size \* sizeof \*db\_index);
++ }
++
++ db\_index[index\_next++].id = strdup(name);
++ }
++ }
++
++ free(ents[--count]);
++ }
++
++ if (count != -1) free(ents);
++ free(top);
++ } while (dirstack\_top);
++
++ /\* Alpha-sort the index array; shouldn't be technically necessary
++ \* but some of the test cases rely on this, and, it matches the
++ \* builtin database. \*/
++ qsort(db\_index, index\_next, sizeof \*db\_index, sysdbcmp);
++
++ db->index = db\_index;
++ db->index\_size = index\_next;
++
++ free(dirstack);
++}
++
++#define FAKE\_HEADER "1234\0??\1??"
++#define FAKE\_BC\_POS (0)
++#define FAKE\_UTC\_POS (7 - 4)
++
++/\* Create a fake data segment for database 'sysdb'. This mocks
++ \* up a fake ->data segment for the given timezone database.
++ \* php\_date.c::timezone\_identifiers\_list() looks at data[pos + 4]
++ \* through data[pos + 6] to compare the country code and BC flag,
++ \* which are stored in the builtin data array like:
++ \*
++ \* (pos + 4) => BC flag
++ \* (pos + 5, pos + 6) => Two chars of country code
++ \*
++ \* where pos is the index corresponding to the timezone name.
++ \*
++ \* Timezone names are classified here into three types:
++ \* 1) UTC, which is special
++ \* 2) "normal" zone names
++ \* 3) "backwards-compat" zone names
++ \*
++ \* (boolean logic of the BC flag seems to be inverted, but hey)
++ \*
++ \* UTC is special since it has BC=\1, code = "??"
++ \* "normal" zones exist in zone.tab and have the given c-code and BC=\1
++ \* "backwards-compat" zones don't exist in zone.tab and have BC=\0
++ \*
++ \* Since UTC and the BC zones are constant, they are encoded in the
++ \* FAKE\_HEADER prefix, and pos pointers index into that.
++ \*
++ \* FAKE\_HEADER is hence four random bytes, then the BC zone segment
++ \* (three bytes), then the UTC zone segment (another three).
++ \*
++ \* For all "normal" zones, three bytes are appended to the data array;
++ \* the BC flag, always 1, and the two bytes of country code.
++ \*/
++static void fake\_data\_segment(timelib\_tzdb \*sysdb,
++ struct location\_info \*\*info)
++{
++ size\_t n;
++ char \*data, \*p;
++
++ /\* Worst case maximum is 3 bytes per zone, plus the header. \*/
++ data = malloc((3 \* sysdb->index\_size) + sizeof(FAKE\_HEADER) - 1);
++
++ /\* Append the fake header, p then = next byte \*/
++ p = mempcpy(data, FAKE\_HEADER, sizeof(FAKE\_HEADER) - 1);
++
++ for (n = 0; n < sysdb->index\_size; n++) {
++ const struct location\_info \*li;
++ timelib\_tzdb\_index\_entry \*ent;
++
++ /\* Lost const'ness since we're modifying the pos pointer. \*/
++ ent = (timelib\_tzdb\_index\_entry \*)&sysdb->index[n];
++
++ /\* Lookup the timezone name in the hash table. \*/
++ if (strcmp(ent->id, "UTC") == 0) {
++ ent->pos = FAKE\_UTC\_POS;
++ continue;
++ }
++
++ li = find\_zone\_info(info, ent->id);
++ if (li) {
++ /\* If found, append the BC byte and the country code; set
++ \* the position index for the timezone to point to
++ \* this. \*/
++ ent->pos = (p - data) - 4;
++ \*p++ = '\x01';
++ \*p++ = li->code[0];
++ \*p++ = li->code[1];
++ }
++ else {
++ /\* If not found, the timezone data can
++ \* point at the header. \*/
++ ent->pos = 0;
++ }
++ }
++
++ /\* Store the fake data array \*/
++ sysdb->data = (unsigned char \*)data;
++}
++
++/\* Evaluates to true if given timezone name is valid. \*/
++#define is\_valid\_tz\_name(tz\_) (tz\_[0] && strstr(tz\_, "..") == NULL)
++
++/\* Return the mmap()ed tzfile if found, else NULL. On success, the
++ \* length of the mapped data is placed in \*length. \*/
++static char \*map\_tzfile(const char \*timezone, size\_t \*length)
++{
++ char fname[PATH\_MAX];
++ struct stat st;
++ char \*p;
++ int fd;
++
++ if (!is\_valid\_tz\_name(timezone)) {
++ return NULL;
++ }
++
++ snprintf(fname, sizeof fname, ZONEINFO\_PREFIX "/%s", timezone);
++
++ fd = open(fname, O\_RDONLY);
++ if (fd == -1) {
++ return NULL;
++ } else if (fstat(fd, &st) != 0 || st.st\_size < 21) {
++ close(fd);
++ return NULL;
++ }
++
++ \*length = st.st\_size;
++ p = mmap(NULL, st.st\_size, PROT\_READ, MAP\_SHARED, fd, 0);
++ close(fd);
++
++ return p != MAP\_FAILED ? p : NULL;
++}
++#endif
++
++/\* seek\_to\_tz\_position() for a builtin/external database. \*/
++static int inmem\_seek\_to\_tz\_position(const unsigned char \*\*tzf,
++ char \*timezone, const timelib\_tzdb \*tzdb)
+ {
+ int left = 0, right = tzdb->index\_size - 1;
+ #ifdef HAVE\_SETLOCALE
+@@ -296,36 +744,131 @@ static int seek\_to\_tz\_position(const uns
+ return 0;
+ }
+
++/\* Modified seek\_to\_tz\_position wrapper which handles the system
++ \* database and the builtin/external databases in the same way.
++ \* Returns zero on failure on non-zero on success. On success, (\*map,
++ \* \*maplen) is an mmap'ed region if \*map is non-NULL, and must be
++ \* munmaped after use. \*/
++static int seek\_to\_tz\_position(const unsigned char \*\*tzf, char \*timezone,
++ char \*\*map, size\_t \*maplen,
++ const timelib\_tzdb \*tzdb)
++{
++#ifdef HAVE\_SYSTEM\_TZDATA
++ if (tzdb == timezonedb\_system) {
++ char \*orig;
++
++ orig = map\_tzfile(timezone, maplen);
++ if (orig == NULL) {
++ return 0;
++ }
++
++ (\*tzf) = (unsigned char \*)orig ;
++ \*map = orig;
++
++ return 1;
++ }
++ else
++#endif
++ {
++ return inmem\_seek\_to\_tz\_position(tzf, timezone, tzdb);
++ }
++}
++
+ const timelib\_tzdb \*timelib\_builtin\_db(void)
+ {
++#ifdef HAVE\_SYSTEM\_TZDATA
++ if (timezonedb\_system == NULL) {
++ timelib\_tzdb \*tmp = malloc(sizeof \*tmp);
++
++ tmp->version = "0.system";
++ tmp->data = NULL;
++ create\_zone\_index(tmp);
++ system\_location\_table = create\_location\_table();
++ fake\_data\_segment(tmp, system\_location\_table);
++ timezonedb\_system = tmp;
++ }
++
++ return timezonedb\_system;
++#else
+ return &timezonedb\_builtin;
++#endif
+ }
+
+ const timelib\_tzdb\_index\_entry \*timelib\_timezone\_builtin\_identifiers\_list(int \*count)
+ {
++#ifdef HAVE\_SYSTEM\_TZDATA
++ \*count = timezonedb\_system->index\_size;
++ return timezonedb\_system->index;
++#else
+ \*count = sizeof(timezonedb\_idx\_builtin) / sizeof(\*timezonedb\_idx\_builtin);
+ return timezonedb\_idx\_builtin;
++#endif
+ }
+
+ int timelib\_timezone\_id\_is\_valid(char \*timezone, const timelib\_tzdb \*tzdb)
+ {
+ const unsigned char \*tzf;
+- return (seek\_to\_tz\_position(&tzf, timezone, tzdb));
++
++#ifdef HAVE\_SYSTEM\_TZDATA
++ if (tzdb == timezonedb\_system) {
++ char fname[PATH\_MAX];
++ struct stat st;
++
++ if (!is\_valid\_tz\_name(timezone)) {
++ return 0;
++ }
++
++ snprintf(fname, sizeof fname, ZONEINFO\_PREFIX "/%s", timezone);
++
++ return stat(fname, &st) == 0 && S\_ISREG(st.st\_mode);
++ }
++#endif
++
++ return (inmem\_seek\_to\_tz\_position(&tzf, timezone, tzdb));
+ }
+
+ timelib\_tzinfo \*timelib\_parse\_tzfile(char \*timezone, const timelib\_tzdb \*tzdb)
+ {
+ const unsigned char \*tzf;
++ char \*memmap = NULL;
++ size\_t maplen;
+ timelib\_tzinfo \*tmp;
+
+- if (seek\_to\_tz\_position(&tzf, timezone, tzdb)) {
++ if (seek\_to\_tz\_position(&tzf, timezone, &memmap, &maplen, tzdb)) {
+ tmp = timelib\_tzinfo\_ctor(timezone);
+
+ read\_preamble(&tzf, tmp);
+ read\_header(&tzf, tmp);
+ read\_transistions(&tzf, tmp);
+ read\_types(&tzf, tmp);
+- read\_location(&tzf, tmp);
++
++#ifdef HAVE\_SYSTEM\_TZDATA
++ if (memmap) {
++ const struct location\_info \*li;
++
++ /\* TZif-style - grok the location info from the system database,
++ \* if possible. \*/
++ if ((li = find\_zone\_info(system\_location\_table, timezone)) != NULL) {
++ tmp->location.comments = strdup(li->comment);
++ strncpy(tmp->location.country\_code, li->code, 2);
++ tmp->location.longitude = li->longitude;
++ tmp->location.latitude = li->latitude;
++ tmp->bc = 1;
++ }
++ else {
++ strcpy(tmp->location.country\_code, "??");
++ tmp->bc = 0;
++ tmp->location.comments = strdup("");
++ }
++
++ /\* Now done with the mmap segment - discard it. \*/
++ munmap(memmap, maplen);
++#endif
++ }
++ else {
++ /\* PHP-style - use the embedded info. \*/
++ read\_location(&tzf, tmp);
++ }
+ } else {
+ tmp = NULL;
+ }
+--- pkg-php.orig/ext/date/lib/timelib.m4
++++ pkg-php/ext/date/lib/timelib.m4
+@@ -78,3 +78,17 @@ stdlib.h
+
+ dnl Check for strtoll, atoll
+ AC\_CHECK\_FUNCS(strtoll atoll strftime)
++
++PHP\_ARG\_WITH(system-tzdata, for use of system timezone data,
++[ --with-system-tzdata[=DIR] to specify use of system timezone data],
++no, no)
++
++if test "$PHP\_SYSTEM\_TZDATA" != "no"; then
++ AC\_DEFINE(HAVE\_SYSTEM\_TZDATA, 1, [Define if system timezone data is used])
++
++ if test "$PHP\_SYSTEM\_TZDATA" != "yes"; then
++ AC\_DEFINE\_UNQUOTED(HAVE\_SYSTEM\_TZDATA\_PREFIX, "$PHP\_SYSTEM\_TZDATA",
++ [Define for location of system timezone data])
++ fi
++fi
++
--- php5-5.3.2.orig/debian/patches/session\_save\_path.patch
+++ php5-5.3.2/debian/patches/session\_save\_path.patch
@@ -0,0 +1,12 @@
+diff -Naurp php-5.3.2.orig/ext/session/session.c php-5.3.2/ext/session/session.c
+--- php-5.3.2.orig/ext/session/session.c 2010-02-04 04:40:38.000000000 -0500
++++ php-5.3.2/ext/session/session.c 2010-05-10 03:58:34.794405379 -0400
+@@ -765,7 +765,7 @@ static PHP\_INI\_MH(OnUpdateHashFunc) /\* {
+ PHP\_INI\_BEGIN()
+ STD\_PHP\_INI\_BOOLEAN("session.bug\_compat\_42", "1", PHP\_INI\_ALL, OnUpdateBool, bug\_compat, php\_ps\_globals, ps\_globals)
+ STD\_PHP\_INI\_BOOLEAN("session.bug\_compat\_warn", "1", PHP\_INI\_ALL, OnUpdateBool, bug\_compat\_warn, php\_ps\_globals, ps\_globals)
+- STD\_PHP\_INI\_ENTRY("session.save\_path", "", PHP\_INI\_ALL, OnUpdateSaveDir,save\_path, php\_ps\_globals, ps\_globals)
++ STD\_PHP\_INI\_ENTRY("session.save\_path", "/var/lib/php5", PHP\_INI\_ALL, OnUpdateSaveDir,save\_path, php\_ps\_globals, ps\_globals)
+ STD\_PHP\_INI\_ENTRY("session.name", "PHPSESSID", PHP\_INI\_ALL, OnUpdateString, session\_name, php\_ps\_globals, ps\_globals)
+ PHP\_INI\_ENTRY("session.save\_handler", "files", PHP\_INI\_ALL, OnUpdateSaveHandler)
+ STD\_PHP\_INI\_BOOLEAN("session.auto\_start", "0", PHP\_INI\_ALL, OnUpdateBool, auto\_start, php\_ps\_globals, ps\_globals)
--- php5-5.3.2.orig/debian/patches/php5-CVE-2012-0057.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2012-0057.patch
@@ -0,0 +1,282 @@
+Origin: http://svn.php.net/viewvc/?view=revision&revision=317759
+ and http://svn.php.net/viewvc/?view=revision&revision=317801
+ and http://svn.php.net/viewvc/?view=revision&revision=317953
+Subject: Added xsl.security\_prefs ini option to define forbidden
+ operations within XSLT stylesheets
+
+Added xsl.security\_prefs ini option to define forbidden
+operations within XSLT stylesheets, default is not to enable
+write operations. This option won't be in 5.4, since there's a new
+method. Bug #54446
+
+Added the xsl.security\_prefs option to 5\_4 and trunk and
+mark it as deprecated for BC-reasons
+Added tests for ini option and combination of both
+
+CVE-2012-0057
+
+---
+ ext/xsl/php\_xsl.c | 17 ++++++
+ ext/xsl/php\_xsl.h | 10 +++
+ ext/xsl/tests/bug54446\_with\_ini.phpt | 95 +++++++++++++++++++++++++++++++++++
+ ext/xsl/xsltprocessor.c | 52 ++++++++++++++++++-
+ 4 files changed, 172 insertions(+), 2 deletions(-)
+
+Index: b/ext/xsl/php\_xsl.h
+===================================================================
+--- a/ext/xsl/php\_xsl.h
++++ b/ext/xsl/php\_xsl.h
+@@ -32,6 +32,7 @@ extern zend\_module\_entry xsl\_module\_entr
+ #include
+ #include
+ #include
++#include
+ #if HAVE\_XSL\_EXSLT
+ #include
+ #include
+@@ -43,6 +44,15 @@ extern zend\_module\_entry xsl\_module\_entr
+ #include
+ #include
+
++#define XSL\_SECPREF\_NONE 0
++#define XSL\_SECPREF\_READ\_FILE 2
++#define XSL\_SECPREF\_WRITE\_FILE 4
++#define XSL\_SECPREF\_CREATE\_DIRECTORY 8
++#define XSL\_SECPREF\_READ\_NETWORK 16
++#define XSL\_SECPREF\_WRITE\_NETWORK 32
++/\* Default == disable all write access == XSL\_SECPREF\_WRITE\_NETWORK | XSL\_SECPREF\_CREATE\_DIRECTORY |Â XSL\_SECPREF\_WRITE\_FILE \*/
++#define XSL\_SECPREF\_DEFAULT 44
++
+ typedef struct \_xsl\_object {
+ zend\_object std;
+ void \*ptr;
+Index: b/ext/xsl/xsltprocessor.c
+===================================================================
+--- a/ext/xsl/xsltprocessor.c
++++ b/ext/xsl/xsltprocessor.c
+@@ -465,7 +465,7 @@ PHP\_FUNCTION(xsl\_xsltprocessor\_import\_st
+
+ static xmlDocPtr php\_xsl\_apply\_stylesheet(zval \*id, xsl\_object \*intern, xsltStylesheetPtr style, zval \*docp TSRMLS\_DC) /\* {{{ \*/
+ {
+- xmlDocPtr newdocp;
++ xmlDocPtr newdocp = NULL;
+ xmlDocPtr doc = NULL;
+ xmlNodePtr node = NULL;
+ xsltTransformContextPtr ctxt;
+@@ -475,6 +475,9 @@ static xmlDocPtr php\_xsl\_apply\_styleshee
+ zval \*doXInclude, \*member;
+ zend\_object\_handlers \*std\_hnd;
+ FILE \*f;
++ int secPrefsError = 0;
++ int secPrefsValue;
++ xsltSecurityPrefsPtr secPrefs = NULL;
+
+ node = php\_libxml\_import\_node(docp TSRMLS\_CC);
+
+@@ -531,11 +534,56 @@ static xmlDocPtr php\_xsl\_apply\_styleshee
+ }
+ efree(member);
+
+- newdocp = xsltApplyStylesheetUser(style, doc, (const char\*\*) params, NULL, f, ctxt);
++
++ secPrefsValue = INI\_INT("xsl.security\_prefs");
++
++ /\* if securityPrefs is set to NONE, we don't have to do any checks, but otherwise... \*/
++ if (secPrefsValue != XSL\_SECPREF\_NONE) {
++ secPrefs = xsltNewSecurityPrefs();
++ if (secPrefsValue & XSL\_SECPREF\_READ\_FILE ) {
++ if (0 != xsltSetSecurityPrefs(secPrefs, XSLT\_SECPREF\_READ\_FILE, xsltSecurityForbid)) {
++ secPrefsError = 1;
++ }
++ }
++ if (secPrefsValue & XSL\_SECPREF\_WRITE\_FILE ) {
++ if (0 != xsltSetSecurityPrefs(secPrefs, XSLT\_SECPREF\_WRITE\_FILE, xsltSecurityForbid)) {
++ secPrefsError = 1;
++ }
++ }
++ if (secPrefsValue & XSL\_SECPREF\_CREATE\_DIRECTORY ) {
++ if (0 != xsltSetSecurityPrefs(secPrefs, XSLT\_SECPREF\_CREATE\_DIRECTORY, xsltSecurityForbid)) {
++ secPrefsError = 1;
++ }
++ }
++ if (secPrefsValue & XSL\_SECPREF\_READ\_NETWORK) {
++ if (0 != xsltSetSecurityPrefs(secPrefs, XSLT\_SECPREF\_READ\_NETWORK, xsltSecurityForbid)) {
++ secPrefsError = 1;
++ }
++ }
++ if (secPrefsValue & XSL\_SECPREF\_WRITE\_NETWORK) {
++ if (0 != xsltSetSecurityPrefs(secPrefs, XSLT\_SECPREF\_WRITE\_NETWORK, xsltSecurityForbid)) {
++ secPrefsError = 1;
++ }
++ }
++
++ if (0 != xsltSetCtxtSecurityPrefs(secPrefs, ctxt)) {
++ secPrefsError = 1;
++ }
++ }
++
++ if (secPrefsError == 1) {
++ php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Can't set libxslt security properties, not doing transformation for security reasons");
++ } else {
++ newdocp = xsltApplyStylesheetUser(style, doc, (const char\*\*) params, NULL, f, ctxt);
++ }
+ if (f) {
+ fclose(f);
+ }
++
+ xsltFreeTransformContext(ctxt);
++ if (secPrefs) {
++ xsltFreeSecurityPrefs(secPrefs);
++ }
+
+ if (intern->node\_list != NULL) {
+ zend\_hash\_destroy(intern->node\_list);
+Index: b/ext/xsl/php\_xsl.c
+===================================================================
+--- a/ext/xsl/php\_xsl.c
++++ b/ext/xsl/php\_xsl.c
+@@ -141,6 +141,11 @@ zend\_object\_value xsl\_objects\_new(zend\_c
+ }
+ /\* }}} \*/
+
++PHP\_INI\_BEGIN()
++//XSL\_SECPREF\_CREATE\_DIRECTORY | XSL\_SECPREF\_WRITE\_NETWORK |Â XSL\_SECPREF\_WRITE\_FILE == 44
++PHP\_INI\_ENTRY("xsl.security\_prefs", "44", PHP\_INI\_ALL, NULL)
++PHP\_INI\_END()
++
+ /\* {{{ PHP\_MINIT\_FUNCTION
+ \*/
+ PHP\_MINIT\_FUNCTION(xsl)
+@@ -167,6 +172,14 @@ PHP\_MINIT\_FUNCTION(xsl)
+ REGISTER\_LONG\_CONSTANT("XSL\_CLONE\_NEVER", -1, CONST\_CS | CONST\_PERSISTENT);
+ REGISTER\_LONG\_CONSTANT("XSL\_CLONE\_ALWAYS", 1, CONST\_CS | CONST\_PERSISTENT);
+
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_NONE", XSL\_SECPREF\_NONE, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_READ\_FILE", XSL\_SECPREF\_READ\_FILE, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_WRITE\_FILE", XSL\_SECPREF\_WRITE\_FILE, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_CREATE\_DIRECTORY", XSL\_SECPREF\_CREATE\_DIRECTORY, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_READ\_NETWORK", XSL\_SECPREF\_READ\_NETWORK, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_WRITE\_NETWORK", XSL\_SECPREF\_WRITE\_NETWORK, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_LONG\_CONSTANT("XSL\_SECPREF\_DEFAULT", XSL\_SECPREF\_DEFAULT, CONST\_CS | CONST\_PERSISTENT);
++
+ REGISTER\_LONG\_CONSTANT("LIBXSLT\_VERSION", LIBXSLT\_VERSION, CONST\_CS | CONST\_PERSISTENT);
+ REGISTER\_STRING\_CONSTANT("LIBXSLT\_DOTTED\_VERSION", LIBXSLT\_DOTTED\_VERSION, CONST\_CS | CONST\_PERSISTENT);
+
+@@ -175,6 +188,8 @@ PHP\_MINIT\_FUNCTION(xsl)
+ REGISTER\_STRING\_CONSTANT("LIBEXSLT\_DOTTED\_VERSION", LIBEXSLT\_DOTTED\_VERSION, CONST\_CS | CONST\_PERSISTENT);
+ #endif
+
++ REGISTER\_INI\_ENTRIES();
++
+ return SUCCESS;
+ }
+ /\* }}} \*/
+@@ -258,6 +273,8 @@ PHP\_MSHUTDOWN\_FUNCTION(xsl)
+
+ xsltCleanupGlobals();
+
++ UNREGISTER\_INI\_ENTRIES();
++
+ return SUCCESS;
+ }
+ /\* }}} \*/
+Index: b/ext/xsl/tests/bug54446\_with\_ini.phpt
+===================================================================
+--- /dev/null
++++ b/ext/xsl/tests/bug54446\_with\_ini.phpt
+@@ -0,0 +1,95 @@
++--TEST--
++Bug #54446 (Arbitrary file creation via libxslt 'output' extension with php.ini setting)
++--SKIPIF--
++php
++if (!extension\_loaded('xsl')) die("skip Extension XSL is required\n");
++?
++--FILE--
++php
++include("prepare.inc");
++
++$outputfile = dirname(\_\_FILE\_\_)."/bug54446test.txt";
++if (file\_exists($outputfile)) {
++ unlink($outputfile);
++}
++
++$sXsl = <<<EOT
++<xsl:stylesheet version="1.0"
++ xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
++ xmlns:sax="http://icl.com/saxon"
++ extension-element-prefixes="sax"
++
++
++
++
++
++
++
++
++EOT;
++
++$xsl->loadXML( $sXsl );
++
++# START XSLT
++$proc->importStylesheet( $xsl );
++
++# TRASNFORM & PRINT
++print $proc->transformToXML( $dom );
++
++
++if (file\_exists($outputfile)) {
++ print "$outputfile exists, but shouldn't!\n";
++} else {
++ print "OK, no file created\n";
++}
++
++#SET NO SECURITY PREFS
++ini\_set("xsl.security\_prefs", XSL\_SECPREF\_NONE);
++
++# TRASNFORM & PRINT
++print $proc->transformToXML( $dom );
++
++
++if (file\_exists($outputfile)) {
++ print "OK, file exists\n";
++} else {
++ print "$outputfile doesn't exist, but should!\n";
++}
++
++unlink($outputfile);
++
++#SET SECURITY PREFS AGAIN
++ini\_set("xsl.security\_prefs", XSL\_SECPREF\_WRITE\_FILE | XSL\_SECPREF\_WRITE\_NETWORK | XSL\_SECPREF\_CREATE\_DIRECTORY);
++
++# TRASNFORM & PRINT
++print $proc->transformToXML( $dom );
++
++if (file\_exists($outputfile)) {
++ print "$outputfile exists, but shouldn't!\n";
++} else {
++ print "OK, no file created\n";
++}
++
++
++--EXPECTF--
++Warning: XSLTProcessor::transformToXml(): runtime error: file %s line %s element output in %s on line %d
++
++Warning: XSLTProcessor::transformToXml(): File write for %s/bug54446test.txt refused in %s on line %s
++
++Warning: XSLTProcessor::transformToXml(): runtime error: file %s line %d element output in %s on line %d
++
++Warning: XSLTProcessor::transformToXml(): xsltDocumentElem: write rights for %s/bug54446test.txt denied in %s on line %d
++OK, no file created
++OK, file exists
++
++Warning: XSLTProcessor::transformToXml(): runtime error: file %s line %s element output in %s on line %d
++
++Warning: XSLTProcessor::transformToXml(): File write for %s/bug54446test.txt refused in %s on line %s
++
++Warning: XSLTProcessor::transformToXml(): runtime error: file %s line %d element output in %s on line %d
++
++Warning: XSLTProcessor::transformToXml(): xsltDocumentElem: write rights for %s/bug54446test.txt denied in %s on line %d
++OK, no file created
++--CREDITS--
++Christian Stocker, chregu@php.net
++
--- php5-5.3.2.orig/debian/patches/108-64\_bit\_datetime.patch
+++ php5-5.3.2/debian/patches/108-64\_bit\_datetime.patch
@@ -0,0 +1,12 @@
+--- a/ext/standard/datetime.c
++++ b/ext/standard/datetime.c
+@@ -20,6 +20,9 @@
+
+ /\* $Id: datetime.c 293036 2010-01-03 09:23:27Z sebastian $ \*/
+
++#define \_XOPEN\_SOURCE /\* needed to get strptime() declared \*/
++#define \_BSD\_SOURCE /\* needed to get ulong declared \*/
++
+ #include "php.h"
+ #include "zend\_operators.h"
+ #include "datetime.h"
--- php5-5.3.2.orig/debian/patches/suhosin.patch
+++ php5-5.3.2/debian/patches/suhosin.patch
@@ -0,0 +1,5671 @@
+suhosin hardening patch
+
+this patch was downloaded from:
+
+ http://download.suhosin.org/suhosin-patch-5.3.2-0.9.9.1.patch.gz
+
+the following modifications have been made:
+
+ \* removed changes to ./configure & ./main/php\_config.h.in since those
+ files are autogenerated
+ \* "quilt refresh" has been run to clean up the offsets, etc
+--- a/Zend/Makefile.am
++++ b/Zend/Makefile.am
+@@ -17,7 +17,7 @@ libZend\_la\_SOURCES=\
+ zend\_objects\_API.c zend\_ts\_hash.c zend\_stream.c \
+ zend\_default\_classes.c \
+ zend\_iterators.c zend\_interfaces.c zend\_exceptions.c \
+- zend\_strtod.c zend\_closures.c zend\_float.c
++ zend\_strtod.c zend\_closures.c zend\_float.c zend\_canary.c zend\_alloc\_canary.c
+
+ libZend\_la\_LDFLAGS =
+ libZend\_la\_LIBADD = @ZEND\_EXTRA\_LIBS@
+--- a/Zend/Zend.dsp
++++ b/Zend/Zend.dsp
+@@ -247,6 +247,14 @@ SOURCE=.\zend\_strtod.c
+ # End Source File
+ # Begin Source File
+
++SOURCE=.\zend\_canary.c
++# End Source File
++# Begin Source File
++
++SOURCE=.\zend\_alloc\_canary.c
++# End Source File
++# Begin Source File
++
+ SOURCE=.\zend\_ts\_hash.c
+ # End Source File
+ # Begin Source File
+--- a/Zend/ZendTS.dsp
++++ b/Zend/ZendTS.dsp
+@@ -277,6 +277,14 @@ SOURCE=.\zend\_strtod.c
+ # End Source File
+ # Begin Source File
+
++SOURCE=.\zend\_canary.c
++# End Source File
++# Begin Source File
++
++SOURCE=.\zend\_alloc\_canary.c
++# End Source File
++# Begin Source File
++
+ SOURCE=.\zend\_ts\_hash.c
+ # End Source File
+ # Begin Source File
+--- a/Zend/zend.c
++++ b/Zend/zend.c
+@@ -60,6 +60,10 @@ int (\*zend\_vspprintf)(char \*\*pbuf, size\_
+ ZEND\_API char \*(\*zend\_getenv)(char \*name, size\_t name\_len TSRMLS\_DC);
+ ZEND\_API char \*(\*zend\_resolve\_path)(const char \*filename, int filename\_len TSRMLS\_DC);
+
++#if SUHOSIN\_PATCH
++ZEND\_API void (\*zend\_suhosin\_log)(int loglevel, char \*fmt, ...);
++#endif
++
+ void (\*zend\_on\_timeout)(int seconds TSRMLS\_DC);
+
+ static void (\*zend\_message\_dispatcher\_p)(long message, void \*data TSRMLS\_DC);
+@@ -88,6 +92,74 @@ static ZEND\_INI\_MH(OnUpdateGCEnabled) /\*
+ }
+ /\* }}} \*/
+
++#if SUHOSIN\_PATCH
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_syslog)
++{
++ if (!new\_value) {
++ SPG(log\_syslog) = S\_ALL & ~S\_SQL | S\_MEMORY;
++ } else {
++ SPG(log\_syslog) = atoi(new\_value) | S\_MEMORY;
++ }
++ return SUCCESS;
++}
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_syslog\_facility)
++{
++ if (!new\_value) {
++ SPG(log\_syslog\_facility) = LOG\_USER;
++ } else {
++ SPG(log\_syslog\_facility) = atoi(new\_value);
++ }
++ return SUCCESS;
++}
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_syslog\_priority)
++{
++ if (!new\_value) {
++ SPG(log\_syslog\_priority) = LOG\_ALERT;
++ } else {
++ SPG(log\_syslog\_priority) = atoi(new\_value);
++ }
++ return SUCCESS;
++}
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_sapi)
++{
++ if (!new\_value) {
++ SPG(log\_sapi) = S\_ALL & ~S\_SQL;
++ } else {
++ SPG(log\_sapi) = atoi(new\_value);
++ }
++ return SUCCESS;
++}
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_script)
++{
++ if (!new\_value) {
++ SPG(log\_script) = S\_ALL & ~S\_MEMORY;
++ } else {
++ SPG(log\_script) = atoi(new\_value) & (~S\_MEMORY) & (~S\_INTERNAL);
++ }
++ return SUCCESS;
++}
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_scriptname)
++{
++ if (SPG(log\_scriptname)) {
++ pefree(SPG(log\_scriptname),1);
++ }
++ SPG(log\_scriptname) = NULL;
++ if (new\_value) {
++ SPG(log\_scriptname) = pestrdup(new\_value,1);
++ }
++ return SUCCESS;
++}
++static ZEND\_INI\_MH(OnUpdateSuhosin\_log\_phpscript)
++{
++ if (!new\_value) {
++ SPG(log\_phpscript) = S\_ALL & ~S\_MEMORY;
++ } else {
++ SPG(log\_phpscript) = atoi(new\_value) & (~S\_MEMORY) & (~S\_INTERNAL);
++ }
++ return SUCCESS;
++}
++#endif
++
+ ZEND\_INI\_BEGIN()
+ ZEND\_INI\_ENTRY("error\_reporting", NULL, ZEND\_INI\_ALL, OnUpdateErrorReporting)
+ STD\_ZEND\_INI\_BOOLEAN("zend.enable\_gc", "1", ZEND\_INI\_ALL, OnUpdateGCEnabled, gc\_enabled, zend\_gc\_globals, gc\_globals)
+--- a/Zend/zend.h
++++ b/Zend/zend.h
+@@ -627,6 +627,9 @@ extern ZEND\_API int (\*zend\_stream\_open\_f
+ extern int (\*zend\_vspprintf)(char \*\*pbuf, size\_t max\_len, const char \*format, va\_list ap);
+ extern ZEND\_API char \*(\*zend\_getenv)(char \*name, size\_t name\_len TSRMLS\_DC);
+ extern ZEND\_API char \*(\*zend\_resolve\_path)(const char \*filename, int filename\_len TSRMLS\_DC);
++#if SUHOSIN\_PATCH
++extern ZEND\_API void (\*zend\_suhosin\_log)(int loglevel, char \*fmt, ...);
++#endif
+
+ ZEND\_API void zend\_error(int type, const char \*format, ...) ZEND\_ATTRIBUTE\_FORMAT(printf, 2, 3);
+
+@@ -771,6 +774,16 @@ ZEND\_API void zend\_save\_error\_handling(z
+ ZEND\_API void zend\_replace\_error\_handling(zend\_error\_handling\_t error\_handling, zend\_class\_entry \*exception\_class, zend\_error\_handling \*current TSRMLS\_DC);
+ ZEND\_API void zend\_restore\_error\_handling(zend\_error\_handling \*saved TSRMLS\_DC);
+
++#if SUHOSIN\_PATCH
++#include "suhosin\_globals.h"
++#include "suhosin\_patch.h"
++#include "php\_syslog.h"
++
++ZEND\_API void zend\_canary(void \*buf, int len);
++ZEND\_API char suhosin\_get\_config(int element);
++
++#endif
++
+ #endif /\* ZEND\_H \*/
+
+ /\*
+--- a/Zend/zend\_alloc.c
++++ b/Zend/zend\_alloc.c
+@@ -32,6 +32,10 @@
+ # include
+ #endif
+
++#if SUHOSIN\_PATCH
++#include "suhosin\_patch.h"
++#endif
++
+ #ifdef ZEND\_WIN32
+ # include
+ # include
+@@ -59,6 +63,7 @@
+ # define PTR\_FMT "0x%0.8lx"
+ #endif
+
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
+ #if ZEND\_DEBUG
+ void zend\_debug\_alloc\_output(char \*format, ...)
+ {
+@@ -76,6 +81,7 @@ void zend\_debug\_alloc\_output(char \*forma
+ #endif
+ }
+ #endif
++#endif
+
+ #if (defined (\_\_GNUC\_\_) && \_\_GNUC\_\_ > 2 ) && !defined(\_\_INTEL\_COMPILER) && !defined(DARWIN) && !defined(\_\_hpux) && !defined(\_AIX)
+ static void zend\_mm\_panic(const char \*message) \_\_attribute\_\_ ((noreturn));
+@@ -134,6 +140,8 @@ static void zend\_mm\_panic(const char \*me
+ # endif
+ #endif
+
++static zend\_intptr\_t SUHOSIN\_POINTER\_GUARD = 0;
++
+ static zend\_mm\_storage\* zend\_mm\_mem\_dummy\_init(void \*params)
+ {
+ return malloc(sizeof(zend\_mm\_storage));
+@@ -328,13 +336,28 @@ static const zend\_mm\_mem\_handlers mem\_ha
+ #define MEM\_BLOCK\_GUARD 0x2A8FCC84
+ #define MEM\_BLOCK\_LEAK 0x6C5E8F2D
+
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++# define CANARY\_SIZE sizeof(size\_t)
++#else
++# define CANARY\_SIZE 0
++#endif
++
+ /\* mm block type \*/
+ typedef struct \_zend\_mm\_block\_info {
+ #if ZEND\_MM\_COOKIES
+ size\_t \_cookie;
+ #endif
+- size\_t \_size;
+- size\_t \_prev;
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ size\_t canary\_1;
++#endif
++ size\_t \_size;
++ size\_t \_prev;
++#if SUHOSIN\_PATCH
++ size\_t size;
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ size\_t canary\_2;
++#endif
++#endif
+ } zend\_mm\_block\_info;
+
+ #if ZEND\_DEBUG
+@@ -408,7 +431,7 @@ typedef struct \_zend\_mm\_free\_block {
+ # define ZEND\_MM\_CACHE\_STAT 0
+ #endif
+
+-struct \_zend\_mm\_heap {
++typedef struct \_zend\_mm\_heap {
+ int use\_zend\_alloc;
+ void \*(\*\_malloc)(size\_t);
+ void (\*\_free)(void\*);
+@@ -443,6 +466,9 @@ struct \_zend\_mm\_heap {
+ int miss;
+ } cache\_stat[ZEND\_MM\_NUM\_BUCKETS+1];
+ #endif
++#if SUHOSIN\_PATCH
++ size\_t canary\_1,canary\_2,canary\_3;
++#endif
+ };
+
+ #define ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, index) \
+@@ -516,18 +542,31 @@ static unsigned int \_zend\_mm\_cookie = 0;
+ /\* optimized access \*/
+ #define ZEND\_MM\_FREE\_BLOCK\_SIZE(b) (b)->info.\_size
+
++#ifndef ZEND\_MM\_ALIGNMENT
++# define ZEND\_MM\_ALIGNMENT 8
++# define ZEND\_MM\_ALIGNMENT\_LOG2 3
++#elif ZEND\_MM\_ALIGNMENT < 4
++# undef ZEND\_MM\_ALIGNMENT
++# undef ZEND\_MM\_ALIGNMENT\_LOG2
++# define ZEND\_MM\_ALIGNMENT 4
++# define ZEND\_MM\_ALIGNMENT\_LOG2 2
++#endif
++
++#define ZEND\_MM\_ALIGNMENT\_MASK ~(ZEND\_MM\_ALIGNMENT-1)
++
+ /\* Aligned header size \*/
++#define ZEND\_MM\_ALIGNED\_SIZE(size) ((size + ZEND\_MM\_ALIGNMENT - 1) & ZEND\_MM\_ALIGNMENT\_MASK)
+ #define ZEND\_MM\_ALIGNED\_HEADER\_SIZE ZEND\_MM\_ALIGNED\_SIZE(sizeof(zend\_mm\_block))
+ #define ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE ZEND\_MM\_ALIGNED\_SIZE(sizeof(zend\_mm\_small\_free\_block))
+-#define ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE ZEND\_MM\_ALIGNED\_SIZE(ZEND\_MM\_ALIGNED\_HEADER\_SIZE + END\_MAGIC\_SIZE)
++#define ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE ZEND\_MM\_ALIGNED\_SIZE(ZEND\_MM\_ALIGNED\_HEADER\_SIZE + END\_MAGIC\_SIZE + CANARY\_SIZE)
+ #define ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE (ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE>ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE?ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE:ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE)
+ #define ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE ZEND\_MM\_ALIGNED\_SIZE(sizeof(zend\_mm\_segment))
+
+-#define ZEND\_MM\_MIN\_SIZE ((ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE>(ZEND\_MM\_ALIGNED\_HEADER\_SIZE+END\_MAGIC\_SIZE))?(ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE-(ZEND\_MM\_ALIGNED\_HEADER\_SIZE+END\_MAGIC\_SIZE)):0)
++#define ZEND\_MM\_MIN\_SIZE ((ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE>(ZEND\_MM\_ALIGNED\_HEADER\_SIZE+END\_MAGIC\_SIZE+CANARY\_SIZE))?(ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE-(ZEND\_MM\_ALIGNED\_HEADER\_SIZE+END\_MAGIC\_SIZE+CANARY\_SIZE)):0)
+
+ #define ZEND\_MM\_MAX\_SMALL\_SIZE ((ZEND\_MM\_NUM\_BUCKETS<>ZEND\_MM\_ALIGNMENT\_LOG2)-(ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE>>ZEND\_MM\_ALIGNMENT\_LOG2))
+
+@@ -589,6 +628,44 @@ static unsigned int \_zend\_mm\_cookie = 0;
+
+ #endif
+
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++
++# define SUHOSIN\_MM\_CHECK\_CANARIES(block, MFUNCTION) do { \
++ char \*p = SUHOSIN\_MM\_END\_CANARY\_PTR(block); size\_t check; \
++ if (((block)->info.canary\_1 != heap->canary\_1) || ((block)->info.canary\_2 != heap->canary\_2)) { \
++ canary\_mismatch: \
++ zend\_suhosin\_log(S\_MEMORY, "canary mismatch on " MFUNCTION " - heap overflow detected at %p", (block)); \
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION) == 0) { \_exit(1); } else { (block)->info.canary\_1 = heap->canary\_1; (block)->info.canary\_2 = heap->canary\_2; }\
++ } \
++ memcpy(✓, p, CANARY\_SIZE); \
++ if (check != heap->canary\_3) { \
++ zend\_suhosin\_log(S\_MEMORY, "end canary mismatch on " MFUNCTION " - heap overflow detected at %p", (block)); \
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION) == 0) { \_exit(1); } else { memcpy(p, heap->canary\_3, CANARY\_SIZE); } \
++ } \
++ } while (0)
++
++# define SUHOSIN\_MM\_SET\_CANARIES(block) do { \
++ (block)->info.canary\_1 = heap->canary\_1; \
++ (block)->info.canary\_2 = heap->canary\_2; \
++ } while (0)
++
++# define SUHOSIN\_MM\_END\_CANARY\_PTR(block) \
++ (char \*)(((char\*)(ZEND\_MM\_DATA\_OF(block))) + ((zend\_mm\_block\*)(block))->info.size + END\_MAGIC\_SIZE)
++
++# define SUHOSIN\_MM\_SET\_END\_CANARY(block) do { \
++ char \*p = SUHOSIN\_MM\_END\_CANARY\_PTR(block); \
++ memcpy(p, &heap->canary\_3, CANARY\_SIZE); \
++ } while (0)
++
++#else
++
++# define SUHOSIN\_MM\_CHECK\_CANARIES(block, MFUNCTION)
++# define SUHOSIN\_MM\_SET\_CANARIES(block)
++# define SUHOSIN\_MM\_END\_CANARY\_PTR(block)
++# define SUHOSIN\_MM\_SET\_END\_CANARY(block)
++
++#endif
++
+
+ #if ZEND\_MM\_HEAP\_PROTECTION
+
+@@ -711,7 +788,7 @@ static inline unsigned int zend\_mm\_low\_b
+ #endif
+ }
+
+-static inline void zend\_mm\_add\_to\_rest\_list(zend\_mm\_heap \*heap, zend\_mm\_free\_block \*mm\_block)
++static void zend\_mm\_add\_to\_rest\_list(zend\_mm\_heap \*heap, zend\_mm\_free\_block \*mm\_block)
+ {
+ zend\_mm\_free\_block \*prev, \*next;
+
+@@ -721,14 +798,14 @@ static inline void zend\_mm\_add\_to\_rest\_l
+ mm\_block->parent = NULL;
+ }
+
+- prev = heap->rest\_buckets[0];
+- next = prev->next\_free\_block;
+- mm\_block->prev\_free\_block = prev;
+- mm\_block->next\_free\_block = next;
+- prev->next\_free\_block = next->prev\_free\_block = mm\_block;
++ prev = SUHOSIN\_MANGLE\_PTR(heap->rest\_buckets[0]);
++ next = SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block);
++ mm\_block->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
++ mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ prev->next\_free\_block = next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
+ }
+
+-static inline void zend\_mm\_add\_to\_free\_list(zend\_mm\_heap \*heap, zend\_mm\_free\_block \*mm\_block)
++static void zend\_mm\_add\_to\_free\_list(zend\_mm\_heap \*heap, zend\_mm\_free\_block \*mm\_block)
+ {
+ size\_t size;
+ size\_t index;
+@@ -745,7 +822,7 @@ static inline void zend\_mm\_add\_to\_free\_l
+ if (!\*p) {
+ \*p = mm\_block;
+ mm\_block->parent = p;
+- mm\_block->prev\_free\_block = mm\_block->next\_free\_block = mm\_block;
++ mm\_block->prev\_free\_block = mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
+ heap->large\_free\_bitmap |= (ZEND\_MM\_LONG\_CONST(1) << index);
+ } else {
+ size\_t m;
+@@ -758,15 +835,15 @@ static inline void zend\_mm\_add\_to\_free\_l
+ if (!\*p) {
+ \*p = mm\_block;
+ mm\_block->parent = p;
+- mm\_block->prev\_free\_block = mm\_block->next\_free\_block = mm\_block;
++ mm\_block->prev\_free\_block = mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
+ break;
+ }
+ } else {
+- zend\_mm\_free\_block \*next = prev->next\_free\_block;
++ zend\_mm\_free\_block \*next = SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block);
+
+- prev->next\_free\_block = next->prev\_free\_block = mm\_block;
+- mm\_block->next\_free\_block = next;
+- mm\_block->prev\_free\_block = prev;
++ prev->next\_free\_block = next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
++ mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ mm\_block->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
+ mm\_block->parent = NULL;
+ break;
+ }
+@@ -778,27 +855,33 @@ static inline void zend\_mm\_add\_to\_free\_l
+ index = ZEND\_MM\_BUCKET\_INDEX(size);
+
+ prev = ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, index);
+- if (prev->prev\_free\_block == prev) {
++ if (SUHOSIN\_MANGLE\_PTR(prev->prev\_free\_block) == prev) {
+ heap->free\_bitmap |= (ZEND\_MM\_LONG\_CONST(1) << index);
+ }
+- next = prev->next\_free\_block;
++ next = SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block);
+
+- mm\_block->prev\_free\_block = prev;
+- mm\_block->next\_free\_block = next;
+- prev->next\_free\_block = next->prev\_free\_block = mm\_block;
++ mm\_block->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
++ mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ prev->next\_free\_block = next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
+ }
+ }
+
+-static inline void zend\_mm\_remove\_from\_free\_list(zend\_mm\_heap \*heap, zend\_mm\_free\_block \*mm\_block)
++static void zend\_mm\_remove\_from\_free\_list(zend\_mm\_heap \*heap, zend\_mm\_free\_block \*mm\_block)
+ {
+- zend\_mm\_free\_block \*prev = mm\_block->prev\_free\_block;
+- zend\_mm\_free\_block \*next = mm\_block->next\_free\_block;
++ zend\_mm\_free\_block \*prev = SUHOSIN\_MANGLE\_PTR(mm\_block->prev\_free\_block);
++ zend\_mm\_free\_block \*next = SUHOSIN\_MANGLE\_PTR(mm\_block->next\_free\_block);
+
+ ZEND\_MM\_CHECK\_MAGIC(mm\_block, MEM\_BLOCK\_FREED);
+
+ if (EXPECTED(prev == mm\_block)) {
+ zend\_mm\_free\_block \*\*rp, \*\*cp;
+
++#if SUHOSIN\_PATCH
++ if (next != mm\_block) {
++ zend\_suhosin\_log(S\_MEMORY, "zend\_mm\_heap corrupted at %p", mm\_block);
++ \_exit(1);
++ }
++#endif
+ #if ZEND\_MM\_SAFE\_UNLINKING
+ if (UNEXPECTED(next != mm\_block)) {
+ zend\_mm\_panic("zend\_mm\_heap corrupted");
+@@ -837,14 +920,21 @@ subst\_block:
+ }
+ } else {
+
++#if SUHOSIN\_PATCH
++ if (SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block) != mm\_block || SUHOSIN\_MANGLE\_PTR(next->prev\_free\_block) != mm\_block) {
++ zend\_suhosin\_log(S\_MEMORY, "zend\_mm\_head corrupted at %p", mm\_block);
++ \_exit(1);
++ }
++#endif
++
+ #if ZEND\_MM\_SAFE\_UNLINKING
+- if (UNEXPECTED(prev->next\_free\_block != mm\_block) || UNEXPECTED(next->prev\_free\_block != mm\_block)) {
++ if (UNEXPECTED(SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block) != mm\_block) || UNEXPECTED(SUHOSIN\_MANGLE\_PTR(next->prev\_free\_block) != mm\_block)) {
+ zend\_mm\_panic("zend\_mm\_heap corrupted");
+ }
+ #endif
+
+- prev->next\_free\_block = next;
+- next->prev\_free\_block = prev;
++ prev->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
+
+ if (EXPECTED(ZEND\_MM\_SMALL\_SIZE(ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block)))) {
+ if (EXPECTED(prev == next)) {
+@@ -860,7 +950,7 @@ subst\_block:
+ }
+ }
+
+-static inline void zend\_mm\_init(zend\_mm\_heap \*heap)
++static void zend\_mm\_init(zend\_mm\_heap \*heap)
+ {
+ zend\_mm\_free\_block\* p;
+ int i;
+@@ -878,12 +968,19 @@ static inline void zend\_mm\_init(zend\_mm\_
+ #endif
+ p = ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, 0);
+ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
+- p->next\_free\_block = p;
+- p->prev\_free\_block = p;
++ p->next\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
++ p->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
+ p = (zend\_mm\_free\_block\*)((char\*)p + sizeof(zend\_mm\_free\_block\*) \* 2);
+ heap->large\_free\_buckets[i] = NULL;
+ }
+- heap->rest\_buckets[0] = heap->rest\_buckets[1] = ZEND\_MM\_REST\_BUCKET(heap);
++ heap->rest\_buckets[0] = heap->rest\_buckets[1] = SUHOSIN\_MANGLE\_PTR(ZEND\_MM\_REST\_BUCKET(heap));
++#if SUHOSIN\_PATCH
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION)) {
++ zend\_canary(&heap->canary\_1, sizeof(heap->canary\_1));
++ zend\_canary(&heap->canary\_2, sizeof(heap->canary\_2));
++ zend\_canary(&heap->canary\_3, sizeof(heap->canary\_3));
++ }
++#endif
+ }
+
+ static void zend\_mm\_del\_segment(zend\_mm\_heap \*heap, zend\_mm\_segment \*segment)
+@@ -904,12 +1001,13 @@ static void zend\_mm\_free\_cache(zend\_mm\_h
+ int i;
+
+ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
++ /\* NULL means NULL even MANGLED \*/
+ if (heap->cache[i]) {
+- zend\_mm\_free\_block \*mm\_block = heap->cache[i];
++ zend\_mm\_free\_block \*mm\_block = SUHOSIN\_MANGLE\_PTR(heap->cache[i]);
+
+ while (mm\_block) {
+ size\_t size = ZEND\_MM\_BLOCK\_SIZE(mm\_block);
+- zend\_mm\_free\_block \*q = mm\_block->prev\_free\_block;
++ zend\_mm\_free\_block \*q = SUHOSIN\_MANGLE\_PTR(mm\_block->prev\_free\_block);
+ zend\_mm\_block \*next\_block = ZEND\_MM\_NEXT\_BLOCK(mm\_block);
+
+ heap->cached -= size;
+@@ -1005,14 +1103,20 @@ static void zend\_mm\_random(unsigned char
+ /\* }}} \*/
+ #endif
+
++
+ /\* Notes:
+ \* - This function may alter the block\_sizes values to match platform alignment
+ \* - This function does \*not\* perform sanity checks on the arguments
+ \*/
+-ZEND\_API zend\_mm\_heap \*zend\_mm\_startup\_ex(const zend\_mm\_mem\_handlers \*handlers, size\_t block\_size, size\_t reserve\_size, int internal, void \*params)
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++zend\_mm\_heap \*\_\_zend\_mm\_startup\_canary\_ex(const zend\_mm\_mem\_handlers \*handlers, size\_t block\_size, size\_t reserve\_size, int internal, void \*params)
++#else
++static zend\_mm\_heap \*\_\_zend\_mm\_startup\_ex(const zend\_mm\_mem\_handlers \*handlers, size\_t block\_size, size\_t reserve\_size, int internal, void \*params)
++#endif
+ {
+ zend\_mm\_storage \*storage;
+ zend\_mm\_heap \*heap;
++ zend\_mm\_free\_block \*tmp;
+
+ #if 0
+ int i;
+@@ -1046,6 +1150,12 @@ ZEND\_API zend\_mm\_heap \*zend\_mm\_startup\_e
+ }
+ #endif
+
++ /\* get the pointer guardian and ensure low 3 bits are 1 \*/
++ if (SUHOSIN\_POINTER\_GUARD == 0) {
++ zend\_canary(&SUHOSIN\_POINTER\_GUARD, sizeof(SUHOSIN\_POINTER\_GUARD));
++ SUHOSIN\_POINTER\_GUARD |= 7;
++ }
++
+ if (zend\_mm\_low\_bit(block\_size) != zend\_mm\_high\_bit(block\_size)) {
+ fprintf(stderr, "'block\_size' must be a power of two\n");
+ /\* See http://support.microsoft.com/kb/190351 \*/
+@@ -1087,12 +1197,12 @@ ZEND\_API zend\_mm\_heap \*zend\_mm\_startup\_e
+ heap->reserve = NULL;
+ heap->reserve\_size = reserve\_size;
+ if (reserve\_size > 0) {
+- heap->reserve = \_zend\_mm\_alloc\_int(heap, reserve\_size ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ heap->reserve = \_zend\_mm\_alloc(heap, reserve\_size ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
+ }
+ if (internal) {
+ int i;
+ zend\_mm\_free\_block \*p, \*q, \*orig;
+- zend\_mm\_heap \*mm\_heap = \_zend\_mm\_alloc\_int(heap, sizeof(zend\_mm\_heap) ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ zend\_mm\_heap \*mm\_heap = \_zend\_mm\_alloc(heap, sizeof(zend\_mm\_heap) ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
+
+ \*mm\_heap = \*heap;
+
+@@ -1100,22 +1210,25 @@ ZEND\_API zend\_mm\_heap \*zend\_mm\_startup\_e
+ orig = ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, 0);
+ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
+ q = p;
+- while (q->prev\_free\_block != orig) {
+- q = q->prev\_free\_block;
++ while (SUHOSIN\_MANGLE\_PTR(q->prev\_free\_block) != orig) {
++ q = SUHOSIN\_MANGLE\_PTR(q->prev\_free\_block);
+ }
+- q->prev\_free\_block = p;
++ q->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
+ q = p;
+- while (q->next\_free\_block != orig) {
+- q = q->next\_free\_block;
++ while (SUHOSIN\_MANGLE\_PTR(q->next\_free\_block) != orig) {
++ q = SUHOSIN\_MANGLE\_PTR(q->next\_free\_block);
+ }
+- q->next\_free\_block = p;
++ q->next\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
+ p = (zend\_mm\_free\_block\*)((char\*)p + sizeof(zend\_mm\_free\_block\*) \* 2);
+ orig = (zend\_mm\_free\_block\*)((char\*)orig + sizeof(zend\_mm\_free\_block\*) \* 2);
+ if (mm\_heap->large\_free\_buckets[i]) {
+ mm\_heap->large\_free\_buckets[i]->parent = &mm\_heap->large\_free\_buckets[i];
+ }
+ }
+- mm\_heap->rest\_buckets[0]->next\_free\_block = mm\_heap->rest\_buckets[1]->prev\_free\_block = ZEND\_MM\_REST\_BUCKET(mm\_heap);
++ tmp = SUHOSIN\_MANGLE\_PTR(mm\_heap->rest\_buckets[0]);
++ tmp->next\_free\_block = SUHOSIN\_MANGLE\_PTR(ZEND\_MM\_REST\_BUCKET(mm\_heap));
++ tmp = SUHOSIN\_MANGLE\_PTR(mm\_heap->rest\_buckets[1]);
++ tmp->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(ZEND\_MM\_REST\_BUCKET(mm\_heap));
+
+ free(heap);
+ heap = mm\_heap;
+@@ -1123,7 +1236,11 @@ ZEND\_API zend\_mm\_heap \*zend\_mm\_startup\_e
+ return heap;
+ }
+
+-ZEND\_API zend\_mm\_heap \*zend\_mm\_startup(void)
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++zend\_mm\_heap \*\_\_zend\_mm\_startup\_canary(void)
++#else
++static zend\_mm\_heap \*\_\_zend\_mm\_startup(void)
++#endif
+ {
+ int i;
+ size\_t seg\_size;
+@@ -1193,6 +1310,27 @@ ZEND\_API zend\_mm\_heap \*zend\_mm\_startup(v
+ return heap;
+ }
+
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
++zend\_mm\_heap\_canary \*\_\_zend\_mm\_startup\_canary\_ex(const zend\_mm\_mem\_handlers \*handlers, size\_t block\_size, size\_t reserve\_size, int internal, void \*params);
++zend\_mm\_heap\_canary \*\_\_zend\_mm\_startup\_canary(void);
++
++ZEND\_API zend\_mm\_heap \*zend\_mm\_startup\_ex(const zend\_mm\_mem\_handlers \*handlers, size\_t block\_size, size\_t reserve\_size, int internal, void \*params)
++{
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION)) {
++ return (zend\_mm\_heap \*)\_\_zend\_mm\_startup\_canary\_ex(handlers, block\_size, reserve\_size, internal, params);
++ }
++ return \_\_zend\_mm\_startup\_ex(handlers, block\_size, reserve\_size, internal, params);
++}
++ZEND\_API zend\_mm\_heap \*zend\_mm\_startup(void)
++{
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION)) {
++ return (zend\_mm\_heap \*)\_\_zend\_mm\_startup\_canary();
++ }
++ return \_\_zend\_mm\_startup();
++}
++
++#endif
++
+ #if ZEND\_DEBUG
+ static long zend\_mm\_find\_leaks(zend\_mm\_segment \*segment, zend\_mm\_block \*b)
+ {
+@@ -1561,7 +1699,11 @@ static int zend\_mm\_check\_heap(zend\_mm\_he
+ }
+ #endif
+
+-ZEND\_API void zend\_mm\_shutdown(zend\_mm\_heap \*heap, int full\_shutdown, int silent TSRMLS\_DC)
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++void \_\_zend\_mm\_shutdown\_canary(zend\_mm\_heap \*heap, int full\_shutdown, int silent TSRMLS\_DC)
++#else
++static void \_\_zend\_mm\_shutdown(zend\_mm\_heap \*heap, int full\_shutdown, int silent TSRMLS\_DC)
++#endif
+ {
+ zend\_mm\_storage \*storage;
+ zend\_mm\_segment \*segment;
+@@ -1571,7 +1713,7 @@ ZEND\_API void zend\_mm\_shutdown(zend\_mm\_h
+ if (heap->reserve) {
+ #if ZEND\_DEBUG
+ if (!silent) {
+- \_zend\_mm\_free\_int(heap, heap->reserve ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ \_zend\_mm\_free(heap, heap->reserve ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
+ }
+ #endif
+ heap->reserve = NULL;
+@@ -1654,12 +1796,23 @@ ZEND\_API void zend\_mm\_shutdown(zend\_mm\_h
+ heap->size = 0;
+ heap->peak = 0;
+ if (heap->reserve\_size) {
+- heap->reserve = \_zend\_mm\_alloc\_int(heap, heap->reserve\_size ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ heap->reserve = \_zend\_mm\_alloc(heap, heap->reserve\_size ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
+ }
+ heap->overflow = 0;
+ }
+ }
+
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
++ZEND\_API void zend\_mm\_shutdown(zend\_mm\_heap \*heap, int full\_shutdown, int silent TSRMLS\_DC)
++{
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION)) {
++ \_\_zend\_mm\_shutdown\_canary(heap, full\_shutdown, silent TSRMLS\_CC);
++ return;
++ }
++ \_\_zend\_mm\_shutdown(heap, full\_shutdown, silent TSRMLS\_CC);
++}
++#endif
++
+ static void zend\_mm\_safe\_error(zend\_mm\_heap \*heap,
+ const char \*format,
+ size\_t limit,
+@@ -1670,7 +1823,11 @@ static void zend\_mm\_safe\_error(zend\_mm\_h
+ size\_t size)
+ {
+ if (heap->reserve) {
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ \_zend\_mm\_free\_canary\_int(heap, heap->reserve ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++#else
+ \_zend\_mm\_free\_int(heap, heap->reserve ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++#endif
+ heap->reserve = NULL;
+ }
+ if (heap->overflow == 0) {
+@@ -1745,7 +1902,7 @@ static zend\_mm\_free\_block \*zend\_mm\_searc
+ p = heap->large\_free\_buckets[index];
+ for (m = true\_size << (ZEND\_MM\_NUM\_BUCKETS - index); ; m <<= 1) {
+ if (UNEXPECTED(ZEND\_MM\_FREE\_BLOCK\_SIZE(p) == true\_size)) {
+- return p->next\_free\_block;
++ return SUHOSIN\_MANGLE\_PTR(p->next\_free\_block);
+ } else if (ZEND\_MM\_FREE\_BLOCK\_SIZE(p) >= true\_size &&
+ ZEND\_MM\_FREE\_BLOCK\_SIZE(p) < best\_size) {
+ best\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(p);
+@@ -1769,7 +1926,7 @@ static zend\_mm\_free\_block \*zend\_mm\_searc
+
+ for (p = rst; p; p = p->child[p->child[0] != NULL]) {
+ if (UNEXPECTED(ZEND\_MM\_FREE\_BLOCK\_SIZE(p) == true\_size)) {
+- return p->next\_free\_block;
++ return SUHOSIN\_MANGLE\_PTR(p->next\_free\_block);
+ } else if (ZEND\_MM\_FREE\_BLOCK\_SIZE(p) > true\_size &&
+ ZEND\_MM\_FREE\_BLOCK\_SIZE(p) < best\_size) {
+ best\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(p);
+@@ -1778,7 +1935,7 @@ static zend\_mm\_free\_block \*zend\_mm\_searc
+ }
+
+ if (best\_fit) {
+- return best\_fit->next\_free\_block;
++ return SUHOSIN\_MANGLE\_PTR(best\_fit->next\_free\_block);
+ }
+ bitmap = bitmap >> 1;
+ if (!bitmap) {
+@@ -1794,9 +1951,12 @@ static zend\_mm\_free\_block \*zend\_mm\_searc
+ best\_fit = p;
+ }
+ }
+- return best\_fit->next\_free\_block;
++ return SUHOSIN\_MANGLE\_PTR(best\_fit->next\_free\_block);
+ }
+
++#if SUHOSIN\_PATCH
++void \*\_zend\_mm\_alloc\_canary\_int(zend\_mm\_heap\_canary \*heap, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC);
++#endif
+ static void \*\_zend\_mm\_alloc\_int(zend\_mm\_heap \*heap, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+ zend\_mm\_free\_block \*best\_fit;
+@@ -1806,7 +1966,7 @@ static void \*\_zend\_mm\_alloc\_int(zend\_mm\_
+ size\_t segment\_size;
+ zend\_mm\_segment \*segment;
+ int keep\_rest = 0;
+-
++
+ if (EXPECTED(ZEND\_MM\_SMALL\_SIZE(true\_size))) {
+ size\_t index = ZEND\_MM\_BUCKET\_INDEX(true\_size);
+ size\_t bitmap;
+@@ -1821,9 +1981,14 @@ static void \*\_zend\_mm\_alloc\_int(zend\_mm\_
+ heap->cache\_stat[index].count--;
+ heap->cache\_stat[index].hit++;
+ #endif
+- best\_fit = heap->cache[index];
++ best\_fit = SUHOSIN\_MANGLE\_PTR(heap->cache[index]);
+ heap->cache[index] = best\_fit->prev\_free\_block;
+ heap->cached -= true\_size;
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(best\_fit);
++ ((zend\_mm\_block\*)best\_fit)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(best\_fit);
++#endif
+ ZEND\_MM\_CHECK\_MAGIC(best\_fit, MEM\_BLOCK\_CACHED);
+ ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 0);
+ return ZEND\_MM\_DATA\_OF(best\_fit);
+@@ -1837,7 +2002,7 @@ static void \*\_zend\_mm\_alloc\_int(zend\_mm\_
+ if (bitmap) {
+ /\* Found some "small" free block that can be used \*/
+ index += zend\_mm\_low\_bit(bitmap);
+- best\_fit = heap->free\_buckets[index\*2];
++ best\_fit = SUHOSIN\_MANGLE\_PTR(heap->free\_buckets[index\*2]);
+ #if ZEND\_MM\_CACHE\_STAT
+ heap->cache\_stat[ZEND\_MM\_NUM\_BUCKETS].hit++;
+ #endif
+@@ -1852,7 +2017,7 @@ static void \*\_zend\_mm\_alloc\_int(zend\_mm\_
+ best\_fit = zend\_mm\_search\_large\_block(heap, true\_size);
+
+ if (!best\_fit && heap->real\_size >= heap->limit - heap->block\_size) {
+- zend\_mm\_free\_block \*p = heap->rest\_buckets[0];
++ zend\_mm\_free\_block \*p = SUHOSIN\_MANGLE\_PTR(heap->rest\_buckets[0]);
+ size\_t best\_size = -1;
+
+ while (p != ZEND\_MM\_REST\_BUCKET(heap)) {
+@@ -1864,7 +2029,7 @@ static void \*\_zend\_mm\_alloc\_int(zend\_mm\_
+ best\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(p);
+ best\_fit = p;
+ }
+- p = p->prev\_free\_block;
++ p = SUHOSIN\_MANGLE\_PTR(p->prev\_free\_block);
+ }
+ }
+
+@@ -1963,13 +2128,19 @@ zend\_mm\_finished\_searching\_for\_block:
+
+ ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 1);
+
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(best\_fit);
++ ((zend\_mm\_block\*)best\_fit)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(best\_fit);
++#endif
++
+ heap->size += true\_size;
+ if (heap->peak < heap->size) {
+ heap->peak = heap->size;
+ }
+
+ HANDLE\_UNBLOCK\_INTERRUPTIONS();
+-
++
+ return ZEND\_MM\_DATA\_OF(best\_fit);
+ }
+
+@@ -1986,19 +2157,26 @@ static void \_zend\_mm\_free\_int(zend\_mm\_he
+
+ mm\_block = ZEND\_MM\_HEADER\_OF(p);
+ size = ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_CHECK\_CANARIES(mm\_block, "efree()");
++#endif
+ ZEND\_MM\_CHECK\_PROTECTION(mm\_block);
+
+ #if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
+ memset(ZEND\_MM\_DATA\_OF(mm\_block), 0x5a, mm\_block->debug.size);
+ #endif
+-
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_DESTROY\_FREE\_MEMORY))) {
++ memset(ZEND\_MM\_DATA\_OF(mm\_block), 0x5a, mm\_block->info.size);
++ }
++#endif
+ #if ZEND\_MM\_CACHE
+ if (EXPECTED(ZEND\_MM\_SMALL\_SIZE(size)) && EXPECTED(heap->cached < ZEND\_MM\_CACHE\_SIZE)) {
+ size\_t index = ZEND\_MM\_BUCKET\_INDEX(size);
+ zend\_mm\_free\_block \*\*cache = &heap->cache[index];
+
+ ((zend\_mm\_free\_block\*)mm\_block)->prev\_free\_block = \*cache;
+- \*cache = (zend\_mm\_free\_block\*)mm\_block;
++ \*cache = (zend\_mm\_free\_block\*)SUHOSIN\_MANGLE\_PTR(mm\_block);
+ heap->cached += size;
+ ZEND\_MM\_SET\_MAGIC(mm\_block, MEM\_BLOCK\_CACHED);
+ #if ZEND\_MM\_CACHE\_STAT
+@@ -2034,6 +2212,9 @@ static void \_zend\_mm\_free\_int(zend\_mm\_he
+ HANDLE\_UNBLOCK\_INTERRUPTIONS();
+ }
+
++#if SUHOSIN\_PATCH
++void \*\_zend\_mm\_realloc\_canary\_int(zend\_mm\_heap\_canary \*heap, void \*p, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC);
++#endif
+ static void \*\_zend\_mm\_realloc\_int(zend\_mm\_heap \*heap, void \*p, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+ zend\_mm\_block \*mm\_block = ZEND\_MM\_HEADER\_OF(p);
+@@ -2043,11 +2224,18 @@ static void \*\_zend\_mm\_realloc\_int(zend\_m
+ void \*ptr;
+
+ if (UNEXPECTED(!p) || !ZEND\_MM\_VALID\_PTR(p)) {
++#ifdef SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ return \_zend\_mm\_alloc\_canary\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#else
+ return \_zend\_mm\_alloc\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+ mm\_block = ZEND\_MM\_HEADER\_OF(p);
+ true\_size = ZEND\_MM\_TRUE\_SIZE(size);
+ orig\_size = ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_CHECK\_CANARIES(mm\_block, "erealloc()");
++#endif
+ ZEND\_MM\_CHECK\_PROTECTION(mm\_block);
+
+ if (UNEXPECTED(true\_size < size)) {
+@@ -2079,6 +2267,11 @@ static void \*\_zend\_mm\_realloc\_int(zend\_m
+ HANDLE\_UNBLOCK\_INTERRUPTIONS();
+ }
+ ZEND\_MM\_SET\_DEBUG\_INFO(mm\_block, size, 0, 0);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(mm\_block);
++ ((zend\_mm\_block\*)mm\_block)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(mm\_block);
++#endif
+ return p;
+ }
+
+@@ -2094,17 +2287,22 @@ static void \*\_zend\_mm\_realloc\_int(zend\_m
+ heap->cache\_stat[index].count--;
+ heap->cache\_stat[index].hit++;
+ #endif
+- best\_fit = heap->cache[index];
++ best\_fit = SUHOSIN\_MANGLE\_PTR(heap->cache[index]);
+ heap->cache[index] = best\_fit->prev\_free\_block;
+ ZEND\_MM\_CHECK\_MAGIC(best\_fit, MEM\_BLOCK\_CACHED);
+- ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 0);
+-
++ ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 0);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(best\_fit);
++ ((zend\_mm\_block\*)best\_fit)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(best\_fit);
++#endif
++
+ ptr = ZEND\_MM\_DATA\_OF(best\_fit);
+
+ #if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
+ memcpy(ptr, p, mm\_block->debug.size);
+ #else
+- memcpy(ptr, p, orig\_size - ZEND\_MM\_ALIGNED\_HEADER\_SIZE);
++ memcpy(ptr, p, orig\_size - ZEND\_MM\_ALIGNED\_HEADER\_SIZE - CANARY\_SIZE);
+ #endif
+
+ heap->cached -= true\_size - orig\_size;
+@@ -2113,14 +2311,13 @@ static void \*\_zend\_mm\_realloc\_int(zend\_m
+ cache = &heap->cache[index];
+
+ ((zend\_mm\_free\_block\*)mm\_block)->prev\_free\_block = \*cache;
+- \*cache = (zend\_mm\_free\_block\*)mm\_block;
++ \*cache = (zend\_mm\_free\_block\*)SUHOSIN\_MANGLE\_PTR(mm\_block);
+ ZEND\_MM\_SET\_MAGIC(mm\_block, MEM\_BLOCK\_CACHED);
+ #if ZEND\_MM\_CACHE\_STAT
+ if (++heap->cache\_stat[index].count > heap->cache\_stat[index].max\_count) {
+ heap->cache\_stat[index].max\_count = heap->cache\_stat[index].count;
+ }
+ #endif
+-
+ return ptr;
+ }
+ }
+@@ -2163,6 +2360,11 @@ static void \*\_zend\_mm\_realloc\_int(zend\_m
+ heap->peak = heap->size;
+ }
+ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(mm\_block);
++ ((zend\_mm\_block\*)mm\_block)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(mm\_block);
++#endif
+ return p;
+ } else if (ZEND\_MM\_IS\_FIRST\_BLOCK(mm\_block) &&
+ ZEND\_MM\_IS\_GUARD\_BLOCK(ZEND\_MM\_BLOCK\_AT(next\_block, ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block)))) {
+@@ -2265,38 +2467,90 @@ out\_of\_memory:
+ }
+
+ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(mm\_block);
++ ((zend\_mm\_block\*)mm\_block)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(mm\_block);
++#endif
+ return ZEND\_MM\_DATA\_OF(mm\_block);
+ }
+
++#ifdef SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ ptr = \_zend\_mm\_alloc\_canary\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#else
+ ptr = \_zend\_mm\_alloc\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ #if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
+ memcpy(ptr, p, mm\_block->debug.size);
+ #else
+- memcpy(ptr, p, orig\_size - ZEND\_MM\_ALIGNED\_HEADER\_SIZE);
++ memcpy(ptr, p, orig\_size - ZEND\_MM\_ALIGNED\_HEADER\_SIZE - CANARY\_SIZE);
+ #endif
++#ifdef SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ \_zend\_mm\_free\_canary\_int(heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#else
+ \_zend\_mm\_free\_int(heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ return ptr;
+ }
+
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
+ ZEND\_API void \*\_zend\_mm\_alloc(zend\_mm\_heap \*heap, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+- return \_zend\_mm\_alloc\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
++ return \_zend\_mm\_alloc\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ return \_zend\_mm\_alloc\_canary\_int((zend\_mm\_heap\_canary \*)heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+
+ ZEND\_API void \_zend\_mm\_free(zend\_mm\_heap \*heap, void \*p ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+- \_zend\_mm\_free\_int(heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
++ { \_zend\_mm\_free\_int(heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC); return; }
++#if SUHOSIN\_PATCH
++ \_zend\_mm\_free\_canary\_int((zend\_mm\_heap\_canary \*)heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+
+ ZEND\_API void \*\_zend\_mm\_realloc(zend\_mm\_heap \*heap, void \*ptr, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+- return \_zend\_mm\_realloc\_int(heap, ptr, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
++ return \_zend\_mm\_realloc\_int(heap, ptr, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ return \_zend\_mm\_realloc\_canary\_int((zend\_mm\_heap\_canary \*)heap, ptr, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+
+ ZEND\_API size\_t \_zend\_mm\_block\_size(zend\_mm\_heap \*heap, void \*p ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+ zend\_mm\_block \*mm\_block;
+
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) != 0) {
++ return \_zend\_mm\_block\_size\_canary((zend\_mm\_heap\_canary \*)heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++
++ if (!ZEND\_MM\_VALID\_PTR(p)) {
++ return 0;
++ }
++ mm\_block = ZEND\_MM\_HEADER\_OF(p);
++ ZEND\_MM\_CHECK\_PROTECTION(mm\_block);
++#if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
++ return mm\_block->debug.size;
++#else
++ return ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++#endif
++}
++#else
++ZEND\_API size\_t \_zend\_mm\_block\_size\_canary(zend\_mm\_heap \*heap, void \*p ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_block \*mm\_block;
++
+ if (!ZEND\_MM\_VALID\_PTR(p)) {
+ return 0;
+ }
+@@ -2309,6 +2563,8 @@ ZEND\_API size\_t \_zend\_mm\_block\_size(zend
+ #endif
+ }
+
++#endif
++
+ /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
+ /\* Allocation Manager \*/
+ /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
+@@ -2325,6 +2581,7 @@ static int alloc\_globals\_id;
+ static zend\_alloc\_globals alloc\_globals;
+ #endif
+
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
+ ZEND\_API int is\_zend\_mm(TSRMLS\_D)
+ {
+ return AG(mm\_heap)->use\_zend\_alloc;
+@@ -2337,7 +2594,13 @@ ZEND\_API void \*\_emalloc(size\_t size ZEND
+ if (UNEXPECTED(!AG(mm\_heap)->use\_zend\_alloc)) {
+ return AG(mm\_heap)->\_malloc(size);
+ }
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
+ return \_zend\_mm\_alloc\_int(AG(mm\_heap), size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ return \_zend\_mm\_alloc\_canary\_int((zend\_mm\_heap\_canary \*)AG(mm\_heap), size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+
+ ZEND\_API void \_efree(void \*ptr ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+@@ -2348,7 +2611,13 @@ ZEND\_API void \_efree(void \*ptr ZEND\_FILE
+ AG(mm\_heap)->\_free(ptr);
+ return;
+ }
+- \_zend\_mm\_free\_int(AG(mm\_heap), ptr ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
++ { \_zend\_mm\_free\_int(AG(mm\_heap), ptr ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC); return; }
++#if SUHOSIN\_PATCH
++ \_zend\_mm\_free\_canary\_int((zend\_mm\_heap\_canary \*)AG(mm\_heap), ptr ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+
+ ZEND\_API void \*\_erealloc(void \*ptr, size\_t size, int allow\_failure ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+@@ -2358,7 +2627,13 @@ ZEND\_API void \*\_erealloc(void \*ptr, size
+ if (UNEXPECTED(!AG(mm\_heap)->use\_zend\_alloc)) {
+ return AG(mm\_heap)->\_realloc(ptr, size);
+ }
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
+ return \_zend\_mm\_realloc\_int(AG(mm\_heap), ptr, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ return \_zend\_mm\_realloc\_canary\_int((zend\_mm\_heap\_canary \*)AG(mm\_heap), ptr, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
+
+ ZEND\_API size\_t \_zend\_mem\_block\_size(void \*ptr TSRMLS\_DC ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+@@ -2366,8 +2641,15 @@ ZEND\_API size\_t \_zend\_mem\_block\_size(voi
+ if (UNEXPECTED(!AG(mm\_heap)->use\_zend\_alloc)) {
+ return 0;
+ }
+- return \_zend\_mm\_block\_size(AG(mm\_heap), ptr ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION) == 0))
++#endif
++ return \_zend\_mm\_block\_size(AG(mm\_heap), ptr ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if SUHOSIN\_PATCH
++ return \_zend\_mm\_block\_size\_canary((zend\_mm\_heap\_canary \*)AG(mm\_heap), ptr ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#endif
+ }
++#endif
+
+ #if defined(\_\_GNUC\_\_) && defined(i386)
+
+@@ -2438,7 +2720,7 @@ static inline size\_t safe\_address(size\_t
+ }
+ #endif
+
+-
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
+ ZEND\_API void \*\_safe\_emalloc(size\_t nmemb, size\_t size, size\_t offset ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
+ {
+ return emalloc\_rel(safe\_address(nmemb, size, offset));
+@@ -2551,6 +2833,7 @@ ZEND\_API void shutdown\_memory\_manager(in
+ {
+ zend\_mm\_shutdown(AG(mm\_heap), full\_shutdown, silent TSRMLS\_CC);
+ }
++#endif
+
+ static void alloc\_globals\_ctor(zend\_alloc\_globals \*alloc\_globals TSRMLS\_DC)
+ {
+@@ -2575,6 +2858,7 @@ static void alloc\_globals\_dtor(zend\_allo
+ }
+ #endif
+
++#ifndef SUHOSIN\_MM\_CLONE\_FILE
+ ZEND\_API void start\_memory\_manager(TSRMLS\_D)
+ {
+ #ifdef ZTS
+@@ -2639,6 +2923,7 @@ ZEND\_API void \_full\_mem\_check(int silent
+ zend\_debug\_alloc\_output("------------------------------------------------\n");
+ }
+ #endif
++#endif
+
+ /\*
+ \* Local variables:
+--- a/Zend/zend\_alloc.h
++++ b/Zend/zend\_alloc.h
+@@ -203,6 +203,8 @@ END\_EXTERN\_C()
+
+ /\* Heap functions \*/
+ typedef struct \_zend\_mm\_heap zend\_mm\_heap;
++typedef struct \_zend\_mm\_heap\_canary zend\_mm\_heap\_canary;
++
+
+ ZEND\_API zend\_mm\_heap \*zend\_mm\_startup(void);
+ ZEND\_API void zend\_mm\_shutdown(zend\_mm\_heap \*heap, int full\_shutdown, int silent TSRMLS\_DC);
+--- /dev/null
++++ b/Zend/zend\_alloc\_canary.c
+@@ -0,0 +1,2502 @@
++/\*
++ +----------------------------------------------------------------------+
++ | Suhosin-Patch for PHP |
++ +----------------------------------------------------------------------+
++ | Copyright (c) 2004-2010 Stefan Esser |
++ +----------------------------------------------------------------------+
++ | This source file is subject to version 2.02 of the PHP license, |
++ | that is bundled with this package in the file LICENSE, and is |
++ | available at through the world-wide-web at |
++ | http://www.php.net/license/2\_02.txt. |
++ | If you did not receive a copy of the PHP license and are unable to |
++ | obtain it through the world-wide-web, please send a note to |
++ | license@php.net so we can mail you a copy immediately. |
++ +----------------------------------------------------------------------+
++ | Author: Stefan Esser  |
++ +----------------------------------------------------------------------+
++ \*/
++/\* $Id: zend\_alloc\_canary.c, $ \*/
++
++#include "zend.h"
++#include "zend\_alloc.h"
++#include "zend\_globals.h"
++#include "zend\_operators.h"
++
++#ifdef HAVE\_SIGNAL\_H
++# include
++#endif
++#ifdef HAVE\_UNISTD\_H
++# include
++#endif
++
++#if SUHOSIN\_PATCH
++#include "suhosin\_patch.h"
++#endif
++
++#ifdef ZEND\_WIN32
++# include
++# include
++#endif
++
++#ifndef ZEND\_MM\_HEAP\_PROTECTION
++# define ZEND\_MM\_HEAP\_PROTECTION ZEND\_DEBUG
++#endif
++
++#ifndef ZEND\_MM\_SAFE\_UNLINKING
++# define ZEND\_MM\_SAFE\_UNLINKING 1
++#endif
++
++#ifndef ZEND\_MM\_COOKIES
++# define ZEND\_MM\_COOKIES ZEND\_DEBUG
++#endif
++
++#ifdef \_WIN64
++# define PTR\_FMT "0x%0.16I64x"
++/\*
++#elif sizeof(long) == 8
++# define PTR\_FMT "0x%0.16lx"
++\*/
++#else
++# define PTR\_FMT "0x%0.8lx"
++#endif
++
++#define SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION 1
++
++#if (defined (\_\_GNUC\_\_) && \_\_GNUC\_\_ > 2 ) && !defined(\_\_INTEL\_COMPILER) && !defined(DARWIN) && !defined(\_\_hpux) && !defined(\_AIX)
++static void zend\_mm\_panic(const char \*message) \_\_attribute\_\_ ((noreturn));
++#endif
++
++static void zend\_mm\_panic(const char \*message)
++{
++ fprintf(stderr, "%s\n", message);
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++#if ZEND\_DEBUG && defined(HAVE\_KILL) && defined(HAVE\_GETPID)
++ kill(getpid(), SIGSEGV);
++#endif
++ exit(1);
++}
++
++/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
++/\* Storage Manager \*/
++/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
++
++#ifdef ZEND\_WIN32
++# define HAVE\_MEM\_WIN32 /\* use VirtualAlloc() to allocate memory \*/
++#endif
++#define HAVE\_MEM\_MALLOC /\* use malloc() to allocate segments \*/
++
++#include
++#include
++#if HAVE\_LIMITS\_H
++#include
++#endif
++#include
++#include
++
++#if defined(HAVE\_MEM\_MMAP\_ANON) || defined(HAVE\_MEM\_MMAP\_ZERO)
++# ifdef HAVE\_MREMAP
++# ifndef \_GNU\_SOURCE
++# define \_GNU\_SOURCE
++# endif
++# ifndef \_\_USE\_GNU
++# define \_\_USE\_GNU
++# endif
++# endif
++# include
++# ifndef MAP\_ANON
++# ifdef MAP\_ANONYMOUS
++# define MAP\_ANON MAP\_ANONYMOUS
++# endif
++# endif
++# ifndef MREMAP\_MAYMOVE
++# define MREMAP\_MAYMOVE 0
++# endif
++# ifndef MAP\_FAILED
++# define MAP\_FAILED ((void\*)-1)
++# endif
++#endif
++
++static zend\_intptr\_t SUHOSIN\_POINTER\_GUARD = 0;
++
++static zend\_mm\_storage\* zend\_mm\_mem\_dummy\_init(void \*params)
++{
++ return malloc(sizeof(zend\_mm\_storage));
++}
++
++static void zend\_mm\_mem\_dummy\_dtor(zend\_mm\_storage \*storage)
++{
++ free(storage);
++}
++
++static void zend\_mm\_mem\_dummy\_compact(zend\_mm\_storage \*storage)
++{
++}
++
++#if defined(HAVE\_MEM\_MMAP\_ANON) || defined(HAVE\_MEM\_MMAP\_ZERO)
++
++static zend\_mm\_segment\* zend\_mm\_mem\_mmap\_realloc(zend\_mm\_storage \*storage, zend\_mm\_segment\* segment, size\_t size)
++{
++ zend\_mm\_segment \*ret;
++#ifdef HAVE\_MREMAP
++#if defined(\_\_NetBSD\_\_)
++ /\* NetBSD 5 supports mremap but takes an extra newp argument \*/
++ ret = (zend\_mm\_segment\*)mremap(segment, segment->size, segment, size, MREMAP\_MAYMOVE);
++#else
++ ret = (zend\_mm\_segment\*)mremap(segment, segment->size, size, MREMAP\_MAYMOVE);
++#endif
++ if (ret == MAP\_FAILED) {
++#endif
++ ret = storage->handlers->\_alloc(storage, size);
++ if (ret) {
++ memcpy(ret, segment, size > segment->size ? segment->size : size);
++ storage->handlers->\_free(storage, segment);
++ }
++#ifdef HAVE\_MREMAP
++ }
++#endif
++ return ret;
++}
++
++static void zend\_mm\_mem\_mmap\_free(zend\_mm\_storage \*storage, zend\_mm\_segment\* segment)
++{
++ munmap((void\*)segment, segment->size);
++}
++
++#endif
++
++#ifdef HAVE\_MEM\_MMAP\_ANON
++
++static zend\_mm\_segment\* zend\_mm\_mem\_mmap\_anon\_alloc(zend\_mm\_storage \*storage, size\_t size)
++{
++ zend\_mm\_segment \*ret = (zend\_mm\_segment\*)mmap(NULL, size, PROT\_READ | PROT\_WRITE, MAP\_PRIVATE | MAP\_ANON, -1, 0);
++ if (ret == MAP\_FAILED) {
++ ret = NULL;
++ }
++ return ret;
++}
++
++# define ZEND\_MM\_MEM\_MMAP\_ANON\_DSC {"mmap\_anon", zend\_mm\_mem\_dummy\_init, zend\_mm\_mem\_dummy\_dtor, zend\_mm\_mem\_dummy\_compact, zend\_mm\_mem\_mmap\_anon\_alloc, zend\_mm\_mem\_mmap\_realloc, zend\_mm\_mem\_mmap\_free}
++
++#endif
++
++#ifdef HAVE\_MEM\_MMAP\_ZERO
++
++static int zend\_mm\_dev\_zero\_fd = -1;
++
++static zend\_mm\_storage\* zend\_mm\_mem\_mmap\_zero\_init(void \*params)
++{
++ if (zend\_mm\_dev\_zero\_fd != -1) {
++ zend\_mm\_dev\_zero\_fd = open("/dev/zero", O\_RDWR, S\_IRUSR | S\_IWUSR);
++ }
++ if (zend\_mm\_dev\_zero\_fd >= 0) {
++ return malloc(sizeof(zend\_mm\_storage));
++ } else {
++ return NULL;
++ }
++}
++
++static void zend\_mm\_mem\_mmap\_zero\_dtor(zend\_mm\_storage \*storage)
++{
++ close(zend\_mm\_dev\_zero\_fd);
++ free(storage);
++}
++
++static zend\_mm\_segment\* zend\_mm\_mem\_mmap\_zero\_alloc(zend\_mm\_storage \*storage, size\_t size)
++{
++ zend\_mm\_segment \*ret = (zend\_mm\_segment\*)mmap(NULL, size, PROT\_READ | PROT\_WRITE, MAP\_PRIVATE, zend\_mm\_dev\_zero\_fd, 0);
++ if (ret == MAP\_FAILED) {
++ ret = NULL;
++ }
++ return ret;
++}
++
++# define ZEND\_MM\_MEM\_MMAP\_ZERO\_DSC {"mmap\_zero", zend\_mm\_mem\_mmap\_zero\_init, zend\_mm\_mem\_mmap\_zero\_dtor, zend\_mm\_mem\_dummy\_compact, zend\_mm\_mem\_mmap\_zero\_alloc, zend\_mm\_mem\_mmap\_realloc, zend\_mm\_mem\_mmap\_free}
++
++#endif
++
++#ifdef HAVE\_MEM\_WIN32
++
++static zend\_mm\_storage\* zend\_mm\_mem\_win32\_init(void \*params)
++{
++ HANDLE heap = HeapCreate(HEAP\_NO\_SERIALIZE, 0, 0);
++ zend\_mm\_storage\* storage;
++
++ if (heap == NULL) {
++ return NULL;
++ }
++ storage = (zend\_mm\_storage\*)malloc(sizeof(zend\_mm\_storage));
++ storage->data = (void\*) heap;
++ return storage;
++}
++
++static void zend\_mm\_mem\_win32\_dtor(zend\_mm\_storage \*storage)
++{
++ HeapDestroy((HANDLE)storage->data);
++ free(storage);
++}
++
++static void zend\_mm\_mem\_win32\_compact(zend\_mm\_storage \*storage)
++{
++ HeapDestroy((HANDLE)storage->data);
++ storage->data = (void\*)HeapCreate(HEAP\_NO\_SERIALIZE, 0, 0);
++}
++
++static zend\_mm\_segment\* zend\_mm\_mem\_win32\_alloc(zend\_mm\_storage \*storage, size\_t size)
++{
++ return (zend\_mm\_segment\*) HeapAlloc((HANDLE)storage->data, HEAP\_NO\_SERIALIZE, size);
++}
++
++static void zend\_mm\_mem\_win32\_free(zend\_mm\_storage \*storage, zend\_mm\_segment\* segment)
++{
++ HeapFree((HANDLE)storage->data, HEAP\_NO\_SERIALIZE, segment);
++}
++
++static zend\_mm\_segment\* zend\_mm\_mem\_win32\_realloc(zend\_mm\_storage \*storage, zend\_mm\_segment\* segment, size\_t size)
++{
++ return (zend\_mm\_segment\*) HeapReAlloc((HANDLE)storage->data, HEAP\_NO\_SERIALIZE, segment, size);
++}
++
++# define ZEND\_MM\_MEM\_WIN32\_DSC {"win32", zend\_mm\_mem\_win32\_init, zend\_mm\_mem\_win32\_dtor, zend\_mm\_mem\_win32\_compact, zend\_mm\_mem\_win32\_alloc, zend\_mm\_mem\_win32\_realloc, zend\_mm\_mem\_win32\_free}
++
++#endif
++
++#ifdef HAVE\_MEM\_MALLOC
++
++static zend\_mm\_segment\* zend\_mm\_mem\_malloc\_alloc(zend\_mm\_storage \*storage, size\_t size)
++{
++ return (zend\_mm\_segment\*)malloc(size);
++}
++
++static zend\_mm\_segment\* zend\_mm\_mem\_malloc\_realloc(zend\_mm\_storage \*storage, zend\_mm\_segment \*ptr, size\_t size)
++{
++ return (zend\_mm\_segment\*)realloc(ptr, size);
++}
++
++static void zend\_mm\_mem\_malloc\_free(zend\_mm\_storage \*storage, zend\_mm\_segment \*ptr)
++{
++ free(ptr);
++}
++
++# define ZEND\_MM\_MEM\_MALLOC\_DSC {"malloc", zend\_mm\_mem\_dummy\_init, zend\_mm\_mem\_dummy\_dtor, zend\_mm\_mem\_dummy\_compact, zend\_mm\_mem\_malloc\_alloc, zend\_mm\_mem\_malloc\_realloc, zend\_mm\_mem\_malloc\_free}
++
++#endif
++
++static const zend\_mm\_mem\_handlers mem\_handlers[] = {
++#ifdef HAVE\_MEM\_WIN32
++ ZEND\_MM\_MEM\_WIN32\_DSC,
++#endif
++#ifdef HAVE\_MEM\_MALLOC
++ ZEND\_MM\_MEM\_MALLOC\_DSC,
++#endif
++#ifdef HAVE\_MEM\_MMAP\_ANON
++ ZEND\_MM\_MEM\_MMAP\_ANON\_DSC,
++#endif
++#ifdef HAVE\_MEM\_MMAP\_ZERO
++ ZEND\_MM\_MEM\_MMAP\_ZERO\_DSC,
++#endif
++ {NULL, NULL, NULL, NULL, NULL, NULL}
++};
++
++# define ZEND\_MM\_STORAGE\_DTOR() heap->storage->handlers->dtor(heap->storage)
++# define ZEND\_MM\_STORAGE\_ALLOC(size) heap->storage->handlers->\_alloc(heap->storage, size)
++# define ZEND\_MM\_STORAGE\_REALLOC(ptr, size) heap->storage->handlers->\_realloc(heap->storage, ptr, size)
++# define ZEND\_MM\_STORAGE\_FREE(ptr) heap->storage->handlers->\_free(heap->storage, ptr)
++
++/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
++/\* Heap Manager \*/
++/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
++
++#define MEM\_BLOCK\_VALID 0x7312F8DC
++#define MEM\_BLOCK\_FREED 0x99954317
++#define MEM\_BLOCK\_CACHED 0xFB8277DC
++#define MEM\_BLOCK\_GUARD 0x2A8FCC84
++#define MEM\_BLOCK\_LEAK 0x6C5E8F2D
++
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++# define CANARY\_SIZE sizeof(size\_t)
++#else
++# define CANARY\_SIZE 0
++#endif
++
++/\* mm block type \*/
++typedef struct \_zend\_mm\_block\_info\_canary {
++#if ZEND\_MM\_COOKIES
++ size\_t \_cookie;
++#endif
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ size\_t canary\_1;
++#endif
++ size\_t \_size;
++ size\_t \_prev;
++#if SUHOSIN\_PATCH
++ size\_t size;
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++ size\_t canary\_2;
++#endif
++#endif
++} zend\_mm\_block\_info\_canary;
++
++#if ZEND\_DEBUG
++
++typedef struct \_zend\_mm\_debug\_info\_canary {
++ char \*filename;
++ uint lineno;
++ char \*orig\_filename;
++ uint orig\_lineno;
++ size\_t size;
++#if ZEND\_MM\_HEAP\_PROTECTION
++ unsigned int start\_magic;
++#endif
++} zend\_mm\_debug\_info\_canary;
++
++#elif ZEND\_MM\_HEAP\_PROTECTION
++
++typedef struct \_zend\_mm\_debug\_info\_canary {
++ size\_t size;
++ unsigned int start\_magic;
++} zend\_mm\_debug\_info\_canary;
++
++#endif
++
++typedef struct \_zend\_mm\_block\_canary {
++ zend\_mm\_block\_info\_canary info;
++#if ZEND\_DEBUG
++ unsigned int magic;
++# ifdef ZTS
++ THREAD\_T thread\_id;
++# endif
++ zend\_mm\_debug\_info\_canary debug;
++#elif ZEND\_MM\_HEAP\_PROTECTION
++ zend\_mm\_debug\_info\_canary debug;
++#endif
++} zend\_mm\_block\_canary;
++
++typedef struct \_zend\_mm\_small\_free\_block\_canary {
++ zend\_mm\_block\_info\_canary info;
++#if ZEND\_DEBUG
++ unsigned int magic;
++# ifdef ZTS
++ THREAD\_T thread\_id;
++# endif
++#endif
++ struct \_zend\_mm\_free\_block\_canary \*prev\_free\_block;
++ struct \_zend\_mm\_free\_block\_canary \*next\_free\_block;
++} zend\_mm\_small\_free\_block\_canary;
++
++typedef struct \_zend\_mm\_free\_block\_canary {
++ zend\_mm\_block\_info\_canary info;
++#if ZEND\_DEBUG
++ unsigned int magic;
++# ifdef ZTS
++ THREAD\_T thread\_id;
++# endif
++#endif
++ struct \_zend\_mm\_free\_block\_canary \*prev\_free\_block;
++ struct \_zend\_mm\_free\_block\_canary \*next\_free\_block;
++
++ struct \_zend\_mm\_free\_block\_canary \*\*parent;
++ struct \_zend\_mm\_free\_block\_canary \*child[2];
++} zend\_mm\_free\_block\_canary;
++
++#define ZEND\_MM\_NUM\_BUCKETS (sizeof(size\_t) << 3)
++
++#define ZEND\_MM\_CACHE 1
++#define ZEND\_MM\_CACHE\_SIZE (ZEND\_MM\_NUM\_BUCKETS \* 4 \* 1024)
++
++#ifndef ZEND\_MM\_CACHE\_STAT
++# define ZEND\_MM\_CACHE\_STAT 0
++#endif
++
++typedef struct \_zend\_mm\_heap\_canary {
++ int use\_zend\_alloc;
++ void \*(\*\_malloc)(size\_t);
++ void (\*\_free)(void\*);
++ void \*(\*\_realloc)(void\*, size\_t);
++ size\_t free\_bitmap;
++ size\_t large\_free\_bitmap;
++ size\_t block\_size;
++ size\_t compact\_size;
++ zend\_mm\_segment \*segments\_list;
++ zend\_mm\_storage \*storage;
++ size\_t real\_size;
++ size\_t real\_peak;
++ size\_t limit;
++ size\_t size;
++ size\_t peak;
++ size\_t reserve\_size;
++ void \*reserve;
++ int overflow;
++ int internal;
++#if ZEND\_MM\_CACHE
++ unsigned int cached;
++ zend\_mm\_free\_block\_canary \*cache[ZEND\_MM\_NUM\_BUCKETS];
++#endif
++ zend\_mm\_free\_block\_canary \*free\_buckets[ZEND\_MM\_NUM\_BUCKETS\*2];
++ zend\_mm\_free\_block\_canary \*large\_free\_buckets[ZEND\_MM\_NUM\_BUCKETS];
++ zend\_mm\_free\_block\_canary \*rest\_buckets[2];
++#if ZEND\_MM\_CACHE\_STAT
++ struct {
++ int count;
++ int max\_count;
++ int hit;
++ int miss;
++ } cache\_stat[ZEND\_MM\_NUM\_BUCKETS+1];
++#endif
++#if SUHOSIN\_PATCH
++ size\_t canary\_1,canary\_2,canary\_3;
++#endif
++};
++
++#define ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, index) \
++ (zend\_mm\_free\_block\_canary\*) ((char\*)&heap->free\_buckets[index \* 2] + \
++ sizeof(zend\_mm\_free\_block\_canary\*) \* 2 - \
++ sizeof(zend\_mm\_small\_free\_block\_canary))
++
++#define ZEND\_MM\_REST\_BUCKET(heap) \
++ (zend\_mm\_free\_block\_canary\*)((char\*)&heap->rest\_buckets[0] + \
++ sizeof(zend\_mm\_free\_block\_canary\*) \* 2 - \
++ sizeof(zend\_mm\_small\_free\_block\_canary))
++
++#if ZEND\_MM\_COOKIES
++
++static unsigned int \_zend\_mm\_cookie = 0;
++
++# define ZEND\_MM\_COOKIE(block) \
++ (((size\_t)(block)) ^ \_zend\_mm\_cookie)
++# define ZEND\_MM\_SET\_COOKIE(block) \
++ (block)->info.\_cookie = ZEND\_MM\_COOKIE(block)
++# define ZEND\_MM\_CHECK\_COOKIE(block) \
++ if (UNEXPECTED((block)->info.\_cookie != ZEND\_MM\_COOKIE(block))) { \
++ zend\_mm\_panic("zend\_mm\_heap corrupted"); \
++ }
++#else
++# define ZEND\_MM\_SET\_COOKIE(block)
++# define ZEND\_MM\_CHECK\_COOKIE(block)
++#endif
++
++/\* Default memory segment size \*/
++#define ZEND\_MM\_SEG\_SIZE (256 \* 1024)
++
++/\* Reserved space for error reporting in case of memory overflow \*/
++#define ZEND\_MM\_RESERVE\_SIZE (8\*1024)
++
++#ifdef \_WIN64
++# define ZEND\_MM\_LONG\_CONST(x) (x##i64)
++#else
++# define ZEND\_MM\_LONG\_CONST(x) (x##L)
++#endif
++
++#define ZEND\_MM\_TYPE\_MASK ZEND\_MM\_LONG\_CONST(0x3)
++
++#define ZEND\_MM\_FREE\_BLOCK ZEND\_MM\_LONG\_CONST(0x0)
++#define ZEND\_MM\_USED\_BLOCK ZEND\_MM\_LONG\_CONST(0x1)
++#define ZEND\_MM\_GUARD\_BLOCK ZEND\_MM\_LONG\_CONST(0x3)
++
++#define ZEND\_MM\_BLOCK(b, type, size) do { \
++ size\_t \_size = (size); \
++ (b)->info.\_size = (type) | \_size; \
++ ZEND\_MM\_BLOCK\_AT(b, \_size)->info.\_prev = (type) | \_size; \
++ ZEND\_MM\_SET\_COOKIE(b); \
++ } while (0);
++#define ZEND\_MM\_LAST\_BLOCK(b) do { \
++ (b)->info.\_size = ZEND\_MM\_GUARD\_BLOCK | ZEND\_MM\_ALIGNED\_HEADER\_SIZE; \
++ ZEND\_MM\_SET\_MAGIC(b, MEM\_BLOCK\_GUARD); \
++ } while (0);
++#define ZEND\_MM\_BLOCK\_SIZE(b) ((b)->info.\_size & ~ZEND\_MM\_TYPE\_MASK)
++#define ZEND\_MM\_IS\_FREE\_BLOCK(b) (!((b)->info.\_size & ZEND\_MM\_USED\_BLOCK))
++#define ZEND\_MM\_IS\_USED\_BLOCK(b) ((b)->info.\_size & ZEND\_MM\_USED\_BLOCK)
++#define ZEND\_MM\_IS\_GUARD\_BLOCK(b) (((b)->info.\_size & ZEND\_MM\_TYPE\_MASK) == ZEND\_MM\_GUARD\_BLOCK)
++
++#define ZEND\_MM\_NEXT\_BLOCK(b) ZEND\_MM\_BLOCK\_AT(b, ZEND\_MM\_BLOCK\_SIZE(b))
++#define ZEND\_MM\_PREV\_BLOCK(b) ZEND\_MM\_BLOCK\_AT(b, -(int)((b)->info.\_prev & ~ZEND\_MM\_TYPE\_MASK))
++
++#define ZEND\_MM\_PREV\_BLOCK\_IS\_FREE(b) (!((b)->info.\_prev & ZEND\_MM\_USED\_BLOCK))
++
++#define ZEND\_MM\_MARK\_FIRST\_BLOCK(b) ((b)->info.\_prev = ZEND\_MM\_GUARD\_BLOCK)
++#define ZEND\_MM\_IS\_FIRST\_BLOCK(b) ((b)->info.\_prev == ZEND\_MM\_GUARD\_BLOCK)
++
++/\* optimized access \*/
++#define ZEND\_MM\_FREE\_BLOCK\_SIZE(b) (b)->info.\_size
++
++#ifndef ZEND\_MM\_ALIGNMENT
++# define ZEND\_MM\_ALIGNMENT 8
++# define ZEND\_MM\_ALIGNMENT\_LOG2 3
++#elif ZEND\_MM\_ALIGNMENT < 4
++# undef ZEND\_MM\_ALIGNMENT
++# undef ZEND\_MM\_ALIGNMENT\_LOG2
++# define ZEND\_MM\_ALIGNMENT 4
++# define ZEND\_MM\_ALIGNMENT\_LOG2 2
++#endif
++
++#define ZEND\_MM\_ALIGNMENT\_MASK ~(ZEND\_MM\_ALIGNMENT-1)
++
++/\* Aligned header size \*/
++#define ZEND\_MM\_ALIGNED\_SIZE(size) ((size + ZEND\_MM\_ALIGNMENT - 1) & ZEND\_MM\_ALIGNMENT\_MASK)
++#define ZEND\_MM\_ALIGNED\_HEADER\_SIZE ZEND\_MM\_ALIGNED\_SIZE(sizeof(zend\_mm\_block\_canary))
++#define ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE ZEND\_MM\_ALIGNED\_SIZE(sizeof(zend\_mm\_small\_free\_block\_canary))
++#define ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE ZEND\_MM\_ALIGNED\_SIZE(ZEND\_MM\_ALIGNED\_HEADER\_SIZE + END\_MAGIC\_SIZE + CANARY\_SIZE)
++#define ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE (ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE>ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE?ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE:ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE)
++#define ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE ZEND\_MM\_ALIGNED\_SIZE(sizeof(zend\_mm\_segment))
++
++#define ZEND\_MM\_MIN\_SIZE ((ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE>(ZEND\_MM\_ALIGNED\_HEADER\_SIZE+END\_MAGIC\_SIZE+CANARY\_SIZE))?(ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE-(ZEND\_MM\_ALIGNED\_HEADER\_SIZE+END\_MAGIC\_SIZE+CANARY\_SIZE)):0)
++
++#define ZEND\_MM\_MAX\_SMALL\_SIZE ((ZEND\_MM\_NUM\_BUCKETS<>ZEND\_MM\_ALIGNMENT\_LOG2)-(ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE>>ZEND\_MM\_ALIGNMENT\_LOG2))
++
++#define ZEND\_MM\_SMALL\_SIZE(true\_size) (true\_size < ZEND\_MM\_MAX\_SMALL\_SIZE)
++
++/\* Memory calculations \*/
++#define ZEND\_MM\_BLOCK\_AT(blk, offset) ((zend\_mm\_block\_canary \*) (((char \*) (blk))+(offset)))
++#define ZEND\_MM\_DATA\_OF(p) ((void \*) (((char \*) (p))+ZEND\_MM\_ALIGNED\_HEADER\_SIZE))
++#define ZEND\_MM\_HEADER\_OF(blk) ZEND\_MM\_BLOCK\_AT(blk, -(int)ZEND\_MM\_ALIGNED\_HEADER\_SIZE)
++
++/\* Debug output \*/
++#if ZEND\_DEBUG
++
++# ifdef ZTS
++# define ZEND\_MM\_SET\_THREAD\_ID(block) \
++ ((zend\_mm\_block\_canary\*)(block))->thread\_id = tsrm\_thread\_id()
++# define ZEND\_MM\_BAD\_THREAD\_ID(block) ((block)->thread\_id != tsrm\_thread\_id())
++# else
++# define ZEND\_MM\_SET\_THREAD\_ID(block)
++# define ZEND\_MM\_BAD\_THREAD\_ID(block) 0
++# endif
++
++# define ZEND\_MM\_VALID\_PTR(block) \
++ zend\_mm\_check\_ptr(heap, block, 1 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC)
++
++# define ZEND\_MM\_SET\_MAGIC(block, val) do { \
++ (block)->magic = (val); \
++ } while (0)
++
++# define ZEND\_MM\_CHECK\_MAGIC(block, val) do { \
++ if ((block)->magic != (val)) { \
++ zend\_mm\_panic("zend\_mm\_heap corrupted"); \
++ } \
++ } while (0)
++
++# define ZEND\_MM\_SET\_DEBUG\_INFO(block, \_\_size, set\_valid, set\_thread) do { \
++ ((zend\_mm\_block\_canary\*)(block))->debug.filename = \_\_zend\_filename; \
++ ((zend\_mm\_block\_canary\*)(block))->debug.lineno = \_\_zend\_lineno; \
++ ((zend\_mm\_block\_canary\*)(block))->debug.orig\_filename = \_\_zend\_orig\_filename; \
++ ((zend\_mm\_block\_canary\*)(block))->debug.orig\_lineno = \_\_zend\_orig\_lineno; \
++ ZEND\_MM\_SET\_BLOCK\_SIZE(block, \_\_size); \
++ if (set\_valid) { \
++ ZEND\_MM\_SET\_MAGIC(block, MEM\_BLOCK\_VALID); \
++ } \
++ if (set\_thread) { \
++ ZEND\_MM\_SET\_THREAD\_ID(block); \
++ } \
++ } while (0)
++
++#else
++
++# define ZEND\_MM\_VALID\_PTR(ptr) EXPECTED(ptr != NULL)
++
++# define ZEND\_MM\_SET\_MAGIC(block, val)
++
++# define ZEND\_MM\_CHECK\_MAGIC(block, val)
++
++# define ZEND\_MM\_SET\_DEBUG\_INFO(block, \_\_size, set\_valid, set\_thread) ZEND\_MM\_SET\_BLOCK\_SIZE(block, \_\_size)
++
++#endif
++
++#if SUHOSIN\_MM\_WITH\_CANARY\_PROTECTION
++
++# define SUHOSIN\_MM\_CHECK\_CANARIES(block, MFUNCTION) do { \
++ char \*p = SUHOSIN\_MM\_END\_CANARY\_PTR(block); size\_t check; \
++ if (((block)->info.canary\_1 != heap->canary\_1) || ((block)->info.canary\_2 != heap->canary\_2)) { \
++ canary\_mismatch: \
++ zend\_suhosin\_log(S\_MEMORY, "canary mismatch on " MFUNCTION " - heap overflow detected at %p", (block)); \
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION) == 0) { \_exit(1); } else { (block)->info.canary\_1 = heap->canary\_1; (block)->info.canary\_2 = heap->canary\_2; }\
++ } \
++ memcpy(✓, p, CANARY\_SIZE); \
++ if (check != heap->canary\_3) { \
++ zend\_suhosin\_log(S\_MEMORY, "end canary mismatch on " MFUNCTION " - heap overflow detected at %p", (block)); \
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION) == 0) { \_exit(1); } else { memcpy(p, heap->canary\_3, CANARY\_SIZE); } \
++ } \
++ } while (0)
++
++# define SUHOSIN\_MM\_SET\_CANARIES(block) do { \
++ (block)->info.canary\_1 = heap->canary\_1; \
++ (block)->info.canary\_2 = heap->canary\_2; \
++ } while (0)
++
++# define SUHOSIN\_MM\_END\_CANARY\_PTR(block) \
++ (char \*)(((char\*)(ZEND\_MM\_DATA\_OF(block))) + ((zend\_mm\_block\_canary\*)(block))->info.size + END\_MAGIC\_SIZE)
++
++# define SUHOSIN\_MM\_SET\_END\_CANARY(block) do { \
++ char \*p = SUHOSIN\_MM\_END\_CANARY\_PTR(block); \
++ memcpy(p, &heap->canary\_3, CANARY\_SIZE); \
++ } while (0)
++
++#else
++
++# define SUHOSIN\_MM\_CHECK\_CANARIES(block, MFUNCTION)
++# define SUHOSIN\_MM\_SET\_CANARIES(block)
++# define SUHOSIN\_MM\_END\_CANARY\_PTR(block)
++# define SUHOSIN\_MM\_SET\_END\_CANARY(block)
++
++#endif
++
++
++#if ZEND\_MM\_HEAP\_PROTECTION
++
++# define ZEND\_MM\_CHECK\_PROTECTION(block) \
++ do { \
++ if ((block)->debug.start\_magic != \_mem\_block\_start\_magic || \
++ memcmp(ZEND\_MM\_END\_MAGIC\_PTR(block), &\_mem\_block\_end\_magic, END\_MAGIC\_SIZE) != 0) { \
++ zend\_mm\_panic("zend\_mm\_heap corrupted"); \
++ } \
++ } while (0)
++
++# define ZEND\_MM\_END\_MAGIC\_PTR(block) \
++ (((char\*)(ZEND\_MM\_DATA\_OF(block))) + ((zend\_mm\_block\_canary\*)(block))->debug.size)
++
++# define END\_MAGIC\_SIZE sizeof(unsigned int)
++
++# define ZEND\_MM\_SET\_BLOCK\_SIZE(block, \_\_size) do { \
++ char \*p; \
++ ((zend\_mm\_block\_canary\*)(block))->debug.size = (\_\_size); \
++ p = ZEND\_MM\_END\_MAGIC\_PTR(block); \
++ ((zend\_mm\_block\_canary\*)(block))->debug.start\_magic = \_mem\_block\_start\_magic; \
++ memcpy(p, &\_mem\_block\_end\_magic, END\_MAGIC\_SIZE); \
++ } while (0)
++
++static unsigned int \_mem\_block\_start\_magic = 0;
++static unsigned int \_mem\_block\_end\_magic = 0;
++
++#else
++
++# if ZEND\_DEBUG
++# define ZEND\_MM\_SET\_BLOCK\_SIZE(block, \_size) \
++ ((zend\_mm\_block\_canary\*)(block))->debug.size = (\_size)
++# else
++# define ZEND\_MM\_SET\_BLOCK\_SIZE(block, \_size)
++# endif
++
++# define ZEND\_MM\_CHECK\_PROTECTION(block)
++
++# define END\_MAGIC\_SIZE 0
++
++#endif
++
++#if ZEND\_MM\_SAFE\_UNLINKING
++# define ZEND\_MM\_CHECK\_BLOCK\_LINKAGE(block) \
++ if (UNEXPECTED((block)->info.\_size != ZEND\_MM\_BLOCK\_AT(block, ZEND\_MM\_FREE\_BLOCK\_SIZE(block))->info.\_prev) || \
++ UNEXPECTED(!UNEXPECTED(ZEND\_MM\_IS\_FIRST\_BLOCK(block)) && \
++ UNEXPECTED(ZEND\_MM\_PREV\_BLOCK(block)->info.\_size != (block)->info.\_prev))) { \
++ zend\_mm\_panic("zend\_mm\_heap corrupted"); \
++ }
++#define ZEND\_MM\_CHECK\_TREE(block) \
++ if (UNEXPECTED(\*((block)->parent) != (block))) { \
++ zend\_mm\_panic("zend\_mm\_heap corrupted"); \
++ }
++#else
++# define ZEND\_MM\_CHECK\_BLOCK\_LINKAGE(block)
++# define ZEND\_MM\_CHECK\_TREE(block)
++#endif
++
++#define ZEND\_MM\_LARGE\_BUCKET\_INDEX(S) zend\_mm\_high\_bit(S)
++
++void \*\_zend\_mm\_alloc\_canary\_int(zend\_mm\_heap\_canary \*heap, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC) ZEND\_ATTRIBUTE\_MALLOC;
++void \_zend\_mm\_free\_canary\_int(zend\_mm\_heap\_canary \*heap, void \*p ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC);
++void \*\_zend\_mm\_realloc\_canary\_int(zend\_mm\_heap\_canary \*heap, void \*p, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC);
++
++
++static inline unsigned int zend\_mm\_high\_bit(size\_t \_size)
++{
++#if defined(\_\_GNUC\_\_) && defined(i386)
++ unsigned int n;
++
++ \_\_asm\_\_("bsrl %1,%0\n\t" : "=r" (n) : "rm" (\_size));
++ return n;
++#elif defined(\_\_GNUC\_\_) && defined(\_\_x86\_64\_\_)
++ unsigned long n;
++
++ \_\_asm\_\_("bsrq %1,%0\n\t" : "=r" (n) : "rm" (\_size));
++ return (unsigned int)n;
++#elif defined(\_MSC\_VER) && defined(\_M\_IX86)
++ \_\_asm {
++ bsr eax, \_size
++ }
++#else
++ unsigned int n = 0;
++ while (\_size != 0) {
++ \_size = \_size >> 1;
++ n++;
++ }
++ return n-1;
++#endif
++}
++
++static inline unsigned int zend\_mm\_low\_bit(size\_t \_size)
++{
++#if defined(\_\_GNUC\_\_) && defined(i386)
++ unsigned int n;
++
++ \_\_asm\_\_("bsfl %1,%0\n\t" : "=r" (n) : "rm" (\_size));
++ return n;
++#elif defined(\_\_GNUC\_\_) && defined(\_\_x86\_64\_\_)
++ unsigned long n;
++
++ \_\_asm\_\_("bsfq %1,%0\n\t" : "=r" (n) : "rm" (\_size));
++ return (unsigned int)n;
++#elif defined(\_MSC\_VER) && defined(\_M\_IX86)
++ \_\_asm {
++ bsf eax, \_size
++ }
++#else
++ static const int offset[16] = {4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0};
++ unsigned int n;
++ unsigned int index = 0;
++
++ n = offset[\_size & 15];
++ while (n == 4) {
++ \_size >>= 4;
++ index += n;
++ n = offset[\_size & 15];
++ }
++
++ return index + n;
++#endif
++}
++
++static void zend\_mm\_add\_to\_rest\_list(zend\_mm\_heap\_canary \*heap, zend\_mm\_free\_block\_canary \*mm\_block)
++{
++ zend\_mm\_free\_block\_canary \*prev, \*next;
++
++ ZEND\_MM\_SET\_MAGIC(mm\_block, MEM\_BLOCK\_FREED);
++
++ if (!ZEND\_MM\_SMALL\_SIZE(ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block))) {
++ mm\_block->parent = NULL;
++ }
++
++ prev = SUHOSIN\_MANGLE\_PTR(heap->rest\_buckets[0]);
++ next = SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block);
++ mm\_block->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
++ mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ prev->next\_free\_block = next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
++}
++
++static void zend\_mm\_add\_to\_free\_list(zend\_mm\_heap\_canary \*heap, zend\_mm\_free\_block\_canary \*mm\_block)
++{
++ size\_t size;
++ size\_t index;
++
++ ZEND\_MM\_SET\_MAGIC(mm\_block, MEM\_BLOCK\_FREED);
++
++ size = ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block);
++ if (EXPECTED(!ZEND\_MM\_SMALL\_SIZE(size))) {
++ zend\_mm\_free\_block\_canary \*\*p;
++
++ index = ZEND\_MM\_LARGE\_BUCKET\_INDEX(size);
++ p = &heap->large\_free\_buckets[index];
++ mm\_block->child[0] = mm\_block->child[1] = NULL;
++ if (!\*p) {
++ \*p = mm\_block;
++ mm\_block->parent = p;
++ mm\_block->prev\_free\_block = mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
++ heap->large\_free\_bitmap |= (ZEND\_MM\_LONG\_CONST(1) << index);
++ } else {
++ size\_t m;
++
++ for (m = size << (ZEND\_MM\_NUM\_BUCKETS - index); ; m <<= 1) {
++ zend\_mm\_free\_block\_canary \*prev = \*p;
++
++ if (ZEND\_MM\_FREE\_BLOCK\_SIZE(prev) != size) {
++ p = &prev->child[(m >> (ZEND\_MM\_NUM\_BUCKETS-1)) & 1];
++ if (!\*p) {
++ \*p = mm\_block;
++ mm\_block->parent = p;
++ mm\_block->prev\_free\_block = mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
++ break;
++ }
++ } else {
++ zend\_mm\_free\_block\_canary \*next = SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block);
++
++ prev->next\_free\_block = next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
++ mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ mm\_block->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
++ mm\_block->parent = NULL;
++ break;
++ }
++ }
++ }
++ } else {
++ zend\_mm\_free\_block\_canary \*prev, \*next;
++
++ index = ZEND\_MM\_BUCKET\_INDEX(size);
++
++ prev = ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, index);
++ if (SUHOSIN\_MANGLE\_PTR(prev->prev\_free\_block) == prev) {
++ heap->free\_bitmap |= (ZEND\_MM\_LONG\_CONST(1) << index);
++ }
++ next = SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block);
++
++ mm\_block->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
++ mm\_block->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ prev->next\_free\_block = next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(mm\_block);
++ }
++}
++
++static void zend\_mm\_remove\_from\_free\_list(zend\_mm\_heap\_canary \*heap, zend\_mm\_free\_block\_canary \*mm\_block)
++{
++ zend\_mm\_free\_block\_canary \*prev = SUHOSIN\_MANGLE\_PTR(mm\_block->prev\_free\_block);
++ zend\_mm\_free\_block\_canary \*next = SUHOSIN\_MANGLE\_PTR(mm\_block->next\_free\_block);
++
++ ZEND\_MM\_CHECK\_MAGIC(mm\_block, MEM\_BLOCK\_FREED);
++
++ if (EXPECTED(prev == mm\_block)) {
++ zend\_mm\_free\_block\_canary \*\*rp, \*\*cp;
++
++#if SUHOSIN\_PATCH
++ if (next != mm\_block) {
++ zend\_suhosin\_log(S\_MEMORY, "zend\_mm\_heap corrupted at %p", mm\_block);
++ \_exit(1);
++ }
++#endif
++#if ZEND\_MM\_SAFE\_UNLINKING
++ if (UNEXPECTED(next != mm\_block)) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++#endif
++
++ rp = &mm\_block->child[mm\_block->child[1] != NULL];
++ prev = \*rp;
++ if (EXPECTED(prev == NULL)) {
++ size\_t index = ZEND\_MM\_LARGE\_BUCKET\_INDEX(ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block));
++
++ ZEND\_MM\_CHECK\_TREE(mm\_block);
++ \*mm\_block->parent = NULL;
++ if (mm\_block->parent == &heap->large\_free\_buckets[index]) {
++ heap->large\_free\_bitmap &= ~(ZEND\_MM\_LONG\_CONST(1) << index);
++ }
++ } else {
++ while (\*(cp = &(prev->child[prev->child[1] != NULL])) != NULL) {
++ prev = \*cp;
++ rp = cp;
++ }
++ \*rp = NULL;
++
++subst\_block:
++ ZEND\_MM\_CHECK\_TREE(mm\_block);
++ \*mm\_block->parent = prev;
++ prev->parent = mm\_block->parent;
++ if ((prev->child[0] = mm\_block->child[0])) {
++ ZEND\_MM\_CHECK\_TREE(prev->child[0]);
++ prev->child[0]->parent = &prev->child[0];
++ }
++ if ((prev->child[1] = mm\_block->child[1])) {
++ ZEND\_MM\_CHECK\_TREE(prev->child[1]);
++ prev->child[1]->parent = &prev->child[1];
++ }
++ }
++ } else {
++
++#if SUHOSIN\_PATCH
++ if (SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block) != mm\_block || SUHOSIN\_MANGLE\_PTR(next->prev\_free\_block) != mm\_block) {
++ zend\_suhosin\_log(S\_MEMORY, "zend\_mm\_head corrupted at %p", mm\_block);
++ \_exit(1);
++ }
++#endif
++
++#if ZEND\_MM\_SAFE\_UNLINKING
++ if (UNEXPECTED(SUHOSIN\_MANGLE\_PTR(prev->next\_free\_block) != mm\_block) || UNEXPECTED(SUHOSIN\_MANGLE\_PTR(next->prev\_free\_block) != mm\_block)) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++#endif
++
++ prev->next\_free\_block = SUHOSIN\_MANGLE\_PTR(next);
++ next->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(prev);
++
++ if (EXPECTED(ZEND\_MM\_SMALL\_SIZE(ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block)))) {
++ if (EXPECTED(prev == next)) {
++ size\_t index = ZEND\_MM\_BUCKET\_INDEX(ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block));
++
++ if (EXPECTED(heap->free\_buckets[index\*2] == heap->free\_buckets[index\*2+1])) {
++ heap->free\_bitmap &= ~(ZEND\_MM\_LONG\_CONST(1) << index);
++ }
++ }
++ } else if (UNEXPECTED(mm\_block->parent != NULL)) {
++ goto subst\_block;
++ }
++ }
++}
++
++static void zend\_mm\_init(zend\_mm\_heap\_canary \*heap)
++{
++ zend\_mm\_free\_block\_canary\* p;
++ int i;
++
++ heap->free\_bitmap = 0;
++ heap->large\_free\_bitmap = 0;
++#if ZEND\_MM\_CACHE
++ heap->cached = 0;
++ memset(heap->cache, 0, sizeof(heap->cache));
++#endif
++#if ZEND\_MM\_CACHE\_STAT
++ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
++ heap->cache\_stat[i].count = 0;
++ }
++#endif
++ p = ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, 0);
++ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
++ p->next\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
++ p->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
++ p = (zend\_mm\_free\_block\_canary\*)((char\*)p + sizeof(zend\_mm\_free\_block\_canary\*) \* 2);
++ heap->large\_free\_buckets[i] = NULL;
++ }
++ heap->rest\_buckets[0] = heap->rest\_buckets[1] = SUHOSIN\_MANGLE\_PTR(ZEND\_MM\_REST\_BUCKET(heap));
++#if SUHOSIN\_PATCH
++ if (SUHOSIN\_CONFIG(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION)) {
++ zend\_canary(&heap->canary\_1, sizeof(heap->canary\_1));
++ zend\_canary(&heap->canary\_2, sizeof(heap->canary\_2));
++ zend\_canary(&heap->canary\_3, sizeof(heap->canary\_3));
++ }
++#endif
++}
++
++static void zend\_mm\_del\_segment(zend\_mm\_heap\_canary \*heap, zend\_mm\_segment \*segment)
++{
++ zend\_mm\_segment \*\*p = &heap->segments\_list;
++
++ while (\*p != segment) {
++ p = &(\*p)->next\_segment;
++ }
++ \*p = segment->next\_segment;
++ heap->real\_size -= segment->size;
++ ZEND\_MM\_STORAGE\_FREE(segment);
++}
++
++#if ZEND\_MM\_CACHE
++static void zend\_mm\_free\_cache(zend\_mm\_heap\_canary \*heap)
++{
++ int i;
++
++ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
++ /\* SUHOSIN\_MANGLE\_PTR should NOT affect NULL pointers \*/
++ if (heap->cache[i]) {
++ zend\_mm\_free\_block\_canary \*mm\_block = SUHOSIN\_MANGLE\_PTR(heap->cache[i]);
++
++ while (mm\_block) {
++ size\_t size = ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++ zend\_mm\_free\_block\_canary \*q = SUHOSIN\_MANGLE\_PTR(mm\_block->prev\_free\_block);
++ zend\_mm\_block\_canary \*next\_block = ZEND\_MM\_NEXT\_BLOCK(mm\_block);
++
++ heap->cached -= size;
++
++ if (ZEND\_MM\_PREV\_BLOCK\_IS\_FREE(mm\_block)) {
++ mm\_block = (zend\_mm\_free\_block\_canary\*)ZEND\_MM\_PREV\_BLOCK(mm\_block);
++ size += ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block);
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) mm\_block);
++ }
++ if (ZEND\_MM\_IS\_FREE\_BLOCK(next\_block)) {
++ size += ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block);
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) next\_block);
++ }
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_FREE\_BLOCK, size);
++
++ if (ZEND\_MM\_IS\_FIRST\_BLOCK(mm\_block) &&
++ ZEND\_MM\_IS\_GUARD\_BLOCK(ZEND\_MM\_NEXT\_BLOCK(mm\_block))) {
++ zend\_mm\_del\_segment(heap, (zend\_mm\_segment \*) ((char \*)mm\_block - ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE));
++ } else {
++ zend\_mm\_add\_to\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) mm\_block);
++ }
++
++ mm\_block = q;
++ }
++ heap->cache[i] = NULL;
++#if ZEND\_MM\_CACHE\_STAT
++ heap->cache\_stat[i].count = 0;
++#endif
++ }
++ }
++}
++#endif
++
++#if ZEND\_MM\_HEAP\_PROTECTION || ZEND\_MM\_COOKIES
++static void zend\_mm\_random(unsigned char \*buf, size\_t size) /\* {{{ \*/
++{
++ size\_t i = 0;
++ unsigned char t;
++
++#ifdef ZEND\_WIN32
++ HCRYPTPROV hCryptProv;
++ int has\_context = 0;
++
++ if (!CryptAcquireContext(&hCryptProv, NULL, NULL, PROV\_RSA\_FULL, 0)) {
++ /\* Could mean that the key container does not exist, let try
++ again by asking for a new one \*/
++ if (GetLastError() == NTE\_BAD\_KEYSET) {
++ if (CryptAcquireContext(&hCryptProv, NULL, NULL, PROV\_RSA\_FULL, CRYPT\_NEWKEYSET)) {
++ has\_context = 1;
++ }
++ }
++ } else {
++ has\_context = 1;
++ }
++ if (has\_context) {
++ do {
++ BOOL ret = CryptGenRandom(hCryptProv, size, buf);
++ CryptReleaseContext(hCryptProv, 0);
++ if (ret) {
++ while (i < size && buf[i] != 0) {
++ i++;
++ }
++ if (i == size) {
++ return;
++ }
++ }
++ } while (0);
++ }
++#elif defined(HAVE\_DEV\_URANDOM)
++ int fd = open("/dev/urandom", 0);
++
++ if (fd >= 0) {
++ if (read(fd, buf, size) == size) {
++ while (i < size && buf[i] != 0) {
++ i++;
++ }
++ if (i == size) {
++ close(fd);
++ return;
++ }
++ }
++ close(fd);
++ }
++#endif
++ t = (unsigned char)getpid();
++ while (i < size) {
++ do {
++ buf[i] = ((unsigned char)rand()) ^ t;
++ } while (buf[i] == 0);
++ t = buf[i++] << 1;
++ }
++}
++/\* }}} \*/
++#endif
++
++
++/\* Notes:
++ \* - This function may alter the block\_sizes values to match platform alignment
++ \* - This function does \*not\* perform sanity checks on the arguments
++ \*/
++zend\_mm\_heap\_canary \*\_\_zend\_mm\_startup\_canary\_ex(const zend\_mm\_mem\_handlers \*handlers, size\_t block\_size, size\_t reserve\_size, int internal, void \*params)
++{
++ zend\_mm\_storage \*storage;
++ zend\_mm\_heap\_canary \*heap;
++ zend\_mm\_free\_block\_canary \*tmp;
++
++#if 0
++ int i;
++
++ printf("ZEND\_MM\_ALIGNMENT=%d\n", ZEND\_MM\_ALIGNMENT);
++ printf("ZEND\_MM\_ALIGNMENT\_LOG2=%d\n", ZEND\_MM\_ALIGNMENT\_LOG2);
++ printf("ZEND\_MM\_MIN\_SIZE=%d\n", ZEND\_MM\_MIN\_SIZE);
++ printf("ZEND\_MM\_MAX\_SMALL\_SIZE=%d\n", ZEND\_MM\_MAX\_SMALL\_SIZE);
++ printf("ZEND\_MM\_ALIGNED\_HEADER\_SIZE=%d\n", ZEND\_MM\_ALIGNED\_HEADER\_SIZE);
++ printf("ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE=%d\n", ZEND\_MM\_ALIGNED\_FREE\_HEADER\_SIZE);
++ printf("ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE=%d\n", ZEND\_MM\_MIN\_ALLOC\_BLOCK\_SIZE);
++ printf("ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE=%d\n", ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE);
++ printf("ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE=%d\n", ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ for (i = 0; i < ZEND\_MM\_MAX\_SMALL\_SIZE; i++) {
++ printf("%3d%c: %3ld %d %2ld\n", i, (i == ZEND\_MM\_MIN\_SIZE?'\*':' '), (long)ZEND\_MM\_TRUE\_SIZE(i), ZEND\_MM\_SMALL\_SIZE(ZEND\_MM\_TRUE\_SIZE(i)), (long)ZEND\_MM\_BUCKET\_INDEX(ZEND\_MM\_TRUE\_SIZE(i)));
++ }
++ exit(0);
++#endif
++
++#if ZEND\_MM\_HEAP\_PROTECTION
++ if (\_mem\_block\_start\_magic == 0) {
++ zend\_mm\_random((unsigned char\*)&\_mem\_block\_start\_magic, sizeof(\_mem\_block\_start\_magic));
++ }
++ if (\_mem\_block\_end\_magic == 0) {
++ zend\_mm\_random((unsigned char\*)&\_mem\_block\_end\_magic, sizeof(\_mem\_block\_end\_magic));
++ }
++#endif
++#if ZEND\_MM\_COOKIES
++ if (\_zend\_mm\_cookie == 0) {
++ zend\_mm\_random((unsigned char\*)&\_zend\_mm\_cookie, sizeof(\_zend\_mm\_cookie));
++ }
++#endif
++
++ /\* get the pointer guardian and ensure low 3 bits are 1 \*/
++ if (SUHOSIN\_POINTER\_GUARD == 0) {
++ zend\_canary(&SUHOSIN\_POINTER\_GUARD, sizeof(SUHOSIN\_POINTER\_GUARD));
++ SUHOSIN\_POINTER\_GUARD |= 7;
++ }
++
++ if (zend\_mm\_low\_bit(block\_size) != zend\_mm\_high\_bit(block\_size)) {
++ fprintf(stderr, "'block\_size' must be a power of two\n");
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ exit(255);
++ }
++ storage = handlers->init(params);
++ if (!storage) {
++ fprintf(stderr, "Cannot initialize zend\_mm storage [%s]\n", handlers->name);
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ exit(255);
++ }
++ storage->handlers = handlers;
++
++ heap = malloc(sizeof(struct \_zend\_mm\_heap\_canary));
++
++ heap->storage = storage;
++ heap->block\_size = block\_size;
++ heap->compact\_size = 0;
++ heap->segments\_list = NULL;
++ zend\_mm\_init(heap);
++# if ZEND\_MM\_CACHE\_STAT
++ memset(heap->cache\_stat, 0, sizeof(heap->cache\_stat));
++# endif
++
++ heap->use\_zend\_alloc = 1;
++ heap->real\_size = 0;
++ heap->overflow = 0;
++ heap->real\_peak = 0;
++ heap->limit = ZEND\_MM\_LONG\_CONST(1)<<(ZEND\_MM\_NUM\_BUCKETS-2);
++ heap->size = 0;
++ heap->peak = 0;
++ heap->internal = internal;
++ heap->reserve = NULL;
++ heap->reserve\_size = reserve\_size;
++ if (reserve\_size > 0) {
++ heap->reserve = \_zend\_mm\_alloc((zend\_mm\_heap \*)heap, reserve\_size ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ }
++ if (internal) {
++ int i;
++ zend\_mm\_free\_block\_canary \*p, \*q, \*orig;
++ zend\_mm\_heap\_canary \*mm\_heap = \_zend\_mm\_alloc((zend\_mm\_heap \*)heap, sizeof(zend\_mm\_heap\_canary) ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++
++ \*mm\_heap = \*heap;
++
++ p = ZEND\_MM\_SMALL\_FREE\_BUCKET(mm\_heap, 0);
++ orig = ZEND\_MM\_SMALL\_FREE\_BUCKET(heap, 0);
++ for (i = 0; i < ZEND\_MM\_NUM\_BUCKETS; i++) {
++ q = p;
++ while (SUHOSIN\_MANGLE\_PTR(q->prev\_free\_block) != orig) {
++ q = SUHOSIN\_MANGLE\_PTR(q->prev\_free\_block);
++ }
++ q->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
++ q = p;
++ while (SUHOSIN\_MANGLE\_PTR(q->next\_free\_block) != orig) {
++ q = SUHOSIN\_MANGLE\_PTR(q->next\_free\_block);
++ }
++ q->next\_free\_block = SUHOSIN\_MANGLE\_PTR(p);
++ p = (zend\_mm\_free\_block\_canary\*)((char\*)p + sizeof(zend\_mm\_free\_block\_canary\*) \* 2);
++ orig = (zend\_mm\_free\_block\_canary\*)((char\*)orig + sizeof(zend\_mm\_free\_block\_canary\*) \* 2);
++ if (mm\_heap->large\_free\_buckets[i]) {
++ mm\_heap->large\_free\_buckets[i]->parent = &mm\_heap->large\_free\_buckets[i];
++ }
++ }
++
++ tmp = SUHOSIN\_MANGLE\_PTR(mm\_heap->rest\_buckets[0]);
++ tmp->next\_free\_block = SUHOSIN\_MANGLE\_PTR(ZEND\_MM\_REST\_BUCKET(mm\_heap));
++ tmp = SUHOSIN\_MANGLE\_PTR(mm\_heap->rest\_buckets[1]);
++ tmp->prev\_free\_block = SUHOSIN\_MANGLE\_PTR(ZEND\_MM\_REST\_BUCKET(mm\_heap));
++
++ free(heap);
++ heap = mm\_heap;
++ }
++ return heap;
++}
++
++zend\_mm\_heap\_canary \*\_\_zend\_mm\_startup\_canary(void)
++{
++ int i;
++ size\_t seg\_size;
++ char \*mem\_type = getenv("ZEND\_MM\_MEM\_TYPE");
++ char \*tmp;
++ const zend\_mm\_mem\_handlers \*handlers;
++ zend\_mm\_heap\_canary \*heap;
++
++ if (mem\_type == NULL) {
++ i = 0;
++ } else {
++ for (i = 0; mem\_handlers[i].name; i++) {
++ if (strcmp(mem\_handlers[i].name, mem\_type) == 0) {
++ break;
++ }
++ }
++ if (!mem\_handlers[i].name) {
++ fprintf(stderr, "Wrong or unsupported zend\_mm storage type '%s'\n", mem\_type);
++ fprintf(stderr, " supported types:\n");
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ for (i = 0; mem\_handlers[i].name; i++) {
++ fprintf(stderr, " '%s'\n", mem\_handlers[i].name);
++ }
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ exit(255);
++ }
++ }
++ handlers = &mem\_handlers[i];
++
++ tmp = getenv("ZEND\_MM\_SEG\_SIZE");
++ if (tmp) {
++ seg\_size = zend\_atoi(tmp, 0);
++ if (zend\_mm\_low\_bit(seg\_size) != zend\_mm\_high\_bit(seg\_size)) {
++ fprintf(stderr, "ZEND\_MM\_SEG\_SIZE must be a power of two\n");
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ exit(255);
++ } else if (seg\_size < ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE + ZEND\_MM\_ALIGNED\_HEADER\_SIZE) {
++ fprintf(stderr, "ZEND\_MM\_SEG\_SIZE is too small\n");
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ exit(255);
++ }
++ } else {
++ seg\_size = ZEND\_MM\_SEG\_SIZE;
++ }
++
++ heap = \_\_zend\_mm\_startup\_canary\_ex(handlers, seg\_size, ZEND\_MM\_RESERVE\_SIZE, 0, NULL);
++ if (heap) {
++ tmp = getenv("ZEND\_MM\_COMPACT");
++ if (tmp) {
++ heap->compact\_size = zend\_atoi(tmp, 0);
++ } else {
++ heap->compact\_size = 2 \* 1024 \* 1024;
++ }
++ }
++ return heap;
++}
++
++#if ZEND\_DEBUG
++static long zend\_mm\_find\_leaks(zend\_mm\_segment \*segment, zend\_mm\_block\_canary \*b)
++{
++ long leaks = 0;
++ zend\_mm\_block\_canary \*p, \*q;
++
++ p = ZEND\_MM\_NEXT\_BLOCK(b);
++ while (1) {
++ if (ZEND\_MM\_IS\_GUARD\_BLOCK(p)) {
++ ZEND\_MM\_CHECK\_MAGIC(p, MEM\_BLOCK\_GUARD);
++ segment = segment->next\_segment;
++ if (!segment) {
++ break;
++ }
++ p = (zend\_mm\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ continue;
++ }
++ q = ZEND\_MM\_NEXT\_BLOCK(p);
++ if (q <= p ||
++ (char\*)q > (char\*)segment + segment->size ||
++ p->info.\_size != q->info.\_prev) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++ if (!ZEND\_MM\_IS\_FREE\_BLOCK(p)) {
++ if (p->magic == MEM\_BLOCK\_VALID) {
++ if (p->debug.filename==b->debug.filename && p->debug.lineno==b->debug.lineno) {
++ ZEND\_MM\_SET\_MAGIC(p, MEM\_BLOCK\_LEAK);
++ leaks++;
++ }
++#if ZEND\_MM\_CACHE
++ } else if (p->magic == MEM\_BLOCK\_CACHED) {
++ /\* skip it \*/
++#endif
++ } else if (p->magic != MEM\_BLOCK\_LEAK) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++ }
++ p = q;
++ }
++ return leaks;
++}
++
++static void zend\_mm\_check\_leaks(zend\_mm\_heap\_canary \*heap TSRMLS\_DC)
++{
++ zend\_mm\_segment \*segment = heap->segments\_list;
++ zend\_mm\_block\_canary \*p, \*q;
++ zend\_uint total = 0;
++
++ if (!segment) {
++ return;
++ }
++ p = (zend\_mm\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ while (1) {
++ q = ZEND\_MM\_NEXT\_BLOCK(p);
++ if (q <= p ||
++ (char\*)q > (char\*)segment + segment->size ||
++ p->info.\_size != q->info.\_prev) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++ if (!ZEND\_MM\_IS\_FREE\_BLOCK(p)) {
++ if (p->magic == MEM\_BLOCK\_VALID) {
++ long repeated;
++ zend\_leak\_info leak;
++
++ ZEND\_MM\_SET\_MAGIC(p, MEM\_BLOCK\_LEAK);
++
++ leak.addr = ZEND\_MM\_DATA\_OF(p);
++ leak.size = p->debug.size;
++ leak.filename = p->debug.filename;
++ leak.lineno = p->debug.lineno;
++ leak.orig\_filename = p->debug.orig\_filename;
++ leak.orig\_lineno = p->debug.orig\_lineno;
++
++ zend\_message\_dispatcher(ZMSG\_LOG\_SCRIPT\_NAME, NULL TSRMLS\_CC);
++ zend\_message\_dispatcher(ZMSG\_MEMORY\_LEAK\_DETECTED, &leak TSRMLS\_CC);
++ repeated = zend\_mm\_find\_leaks(segment, p);
++ total += 1 + repeated;
++ if (repeated) {
++ zend\_message\_dispatcher(ZMSG\_MEMORY\_LEAK\_REPEATED, (void \*)(zend\_uintptr\_t)repeated TSRMLS\_CC);
++ }
++#if ZEND\_MM\_CACHE
++ } else if (p->magic == MEM\_BLOCK\_CACHED) {
++ /\* skip it \*/
++#endif
++ } else if (p->magic != MEM\_BLOCK\_LEAK) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++ }
++ if (ZEND\_MM\_IS\_GUARD\_BLOCK(q)) {
++ segment = segment->next\_segment;
++ if (!segment) {
++ break;
++ }
++ q = (zend\_mm\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ }
++ p = q;
++ }
++ if (total) {
++ zend\_message\_dispatcher(ZMSG\_MEMORY\_LEAKS\_GRAND\_TOTAL, &total TSRMLS\_CC);
++ }
++}
++
++static int zend\_mm\_check\_ptr(zend\_mm\_heap\_canary \*heap, void \*ptr, int silent ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_block\_canary \*p;
++ int no\_cache\_notice = 0;
++ int had\_problems = 0;
++ int valid\_beginning = 1;
++
++ if (silent==2) {
++ silent = 1;
++ no\_cache\_notice = 1;
++ } else if (silent==3) {
++ silent = 0;
++ no\_cache\_notice = 1;
++ }
++ if (!silent) {
++ TSRMLS\_FETCH();
++
++ zend\_message\_dispatcher(ZMSG\_LOG\_SCRIPT\_NAME, NULL TSRMLS\_CC);
++ zend\_debug\_alloc\_output("---------------------------------------\n");
++ zend\_debug\_alloc\_output("%s(%d) : Block "PTR\_FMT" status:\n" ZEND\_FILE\_LINE\_RELAY\_CC, ptr);
++ if (\_\_zend\_orig\_filename) {
++ zend\_debug\_alloc\_output("%s(%d) : Actual location (location was relayed)\n" ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ if (!ptr) {
++ zend\_debug\_alloc\_output("NULL\n");
++ zend\_debug\_alloc\_output("---------------------------------------\n");
++ return 0;
++ }
++ }
++
++ if (!ptr) {
++ if (silent) {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ }
++
++ p = ZEND\_MM\_HEADER\_OF(ptr);
++
++#ifdef ZTS
++ if (ZEND\_MM\_BAD\_THREAD\_ID(p)) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("Invalid pointer: ((thread\_id=0x%0.8X) != (expected=0x%0.8X))\n", (long)p->thread\_id, (long)tsrm\_thread\_id());
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ }
++#endif
++
++ if (p->info.\_size != ZEND\_MM\_NEXT\_BLOCK(p)->info.\_prev) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("Invalid pointer: ((size="PTR\_FMT") != (next.prev="PTR\_FMT"))\n", p->info.\_size, ZEND\_MM\_NEXT\_BLOCK(p)->info.\_prev);
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ }
++ if (p->info.\_prev != ZEND\_MM\_GUARD\_BLOCK &&
++ ZEND\_MM\_PREV\_BLOCK(p)->info.\_size != p->info.\_prev) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("Invalid pointer: ((prev="PTR\_FMT") != (prev.size="PTR\_FMT"))\n", p->info.\_prev, ZEND\_MM\_PREV\_BLOCK(p)->info.\_size);
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ }
++
++ if (had\_problems) {
++ zend\_debug\_alloc\_output("---------------------------------------\n");
++ return 0;
++ }
++
++ if (!silent) {
++ zend\_debug\_alloc\_output("%10s\t","Beginning: ");
++ }
++
++ if (!ZEND\_MM\_IS\_USED\_BLOCK(p)) {
++ if (!silent) {
++ if (p->magic != MEM\_BLOCK\_FREED) {
++ zend\_debug\_alloc\_output("Freed (magic=0x%0.8X, expected=0x%0.8X)\n", p->magic, MEM\_BLOCK\_FREED);
++ } else {
++ zend\_debug\_alloc\_output("Freed\n");
++ }
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ } else if (ZEND\_MM\_IS\_GUARD\_BLOCK(p)) {
++ if (!silent) {
++ if (p->magic != MEM\_BLOCK\_FREED) {
++ zend\_debug\_alloc\_output("Guard (magic=0x%0.8X, expected=0x%0.8X)\n", p->magic, MEM\_BLOCK\_FREED);
++ } else {
++ zend\_debug\_alloc\_output("Guard\n");
++ }
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ } else {
++ switch (p->magic) {
++ case MEM\_BLOCK\_VALID:
++ case MEM\_BLOCK\_LEAK:
++ if (!silent) {
++ zend\_debug\_alloc\_output("OK (allocated on %s:%d, %d bytes)\n", p->debug.filename, p->debug.lineno, (int)p->debug.size);
++ }
++ break; /\* ok \*/
++ case MEM\_BLOCK\_CACHED:
++ if (!no\_cache\_notice) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("Cached\n");
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ }
++ case MEM\_BLOCK\_FREED:
++ if (!silent) {
++ zend\_debug\_alloc\_output("Freed (invalid)\n");
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ break;
++ case MEM\_BLOCK\_GUARD:
++ if (!silent) {
++ zend\_debug\_alloc\_output("Guard (invalid)\n");
++ had\_problems = 1;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ break;
++ default:
++ if (!silent) {
++ zend\_debug\_alloc\_output("Unknown (magic=0x%0.8X, expected=0x%0.8X)\n", p->magic, MEM\_BLOCK\_VALID);
++ had\_problems = 1;
++ valid\_beginning = 0;
++ } else {
++ return zend\_mm\_check\_ptr(heap, ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ break;
++ }
++ }
++
++#if ZEND\_MM\_HEAP\_PROTECTION
++ if (!valid\_beginning) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("%10s\t", "Start:");
++ zend\_debug\_alloc\_output("Unknown\n");
++ zend\_debug\_alloc\_output("%10s\t", "End:");
++ zend\_debug\_alloc\_output("Unknown\n");
++ }
++ } else {
++ char \*end\_magic = ZEND\_MM\_END\_MAGIC\_PTR(p);
++
++ if (p->debug.start\_magic == \_mem\_block\_start\_magic) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("%10s\t", "Start:");
++ zend\_debug\_alloc\_output("OK\n");
++ }
++ } else {
++ char \*overflow\_ptr, \*magic\_ptr=(char \*) &\_mem\_block\_start\_magic;
++ int overflows=0;
++ int i;
++
++ if (silent) {
++ return \_mem\_block\_check(ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ had\_problems = 1;
++ overflow\_ptr = (char \*) &p->debug.start\_magic;
++ i = END\_MAGIC\_SIZE;
++ while (--i >= 0) {
++ if (overflow\_ptr[i]!=magic\_ptr[i]) {
++ overflows++;
++ }
++ }
++ zend\_debug\_alloc\_output("%10s\t", "Start:");
++ zend\_debug\_alloc\_output("Overflown (magic=0x%0.8X instead of 0x%0.8X)\n", p->debug.start\_magic, \_mem\_block\_start\_magic);
++ zend\_debug\_alloc\_output("%10s\t","");
++ if (overflows >= END\_MAGIC\_SIZE) {
++ zend\_debug\_alloc\_output("At least %d bytes overflown\n", END\_MAGIC\_SIZE);
++ } else {
++ zend\_debug\_alloc\_output("%d byte(s) overflown\n", overflows);
++ }
++ }
++ if (memcmp(end\_magic, &\_mem\_block\_end\_magic, END\_MAGIC\_SIZE)==0) {
++ if (!silent) {
++ zend\_debug\_alloc\_output("%10s\t", "End:");
++ zend\_debug\_alloc\_output("OK\n");
++ }
++ } else {
++ char \*overflow\_ptr, \*magic\_ptr=(char \*) &\_mem\_block\_end\_magic;
++ int overflows=0;
++ int i;
++
++ if (silent) {
++ return \_mem\_block\_check(ptr, 0 ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ had\_problems = 1;
++ overflow\_ptr = (char \*) end\_magic;
++
++ for (i=0; i < END\_MAGIC\_SIZE; i++) {
++ if (overflow\_ptr[i]!=magic\_ptr[i]) {
++ overflows++;
++ }
++ }
++
++ zend\_debug\_alloc\_output("%10s\t", "End:");
++ zend\_debug\_alloc\_output("Overflown (magic=0x%0.8X instead of 0x%0.8X)\n", \*end\_magic, \_mem\_block\_end\_magic);
++ zend\_debug\_alloc\_output("%10s\t","");
++ if (overflows >= END\_MAGIC\_SIZE) {
++ zend\_debug\_alloc\_output("At least %d bytes overflown\n", END\_MAGIC\_SIZE);
++ } else {
++ zend\_debug\_alloc\_output("%d byte(s) overflown\n", overflows);
++ }
++ }
++ }
++#endif
++
++ if (!silent) {
++ zend\_debug\_alloc\_output("---------------------------------------\n");
++ }
++ return ((!had\_problems) ? 1 : 0);
++}
++
++static int zend\_mm\_check\_heap(zend\_mm\_heap\_canary \*heap, int silent ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_segment \*segment = heap->segments\_list;
++ zend\_mm\_block\_canary \*p, \*q;
++ int errors = 0;
++
++ if (!segment) {
++ return 0;
++ }
++ p = (zend\_mm\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ while (1) {
++ q = ZEND\_MM\_NEXT\_BLOCK(p);
++ if (q <= p ||
++ (char\*)q > (char\*)segment + segment->size ||
++ p->info.\_size != q->info.\_prev) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++ if (!ZEND\_MM\_IS\_FREE\_BLOCK(p)) {
++ if (p->magic == MEM\_BLOCK\_VALID || p->magic == MEM\_BLOCK\_LEAK) {
++ if (!zend\_mm\_check\_ptr(heap, ZEND\_MM\_DATA\_OF(p), (silent?2:3) ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC)) {
++ errors++;
++ }
++#if ZEND\_MM\_CACHE
++ } else if (p->magic == MEM\_BLOCK\_CACHED) {
++ /\* skip it \*/
++#endif
++ } else if (p->magic != MEM\_BLOCK\_LEAK) {
++ zend\_mm\_panic("zend\_mm\_heap corrupted");
++ }
++ }
++ if (ZEND\_MM\_IS\_GUARD\_BLOCK(q)) {
++ segment = segment->next\_segment;
++ if (!segment) {
++ return errors;
++ }
++ q = (zend\_mm\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ }
++ p = q;
++ }
++}
++#endif
++
++void \_\_zend\_mm\_shutdown\_canary(zend\_mm\_heap\_canary \*heap, int full\_shutdown, int silent TSRMLS\_DC)
++{
++ zend\_mm\_storage \*storage;
++ zend\_mm\_segment \*segment;
++ zend\_mm\_segment \*prev;
++ int internal;
++
++ if (heap->reserve) {
++#if ZEND\_DEBUG
++ if (!silent) {
++ \_zend\_mm\_free(heap, heap->reserve ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ }
++#endif
++ heap->reserve = NULL;
++ }
++
++#if ZEND\_MM\_CACHE\_STAT
++ if (full\_shutdown) {
++ FILE \*f;
++
++ f = fopen("zend\_mm.log", "w");
++ if (f) {
++ int i,j;
++ size\_t size, true\_size, min\_size, max\_size;
++ int hit = 0, miss = 0;
++
++ fprintf(f, "\nidx min\_size max\_size true\_size max\_len hits misses\n");
++ size = 0;
++ while (1) {
++ true\_size = ZEND\_MM\_TRUE\_SIZE(size);
++ if (ZEND\_MM\_SMALL\_SIZE(true\_size)) {
++ min\_size = size;
++ i = ZEND\_MM\_BUCKET\_INDEX(true\_size);
++ size++;
++ while (1) {
++ true\_size = ZEND\_MM\_TRUE\_SIZE(size);
++ if (ZEND\_MM\_SMALL\_SIZE(true\_size)) {
++ j = ZEND\_MM\_BUCKET\_INDEX(true\_size);
++ if (j > i) {
++ max\_size = size-1;
++ break;
++ }
++ } else {
++ max\_size = size-1;
++ break;
++ }
++ size++;
++ }
++ hit += heap->cache\_stat[i].hit;
++ miss += heap->cache\_stat[i].miss;
++ fprintf(f, "%2d %8d %8d %9d %8d %8d %8d\n", i, (int)min\_size, (int)max\_size, ZEND\_MM\_TRUE\_SIZE(max\_size), heap->cache\_stat[i].max\_count, heap->cache\_stat[i].hit, heap->cache\_stat[i].miss);
++ } else {
++ break;
++ }
++ }
++ fprintf(f, " %8d %8d\n", hit, miss);
++ fprintf(f, " %8d %8d\n", heap->cache\_stat[ZEND\_MM\_NUM\_BUCKETS].hit, heap->cache\_stat[ZEND\_MM\_NUM\_BUCKETS].miss);
++ fclose(f);
++ }
++ }
++#endif
++
++#if ZEND\_DEBUG
++ if (!silent) {
++ zend\_mm\_check\_leaks(heap TSRMLS\_CC);
++ }
++#endif
++
++ internal = heap->internal;
++ storage = heap->storage;
++ segment = heap->segments\_list;
++ while (segment) {
++ prev = segment;
++ segment = segment->next\_segment;
++ ZEND\_MM\_STORAGE\_FREE(prev);
++ }
++ if (full\_shutdown) {
++ storage->handlers->dtor(storage);
++ if (!internal) {
++ free(heap);
++ }
++ } else {
++ if (heap->compact\_size &&
++ heap->real\_peak > heap->compact\_size) {
++ storage->handlers->compact(storage);
++ }
++ heap->segments\_list = NULL;
++ zend\_mm\_init(heap);
++ heap->real\_size = 0;
++ heap->real\_peak = 0;
++ heap->size = 0;
++ heap->peak = 0;
++ if (heap->reserve\_size) {
++ heap->reserve = \_zend\_mm\_alloc((zend\_mm\_heap \*)heap, heap->reserve\_size ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ }
++ heap->overflow = 0;
++ }
++}
++
++static void zend\_mm\_safe\_error(zend\_mm\_heap\_canary \*heap,
++ const char \*format,
++ size\_t limit,
++#if ZEND\_DEBUG
++ const char \*filename,
++ uint lineno,
++#endif
++ size\_t size)
++{
++ if (heap->reserve) {
++ \_zend\_mm\_free\_canary\_int(heap, heap->reserve ZEND\_FILE\_LINE\_CC ZEND\_FILE\_LINE\_EMPTY\_CC);
++ heap->reserve = NULL;
++ }
++ if (heap->overflow == 0) {
++ char \*error\_filename;
++ uint error\_lineno;
++ TSRMLS\_FETCH();
++ if (zend\_is\_compiling(TSRMLS\_C)) {
++ error\_filename = zend\_get\_compiled\_filename(TSRMLS\_C);
++ error\_lineno = zend\_get\_compiled\_lineno(TSRMLS\_C);
++ } else if (EG(in\_execution)) {
++ error\_filename = EG(active\_op\_array)?EG(active\_op\_array)->filename:NULL;
++ error\_lineno = EG(opline\_ptr)?(\*EG(opline\_ptr))->lineno:0;
++ } else {
++ error\_filename = NULL;
++ error\_lineno = 0;
++ }
++ if (!error\_filename) {
++ error\_filename = "Unknown";
++ }
++ heap->overflow = 1;
++ zend\_try {
++ zend\_error\_noreturn(E\_ERROR,
++ format,
++ limit,
++#if ZEND\_DEBUG
++ filename,
++ lineno,
++#endif
++ size);
++ } zend\_catch {
++ if (heap->overflow == 2) {
++ fprintf(stderr, "\nFatal error: ");
++ fprintf(stderr,
++ format,
++ limit,
++#if ZEND\_DEBUG
++ filename,
++ lineno,
++#endif
++ size);
++ fprintf(stderr, " in %s on line %d\n", error\_filename, error\_lineno);
++ }
++/\* See http://support.microsoft.com/kb/190351 \*/
++#ifdef PHP\_WIN32
++ fflush(stderr);
++#endif
++ } zend\_end\_try();
++ } else {
++ heap->overflow = 2;
++ }
++ zend\_bailout();
++}
++
++static zend\_mm\_free\_block\_canary \*zend\_mm\_search\_large\_block(zend\_mm\_heap\_canary \*heap, size\_t true\_size)
++{
++ zend\_mm\_free\_block\_canary \*best\_fit;
++ size\_t index = ZEND\_MM\_LARGE\_BUCKET\_INDEX(true\_size);
++ size\_t bitmap = heap->large\_free\_bitmap >> index;
++ zend\_mm\_free\_block\_canary \*p;
++
++ if (bitmap == 0) {
++ return NULL;
++ }
++
++ if (UNEXPECTED((bitmap & 1) != 0)) {
++ /\* Search for best "large" free block \*/
++ zend\_mm\_free\_block\_canary \*rst = NULL;
++ size\_t m;
++ size\_t best\_size = -1;
++
++ best\_fit = NULL;
++ p = heap->large\_free\_buckets[index];
++ for (m = true\_size << (ZEND\_MM\_NUM\_BUCKETS - index); ; m <<= 1) {
++ if (UNEXPECTED(ZEND\_MM\_FREE\_BLOCK\_SIZE(p) == true\_size)) {
++ return SUHOSIN\_MANGLE\_PTR(p->next\_free\_block);
++ } else if (ZEND\_MM\_FREE\_BLOCK\_SIZE(p) >= true\_size &&
++ ZEND\_MM\_FREE\_BLOCK\_SIZE(p) < best\_size) {
++ best\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(p);
++ best\_fit = p;
++ }
++ if ((m & (ZEND\_MM\_LONG\_CONST(1) << (ZEND\_MM\_NUM\_BUCKETS-1))) == 0) {
++ if (p->child[1]) {
++ rst = p->child[1];
++ }
++ if (p->child[0]) {
++ p = p->child[0];
++ } else {
++ break;
++ }
++ } else if (p->child[1]) {
++ p = p->child[1];
++ } else {
++ break;
++ }
++ }
++
++ for (p = rst; p; p = p->child[p->child[0] != NULL]) {
++ if (UNEXPECTED(ZEND\_MM\_FREE\_BLOCK\_SIZE(p) == true\_size)) {
++ return SUHOSIN\_MANGLE\_PTR(p->next\_free\_block);
++ } else if (ZEND\_MM\_FREE\_BLOCK\_SIZE(p) > true\_size &&
++ ZEND\_MM\_FREE\_BLOCK\_SIZE(p) < best\_size) {
++ best\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(p);
++ best\_fit = p;
++ }
++ }
++
++ if (best\_fit) {
++ return SUHOSIN\_MANGLE\_PTR(best\_fit->next\_free\_block);
++ }
++ bitmap = bitmap >> 1;
++ if (!bitmap) {
++ return NULL;
++ }
++ index++;
++ }
++
++ /\* Search for smallest "large" free block \*/
++ best\_fit = p = heap->large\_free\_buckets[index + zend\_mm\_low\_bit(bitmap)];
++ while ((p = p->child[p->child[0] != NULL])) {
++ if (ZEND\_MM\_FREE\_BLOCK\_SIZE(p) < ZEND\_MM\_FREE\_BLOCK\_SIZE(best\_fit)) {
++ best\_fit = p;
++ }
++ }
++ return SUHOSIN\_MANGLE\_PTR(best\_fit->next\_free\_block);
++}
++
++void \*\_zend\_mm\_alloc\_canary\_int(zend\_mm\_heap\_canary \*heap, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_free\_block\_canary \*best\_fit;
++ size\_t true\_size = ZEND\_MM\_TRUE\_SIZE(size);
++ size\_t block\_size;
++ size\_t remaining\_size;
++ size\_t segment\_size;
++ zend\_mm\_segment \*segment;
++ int keep\_rest = 0;
++
++ if (EXPECTED(ZEND\_MM\_SMALL\_SIZE(true\_size))) {
++ size\_t index = ZEND\_MM\_BUCKET\_INDEX(true\_size);
++ size\_t bitmap;
++
++ if (UNEXPECTED(true\_size < size)) {
++ goto out\_of\_memory;
++ }
++#if ZEND\_MM\_CACHE
++ if (EXPECTED(heap->cache[index] != NULL)) {
++ /\* Get block from cache \*/
++#if ZEND\_MM\_CACHE\_STAT
++ heap->cache\_stat[index].count--;
++ heap->cache\_stat[index].hit++;
++#endif
++ best\_fit = SUHOSIN\_MANGLE\_PTR(heap->cache[index]);
++ heap->cache[index] = best\_fit->prev\_free\_block;
++ heap->cached -= true\_size;
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(best\_fit);
++ ((zend\_mm\_block\_canary\*)best\_fit)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(best\_fit);
++#endif
++ ZEND\_MM\_CHECK\_MAGIC(best\_fit, MEM\_BLOCK\_CACHED);
++ ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 0);
++ return ZEND\_MM\_DATA\_OF(best\_fit);
++ }
++#if ZEND\_MM\_CACHE\_STAT
++ heap->cache\_stat[index].miss++;
++#endif
++#endif
++
++ bitmap = heap->free\_bitmap >> index;
++ if (bitmap) {
++ /\* Found some "small" free block that can be used \*/
++ index += zend\_mm\_low\_bit(bitmap);
++ best\_fit = SUHOSIN\_MANGLE\_PTR(heap->free\_buckets[index\*2]);
++#if ZEND\_MM\_CACHE\_STAT
++ heap->cache\_stat[ZEND\_MM\_NUM\_BUCKETS].hit++;
++#endif
++ goto zend\_mm\_finished\_searching\_for\_block;
++ }
++ }
++
++#if ZEND\_MM\_CACHE\_STAT
++ heap->cache\_stat[ZEND\_MM\_NUM\_BUCKETS].miss++;
++#endif
++
++ best\_fit = zend\_mm\_search\_large\_block(heap, true\_size);
++
++ if (!best\_fit && heap->real\_size >= heap->limit - heap->block\_size) {
++ zend\_mm\_free\_block\_canary \*p = SUHOSIN\_MANGLE\_PTR(heap->rest\_buckets[0]);
++ size\_t best\_size = -1;
++
++ while (p != ZEND\_MM\_REST\_BUCKET(heap)) {
++ if (UNEXPECTED(ZEND\_MM\_FREE\_BLOCK\_SIZE(p) == true\_size)) {
++ best\_fit = p;
++ goto zend\_mm\_finished\_searching\_for\_block;
++ } else if (ZEND\_MM\_FREE\_BLOCK\_SIZE(p) > true\_size &&
++ ZEND\_MM\_FREE\_BLOCK\_SIZE(p) < best\_size) {
++ best\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(p);
++ best\_fit = p;
++ }
++ p = SUHOSIN\_MANGLE\_PTR(p->prev\_free\_block);
++ }
++ }
++
++ if (!best\_fit) {
++ if (true\_size > heap->block\_size - (ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE + ZEND\_MM\_ALIGNED\_HEADER\_SIZE)) {
++ /\* Make sure we add a memory block which is big enough,
++ segment must have header "size" and trailer "guard" block \*/
++ segment\_size = true\_size + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE + ZEND\_MM\_ALIGNED\_HEADER\_SIZE;
++ segment\_size = (segment\_size + (heap->block\_size-1)) & ~(heap->block\_size-1);
++ keep\_rest = 1;
++ } else {
++ segment\_size = heap->block\_size;
++ }
++
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++
++ if (segment\_size < true\_size ||
++ heap->real\_size + segment\_size > heap->limit) {
++ /\* Memory limit overflow \*/
++#if ZEND\_MM\_CACHE
++ zend\_mm\_free\_cache(heap);
++#endif
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++#if ZEND\_DEBUG
++ zend\_mm\_safe\_error(heap, "Allowed memory size of %ld bytes exhausted at %s:%d (tried to allocate %lu bytes)", heap->limit, \_\_zend\_filename, \_\_zend\_lineno, size);
++#else
++ zend\_mm\_safe\_error(heap, "Allowed memory size of %ld bytes exhausted (tried to allocate %lu bytes)", heap->limit, size);
++#endif
++ }
++
++ segment = (zend\_mm\_segment \*) ZEND\_MM\_STORAGE\_ALLOC(segment\_size);
++
++ if (!segment) {
++ /\* Storage manager cannot allocate memory \*/
++#if ZEND\_MM\_CACHE
++ zend\_mm\_free\_cache(heap);
++#endif
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++out\_of\_memory:
++#if ZEND\_DEBUG
++ zend\_mm\_safe\_error(heap, "Out of memory (allocated %ld) at %s:%d (tried to allocate %lu bytes)", heap->real\_size, \_\_zend\_filename, \_\_zend\_lineno, size);
++#else
++ zend\_mm\_safe\_error(heap, "Out of memory (allocated %ld) (tried to allocate %lu bytes)", heap->real\_size, size);
++#endif
++ return NULL;
++ }
++
++ heap->real\_size += segment\_size;
++ if (heap->real\_size > heap->real\_peak) {
++ heap->real\_peak = heap->real\_size;
++ }
++
++ segment->size = segment\_size;
++ segment->next\_segment = heap->segments\_list;
++ heap->segments\_list = segment;
++
++ best\_fit = (zend\_mm\_free\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ ZEND\_MM\_MARK\_FIRST\_BLOCK(best\_fit);
++
++ block\_size = segment\_size - ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE - ZEND\_MM\_ALIGNED\_HEADER\_SIZE;
++
++ ZEND\_MM\_LAST\_BLOCK(ZEND\_MM\_BLOCK\_AT(best\_fit, block\_size));
++
++ } else {
++zend\_mm\_finished\_searching\_for\_block:
++ /\* remove from free list \*/
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++ ZEND\_MM\_CHECK\_MAGIC(best\_fit, MEM\_BLOCK\_FREED);
++ ZEND\_MM\_CHECK\_COOKIE(best\_fit);
++ ZEND\_MM\_CHECK\_BLOCK\_LINKAGE(best\_fit);
++ zend\_mm\_remove\_from\_free\_list(heap, best\_fit);
++
++ block\_size = ZEND\_MM\_FREE\_BLOCK\_SIZE(best\_fit);
++ }
++
++ remaining\_size = block\_size - true\_size;
++
++ if (remaining\_size < ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE) {
++ true\_size = block\_size;
++ ZEND\_MM\_BLOCK(best\_fit, ZEND\_MM\_USED\_BLOCK, true\_size);
++ } else {
++ zend\_mm\_free\_block\_canary \*new\_free\_block;
++
++ /\* prepare new free block \*/
++ ZEND\_MM\_BLOCK(best\_fit, ZEND\_MM\_USED\_BLOCK, true\_size);
++ new\_free\_block = (zend\_mm\_free\_block\_canary \*) ZEND\_MM\_BLOCK\_AT(best\_fit, true\_size);
++ ZEND\_MM\_BLOCK(new\_free\_block, ZEND\_MM\_FREE\_BLOCK, remaining\_size);
++
++ /\* add the new free block to the free list \*/
++ if (EXPECTED(!keep\_rest)) {
++ zend\_mm\_add\_to\_free\_list(heap, new\_free\_block);
++ } else {
++ zend\_mm\_add\_to\_rest\_list(heap, new\_free\_block);
++ }
++ }
++
++ ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 1);
++
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(best\_fit);
++ ((zend\_mm\_block\_canary\*)best\_fit)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(best\_fit);
++#endif
++
++ heap->size += true\_size;
++ if (heap->peak < heap->size) {
++ heap->peak = heap->size;
++ }
++
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++ return ZEND\_MM\_DATA\_OF(best\_fit);
++}
++
++
++void \_zend\_mm\_free\_canary\_int(zend\_mm\_heap\_canary \*heap, void \*p ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_block\_canary \*mm\_block;
++ zend\_mm\_block\_canary \*next\_block;
++ size\_t size;
++
++ if (!ZEND\_MM\_VALID\_PTR(p)) {
++ return;
++ }
++
++ mm\_block = ZEND\_MM\_HEADER\_OF(p);
++ size = ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_CHECK\_CANARIES(mm\_block, "efree()");
++#endif
++ ZEND\_MM\_CHECK\_PROTECTION(mm\_block);
++
++#if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
++ memset(ZEND\_MM\_DATA\_OF(mm\_block), 0x5a, mm\_block->debug.size);
++#endif
++#if SUHOSIN\_PATCH
++ if (UNEXPECTED(SUHOSIN\_CONFIG(SUHOSIN\_MM\_DESTROY\_FREE\_MEMORY))) {
++ memset(ZEND\_MM\_DATA\_OF(mm\_block), 0x5a, mm\_block->info.size);
++ }
++#endif
++#if ZEND\_MM\_CACHE
++ if (EXPECTED(ZEND\_MM\_SMALL\_SIZE(size)) && EXPECTED(heap->cached < ZEND\_MM\_CACHE\_SIZE)) {
++ size\_t index = ZEND\_MM\_BUCKET\_INDEX(size);
++ zend\_mm\_free\_block\_canary \*\*cache = &heap->cache[index];
++
++ ((zend\_mm\_free\_block\_canary\*)mm\_block)->prev\_free\_block = \*cache;
++ \*cache = (zend\_mm\_free\_block\_canary\*)SUHOSIN\_MANGLE\_PTR(mm\_block);
++ heap->cached += size;
++ ZEND\_MM\_SET\_MAGIC(mm\_block, MEM\_BLOCK\_CACHED);
++#if ZEND\_MM\_CACHE\_STAT
++ if (++heap->cache\_stat[index].count > heap->cache\_stat[index].max\_count) {
++ heap->cache\_stat[index].max\_count = heap->cache\_stat[index].count;
++ }
++#endif
++ return;
++ }
++#endif
++
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++
++ heap->size -= size;
++
++ next\_block = ZEND\_MM\_BLOCK\_AT(mm\_block, size);
++ if (ZEND\_MM\_IS\_FREE\_BLOCK(next\_block)) {
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) next\_block);
++ size += ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block);
++ }
++ if (ZEND\_MM\_PREV\_BLOCK\_IS\_FREE(mm\_block)) {
++ mm\_block = ZEND\_MM\_PREV\_BLOCK(mm\_block);
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) mm\_block);
++ size += ZEND\_MM\_FREE\_BLOCK\_SIZE(mm\_block);
++ }
++ if (ZEND\_MM\_IS\_FIRST\_BLOCK(mm\_block) &&
++ ZEND\_MM\_IS\_GUARD\_BLOCK(ZEND\_MM\_BLOCK\_AT(mm\_block, size))) {
++ zend\_mm\_del\_segment(heap, (zend\_mm\_segment \*) ((char \*)mm\_block - ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE));
++ } else {
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_FREE\_BLOCK, size);
++ zend\_mm\_add\_to\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) mm\_block);
++ }
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++}
++
++void \*\_zend\_mm\_realloc\_canary\_int(zend\_mm\_heap\_canary \*heap, void \*p, size\_t size ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_block\_canary \*mm\_block = ZEND\_MM\_HEADER\_OF(p);
++ zend\_mm\_block\_canary \*next\_block;
++ size\_t true\_size;
++ size\_t orig\_size;
++ void \*ptr;
++
++ if (UNEXPECTED(!p) || !ZEND\_MM\_VALID\_PTR(p)) {
++ return \_zend\_mm\_alloc\_canary\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ }
++ mm\_block = ZEND\_MM\_HEADER\_OF(p);
++ true\_size = ZEND\_MM\_TRUE\_SIZE(size);
++ orig\_size = ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_CHECK\_CANARIES(mm\_block, "erealloc()");
++#endif
++ ZEND\_MM\_CHECK\_PROTECTION(mm\_block);
++
++ if (UNEXPECTED(true\_size < size)) {
++ goto out\_of\_memory;
++ }
++
++ if (true\_size <= orig\_size) {
++ size\_t remaining\_size = orig\_size - true\_size;
++
++ if (remaining\_size >= ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE) {
++ zend\_mm\_free\_block\_canary \*new\_free\_block;
++
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++ next\_block = ZEND\_MM\_BLOCK\_AT(mm\_block, orig\_size);
++ if (ZEND\_MM\_IS\_FREE\_BLOCK(next\_block)) {
++ remaining\_size += ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block);
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) next\_block);
++ }
++
++ /\* prepare new free block \*/
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_USED\_BLOCK, true\_size);
++ new\_free\_block = (zend\_mm\_free\_block\_canary \*) ZEND\_MM\_BLOCK\_AT(mm\_block, true\_size);
++
++ ZEND\_MM\_BLOCK(new\_free\_block, ZEND\_MM\_FREE\_BLOCK, remaining\_size);
++
++ /\* add the new free block to the free list \*/
++ zend\_mm\_add\_to\_free\_list(heap, new\_free\_block);
++ heap->size += (true\_size - orig\_size);
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++ }
++ ZEND\_MM\_SET\_DEBUG\_INFO(mm\_block, size, 0, 0);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(mm\_block);
++ ((zend\_mm\_block\_canary\*)mm\_block)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(mm\_block);
++#endif
++ return p;
++ }
++
++#if ZEND\_MM\_CACHE
++ if (ZEND\_MM\_SMALL\_SIZE(true\_size)) {
++ size\_t index = ZEND\_MM\_BUCKET\_INDEX(true\_size);
++
++ if (heap->cache[index] != NULL) {
++ zend\_mm\_free\_block\_canary \*best\_fit;
++ zend\_mm\_free\_block\_canary \*\*cache;
++
++#if ZEND\_MM\_CACHE\_STAT
++ heap->cache\_stat[index].count--;
++ heap->cache\_stat[index].hit++;
++#endif
++ best\_fit = SUHOSIN\_MANGLE\_PTR(heap->cache[index]);
++ heap->cache[index] = best\_fit->prev\_free\_block;
++ ZEND\_MM\_CHECK\_MAGIC(best\_fit, MEM\_BLOCK\_CACHED);
++ ZEND\_MM\_SET\_DEBUG\_INFO(best\_fit, size, 1, 0);
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(best\_fit);
++ ((zend\_mm\_block\_canary\*)best\_fit)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(best\_fit);
++#endif
++
++ ptr = ZEND\_MM\_DATA\_OF(best\_fit);
++
++#if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
++ memcpy(ptr, p, mm\_block->debug.size);
++#else
++ memcpy(ptr, p, orig\_size - ZEND\_MM\_ALIGNED\_HEADER\_SIZE - CANARY\_SIZE);
++#endif
++
++ heap->cached -= true\_size - orig\_size;
++
++ index = ZEND\_MM\_BUCKET\_INDEX(orig\_size);
++ cache = &heap->cache[index];
++
++ ((zend\_mm\_free\_block\_canary\*)mm\_block)->prev\_free\_block = \*cache;
++ \*cache = (zend\_mm\_free\_block\_canary\*)SUHOSIN\_MANGLE\_PTR(mm\_block);
++ ZEND\_MM\_SET\_MAGIC(mm\_block, MEM\_BLOCK\_CACHED);
++#if ZEND\_MM\_CACHE\_STAT
++ if (++heap->cache\_stat[index].count > heap->cache\_stat[index].max\_count) {
++ heap->cache\_stat[index].max\_count = heap->cache\_stat[index].count;
++ }
++#endif
++ return ptr;
++ }
++ }
++#endif
++
++ next\_block = ZEND\_MM\_BLOCK\_AT(mm\_block, orig\_size);
++
++ if (ZEND\_MM\_IS\_FREE\_BLOCK(next\_block)) {
++ ZEND\_MM\_CHECK\_COOKIE(next\_block);
++ ZEND\_MM\_CHECK\_BLOCK\_LINKAGE(next\_block);
++ if (orig\_size + ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block) >= true\_size) {
++ size\_t block\_size = orig\_size + ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block);
++ size\_t remaining\_size = block\_size - true\_size;
++
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) next\_block);
++
++ if (remaining\_size < ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE) {
++ true\_size = block\_size;
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_USED\_BLOCK, true\_size);
++ } else {
++ zend\_mm\_free\_block\_canary \*new\_free\_block;
++
++ /\* prepare new free block \*/
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_USED\_BLOCK, true\_size);
++ new\_free\_block = (zend\_mm\_free\_block\_canary \*) ZEND\_MM\_BLOCK\_AT(mm\_block, true\_size);
++ ZEND\_MM\_BLOCK(new\_free\_block, ZEND\_MM\_FREE\_BLOCK, remaining\_size);
++
++ /\* add the new free block to the free list \*/
++ if (ZEND\_MM\_IS\_FIRST\_BLOCK(mm\_block) &&
++ ZEND\_MM\_IS\_GUARD\_BLOCK(ZEND\_MM\_BLOCK\_AT(new\_free\_block, remaining\_size))) {
++ zend\_mm\_add\_to\_rest\_list(heap, new\_free\_block);
++ } else {
++ zend\_mm\_add\_to\_free\_list(heap, new\_free\_block);
++ }
++ }
++ ZEND\_MM\_SET\_DEBUG\_INFO(mm\_block, size, 0, 0);
++ heap->size = heap->size + true\_size - orig\_size;
++ if (heap->peak < heap->size) {
++ heap->peak = heap->size;
++ }
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(mm\_block);
++ ((zend\_mm\_block\_canary\*)mm\_block)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(mm\_block);
++#endif
++ return p;
++ } else if (ZEND\_MM\_IS\_FIRST\_BLOCK(mm\_block) &&
++ ZEND\_MM\_IS\_GUARD\_BLOCK(ZEND\_MM\_BLOCK\_AT(next\_block, ZEND\_MM\_FREE\_BLOCK\_SIZE(next\_block)))) {
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++ zend\_mm\_remove\_from\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) next\_block);
++ goto realloc\_segment;
++ }
++ } else if (ZEND\_MM\_IS\_FIRST\_BLOCK(mm\_block) && ZEND\_MM\_IS\_GUARD\_BLOCK(next\_block)) {
++ zend\_mm\_segment \*segment;
++ zend\_mm\_segment \*segment\_copy;
++ size\_t segment\_size;
++ size\_t block\_size;
++ size\_t remaining\_size;
++
++ HANDLE\_BLOCK\_INTERRUPTIONS();
++realloc\_segment:
++ /\* segment size, size of block and size of guard block \*/
++ if (true\_size > heap->block\_size - (ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE + ZEND\_MM\_ALIGNED\_HEADER\_SIZE)) {
++ segment\_size = true\_size+ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE+ZEND\_MM\_ALIGNED\_HEADER\_SIZE;
++ segment\_size = (segment\_size + (heap->block\_size-1)) & ~(heap->block\_size-1);
++ } else {
++ segment\_size = heap->block\_size;
++ }
++
++ segment\_copy = (zend\_mm\_segment \*) ((char \*)mm\_block - ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ if (segment\_size < true\_size ||
++ heap->real\_size + segment\_size - segment\_copy->size > heap->limit) {
++ if (ZEND\_MM\_IS\_FREE\_BLOCK(next\_block)) {
++ zend\_mm\_add\_to\_free\_list(heap, (zend\_mm\_free\_block\_canary \*) next\_block);
++ }
++#if ZEND\_MM\_CACHE
++ zend\_mm\_free\_cache(heap);
++#endif
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++#if ZEND\_DEBUG
++ zend\_mm\_safe\_error(heap, "Allowed memory size of %ld bytes exhausted at %s:%d (tried to allocate %ld bytes)", heap->limit, \_\_zend\_filename, \_\_zend\_lineno, size);
++#else
++ zend\_mm\_safe\_error(heap, "Allowed memory size of %ld bytes exhausted (tried to allocate %ld bytes)", heap->limit, size);
++#endif
++ return NULL;
++ }
++
++ segment = ZEND\_MM\_STORAGE\_REALLOC(segment\_copy, segment\_size);
++ if (!segment) {
++#if ZEND\_MM\_CACHE
++ zend\_mm\_free\_cache(heap);
++#endif
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++out\_of\_memory:
++#if ZEND\_DEBUG
++ zend\_mm\_safe\_error(heap, "Out of memory (allocated %ld) at %s:%d (tried to allocate %ld bytes)", heap->real\_size, \_\_zend\_filename, \_\_zend\_lineno, size);
++#else
++ zend\_mm\_safe\_error(heap, "Out of memory (allocated %ld) (tried to allocate %ld bytes)", heap->real\_size, size);
++#endif
++ return NULL;
++ }
++ heap->real\_size += segment\_size - segment->size;
++ if (heap->real\_size > heap->real\_peak) {
++ heap->real\_peak = heap->real\_size;
++ }
++
++ segment->size = segment\_size;
++
++ if (segment != segment\_copy) {
++ zend\_mm\_segment \*\*seg = &heap->segments\_list;
++ while (\*seg != segment\_copy) {
++ seg = &(\*seg)->next\_segment;
++ }
++ \*seg = segment;
++ mm\_block = (zend\_mm\_block\_canary \*) ((char \*) segment + ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE);
++ ZEND\_MM\_MARK\_FIRST\_BLOCK(mm\_block);
++ }
++
++ block\_size = segment\_size - ZEND\_MM\_ALIGNED\_SEGMENT\_SIZE - ZEND\_MM\_ALIGNED\_HEADER\_SIZE;
++ remaining\_size = block\_size - true\_size;
++
++ /\* setup guard block \*/
++ ZEND\_MM\_LAST\_BLOCK(ZEND\_MM\_BLOCK\_AT(mm\_block, block\_size));
++
++ if (remaining\_size < ZEND\_MM\_ALIGNED\_MIN\_HEADER\_SIZE) {
++ true\_size = block\_size;
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_USED\_BLOCK, true\_size);
++ } else {
++ zend\_mm\_free\_block\_canary \*new\_free\_block;
++
++ /\* prepare new free block \*/
++ ZEND\_MM\_BLOCK(mm\_block, ZEND\_MM\_USED\_BLOCK, true\_size);
++ new\_free\_block = (zend\_mm\_free\_block\_canary \*) ZEND\_MM\_BLOCK\_AT(mm\_block, true\_size);
++ ZEND\_MM\_BLOCK(new\_free\_block, ZEND\_MM\_FREE\_BLOCK, remaining\_size);
++
++ /\* add the new free block to the free list \*/
++ zend\_mm\_add\_to\_rest\_list(heap, new\_free\_block);
++ }
++
++ ZEND\_MM\_SET\_DEBUG\_INFO(mm\_block, size, 1, 1);
++
++ heap->size = heap->size + true\_size - orig\_size;
++ if (heap->peak < heap->size) {
++ heap->peak = heap->size;
++ }
++
++ HANDLE\_UNBLOCK\_INTERRUPTIONS();
++#if SUHOSIN\_PATCH
++ SUHOSIN\_MM\_SET\_CANARIES(mm\_block);
++ ((zend\_mm\_block\_canary\*)mm\_block)->info.size = size;
++ SUHOSIN\_MM\_SET\_END\_CANARY(mm\_block);
++#endif
++ return ZEND\_MM\_DATA\_OF(mm\_block);
++ }
++
++ ptr = \_zend\_mm\_alloc\_canary\_int(heap, size ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++#if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
++ memcpy(ptr, p, mm\_block->debug.size);
++#else
++ memcpy(ptr, p, orig\_size - ZEND\_MM\_ALIGNED\_HEADER\_SIZE - CANARY\_SIZE);
++#endif
++ \_zend\_mm\_free\_canary\_int(heap, p ZEND\_FILE\_LINE\_RELAY\_CC ZEND\_FILE\_LINE\_ORIG\_RELAY\_CC);
++ return ptr;
++}
++
++ZEND\_API size\_t \_zend\_mm\_block\_size\_canary(zend\_mm\_heap\_canary \*heap, void \*p ZEND\_FILE\_LINE\_DC ZEND\_FILE\_LINE\_ORIG\_DC)
++{
++ zend\_mm\_block\_canary \*mm\_block;
++
++ if (!ZEND\_MM\_VALID\_PTR(p)) {
++ return 0;
++ }
++ mm\_block = ZEND\_MM\_HEADER\_OF(p);
++ ZEND\_MM\_CHECK\_PROTECTION(mm\_block);
++#if ZEND\_DEBUG || ZEND\_MM\_HEAP\_PROTECTION
++ return mm\_block->debug.size;
++#else
++ return ZEND\_MM\_BLOCK\_SIZE(mm\_block);
++#endif
++}
++
++#if defined(\_\_GNUC\_\_) && defined(i386)
++
++static inline size\_t safe\_address(size\_t nmemb, size\_t size, size\_t offset)
++{
++ size\_t res = nmemb;
++ unsigned long overflow = 0;
++
++ \_\_asm\_\_ ("mull %3\n\taddl %4,%0\n\tadcl %1,%1"
++ : "=&a"(res), "=&d" (overflow)
++ : "%0"(res),
++ "rm"(size),
++ "rm"(offset));
++
++ if (UNEXPECTED(overflow)) {
++ zend\_error\_noreturn(E\_ERROR, "Possible integer overflow in memory allocation (%zu \* %zu + %zu)", nmemb, size, offset);
++ return 0;
++ }
++ return res;
++}
++
++#elif defined(\_\_GNUC\_\_) && defined(\_\_x86\_64\_\_)
++
++static inline size\_t safe\_address(size\_t nmemb, size\_t size, size\_t offset)
++{
++ size\_t res = nmemb;
++ unsigned long overflow = 0;
++
++ \_\_asm\_\_ ("mulq %3\n\taddq %4,%0\n\tadcq %1,%1"
++ : "=&a"(res), "=&d" (overflow)
++ : "%0"(res),
++ "rm"(size),
++ "rm"(offset));
++
++ if (UNEXPECTED(overflow)) {
++ zend\_error\_noreturn(E\_ERROR, "Possible integer overflow in memory allocation (%zu \* %zu + %zu)", nmemb, size, offset);
++ return 0;
++ }
++ return res;
++}
++
++#elif SIZEOF\_SIZE\_T == 4 && defined(HAVE\_ZEND\_LONG64)
++
++static inline size\_t safe\_address(size\_t nmemb, size\_t size, size\_t offset)
++{
++ zend\_ulong64 res = (zend\_ulong64)nmemb \* (zend\_ulong64)size + (zend\_ulong64)offset;
++
++ if (UNEXPECTED(res > (zend\_ulong64)0xFFFFFFFFL)) {
++ zend\_error\_noreturn(E\_ERROR, "Possible integer overflow in memory allocation (%zu \* %zu + %zu)", nmemb, size, offset);
++ return 0;
++ }
++ return (size\_t) res;
++}
++
++#else
++
++static inline size\_t safe\_address(size\_t nmemb, size\_t size, size\_t offset)
++{
++ size\_t res = nmemb \* size + offset;
++ double \_d = (double)nmemb \* (double)size + (double)offset;
++ double \_delta = (double)res - \_d;
++
++ if (UNEXPECTED((\_d + \_delta ) != \_d)) {
++ zend\_error\_noreturn(E\_ERROR, "Possible integer overflow in memory allocation (%zu \* %zu + %zu)", nmemb, size, offset);
++ return 0;
++ }
++ return res;
++}
++#endif
++
++/\*
++ \* Local variables:
++ \* tab-width: 4
++ \* c-basic-offset: 4
++ \* indent-tabs-mode: t
++ \* End:
++ \*/
++
+--- /dev/null
++++ b/Zend/zend\_canary.c
+@@ -0,0 +1,66 @@
++/\*
++ +----------------------------------------------------------------------+
++ | Suhosin-Patch for PHP |
++ +----------------------------------------------------------------------+
++ | Copyright (c) 2004-2009 Stefan Esser |
++ +----------------------------------------------------------------------+
++ | This source file is subject to version 2.02 of the PHP license, |
++ | that is bundled with this package in the file LICENSE, and is |
++ | available at through the world-wide-web at |
++ | http://www.php.net/license/2\_02.txt. |
++ | If you did not receive a copy of the PHP license and are unable to |
++ | obtain it through the world-wide-web, please send a note to |
++ | license@php.net so we can mail you a copy immediately. |
++ +----------------------------------------------------------------------+
++ | Author: Stefan Esser  |
++ +----------------------------------------------------------------------+
++ \*/
++/\* $Id: zend\_canary.c,v 1.1 2004/11/26 12:45:41 ionic Exp $ \*/
++
++#include "zend.h"
++
++#include
++#include
++
++
++#if SUHOSIN\_PATCH
++
++static size\_t last\_canary = 0x73625123;
++
++/\* will be replaced later with more compatible method \*/
++ZEND\_API void zend\_canary(void \*buf, int len)
++{
++ time\_t t;
++ size\_t canary;
++ int fd;
++
++#ifndef PHP\_WIN32
++ fd = open("/dev/urandom", 0);
++ if (fd != -1) {
++ int r = read(fd, buf, len);
++ close(fd);
++ if (r == len) {
++ return;
++ }
++ }
++#endif
++ /\* not good but we never want to do this \*/
++ time(&t);
++ canary = \*(unsigned int \*)&t + getpid() << 16 + last\_canary;
++ last\_canary ^= (canary << 5) | (canary >> (32-5));
++ /\* When we ensure full win32 compatibility in next version
++ we will replace this with the random number code from zend\_alloc.c \*/
++ memcpy(buf, &canary, len);
++}
++
++#endif
++
++
++/\*
++ \* Local variables:
++ \* tab-width: 4
++ \* c-basic-offset: 4
++ \* End:
++ \* vim600: sw=4 ts=4 fdm=marker
++ \* vim<600: sw=4 ts=4
++ \*/
+--- a/Zend/zend\_compile.c
++++ b/Zend/zend\_compile.c
+@@ -73,6 +73,11 @@ static void zend\_destroy\_property\_info\_i
+ }
+ /\* }}} \*/
+
++#if SUHOSIN\_PATCH
++void \*suhosin\_zend\_destroy\_property\_info\_internal = zend\_destroy\_property\_info\_internal;
++void \*suhosin\_zend\_destroy\_property\_info = zend\_destroy\_property\_info;
++#endif
++
+ static void build\_runtime\_defined\_function\_key(zval \*result, const char \*name, int name\_length TSRMLS\_DC) /\* {{{ \*/
+ {
+ char char\_pos\_buf[32];
+--- a/Zend/zend\_compile.h
++++ b/Zend/zend\_compile.h
+@@ -606,6 +606,11 @@ ZEND\_API zend\_bool zend\_is\_auto\_global(c
+ ZEND\_API int zend\_auto\_global\_disable\_jit(const char \*varname, zend\_uint varname\_length TSRMLS\_DC);
+ ZEND\_API size\_t zend\_dirname(char \*path, size\_t len);
+
++#if SUHOSIN\_PATCH
++extern void \*suhosin\_zend\_destroy\_property\_info\_internal;
++extern void \*suhosin\_zend\_destroy\_property\_info;
++#endif
++
+ int zendlex(znode \*zendlval TSRMLS\_DC);
+
+ /\* BEGIN: OPCODES \*/
+--- a/Zend/zend\_constants.c
++++ b/Zend/zend\_constants.c
+@@ -113,6 +113,76 @@ void zend\_register\_standard\_constants(TS
+
+ REGISTER\_MAIN\_LONG\_CONSTANT("E\_ALL", E\_ALL, CONST\_PERSISTENT | CONST\_CS);
+
++#if SUHOSIN\_PATCH
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_MEMORY", S\_MEMORY, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_VARS", S\_VARS, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_FILES", S\_FILES, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_INCLUDE", S\_INCLUDE, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_SQL", S\_SQL, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_EXECUTOR", S\_EXECUTOR, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_MAIL", S\_MAIL, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_SESSION", S\_SESSION, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_MISC", S\_MISC, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_INTERNAL", S\_INTERNAL, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_LONG\_CONSTANT("S\_ALL", S\_ALL, CONST\_PERSISTENT | CONST\_CS);
++
++ /\* error levels \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_EMERG", LOG\_EMERG, CONST\_CS | CONST\_PERSISTENT); /\* system unusable \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_ALERT", LOG\_ALERT, CONST\_CS | CONST\_PERSISTENT); /\* immediate action required \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_CRIT", LOG\_CRIT, CONST\_CS | CONST\_PERSISTENT); /\* critical conditions \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_ERR", LOG\_ERR, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_WARNING", LOG\_WARNING, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_NOTICE", LOG\_NOTICE, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_INFO", LOG\_INFO, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_DEBUG", LOG\_DEBUG, CONST\_CS | CONST\_PERSISTENT);
++ /\* facility: type of program logging the message \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_KERN", LOG\_KERN, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_USER", LOG\_USER, CONST\_CS | CONST\_PERSISTENT); /\* generic user level \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_MAIL", LOG\_MAIL, CONST\_CS | CONST\_PERSISTENT); /\* log to email \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_DAEMON", LOG\_DAEMON, CONST\_CS | CONST\_PERSISTENT); /\* other system daemons \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_AUTH", LOG\_AUTH, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_SYSLOG", LOG\_SYSLOG, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LPR", LOG\_LPR, CONST\_CS | CONST\_PERSISTENT);
++#ifdef LOG\_NEWS
++ /\* No LOG\_NEWS on HP-UX \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_NEWS", LOG\_NEWS, CONST\_CS | CONST\_PERSISTENT); /\* usenet new \*/
++#endif
++#ifdef LOG\_UUCP
++ /\* No LOG\_UUCP on HP-UX \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_UUCP", LOG\_UUCP, CONST\_CS | CONST\_PERSISTENT);
++#endif
++#ifdef LOG\_CRON
++ /\* apparently some systems don't have this one \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_CRON", LOG\_CRON, CONST\_CS | CONST\_PERSISTENT);
++#endif
++#ifdef LOG\_AUTHPRIV
++ /\* AIX doesn't have LOG\_AUTHPRIV \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_AUTHPRIV", LOG\_AUTHPRIV, CONST\_CS | CONST\_PERSISTENT);
++#endif
++#ifndef PHP\_WIN32
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL0", LOG\_LOCAL0, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL1", LOG\_LOCAL1, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL2", LOG\_LOCAL2, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL3", LOG\_LOCAL3, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL4", LOG\_LOCAL4, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL5", LOG\_LOCAL5, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL6", LOG\_LOCAL6, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_LOCAL7", LOG\_LOCAL7, CONST\_CS | CONST\_PERSISTENT);
++#endif
++ /\* options \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_PID", LOG\_PID, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_CONS", LOG\_CONS, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_ODELAY", LOG\_ODELAY, CONST\_CS | CONST\_PERSISTENT);
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_NDELAY", LOG\_NDELAY, CONST\_CS | CONST\_PERSISTENT);
++#ifdef LOG\_NOWAIT
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_NOWAIT", LOG\_NOWAIT, CONST\_CS | CONST\_PERSISTENT);
++#endif
++#ifdef LOG\_PERROR
++ /\* AIX doesn't have LOG\_PERROR \*/
++ REGISTER\_MAIN\_LONG\_CONSTANT("LOG\_PERROR", LOG\_PERROR, CONST\_CS | CONST\_PERSISTENT); /\*log to stderr\*/
++#endif
++#endif
++
+ /\* true/false constants \*/
+ {
+ zend\_constant c;
+--- a/Zend/zend\_errors.h
++++ b/Zend/zend\_errors.h
+@@ -41,6 +41,20 @@
+ #define E\_ALL (E\_ERROR | E\_WARNING | E\_PARSE | E\_NOTICE | E\_CORE\_ERROR | E\_CORE\_WARNING | E\_COMPILE\_ERROR | E\_COMPILE\_WARNING | E\_USER\_ERROR | E\_USER\_WARNING | E\_USER\_NOTICE | E\_RECOVERABLE\_ERROR | E\_DEPRECATED | E\_USER\_DEPRECATED)
+ #define E\_CORE (E\_CORE\_ERROR | E\_CORE\_WARNING)
+
++#if SUHOSIN\_PATCH
++#define S\_MEMORY (1<<0L)
++#define S\_MISC (1<<1L)
++#define S\_VARS (1<<2L)
++#define S\_FILES (1<<3L)
++#define S\_INCLUDE (1<<4L)
++#define S\_SQL (1<<5L)
++#define S\_EXECUTOR (1<<6L)
++#define S\_MAIL (1<<7L)
++#define S\_SESSION (1<<8L)
++#define S\_INTERNAL (1<<29L)
++#define S\_ALL (S\_MEMORY | S\_VARS | S\_INCLUDE | S\_FILES | S\_MAIL | S\_SESSION | S\_MISC | S\_SQL | S\_EXECUTOR)
++#endif
++
+ #endif /\* ZEND\_ERRORS\_H \*/
+
+ /\*
+--- a/Zend/zend\_hash.c
++++ b/Zend/zend\_hash.c
+@@ -20,6 +20,7 @@
+ /\* $Id: zend\_hash.c 293155 2010-01-05 20:46:53Z sebastian $ \*/
+
+ #include "zend.h"
++#include "zend\_compile.h"
+
+ #define CONNECT\_TO\_BUCKET\_DLLIST(element, list\_head) \
+ (element)->pNext = (list\_head); \
+@@ -133,6 +134,199 @@ ZEND\_API ulong zend\_hash\_func(const char
+ }
+
+
++#if SUHOSIN\_PATCH
++#ifdef ZTS
++static MUTEX\_T zend\_hash\_dprot\_mx\_reader;
++static MUTEX\_T zend\_hash\_dprot\_mx\_writer;
++static unsigned int zend\_hash\_dprot\_reader;
++#endif
++static unsigned int zend\_hash\_dprot\_counter;
++static unsigned int zend\_hash\_dprot\_curmax;
++static dtor\_func\_t \*zend\_hash\_dprot\_table = NULL;
++
++static void zend\_hash\_dprot\_begin\_read()
++{
++#ifdef ZTS
++ tsrm\_mutex\_lock(zend\_hash\_dprot\_mx\_reader);
++ if ((++(zend\_hash\_dprot\_reader)) == 1) {
++ tsrm\_mutex\_lock(zend\_hash\_dprot\_mx\_writer);
++ }
++ tsrm\_mutex\_unlock(zend\_hash\_dprot\_mx\_reader);
++#endif
++}
++
++static void zend\_hash\_dprot\_end\_read()
++{
++#ifdef ZTS
++ tsrm\_mutex\_lock(zend\_hash\_dprot\_mx\_reader);
++ if ((--(zend\_hash\_dprot\_reader)) == 0) {
++ tsrm\_mutex\_unlock(zend\_hash\_dprot\_mx\_writer);
++ }
++ tsrm\_mutex\_unlock(zend\_hash\_dprot\_mx\_reader);
++#endif
++}
++
++static void zend\_hash\_dprot\_begin\_write()
++{
++#ifdef ZTS
++ tsrm\_mutex\_lock(zend\_hash\_dprot\_mx\_writer);
++#endif
++}
++
++static void zend\_hash\_dprot\_end\_write()
++{
++#ifdef ZTS
++ tsrm\_mutex\_unlock(zend\_hash\_dprot\_mx\_writer);
++#endif
++}
++
++/\*ZEND\_API void zend\_hash\_dprot\_dtor()
++{
++#ifdef ZTS
++ tsrm\_mutex\_free(zend\_hash\_dprot\_mx\_reader);
++ tsrm\_mutex\_free(zend\_hash\_dprot\_mx\_writer);
++#endif
++ free(zend\_hash\_dprot\_table);
++}\*/
++
++static void zend\_hash\_add\_destructor(dtor\_func\_t pDestructor)
++{
++ int left, right, mid;
++ zend\_bool found = 0;
++ unsigned long value;
++
++ if (pDestructor == NULL || pDestructor == ZVAL\_PTR\_DTOR || pDestructor == ZVAL\_INTERNAL\_PTR\_DTOR
++ || pDestructor == ZEND\_FUNCTION\_DTOR || pDestructor == ZEND\_CLASS\_DTOR) {
++ return;
++ }
++
++ if (zend\_hash\_dprot\_table == NULL) {
++#ifdef ZTS
++ zend\_hash\_dprot\_mx\_reader = tsrm\_mutex\_alloc();
++ zend\_hash\_dprot\_mx\_writer = tsrm\_mutex\_alloc();
++ zend\_hash\_dprot\_reader = 0;
++#endif
++ zend\_hash\_dprot\_counter = 0;
++ zend\_hash\_dprot\_curmax = 256;
++ zend\_hash\_dprot\_table = (dtor\_func\_t \*) malloc(256 \* sizeof(dtor\_func\_t));
++ }
++
++ zend\_hash\_dprot\_begin\_write();
++
++ if (zend\_hash\_dprot\_counter == 0) {
++ zend\_hash\_dprot\_counter++;
++ zend\_hash\_dprot\_table[0] = pDestructor;
++ } else {
++ value = (unsigned long) pDestructor;
++ left = 0;
++ right = zend\_hash\_dprot\_counter-1;
++ mid = 0;
++
++ while (left < right) {
++ mid = (right - left) >> 1;
++ mid += left;
++ if ((unsigned long)zend\_hash\_dprot\_table[mid] == value) {
++ found = 1;
++ break;
++ }
++ if (value < (unsigned long)zend\_hash\_dprot\_table[mid]) {
++ right = mid-1;
++ } else {
++ left = mid+1;
++ }
++ }
++ if ((unsigned long)zend\_hash\_dprot\_table[left] == value) {
++ found = 1;
++ }
++
++ if (!found) {
++
++ if (zend\_hash\_dprot\_counter >= zend\_hash\_dprot\_curmax) {
++ zend\_hash\_dprot\_curmax += 256;
++ zend\_hash\_dprot\_table = (dtor\_func\_t \*) realloc(zend\_hash\_dprot\_table, zend\_hash\_dprot\_curmax \* sizeof(dtor\_func\_t));
++ }
++
++ if ((unsigned long)zend\_hash\_dprot\_table[left] < value) {
++ memmove(zend\_hash\_dprot\_table+left+2, zend\_hash\_dprot\_table+left+1, (zend\_hash\_dprot\_counter-left-1)\*sizeof(dtor\_func\_t));
++ zend\_hash\_dprot\_table[left+1] = pDestructor;
++ } else {
++ memmove(zend\_hash\_dprot\_table+left+1, zend\_hash\_dprot\_table+left, (zend\_hash\_dprot\_counter-left)\*sizeof(dtor\_func\_t));
++ zend\_hash\_dprot\_table[left] = pDestructor;
++ }
++
++ zend\_hash\_dprot\_counter++;
++ }
++ }
++
++ zend\_hash\_dprot\_end\_write();
++}
++
++static void zend\_hash\_check\_destructor(dtor\_func\_t pDestructor)
++{
++ unsigned long value;
++
++ if (pDestructor == NULL || pDestructor == ZVAL\_PTR\_DTOR || pDestructor == ZVAL\_INTERNAL\_PTR\_DTOR
++#ifdef ZEND\_ENGINE\_2
++ || pDestructor == suhosin\_zend\_destroy\_property\_info\_internal || pDestructor == suhosin\_zend\_destroy\_property\_info
++#endif
++ || pDestructor == ZEND\_FUNCTION\_DTOR || pDestructor == ZEND\_CLASS\_DTOR) {
++ return;
++ }
++
++ zend\_hash\_dprot\_begin\_read();
++
++ if (zend\_hash\_dprot\_counter > 0) {
++ int left, right, mid;
++ zend\_bool found = 0;
++
++ value = (unsigned long) pDestructor;
++ left = 0;
++ right = zend\_hash\_dprot\_counter-1;
++
++ while (left < right) {
++ mid = (right - left) >> 1;
++ mid += left;
++ if ((unsigned long)zend\_hash\_dprot\_table[mid] == value) {
++ found = 1;
++ break;
++ }
++ if (value < (unsigned long)zend\_hash\_dprot\_table[mid]) {
++ right = mid-1;
++ } else {
++ left = mid+1;
++ }
++ }
++ if ((unsigned long)zend\_hash\_dprot\_table[left] == value) {
++ found = 1;
++ }
++
++ if (!found) {
++ zend\_hash\_dprot\_end\_read();
++
++ zend\_suhosin\_log(S\_MEMORY, "possible memory corruption detected - unknown Hashtable destructor");
++ if (SUHOSIN\_CONFIG(SUHOSIN\_HT\_IGNORE\_INVALID\_DESTRUCTOR) == 0) {
++ \_exit(1);
++ }
++ return;
++ }
++
++ } else {
++ zend\_hash\_dprot\_end\_read();
++
++ zend\_suhosin\_log(S\_MEMORY, "possible memory corruption detected - unknown Hashtable destructor");
++ if (SUHOSIN\_CONFIG(SUHOSIN\_HT\_IGNORE\_INVALID\_DESTRUCTOR) == 0) {
++ \_exit(1);
++ }
++ return;
++ }
++
++ zend\_hash\_dprot\_end\_read();
++}
++
++#else
++#define zend\_hash\_add\_destructor(pDestructor) do {} while(0)
++#define zend\_hash\_check\_destructor(pDestructor) do {} while(0)
++#endif
+
+ ZEND\_API int \_zend\_hash\_init(HashTable \*ht, uint nSize, hash\_func\_t pHashFunction, dtor\_func\_t pDestructor, zend\_bool persistent ZEND\_FILE\_LINE\_DC)
+ {
+@@ -153,6 +347,7 @@ ZEND\_API int \_zend\_hash\_init(HashTable \*
+
+ ht->nTableMask = ht->nTableSize - 1;
+ ht->pDestructor = pDestructor;
++ zend\_hash\_add\_destructor(pDestructor);
+ ht->arBuckets = NULL;
+ ht->pListHead = NULL;
+ ht->pListTail = NULL;
+@@ -230,6 +425,7 @@ ZEND\_API int \_zend\_hash\_add\_or\_update(Ha
+ return FAILURE;
+ }
+ #endif
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ if (ht->pDestructor) {
+ ht->pDestructor(p->pData);
+ }
+@@ -295,6 +491,7 @@ ZEND\_API int \_zend\_hash\_quick\_add\_or\_upd
+ return FAILURE;
+ }
+ #endif
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ if (ht->pDestructor) {
+ ht->pDestructor(p->pData);
+ }
+@@ -370,6 +567,7 @@ ZEND\_API int \_zend\_hash\_index\_update\_or\_
+ return FAILURE;
+ }
+ #endif
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ if (ht->pDestructor) {
+ ht->pDestructor(p->pData);
+ }
+@@ -493,6 +691,7 @@ ZEND\_API int zend\_hash\_del\_key\_or\_index(
+ if (ht->pInternalPointer == p) {
+ ht->pInternalPointer = p->pListNext;
+ }
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ if (ht->pDestructor) {
+ ht->pDestructor(p->pData);
+ }
+@@ -519,6 +718,7 @@ ZEND\_API void zend\_hash\_destroy(HashTabl
+ SET\_INCONSISTENT(HT\_IS\_DESTROYING);
+
+ p = ht->pListHead;
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ while (p != NULL) {
+ q = p;
+ p = p->pListNext;
+@@ -545,6 +745,7 @@ ZEND\_API void zend\_hash\_clean(HashTable
+ SET\_INCONSISTENT(HT\_CLEANING);
+
+ p = ht->pListHead;
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ while (p != NULL) {
+ q = p;
+ p = p->pListNext;
+@@ -607,6 +808,7 @@ static Bucket \*zend\_hash\_apply\_deleter(H
+ ht->nNumOfElements--;
+ HANDLE\_UNBLOCK\_INTERRUPTIONS();
+
++ zend\_hash\_check\_destructor(ht->pDestructor);
+ if (ht->pDestructor) {
+ ht->pDestructor(p->pData);
+ }
+--- a/Zend/zend\_llist.c
++++ b/Zend/zend\_llist.c
+@@ -23,6 +23,194 @@
+ #include "zend\_llist.h"
+ #include "zend\_qsort.h"
+
++#if SUHOSIN\_PATCH
++#ifdef ZTS
++static MUTEX\_T zend\_llist\_dprot\_mx\_reader;
++static MUTEX\_T zend\_llist\_dprot\_mx\_writer;
++static unsigned int zend\_llist\_dprot\_reader;
++#endif
++static unsigned int zend\_llist\_dprot\_counter;
++static unsigned int zend\_llist\_dprot\_curmax;
++static llist\_dtor\_func\_t \*zend\_llist\_dprot\_table = NULL;
++
++static void zend\_llist\_dprot\_begin\_read()
++{
++#ifdef ZTS
++ tsrm\_mutex\_lock(zend\_llist\_dprot\_mx\_reader);
++ if ((++(zend\_llist\_dprot\_reader)) == 1) {
++ tsrm\_mutex\_lock(zend\_llist\_dprot\_mx\_writer);
++ }
++ tsrm\_mutex\_unlock(zend\_llist\_dprot\_mx\_reader);
++#endif
++}
++
++static void zend\_llist\_dprot\_end\_read()
++{
++#ifdef ZTS
++ tsrm\_mutex\_lock(zend\_llist\_dprot\_mx\_reader);
++ if ((--(zend\_llist\_dprot\_reader)) == 0) {
++ tsrm\_mutex\_unlock(zend\_llist\_dprot\_mx\_writer);
++ }
++ tsrm\_mutex\_unlock(zend\_llist\_dprot\_mx\_reader);
++#endif
++}
++
++static void zend\_llist\_dprot\_begin\_write()
++{
++#ifdef ZTS
++ tsrm\_mutex\_lock(zend\_llist\_dprot\_mx\_writer);
++#endif
++}
++
++static void zend\_llist\_dprot\_end\_write()
++{
++#ifdef ZTS
++ tsrm\_mutex\_unlock(zend\_llist\_dprot\_mx\_writer);
++#endif
++}
++
++/\*ZEND\_API void zend\_llist\_dprot\_dtor()
++{
++#ifdef ZTS
++ tsrm\_mutex\_free(zend\_llist\_dprot\_mx\_reader);
++ tsrm\_mutex\_free(zend\_llist\_dprot\_mx\_writer);
++#endif
++ free(zend\_llist\_dprot\_table);
++}\*/
++
++static void zend\_llist\_add\_destructor(llist\_dtor\_func\_t pDestructor)
++{
++ int left, right, mid;
++ zend\_bool found = 0;
++ unsigned long value;
++
++ if (pDestructor == NULL || pDestructor == ZVAL\_PTR\_DTOR) {
++ return;
++ }
++
++ if (zend\_llist\_dprot\_table == NULL) {
++#ifdef ZTS
++ zend\_llist\_dprot\_mx\_reader = tsrm\_mutex\_alloc();
++ zend\_llist\_dprot\_mx\_writer = tsrm\_mutex\_alloc();
++ zend\_llist\_dprot\_reader = 0;
++#endif
++ zend\_llist\_dprot\_counter = 0;
++ zend\_llist\_dprot\_curmax = 256;
++ zend\_llist\_dprot\_table = (llist\_dtor\_func\_t \*) malloc(256 \* sizeof(llist\_dtor\_func\_t));
++ }
++
++ zend\_llist\_dprot\_begin\_write();
++
++ if (zend\_llist\_dprot\_counter == 0) {
++ zend\_llist\_dprot\_counter++;
++ zend\_llist\_dprot\_table[0] = pDestructor;
++ } else {
++ value = (unsigned long) pDestructor;
++ left = 0;
++ right = zend\_llist\_dprot\_counter-1;
++ mid = 0;
++
++ while (left < right) {
++ mid = (right - left) >> 1;
++ mid += left;
++ if ((unsigned long)zend\_llist\_dprot\_table[mid] == value) {
++ found = 1;
++ break;
++ }
++ if (value < (unsigned long)zend\_llist\_dprot\_table[mid]) {
++ right = mid-1;
++ } else {
++ left = mid+1;
++ }
++ }
++ if ((unsigned long)zend\_llist\_dprot\_table[left] == value) {
++ found = 1;
++ }
++
++ if (!found) {
++
++ if (zend\_llist\_dprot\_counter >= zend\_llist\_dprot\_curmax) {
++ zend\_llist\_dprot\_curmax += 256;
++ zend\_llist\_dprot\_table = (llist\_dtor\_func\_t \*) realloc(zend\_llist\_dprot\_table, zend\_llist\_dprot\_curmax \* sizeof(llist\_dtor\_func\_t));
++ }
++
++ if ((unsigned long)zend\_llist\_dprot\_table[left] < value) {
++ memmove(zend\_llist\_dprot\_table+left+2, zend\_llist\_dprot\_table+left+1, (zend\_llist\_dprot\_counter-left-1)\*sizeof(llist\_dtor\_func\_t));
++ zend\_llist\_dprot\_table[left+1] = pDestructor;
++ } else {
++ memmove(zend\_llist\_dprot\_table+left+1, zend\_llist\_dprot\_table+left, (zend\_llist\_dprot\_counter-left)\*sizeof(llist\_dtor\_func\_t));
++ zend\_llist\_dprot\_table[left] = pDestructor;
++ }
++
++ zend\_llist\_dprot\_counter++;
++ }
++ }
++
++ zend\_llist\_dprot\_end\_write();
++}
++
++static void zend\_llist\_check\_destructor(llist\_dtor\_func\_t pDestructor)
++{
++ unsigned long value;
++
++ if (pDestructor == NULL || pDestructor == ZVAL\_PTR\_DTOR) {
++ return;
++ }
++
++ zend\_llist\_dprot\_begin\_read();
++
++ if (zend\_llist\_dprot\_counter > 0) {
++ int left, right, mid;
++ zend\_bool found = 0;
++
++ value = (unsigned long) pDestructor;
++ left = 0;
++ right = zend\_llist\_dprot\_counter-1;
++
++ while (left < right) {
++ mid = (right - left) >> 1;
++ mid += left;
++ if ((unsigned long)zend\_llist\_dprot\_table[mid] == value) {
++ found = 1;
++ break;
++ }
++ if (value < (unsigned long)zend\_llist\_dprot\_table[mid]) {
++ right = mid-1;
++ } else {
++ left = mid+1;
++ }
++ }
++ if ((unsigned long)zend\_llist\_dprot\_table[left] == value) {
++ found = 1;
++ }
++
++ if (!found) {
++ zend\_llist\_dprot\_end\_read();
++
++ zend\_suhosin\_log(S\_MEMORY, "possible memory corruption detected - unknown llist destructor");
++ if (SUHOSIN\_CONFIG(SUHOSIN\_LL\_IGNORE\_INVALID\_DESTRUCTOR) == 0) {
++ \_exit(1);
++ }
++ return;
++ }
++
++ } else {
++ zend\_llist\_dprot\_end\_read();
++
++ zend\_suhosin\_log(S\_MEMORY, "possible memory corruption detected - unknown llist destructor");
++ if (SUHOSIN\_CONFIG(SUHOSIN\_LL\_IGNORE\_INVALID\_DESTRUCTOR) == 0) {
++ \_exit(1);
++ }
++ return;
++ }
++
++ zend\_llist\_dprot\_end\_read();
++}
++#else
++#define zend\_llist\_add\_destructor(pDestructor) do {} while(0)
++#define zend\_llist\_check\_destructor(pDestructor) do {} while(0)
++#endif
++
+ ZEND\_API void zend\_llist\_init(zend\_llist \*l, size\_t size, llist\_dtor\_func\_t dtor, unsigned char persistent)
+ {
+ l->head = NULL;
+@@ -30,6 +218,7 @@ ZEND\_API void zend\_llist\_init(zend\_llist
+ l->count = 0;
+ l->size = size;
+ l->dtor = dtor;
++ zend\_llist\_add\_destructor(dtor);
+ l->persistent = persistent;
+ }
+
+@@ -81,6 +270,7 @@ ZEND\_API void zend\_llist\_prepend\_element
+ } else {\
+ (l)->tail = (current)->prev;\
+ }\
++ zend\_llist\_check\_destructor((l)->dtor); \
+ if ((l)->dtor) {\
+ (l)->dtor((current)->data);\
+ }\
+@@ -108,6 +298,7 @@ ZEND\_API void zend\_llist\_destroy(zend\_ll
+ {
+ zend\_llist\_element \*current=l->head, \*next;
+
++ zend\_llist\_check\_destructor(l->dtor);
+ while (current) {
+ next = current->next;
+ if (l->dtor) {
+@@ -133,6 +324,7 @@ ZEND\_API void \*zend\_llist\_remove\_tail(ze
+ zend\_llist\_element \*old\_tail;
+ void \*data;
+
++ zend\_llist\_check\_destructor((l)->dtor);
+ if ((old\_tail = l->tail)) {
+ if (old\_tail->prev) {
+ old\_tail->prev->next = NULL;
+--- a/Zend/zend\_operators.c
++++ b/Zend/zend\_operators.c
+@@ -152,9 +152,14 @@ ZEND\_API void convert\_scalar\_to\_number(z
+ case IS\_STRING:
+ {
+ char \*strval;
++ int strl;
+
+ strval = Z\_STRVAL\_P(op);
+- if ((Z\_TYPE\_P(op)=is\_numeric\_string(strval, Z\_STRLEN\_P(op), &Z\_LVAL\_P(op), &Z\_DVAL\_P(op), 1)) == 0) {
++ strl = Z\_STRLEN\_P(op);
++#if SUHOSIN\_PATCH
++ Z\_STRLEN\_P(op) = 0;
++#endif
++ if ((Z\_TYPE\_P(op)=is\_numeric\_string(strval, strl, &Z\_LVAL\_P(op), &Z\_DVAL\_P(op), 1)) == 0) {
+ ZVAL\_LONG(op, 0);
+ }
+ STR\_FREE(strval);
+@@ -186,7 +191,8 @@ ZEND\_API void convert\_scalar\_to\_number(z
+ } else { \
+ switch (Z\_TYPE\_P(op)) { \
+ case IS\_STRING: \
+- { \
++ { \
++ Z\_STRLEN(holder) = 0; \
+ if ((Z\_TYPE(holder)=is\_numeric\_string(Z\_STRVAL\_P(op), Z\_STRLEN\_P(op), &Z\_LVAL(holder), &Z\_DVAL(holder), 1)) == 0) { \
+ ZVAL\_LONG(&(holder), 0); \
+ } \
+@@ -228,6 +234,7 @@ ZEND\_API void convert\_scalar\_to\_number(z
+ Z\_LVAL(holder) = zend\_dval\_to\_lval(Z\_DVAL\_P(op)); \
+ break; \
+ case IS\_STRING: \
++ Z\_STRLEN(holder) = 0; \
+ Z\_LVAL(holder) = strtol(Z\_STRVAL\_P(op), NULL, 10); \
+ break; \
+ case IS\_ARRAY: \
+@@ -270,6 +277,7 @@ ZEND\_API void convert\_scalar\_to\_number(z
+ Z\_LVAL(holder) = (Z\_DVAL\_P(op) ? 1 : 0); \
+ break; \
+ case IS\_STRING: \
++ Z\_STRLEN(holder) = 0; \
+ if (Z\_STRLEN\_P(op) == 0 \
+ || (Z\_STRLEN\_P(op)==1 && Z\_STRVAL\_P(op)[0]=='0')) { \
+ Z\_LVAL(holder) = 0; \
+@@ -355,6 +363,9 @@ ZEND\_API void convert\_to\_long\_base(zval
+ {
+ char \*strval = Z\_STRVAL\_P(op);
+
++#if SUHOSIN\_PATCH
++ Z\_STRLEN\_P(op) = 0;
++#endif
+ Z\_LVAL\_P(op) = strtol(strval, NULL, base);
+ STR\_FREE(strval);
+ }
+@@ -415,6 +426,9 @@ ZEND\_API void convert\_to\_double(zval \*op
+ {
+ char \*strval = Z\_STRVAL\_P(op);
+
++#if SUHOSIN\_PATCH
++ Z\_STRLEN\_P(op) = 0;
++#endif
+ Z\_DVAL\_P(op) = zend\_strtod(strval, NULL);
+ STR\_FREE(strval);
+ }
+@@ -501,8 +515,14 @@ ZEND\_API void convert\_to\_boolean(zval \*o
+
+ if (Z\_STRLEN\_P(op) == 0
+ || (Z\_STRLEN\_P(op)==1 && Z\_STRVAL\_P(op)[0]=='0')) {
++#if SUHOSIN\_PATCH
++ Z\_STRLEN\_P(op) = 0;
++#endif
+ Z\_LVAL\_P(op) = 0;
+ } else {
++#if SUHOSIN\_PATCH
++ Z\_STRLEN\_P(op) = 0;
++#endif
+ Z\_LVAL\_P(op) = 1;
+ }
+ STR\_FREE(strval);
+@@ -616,6 +636,9 @@ static void convert\_scalar\_to\_array(zval
+ \*entry = \*op;
+ INIT\_PZVAL(entry);
+
++#if SUHOSIN\_PATCH
++ Z\_STRLEN\_P(op) = 0;
++#endif
+ switch (type) {
+ case IS\_ARRAY:
+ ALLOC\_HASHTABLE(Z\_ARRVAL\_P(op));
+--- a/Zend/zend\_variables.c
++++ b/Zend/zend\_variables.c
+@@ -34,6 +34,9 @@ ZEND\_API void \_zval\_dtor\_func(zval \*zval
+ case IS\_CONSTANT:
+ CHECK\_ZVAL\_STRING\_REL(zvalue);
+ STR\_FREE\_REL(zvalue->value.str.val);
++#if SUHOSIN\_PATCH
++ zvalue->value.str.len = 0;
++#endif
+ break;
+ case IS\_ARRAY:
+ case IS\_CONSTANT\_ARRAY: {
+@@ -78,6 +81,9 @@ ZEND\_API void \_zval\_internal\_dtor(zval \*
+ case IS\_CONSTANT:
+ CHECK\_ZVAL\_STRING\_REL(zvalue);
+ free(zvalue->value.str.val);
++#if SUHOSIN\_PATCH
++ zvalue->value.str.len = 0;
++#endif
+ break;
+ case IS\_ARRAY:
+ case IS\_CONSTANT\_ARRAY:
+--- a/configure.in
++++ b/configure.in
+@@ -289,6 +289,7 @@ sinclude(Zend/Zend.m4)
+ sinclude(TSRM/threads.m4)
+ sinclude(TSRM/tsrm.m4)
+
++sinclude(main/suhosin\_patch.m4)
+
+ dnl divert(2)
+
+@@ -1399,7 +1400,7 @@ PHP\_ADD\_SOURCES(main, main.c snprintf.c
+ php\_ini.c SAPI.c rfc1867.c php\_content\_types.c strlcpy.c \
+ strlcat.c mergesort.c reentrancy.c php\_variables.c php\_ticks.c \
+ network.c php\_open\_temporary\_file.c php\_logos.c \
+- output.c getopt.c)
++ output.c getopt.c suhosin\_patch.c )
+
+ PHP\_ADD\_SOURCES(main/streams, streams.c cast.c memory.c filter.c \
+ plain\_wrapper.c userspace.c transports.c xp\_socket.c mmap.c \
+@@ -1427,7 +1428,7 @@ PHP\_ADD\_SOURCES(Zend, \
+ zend\_list.c zend\_indent.c zend\_builtin\_functions.c zend\_sprintf.c \
+ zend\_ini.c zend\_qsort.c zend\_multibyte.c zend\_ts\_hash.c zend\_stream.c \
+ zend\_iterators.c zend\_interfaces.c zend\_exceptions.c zend\_strtod.c zend\_gc.c \
+- zend\_closures.c zend\_float.c)
++ zend\_closures.c zend\_float.c zend\_canary.c zend\_alloc\_canary.c )
+
+ if test -r "$abs\_srcdir/Zend/zend\_objects.c"; then
+ PHP\_ADD\_SOURCES(Zend, zend\_objects.c zend\_object\_handlers.c zend\_objects\_API.c zend\_default\_classes.c)
+--- a/ext/standard/dl.c
++++ b/ext/standard/dl.c
+@@ -249,6 +249,23 @@ PHPAPI int php\_load\_extension(char \*file
+ return FAILURE;
+ }
+ }
++
++#if SUHOSIN\_PATCH
++ if (strncmp("suhosin", module\_entry->name, sizeof("suhosin")-1) == 0) {
++ void \*log\_func;
++ /\* sucessfully loaded suhosin extension, now check for logging function replacement \*/
++ log\_func = (void \*) DL\_FETCH\_SYMBOL(handle, "suhosin\_log");
++ if (log\_func == NULL) {
++ log\_func = (void \*) DL\_FETCH\_SYMBOL(handle, "\_suhosin\_log");
++ }
++ if (log\_func != NULL) {
++ zend\_suhosin\_log = log\_func;
++ } else {
++ zend\_suhosin\_log(S\_MISC, "could not replace logging function");
++ }
++ }
++#endif
++
+ return SUCCESS;
+ }
+ /\* }}} \*/
+--- a/ext/standard/info.c
++++ b/ext/standard/info.c
+@@ -867,6 +867,33 @@ PHPAPI void php\_print\_info(int flag TSRM
+
+ php\_info\_print\_table\_end();
+
++ /\* Suhosin Patch \*/
++ php\_info\_print\_box\_start(0);
++ if (expose\_php && !sapi\_module.phpinfo\_as\_text) {
++ PUTS("[![\"Suhosin](\"");)](%5C%22http%3A//www.suhosin.org%5C%22)\n");
++ }
++ PUTS("This server is protected with the Suhosin Patch ");
++ if (sapi\_module.phpinfo\_as\_text) {
++ PUTS(SUHOSIN\_PATCH\_VERSION);
++ } else {
++ zend\_html\_puts(SUHOSIN\_PATCH\_VERSION, strlen(SUHOSIN\_PATCH\_VERSION) TSRMLS\_CC);
++ }
++ PUTS(!sapi\_module.phpinfo\_as\_text?"
":"\n");
++ if (sapi\_module.phpinfo\_as\_text) {
++ PUTS("Copyright (c) 2006-2007 Hardened-PHP Project\n");
++ PUTS("Copyright (c) 2007-2009 SektionEins GmbH\n");
++ } else {
++ PUTS("Copyright (c) 2006-2007 [Hardened-PHP Project](%5C%22http%3A//www.hardened-php.net/%5C%22)\n");
++ PUTS("Copyright (c) 2007-2009 [SektionEins GmbH](%5C%22http%3A//www.sektioneins.de/%5C%22)\n");
++ }
++ php\_info\_print\_box\_end();
++
+ /\* Zend Engine \*/
+ php\_info\_print\_box\_start(0);
+ if (expose\_php && !sapi\_module.phpinfo\_as\_text) {
+--- a/ext/standard/syslog.c
++++ b/ext/standard/syslog.c
+@@ -42,6 +42,7 @@ static void start\_syslog(TSRMLS\_D);
+ \*/
+ PHP\_MINIT\_FUNCTION(syslog)
+ {
++#if !SUHOSIN\_PATCH
+ /\* error levels \*/
+ REGISTER\_LONG\_CONSTANT("LOG\_EMERG", LOG\_EMERG, CONST\_CS | CONST\_PERSISTENT); /\* system unusable \*/
+ REGISTER\_LONG\_CONSTANT("LOG\_ALERT", LOG\_ALERT, CONST\_CS | CONST\_PERSISTENT); /\* immediate action required \*/
+@@ -97,6 +98,7 @@ PHP\_MINIT\_FUNCTION(syslog)
+ /\* AIX doesn't have LOG\_PERROR \*/
+ REGISTER\_LONG\_CONSTANT("LOG\_PERROR", LOG\_PERROR, CONST\_CS | CONST\_PERSISTENT); /\*log to stderr\*/
+ #endif
++#endif
+ BG(syslog\_device)=NULL;
+
+ return SUCCESS;
+--- a/main/fopen\_wrappers.c
++++ b/main/fopen\_wrappers.c
+@@ -85,13 +85,8 @@ or a tightening during activation/runtim
+ PHPAPI ZEND\_INI\_MH(OnUpdateBaseDir)
+ {
+ char \*\*p, \*pathbuf, \*ptr, \*end;
+-#ifndef ZTS
+- char \*base = (char \*) mh\_arg2;
+-#else
+- char \*base = (char \*) ts\_resource(\*((int \*) mh\_arg2));
+-#endif
+
+- p = (char \*\*) (base + (size\_t) mh\_arg1);
++ p = &PG(open\_basedir);
+
+ if (stage == PHP\_INI\_STAGE\_STARTUP || stage == PHP\_INI\_STAGE\_SHUTDOWN || stage == PHP\_INI\_STAGE\_ACTIVATE || stage == PHP\_INI\_STAGE\_DEACTIVATE) {
+ /\* We're in a PHP\_INI\_SYSTEM context, no restrictions \*/
+--- a/main/main.c
++++ b/main/main.c
+@@ -90,6 +90,9 @@
+
+ #include "SAPI.h"
+ #include "rfc1867.h"
++#if SUHOSIN\_PATCH
++#include "suhosin\_globals.h"
++#endif
+
+ #if !HAVE\_UNISTD\_H || (!defined(\_SC\_PAGESIZE) && !defined(\_SC\_PAGE\_SIZE))
+ # if HAVE\_SYS\_MMAN\_H
+@@ -490,7 +493,7 @@ PHP\_INI\_BEGIN()
+ STD\_PHP\_INI\_ENTRY("extension\_dir", PHP\_EXTENSION\_DIR, PHP\_INI\_SYSTEM, OnUpdateStringUnempty, extension\_dir, php\_core\_globals, core\_globals)
+ STD\_PHP\_INI\_ENTRY("include\_path", PHP\_INCLUDE\_PATH, PHP\_INI\_ALL, OnUpdateStringUnempty, include\_path, php\_core\_globals, core\_globals)
+ PHP\_INI\_ENTRY("max\_execution\_time", "30", PHP\_INI\_ALL, OnUpdateTimeout)
+- STD\_PHP\_INI\_ENTRY("open\_basedir", NULL, PHP\_INI\_ALL, OnUpdateBaseDir, open\_basedir, php\_core\_globals, core\_globals)
++ PHP\_INI\_ENTRY("open\_basedir", NULL, PHP\_INI\_ALL, OnUpdateBaseDir)
+ STD\_PHP\_INI\_ENTRY("safe\_mode\_exec\_dir", PHP\_SAFE\_MODE\_EXEC\_DIR, PHP\_INI\_SYSTEM, OnUpdateString, safe\_mode\_exec\_dir, php\_core\_globals, core\_globals)
+
+ STD\_PHP\_INI\_BOOLEAN("file\_uploads", "1", PHP\_INI\_SYSTEM, OnUpdateBool, file\_uploads, php\_core\_globals, core\_globals)
+@@ -1791,6 +1794,10 @@ void dummy\_invalid\_parameter\_handler(
+ }
+ #endif
+
++#if SUHOSIN\_PATCH
++PHPAPI void suhosin\_startup();
++#endif
++
+ /\* {{{ php\_module\_startup
+ \*/
+ int php\_module\_startup(sapi\_module\_struct \*sf, zend\_module\_entry \*additional\_modules, uint num\_additional\_modules)
+@@ -1835,6 +1842,10 @@ int php\_module\_startup(sapi\_module\_struc
+ tsrm\_ls = ts\_resource(0);
+ #endif
+
++#if SUHOSIN\_PATCH
++ suhosin\_startup();
++#endif
++
+ module\_shutdown = 0;
+ module\_startup = 1;
+ sapi\_initialize\_empty\_request(TSRMLS\_C);
+@@ -1954,7 +1965,11 @@ int php\_module\_startup(sapi\_module\_struc
+ REGISTER\_MAIN\_STRINGL\_CONSTANT("PHP\_CONFIG\_FILE\_SCAN\_DIR", PHP\_CONFIG\_FILE\_SCAN\_DIR, sizeof(PHP\_CONFIG\_FILE\_SCAN\_DIR)-1, CONST\_PERSISTENT | CONST\_CS);
+ REGISTER\_MAIN\_STRINGL\_CONSTANT("PHP\_SHLIB\_SUFFIX", PHP\_SHLIB\_SUFFIX, sizeof(PHP\_SHLIB\_SUFFIX)-1, CONST\_PERSISTENT | CONST\_CS);
+ REGISTER\_MAIN\_STRINGL\_CONSTANT("PHP\_EOL", PHP\_EOL, sizeof(PHP\_EOL)-1, CONST\_PERSISTENT | CONST\_CS);
+- REGISTER\_MAIN\_LONG\_CONSTANT("PHP\_MAXPATHLEN", MAXPATHLEN, CONST\_PERSISTENT | CONST\_CS);
++#if SUHOSIN\_PATCH
++ REGISTER\_MAIN\_LONG\_CONSTANT("SUHOSIN\_PATCH", 1, CONST\_PERSISTENT | CONST\_CS);
++ REGISTER\_MAIN\_STRINGL\_CONSTANT("SUHOSIN\_PATCH\_VERSION", SUHOSIN\_PATCH\_VERSION, sizeof(SUHOSIN\_PATCH\_VERSION)-1, CONST\_PERSISTENT | CONST\_CS);
++#endif
++ REGISTER\_MAIN\_LONG\_CONSTANT("PHP\_MAXPATHLEN", MAXPATHLEN, CONST\_PERSISTENT | CONST\_CS);
+ REGISTER\_MAIN\_LONG\_CONSTANT("PHP\_INT\_MAX", LONG\_MAX, CONST\_PERSISTENT | CONST\_CS);
+ REGISTER\_MAIN\_LONG\_CONSTANT("PHP\_INT\_SIZE", sizeof(long), CONST\_PERSISTENT | CONST\_CS);
+
+--- a/main/php.h
++++ b/main/php.h
+@@ -457,6 +457,10 @@ END\_EXTERN\_C()
+ #endif
+ #endif /\* !XtOffsetOf \*/
+
++#if SUHOSIN\_PATCH
++#include "suhosin\_patch.h"
++#endif
++
+ #endif
+
+ /\*
+--- a/main/php\_logos.c
++++ b/main/php\_logos.c
+@@ -50,6 +50,10 @@ PHPAPI int php\_unregister\_info\_logo(char
+ return zend\_hash\_del(&phpinfo\_logo\_hash, logo\_string, strlen(logo\_string));
+ }
+
++#if SUHOSIN\_PATCH
++#include "suhosin\_logo.h"
++#endif
++
+ int php\_init\_info\_logos(void)
+ {
+ if(zend\_hash\_init(&phpinfo\_logo\_hash, 0, NULL, NULL, 1)==FAILURE)
+@@ -58,7 +62,9 @@ int php\_init\_info\_logos(void)
+ php\_register\_info\_logo(PHP\_LOGO\_GUID , "image/gif", php\_logo , sizeof(php\_logo));
+ php\_register\_info\_logo(PHP\_EGG\_LOGO\_GUID, "image/gif", php\_egg\_logo, sizeof(php\_egg\_logo));
+ php\_register\_info\_logo(ZEND\_LOGO\_GUID , "image/gif", zend\_logo , sizeof(zend\_logo));
+-
++#if SUHOSIN\_PATCH
++ php\_register\_info\_logo(SUHOSIN\_LOGO\_GUID, "image/jpeg", suhosin\_logo , sizeof(suhosin\_logo));
++#endif
+ return SUCCESS;
+ }
+
+--- a/main/snprintf.c
++++ b/main/snprintf.c
+@@ -1091,7 +1091,11 @@ static int format\_converter(register buf
+
+
+ case 'n':
++#if SUHOSIN\_PATCH
++ zend\_suhosin\_log(S\_MISC, "'n' specifier within format string");
++#else
+ \*(va\_arg(ap, int \*)) = cc;
++#endif
+ goto skip\_output;
+
+ /\*
+--- a/main/spprintf.c
++++ b/main/spprintf.c
+@@ -698,7 +698,11 @@ static void xbuf\_format\_converter(smart\_
+
+
+ case 'n':
++#if SUHOSIN\_PATCH
++ zend\_suhosin\_log(S\_MISC, "'n' specifier within format string");
++#else
+ \*(va\_arg(ap, int \*)) = xbuf->len;
++#endif
+ goto skip\_output;
+
+ /\*
+--- /dev/null
++++ b/main/suhosin\_globals.h
+@@ -0,0 +1,61 @@
++/\*
++ +----------------------------------------------------------------------+
++ | Suhosin-Patch for PHP |
++ +----------------------------------------------------------------------+
++ | Copyright (c) 2004-2009 Stefan Esser |
++ +----------------------------------------------------------------------+
++ | This source file is subject to version 2.02 of the PHP license, |
++ | that is bundled with this package in the file LICENSE, and is |
++ | available at through the world-wide-web at |
++ | http://www.php.net/license/2\_02.txt. |
++ | If you did not receive a copy of the PHP license and are unable to |
++ | obtain it through the world-wide-web, please send a note to |
++ | license@php.net so we can mail you a copy immediately. |
++ +----------------------------------------------------------------------+
++ | Author: Stefan Esser  |
++ +----------------------------------------------------------------------+
++ \*/
++
++#ifndef SUHOSIN\_GLOBALS\_H
++#define SUHOSIN\_GLOBALS\_H
++
++typedef struct \_suhosin\_patch\_globals suhosin\_patch\_globals\_struct;
++
++#ifdef ZTS
++# define SPG(v) TSRMG(suhosin\_patch\_globals\_id, suhosin\_patch\_globals\_struct \*, v)
++extern int suhosin\_patch\_globals\_id;
++#else
++# define SPG(v) (suhosin\_patch\_globals.v)
++extern struct \_suhosin\_patch\_globals suhosin\_patch\_globals;
++#endif
++
++
++struct \_suhosin\_patch\_globals {
++ /\* logging \*/
++ int log\_syslog;
++ int log\_syslog\_facility;
++ int log\_syslog\_priority;
++ int log\_sapi;
++ int log\_script;
++ int log\_phpscript;
++ char \*log\_scriptname;
++ char \*log\_phpscriptname;
++ zend\_bool log\_phpscript\_is\_safe;
++ zend\_bool log\_use\_x\_forwarded\_for;
++
++ /\* memory manager canary protection \*/
++ unsigned int canary\_1;
++ unsigned int canary\_2;
++ unsigned int canary\_3;
++ unsigned int dummy;
++};
++
++
++#endif /\* SUHOSIN\_GLOBALS\_H \*/
++
++/\*
++ \* Local variables:
++ \* tab-width: 4
++ \* c-basic-offset: 4
++ \* End:
++ \*/
+--- /dev/null
++++ b/main/suhosin\_logo.h
+@@ -0,0 +1,178 @@
++static unsigned char suhosin\_logo[] =
++ "\xff\xd8\xff\xe0\x00\x10\x4a\x46\x49\x46\x00\x01\x01\x01\x00\x48"
++ "\x00\x48\x00\x00\xff\xe1\x00\x16\x45\x78\x69\x66\x00\x00\x4d\x4d"
++ "\x00\x2a\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\xff\xdb\x00\x43"
++ "\x00\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01"
++ "\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01"
++ "\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01"
++ "\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01"
++ "\x01\xff\xc0\x00\x0b\x08\x00\x27\x00\x71\x01\x01\x22\x00\xff\xc4"
++ "\x00\x1e\x00\x00\x02\x02\x02\x03\x01\x01\x00\x00\x00\x00\x00\x00"
++ "\x00\x00\x00\x00\x09\x06\x08\x05\x07\x02\x03\x0a\x01\x04\xff\xc4"
++ "\x00\x32\x10\x00\x01\x04\x03\x00\x02\x00\x05\x01\x05\x09\x01\x00"
++ "\x00\x00\x00\x05\x02\x03\x04\x06\x01\x07\x08\x00\x09\x11\x12\x13"
++ "\x14\x21\x15\x0a\x16\x31\x56\x96\x17\x18\x19\x23\x32\x41\x58\x98"
++ "\xd4\xd6\xff\xda\x00\x08\x01\x01\x00\x00\x3f\x00\xf4\xc1\xe1\xe5"
++ "\x69\xe9\x3e\xb9\xd1\x7c\x8a\x2e\x9d\x66\xe8\x3b\x29\x4d\x7f\x46"
++ "\xba\x58\x55\x54\x8d\xb1\x5f\xaa\xd9\x8d\x51\x2b\xb6\x27\x5a\x69"
++ "\xd1\x43\xaf\x16\x1a\xf0\xb2\xb1\xe9\x6d\x9f\xc2\xa4\x36\x18\xb5"
++ "\x85\x10\x41\xbe\xfc\x09\xac\x49\x29\x11\xd4\x32\x97\xec\x08\x13"
++ "\xc1\x2d\x20\xc3\x59\xeb\x26\x05\xd8\x6b\x76\x31\x43\x8f\x57\xcf"
++ "\x84\x9f\x14\xa8\x53\x81\x0b\xc3\x64\x80\xa3\x02\x0a\x41\x75\xf8"
++ "\x44\x85\x93\x81\x22\x3c\xd8\x13\xe1\xbe\xf4\x59\x91\x1f\x6a\x44"
++ "\x77\x5c\x69\xc4\x2f\x39\x5f\x0f\x2a\x8d\xeb\xba\xf8\xc3\x56\x6c"
++ "\x3b\x36\xa7\xda\xbd\x4d\xa1\xb5\x4e\xc6\xa7\xa4\x3a\xec\x15\x2d"
++ "\xa5\xb3\xea\x5a\xdc\xac\x46\xac\x01\x60\xd8\x43\xc8\x8e\x8b\xb1"
++ "\x40\x4c\x95\x8b\x34\x41\x28\x52\x91\x28\x43\xd3\xa3\xb6\xa7\x55"
++ "\x15\xe7\x5a\x96\xcb\xf1\xda\xe5\x55\xee\xfe\x1e\xbd\xd9\x41\xd3"
++ "\x28\xfd\x97\xca\x57\x2b\x85\x9c\xa4\x30\x95\xaa\xa5\x57\xa2\x35"
++ "\x15\x86\xcb\x61\x34\x41\xe4\xc7\x80\x20\x18\x21\x17\x09\x85\x0b"
++ "\x14\x9d\x21\x68\x62\x1c\x08\x11\x64\x4b\x92\xf2\xd2\xd3\x2d\x2d"
++ "\x6a\xc2\x73\x6b\x3c\x3c\x8b\x9e\xbc\x52\xaa\xa4\xab\x81\x6c\xf6"
++ "\xfa\xbd\x70\xc5\xc6\x7b\xc2\xaa\x22\x4f\x58\x04\x87\x25\x6a\x27"
++ "\x1d\xa4\x3d\x20\x75\x72\x01\x09\x71\xe5\x1c\x9e\xc3\x2e\x36\xf3"
++ "\xd0\xc6\x35\x2a\x43\x4d\x2d\x0e\x2d\xb4\xa1\x49\xce\x65\x1e\x52"
++ "\x9e\xa1\xf6\x09\xcc\xdc\x63\x66\xa8\x01\xe9\x3b\x0d\xd7\x5a\x85"
++ "\xbb\xc5\x65\xc0\x7b\x2e\x46\xa9\xd9\x56\x1d\x4c\x92\x72\x26\x4e"
++ "\x86\xd5\x68\xae\xc4\xaa\x55\xce\xd7\x83\x59\xb3\x81\xee\xce\x74"
++ "\x39\x39\x31\x9f\x8a\x25\xe8\xa5\xa5\xe5\x81\xf2\x11\x23\xcb\xa1"
++ "\x1e\x43\x12\xe3\xb1\x2a\x2b\xcd\xc8\x8d\x25\x96\xa4\x47\x7d\x95"
++ "\xa5\xc6\x9f\x61\xe4\x25\xc6\x5e\x69\xc4\xe7\x29\x5b\x6e\xb6\xa4"
++ "\xad\x0b\x4e\x72\x95\x25\x58\x56\x33\x9c\x67\xce\xef\x0f\x17\xbf"
++ "\x4c\x7b\x2d\xe6\xfe\x76\x35\x27\x5a\x07\x97\x67\xe8\xae\x8d\x71"
++ "\x0f\xb2\x13\x99\xb9\xbc\x14\xad\xb3\xb7\xe6\x11\x6f\xe0\xda\x58"
++ "\xb1\x08\xac\xa6\x6c\x2d\x7f\x05\xb7\x56\xd2\xe6\xcf\xbb\x4d\x0c"
++ "\xe3\x50\xb2\xec\x91\xf0\x4a\xb8\xd6\x22\xb8\xa7\xf6\x67\xaf\xcf"
++ "\x63\x7e\xd7\xe7\x42\xd8\xbd\xc3\x71\xa1\xf2\x7e\x9b\xa8\x97\x83"
++ "\x6e\xd1\xdc\x4b\x06\x11\x2d\xae\x26\x61\x98\x72\x10\xf4\x42\x5d"
++ "\x20\x4a\xa3\x73\xd7\xf2\xcd\x3c\x48\x32\xe4\x03\x9f\x80\x37\x08"
++ "\x36\x11\xd0\xcb\x97\x6c\x08\xed\x6d\x33\x24\xa2\x1b\xb4\x77\xdf"
++ "\x61\x5d\x5f\xc1\x43\xc2\x82\xeb\x0f\x5d\x84\x08\x68\xaa\xa4\x01"
++ "\xe1\x19\xdf\xbc\x31\x65\xfe\xd1\xf5\x7d\x7a\xb2\x2a\x33\x50\x21"
++ "\x2a\x56\x9d\xb1\x81\xab\xdb\x35\x78\x30\x83\xd9\x89\x1d\x31\xac"
++ "\x96\x14\x07\x61\xbc\x20\x68\x42\x85\x33\x19\xac\xbe\xdb\x34\x56"
++ "\xf1\xd5\xfd\x29\xa9\x28\xdb\xcb\x4c\x5a\x23\xdc\xf5\x96\xc5\x10"
++ "\xa3\x35\x5b\x14\x68\xd3\x61\x62\x64\x76\x26\xcb\x17\x3e\x34\x98"
++ "\x04\xa3\xc4\x20\x38\x90\x92\xe3\xc8\x07\x2c\x36\x74\x66\x26\x0e"
++ "\x29\x02\x64\x29\x2d\x21\xe6\x16\x9c\x6b\xce\xa3\x89\xd9\x4f\xd3"
++ "\xc4\xbd\xc5\x87\x79\x9c\x65\xf6\x39\x45\x60\xe8\xce\x9e\xab\x6d"
++ "\x13\x15\x22\xe1\x5e\x4b\x38\x42\xc4\x1e\xd5\x76\xe0\xc5\xeb\x85"
++ "\x07\x2d\x0f\xb8\xb6\xa6\xd6\x6d\x71\x0d\xa2\x43\x4c\x25\xea\xfa"
++ "\xa1\xae\x4c\xe4\x7d\xbd\x76\xa9\xfb\x06\xc2\x83\x42\xeb\xad\xe7"
++ "\xe9\x5f\x68\x6f\xba\xfb\x2f\x07\xce\xb8\x13\xc1\x9b\xeb\xb0\x76"
++ "\x45\x57\x28\x7b\xea\xbe\x0f\xf4\x30\x7b\xa0\xed\xe4\x22\x93\x21"
++ "\xfc\xbc\xe0\xb9\x75\xc1\x4f\xfc\xef\xb6\xfa\xa1\xfc\x64\xa1\x4a"
++ "\x82\xc7\x33\xad\x75\xed\x82\xbd\x3d\xdb\xf7\xa8\xbe\x5e\xbb\x36"
++ "\x62\x04\x9a\x2e\xc5\xd9\x9e\x9c\x3a\x0b\x98\x0b\x57\xac\xf1\x24"
++ "\x62\x58\x83\x15\x5b\xa6\xf2\xda\x34\x70\x03\xce\x0f\x93\x1b\x12"
++ "\xc7\xce\x54\x87\x33\x15\xd6\x53\x25\x1f\x2a\x90\x87\x12\xe3\x78"
++ "\xef\x55\x77\x4d\x4a\xd8\x7e\xef\xd2\xfd\xd1\xaf\x3a\xaf\x55\xdb"
++ "\x6a\x2d\x3d\x42\xac\x51\x79\xee\x91\xab\xe1\x05\x2d\x3c\x80\xa2"
++ "\x43\xad\x22\x2e\xd5\x33\x13\xa4\x9e\x00\xe0\x04\x10\x84\xc8\xf2"
++ "\x19\x30\x92\x1f\xaa\xc3\x28\xc9\x76\x30\x3f\xe9\x10\x61\x5e\x79"
++ "\xd5\xf7\xdf\xd0\x54\xdb\xae\xb6\xae\xfa\xe8\xa3\x57\xe0\x6c\x2d"
++ "\xf7\xbd\x49\xd6\x6e\x76\x79\xcc\x54\x0c\x5f\xff\x00\xbb\x06\x98"
++ "\xa6\x9e\x89\x61\xb4\x6f\xc3\xe3\x6a\xc2\x4f\x59\x03\xc9\x80\x2c"
++ "\x59\x24\x44\x70\x38\xd5\x96\x6a\x9e\x8b\x81\x64\xe5\xbc\xa0\x3c"
++ "\x33\xaf\x17\x9d\xff\x00\x71\x1a\xd1\x3a\x80\x66\xb3\xd9\x31\x77"
++ "\x0d\x12\xbd\xae\x29\xb5\x6a\xd6\xcf\x8d\x68\x87\x75\xcd\xe8\x65"
++ "\x5a\xbe\x3c\x04\x7b\x34\xdb\x54\x19\xa4\x63\x9c\x2a\x5d\x23\xbe"
++ "\xf4\xb1\x1c\x4d\x90\xec\x92\x2f\x49\x71\xf7\x14\xf2\x97\x9f\x15"
++ "\x57\xed\x13\x21\x2a\xf5\x33\xd1\x2a\x52\x52\xac\xb7\x62\xd1\xcb"
++ "\x46\x73\x8c\x67\x28\x56\x77\x86\xbf\x6f\x2a\x4e\x73\xfe\x95\x65"
++ "\x0b\x5a\x3e\x38\xfc\xfc\xaa\x56\x3f\x86\x73\xe3\xb9\x4a\x52\x84"
++ "\xa5\x08\x4e\x12\x94\x27\x09\x4a\x53\x8c\x61\x29\x4a\x71\xf0\x4a"
++ "\x53\x8c\x7e\x31\x8c\x63\x18\xc6\x31\x8f\xc6\x31\xf8\xc7\x9f\x7c"
++ "\xd5\xbb\xae\x5e\xe2\x1f\xab\x6e\x24\x34\x00\x8a\x25\x83\x70\x40"
++ "\x1c\xcc\xda\x45\x7f\x66\x4e\x30\x2e\x94\x7e\x74\x49\xf0\xe4\x4e"
++ "\x06\x5c\xa8\x2f\x89\x21\x2e\x98\x0e\xd9\x21\xc2\x0b\x21\x0f\xc4"
++ "\x16\x6e\x48\xd9\xe4\xe3\x4a\x19\x1e\x64\x67\x54\xff\x00\x3a\x6d"
++ "\x4f\x62\xb5\x00\x4a\xaa\x51\xfd\x2d\xe8\x0e\x6c\xaf\xc6\x7d\x6d"
++ "\xc8\x88\xc7\x67\xea\x8a\x58\x02\x73\xe3\x65\x4d\xc9\x24\xc0\x3d"
++ "\x57\xa3\x2e\x53\x16\x99\x4f\xe5\xe7\x19\x97\x3e\x3b\xcf\xc9\x4b"
++ "\x99\x7f\x33\x25\xa5\xdf\xba\x77\x2b\xd3\x3e\xc2\x7b\x8b\x94\x07"
++ "\xe9\x52\x5b\x43\x87\x34\x14\x86\x37\xcf\x41\x6b\x8e\x6a\xa5\x22"
++ "\xab\xdb\x96\xa2\xcf\x46\xd8\x9b\x45\x93\xef\xd6\xdf\x3e\x99\x9c"
++ "\x7e\x29\x10\x6b\x6c\xa2\xb8\x43\x05\x09\x44\x70\x8c\xb8\xaa\x54"
++ "\x7c\x30\x36\x5e\x1c\x5e\x5b\x9f\x6c\x0d\x81\xee\xa0\x93\x8d\x67"
++ "\x55\xf3\x87\xaf\xaa\x6b\x58\xf9\xbe\xb2\x36\x07\x42\x6e\xbd\x96"
++ "\xe3\x9f\x1f\x8f\xc9\xf4\x9d\xae\x6a\x7d\x4c\x96\xbe\x5f\xc7\xcd"
++ "\xf3\xb2\xf7\xcd\xf0\xcf\xc3\xe4\xf8\xfe\x37\x4f\x1c\x4d\xf6\x40"
++ "\xf1\x6b\x7c\x4e\xe0\xa6\x71\xad\x56\xa7\x1c\x5c\x15\x6b\xfc\xf3"
++ "\x01\x5d\xac\xf1\x75\x9a\x72\x6b\xaa\x28\xc5\x88\x6d\xfb\x33\x85"
++ "\xe0\x4e\x61\xab\xeb\x31\x2c\x71\x08\x73\x11\x3b\xfc\xb5\xc0\x96"
++ "\xcc\x87\x24\x44\xb5\x9b\x9e\xb3\x71\xba\xe9\xed\xb1\x4e\xd7\x76"
++ "\x6c\xd2\xb6\x05\xb7\x5a\xde\xeb\x34\x5b\x96\x16\xfb\x59\xa9\x5c"
++ "\x4f\x55\xca\x8a\xac\x59\xb0\xe4\x54\x39\x25\xbc\x81\x37\x2a\x09"
++ "\x5f\x9e\x3b\x6b\x7d\x1f\x69\xf3\x34\x85\x39\x84\xa7\x28\x0b\xd3"
++ "\xfd\xfb\x4b\x7a\xea\xe7\xd2\x3c\xd3\xda\x15\x68\xbc\x73\xd3\x22"
++ "\x6f\xd7\x72\x5b\x2b\x66\xee\xa8\x0d\x54\xe8\x5b\xf9\x92\x96\x92"
++ "\x93\xea\x97\x4a\xc7\x43\x10\x46\x35\xc5\xc0\x60\x8a\xe4\xc1\xb5"
++ "\x36\xc6\xae\xed\xf7\x70\xa5\x86\x99\x3d\x91\xf8\xfd\x4e\x53\xeb"
++ "\xbb\xbd\x6d\xec\x8f\xd7\x89\x3d\x31\x7f\xd7\x78\xba\x50\xbb\x74"
++ "\x9d\xf6\xac\x4e\xb9\x03\x9c\x79\xd5\xe1\xbd\x17\x68\xd9\x13\x0b"
++ "\x45\x75\x88\x00\x1d\x1f\xae\x73\x6a\x1d\x5c\x6e\x44\x9f\xa6\xfa"
++ "\x4e\xd8\x25\x8b\xc0\xbc\xb2\x99\xe3\x17\x24\xb3\x23\xe2\x48\x8b"
++ "\xfa\x22\xe7\x7e\x8f\xe6\x3f\x5f\x55\x0d\x75\xd3\x51\x0b\xd7\xed"
++ "\xd3\x6f\x97\x3b\x85\x42\x80\x7e\x5f\xdc\x1b\xd6\xba\xee\xc4\x80"
++ "\xce\x06\xa9\x15\x8c\x97\x5f\x40\x69\xb2\x4d\xc5\xb2\x5c\x1e\x01"
++ "\x87\x7e\xe0\x36\x6d\x78\x80\x4e\x3c\x02\xec\x90\x1d\x11\x81\x74"
++ "\xa5\x8b\xa4\xa0\x56\x06\xd5\x79\x72\x85\x57\x3b\xb2\x2e\xae\x90"
++ "\x18\x8d\x91\xb2\x0e\x44\x19\xaa\xb4\xcc\x08\xed\x46\xfa\xd7\x2b"
++ "\x78\x58\x72\x5d\xbb\x5e\x49\xe7\xee\xf3\x8a\x9d\x22\xa4\x19\xc8"
++ "\xe7\x08\xc3\x90\x9b\x35\x9a\xa4\x25\x8c\x4b\x9b\xa7\xf8\xbf\x81"
++ "\xf5\xdf\x22\x66\xf1\x7e\x9f\x66\x3d\xbb\xfa\x73\x73\x4d\xfd\x67"
++ "\x7b\xf4\xce\xc3\x62\x2e\x6f\xbb\x0c\xa2\xdc\x69\xfc\x8a\x17\x0e"
++ "\x3a\x9e\x83\x46\xd7\xe3\x5e\x65\x86\xc0\x51\x00\xbb\x91\xe3\xe1"
++ "\xc1\x16\xc4\xe9\x65\x5c\x14\x3e\x44\x6a\x6b\xd1\x1e\xb0\x36\xdd"
++ "\x0b\x7d\x8a\xeb\xaf\x58\x5b\x64\x3f\x38\xed\x52\x76\xe8\x46\xf7"
++ "\x86\x84\xb3\x93\xb1\x0b\xe5\xfd\xfd\x0d\xe9\x6d\xe4\xf1\x1b\x1d"
++ "\x56\xb4\x34\xe4\x6a\xf5\xa4\x9c\x2c\xc9\x64\x94\xc1\xf5\x79\x6d"
++ "\x12\x96\xf3\x47\xc5\x48\xa8\xdb\xd8\x95\x64\x29\xcf\xf6\x88\xf1"
++ "\x95\x7a\x98\xe8\xbc\x27\x19\xce\x73\x61\xd1\xb8\xc6\x31\x8c\xe7"
++ "\x39\xce\x77\x9e\xbc\xc6\x31\x8c\x63\xf3\x9c\xe7\x39\xc6\x31\x8f"
++ "\xf7\xce\x7e\x1e\x3b\x7f\x0f\x0f\x0f\x13\x57\xb9\x0a\xe1\x0b\x64"
++ "\x5f\x58\x40\xc6\xc7\x7a\x4b\xf2\x3d\xbc\x71\xf4\xa7\xd2\xca\x14"
++ "\xe2\x98\x1a\x30\x1e\xe0\x26\x5a\x6a\xf0\x9c\x67\x38\x66\x00\xb8"
++ "\x72\xe6\xbe\xac\xfe\x12\xd3\x0b\x56\x73\x8c\x63\xc7\x2b\xe1\xe2"
++ "\xe8\xdd\x7b\xff\x00\xd8\xe5\x23\x6c\xce\xa8\x69\xcf\x5e\x3a\xef"
++ "\x77\xea\xe5\xab\x0e\x82\xdb\xd9\xed\x7a\x9e\xb8\x6d\x51\x32\xdb"
++ "\x79\xc3\x36\x9a\x2d\xa3\x50\x39\x65\x0a\x63\x0e\xe5\xd4\x39\x12"
++ "\xbf\x8b\x98\xa4\xa1\x2d\xad\xb3\xcf\x65\x6a\x43\x78\xb3\x3b\x07"
++ "\xd8\xd5\xea\xae\x76\xad\x6f\xf5\xff\x00\xca\x93\xab\x96\xb0\x64"
++ "\xeb\xd6\x4a\xd5\x87\xba\xec\x24\x60\x97\x06\x76\x03\xe3\x4c\x07"
++ "\x29\x11\x8e\x34\x25\x02\x64\x29\xf0\x25\x48\x85\x3a\x33\x8b\x7a"
++ "\x3c\x86\x1e\x75\xa5\x61\xc6\x97\x9f\x8d\x25\xf5\xc9\xcd\xde\xc9"
++ "\x7d\x77\xf2\xc8\x7e\x70\xaf\x73\x5f\x2d\xec\xa2\x51\x2d\x96\xfb"
++ "\x89\xad\x80\x57\xb2\x36\x1d\x7d\x83\x45\xac\xf3\xdb\xcc\x6c\x31"
++ "\x4f\xcf\x30\x58\xd0\x12\x28\x90\x50\x42\x86\xfb\x48\x16\x3c\xc5"
++ "\x9c\xf8\xe7\xcc\x29\x88\xb3\x4a\x4b\x4e\x6c\xbc\xdb\xc7\xbb\xe9"
++ "\xb6\xa0\x8b\x11\xa1\x7d\x73\xd7\xe9\xbf\x7e\xc2\x6c\x10\x8d\xee"
++ "\x9d\xef\x63\x3a\xe0\xf5\xbe\x8c\x3e\xa1\xc7\xc5\xd1\x00\x44\x1e"
++ "\xf3\x51\xf2\xe2\xb0\xe3\xb5\x13\x7f\x32\xf1\x8c\xa6\x22\xfe\x1f"
++ "\x49\x4d\xbb\xcf\x3a\x5d\xed\x4c\xd2\xfc\x85\xed\x23\xd6\xc7\x50"
++ "\xb6\x5b\x3a\x16\x83\xb8\x6f\xfd\x32\x3f\xaa\x36\x34\xbb\xf5\x96"
++ "\xa9\xab\xcf\x9f\x8f\xac\xc3\xca\xd5\x8b\xd8\x48\x9e\x79\xaa\x30"
++ "\x87\xca\x58\x4d\x59\x96\xb9\x4f\xc5\x1b\x1c\xd2\xda\x5b\xe6\x57"
++ "\x29\xa1\x28\x7a\x2b\x5b\xff\x00\x12\x2f\x5e\x3f\xf3\xbb\x8e\x7f"
++ "\xec\xc6\x98\xff\x00\xed\x3c\xa6\xdd\xa9\xdc\x7e\xa0\xf7\xd6\x99"
++ "\x31\xa2\xf7\xaf\x6b\xe9\x82\x74\x4b\x3d\x8f\x5e\x58\x0b\x33\xab"
++ "\xef\xc3\xaf\x84\x64\xb9\xae\xb6\x25\x5f\x62\x8f\x1c\xe3\xf4\x51"
++ "\xb7\x96\xe3\x0e\x30\x42\xa9\x18\x39\xbf\x9e\x2a\x1f\x74\x19\x02"
++ "\x2d\x43\x93\x06\x63\xb1\xa7\x47\x6a\xfa\x9b\x6c\xeb\xbd\xe9\xae"
++ "\x6a\x7b\x6f\x53\x5a\x60\x5d\xb5\xcd\xe8\x67\xeb\x35\x3b\x48\xc6"
++ "\xa6\xb3\x04\xc8\xdf\xb8\x7e\x26\x64\xb0\xc9\x18\xb0\xa7\x33\xf2"
++ "\x4a\x8b\x22\x3b\x8d\x4b\x89\x1d\xf6\x9d\x65\xc4\x38\xd2\x54\x9c"
++ "\xe3\xcd\x89\xe1\xe1\xe6\x3e\x70\x81\x45\x1d\x18\xf9\x31\x83\xc8"
++ "\xbe\x14\x82\x4b\x87\x7a\x74\x28\xd2\xdd\x12\x55\x30\xe6\x0e\x49"
++ "\x31\x8e\x48\x69\xc5\xc0\x20\x91\xe4\x48\x41\x4c\xd8\xb9\x6a\x4e"
++ "\x21\xce\x99\x1b\x0e\xfd\x09\x4f\xa1\x79\x0f\x0f\x0f\x0f\x0f\x0f"
++ "\x0f\x3f\x3c\xb8\x71\x27\xc7\x72\x24\xe8\xb1\xa6\xc5\x7b\x18\xc3"
++ "\xb1\xa5\xb0\xd4\x98\xee\xe3\x19\xc6\x71\x87\x19\x79\x2b\x6d\x78"
++ "\xc6\x71\x8c\xe3\x0a\x4e\x71\x8c\xe3\x19\xfe\x38\xf2\x3b\xfb\x8b"
++ "\x48\xfe\x4e\xaa\xff\x00\x4f\x08\xff\x00\xc7\xe1\xfb\x8b\x48\xfe"
++ "\x4e\xaa\xff\x00\x4f\x08\xff\x00\xc7\xe4\x95\x86\x18\x8a\xcb\x31"
++ "\xa3\x32\xd4\x78\xf1\xdb\x43\x2c\x47\x61\xb4\x32\xcb\x2c\xb4\x9c"
++ "\x21\xb6\x99\x69\xbc\x25\xb6\xdb\x6d\x18\xc2\x10\xda\x12\x94\xa1"
++ "\x38\xc2\x53\x8c\x63\x18\xc7\x9d\xbe\x7f\xff\xd9"
++ ;
+--- /dev/null
++++ b/main/suhosin\_patch.c
+@@ -0,0 +1,470 @@
++/\*
++ +----------------------------------------------------------------------+
++ | Suhosin Patch for PHP |
++ +----------------------------------------------------------------------+
++ | Copyright (c) 2004-2010 Stefan Esser |
++ +----------------------------------------------------------------------+
++ | This source file is subject to version 2.02 of the PHP license, |
++ | that is bundled with this package in the file LICENSE, and is |
++ | available at through the world-wide-web at |
++ | http://www.php.net/license/2\_02.txt. |
++ | If you did not receive a copy of the PHP license and are unable to |
++ | obtain it through the world-wide-web, please send a note to |
++ | license@php.net so we can mail you a copy immediately. |
++ +----------------------------------------------------------------------+
++ | Author: Stefan Esser  |
++ +----------------------------------------------------------------------+
++ \*/
++/\* $Id: suhosin\_patch.c,v 1.2 2004/11/21 09:38:52 ionic Exp $ \*/
++
++#include "php.h"
++
++#include
++#include
++#include
++
++#if HAVE\_UNISTD\_H
++#include
++#endif
++#include "SAPI.h"
++#include "php\_globals.h"
++
++#if SUHOSIN\_PATCH
++
++#ifdef HAVE\_SYS\_SOCKET\_H
++#include
++#endif
++
++#if defined(PHP\_WIN32) || defined(\_\_riscos\_\_) || defined(NETWARE)
++#undef AF\_UNIX
++#endif
++
++#if defined(AF\_UNIX)
++#include
++#endif
++
++#define SYSLOG\_PATH "/dev/log"
++
++#ifdef PHP\_WIN32
++static HANDLE log\_source = 0;
++#endif
++
++#include "snprintf.h"
++
++#include "suhosin\_patch.h"
++
++#ifdef ZTS
++#include "suhosin\_globals.h"
++int suhosin\_patch\_globals\_id;
++#else
++struct \_suhosin\_patch\_globals suhosin\_patch\_globals;
++#endif
++
++static char \*suhosin\_config = NULL;
++
++static zend\_intptr\_t SUHOSIN\_POINTER\_GUARD = 0;
++
++static void php\_security\_log(int loglevel, char \*fmt, ...);
++
++static void suhosin\_patch\_globals\_ctor(suhosin\_patch\_globals\_struct \*suhosin\_patch\_globals TSRMLS\_DC)
++{
++ memset(suhosin\_patch\_globals, 0, sizeof(\*suhosin\_patch\_globals));
++}
++
++ZEND\_API char suhosin\_get\_config(int element)
++{
++ return ((char \*)SUHOSIN\_MANGLE\_PTR(suhosin\_config))[element];
++}
++
++static void suhosin\_set\_config(int element, char value)
++{
++ ((char \*)SUHOSIN\_MANGLE\_PTR(suhosin\_config))[element] = value;
++}
++
++static void suhosin\_read\_configuration\_from\_environment()
++{
++ char \*tmp;
++
++ /\* check if canary protection should be activated or not \*/
++ tmp = getenv("SUHOSIN\_MM\_USE\_CANARY\_PROTECTION");
++ /\* default to activated \*/
++ suhosin\_set\_config(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION, 1);
++ if (tmp) {
++ int flag = zend\_atoi(tmp, 0);
++ suhosin\_set\_config(SUHOSIN\_MM\_USE\_CANARY\_PROTECTION, flag);
++ }
++
++ /\* check if free memory should be overwritten with 0xFF or not \*/
++ tmp = getenv("SUHOSIN\_MM\_DESTROY\_FREE\_MEMORY");
++ /\* default to deactivated \*/
++ suhosin\_set\_config(SUHOSIN\_MM\_DESTROY\_FREE\_MEMORY, 0);
++ if (tmp) {
++ int flag = zend\_atoi(tmp, 0);
++ suhosin\_set\_config(SUHOSIN\_MM\_DESTROY\_FREE\_MEMORY, flag);
++ }
++
++ /\* check if canary violations should be ignored \*/
++ tmp = getenv("SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION");
++ /\* default to NOT ignore \*/
++ suhosin\_set\_config(SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION, 0);
++ if (tmp) {
++ int flag = zend\_atoi(tmp, 0);
++ suhosin\_set\_config(SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION, flag);
++ }
++
++ /\* check if invalid hashtable destructors should be ignored \*/
++ tmp = getenv("SUHOSIN\_HT\_IGNORE\_INVALID\_DESTRUCTOR");
++ /\* default to NOT ignore \*/
++ suhosin\_set\_config(SUHOSIN\_HT\_IGNORE\_INVALID\_DESTRUCTOR, 0);
++ if (tmp) {
++ int flag = zend\_atoi(tmp, 0);
++ suhosin\_set\_config(SUHOSIN\_HT\_IGNORE\_INVALID\_DESTRUCTOR, flag);
++ }
++
++ /\* check if invalid linkedlist destructors should be ignored \*/
++ tmp = getenv("SUHOSIN\_LL\_IGNORE\_INVALID\_DESTRUCTOR");
++ /\* default to NOT ignore \*/
++ suhosin\_set\_config(SUHOSIN\_LL\_IGNORE\_INVALID\_DESTRUCTOR, 0);
++ if (tmp) {
++ int flag = zend\_atoi(tmp, 0);
++ suhosin\_set\_config(SUHOSIN\_LL\_IGNORE\_INVALID\_DESTRUCTOR, flag);
++ }
++
++ suhosin\_set\_config(SUHOSIN\_CONFIG\_SET, 1);
++}
++
++static void suhosin\_write\_protect\_configuration()
++{
++ /\* check return value of mprotect() to ensure memory is read only now \*/
++ if (mprotect(SUHOSIN\_MANGLE\_PTR(suhosin\_config), sysconf(\_SC\_PAGESIZE), PROT\_READ) != 0) {
++ perror("suhosin");
++ \_exit(1);
++ }
++}
++
++PHPAPI void suhosin\_startup()
++{
++#ifdef ZTS
++ ts\_allocate\_id(&suhosin\_patch\_globals\_id, sizeof(suhosin\_patch\_globals\_struct), (ts\_allocate\_ctor) suhosin\_patch\_globals\_ctor, NULL);
++#else
++ suhosin\_patch\_globals\_ctor(&suhosin\_patch\_globals TSRMLS\_CC);
++#endif
++ zend\_suhosin\_log = php\_security\_log;
++
++ /\* get the pointer guardian and ensure low 3 bits are 1 \*/
++ if (SUHOSIN\_POINTER\_GUARD == 0) {
++ zend\_canary(&SUHOSIN\_POINTER\_GUARD, sizeof(SUHOSIN\_POINTER\_GUARD));
++ SUHOSIN\_POINTER\_GUARD |= 7;
++ }
++
++ if (!suhosin\_config) {
++#ifndef MAP\_ANONYMOUS
++#define MAP\_ANONYMOUS MAP\_ANON
++#endif
++ suhosin\_config = mmap(NULL, sysconf(\_SC\_PAGESIZE), PROT\_READ|PROT\_WRITE, MAP\_PRIVATE|MAP\_ANONYMOUS, -1, 0);
++ if (suhosin\_config == MAP\_FAILED) {
++ perror("suhosin");
++ \_exit(1);
++ }
++ suhosin\_config = SUHOSIN\_MANGLE\_PTR(suhosin\_config);
++ }
++ if (!SUHOSIN\_CONFIG(SUHOSIN\_CONFIG\_SET)) {
++ suhosin\_read\_configuration\_from\_environment();
++ suhosin\_write\_protect\_configuration();
++ }
++}
++
++static char \*loglevel2string(int loglevel)
++{
++ switch (loglevel) {
++ case S\_FILES:
++ return "FILES";
++ case S\_INCLUDE:
++ return "INCLUDE";
++ case S\_MEMORY:
++ return "MEMORY";
++ case S\_MISC:
++ return "MISC";
++ case S\_SESSION:
++ return "SESSION";
++ case S\_SQL:
++ return "SQL";
++ case S\_EXECUTOR:
++ return "EXECUTOR";
++ case S\_VARS:
++ return "VARS";
++ default:
++ return "UNKNOWN";
++ }
++}
++
++static void php\_security\_log(int loglevel, char \*fmt, ...)
++{
++ int s, r, i=0;
++#if defined(AF\_UNIX)
++ struct sockaddr\_un saun;
++#endif
++#ifdef PHP\_WIN32
++ LPTSTR strs[2];
++ unsigned short etype;
++ DWORD evid;
++#endif
++ char buf[4096+64];
++ char error[4096+100];
++ char \*ip\_address;
++ char \*fname;
++ char \*alertstring;
++ int lineno;
++ va\_list ap;
++ TSRMLS\_FETCH();
++
++ /\*SDEBUG("(suhosin\_log) loglevel: %d log\_syslog: %u - log\_sapi: %u - log\_script: %u", loglevel, SPG(log\_syslog), SPG(log\_sapi), SPG(log\_script));\*/
++
++ if (SPG(log\_use\_x\_forwarded\_for)) {
++ ip\_address = sapi\_getenv("HTTP\_X\_FORWARDED\_FOR", 20 TSRMLS\_CC);
++ if (ip\_address == NULL) {
++ ip\_address = "X-FORWARDED-FOR not set";
++ }
++ } else {
++ ip\_address = sapi\_getenv("REMOTE\_ADDR", 11 TSRMLS\_CC);
++ if (ip\_address == NULL) {
++ ip\_address = "REMOTE\_ADDR not set";
++ }
++ }
++
++
++ va\_start(ap, fmt);
++ ap\_php\_vsnprintf(error, sizeof(error), fmt, ap);
++ va\_end(ap);
++ while (error[i]) {
++ if (error[i] < 32) error[i] = '.';
++ i++;
++ }
++
++/\* if (SPG(simulation)) {
++ alertstring = "ALERT-SIMULATION";
++ } else { \*/
++ alertstring = "ALERT";
++/\* }\*/
++
++ if (zend\_is\_executing(TSRMLS\_C)) {
++ if (EG(current\_execute\_data)) {
++ lineno = EG(current\_execute\_data)->opline->lineno;
++ fname = EG(current\_execute\_data)->op\_array->filename;
++ } else {
++ lineno = zend\_get\_executed\_lineno(TSRMLS\_C);
++ fname = zend\_get\_executed\_filename(TSRMLS\_C);
++ }
++ ap\_php\_snprintf(buf, sizeof(buf), "%s - %s (attacker '%s', file '%s', line %u)", alertstring, error, ip\_address, fname, lineno);
++ } else {
++ fname = sapi\_getenv("SCRIPT\_FILENAME", 15 TSRMLS\_CC);
++ if (fname==NULL) {
++ fname = "unknown";
++ }
++ ap\_php\_snprintf(buf, sizeof(buf), "%s - %s (attacker '%s', file '%s')", alertstring, error, ip\_address, fname);
++ }
++
++ /\* Syslog-Logging disabled? \*/
++ if (((SPG(log\_syslog)|S\_INTERNAL) & loglevel)==0) {
++ goto log\_sapi;
++ }
++
++#if defined(AF\_UNIX)
++ ap\_php\_snprintf(error, sizeof(error), "<%u>suhosin[%u]: %s\n", (unsigned int)(SPG(log\_syslog\_facility)|SPG(log\_syslog\_priority)),getpid(),buf);
++
++ s = socket(AF\_UNIX, SOCK\_DGRAM, 0);
++ if (s == -1) {
++ goto log\_sapi;
++ }
++
++ memset(&saun, 0, sizeof(saun));
++ saun.sun\_family = AF\_UNIX;
++ strcpy(saun.sun\_path, SYSLOG\_PATH);
++ /\*saun.sun\_len = sizeof(saun);\*/
++
++ r = connect(s, (struct sockaddr \*)&saun, sizeof(saun));
++ if (r) {
++ close(s);
++ s = socket(AF\_UNIX, SOCK\_STREAM, 0);
++ if (s == -1) {
++ goto log\_sapi;
++ }
++
++ memset(&saun, 0, sizeof(saun));
++ saun.sun\_family = AF\_UNIX;
++ strcpy(saun.sun\_path, SYSLOG\_PATH);
++ /\*saun.sun\_len = sizeof(saun);\*/
++
++ r = connect(s, (struct sockaddr \*)&saun, sizeof(saun));
++ if (r) {
++ close(s);
++ goto log\_sapi;
++ }
++ }
++ send(s, error, strlen(error), 0);
++
++ close(s);
++#endif
++#ifdef PHP\_WIN32
++ ap\_php\_snprintf(error, sizeof(error), "suhosin[%u]: %s", getpid(),buf);
++
++ switch (SPG(log\_syslog\_priority)) { /\* translate UNIX type into NT type \*/
++ case 1: /\*LOG\_ALERT:\*/
++ etype = EVENTLOG\_ERROR\_TYPE;
++ break;
++ case 6: /\*LOG\_INFO:\*/
++ etype = EVENTLOG\_INFORMATION\_TYPE;
++ break;
++ default:
++ etype = EVENTLOG\_WARNING\_TYPE;
++ }
++ evid = loglevel;
++ strs[0] = error;
++ /\* report the event \*/
++ if (log\_source == NULL) {
++ log\_source = RegisterEventSource(NULL, "Suhosin-Patch-" SUHOSIN\_PATCH\_VERSION);
++ }
++ ReportEvent(log\_source, etype, (unsigned short) SPG(log\_syslog\_priority), evid, NULL, 1, 0, strs, NULL);
++
++#endif
++log\_sapi:
++ /\* SAPI Logging activated? \*/
++ /\*SDEBUG("(suhosin\_log) log\_syslog: %u - log\_sapi: %u - log\_script: %u - log\_phpscript: %u", SPG(log\_syslog), SPG(log\_sapi), SPG(log\_script), SPG(log\_phpscript));\*/
++ if (((SPG(log\_sapi)|S\_INTERNAL) & loglevel)!=0) {
++ sapi\_module.log\_message(buf);
++ }
++
++/\*log\_script:\*/
++ /\* script logging activaed? \*/
++ if (((SPG(log\_script) & loglevel)!=0) && SPG(log\_scriptname)!=NULL) {
++ char cmd[8192], \*cmdpos, \*bufpos;
++ FILE \*in;
++ int space;
++
++ ap\_php\_snprintf(cmd, sizeof(cmd), "%s %s \'", SPG(log\_scriptname), loglevel2string(loglevel));
++ space = sizeof(cmd) - strlen(cmd);
++ cmdpos = cmd + strlen(cmd);
++ bufpos = buf;
++ if (space <= 1) return;
++ while (space > 2 && \*bufpos) {
++ if (\*bufpos == '\'') {
++ if (space<=5) break;
++ \*cmdpos++ = '\'';
++ \*cmdpos++ = '\\';
++ \*cmdpos++ = '\'';
++ \*cmdpos++ = '\'';
++ bufpos++;
++ space-=4;
++ } else {
++ \*cmdpos++ = \*bufpos++;
++ space--;
++ }
++ }
++ \*cmdpos++ = '\'';
++ \*cmdpos = 0;
++
++ if ((in=VCWD\_POPEN(cmd, "r"))==NULL) {
++ php\_security\_log(S\_INTERNAL, "Unable to execute logging shell script: %s", SPG(log\_scriptname));
++ return;
++ }
++ /\* read and forget the result \*/
++ while (1) {
++ int readbytes = fread(cmd, 1, sizeof(cmd), in);
++ if (readbytes<=0) {
++ break;
++ }
++ }
++ pclose(in);
++ }
++/\*log\_phpscript:\*/
++ if ((SPG(log\_phpscript) & loglevel)!=0 && EG(in\_execution) && SPG(log\_phpscriptname) && SPG(log\_phpscriptname)[0]) {
++ zend\_file\_handle file\_handle;
++ zend\_op\_array \*new\_op\_array;
++ zval \*result = NULL;
++
++ /\*long orig\_execution\_depth = SPG(execution\_depth);\*/
++ zend\_bool orig\_safe\_mode = PG(safe\_mode);
++ char \*orig\_basedir = PG(open\_basedir);
++
++ char \*phpscript = SPG(log\_phpscriptname);
++/\*SDEBUG("scriptname %s", SPG(log\_phpscriptname));`\*/
++#ifdef ZEND\_ENGINE\_2
++ if (zend\_stream\_open(phpscript, &file\_handle TSRMLS\_CC) == SUCCESS) {
++#else
++ if (zend\_open(phpscript, &file\_handle) == SUCCESS && ZEND\_IS\_VALID\_FILE\_HANDLE(&file\_handle)) {
++ file\_handle.filename = phpscript;
++ file\_handle.free\_filename = 0;
++#endif
++ if (!file\_handle.opened\_path) {
++ file\_handle.opened\_path = estrndup(phpscript, strlen(phpscript));
++ }
++ new\_op\_array = zend\_compile\_file(&file\_handle, ZEND\_REQUIRE TSRMLS\_CC);
++ zend\_destroy\_file\_handle(&file\_handle TSRMLS\_CC);
++ if (new\_op\_array) {
++ HashTable \*active\_symbol\_table = EG(active\_symbol\_table);
++ zval \*zerror, \*zerror\_class;
++
++ if (active\_symbol\_table == NULL) {
++ active\_symbol\_table = &EG(symbol\_table);
++ }
++ EG(return\_value\_ptr\_ptr) = &result
++ EG(active\_op\_array) = new\_op\_array;
++
++ MAKE\_STD\_ZVAL(zerror);
++ MAKE\_STD\_ZVAL(zerror\_class);
++ ZVAL\_STRING(zerror, buf, 1);
++ ZVAL\_LONG(zerror\_class, loglevel);
++
++ zend\_hash\_update(active\_symbol\_table, "SUHOSIN\_ERROR", sizeof("SUHOSIN\_ERROR"), (void \*\*)&zerror, sizeof(zval \*), NULL);
++ zend\_hash\_update(active\_symbol\_table, "SUHOSIN\_ERRORCLASS", sizeof("SUHOSIN\_ERRORCLASS"), (void \*\*)&zerror\_class, sizeof(zval \*), NULL);
++
++ /\*SPG(execution\_depth) = 0;\*/
++ if (SPG(log\_phpscript\_is\_safe)) {
++ PG(safe\_mode) = 0;
++ PG(open\_basedir) = NULL;
++ }
++
++ zend\_execute(new\_op\_array TSRMLS\_CC);
++
++ /\*SPG(execution\_depth) = orig\_execution\_depth;\*/
++ PG(safe\_mode) = orig\_safe\_mode;
++ PG(open\_basedir) = orig\_basedir;
++
++#ifdef ZEND\_ENGINE\_2
++ destroy\_op\_array(new\_op\_array TSRMLS\_CC);
++#else
++ destroy\_op\_array(new\_op\_array);
++#endif
++ efree(new\_op\_array);
++#ifdef ZEND\_ENGINE\_2
++ if (!EG(exception))
++#endif
++ {
++ if (EG(return\_value\_ptr\_ptr)) {
++ zval\_ptr\_dtor(EG(return\_value\_ptr\_ptr));
++ EG(return\_value\_ptr\_ptr) = NULL;
++ }
++ }
++ } else {
++ php\_security\_log(S\_INTERNAL, "Unable to execute logging PHP script: %s", SPG(log\_phpscriptname));
++ return;
++ }
++ } else {
++ php\_security\_log(S\_INTERNAL, "Unable to execute logging PHP script: %s", SPG(log\_phpscriptname));
++ return;
++ }
++ }
++
++}
++
++
++#endif
++
++/\*
++ \* Local variables:
++ \* tab-width: 4
++ \* c-basic-offset: 4
++ \* End:
++ \* vim600: sw=4 ts=4 fdm=marker
++ \* vim<600: sw=4 ts=4
++ \*/
+--- /dev/null
++++ b/main/suhosin\_patch.h
+@@ -0,0 +1,59 @@
++/\*
++ +----------------------------------------------------------------------+
++ | Suhosin Patch for PHP |
++ +----------------------------------------------------------------------+
++ | Copyright (c) 2004-2010 Stefan Esser |
++ +----------------------------------------------------------------------+
++ | This source file is subject to version 2.02 of the PHP license, |
++ | that is bundled with this package in the file LICENSE, and is |
++ | available at through the world-wide-web at |
++ | http://www.php.net/license/2\_02.txt. |
++ | If you did not receive a copy of the PHP license and are unable to |
++ | obtain it through the world-wide-web, please send a note to |
++ | license@php.net so we can mail you a copy immediately. |
++ +----------------------------------------------------------------------+
++ | Author: Stefan Esser  |
++ +----------------------------------------------------------------------+
++ \*/
++
++#ifndef SUHOSIN\_PATCH\_H
++#define SUHOSIN\_PATCH\_H
++
++#if SUHOSIN\_PATCH
++
++#include "zend.h"
++
++#define SUHOSIN\_PATCH\_VERSION "0.9.9.1"
++
++#define SUHOSIN\_LOGO\_GUID "SUHO8567F54-D428-14d2-A769-00DA302A5F18"
++
++#define SUHOSIN\_CONFIG(idx) (suhosin\_get\_config(idx))
++
++#define SUHOSIN\_MM\_USE\_CANARY\_PROTECTION 0
++#define SUHOSIN\_MM\_DESTROY\_FREE\_MEMORY 1
++#define SUHOSIN\_MM\_IGNORE\_CANARY\_VIOLATION 2
++#define SUHOSIN\_HT\_IGNORE\_INVALID\_DESTRUCTOR 3
++#define SUHOSIN\_LL\_IGNORE\_INVALID\_DESTRUCTOR 4
++
++#define SUHOSIN\_CONFIG\_SET 100
++
++#include
++#include
++#include
++
++#if defined(DARWIN)
++#include
++#endif
++
++#define SUHOSIN\_MANGLE\_PTR(ptr) (ptr==NULL?NULL:((void \*)((zend\_intptr\_t)(ptr)^SUHOSIN\_POINTER\_GUARD)))
++
++#endif
++
++#endif /\* SUHOSIN\_PATCH\_H \*/
++
++/\*
++ \* Local variables:
++ \* tab-width: 4
++ \* c-basic-offset: 4
++ \* End:
++ \*/
+--- /dev/null
++++ b/main/suhosin\_patch.m4
+@@ -0,0 +1,8 @@
++dnl
++dnl $Id: suhosin\_patch.m4,v 1.1 2004/11/14 13:24:24 ionic Exp $
++dnl
++dnl This file contains Suhosin Patch for PHP specific autoconf functions.
++dnl
++
++AC\_DEFINE(SUHOSIN\_PATCH, 1, [Suhosin Patch])
++
+--- a/sapi/apache/mod\_php5.c
++++ b/sapi/apache/mod\_php5.c
+@@ -969,7 +969,11 @@ static void php\_init\_handler(server\_rec
+ {
+ TSRMLS\_FETCH();
+ if (PG(expose\_php)) {
++#if SUHOSIN\_PATCH
++ ap\_add\_version\_component("PHP/" PHP\_VERSION " with Suhosin-Patch");
++#else
+ ap\_add\_version\_component("PHP/" PHP\_VERSION);
++#endif
+ }
+ }
+ #endif
+--- a/sapi/apache2filter/sapi\_apache2.c
++++ b/sapi/apache2filter/sapi\_apache2.c
+@@ -583,7 +583,11 @@ static void php\_apache\_add\_version(apr\_p
+ {
+ TSRMLS\_FETCH();
+ if (PG(expose\_php)) {
++#if SUHOSIN\_PATCH
++ ap\_add\_version\_component(p, "PHP/" PHP\_VERSION " with Suhosin-Patch");
++#else
+ ap\_add\_version\_component(p, "PHP/" PHP\_VERSION);
++#endif
+ }
+ }
+
+--- a/sapi/apache2handler/sapi\_apache2.c
++++ b/sapi/apache2handler/sapi\_apache2.c
+@@ -393,7 +393,11 @@ static void php\_apache\_add\_version(apr\_p
+ {
+ TSRMLS\_FETCH();
+ if (PG(expose\_php)) {
++#if SUHOSIN\_PATCH
++ ap\_add\_version\_component(p, "PHP/" PHP\_VERSION " with Suhosin-Patch");
++#else
+ ap\_add\_version\_component(p, "PHP/" PHP\_VERSION);
++#endif
+ }
+ }
+
+--- a/sapi/apache\_hooks/mod\_php5.c
++++ b/sapi/apache\_hooks/mod\_php5.c
+@@ -1256,7 +1256,11 @@ static void php\_init\_handler(server\_rec
+ {
+ TSRMLS\_FETCH();
+ if (PG(expose\_php)) {
++#if SUHOSIN\_PATCH
++ ap\_add\_version\_component("PHP/" PHP\_VERSION " with Suhosin-Patch");
++#else
+ ap\_add\_version\_component("PHP/" PHP\_VERSION);
++#endif
+ }
+ }
+ #endif
+--- a/sapi/cgi/cgi\_main.c
++++ b/sapi/cgi/cgi\_main.c
+@@ -1923,10 +1923,18 @@ consult the installation file that came
+ SG(headers\_sent) = 1;
+ SG(request\_info).no\_headers = 1;
+ }
++#if SUHOSIN\_PATCH
+ #if ZEND\_DEBUG
+- php\_printf("PHP %s (%s) (built: %s %s) (DEBUG)\nCopyright (c) 1997-2010 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++ php\_printf("PHP %s with Suhosin-Patch (%s) (built: %s %s) (DEBUG)\nCopyright (c) 1997-2009 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
+ #else
+- php\_printf("PHP %s (%s) (built: %s %s)\nCopyright (c) 1997-2010 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++ php\_printf("PHP %s with Suhosin-Patch (%s) (built: %s %s)\nCopyright (c) 1997-2009 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++#endif
++#else
++ #if ZEND\_DEBUG
++ php\_printf("PHP %s (%s) (built: %s %s) (DEBUG)\nCopyright (c) 1997-2009 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++ #else
++ php\_printf("PHP %s (%s) (built: %s %s)\nCopyright (c) 1997-2009 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++ #endif
+ #endif
+ php\_request\_shutdown((void \*) 0);
+ exit\_status = 0;
+--- a/sapi/cli/php\_cli.c
++++ b/sapi/cli/php\_cli.c
+@@ -831,7 +831,11 @@ int main(int argc, char \*argv[])
+ }
+
+ request\_started = 1;
+- php\_printf("PHP %s (%s) (built: %s %s) %s\nCopyright (c) 1997-2010 The PHP Group\n%s",
++ php\_printf("PHP %s "
++#if SUHOSIN\_PATCH
++ "with Suhosin-Patch "
++#endif
++ "(%s) (built: %s %s) %s\nCopyright (c) 1997-2009 The PHP Group\n%s",
+ PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_,
+ #if ZEND\_DEBUG && defined(HAVE\_GCOV)
+ "(DEBUG GCOV)",
+--- a/sapi/litespeed/lsapi\_main.c
++++ b/sapi/litespeed/lsapi\_main.c
+@@ -545,11 +545,19 @@ static int cli\_main( int argc, char \* ar
+ break;
+ case 'v':
+ if (php\_request\_startup(TSRMLS\_C) != FAILURE) {
++#if SUHOSIN\_PATCH
++#if ZEND\_DEBUG
++ php\_printf("PHP %s with Suhosin-Patch (%s) (built: %s %s) (DEBUG)\nCopyright (c) 1997-2004 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++#else
++ php\_printf("PHP %s with Suhosin-Patch (%s) (built: %s %s)\nCopyright (c) 1997-2004 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++#endif
++#else
+ #if ZEND\_DEBUG
+ php\_printf("PHP %s (%s) (built: %s %s) (DEBUG)\nCopyright (c) 1997-2004 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
+ #else
+ php\_printf("PHP %s (%s) (built: %s %s)\nCopyright (c) 1997-2004 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
+ #endif
++#endif
+ #ifdef PHP\_OUTPUT\_NEWAPI
+ php\_output\_end\_all(TSRMLS\_C);
+ #else
+--- a/sapi/milter/php\_milter.c
++++ b/sapi/milter/php\_milter.c
+@@ -1102,7 +1102,11 @@ int main(int argc, char \*argv[])
+ }
+ SG(headers\_sent) = 1;
+ SG(request\_info).no\_headers = 1;
+- php\_printf("PHP %s (%s) (built: %s %s)\nCopyright (c) 1997-2010 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++#if SUHOSIN\_PATCH
++ php\_printf("PHP %s with Suhosin-Patch (%s) (built: %s %s)\nCopyright (c) 1997-2009 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++#else
++ php\_printf("PHP %s (%s) (built: %s %s)\nCopyright (c) 1997-2009 The PHP Group\n%s", PHP\_VERSION, sapi\_module.name, \_\_DATE\_\_, \_\_TIME\_\_, get\_zend\_version());
++#endif
+ php\_end\_ob\_buffers(1 TSRMLS\_CC);
+ exit(1);
+ break;
+--- a/win32/build/config.w32
++++ b/win32/build/config.w32
+@@ -325,7 +325,7 @@ ADD\_SOURCES("Zend", "zend\_language\_parse
+ zend\_stream.c zend\_iterators.c zend\_interfaces.c zend\_objects.c \
+ zend\_object\_handlers.c zend\_objects\_API.c \
+ zend\_default\_classes.c zend\_execute.c zend\_strtod.c zend\_gc.c zend\_closures.c \
+- zend\_float.c");
++ zend\_float.c zend\_canary.c zend\_alloc\_canary.c");
+
+ if (VCVERS == 1200) {
+ AC\_DEFINE('ZEND\_DVAL\_TO\_LVAL\_CAST\_OK', 1);
+@@ -380,6 +380,7 @@ if (PHP\_ZEND\_MULTIBYTE == "yes") {
+
+ AC\_DEFINE('HAVE\_USLEEP', 1);
+ AC\_DEFINE('HAVE\_STRCOLL', 1);
++AC\_DEFINE('SUHOSIN\_PATCH', 1);
+
+ /\* For snapshot builders, where can we find the additional
+ \* files that make up the snapshot template? \*/
+--- a/win32/build/config.w32.h.in
++++ b/win32/build/config.w32.h.in
+@@ -151,6 +151,9 @@
+ /\* Win32 supports strcoll \*/
+ #define HAVE\_STRCOLL 1
+
++/\* Suhosin Patch support \*/
++#define SUHOSIN\_PATCH 1
++
+ /\* Win32 supports socketpair by the emulation in win32/sockets.c \*/
+ #define HAVE\_SOCKETPAIR 1
+ #define HAVE\_SOCKLEN\_T 1
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-4409.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-4409.patch
@@ -0,0 +1,90 @@
+Subject: Fix invalid args bugs by Maksymilian Arciemowicz
+Origin: http://svn.php.net/viewvc?view=revision&revision=305571
+
+
+---
+ ext/intl/dateformat/dateformat\_attr.c | 1 +
+ ext/intl/formatter/formatter\_attr.c | 9 +++++++--
+ ext/intl/tests/dateformat\_get\_locale.phpt | 6 ++++++
+ ext/intl/tests/formatter\_get\_set\_symbol.phpt | 7 ++++++-
+ 4 files changed, 20 insertions(+), 3 deletions(-)
+
+Index: b/ext/intl/dateformat/dateformat\_attr.c
+===================================================================
+--- a/ext/intl/dateformat/dateformat\_attr.c
++++ b/ext/intl/dateformat/dateformat\_attr.c
+@@ -309,6 +309,7 @@ PHP\_FUNCTION( datefmt\_get\_locale )
+ DATE\_FORMAT\_METHOD\_FETCH\_OBJECT;
+
+ loc = (char \*)udat\_getLocaleByType(DATE\_FORMAT\_OBJECT(dfo), loc\_type,&INTL\_DATA\_ERROR\_CODE(dfo));
++ INTL\_METHOD\_CHECK\_STATUS(dfo, "Error getting locale");
+ RETURN\_STRING(loc, 1);
+ }
+ /\* }}} \*/
+Index: b/ext/intl/tests/dateformat\_get\_locale.phpt
+===================================================================
+--- a/ext/intl/tests/dateformat\_get\_locale.phpt
++++ b/ext/intl/tests/dateformat\_get\_locale.phpt
+@@ -29,6 +29,12 @@ function ut\_main()
+ $res\_str .= "\nAfter call to get\_locale : locale= $locale";
+ $res\_str .= "\n";
+ }
++ $badvals = array(100, -1, 4294901761);
++ foreach($badvals as $badval) {
++ if(ut\_datefmt\_get\_locale($fmt, $badval)) {
++ $res\_str .= "datefmt\_get\_locale should return false for bad argument $badval\n";
++ }
++ }
+
+ return $res\_str;
+
+Index: b/ext/intl/tests/formatter\_get\_set\_symbol.phpt
+===================================================================
+--- a/ext/intl/tests/formatter\_get\_set\_symbol.phpt
++++ b/ext/intl/tests/formatter\_get\_set\_symbol.phpt
+@@ -73,7 +73,12 @@ function ut\_main()
+ // Restore attribute's symbol.
+ ut\_nfmt\_set\_symbol( $fmt, $symb, $orig\_val );
+ }
+-
++ $badvals = array(2147483648, -2147483648, -1, 4294901761);
++ foreach($badvals as $badval) {
++ if(ut\_nfmt\_get\_symbol( $fmt, 2147483648 )) {
++ $res\_str .= "Bad value $badval should return false!\n";
++ }
++ }
+ return $res\_str;
+ }
+
+Index: b/ext/intl/formatter/formatter\_attr.c
+===================================================================
+--- a/ext/intl/formatter/formatter\_attr.c
++++ b/ext/intl/formatter/formatter\_attr.c
+@@ -250,7 +250,7 @@ PHP\_FUNCTION( numfmt\_get\_symbol )
+ long symbol;
+ UChar value\_buf[4];
+ UChar \*value = value\_buf;
+- int length = USIZE(value);
++ int length = USIZE(value\_buf);
+ FORMATTER\_METHOD\_INIT\_VARS;
+
+ /\* Parse parameters. \*/
+@@ -262,12 +262,17 @@ PHP\_FUNCTION( numfmt\_get\_symbol )
+
+ RETURN\_FALSE;
+ }
++
++ if(symbol >= UNUM\_FORMAT\_SYMBOL\_COUNT || symbol < 0) {
++ intl\_error\_set( NULL, U\_ILLEGAL\_ARGUMENT\_ERROR, "numfmt\_get\_symbol: invalid symbol value", 0 TSRMLS\_CC );
++ RETURN\_FALSE;
++ }
+
+ /\* Fetch the object. \*/
+ FORMATTER\_METHOD\_FETCH\_OBJECT;
+
+ length = unum\_getSymbol(FORMATTER\_OBJECT(nfo), symbol, value\_buf, length, &INTL\_DATA\_ERROR\_CODE(nfo));
+- if(INTL\_DATA\_ERROR\_CODE(nfo) == U\_BUFFER\_OVERFLOW\_ERROR && length >= USIZE( value )) {
++ if(INTL\_DATA\_ERROR\_CODE(nfo) == U\_BUFFER\_OVERFLOW\_ERROR && length >= USIZE( value\_buf )) {
+ ++length; /\* to avoid U\_STRING\_NOT\_TERMINATED\_WARNING \*/
+ INTL\_DATA\_ERROR\_CODE(nfo) = U\_ZERO\_ERROR;
+ value = eumalloc(length);
--- php5-5.3.2.orig/debian/patches/fix\_broken\_upstream\_tests.patch
+++ php5-5.3.2/debian/patches/fix\_broken\_upstream\_tests.patch
@@ -0,0 +1,25 @@
+Description: Add missing settings to fix upstream tests
+Origin: vendor
+Forwarded: http://bugs.php.net/50796
+Last-Update: 2010-01-18
+
+--- a/ext/soap/tests/server009.phpt
++++ b/ext/soap/tests/server009.phpt
+@@ -10,6 +10,7 @@ SOAP Server 9: setclass and setpersisten
+ --INI--
+ session.auto\_start=1
+ session.save\_handler=files
++session.save\_path=temp\_session\_store
+ --FILE--
+ php
+ class foo {
+--- a/ext/standard/tests/general\_functions/phpinfo.phpt
++++ b/ext/standard/tests/general\_functions/phpinfo.phpt
+@@ -1,5 +1,7 @@
+ --TEST--
+ phpinfo()
++--SKIPIF--
++<?php die("SKIP phpinfo - test suite's handling of "%s" is incompatible with this test"); ?
+ --FILE--
+ php
+ var\_dump(phpinfo());
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1464.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1464.patch
@@ -0,0 +1,690 @@
+Subject: Fixed bug #54055 (buffer overrun with high values for precision ini setting).
+Origin: http://svn.php.net/viewvc?view=revision&revision=308525
+
+#This fix (for g/G/k/H modes) is done at a different level than that for the
+#modes e/E/f/F, at a bit higher level and therefore with less coverage. I
+#chose this because it addresses the problem where it is -- the calling function
+#that passes a buffer too small to php\_gcvt.
+
+CVE-2011-1464
+
+Patch differs from upstream commit in that the NEWS file addition was
+dropped to reduce patch conflicts.
+
+Index: ext/standard/tests/strings/bug54055.phpt
+===================================================================
+--- ext/standard/tests/strings/bug54055.phpt (revision 0)
++++ ext/standard/tests/strings/bug54055.phpt (revision 308525)
+@@ -0,0 +1,589 @@
++--TEST--
++Bug #54055: PHP crashes when executing strval when precision setting is very high
++--FILE--
++<?php
++for($i = 495; $i <= 1074; $i++) {
++ ini\_set('precision', $i);
++ echo "$i: len=", strlen(strval(-1 \* pow(2, -1074))), "\n";
++}
++--EXPECT--
++495: len=502
++496: len=503
++497: len=504
++498: len=505
++499: len=506
++500: len=507
++501: len=507
++502: len=507
++503: len=507
++504: len=507
++505: len=507
++506: len=507
++507: len=507
++508: len=507
++509: len=507
++510: len=507
++511: len=507
++512: len=507
++513: len=507
++514: len=507
++515: len=507
++516: len=507
++517: len=507
++518: len=507
++519: len=507
++520: len=507
++521: len=507
++522: len=507
++523: len=507
++524: len=507
++525: len=507
++526: len=507
++527: len=507
++528: len=507
++529: len=507
++530: len=507
++531: len=507
++532: len=507
++533: len=507
++534: len=507
++535: len=507
++536: len=507
++537: len=507
++538: len=507
++539: len=507
++540: len=507
++541: len=507
++542: len=507
++543: len=507
++544: len=507
++545: len=507
++546: len=507
++547: len=507
++548: len=507
++549: len=507
++550: len=507
++551: len=507
++552: len=507
++553: len=507
++554: len=507
++555: len=507
++556: len=507
++557: len=507
++558: len=507
++559: len=507
++560: len=507
++561: len=507
++562: len=507
++563: len=507
++564: len=507
++565: len=507
++566: len=507
++567: len=507
++568: len=507
++569: len=507
++570: len=507
++571: len=507
++572: len=507
++573: len=507
++574: len=507
++575: len=507
++576: len=507
++577: len=507
++578: len=507
++579: len=507
++580: len=507
++581: len=507
++582: len=507
++583: len=507
++584: len=507
++585: len=507
++586: len=507
++587: len=507
++588: len=507
++589: len=507
++590: len=507
++591: len=507
++592: len=507
++593: len=507
++594: len=507
++595: len=507
++596: len=507
++597: len=507
++598: len=507
++599: len=507
++600: len=507
++601: len=507
++602: len=507
++603: len=507
++604: len=507
++605: len=507
++606: len=507
++607: len=507
++608: len=507
++609: len=507
++610: len=507
++611: len=507
++612: len=507
++613: len=507
++614: len=507
++615: len=507
++616: len=507
++617: len=507
++618: len=507
++619: len=507
++620: len=507
++621: len=507
++622: len=507
++623: len=507
++624: len=507
++625: len=507
++626: len=507
++627: len=507
++628: len=507
++629: len=507
++630: len=507
++631: len=507
++632: len=507
++633: len=507
++634: len=507
++635: len=507
++636: len=507
++637: len=507
++638: len=507
++639: len=507
++640: len=507
++641: len=507
++642: len=507
++643: len=507
++644: len=507
++645: len=507
++646: len=507
++647: len=507
++648: len=507
++649: len=507
++650: len=507
++651: len=507
++652: len=507
++653: len=507
++654: len=507
++655: len=507
++656: len=507
++657: len=507
++658: len=507
++659: len=507
++660: len=507
++661: len=507
++662: len=507
++663: len=507
++664: len=507
++665: len=507
++666: len=507
++667: len=507
++668: len=507
++669: len=507
++670: len=507
++671: len=507
++672: len=507
++673: len=507
++674: len=507
++675: len=507
++676: len=507
++677: len=507
++678: len=507
++679: len=507
++680: len=507
++681: len=507
++682: len=507
++683: len=507
++684: len=507
++685: len=507
++686: len=507
++687: len=507
++688: len=507
++689: len=507
++690: len=507
++691: len=507
++692: len=507
++693: len=507
++694: len=507
++695: len=507
++696: len=507
++697: len=507
++698: len=507
++699: len=507
++700: len=507
++701: len=507
++702: len=507
++703: len=507
++704: len=507
++705: len=507
++706: len=507
++707: len=507
++708: len=507
++709: len=507
++710: len=507
++711: len=507
++712: len=507
++713: len=507
++714: len=507
++715: len=507
++716: len=507
++717: len=507
++718: len=507
++719: len=507
++720: len=507
++721: len=507
++722: len=507
++723: len=507
++724: len=507
++725: len=507
++726: len=507
++727: len=507
++728: len=507
++729: len=507
++730: len=507
++731: len=507
++732: len=507
++733: len=507
++734: len=507
++735: len=507
++736: len=507
++737: len=507
++738: len=507
++739: len=507
++740: len=507
++741: len=507
++742: len=507
++743: len=507
++744: len=507
++745: len=507
++746: len=507
++747: len=507
++748: len=507
++749: len=507
++750: len=507
++751: len=507
++752: len=507
++753: len=507
++754: len=507
++755: len=507
++756: len=507
++757: len=507
++758: len=507
++759: len=507
++760: len=507
++761: len=507
++762: len=507
++763: len=507
++764: len=507
++765: len=507
++766: len=507
++767: len=507
++768: len=507
++769: len=507
++770: len=507
++771: len=507
++772: len=507
++773: len=507
++774: len=507
++775: len=507
++776: len=507
++777: len=507
++778: len=507
++779: len=507
++780: len=507
++781: len=507
++782: len=507
++783: len=507
++784: len=507
++785: len=507
++786: len=507
++787: len=507
++788: len=507
++789: len=507
++790: len=507
++791: len=507
++792: len=507
++793: len=507
++794: len=507
++795: len=507
++796: len=507
++797: len=507
++798: len=507
++799: len=507
++800: len=507
++801: len=507
++802: len=507
++803: len=507
++804: len=507
++805: len=507
++806: len=507
++807: len=507
++808: len=507
++809: len=507
++810: len=507
++811: len=507
++812: len=507
++813: len=507
++814: len=507
++815: len=507
++816: len=507
++817: len=507
++818: len=507
++819: len=507
++820: len=507
++821: len=507
++822: len=507
++823: len=507
++824: len=507
++825: len=507
++826: len=507
++827: len=507
++828: len=507
++829: len=507
++830: len=507
++831: len=507
++832: len=507
++833: len=507
++834: len=507
++835: len=507
++836: len=507
++837: len=507
++838: len=507
++839: len=507
++840: len=507
++841: len=507
++842: len=507
++843: len=507
++844: len=507
++845: len=507
++846: len=507
++847: len=507
++848: len=507
++849: len=507
++850: len=507
++851: len=507
++852: len=507
++853: len=507
++854: len=507
++855: len=507
++856: len=507
++857: len=507
++858: len=507
++859: len=507
++860: len=507
++861: len=507
++862: len=507
++863: len=507
++864: len=507
++865: len=507
++866: len=507
++867: len=507
++868: len=507
++869: len=507
++870: len=507
++871: len=507
++872: len=507
++873: len=507
++874: len=507
++875: len=507
++876: len=507
++877: len=507
++878: len=507
++879: len=507
++880: len=507
++881: len=507
++882: len=507
++883: len=507
++884: len=507
++885: len=507
++886: len=507
++887: len=507
++888: len=507
++889: len=507
++890: len=507
++891: len=507
++892: len=507
++893: len=507
++894: len=507
++895: len=507
++896: len=507
++897: len=507
++898: len=507
++899: len=507
++900: len=507
++901: len=507
++902: len=507
++903: len=507
++904: len=507
++905: len=507
++906: len=507
++907: len=507
++908: len=507
++909: len=507
++910: len=507
++911: len=507
++912: len=507
++913: len=507
++914: len=507
++915: len=507
++916: len=507
++917: len=507
++918: len=507
++919: len=507
++920: len=507
++921: len=507
++922: len=507
++923: len=507
++924: len=507
++925: len=507
++926: len=507
++927: len=507
++928: len=507
++929: len=507
++930: len=507
++931: len=507
++932: len=507
++933: len=507
++934: len=507
++935: len=507
++936: len=507
++937: len=507
++938: len=507
++939: len=507
++940: len=507
++941: len=507
++942: len=507
++943: len=507
++944: len=507
++945: len=507
++946: len=507
++947: len=507
++948: len=507
++949: len=507
++950: len=507
++951: len=507
++952: len=507
++953: len=507
++954: len=507
++955: len=507
++956: len=507
++957: len=507
++958: len=507
++959: len=507
++960: len=507
++961: len=507
++962: len=507
++963: len=507
++964: len=507
++965: len=507
++966: len=507
++967: len=507
++968: len=507
++969: len=507
++970: len=507
++971: len=507
++972: len=507
++973: len=507
++974: len=507
++975: len=507
++976: len=507
++977: len=507
++978: len=507
++979: len=507
++980: len=507
++981: len=507
++982: len=507
++983: len=507
++984: len=507
++985: len=507
++986: len=507
++987: len=507
++988: len=507
++989: len=507
++990: len=507
++991: len=507
++992: len=507
++993: len=507
++994: len=507
++995: len=507
++996: len=507
++997: len=507
++998: len=507
++999: len=507
++1000: len=507
++1001: len=507
++1002: len=507
++1003: len=507
++1004: len=507
++1005: len=507
++1006: len=507
++1007: len=507
++1008: len=507
++1009: len=507
++1010: len=507
++1011: len=507
++1012: len=507
++1013: len=507
++1014: len=507
++1015: len=507
++1016: len=507
++1017: len=507
++1018: len=507
++1019: len=507
++1020: len=507
++1021: len=507
++1022: len=507
++1023: len=507
++1024: len=507
++1025: len=507
++1026: len=507
++1027: len=507
++1028: len=507
++1029: len=507
++1030: len=507
++1031: len=507
++1032: len=507
++1033: len=507
++1034: len=507
++1035: len=507
++1036: len=507
++1037: len=507
++1038: len=507
++1039: len=507
++1040: len=507
++1041: len=507
++1042: len=507
++1043: len=507
++1044: len=507
++1045: len=507
++1046: len=507
++1047: len=507
++1048: len=507
++1049: len=507
++1050: len=507
++1051: len=507
++1052: len=507
++1053: len=507
++1054: len=507
++1055: len=507
++1056: len=507
++1057: len=507
++1058: len=507
++1059: len=507
++1060: len=507
++1061: len=507
++1062: len=507
++1063: len=507
++1064: len=507
++1065: len=507
++1066: len=507
++1067: len=507
++1068: len=507
++1069: len=507
++1070: len=507
++1071: len=507
++1072: len=507
++1073: len=507
++1074: len=507
+Index: main/snprintf.c
+===================================================================
+--- main/snprintf.c (revision 308524)
++++ main/snprintf.c (revision 308525)
+@@ -677,10 +677,6 @@
+
+ /\*
+ \* Check if a precision was specified
+- \*
+- \* XXX: an unreasonable amount of precision may be specified
+- \* resulting in overflow of num\_buf. Currently we
+- \* ignore this possibility.
+ \*/
+ if (\*fmt == '.') {
+ adjust\_precision = YES;
+@@ -694,6 +690,10 @@
+ precision = 0;
+ } else
+ precision = 0;
++
++ if (precision  FORMAT\_CONV\_MAX\_PRECISION) {
++ precision = FORMAT\_CONV\_MAX\_PRECISION;
++ }
+ } else
+ adjust\_precision = NO;
+ } else
+Index: main/spprintf.c
+===================================================================
+--- main/spprintf.c (revision 308524)
++++ main/spprintf.c (revision 308525)
+@@ -285,10 +285,6 @@
+
+ /\*
+ \* Check if a precision was specified
+- \*
+- \* XXX: an unreasonable amount of precision may be specified
+- \* resulting in overflow of num\_buf. Currently we
+- \* ignore this possibility.
+ \*/
+ if (\*fmt == '.') {
+ adjust\_precision = YES;
+@@ -302,6 +298,10 @@
+ precision = 0;
+ } else
+ precision = 0;
++
++ if (precision > FORMAT\_CONV\_MAX\_PRECISION) {
++ precision = FORMAT\_CONV\_MAX\_PRECISION;
++ }
+ } else
+ adjust\_precision = NO;
+ } else
+Index: main/snprintf.h
+===================================================================
+--- main/snprintf.h (revision 308524)
++++ main/snprintf.h (revision 308525)
+@@ -12,7 +12,7 @@
+ | obtain it through the world-wide-web, please send a note to |
+ | license@php.net so we can mail you a copy immediately. |
+ +----------------------------------------------------------------------+
+- | Author: Stig Sæther Bakken  |
++ | Author: Stig SÃ¦ther Bakken  |
+ | Marcus Boerger  |
+ +----------------------------------------------------------------------+
+ \*/
+@@ -158,6 +158,17 @@
+ extern char \* ap\_php\_conv\_p2(register u\_wide\_int num, register int nbits,
+ char format, char \*buf\_end, register int \*len);
+
++/\* The maximum precision that's allowed for float conversion. Does not include
++ \* decimal separator, exponent, sign, terminator. Currently does not affect
++ \* the modes e/f, only g/k/H, as those have a different limit enforced at
++ \* another level (see NDIG in php\_conv\_fp()).
++ \* Applies to the formatting functions of both spprintf.c and snprintf.c, which
++ \* use equally sized buffers of MAX\_BUF\_SIZE = 512 to hold the result of the
++ \* call to php\_gcvt().
++ \* This should be reasonably smaller than MAX\_BUF\_SIZE (I think MAX\_BUF\_SIZE - 9
++ \* should be enough, but let's give some more space) \*/
++#define FORMAT\_CONV\_MAX\_PRECISION 500
++
+ #endif /\* SNPRINTF\_H \*/
+
+ /\*
--- php5-5.3.2.orig/debian/patches/045-exif\_nesting\_level.patch
+++ php5-5.3.2/debian/patches/045-exif\_nesting\_level.patch
@@ -0,0 +1,16 @@
+Description: Increase maximum exif nesting level.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- pkg-php.orig/ext/exif/exif.c
++++ pkg-php/ext/exif/exif.c
+@@ -99,7 +99,7 @@ typedef unsigned char uchar;
+
+ #define EFREE\_IF(ptr) if (ptr) efree(ptr)
+
+-#define MAX\_IFD\_NESTING\_LEVEL 100
++#define MAX\_IFD\_NESTING\_LEVEL 250
+
+ /\* {{{ arginfo \*/
+ ZEND\_BEGIN\_ARG\_INFO(arginfo\_exif\_tagname, 0)
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-0421.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-0421.patch
@@ -0,0 +1,48 @@
+Subject: fix bug 53885 (ZipArchive segfault with FL\_UNCHANGED on empty archive)
+Origin: http://svn.php.net/viewvc/?view=revision&revision=307867
+Bug: http://bugs.php.net/bug.php?id=53885
+
+CVE-2011-421
+
+Patch has been modified from upstream commit to remove edits to NEWS, to
+reduce conflicts when applying.
+
+Index: ext/zip/tests/bug53885.phpt
+===================================================================
+--- ext/zip/tests/bug53885.phpt (revision 0)
++++ ext/zip/tests/bug53885.phpt (revision 307867)
+@@ -0,0 +1,19 @@
++--TEST--
++Bug #53885 (ZipArchive segfault with FL\_UNCHANGED on empty archive)
++--SKIPIF--
++php
++if(!extension\_loaded('zip')) die('skip');
++?
++--FILE--
++php
++$fname = dirname(\_\_FILE\_\_)."/test53885.zip";
++if(file\_exists($fname)) unlink($fname);
++touch($fname);
++$nx=new ZipArchive();
++$nx-open($fname);
++$nx->locateName("a",ZIPARCHIVE::FL\_UNCHANGED);
++$nx->statName("a",ZIPARCHIVE::FL\_UNCHANGED);
++?>
++==DONE==
++--EXPECTF--
++==DONE==
+Index: ext/zip/lib/zip\_name\_locate.c
+===================================================================
+--- ext/zip/lib/zip\_name\_locate.c (revision 307866)
++++ ext/zip/lib/zip\_name\_locate.c (revision 307867)
+@@ -60,6 +60,10 @@
+ return -1;
+ }
+
++ if((flags & ZIP\_FL\_UNCHANGED) && !za->cdir) {
++ return -1;
++ }
++
+ cmp = (flags & ZIP\_FL\_NOCASE) ? strcmpi : strcmp;
+
+ n = (flags & ZIP\_FL\_UNCHANGED) ? za->cdir->nentry : za->nentry;
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-3710.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-3710.patch
@@ -0,0 +1,53 @@
+Subject: Segfault in filter\_var with FILTER\_VALIDATE\_EMAIL with large amount of data
+Origin: http://svn.php.net/viewvc?view=revision&revision=303779
+Bug: http://bugs.php.net/bug.php?id=52929
+
+CVE-2010-3710
+
+[Ubuntu note: patch differs from upstream commit in that the change to
+ the NEWS file has been dropped to reduce conflicts - sbeattie]
+
+---
+ ext/filter/logical\_filters.c | 5 +++++
+ ext/filter/tests/bug52929.phpt | 18 ++++++++++++++++++
+ 2 files changed, 23 insertions(+)
+
+Index: b/ext/filter/tests/bug52929.phpt
+===================================================================
+--- /dev/null
++++ b/ext/filter/tests/bug52929.phpt
+@@ -0,0 +1,18 @@
++--TEST--
++Bug #52929 (Segfault in filter\_var with FILTER\_VALIDATE\_EMAIL with large amount of data)
++--SKIPIF--
++php if (!extension\_loaded("filter")) die("skip"); ?
++--FILE--
++php
++var\_dump(filter\_var('valid@email.address', FILTER\_VALIDATE\_EMAIL));
++
++// Beyond the allowable limit for an e-mail address.
++var\_dump(filter\_var('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx@yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy.zz', FILTER\_VALIDATE\_EMAIL));
++
++// An invalid address likely to crash PHP due to stack exhaustion if it goes to
++// the validation regex.
++var\_dump(filter\_var(str\_repeat('x', 8000), FILTER\_VALIDATE\_EMAIL));
++--EXPECT--
++string(19) "valid@email.address"
++bool(false)
++bool(false)
+Index: b/ext/filter/logical\_filters.c
+===================================================================
+--- a/ext/filter/logical\_filters.c
++++ b/ext/filter/logical\_filters.c
+@@ -531,6 +531,11 @@ void php\_filter\_validate\_email(PHP\_INPUT
+ int matches;
+
+
++ /\* The maximum length of an e-mail address is 320 octets, per RFC 2821. \*/
++ if (Z\_STRLEN\_P(value)  320) {
++ RETURN\_VALIDATION\_FAILED
++ }
++
+ re = pcre\_get\_compiled\_regex((char \*)regexp, &pcre\_extra, &preg\_options TSRMLS\_CC);
+ if (!re) {
+ RETURN\_VALIDATION\_FAILED
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-3267.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-3267.patch
@@ -0,0 +1,25 @@
+Subject: Fixed crash in error\_log() (strlen(NULL))
+Origin: http://svn.php.net/viewvc?view=revision&revision=312417
+
+r312417 | felipe | 2011-06-23 14:48:15 -0700 (Thu, 23 Jun 2011) | 1 line
+- Fixed crash in error\_log() (strlen(NULL)) reported by: shm, Maksymilian Arciemowicz
+
+CVE-2011-3267
+
+---
+ ext/standard/basic\_functions.c | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+Index: b/ext/standard/basic\_functions.c
+===================================================================
+--- a/ext/standard/basic\_functions.c
++++ b/ext/standard/basic\_functions.c
+@@ -4671,7 +4671,7 @@ PHP\_FUNCTION(error\_log)
+ opt\_err = erropt;
+ }
+
+- if (opt\_err == 3) {
++ if (opt\_err == 3 && opt) {
+ if (strlen(opt) != opt\_len) {
+ RETURN\_FALSE;
+ }
--- php5-5.3.2.orig/debian/patches/fix\_broken\_sha2\_test.patch
+++ php5-5.3.2/debian/patches/fix\_broken\_sha2\_test.patch
@@ -0,0 +1,40 @@
+--- a/ext/standard/config.m4
++++ b/ext/standard/config.m4
+@@ -184,12 +184,12 @@ AC\_TRY\_RUN([
+
+ main() {
+ #if HAVE\_CRYPT
+- char salt[30], answer[80];
+-
+- salt[0]='$'; salt[1]='6'; salt[2]='$'; salt[3]='$'; salt[4]='b'; salt[5]='a'; salt[6]='r'; salt[7]='\0';
++ char salt[21], answer[21+86];
++
++ strcpy(salt,"\$6\$rasmuslerdorf\$");
+ strcpy(answer, salt);
+- strcpy(&answer[29],"$6$$QMXjqd7rHQZPQ1yHsXkQqC1FBzDiVfTHXL.LaeDAeVV.IzMaV9VU4MQ8kPuZa2SOP1A0RPm772EaFYjpEJtdu.");
+- exit (strcmp((char \*)crypt("foo",salt),answer));
++ strcat(answer, "EeHCRjm0bljalWuALHSTs1NB9ipEiLEXLhYeXdOpx22gmlmVejnVXFhd84cEKbYxCo.XuUTrW.RLraeEnsvWs/");
++ exit (strcmp((char \*)crypt("rasmuslerdorf",salt),answer));
+ #else
+ exit(0);
+ #endif
+@@ -213,12 +213,13 @@ AC\_TRY\_RUN([
+
+ main() {
+ #if HAVE\_CRYPT
+- char salt[30], answer[80];
+- salt[0]='$'; salt[1]='5'; salt[2]='$'; salt[3]='$'; salt[4]='s'; salt[5]='a'; salt[6]='l'; salt[7]='t'; salt[8]='s'; salt[9]='t'; salt[10]='r'; salt[11]='i'; salt[12]='n'; salt[13]='g'; salt[14]='\0';
+- strcat(salt,"");
++ char salt[21], answer[21+43];
++
++ strcpy(salt,"\$5\$rasmuslerdorf\$");
+ strcpy(answer, salt);
+- strcpy(&answer[29], "$5$saltstring$5B8vYYiY.CVt1RlTTf8KbXBH3hsxY/GNooZaBBGWEc5");
+- exit (strcmp((char \*)crypt("foo",salt),answer));
++ strcat(answer, "cFAm2puLCujQ9t.0CxiFIIvFi4JyQx5UncCt/xRIX23");
++ exit (strcmp((char \*)crypt("rasmuslerdorf",salt),answer));
++
+ #else
+ exit(0);
+ #endif
+
--- php5-5.3.2.orig/debian/patches/112-proc\_open.patch
+++ php5-5.3.2/debian/patches/112-proc\_open.patch
@@ -0,0 +1,11 @@
+--- a/ext/standard/proc\_open.c
++++ b/ext/standard/proc\_open.c
+@@ -62,7 +62,7 @@
+ \* \*/
+ #ifdef PHP\_CAN\_SUPPORT\_PROC\_OPEN
+
+-#if 0 && HAVE\_PTSNAME && HAVE\_GRANTPT && HAVE\_UNLOCKPT && HAVE\_SYS\_IOCTL\_H && HAVE\_TERMIOS\_H
++#if HAVE\_PTSNAME && HAVE\_GRANTPT && HAVE\_UNLOCKPT && HAVE\_SYS\_IOCTL\_H && HAVE\_TERMIOS\_H
+ # include
+ # include
+ # define PHP\_CAN\_DO\_PTS 1
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1466.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1466.patch
@@ -0,0 +1,102 @@
+Subject: Fixed bug #53574 (Integer overflow in SdnToJulian, sometimes leading to segfault).
+Origin: http://svn.php.net/viewvc?view=revision&revision=306475
+
+CVE-2011-1466
+
+Patch differs from upstream commit in that the edit to the NEWS file was
+dropped to reduce patch conflicts.
+
+Index: ext/calendar/tests/bug53574.phpt
+===================================================================
+--- ext/calendar/tests/bug53574.phpt (revision 0)
++++ ext/calendar/tests/bug53574.phpt (revision 306475)
+@@ -0,0 +1,35 @@
++--TEST--
++Bug #53574 (Integer overflow in SdnToJulian; leads to segfault)
++--SKIPIF--
++php include 'skipif.inc'; ?
++--FILE--
++php
++if (PHP\_INT\_MAX == 0x7FFFFFFF) {
++ $x = 882858043;
++} else {
++ $x = 3315881921229094912;
++}
++
++var\_dump(cal\_from\_jd($x, CAL\_JULIAN));
++--EXPECT--
++array(9) {
++ ["date"]=
++ string(5) "0/0/0"
++ ["month"]=>
++ int(0)
++ ["day"]=>
++ int(0)
++ ["year"]=>
++ int(0)
++ ["dow"]=>
++ int(3)
++ ["abbrevdayname"]=>
++ string(3) "Wed"
++ ["dayname"]=>
++ string(9) "Wednesday"
++ ["abbrevmonth"]=>
++ string(0) ""
++ ["monthname"]=>
++ string(0) ""
++}
++
+Index: ext/calendar/julian.c
+===================================================================
+--- ext/calendar/julian.c (revision 306474)
++++ ext/calendar/julian.c (revision 306475)
+@@ -146,6 +146,7 @@
+ \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
+
+ #include "sdncal.h"
++#include
+
+ #define JULIAN\_SDN\_OFFSET 32083
+ #define DAYS\_PER\_5\_MONTHS 153
+@@ -164,15 +165,22 @@
+ int dayOfYear;
+
+ if (sdn <= 0) {
+- \*pYear = 0;
+- \*pMonth = 0;
+- \*pDay = 0;
+- return;
++ goto fail;
+ }
+- temp = (sdn + JULIAN\_SDN\_OFFSET) \* 4 - 1;
++ /\* Check for overflow \*/
++ if (sdn > (LONG\_MAX - JULIAN\_SDN\_OFFSET \* 4 + 1) / 4 || sdn < LONG\_MIN / 4) {
++ goto fail;
++ }
++ temp = sdn \* 4 + (JULIAN\_SDN\_OFFSET \* 4 - 1);
+
+ /\* Calculate the year and day of year (1 <= dayOfYear <= 366). \*/
+- year = temp / DAYS\_PER\_4\_YEARS;
++ {
++ long yearl = temp / DAYS\_PER\_4\_YEARS;
++ if (yearl > INT\_MAX || yearl < INT\_MIN) {
++ goto fail;
++ }
++ year = (int) yearl;
++ }
+ dayOfYear = (temp % DAYS\_PER\_4\_YEARS) / 4 + 1;
+
+ /\* Calculate the month and day of month. \*/
+@@ -196,6 +204,12 @@
+ \*pYear = year;
+ \*pMonth = month;
+ \*pDay = day;
++ return;
++
++fail:
++ \*pYear = 0;
++ \*pMonth = 0;
++ \*pDay = 0;
+ }
+
+ long int JulianToSdn(
--- php5-5.3.2.orig/debian/patches/php5-CVE-2010-3709.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2010-3709.patch
@@ -0,0 +1,24 @@
+Subject: fix Fixed NULL pointer dereference in ZipArchive::getArchiveComment
+Origin: http://svn.php.net/viewvc?view=revision&revision=304505
+
+CVE-2010-3709
+report & patch from Maksymilian Arciemowicz
+
+---
+ ext/zip/php\_zip.c | 3 +++
+ 1 file changed, 3 insertions(+)
+
+Index: b/ext/zip/php\_zip.c
+===================================================================
+--- a/ext/zip/php\_zip.c
++++ b/ext/zip/php\_zip.c
+@@ -1961,6 +1961,9 @@ static ZIPARCHIVE\_METHOD(getArchiveComme
+ }
+
+ comment = zip\_get\_archive\_comment(intern, &comment\_len, (int)flags);
++ if(comment==NULL) {
++ RETURN\_FALSE;
++ }
+ RETURN\_STRINGL((char \*)comment, (long)comment\_len, 1);
+ }
+ /\* }}} \*/
--- php5-5.3.2.orig/debian/patches/php5-CVE-2011-1148.patch
+++ php5-5.3.2/debian/patches/php5-CVE-2011-1148.patch
@@ -0,0 +1,199 @@
+Subject: fix bug #54238 (use-after-free in substr\_replace())
+Origin: http://svn.php.net/viewvc?view=revision&revision=310194
+
+CVE-2011-1148
+
+Patch differs from upstream commit in that added entry in NEWS file has
+been removed to reduce patch conflicts.
+
+Index: ext/standard/string.c
+===================================================================
+--- ext/standard/string.c (revision 310193)
++++ ext/standard/string.c (revision 310194)
+@@ -2352,20 +2352,35 @@
+
+ zend\_hash\_internal\_pointer\_reset\_ex(Z\_ARRVAL\_PP(str), &pos\_str);
+ while (zend\_hash\_get\_current\_data\_ex(Z\_ARRVAL\_PP(str), (void \*\*) &tmp\_str, &pos\_str) == SUCCESS) {
+- convert\_to\_string\_ex(tmp\_str);
++ zval \*orig\_str;
++ zval dummy;
++ if(Z\_TYPE\_PP(tmp\_str) != IS\_STRING) {
++ dummy = \*\*tmp\_str;
++ orig\_str = &dummy
++ zval\_copy\_ctor(orig\_str);
++ convert\_to\_string(orig\_str);
++ } else {
++ orig\_str = \*tmp\_str;
++ }
+
+ if (Z\_TYPE\_PP(from) == IS\_ARRAY) {
+ if (SUCCESS == zend\_hash\_get\_current\_data\_ex(Z\_ARRVAL\_PP(from), (void \*\*) &tmp\_from, &pos\_from)) {
+- convert\_to\_long\_ex(tmp\_from);
++ if(Z\_TYPE\_PP(tmp\_from) != IS\_LONG) {
++ zval dummy = \*\*tmp\_from;
++ zval\_copy\_ctor(&dummy);
++ convert\_to\_long(&dummy);
++ f = Z\_LVAL(dummy);
++ } else {
++ f = Z\_LVAL\_PP(tmp\_from);
++ }
+
+- f = Z\_LVAL\_PP(tmp\_from);
+ if (f < 0) {
+- f = Z\_STRLEN\_PP(tmp\_str) + f;
++ f = Z\_STRLEN\_P(orig\_str) + f;
+ if (f < 0) {
+ f = 0;
+ }
+- } else if (f > Z\_STRLEN\_PP(tmp\_str)) {
+- f = Z\_STRLEN\_PP(tmp\_str);
++ } else if (f > Z\_STRLEN\_P(orig\_str)) {
++ f = Z\_STRLEN\_P(orig\_str);
+ }
+ zend\_hash\_move\_forward\_ex(Z\_ARRVAL\_PP(from), &pos\_from);
+ } else {
+@@ -2374,72 +2389,94 @@
+ } else {
+ f = Z\_LVAL\_PP(from);
+ if (f < 0) {
+- f = Z\_STRLEN\_PP(tmp\_str) + f;
++ f = Z\_STRLEN\_P(orig\_str) + f;
+ if (f < 0) {
+ f = 0;
+ }
+- } else if (f > Z\_STRLEN\_PP(tmp\_str)) {
+- f = Z\_STRLEN\_PP(tmp\_str);
++ } else if (f > Z\_STRLEN\_P(orig\_str)) {
++ f = Z\_STRLEN\_P(orig\_str);
+ }
+ }
+
+ if (argc > 3 && Z\_TYPE\_PP(len) == IS\_ARRAY) {
+ if (SUCCESS == zend\_hash\_get\_current\_data\_ex(Z\_ARRVAL\_PP(len), (void \*\*) &tmp\_len, &pos\_len)) {
+- convert\_to\_long\_ex(tmp\_len);
++ if(Z\_TYPE\_PP(tmp\_len) != IS\_LONG) {
++ zval dummy = \*\*tmp\_len;
++ zval\_copy\_ctor(&dummy);
++ convert\_to\_long(&dummy);
++ l = Z\_LVAL(dummy);
++ } else {
++ l = Z\_LVAL\_PP(tmp\_len);
++ }
+
+ l = Z\_LVAL\_PP(tmp\_len);
+ zend\_hash\_move\_forward\_ex(Z\_ARRVAL\_PP(len), &pos\_len);
+ } else {
+- l = Z\_STRLEN\_PP(tmp\_str);
++ l = Z\_STRLEN\_P(orig\_str);
+ }
+ } else if (argc > 3) {
+ l = Z\_LVAL\_PP(len);
+ } else {
+- l = Z\_STRLEN\_PP(tmp\_str);
++ l = Z\_STRLEN\_P(orig\_str);
+ }
+
+ if (l < 0) {
+- l = (Z\_STRLEN\_PP(tmp\_str) - f) + l;
++ l = (Z\_STRLEN\_P(orig\_str) - f) + l;
+ if (l < 0) {
+ l = 0;
+ }
+ }
+
+- if ((f + l) > Z\_STRLEN\_PP(tmp\_str)) {
+- l = Z\_STRLEN\_PP(tmp\_str) - f;
++ if ((f + l) > Z\_STRLEN\_P(orig\_str)) {
++ l = Z\_STRLEN\_P(orig\_str) - f;
+ }
+
+- result\_len = Z\_STRLEN\_PP(tmp\_str) - l;
++ result\_len = Z\_STRLEN\_P(orig\_str) - l;
+
+ if (Z\_TYPE\_PP(repl) == IS\_ARRAY) {
+ if (SUCCESS == zend\_hash\_get\_current\_data\_ex(Z\_ARRVAL\_PP(repl), (void \*\*) &tmp\_repl, &pos\_repl)) {
+- convert\_to\_string\_ex(tmp\_repl);
+- result\_len += Z\_STRLEN\_PP(tmp\_repl);
++ zval \*repl\_str;
++ zval zrepl;
++ if(Z\_TYPE\_PP(tmp\_repl) != IS\_STRING) {
++ zrepl = \*\*tmp\_repl;
++ repl\_str = &zrepl
++ zval\_copy\_ctor(repl\_str);
++ convert\_to\_string(repl\_str);
++ } else {
++ repl\_str = \*tmp\_repl;
++ }
++
++ result\_len += Z\_STRLEN\_P(repl\_str);
+ zend\_hash\_move\_forward\_ex(Z\_ARRVAL\_PP(repl), &pos\_repl);
+ result = emalloc(result\_len + 1);
+
+- memcpy(result, Z\_STRVAL\_PP(tmp\_str), f);
+- memcpy((result + f), Z\_STRVAL\_PP(tmp\_repl), Z\_STRLEN\_PP(tmp\_repl));
+- memcpy((result + f + Z\_STRLEN\_PP(tmp\_repl)), Z\_STRVAL\_PP(tmp\_str) + f + l, Z\_STRLEN\_PP(tmp\_str) - f - l);
++ memcpy(result, Z\_STRVAL\_P(orig\_str), f);
++ memcpy((result + f), Z\_STRVAL\_P(repl\_str), Z\_STRLEN\_P(repl\_str));
++ memcpy((result + f + Z\_STRLEN\_P(repl\_str)), Z\_STRVAL\_P(orig\_str) + f + l, Z\_STRLEN\_P(orig\_str) - f - l);
++ if(Z\_TYPE\_PP(tmp\_repl) != IS\_STRING) {
++ zval\_dtor(repl\_str);
++ }
+ } else {
+ result = emalloc(result\_len + 1);
+
+- memcpy(result, Z\_STRVAL\_PP(tmp\_str), f);
+- memcpy((result + f), Z\_STRVAL\_PP(tmp\_str) + f + l, Z\_STRLEN\_PP(tmp\_str) - f - l);
++ memcpy(result, Z\_STRVAL\_P(orig\_str), f);
++ memcpy((result + f), Z\_STRVAL\_P(orig\_str) + f + l, Z\_STRLEN\_P(orig\_str) - f - l);
+ }
+ } else {
+ result\_len += Z\_STRLEN\_PP(repl);
+
+ result = emalloc(result\_len + 1);
+
+- memcpy(result, Z\_STRVAL\_PP(tmp\_str), f);
++ memcpy(result, Z\_STRVAL\_P(orig\_str), f);
+ memcpy((result + f), Z\_STRVAL\_PP(repl), Z\_STRLEN\_PP(repl));
+- memcpy((result + f + Z\_STRLEN\_PP(repl)), Z\_STRVAL\_PP(tmp\_str) + f + l, Z\_STRLEN\_PP(tmp\_str) - f - l);
++ memcpy((result + f + Z\_STRLEN\_PP(repl)), Z\_STRVAL\_P(orig\_str) + f + l, Z\_STRLEN\_P(orig\_str) - f - l);
+ }
+
+ result[result\_len] = '\0';
+ add\_next\_index\_stringl(return\_value, result, result\_len, 0);
+-
++ if(Z\_TYPE\_PP(tmp\_str) != IS\_STRING) {
++ zval\_dtor(orig\_str);
++ }
+ zend\_hash\_move\_forward\_ex(Z\_ARRVAL\_PP(str), &pos\_str);
+ } /\*while\*/
+ } /\* if \*/
+Index: ext/standard/tests/strings/bug54238.phpt
+===================================================================
+--- ext/standard/tests/strings/bug54238.phpt (revision 0)
++++ ext/standard/tests/strings/bug54238.phpt (revision 310194)
+@@ -0,0 +1,25 @@
++--TEST--
++Bug #54238 (use-after-free in substr\_replace())
++--INI--
++error\_reporting=E\_ALL&~E\_NOTICE
++--FILE--
++php
++$f = array(array('A', 'A'));
++
++$z = substr\_replace($f, $f, $f, 1);
++var\_dump($z, $f);
++?
++--EXPECT--
++array(1) {
++ [0]=>
++ string(9) "AArrayray"
++}
++array(1) {
++ [0]=>
++ array(2) {
++ [0]=>
++ string(1) "A"
++ [1]=>
++ string(1) "A"
++ }
++}
--- php5-5.3.2.orig/debian/patches/006-debian\_quirks.patch
+++ php5-5.3.2/debian/patches/006-debian\_quirks.patch
@@ -0,0 +1,222 @@
+Description: Changes to make php use versioned paths and other minor
+ cleanup changes.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- a/configure.in
++++ b/configure.in
+@@ -1005,7 +1005,7 @@ if test "$PHP\_CLI" = "no"; then
+ fi
+
+ PHP\_ARG\_WITH(pear, [whether to install PEAR],
+-[ --with-pear=DIR Install PEAR in DIR [PREFIX/lib/php]
++[ --with-pear=DIR Install PEAR in DIR [PREFIX/lib/php5]
+ --without-pear Do not install PEAR], DEFAULT, yes)
+
+ if test "$PHP\_PEAR" != "no"; then
+@@ -1035,7 +1035,7 @@ dnl
+ if test "$PHP\_PEAR" = "DEFAULT" || test "$PHP\_PEAR" = "yes"; then
+ case $PHP\_LAYOUT in
+ GNU) PEAR\_INSTALLDIR=$datadir/pear;;
+- \*) PEAR\_INSTALLDIR=$libdir/php;;
++ \*) PEAR\_INSTALLDIR=$libdir/php5;;
+ esac
+ fi
+
+@@ -1090,12 +1090,12 @@ test "$program\_suffix" = "NONE" && progr
+
+ case $libdir in
+ '${exec\_prefix}/lib')
+- libdir=$libdir/php
++ libdir=$libdir/php5
+ ;;
+ esac
+ case $datadir in
+ '${prefix}/share')
+- datadir=$datadir/php
++ datadir=$datadir/php5
+ ;;
+ esac
+
+@@ -1161,7 +1161,7 @@ EXPANDED\_SYSCONFDIR=`eval echo $sysconfd
+ EXPANDED\_DATADIR=$datadir
+ EXPANDED\_PHP\_CONFIG\_FILE\_PATH=`eval echo "$PHP\_CONFIG\_FILE\_PATH"`
+ EXPANDED\_PHP\_CONFIG\_FILE\_SCAN\_DIR=`eval echo "$PHP\_CONFIG\_FILE\_SCAN\_DIR"`
+-INCLUDE\_PATH=.:$EXPANDED\_PEAR\_INSTALLDIR
++INCLUDE\_PATH=.:$EXPANDED\_PEAR\_INSTALLDIR:/usr/share/pear
+
+ exec\_prefix=$old\_exec\_prefix
+ libdir=$old\_libdir
+--- a/ext/ext\_skel
++++ b/ext/ext\_skel
+@@ -70,7 +70,7 @@ if test -d "$extname" ; then
+ fi
+
+ if test -z "$skel\_dir"; then
+- skel\_dir="skeleton"
++ skel\_dir="/usr/lib/php5/skeleton"
+ fi
+
+ ## convert skel\_dir to full path
+--- a/php.ini-development
++++ b/php.ini-development
+@@ -781,7 +781,7 @@ default\_mimetype = "text/html"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+
+ ; UNIX: "/path1:/path2"
+-;include\_path = ".:/php/includes"
++;include\_path = ".:/usr/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include\_path = ".;c:\php\includes"
+--- a/php.ini-production
++++ b/php.ini-production
+@@ -781,7 +781,7 @@ default\_mimetype = "text/html"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+
+ ; UNIX: "/path1:/path2"
+-;include\_path = ".:/php/includes"
++;include\_path = ".:/usr/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include\_path = ".;c:\php\includes"
+@@ -938,53 +938,6 @@ default\_socket\_timeout = 60
+ ; If you only provide the name of the extension, PHP will look for it in its
+ ; default extension directory.
+ ;
+-; Windows Extensions
+-; Note that ODBC support is built in, so no dll is needed for it.
+-; Note that many DLL files are located in the extensions/ (PHP 4) ext/ (PHP 5)
+-; extension folders as well as the separate PECL DLL download (PHP 5).
+-; Be sure to appropriately set the extension\_dir directive.
+-;
+-;extension=php\_bz2.dll
+-;extension=php\_curl.dll
+-;extension=php\_dba.dll
+-;extension=php\_exif.dll
+-;extension=php\_fileinfo.dll
+-;extension=php\_gd2.dll
+-;extension=php\_gettext.dll
+-;extension=php\_gmp.dll
+-;extension=php\_intl.dll
+-;extension=php\_imap.dll
+-;extension=php\_interbase.dll
+-;extension=php\_ldap.dll
+-;extension=php\_mbstring.dll
+-;extension=php\_ming.dll
+-;extension=php\_mssql.dll
+-;extension=php\_mysql.dll
+-;extension=php\_mysqli.dll
+-;extension=php\_oci8.dll ; Use with Oracle 10gR2 Instant Client
+-;extension=php\_oci8\_11g.dll ; Use with Oracle 11g Instant Client
+-;extension=php\_openssl.dll
+-;extension=php\_pdo\_firebird.dll
+-;extension=php\_pdo\_mssql.dll
+-;extension=php\_pdo\_mysql.dll
+-;extension=php\_pdo\_oci.dll
+-;extension=php\_pdo\_odbc.dll
+-;extension=php\_pdo\_pgsql.dll
+-;extension=php\_pdo\_sqlite.dll
+-;extension=php\_pgsql.dll
+-;extension=php\_phar.dll
+-;extension=php\_pspell.dll
+-;extension=php\_shmop.dll
+-;extension=php\_snmp.dll
+-;extension=php\_soap.dll
+-;extension=php\_sockets.dll
+-;extension=php\_sqlite.dll
+-;extension=php\_sqlite3.dll
+-;extension=php\_sybase\_ct.dll
+-;extension=php\_tidy.dll
+-;extension=php\_xmlrpc.dll
+-;extension=php\_xsl.dll
+-;extension=php\_zip.dll
+
+ ;;;;;;;;;;;;;;;;;;;
+ ; Module Settings ;
+--- a/sapi/caudium/config.m4
++++ b/sapi/caudium/config.m4
+@@ -26,8 +26,8 @@ if test "$PHP\_CAUDIUM" != "no"; then
+ AC\_MSG\_ERROR([Could not find a pike in $PHP\_CAUDIUM/bin/])
+ fi
+ if $PIKE -e 'float v; int rel;sscanf(version(), "Pike v%f release %d", v, rel);v += rel/10000.0; if(v < 7.0268) exit(1); exit(0);'; then
+- PIKE\_MODULE\_DIR=`$PIKE --show-paths 2>&1| grep '^Module' | sed -e 's/.\*: //'`
+- PIKE\_INCLUDE\_DIR=`echo $PIKE\_MODULE\_DIR | sed -e 's,lib/pike/modules,include/pike,' -e 's,lib/modules,include/pike,' `
++ PIKE\_MODULE\_DIR=`$PIKE --show-paths 2>&1| grep '^Master file' | sed -e 's/.\*: //' -e 's/master.pike/modules/'`
++ PIKE\_INCLUDE\_DIR=`echo $PIKE\_MODULE\_DIR | sed -e 's,lib/modules,,' -e 's,modules,include,' `
+ if test -z "$PIKE\_INCLUDE\_DIR" || test -z "$PIKE\_MODULE\_DIR"; then
+ AC\_MSG\_ERROR(Failed to figure out Pike module and include directories)
+ fi
+@@ -84,7 +84,9 @@ if test "$PHP\_CAUDIUM" != "no"; then
+ PIKE\_VERSION=`$PIKE -e 'string v; int rel;sscanf(version(), "Pike v%s release %d", v, rel); write(v+"."+rel);'`
+ AC\_DEFINE(HAVE\_CAUDIUM,1,[Whether to compile with Caudium support])
+ PHP\_SELECT\_SAPI(caudium, shared, caudium.c)
+- INSTALL\_IT="\$(INSTALL) -m 0755 $SAPI\_SHARED $PHP\_CAUDIUM/lib/$PIKE\_VERSION/PHP5.so"
++ dnl FIXME: This is the ugliest hack in the world!
++ dnl INSTALL\_IT="\$(mkinstalldirs) \$(INSTALL\_ROOT)$PHP\_CAUDIUM/lib/$PIKE\_VERSION/ && \$(INSTALL) -m 0755 $SAPI\_SHARED \$(INSTALL\_ROOT)$PHP\_CAUDIUM/lib/$PIKE\_VERSION/php5.so"
++ INSTALL\_IT="\$(mkinstalldirs) \$(INSTALL\_ROOT)$PHP\_CAUDIUM/lib/$PIKE\_VERSION/ && \$(INSTALL) -m 0755 .$SAPI\_SHARED \$(INSTALL\_ROOT)$PHP\_CAUDIUM/lib/$PIKE\_VERSION/PHP5.so"
+ RESULT=" \*\*\* Pike binary used: $PIKE
+ \*\*\* Pike include dir(s) used: $PIKE\_INCLUDE\_DIR
+ \*\*\* Pike version: $PIKE\_VERSION"
+--- a/sapi/cli/php.1.in
++++ b/sapi/cli/php.1.in
+@@ -309,13 +309,14 @@ Shows configuration for extension
+ Show configuration file names
+ .SH FILES
+ .TP 15
+-.B php\-cli.ini
++.B /etc/php5/cli/php.ini
+ The configuration file for the CLI version of PHP.
+ .TP
+-.B php.ini
+-The standard configuration file will only be used when
+-.B php\-cli.ini
+-cannot be found.
++.B /etc/php5/cgi/php.ini
++The configuration file for the CGI version of PHP.
++.TP
++.B /etc/php5/apache2/php.ini
++The configuration file for the version of PHP that apache2 uses.
+ .SH EXAMPLES
+ .TP 5
+ \fIphp \-r 'echo "Hello World\\n";'\fP
+--- a/scripts/Makefile.frag
++++ b/scripts/Makefile.frag
+@@ -3,8 +3,8 @@
+ # Build environment install
+ #
+
+-phpincludedir = $(includedir)/php
+-phpbuilddir = $(libdir)/build
++phpincludedir = $(includedir)/php5
++phpbuilddir = $(prefix)/lib/php5/build
+
+ BUILD\_FILES = \
+ scripts/phpize.m4 \
+--- a/scripts/php-config.in
++++ b/scripts/php-config.in
+@@ -5,8 +5,8 @@ prefix="@prefix@"
+ exec\_prefix="@exec\_prefix@"
+ version="@PHP\_VERSION@"
+ vernum="@PHP\_VERSION\_ID@"
+-include\_dir="@includedir@/php"
+-includes="-I$include\_dir -I$include\_dir/main -I$include\_dir/TSRM -I$include\_dir/Zend -I$include\_dir/ext -I$include\_dir/ext/date/lib"
++include\_dir="@includedir@/php5"
++includes="-I$include\_dir -I$include\_dir/main -I$include\_dir/TSRM -I$include\_dir/Zend -I$include\_dir/ext -I$include\_dir/ext/date/lib $(getconf LFS\_CFLAGS)"
+ ldflags="@PHP\_LDFLAGS@"
+ libs="@EXTRA\_LIBS@"
+ extension\_dir='@EXTENSION\_DIR@'
+--- a/scripts/phpize.in
++++ b/scripts/phpize.in
+@@ -3,8 +3,8 @@
+ # Variable declaration
+ prefix='@prefix@'
+ exec\_prefix="`eval echo @exec\_prefix@`"
+-phpdir="`eval echo @libdir@`/build"
+-includedir="`eval echo @includedir@`/php"
++phpdir="$prefix/lib/php5/build"
++includedir="$prefix/include/php5"
+ builddir="`pwd`"
+ SED="@SED@"
+
--- php5-5.3.2.orig/debian/patches/001-libtool\_fixes.patch
+++ php5-5.3.2/debian/patches/001-libtool\_fixes.patch
@@ -0,0 +1,24 @@
+--- a/TSRM/configure.in
++++ b/TSRM/configure.in
+@@ -13,9 +13,6 @@ TSRM\_BASIC\_CHECKS
+ TSRM\_THREADS\_CHECKS
+
+ AM\_PROG\_LIBTOOL
+-if test "$enable\_debug" != "yes"; then
+- AM\_SET\_LIBTOOL\_VARIABLE([--silent])
+-fi
+
+ dnl TSRM\_PTHREAD
+
+--- a/configure.in
++++ b/configure.in
+@@ -1343,9 +1343,6 @@ AC\_PROVIDE\_IFELSE([PHP\_REQUIRE\_CXX], [],
+ ])
+ AC\_PROG\_LIBTOOL
+
+-if test "$enable\_debug" != "yes"; then
+- PHP\_SET\_LIBTOOL\_VARIABLE([--silent])
+-fi
+
+ dnl libtool 1.4.3 needs this.
+ PHP\_SET\_LIBTOOL\_VARIABLE([--preserve-dup-deps])
--- php5-5.3.2.orig/debian/patches/gentoo/117-4\_digit\_year\_big\_endian.patch
+++ php5-5.3.2/debian/patches/gentoo/117-4\_digit\_year\_big\_endian.patch
@@ -0,0 +1,11 @@
+--- pkg-php.orig/ext/date/php\_date.c
++++ pkg-php/ext/date/php\_date.c
+@@ -803,7 +803,7 @@ static char \*date\_format(char \*format, i
+ /\* year \*/
+ case 'L': length = slprintf(buffer, 32, "%d", timelib\_is\_leap((int) t->y)); break;
+ case 'y': length = slprintf(buffer, 32, "%02d", (int) t->y % 100); break;
+- case 'Y': length = slprintf(buffer, 32, "%s%04ld", t->y < 0 ? "-" : "", llabs(t->y)); break;
++ case 'Y': length = slprintf(buffer, 32, "%s%04lld", t->y < 0 ? "-" : "", llabs(t->y)); break;
+
+ /\* time \*/
+ case 'a': length = slprintf(buffer, 32, "%s", t->h >= 12 ? "pm" : "am"); break;
--- php5-5.3.2.orig/debian/patches/gentoo/009\_ob-memory-leaks.patch
+++ php5-5.3.2/debian/patches/gentoo/009\_ob-memory-leaks.patch
@@ -0,0 +1,33 @@
+009\_ob-memory-leaks.patch
+PHP\_5\_2
+http://cvs.php.net/viewvc.cgi/php-src/main/output.c?r1=1.167.2.3.2.8&r2=1.167.2.3.2.9&diff\_format=u
+Fixed memory leak in ob\_get\_clean/ob\_get\_flush.
+
+--- a/main/output.c
++++ b/main/output.c
+@@ -816,10 +816,12 @@ PHP\_FUNCTION(ob\_end\_flush)
+
+ if (!OG(ob\_nesting\_level)) {
+ php\_error\_docref("ref.outcontrol" TSRMLS\_CC, E\_NOTICE, "failed to delete and flush buffer. No buffer to delete or flush.");
++ zval\_dtor(return\_value);
+ RETURN\_FALSE;
+ }
+ if (OG(ob\_nesting\_level) && !OG(active\_ob\_buffer).status && !OG(active\_ob\_buffer).erase) {
+ php\_error\_docref("ref.outcontrol" TSRMLS\_CC, E\_NOTICE, "failed to delete buffer %s.", OG(active\_ob\_buffer).handler\_name);
++ zval\_dtor(return\_value);
+ RETURN\_FALSE;
+ }
+
+@@ -838,10 +840,12 @@ PHP\_FUNCTION(ob\_end\_clean)
+
+ if (!OG(ob\_nesting\_level)) {
+ php\_error\_docref("ref.outcontrol" TSRMLS\_CC, E\_NOTICE, "failed to delete buffer. No buffer to delete.");
++ zval\_dtor(return\_value);
+ RETURN\_FALSE;
+ }
+ if (OG(ob\_nesting\_level) && !OG(active\_ob\_buffer).status && !OG(active\_ob\_buffer).erase) {
+ php\_error\_docref("ref.outcontrol" TSRMLS\_CC, E\_NOTICE, "failed to delete buffer %s.", OG(active\_ob\_buffer).handler\_name);
++ zval\_dtor(return\_value);
+ RETURN\_FALSE;
+ }
+


=== Content from bugzilla.novell.com_0bb1639e_20250126_100726.html ===




=== Content from www.redhat.com_948459ca_20250126_100758.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.novell.com_d17cf78a_20250126_100713.html ===




=== Content from www.redhat.com_3ad1e2b5_20250126_100758.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.novell.com_bf600811_20250126_100741.html ===




=== Content from bugzilla.novell.com_90768e56_20250126_100719.html ===




=== Content from lists.opensuse.org_1fe5c5fe_20250125_160224.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/#KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS)

# [security-announce] openSUSE-SU-2012:0426-1: important: update for php5

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

29 Mar
2012

29 Mar
'12

13:08

openSUSE Security Update: update for php5
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2012:0426-1
Rating: important
References: #728671 #733590 #736169 #738221 #741520 #741859
#742273 #742806 #743308 #744966 #746661 #749111
Cross-References: CVE-2011-1466 CVE-2011-4153 CVE-2011-4566
CVE-2011-4885 CVE-2012-0057 CVE-2012-0781
CVE-2012-0788 CVE-2012-0789 CVE-2012-0807
CVE-2012-0830 CVE-2012-0831
Affected Products:
openSUSE 12.1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves 11 vulnerabilities and has one errata
is now available.
Description:
php5 security update
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.1:
zypper in -t patch openSUSE-2012-182
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.1 (i586 x86\_64):
apache2-mod\_php5-5.3.8-4.9.2
apache2-mod\_php5-debuginfo-5.3.8-4.9.2
php5-5.3.8-4.9.2
php5-bcmath-5.3.8-4.9.2
php5-bcmath-debuginfo-5.3.8-4.9.2
php5-bz2-5.3.8-4.9.2
php5-bz2-debuginfo-5.3.8-4.9.2
php5-calendar-5.3.8-4.9.2
php5-calendar-debuginfo-5.3.8-4.9.2
php5-ctype-5.3.8-4.9.2
php5-ctype-debuginfo-5.3.8-4.9.2
php5-curl-5.3.8-4.9.2
php5-curl-debuginfo-5.3.8-4.9.2
php5-dba-5.3.8-4.9.2
php5-dba-debuginfo-5.3.8-4.9.2
php5-debuginfo-5.3.8-4.9.2
php5-debugsource-5.3.8-4.9.2
php5-devel-5.3.8-4.9.2
php5-dom-5.3.8-4.9.2
php5-dom-debuginfo-5.3.8-4.9.2
php5-enchant-5.3.8-4.9.2
php5-enchant-debuginfo-5.3.8-4.9.2
php5-exif-5.3.8-4.9.2
php5-exif-debuginfo-5.3.8-4.9.2
php5-fastcgi-5.3.8-4.9.2
php5-fastcgi-debuginfo-5.3.8-4.9.2
php5-fileinfo-5.3.8-4.9.2
php5-fileinfo-debuginfo-5.3.8-4.9.2
php5-fpm-5.3.8-4.9.2
php5-fpm-debuginfo-5.3.8-4.9.2
php5-ftp-5.3.8-4.9.2
php5-ftp-debuginfo-5.3.8-4.9.2
php5-gd-5.3.8-4.9.2
php5-gd-debuginfo-5.3.8-4.9.2
php5-gettext-5.3.8-4.9.2
php5-gettext-debuginfo-5.3.8-4.9.2
php5-gmp-5.3.8-4.9.2
php5-gmp-debuginfo-5.3.8-4.9.2
php5-iconv-5.3.8-4.9.2
php5-iconv-debuginfo-5.3.8-4.9.2
php5-imap-5.3.8-4.9.2
php5-imap-debuginfo-5.3.8-4.9.2
php5-intl-5.3.8-4.9.2
php5-intl-debuginfo-5.3.8-4.9.2
php5-json-5.3.8-4.9.2
php5-json-debuginfo-5.3.8-4.9.2
php5-ldap-5.3.8-4.9.2
php5-ldap-debuginfo-5.3.8-4.9.2
php5-mbstring-5.3.8-4.9.2
php5-mbstring-debuginfo-5.3.8-4.9.2
php5-mcrypt-5.3.8-4.9.2
php5-mcrypt-debuginfo-5.3.8-4.9.2
php5-mssql-5.3.8-4.9.2
php5-mssql-debuginfo-5.3.8-4.9.2
php5-mysql-5.3.8-4.9.2
php5-mysql-debuginfo-5.3.8-4.9.2
php5-odbc-5.3.8-4.9.2
php5-odbc-debuginfo-5.3.8-4.9.2
php5-openssl-5.3.8-4.9.2
php5-openssl-debuginfo-5.3.8-4.9.2
php5-pcntl-5.3.8-4.9.2
php5-pcntl-debuginfo-5.3.8-4.9.2
php5-pdo-5.3.8-4.9.2
php5-pdo-debuginfo-5.3.8-4.9.2
php5-pgsql-5.3.8-4.9.2
php5-pgsql-debuginfo-5.3.8-4.9.2
php5-phar-5.3.8-4.9.2
php5-phar-debuginfo-5.3.8-4.9.2
php5-posix-5.3.8-4.9.2
php5-posix-debuginfo-5.3.8-4.9.2
php5-pspell-5.3.8-4.9.2
php5-pspell-debuginfo-5.3.8-4.9.2
php5-readline-5.3.8-4.9.2
php5-readline-debuginfo-5.3.8-4.9.2
php5-shmop-5.3.8-4.9.2
php5-shmop-debuginfo-5.3.8-4.9.2
php5-snmp-5.3.8-4.9.2
php5-snmp-debuginfo-5.3.8-4.9.2
php5-soap-5.3.8-4.9.2
php5-soap-debuginfo-5.3.8-4.9.2
php5-sockets-5.3.8-4.9.2
php5-sockets-debuginfo-5.3.8-4.9.2
php5-sqlite-5.3.8-4.9.2
php5-sqlite-debuginfo-5.3.8-4.9.2
php5-suhosin-5.3.8-4.9.2
php5-suhosin-debuginfo-5.3.8-4.9.2
php5-sysvmsg-5.3.8-4.9.2
php5-sysvmsg-debuginfo-5.3.8-4.9.2
php5-sysvsem-5.3.8-4.9.2
php5-sysvsem-debuginfo-5.3.8-4.9.2
php5-sysvshm-5.3.8-4.9.2
php5-sysvshm-debuginfo-5.3.8-4.9.2
php5-tidy-5.3.8-4.9.2
php5-tidy-debuginfo-5.3.8-4.9.2
php5-tokenizer-5.3.8-4.9.2
php5-tokenizer-debuginfo-5.3.8-4.9.2
php5-wddx-5.3.8-4.9.2
php5-wddx-debuginfo-5.3.8-4.9.2
php5-xmlreader-5.3.8-4.9.2
php5-xmlreader-debuginfo-5.3.8-4.9.2
php5-xmlrpc-5.3.8-4.9.2
php5-xmlrpc-debuginfo-5.3.8-4.9.2
php5-xmlwriter-5.3.8-4.9.2
php5-xmlwriter-debuginfo-5.3.8-4.9.2
php5-xsl-5.3.8-4.9.2
php5-xsl-debuginfo-5.3.8-4.9.2
php5-zip-5.3.8-4.9.2
php5-zip-debuginfo-5.3.8-4.9.2
php5-zlib-5.3.8-4.9.2
php5-zlib-debuginfo-5.3.8-4.9.2
- openSUSE 12.1 (noarch):
php5-pear-5.3.8-4.9.2
References:
<http://support.novell.com/security/cve/CVE-2011-1466.html>
<http://support.novell.com/security/cve/CVE-2011-4153.html>
<http://support.novell.com/security/cve/CVE-2011-4566.html>
<http://support.novell.com/security/cve/CVE-2011-4885.html>
<http://support.novell.com/security/cve/CVE-2012-0057.html>
<http://support.novell.com/security/cve/CVE-2012-0781.html>
<http://support.novell.com/security/cve/CVE-2012-0788.html>
<http://support.novell.com/security/cve/CVE-2012-0789.html>
<http://support.novell.com/security/cve/CVE-2012-0807.html>
<http://support.novell.com/security/cve/CVE-2012-0830.html>
<http://support.novell.com/security/cve/CVE-2012-0831.html>
<https://bugzilla.novell.com/728671>
<https://bugzilla.novell.com/733590>
<https://bugzilla.novell.com/736169>
<https://bugzilla.novell.com/738221>
<https://bugzilla.novell.com/741520>
<https://bugzilla.novell.com/741859>
<https://bugzilla.novell.com/742273>
<https://bugzilla.novell.com/742806>
<https://bugzilla.novell.com/743308>
<https://bugzilla.novell.com/744966>
<https://bugzilla.novell.com/746661>
<https://bugzilla.novell.com/749111>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS/#KJSJBSOKDO7W7IDUBU2VKG3HBHQEXLBS)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.ubuntu.com_daa224b4_20250125_160233.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1358-1: PHP vulnerabilities

10 February 2012

Multiple vulnerabilities in PHP.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 11.10](/security/notices?release=oneiric)
* [Ubuntu 11.04](/security/notices?release=natty)
* [Ubuntu 10.10](/security/notices?release=maverick)
* [Ubuntu 10.04](/security/notices?release=lucid)
* [Ubuntu 8.04](/security/notices?release=hardy)

## Packages

* [php5](/security/cves?package=php5) - HTML-embedded scripting language interpreter

## Details

It was discovered that PHP computed hash values for form parameters

without restricting the ability to trigger hash collisions predictably.

This could allow a remote attacker to cause a denial of service by

sending many crafted parameters. ([CVE-2011-4885](/security/CVE-2011-4885))

ATTENTION: this update changes previous PHP behavior by

limiting the number of external input variables to 1000.

This may be increased by adding a "max\_input\_vars"

directive to the php.ini configuration file. See

<http://www.php.net/manual/en/info.configuration.php#ini.max-input-vars>

for more information.

Stefan Esser discovered that the fix to address the predictable hash

collision issue, [CVE-2011-4885](/security/CVE-2011-4885), did not properly handle the situation

where the limit was reached. This could allow a remote attacker to

cause a denial of service or execute arbitrary code via a request

containing a large number of variables. ([CVE-2012-0830](/security/CVE-2012-0830))

It was discovered that PHP did not always check the return value of

the zend\_strndup function. This could allow a remote attacker to

cause a denial of service. ([CVE-2011-4153](/security/CVE-2011-4153))

It was discovered that PHP did not properly enforce libxslt security

settings. This could allow a remote attacker to create arbitrary

files via a crafted XSLT stylesheet that uses the libxslt output

extension. ([CVE-2012-0057](/security/CVE-2012-0057))

It was discovered that PHP did not properly enforce that PDORow

objects could not be serialized and not be saved in a session. A

remote attacker could use this to cause a denial of service via an

application crash. ([CVE-2012-0788](/security/CVE-2012-0788))

It was discovered that PHP allowed the magic\_quotes\_gpc setting to

be disabled remotely. This could allow a remote attacker to bypass

restrictions that could prevent an SQL injection. ([CVE-2012-0831](/security/CVE-2012-0831))

USN 1126-1 addressed an issue where the /etc/cron.d/php5 cron job

for PHP allowed local users to delete arbitrary files via a symlink

attack on a directory under /var/lib/php5/. Emese Revfy discovered

that the fix had not been applied to PHP for Ubuntu 10.04 LTS. This

update corrects the issue. We apologize for the error. ([CVE-2011-0441](/security/CVE-2011-0441))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 8.04

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.2.4-2ubuntu5.22](https://launchpad.net/ubuntu/%2Bsource/php5/5.2.4-2ubuntu5.22)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.2.4-2ubuntu5.22](https://launchpad.net/ubuntu/%2Bsource/php5/5.2.4-2ubuntu5.22)
* [php5-common](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.2.4-2ubuntu5.22](https://launchpad.net/ubuntu/%2Bsource/php5/5.2.4-2ubuntu5.22)
* [php5-xsl](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.2.4-2ubuntu5.22](https://launchpad.net/ubuntu/%2Bsource/php5/5.2.4-2ubuntu5.22)
* [php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.2.4-2ubuntu5.22](https://launchpad.net/ubuntu/%2Bsource/php5/5.2.4-2ubuntu5.22)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.2.4-2ubuntu5.22](https://launchpad.net/ubuntu/%2Bsource/php5/5.2.4-2ubuntu5.22)

##### Ubuntu 11.10

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.6-13ubuntu3.5](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.6-13ubuntu3.5)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.6-13ubuntu3.5](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.6-13ubuntu3.5)
* [php5-common](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.6-13ubuntu3.5](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.6-13ubuntu3.5)
* [php5-xsl](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.6-13ubuntu3.5](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.6-13ubuntu3.5)
* [php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.6-13ubuntu3.5](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.6-13ubuntu3.5)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.6-13ubuntu3.5](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.6-13ubuntu3.5)

##### Ubuntu 11.04

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.5-1ubuntu7.6](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.5-1ubuntu7.6)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.5-1ubuntu7.6](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.5-1ubuntu7.6)
* [php5-common](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.5-1ubuntu7.6](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.5-1ubuntu7.6)
* [php5-xsl](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.5-1ubuntu7.6](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.5-1ubuntu7.6)
* [php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.5-1ubuntu7.6](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.5-1ubuntu7.6)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.5-1ubuntu7.6](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.5-1ubuntu7.6)

##### Ubuntu 10.10

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.3-1ubuntu9.9](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.3-1ubuntu9.9)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.3-1ubuntu9.9](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.3-1ubuntu9.9)
* [php5-common](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.3-1ubuntu9.9](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.3-1ubuntu9.9)
* [php5-xsl](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.3-1ubuntu9.9](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.3-1ubuntu9.9)
* [php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.3-1ubuntu9.9](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.3-1ubuntu9.9)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.3-1ubuntu9.9](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.3-1ubuntu9.9)

##### Ubuntu 10.04

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.13](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.13](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13)
* [php5-common](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.13](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13)
* [php5-xsl](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.13](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13)
* [php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.13](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.13](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.13)

In general, a standard system update will make all the necessary changes.

## References

* [CVE-2012-0831](/security/CVE-2012-0831)
* [CVE-2011-4153](/security/CVE-2011-4153)
* [CVE-2012-0830](/security/CVE-2012-0830)
* [CVE-2012-0057](/security/CVE-2012-0057)
* [CVE-2012-0788](/security/CVE-2012-0788)
* [CVE-2011-4885](/security/CVE-2011-4885)
* [CVE-2011-0441](/security/CVE-2011-0441)

## Related notices

* [USN-1126-1](/security/notices/USN-1126-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from rhn.redhat.com_59fddf4b_20250125_160224.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2013:1307 - Security Advisory

Issued:
2013-09-30
Updated:
2013-09-30
# RHSA-2013:1307 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: php53 security, bug fix and enhancement update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2013%3A1307)

## Topic

Updated php53 packages that fix multiple security issues, several bugs, and
add one enhancement are now available for Red Hat Enterprise Linux 5.

The Red Hat Security Response Team has rated this update as having moderate
security impact. Common Vulnerability Scoring System (CVSS) base scores,
which give detailed severity ratings, are available for each vulnerability
from the CVE links in the References section.

## Description

PHP is an HTML-embedded scripting language commonly used with the Apache
HTTP Server.

It was found that PHP did not properly handle file names with a NULL
character. A remote attacker could possibly use this flaw to make a PHP
script access unexpected files and bypass intended file system access
restrictions. (CVE-2006-7243)

It was found that PHP did not check for carriage returns in HTTP headers,
allowing intended HTTP response splitting protections to be bypassed.
Depending on the web browser the victim is using, a remote attacker could
use this flaw to perform HTTP response splitting attacks. (CVE-2011-1398)

A flaw was found in PHP's SSL client's hostname identity check when
handling certificates that contain hostnames with NULL bytes. If an
attacker was able to get a carefully crafted certificate signed by a
trusted Certificate Authority, the attacker could use the certificate to
conduct man-in-the-middle attacks to spoof SSL servers. (CVE-2013-4248)

An integer signedness issue, leading to a heap-based buffer underflow, was
found in the PHP scandir() function. If a remote attacker could upload an
excessively large number of files to a directory the scandir() function
runs on, it could cause the PHP interpreter to crash or, possibly, execute
arbitrary code. (CVE-2012-2688)

It was found that PHP did not correctly handle the magic\_quotes\_gpc
configuration directive. This could result in magic\_quotes\_gpc input
escaping not being applied in all cases, possibly making it easier for a
remote attacker to perform SQL injection attacks. (CVE-2012-0831)

It was found that the PHP SOAP parser allowed the expansion of external XML
entities during SOAP message parsing. A remote attacker could possibly use
this flaw to read arbitrary files that are accessible to a PHP application
using a SOAP extension. (CVE-2013-1643)

These updated php53 packages also include numerous bug fixes and
enhancements. Space precludes documenting all of these changes in this
advisory. Users are directed to the Red Hat Enterprise Linux 5.10 Technical
Notes, linked to in the References, for information on the most significant
of these changes.

All PHP users are advised to upgrade to these updated packages, which
contain backported patches to correct these issues and add this
enhancement. After installing the updated packages, the httpd daemon must
be restarted for the update to take effect.

## Solution

Before applying this update, make sure all previously released errata
relevant to your system have been applied.

This update is available via the Red Hat Network. Details on how to use the
Red Hat Network to apply this update are available at
<https://access.redhat.com/site/articles/11258>

## Affected Products

* Red Hat Enterprise Linux Server 5 x86\_64
* Red Hat Enterprise Linux Server 5 ia64
* Red Hat Enterprise Linux Server 5 i386
* Red Hat Enterprise Linux Workstation 5 x86\_64
* Red Hat Enterprise Linux Workstation 5 i386
* Red Hat Enterprise Linux for IBM z Systems 5 s390x
* Red Hat Enterprise Linux for Power, big endian 5 ppc
* Red Hat Enterprise Linux Server from RHUI 5 x86\_64
* Red Hat Enterprise Linux Server from RHUI 5 i386

## Fixes

* [BZ - 662707](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=662707)
  - CVE-2006-7243 php: paths with NULL character were considered valid
* [BZ - 789468](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=789468)
  - CVE-2012-0831 php: PG(magic\_quote\_gpc) was not restored on shutdown
* [BZ - 828051](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=828051)
  - CVE-2012-2688 php: Integer Signedness issues in \_php\_stream\_scandir
* [BZ - 837044](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=837044)
  - add php(language) virtual provide
* [BZ - 853329](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=853329)
  - CVE-2011-1398 PHP: sapi\_header\_op() %0D sequence handling security bypass
* [BZ - 869691](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=869691)
  - setDate, setISODate, setTime works wrong when DateTime created from timestamp
* [BZ - 869693](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=869693)
  - PDOStatement execute segfaults for pdo\_mysql driver
* [BZ - 869697](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=869697)
  - fileinfo extension: use stat function from stream wrapper
* [BZ - 892695](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=892695)
  - $this becomes a non-object
* [BZ - 918187](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=918187)
  - CVE-2013-1643 php: Ability to read arbitrary files due use of external entities while parsing SOAP WSDL files
* [BZ - 951075](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=951075)
  - Apache 2.2.15 on RHEL 6.3 segfaults with certain PHP content
* [BZ - 953818](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=953818)
  - Bad memset call in libzip
* [BZ - 997097](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=997097)
  - CVE-2013-4248 php: hostname check bypassing vulnerability in SSL client

## CVEs

* [CVE-2011-1398](https://www.redhat.com/security/data/cve/CVE-2011-1398.html)
* [CVE-2012-2688](https://www.redhat.com/security/data/cve/CVE-2012-2688.html)
* [CVE-2012-0831](https://www.redhat.com/security/data/cve/CVE-2012-0831.html)
* [CVE-2006-7243](https://www.redhat.com/security/data/cve/CVE-2006-7243.html)
* [CVE-2013-1643](https://www.redhat.com/security/data/cve/CVE-2013-1643.html)
* [CVE-2013-4248](https://www.redhat.com/security/data/cve/CVE-2013-4248.html)

## References

* <https://access.redhat.com/security/updates/classification/#moderate>
* <https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/5.10_Technical_Notes/php53.html#RHSA-2013-1307>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat Enterprise Linux Server 5

| SRPM | |
| --- | --- |
| php53-5.3.3-21.el5.src.rpm | SHA-256: 76e480455b7c7d8e3b76ce5011287ee504a7c8e00cbf088cd587f906b22b892f |
| x86\_64 | |
| php53-5.3.3-21.el5.x86\_64.rpm | SHA-256: f27ba8b5e21e9c74ba662a5c139c318593d2736975645b1f46be3be744702222 |
| php53-bcmath-5.3.3-21.el5.x86\_64.rpm | SHA-256: 3b9ce5979be87c73f4349f785595b0a18c8fa1101993c59b3db9f738f74888c3 |
| php53-cli-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0568da184172cfd4a2197506f9bac2032ba3df78f7fc0b52f3daac85ce866608 |
| php53-common-5.3.3-21.el5.x86\_64.rpm | SHA-256: 07dd16c392501282f32984f74addd8ce536337500debd7e1ea32be2a2ac71d77 |
| php53-dba-5.3.3-21.el5.x86\_64.rpm | SHA-256: 7ad4223f77085bf1992eb6badc160576ad75b862c2e4d72221667e191996dc87 |
| php53-debuginfo-5.3.3-21.el5.x86\_64.rpm | SHA-256: 46920934b77528f5bd1d330f5ffee785d7b6e71b3274699f4109b68ca20fb367 |
| php53-devel-5.3.3-21.el5.x86\_64.rpm | SHA-256: f8dac1a6ae515035078528d276309555dabaf05ca265dafca7634b925bd13b77 |
| php53-gd-5.3.3-21.el5.x86\_64.rpm | SHA-256: 5c36c0793560f47325400b6260625689173f3cdf2fd50e2b39e733a4daf53a36 |
| php53-imap-5.3.3-21.el5.x86\_64.rpm | SHA-256: 3ee20378ac73cf40b2c8635d74c57b375e709c7844835e6fa7604d99f38a42ad |
| php53-intl-5.3.3-21.el5.x86\_64.rpm | SHA-256: 6b557c47f28a111c8d1a2765fcdc2db48a4c62b070b6f71de827c18c13064a69 |
| php53-ldap-5.3.3-21.el5.x86\_64.rpm | SHA-256: 5d5220ef4c7b3786c343847f0bd136dae11b31714c2b024b8462dffe99131bba |
| php53-mbstring-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0e58a4715af8e6e95c080b42abba05757b38dd83aeeb36ba08117d9512fa3408 |
| php53-mysql-5.3.3-21.el5.x86\_64.rpm | SHA-256: 044f81f6489059de1b08d9e7ed2b4d194878dd71f92ae5a78f96ba5665bde1b9 |
| php53-odbc-5.3.3-21.el5.x86\_64.rpm | SHA-256: 1afdb4bf954bf45a3b6b7a6dad7e01dc40a7a4b862ce28da3ee800c224bf2d8b |
| php53-pdo-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0f9ab82c304ce4bc129f7bc356ed54a4ffa79915e829354eeb3c19a377e08df7 |
| php53-pgsql-5.3.3-21.el5.x86\_64.rpm | SHA-256: 2d3d47972a728025a85aee07a6be524f7adf68c266a3ad4732e3831de0afaa19 |
| php53-process-5.3.3-21.el5.x86\_64.rpm | SHA-256: 42bd88365ce59d894e0372e60c822bc816c3eea5e301ff4c89842380f20bed8a |
| php53-pspell-5.3.3-21.el5.x86\_64.rpm | SHA-256: 03513841d0cde54c347f2f4321660877ea6d37356e5721d5f4780c14495669a8 |
| php53-snmp-5.3.3-21.el5.x86\_64.rpm | SHA-256: cd6b83e8a615fb7e60eeb95211021f6bceb85e9286caccccb6c0263c1f1a6c37 |
| php53-soap-5.3.3-21.el5.x86\_64.rpm | SHA-256: b8d5589cc1cef0a95b23fa293d76e05119b423b620d66494b5ec98d96cdc8f7f |
| php53-xml-5.3.3-21.el5.x86\_64.rpm | SHA-256: 6026ed4ca12f87a832423a17f0683707266345adf5620e8ae179b93901682074 |
| php53-xmlrpc-5.3.3-21.el5.x86\_64.rpm | SHA-256: 8289babeb3598ae18d296e2cf84d78e1f239eb82a9a1fa9dc4978350d85a4eda |
| ia64 | |
| php53-5.3.3-21.el5.ia64.rpm | SHA-256: 94aca06169151ad50d756a4c98f1476db328466d995aa6dc8014f78e612015da |
| php53-bcmath-5.3.3-21.el5.ia64.rpm | SHA-256: 2f1b9161eb13c223cab7d18c4b80f236a3be74167d2c226f070bb00d24400984 |
| php53-cli-5.3.3-21.el5.ia64.rpm | SHA-256: 098f9f0bb14d2caca135d379da0d71361029f75a6c28b70c8af340fd46a0c52b |
| php53-common-5.3.3-21.el5.ia64.rpm | SHA-256: f34f2ab9cedce499fee78e8e89196a00fa11c2303ad87091d40b3b602808ca7a |
| php53-dba-5.3.3-21.el5.ia64.rpm | SHA-256: 5ed50f4191b3473ef4bdab6e1bce95bde80d4483c54d060efc6f2218df73ff00 |
| php53-debuginfo-5.3.3-21.el5.ia64.rpm | SHA-256: fa929a416b761b355405dacb4425e539b9181dccf099d94e6dbb8e16d1c17359 |
| php53-devel-5.3.3-21.el5.ia64.rpm | SHA-256: e79cb792533f735740964aebd6f0af55b4d4ee2ae05aa90cfbf6c3310fb80c90 |
| php53-gd-5.3.3-21.el5.ia64.rpm | SHA-256: 2b80da4e08f77b9a68f3ed045d3e61459251bfd09da343b7157480f83caea522 |
| php53-imap-5.3.3-21.el5.ia64.rpm | SHA-256: e836eca6ddafa2188d88597411f17f0642ad3f3641da18276fba6a6fd388da84 |
| php53-intl-5.3.3-21.el5.ia64.rpm | SHA-256: 7d9c5ee554071e6d10bbbc6a757cc106b31ee339dc56ad2e247263b7e231fb9c |
| php53-ldap-5.3.3-21.el5.ia64.rpm | SHA-256: 4ee38ee0afcbadf1a3c70f613f5ef30ce112903e7c2e714794438f9cfc673b35 |
| php53-mbstring-5.3.3-21.el5.ia64.rpm | SHA-256: c3f2532411547dfcc6e8e13f667e70d0747d9a65453e37ee5c36ed53c37e7793 |
| php53-mysql-5.3.3-21.el5.ia64.rpm | SHA-256: 252b3f35f44ec244a0ea673fbbec990ece0ae75205b5ec1c00cc521899748738 |
| php53-odbc-5.3.3-21.el5.ia64.rpm | SHA-256: bf4d39933ad8a899c084c54f334f4f22f4e8465f9370c6bda3d459d923d4306c |
| php53-pdo-5.3.3-21.el5.ia64.rpm | SHA-256: 1a724094b32779e75ab351a7a657d7ff12c22f9c27e01e409b80c8abb5619dc7 |
| php53-pgsql-5.3.3-21.el5.ia64.rpm | SHA-256: 5321abcf85cbed63c16b0e51e268ea229bdad90f277caefc4146ba4efb4ba9c2 |
| php53-process-5.3.3-21.el5.ia64.rpm | SHA-256: e4629bbf314f94e61dc4c4933512b9bbcc43be8ecccf2624fb776e0300c200f8 |
| php53-pspell-5.3.3-21.el5.ia64.rpm | SHA-256: fc8bcf7123f93453f6dc6c0f9b2c2f924f4c57413523938703e69c1b0bbae4be |
| php53-snmp-5.3.3-21.el5.ia64.rpm | SHA-256: 733d0b77f854dc1b2204e56c46c698cda53562d31e29ba67830f3a807a64c00a |
| php53-soap-5.3.3-21.el5.ia64.rpm | SHA-256: ddd9884c5b6eea60690c2ae894d7982d45d1a40b1f08a4d48a13b467c60cf1d2 |
| php53-xml-5.3.3-21.el5.ia64.rpm | SHA-256: d844060bc0872ae30414258c9026cf0e670effd3f732e78450a1535bc99bf798 |
| php53-xmlrpc-5.3.3-21.el5.ia64.rpm | SHA-256: 39cdd24806651c889bbc2e1dc2507383aa82d30993245379e9364d99309d6955 |
| i386 | |
| php53-5.3.3-21.el5.i386.rpm | SHA-256: 79296024d45cb8d9c095de4b303969beeac81afad211890b11d5ed2e18fe4b4f |
| php53-bcmath-5.3.3-21.el5.i386.rpm | SHA-256: cf1c95ccc23e14badf54c9eff0400aafb2044b6314ebd0190555f4c70d17de33 |
| php53-cli-5.3.3-21.el5.i386.rpm | SHA-256: d47ae4e7339a14cdf3455bfc7bc6b165d90249422cf6d35611c3ae1a8b455b35 |
| php53-common-5.3.3-21.el5.i386.rpm | SHA-256: 464f01627f68254b5c7581600b5f6660d0301e9ecf86043705edc010517a5f45 |
| php53-dba-5.3.3-21.el5.i386.rpm | SHA-256: 41f445c1ce5acc840f5ca1bbf6fad75bd0bab7e2e6b9424668f0e9cede4d8b05 |
| php53-debuginfo-5.3.3-21.el5.i386.rpm | SHA-256: 14c7149dce8146713998bef44ace023c2f9917c59bd36f67b3ee2c02384088f1 |
| php53-devel-5.3.3-21.el5.i386.rpm | SHA-256: 545848e142e54d16f21ccb4061ab687c0162365f03288ac16e35c499f3cc0ae9 |
| php53-gd-5.3.3-21.el5.i386.rpm | SHA-256: 26e0b511c8a9ab13dc5339fc1e6288bbcc35f54c07fca47103410d13c5b68dea |
| php53-imap-5.3.3-21.el5.i386.rpm | SHA-256: 92d98291df77d4a6b96d18710879ae8305387e0798fd10cd4718e24e45d2bbfb |
| php53-intl-5.3.3-21.el5.i386.rpm | SHA-256: 0a9bd3687bbed14187bfd9071f09a3af661663dc2f64b7f455fd0f4d60c027d6 |
| php53-ldap-5.3.3-21.el5.i386.rpm | SHA-256: a3673bde3e9ebd3fba1f5df0dde4189eab073e5aa0968df51a74530313d0e5d1 |
| php53-mbstring-5.3.3-21.el5.i386.rpm | SHA-256: edff0399eac4a822de039beee84a1a6f79b0481da8dfe9199d2979d962fd7dca |
| php53-mysql-5.3.3-21.el5.i386.rpm | SHA-256: e92ed500af21d0e26c3cc40e8cd649db211b8a8dbd3ee4469433f6bae0f0d548 |
| php53-odbc-5.3.3-21.el5.i386.rpm | SHA-256: e14160e55af1e01ffb8eea23fa5a03394dfde54ab6125a7b3da2acd28bc1d4ef |
| php53-pdo-5.3.3-21.el5.i386.rpm | SHA-256: b926cc0ec662de22d08dfce6478ef0c66085071d2592dba4adcff6f653129493 |
| php53-pgsql-5.3.3-21.el5.i386.rpm | SHA-256: 18cc64c114b1a0d16df9a23325d4747613664f56afe9a3aa7de70e5d45d35efa |
| php53-process-5.3.3-21.el5.i386.rpm | SHA-256: 104e7141ffe333032b0e7c2f996848eb4dd9f27dde27fd26a137355a3ccc304f |
| php53-pspell-5.3.3-21.el5.i386.rpm | SHA-256: 9fc20221ff0fec40b432b0dd7e1fe5da480721a59fb86dd3135042414d5af41c |
| php53-snmp-5.3.3-21.el5.i386.rpm | SHA-256: 352e0ac307c0177db81f9de28a9e5a7402670046d1f872603022b746618aaa89 |
| php53-soap-5.3.3-21.el5.i386.rpm | SHA-256: 5da1a3b3469aec7c69f6e2f4f2507ea251b1c20b8d1361fe14ed66733f3ac19e |
| php53-xml-5.3.3-21.el5.i386.rpm | SHA-256: 342f1ce8ec27c0949173a19da149433ba216661582af39b3ecdd6e13f6b2fad1 |
| php53-xmlrpc-5.3.3-21.el5.i386.rpm | SHA-256: 3215bbd015487df513c80736a96ff5d741dc1bbc6b4f6e1cf564aaa27e92e91f |

## Red Hat Enterprise Linux Workstation 5

| SRPM | |
| --- | --- |
| php53-5.3.3-21.el5.src.rpm | SHA-256: 76e480455b7c7d8e3b76ce5011287ee504a7c8e00cbf088cd587f906b22b892f |
| x86\_64 | |
| php53-5.3.3-21.el5.x86\_64.rpm | SHA-256: f27ba8b5e21e9c74ba662a5c139c318593d2736975645b1f46be3be744702222 |
| php53-bcmath-5.3.3-21.el5.x86\_64.rpm | SHA-256: 3b9ce5979be87c73f4349f785595b0a18c8fa1101993c59b3db9f738f74888c3 |
| php53-cli-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0568da184172cfd4a2197506f9bac2032ba3df78f7fc0b52f3daac85ce866608 |
| php53-common-5.3.3-21.el5.x86\_64.rpm | SHA-256: 07dd16c392501282f32984f74addd8ce536337500debd7e1ea32be2a2ac71d77 |
| php53-dba-5.3.3-21.el5.x86\_64.rpm | SHA-256: 7ad4223f77085bf1992eb6badc160576ad75b862c2e4d72221667e191996dc87 |
| php53-debuginfo-5.3.3-21.el5.x86\_64.rpm | SHA-256: 46920934b77528f5bd1d330f5ffee785d7b6e71b3274699f4109b68ca20fb367 |
| php53-devel-5.3.3-21.el5.x86\_64.rpm | SHA-256: f8dac1a6ae515035078528d276309555dabaf05ca265dafca7634b925bd13b77 |
| php53-gd-5.3.3-21.el5.x86\_64.rpm | SHA-256: 5c36c0793560f47325400b6260625689173f3cdf2fd50e2b39e733a4daf53a36 |
| php53-imap-5.3.3-21.el5.x86\_64.rpm | SHA-256: 3ee20378ac73cf40b2c8635d74c57b375e709c7844835e6fa7604d99f38a42ad |
| php53-intl-5.3.3-21.el5.x86\_64.rpm | SHA-256: 6b557c47f28a111c8d1a2765fcdc2db48a4c62b070b6f71de827c18c13064a69 |
| php53-ldap-5.3.3-21.el5.x86\_64.rpm | SHA-256: 5d5220ef4c7b3786c343847f0bd136dae11b31714c2b024b8462dffe99131bba |
| php53-mbstring-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0e58a4715af8e6e95c080b42abba05757b38dd83aeeb36ba08117d9512fa3408 |
| php53-mysql-5.3.3-21.el5.x86\_64.rpm | SHA-256: 044f81f6489059de1b08d9e7ed2b4d194878dd71f92ae5a78f96ba5665bde1b9 |
| php53-odbc-5.3.3-21.el5.x86\_64.rpm | SHA-256: 1afdb4bf954bf45a3b6b7a6dad7e01dc40a7a4b862ce28da3ee800c224bf2d8b |
| php53-pdo-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0f9ab82c304ce4bc129f7bc356ed54a4ffa79915e829354eeb3c19a377e08df7 |
| php53-pgsql-5.3.3-21.el5.x86\_64.rpm | SHA-256: 2d3d47972a728025a85aee07a6be524f7adf68c266a3ad4732e3831de0afaa19 |
| php53-process-5.3.3-21.el5.x86\_64.rpm | SHA-256: 42bd88365ce59d894e0372e60c822bc816c3eea5e301ff4c89842380f20bed8a |
| php53-pspell-5.3.3-21.el5.x86\_64.rpm | SHA-256: 03513841d0cde54c347f2f4321660877ea6d37356e5721d5f4780c14495669a8 |
| php53-snmp-5.3.3-21.el5.x86\_64.rpm | SHA-256: cd6b83e8a615fb7e60eeb95211021f6bceb85e9286caccccb6c0263c1f1a6c37 |
| php53-soap-5.3.3-21.el5.x86\_64.rpm | SHA-256: b8d5589cc1cef0a95b23fa293d76e05119b423b620d66494b5ec98d96cdc8f7f |
| php53-xml-5.3.3-21.el5.x86\_64.rpm | SHA-256: 6026ed4ca12f87a832423a17f0683707266345adf5620e8ae179b93901682074 |
| php53-xmlrpc-5.3.3-21.el5.x86\_64.rpm | SHA-256: 8289babeb3598ae18d296e2cf84d78e1f239eb82a9a1fa9dc4978350d85a4eda |
| i386 | |
| php53-5.3.3-21.el5.i386.rpm | SHA-256: 79296024d45cb8d9c095de4b303969beeac81afad211890b11d5ed2e18fe4b4f |
| php53-bcmath-5.3.3-21.el5.i386.rpm | SHA-256: cf1c95ccc23e14badf54c9eff0400aafb2044b6314ebd0190555f4c70d17de33 |
| php53-cli-5.3.3-21.el5.i386.rpm | SHA-256: d47ae4e7339a14cdf3455bfc7bc6b165d90249422cf6d35611c3ae1a8b455b35 |
| php53-common-5.3.3-21.el5.i386.rpm | SHA-256: 464f01627f68254b5c7581600b5f6660d0301e9ecf86043705edc010517a5f45 |
| php53-dba-5.3.3-21.el5.i386.rpm | SHA-256: 41f445c1ce5acc840f5ca1bbf6fad75bd0bab7e2e6b9424668f0e9cede4d8b05 |
| php53-debuginfo-5.3.3-21.el5.i386.rpm | SHA-256: 14c7149dce8146713998bef44ace023c2f9917c59bd36f67b3ee2c02384088f1 |
| php53-devel-5.3.3-21.el5.i386.rpm | SHA-256: 545848e142e54d16f21ccb4061ab687c0162365f03288ac16e35c499f3cc0ae9 |
| php53-gd-5.3.3-21.el5.i386.rpm | SHA-256: 26e0b511c8a9ab13dc5339fc1e6288bbcc35f54c07fca47103410d13c5b68dea |
| php53-imap-5.3.3-21.el5.i386.rpm | SHA-256: 92d98291df77d4a6b96d18710879ae8305387e0798fd10cd4718e24e45d2bbfb |
| php53-intl-5.3.3-21.el5.i386.rpm | SHA-256: 0a9bd3687bbed14187bfd9071f09a3af661663dc2f64b7f455fd0f4d60c027d6 |
| php53-ldap-5.3.3-21.el5.i386.rpm | SHA-256: a3673bde3e9ebd3fba1f5df0dde4189eab073e5aa0968df51a74530313d0e5d1 |
| php53-mbstring-5.3.3-21.el5.i386.rpm | SHA-256: edff0399eac4a822de039beee84a1a6f79b0481da8dfe9199d2979d962fd7dca |
| php53-mysql-5.3.3-21.el5.i386.rpm | SHA-256: e92ed500af21d0e26c3cc40e8cd649db211b8a8dbd3ee4469433f6bae0f0d548 |
| php53-odbc-5.3.3-21.el5.i386.rpm | SHA-256: e14160e55af1e01ffb8eea23fa5a03394dfde54ab6125a7b3da2acd28bc1d4ef |
| php53-pdo-5.3.3-21.el5.i386.rpm | SHA-256: b926cc0ec662de22d08dfce6478ef0c66085071d2592dba4adcff6f653129493 |
| php53-pgsql-5.3.3-21.el5.i386.rpm | SHA-256: 18cc64c114b1a0d16df9a23325d4747613664f56afe9a3aa7de70e5d45d35efa |
| php53-process-5.3.3-21.el5.i386.rpm | SHA-256: 104e7141ffe333032b0e7c2f996848eb4dd9f27dde27fd26a137355a3ccc304f |
| php53-pspell-5.3.3-21.el5.i386.rpm | SHA-256: 9fc20221ff0fec40b432b0dd7e1fe5da480721a59fb86dd3135042414d5af41c |
| php53-snmp-5.3.3-21.el5.i386.rpm | SHA-256: 352e0ac307c0177db81f9de28a9e5a7402670046d1f872603022b746618aaa89 |
| php53-soap-5.3.3-21.el5.i386.rpm | SHA-256: 5da1a3b3469aec7c69f6e2f4f2507ea251b1c20b8d1361fe14ed66733f3ac19e |
| php53-xml-5.3.3-21.el5.i386.rpm | SHA-256: 342f1ce8ec27c0949173a19da149433ba216661582af39b3ecdd6e13f6b2fad1 |
| php53-xmlrpc-5.3.3-21.el5.i386.rpm | SHA-256: 3215bbd015487df513c80736a96ff5d741dc1bbc6b4f6e1cf564aaa27e92e91f |

## Red Hat Enterprise Linux for IBM z Systems 5

| SRPM | |
| --- | --- |
| php53-5.3.3-21.el5.src.rpm | SHA-256: 76e480455b7c7d8e3b76ce5011287ee504a7c8e00cbf088cd587f906b22b892f |
| s390x | |
| php53-5.3.3-21.el5.s390x.rpm | SHA-256: 55f84c444e847ac034d869b2dc09df1a65ea719bf884d1bc7ba12a7f330a00de |
| php53-bcmath-5.3.3-21.el5.s390x.rpm | SHA-256: f6d549d6715b40f4fd8094ac3f3de6f2e4e8e876b02393afbe75b14a52215bac |
| php53-cli-5.3.3-21.el5.s390x.rpm | SHA-256: 53605556082e11dbb9189376a39811a2beea834328826714a42b099cc05889f7 |
| php53-common-5.3.3-21.el5.s390x.rpm | SHA-256: 338f967f634dfa90e8d3e3c6220d852d4857af5f638fdadeb3ea33d250d2d145 |
| php53-dba-5.3.3-21.el5.s390x.rpm | SHA-256: 4de42a1edd6829421ae7009d5c5eca287577466b03d05651547b5aac1f4123df |
| php53-debuginfo-5.3.3-21.el5.s390x.rpm | SHA-256: 9985a6314da904af8c48f3bd342b2eb592b6fe59877be7f96dc6ec2b9ad7fd97 |
| php53-devel-5.3.3-21.el5.s390x.rpm | SHA-256: 683df8a5035cf05355273564f7a0ecab8d180107ae611dcebb6e47805006e996 |
| php53-gd-5.3.3-21.el5.s390x.rpm | SHA-256: 9113141d33d6dda3facca1c3eac86a0b99703cb492f91000968894ee90c68774 |
| php53-imap-5.3.3-21.el5.s390x.rpm | SHA-256: b0be6ac16f03ca31e57a6ab950137703eb7d0a198fc562fc66419e9d517c0208 |
| php53-intl-5.3.3-21.el5.s390x.rpm | SHA-256: d6891e12092a4b20d22fda64b8f64e3e599087130a035ece23fb47624f5ce4f9 |
| php53-ldap-5.3.3-21.el5.s390x.rpm | SHA-256: 42256c39d7683f66eda711df3bdbef7f34aee49ff3b5393151f9c2d6b7111ac9 |
| php53-mbstring-5.3.3-21.el5.s390x.rpm | SHA-256: 0e6a62612023b251da60b6b4321531c55110503a261f5042dbf141f90cc51248 |
| php53-mysql-5.3.3-21.el5.s390x.rpm | SHA-256: 65932d3958de9eed983bbc9684c30557cf661f2a27de7d64c7ec6dcdc1b766c9 |
| php53-odbc-5.3.3-21.el5.s390x.rpm | SHA-256: 20c5530b425fc7953a2dd105c321f0fc030511436046a4dc96bf41dfbfcfe2da |
| php53-pdo-5.3.3-21.el5.s390x.rpm | SHA-256: a32948ce2ba8efe1dd9f10183691368d9ccc88e726412c6dbdb80524b369b394 |
| php53-pgsql-5.3.3-21.el5.s390x.rpm | SHA-256: 8e72a7dfd6bf795de5d5fc93cdbc72bbe9cdb6dc0c4f276994255e4fc81a0125 |
| php53-process-5.3.3-21.el5.s390x.rpm | SHA-256: e568269114d063a37714982f14e7400b9557a1b83d36675b112bc70c4543960b |
| php53-pspell-5.3.3-21.el5.s390x.rpm | SHA-256: 604d4d97aa9b19132a6b525cf7894d7cc4d58a2ff8c608bd48fbb185df8d68df |
| php53-snmp-5.3.3-21.el5.s390x.rpm | SHA-256: 299ab2deafb3e63315ab423164e0e503995d25a00683c99ef6eff7ae515cec7e |
| php53-soap-5.3.3-21.el5.s390x.rpm | SHA-256: bee8ac1c3fb67067eeb85dfc501eeda8061150ff0ca923439df9e5a6bf360d12 |
| php53-xml-5.3.3-21.el5.s390x.rpm | SHA-256: e455ba119b4af5f0e0da5eee4d4a52031adf604def5fc6a3a995b30619be13e3 |
| php53-xmlrpc-5.3.3-21.el5.s390x.rpm | SHA-256: caa83d1dc0605a15619358076f4b97c4c70376506501086923b22ae11e095cc9 |

## Red Hat Enterprise Linux for Power, big endian 5

| SRPM | |
| --- | --- |
| php53-5.3.3-21.el5.src.rpm | SHA-256: 76e480455b7c7d8e3b76ce5011287ee504a7c8e00cbf088cd587f906b22b892f |
| ppc | |
| php53-5.3.3-21.el5.ppc.rpm | SHA-256: 7907d5a89d2d6a443d48a28ded2f8fb516cca91117ce0e786c838bb4bf3e257d |
| php53-bcmath-5.3.3-21.el5.ppc.rpm | SHA-256: 1423c69b1cbabcfda6e78a558bb43bb7619af818f860c30d4f941be958d1f5d2 |
| php53-cli-5.3.3-21.el5.ppc.rpm | SHA-256: d92ec124e3931f0945b7bdf2462c8a7c84f4b60881de77a02f118c1baa6f74a9 |
| php53-common-5.3.3-21.el5.ppc.rpm | SHA-256: 3fb446e67b7b7e04f9d9682d36efe5862601b5a74f175c4397a4ae2c79970c64 |
| php53-dba-5.3.3-21.el5.ppc.rpm | SHA-256: 1ff8c06dbbbb8f35d5829306230681a075e4dfb4f12e00193e151fdbc4dea4eb |
| php53-debuginfo-5.3.3-21.el5.ppc.rpm | SHA-256: 9cc2f3cfb14c934f295dc3847697a6bfefe27eef8e8676c1a14f41b431b85766 |
| php53-devel-5.3.3-21.el5.ppc.rpm | SHA-256: 9727bfca23353ff3b85c20d9ad73bc9cd0956e118704145657d8c63394304d16 |
| php53-gd-5.3.3-21.el5.ppc.rpm | SHA-256: cb5f18515df16bcaa1f503e46f03f1f3bd1421708b9cb85c6b91d82e3a1ef7c5 |
| php53-imap-5.3.3-21.el5.ppc.rpm | SHA-256: db326b80a73e902571a2cce1f51b62427c1e8dc072d05a33954299c472bf6b46 |
| php53-intl-5.3.3-21.el5.ppc.rpm | SHA-256: 80a196e23c7065c3dee47438833f2e2b2fd406bde16bcb74a559dc5d7c2e1bc7 |
| php53-ldap-5.3.3-21.el5.ppc.rpm | SHA-256: 16e74be8e6e46d6c929390b5f07de92129c7f0f3cb2ba53bfb78d6a562aaa649 |
| php53-mbstring-5.3.3-21.el5.ppc.rpm | SHA-256: 29b41f10cd03ac27ca71b1ff7b01ad3aead0868d73b3c519a91447f81a0b1f13 |
| php53-mysql-5.3.3-21.el5.ppc.rpm | SHA-256: 18a29cb22c3668f5c97b6566c66fbb099eb2a1f011fc41eb3fd29a467b27d8ff |
| php53-odbc-5.3.3-21.el5.ppc.rpm | SHA-256: a84da045c0b46594242469ce3b47fbe87d08284f2497b640fd7f1d69e42b704f |
| php53-pdo-5.3.3-21.el5.ppc.rpm | SHA-256: 1da703ae707f4ccd9b91c89963ae792768c8afd8b074d6df5202b98b5e9592ad |
| php53-pgsql-5.3.3-21.el5.ppc.rpm | SHA-256: 098e9d5ee55153dd1c4807e115896101de5eff67a75478bc8db6aa5d9fc21322 |
| php53-process-5.3.3-21.el5.ppc.rpm | SHA-256: 776693de719463b39b3cbe96601dfe4630d611a27c43248989bc641556e6d8a8 |
| php53-pspell-5.3.3-21.el5.ppc.rpm | SHA-256: f307e2830eedba60f4e1ab3457136285b609c41e70cffe23983fb30d24f2c977 |
| php53-snmp-5.3.3-21.el5.ppc.rpm | SHA-256: 9a8d4d583c90e6c0f34a3afc706547dbffb682927c66bd837c05b978d9e3c340 |
| php53-soap-5.3.3-21.el5.ppc.rpm | SHA-256: 3ff99970bd21f4e9617794ed3c16527d0bc4c6f2de3b376642b2d4db1c4ee1c9 |
| php53-xml-5.3.3-21.el5.ppc.rpm | SHA-256: a39ece8f1a688163b13369af1863acaa5fe7f54a363b98c2335397116ead01da |
| php53-xmlrpc-5.3.3-21.el5.ppc.rpm | SHA-256: 10347f0d86ac43793ef7bb35b2cfc9a29d851fc5e7dbacb087c5fbd125c5c6e8 |

## Red Hat Enterprise Linux Server from RHUI 5

| SRPM | |
| --- | --- |
| php53-5.3.3-21.el5.src.rpm | SHA-256: 76e480455b7c7d8e3b76ce5011287ee504a7c8e00cbf088cd587f906b22b892f |
| x86\_64 | |
| php53-5.3.3-21.el5.x86\_64.rpm | SHA-256: f27ba8b5e21e9c74ba662a5c139c318593d2736975645b1f46be3be744702222 |
| php53-bcmath-5.3.3-21.el5.x86\_64.rpm | SHA-256: 3b9ce5979be87c73f4349f785595b0a18c8fa1101993c59b3db9f738f74888c3 |
| php53-cli-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0568da184172cfd4a2197506f9bac2032ba3df78f7fc0b52f3daac85ce866608 |
| php53-common-5.3.3-21.el5.x86\_64.rpm | SHA-256: 07dd16c392501282f32984f74addd8ce536337500debd7e1ea32be2a2ac71d77 |
| php53-dba-5.3.3-21.el5.x86\_64.rpm | SHA-256: 7ad4223f77085bf1992eb6badc160576ad75b862c2e4d72221667e191996dc87 |
| php53-debuginfo-5.3.3-21.el5.x86\_64.rpm | SHA-256: 46920934b77528f5bd1d330f5ffee785d7b6e71b3274699f4109b68ca20fb367 |
| php53-devel-5.3.3-21.el5.x86\_64.rpm | SHA-256: f8dac1a6ae515035078528d276309555dabaf05ca265dafca7634b925bd13b77 |
| php53-gd-5.3.3-21.el5.x86\_64.rpm | SHA-256: 5c36c0793560f47325400b6260625689173f3cdf2fd50e2b39e733a4daf53a36 |
| php53-imap-5.3.3-21.el5.x86\_64.rpm | SHA-256: 3ee20378ac73cf40b2c8635d74c57b375e709c7844835e6fa7604d99f38a42ad |
| php53-intl-5.3.3-21.el5.x86\_64.rpm | SHA-256: 6b557c47f28a111c8d1a2765fcdc2db48a4c62b070b6f71de827c18c13064a69 |
| php53-ldap-5.3.3-21.el5.x86\_64.rpm | SHA-256: 5d5220ef4c7b3786c343847f0bd136dae11b31714c2b024b8462dffe99131bba |
| php53-mbstring-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0e58a4715af8e6e95c080b42abba05757b38dd83aeeb36ba08117d9512fa3408 |
| php53-mysql-5.3.3-21.el5.x86\_64.rpm | SHA-256: 044f81f6489059de1b08d9e7ed2b4d194878dd71f92ae5a78f96ba5665bde1b9 |
| php53-odbc-5.3.3-21.el5.x86\_64.rpm | SHA-256: 1afdb4bf954bf45a3b6b7a6dad7e01dc40a7a4b862ce28da3ee800c224bf2d8b |
| php53-pdo-5.3.3-21.el5.x86\_64.rpm | SHA-256: 0f9ab82c304ce4bc129f7bc356ed54a4ffa79915e829354eeb3c19a377e08df7 |
| php53-pgsql-5.3.3-21.el5.x86\_64.rpm | SHA-256: 2d3d47972a728025a85aee07a6be524f7adf68c266a3ad4732e3831de0afaa19 |
| php53-process-5.3.3-21.el5.x86\_64.rpm | SHA-256: 42bd88365ce59d894e0372e60c822bc816c3eea5e301ff4c89842380f20bed8a |
| php53-pspell-5.3.3-21.el5.x86\_64.rpm | SHA-256: 03513841d0cde54c347f2f4321660877ea6d37356e5721d5f4780c14495669a8 |
| php53-snmp-5.3.3-21.el5.x86\_64.rpm | SHA-256: cd6b83e8a615fb7e60eeb95211021f6bceb85e9286caccccb6c0263c1f1a6c37 |
| php53-soap-5.3.3-21.el5.x86\_64.rpm | SHA-256: b8d5589cc1cef0a95b23fa293d76e05119b423b620d66494b5ec98d96cdc8f7f |
| php53-xml-5.3.3-21.el5.x86\_64.rpm | SHA-256: 6026ed4ca12f87a832423a17f0683707266345adf5620e8ae179b93901682074 |
| php53-xmlrpc-5.3.3-21.el5.x86\_64.rpm | SHA-256: 8289babeb3598ae18d296e2cf84d78e1f239eb82a9a1fa9dc4978350d85a4eda |
| i386 | |
| php53-5.3.3-21.el5.i386.rpm | SHA-256: 79296024d45cb8d9c095de4b303969beeac81afad211890b11d5ed2e18fe4b4f |
| php53-bcmath-5.3.3-21.el5.i386.rpm | SHA-256: cf1c95ccc23e14badf54c9eff0400aafb2044b6314ebd0190555f4c70d17de33 |
| php53-cli-5.3.3-21.el5.i386.rpm | SHA-256: d47ae4e7339a14cdf3455bfc7bc6b165d90249422cf6d35611c3ae1a8b455b35 |
| php53-common-5.3.3-21.el5.i386.rpm | SHA-256: 464f01627f68254b5c7581600b5f6660d0301e9ecf86043705edc010517a5f45 |
| php53-dba-5.3.3-21.el5.i386.rpm | SHA-256: 41f445c1ce5acc840f5ca1bbf6fad75bd0bab7e2e6b9424668f0e9cede4d8b05 |
| php53-debuginfo-5.3.3-21.el5.i386.rpm | SHA-256: 14c7149dce8146713998bef44ace023c2f9917c59bd36f67b3ee2c02384088f1 |
| php53-devel-5.3.3-21.el5.i386.rpm | SHA-256: 545848e142e54d16f21ccb4061ab687c0162365f03288ac16e35c499f3cc0ae9 |
| php53-gd-5.3.3-21.el5.i386.rpm | SHA-256: 26e0b511c8a9ab13dc5339fc1e6288bbcc35f54c07fca47103410d13c5b68dea |
| php53-imap-5.3.3-21.el5.i386.rpm | SHA-256: 92d98291df77d4a6b96d18710879ae8305387e0798fd10cd4718e24e45d2bbfb |
| php53-intl-5.3.3-21.el5.i386.rpm | SHA-256: 0a9bd3687bbed14187bfd9071f09a3af661663dc2f64b7f455fd0f4d60c027d6 |
| php53-ldap-5.3.3-21.el5.i386.rpm | SHA-256: a3673bde3e9ebd3fba1f5df0dde4189eab073e5aa0968df51a74530313d0e5d1 |
| php53-mbstring-5.3.3-21.el5.i386.rpm | SHA-256: edff0399eac4a822de039beee84a1a6f79b0481da8dfe9199d2979d962fd7dca |
| php53-mysql-5.3.3-21.el5.i386.rpm | SHA-256: e92ed500af21d0e26c3cc40e8cd649db211b8a8dbd3ee4469433f6bae0f0d548 |
| php53-odbc-5.3.3-21.el5.i386.rpm | SHA-256: e14160e55af1e01ffb8eea23fa5a03394dfde54ab6125a7b3da2acd28bc1d4ef |
| php53-pdo-5.3.3-21.el5.i386.rpm | SHA-256: b926cc0ec662de22d08dfce6478ef0c66085071d2592dba4adcff6f653129493 |
| php53-pgsql-5.3.3-21.el5.i386.rpm | SHA-256: 18cc64c114b1a0d16df9a23325d4747613664f56afe9a3aa7de70e5d45d35efa |
| php53-process-5.3.3-21.el5.i386.rpm | SHA-256: 104e7141ffe333032b0e7c2f996848eb4dd9f27dde27fd26a137355a3ccc304f |
| php53-pspell-5.3.3-21.el5.i386.rpm | SHA-256: 9fc20221ff0fec40b432b0dd7e1fe5da480721a59fb86dd3135042414d5af41c |
| php53-snmp-5.3.3-21.el5.i386.rpm | SHA-256: 352e0ac307c0177db81f9de28a9e5a7402670046d1f872603022b746618aaa89 |
| php53-soap-5.3.3-21.el5.i386.rpm | SHA-256: 5da1a3b3469aec7c69f6e2f4f2507ea251b1c20b8d1361fe14ed66733f3ac19e |
| php53-xml-5.3.3-21.el5.i386.rpm | SHA-256: 342f1ce8ec27c0949173a19da149433ba216661582af39b3ecdd6e13f6b2fad1 |
| php53-xmlrpc-5.3.3-21.el5.i386.rpm | SHA-256: 3215bbd015487df513c80736a96ff5d741dc1bbc6b4f6e1cf564aaa27e92e91f |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.novell.com_8e330d12_20250126_100723.html ===




=== Content from bugzilla.novell.com_bb3c4389_20250126_100746.html ===




=== Content from www.redhat.com_d911567d_20250126_100754.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


