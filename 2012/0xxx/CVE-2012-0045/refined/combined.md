=== Content from www.openwall.com_ff0141a7_20250126_034838.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

# blists - web interface to mailing list archives

blists is a web interface to mailing list archives that works off indexed mbox files.
There are two programs: *bindex* and *bit*.
*bindex* generates or updates the index file (yes, incremental updates are supported).
*bit* is a CGI/SSI program that generates web pages on the fly.
Both programs are written in C and are very fast.

You can view the latest <README> file,
which describes blists in more detail and provides installation instructions.
It is also included in the archive below.

Download ([release notes](/lists/announce/2017/11/19/1)):

* [blists 2.0](blists-2.0.tar.gz) and
  its [signature](blists-2.0.tar.gz.sign)* [blists 1.0](blists-1.0.tar.gz) and
    its [signature](blists-1.0.tar.gz.sign)

These files are also
[available from the Openwall file archive](https://download.openwall.net/pub/projects/blists/).
The source code of blists can be browsed on
[GitHub](https://github.com/openwall/blists) or via
[CVSweb](https://cvsweb.openwall.com/blists).

Follow [this link](/signatures/) for information on verifying the signatures.

To see blists in action, check out our
[Open Source and information security mailing list archives](https://lists.openwall.net).

blists is a registered project with
[Open Hub](https://www.openhub.net/p/blists).

Quick Comment:

413273



=== Content from github.com_15c3ce96_20250124_220137.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc2226fc9e87ba3da060e47333657cd6616652b84)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc2226fc9e87ba3da060e47333657cd6616652b84)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/c2226fc9e87ba3da060e47333657cd6616652b84)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

KVM: x86: fix missing checks in syscall emulation

[Browse files](/torvalds/linux/tree/c2226fc9e87ba3da060e47333657cd6616652b84)
Browse the repository at this point in the history

```
On hosts without this patch, 32bit guests will crash (and 64bit guests
may behave in a wrong way) for example by simply executing following
nasm-demo-application:

    [bits 32]
    global _start
    SECTION .text
    _start: syscall

(I tested it with winxp and linux - both always crashed)

    Disassembly of section .text:

    00000000 <_start>:
       0:   0f 05                   syscall

The reason seems a missing "invalid opcode"-trap (int6) for the
syscall opcode "0f05", which is not available on Intel CPUs
within non-longmodes, as also on some AMD CPUs within legacy-mode.
(depending on CPU vendor, MSR_EFER and cpuid)

Because previous mentioned OSs may not engage corresponding
syscall target-registers (STAR, LSTAR, CSTAR), they remain
NULL and (non trapping) syscalls are leading to multiple
faults and finally crashs.

Depending on the architecture (AMD or Intel) pretended by
guests, various checks according to vendor's documentation
are implemented to overcome the current issue and behave
like the CPUs physical counterparts.

[mtosatti: cleanup/beautify code]

Signed-off-by: Stephan Baerwolf <stephan.baerwolf@tu-ilmenau.de>
Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
```

* Loading branch information

[![@baerwolf](https://avatars.githubusercontent.com/u/1092625?s=40&v=4)](/baerwolf) [![@avikivity](https://avatars.githubusercontent.com/u/1017210?s=40&v=4)](/avikivity)

[baerwolf](/torvalds/linux/commits?author=baerwolf "View all commits by baerwolf")
authored and
[avikivity](/torvalds/linux/commits?author=avikivity "View all commits by avikivity")
committed
Feb 1, 2012

1 parent
[bdb42f5](/torvalds/linux/commit/bdb42f5afebe208eae90406959383856ae2caf2b)

commit c2226fc

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**64 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* arch/x86

  + include/asm

    - arch/x86/include/asm/kvm\_emulate.h
      [kvm\_emulate.h](#diff-5df6eb2fe64e5b8574065d91d486c0578896f492fa5ed74d961d64553166f9a8)
  + kvm

    - arch/x86/kvm/emulate.c
      [emulate.c](#diff-50a0b0edc05bf5218443999c4f0c82b96115995a68dca707080331ff3190b937)

## There are no files selected for viewing

13 changes: 13 additions & 0 deletions

13
[arch/x86/include/asm/kvm\_emulate.h](#diff-5df6eb2fe64e5b8574065d91d486c0578896f492fa5ed74d961d64553166f9a8 "arch/x86/include/asm/kvm_emulate.h")

Show comments

[View file](/torvalds/linux/blob/c2226fc9e87ba3da060e47333657cd6616652b84/arch/x86/include/asm/kvm_emulate.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -301,6 +301,19 @@ struct x86\_emulate\_ctxt { |
|  |  | #define X86EMUL\_MODE\_PROT (X86EMUL\_MODE\_PROT16|X86EMUL\_MODE\_PROT32| \ |
|  |  | X86EMUL\_MODE\_PROT64) |
|  |  |  |
|  |  | /\* CPUID vendors \*/ |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_AuthenticAMD\_ebx 0x68747541 |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_AuthenticAMD\_ecx 0x444d4163 |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_AuthenticAMD\_edx 0x69746e65 |
|  |  |  |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_AMDisbetterI\_ebx 0x69444d41 |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_AMDisbetterI\_ecx 0x21726574 |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_AMDisbetterI\_edx 0x74656273 |
|  |  |  |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_GenuineIntel\_ebx 0x756e6547 |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_GenuineIntel\_ecx 0x6c65746e |
|  |  | #define X86EMUL\_CPUID\_VENDOR\_GenuineIntel\_edx 0x49656e69 |
|  |  |  |
|  |  | enum x86\_intercept\_stage { |
|  |  | X86\_ICTP\_NONE = 0, /\* Allow zero-init to not match anything \*/ |
|  |  | X86\_ICPT\_PRE\_EXCEPT, |
| Expand Down | |  |

51 changes: 51 additions & 0 deletions

51
[arch/x86/kvm/emulate.c](#diff-50a0b0edc05bf5218443999c4f0c82b96115995a68dca707080331ff3190b937 "arch/x86/kvm/emulate.c")

Show comments

[View file](/torvalds/linux/blob/c2226fc9e87ba3da060e47333657cd6616652b84/arch/x86/kvm/emulate.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1891,6 +1891,51 @@ setup\_syscalls\_segments(struct x86\_emulate\_ctxt \*ctxt, |
|  |  | ss->p = 1; |
|  |  | } |
|  |  |  |
|  |  | static bool em\_syscall\_is\_enabled(struct x86\_emulate\_ctxt \*ctxt) |
|  |  | { |
|  |  | struct x86\_emulate\_ops \*ops = ctxt->ops; |
|  |  | u32 eax, ebx, ecx, edx; |
|  |  |  |
|  |  | /\* |
|  |  | \* syscall should always be enabled in longmode - so only become |
|  |  | \* vendor specific (cpuid) if other modes are active... |
|  |  | \*/ |
|  |  | if (ctxt->mode == X86EMUL\_MODE\_PROT64) |
|  |  | return true; |
|  |  |  |
|  |  | eax = 0x00000000; |
|  |  | ecx = 0x00000000; |
|  |  | if (ops->get\_cpuid(ctxt, &eax, &ebx, &ecx, &edx)) { |
|  |  | /\* |
|  |  | \* Intel ("GenuineIntel") |
|  |  | \* remark: Intel CPUs only support "syscall" in 64bit |
|  |  | \* longmode. Also an 64bit guest with a |
|  |  | \* 32bit compat-app running will #UD !! While this |
|  |  | \* behaviour can be fixed (by emulating) into AMD |
|  |  | \* response - CPUs of AMD can't behave like Intel. |
|  |  | \*/ |
|  |  | if (ebx == X86EMUL\_CPUID\_VENDOR\_GenuineIntel\_ebx && |
|  |  | ecx == X86EMUL\_CPUID\_VENDOR\_GenuineIntel\_ecx && |
|  |  | edx == X86EMUL\_CPUID\_VENDOR\_GenuineIntel\_edx) |
|  |  | return false; |
|  |  |  |
|  |  | /\* AMD ("AuthenticAMD") \*/ |
|  |  | if (ebx == X86EMUL\_CPUID\_VENDOR\_AuthenticAMD\_ebx && |
|  |  | ecx == X86EMUL\_CPUID\_VENDOR\_AuthenticAMD\_ecx && |
|  |  | edx == X86EMUL\_CPUID\_VENDOR\_AuthenticAMD\_edx) |
|  |  | return true; |
|  |  |  |
|  |  | /\* AMD ("AMDisbetter!") \*/ |
|  |  | if (ebx == X86EMUL\_CPUID\_VENDOR\_AMDisbetterI\_ebx && |
|  |  | ecx == X86EMUL\_CPUID\_VENDOR\_AMDisbetterI\_ecx && |
|  |  | edx == X86EMUL\_CPUID\_VENDOR\_AMDisbetterI\_edx) |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | /\* default: (not Intel, not AMD), apply Intel's stricter rules... \*/ |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | static int em\_syscall(struct x86\_emulate\_ctxt \*ctxt) |
|  |  | { |
|  |  | struct x86\_emulate\_ops \*ops = ctxt->ops; |
| Expand All | | @@ -1904,9 +1949,15 @@ static int em\_syscall(struct x86\_emulate\_ctxt \*ctxt) |
|  |  | ctxt->mode == X86EMUL\_MODE\_VM86) |
|  |  | return emulate\_ud(ctxt); |
|  |  |  |
|  |  | if (!(em\_syscall\_is\_enabled(ctxt))) |
|  |  | return emulate\_ud(ctxt); |
|  |  |  |
|  |  | ops->get\_msr(ctxt, MSR\_EFER, &efer); |
|  |  | setup\_syscalls\_segments(ctxt, &cs, &ss); |
|  |  |  |
|  |  | if (!(efer & EFER\_SCE)) |
|  |  | return emulate\_ud(ctxt); |
|  |  |  |
|  |  | ops->get\_msr(ctxt, MSR\_STAR, &msr\_data); |
|  |  | msr\_data >>= 32; |
|  |  | cs\_sel = (u16)(msr\_data & 0xfffc); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c2226fc`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc2226fc9e87ba3da060e47333657cd6616652b84) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.kernel.org_f0b1baae_20250124_220131.html ===
commit 23d8c3f8f494c8516c9b4c05529e118e6a485956
Author: Greg Kroah-Hartman
Date: Mon Apr 2 09:53:31 2012 -0700
Linux 3.2.14
commit e277a09f64ac659407582c2182b245afa66dcebc
Author: Matthew Garrett
Date: Tue Mar 27 10:17:41 2012 -0400
ASPM: Fix pcie devices with non-pcie children
commit c9651e70ad0aa499814817cbf3cc1d0b806ed3a1 upstream.
Since 3.2.12 and 3.3, some systems are failing to boot with a BUG\_ON.
Some other systems using the pata\_jmicron driver fail to boot because no
disks are detected. Passing pcie\_aspm=force on the kernel command line
works around it.
The cause: commit 4949be16822e ("PCI: ignore pre-1.1 ASPM quirking when
ASPM is disabled") changed the behaviour of pcie\_aspm\_sanity\_check() to
always return 0 if aspm is disabled, in order to avoid cases where we
changed ASPM state on pre-PCIe 1.1 devices.
This skipped the secondary function of pcie\_aspm\_sanity\_check which was
to avoid us enabling ASPM on devices that had non-PCIe children, causing
trouble later on. Move the aspm\_disabled check so we continue to honour
that scenario.
Addresses https://bugzilla.kernel.org/show\_bug.cgi?id=42979 and
http://bugs.debian.org/665420
Reported-by: Romain Francoise  # kernel panic
Reported-by: Chris Holland  # disk detection trouble
Signed-off-by: Matthew Garrett
Tested-by: Hatem Masmoudi  # Dell Latitude E5520
Tested-by: janek  # pata\_jmicron with JMB362/JMB363
[jn: with more symptoms in log message]
Signed-off-by: Jonathan Nieder
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 46979bfe3c1c2435f7f8190ff0c0994de3cfc471
Author: Yoshii Takashi
Date: Wed Mar 14 16:14:43 2012 +0900
serial: sh-sci: fix a race of DMA submit\_tx on transfer
commit 49d4bcaddca977fffdea8b0b71f6e5da96dac78e upstream.
When DMA is enabled, sh-sci transfer begins with
uart\_start()
sci\_start\_tx()
if (cookie\_tx < 0) schedule\_work()
Then, starts DMA when wq scheduled, -- (A)
process\_one\_work()
work\_fn\_rx()
cookie\_tx = desc->submit\_tx()
And finishes when DMA transfer ends, -- (B)
sci\_dma\_tx\_complete()
async\_tx\_ack()
cookie\_tx = -EINVAL
(possible another schedule\_work())
This A to B sequence is not reentrant, since controlling variables
(for example, cookie\_tx above) are not queues nor lists. So, they
must be invoked as A B A B..., otherwise results in kernel crash.
To ensure the sequence, sci\_start\_tx() seems to test if cookie\_tx < 0
(represents "not used") to call schedule\_work().
But cookie\_tx will not be set (to a cookie, also means "used") until
in the middle of work queue scheduled function work\_fn\_tx().
This gap between the test and set allows the breakage of the sequence
under the very frequently call of uart\_start().
Another gap between async\_tx\_ack() and another schedule\_work() results
in the same issue, too.
This patch introduces a new condition "cookie\_tx == 0" just to mark
it is "busy" and assign it within spin-locked region to fill the gaps.
Signed-off-by: Takashi Yoshii
Reviewed-by: Guennadi Liakhovetski
Signed-off-by: Paul Mundt
Signed-off-by: Greg Kroah-Hartman
commit b43188de0cd27787a75c79856e72c649d4ee9035
Author: Dan Carpenter
Date: Wed Jan 18 12:56:02 2012 +0300
nfsd: don't allow zero length strings in cache\_parse()
commit 6d8d17499810479eabd10731179c04b2ca22152f upstream.
There is no point in passing a zero length string here and quite a
few of that cache\_parse() implementations will Oops if count is
zero.
Signed-off-by: Dan Carpenter
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 61d38cd909ad35ff497bf1a84cd57b2baf6d9c49
Author: John Stultz
Date: Tue Mar 6 17:16:09 2012 -0800
rtc: Provide flag for rtc devices that don't support UIE
commit 4a649903f91232d02284d53724b0a45728111767 upstream.
Richard Weinberger noticed that on some RTC hardware that
doesn't support UIE mode, due to coarse granular alarms
(like 1minute resolution), the current virtualized RTC
support doesn't properly error out when UIE is enabled.
Instead the current code queues an alarm for the next second,
but it won't fire until up to a miniute later.
This patch provides a generic way to flag this sort of hardware
and fixes the issue on the mpc5121 where Richard noticed the
problem.
Reported-by: Richard Weinberger
Tested-by: Richard Weinberger
Signed-off-by: John Stultz
Signed-off-by: Greg Kroah-Hartman
commit acff5ccd7dfccb0c28f367a2a684a7e8e3ee0112
Author: Chris Metcalf
Date: Mon Mar 26 16:26:12 2012 -0400
compat: use sys\_sendfile64() implementation for sendfile syscall
commit 1631fcea8399da5e80a80084b3b8c5bfd99d21e7 upstream.
 was set up to use sys\_sendfile() for the 32-bit
compat API instead of sys\_sendfile64(), but in fact the right thing to
do is to use sys\_sendfile64() in all cases. The 32-bit sendfile64() API
in glibc uses the sendfile64 syscall, so it has to be capable of doing
full 64-bit operations. But the sys\_sendfile() kernel implementation
has a MAX\_NON\_LFS test in it which explicitly limits the offset to 2^32.
So, we need to use the sys\_sendfile64() implementation in the kernel
for this case.
Acked-by: Arnd Bergmann
Signed-off-by: Chris Metcalf
Signed-off-by: Greg Kroah-Hartman
commit d88f3015285a3845d7330452865f763f16bda726
Author: Dan Carpenter
Date: Sat Mar 24 10:52:50 2012 +0300
x86, tls: Off by one limit check
commit 8f0750f19789cf352d7e24a6cc50f2ab1b4f1372 upstream.
These are used as offsets into an array of GDT\_ENTRY\_TLS\_ENTRIES members
so GDT\_ENTRY\_TLS\_ENTRIES is one past the end of the array.
Signed-off-by: Dan Carpenter
Link: http://lkml.kernel.org/r/20120324075250.GA28258@elgon.mountain
Signed-off-by: H. Peter Anvin
Signed-off-by: Greg Kroah-Hartman
commit 94e75cfe69ac1d91bae5998ac0f21e355ce93a8b
Author: Alok Kataria
Date: Tue Feb 21 18:19:55 2012 -0800
x86, tsc: Skip refined tsc calibration on systems with reliable TSC
commit 57779dc2b3b75bee05ef5d1ada47f615f7a13932 upstream.
While running the latest Linux as guest under VMware in highly
over-committed situations, we have seen cases when the refined TSC
algorithm fails to get a valid tsc\_start value in
tsc\_refine\_calibration\_work from multiple attempts. As a result the
kernel keeps on scheduling the tsc\_irqwork task for later. Subsequently
after several attempts when it gets a valid start value it goes through
the refined calibration and either bails out or uses the new results.
Given that the kernel originally read the TSC frequency from the
platform, which is the best it can get, I don't think there is much
value in refining it.
So for systems which get the TSC frequency from the platform we
should skip the refined tsc algorithm.
We can use the TSC\_RELIABLE cpu cap flag to detect this, right now it is
set only on VMware and for Moorestown Penwell both of which have there
own TSC calibration methods.
Signed-off-by: Alok N Kataria
Cc: John Stultz
Cc: Dirk Brandewie
Cc: Alan Cox
[jstultz: Reworked to simply not schedule the refining work,
rather then scheduling the work and bombing out later]
Signed-off-by: John Stultz
Signed-off-by: Greg Kroah-Hartman
commit eaadbfbf85875c76259c93e7ba51aebe2cad2138
Author: NeilBrown
Date: Tue Feb 7 15:35:42 2012 +1100
lockd: fix arg parsing for grace\_period and timeout.
commit de5b8e8e047534aac6bc9803f96e7257436aef9c upstream.
If you try to set grace\_period or timeout via a module parameter
to lockd, and do this on a big-endian machine where
sizeof(int) != sizeof(unsigned long)
it won't work. This number given will be effectively shifted right
by the difference in those two sizes.
So cast kp->arg properly to get correct result.
Signed-off-by: NeilBrown
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 9b5796b841ae7be468c39e88a9c723269651f57c
Author: Steffen Klassert
Date: Wed Mar 21 23:36:13 2012 +0000
xfrm: Access the replay notify functions via the registered callbacks
[ Upstream commit 1265fd616782ef03b98fd19f65c2b47fcd4ea11f ]
We call the wrong replay notify function when we use ESN replay
handling. This leads to the fact that we don't send notifications
if we use ESN. Fix this by calling the registered callbacks instead
of xfrm\_replay\_notify().
Signed-off-by: Steffen Klassert
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9b1ad27f4e59445a6e52deb25956b28a84509361
Author: stephen hemminger
Date: Wed Mar 21 05:32:05 2012 +0000
sky2: override for PCI legacy power management
[ Upstream commit 5676cc7bfe1e388e87843f71daa229610385b41e ]
Some BIOS's don't setup power management correctly (what else is
new) and don't allow use of PCI Express power control. Add a special
exception module parameter to allow working around this issue.
Based on slightly different patch by Knut Petersen.
Reported-by: Arkadiusz Miskiewicz
Signed-off-by: Stephen Hemminger
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8dd1b45065052ea3bddbb58368dfdbef5c4bc80d
Author: Dave Jones
Date: Mon Mar 19 13:01:07 2012 +0000
Remove printk from rds\_sendmsg
[ Upstream commit a6506e1486181975d318344143aca722b2b91621 ]
no socket layer outputs a message for this error and neither should rds.
Signed-off-by: Dave Jones
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 905c221ccf34bd7be7947cab38b2b1296fe9243b
Author: Eric Dumazet
Date: Wed Mar 21 06:58:03 2012 +0000
net: fix napi\_reuse\_skb() skb reserve
[ Upstream commit 2a2a459eeeff48640dc557548ce576d666ab06ed ]
napi->skb is allocated in napi\_get\_frags() using
netdev\_alloc\_skb\_ip\_align(), with a reserve of NET\_SKB\_PAD +
NET\_IP\_ALIGN bytes.
However, when such skb is recycled in napi\_reuse\_skb(), it ends with a
reserve of NET\_IP\_ALIGN which is suboptimal.
Signed-off-by: Eric Dumazet
Cc: Herbert Xu
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit beadbcb483a11bb6f4964d5525fef22dd573505a
Author: Eric Dumazet
Date: Tue Mar 27 09:53:52 2012 +0000
net: fix a potential rcu\_read\_lock() imbalance in rt6\_fill\_node()
[ Upstream commit 94f826b8076e2cb92242061e92f21b5baa3eccc2 ]
Commit f2c31e32b378 (net: fix NULL dereferences in check\_peer\_redir() )
added a regression in rt6\_fill\_node(), leading to rcu\_read\_lock()
imbalance.
Thats because NLA\_PUT() can make a jump to nla\_put\_failure label.
Fix this by using nla\_put()
Many thanks to Ben Greear for his help
Reported-by: Ben Greear
Reported-by: Dave Jones
Signed-off-by: Eric Dumazet
Tested-by: Ben Greear
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8a9ecfa63e8113306420f60832b0b9631e26ec57
Author: Eric Dumazet
Date: Sun Mar 18 02:40:48 2012 +0000
net: bpf\_jit: fix BPF\_S\_LDX\_B\_MSH compilation
[ Upstream commit dc72d99dabb870ca5bd6d9fff674be853bb4a88d ]
Matt Evans spotted that x86 bpf\_jit was incorrectly handling negative
constant offsets in BPF\_S\_LDX\_B\_MSH instruction.
We need to abort JIT compilation like we do in common\_load so that
filter uses the interpreter code and can call \_\_load\_pointer()
Reference: http://lists.openwall.net/netdev/2011/07/19/11
Thanks to Indan Zupancic to bring back this issue.
Reported-by: Matt Evans
Reported-by: Indan Zupancic
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0cff40794bd89b8218f64f8fe058fbf67835fc2f
Author: Gao feng
Date: Mon Mar 19 22:36:10 2012 +0000
ipv6: fix incorrent ipv6 ipsec packet fragment
[ Upstream commit 1f85851e17b64cabd089a8a8839dddebc627948c ]
Since commit 299b0767(ipv6: Fix IPsec slowpath fragmentation problem)
In func ip6\_append\_data,after call skb\_put(skb, fraglen + dst\_exthdrlen)
the skb->len contains dst\_exthdrlen,and we don't reduce dst\_exthdrlen at last
This will make fraggap>0 in next "while cycle",and cause the size of skb incorrent
Fix this by reserve headroom for dst\_exthdrlen.
Signed-off-by: Gao feng
Acked-by: Steffen Klassert
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9ec476d98f2ee3e851549e2a926a3db9477f4807
Author: Benjamin LaHaise
Date: Tue Mar 20 03:57:54 2012 +0000
Fix pppol2tp getsockname()
[ Upstream commit bbdb32cb5b73597386913d052165423b9d736145 ]
While testing L2TP functionality, I came across a bug in getsockname(). The
IP address returned within the pppol2tp\_addr's addr memember was not being
set to the IP address in use. This bug is caused by using inet\_sk() on the
wrong socket (the L2TP socket rather than the underlying UDP socket), and was
likely introduced during the addition of L2TPv3 support.
Signed-off-by: Benjamin LaHaise
Signed-off-by: James Chapman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 982b8bf53d1b4a8ab091d9218ce71b817a19fbb4
Author: Dave Airlie
Date: Wed Mar 28 10:48:49 2012 +0100
drm/i915: suspend fbdev device around suspend/hibernate
commit 3fa016a0b5c5237e9c387fc3249592b2cb5391c6 upstream.
Looking at hibernate overwriting I though it looked like a cursor,
so I tracked down this missing piece to stop the cursor blink
timer. I've no idea if this is sufficient to fix the hibernate
problems people are seeing, but please test it.
Both radeon and nouveau have done this for a long time.
I've run this personally all night hib/resume cycles with no fails.
Reviewed-by: Keith Packard
Reported-by: Petr Tesarik
Reported-by: Stanislaw Gruszka
Reported-by: Lots of misc segfaults after hibernate across the world.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=37142
Tested-by: Dave Airlie
Tested-by: Bojan Smojver
Tested-by: Andreas Hartmann
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 6ea96a4a90a5f2e1119df30180d851296e72032f
Author: Bing Zhao
Date: Tue Dec 20 18:19:00 2011 -0800
Bluetooth: btusb: fix bInterval for high/super speed isochronous endpoints
commit fa0fb93f2ac308a76fa64eb57c18511dadf97089 upstream.
For high-speed/super-speed isochronous endpoints, the bInterval
value is used as exponent, 2^(bInterval-1). Luckily we have
usb\_fill\_int\_urb() function that handles it correctly. So we just
call this function to fill in the RX URB.
Cc: Marcel Holtmann
Signed-off-by: Bing Zhao
Acked-by: Marcel Holtmann
Signed-off-by: Gustavo F. Padovan
Signed-off-by: Greg Kroah-Hartman
commit c88e98e32e1709e8cd765b701dd6fdeb08612819
Author: Sasha Levin
Date: Mon Jan 30 23:07:22 2012 -0500
module: Remove module size limit
commit f946eeb9313ff1470758e171a60fe7438a2ded3f upstream.
Module size was limited to 64MB, this was legacy limitation due to vmalloc()
which was removed a while ago.
Limiting module size to 64MB is both pointless and affects real world use
cases.
Cc: Tim Abbott
Signed-off-by: Sasha Levin
Signed-off-by: Rusty Russell
Signed-off-by: Greg Kroah-Hartman
commit 04cf7f7a565f0d2d2f5f3be56ceb6d680cba0f71
Author: Trond Myklebust
Date: Tue Mar 27 18:22:19 2012 -0400
NFSv4.1: Fix layoutcommit error handling
commit e59d27e05a6435f8c04d5ad843f37fa795f2eaaa upstream.
Firstly, task->tk\_status will always return negative error values,
so the current tests for 'NFS4ERR\_DELEG\_REVOKED' etc. are all being
ignored.
Secondly, clean up the code so that we only need to test
task->tk\_status once!
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit e5267d1f1cc43a481a599fe1e2d8256016e18825
Author: Trond Myklebust
Date: Tue Mar 27 18:13:02 2012 -0400
NFSv4: Fix two infinite loops in the mount code
commit 05e9cfb408b24debb3a85fd98edbfd09dd148881 upstream.
We can currently loop forever in nfs4\_lookup\_root() and in
nfs41\_proc\_secinfo\_no\_name(), if the first iteration returns a
NFS4ERR\_DELAY or something else that causes exception.retry to get
set.
Reported-by: Weston Andros Adamson
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 8a9de9cde83d1c913bcbe5bd8c6291f5536a576c
Author: Christoph Lameter
Date: Tue Jan 17 09:27:31 2012 -0600
slub: Do not hold slub\_lock when calling sysfs\_slab\_add()
commit 66c4c35c6bc5a1a452b024cf0364635b28fd94e4 upstream.
sysfs\_slab\_add() calls various sysfs functions that actually may
end up in userspace doing all sorts of things.
Release the slub\_lock after adding the kmem\_cache structure to the list.
At that point the address of the kmem\_cache is not known so we are
guaranteed exlusive access to the following modifications to the
kmem\_cache structure.
If the sysfs\_slab\_add fails then reacquire the slub\_lock to
remove the kmem\_cache structure from the list.
Reported-by: Sasha Levin
Acked-by: Eric Dumazet
Signed-off-by: Christoph Lameter
Signed-off-by: Pekka Enberg
Signed-off-by: Greg Kroah-Hartman
commit c45247fdfb2ddf4a96574f8dd3b6857056c20c91
Author: Jan Kara
Date: Thu Mar 15 09:34:02 2012 +0000
xfs: Fix oops on IO error during xlog\_recover\_process\_iunlinks()
commit d97d32edcd732110758799ae60af725e5110b3dc upstream.
When an IO error happens during inode deletion run from
xlog\_recover\_process\_iunlinks() filesystem gets shutdown. Thus any subsequent
attempt to read buffers fails. Code in xlog\_recover\_process\_iunlinks() does not
count with the fact that read of a buffer which was read a while ago can
really fail which results in the oops on
agi = XFS\_BUF\_TO\_AGI(agibp);
Fix the problem by cleaning up the buffer handling in
xlog\_recover\_process\_iunlinks() as suggested by Dave Chinner. We release buffer
lock but keep buffer reference to AG buffer. That is enough for buffer to stay
pinned in memory and we don't have to call xfs\_read\_agi() all the time.
Signed-off-by: Jan Kara
Reviewed-by: Dave Chinner
Signed-off-by: Ben Myers
Signed-off-by: Greg Kroah-Hartman
commit 2cbfe1645597e81c6f6af0b5245ab67cac6db027
Author: Masanari Iida
Date: Wed Mar 28 14:42:56 2012 -0700
backlight: fix typo in tosa\_lcd.c
commit 8da00edc1069f01c34510fa405dc15d96c090a3f upstream.
Fix typo in drivers/video/backlight/tosa\_lcd.c
"tosa\_lcd\_reume" should be "tosa\_lcd\_resume".
Signed-off-by: Masanari Iida
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 08c4bc38d68c073671068eb6fe54cbaa0a116b8c
Author: Joe Thornber
Date: Wed Mar 28 18:41:23 2012 +0100
dm thin: fix stacked bi\_next usage
commit 6f94a4c45a6f744383f9f695dde019998db3df55 upstream.
Avoid using the bi\_next field for the holder of a cell when deferring
bios because a stacked device below might change it. Store the
holder in a new field in struct cell instead.
When a cell is created, the bio that triggered creation (the holder) was
added to the same bio list as subsequent bios. In some cases we pass
this holder bio directly to devices underneath. If those devices use
the bi\_next field there will be trouble...
This also simplifies some code that had to work out which bio was the
holder.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit e9decde494c0960caaad20f6d5cd92d99a29dae2
Author: Joe Thornber
Date: Wed Mar 28 18:41:23 2012 +0100
dm persistent data: fix btree rebalancing after remove
commit b0988900bae9ecf968a8a8d086a9eec671a9517a upstream.
When we remove an entry from a node we sometimes rebalance with it's
two neighbours. This wasn't being done correctly; in some cases
entries have to move all the way from the right neighbour to the left
neighbour, or vice versa. This patch pretty much re-writes the
balancing code to fix it.
This code is barely used currently; only when you delete a thin
device, and then only if you have hundreds of them in the same pool.
Once we have discard support, which removes mappings, this will be used
much more heavily.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit e6958f1facf6b5369b6020a7b123a278407d25c5
Author: Andrei Warkentin
Date: Wed Mar 28 18:41:22 2012 +0100
dm exception store: fix init error path
commit aadbe266f2f89ccc68b52f4effc7b3a8b29521ef upstream.
Call the correct exit function on failure in dm\_exception\_store\_init.
Signed-off-by: Andrei Warkentin
Acked-by: Mike Snitzer
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit 33eb514c949a81198867cebfd34153f98d308b79
Author: Mikulas Patocka
Date: Wed Mar 28 18:41:22 2012 +0100
dm crypt: add missing error handling
commit 72c6e7afc43e19f68a31dea204fc366624d6eee9 upstream.
Always set io->error to -EIO when an error is detected in dm-crypt.
There were cases where an error code would be set only if we finish
processing the last sector. If there were other encryption operations in
flight, the error would be ignored and bio would be returned with
success as if no error happened.
This bug is present in kcryptd\_crypt\_write\_convert, kcryptd\_crypt\_read\_convert
and kcryptd\_async\_done.
Signed-off-by: Mikulas Patocka
Reviewed-by: Milan Broz
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit 16c69b101a905588160514815f6285be4547f998
Author: Mikulas Patocka
Date: Wed Mar 28 18:41:22 2012 +0100
dm crypt: fix mempool deadlock
commit aeb2deae2660a1773c83d3c6e9e6575daa3855d6 upstream.
This patch fixes a possible deadlock in dm-crypt's mempool use.
Currently, dm-crypt reserves a mempool of MIN\_BIO\_PAGES reserved pages.
It allocates first MIN\_BIO\_PAGES with non-failing allocation (the allocation
cannot fail and waits until the mempool is refilled). Further pages are
allocated with different gfp flags that allow failing.
Because allocations may be done in parallel, this code can deadlock. Example:
There are two processes, each tries to allocate MIN\_BIO\_PAGES and the processes
run simultaneously.
It may end up in a situation where each process allocates (MIN\_BIO\_PAGES / 2)
pages. The mempool is exhausted. Each process waits for more pages to be freed
to the mempool, which never happens.
To avoid this deadlock scenario, this patch changes the code so that only
the first page is allocated with non-failing gfp mask. Allocation of further
pages may fail.
Signed-off-by: Mikulas Patocka
Signed-off-by: Milan Broz
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit 7c2d80c67d367b9a1131de67ddd8088df3541273
Author: Sekhar Nori
Date: Sun Mar 11 18:16:12 2012 +0530
gpio/davinci: fix enabling unbanked GPIO IRQs
commit 81b279d80a63628e580c71a31d30a8c3b3047ad4 upstream.
Unbanked GPIO IRQ handling code made a copy of just
the irq\_chip structure for GPIO IRQ lines which caused
problems after the generic IRQ chip conversion because
there was no valid irq\_chip\_type structure with the
right "regs" populated. irq\_gc\_mask\_set\_bit() was
therefore accessing random addresses.
Fix it by making a copy of irq\_chip\_type structure
instead. This will ensure sane register offsets.
Reported-by: Jon Povey
Tested-by: Jon Povey
Signed-off-by: Sekhar Nori
Signed-off-by: Grant Likely
Signed-off-by: Greg Kroah-Hartman
commit 9e4e8ae49a74dbbc69b4e923ecf387154e34da8a
Author: Sekhar Nori
Date: Sun Mar 11 18:16:11 2012 +0530
gpio/davinci: fix oops on unbanked gpio irq request
commit ab2dde9924dd1ddb791fa8b14aa52e1df681e20c upstream.
Unbanked GPIO irq setup code was overwriting chip\_data leading
to the following oops on request\_irq()
Unable to handle kernel paging request at virtual address febfffff
pgd = c22dc000
[febfffff] \*pgd=00000000
Internal error: Oops: 801 [#1] PREEMPT
Modules linked in: mcu(+) edmak irqk cmemk
CPU: 0 Not tainted (3.0.0-rc7+ #93)
PC is at irq\_gc\_mask\_set\_bit+0x68/0x7c
LR is at vprintk+0x22c/0x484
pc : [] lr : [] psr: 60000093
sp : c33e3ba0 ip : c33e3af0 fp : c33e3bc4
r10: c04555bc r9 : c33d4340 r8 : 60000013
r7 : 0000002d r6 : c04555bc r5 : fec67010 r4 : 00000000
r3 : c04734c8 r2 : fec00000 r1 : ffffffff r0 : 00000026
Flags: nZCv IRQs off FIQs on Mode SVC\_32 ISA ARM Segment user
Control: 0005317f Table: 822dc000 DAC: 00000015
Process modprobe (pid: 526, stack limit = 0xc33e2270)
Stack: (0xc33e3ba0 to 0xc33e4000)
3ba0: 00000000 c007d3d4 c33e3bcc c04555bc c04555bc c33d4340 c33e3bdc c33e3bc8
3bc0: c007f5f8 c0080bb4 00000000 c04555bc c33e3bf4 c33e3be0 c007f654 c007f5c0
3be0: 00000000 c04555bc c33e3c24 c33e3bf8 c007e6e8 c007f618 c01f2284 c0350af8
3c00: c0405214 bf016c98 00000001 00000000 c33dc008 0000002d c33e3c54 c33e3c28
3c20: c007e888 c007e408 00000001 c23ef880 c33dc000 00000000 c33dc080 c25caa00
3c40: c0487498 bf017078 c33e3c94 c33e3c58 bf016b44 c007e7d4 bf017078 c33dc008
3c60: c25caa08 c33dc008 c33e3c84 bf017484 c25caa00 c25caa00 c01f5f48 c25caa08
3c80: c0496d60 bf017484 c33e3ca4 c33e3c98 c022a698 bf01692c c33e3cd4 c33e3ca8
3ca0: c01f5d88 c022a688 00000000 bf017484 c25caa00 c25caa00 c01f5f48 c25caa08
3cc0: c0496d60 00000000 c33e3cec c33e3cd8 c01f5f8c c01f5d10 00000000 c33e3cf0
3ce0: c33e3d14 c33e3cf0 c01f5210 c01f5f58 c303cb48 c25ecf94 c25caa00 c25caa00
3d00: c25caa34 c33e3dd8 c33e3d34 c33e3d18 c01f6044 c01f51b8 c0496d3c c25caa00
3d20: c044e918 c33e3dd8 c33e3d44 c33e3d38 c01f4ff4 c01f5fcc c33e3d94 c33e3d48
3d40: c01f3d10 c01f4fd8 00000000 c044e918 00000000 00000000 c01f52c0 c034d570
3d60: c33e3d84 c33e3d70 c022bf84 c25caa00 00000000 c044e918 c33e3dd8 c25c2e00
3d80: c0496d60 bf01763c c33e3db4 c33e3d98 c022b1a0 c01f384c c25caa00 c33e3dd8
3da0: 00000000 c33e3dd8 c33e3dd4 c33e3db8 c022b27c c022b0e8 00000000 bf01763c
3dc0: c0451c80 c33e3dd8 c33e3e34 c33e3dd8 bf016f60 c022b210 5f75636d 746e6f63
3de0: 006c6f72 00000000 00000000 00000000 00000000 00000000 00000000 bf0174bc
3e00: 00000000 00989680 00000000 00000020 c0451c80 c0451c80 bf0174dc c01f5eb0
3e20: c33f0f00 bf0174dc c33e3e44 c33e3e38 c01f72f4 bf016e2c c33e3e74 c33e3e48
3e40: c01f5d88 c01f72e4 00000000 c0451c80 c0451cb4 bf0174dc c01f5eb0 c33f0f00
3e60: c0473100 00000000 c33e3e94 c33e3e78 c01f5f44 c01f5d10 00000000 c33e3e98
3e80: bf0174dc c01f5eb0 c33e3ebc c33e3e98 c01f5534 c01f5ec0 c303c038 c3061c30
3ea0: 00003cd8 00098258 bf0174dc c0462ac8 c33e3ecc c33e3ec0 c01f5bec c01f54dc
3ec0: c33e3efc c33e3ed0 c01f4d30 c01f5bdc bf0173a0 c33e2000 00003cd8 00098258
3ee0: bf0174dc c33e2000 c00301a4 bf019000 c33e3f1c c33e3f00 c01f6588 c01f4c8c
3f00: 00003cd8 00098258 00000000 c33e2000 c33e3f2c c33e3f20 c01f777c c01f6524
3f20: c33e3f3c c33e3f30 bf019014 c01f7740 c33e3f7c c33e3f40 c002f3ec bf019010
3f40: 00000000 00003cd8 00098258 bf017518 00000000 00003cd8 00098258 bf017518
3f60: 00000000 c00301a4 c33e2000 00000000 c33e3fa4 c33e3f80 c007b934 c002f3c4
3f80: c00b307c c00b2f48 00003cd8 00000000 00000003 00000080 00000000 c33e3fa8
3fa0: c0030020 c007b8b8 00003cd8 00000000 00098288 00003cd8 00098258 00098240
3fc0: 00003cd8 00000000 00000003 00000080 00098008 00098028 00098288 00000001
3fe0: be892998 be892988 00013d7c 40178740 60000010 00098288 09089041 00200845
Backtrace:
[] (irq\_gc\_mask\_set\_bit+0x0/0x7c) from [] (irq\_enable+0x48/0x58)
r6:c33d4340 r5:c04555bc r4:c04555bc
[] (irq\_enable+0x0/0x58) from [] (irq\_startup+0x4c/0x54)
r5:c04555bc r4:00000000
[] (irq\_startup+0x0/0x54) from [] (\_\_setup\_irq+0x2f0/0x3cc)
r5:c04555bc r4:00000000
[] (\_\_setup\_irq+0x0/0x3cc) from [] (request\_threaded\_irq+0xc4/0x110)
r8:0000002d r7:c33dc008 r6:00000000 r5:00000001 r4:bf016c98
[] (request\_threaded\_irq+0x0/0x110) from [] (mcu\_spi\_probe+0x228/0x37c [mcu])
[] (mcu\_spi\_probe+0x0/0x37c [mcu]) from [] (spi\_drv\_probe+0x20/0x24)
[] (spi\_drv\_probe+0x0/0x24) from [] (driver\_probe\_device+0x88/0x1b0)
[] (driver\_probe\_device+0x0/0x1b0) from [] (\_\_device\_attach+0x44/0x48)
[] (\_\_device\_attach+0x0/0x48) from [] (bus\_for\_each\_drv+0x68/0x94)
r5:c33e3cf0 r4:00000000
[] (bus\_for\_each\_drv+0x0/0x94) from [] (device\_attach+0x88/0xa0)
r7:c33e3dd8 r6:c25caa34 r5:c25caa00 r4:c25caa00
[] (device\_attach+0x0/0xa0) from [] (bus\_probe\_device+0x2c/0x4c)
r7:c33e3dd8 r6:c044e918 r5:c25caa00 r4:c0496d3c
[] (bus\_probe\_device+0x0/0x4c) from [] (device\_add+0x4d4/0x648)
[] (device\_add+0x0/0x648) from [] (spi\_add\_device+0xc8/0x128)
[] (spi\_add\_device+0x0/0x128) from [] (spi\_new\_device+0x7c/0xb4)
r7:c33e3dd8 r6:00000000 r5:c33e3dd8 r4:c25caa00
[] (spi\_new\_device+0x0/0xb4) from [] (mcu\_probe+0x144/0x224 [mcu])
r7:c33e3dd8 r6:c0451c80 r5:bf01763c r4:00000000
[] (mcu\_probe+0x0/0x224 [mcu]) from [] (platform\_drv\_probe+0x20/0x24)
[] (platform\_drv\_probe+0x0/0x24) from [] (driver\_probe\_device+0x88/0x1b0)
[] (driver\_probe\_device+0x0/0x1b0) from [] (\_\_driver\_attach+0x94/0x98)
[] (\_\_driver\_attach+0x0/0x98) from [] (bus\_for\_each\_dev+0x68/0x94)
r7:c01f5eb0 r6:bf0174dc r5:c33e3e98 r4:00000000
[] (bus\_for\_each\_dev+0x0/0x94) from [] (driver\_attach+0x20/0x28)
r7:c0462ac8 r6:bf0174dc r5:00098258 r4:00003cd8
[] (driver\_attach+0x0/0x28) from [] (bus\_add\_driver+0xb4/0x258)
[] (bus\_add\_driver+0x0/0x258) from [] (driver\_register+0x74/0x158)
[] (driver\_register+0x0/0x158) from [] (platform\_driver\_register+0x4c/0x60)
r7:c33e2000 r6:00000000 r5:00098258 r4:00003cd8
[] (platform\_driver\_register+0x0/0x60) from [] (mcu\_init+0x14/0x20 [mcu])
[] (mcu\_init+0x0/0x20 [mcu]) from [] (do\_one\_initcall+0x38/0x170)
[] (do\_one\_initcall+0x0/0x170) from [] (sys\_init\_module+0x8c/0x1a4)
[] (sys\_init\_module+0x0/0x1a4) from [] (ret\_fast\_syscall+0x0/0x2c)
r7:00000080 r6:00000003 r5:00000000 r4:00003cd8
Code: e1844003 e585400c e596300c e5932064 (e7814002)
Fix the issue.
Reported-by: Jon Povey
Signed-off-by: Sekhar Nori
Signed-off-by: Grant Likely
Signed-off-by: Greg Kroah-Hartman
commit c43d4b949b856e428d4c1f3c7d4533e40d3bbe67
Author: Tarun Kanti DebBarma
Date: Fri Nov 25 15:27:37 2011 +0530
gpio/omap: fix \_set\_gpio\_irqenable implementation
commit 8276536cec38bc6bde30d0aa67716f22b9b9705a upstream.
This function should be capable of both enabling and disabling interrupts
based upon the \*enable\* parameter. Right now the function only enables
the interrupt and \*enable\* is not used at all. So add the interrupt
disable capability also using the parameter.
Signed-off-by: Tarun Kanti DebBarma
Reviewed-by: Santosh Shilimkar
Acked-by: Felipe Balbi
Reviewed-by: Kevin Hilman
Signed-off-by: Kevin Hilman
Signed-off-by: Greg Kroah-Hartman
commit 712f04ff3aea5f7cc284df68f93b1eacb5cb0fa2
Author: Jan Kara
Date: Mon Feb 20 17:49:56 2012 +0100
udf: Fix deadlock in udf\_release\_file()
commit a0391a3ae91d301c0e59368531a4de5f0b122bcf upstream.
udf\_release\_file() can be called from munmap() path with mmap\_sem held. Thus
we cannot take i\_mutex there because that ranks above mmap\_sem. Luckily,
i\_mutex is not needed in udf\_release\_file() anymore since protection by
i\_data\_sem is enough to protect from races with write and truncate.
Reported-by: Al Viro
Reviewed-by: Namjae Jeon
Signed-off-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 83e41946441048f5d30f2022dda519b4b58c9ad8
Author: Stephen Warren
Date: Tue Feb 14 13:39:39 2012 -0700
ARM: tegra: select required CPU and L2 errata options
commit f35b431dde39fb40944d1024f08d88fbf04a3193 upstream.
The ARM IP revisions in Tegra are:
Tegra20: CPU r1p1, PL310 r2p0
Tegra30: CPU A01=r2p7/>=A02=r2p9, NEON r2p3-50, PL310 r3p1-50
Based on work by Olof Johansson, although the actual list of errata is
somewhat different here, since I added a bunch more and removed one PL310
erratum that doesn't seem applicable.
Signed-off-by: Stephen Warren
Signed-off-by: Olof Johansson
Signed-off-by: Greg Kroah-Hartman
commit d27e4c282e8445be329e4e3544ea5e9d4dfdc953
Author: Michel Lespinasse
Date: Mon Mar 26 17:32:44 2012 -0700
vfs: fix d\_ancestor() case in d\_materialize\_unique
commit b18dafc86bb879d2f38a1743985d7ceb283c2f4d upstream.
In d\_materialise\_unique() there are 3 subcases to the 'aliased dentry'
case; in two subcases the inode i\_lock is properly released but this
does not occur in the -ELOOP subcase.
This seems to have been introduced by commit 1836750115f2 ("fix loop
checks in d\_materialise\_unique()").
Signed-off-by: Michel Lespinasse
[ Added a comment, and moved the unlock to where we generate the -ELOOP,
which seems to be more natural.
You probably can't actually trigger this without a buggy network file
server - d\_materialize\_unique() is for finding aliases on non-local
filesystems, and the d\_ancestor() case is for a hardlinked directory
loop.
But we should be robust in the case of such buggy servers anyway. ]
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit ac35405d20c0bd438cea6e9dddd84335370c739e
Author: Theodore Ts'o
Date: Sun Mar 11 23:30:16 2012 -0400
ext4: check for zero length extent
commit 31d4f3a2f3c73f279ff96a7135d7202ef6833f12 upstream.
Explicitly test for an extent whose length is zero, and flag that as a
corrupted extent.
This avoids a kernel BUG\_ON assertion failure.
Tested: Without this patch, the file system image found in
tests/f\_ext\_zero\_len/image.gz in the latest e2fsprogs sources causes a
kernel panic. With this patch, an ext4 file system error is noted
instead, and the file system is marked as being corrupted.
https://bugzilla.kernel.org/show\_bug.cgi?id=42859
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 3b9dbd4b410c4b2dc27c71fab78e4dff9b29e14c
Author: Jeff Moyer
Date: Mon Mar 5 10:29:52 2012 -0500
ext4: fix race between sync and completed io work
commit 491caa43639abcffaa645fbab372a7ef4ce2975c upstream.
The following command line will leave the aio-stress process unkillable
on an ext4 file system (in my case, mounted on /mnt/test):
aio-stress -t 20 -s 10 -O -S -o 2 -I 1000 /mnt/test/aiostress.3561.4 /mnt/test/aiostress.3561.4.20 /mnt/test/aiostress.3561.4.19 /mnt/test/aiostress.3561.4.18 /mnt/test/aiostress.3561.4.17 /mnt/test/aiostress.3561.4.16 /mnt/test/aiostress.3561.4.15 /mnt/test/aiostress.3561.4.14 /mnt/test/aiostress.3561.4.13 /mnt/test/aiostress.3561.4.12 /mnt/test/aiostress.3561.4.11 /mnt/test/aiostress.3561.4.10 /mnt/test/aiostress.3561.4.9 /mnt/test/aiostress.3561.4.8 /mnt/test/aiostress.3561.4.7 /mnt/test/aiostress.3561.4.6 /mnt/test/aiostress.3561.4.5 /mnt/test/aiostress.3561.4.4 /mnt/test/aiostress.3561.4.3 /mnt/test/aiostress.3561.4.2
This is using the aio-stress program from the xfstests test suite.
That particular command line tells aio-stress to do random writes to
20 files from 20 threads (one thread per file). The files are NOT
preallocated, so you will get writes to random offsets within the
file, thus creating holes and extending i\_size. It also opens the
file with O\_DIRECT and O\_SYNC.
On to the problem. When an I/O requires unwritten extent conversion,
it is queued onto the completed\_io\_list for the ext4 inode. Two code
paths will pull work items from this list. The first is the
ext4\_end\_io\_work routine, and the second is ext4\_flush\_completed\_IO,
which is called via the fsync path (and O\_SYNC handling, as well).
There are two issues I've found in these code paths. First, if the
fsync path beats the work routine to a particular I/O, the work
routine will free the io\_end structure! It does not take into account
the fact that the io\_end may still be in use by the fsync path. I've
fixed this issue by adding yet another IO\_END flag, indicating that
the io\_end is being processed by the fsync path.
The second problem is that the work routine will make an assignment to
io->flag outside of the lock. I have witnessed this result in a hang
at umount. Moving the flag setting inside the lock resolved that
problem.
The problem was introduced by commit b82e384c7b ("ext4: optimize
locking for end\_io extent conversion"), which first appeared in 3.2.
As such, the fix should be backported to that release (probably along
with the unwritten extent conversion race fix).
Signed-off-by: Jeff Moyer
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 8608fb78b2cbf9eb8794e592bf43a8b1884c5a85
Author: Jeff Moyer
Date: Mon Feb 20 17:59:24 2012 -0500
ext4: fix race between unwritten extent conversion and truncate
commit 266991b13890049ee1a6bb95b9817f06339ee3d7 upstream.
The following comment in ext4\_end\_io\_dio caught my attention:
/\* XXX: probably should move into the real I/O completion handler \*/
inode\_dio\_done(inode);
The truncate code takes i\_mutex, then calls inode\_dio\_wait. Because the
ext4 code path above will end up dropping the mutex before it is
reacquired by the worker thread that does the extent conversion, it
seems to me that the truncate can happen out of order. Jan Kara
mentioned that this might result in error messages in the system logs,
but that should be the extent of the "damage."
The fix is pretty straight-forward: don't call inode\_dio\_done until the
extent conversion is complete.
Reviewed-by: Jan Kara
Signed-off-by: Jeff Moyer
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 0b9af6daefb3de24ba6c32df234cca448ec76b18
Author: Lukas Czerner
Date: Mon Feb 20 17:53:00 2012 -0500
ext4: ignore EXT4\_INODE\_JOURNAL\_DATA flag with delalloc
commit 3d2b158262826e8b75bbbfb7b97010838dd92ac7 upstream.
Ext4 does not support data journalling with delayed allocation enabled.
We even do not allow to mount the file system with delayed allocation
and data journalling enabled, however it can be set via FS\_IOC\_SETFLAGS
so we can hit the inode with EXT4\_INODE\_JOURNAL\_DATA set even on file
system mounted with delayed allocation (default) and that's where
problem arises. The easies way to reproduce this problem is with the
following set of commands:
mkfs.ext4 /dev/sdd
mount /dev/sdd /mnt/test1
dd if=/dev/zero of=/mnt/test1/file bs=1M count=4
chattr +j /mnt/test1/file
dd if=/dev/zero of=/mnt/test1/file bs=1M count=4 conv=notrunc
chattr -j /mnt/test1/file
Additionally it can be reproduced quite reliably with xfstests 272 and
269. In fact the above reproducer is a part of test 272.
To fix this we should ignore the EXT4\_INODE\_JOURNAL\_DATA inode flag if
the file system is mounted with delayed allocation. This can be easily
done by fixing ext4\_should\_\*\_data() functions do ignore data journal
flag when delalloc is set (suggested by Ted). We also have to set the
appropriate address space operations for the inode (again, ignoring data
journal flag if delalloc enabled).
Additionally this commit introduces ext4\_inode\_journal\_mode() function
because ext4\_should\_\*\_data() has already had a lot of common code and
this change is putting it all into one function so it is easier to
read.
Successfully tested with xfstests in following configurations:
delalloc + data=ordered
delalloc + data=writeback
data=journal
nodelalloc + data=ordered
nodelalloc + data=writeback
nodelalloc + data=journal
Signed-off-by: Lukas Czerner
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 146af184d533e62fc55ecd2cca925d3c072b5afc
Author: Eric Sandeen
Date: Mon Feb 20 17:53:01 2012 -0500
jbd2: clear BH\_Delay & BH\_Unwritten in journal\_unmap\_buffer
commit 15291164b22a357cb211b618adfef4fa82fc0de3 upstream.
journal\_unmap\_buffer()'s zap\_buffer: code clears a lot of buffer head
state ala discard\_buffer(), but does not touch \_Delay or \_Unwritten as
discard\_buffer() does.
This can be problematic in some areas of the ext4 code which assume
that if they have found a buffer marked unwritten or delay, then it's
a live one. Perhaps those spots should check whether it is mapped
as well, but if jbd2 is going to tear down a buffer, let's really
tear it down completely.
Without this I get some fsx failures on sub-page-block filesystems
up until v3.2, at which point 4e96b2dbbf1d7e81f22047a50f862555a6cb87cb
and 189e868fa8fdca702eb9db9d8afc46b5cb9144c9 make the failures go
away, because buried within that large change is some more flag
clearing. I still think it's worth doing in jbd2, since
->invalidatepage leads here directly, and it's the right place
to clear away these flags.
Signed-off-by: Eric Sandeen
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 4b952bf66061416f9da18ce8ff54d01808220480
Author: Srivatsa S. Bhat
Date: Fri Feb 17 23:39:51 2012 +0100
PM / Hibernate: Enable usermodehelpers in hibernate() error path
commit 05b4877f6a4f1ba4952d1222213d262bf8c132b7 upstream.
If create\_basic\_memory\_bitmaps() fails, usermodehelpers are not re-enabled
before returning. Fix this. And while at it, reword the goto labels so that
they look more meaningful.
Signed-off-by: Srivatsa S. Bhat
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 49341010d998c15e7fa18b473ea7af6d7b9f3571
Author: Trond Myklebust
Date: Mon Mar 12 18:01:48 2012 -0400
NFSv4: Rate limit the state manager warning messages
commit 9a3ba432330e504ac61ff0043dbdaba7cea0e35a upstream.
Prevent the state manager from filling up system logs when recovery
fails on the server.
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 25c67995203d092a3ab6860ddb84050cab745efe
Author: Michael Krufky
Date: Sun Mar 18 14:35:57 2012 -0300
mxl111sf: fix error on stream stop in mxl111sf\_ep6\_streaming\_ctrl()
commit 3be5bb71fbf18f83cb88b54a62a78e03e5a4f30a upstream.
Remove unnecessary register access in mxl111sf\_ep6\_streaming\_ctrl()
This code breaks driver operation in kernel 3.3 and later, although
it works properly in 3.2 Disable register access to 0x12 for now.
Signed-off-by: Michael Krufky
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 58f3dcce144cf88dedeb89250545ae242532b3c9
Author: Michael Krufky
Date: Tue Feb 7 13:28:33 2012 -0300
pvrusb2: fix 7MHz & 8MHz DVB-T tuner support for HVR1900 rev D1F5
commit 9ab2393fc3e460cd2040de1483918eb17abb822f upstream.
The D1F5 revision of the WinTV HVR-1900 uses a tda18271c2 tuner
instead of a tda18271c1 tuner as used in revision D1E9. To
account for this, we must hardcode the frontend configuration
to use the same IF frequency configuration for both revisions
of the device.
6MHz DVB-T is unaffected by this issue, as the recommended
IF Frequency configuration for 6MHz DVB-T is the same on both
c1 and c2 revisions of the tda18271 tuner.
Signed-off-by: Michael Krufky
Cc: Mike Isely
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 13c7e19eac321c1a19ab723b17e215d8e61a6c13
Author: Xi Wang
Date: Tue Feb 14 14:32:41 2012 -0300
lgdt330x: fix signedness error in i2c\_read\_demod\_bytes()
commit 34817174fca0c5512c2d5b6ea0fc37a0337ce1d8 upstream.
The error handling in lgdt3303\_read\_status() and lgdt330x\_read\_ucblocks()
doesn't work, because i2c\_read\_demod\_bytes() returns a u8 and (err < 0)
is always false.
err = i2c\_read\_demod\_bytes(state, 0x58, buf, 1);
if (err < 0)
return err;
Change the return type of i2c\_read\_demod\_bytes() to int. Also change
the return value on error to -EIO to make (err < 0) work.
Signed-off-by: Xi Wang
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit e60a74019cd11c51dce802a60a5c604b4f7735a1
Author: Andreas Herrmann
Date: Fri Mar 23 10:02:17 2012 +0100
hwmon: (fam15h\_power) Correct sign extension of running\_avg\_capture
commit fc0900cbda9243957d812cd6b4cc87965f9fe75f upstream.
Wrong bit was used for sign extension which caused wrong end results.
Thanks to Andre for spotting this bug.
Reported-by: Andre Przywara
Signed-off-by: Andreas Herrmann
Acked-by: Guenter Roeck
Signed-off-by: Jean Delvare
Signed-off-by: Greg Kroah-Hartman
commit eebfd5e734d12b915ebff75690e63e80678f3609
Author: Lucas De Marchi
Date: Thu Mar 22 14:42:22 2012 -0700
sysctl: protect poll() in entries that may go away
commit 4e474a00d7ff746ed177ddae14fa8b2d4bad7a00 upstream.
Protect code accessing ctl\_table by grabbing the header with grab\_header()
and after releasing with sysctl\_head\_finish(). This is needed if poll()
is called in entries created by modules: currently only hostname and
domainname support poll(), but this bug may be triggered when/if modules
use it and if user called poll() in a file that doesn't support it.
Dave Jones reported the following when using a syscall fuzzer while
hibernating/resuming:
RIP: 0010:[] [] proc\_sys\_poll+0x4e/0x90
RAX: 0000000000000145 RBX: ffff88020cab6940 RCX: 0000000000000000
RDX: ffffffff81233df0 RSI: 6b6b6b6b6b6b6b6b RDI: ffff88020cab6940
[ ... ]
Code: 00 48 89 fb 48 89 f1 48 8b 40 30 4c 8b 60 e8 b8 45 01 00 00 49 83
7c 24 28 00 74 2e 49 8b 74 24 30 48 85 f6 74 24 48 85 c9 75 32 <8b> 16
b8 45 01 00 00 48 63 d2 49 39 d5 74 10 8b 06 48 98 48 89
If an entry goes away while we are polling() it, ctl\_table may not exist
anymore.
Reported-by: Dave Jones
Signed-off-by: Lucas De Marchi
Cc: Al Viro
Cc: Linus Torvalds
Cc: Alexey Dobriyan
Signed-off-by: Andrew Morton
Signed-off-by: Eric W. Biederman
Signed-off-by: Greg Kroah-Hartman
commit ab153f21e011985dbe056f8780c31d823db8948e
Author: Steffen Persvold
Date: Thu Mar 15 15:20:29 2012 +0100
iommu/amd: Fix section warning for prealloc\_protection\_domains
commit cebd5fa4d3046d5b43ce1836a0120612822a7fb0 upstream.
Fix the following section warning in drivers/iommu/amd\_iommu.c :
WARNING: vmlinux.o(.text+0x526e77): Section mismatch in reference from the function prealloc\_protection\_domains() to the function .init.text:alloc\_passthrough\_domain()
The function prealloc\_protection\_domains() references
the function \_\_init alloc\_passthrough\_domain().
This is often because prealloc\_protection\_domains lacks a \_\_init
annotation or the annotation of alloc\_passthrough\_domain is wrong.
Signed-off-by: Steffen Persvold
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 4177c3642343a0a3ada8a8ee54628daa4b2d065d
Author: Pravin B Shelar
Date: Fri Mar 23 15:02:55 2012 -0700
proc-ns: use d\_set\_d\_op() API to set dentry ops in proc\_ns\_instantiate().
commit 1b26c9b334044cff6d1d2698f2be41bc7d9a0864 upstream.
The namespace cleanup path leaks a dentry which holds a reference count
on a network namespace. Keeping that network namespace from being freed
when the last user goes away. Leaving things like vlan devices in the
leaked network namespace.
If you use ip netns add for much real work this problem becomes apparent
pretty quickly. It light testing the problem hides because frequently
you simply don't notice the leak.
Use d\_set\_d\_op() so that DCACHE\_OP\_\* flags are set correctly.
This issue exists back to 3.0.
Acked-by: "Eric W. Biederman"
Reported-by: Justin Pettit
Signed-off-by: Pravin B Shelar
Signed-off-by: Jesse Gross
Cc: David Miller
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c0bea34d0e5acbca09db615a3a9ea891c2ff0a4f
Author: Dmitry Adamushko
Date: Thu Mar 22 21:39:25 2012 +0100
x86-32: Fix endless loop when processing signals for kernel tasks
commit 29a2e2836ff9ea65a603c89df217f4198973a74f upstream.
The problem occurs on !CONFIG\_VM86 kernels [1] when a kernel-mode task
returns from a system call with a pending signal.
A real-life scenario is a child of 'khelper' returning from a failed
kernel\_execve() in \_\_\_\_call\_usermodehelper() [ kernel/kmod.c ].
kernel\_execve() fails due to a pending SIGKILL, which is the result of
"kill -9 -1" (at least, busybox's init does it upon reboot).
The loop is as follows:
\* syscall\_exit\_work:
- work\_pending: // start\_of\_the\_loop
- work\_notify\_sig:
- do\_notify\_resume()
- do\_signal()
- if (!user\_mode(regs)) return;
- resume\_userspace // TIF\_SIGPENDING is still set
- work\_pending // so we call work\_pending => goto
// start\_of\_the\_loop
More information can be found in another LKML thread:
http://www.serverphorums.com/read.php?12,457826
[1] the problem was also seen on MIPS.
Signed-off-by: Dmitry Adamushko
Link: http://lkml.kernel.org/r/1332448765.2299.68.camel@dimm
Cc: Oleg Nesterov
Cc: Roland McGrath
Cc: Andrew Morton
Signed-off-by: H. Peter Anvin
Signed-off-by: Greg Kroah-Hartman
commit eafb50b40d5fc72ad3e31ff07dab4f98dd76027e
Author: Jeff Kirsher
Date: Fri Nov 18 14:25:00 2011 +0000
e1000e: Avoid wrong check on TX hang
commit 09357b00255c233705b1cf6d76a8d147340545b8 upstream.
Based on the original patch submitted my Michael Wang
.
Descriptors may not be write-back while checking TX hang with flag
FLAG2\_DMA\_BURST on.
So when we detect hang, we just flush the descriptor and detect
again for once.
-v2 change 1 to true and 0 to false and remove extra ()
CC: Michael Wang
CC: Flavio Leitner
Acked-by: Jesse Brandeburg
Tested-by: Aaron Brown
Signed-off-by: Jeff Kirsher
Signed-off-by: Greg Kroah-Hartman
commit 4f68ac2aaf52ed31f7d97a6542571f0f7efd7d2e
Author: tom.leiming@gmail.com
Date: Thu Mar 22 03:22:38 2012 +0000
usbnet: don't clear urb->dev in tx\_complete
commit 5d5440a835710d09f0ef18da5000541ec98b537a upstream.
URB unlinking is always racing with its completion and tx\_complete
may be called before or during running usb\_unlink\_urb, so tx\_complete
must not clear urb->dev since it will be used in unlink path,
otherwise invalid memory accesses or usb device leak may be caused
inside usb\_unlink\_urb.
Cc: Alan Stern
Cc: Oliver Neukum
Signed-off-by: Ming Lei
Acked-by: Greg Kroah-Hartman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0cc3dc325e20418548edc6571c80d4ae4bffb153
Author: tom.leiming@gmail.com
Date: Thu Mar 22 03:22:18 2012 +0000
usbnet: increase URB reference count before usb\_unlink\_urb
commit 0956a8c20b23d429e79ff86d4325583fc06f9eb4 upstream.
Commit 4231d47e6fe69f061f96c98c30eaf9fb4c14b96d(net/usbnet: avoid
recursive locking in usbnet\_stop()) fixes the recursive locking
problem by releasing the skb queue lock, but it makes usb\_unlink\_urb
racing with defer\_bh, and the URB to being unlinked may be freed before
or during calling usb\_unlink\_urb, so use-after-free problem may be
triggerd inside usb\_unlink\_urb.
The patch fixes the use-after-free problem by increasing URB
reference count with skb queue lock held before calling
usb\_unlink\_urb, so the URB won't be freed until return from
usb\_unlink\_urb.
Cc: Sebastian Andrzej Siewior
Cc: Alan Stern
Cc: Oliver Neukum
Reported-by: Dave Jones
Signed-off-by: Ming Lei
Acked-by: Greg Kroah-Hartman
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b8d535ac89519bda67bc3cab419a29953b1eb74e
Author: Trond Myklebust
Date: Mon Mar 19 13:39:35 2012 -0400
SUNRPC: We must not use list\_for\_each\_entry\_safe() in rpc\_wake\_up()
commit 540a0f7584169651f485e8ab67461fcb06934e38 upstream.
The problem is that for the case of priority queues, we
have to assume that \_\_rpc\_remove\_wait\_queue\_priority will move new
elements from the tk\_wait.links lists into the queue->tasks[] list.
We therefore cannot use list\_for\_each\_entry\_safe() on queue->tasks[],
since that will skip these new tasks that \_\_rpc\_remove\_wait\_queue\_priority
is adding.
Without this fix, rpc\_wake\_up and rpc\_wake\_up\_status will both fail
to wake up all functions on priority wait queues, which can result
in some nasty hangs.
Reported-by: Andy Adamson
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 8617e195f2213c885c5aae3578c545a5ace9477b
Author: Artem Bityutskiy
Date: Wed Mar 7 19:08:36 2012 +0200
UBI: fix eraseblock picking criteria
commit 7eb3aa65853e1b223bfc786b023b702018cb76c0 upstream.
The 'find\_wl\_entry()' function expects the maximum difference as the second
argument, not the maximum absolute value. So the "unknown" eraseblock picking
was incorrect, as Shmulik Ladkani spotted. This patch fixes the issue.
Reported-by: Shmulik Ladkani
Signed-off-by: Artem Bityutskiy
Reviewed-by: Shmulik Ladkani
Signed-off-by: Greg Kroah-Hartman
commit ab053f76fec843ab4db48390319de701d654e9a1
Author: Richard Weinberger
Date: Mon Jan 30 18:20:13 2012 +0100
UBI: fix error handling in ubi\_scan()
commit a29852be492d61001d86c6ebf5fff9b93d7b4be9 upstream.
Two bad things can happen in ubi\_scan():
1. If kmem\_cache\_create() fails we jump to out\_si and call
ubi\_scan\_destroy\_si() which calls kmem\_cache\_destroy().
But si->scan\_leb\_slab is NULL.
2. If process\_eb() fails we jump to out\_vidh, call
kmem\_cache\_destroy() and ubi\_scan\_destroy\_si() which calls
again kmem\_cache\_destroy().
Signed-off-by: Richard Weinberger
Signed-off-by: Artem Bityutskiy
Signed-off-by: Greg Kroah-Hartman
commit 81555664cb1238f44c7363061d1a48f0761b2dd8
Author: Pavel Shilovsky
Date: Sat Mar 17 09:46:55 2012 +0300
CIFS: Fix a spurious error in cifs\_push\_posix\_locks
commit ce85852b90a214cf577fc1b4f49d99fd7e98784a upstream.
Signed-off-by: Pavel Shilovsky
Reviewed-by: Jeff Layton
Reported-by: Ben Hutchings
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit b38efc0924987777790559e4ec34cc693ce02c0b
Author: Jeff Layton
Date: Wed Mar 21 06:30:40 2012 -0400
cifs: fix issue mounting of DFS ROOT when redirecting from one domain controller to the next
commit 1daaae8fa4afe3df78ca34e724ed7e8187e4eb32 upstream.
This patch fixes an issue when cifs\_mount receives a
STATUS\_BAD\_NETWORK\_NAME error during cifs\_get\_tcon but is able to
continue after an DFS ROOT referral. In this case, the return code
variable is not reset prior to trying to mount from the system referred
to. Thus, is\_path\_accessible is not executed and the final DFS referral
is not performed causing a mount error.
Use case: In DNS, example.com resolves to the secondary AD server
ad2.example.com Our primary domain controller is ad1.example.com and has
a DFS redirection set up from \\ad1\share\Users to \\files\share\Users.
Mounting \\example.com\share\Users fails.
Regression introduced by commit 724d9f1.
Reviewed-by: Pavel Shilovsky
Signed-off-by: Jeff Layton
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit a3f7edf2fcb8e3e9c530c596a6c07479aeed418b
Author: Pavel Shilovsky
Date: Tue Mar 20 12:55:09 2012 +0300
CIFS: Respect negotiated MaxMpxCount
commit 10b9b98e41ba248a899f6175ce96ee91431b6194 upstream.
Some servers sets this value less than 50 that was hardcoded and
we lost the connection if when we exceed this limit. Fix this by
respecting this value - not sending more than the server allows.
Reviewed-by: Jeff Layton
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit cebef762efaa200ad00134a14c88374c6faaac6d
Author: Dave Chinner
Date: Wed Mar 7 04:50:25 2012 +0000
xfs: fix inode lookup race
commit f30d500f809eca67a21704347ab14bb35877b5ee upstream.
When we get concurrent lookups of the same inode that is not in the
per-AG inode cache, there is a race condition that triggers warnings
in unlock\_new\_inode() indicating that we are initialising an inode
that isn't in a the correct state for a new inode.
When we do an inode lookup via a file handle or a bulkstat, we don't
serialise lookups at a higher level through the dentry cache (i.e.
pathless lookup), and so we can get concurrent lookups of the same
inode.
The race condition is between the insertion of the inode into the
cache in the case of a cache miss and a concurrently lookup:
Thread 1 Thread 2
xfs\_iget()
xfs\_iget\_cache\_miss()
xfs\_iread()
lock radix tree
radix\_tree\_insert()
rcu\_read\_lock
radix\_tree\_lookup
lock inode flags
XFS\_INEW not set
igrab()
unlock inode flags
rcu\_read\_unlock
use uninitialised inode
.....
lock inode flags
set XFS\_INEW
unlock inode flags
unlock radix tree
xfs\_setup\_inode()
inode flags = I\_NEW
unlock\_new\_inode()
WARNING as inode flags != I\_NEW
This can lead to inode corruption, inode list corruption, etc, and
is generally a bad thing to occur.
Fix this by setting XFS\_INEW before inserting the inode into the
radix tree. This will ensure any concurrent lookup will find the new
inode with XFS\_INEW set and that forces the lookup to wait until the
XFS\_INEW flag is removed before allowing the lookup to succeed.
Signed-off-by: Dave Chinner
Reviewed-by: Christoph Hellwig
Signed-off-by: Ben Myers
Signed-off-by: Greg Kroah-Hartman
commit 12a2bb2225a1636d291af1714ac6da2b2947ced8
Author: Trond Myklebust
Date: Wed Mar 7 16:39:06 2012 -0500
NFSv4: Return the delegation if the server returns NFS4ERR\_OPENMODE
commit 3114ea7a24d3264c090556a2444fc6d2c06176d4 upstream.
If a setattr() fails because of an NFS4ERR\_OPENMODE error, it is
probably due to us holding a read delegation. Ensure that the
recovery routines return that delegation in this case.
Reported-by: Miklos Szeredi
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 7be1e5fdc0b3932ab0882820f69e27769bfd9d70
Author: Trond Myklebust
Date: Mon Mar 5 19:56:44 2012 -0500
NFS: Properly handle the case where the delegation is revoked
commit a1d0b5eebc4fd6e0edb02688b35f17f67f42aea5 upstream.
If we know that the delegation stateid is bad or revoked, we need to
remove that delegation as soon as possible, and then mark all the
stateids that relied on that delegation for recovery. We cannot use
the delegation as part of the recovery process.
Also note that NFSv4.1 uses a different error code (NFS4ERR\_DELEG\_REVOKED)
to indicate that the delegation was revoked.
Finally, ensure that setlk() and setattr() can both recover safely from
a revoked delegation.
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit c401f604a75970a1e5c2718232b3c4c2060a3ee8
Author: Stephan Bärwolf
Date: Thu Jan 12 16:43:04 2012 +0100
KVM: x86: fix missing checks in syscall emulation
commit c2226fc9e87ba3da060e47333657cd6616652b84 upstream.
On hosts without this patch, 32bit guests will crash (and 64bit guests
may behave in a wrong way) for example by simply executing following
nasm-demo-application:
[bits 32]
global \_start
SECTION .text
\_start: syscall
(I tested it with winxp and linux - both always crashed)
Disassembly of section .text:
00000000 <\_start>:
0: 0f 05 syscall
The reason seems a missing "invalid opcode"-trap (int6) for the
syscall opcode "0f05", which is not available on Intel CPUs
within non-longmodes, as also on some AMD CPUs within legacy-mode.
(depending on CPU vendor, MSR\_EFER and cpuid)
Because previous mentioned OSs may not engage corresponding
syscall target-registers (STAR, LSTAR, CSTAR), they remain
NULL and (non trapping) syscalls are leading to multiple
faults and finally crashs.
Depending on the architecture (AMD or Intel) pretended by
guests, various checks according to vendor's documentation
are implemented to overcome the current issue and behave
like the CPUs physical counterparts.
[mtosatti: cleanup/beautify code]
Signed-off-by: Stephan Baerwolf
Signed-off-by: Marcelo Tosatti
Signed-off-by: Stefan Bader
Signed-off-by: Greg Kroah-Hartman
commit 90509a557798a023b3f5c46bebae62aa00e5da2a
Author: Stephan Bärwolf
Date: Thu Jan 12 16:43:03 2012 +0100
KVM: x86: extend "struct x86\_emulate\_ops" with "get\_cpuid"
commit bdb42f5afebe208eae90406959383856ae2caf2b upstream.
In order to be able to proceed checks on CPU-specific properties
within the emulator, function "get\_cpuid" is introduced.
With "get\_cpuid" it is possible to virtually call the guests
"cpuid"-opcode without changing the VM's context.
[mtosatti: cleanup/beautify code]
Signed-off-by: Stephan Baerwolf
Signed-off-by: Marcelo Tosatti
Signed-off-by: Stefan Bader
Signed-off-by: Greg Kroah-Hartman
commit 74b7bd47282eb4729509c1adad27e05cb77a3837
Author: Clemens Ladisch
Date: Mon Mar 12 21:45:47 2012 +0100
firewire: ohci: fix too-early completion of IR multichannel buffers
commit 0c0efbacab8d70700d13301e0ae7975783c0cb0a upstream.
handle\_ir\_buffer\_fill() assumed that a completed descriptor would be
indicated by a non-zero transfer\_status (as in most other descriptors).
However, this field is written by the controller as soon as (the end of)
the first packet has been written into the buffer. As a consequence, if
we happen to run into such a descriptor when the interrupt handler is
executed after such a packet has completed, the descriptor would be
taken out of the list of active descriptors as soon as the buffer had
been partially filled, so the event for the buffer being completely
filled would never be sent.
To fix this, handle descriptors only when they have been completely
filled, i.e., when res\_count == 0. (This also matches the condition
that is reported by the controller with an interrupt.)
Signed-off-by: Clemens Ladisch
Signed-off-by: Stefan Richter
Signed-off-by: Greg Kroah-Hartman
commit ae72c6c317b0c2fd455c131b45e290b9acf6b354
Author: Sergei Shtylyov
Date: Thu Jan 19 19:09:56 2012 +0300
pata\_legacy: correctly mask recovery field for HT6560B
commit 9716387311c790de381214c03e7f1b72b91a8189 upstream.
According to the HT6560H datasheet, the recovery timing field is 4-bit wide,
with a value of 0 meaning 16 cycles. Correct obvious thinko in the recovery
field mask.
Signed-off-by: Sergei Shtylyov
Signed-off-by: Jeff Garzik
Signed-off-by: Greg Kroah-Hartman
commit 5cd9c9621c2c3cf16bf0a308bd87e7d7aeb78160
Author: Keng-Yu Lin
Date: Mon Jan 30 14:25:45 2012 +0800
HID: add more hotkeys in Asus AIO keyboards
commit 6c30d5a53229aad22bb675e0bd6eb518ecaa4316 upstream.
Add support for the camera key. The hotkey for
Asus S.H.E(Super Hybrid Engine) mode is mapped to KEY\_KEY\_PROG1
just for notifying the userspace.
Signed-off-by: Keng-Yu Lin
Signed-off-by: Jiri Kosina
Signed-off-by: Greg Kroah-Hartman
commit c2040a53ad769fd0f12678feaf73ffa1d4ff124d
Author: Keng-Yu Lin
Date: Thu Feb 2 10:31:26 2012 +0100
HID: add extra hotkeys in Asus AIO keyboards
commit 3596bb929f2abd3433c2eaa5755fad48ac207af1 upstream.
The Asus All-In-One PC has a wireless keyboard with wifi toggle,
brightness up, brightness down and display off hotkeys.
This patch adds suppoort for these hotkeys.
Signed-off-by: Keng-Yu Lin
Signed-off-by: Jiri Kosina
Signed-off-by: Greg Kroah-Hartman
commit ef5cf6b5cfaac10c6ad1cb6547c977efcddce7db
Author: Keng-Yu Lin
Date: Wed Nov 30 18:32:37 2011 +0800
Bluetooth: Add AR30XX device ID on Asus laptops
commit 6b6ba88b5bb8779156b21bb957520a448c3642e2 upstream.
The ID is found on Asus K54HR and K53U.
Blacklist the AR3011-based device ID [0489:e03d]
and add to ath3k.c for firmware loading.
Below is the output of usb-devices script:
Before the fiwmware loading:
T: Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#= 3 Spd=12 MxCh= 0
D: Ver= 1.10 Cls=e0(wlcon) Sub=01 Prot=01 MxPS=64 #Cfgs= 1
P: Vendor=0489 ProdID=e03d Rev=00.01
C: #Ifs= 2 Cfg#= 1 Atr=e0 MxPwr=100mA
I: If#= 0 Alt= 0 #EPs= 3 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
I: If#= 1 Alt= 0 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
After the fiwmware loading:
T: Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#= 5 Spd=12 MxCh= 0
D: Ver= 1.10 Cls=e0(wlcon) Sub=01 Prot=01 MxPS=64 #Cfgs= 1
P: Vendor=0cf3 ProdID=3005 Rev=00.01
C: #Ifs= 2 Cfg#= 1 Atr=e0 MxPwr=100mA
I: If#= 0 Alt= 0 #EPs= 3 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
I: If#= 1 Alt= 0 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
Signed-off-by: Keng-Yu Lin
Signed-off-by: Gustavo F. Padovan
Signed-off-by: Johan Hedberg
Signed-off-by: Greg Kroah-Hartman
commit fbd49ca445e92374ddb1d43ab43d527c489905a1
Author: Roland Dreier
Date: Thu Feb 23 17:22:12 2012 -0800
target: Fix 16-bit target ports for SET TARGET PORT GROUPS emulation
commit 33395fb8a13731c7ef7b175dbf5a4d8a6738fe6c upstream.
The old code did (MSB << 8) & 0xff, which always evaluates to 0. Just use
get\_unaligned\_be16() so we don't have to worry about whether our open-coded
version is correct or not.
Signed-off-by: Roland Dreier
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit b794073eb1f5574b35c5de89ce81f108742a9879
Author: Jörn Engel
Date: Wed Feb 15 16:52:11 2012 -0500
target: prevent NULL pointer dereference in target\_report\_luns
commit 47f1b8803e1e358ebbf4f82bfdb98971c912a2c3 upstream.
transport\_kmap\_data\_sg can return NULL. I never saw this trigger, but
returning -ENOMEM seems better than a crash. Also removes a pointless
case while at it.
Signed-off-by: Joern Engel
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit f18009c7acc4efa72c6bb36f8be1db8b08582dd9
Author: Jörn Engel
Date: Wed Feb 15 16:51:32 2012 -0500
target: fix use after free in target\_report\_luns
commit 382436f8804fe1cb20b9a2a811a10eb2d8554721 upstream.
Fix possible NULL pointer dereference in target\_report\_luns failure path.
Signed-off-by: Joern Engel
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 9a99a9592a98270e37b08574e2ed17b11ae741c3
Author: Roland Dreier
Date: Mon Feb 13 16:18:16 2012 -0800
target: Don't set WBUS16 or SYNC bits in INQUIRY response
commit effc6cc8828257c32c37635e737f14fd6e19ecd7 upstream.
SPC-4 says about the WBUS16 and SYNC bits:
The meanings of these fields are specific to SPI-5 (see 6.4.3).
For SCSI transport protocols other than the SCSI Parallel
Interface, these fields are reserved.
We don't have a SPI fabric module, so we should never set these bits.
(The comment was misleading, since it only mentioned Sync but the
actual code set WBUS16 too).
Signed-off-by: Roland Dreier
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit dc64052e954f7b2658fc194108eaac53d0828190
Author: Alex Deucher
Date: Fri Mar 16 12:22:10 2012 -0400
drm/radeon/kms: add connector quirk for Fujitsu D3003-S2 board
commit 4c1b2d2da3451f5c8dd59bd7e05bd9729d2aee05 upstream.
vbios lists DVI-I port as VGA and DVI-D.
Fixes:
https://bugs.freedesktop.org/show\_bug.cgi?id=47007
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 16d4db3ec3dfdd10bbafef9a4f62fc9374592d2e
Author: Alex Deucher
Date: Fri Mar 16 12:22:09 2012 -0400
drm/radeon/kms: fix analog load detection on DVI-I connectors
commit e00e8b5e760cbbe9067daeae5454d67c44c8d035 upstream.
We digital encoders have a detect function as well (for
DP to VGA bridges), so we make sure we choose the analog
one here.
Fixes:
https://bugs.freedesktop.org/show\_bug.cgi?id=47007
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit c59359dcec7e50ad725069c93e574a1e4eb6de89
Author: Michel Dänzer
Date: Wed Mar 14 17:12:41 2012 +0100
drm/radeon: Restrict offset for legacy hardware cursor.
commit c4353016dac10133fa5d8535af83f0c4845a2915 upstream.
The hardware only takes 27 bits for the offset, so larger offsets are
truncated, and the hardware cursor shows random bits other than the intended
ones.
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=46796
Signed-off-by: Michel Dänzer
Reviewed-by: Alex Deucher
Signed-off-by: Dave Airlie
commit 89df7051aab3884a734fc1eb666322643519c9c8
Author: Chris Wilson
Date: Wed Dec 14 13:57:23 2011 +0100
drm/i915: Only clear the GPU domains upon a successful finish
commit c501ae7f332cdaf42e31af30b72b4b66cbbb1604 upstream.
By clearing the GPU read domains before waiting upon the buffer, we run
the risk of the wait being interrupted and the domains prematurely
cleared. The next time we attempt to wait upon the buffer (after
userspace handles the signal), we believe that the buffer is idle and so
skip the wait.
There are a number of bugs across all generations which show signs of an
overly haste reuse of active buffers.
Such as:
https://bugs.freedesktop.org/show\_bug.cgi?id=29046
https://bugs.freedesktop.org/show\_bug.cgi?id=35863
https://bugs.freedesktop.org/show\_bug.cgi?id=38952
https://bugs.freedesktop.org/show\_bug.cgi?id=40282
https://bugs.freedesktop.org/show\_bug.cgi?id=41098
https://bugs.freedesktop.org/show\_bug.cgi?id=41102
https://bugs.freedesktop.org/show\_bug.cgi?id=41284
https://bugs.freedesktop.org/show\_bug.cgi?id=42141
A couple of those pre-date i915\_gem\_object\_finish\_gpu(), so may be
unrelated (such as a wild write from a userspace command buffer), but
this does look like a convincing cause for most of those bugs.
Signed-off-by: Chris Wilson
Reviewed-by: Daniel Vetter
Reviewed-by: Eugeni Dodonov
Signed-off-by: Daniel Vetter
Signed-off-by: Greg Kroah-Hartman
commit b7715ffd670153926766a6b7419c306591f20676
Author: NeilBrown
Date: Mon Mar 19 12:46:41 2012 +1100
md: fix clearing of the 'changed' flags for the bad blocks list.
commit d0962936bff659d20522555b517582a2715fd23f upstream.
In super\_1\_sync (the first hunk) we need to clear 'changed' before
checking read\_seqretry(), otherwise we might race with other code
adding a bad block and so won't retry later.
In md\_update\_sb (the second hunk), in the case where there is no
metadata (neither persistent nor external), we treat any bad blocks as
an error. However we need to clear the 'changed' flag before calling
md\_ack\_all\_badblocks, else it won't do anything.
This patch is suitable for -stable release 3.0 and later.
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit 0b5216e57f491984c6833eeb699cb1ba3895e305
Author: NeilBrown
Date: Mon Mar 19 12:46:38 2012 +1100
md/raid1,raid10: avoid deadlock during resync/recovery.
commit d6b42dcb995e6acd7cc276774e751ffc9f0ef4bf upstream.
If RAID1 or RAID10 is used under LVM or some other stacking
block device, it is possible to enter a deadlock during
resync or recovery.
This can happen if the upper level block device creates
two requests to the RAID1 or RAID10. The first request gets
processed, blocks recovery and queue requests for underlying
requests in current->bio\_list. A resync request then starts
which will wait for those requests and block new IO.
But then the second request to the RAID1/10 will be attempted
and it cannot progress until the resync request completes,
which cannot progress until the underlying device requests complete,
which are on a queue behind that second request.
So allow that second request to proceed even though there is
a resync request about to start.
This is suitable for any -stable kernel.
Reported-by: Ray Morris
Tested-by: Ray Morris
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit 6bd620a44f7fdb2755101517e878c17b0b730332
Author: NeilBrown
Date: Mon Mar 19 12:46:37 2012 +1100
md: don't set md arrays to readonly on shutdown.
commit c744a65c1e2d59acc54333ce80a5b0702a98010b upstream.
It seems that with recent kernel, writeback can still be happening
while shutdown is happening, and consequently data can be written
after the md reboot notifier switches all arrays to read-only.
This causes a BUG.
So don't switch them to read-only - just mark them clean and
set 'safemode' to '2' which mean that immediately after any
write the array will be switch back to 'clean'.
This could result in the shutdown happening when array is marked
dirty, thus forcing a resync on reboot. However if you reboot
without performing a "sync" first, you get to keep both halves.
This is suitable for any stable kernel (though there might be some
conflicts with obvious fixes in earlier kernels).
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit aae19423e23df33f18e49f7558cb660aa485df90
Author: NeilBrown
Date: Mon Mar 19 12:46:37 2012 +1100
md/bitmap: ensure to load bitmap when creating via sysfs.
commit 4474ca42e2577563a919fd3ed782e2ec55bf11a2 upstream.
When commit 69e51b449d383e (md/bitmap: separate out loading a bitmap...)
created bitmap\_load, it missed calling it after bitmap\_create when a
bitmap is created through the sysfs interface.
So if a bitmap is added this way, we don't allocate memory properly
and can crash.
This is suitable for any -stable release since 2.6.35.
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit 9a0aae0c2e37ed923640e8646a392814a76bed6a
Author: Nicholas Bellinger
Date: Fri Mar 9 23:45:38 2012 -0800
tcm\_fc: Fix fc\_exch memory leak in ft\_send\_resp\_status
commit 031ed4d565b31880a4136bb7366bc89f5b1dba7d upstream.
This patch fixes a bug in tcm\_fc where fc\_exch memory from fc\_exch\_mgr->ep\_pool
is currently being leaked by ft\_send\_resp\_status() usage. Following current
code in ft\_queue\_status() response path, using lport->tt.seq\_send() needs to be
followed by a lport->tt.exch\_done() in order to release fc\_exch memory back into
libfc\_em kmem\_cache.
ft\_send\_resp\_status() code is currently used in pre submit se\_cmd ft\_send\_work()
error exceptions, TM request setup exceptions, and main TM response callback
path in ft\_queue\_tm\_resp(). This bugfix addresses the leak in these cases.
Cc: Mark D Rustad
Cc: Kiran Patil
Cc: Robert Love
Cc: Andy Grover
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit ee7d30aab7663d796c13f3d7e8e80068f922a334
Author: Kay Sievers
Date: Sat Jan 28 19:57:46 2012 +0000
udlfb: remove sysfs framebuffer device with USB .disconnect()
commit ce880cb860f36694d2cdebfac9e6ae18176fe4c4 upstream.
The USB graphics card driver delays the unregistering of the framebuffer
device to a workqueue, which breaks the userspace visible remove uevent
sequence. Recent userspace tools started to support USB graphics card
hotplug out-of-the-box and rely on proper events sent by the kernel.
The framebuffer device is a direct child of the USB interface which is
removed immediately after the USB .disconnect() callback. But the fb device
in /sys stays around until its final cleanup, at a time where all the parent
devices have been removed already.
To work around that, we remove the sysfs fb device directly in the USB
.disconnect() callback and leave only the cleanup of the internal fb
data to the delayed work.
Before:
add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)
add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)
add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/graphics/fb0 (graphics)
remove /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)
remove /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)
remove /2-1.2:1.0/graphics/fb0 (graphics)
After:
add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)
add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)
add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/graphics/fb1 (graphics)
remove /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/graphics/fb1 (graphics)
remove /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)
remove /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)
Tested-by: Bernie Thompson
Acked-by: Bernie Thompson
Signed-off-by: Kay Sievers
Signed-off-by: Florian Tobias Schandinat
Signed-off-by: Greg Kroah-Hartman
commit 3b6df5f6f4c6398dde02581ed559c5520674979f
Author: Lothar Waßmann
Date: Sun Mar 11 15:08:46 2012 +0100
usb gadget: fix a section mismatch when compiling g\_ffs with CONFIG\_USB\_FUNCTIONFS\_ETH
commit 8d0698428822ce63f7269e7fe81fc4580807b9ac upstream.
commit 28824b18ac4705e876a282a15ea0de8fc957551f:
|Author: Michal Nazarewicz
|Date: Wed May 5 12:53:13 2010 +0200
|
| USB: gadget: \_\_init and \_\_exit tags removed
|
| \_\_init, \_\_initdata and \_\_exit tags have have been removed from
| various files to make it possible for gadgets that do not use
| the \_\_init/\_\_exit tags to use those.
obviously missed (at least) this case leading to a section mismatch in
g\_ffs.c when compiling with CONFIG\_USB\_FUNCTIONFS\_ETH enabled.
Signed-off-by: Lothar Waßmann
Acked-by: Michal Nazarewicz
Signed-off-by: Greg Kroah-Hartman
commit d8b8c61ff79f4edc8ef979a9fcb94b79beb77cdf
Author: Anssi Hannula
Date: Tue Mar 13 17:43:02 2012 +0200
ALSA: hda - fix printing of high HDMI sample rates
commit 25dc16f69892182192b1234594fd3cf342ad4195 upstream.
A previous commit af65cbf296 (ALSA: hdmi: fix printout of SAD sampling
rates) fixed the sample rates shown in /proc/asound/cardX/eldY and
kernel log to not be entirely wrong. However, a missing rate from the
array added in the patch causes HDMI rates 88.2 kHz, 96 kHz, 176.4 kHz,
and 192 kHz to be shown as 96 kHz, 176.4 kHz, 192 kHz, and 384 kHz,
respectively.
Fix the reporting by adding the ALSA rate 64 kHz into the conversion
array between 48 kHz and 88.2 kHz.
Signed-off-by: Anssi Hannula
Cc: Pierre-Louis Bossart
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit abd8ea073d7438c42004aac75d4bbb46e7a8c054
Author: Nicholas Bellinger
Date: Sun Feb 26 22:16:07 2012 -0800
iscsi-target: Fix dynamic -> explict NodeACL pointer reference
commit d06283341aee9e48eff1b068779d340785c635ce upstream.
This patch fixes a free after use in lio\_target\_make\_nodeacl() where
iscsi\_node\_acl was referenced from the original se\_nacl\_new allocation,
instead of from core\_tpg\_add\_initiator\_node\_acl() in the case of dynamic
-> explict NodeACL conversion.
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 05ea4968dcc95650e2d1e1b67102018cdbd80e65
Author: Nicholas Bellinger
Date: Thu Feb 23 17:28:43 2012 -0800
iscsi-target: Fix iscsit\_alloc\_buffs() failure cases
commit d335e6054db616bce3f040e659fa38440518ad1d upstream.
Make iscsit\_alloc\_buffs() failure case for page\_alloc\_failed use correct
\_\_free\_page() SGL pointer, and return -ENOMEM for iscsit\_allocate\_iovecs
failure to push se\_cmd->t\_mem\_sg release into iscsit\_release\_cmd()
callback during iscsit\_add\_reject\_from\_cmd() connection reset.
Also drop cmd->t\_mem\_sg = NULL assignment from page\_alloc\_failed
failure case.
Reported-by: Roland Dreier
Cc: Andy Grover
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit bb9ed4f099c534078357b549b53749a55dfd1c97
Author: Roland Dreier
Date: Tue Feb 14 15:30:31 2012 -0800
tcm\_loop: Set residual field for SCSI commands
commit 6cf3fa6918baab0c447f1206f1cef9166ad04864 upstream.
If the target core signals an over- or under-run, tcm\_loop should call
scsi\_set\_resid() to tell the SCSI midlayer about the residual data length.
The difference can be seen by doing something like
strace -eioctl sg\_raw -r 1024 /dev/sda 8 0 0 0 1 0 > /dev/null
and looking at the "resid=" part of the SG\_IO ioctl -- after this patch,
the field is correctly reported as 512.
Signed-off-by: Roland Dreier
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 0f813454b313d17992a2c8ec7483c733ce5107b3
Author: Daniel Mack
Date: Mon Mar 19 09:12:53 2012 +0100
ASoC: pxa-ssp: atomically set stream active masks
commit 273b72c8ce6b28df6b49423d775c3e59072c73c5 upstream.
PXA's SSP engine fails to take its current channel phase into account
when enabling a stream while the engine is already running. This
results in randomly swapped left/right channels on either the record
or the playback side, depending on which one was enabled first.
The following patch fixes this by factoring out the bit field
modifications in question to a separate function that pauses the
engine temporarily, modifies the bits and kicks it off again
afterwards. Appearantly, a transition of SSCR0\_SSE syncs both
directions properly.
The patch has been rolled out to quite a number of devices over the
last weeks and seems to fix the issue reliably.
Signed-off-by: Daniel Mack
Reported-and-tested-by: Sven Neumann
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 34ef160b39875c7f823f29b8925e1331d940148c
Author: Timur Tabi
Date: Fri Mar 16 16:32:52 2012 -0500
ASoC: fsl: p1022ds: tell the WM8776 codec driver that it's the master
commit 70ac07bb633dee75ac554195b9a4d69adfa7803c upstream.
The WM8776 codec driver requires the machine driver to set one of the
SND\_SOC\_DAIFMT\_CBx\_xxx values. The P1022DS machine driver should be setting
SND\_SOC\_DAIFMT\_CBM\_CFM, but since that value was zero, no one noticed.
Commit 75d9ac46 ("ASoC: Allow DAI formats to be specified in the
dai\_link"), however, changed the value of SND\_SOC\_DAIFMT\_CBM\_CFM from zero
to a non-zero value, which means that it now needs to be specifically set
by the machine driver.
We also set SND\_SOC\_DAIFMT\_NB\_NF, for the same reason.
Signed-off-by: Timur Tabi
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit fe4e2fab7a5efb7352985a195d0a7d95816a698b
Author: Aneesh Kumar K.V
Date: Wed Mar 21 16:34:08 2012 -0700
hugetlbfs: avoid taking i\_mutex from hugetlbfs\_read()
commit a05b0855fd15504972dba2358e5faa172a1e50ba upstream.
Taking i\_mutex in hugetlbfs\_read() can result in deadlock with mmap as
explained below
Thread A:
read() on hugetlbfs
hugetlbfs\_read() called
i\_mutex grabbed
hugetlbfs\_read\_actor() called
\_\_copy\_to\_user() called
page fault is triggered
Thread B, sharing address space with A:
mmap() the same file
->mmap\_sem is grabbed on task\_B->mm->mmap\_sem
hugetlbfs\_file\_mmap() is called
attempt to grab ->i\_mutex and block waiting for A to give it up
Thread A:
pagefault handled blocked on attempt to grab task\_A->mm->mmap\_sem,
which happens to be the same thing as task\_B->mm->mmap\_sem. Block waiting
for B to give it up.
AFAIU the i\_mutex locking was added to hugetlbfs\_read() as per
http://lkml.indiana.edu/hypermail/linux/kernel/0707.2/3066.html to take
care of the race between truncate and read. This patch fixes this by
looking at page->mapping under lock\_page() (find\_lock\_page()) to ensure
that the inode didn't get truncated in the range during a parallel read.
Ideally we can extend the patch to make sure we don't increase i\_size in
mmap. But that will break userspace, because applications will now have
to use truncate(2) to increase i\_size in hugetlbfs.
Based on the original patch from Hillf Danton.
Signed-off-by: Aneesh Kumar K.V
Cc: Hillf Danton
Cc: KAMEZAWA Hiroyuki
Cc: Al Viro
Cc: Hugh Dickins
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 9565cb71a1c0fbeab977cc346063873319f1953d
Author: Nishanth Aravamudan
Date: Wed Mar 21 16:34:07 2012 -0700
bootmem/sparsemem: remove limit constraint in alloc\_bootmem\_section
commit f5bf18fa22f8c41a13eb8762c7373eb3a93a7333 upstream.
While testing AMS (Active Memory Sharing) / CMO (Cooperative Memory
Overcommit) on powerpc, we tripped the following:
kernel BUG at mm/bootmem.c:483!
cpu 0x0: Vector: 700 (Program Check) at [c000000000c03940]
pc: c000000000a62bd8: .alloc\_bootmem\_core+0x90/0x39c
lr: c000000000a64bcc: .sparse\_early\_usemaps\_alloc\_node+0x84/0x29c
sp: c000000000c03bc0
msr: 8000000000021032
current = 0xc000000000b0cce0
paca = 0xc000000001d80000
pid = 0, comm = swapper
kernel BUG at mm/bootmem.c:483!
enter ? for help
[c000000000c03c80] c000000000a64bcc
.sparse\_early\_usemaps\_alloc\_node+0x84/0x29c
[c000000000c03d50] c000000000a64f10 .sparse\_init+0x12c/0x28c
[c000000000c03e20] c000000000a474f4 .setup\_arch+0x20c/0x294
[c000000000c03ee0] c000000000a4079c .start\_kernel+0xb4/0x460
[c000000000c03f90] c000000000009670 .start\_here\_common+0x1c/0x2c
This is
BUG\_ON(limit && goal + size > limit);
and after some debugging, it seems that
goal = 0x7ffff000000
limit = 0x80000000000
and sparse\_early\_usemaps\_alloc\_node ->
sparse\_early\_usemaps\_alloc\_pgdat\_section calls
return alloc\_bootmem\_section(usemap\_size() \* count, section\_nr);
This is on a system with 8TB available via the AMS pool, and as a quirk
of AMS in firmware, all of that memory shows up in node 0. So, we end
up with an allocation that will fail the goal/limit constraints.
In theory, we could "fall-back" to alloc\_bootmem\_node() in
sparse\_early\_usemaps\_alloc\_node(), but since we actually have HOTREMOVE
defined, we'll BUG\_ON() instead. A simple solution appears to be to
unconditionally remove the limit condition in alloc\_bootmem\_section,
meaning allocations are allowed to cross section boundaries (necessary
for systems of this size).
Johannes Weiner pointed out that if alloc\_bootmem\_section() no longer
guarantees section-locality, we need check\_usemap\_section\_nr() to print
possible cross-dependencies between node descriptors and the usemaps
allocated through it. That makes the two loops in
sparse\_early\_usemaps\_alloc\_node() identical, so re-factor the code a
bit.
[akpm@linux-foundation.org: code simplification]
Signed-off-by: Nishanth Aravamudan
Cc: Dave Hansen
Cc: Anton Blanchard
Cc: Paul Mackerras
Cc: Ben Herrenschmidt
Cc: Robert Jennings
Acked-by: Johannes Weiner
Acked-by: Mel Gorman
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5c6156fac087f551cbd57499f4bed2fc614d70cd
Author: Rafael J. Wysocki
Date: Tue Mar 13 22:39:31 2012 +0100
PM / Domains: Fix handling of wakeup devices during system resume
commit cc85b20780562d404e18a47b9b55b4a5102ae53e upstream.
During system suspend pm\_genpd\_suspend\_noirq() checks if the given
device is in a wakeup path (i.e. it appears to be needed for one or
more wakeup devices to work or is a wakeup device itself) and if it
needs to be "active" for wakeup to work. If that is the case, the
function returns 0 without incrementing the device domain's counter
of suspended devices and without executing genpd\_stop\_dev() for the
device. In consequence, the device is not stopped (e.g. its clock
isn't disabled) and power is always supplied to its domain in the
resulting system sleep state.
However, pm\_genpd\_resume\_noirq() doesn't repeat that check and it
runs genpd\_start\_dev() and decrements the domain's counter of
suspended devices even for the wakeup device that weren't stopped by
pm\_genpd\_suspend\_noirq(). As a result, the start callback may be run
unnecessarily for them and their domains' counters of suspended
devices may become negative. Both outcomes aren't desirable, so fix
pm\_genpd\_resume\_noirq() to look for wakeup devices that might not be
stopped by during system suspend.
Signed-off-by: Rafael J. Wysocki
Tested-by: Simon Horman
Signed-off-by: Greg Kroah-Hartman
commit 923da1e9e292633437c35fd870d47f18b0ee197f
Author: Tim Gardner
Date: Tue Dec 6 11:29:20 2011 -0700
TPM: Zero buffer whole after copying to userspace
commit 3ab1aff89477dafb1aaeafe8c8669114a02b7226 upstream.
Commit 3321c07ae5068568cd61ac9f4ba749006a7185c9 correctly clears the TPM
buffer if the user specified read length is >= the TPM buffer length. However,
if the user specified read length is < the TPM buffer length, then part of the
TPM buffer is left uncleared.
Reported-by: Seth Forshee
Cc: Debora Velarde
Cc: Rajiv Andrade
Cc: Marcel Selhorst
Cc: tpmdd-devel@lists.sourceforge.net
Signed-off-by: Tim Gardner
Signed-off-by: Rajiv Andrade
Signed-off-by: Greg Kroah-Hartman
commit c6cf24ba30c7225667827245cfd2bc98f7f5ed2b
Author: Andrea Arcangeli
Date: Wed Mar 21 16:33:42 2012 -0700
mm: thp: fix pmd\_bad() triggering in code paths holding mmap\_sem read mode
commit 1a5a9906d4e8d1976b701f889d8f35d54b928f25 upstream.
In some cases it may happen that pmd\_none\_or\_clear\_bad() is called with
the mmap\_sem hold in read mode. In those cases the huge page faults can
allocate hugepmds under pmd\_none\_or\_clear\_bad() and that can trigger a
false positive from pmd\_bad() that will not like to see a pmd
materializing as trans huge.
It's not khugepaged causing the problem, khugepaged holds the mmap\_sem
in write mode (and all those sites must hold the mmap\_sem in read mode
to prevent pagetables to go away from under them, during code review it
seems vm86 mode on 32bit kernels requires that too unless it's
restricted to 1 thread per process or UP builds). The race is only with
the huge pagefaults that can convert a pmd\_none() into a
pmd\_trans\_huge().
Effectively all these pmd\_none\_or\_clear\_bad() sites running with
mmap\_sem in read mode are somewhat speculative with the page faults, and
the result is always undefined when they run simultaneously. This is
probably why it wasn't common to run into this. For example if the
madvise(MADV\_DONTNEED) runs zap\_page\_range() shortly before the page
fault, the hugepage will not be zapped, if the page fault runs first it
will be zapped.
Altering pmd\_bad() not to error out if it finds hugepmds won't be enough
to fix this, because zap\_pmd\_range would then proceed to call
zap\_pte\_range (which would be incorrect if the pmd become a
pmd\_trans\_huge()).
The simplest way to fix this is to read the pmd in the local stack
(regardless of what we read, no need of actual CPU barriers, only
compiler barrier needed), and be sure it is not changing under the code
that computes its value. Even if the real pmd is changing under the
value we hold on the stack, we don't care. If we actually end up in
zap\_pte\_range it means the pmd was not none already and it was not huge,
and it can't become huge from under us (khugepaged locking explained
above).
All we need is to enforce that there is no way anymore that in a code
path like below, pmd\_trans\_huge can be false, but pmd\_none\_or\_clear\_bad
can run into a hugepmd. The overhead of a barrier() is just a compiler
tweak and should not be measurable (I only added it for THP builds). I
don't exclude different compiler versions may have prevented the race
too by caching the value of \*pmd on the stack (that hasn't been
verified, but it wouldn't be impossible considering
pmd\_none\_or\_clear\_bad, pmd\_bad, pmd\_trans\_huge, pmd\_none are all inlines
and there's no external function called in between pmd\_trans\_huge and
pmd\_none\_or\_clear\_bad).
if (pmd\_trans\_huge(\*pmd)) {
if (next-addr != HPAGE\_PMD\_SIZE) {
VM\_BUG\_ON(!rwsem\_is\_locked(&tlb->mm->mmap\_sem));
split\_huge\_page\_pmd(vma->vm\_mm, pmd);
} else if (zap\_huge\_pmd(tlb, vma, pmd, addr))
continue;
/\* fall through \*/
}
if (pmd\_none\_or\_clear\_bad(pmd))
Because this race condition could be exercised without special
privileges this was reported in CVE-2012-1179.
The race was identified and fully explained by Ulrich who debugged it.
I'm quoting his accurate explanation below, for reference.
====== start quote =======
mapcount 0 page\_mapcount 1
kernel BUG at mm/huge\_memory.c:1384!
At some point prior to the panic, a "bad pmd ..." message similar to the
following is logged on the console:
mm/memory.c:145: bad pmd ffff8800376e1f98(80000000314000e7).
The "bad pmd ..." message is logged by pmd\_clear\_bad() before it clears
the page's PMD table entry.
143 void pmd\_clear\_bad(pmd\_t \*pmd)
144 {
-> 145 pmd\_ERROR(\*pmd);
146 pmd\_clear(pmd);
147 }
After the PMD table entry has been cleared, there is an inconsistency
between the actual number of PMD table entries that are mapping the page
and the page's map count (\_mapcount field in struct page). When the page
is subsequently reclaimed, \_\_split\_huge\_page() detects this inconsistency.
1381 if (mapcount != page\_mapcount(page))
1382 printk(KERN\_ERR "mapcount %d page\_mapcount %d\n",
1383 mapcount, page\_mapcount(page));
-> 1384 BUG\_ON(mapcount != page\_mapcount(page));
The root cause of the problem is a race of two threads in a multithreaded
process. Thread B incurs a page fault on a virtual address that has never
been accessed (PMD entry is zero) while Thread A is executing an madvise()
system call on a virtual address within the same 2 MB (huge page) range.
virtual address space
.---------------------.
| |
| |
.-|---------------------|
| | |
| | |<-- B(fault)
| | |
2 MB | |/////////////////////|-.
huge < |/////////////////////| > A(range)
page | |/////////////////////|-'
| | |
| | |
'-|---------------------|
| |
| |
'---------------------'
- Thread A is executing an madvise(..., MADV\_DONTNEED) system call
on the virtual address range "A(range)" shown in the picture.
sys\_madvise
// Acquire the semaphore in shared mode.
down\_read(&current->mm->mmap\_sem)
...
madvise\_vma
switch (behavior)
case MADV\_DONTNEED:
madvise\_dontneed
zap\_page\_range
unmap\_vmas
unmap\_page\_range
zap\_pud\_range
zap\_pmd\_range
//
// Assume that this huge page has never been accessed.
// I.e. content of the PMD entry is zero (not mapped).
//
if (pmd\_trans\_huge(\*pmd)) {
// We don't get here due to the above assumption.
}
//
// Assume that Thread B incurred a page fault and
.---------> // sneaks in here as shown below.
| //
| if (pmd\_none\_or\_clear\_bad(pmd))
| {
| if (unlikely(pmd\_bad(\*pmd)))
| pmd\_clear\_bad
| {
| pmd\_ERROR
| // Log "bad pmd ..." message here.
| pmd\_clear
| // Clear the page's PMD entry.
| // Thread B incremented the map count
| // in page\_add\_new\_anon\_rmap(), but
| // now the page is no longer mapped
| // by a PMD entry (-> inconsistency).
| }
| }
|
v
- Thread B is handling a page fault on virtual address "B(fault)" shown
in the picture.
...
do\_page\_fault
\_\_do\_page\_fault
// Acquire the semaphore in shared mode.
down\_read\_trylock(&mm->mmap\_sem)
...
handle\_mm\_fault
if (pmd\_none(\*pmd) && transparent\_hugepage\_enabled(vma))
// We get here due to the above assumption (PMD entry is zero).
do\_huge\_pmd\_anonymous\_page
alloc\_hugepage\_vma
// Allocate a new transparent huge page here.
...
\_\_do\_huge\_pmd\_anonymous\_page
...
spin\_lock(&mm->page\_table\_lock)
...
page\_add\_new\_anon\_rmap
// Here we increment the page's map count (starts at -1).
atomic\_set(&page->\_mapcount, 0)
set\_pmd\_at
// Here we set the page's PMD entry which will be cleared
// when Thread A calls pmd\_clear\_bad().
...
spin\_unlock(&mm->page\_table\_lock)
The mmap\_sem does not prevent the race because both threads are acquiring
it in shared mode (down\_read). Thread B holds the page\_table\_lock while
the page's map count and PMD table entry are updated. However, Thread A
does not synchronize on that lock.
====== end quote =======
[akpm@linux-foundation.org: checkpatch fixes]
Reported-by: Ulrich Obergfell
Signed-off-by: Andrea Arcangeli
Acked-by: Johannes Weiner
Cc: Mel Gorman
Cc: Hugh Dickins
Cc: Dave Jones
Acked-by: Larry Woodman
Acked-by: Rik van Riel
Cc: Mark Salter
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 273fb194e86b795b08a724c7646d0f694949070b
Author: Suresh Siddha
Date: Mon Mar 12 11:36:33 2012 -0700
x86/ioapic: Add register level checks to detect bogus io-apic entries
commit 73d63d038ee9f769f5e5b46792d227fe20e442c5 upstream.
With the recent changes to clear\_IO\_APIC\_pin() which tries to
clear remoteIRR bit explicitly, some of the users started to see
"Unable to reset IRR for apic .." messages.
Close look shows that these are related to bogus IO-APIC entries
which return's all 1's for their io-apic registers. And the
above mentioned error messages are benign. But kernel should
have ignored such io-apic's in the first place.
Check if register 0, 1, 2 of the listed io-apic are all 1's and
ignore such io-apic.
Reported-by: Álvaro Castillo
Tested-by: Jon Dufresne
Signed-off-by: Suresh Siddha
Cc: yinghai@kernel.org
Cc: kernel-team@fedoraproject.org
Cc: Josh Boyer
Link: http://lkml.kernel.org/r/1331577393.31585.94.camel@sbsiddha-desk.sc.intel.com
[ Performed minor cleanup of affected code. ]
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 4a02744bb48ce0d1ea3470c5f791382786a02ee9
Author: Fabio Estevam
Date: Thu Jan 5 12:49:54 2012 -0200
ima: fix Kconfig dependencies
commit f4a0391dfa91155bd961673b31eb42d9d45c799d upstream.
Fix the following build warning:
warning: (IMA) selects TCG\_TPM which has unmet direct dependencies
(HAS\_IOMEM && EXPERIMENTAL)
Suggested-by: Rajiv Andrade
Signed-off-by: Fabio Estevam
Signed-off-by: Rajiv Andrade
Signed-off-by: Mimi Zohar
Signed-off-by: Greg Kroah-Hartman
commit 9af865fc7d42e347f679405000fc22ecbfbf2653
Author: Or Gerlitz
Date: Mon Mar 5 18:21:44 2012 +0200
IB/iser: Post initial receive buffers before sending the final login request
commit 89e984e2c2cd14f77ccb26c47726ac7f13b70ae8 upstream.
An iser target may send iscsi NO-OP PDUs as soon as it marks the iSER
iSCSI session as fully operative. This means that there is window
where there are no posted receive buffers on the initiator side, so
it's possible for the iSER RC connection to break because of RNR NAK /
retry errors. To fix this, rely on the flags bits in the login
request to have FFP (0x3) in the lower nibble as a marker for the
final login request, and post an initial chunk of receive buffers
before sending that login request instead of after getting the login
response.
Signed-off-by: Or Gerlitz
Signed-off-by: Roland Dreier
Signed-off-by: Greg Kroah-Hartman
commit 2e4d3c51483d1272acb34db75695423a7e2f8163
Author: Greg Rose
Date: Wed Feb 8 00:45:00 2012 +0000
rtnetlink: Fix VF IFLA policy
commit 48752f6513012a1b078da08b145d5c40a644f058 upstream.
Add VF spoof check to IFLA policy. The original patch I submitted to
add the spoof checking feature to rtnl failed to add the proper policy
rule that identifies the data type and len. This patch corrects that
oversight. No bugs have been reported against this but it may cause
some problem for the netlink message parsing that uses the policy
table.
Signed-off-by: Greg Rose
Tested-by: Sibai Li
Signed-off-by: Jeff Kirsher
Signed-off-by: Greg Kroah-Hartman
commit 0abe0c69f3f07313c6f9eaa60b2a760a9a5c94f5
Author: Max Filippov
Date: Thu Mar 1 00:40:08 2012 +0400
p54spi: Release GPIO lines and IRQ on error in p54spi\_probe
commit 62ebeed8d00aef75eac4fd6c161cae75a41965ca upstream.
This makes it possible to reload driver if insmod has failed due to
missing firmware.
Signed-off-by: Max Filippov
Acked-by: Christian Lamparter
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 63d1c8663a622c8861b65d89b6f24578cb485655
Author: Rabin Vincent
Date: Tue Nov 22 11:03:14 2011 +0100
rtc: Disable the alarm in the hardware (v2)
commit 41c7f7424259ff11009449f87c95656f69f9b186 upstream.
Currently, the RTC code does not disable the alarm in the hardware.
This means that after a sequence such as the one below (the files are in the
RTC sysfs), the box will boot up after 2 minutes even though we've
asked for the alarm to be turned off.
# echo $((`cat since\_epoch`)+120) > wakealarm
# echo 0 > wakealarm
# poweroff
Fix this by disabling the alarm when there are no timers to run.
The original version of this patch was reverted. This version
disables the irq directly instead of setting a disabled timer
in the future.
Cc: John Stultz
Signed-off-by: Rabin Vincent
[Merged in the second revision from Rabin]
Signed-off-by: John Stultz
Signed-off-by: Greg Kroah-Hartman
commit d06ce542311192cc20921f22848960e66e110dee
Author: Alexander Gordeev
Date: Fri Mar 9 14:59:13 2012 +0100
genirq: Fix incorrect check for forced IRQ thread handler
commit 540b60e24f3f4781d80e47122f0c4486a03375b8 upstream.
We do not want a bitwise AND between boolean operands
Signed-off-by: Alexander Gordeev
Cc: Oleg Nesterov
Link: http://lkml.kernel.org/r/20120309135912.GA2114@dhcp-26-207.brq.redhat.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 4e6c04eca71ab6cf9fbec301783540fd773a7536
Author: Russell King
Date: Mon Mar 5 15:07:25 2012 -0800
genirq: Fix long-term regression in genirq irq\_set\_irq\_type() handling
commit a09b659cd68c10ec6a30cb91ebd2c327fcd5bfe5 upstream.
In 2008, commit 0c5d1eb77a8be ("genirq: record trigger type") modified the
way set\_irq\_type() handles the 'no trigger' condition. However, this has
an adverse effect on PCMCIA support on Intel StrongARM and probably PXA
platforms.
PCMCIA has several status signals on the socket which can trigger
interrupts; some of these status signals depend on the card's mode
(whether it is configured in memory or IO mode). For example, cards have
a 'Ready/IRQ' signal: in memory mode, this provides an indication to
PCMCIA that the card has finished its power up initialization. In IO
mode, it provides the device interrupt signal. Other status signals
switch between on-board battery status and loud speaker output.
In classical PCMCIA implementations, where you have a specific socket
controller, the controller provides a method to mask interrupts from the
socket, and importantly ignore any state transitions on the pins which
correspond with interrupts once masked. This masking prevents unwanted
events caused by the removal and application of socket power being
forwarded.
However, on platforms where there is no socket controller, the PCMCIA
status and interrupt signals are routed to standard edge-triggered GPIOs.
These GPIOs can be configured to interrupt on rising edge, falling edge,
or never. This is where the problems start.
Edge triggered interrupts are required to record events while disabled via
the usual methods of {free,request,disable,enable}\_irq() to prevent
problems with dropped interrupts (eg, the 8390 driver uses disable\_irq()
to defer the delivery of interrupts). As a result, these interfaces can
not be used to implement the desired behaviour.
The side effect of this is that if the 'Ready/IRQ' GPIO is disabled via
disable\_irq() on suspend, and enabled via enable\_irq() after resume, we
will record the state transitions caused by powering events as valid
interrupts, and foward them to the card driver, which may attempt to
access a card which is not powered up.
This leads delays resume while drivers spin in their interrupt handlers,
and complaints from drivers before they realize what's happened.
Moreover, in the case of the 'Ready/IRQ' signal, this is requested and
freed by the card driver itself; the PCMCIA core has no idea whether the
interrupt is requested, and, therefore, whether a call to disable\_irq()
would be valid. (We tried this around 2.4.17 / 2.5.1 kernel era, and
ended up throwing it out because of this problem.)
Therefore, it was decided back in around 2002 to disable the edge
triggering instead, resulting in all state transitions on the GPIO being
ignored. That's what we actually need the hardware to do.
The commit above changes this behaviour; it explicitly prevents the 'no
trigger' state being selected.
The reason that request\_irq() does not accept the 'no trigger' state is
for compatibility with existing drivers which do not provide their desired
triggering configuration. The set\_irq\_type() function is 'new' and not
used by non-trigger aware drivers.
Therefore, revert this change, and restore previously working platforms
back to their former state.
Signed-off-by: Russell King
Cc: linux@arm.linux.org.uk
Cc: Ingo Molnar
Signed-off-by: Andrew Morton
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 1a24aa6ec745d87b9dcac87ebb45959ae19117dc
Author: Andrew Vagin
Date: Wed Mar 7 14:49:56 2012 +0400
uevent: send events in correct order according to seqnum (v3)
commit 7b60a18da393ed70db043a777fd9e6d5363077c4 upstream.
The queue handling in the udev daemon assumes that the events are
ordered.
Before this patch uevent\_seqnum is incremented under sequence\_lock,
than an event is send uner uevent\_sock\_mutex. I want to say that code
contained a window between incrementing seqnum and sending an event.
This patch locks uevent\_sock\_mutex before incrementing uevent\_seqnum.
v2: delete sequence\_lock, uevent\_seqnum is protected by uevent\_sock\_mutex
v3: unlock the mutex before the goto exit
Thanks for Kay for the comments.
Signed-off-by: Andrew Vagin
Tested-By: Kay Sievers
Signed-off-by: Greg Kroah-Hartman
commit 1f2c44df43fef14718d2713f89b1ce1fada45577
Author: Sasha Levin
Date: Thu Mar 15 12:36:14 2012 -0400
ntp: Fix integer overflow when setting time
commit a078c6d0e6288fad6d83fb6d5edd91ddb7b6ab33 upstream.
'long secs' is passed as divisor to div\_s64, which accepts a 32bit
divisor. On 64bit machines that value is trimmed back from 8 bytes
back to 4, causing a divide by zero when the number is bigger than
(1 << 32) - 1 and all 32 lower bits are 0.
Use div64\_long() instead.
Signed-off-by: Sasha Levin
Cc: johnstul@us.ibm.com
Link: http://lkml.kernel.org/r/1331829374-31543-2-git-send-email-levinsasha928@gmail.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit c2b033667cb7080061978656681a6ba2108e51bb
Author: Sasha Levin
Date: Thu Mar 15 12:36:13 2012 -0400
math: Introduce div64\_long
commit f910381a55cdaa097030291f272f6e6e4380c39a upstream.
Add a div64\_long macro which is used to devide a 64bit number by a long (which
can be 4 bytes on 32bit systems and 8 bytes on 64bit systems).
Suggested-by: Thomas Gleixner
Signed-off-by: Sasha Levin
Cc: johnstul@us.ibm.com
Link: http://lkml.kernel.org/r/1331829374-31543-1-git-send-email-levinsasha928@gmail.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit c8fe46316175840b3a0c2d5f5ad7c9d2c837e58f
Author: Johannes Berg
Date: Sun Mar 4 08:50:46 2012 -0800
iwlwifi: always monitor for stuck queues
commit 342bbf3fee2fa9a18147e74b2e3c4229a4564912 upstream.
If we only monitor while associated, the following
can happen:
- we're associated, and the queue stuck check
runs, setting the queue "touch" time to X
- we disassociate, stopping the monitoring,
which leaves the time set to X
- almost 2s later, we associate, and enqueue
a frame
- before the frame is transmitted, we monitor
for stuck queues, and find the time set to
X, although it is now later than X + 2000ms,
so we decide that the queue is stuck and
erroneously restart the device
It happens more with P2P because there we can
go between associated/unassociated frequently.
Reported-by: Ben Cahill
Signed-off-by: Johannes Berg
Signed-off-by: Wey-Yi Guy
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 67fd437fd75067e8f5fd02a4cabdc2da3b65abeb
Author: Jingjun Wu
Date: Fri Mar 2 20:52:14 2012 -0600
rtlwifi: rtl8192ce: Fix loss of receive performance
commit a9b89e2567c743483e6354f64d7a7e3a8c101e9e upstream.
Driver rtl8192ce when used with the RTL8188CE device would start at about
20 Mbps on a 54 Mbps connection, but quickly drop to 1 Mbps. One of the
symptoms is that the AP would need to retransmit each packet 4 of 5 times
before the driver would acknowledge it. Recovery is possible only by
unloading and reloading the driver. This problem was reported at
https://bugzilla.redhat.com/show\_bug.cgi?id=770207.
The problem is due to a missing update of the gain setting.
Signed-off-by: Jingjun Wu
Signed-off-by: Larry Finger
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit a6ce707abde542b876d685e1f031453442dc2b13
Author: Larry Finger
Date: Fri Mar 2 15:23:36 2012 -0600
rtlwifi: rtl8192c: Prevent sleeping from invalid context in rtl8192cu
commit ebecdcc12fed5d3c81853dea61a0a78a5aefab52 upstream.
When driver rtl8192cu is used with the debug level set to 3 or greater,
the result is "sleeping function called from invalid context" due to
an rcu\_read\_lock() call in the DM refresh routine in driver rtl8192c.
This lock is not necessary as the USB driver does not use the struct
being protected, thus the lock is set only when a PCI interface is
active.
This bug is reported in https://bugzilla.kernel.org/show\_bug.cgi?id=42775.
Reported-by: Ronald Wahl
Tested-by: Ronald Wahl
Signed-off-by: Larry Finger
Cc: Ronald Wahl
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 4d804674785319b3ef7544575139402e80190a30
Author: Simon Graham
Date: Tue Feb 7 18:07:38 2012 -0600
rtlwifi: Handle previous allocation failures when freeing device memory
commit 7f66c2f93e5779625c10d262c84537427a2673ca upstream.
Handle previous allocation failures when freeing device memory
Signed-off-by: Simon Graham
Signed-off-by: Larry Finger
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit de886abb2cdce855f6badbd4d77f100df62499a7
Author: Larry Finger
Date: Sat Jan 7 20:46:40 2012 -0600
rtlwifi: rtl8192c\_common: rtl8192de: Check for allocation failures
commit 76a92be537f1c8c259e393632301446257ca3ea9 upstream.
In https://bugzilla.redhat.com/show\_bug.cgi?id=771656, a kernel bug was
triggered due to a failed skb allocation that was not checked. This event
lead to an audit of all memory allocations in the complete rtlwifi family
of drivers. This patch fixes the rest.
Signed-off-by: Larry Finger
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 81a142cabdaa962f2541c3497cd08d39432602df
Author: Gertjan van Wingerde
Date: Sat Feb 11 21:58:09 2012 +0100
rt2x00: Add support for D-Link DWA-127 to rt2800usb.
commit d42a179b941a9e4cc6cf41d0f3cbadd75fc48a89 upstream.
This is an RT3070 based device.
Reported-by: Mikhail Kryshen
Signed-off-by: Gertjan van Wingerde
Acked-by: Ivo van Doorn
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 7b2a7db9fd2de45d1be277679d89f6bf8c56fd32
Author: Donald Lee
Date: Wed Mar 14 15:26:33 2012 +0800
USB: serial: mos7840: Fixed MCS7820 device attach problem
commit 093ea2d3a766cb8a4c4de57efec6c0a127a58792 upstream.
A MCS7820 device supports two serial ports and a MCS7840 device supports
four serial ports. Both devices use the same driver, but the attach function
in driver was unable to correctly handle the port numbers for MCS7820
device. This problem has been fixed in this patch and this fix has been
verified on x86 Linux kernel 3.2.9 with both MCS7820 and MCS7840 devices.
Signed-off-by: Donald Lee
Signed-off-by: Greg Kroah-Hartman
commit 30f0518605762cf1dbf3379acc573cf129cbf593
Author: Preston Fick
Date: Fri Feb 24 13:42:39 2012 -0600
usb: cp210x: Update to support CP2105 and multiple interface devices
commit a5360a53a7ccad5ed9ccef210b94fef13c6e5529 upstream.
This patch updates the cp210x driver to support CP210x multiple
interface devices devices from Silicon Labs. The existing driver
always sends control requests to interface 0, which is hardcoded in
the usb\_control\_msg function calls. This only allows for single
interface devices to be used, and causes a bug when using ports on an
interface other than 0 in the multiple interface devices.
Here are the changes included in this patch:
- Updated the device list to contain the Silicon Labs factory default
VID/PID for multiple interface CP210x devices
- Created a cp210x\_port\_private struct created for each port on
startup, this struct holds the interface number
- Added a cp210x\_release function to clean up the cp210x\_port\_private
memory created on startup
- Modified usb\_get\_config and usb\_set\_config to get a pointer to the
cp210x\_port\_private struct, and use the interface number there in the
usb\_control\_message wIndex param
Signed-off-by: Preston Fick
Signed-off-by: Greg Kroah-Hartman
commit 39531b9566659b87cc585807e797eaf2dde4d563
Author: Scott Dial
Date: Fri Feb 24 19:04:09 2012 -0500
usb-serial: Add support for the Sealevel SeaLINK+8 2038-ROHS device
commit 6d161b99f875269ad4ffa44375e1e54bca6fd02e upstream.
This patch adds new device IDs to the ftdi\_sio module to support
the new Sealevel SeaLINK+8 2038-ROHS device.
Signed-off-by: Scott Dial
Signed-off-by: Greg Kroah-Hartman
commit b951f1a7f9727ad427088ed4c36f364144945202
Author: Dan Williams
Date: Fri Feb 24 13:08:43 2012 -0600
USB: qcserial: don't grab QMI port on Gobi 1000 devices
commit c192c8e71a2ded01170c1a992cd21aaedc822756 upstream.
Gobi 1000 devices have a different port layout, which wasn't respected
by the current driver, and thus it grabbed the QMI/net port. In the
near future we'll be attaching another driver to the QMI/net port for
these devices (cdc-wdm and qmi\_wwan) so make sure the qcserial driver
doesn't claim them. This patch also prevents qcserial from binding to
interfaces 0 and 1 on 1K devices because those interfaces do not
respond.
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit 4a39b3bd2582ccb1d3ca6fea5fc15b43a66c0b3a
Author: Thomas Tuttle
Date: Wed Feb 1 16:07:17 2012 -0500
USB: qcserial: add several new serial devices
commit 2db4d87070e87d198ab630e66a898b45eff316d9 upstream.
Signed-off-by: Thomas Tuttle
Signed-off-by: Greg Kroah-Hartman
commit 61849d8278208ab8445e6143387b5cfe0219c21d
Author: Josh Boyer
Date: Mon Feb 20 15:34:34 2012 -0500
USB: ums\_realtek: do not use stack memory for DMA in \_\_do\_config\_autodelink
commit 4898e07174b79013afd2b422ef6c4336ef8e6783 upstream.
\_\_do\_config\_autodelink passes the data variable to the transport function.
If the calling functions pass a stack variable, this will eventually trigger
a DMA-API debug backtrace for mapping stack memory in the DMA buffer. Fix
this by calling kmemdup for the passed data instead.
Signed-off-by: Josh Boyer
Signed-off-by: Greg Kroah-Hartman
commit 727414186307fa88c9240f32cfe45a11b672274e
Author: Peter Chen
Date: Thu Feb 16 09:41:52 2012 +0800
usb: Fix build error due to dma\_mask is not at pdev\_archdata at ARM
commit e90fc3cb087ce5c5f81e814358222cd6d197b5db upstream.
When build i.mx platform with imx\_v6\_v7\_defconfig, and after adding
USB Gadget support, it has below build error:
CC drivers/usb/host/fsl-mph-dr-of.o
drivers/usb/host/fsl-mph-dr-of.c: In function 'fsl\_usb2\_device\_register':
drivers/usb/host/fsl-mph-dr-of.c:97: error: 'struct pdev\_archdata'
has no member named 'dma\_mask'
It has discussed at: http://www.spinics.net/lists/linux-usb/msg57302.html
For PowerPC, there is dma\_mask at struct pdev\_archdata, but there is
no dma\_mask at struct pdev\_archdata for ARM. The pdev\_archdata is
related to specific platform, it should NOT be accessed by
cross platform drivers, like USB.
The code for pdev\_archdata should be useless, as for PowerPC,
it has already gotten the value for pdev->dev.dma\_mask at function
arch\_setup\_pdev\_archdata of arch/powerpc/kernel/setup-common.c.
Tested-by: Ramneek Mehresh
Signed-off-by: Peter Chen
Signed-off-by: Greg Kroah-Hartman
commit 8bfc26d2e9978d70eef8b03b9495045425c23f22
Author: Peter Chen
Date: Thu Feb 16 09:36:25 2012 +0800
usb: fsl\_udc\_core: Fix scheduling while atomic dump message
commit c5cc5ed86667d4ae74fe40ee4ed893f4b46aba05 upstream.
When loading g\_ether gadget, there is below message:
Backtrace:
[<80012248>] (dump\_backtrace+0x0/0x10c) from [<803cb42c>] (dump\_stack+0x18/0x1c)
r7:00000000 r6:80512000 r5:8052bef8 r4:80513f30
[<803cb414>] (dump\_stack+0x0/0x1c) from [<8000feb4>] (show\_regs+0x44/0x50)
[<8000fe70>] (show\_regs+0x0/0x50) from [<8004c840>] (\_\_schedule\_bug+0x68/0x84)
r5:8052bef8 r4:80513f30
[<8004c7d8>] (\_\_schedule\_bug+0x0/0x84) from [<803cd0e4>] (\_\_schedule+0x4b0/0x528)
r5:8052bef8 r4:809aad00
[<803ccc34>] (\_\_schedule+0x0/0x528) from [<803cd214>] (\_cond\_resched+0x44/0x58)
[<803cd1d0>] (\_cond\_resched+0x0/0x58) from [<800a9488>] (dma\_pool\_alloc+0x184/0x250)
r5:9f9b4000 r4:9fb4fb80
[<800a9304>] (dma\_pool\_alloc+0x0/0x250) from [<802a8ad8>] (fsl\_req\_to\_dtd+0xac/0x180)
[<802a8a2c>] (fsl\_req\_to\_dtd+0x0/0x180) from [<802a8ce4>] (fsl\_ep\_queue+0x138/0x274)
[<802a8bac>] (fsl\_ep\_queue+0x0/0x274) from [<7f004328>] (composite\_setup+0x2d4/0xfac [g\_ether])
[<7f004054>] (composite\_setup+0x0/0xfac [g\_ether]) from [<802a9bb4>] (fsl\_udc\_irq+0x8dc/0xd38)
[<802a92d8>] (fsl\_udc\_irq+0x0/0xd38) from [<800704f8>] (handle\_irq\_event\_percpu+0x54/0x188)
[<800704a4>] (handle\_irq\_event\_percpu+0x0/0x188) from [<80070674>] (handle\_irq\_event+0x48/0x68)
[<8007062c>] (handle\_irq\_event+0x0/0x68) from [<800738ec>] (handle\_level\_irq+0xb4/0x138)
r5:80514f94 r4:80514f40
[<80073838>] (handle\_level\_irq+0x0/0x138) from [<8006ffa4>] (generic\_handle\_irq+0x38/0x44)
r7:00000012 r6:80510b1c r5:80529860 r4:80512000
[<8006ff6c>] (generic\_handle\_irq+0x0/0x44) from [<8000f4c4>] (handle\_IRQ+0x54/0xb4)
[<8000f470>] (handle\_IRQ+0x0/0xb4) from [<800085b8>] (tzic\_handle\_irq+0x64/0x94)
r9:412fc085 r8:00000000 r7:80513f30 r6:00000001 r5:00000000
r4:00000000
[<80008554>] (tzic\_handle\_irq+0x0/0x94) from [<8000e680>] (\_\_irq\_svc+0x40/0x60)
The reason of above dump message is calling dma\_poll\_alloc with can-schedule
mem\_flags at atomic context.
To fix this problem, below changes are made:
- fsl\_req\_to\_dtd doesn't need to be protected by spin\_lock\_irqsave,
as struct usb\_request can be access at process context. Move lock
to beginning of hardware visit (fsl\_queue\_td).
- Change the memory flag which using to allocate dTD descriptor buffer,
the memory flag can be from gadget layer.
It is tested at i.mx51 bbg board with g\_mass\_storage, g\_ether, g\_serial.
Signed-off-by: Peter Chen
Acked-by: Li Yang
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 3d8e1c65555c758475a005c287f1c4b69296b226
Author: Ben Hutchings
Date: Sun Feb 12 06:02:43 2012 +0000
cdc-wdm: Don't clear WDM\_READ unless entire read buffer is emptied
commit b7a205545345578712611106b371538992e142ff upstream.
The WDM\_READ flag is cleared later iff desc->length is reduced to 0.
Signed-off-by: Ben Hutchings
Tested-by: Bjørn Mork
Cc: Oliver Neukum
Signed-off-by: Greg Kroah-Hartman
commit 8d272f9af55e8900fc96886bd72b158482ed55d0
Author: Ben Hutchings
Date: Sun Feb 12 06:00:41 2012 +0000
cdc-wdm: Fix more races on the read path
commit 711c68b3c0f7a924ffbee4aa962d8f62b85188ff upstream.
We must not allow the input buffer length to change while we're
shuffling the buffer contents. We also mustn't clear the WDM\_READ
flag after more data might have arrived. Therefore move both of these
into the spinlocked region at the bottom of wdm\_read().
When reading desc->length without holding the iuspin lock, use
ACCESS\_ONCE() to ensure the compiler doesn't re-read it with
inconsistent results.
Signed-off-by: Ben Hutchings
Tested-by: Bjørn Mork
Cc: Oliver Neukum
Signed-off-by: Greg Kroah-Hartman
commit 77131893c0287a7736171b97ef69b989bbeaba62
Author: Johan Hovold
Date: Fri Feb 10 13:20:49 2012 +0100
USB: serial: fix console error reporting
commit 548dd4b6da8a8e428453d55f7fa7b8a46498d147 upstream.
Do not report errors in write path if port is used as a console as this
may trigger the same error (and error report) resulting in a loop.
Reported-by: Stephen Hemminger
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 9d7203a1946813100a0623289df8c2bbbe832831
Author: Liz Clark
Date: Thu Mar 15 10:33:29 2012 -0700
TTY: Wrong unicode value copied in con\_set\_unimap()
commit 4a4c61b7ce26bfc9d49ea4bd121d52114bad9f99 upstream.
Bugzilla 40012: PIO\_UNIMAP bug: error updating Unicode-to-font map
https://bugzilla.kernel.org/show\_bug.cgi?id=40012
The unicode font map for the virtual console is a 32x32x64 table which
allocates rows dynamically as entries are added. The unicode value
increases sequentially and should count all entries even in empty
rows. The defect is when copying the unicode font map in con\_set\_unimap(),
the unicode value is not incremented properly. The wrong unicode value
is entered in the new font map.
Signed-off-by: Liz Clark
Signed-off-by: Greg Kroah-Hartman
commit 676ba4178125f06e9bd1d0b539f5644f1cea31a5
Author: Dan Carpenter
Date: Wed Mar 7 13:05:00 2012 +0300
tty: moxa: fix bit test in moxa\_start()
commit 58112dfbfe02d803566a2c6c8bd97b5fa3c62cdc upstream.
This is supposed to be doing a shift before the comparison instead of
just doing a bitwise AND directly. The current code means the start()
just returns without doing anything.
Signed-off-by: Dan Carpenter
Acked-by: Jiri Slaby
Signed-off-by: Greg Kroah-Hartman
commit cbdbd450211dd493262c0573e7143e1bb0bf7892
Author: Masami Ichikawa
Date: Tue Feb 21 07:43:50 2012 +0900
sysfs: Fix memory leak in sysfs\_sd\_setsecdata().
commit 93518dd2ebafcc761a8637b2877008cfd748c202 upstream.
This patch fixies follwing two memory leak patterns that reported by kmemleak.
sysfs\_sd\_setsecdata() is called during sys\_lsetxattr() operation.
It checks sd->s\_iattr is NULL or not. Then if it is NULL, it calls
sysfs\_init\_inode\_attrs() to allocate memory.
That code is this.
iattrs = sd->s\_iattr;
if (!iattrs)
iattrs = sysfs\_init\_inode\_attrs(sd);
The iattrs recieves sysfs\_init\_inode\_attrs()'s result, but sd->s\_iattr
doesn't know the address. so it needs to set correct address to
sd->s\_iattr to free memory in other function.
unreferenced object 0xffff880250b73e60 (size 32):
comm "systemd", pid 1, jiffies 4294683888 (age 94.553s)
hex dump (first 32 bytes):
73 79 73 74 65 6d 5f 75 3a 6f 62 6a 65 63 74 5f system\_u:object\_
72 3a 73 79 73 66 73 5f 74 3a 73 30 00 00 00 00 r:sysfs\_t:s0....
backtrace:
[] kmemleak\_alloc+0x73/0x98
[] \_\_kmalloc+0x100/0x12c
[] context\_struct\_to\_string+0x106/0x210
[] security\_sid\_to\_context\_core+0x10b/0x129
[] security\_sid\_to\_context+0x10/0x12
[] selinux\_inode\_getsecurity+0x7d/0xa8
[] selinux\_inode\_getsecctx+0x22/0x2e
[] security\_inode\_getsecctx+0x16/0x18
[] sysfs\_setxattr+0x96/0x117
[] \_\_vfs\_setxattr\_noperm+0x73/0xd9
[] vfs\_setxattr+0x83/0xa1
[] setxattr+0xcf/0x101
[] sys\_lsetxattr+0x6a/0x8f
[] system\_call\_fastpath+0x16/0x1b
[] 0xffffffffffffffff
unreferenced object 0xffff88024163c5a0 (size 96):
comm "systemd", pid 1, jiffies 4294683888 (age 94.553s)
hex dump (first 32 bytes):
00 00 00 00 ed 41 00 00 00 00 00 00 00 00 00 00 .....A..........
00 00 00 00 00 00 00 00 0c 64 42 4f 00 00 00 00 .........dBO....
backtrace:
[] kmemleak\_alloc+0x73/0x98
[] kmem\_cache\_alloc\_trace+0xc4/0xee
[] sysfs\_init\_inode\_attrs+0x2a/0x83
[] sysfs\_setxattr+0xbf/0x117
[] \_\_vfs\_setxattr\_noperm+0x73/0xd9
[] vfs\_setxattr+0x83/0xa1
[] setxattr+0xcf/0x101
[] sys\_lsetxattr+0x6a/0x8f
[] system\_call\_fastpath+0x16/0x1b
[] 0xffffffffffffffff
`
Signed-off-by: Masami Ichikawa
Signed-off-by: Greg Kroah-Hartman
commit 29bfcea07745737f385b0d092e71527051c29029
Author: Thomas Gleixner
Date: Wed Feb 15 12:08:34 2012 +0100
futex: Cover all PI opcodes with cmpxchg enabled check
commit 59263b513c11398cd66a52d4c5b2b118ce1e0359 upstream.
Some of the newer futex PI opcodes do not check the cmpxchg enabled
variable and call unconditionally into the handling functions. Cover
all PI opcodes in a separate check.
Signed-off-by: Thomas Gleixner
Cc: Peter Zijlstra
Cc: Darren Hart
Signed-off-by: Greg Kroah-Hartman
commit fe7951d72fe43d52e28f4e0ec1f1de2d0a12e5b0
Author: Orjan Friberg
Date: Wed Mar 7 17:16:14 2012 +0100
USB: gadget: Make g\_hid device class conform to spec.
commit 33d2832ab0149a26418d360af3c444969a63fb28 upstream.
HID devices should specify this in their interface descriptors, not in the
device descriptor. This fixes a "missing hardware id" bug under Windows 7 with
a VIA VL800 (3.0) controller.
Signed-off-by: Orjan Friberg
Cc: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit d8808b35aaac220884881a5b11a57ef65d2eb45d
Author: Thomas Faber
Date: Fri Mar 2 09:41:50 2012 +0100
usb: gadgetfs: return number of bytes on ep0 read request
commit 85b4b3c8c189e0159101f7628a71411af072ff69 upstream.
A read from GadgetFS endpoint 0 during the data stage of a control
request would always return 0 on success (as returned by
wait\_event\_interruptible) despite having written data into the user
buffer.
This patch makes it correctly set the return value to the number of
bytes read.
Signed-off-by: Thomas Faber
Signed-off-by: Greg Kroah-Hartman
commit b94e22b626e2ba1e73bea71998c769624279b958
Author: Kuninori Morimoto
Date: Mon Feb 20 17:35:50 2012 -0800
usb: renesas\_usbhs: bugfix: add .release function to gpriv->gadget.dev
commit 3b2a2e47174cd978258bbb0fdf2e2b1b5ec2144c upstream.
This patch fixup below warning on device\_unregister()
renesas\_usbhs renesas\_usbhs.1: host probed
renesas\_usbhs renesas\_usbhs.1: gadget probed
renesas\_usbhs renesas\_usbhs.1: irq request err
------------[ cut here ]------------
WARNING: at ${LINUX}/drivers/base/core.c:1)
Device 'gadget' does not have a release() function, it is broken and must be fi.
Modules linked in:
[] (unwind\_backtrace+0x0/0xe4) from [] (warn\_slowpath\_commo)
[] (warn\_slowpath\_common+0x4c/0x64) from [] (warn\_slowpath\_)
[] (warn\_slowpath\_fmt+0x2c/0x3c) from [] (device\_release+0x)
[] (device\_release+0x70/0x84) from [] (kobject\_cleanup+0x58)
[] (kobject\_cleanup+0x58/0x6c) from [] (usbhs\_mod\_gadget\_re)
[] (usbhs\_mod\_gadget\_remove+0x3c/0x6c) from [] (usbhs\_mod\_p)
[] (usbhs\_mod\_probe+0x68/0x80) from [] (usbhs\_probe+0x1cc/0)
...
Signed-off-by: Kuninori Morimoto
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 28e0c4cc0c55bea990c7ed35e4e07afb6cb485e0
Author: Supriya Karanth
Date: Fri Feb 17 14:54:52 2012 +0530
usb: musb: Reselect index reg in interrupt context
commit 39287076e46d2c19aaceaa6f0a44168ae4d257ec upstream.
musb INDEX register is getting modified/corrupted during temporary
un-locking in a SMP system. Set this register with proper value
after re-acquiring the lock
Scenario:
---------
CPU1 is handling a data transfer completion interrupt received for
the CLASS1 EP
CPU2 is handling a CLASS2 thread which is queuing data to musb for
transfer
Below is the error sequence:
CPU1 | CPU2
--------------------------------------------------------------------
Data transfer completion inter- |
rupt recieved. |
|
musb INDEX reg set to CLASS1 EP |
|
musb LOCK is acquired. |
|
| CLASS2 thread queues data.
|
| CLASS2 thread tries to acquire musb
| LOCK but lock is already taken by
| CLASS1, so CLASS2 thread is
| spinning.
|
From Interrupt Context musb |
giveback function is called |
|
The giveback function releases | CLASS2 thread now acquires LOCK
LOCK |
|
ClASS1 Request's completion cal-| ClASS2 schedules the data transfer and
lback is called | sets the MUSB INDEX to Class2 EP number
|
Interrupt handler for CLASS1 EP |
tries to acquire LOCK and is |
spinning |
|
Interrupt for Class1 EP acquires| Class2 completes the scheduling etc and
the MUSB LOCK | releases the musb LOCK
|
Interrupt for Class1 EP schedul-|
es the next data transfer |
but musb INDEX register is still|
set to CLASS2 EP |
Since the MUSB INDEX register is set to a different endpoint, we
read and modify the wrong registers. Hence data transfer will not
happen properly. This results in unpredictable behavior
So, the MUSB INDEX register is set to proper value again when
interrupt re-acquires the lock
Signed-off-by: Supriya Karanth
Signed-off-by: Praveena Nadahally
Reviewed-by: srinidhi kasagar
Signed-off-by: Felipe Balbi
commit 289bd26e44bc08df86466f7bdf5257d28765b5b1
Author: Anton Tikhomirov
Date: Thu Feb 23 15:38:46 2012 +0900
usb: dwc3: use proper function for setting endpoint name
commit 27a78d6a283d6782438f72306746afe4bf44c215 upstream.
It's wrong to use the size of array as an argument for strncat.
Memory corruption is possible. strlcat is exactly what we need here.
Signed-off-by: Anton Tikhomirov
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 8b2c433eb4ca5df49724fc77cef209ab2a3b54d1
Author: Paul Zimmerman
Date: Fri Feb 17 14:10:16 2012 -0800
usb: dwc3: fix bogus test in dwc3\_gadget\_start\_isoc
commit 9bafa56c7cee5c6fa68de5924220abb220c7e229 upstream.
Zero is a valid value for a microframe number. So remove the bogus
test for non-zero in dwc3\_gadget\_start\_isoc().
Signed-off-by: Paul Zimmerman
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 6fc05c7f2cfbc2ec7e5c82b65b64c27ec2a764b0
Author: Larry Finger
Date: Sun Feb 26 22:08:36 2012 -0600
staging: r8712u: Fix regression in signal level after commit c6dc001
commit da3e6ec2f443ac00aa623c5921e3521f5f38efe4 upstream.
In commit c6dc001 "staging: r8712u: Merging Realtek's latest (v2.6.6).
Various fixes", the returned qual.qual member of the iw\_statistics
struct was changed. For strong signals, this change made no difference;
however for medium and weak signals it results in a low signal that
shows considerable fluctuation, When using wicd for a medium-strength
AP, the value reported in the status line is reduced from 100% to 60% by
this bug.
This problem is reported in https://bugzilla.kernel.org/show\_bug.cgi?id=42826.
Reported-and-tested-by: Robert Crawford
Signed-off-by: Larry Finger
Signed-off-by: Greg Kroah-Hartman
commit 4399750de90017d366ae688b3e4ba86e5dfe6d25
Author: Larry Finger
Date: Sat Feb 25 18:10:20 2012 -0600
staging: r8712u: Fix regression introduced by commit a5ee652
commit 9f4bc8cf3fe750ed093856a5f5d41c11cc12ad22 upstream.
In commit a5ee652 "staging: r8712u: Interface-state not fully tracked",
the private boolean "bup" was set false when the interface was brought down,
as that seemed appropriate. This change has not caused any problems when
using NetworkManager or manual control of the device; however, when wicd
control is used, there is a locking problem in wpa\_supplicant, as shown in
https://bugzilla.kernel.org/show\_bug.cgi?id=42818.
This fix reverts the only code change in commit a5ee652. My
analysis is that "bup" is badly named. In its present form, it
seems to indicate the up/down state of the device, but its usage
is more consistent with an initialized/uninitialized state. That
problem will be addressed in a later patch.
Note: Commit 8c213fa, which introdued asynchronous firmware loading
for this driver, exposed this bug to a greater extent. That bug
is addressed in the next patch in this series.
This bug is also responsible for the bug in
https://bugzilla.kernel.org/show\_bug.cgi?id=42815. and this bug is
also part of the problems discussed at https://bugs.archlinux.org/task/27996#comment89950.
Tested-by: Alberto Lago Ballesteros
Tested-by: Adrian
Signed-off-by: Larry Finger
Signed-off-by: Greg Kroah-Hartman
commit 35e95b11598a156121aa2d35cdec7e2994eafa83
Author: Larry Finger
Date: Thu Feb 9 16:37:17 2012 -0600
staging: r8712u: Add missing initialization and remove configuration parameter CONFIG\_R8712\_AP
commit 073863432f7eaa23c7c09733414d4be2eabf5eef upstream.
When this driver was upgraded to the vendor 20100831 version in
commit 93c55dda092c7 et al,, one listhead initialization was missed.
This broke complete operation of the driver whenever AP mode was
enabled. This fixes https://bugs.archlinux.org/task/27996.
The configuration parameter R8712\_AP is misleading as the driver cannot
function as an AP without a heavily hacked version of hostapd. Thus, it
makes sense to remove the parameter; however the code and data configured
for the option is left in.
Signed-off-by: Larry Finger
Signed-off-by: Greg Kroah-Hartman
commit 5856307bd35ec6586ee6fa513ee32516cacb7ff6
Author: Shengzhou Liu
Date: Thu Feb 16 18:02:20 2012 +0800
powerpc/usb: fix bug of kernel hang when initializing usb
commit 28c56ea1431421dec51b7b229369e991481453df upstream.
If USB UTMI PHY is not enable, writing to portsc register will lead to
kernel hang during boot up.
Signed-off-by: Shengzhou Liu
Reported-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 4c9da75cb251ae99c5afe98b79c5a56b17fa0a26
Author: Michał Wróbel
Date: Thu Mar 15 17:24:04 2012 +0100
USB: ftdi\_sio: new PID: LUMEL PD12
commit 57e596f3af88ef52dea9640ed5e34ecd38893a02 upstream.
Signed-off-by: Michał Wróbel
Signed-off-by: Greg Kroah-Hartman
commit 73cd08ed12d435ee5c50af6dc684036e6d7b7e29
Author: Jim Paris
Date: Wed Mar 14 17:54:25 2012 -0400
USB: ftdi\_sio: add support for FT-X series devices
commit dc0827c128c0ee5a58b822b99d662b59f4b8e970 upstream.
Add PID 0x6015, corresponding to the new series of FT-X chips
(FT220XD, FT201X, FT220X, FT221X, FT230X, FT231X, FT240X). They all
appear as serial devices, and seem indistinguishable except for the
default product string stored in their EEPROM. The baudrate
generation matches FT232RL devices.
Tested with a FT201X and FT230X at various baudrates (100 - 3000000).
Sample dmesg:
ftdi\_sio: v1.6.0:USB FTDI Serial Converters Driver
usb 2-1: new full-speed USB device number 6 using ohci\_hcd
usb 2-1: New USB device found, idVendor=0403, idProduct=6015
usb 2-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
usb 2-1: Product: FT230X USB Half UART
usb 2-1: Manufacturer: FTDI
usb 2-1: SerialNumber: DC001WI6
ftdi\_sio 2-1:1.0: FTDI USB Serial Device converter detected
drivers/usb/serial/ftdi\_sio.c: ftdi\_sio\_port\_probe
drivers/usb/serial/ftdi\_sio.c: ftdi\_determine\_type: bcdDevice = 0x1000, bNumInterfaces = 1
usb 2-1: Detected FT-X
usb 2-1: Number of endpoints 2
usb 2-1: Endpoint 1 MaxPacketSize 64
usb 2-1: Endpoint 2 MaxPacketSize 64
usb 2-1: Setting MaxPacketSize 64
drivers/usb/serial/ftdi\_sio.c: read\_latency\_timer
drivers/usb/serial/ftdi\_sio.c: write\_latency\_timer: setting latency timer = 1
drivers/usb/serial/ftdi\_sio.c: create\_sysfs\_attrs
drivers/usb/serial/ftdi\_sio.c: sysfs attributes for FT-X
usb 2-1: FTDI USB Serial Device converter now attached to ttyUSB0
Signed-off-by: Jim Paris
Signed-off-by: Greg Kroah-Hartman
commit fe9d085752d475f02bb377bc5d3e191f31482344
Author: Michał Wróbel
Date: Fri Mar 9 14:40:18 2012 +0100
USB: ftdi\_sio: new PID: Distortec JTAG-lock-pick
commit 47594d5528f28a4c025c2955c68104c75815637c upstream.
Signed-off-by: Michał Wróbel
Signed-off-by: Greg Kroah-Hartman
commit 59df038acf5b2687e401b42cb524dc472d554e3d
Author: Bruno Thomsen
Date: Sun Mar 4 15:19:14 2012 +0100
USB: Microchip VID mislabeled as Hornby VID in ftdi\_sio.
commit c1cee1d84001815a1b4321c49b995254c0df3100 upstream.
Microchip VID (0x04d8) was mislabeled as Hornby VID according to USB-IDs.
A Full Speed USB Demo Board PID (0x000a) was mislabeled as
Hornby Elite (an Digital Command Controller Console for model railways).
Most likely the Hornby based their design on
PIC18F87J50 Full Speed USB Demo Board.
Signed-off-by: Bruno Thomsen
Signed-off-by: Greg Kroah-Hartman
commit 65ad87ff57ca0150596d7bf1349f42392d40ebda
Author: Peter Korsgaard
Date: Wed Feb 29 10:05:37 2012 +0100
USB: ftdi\_sio: add support for BeagleBone rev A5+
commit 444aa7fa9bd752d19ce472d3e02558b987c3cc67 upstream.
BeagleBone changed to the default FTDI 0403:6010 id in rev A5 to make life
easier for Windows users, so we need a similar workaround as the Calao
board to support it.
Signed-off-by: Peter Korsgaard
Signed-off-by: Greg Kroah-Hartman
commit 63b9e81c411c2221260124d4a167aab4c24ff603
Author: Greg Kroah-Hartman
Date: Tue Feb 28 09:20:09 2012 -0800
USB: ftdi\_sio: fix problem when the manufacture is a NULL string
commit 656d2b3964a9d0f9864d472f8dfa2dd7dd42e6c0 upstream.
On some misconfigured ftdi\_sio devices, if the manufacturer string is
NULL, the kernel will oops when the device is plugged in. This patch
fixes the problem.
Reported-by: Wojciech M Zabolotny
Tested-by: Wojciech M Zabolotny
Signed-off-by: Greg Kroah-Hartman
commit 32c5edbdda0e9737b0667036ef1210eb0284c54b
Author: Andrea Righi
Date: Mon Feb 20 13:11:49 2012 +0100
staging: zcache: avoid AB-BA deadlock condition
commit cfbc6a92212e74b07aa76c9e2f20c542e36077fb upstream.
Commit 9256a47 fixed a deadlock condition, being sure that the buddy
list spinlock is always taken before the page spinlock.
However in zbud\_free\_and\_delist() locking order is the opposite
(page lock -> list lock).
Possible unsafe locking scenario (reported by lockdep):
CPU0 CPU1
---- ----
lock(&(&zbpg->lock)->rlock);
lock(zbud\_budlists\_spinlock);
lock(&(&zbpg->lock)->rlock);
lock(zbud\_budlists\_spinlock);
Fix by grabbing the locks in opposite order in zbud\_free\_and\_delist().
Signed-off-by: Andrea Righi
Signed-off-by: Greg Kroah-Hartman
commit 0bd61423aaaa167455003c48b8c3d1f2b9dcc19d
Author: Bjørn Mork
Date: Fri Mar 16 15:41:26 2012 +0100
USB: option: add ZTE MF820D
commit 5889d3d4209c1050b4a3c96c41faf6c0976a4acf upstream.
This device presents a total of 5 interfaces with ff/ff/ff
class/subclass/protocol. The last one of these is verified
to be a QMI/wwan combined interface which should be handled
by the qmi\_wwan driver, so we blacklist it here.
Signed-off-by: Bjørn Mork
Signed-off-by: Greg Kroah-Hartman
commit d86147440f519b20bdb78749f921edfe5620b589
Author: Bjørn Mork
Date: Fri Mar 16 12:56:44 2012 +0100
USB: option: make interface blacklist work again
commit 963940cf472d76eca2d36296e461202cc6997352 upstream.
commit 0d905fd "USB: option: convert Huawei K3765, K4505, K4605
reservered interface to blacklist" accidentally ANDed two
blacklist tests by leaving out a return. This was not noticed
because the two consecutive bracketless if statements made it
syntactically correct.
Signed-off-by: Bjørn Mork
Signed-off-by: Greg Kroah-Hartman
commit bbd5d3840cf705d141e6af6888b3aa14bee127ee
Author: Daniele Palmas
Date: Wed Feb 29 15:32:05 2012 +0100
USB: option driver: adding support for Telit CC864-SINGLE, CC864-DUAL and DE910-DUAL modems
commit 7204cf584836c24b4b06e4ad4a8e6bb8ea84908e upstream.
Adding PID for Telit CC864-SINGLE, CC864-DUAL and DE910-DUAL
modems
Signed-off-by: Daniele Palmas
Signed-off-by: Greg Kroah-Hartman
commit 881f65f84efe837d2bb914d1f06682f0bc7580a1
Author: Meng Zhang
Date: Mon Feb 27 08:24:19 2012 +0100
USB: option: Add MediaTek MT6276M modem&app interfaces
commit 0d8520a1d7f43328bc7085d4244d93c595064157 upstream.
Add MEDIATEK products to Option driver
Signed-off-by: Meng Zhang
Signed-off-by: Matthias Urlichs
Signed-off-by: Greg Kroah-Hartman


=== Content from bugzilla.redhat.com_04911bd1_20250124_220135.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D773370)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D773370)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D773370)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 773370

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 773370**](show_bug.cgi?id=773370)
(CVE-2012-0045)
- [CVE-2012-0045](https://access.redhat.com/security/cve/CVE-2012-0045) kernel: kvm: syscall instruction induced guest panic

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-0045 kernel: kvm: syscall instruction induced guest panic

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-0045 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (1): | [782123](show_bug.cgi?id=782123)  ([view as bug list](buglist.cgi?bug_id=782123)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [773390](show_bug.cgi?id=773390) [773391](show_bug.cgi?id=773391) [773392](show_bug.cgi?id=773392 "CLOSED ERRATA - CVE-2012-0045 kernel: kvm: syscall instruction induced guest panic [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [773374](show_bug.cgi?id=773374) | | TreeView+ | [depends on](buglist.cgi?bug_id=773370&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=773370&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2012-01-11 16:56 UTC by Petr Matousek | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-05-11 18:34 UTC ([History](show_activity.cgi?id=773370)) | | [CC List:](page.cgi?id=fields.html#cclist) | 23 users (show)  areis arozansk bhu dhoward ehabkost fhrbata gansalmon itamar jkacur jonathan jwboyer kernel-maint kernel-mgr lcapitulino lgoncalv madhu.chinakonda mkenneth mtosatti nobody rt-maint vgoyal virt-maint williams | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-10-19 21:51:25 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2012:0350](https://access.redhat.com/errata/RHSA-2012%3A0350) | 0 | normal | SHIPPED\_LIVE | Moderate: kernel security and bug fix update | 2012-03-06 23:43:05 UTC | | Red Hat Product Errata | [RHSA-2012:0422](https://access.redhat.com/errata/RHSA-2012%3A0422) | 0 | normal | SHIPPED\_LIVE | Moderate: rhev-hypervisor6 security and bug fix update | 2012-03-26 19:17:12 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=773370#c0)  Petr Matousek    2012-01-11 16:56:13 UTC  ``` 32bit guests will crash (and 64bit guests may behave in a wrong way) for example by simply executing following nasm-demo-application:      [bits 32]     global _start     SECTION .text     _start: syscall  The reason seems a missing "invalid opcode"-trap (int6) for the syscall opcode "0f05", which is not available on Intel CPUs within non-longmodes, as also on some AMD CPUs within legacy-mode. (depending on CPU vendor, MSR_EFER and cpuid)  Because previous mentioned OSs may not engage corresponding syscall target-registers (STAR, LSTAR, CSTAR), they remain NULL and (non trapping) syscalls are leading to multiple faults and finally crashs.  Reference: <https://lkml.org/lkml/2011/12/28/170> <http://www.spinics.net/lists/kvm/msg66633.html>  Proposed patch: <http://www.spinics.net/lists/kvm/msg66633.html>  Acknowledgements:  Red Hat would like to thank Stephan Bärwolf for reporting this issue.   ```  [Comment 2](show_bug.cgi?id=773370#c2)  Petr Matousek    2012-01-11 18:09:30 UTC  ``` Created kernel tracking bugs for this issue  Affects: fedora-all [[bug 773392](show_bug.cgi?id=773392 "CLOSED ERRATA - CVE-2012-0045 kernel: kvm: syscall instruction induced guest panic [fedora-all]")]   ```  [Comment 4](show_bug.cgi?id=773370#c4)  Petr Matousek    2012-01-11 20:15:05 UTC  ``` Introduced by e66bb2ccdcf76d032bbb464b35c292bb3ee58f9b in linux-2.6.32   ```  [Comment 5](show_bug.cgi?id=773370#c5)  Kurt Seifried    2012-01-12 00:11:39 UTC  ``` Added [CVE-2012-0045](https://access.redhat.com/security/cve/CVE-2012-0045) as per <http://www.openwall.com/lists/oss-security/2012/01/12/2>   ```  [Comment 6](show_bug.cgi?id=773370#c6)  Petr Matousek    2012-01-13 10:23:17 UTC  ``` Upstream KVM repo commits:  <http://git.kernel.org/?p=virt/kvm/kvm.git;a=commit;h=0769c5de24621141c953fbe1f943582d37cb4244> <http://git.kernel.org/?p=virt/kvm/kvm.git;a=commit;h=e28ba7bb020f07193bc000453c8775e9d2c0dda7>   ```  [Comment 7](show_bug.cgi?id=773370#c7)  Petr Matousek    2012-01-16 17:03:11 UTC  ``` *** [Bug 782123](show_bug.cgi?id=782123) has been marked as a duplicate of this bug. ***   ```  [Comment 8](show_bug.cgi?id=773370#c8)  Petr Matousek    2012-01-18 21:05:47 UTC  ``` Statement:  This issue did not affect the versions of Linux kernel as shipped with Red Hat Enterprise Linux 4 and Red Hat Enterprise MRG as they did not provide support for the KVM subsystem. This issue did not affect the versions of kvm as shipped with Red Hat Enterprise Linux 5 as they did not include support for syscall instruction emulation. This has been addressed in Red Hat Enterprise Linux 6 via <https://rhn.redhat.com/errata/RHSA-2012-0350.html>.   ```  [Comment 10](show_bug.cgi?id=773370#c10)  errata-xmlrpc    2012-03-06 18:46:34 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2012:0350 <https://rhn.redhat.com/errata/RHSA-2012-0350.html>   ```  [Comment 11](show_bug.cgi?id=773370#c11)  errata-xmlrpc    2012-03-26 15:18:16 UTC  ``` This issue has been addressed in following products:    RHEV-H and Agents for RHEL-6  Via RHSA-2012:0422 <https://rhn.redhat.com/errata/RHSA-2012-0422.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=773370&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.openwall.com_f48506a6_20250124_220133.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2012/01/11/4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4F0E24B5.7060503@redhat.com>
Date: Wed, 11 Jan 2012 17:09:25 -0700
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE request -- kernel: kvm: syscall instruction
 induced guest panic

On 01/11/2012 01:19 PM, Petr Matousek wrote:
> "32bit guests will crash (and 64bit guests may behave in a
> wrong way) for example by simply executing following
> nasm-demo-application:
>
>     [bits 32]
>     global _start
>     SECTION .text
>     _start: syscall
>
> The reason seems a missing "invalid opcode"-trap (int6) for the
> syscall opcode "0f05", which is not available on Intel CPUs
> within non-longmodes, as also on some AMD CPUs within legacy-mode.
> (depending on CPU vendor, MSR_EFER and cpuid)
>
> Because previous mentioned OSs may not engage corresponding
> syscall target-registers (STAR, LSTAR, CSTAR), they remain
> NULL and (non trapping) syscalls are leading to multiple
> faults and finally crashs."
>
> References:
> <https://bugzilla.redhat.com/show_bug.cgi?id=773370>
> <https://lkml.org/lkml/2011/12/28/170>
> <http://www.spinics.net/lists/kvm/msg66633.html>
>
> Proposed patch:
> <http://www.spinics.net/lists/kvm/msg66633.html>
>
> Credits:
> Stephan Bärwolf
>
> Introduced by:
> e66bb2ccdcf76d032bbb464b35c292bb3ee58f9b in linux-2.6.32
>
> Thanks,
Please use CVE-2012-0045 for this issue.

--

-- Kurt Seifried / Red Hat Security Response Team

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.openwall.net_ae5d8845_20250126_034838.html ===


| [lists.openwall.net](https://lists.openwall.net) [lists](/)  /  [announce](https://www.openwall.com/lists/announce/)  [owl-users](https://www.openwall.com/lists/owl-users/)  [owl-dev](https://www.openwall.com/lists/owl-dev/)  [john-users](https://www.openwall.com/lists/john-users/)  [john-dev](https://www.openwall.com/lists/john-dev/)  [passwdqc-users](https://www.openwall.com/lists/passwdqc-users/)  [yescrypt](https://www.openwall.com/lists/yescrypt/)  [popa3d-users](https://www.openwall.com/lists/popa3d-users/)  /  [oss-security](https://www.openwall.com/lists/oss-security/)  [kernel-hardening](https://www.openwall.com/lists/kernel-hardening/)  [musl](https://www.openwall.com/lists/musl/)  [sabotage](https://www.openwall.com/lists/sabotage/)  [tlsify](https://www.openwall.com/lists/tlsify/)  [passwords](https://www.openwall.com/lists/passwords/)  /  [crypt-dev](https://www.openwall.com/lists/crypt-dev/)  [xvendor](https://www.openwall.com/lists/xvendor/)  /  [Bugtraq](/bugtraq/)  [Full-Disclosure](/full-disclosure/)  [linux-kernel](/linux-kernel/)  linux-[netdev](/netdev/)  [linux-ext4](/linux-ext4/)  [linux-hardening](/linux-hardening/)  [linux-cve-announce](/linux-cve-announce/)  [PHC](/phc-discussions/)| *Open Source and information security mailing list archives*|  | | | | |
| --- | --- | --- | --- | --- |

| | [Hash Suite: Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

# Open Source and information security mailing list archives

### Openwall-hosted community mailing lists

* [oss-security](https://www.openwall.com/lists/oss-security/)
  ([info](https://oss-security.openwall.org/wiki/mailing-lists/oss-security)) -
  Open Source software security discussions
  (there's also a [wiki](https://oss-security.openwall.org/wiki/))* [kernel-hardening](https://www.openwall.com/lists/kernel-hardening/) -
    Linux kernel security hardening discussions (see also linux-hardening below)* [libc-coord](https://www.openwall.com/lists/libc-coord/) -
      [coordination of work on standard C libraries (libc)](https://www.openwall.com/lists/libc-coord/2020/01/30/1)* [musl](https://www.openwall.com/lists/musl/) - discussions around
        [musl](https://www.musl-libc.org),
        a new standard C library for Linux* [passwords](https://www.openwall.com/lists/passwords/) - discussions on anything related to passwords
          except what better fits on other mailing lists* [sabotage](https://www.openwall.com/lists/sabotage/) -
            discussions around Sabotage Linux,
            an experimental distribution based on musl and BusyBox* [tlsify](https://www.openwall.com/lists/tlsify/) - [a TLS API](https://www.openwall.com/lists/tlsify/2015/09/28/1)
              for file-descriptor-oriented applications to make use of secure (TLS) sockets
              without invasive changes to their programming model

### Openwall mailing lists

* [announce](https://www.openwall.com/lists/announce/) - announcements only, very low traffic* [owl-users](https://www.openwall.com/lists/owl-users/) -
    [Openwall GNU/\*/Linux](https://www.openwall.com/Owl/) (Owl) user discussions* [owl-dev](https://www.openwall.com/lists/owl-dev/) - Owl development discussions* [lkrg-users](https://www.openwall.com/lists/lkrg-users/) -
        [Linux Kernel Runtime Guard](https://www.openwall.com/lkrg/) user discussions* [john-users](https://www.openwall.com/lists/john-users/) -
          [John the Ripper](https://www.openwall.com/john/) password cracker user discussions

          See also:
          [selected most useful and currently relevant postings](https://openwall.info/wiki/john/mailing-list-excerpts)* [john-dev](https://www.openwall.com/lists/john-dev/) -
            John the Ripper development discussions* [passwdqc-users](https://www.openwall.com/lists/passwdqc-users/) -
              [passwdqc](https://www.openwall.com/passwdqc/)
              password/passphrase strength checking and policy enforcement toolset user discussions* [yescrypt](https://www.openwall.com/lists/yescrypt/) -
                discussions around [yescrypt](https://www.openwall.com/yescrypt/) KDF and password hashing scheme* [popa3d-users](https://www.openwall.com/lists/popa3d-users/) -
                  [popa3d](https://www.openwall.com/popa3d/) Unix POP3 daemon user discussions

### Obsolete/inactive Openwall(-hosted) mailing lists

* [crypt-dev](https://www.openwall.com/lists/crypt-dev/) -
  [design and implementation of a new password hashing method for servers](https://www.openwall.com/lists/crypt-dev/2011/04/05/2)* [xvendor](https://www.openwall.com/lists/xvendor/)
    ([info](https://www.openwall.com/community/xvendor)) -
    collaboration and information exchange between OS distribution vendors
    (mostly Linux) on non-security topics

### Other (third-party) mailing lists

* [Bugtraq](bugtraq/) -
  security vulnerability announcements and discussions, pre-moderated* [Full-Disclosure](full-disclosure/) -
    security vulnerability announcements and discussions, originally not moderated but now also pre-moderated* [linux-kernel](linux-kernel/) -
      Linux kernel development discussions, very high volume* [netdev](netdev/) -
        Linux networking subsystem development discussions, high volume* [linux-ext4](linux-ext4/) -
          Linux ext4 filesystem development* [linux-hardening](linux-hardening/) -
            Linux kernel security hardening discussions (focused on upstream maintenance of the changes)* [linux-cve-announce](linux-cve-announce/) -
              [Linux kernel CVE announcements](https://docs.kernel.org/process/cve.html)* [PHC discussions](phc-discussions/) -
                [Password Hashing Competition](https://password-hashing.net)
                discussions

Quick Comment:

| [Powered by Openwall GNU/*/Linux](https://www.openwall.com/Owl/ "Powered by Openwall GNU/*/Linux - security-enhanced \"Linux distribution\"") [Powered by OpenVZ](https://openvz.org "Powered by OpenVZ - OS virtualization solution for Linux") 783626 | |
| --- | --- |



=== Content from lists.opensuse.org_a6dc7c12_20250124_220116.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/#7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH)

# [security-announce] SUSE-SU-2012:0616-1: important: Security update for Linux kernel

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

14 May
2012

14 May
'12

14:08

SUSE Security Update: Security update for Linux kernel
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2012:0616-1
Rating: important
References: #611264 #617344 #624072 #652942 #668194 #676204
#688079 #693639 #697920 #700449 #704280 #713148
#714507 #716850 #717994 #719793 #720374 #721366
#727834 #729247 #731809 #733761 #734300 #734900
#737326 #738210 #738503 #738528 #738679 #740180
#740895 #740969 #742210 #742358 #743209 #743619
#744163 #744658 #745422 #745699 #745832 #745929
#746980 #747028 #747430 #747445 #748112 #748279
#748812 #749342 #749569 #749886 #750079 #750171
#751322 #751844 #751880 #752491 #752634 #752972
#755178 #755537 #756448 #756840 #757917 #758532
#758813 #759544
Cross-References: CVE-2011-1083 CVE-2011-4086 CVE-2011-4622
CVE-2012-0045 CVE-2012-0879 CVE-2012-1090
CVE-2012-1097 CVE-2012-2133
Affected Products:
SUSE Linux Enterprise Server 11 SP2
SUSE Linux Enterprise Server 11 SP1 for VMware
SUSE Linux Enterprise Server 11 SP1
SUSE Linux Enterprise High Availability Extension 11 SP1
SUSE Linux Enterprise Desktop 11 SP2
SUSE Linux Enterprise Desktop 11 SP1
SLE 11 SERVER Unsupported Extras
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves 8 vulnerabilities and has 60 fixes is
now available. It includes one version update.
Description:
The SUSE Linux Enterprise 11 SP1 kernel have been updated
to the 2.6.32.59 stable release to fix a lot of bugs and
security issues.
The following security issues have been fixed:
\* CVE-2012-2133: A use after free bug in hugetlb
support could be used by local attackers to crash the
system.
\* CVE-2012-1097: A null pointer dereference bug in the
regsets proc file could be used by local attackers to
perhaps crash the system. With mmap\_min\_addr is set and
enabled, exploitation is unlikely.
\* CVE-2012-0879: A reference counting issue in CLONE\_IO
could be used by local attackers to cause a denial of
service (out of memory).
\* CVE-2012-1090: A file handle leak in CIFS code could
be used by local attackers to crash the system.
\* CVE-2011-1083: Large nested epoll chains could be
used by local attackers to cause a denial of service
(excessive CPU consumption).
\* CVE-2011-4622: When using KVM, programming a PIT
timer without a irqchip configuration, can be used to crash
the kvm guest. This likely can be done only by a privileged
guest user.
\* CVE-2012-0045: A KVM 32bit guest crash in "syscall"
opcode handling was fixed that could be caused by local
attackers.
\* CVE-2011-4086: Fixed a oops in jbd/jbd2 that could be
caused by specific filesystem access patterns.
The following non-security issues have been fixed:
X86:
\* x86: fix the initialization of physnode\_map
(bnc#748112).
\* x86: Allow bootmem reserves at greater than 8G node
offset within a node (bnc#740895).
\* x86, tsc: Fix SMI induced variation in
quick\_pit\_calibrate(). (bnc#751322)
\* x86, efi: Work around broken firmware. (bnc#714507)
BONDING:
\* bonding: update speed/duplex for NETDEV\_CHANGE
(bnc#752634).
\* bonding: comparing a u8 with -1 is always false
(bnc#752634).
\* bonding: start slaves with link down for ARP monitor
(bnc#752634).
\* bonding: send gratuitous ARP for all addresses
(bnc#752491).
XFS:
\* xfs: Fix excessive inode syncing when project quota
is exceeded (bnc#756448).
\* xfs: Fix oops on IO error during
xlog\_recover\_process\_iunlinks() (bnc#716850).
SCSI:
\* scsi/ses: Handle non-unique element descriptors
(bnc#749342, bnc#617344).
\* scsi/sd: mark busy sd majors as allocated
(bug#744658).
\* scsi: Check for invalid sdev in
scsi\_prep\_state\_check() (bnc#734300).
MD/RAID:
\* md: fix possible corruption of array metadata on
shutdown.
\* md: ensure changes to write-mostly are reflected in
metadata (bnc#755178).
\* md: do not set md arrays to readonly on shutdown
(bnc#740180, bnc#713148, bnc#734900).
XEN:
\* smpboot: adjust ordering of operations.
\* x86-64: provide a memset() that can deal with 4Gb or
above at a time (bnc#738528).
\* blkfront: properly fail packet requests (bnc#745929).
\* Update Xen patches to 2.6.32.57.
\* xenbus: Reject replies with payload >
XENSTORE\_PAYLOAD\_MAX.
\* xenbus\_dev: add missing error checks to watch
handling.
\* Refresh other Xen patches (bnc#652942, bnc#668194,
bnc#688079).
\* fix Xen-specific kABI issue in Linux 2.6.19.
NFS:
\* NFSD: Fill in WCC data for REMOVE, RMDIR, MKNOD, and
MKDIR (bnc#751880).
\* nfs: Include SYNC flag when comparing mount options
with NOAC flag (bnc#745422).
\* NFS returns EIO for EDQUOT and others (bnc#747028).
\* lockd: fix arg parsing for grace\_period and timeout
(bnc#733761).
\* nfs: allow nfs4leasetime to be set before starting
servers (bnc#733761).
\* nfs: handle d\_revalidate of dot correctly
(bnc#731809).
S/390:
\* ctcmpc: use correct idal word list for ctcmpc
(bnc#750171,LTC#79264).
\* qeth: synchronize discipline module loading
(bnc#747430,LTC#78788).
\* qdio: avoid race leading to stall when tolerating CQ
(bnc#737326,LTC#76599).
\* kernel: no storage key operations for invalid page
table entries (bnc#737326,LTC#77697).
OTHER:
\* tlan: add cast needed for proper 64 bit operation
(bnc#756840).
\* dl2k: Tighten ioctl permissions (bnc#758813).
\* tg3: Fix RSS ring refill race condition (bnc#757917).
\* usbhid: fix error handling of not enough bandwidth
(bnc#704280).
\* pagecache limit: Fix the shmem deadlock (bnc#755537).
\* tty\_audit: fix tty\_audit\_add\_data live lock on audit
disabled (bnc#721366).
\* ixgbe: driver sets all WOL flags upon initialization
so that machine is powered on as soon at it is switched off
(bnc#693639)
\* PCI: Set device power state to PCI\_D0 for device
without native PM support (bnc#752972).
\* dlm: Do not allocate a fd for peeloff (bnc#729247).
\* sctp: Export sctp\_do\_peeloff (bnc#729247).
\* epoll: Do not limit non-nested epoll paths
(bnc#676204).
\* mlx4: Limit MSI-X vector allocation (bnc#624072).
\* mlx4: Changing interrupt scheme (bnc#624072).
\* mlx4\_en: Assigning TX irq per ring (bnc#624072).
\* mlx4\_en: Restoring RX buffer pointer in case of
failure (bnc#624072).
\* mlx4\_en: using new mlx4 interrupt scheme (bnc#624072).
\* igb: Fix for Alt MAC Address feature on 82580 and
later devices (bnc#746980).
\* igb: Power down link when interface is down
(bnc#745699).
\* igb: use correct bits to identify if managability is
enabled (bnc#743209).
\* intel\_agp: Do not oops with zero stolen memory
(bnc#738679).
\* agp: fix scratch page cleanup (bnc#738679).
\* hugetlb: add generic definition of NUMA\_NO\_NODE
(bnc#751844).
\* sched: Fix proc\_sched\_set\_task() (bnc#717994).
\* PM: Print a warning if firmware is requested when
tasks are frozen (bnc#749886).
\* PM / Sleep: Fix freezer failures due to racy
usermodehelper\_is\_disabled() (bnc#749886).
\* PM / Sleep: Fix read\_unlock\_usermodehelper() call
(bnc#749886).
\* firmware loader: allow builtin firmware load even if
usermodehelper is disabled (bnc#749886).
\* PM / Hibernate: Enable usermodehelpers in
software\_resume() error path (bnc#744163).
\* ipv6: Allow inet6\_dump\_addr() to handle more than 64
addresses (bnc#748279).
\* ipv6: fix refcnt problem related to POSTDAD state
(bnc#743619).
\* be2net: change to show correct physical link status
(bnc#727834).
\* be2net: changes to properly provide phy details
(bnc#727834).
\* aio: fix race between io\_destroy() and io\_submit()
(bnc#747445 bnc#611264).
\* intel-iommu: Check for identity mapping candidate
using system dma mask (bnc#700449).
\* intel-iommu: Dont cache iova above 32bit (bnc#700449).
\* intel-iommu: Add domain check in
domain\_remove\_one\_dev\_info (bnc#700449).
\* intel-iommu: Provide option to enable 64-bit IOMMU
pass through mode (bnc#700449).
\* intel-iommu: Remove Host Bridge devices from identity
mapping (bnc#700449).
\* intel-iommu: Speed up processing of the
identity\_mapping function (bnc#700449).
\* intel-iommu: Use coherent DMA mask when requested
(bnc#700449).
\* 1: Fix accounting of softirq time when idle
(bnc#719793).
\* driver-core: fix race between device\_register and
driver\_register (bnc#742358).
\* dcache:
patches.fixes/large-hash-dcache\_init-fix.patch: Fix oops
when initializing large hash on > 16TB machine (bnc#742210).
\* kdump: Save PG\_compound or PG\_head value in
VMCOREINFO (bnc#738503).
\* Update config files: disable NET\_9P\_RDMA (bnc#720374).
\* cdc-wdm: fix race leading leading to memory
corruption (bnc#759544).
Security Issue references:
\* CVE-2011-1083
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1083>

...

\* CVE-2011-4086
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4086>

...

\* CVE-2011-4622
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4622>

...

\* CVE-2012-0045
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0045>

...

\* CVE-2012-0879
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0879>

...

\* CVE-2012-1090
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1090>

...

\* CVE-2012-1097
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1097>

...

\* CVE-2012-2133
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-2133>

...

Indications:
Everyone using the Linux Kernel on x86\_64 architecture should update.
Special Instructions and Notes:
Please reboot the system after installing this update.
Patch Instructions:
To install this SUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- SUSE Linux Enterprise Server 11 SP2:
zypper in -t patch slessp1-kernel-6227 slessp1-kernel-6228 slessp1-kernel-6229 slessp1-kernel-6238
- SUSE Linux Enterprise Server 11 SP1 for VMware:
zypper in -t patch slessp1-kernel-6227 slessp1-kernel-6230
- SUSE Linux Enterprise Server 11 SP1:
zypper in -t patch slessp1-kernel-6227 slessp1-kernel-6228 slessp1-kernel-6229 slessp1-kernel-6230 slessp1-kernel-6238
- SUSE Linux Enterprise High Availability Extension 11 SP1:
zypper in -t patch sleshasp1-kernel-6227 sleshasp1-kernel-6228 sleshasp1-kernel-6229 sleshasp1-kernel-6230 sleshasp1-kernel-6238
- SUSE Linux Enterprise Desktop 11 SP2:
zypper in -t patch sledsp1-kernel-6227
- SUSE Linux Enterprise Desktop 11 SP1:
zypper in -t patch sledsp1-kernel-6227 sledsp1-kernel-6230
To bring your system up-to-date, use "zypper patch".
Package List:
- SUSE Linux Enterprise Server 11 SP2 (i586 ia64 ppc64 s390x):
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-default-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-trace-0\_2.6.32.59\_0.3-7.9.59
- SUSE Linux Enterprise Server 11 SP2 (ppc64):
ext4dev-kmp-ppc64-0\_2.6.32.59\_0.3-7.9.59
- SUSE Linux Enterprise Server 11 SP2 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-pae-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-xen-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-trace-0\_2.6.32.59\_0.3-0.18.16
kernel-ec2-2.6.32.59-0.3.1
kernel-ec2-base-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (i586 x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-default-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-trace-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-trace-0\_2.6.32.59\_0.3-0.18.16
kernel-default-2.6.32.59-0.3.1
kernel-default-base-2.6.32.59-0.3.1
kernel-default-devel-2.6.32.59-0.3.1
kernel-source-2.6.32.59-0.3.1
kernel-syms-2.6.32.59-0.3.1
kernel-trace-2.6.32.59-0.3.1
kernel-trace-base-2.6.32.59-0.3.1
kernel-trace-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-pae-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-pae-2.6.32.59-0.3.1
kernel-pae-base-2.6.32.59-0.3.1
kernel-pae-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586 ia64 ppc64 s390x x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-default-0\_2.6.32.59\_0.3-7.9.59
ext4dev-kmp-trace-0\_2.6.32.59\_0.3-7.9.59
kernel-default-2.6.32.59-0.3.1
kernel-default-base-2.6.32.59-0.3.1
kernel-default-devel-2.6.32.59-0.3.1
kernel-source-2.6.32.59-0.3.1
kernel-syms-2.6.32.59-0.3.1
kernel-trace-2.6.32.59-0.3.1
kernel-trace-base-2.6.32.59-0.3.1
kernel-trace-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586 x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-xen-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-trace-0\_2.6.32.59\_0.3-0.18.16
kernel-ec2-2.6.32.59-0.3.1
kernel-ec2-base-2.6.32.59-0.3.1
kernel-ec2-devel-2.6.32.59-0.3.1
kernel-xen-2.6.32.59-0.3.1
kernel-xen-base-2.6.32.59-0.3.1
kernel-xen-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (s390x) [New Version: 2.6.32.59]:
kernel-default-man-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (ppc64) [New Version: 2.6.32.59]:
ext4dev-kmp-ppc64-0\_2.6.32.59\_0.3-7.9.59
kernel-ppc64-2.6.32.59-0.3.1
kernel-ppc64-base-2.6.32.59-0.3.1
kernel-ppc64-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
ext4dev-kmp-pae-0\_2.6.32.59\_0.3-7.9.59
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-pae-2.6.32.59-0.3.1
kernel-pae-base-2.6.32.59-0.3.1
kernel-pae-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise High Availability Extension 11 SP1 (i586 ia64 ppc64 s390x x86\_64):
cluster-network-kmp-default-1.4\_2.6.32.59\_0.3-2.5.45
cluster-network-kmp-trace-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-default-2\_2.6.32.59\_0.3-0.2.91
gfs2-kmp-trace-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-default-1.6\_2.6.32.59\_0.3-0.4.2.45
ocfs2-kmp-trace-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise High Availability Extension 11 SP1 (i586 x86\_64):
cluster-network-kmp-xen-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-xen-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-xen-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise High Availability Extension 11 SP1 (ppc64):
cluster-network-kmp-ppc64-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-ppc64-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-ppc64-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise High Availability Extension 11 SP1 (i586):
cluster-network-kmp-pae-1.4\_2.6.32.59\_0.3-2.5.45
gfs2-kmp-pae-2\_2.6.32.59\_0.3-0.2.91
ocfs2-kmp-pae-1.6\_2.6.32.59\_0.3-0.4.2.45
- SUSE Linux Enterprise Desktop 11 SP2 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-desktop-devel-2.6.32.59-0.3.1
- SUSE Linux Enterprise Desktop 11 SP1 (i586 x86\_64) [New Version: 2.6.32.59]:
btrfs-kmp-default-0\_2.6.32.59\_0.3-0.3.92
btrfs-kmp-xen-0\_2.6.32.59\_0.3-0.3.92
hyper-v-kmp-default-0\_2.6.32.59\_0.3-0.18.16
kernel-default-2.6.32.59-0.3.1
kernel-default-base-2.6.32.59-0.3.1
kernel-default-devel-2.6.32.59-0.3.1
kernel-default-extra-2.6.32.59-0.3.1
kernel-desktop-devel-2.6.32.59-0.3.1
kernel-source-2.6.32.59-0.3.1
kernel-syms-2.6.32.59-0.3.1
kernel-trace-devel-2.6.32.59-0.3.1
kernel-xen-2.6.32.59-0.3.1
kernel-xen-base-2.6.32.59-0.3.1
kernel-xen-devel-2.6.32.59-0.3.1
kernel-xen-extra-2.6.32.59-0.3.1
- SUSE Linux Enterprise Desktop 11 SP1 (i586) [New Version: 2.6.32.59]:
btrfs-kmp-pae-0\_2.6.32.59\_0.3-0.3.92
hyper-v-kmp-pae-0\_2.6.32.59\_0.3-0.18.16
kernel-pae-2.6.32.59-0.3.1
kernel-pae-base-2.6.32.59-0.3.1
kernel-pae-devel-2.6.32.59-0.3.1
kernel-pae-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (i586 ia64 ppc64 s390x x86\_64):
kernel-default-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (i586 x86\_64):
kernel-xen-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (ppc64):
kernel-ppc64-extra-2.6.32.59-0.3.1
- SLE 11 SERVER Unsupported Extras (i586):
kernel-pae-extra-2.6.32.59-0.3.1
References:
<http://support.novell.com/security/cve/CVE-2011-1083.html>
<http://support.novell.com/security/cve/CVE-2011-4086.html>
<http://support.novell.com/security/cve/CVE-2011-4622.html>
<http://support.novell.com/security/cve/CVE-2012-0045.html>
<http://support.novell.com/security/cve/CVE-2012-0879.html>
<http://support.novell.com/security/cve/CVE-2012-1090.html>
<http://support.novell.com/security/cve/CVE-2012-1097.html>
<http://support.novell.com/security/cve/CVE-2012-2133.html>
<https://bugzilla.novell.com/611264>
<https://bugzilla.novell.com/617344>
<https://bugzilla.novell.com/624072>
<https://bugzilla.novell.com/652942>
<https://bugzilla.novell.com/668194>
<https://bugzilla.novell.com/676204>
<https://bugzilla.novell.com/688079>
<https://bugzilla.novell.com/693639>
<https://bugzilla.novell.com/697920>
<https://bugzilla.novell.com/700449>
<https://bugzilla.novell.com/704280>
<https://bugzilla.novell.com/713148>
<https://bugzilla.novell.com/714507>
<https://bugzilla.novell.com/716850>
<https://bugzilla.novell.com/717994>
<https://bugzilla.novell.com/719793>
<https://bugzilla.novell.com/720374>
<https://bugzilla.novell.com/721366>
<https://bugzilla.novell.com/727834>
<https://bugzilla.novell.com/729247>
<https://bugzilla.novell.com/731809>
<https://bugzilla.novell.com/733761>
<https://bugzilla.novell.com/734300>
<https://bugzilla.novell.com/734900>
<https://bugzilla.novell.com/737326>
<https://bugzilla.novell.com/738210>
<https://bugzilla.novell.com/738503>
<https://bugzilla.novell.com/738528>
<https://bugzilla.novell.com/738679>
<https://bugzilla.novell.com/740180>
<https://bugzilla.novell.com/740895>
<https://bugzilla.novell.com/740969>
<https://bugzilla.novell.com/742210>
<https://bugzilla.novell.com/742358>
<https://bugzilla.novell.com/743209>
<https://bugzilla.novell.com/743619>
<https://bugzilla.novell.com/744163>
<https://bugzilla.novell.com/744658>
<https://bugzilla.novell.com/745422>
<https://bugzilla.novell.com/745699>
<https://bugzilla.novell.com/745832>
<https://bugzilla.novell.com/745929>
<https://bugzilla.novell.com/746980>
<https://bugzilla.novell.com/747028>
<https://bugzilla.novell.com/747430>
<https://bugzilla.novell.com/747445>
<https://bugzilla.novell.com/748112>
<https://bugzilla.novell.com/748279>
<https://bugzilla.novell.com/748812>
<https://bugzilla.novell.com/749342>
<https://bugzilla.novell.com/749569>
<https://bugzilla.novell.com/749886>
<https://bugzilla.novell.com/750079>
<https://bugzilla.novell.com/750171>
<https://bugzilla.novell.com/751322>
<https://bugzilla.novell.com/751844>
<https://bugzilla.novell.com/751880>
<https://bugzilla.novell.com/752491>
<https://bugzilla.novell.com/752634>
<https://bugzilla.novell.com/752972>
<https://bugzilla.novell.com/755178>
<https://bugzilla.novell.com/755537>
<https://bugzilla.novell.com/756448>
<https://bugzilla.novell.com/756840>
<https://bugzilla.novell.com/757917>
<https://bugzilla.novell.com/758532>
<https://bugzilla.novell.com/758813>
<https://bugzilla.novell.com/759544>
[http://download.novell.com/patch/finder/?keywords=1e4adcc13979f6e0edae89a1f8...](http://download.novell.com/patch/finder/?keywords=1e4adcc13979f6e0edae89a1f83efe4b)
[http://download.novell.com/patch/finder/?keywords=53329dfb9cc84e6d2bc6d1f418...](http://download.novell.com/patch/finder/?keywords=53329dfb9cc84e6d2bc6d1f418dd371c)
[http://download.novell.com/patch/finder/?keywords=58369efceea971820d4fcd4d5a...](http://download.novell.com/patch/finder/?keywords=58369efceea971820d4fcd4d5a7c2ef6)
[http://download.novell.com/patch/finder/?keywords=59f23e0836e0df248ae14c769e...](http://download.novell.com/patch/finder/?keywords=59f23e0836e0df248ae14c769ecdd7d3)
[http://download.novell.com/patch/finder/?keywords=763d59c2691aa9de51f489118d...](http://download.novell.com/patch/finder/?keywords=763d59c2691aa9de51f489118dbe394c)
[http://download.novell.com/patch/finder/?keywords=a1f901b5aa53a2ebe1c8ee72b5...](http://download.novell.com/patch/finder/?keywords=a1f901b5aa53a2ebe1c8ee72b5bf4f77)
[http://download.novell.com/patch/finder/?keywords=aec0b832ae76838da3b2076f7d...](http://download.novell.com/patch/finder/?keywords=aec0b832ae76838da3b2076f7d59e991)
[http://download.novell.com/patch/finder/?keywords=c9182ab9f8793390d728336608...](http://download.novell.com/patch/finder/?keywords=c9182ab9f8793390d7283366086c5f96)
[http://download.novell.com/patch/finder/?keywords=eb828a35b91422d320f8c3f2f8...](http://download.novell.com/patch/finder/?keywords=eb828a35b91422d320f8c3f2f81d2876)
[http://download.novell.com/patch/finder/?keywords=efd514eca66da8be4a95dffed7...](http://download.novell.com/patch/finder/?keywords=efd514eca66da8be4a95dffed72779e5)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH/#7K3KOVJG6SHW3GNYC6QDTQVNM2VYYIPH)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from access.redhat.com_89ed48e9_20250126_034838.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


