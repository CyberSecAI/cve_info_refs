=== Content from bugzilla.mozilla.org_f6e36185_20250125_103010.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/712289)
* [XML](/show_bug.cgi?ctype=xml&id=712289)

Closed
[Bug 712289](/show_bug.cgi?id=712289)

Opened 13 years ago
Closed 13 years ago

# jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla12

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| firefox-esr10 | [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | - | affected |
| firefox10 | + | verified |
| firefox11 | + | verified |
| firefox-esr10 | 10+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: Honza, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/34b251cf082c202fb3160b1afb810001?d=mm&size=40)  [Honza](/user_profile?user_id=303767)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

21 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[684526](/show_bug.cgi?id=684526 "RESOLVED FIXED - Figure out what to do about gcc pr50284 by reunifying jsval and JS::Value (né js::Value)"), [689118](/show_bug.cgi?id=689118 "VERIFIED FIXED - Firefox- Crash Report [@ js::AutoCompartment::AutoCompartment ]"), [715907](/show_bug.cgi?id=715907 "RESOLVED FIXED - crash in jsd_NewValue @ JSCompartment::wrap with Firebug"), [716268](/show_bug.cgi?id=716268 "RESOLVED WONTFIX - Firefox crashes when clicking on a jQuery link, very strange vars in Firebug")

Dependency [tree](/showdependencytree.cgi?id=712289&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=712289)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [emorley](/user_profile?user_id=373476) | [in-testsuite](#c44 "13 years ago") | + |
| --- | --- | --- |
| [emorley](/user_profile?user_id=373476) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [Test extension](/attachment.cgi?id=584014)  [13 years ago](#c6)  [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767)   3.31 KB, application/x-xpinstall |  | [Details](/attachment.cgi?id=584014&action=edit) |
| --- | --- | --- |
| [Make sure that alignment requirements agree for js::Value and jsval\_layout.](/attachment.cgi?id=588450)  [13 years ago](#c14)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   3.42 KB, patch | luke : [review+](#c17 "13 years ago") | [Details](/attachment.cgi?id=588450&action=edit) | [Diff](/attachment.cgi?id=588450&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588450) |
| [With those changes](/attachment.cgi?id=588591)  [13 years ago](#c20)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   3.20 KB, patch | luke : [review+](#c21 "13 years ago") | [Details](/attachment.cgi?id=588591&action=edit) | [Diff](/attachment.cgi?id=588591&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588591) |
| [Make sure that alignment requirements agree for js::Value and jsval\_layout.](/attachment.cgi?id=588708)  [13 years ago](#c23)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   4.13 KB, patch | akeybl : [approval-mozilla-aurora+](#c30 "13 years ago")  akeybl : [approval-mozilla-beta+](#c30 "13 years ago") | [Details](/attachment.cgi?id=588708&action=edit) | [Diff](/attachment.cgi?id=588708&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588708) |
| [Test alignment of jsval across C and C++](/attachment.cgi?id=589107)  [13 years ago](#c33)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   2.35 KB, patch | bzbarsky : [review+](#c34 "13 years ago") | [Details](/attachment.cgi?id=589107&action=edit) | [Diff](/attachment.cgi?id=589107&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=589107) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=712289#c0)• 13 years ago |
|  | |

Firebug is using jsdIValue.getWrappedValue() API to get list of of local (closure) scope variables (names and values).
To get list of a scope properties, Firebug is using:
var listValue = {value: null}, lengthValue = {value: 0};
jsdIStackFrame frame.scope.getProperties(listValue, lengthValue);
It works on Windows, but in Ubuntu - applying getWrappedValue() on returned properties (prop.name and prop.value), returns a number instead of a name or a value.
Here is the related code in Firebug SVN:
<http://code.google.com/p/fbug/source/browse/branches/firebug1.9/content/firebug/lib/wrapper.js#73>
STR:
1) Install Firebug e.g. from here: <http://code.google.com/p/fbug/issues/detail?id=5058#c4>
2) Load <http://getfirebug.com/tests/content/branches/1.9/script/watch/5019/issue5019.html>
3) Follow steps on the test page.
The Watch side panel properly displays local variables a, b, c and their values in Windows, but in Ubuntu I am seeing something like: -4.428469523771077e-75, 2.12199573e-314, etc. (looks like a reference/address instead of an actual value)
Tested with Firefox Nightly:
Built from <http://hg.mozilla.org/mozilla-central/rev/2afd7ae68e8b>
Honza

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=712289#c1)• 13 years ago |
|  | |

Assuming this just appeared on the nightlies, this is likely a regression from [bug 705444](/show_bug.cgi?id=705444 "RESOLVED FIXED - Use IDL for jsdIValue::GetWrappedValue") (or maybe [bug 708754](/show_bug.cgi?id=708754 "RESOLVED FIXED - Use IDL for jsdIDebuggerService::WrapValue and remove WrapJSValue")). Ms2ger, can you look into this?

|  | [Simon Lindholm](/user_profile?user_id=394022) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=712289#c2)• 13 years ago |
|  | |

Sadly I can reproduce this behavior in Firefox 9 and up. i686-pc-linux-gnu, Ubuntu 11.10. Not all variables show up weird, for example in the test <http://getfirebug.com/tests/content/branches/1.9/commandLine/4434/issue4434.html> precisely function parameters seem to be affected.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=712289#c3)• 13 years ago |
|  | |

Jan, are you seeing this with the 32-bit Linux nightlies?

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=712289#c4)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #3](/show_bug.cgi?id=712289#c3 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> Jan, are you seeing this with the 32-bit Linux nightlies?
Yes

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=712289#c5)• 13 years ago |
|  | |

OK. Could you possibly create a smallish testcase I can run to reproduce the bug?

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=712289#c6)• 13 years ago |
|  | |

Attached file
[Test extension](attachment.cgi?id=584014)
— [Details](attachment.cgi?id=584014&action=edit)

Sure thing, here you go
1) Install the attached extension
2) Open test.html file (you need to extract it from the xpi), you should use http: or file: to open that file
3) Click the button on the page
4) Watch system console (dump) or Firefox Error Console
I am seeing, in Windows:
scope: Call
scope vars: c: false, b: 100, a: hello
in Linux (Ubuntu 9.04):
scope: Call
scope vars: c: false, -2.21420102685212e-75: 2.143215748267e-312, undefined: a
Honza

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=712289#c7)• 13 years ago |
|  | |

OK. I don't have Windows, but I \_can\_ reproduce the bug on both Linux and Mac... in a 32-bit build. In a 64-bit build, I get the expected output.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=712289#c8)• 13 years ago |
|  | |

OK. So we get into \_buildProps with this obj:
(gdb) call js\_DumpObject(obj)
object 0x19b78060
class 0x139596a0 Call
flags:
proto null
parent <Window object at 0x19b1c0d0>
private 0x195140a8
reserved slots:
0 (reserved) = <Window object at 0x19b1c0d0>
1 (reserved) = <function executeTest (file:///Users/bzbarsky/test/test.html:26) at 0x19b2f2e0>
2 (reserved) = undefined
properties:
((Shape \*) 0x19b21ce8) enumerate permanent getterOp=0x1351d286 setterOp=0x13521326 "a": slot 3 = undefined
((Shape \*) 0x19b21d00) enumerate permanent getterOp=0x1351d286 setterOp=0x13521326 "b": slot 4 = undefined
((Shape \*) 0x19b7de20) enumerate permanent getterOp=0x1351d286 setterOp=0x13521326 "c": slot 5 = undefined
Then we call JS\_GetPropertyDescArray on this object. And we get a result which is bogus. The first entry is ok, but after that:
(gdb) p/x pda.array[1].id
$41 = {
asBits = 0x19a00630ffffff82,
s = {
payload = {
i32 = 0xffffff82,
u32 = 0xffffff82,
boo = 0xffffff82,
str = 0xffffff82,
obj = 0xffffff82,
ptr = 0xffffff82,
why = 0xffffff82,
word = 0xffffff82
},
tag = 0x19a00630
},
asDouble = 0x0,
asPtr = 0xffffff82
}
Now the weird thing is that if I look at pda->array[1].id right before the return JS\_TRUE in JS\_GetPropertyDescArray, it looks like this:
(gdb) p/x pda->array[1].id
$88 = {
data = {
asBits = 0xffffff8519a00630,
s = {
payload = {
i32 = 0x19a00630,
u32 = 0x19a00630,
boo = 0x19a00630,
str = 0x19a00630,
obj = 0x19a00630,
ptr = 0x19a00630,
why = 0x19a00630,
word = 0x19a00630
},
tag = 0xffffff85
},
asDouble = 0x8000000000000000,
asPtr = 0x19a00630
}
}
which is a perfectly reasonable string.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=712289#c9)• 13 years ago |
|  | |

This is not an xpconnect bug. Things go wrong in jseng.Assignee: nobody → generalComponent: XPConnect → JavaScript EngineQA Contact: xpconnect → general

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=712289#c10)• 13 years ago |
|  | |

OK. So inside JS\_GetPropertyDescArray we have:
(gdb) p &pda->array[0]
$105 = (JSPropertyDesc \*) 0x46d3e0
(gdb) p sizeof(pda->array[0])
$106 = 32
and once we return we have:
(gdb) p &pda.array[0]
$108 = (JSPropertyDesc \*) 0x46d3e0
(gdb) p sizeof(pda.array[0])
$109 = 28

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=712289#c11)• 13 years ago |
|  | |

Inside JS\_GetPropertyDescArray:
(gdb) p &pda->array[0]
$121 = (JSPropertyDesc \*) 0x416bd0
(gdb) p (char\*)&$121->flags - (char\*)$121
$122 = 16
(gdb) p (char\*)&$121->alias - (char\*)$121
$123 = 24
After we return:
(gdb) p &pda.array[0]
$125 = (JSPropertyDesc \*) 0x416bd0
Current language: auto; currently c
(gdb) p (char\*)&$125->flags - (char\*)$125
$126 = 16
(gdb) p (char\*)&$125->alias - (char\*)$125
$127 = 20
Somehow the two compilation units are seeing different alignment requirements for jsval.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=712289#c12)• 13 years ago |
|  | |

The version of jsval that JS\_GetPropertyDescArray is a struct that has a single member called "data". The version of jsval in the C caller does not.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=712289#c13)• 13 years ago |
|  | |

OK, so jsval is jsval\_layout in C code. jsval\_layout is a union, but all the union members only require 4-byte alignment with GCC in 32-bit mode (yes, including the double; I just tested with a small testcase; I knew gcc did that for 64-bit ints, but the fact that it does it for doubles is a surprise).
In C++ code, jsval is js::Value, which has explicit JSVAL\_ALIGNMENT to make it require 8-byte alignment.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=712289#c14)• 13 years ago |
|  | |

Attached patch

[Make sure that alignment requirements agree for js::Value and jsval\_layout.](attachment.cgi?id=588450&action=diff) (obsolete)
— [Details](attachment.cgi?id=588450&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588450)

We should probably backport this to 10 and 11, right?
[Attachment #588450](/attachment.cgi?id=588450&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: review?(luke)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=712289#c15)• 13 years ago |
|  | |

Oh, and if someone knows how to write a regression test for this, please do.Assignee: general → bzbarskyWhiteboard: [need review]

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=712289#c16)• 13 years ago |
|  | |

This is almost certainly the cause of [bug 715907](/show_bug.cgi?id=715907 "RESOLVED FIXED - crash in jsd_NewValue @ JSCompartment::wrap with Firebug").Blocks: [715907](/show_bug.cgi?id=715907 "RESOLVED FIXED - crash in jsd_NewValue @ JSCompartment::wrap with Firebug")

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=712289#c17)• 13 years ago |
|  | |

Comment on [attachment 588450](/attachment.cgi?id=588450 "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[details]](/attachment.cgi?id=588450&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[diff]](/attachment.cgi?id=588450&action=diff "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588450)
Make sure that alignment requirements agree for js::Value and jsval\_layout.
Thanks bz!
>+ struct jsval\_layoutAlignmentTester {
>+ char c;
>+ jsval\_layout l;
>+ };
Could you rename to LayoutAlignmentTester?
>+struct ValueAlignmentTester {
>+ char c;
>+ Value v;
>+};
>+JS\_STATIC\_ASSERT(sizeof(ValueAlignmentTester) == 16);
and move ValueAlignmentTester right below LayoutAlignmentTester and put the static assert in staticAssertions() (complete type is visible in memfuns)
[Attachment #588450](/attachment.cgi?id=588450&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: review?(luke) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=712289#c18)• 13 years ago |
|  | |

> Could you rename to LayoutAlignmentTester?
Yes.
> and move ValueAlignmentTester right below LayoutAlignmentTester
Doesn't compile, because it claims that Value is not a complete type when defining ValueAlignmentTester. I actually had it that way to start with, but had to change to this setup...

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=712289#c19)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #18](/show_bug.cgi?id=712289#c18 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
Ah, of course; then how about:
void staticAsserts() {
struct ValueAlignmentTester { char c; Value v; };
JS\_STATIC\_ASSERT(sizeof(ValueAlignmentTester) == 16);
}
? (And, for symmetry, could you put LayoutAlignmentTester right below it?)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=712289#c20)• 13 years ago |
|  | |

Attached patch

[With those changes](attachment.cgi?id=588591&action=diff)
— [Details](attachment.cgi?id=588591&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588591)

[Attachment #588591](/attachment.cgi?id=588591&action=edit "With those changes") -
Flags: review?(luke)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2125228_20209)• 13 years ago |

[Attachment #588450](/attachment.cgi?id=588450&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Attachment is obsolete: true

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=712289#c21)• 13 years ago |
|  | |

Comment on [attachment 588591](/attachment.cgi?id=588591 "With those changes") [[details]](/attachment.cgi?id=588591&action=edit "With those changes") [[diff]](/attachment.cgi?id=588591&action=diff "With those changes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588591)
With those changes
I just realized, though, that this whole block is only #ifdef \_\_cplusplus. I think, ideally, the jsval\_layout static assert would be right after the lines:
#endif /\* defined (\_\_cplusplus) \*/
next to the:
JS\_STATIC\_ASSERT(sizeof(jsval\_layout) == sizeof(jsval));
and the JS::Value assert would be right above the
#else /\* defined(\_\_cplusplus) \*/
Secondly, since the \*Tester classes are outside any namespace in this context, they'd need a JS- prefix. Thanks again, sorry for the hassle.
[Attachment #588591](/attachment.cgi?id=588591&action=edit "With those changes") -
Flags: review?(luke) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=712289#c22)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/b4195741db43> pushed with those changes.
Going to request branch approval for this....
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F)Whiteboard: [need review]Target Milestone: --- → mozilla12

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=712289#c23)• 13 years ago |
|  | |

Attached patch

[Make sure that alignment requirements agree for js::Value and jsval\_layout.](attachment.cgi?id=588708&action=diff)
— [Details](attachment.cgi?id=588708&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588708)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=712289#c24)• 13 years ago |
|  | |

Comment on [attachment 588708](/attachment.cgi?id=588708 "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[details]](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[diff]](/attachment.cgi?id=588708&action=diff "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588708)
Make sure that alignment requirements agree for js::Value and jsval\_layout.
[Approval Request Comment]
Regression caused by (bug #): [bug 684526](/show_bug.cgi?id=684526 "RESOLVED FIXED - Figure out what to do about gcc pr50284 by reunifying jsval and JS::Value (né js::Value)")
User impact if declined: Using some JS debugger APIs at best returns garbage data and at worst crashes. The crashes may or may not be exploitable.
Testing completed (on m-c, etc.): The code compiles and fixes the testcase in this bug. It also passes our various other tests.
Risk to taking this patch (and alternatives if risky): Low risk, I believe, but please double-check with Luke.
[Attachment #588708](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: approval-mozilla-beta?
[Attachment #588708](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: approval-mozilla-aurora?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2211537_20209)• 13 years ago |

Blocks: [684526](/show_bug.cgi?id=684526 "RESOLVED FIXED - Figure out what to do about gcc pr50284 by reunifying jsval and JS::Value (né js::Value)")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2211807_20209)• 13 years ago |

Flags: in-testsuite?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2218871_20209)• 13 years ago |

Blocks: [716268](/show_bug.cgi?id=716268 "RESOLVED WONTFIX - Firefox crashes when clicking on a jQuery link, very strange vars in Firebug")

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2320086_69426)• 13 years ago |

Blocks: [689118](/show_bug.cgi?id=689118 "VERIFIED FIXED - Firefox- Crash Report [@ js::AutoCompartment::AutoCompartment ]")

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=712289#c25)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/b4195741db43>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=712289#c26)• 13 years ago |
|  | |

This bug appears to be biting people using release Firefox. See [bug 715907](/show_bug.cgi?id=715907 "RESOLVED FIXED - crash in jsd_NewValue @ JSCompartment::wrap with Firebug").
The user there claims Firefox crashes when using Firebug, once an hour or so.
Folks this is bad. The fact that it's crashing means the bug can trigger in practice. Likely a Web page can use it to introduce garbage jsvals into the engine. I have a hard time believing it's not exploitable.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=712289#c27)• 13 years ago |
|  | |

Agreed that this is probably exploitable, for what it's worth. I personally think we should fix this on 10 and 11 and at least consider a 9.0.2 (though 10 will ship pretty soon anyway, so maybe not worth worrying about).
I wonder whether this bites things that don't use jsd...
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2351345_281791)• 13 years ago |

Group: core-security
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=712289#c28)• 13 years ago |
|  | |

timeless points out that we could, in parallel to shipping the fix, block Firebug for users of the affected versions.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=712289#c29)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #24](/show_bug.cgi?id=712289#c24 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> Risk to taking this patch (and alternatives if risky): Low risk, I believe,
> but please double-check with Luke.
Agreed

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2352511_302720)• 13 years ago |

Summary: jsdIValue.getWrappedValue doesn't seem to work in Ubuntu 9.04 → jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2354792_425645)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=712289#c30)• 13 years ago |
|  | |

Comment on [attachment 588708](/attachment.cgi?id=588708 "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[details]](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[diff]](/attachment.cgi?id=588708&action=diff "Make sure that alignment requirements agree for js::Value and jsval_layout.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=588708)
Make sure that alignment requirements agree for js::Value and jsval\_layout.
[Triage Comment]
Deemed low risk and fixes crashes that may be significantly affecting a part of our user population. Also may prevent a security vulnerability. Approving for aurora and beta.
[Attachment #588708](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: approval-mozilla-beta?
[Attachment #588708](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: approval-mozilla-beta+
[Attachment #588708](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: approval-mozilla-aurora?
[Attachment #588708](/attachment.cgi?id=588708&action=edit "Make sure that alignment requirements agree for js::Value and jsval_layout.") -
Flags: approval-mozilla-aurora+

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2357395_5189)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=712289#c31)• 13 years ago |
|  | |

Sorry for resetting the flags, that was due to reloading the bug to dodge a mid-air collision. Unfortunately I can't undo that change myself so I guess Alex need to set those flags again. Sorry. :-/

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a2358335_425645)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=712289#c32)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/8b89bc45b439>
<http://hg.mozilla.org/releases/mozilla-beta/rev/59d8e5608ab7>
Alex, is this effectively wontfix for fx9?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=712289#c33)• 13 years ago |
|  | |

Attached patch

[Test alignment of jsval across C and C++](attachment.cgi?id=589107&action=diff)
— [Details](attachment.cgi?id=589107&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=589107)

I think this test is testing the right thing. No need to land it until the fix is in a release, though, especially with the static assert in place already.
[Attachment #589107](/attachment.cgi?id=589107&action=edit "Test alignment of jsval across C and C++") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=712289#c34)• 13 years ago |
|  | |

Comment on [attachment 589107](/attachment.cgi?id=589107 "Test alignment of jsval across C and C++") [[details]](/attachment.cgi?id=589107&action=edit "Test alignment of jsval across C and C++") [[diff]](/attachment.cgi?id=589107&action=diff "Test alignment of jsval across C and C++") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712289&attachment=589107)
Test alignment of jsval across C and C++
r=me
[Attachment #589107](/attachment.cgi?id=589107&action=edit "Test alignment of jsval across C and C++") -
Flags: review?(bzbarsky) → review+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=712289#c35)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #32](/show_bug.cgi?id=712289#c32 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> Alex, is this effectively wontfix for fx9?
Yep - that ship's sailed.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=712289#c36)• 13 years ago |
|  | |

> Yep - that ship's sailed.
Just to be clear about what I was asking. I know we've shipped Firefox 9. The question was about whether we should be considering a chemspill for this before the Fx10 release. If we're not, that's fine by me.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=712289#c37)• 13 years ago |
|  | |

Filed [bug 718831](/show_bug.cgi?id=718831 "RESOLVED WONTFIX - Block Firebug for Firefox 9 due to bug 712289") to get Firebug blocklisted in Firefox 9.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=712289#c38)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #36](/show_bug.cgi?id=712289#c36 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> > Yep - that ship's sailed.
>
> Just to be clear about what I was asking. I know we've shipped Firefox 9.
> The question was about whether we should be considering a chemspill for this
> before the Fx10 release. If we're not, that's fine by me.
The possibility of a 9.0.2 for this issue is off the table due to our proximity to 10's release and the fact that crashes are intermittent (according to blocked bugs).

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=712289#c39)• 13 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #37](/show_bug.cgi?id=712289#c37 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> Filed [bug 718831](/show_bug.cgi?id=718831 "RESOLVED WONTFIX - Block Firebug for Firefox 9 due to bug 712289") to get Firebug blocklisted in Firefox 9.
Is the motivation for this blocklist bug due to security concerns? Otherwise, this would appear to be blocklisting a usable add-on that causes intermittent crashes.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=712289#c40)• 13 years ago |
|  | |

This is clearly sg:critical for Firebug users, but if it isn't exploitable for users w/out a debugger the overall severity might be sg:moderate. Probably doesn't matter much since it's fixed.
Does not affect the old 1.9.2 branch.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[Comment 26](#c26) is private:
false
[Comment 27](#c27) is private:
false
[Comment 39](#c39) is private:
falseWhiteboard: [sg:critical]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a3738433_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Ginn Chen](/user_profile?user_id=130269) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=712289#c41)• 13 years ago |
|  | |

Why do we need #ifdef DEBUG for those JS\_STATIC\_ASSERTs?
Anyway, the asserts don't work with Solaris Studio compiler, because we don't use JSVAL\_ALIGNMENT, js::Value and jsval\_layout are both 4-byte alignment.
(If I use align attribute with Solaris Studio compiler, it has problems with C\_ValueToObject, it might be a bug of Solaris Studio.)
BTW: the "Test alignment of jsval across C and C++" patch was not committed.
And it has an extra "return sizeof(AlignTest);" in BEGIN\_TEST(testValueABI\_alignment).
So it didn't actually do the test.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=712289#c42)• 13 years ago |
|  | |

> Why do we need #ifdef DEBUG for those JS\_STATIC\_ASSERTs?
I didn't want to add new symbols in release bulds. It's not strictly needed.
> Anyway, the asserts don't work with Solaris Studio compiler
Hmm. I guess we should assert that the two structs have the same alignment, not that they have 8-byte alignment. Do you want to do that, or should I? Probably in a separate bug.
> BTW: the "Test alignment of jsval across C and C++" patch was not committed.
Indeed. Steve?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=712289#c43)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #42](/show_bug.cgi?id=712289#c42 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> > BTW: the "Test alignment of jsval across C and C++" patch was not committed.
>
> Indeed. Steve?
I wasn't sure what the policy was for tests of sg:crit bugs, so I stalled on landing it until the fix made it to a release. And then, of course, never got around to landing it after 10 was released.
(In reply to Ginn Chen from [comment #41](/show_bug.cgi?id=712289#c41 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)"))
> And it has an extra "return sizeof(AlignTest);" in
> BEGIN\_TEST(testValueABI\_alignment).
> So it didn't actually do the test.
Doh! I thought I tried this before and after the patch.
Oh. No, I didn't, because it would never fail on my development machine. Well, unless I cross-compiled to 32-bit, doing that now... yep, it works.
Thanks.
<http://hg.mozilla.org/integration/mozilla-inbound/rev/62635aac38dd>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=712289#c44)• 13 years ago |
|  | |

Test:
<https://hg.mozilla.org/mozilla-central/rev/62635aac38dd>Flags: in-testsuite? → in-testsuite+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a6864416_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a7285338_432443)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a7285558_432443)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a7285888_432443)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=712289#c45)• 13 years ago |
|  | |

Verified in FF 10.0.3 ESR, FF 10.0.2, FF 11 Beta, FF 12 Aurora, FF 13 Nightly.Status: RESOLVED → VERIFIEDWhiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a7463730_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712289#a8754735_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=712289&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_171b17cf_20250125_102959.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/684938)
* [XML](/show_bug.cgi?ctype=xml&id=684938)

Closed
[Bug 684938](/show_bug.cgi?id=684938)

Opened 13 years ago
Closed 13 years ago

# Proxy nsXPCWrappedJS::Release to the main thread

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Proxy nsXPCWrappedJS::Release to the main thread

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | wontfix |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | + | fixed |
| firefox11 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: peterv, Assigned: peterv)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=40)  [peterv](/user_profile?user_id=24295)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=40)  [peterv](/user_profile?user_id=24295)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[684711](/show_bug.cgi?id=684711 "RESOLVED WORKSFORME - Don't add objects that are used off of the main thread to the cycle collector")

Dependency [tree](/showdependencytree.cgi?id=684938&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=684938)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical?][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [v1](/attachment.cgi?id=561860)  [13 years ago](#c1)  [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)   7.06 KB, patch | mrbkap : [review+](#c8 "13 years ago")  jst : [approval-mozilla-beta-](#c15 "13 years ago") | [Details](/attachment.cgi?id=561860&action=edit) | [Diff](/attachment.cgi?id=561860&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=684938#c0)• 13 years ago |
|  | |

Running the release on a thread other than the main thread can crash because we add nsXPCWrappedJS objects to the cycle collector, which assumes objects can't be refcounted while it runs. Both AddRef and Release are problematic, but Release will lead to crashes for sure whereas AddRef can lead to premature unlinking which shouldn't cause crashes, but might. I'll add a patch here to fix the crashes due to Release, [bug 684711](/show_bug.cgi?id=684711 "RESOLVED WORKSFORME - Don't add objects that are used off of the main thread to the cycle collector") will deal with the whole issue.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a109408_1689)• 13 years ago |

Whiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a179071_1689)• 13 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a1388762_12352)• 13 years ago |

[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=684938#c1)• 13 years ago |
|  | |

Attached patch

[v1](attachment.cgi?id=561860&action=diff)
— [Details](attachment.cgi?id=561860&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=684938#c2)• 13 years ago |
|  | |

Peter, is this patch ready to be reviewed? If so, please request review asap. Thanks!

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=684938#c3)• 13 years ago |
|  | |

Not going to take this fix this late for 8. And I don't know if we can write a testcase for this, but if we can that would be awesome.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=684938#c4)• 13 years ago |
|  | |

This doesn't really count, but I'd wager that some of the intermittent oranges I linked to in [Bug 684711](/show_bug.cgi?id=684711 "RESOLVED WORKSFORME - Don't add objects that are used off of the main thread to the cycle collector") will go away when this lands, so presumably if they come back that is kind of like a test...

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=684938#c5)• 13 years ago |
|  | |

Comment on [attachment 561860](/attachment.cgi?id=561860 "v1") [[details]](/attachment.cgi?id=561860&action=edit "v1") [[diff]](/attachment.cgi?id=561860&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860)
v1
This seems to pass on try.
[Attachment #561860](/attachment.cgi?id=561860&action=edit "v1") -
Flags: review?(mrbkap)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=684938#c6)• 13 years ago |
|  | |

Comment on [attachment 561860](/attachment.cgi?id=561860 "v1") [[details]](/attachment.cgi?id=561860&action=edit "v1") [[diff]](/attachment.cgi?id=561860&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860)
v1
Review of [attachment 561860](/attachment.cgi?id=561860 "v1") [[details]](/attachment.cgi?id=561860&action=edit "v1") [[diff]](/attachment.cgi?id=561860&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860):
-----------------------------------------------------------------
::: js/src/xpconnect/src/xpcwrappedjs.cpp
@@ +206,5 @@
> + {
> + // We'd like to abort here, but this can happen if someone uses a proxy
> + // for the nsXPCWrappedJS.
> + nsCOMPtr<nsIThread> mainThread = do\_GetMainThread();
> + NS\_ProxyRelease(mainThread, static\_cast<nsIXPConnectWrappedJS\*>(this));
Hm, I'm not 100% sure that this is safe... I guess we should never be able to get here after the thread manager is shutdown, so do\_GetMainThread should always succeed, but you should probably assert mainThread here. NS\_ProxyReleae will just go ahead and release the object it if you pass null for target (which seems pretty dumb to me).

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=684938#c7)• 13 years ago |
|  | |

I guess we can also just return early if the mainThread has been shut down. Leaking isn't the end of the world in that case.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=684938#c8)• 13 years ago |
|  | |

Comment on [attachment 561860](/attachment.cgi?id=561860 "v1") [[details]](/attachment.cgi?id=561860&action=edit "v1") [[diff]](/attachment.cgi?id=561860&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860)
v1
r=me with bent's observation fixed.
[Attachment #561860](/attachment.cgi?id=561860&action=edit "v1") -
Flags: review?(mrbkap) → review+

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=684938#c9)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/e8e8396802f2>Target Milestone: --- → mozilla10

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=684938#c10)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e8e8396802f2>Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a6230644_12352)• 13 years ago |

[Attachment #561860](/attachment.cgi?id=561860&action=edit "v1") -
Flags: approval-mozilla-beta?
[Attachment #561860](/attachment.cgi?id=561860&action=edit "v1") -
Flags: approval-mozilla-aurora?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=684938#c11)• 13 years ago |
|  | |

This landed the day before the switchover, so it should already be on Aurora.
I looked over the blocked bugs in [bug 684711](/show_bug.cgi?id=684711 "RESOLVED WORKSFORME - Don't add objects that are used off of the main thread to the cycle collector"), which is a list of bugs with stacks involving the cycle collector calling into nonsense stacks. All but 2 haven't been seen recently. I looked more closely at the remaining two, which have been seen in the last few months with fairly high frequency.
[Bug 675605](/show_bug.cgi?id=675605 "RESOLVED WORKSFORME - intermittent crash in /tests/security/ssl/bugs/test_bug480509.html | Exited with code 1 (or -10) during test run [@nsXPCWrappedJS::cycleCollection::Traverse]"): This involves nsXPCWrappedJS::cycleCollection::Traverse, which is something this patch should fix. It looks like [bug 675605](/show_bug.cgi?id=675605 "RESOLVED WORKSFORME - intermittent crash in /tests/security/ssl/bugs/test_bug480509.html | Exited with code 1 (or -10) during test run [@nsXPCWrappedJS::cycleCollection::Traverse]") went away on trunk on 10/07. On Aurora, it went away on 11/07, which is the day before the crossover. Since then it has only shown up once, on beta.
[Bug 635480](/show_bug.cgi?id=635480 "RESOLVED WORKSFORME - intermittent crash in toolkit/mozapps/extensions/test/browser/browser_installssl.js or browser_updatessl.js [@nsSVGMarkerElement::SetOrientToAngle][@nsXPCOMCycleCollectionParticipant::CheckForRightISupports][@nsXPCWrappedJS::cycleCollection::Traverse]"): This involve nsXPCWrappedJS::cycleCollection::Traverse calling into CheckForRightISupports calling into a random SVG code, which sounds like an instance of something this bug would fix. The last instance of this on m-c is 9/29, which is vaguely around the date the previous one went away on trunk. Like the previous bug, the last instance of this on Aurora was on 11/07, right before the branch.
Both of these went away too early on trunk to have been fixed by this particular patch. Perhaps some of the ongoing work on removing XPCOM proxies ([bug 675221](/show_bug.cgi?id=675221 "RESOLVED FIXED - Remove XPCOM proxies")) removed the particular off-thread activity that was causing these crashes. Looking at that bug, the patch "Implement Runnable that can be waited on synchronously, for removing XPCOM proxies" landed on 10/07, so maybe that fixed 675605? It doesn't really sound like it, but who knows.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=684938#c12)• 13 years ago |
|  | |

Comment on [attachment 561860](/attachment.cgi?id=561860 "v1") [[details]](/attachment.cgi?id=561860&action=edit "v1") [[diff]](/attachment.cgi?id=561860&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860)
v1
Thanks Andrew!
[Attachment #561860](/attachment.cgi?id=561860&action=edit "v1") -
Flags: approval-mozilla-aurora?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=684938#c13)• 13 years ago |
|  | |

And also, given the fact that this is a race condition that's likely very hard to reliably trigger from a webpage I don't think we need to push to get this in on beta from a security point of view, but I would like to know if the collective number of cycle collector crashes that are likely fixed by this is large enough to warrant the risk of taking this for beta.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=684938#c14)• 13 years ago |
|  | |

It isn't clear to me. The crashes in those bugs I linked were fairly common, but I can't see anything on crash-stats that looks like it. But as 635480 shows, the top frame could be anything. I think the most noticeable thing to find would be a crash with nsXPCWrappedJS::cycleCollection::Traverse anywhere on the stack, or probably even just in the second frame. I'm not sure how one would go about doing that.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=684938#c15)• 13 years ago |
|  | |

Comment on [attachment 561860](/attachment.cgi?id=561860 "v1") [[details]](/attachment.cgi?id=561860&action=edit "v1") [[diff]](/attachment.cgi?id=561860&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=684938&attachment=561860)
v1
I looked into the volume of the relevant crashes and they're fairly low volume, so we won't be pushing for this in beta.
[Attachment #561860](/attachment.cgi?id=561860&action=edit "v1") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=684938#c16)• 13 years ago |
|  | |

Marking fixed for 10 and 11, and wontfix for 9.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=684938#c17)• 13 years ago |
|  | |

Is there something QA can do to verify this fix?Whiteboard: [sg:critical?] → [sg:critical?][qa?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a11080301_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=684938#c18)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #17](/show_bug.cgi?id=684938#c17 "RESOLVED FIXED - Proxy nsXPCWrappedJS::Release to the main thread"))
> Is there something QA can do to verify this fix?
bump

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a17200209_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=684938#a129686555_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=684938&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Peter Van der Beken [:peterv]](/user_profile?user_id=24295)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_237b5676_20250125_103003.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/696748)
* [XML](/show_bug.cgi?ctype=xml&id=696748)

Closed
[Bug 696748](/show_bug.cgi?id=696748)

Opened 13 years ago
Closed 13 years ago

# [ARM] Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[ARM] Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

ARM

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | + | fixed |
| firefox11 | + | fixed |
| firefox12 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: mjrosenb)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/b00d3efc283ff1d77f56f01b78f60713?d=mm&size=40)  [mjrosenb](/user_profile?user_id=419881)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, crash, testcase, Whiteboard: [sg:critical] js-triage-needed)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical] js-triage-needed

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#a44317803_395101 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Don't place pools in the middle of a call](/attachment.cgi?id=575610)  [13 years ago](#c5)  [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)   2.05 KB, patch | dmandelin : [review+](#a2205497_294323 "13 years ago")  curtisk : [approval-mozilla-beta+](#a6341824_406847 "13 years ago") | [Details](/attachment.cgi?id=575610&action=edit) | [Diff](/attachment.cgi?id=575610&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696748&attachment=575610) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=696748#c0)• 13 years ago |
|  | |

The following test crashes on mozilla-central revision e79245e249c4 (options -m -n -a), armv7-a arch only:
try {
this.watch("b", "".substring);
} catch(exc1) {}
eval("\
var URI = '';\
test();\
function test() {\
URI += '<zcti application=\"xxxx\_demo\">';\
URI += '<pstn\_data>';\
URI += '<dnis>877-485-xxxx</dnis>';\
URI += '</pstn\_data>';\
URI >>= '<keyvalue key=\"name\" value=\"xxx\"/>';\
URI += '<keyvalue key=\"phone\" value=\"6509309000\"/>';\
}\
test();\
");
The optimized build does not crash, but stepping through the assertion causes a crash (but the assert also differs here). It might be that the testcase requires additional tweaking to reveal the issue on opt. Marking this as S-s due to the crash. If the crash is debug-only, feel free unhide.
Backtrace of crash:
Program received signal SIGABRT, Aborted.
Assertion failure: (\*insn & 0x012fff30) == 0x012fff30
(../assembler/assembler/ARMAssembler.h:994 static JSC::ARMWord\* JSC::ARMAssembler::getLdrImmAddress(JSC::ARMWord\*))
Program received signal SIGSEGV, Segmentation fault.
0x00282b98 in JSC::ARMAssembler::getLdrImmAddress (insn=0x4009a188) at ../assembler/assembler/ARMAssembler.h:994
994 ASSERT((\*insn & 0x012fff30) == 0x012fff30);
(gdb) bt
#0 0x00282b98 in JSC::ARMAssembler::getLdrImmAddress (insn=0x4009a188) at ../assembler/assembler/ARMAssembler.h:994
#1 0x00282c5c in JSC::ARMAssembler::patchPointerInternal (from=1074373000, to=0x2f6045) at ../assembler/assembler/ARMAssembler.h:1020
#2 0x002f6772 in JSC::ARMAssembler::relinkCall (from=0x4009a188, to=0x2f6045) at ../assembler/assembler/ARMAssembler.h:1139
#3 0x002f687c in JSC::MacroAssemblerARM::repatchCall (call=..., destination=...) at ../assembler/assembler/MacroAssemblerARM.h:1523
#4 0x002f6ec8 in JSC::RepatchBuffer::relink (this=0xbe8ad664, call=..., destination=...) at ../assembler/assembler/RepatchBuffer.h:95
#5 0x002f6f9e in js::mjit::ic::Repatcher::relink (this=0xbe8ad664, call=..., stub=...) at ../methodjit/ICRepatcher.h:90
#6 0x002f3c78 in PatchSetFallback (f=..., ic=0x456800) at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MonoIC.cpp:150
#7 0x002f46ce in UpdateSetGlobalName (f=..., ic=0x456800, obj=0x40b00040, shape=0x40b0efb0) at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MonoIC.cpp:280
#8 0x002f4886 in js::mjit::ic::SetGlobalName (f=..., ic=0x456800) at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MonoIC.cpp:329
#9 0x00281352 in JaegerStubVeneer () at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MethodJIT.cpp:164
#10 0x4009a194 in ?? ()
Cannot access memory at address 0x0
#11 0x4009a194 in ?? ()
Cannot access memory at address 0x0
Backtrace stopped: previous frame identical to this frame (corrupt stack?)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=696748#c1)• 13 years ago |
|  | |

Given that this is in the guts of the assembler I'm guessing at sg:critical here, but if that turns out to not be the case we can re-label this one.Whiteboard: js-triage-needed → [sg:critical] js-triage-needed

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a1498071_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=696748#c2)• 13 years ago |
|  | |

Marty, can you take a look at this--see if it is in fact exploitable? It looks to me like it may not be, but it seems like a codegen bug at least.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a2103232_1689)• 13 years ago |

Assignee: general → mrosenberg

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=696748#c3)• 13 years ago |
|  | |

oy.
Not horribly unexpected, the issue is with pools. More specifically, with pools and the repatcher.
For repatchable stub calls (well all calls, but specifically, repatchable calls) we generate the sequence
ldr r12, [pc, pool\_dest]
ldr r8, [pc, pool\_jaeger\_stub\_veneer]
blx r8
...
pool:
...
pool\_dest:
.word function\_to\_call
pool\_jaeger\_stub\_veneer
.word jaeger\_stub\_veneer
which will load the address of a function out of pool\_dest, into register 12, then load the address of the jaeger stub veneer into r8, and call the jaeger stub veneer. The repatcher gets the address of |ldr r8, ...|, then looks back at the previous instruction, decodes enough of the instruction to find the address of pool\_dest, and finally writes over the |.word function\_to\_call| with the new value.
In this case, however, immediately after emitting |ldr r12, [pc, pool\_dest]|, we determined the pool needed to be flushed, and flushed the pool, thus the sequence we actually got was:
ldr r12, [pc, pool\_dest]
b after\_pool
pool1:
...
pool\_dest:
.word function\_to\_call
after\_pool
ldr r8, [pc, pool\_jaeger\_stub\_veneer]
blx r8
...
pool2
pool\_jaeger\_stub\_veneer
.word jaeger\_stub\_veneer
so when the instruction that the re-patcher gets is still |ldr r8, [pc,pool\_jaeger\_stub\_veneer]|. However, the "instruction" before it is now .word function\_to\_call rather than |ldr r12, [pc, pool\_dest]|. This is why the assertion is thrown. The result of calling the patcher on this is: we read the bottom 12 bits of the function that we're attempting to patch from, add it to the address of the patch (two before the actuall call to jaeger\_stub\_veneer), get a memory location, and write over that memory location with a single word of data that any possible attackers most likely won't get to control (We are writing over the value with the address of a C function). More likely than not, the address that we write over will \*not\* be word aligned, whereas any instructions (or other data) that we generate will likely be word aligned, so it is likely going to write over parts of two different values. I would say that this is in fact exploitable, but would be hard pressed to generate a reasonable exploit.

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=696748#c4)• 13 years ago |
|  | |

I can think of two possible solutions:
1) rather than storing the address of the second instruction, store the address of the \*first\* instruction, so we'll be able to walk forwards and get to the other two, possibly following pool guards.
2) mark those three instructions as a no-pool zone. no-pool zones have always felt like a hack.
I'll need to find out why we carry the address of the second instruction to begin with.

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=696748#c5)• 13 years ago |
|  | |

Attached patch

[Don't place pools in the middle of a call](attachment.cgi?id=575610&action=diff)
— [Details](attachment.cgi?id=575610&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696748&attachment=575610)

Have not pushed to try, nor run jit-tests locally yet.
[Attachment #575610](/attachment.cgi?id=575610&action=edit "Don't place pools in the middle of a call") -
Flags: review?(dmandelin)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a2205497_294323)• 13 years ago |

[Attachment #575610](/attachment.cgi?id=575610&action=edit "Don't place pools in the middle of a call") -
Flags: review?(dmandelin) → review+

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=696748#c6)• 13 years ago |
|  | |

Sorry for the slow update, I thought the fix for this landed on m-i on monday, but evidently the push failed, and I didn't notice?
<http://hg.mozilla.org/integration/mozilla-inbound/rev/6dc5acdc2cbe>

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=696748#c7)• 13 years ago |
|  | |

(In reply to Marty Rosenberg [:Marty] from [comment #6](/show_bug.cgi?id=696748#c6 "VERIFIED FIXED - [ARM] Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56"))
> Sorry for the slow update, I thought the fix for this landed on m-i on
> monday, but evidently the push failed, and I didn't notice?
> <http://hg.mozilla.org/integration/mozilla-inbound/rev/6dc5acdc2cbe>
No problem, thanks for double-checking.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=696748#c8)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/6dc5acdc2cbe>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a3404111_425645)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=696748#c9)• 13 years ago |
|  | |

If this is a major security concern for FF9/10 and is considered low risk, please nominate for approval on beta/aurora.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=696748#c10)• 13 years ago |
|  | |

We should get this fix into Fx10, don't feel too strongly about rushing it into 9.
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)Summary: Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56 → [ARM] Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56Target Milestone: --- → mozilla11

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=696748#c11)• 13 years ago |
|  | |

Marty, is this patch appropriate for aurora? If so, please request aurora approval on the patch!

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=696748#c12)• 13 years ago |
|  | |

Marty, ping?

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=696748#c13)• 13 years ago |
|  | |

Comment on [attachment 575610](/attachment.cgi?id=575610 "Don't place pools in the middle of a call") [[details]](/attachment.cgi?id=575610&action=edit "Don't place pools in the middle of a call") [[diff]](/attachment.cgi?id=575610&action=diff "Don't place pools in the middle of a call") [[review]](/page.cgi?id=splinter.html&ignore=&bug=696748&attachment=575610)
Don't place pools in the middle of a call
[Approval Request Comment]
Regression caused by (bug #):
User impact if declined:
This bug has been in the assembler since arm support for JM landed
Testing completed (on m-c, etc.):
Risk to taking this patch (and alternatives if risky):
It has been pretty thoroughly tested on aurora, and the fix is pretty foolproof
[Attachment #575610](/attachment.cgi?id=575610&action=edit "Don't place pools in the middle of a call") -
Flags: approval-mozilla-beta?

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a6341824_406847)• 13 years ago |

[Attachment #575610](/attachment.cgi?id=575610&action=edit "Don't place pools in the middle of a call") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a6942149_1689)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=696748#c14)• 13 years ago |
|  | |

Pushed to beta with: <https://hg.mozilla.org/releases/mozilla-beta/rev/2f0d90c7f5c7>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a13072141_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a13082183_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=696748#c15)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/053bb31882c4>

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696748#a44317803_395101)• 12 years ago |

Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=696748&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_15af6469_20250125_103005.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/707051)
* [XML](/show_bug.cgi?ctype=xml&id=707051)

Closed
[Bug 707051](/show_bug.cgi?id=707051)

Opened 13 years ago
Closed 13 years ago

# Failure to mark some shapes during delayed marking

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Failure to mark some shapes during delayed marking

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 |  | fixed |
| firefox11 |  | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: billm, Assigned: billm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [fix](/attachment.cgi?id=578462)  [13 years ago](#c0)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   2.73 KB, patch | igor : [review+](#c1 "13 years ago")  akeybl : [approval-mozilla-aurora-](#c11 "13 years ago")  akeybl : [approval-mozilla-beta-](#c11 "13 years ago") | [Details](/attachment.cgi?id=578462&action=edit) | [Diff](/attachment.cgi?id=578462&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=578462) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=579485)  [13 years ago](#c15)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   6.74 KB, patch | igor : [review+](#c16 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c23 "13 years ago")  akeybl : [approval-mozilla-beta-](#c23 "13 years ago") | [Details](/attachment.cgi?id=579485&action=edit) | [Diff](/attachment.cgi?id=579485&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=579485) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=707051#c0)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=578462&action=diff) (obsolete)
— [Details](attachment.cgi?id=578462&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=578462)

When we do delayed marking, we call JS\_TraceChildren on each marked object in the arena. It calls MarkChildren. When given a shape, MarkChildren fails to set the marked bit for its parent shape--it just walks up the shape tree. I stumbled upon this while doing incremental GC, but it suggests that we need to do better testing of delayed marking--probably via [bug 673551](/show_bug.cgi?id=673551 "RESOLVED FIXED - GC: Add environment variable for mark stack size").
In the patch, I had to change the return type of previous() so that the write barrier checks don't complain.
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: review?(igor)

|  | [Igor Bukanov](/user_profile?user_id=50763) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=707051#c1)• 13 years ago |
|  | |

Comment on [attachment 578462](/attachment.cgi?id=578462 "fix") [[details]](/attachment.cgi?id=578462&action=edit "fix") [[diff]](/attachment.cgi?id=578462&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=578462)
fix
Review of [attachment 578462](/attachment.cgi?id=578462 "fix") [[details]](/attachment.cgi?id=578462&action=edit "fix") [[diff]](/attachment.cgi?id=578462&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=578462):
-----------------------------------------------------------------
Comment in ScanShape before shape = shape->previous(); why the loop in that function is essential to stop unbounded recursion.
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: review?(igor) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=707051#c2)• 13 years ago |
|  | |

Could this have been the cause of some of our GC topcrashes?

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=707051#c3)• 13 years ago |
|  | |

Comment on [attachment 578462](/attachment.cgi?id=578462 "fix") [[details]](/attachment.cgi?id=578462&action=edit "fix") [[diff]](/attachment.cgi?id=578462&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=578462)
fix
I think I broke this in Firefox 5. So I don't think it's causing the topcrashes that we examined a long time ago, but it may be causing some current topcrashes.
It would be nice to take this patch, since it seems pretty exploitable. I'm a bit worried about regression risks, though. This is the same path that the cycle collector takes. So we were probably missing a bunch of shapes from the CC graph, and now we won't be. Andrew, do you know if that's likely to be a performance problem? We often have a lot of shapes.
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=707051#a78964_294323)• 13 years ago |

Assignee: general → wmccloskey

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=707051#c4)• 13 years ago |
|  | |

Shapes are not added to the CC graph. See AddToCCKind. Instead of adding the graph, the CC traces through the children to find non-shape nodes. Potentially this could cause the CC to blow the stack, but if this only came into play in 5 maybe it is okay. It could also cause slowdown.
I don't know much about shapes. Do they point from parent to child as well as from child to parent? Are there likely to be a lot of shapes that are reachable from gray nodes but not black ones?

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=707051#c5)• 13 years ago |
|  | |

Shapes point to parent (previous) and child or children, but the latter linkage should not matter here.
/be

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=707051#c6)• 13 years ago |
|  | |

Well, my main worry is that the combination of two creates doubly-linked trees, which tend to embiggen the CC graph, in cases like the DOM (with the addition of strong parent pointer) and the JS global.
If you want to measure the effect on the graph, bill, you can either count how many shapes are being marked gray, or, more directly, go into NoteJSRoot in nsXPConnect.cpp and add something like
if (kind == JSTRACE\_SHAPE)
myNewGlobalCounter++;
in the else if (kind != JSTRACE\_STRING) case. Initialize myNewGlobalCounter in BeginCycleCollection and print it out in EndCycleCollection in that file.

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=707051#c7)• 13 years ago |
|  | |

Shapes can participate in cycles only if they are for accessor (getter/setter) properties or methods (function-valued properties memoized/shared via shapes). These are relatively uncommon across all object populations, more common among prototype objects. Can you take advantage of this sparseness? You shouldn't have to reify peer CC data structures for all shapes, just the ones that might be suspects.
/be

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=707051#c8)• 13 years ago |
|  | |

No shapes are reified, they are just recursively scanned for non-shapes. Only non-shapes are added to the graph. But yes, it sounds like we could avoid even doing that a lot of the time. The cycle collector does not take advantage of any preknowledge about the shape of the JS heap, except that strings (even compound ones) are never cyclic.
Ultimately, I'd like to push the CC's traversal of the GC heap inside the GC heap, if only to avoid the virtual call in XPCOM->XPConnect->JS->XPConnect->XPCOM dance we currently have to do to take single step in the CC ([bug 653013](/show_bug.cgi?id=653013 "RESOLVED INCOMPLETE - GC: Invent a better traversal API for the cycle collector and JS_DumpHeap")). Once that is done we could be smarter about stuff.
Peterv has some thoughts on shapes in the CC graph in [bug 651445](/show_bug.cgi?id=651445 "RESOLVED WONTFIX - Should shapes be added to the CC graph?"), mainly concerns about not adding them.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=707051#c9)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/e0cb9fb30750>
It doesn't sound like this will screw anything up. As Brendan said, we don't trace the children of a shape. And since shapes aren't actually put in the CC graph, we only have to worry about shapes further up the parent chain that point to objects via accessors. It seems pretty unlikely that this would have a noticeable performance impact. So I think the regression risk is low. And, as I said, the bug is pretty serious.Target Milestone: --- → mozilla11

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=707051#c10)• 13 years ago |
|  | |

Backed out in <https://hg.mozilla.org/integration/mozilla-inbound/rev/527a79f535d8> - I haven't seen a single useful stack yet, but Mac and Windows, reftests, jsreftests, and mochitest-2 were crashing. Random selection of logs:
<https://tbpl.mozilla.org/php/getParsedLog.php?id=7744624&tree=Mozilla-Inbound>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=7744595&tree=Mozilla-Inbound>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=7744600&tree=Mozilla-Inbound>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=7744444&tree=Mozilla-Inbound>

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=707051#c11)• 13 years ago |
|  | |

Comment on [attachment 578462](/attachment.cgi?id=578462 "fix") [[details]](/attachment.cgi?id=578462&action=edit "fix") [[diff]](/attachment.cgi?id=578462&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=578462)
fix
[Triage Comment]
Please re-nominate once this has landed on m-c.
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: approval-mozilla-beta-
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Flags: approval-mozilla-aurora-

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=707051#c12)• 13 years ago |
|  | |

This causes a stack overflow in the cycle collector. Here is what NoteJSChild in nsXPConnect.cpp looks like:
static void
NoteJSChild(JSTracer \*trc, void \*thing, JSGCTraceKind kind)
{
if (AddToCCKind(kind)) {
...
} else if (kind != JSTRACE\_STRING) {
JS\_TraceChildren(trc, thing, kind);
}
}
Since AddToCCKind(JSTRACE\_SHAPE) is false, we call JS\_TraceChildren. This can blow up the stack when traversing long parent chains.
It looks like the previous version of the code was doing exactly what the cycle collector needed: it was skipping over the parent shape itself, and just tracing through the shape's children. However, this is not what we need for delayed marking (this is the aspect I forgot in our conversation today, Andrew; it's still a serious bug).
I'm thinking of adding a flag to JSTracer to say which behavior is desired. This is pretty ugly, but there aren't a lot of good alternatives. We can detect a stack overflow in NoteJSChild, but what do we do then? Aborting the CC seems like a bad idea, since it would cause us to leak. Andrew and I talked about adding shapes to the CC graph selectively, when we run out of stack space for them. This seems really dangerous, though. There may be other parts of the CC that break if some shapes are in the graph and not others.
Peterv, Igor, Andreas, do you guys have any good ideas? It would be nice if whatever we come up with is safe enough to land in aurora and beta. That's why I like the flag idea.Target Milestone: mozilla11 → ---

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=707051#c13)• 13 years ago |
|  | |

I think the safest thing to do in the short term is to add a flag (or repurpose the one I already added with some kind of enum) that leaves the behavior alone except for the delayed marker. There's a delicate symbiosis between the current behavior of JS\_TraceChildren and the CC that seems to work. In the long term, of course, having even more ways to trace through JS seems very future-unproof.

|  | [Igor Bukanov](/user_profile?user_id=50763) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=707051#c14)• 13 years ago |
|  | |

We need to eliminate the tail recursion over the shape.parent. A simplest solution for that would be to provide a function like
Shape \*TraceShapeChildren(JSTracer \*trc, Shape \*shape)
that would not call the tracer on the shape but rather return it so NoteJSChild can have:
} else if (kind == JSTRACE\_SHAPE) {
while (!!(thing = JS\_TraceChildren(trc, (Shape \*) thing));
}

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=707051#c15)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=579485&action=diff)
— [Details](attachment.cgi?id=579485&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=579485)

I like Igor's idea. This patch doesn't die on tinderbox the way the previous one did.
[Attachment #578462](/attachment.cgi?id=578462&action=edit "fix") -
Attachment is obsolete: true
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: review?(igor)

|  | [Igor Bukanov](/user_profile?user_id=50763) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=707051#c16)• 13 years ago |
|  | |

Comment on [attachment 579485](/attachment.cgi?id=579485 "fix") [[details]](/attachment.cgi?id=579485&action=edit "fix") [[diff]](/attachment.cgi?id=579485&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=579485)
fix
Review of [attachment 579485](/attachment.cgi?id=579485 "fix") [[details]](/attachment.cgi?id=579485&action=edit "fix") [[diff]](/attachment.cgi?id=579485&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=579485):
-----------------------------------------------------------------
::: js/src/jsgcmark.cpp
@@ +983,5 @@
> MarkChildren(JSTracer \*trc, const Shape \*shape)
> {
> + MarkShapeChildrenAcyclic(trc, shape);
> + if (shape->previous())
> + MarkShape(trc, shape->previous(), "parent");
This should use MarkShapeChildrenAcyclic result instead of accessing shape->previous() one more time.
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: review?(igor) → review+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=707051#c17)• 13 years ago |
|  | |

(In reply to Igor Bukanov from [comment #16](/show_bug.cgi?id=707051#c16 "RESOLVED FIXED - Failure to mark some shapes during delayed marking"))
> This should use MarkShapeChildrenAcyclic result instead of accessing
> shape->previous() one more time.
The problem is that MarkShape wants a MarkablePointer and MarkShapeChildrenAcyclic just returns a Shape. I could use MarkShapeUnbarriered, but I'm trying to limit the number of those.

|  | [Igor Bukanov](/user_profile?user_id=50763) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=707051#c18)• 13 years ago |
|  | |

(In reply to Bill McCloskey (:billm) from [comment #17](/show_bug.cgi?id=707051#c17 "RESOLVED FIXED - Failure to mark some shapes during delayed marking"))
> The problem is that MarkShape wants a MarkablePointer and
> MarkShapeChildrenAcyclic just returns a Shape. I could use
> MarkShapeUnbarriered, but I'm trying to limit the number of those.
Then comment why the result of MarkShapeChildrenAcyclic is ignored.
Also, we need comments in MarkShapeChildrenAcyclic that tracing via BaseShape link shape->base()->baseUnowned() stops right at that point so MarkShapeChildrenAcyclic is truly O(1) in space.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=707051#c19)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/d91ce1c668e7>
I did my best to write a good comment.Target Milestone: --- → mozilla11

|  | [Igor Bukanov](/user_profile?user_id=50763) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=707051#c20)• 13 years ago |
|  | |

(In reply to Bill McCloskey (:billm) from [comment #19](/show_bug.cgi?id=707051#c19 "RESOLVED FIXED - Failure to mark some shapes during delayed marking"))
> I did my best to write a good comment.
The comment is very clear, thanks!

|  | [Ian Melven :imelven](/user_profile?user_id=416294) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=707051#c21)• 13 years ago |
|  | |

Via ed morley:
<https://hg.mozilla.org/mozilla-central/rev/d91ce1c668e7>
marking fixed with target milestone of mozilla11Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Ian Melven :imelven](/user_profile?user_id=416294) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=707051#a583508_416294)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=707051#c22)• 13 years ago |
|  | |

Comment on [attachment 579485](/attachment.cgi?id=579485 "fix") [[details]](/attachment.cgi?id=579485&action=edit "fix") [[diff]](/attachment.cgi?id=579485&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=579485)
fix
This seems to have stuck. This patch is more conservative than the last one in that it shouldn't alter the cycle collector behavior at all. I think the regression risk should be low.
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=707051#c23)• 13 years ago |
|  | |

Comment on [attachment 579485](/attachment.cgi?id=579485 "fix") [[details]](/attachment.cgi?id=579485&action=edit "fix") [[diff]](/attachment.cgi?id=579485&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=707051&attachment=579485)
fix
[Triage Comment]
Having discussed with curtisk and dveditz, it sounds like this issue would not cause us to chemspill FF9 or otherwise mitigate (the bar we're setting for beta at this point), and the code that's already landed on m-c does not point directly at an exploit.
Let's take this on aurora only.
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: approval-mozilla-beta-
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #579485](/attachment.cgi?id=579485&action=edit "fix") -
Flags: approval-mozilla-aurora+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=707051#c24)• 13 years ago |
|  | |

Seems reasonable.
<https://hg.mozilla.org/releases/mozilla-aurora/rev/c99bfdb03cfd>

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=707051#a1105804_389993)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=707051#c25)• 13 years ago |
|  | |

Is this something QA can verify?Whiteboard: [sg:critical] → [sg:critical][qa?]

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=707051#c26)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #25](/show_bug.cgi?id=707051#c25 "RESOLVED FIXED - Failure to mark some shapes during delayed marking"))
> Is this something QA can verify?
No. We might be able to write a test if we could artificially induce delayed marking. That work in going on in [bug 673551](/show_bug.cgi?id=673551 "RESOLVED FIXED - GC: Add environment variable for mark stack size").

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=707051#a2316158_279076)• 13 years ago |

Whiteboard: [sg:critical][qa?] → [sg:critical][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=707051#a3689605_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=707051#a9742604_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=707051&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_1c8226f8_20250125_103015.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/715662)
* [XML](/show_bug.cgi?ctype=xml&id=715662)

Closed
[Bug 715662](/show_bug.cgi?id=715662)

Opened 13 years ago
Closed 13 years ago

# browser-only methodjit crash (triggered by CSS transform tests)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

browser-only methodjit crash (triggered by CSS transform tests)

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Other Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | + | verified |
| firefox11 | + | verified |
| firefox12 | + | verified |
| firefox-esr10 |  | unaffected |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jorendorff, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### ( [URL](http://aryeh.name/tmp/gecko-crash.html "http://aryeh.name/tmp/gecko-crash.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[716900](/show_bug.cgi?id=716900 "RESOLVED FIXED - Crash on Javascript heavy site")

Dependency [tree](/showdependencytree.cgi?id=715662&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=715662)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[aryeh.name/tmp/gecko-crash.html](http://aryeh.name/tmp/gecko-crash.html "http://aryeh.name/tmp/gecko-crash.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=586296)  [13 years ago](#c2)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   822 bytes, patch | dvander : [review+](#a18707_309316 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c10 "13 years ago")  akeybl : [approval-mozilla-beta+](#c10 "13 years ago") | [Details](/attachment.cgi?id=586296&action=edit) | [Diff](/attachment.cgi?id=586296&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=715662&attachment=586296) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=715662#c0)• 13 years ago |
|  | |

Found by Aryeh Gregor, see URL. I can't get it to happen in the shell.
<!doctype html>
<script>
var p = [[0]];
function f(y) {
var a, b, c, d;
for (var k = 0; k < 2; k++) {
var z = 0 + p[0][0] - y;
if (a === undefined || z < a)
a = z;
if (c === undefined || z > c)
c = z;
}
throw 0;
}
var arr = [1, 1, 1, 1, 1, 1, 1, 0.5];
for (var i = 0; i < 5; i++) {
for (var j = 0; j < 8; j++) {
try {
f(arr[j]);
} catch (exc) {
console.log("fail");
}
}
}
</script>

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=715662#c1)• 13 years ago |
|  | |

It crashes computing `z > c`.
c should be undefined, but the value on the stack is
ObjectValue(\*(JSObject \*) NULL).
#0 0x0000000103f3701c in js::HeapPtr<js::Shape, unsigned long>::operator js::Shape\* (this=0x0) at Barrier.h:231
#1 0x0000000103fa5d48 in JSObject::lastProperty (this=0x0) at jsobj.h:515
#2 0x0000000104005378 in JSObject::getClass (this=0x0) at jsscope.h:1116
#3 0x0000000103de984b in JSObject::defaultValue (this=0x0, cx=0x113faaf10, hint=JSTYPE\_NUMBER, vp=0x10ae2e150) at jsobjinlines.h:125
#4 0x00000001040d507d in ToPrimitive (cx=0x113faaf10, preferredType=JSTYPE\_NUMBER, vp=0x10ae2e150) at jsobjinlines.h:1443
#5 0x00000001040e10e5 in js::mjit::stubs::GreaterThan (f=@0x7fff5fbf6fc0) at StubCalls.cpp:808
#6 0x0000000117c93a53 in ?? ()
#7 0x00000001040d0f6f in js::mjit::EnterMethodJIT (cx=0x113faaf10, fp=0x10ae2e030, code=0x117c94c17, stackLimit=0x10b20e000, partial=true) at MethodJIT.cpp:1051
#8 0x00000001040d13b5 in CheckStackAndEnterMethodJIT (cx=0x113faaf10, fp=0x10ae2e030, code=0x117c94c17, partial=true) at MethodJIT.cpp:1109
#9 0x00000001040d1424 in js::mjit::JaegerShotAtSafePoint (cx=0x113faaf10, safePoint=0x117c94c17, partial=true) at MethodJIT.cpp:1127
#10 0x0000000103e841f4 in js::Interpret (cx=0x113faaf10, entryFrame=0x10ae2e030, interpMode=js::JSINTERP\_NORMAL) at jsinterp.cpp:1847
#11 0x0000000103ea5811 in js::RunScript (cx=0x113faaf10, script=0x10b40f350, fp=0x10ae2e030) at jsinterp.cpp:478
#12 0x0000000103ea5c1d in js::ExecuteKernel (cx=0x113faaf10, script=0x10b40f350, scopeChain=@0x10b411060, thisv=@0x7fff5fbfae30, type=js::EXECUTE\_GLOBAL, evalInFrame=0x0, result=0x0) at jsinterp.cpp:714
#13 0x0000000103ea6075 in js::Execute (cx=0x113faaf10, script=0x10b40f350, scopeChainArg=@0x10b411060, rval=0x0) at jsinterp.cpp:755
#14 0x0000000103d5f078 in EvaluateUCScriptForPrincipalsCommon (cx=0x113faaf10, obj=0x10b411060, principals=0x10d707118, originPrincipals=0x0, chars=0x114324408, length=434, filename=0x11427b158 "file:///Users/jorendorff/dev/gecko-crash/gecko-crash.html", lineno=2, rval=0x0, compileVersion=JSVERSION\_DEFAULT) at jsapi.cpp:5321
(gdb) p rval.data.debugView
$1 = {
payload47 = 0,
tag = JSVAL\_TAG\_OBJECT
}

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a990_346231)• 13 years ago |

Assignee: general → bhackett1024

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a1074_346231)• 13 years ago |

Group: core-security

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a14013_294323)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=715662#c2)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=586296&action=diff)
— [Details](attachment.cgi?id=586296&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=715662&attachment=586296)

At control flow join points, if a variable is known to be a double and is being held in a FP register then it isn't required to be synced to memory at the join. Its type tag, however, was being marked as synced, and in the example after some later copies between the variable z and a (whose type is unknown) we forgot that z was a double but still treated its type as synced, causing later codegen to be incorrect. The fix marks both the type and payload as unsynced.
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a18707_309316)• 13 years ago |

[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=715662#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/6c3cea75e5ba>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a19469_346231)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=715662#c4)• 13 years ago |
|  | |

Comment on [attachment 586296](/attachment.cgi?id=586296 "patch") [[details]](/attachment.cgi?id=586296&action=edit "patch") [[diff]](/attachment.cgi?id=586296&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=715662&attachment=586296)
patch
[Approval Request Comment]
User impact if declined: Potential crash in jitcode on a torn value (security risk).
Risk to taking this patch (and alternatives if risky): Should be low risk, affects code generation in a corner case, but should bake in nightlies for a few days at least.
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=715662#c5)• 13 years ago |
|  | |

This needs a test.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=715662#c6)• 13 years ago |
|  | |

OK, here's the first half of a shell test. If you run this with -m -n -a, it triggers the exact situation being patched here: fe->data.unsync() executes, and reg.isReg() is false.
However that is not enough, because the test case then passes. Is there an assertion we could add to a later stage of the JIT that would detect this class of bug? If not, how can I make it cause some observable runtime effect?
function f() {
var a = [1, 0.5, 1];
var b;
for (var i = 0; i < a.length; i++) {
var z = -a[i];
if (b === undefined || z < b)
b = z;
}
}
f();

|  | [Ian Melven :imelven](/user_profile?user_id=416294) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=715662#c7)• 13 years ago |
|  | |

Marking fixed for edmorley.
<https://hg.mozilla.org/mozilla-central/rev/6c3cea75e5ba>Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=715662#c8)• 13 years ago |
|  | |

Looking for a security rating prior to deciding on whether or not to take based upon that analysis. If not, there's no need to track until it's verified that this is a significant crasher or recent regression.Whiteboard: [sg:]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a341667_346231)• 13 years ago |

Whiteboard: [sg:] → [sg:critical]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=715662#c9)• 13 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #6](/show_bug.cgi?id=715662#c6 "VERIFIED FIXED - browser-only methodjit crash (triggered by CSS transform tests)"))
> However that is not enough, because the test case then passes. Is there an
> assertion we could add to a later stage of the JIT that would detect this
> class of bug? If not, how can I make it cause some observable runtime effect?
There really isn't a way for the JIT to assert the correctness of its information here, as the basic problem is that the JIT has incorrect information about which parts of the frame are coherent in the generated machine code, and that correctness is not a property that can be asserted.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=715662#c10)• 13 years ago |
|  | |

Comment on [attachment 586296](/attachment.cgi?id=586296 "patch") [[details]](/attachment.cgi?id=586296&action=edit "patch") [[diff]](/attachment.cgi?id=586296&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=715662&attachment=586296)
patch
[Triage Comment]
Approving for aurora and beta since this is externally found, sg-crit and deemed low-risk.
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #586296](/attachment.cgi?id=586296&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a441898_425645)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=715662#c11)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/c6ef2c476d17>
<https://hg.mozilla.org/releases/mozilla-beta/rev/a1a53d18a8bd>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)Target Milestone: --- → mozilla10

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a682541_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a2329340_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a5282414_432443)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a5282626_432443)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a5282838_432443)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a5282945_432443)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a5282953_432443)• 13 years ago |

Whiteboard: [sg:critical][qa+] → [sg:critical]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a7264673_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a7345783_1689)• 13 years ago |

Group: core-securityKeywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Scoobidiver (away)](/user_profile?user_id=386758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=715662#a29352752_386758)• 12 years ago |

Blocks: [716900](/show_bug.cgi?id=716900 "RESOLVED FIXED - Crash on Javascript heavy site")
You need to [log in](/show_bug.cgi?id=715662&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_df134be1_20250125_103011.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/713209)
* [XML](/show_bug.cgi?ctype=xml&id=713209)

Closed
[Bug 713209](/show_bug.cgi?id=713209)

Opened 13 years ago
Closed 13 years ago

# Crash [@ \_\_memcpy\_ssse3\_rep] through JSRope::flatten

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ \_\_memcpy\_ssse3\_rep] through JSRope::flatten

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox-esr10 | [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | + | affected |
| firefox10 | + | verified |
| firefox11 | + | verified |
| firefox12 | + | verified |
| firefox-esr10 | 10+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical][qa+:ashughes] js-triage-needed)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa+:ashughes] js-triage-needed

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c18 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ \_\_memcpy\_ssse3\_rep ]](https://crash-stats.mozilla.org/signature/?signature=__memcpy_ssse3_rep)

[[@ JSRope::flatten ]](https://crash-stats.mozilla.org/signature/?signature=JSRope%3A%3Aflatten)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=584129)  [13 years ago](#c3)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1.83 KB, patch | dvander : [review+](#a377762_309316 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c12 "13 years ago")  akeybl : [approval-mozilla-beta+](#c12 "13 years ago") | [Details](/attachment.cgi?id=584129&action=edit) | [Diff](/attachment.cgi?id=584129&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=713209#c0)• 13 years ago |
|  | |

The following test crashes on mozilla-central revision c5b90ea7e475 (options -m -n -a, 32 bit only):
var save\_\_proto\_\_ = \_\_proto\_\_;
\_\_proto\_\_ = save\_\_proto\_\_;
function bar(x, y) {
return x + y;
}
function foo(x, y) {
var a = 0;
for (var i = 0; i < 1000; i++) {
a += (this.toString);
a += bar(x, y);
a = bar(x, (a));
a += bar(x, y);
}
return a;
}
var q = foo(0, 1);
print(q.toSource());
Backtrace:
#0 \_\_memcpy\_ssse3\_rep () at ../sysdeps/i386/i686/multiarch/memcpy-ssse3-rep.S:1293
#1 0x08243150 in js::PodCopy<unsigned short> (dst=0xd477d008, src=0xf7400160, nelem=259260942) at ../jsutil.h:322
#2 0x08243dd6 in JSRope::flattenInternal<(JSRope::UsingBarrier)1> (this=0xf741db00, maybecx=0x8545568) at /srv/repos/mozilla-central/js/src/vm/String.cpp:225
#3 0x08242431 in JSRope::flatten (this=0xf741db00, maybecx=0x8545568) at /srv/repos/mozilla-central/js/src/vm/String.cpp:268
#4 0x08086f4c in JSString::ensureLinear (this=0xf741db00, cx=0x8545568) at /srv/repos/mozilla-central/js/src/vm/String.h:822
#5 0x08086ebc in JSString::getChars (this=0xf741db00, cx=0x8545568) at /srv/repos/mozilla-central/js/src/vm/String.h:804
#6 0x0817ef10 in QuoteString (sp=0xffffc804, str=0xf741db00, quote=34) at /srv/repos/mozilla-central/js/src/jsopcode.cpp:872
#7 0x0817f269 in js\_QuoteString (cx=0x8545568, str=0xf741db00, quote=34) at /srv/repos/mozilla-central/js/src/jsopcode.cpp:940
#8 0x081c8c52 in str\_toSource (cx=0x8545568, argc=0, vp=0xf76ea068) at /srv/repos/mozilla-central/js/src/jsstr.cpp:536
#9 0x08140a8c in js::CallJSNative (cx=0x8545568, native=0x81c8ba4 <str\_toSource(JSContext\*, uintN, JS::Value\*)>, args=...) at ../jscntxtinlines.h:311
#10 0x08123de2 in js::InvokeKernel (cx=0x8545568, args=..., construct=js::NO\_CONSTRUCT) at /srv/repos/mozilla-central/js/src/jsinterp.cpp:625
#11 0x08132ad0 in js::Interpret (cx=0x8545568, entryFrame=0xf76ea020, interpMode=js::JSINTERP\_NORMAL) at /srv/repos/mozilla-central/js/src/jsinterp.cpp:3506
#12 0x0829e62c in js::mjit::EnterMethodJIT (cx=0x8545568, fp=0xf76ea020, code=0xf73ce050, stackLimit=0xf7aca000, partial=false)
at /srv/repos/mozilla-central/js/src/methodjit/MethodJIT.cpp:1093
S-s and sg:critical due to obvious memory hazard (probably buffer overflow).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=713209#c1)• 13 years ago |
|  | |

Wow, this one is tough. It affects all shells I have tested (release, beta, aurora, central) in opt32 and dbg32 modes.Crash Signature: [@ \_\_memcpy\_ssse3\_rep]
[@ JSRope::flatten]
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=713209#c2)• 13 years ago |
|  | |

I looked at this quickly. It only repros with -m -n -a, so seems related to TI. The 'str' passed to js\_QuoteString seems to have been trashed: it is in a FINALIZE\_STRING arena, but its length is garbage (that makes it look like a rope). Interestingly, when viewed as a rope, the "left" child points to a GC thing in FINALIZE\_OBJECT2.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=713209#c3)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=584129&action=diff)
— [Details](attachment.cgi?id=584129&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129)

Regalloc bug. When writing out the return value of an inlined call (as is done when the call's result type is unknown), the inline frame's callee might get synced when allocating a register for the type, clobbering the already-written payload. This could cause a JSObject\* to be interpreted as a value of another type, e.g. a string.Assignee: general → bhackett1024
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: review?(dvander)
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a280594_425645)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=713209#c4)• 13 years ago |
|  | |

Comment on [attachment 584129](/attachment.cgi?id=584129 "patch") [[details]](/attachment.cgi?id=584129&action=edit "patch") [[diff]](/attachment.cgi?id=584129&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129)
patch
[Triage Comment]
Please re-nominate once r+'d and landed on m-c.
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta-
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora-

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a377762_309316)• 13 years ago |

[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=713209#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/d10b118890e4>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a385660_346231)• 13 years ago |

[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta-
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora-

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=713209#c6)• 13 years ago |
|  | |

Comment on [attachment 584129](/attachment.cgi?id=584129 "patch") [[details]](/attachment.cgi?id=584129&action=edit "patch") [[diff]](/attachment.cgi?id=584129&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129)
patch
Backed out due to some 64 bit 'make check' orange.
<https://hg.mozilla.org/integration/mozilla-inbound/rev/f623372c6de0>
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=713209#c7)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/721203297177>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=713209#c8)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/721203297177>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDTarget Milestone: --- → mozilla12

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=713209#c9)• 13 years ago |
|  | |

Comment on [attachment 584129](/attachment.cgi?id=584129 "patch") [[details]](/attachment.cgi?id=584129&action=edit "patch") [[diff]](/attachment.cgi?id=584129&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129)
patch
[Approval Request Comment]
Regression caused by (bug #):
User impact if declined:
Testing completed (on m-c, etc.):
Risk to taking this patch (and alternatives if risky):
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=713209#c10)• 13 years ago |
|  | |

(In reply to Brian Hackett (:bhackett) from [comment #9](/show_bug.cgi?id=713209#c9 "VERIFIED FIXED - Crash [@ __memcpy_ssse3_rep] through JSRope::flatten"))
> Comment on [attachment 584129](/attachment.cgi?id=584129 "patch") [[details]](/attachment.cgi?id=584129&action=edit "patch") [[diff]](/attachment.cgi?id=584129&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129)
> patch
>
> [Approval Request Comment]
> Regression caused by (bug #):
> User impact if declined:
> Testing completed (on m-c, etc.):
> Risk to taking this patch (and alternatives if risky):
Brian - can you address the risk of taking this patch? The benefit seems clear from the sg:crit status.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=713209#c11)• 13 years ago |
|  | |

This is fixing a compiler bug, so the risk here is that the fix is incorrect. This has been in nightlies for close to a week now, and doesn't seem to have been causing any problems.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=713209#c12)• 13 years ago |
|  | |

Comment on [attachment 584129](/attachment.cgi?id=584129 "patch") [[details]](/attachment.cgi?id=584129&action=edit "patch") [[diff]](/attachment.cgi?id=584129&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=713209&attachment=584129)
patch
[Triage Comment]
Given Brian's risk evaluation, approving for Aurora/Beta.
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #584129](/attachment.cgi?id=584129&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=713209#c13)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/2d764ffa9bf7>
<https://hg.mozilla.org/releases/mozilla-beta/rev/0e556b6d0601>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a1129154_346231)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)Target Milestone: mozilla12 → mozilla10

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a1146358_279076)• 13 years ago |

Whiteboard: [sg:critical] js-triage-needed → [sg:critical] js-triage-needed [qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a1837722_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=713209#c14)• 13 years ago |
|  | |

Verified fixed in Firefox 11.0b6 js-shell.
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=713209#c15)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #14](/show_bug.cgi?id=713209#c14 "VERIFIED FIXED - Crash [@ __memcpy_ssse3_rep] through JSRope::flatten"))
> Verified fixed in Firefox 11.0b6 js-shell.
Since this landed in Firefox 11 when it was in Aurora but verified in Beta, should this be keyword verified-beta or verified-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a6610641_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a7209944_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a7889574_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=713209#a7901164_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=713209#c16)• 13 years ago |
|  | |

Ubuntu 11.10, 32bit
Built js-shell for the latest beta release and run the tests from [comment #0](/show_bug.cgi?id=713209#c0 "VERIFIED FIXED - Crash [@ __memcpy_ssse3_rep] through JSRope::flatten"): no crash occured.
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=713209#c17)• 13 years ago |
|  | |

Verified fixed in Firefox 10 and ESR:10
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)Whiteboard: [sg:critical] js-triage-needed [qa+] → [sg:critical][qa+:ashughes] js-triage-needed

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=713209#c18)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=713209&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mandriva.com_165249f2_20250125_102953.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_7eb058b0_20250125_103008.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/712169)
* [XML](/show_bug.cgi?ctype=xml&id=712169)

Closed
[Bug 712169](/show_bug.cgi?id=712169)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: canAllocUnaligned(n), at js/src/ds/LifoAlloc.cpp:100 or Crash [@ \_\_memcpy\_ssse3\_rep]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: canAllocUnaligned(n), at js/src/ds/LifoAlloc.cpp:100 or Crash [@ \_\_memcpy\_ssse3\_rep]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla12

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | --- | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [unaffected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=unaffected) |
| firefox-esr10 | [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 |  | verified |
| firefox11 | + | verified |
| firefox12 | + | unaffected |
| firefox-esr10 | 10+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: cdleary)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ecddac0123ccc2047c6441c5514bcf4f?d=mm&size=40)  [cdleary](/user_profile?user_id=374575)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical][qa+:ashughes] js-triage-done)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa+:ashughes] js-triage-done

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c11 "12 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ \_\_memcpy\_ssse3\_rep ]](https://crash-stats.mozilla.org/signature/?signature=__memcpy_ssse3_rep)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Overflow check in unaligned case.](/attachment.cgi?id=583016)  [13 years ago](#c1)  [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575)   637 bytes, patch | luke : [review+](#a61576_347312 "13 years ago")  christian : [approval-mozilla-aurora+](#c4 "13 years ago")  christian : [approval-mozilla-beta+](#c6 "13 years ago") | [Details](/attachment.cgi?id=583016&action=edit) | [Diff](/attachment.cgi?id=583016&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712169&attachment=583016) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=712169#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision f98c57415d8d (options -m -n -a), 32 bit:
try {
var str = '0123456789';
for (var icount = 0; icount < 24; let(icount, printStatus) (function() gczeal(2))[1]++)
str = str + str;
} catch(ex) {
new XML ( str, false, (new RegExp('[0-9]{3}')).test('23 2 34 78 9 09'));
}
this.toSource();
Furthermore this test crashes on optimized 32 bit versions:
#0 \_\_memcpy\_ssse3\_rep () at ../sysdeps/i386/i686/multiarch/memcpy-ssse3-rep.S:1309
#1 0x081b8f43 in js::LifoAlloc::reallocUnaligned (this=0xf7b0a364, origPtr=0xe73bd018, origSize=167772162, incr=167772162) at /usr/include/bits/string3.h:52
#2 0x080f6090 in SprintEnsureBuffer (sp=0xffffce30, len=<value optimized out>) at /srv/repos/mozilla-central/js/src/jsopcode.cpp:752
#3 0x080f6b19 in js::SprintPut (sp=0xffffce30, s=0x8330ae8 "\"", len=1) at /srv/repos/mozilla-central/js/src/jsopcode.cpp:784
#4 0x080f6de0 in SprintCString (sp=0xffffce30, format=0x827a9c6 "%c") at /srv/repos/mozilla-central/js/src/jsopcode.cpp:804
#5 js::Sprint (sp=0xffffce30, format=0x827a9c6 "%c") at /srv/repos/mozilla-central/js/src/jsopcode.cpp:840
#6 0x080f72c9 in QuoteString (sp=0xffffce30, str=<value optimized out>, quote=34) at /srv/repos/mozilla-central/js/src/jsopcode.cpp:922
#7 0x080f7361 in js\_QuoteString (cx=0x8327358, str=0xf740d180, quote=34) at /srv/repos/mozilla-central/js/src/jsopcode.cpp:940
#8 0x0812b49e in js\_ValueToSource (cx=0x8327358, v=...) at /srv/repos/mozilla-central/js/src/jsstr.cpp:3351
#9 0x080ea30b in obj\_toSource (cx=0x8327358, argc=0, vp=0xf76ea058) at /srv/repos/mozilla-central/js/src/jsobj.cpp:669
#10 0x080cd14c in CallJSNative (cx=0x8327358, args=..., construct=js::NO\_CONSTRUCT) at ../jscntxtinlines.h:311
S-s and sg:critical due to obvious memory hazard.

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=712169#c1)• 13 years ago |
|  | |

Attached patch

[Overflow check in unaligned case.](attachment.cgi?id=583016&action=diff)
— [Details](attachment.cgi?id=583016&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712169&attachment=583016)

Very low risk, requesting Aurora approval, beta not affected.Assignee: general → christopher.learyStatus: NEW → ASSIGNED
[Attachment #583016](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") -
Flags: review?(luke)
[Attachment #583016](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") -
Flags: approval-mozilla-aurora?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712169#a61576_347312)• 13 years ago |

[Attachment #583016](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") -
Flags: review?(luke) → review+

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=712169#c2)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/cb95ada7b4b4>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=712169#c3)• 13 years ago |
|  | |

Merged by Ed Morley
<https://hg.mozilla.org/mozilla-central/rev/cb95ada7b4b4>
LifoAlloc.cpp doesn't exist in Firefox 10 so I'm assuming that version is unaffected by this bug.Status: ASSIGNED → RESOLVEDClosed: 13 years ago
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=unaffected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Resolution: --- → FIXEDTarget Milestone: --- → mozilla12

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=712169#c4)• 13 years ago |
|  | |

Comment on [attachment 583016](/attachment.cgi?id=583016 "Overflow check in unaligned case.") [[details]](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") [[diff]](/attachment.cgi?id=583016&action=diff "Overflow check in unaligned case.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712169&attachment=583016)
Overflow check in unaligned case.
[triage comment]
Approved for aurora. Please land as soon as you can.
[Attachment #583016](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=712169#c5)• 13 years ago |
|  | |

Comment on [attachment 583016](/attachment.cgi?id=583016 "Overflow check in unaligned case.") [[details]](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") [[diff]](/attachment.cgi?id=583016&action=diff "Overflow check in unaligned case.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712169&attachment=583016)
Overflow check in unaligned case.
We merged on the 20th so I now need beta approval as well.
[Attachment #583016](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") -
Flags: approval-mozilla-beta?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=712169#c6)• 13 years ago |
|  | |

Comment on [attachment 583016](/attachment.cgi?id=583016 "Overflow check in unaligned case.") [[details]](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") [[diff]](/attachment.cgi?id=583016&action=diff "Overflow check in unaligned case.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712169&attachment=583016)
Overflow check in unaligned case.
[triage comment]
Approved for beta as well. Sorry, I should have asked if it applied there too.
[Attachment #583016](/attachment.cgi?id=583016&action=edit "Overflow check in unaligned case.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=712169#c7)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/438310f9f812>
Changed the tracking flags because this made it into mozilla-central before Fx11 merged to aurora.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=unaffected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [unaffected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712169#a765203_279076)• 13 years ago |

Whiteboard: [sg:critical] js-triage-needed → [sg:critical][qa+] js-triage-needed

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712169#a765540_389993)• 13 years ago |

Whiteboard: [sg:critical][qa+] js-triage-needed → [sg:critical][qa+] js-triage-done

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=712169#c8)• 13 years ago |
|  | |

Verified fixed in Firefox 11.0b6
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712169#a6914615_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712169#a7513925_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=712169#c9)• 13 years ago |
|  | |

Verified in nightly (finally).Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712169#a8193584_1689)• 13 years ago |

Group: core-security

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=712169#c10)• 13 years ago |
|  | |

Verified fixed in Firefox 10 and ESR:10
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] js-triage-done → [sg:critical][qa+:ashughes] js-triage-done

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=712169#c11)• 12 years ago |
|  | |

Didn't manage to rewrite the test such that it doesn't require E4X, in-testsuite-.Flags: in-testsuite-
You need to [log in](/show_bug.cgi?id=712169&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_fe0bb785_20250125_102955.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2012-01

## Miscellaneous memory safety hazards (rv:10.0/ 1.9.2.26)

Announced
January 31, 2012
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox, SeaMonkey, Thunderbird
Fixed in

* Firefox 10
* Firefox 3.6.26
* SeaMonkey 2.7
* Thunderbird 10
* Thunderbird 3.1.18

### Description

Mozilla developers identified and fixed several memory safety bugs
in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption
under certain circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the Thunderbird and SeaMonkey products because scripting is disabled, but are potentially a risk in browser or browser-like contexts in those products.

### References

Ben Hawkes, Christian Holler, Honza Bombas, Jason Orendorff, Jesse Ruderman,
Jan Odvarko, Peter Van Der Beken, and Bill McCloskey reported memory safety
problems that were fixed in Firefox 10.

* [Memory safety bugs fixed in Firefox 10](https://bugzilla.mozilla.org/buglist.cgi?bug_id=695076,696748,712169,713209,714600,692817,715662,665578,711651,712289,684938,707051)
* [CVE-2012-0443](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0443)

Jesse Ruderman and Bob Clary reported memory safety problems that were fixed
in both Firefox 10 and Firefox 3.6.26.

* [Memory safety bugs fixed in Firefox 10 and Firefox 3.6.26](https://bugzilla.mozilla.org/buglist.cgi?bug_id=693399,705347)
* [CVE-2012-0442](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0442)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_f35937d6_20250125_103002.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/695076)
* [XML](/show_bug.cgi?ctype=xml&id=695076)

Closed
[Bug 695076](/show_bug.cgi?id=695076)
(CVE-2011-3662)

Opened 13 years ago
Closed 13 years ago

# Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface

## Categories

### (Core :: Graphics: CanvasWebGL, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20CanvasWebGL#Graphics%3A%20CanvasWebGL)

Graphics: CanvasWebGL
▾

Core :: Graphics: CanvasWebGL
Bugs with the WebGL Canvas Context.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20CanvasWebGL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | + | verified |
| firefox11 | + | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bjacob, Assigned: bjacob)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[686398](/show_bug.cgi?id=686398 "VERIFIED FIXED - WebGL crash, addressing Texture ImageInfo out of bounds"), [703917](/show_bug.cgi?id=703917 "RESOLVED FIXED - Upgrade ANGLE to r885")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=695076&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=695076)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[code.google.com/p/angleproject/issues...](http://code.google.com/p/angleproject/issues/detail?id=243 "http://code.google.com/p/angleproject/issues/detail?id=243")

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2011-3662

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ gl::Texture::createSurface(gl::Texture::Image\*) ]](https://crash-stats.mozilla.org/signature/?signature=gl%3A%3ATexture%3A%3AcreateSurface%28gl%3A%3ATexture%3A%3AImage%2A%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [try this](/attachment.cgi?id=567544)  [13 years ago](#c1)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.02 KB, patch |  | [Details](/attachment.cgi?id=567544&action=edit) | [Diff](/attachment.cgi?id=567544&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=695076&attachment=567544) |
| --- | --- | --- |
| [import angle r885 in aurora](/attachment.cgi?id=582114)  [13 years ago](#c14)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   4.35 KB, patch | akeybl : [approval-mozilla-aurora+](#c15 "13 years ago") | [Details](/attachment.cgi?id=582114&action=edit) | [Diff](/attachment.cgi?id=582114&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=695076&attachment=582114) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=695076#c0)• 13 years ago |
|  | |

Ben Hawkes reports that his testcase from [Bug 686398](/show_bug.cgi?id=686398 "VERIFIED FIXED - WebGL crash, addressing Texture ImageInfo out of bounds"),
<https://bugzilla.mozilla.org/attachment.cgi?id=559916>
still crashes Firefox 10.0a1 on Windows. Here is a crash report:
<https://crash-stats.mozilla.com/report/index/bp-75d8250b-6c46-4f0d-8115-6a6472111017>
This is very different from [Bug 686398](/show_bug.cgi?id=686398 "VERIFIED FIXED - WebGL crash, addressing Texture ImageInfo out of bounds"), is a ANGLE bug (need to report upstream) and potentially a security concern (invalid read at non-null address).

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=695076#c1)• 13 years ago |
|  | |

Attached patch

[try this](attachment.cgi?id=567544&action=diff)
— [Details](attachment.cgi?id=567544&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=695076&attachment=567544)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=695076#c2)• 13 years ago |
|  | |

Benoit, does the invalid read affect control flow? I.e. do you think this is sg:critical or lower?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=695076#c3)• 13 years ago |
|  | |

I don't know, this requires understanding ANGLE code better than I do.
Sorry I forgot to forward this bug to ANGLE until now.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=695076#c4)• 13 years ago |
|  | |

Pushed my tentative fix to try:
<https://tbpl.mozilla.org/?tree=Try&rev=eb63e500a6bb>
this has less than 50% chances of working, please still give it a try.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=695076#c5)• 13 years ago |
|  | |

Filed <http://code.google.com/p/angleproject/issues/detail?id=243>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=695076#c6)• 13 years ago |
|  | |

Did the try build ([comment 4](/show_bug.cgi?id=695076#c4 "VERIFIED FIXED - Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface")) fix the crash?
Based on the crash link this is crashing trying to read when doing
image->surface->Release();
which means it could theoretically lead to calling an attacker-supplied function on a fake object.See Also: → <http://code.google.com/p/angleproject/issues/detail?id=243>Whiteboard: [sg:critical]

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=695076#c7)• 13 years ago |
|  | |

Suggest trying with ANGLE SVN head. We've completely rewritten much of the texture code.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=695076#c8)• 13 years ago |
|  | |

(In reply to daniel-bzmz from [comment #7](/show_bug.cgi?id=695076#c7 "VERIFIED FIXED - Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface"))
> Suggest trying with ANGLE SVN head. We've completely rewritten much of the
> texture code.
Will do the ANGLE update as soon as possible. Meanwhile, can you have a look at my patch here and check if this is something that you'd want to take in ANGLE anyway? It just adds some error checking.

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=695076#c9)• 13 years ago |
|  | |

We rewrote much of the texture handling code, so it may no longer be relevant. We'll see if we can reproduce the problem before/after.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a2687643_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=695076#c10)• 13 years ago |
|  | |

We found the underlying bug causing the problem here. Will be fixed soon.

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=695076#c11)• 13 years ago |
|  | |

Fixed in ANGLE r885. Should be easily cherry-pick-able if desired.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a2857735_382769)• 13 years ago |

Depends on: [703917](/show_bug.cgi?id=703917 "RESOLVED FIXED - Upgrade ANGLE to r885")

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a3027158_382769)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a3902674_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a3989533_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=695076#c12)• 13 years ago |
|  | |

If this is a major security concern for FF9/10, please nominate for approval on beta/aurora.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=695076#c13)• 13 years ago |
|  | |

(In reply to daniel-bzmz from [comment #11](/show_bug.cgi?id=695076#c11 "VERIFIED FIXED - Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface"))
> Fixed in ANGLE r885. Should be easily cherry-pick-able if desired.
Benoit: please prepare such a check-pick patch for landing in Firefox 10 (and if safe, Fx9).Assignee: nobody → bjacob
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a5106886_1689)• 13 years ago |

[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a5107081_1689)• 13 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=695076#c14)• 13 years ago |
|  | |

Attached patch

[import angle r885 in aurora](attachment.cgi?id=582114&action=diff)
— [Details](attachment.cgi?id=582114&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=695076&attachment=582114)

Here you go. No review because this is a ANGLE rev and already using it on m-c.
<https://tbpl.mozilla.org/?tree=Try&rev=0e57ebad2fb5>
[Attachment #582114](/attachment.cgi?id=582114&action=edit "import angle r885 in aurora") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=695076#c15)• 13 years ago |
|  | |

Comment on [attachment 582114](/attachment.cgi?id=582114 "import angle r885 in aurora") [[details]](/attachment.cgi?id=582114&action=edit "import angle r885 in aurora") [[diff]](/attachment.cgi?id=582114&action=diff "import angle r885 in aurora") [[review]](/page.cgi?id=splinter.html&ignore=&bug=695076&attachment=582114)
import angle r885 in aurora
[Triage Comment]
Approved for Aurora. Please land on Monday 12/19 or earlier in order to make the cut-over to Beta.
[Attachment #582114](/attachment.cgi?id=582114&action=edit "import angle r885 in aurora") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=695076#c16)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/d68e03ca27dc>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=695076#c17)• 13 years ago |
|  | |

Thanks!
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a5461617_1689)• 13 years ago |

Alias: CVE-2011-3662

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=695076#a10554152_1689)• 13 years ago |

Group: core-security

|  | [Virgil Dicu [:virgil] [QA]](/user_profile?user_id=421602) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=695076#c18)• 13 years ago |
|  | |

Mozilla/5.0 (Windows NT 6.1; rv:11.0) Gecko/20100101 Firefox/11.0
Mozilla/5.0 (Windows NT 6.1; rv:10.0.1) Gecko/20100101 Firefox/10.0.1
Verified with 11b3 and 10.0.1 on Windows 7 x86. No crash when running the testcase from [comment 0](/show_bug.cgi?id=695076#c0 "VERIFIED FIXED - Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface").
Could previously replicate the crash on the affected branches (F8).Status: RESOLVED → VERIFIED
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]
You need to [log in](/show_bug.cgi?id=695076&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_47c62f6f_20250125_102957.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/665578)
* [XML](/show_bug.cgi?ctype=xml&id=665578)

Closed
[Bug 665578](/show_bug.cgi?id=665578)

Opened 14 years ago
Closed 13 years ago

# [ATI on Mac] WebGL demo "To the Road of Ribbon" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[ATI on Mac] WebGL demo "To the Road of Ribbon" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]

## Categories

### (Core :: Graphics: CanvasWebGL, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20CanvasWebGL#Graphics%3A%20CanvasWebGL)

Graphics: CanvasWebGL
▾

Core :: Graphics: CanvasWebGL
Bugs with the WebGL Canvas Context.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20CanvasWebGL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | - | wontfix |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | + | fixed |
| firefox11 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: bjacob)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

23 people

## References

### ( [URL](http://www.iquilezles.org/apps/shadertoy/ "http://www.iquilezles.org/apps/shadertoy/") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[690735](/show_bug.cgi?id=690735 "RESOLVED FIXED - Upgrade ANGLE to r774"), [711592](/show_bug.cgi?id=711592 "RESOLVED FIXED - Update ANGLE to r924")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[605780](/show_bug.cgi?id=605780 "RESOLVED FIXED - [meta] tracking bug of crashes with ATI/AMD (Radeon) cards")

Dependency [tree](/showdependencytree.cgi?id=665578&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=665578)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[685892](/show_bug.cgi?id=685892 "RESOLVED DUPLICATE - Shader Toy \"To the Road of Ribbon\" shader triggers crash on Mac/ATI")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[iquilezles.org/apps/shadertoy](http://www.iquilezles.org/apps/shadertoy/ "http://www.iquilezles.org/apps/shadertoy/")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[code.google.com/p/angleproject/issues...](http://code.google.com/p/angleproject/issues/detail?id=193 "http://code.google.com/p/angleproject/issues/detail?id=193")

## Details

### (Keywords: crash, reproducible, testcase, Whiteboard: [sg:critical?][qa+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ ATIRadeonX3000GLDriver@0x5a4fc ]](https://crash-stats.mozilla.org/signature/?signature=ATIRadeonX3000GLDriver%400x5a4fc)

[[@ gldCopyTexSubImage + 33165 ]](https://crash-stats.mozilla.org/signature/?signature=gldCopyTexSubImage%20%2B%2033165)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (9 files, 3 obsolete files)

| [graphics info from System Profiler](/attachment.cgi?id=540493)  [14 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   483 bytes, text/plain |  | [Details](/attachment.cgi?id=540493&action=edit) |
| --- | --- | --- |
| [crash report (mac debug)](/attachment.cgi?id=540494)  [14 years ago](#c2)  [Jesse Ruderman](/user_profile?user_id=11608)   37.20 KB, text/plain |  | [Details](/attachment.cgi?id=540494&action=edit) |
| [crash report (mac debug)](/attachment.cgi?id=540495)  [14 years ago](#c3)  [Jesse Ruderman](/user_profile?user_id=11608)   55.39 KB, text/plain |  | [Details](/attachment.cgi?id=540495&action=edit) |
| [testcase](/attachment.cgi?id=540550)  [14 years ago](#c7)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   2.64 KB, text/html |  | [Details](/attachment.cgi?id=540550&action=edit) |
| [output with MOZ\_GL\_DEBUG\_VERBOSE](/attachment.cgi?id=541618)  [14 years ago](#c13)  [Jesse Ruderman](/user_profile?user_id=11608)   158.27 KB, text/plain |  | [Details](/attachment.cgi?id=541618&action=edit) |
| [testcase (slightly reduced)](/attachment.cgi?id=541722)  [14 years ago](#c20)  [Jesse Ruderman](/user_profile?user_id=11608)   2.07 KB, text/html |  | [Details](/attachment.cgi?id=541722&action=edit) |
| [experimental patch: always unroll loops on Mac](/attachment.cgi?id=541936)  [14 years ago](#c25)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.15 KB, patch |  | [Details](/attachment.cgi?id=541936&action=edit) | [Diff](/attachment.cgi?id=541936&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=541936) |
| [use ANGLE built-in-function-emulation feature](/attachment.cgi?id=564017)  [13 years ago](#c62)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.42 KB, patch | jrmuizel : [review-](#c64 "13 years ago") | [Details](/attachment.cgi?id=564017&action=edit) | [Diff](/attachment.cgi?id=564017&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564017) |
| [use ANGLE built-in-function-emulation feature](/attachment.cgi?id=564288)  [13 years ago](#c65)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.97 KB, patch | jrmuizel : [review+](#c66 "13 years ago")  akeybl : [approval-mozilla-aurora-](#c89 "13 years ago") | [Details](/attachment.cgi?id=564288&action=edit) | [Diff](/attachment.cgi?id=564288&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288) |
| [Patch for Aurora: upgrade ANGLE from r740 to chrome\_m15 branch](/attachment.cgi?id=568995)  [13 years ago](#c70)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   66.79 KB, patch | akeybl : [approval-mozilla-aurora-](#a12204619_425645 "13 years ago") | [Details](/attachment.cgi?id=568995&action=edit) | [Diff](/attachment.cgi?id=568995&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=568995) |
| [Patch on top of previous patch to disable built-in function emulation on 10.7 and newer](/attachment.cgi?id=569382)  [13 years ago](#c73)  [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990)   2.86 KB, patch | bjacob : [review+](#c82 "13 years ago") | [Details](/attachment.cgi?id=569382&action=edit) | [Diff](/attachment.cgi?id=569382&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=569382) |
| [Updated patch on top of previous patch to disable built-in function emulation on 10.7 and newer](/attachment.cgi?id=572632)  [13 years ago](#c85)  [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990)   2.01 KB, patch | bjacob : [review+](#a12124607_382769 "13 years ago") | [Details](/attachment.cgi?id=572632&action=edit) | [Diff](/attachment.cgi?id=572632&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=572632) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=665578#c0)• 14 years ago |
|  | |

Steps to reproduce, at least on my computer:
1. Load <http://www.iquilezles.org/apps/shadertoy/>.
2. In the dropdown in the upper right, select the 3D demo called "To the Road of Ribbon".
3. Click the "Load" button.
Result: [bp-788d54b6-7ae3-47d1-a7f8-2197c2110620](https://crash-stats.mozilla.org/report/index/788d54b6-7ae3-47d1-a7f8-2197c2110620)
Security-sensitive because it's accessing what looks like a random memory address.
This is a new MacBook Pro with Mac OS X 10.6.7.
Graphics info from about:support:
> Adapter Description: 0x21b00,0x20400
> WebGL Renderer: ATI Technologies Inc. -- ATI Radeon HD 6750M OpenGL Engine -- 2.1 ATI-1.6.34
> GPU Accelerated Windows: 1/1 OpenGL

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=665578#c1)• 14 years ago |
|  | |

Attached file
[graphics info from System Profiler](attachment.cgi?id=540493)
— [Details](attachment.cgi?id=540493&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=665578#c2)• 14 years ago |
|  | |

Attached file
[crash report (mac debug)](attachment.cgi?id=540494) (obsolete)
— [Details](attachment.cgi?id=540494&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=665578#c3)• 14 years ago |
|  | |

Attached file
[crash report (mac debug)](attachment.cgi?id=540495)
— [Details](attachment.cgi?id=540495&action=edit)

[Attachment #540494](/attachment.cgi?id=540494&action=edit "crash report (mac debug)") -
Attachment is obsolete: true

|  | [Charles J. Cliffe](/user_profile?user_id=381305) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=665578#c4)• 14 years ago |
|  | |

Strange, following these steps also crashed FF4 on me, but only on my first visit to that shader -- appears to be fine every time since.
My crash report is here:
<https://crash-stats.mozilla.com/report/index/bp-1bd7001a-2c61-4deb-9828-0cfd12110620>
Also running 10.6.7 on a macbook pro except with an NVIDIA 330M GT

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=665578#c5)• 14 years ago |
|  | |

Using Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:7.0a1) Gecko/20110620 Firefox/7.0a1, I cannot reproduce the crash, but I can reproduce it easily on my 10.6.7 machine.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=665578#c6)• 14 years ago |
|  | |

My 10.7 machine has NVIDIA GeForce 9400M while the 10.6 machine has the AMD Radeon HD 6750M and is the newest MPB hardware.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=665578#c7)• 14 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=540550)
— [Details](attachment.cgi?id=540550&action=edit)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=665578#c8)• 14 years ago |
|  | |

bjacob, can you look into this please?Assignee: nobody → bjacob
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=665578#c9)• 14 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=665578#c4 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Strange, following these steps also crashed FF4 on me, but only on my first
> visit to that shader -- appears to be fine every time since.
>
> My crash report is here:
>
> <https://crash-stats.mozilla.com/report/index/bp-1bd7001a-2c61-4deb-9828>-
> 0cfd12110620
>
> Also running 10.6.7 on a macbook pro except with an NVIDIA 330M GT
Charles, your crash looks completely different and should be filed separately against the JS engine.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=665578#c10)• 14 years ago |
|  | |

(In reply to [comment #3](/show_bug.cgi?id=665578#c3 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Created [attachment 540495](/attachment.cgi?id=540495 "crash report (mac debug)") [[details]](/attachment.cgi?id=540495&action=edit "crash report (mac debug)")
> crash report (mac debug)
Can you please try, with a \_debug\_ build, running with MOZ\_GL\_DEBUG\_VERBOSE defined, and capture the output. Something like:
MOZ\_GL\_DEBUG\_VERBOSE=1 ./firefox 2>&1 | tee logfile
I'd like to see the last ~1000 lines if it's too big. Also, when it's crashed, can you please go in GDB and do:
call DumpJSStack()

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=665578#c11)• 14 years ago |
|  | |

Note: here with NVIDIA driver on linux, it works fine.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=665578#c12)• 14 years ago |
|  | |

(In reply to [comment #10](/show_bug.cgi?id=665578#c10 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> (In reply to [comment #3](/show_bug.cgi?id=665578#c3 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> > Created [attachment 540495](/attachment.cgi?id=540495 "crash report (mac debug)") [[details]](/attachment.cgi?id=540495&action=edit "crash report (mac debug)")
> > crash report (mac debug)
>
> Can you please try, with a \_debug\_ build, running with MOZ\_GL\_DEBUG\_VERBOSE
> defined, and capture the output.
Please also attach a backtrace obtained with MOZ\_GL\_DEBUG\_VERBOSE. Without GL debug mode, backtraces are often fooled by the asynchronousness of the GL. The debug mode makes it a synchronous API.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=665578#c13)• 14 years ago |
|  | |

Attached file
[output with MOZ\_GL\_DEBUG\_VERBOSE](attachment.cgi?id=541618)
— [Details](attachment.cgi?id=541618&action=edit)

This is with the testcase Christoph attached. It includes a stack trace and a DumpJSStack.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=665578#c14)• 14 years ago |
|  | |

I can't reproduce on my Mac Mini with a NVIDIA Geforce 320M and Mac OS 10.6.4. Confirming that this bug is ATI-only.Blocks: [605780](/show_bug.cgi?id=605780 "RESOLVED FIXED - [meta] tracking bug of crashes with ATI/AMD (Radeon) cards")Summary: WebGL demo "To the Road of Ribbon" crashes [@ ATIRadeonX3000GLDriver@0x5a4fc] → [ATI on Mac] WebGL demo "To the Road of Ribbon" crashes [@ ATIRadeonX3000GLDriver@0x5a4fc]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a340334_382769)• 14 years ago |

Summary: [ATI on Mac] WebGL demo "To the Road of Ribbon" crashes [@ ATIRadeonX3000GLDriver@0x5a4fc] → [ATI on Mac] WebGL demo "To the Road of Ribbon" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=665578#c15)• 14 years ago |
|  | |

(In reply to [comment #13](/show_bug.cgi?id=665578#c13 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Created [attachment 541618](/attachment.cgi?id=541618 "output with MOZ_GL_DEBUG_VERBOSE") [[details]](/attachment.cgi?id=541618&action=edit "output with MOZ_GL_DEBUG_VERBOSE")
> output with MOZ\_GL\_DEBUG\_VERBOSE
>
> This is with the testcase Christoph attached. It includes a stack trace and
> a DumpJSStack.
Thanks a lot. This shows that the crash is actually in useProgram. I wonder if the GL is getting confused by the undefined vertex attribs in the shader.
Does Chrome also crash on the same machine?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=665578#c16)• 14 years ago |
|  | |

> I wonder if the GL is getting confused by the undefined vertex attribs in the shader.
Ignore that, sorry: the crash is in the first useProgram() call, so by that time attribs can't have been defined yet.
The stack is really strange:
#0 0x00007fffffe00847 in \_\_memcpy ()
#1 0x000000011cd1e4fd in gldCopyTexSubImage ()
#2 0x000000011cd05adf in gldUpdateDispatch ()
#3 0x000000011ccd7748 in gldCreateProgram ()
#4 0x000000011ccd80fb in gldCreateProgram ()
#5 0x000000011ccf29e6 in gldUpdateDispatch ()
#6 0x000000011cbde584 in gleDoSelectiveDispatchNoErrorCore ()
#7 0x000000011cb4d10b in glFinish\_Exec ()
#8 0x000000010179fad1 in mozilla::gl::GLContext::AfterGLCall (this=0x100e08a00, glFunction=0x102fc27b8 "void mozilla::gl::GLContext::fUseProgram(GLuint)") at GLContext.h:1042
#9 0x00000001027d79b7 in mozilla::gl::GLContext::fUseProgram (this=0x100e08a00, program=1) at GLContext.h:1773
Frames 9 to 5 look normal. Frames 4 to 2 can still be understood: program creation was delayed until the program is made current. But frame 1 is ununderstandable: it claims that we're grabbing part of the framebuffer into a texture. That's all the more unexpected as this testcase doesn't do anything with textures.
If you would like us to understand this bug better and perhaps find a work-around, please try to reduce the testcase. There's probably a lot of stuff that can be taken out of this big shader that defines multiple functions oa(), ob(), o() etc.
I don't understand Mac signal names: is this an invalid read, or an invalid write?
I don't agree that the address being accessed here, 0x1266db000, looks random. It looks very close to the heap, since e.g. 0x126706850 and 0x124330a00 are on the heap and it falls in between them.
If it's a write access then I can see how this is sg:critical, as one could imagine an exploit writing stuff onto the heap. If it's a read access, I'm less sure: I understand that that means that the GL is potentially reading private data, but I don't know that that could be exploited i.e. that that private data could end up being exposed in some exploitable way as opposed to just being used internally by the GL.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=665578#c17)• 14 years ago |
|  | |

(In reply to [comment #16](/show_bug.cgi?id=665578#c16 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> I don't understand Mac signal names: is this an invalid read, or an invalid
> write?
Program received signal EXC\_BAD\_ACCESS, Could not access memory.
Reason: KERN\_INVALID\_ADDRESS at address: 0x000000011e828000
0x00007fffffe00847 in \_\_memcpy ()
--[ REGISTERS ]
rax: 0x63b3000 rbx: 0x117cd7fe0 rcx: 0xffffffffffffe600
rdx: 0x30 rsi: 0x118476a00 rdi: 0x11e829a00
rbp: 0x7fff5fbfac10 rsp: 0x7fff5fbfac10 rip: 0x7fffffe00847
--[ FAULTING INSTRUCTION ]
0x7fffffe00847 <\_\_memcpy+167>: movdqa XMMWORD PTR [rdi+rcx],xmm0

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=665578#c18)• 14 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=665578#c17 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> --[ FAULTING INSTRUCTION ]
> 0x7fffffe00847 <\_\_memcpy+167>: movdqa XMMWORD PTR [rdi+rcx],xmm0
OK so it's an invalid write, thanks.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=665578#c19)• 14 years ago |
|  | |

@Benoit: my insights :)
I think the problem is the assignment of q which is made during the for loop(s). If we reduce the size of the loop counter the bug is not triggered. There was similar issue with uniform variables. Which looked like:
uniform sampler2D uni[8];
void main() {
vec4 c = vec4(0,0,0,0);
for (int ii = 0; ii < NUM\_TEXTURES; ++ii) {
c += texture2D(uni[ii], vec2(0.5, 0.5));
}
gl\_FragColor = c;
}
Benoit, do you remember this bug?

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=665578#c20)• 14 years ago |
|  | |

Attached file
[testcase (slightly reduced)](attachment.cgi?id=541722)
— [Details](attachment.cgi?id=541722&action=edit)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=665578#c21)• 14 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=665578#c19 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Benoit, do you remember this bug?
Oh, right. The stack sure does look similar. I think the ANGLE guys figured that Mac crashed when a loop index was used to address a sampler array:
<http://code.google.com/p/angleproject/issues/detail?id=94>
They fixed it by unrolling such for loops:
<http://code.google.com/p/angleproject/source/detail?r=606>
Here however, we don't have any samplers. Could it still be another bug with for loops on Mac? It would be interesting to manually unroll all the for loops in the testcase to see if the crash persists.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=665578#c22)• 14 years ago |
|  | |

ANGLE devs: can you please have a look at comments 19-21, the present crash looks very similar to ANGLE bug 94 except that we have no samplers involved here. Questions:
- Does ANGLE now automatically unroll loops where the index is used to address a sampler array? Or is there a compile-time option to enable that?
- Is there an ANGLE option to unroll all for loops? I'd like to see if this makes the present crash go away.
- Does the present testcase also crash Chrome on Macs with ATI cards?

|  | [Zhenyao Mo](/user_profile?user_id=418005) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=665578#c23)• 14 years ago |
|  | |

(In reply to [comment #22](/show_bug.cgi?id=665578#c22 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> ANGLE devs: can you please have a look at comments 19-21, the present crash
> looks very similar to ANGLE bug 94 except that we have no samplers involved
> here. Questions:
>
> - Does ANGLE now automatically unroll loops where the index is used to
> address a sampler array? Or is there a compile-time option to enable that?
No option. It always unrolls on Mac.
>
> - Is there an ANGLE option to unroll all for loops? I'd like to see if this
> makes the present crash go away.
No. But you can easily to so to your local ANGLE. The code is there for sampler arrays, you only need to comment out the condition.
>
> - Does the present testcase also crash Chrome on Macs with ATI cards?
I don't have a Mac with ATI card to test at the moment.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=665578#c24)• 14 years ago |
|  | |

(In reply to [comment #22](/show_bug.cgi?id=665578#c22 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> - Does the present testcase also crash Chrome on Macs with ATI cards?
Yes, Chrome crashes too:
Google Chrome 14.0.797.0 (Offizieller Build 89638) dev
OS Mac OS
WebKit 535.1 (trunk@89145)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=665578#c25)• 14 years ago |
|  | |

Attached patch

[experimental patch: always unroll loops on Mac](attachment.cgi?id=541936&action=diff)
— [Details](attachment.cgi?id=541936&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=541936)

Thanks Mo. Here's an attempt at unrolling all loops, just to see if it fixes the crash. Can you please check the patch.
Jesse: please check if this avoids the crash.

|  | [Zhenyao Mo](/user_profile?user_id=418005) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=665578#c26)• 14 years ago |
|  | |

Yeah, this should work.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=665578#c27)• 14 years ago |
|  | |

Have applied the patch but FF is still crashing.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=665578#c28)• 14 years ago |
|  | |

(In reply to [comment #26](/show_bug.cgi?id=665578#c26 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Yeah, this should work.
The loop unrolling patch doesn't seem to unroll the loops in this shader.
Here's the output from angle with [attachment 541936](/attachment.cgi?id=541936 "experimental patch: always unroll loops on Mac") [[details]](/attachment.cgi?id=541936&action=edit "experimental patch: always unroll loops on Mac") [[diff]](/attachment.cgi?id=541936&action=diff "experimental patch: always unroll loops on Mac") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=541936)
uniform vec2 resolution;
uniform float time;
void main(){
vec2 p = gl\_FragCoord.xy;
(p[0] \*= (resolution[0] / resolution[1]));
vec3 org = vec3((sin(time) \* 0.5), (cos((time \* 0.5)) \* 0.25), time);
vec3 dir = normalize(vec3(p[0], p[1], 1.0));
vec3 q = vec3(0.0, 0.0, 0.0);
for (int i = 0; (i < 64); (i++))
{
(q += min((((cos(q[0]) + cos((q[1] \* 1.5))) + cos(q[2])) + cos(q[1])), length(max((abs((q - vec3((cos((q[2] \* 1.5)) \* 0.30000001), (-0.5 + (cos(q[2]) \* 0.2)), 0.0))) - vec3(0.125, 0.02, (time + 3.0))), vec3(0.0, 0.0, 0.0)))));
}
(q += reflect(dir, q));
for (int i = 0; (i < 64); (i++))
{
(q += min((((cos(q[0]) + cos((q[1] \* 1.5))) + cos(q[2])) + cos(q[1])), length(max((abs((q - vec3((cos((q[2] \* 1.5)) \* 0.30000001), (-0.5 + (cos(q[2]) \* 0.2)), 0.0))) - vec3(0.125, 0.02, (time + 3.0))), vec3(0.0, 0.0, 0.0)))));
}
vec4 fcolor = (((q[0] + vec4(length((q - org)))) + (min(q[1], 1.0) \* vec4(1.0, 0.80000001, 0.69999999, 1.0))) \* time);
(gl\_FragColor = vec4(fcolor.xyz, 1.0));
}

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=665578#c29)• 14 years ago |
|  | |

Not going to make it for 6 :(
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=665578#c30)• 14 years ago |
|  | |

Apparently no reply yet on my email to the WebGL list, pinging.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=665578#c31)• 13 years ago |
|  | |

Still nothing from the WebGL list?

|  | [Kenneth Russell](/user_profile?user_id=262289) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=665578#c32)• 13 years ago |
|  | |

Sorry, but no, there has been a lot of traffic on the WebGL lists recently and this issue seems to have fallen through the cracks.
The difficult part is going to be finding someone to implement the loop unrolling workaround.
I suggest filing a security issue on <http://code.google.com/p/angleproject/issues/list> (CC: kbr@chromium.org) and I can try to get it prioritized.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=665578#c33)• 13 years ago |
|  | |

Indeed I dropped this ball, sorry. Filing ANGLE bug now.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=665578#c34)• 13 years ago |
|  | |

Filed ANGLE bug:
<http://code.google.com/p/angleproject/issues/detail?id=193>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a4507825_1689)• 13 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)See Also: → <http://code.google.com/p/angleproject/issues/detail?id=193>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=665578#c35)• 13 years ago |
|  | |

Mo has implemented an option for unrolling of all loops in ANGLE r734. Now we have to use it.
Meanwhile ANGLE developers are investigating a different class of work-arounds in ANGLE [bug 196](/show_bug.cgi?id=196 "VERIFIED WONTFIX - warning fix : ns/lib/layout/editor.c").

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a5113212_12352)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=665578#c36)• 13 years ago |
|  | |

Is the fix in angle something we can cherry pick for 7 and 8, or do we need to wait for a new angle merge here? We're running very short on time for 7 (given all hands meetings etc).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=665578#c37)• 13 years ago |
|  | |

scarybeasts: when will Chrome be adopting (and more importantly, announcing) this fix for the ANGLE bug?

|  | [Chris Evans](/user_profile?user_id=322399) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=665578#c38)• 13 years ago |
|  | |

Is this an ANGLE bug or a workaround for an ATI / MacOS bug? It's not clear to me.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=665578#c39)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #36](/show_bug.cgi?id=665578#c36 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Is the fix in angle something we can cherry pick for 7 and 8, or do we need
> to wait for a new angle merge here? We're running very short on time for 7
> (given all hands meetings etc).
It should be cherry-pickable, but either way it will be a quite intrusive change as it's about rewriting shaders. So I don't think that we want it in Firefox 7.
The first possible work-around, which consists in an option to unroll all loops, was implemented as ANGLE r734.
The second possible work-around, which consists in replacing built-in GLSL functions such as normalize() by shims doing basically the same thing and multiplying the result by 1, has just been implemented as ANGLE r738.
The second work-around (r738) seems to work around a larger class of Mac crashers, and doesn't suffer from the downsides of unrolling all loops, so it's my preferred option.
<http://code.google.com/p/angleproject/source/detail?r=738>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=665578#c40)• 13 years ago |
|  | |

(In reply to Chris Evans from [comment #38](/show_bug.cgi?id=665578#c38 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Is this an ANGLE bug or a workaround for an ATI / MacOS bug? It's not clear
> to me.
The bug here is in the Mac OpenGL libraries. The work-arounds are being implemented in ANGLE. The most likely work-around is ANGLE r738, see [comment 39](/show_bug.cgi?id=665578#c39 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]") above.

|  | [Chris Evans](/user_profile?user_id=322399) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=665578#c41)• 13 years ago |
|  | |

Oh, the Mac OpenGL libraries are in an awful state! I have a ton of cases open, and I've forwarded more over from external researchers.
I don't think it's necessary to synchronize here, nor rush anything.
If you haven't already sent this over to Apple, let me know and I have a good contact.
Also, I don't think you should assign this a Mozilla CVE as it is not your fault. You might always mention "workarounds for Mac bugs" in your release notes, though.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=665578#c42)• 13 years ago |
|  | |

Ok, wontfix for 7 then. Thanks Bonoit.
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=665578#c43)• 13 years ago |
|  | |

mozilla-central now has ANGLE r740 so the work-arounds are implemented in ANGLE and we just need to turn them on.
Here's a tryserver build:
<https://tbpl.mozilla.org/?tree=Try&usebuildbot=1&rev=d56911f09ab6>
[http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob@mozilla.com-d56911f09ab6](http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob%40mozilla.com-d56911f09ab6)
By default it doesn't do anything special but you can switch two different workarounds for this bug by defining these environment variables:
MOZ\_ANGLE\_UNROLL\_FOR\_LOOP\_WITH\_INTEGER\_INDEX
turns on the workaround implemented in ANGLE r734
MOZ\_ANGLE\_EMULATE\_BUILT\_IN\_FUNCTIONS
turns on the workaround implemented in ANGLE r738 and fixed in ANGLE r740
It doesn't matter what the value of these environment vars is, only whether they are defined.
If both fix the crash and we get to choose, the preferred solution is EMULATE\_BUILT\_IN\_FUNCTIONS.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=665578#c44)• 13 years ago |
|  | |

Jeff M just tested it on his Mac.
MOZ\_ANGLE\_UNROLL\_FOR\_LOOP\_WITH\_INTEGER\_INDEX does not fix the crash.
MOZ\_ANGLE\_EMULATE\_BUILT\_IN\_FUNCTIONS "fixes" the crash... by injecting a syntax error into the shader preventing the GL driver from successfully compiling it. Here's what Jeff gets on the ShaderToy page:
FS ERROR: ERROR: 0:5: '\*' : wrong operand types no operation '\*' exists that takes a left-hand operand of type '3-component vector of float' and a right operand of type 'const int' (or there is no acceptable conversion)
Apparenntly what happens is that the ANGLE EMULATE\_BUILT\_IN\_FUNCTIONS feature replaces
v.normalize()
by
v.normalize() \* 1
and instead it should replace the 1 by a float constant, like
v.normalize() \* 1.
Filing a ANGLE bug; will also try to patch it myself.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=665578#c45)• 13 years ago |
|  | |

Filed <http://code.google.com/p/angleproject/issues/detail?id=202>
Wrote a patch. Tryserver:
<http://code.google.com/p/angleproject/issues/detail?id=202>
[http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob@mozilla.com-d17ed33c8ed9](http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob%40mozilla.com-d17ed33c8ed9)
Please try again with MOZ\_ANGLE\_EMULATE\_BUILT\_IN\_FUNCTIONS once this build is ready.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=665578#c46)• 13 years ago |
|  | |

Oops, the TBPL link is <https://tbpl.mozilla.org/?tree=Try&usebuildbot=1&rev=d17ed33c8ed9>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=665578#c48)• 13 years ago |
|  | |

Can someone (Jeff? Doug?) please check this build,
[http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob@mozilla.com-d17ed33c8ed9](http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob%40mozilla.com-d17ed33c8ed9)
with MOZ\_ANGLE\_EMULATE\_BUILT\_IN\_FUNCTIONS=1 ?

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=665578#c49)• 13 years ago |
|  | |

I'm unable to repro this crash on my Mac. System specs:
Video card: ATI Radeon HD 6750M
OS: Mac OS X 10.7.1
Video driver: ATI Technologies Inc. -- ATI Radeon HD 6750M OpenGL Engine -- 2.1 ATI-7.4.10
Note that I couldn't repro it on release either, or with MOZ\_ANGLE\_EMULATE\_BUILT\_IN\_FUNCTIONS=0.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=665578#c50)• 13 years ago |
|  | |

I will try to reproduce this using the tryserver build as well since I have good luck crashing on that site.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=665578#c51)• 13 years ago |
|  | |

/marcia wonder where the tryserver build went since the link in [Comment 48](/show_bug.cgi?id=665578#c48 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]") is giving me a 404. Can we regenerate the build?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=665578#c52)• 13 years ago |
|  | |

Forget about that tryserver build, it probably didn't work; but since then I've received a notification from Mo that the real workaround is implemented in ANGLE r774, using the BUILT\_IN\_FUNCTION\_EMULATION option. Will make a patch ASAP, first need to update ANGLE to r774.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a8799452_382769)• 13 years ago |

Depends on: [690735](/show_bug.cgi?id=690735 "RESOLVED FIXED - Upgrade ANGLE to r774")

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=665578#c53)• 13 years ago |
|  | |

Tryserver build with ANGLE updated to r774 and using built-in function emulation:
[https://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob@mozilla.com-3fa88d7c03b2/](https://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bjacob%40mozilla.com-3fa88d7c03b2/)
Please test!

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=665578#c54)• 13 years ago |
|  | |

Benoit: I tested the Tryserver build on 10.6 and it did not crash, although the content did not show in the window. I just see the fps moving but no actual rendering in the window.
Using Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:10.0a1) Gecko/20110929 Firefox/10.0a1 I am able to still replicate the crash easily on the same machine.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=665578#c55)• 13 years ago |
|  | |

Great, thanks.
Mo, is it expected behavior, that while not crashing it's also not rendering correctly?
Anyway, from a security perspective that's all we need :-)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=665578#c56)• 13 years ago |
|  | |

The status of landing this fix is as follows:
\* Firefox 10: it's a no brainer to upgrade ANGLE to r774 and land this fix
\* Firefox 9: i suggest backporting the ANGLE r774 to aurora. Not only will this allow landing this fix easily, but it also brings a large number of other fixes.
\* Firefox 8: I don't know what to do. This fix seems to rely on a number of changesets and cherry-picking them might be just as dangerous as doing a wholesale ANGLE upgrade, which is kinda scary to do in beta stage.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=665578#c57)• 13 years ago |
|  | |

Also, Aurora is already on ANGLE r740 making this a relatively small ANGLE update (in particular no build-system change is involved, these being the ones that bit us in the past).
But Beta is still on ANGLE r686... so that would be a really big ANGLE update.

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=665578#c58)• 13 years ago |
|  | |

@Beniot: you might want to consider the chrome\_m14 or chrome\_m15 branches of ANGLE. I believe they had the fix you need merged into them recently. I'm not sure how closely they are aligned with when you pulled for FF 8/9 but in some ways it might be nice to have both Chrome and FF use the same branches :-)

|  | [Zhenyao Mo](/user_profile?user_id=418005) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=665578#c59)• 13 years ago |
|  | |

To fix the crash, all the EMULATION did is put cos into a function wrapper
float cos\_emu(float angle)
{
return cos(angle);
}
so that should not affect the rendering in theory. If it's not rendering correctly, there is another bug.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=665578#c60)• 13 years ago |
|  | |

(In reply to daniel-bzmz from [comment #58](/show_bug.cgi?id=665578#c58 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> @Beniot: you might want to consider the chrome\_m14 or chrome\_m15 branches of
> ANGLE. I believe they had the fix you need merged into them recently. I'm
> not sure how closely they are aligned with when you pulled for FF 8/9 but in
> some ways it might be nice to have both Chrome and FF use the same branches
> :-)
@Daniel: I actually would love to align FF ANGLE versions with Chrome's, but the main limiting factor here is SVN's difficult handling of branches (or my poor understanding thereof). It's probably doable but I haven't figured a very good way yet of generating a diff between two branches if I decide to switch a FF release from one chrome\_mXX branch to another, or switch from trunk to some chrome\_mXX branch, etc.

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=665578#c61)• 13 years ago |
|  | |

Replied to Benoit via email.
Basic gist is : svn diff OLD-URL[@OLDREV] NEW-URL[@NEWREV]
eg: svn diff [https://angleproject.googlecode.com/svn/trunk@r686](https://angleproject.googlecode.com/svn/trunk%40r686) <https://angleproject.googlecode.com/svn/branches/chrome_m14>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=665578#c62)• 13 years ago |
|  | |

Attached patch

[use ANGLE built-in-function-emulation feature](attachment.cgi?id=564017&action=diff) (obsolete)
— [Details](attachment.cgi?id=564017&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564017)

[Attachment #564017](/attachment.cgi?id=564017&action=edit "use ANGLE built-in-function-emulation feature") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=665578#c63)• 13 years ago |
|  | |

(In reply to daniel-bzmz from [comment #61](/show_bug.cgi?id=665578#c61 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Replied to Benoit via email.
>
> Basic gist is : svn diff OLD-URL[@OLDREV] NEW-URL[@NEWREV]
> eg: svn diff [https://angleproject.googlecode.com/svn/trunk@r686](https://angleproject.googlecode.com/svn/trunk%40r686)
> <https://angleproject.googlecode.com/svn/branches/chrome_m14>
Thanks a lot! Will use chrome\_m branches.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=665578#c64)• 13 years ago |
|  | |

Comment on [attachment 564017](/attachment.cgi?id=564017 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564017&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564017&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564017)
use ANGLE built-in-function-emulation feature
I don't like sprinkling #ifdefs all around and would prefer something like:
if (needsBuiltInFunctions())
compileOptions |= SH\_EMULATE\_BUILT\_IN\_FUNCTIONS
[Attachment #564017](/attachment.cgi?id=564017&action=edit "use ANGLE built-in-function-emulation feature") -
Flags: review?(jmuizelaar) → review-

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=665578#c65)• 13 years ago |
|  | |

Attached patch

[use ANGLE built-in-function-emulation feature](attachment.cgi?id=564288&action=diff)
— [Details](attachment.cgi?id=564288&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288)

ok, i hope this is good enough for you, kitten; i want to harmonize the way we do workarounds, see [bug 686735](/show_bug.cgi?id=686735 "RESOLVED FIXED - Implement no-gfx-driver-workarounds mode"), but let's first fix this security bug.
[Attachment #564017](/attachment.cgi?id=564017&action=edit "use ANGLE built-in-function-emulation feature") -
Attachment is obsolete: true
[Attachment #564288](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") -
Flags: review?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=665578#c66)• 13 years ago |
|  | |

Comment on [attachment 564288](/attachment.cgi?id=564288 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564288&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288)
use ANGLE built-in-function-emulation feature
Still not thrilled but better enough for me.
[Attachment #564288](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") -
Flags: review?(jmuizelaar) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a10483162_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=665578#c67)• 13 years ago |
|  | |

Can we get this landed? We'd love to get this in for 8, which means we need to get this landed on trunk ASAP.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=665578#c68)• 13 years ago |
|  | |

Sorry, dropped this ball again. This is currently only landed in m-c. For 8, the way to go would be to import the chrome\_m14 branch of ANGLE. patch coming.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=665578#c69)• 13 years ago |
|  | |

I tried to make a patch for 8 using the chrome\_m14 branch... but it's missing the main changeset, ANGLE r738. Only the bugfix ANGLE r773 changeset was merged to that branch.
-> giving up for Firefox 8 at this point. Patch coming for Firefox 9 using chrome\_m15 branch.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=665578#c70)• 13 years ago |
|  | |

Attached patch

[Patch for Aurora: upgrade ANGLE from r740 to chrome\_m15 branch](attachment.cgi?id=568995&action=diff)
— [Details](attachment.cgi?id=568995&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=568995)

This patch for Aurora updates it to the chrome\_m15 branch, which is a small change. chrome\_m15 branched off r744 while we were at r740; the diff between 740 and 744 is some optimizations that are nice to have and have been tested for a month on Nightly.
To get the present bug fixed in Aurora, we need approval for both:
- this patch, and
- the other patch to actually use the function-emulation feature ([attachment 564288](/attachment.cgi?id=564288 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564288&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288))
[Attachment #568995](/attachment.cgi?id=568995&action=edit "Patch for Aurora: upgrade ANGLE from r740 to chrome_m15 branch") -
Flags: approval-mozilla-aurora?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a10836223_382769)• 13 years ago |

[Attachment #564288](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") -
Flags: approval-mozilla-aurora?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=665578#c71)• 13 years ago |
|  | |

Aurora patches on tryserver: <https://tbpl.mozilla.org/?tree=Try&rev=227ae3d1470e>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=665578#c72)• 13 years ago |
|  | |

I guessed now was the right time to land this patch, since that's in principle needed to get aurora approval.
<http://hg.mozilla.org/mozilla-central/rev/182a55b58e01>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a10837945_382769)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=665578#c73)• 13 years ago |
|  | |

Attached patch

[Patch on top of previous patch to disable built-in function emulation on 10.7 and newer](attachment.cgi?id=569382&action=diff) (obsolete)
— [Details](attachment.cgi?id=569382&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=569382)

We were running into errors on 10.7 + ATI:
<https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/sdk/tests/conformance/glsl/functions/glsl-function-cos.html>
FAIL \*\*\* Error compiling shader '[object WebGLShader @ 0x115c798c0 (native @ 0x115c79ec0)]':ERROR: 0:5: 'webgl\_emu\_precision' : syntax error syntax error
FAIL getError expected: NO\_ERROR. Was INVALID\_VALUE : no errors from draw
FAIL \*\*\* Error compiling shader '[object WebGLShader @ 0x115aeae90 (native @ 0x115aeb020)]':ERROR: 0:5: 'webgl\_emu\_precision' : syntax error syntax error
FAIL getError expected: NO\_ERROR. Was INVALID\_VALUE : no errors from draw
FAIL \*\*\* Error compiling shader '[object WebGLShader @ 0x11cc04ef0 (native @ 0x11cc04640)]':ERROR: 0:5: 'webgl\_emu\_precision' : syntax error syntax error
FAIL getError expected: NO\_ERROR. Was INVALID\_VALUE : no errors from draw
FAIL \*\*\* Error compiling shader '[object WebGLShader @ 0x118981e90 (native @ 0x118981de0)]':ERROR: 0:5: 'webgl\_emu\_precision' : syntax error syntax error
FAIL getError expected: NO\_ERROR. Was INVALID\_VALUE : no errors from draw
This patch fixes these on 10.7.
[Attachment #569382](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Flags: review?(bjacob)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a11158725_12352)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=665578#c74)• 13 years ago |
|  | |

Running my patch on Try: <https://tbpl.mozilla.org/?tree=Try&rev=20a50709f71c>

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=665578#c75)• 13 years ago |
|  | |

[triage comment]
Not ready to approve yet until "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer" is ready

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a11597197_382769)• 13 years ago |

[Attachment #569382](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Attachment description: Patch on top of previous patch to disable built-in function emulation on 10.7 and newer → (Maybe consider in the future) Patch on top of previous patch to disable built-in function emulation on 10.7 and newer
[Attachment #569382](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Flags: review?(bjacob)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=665578#c76)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #75](/show_bug.cgi?id=665578#c75 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> [triage comment]
>
> Not ready to approve yet until "Patch on top of previous patch to disable
> built-in function emulation on 10.7 and newer" is ready
This was just a potential follow-up patch in case it would be confirmed that the security issue is fixed on Mac OS 10.7... which so far is only confirmed on 1 machine.
I removed the r? field on it and renamed it to be clear.

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=665578#c77)• 13 years ago |
|  | |

Just to clarify: we posted about this bug on the 3dweb mailing list (for WebGL stuff) and someone said that they'd look into it because it seemed to be a bug with ANGLE. We're hoping that if we update ANGLE after it is patched, this bug will go away. If this happens, my patch will be unnecessary. It sounds like this regression isn't anywhere near as bad as the security hole we're leaving open without the main patch, anyways.

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=665578#c78)• 13 years ago |
|  | |

I just discovered that this breaks the WebGL water demo (<http://madebyevan.com/webgl-water/>) and probably others that are similar. I have filed a bug with ANGLE.
<http://code.google.com/p/angleproject/issues/detail?id=242&thanks=242&ts=1320357137>

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=665578#c79)• 13 years ago |
|  | |

[triage comment]
Ok, so for Firefox 9 (on aurora, moving to beta tomorrow):
1. If we take the patch, we get the issues in [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]")
2. There is another patch to fix ths issues in [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]")
3. The patch breaks some demos / might break some sites
4. This is a bug in Apple's graphics drivers, thought to be a security issue
Is that all correct? If so, I'm not sure we can take this in Firefox 9 as-is.Keywords: [#relman/triage/needs-info](/buglist.cgi?keywords=%23relman%2Ftriage%2Fneeds-info&resolution=---)

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=665578#c80)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #79](/show_bug.cgi?id=665578#c79 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> [triage comment]
>
> Ok, so for Firefox 9 (on aurora, moving to beta tomorrow):
>
> 1. If we take the patch, we get the issues in [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]")
> 2. There is another patch to fix ths issues in [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]")
> 3. The patch breaks some demos / might break some sites
> 4. This is a bug in Apple's graphics drivers, thought to be a security issue
>
> Is that all correct? If so, I'm not sure we can take this in Firefox 9 as-is.
I think I should have clarified. My patch fixes the issue described in [comment 78](/show_bug.cgi?id=665578#c78 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"). [Comment 78](/show_bug.cgi?id=665578#c78 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]") was made because we originally thought that the conformance issue wasn't serious but then I discovered that the problem uncovered by the conformance tests applied to a real-world demo.
The patch is, however, intended to be a temporary fix and I wanted to hold off on doing anything about it until the ANGLE people fix it properly. Given that the broken code will be going into a release, I think it's best to land my patch and we can just pull it later when ANGLE is updated.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=665578#c81)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #79](/show_bug.cgi?id=665578#c79 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> [triage comment]
>
> Ok, so for Firefox 9 (on aurora, moving to beta tomorrow):
>
> 1. If we take the patch, we get the issues in [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]")
> 2. There is another patch to fix ths issues in [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]")
> 3. The patch breaks some demos / might break some sites
> 4. This is a bug in Apple's graphics drivers, thought to be a security issue
>
> Is that all correct? If so, I'm not sure we can take this in Firefox 9 as-is.
That's correct. The main patch here is turning on a ANGLE feature that rewrites WebGL shaders to work around a bug in Apple's shader compiler. Unfortunately, that ANGLE feature is currently buggy and causes valid, real-world WebGL apps to stop working.
Given that I don't see a big emergency here (exploitability seems improbable) I wouldn't do anything for FF9.
Hopefully the ANGLE bug can be fixed in time for Firefox 10, or else we'll have a bad dilemma (keep using it and break real world apps due to the ANGLE bug, or turn it off and lose the security work-around it provides).

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=665578#c82)• 13 years ago |
|  | |

Comment on [attachment 569382](/attachment.cgi?id=569382 "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") [[details]](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") [[diff]](/attachment.cgi?id=569382&action=diff "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=569382)
Patch on top of previous patch to disable built-in function emulation on 10.7 and newer
Review of [attachment 569382](/attachment.cgi?id=569382 "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") [[details]](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") [[diff]](/attachment.cgi?id=569382&action=diff "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=569382):
-----------------------------------------------------------------
My only reservation is that we only have limited data to know that it's actually fixed on 10.7 (it just works on Doug's machine).
I'm comfortable landing this on central for FF10 and letting it bake during the full aurora and beta cycles. I'd be less comfortable getting this in FF9 in Beta this week.
[Attachment #569382](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Flags: review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a12116086_382769)• 13 years ago |

[Attachment #569382](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Attachment description: (Maybe consider in the future) Patch on top of previous patch to disable built-in function emulation on 10.7 and newer → Patch on top of previous patch to disable built-in function emulation on 10.7 and newer

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=665578#c83)• 13 years ago |
|  | |

Patch on top of previous patch to disable built-in function emulation on 10.7 and newer
<http://hg.mozilla.org/integration/mozilla-inbound/rev/82a297b0d0d3>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=665578#c84)• 13 years ago |
|  | |

backed out from inbound:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/f70682372656>

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=665578#c85)• 13 years ago |
|  | |

Attached patch

[Updated patch on top of previous patch to disable built-in function emulation on 10.7 and newer](attachment.cgi?id=572632&action=diff)
— [Details](attachment.cgi?id=572632&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=572632)

Updated to use new OnLionOrLater() function which vastly simplifies the code.
[Attachment #569382](/attachment.cgi?id=569382&action=edit "Patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Attachment is obsolete: true
[Attachment #572632](/attachment.cgi?id=572632&action=edit "Updated patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Flags: review?(bjacob)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a12124607_382769)• 13 years ago |

[Attachment #572632](/attachment.cgi?id=572632&action=edit "Updated patch on top of previous patch to disable built-in function emulation on 10.7 and newer") -
Flags: review?(bjacob) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=665578#c86)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/412bc4e114ec>

|  | [Justin Wood (:Callek)](/user_profile?user_id=129968) |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=665578#c87)• 13 years ago |
|  | |

(In reply to Benoit Jacob [:bjacob] from [comment #86](/show_bug.cgi?id=665578#c86 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> <http://hg.mozilla.org/integration/mozilla-inbound/rev/412bc4e114ec>
merged to m-c
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)Whiteboard: [sg:critical?] → [sg:critical]Target Milestone: --- → mozilla10

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=665578#c88)• 13 years ago |
|  | |

I don't see a reason to drop the '?' from [sg:critical?] now?Whiteboard: [sg:critical] → [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a12203802_1689)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=665578#c89)• 13 years ago |
|  | |

Comment on [attachment 564288](/attachment.cgi?id=564288 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564288&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288)
use ANGLE built-in-function-emulation feature
[Triage Comment]
Triggers a major feature regression that will need to be fixed before this lands. Denying for Aurora.
I believe this made the merge (and is thus in Aurora now). Please back out if so.
[Attachment #564288](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora-

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a12204619_425645)• 13 years ago |

[Attachment #568995](/attachment.cgi?id=568995&action=edit "Patch for Aurora: upgrade ANGLE from r740 to chrome_m15 branch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora-

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=665578#c90)• 13 years ago |
|  | |

(In reply to Alex Keybl [:akeybl] from [comment #89](/show_bug.cgi?id=665578#c89 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> Comment on [attachment 564288](/attachment.cgi?id=564288 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564288&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288) [diff] [details] [review]
> use ANGLE built-in-function-emulation feature
>
> [Triage Comment]
> Triggers a major feature regression that will need to be fixed before this
> lands. Denying for Aurora.
>
> I believe this made the merge (and is thus in Aurora now). Please back out
> if so.
What's the regression you're talking about?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=665578#c91)• 13 years ago |
|  | |

(In reply to Doug Sherk (:dRdR) from [comment #90](/show_bug.cgi?id=665578#c90 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> (In reply to Alex Keybl [:akeybl] from [comment #89](/show_bug.cgi?id=665578#c89 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> > Comment on [attachment 564288](/attachment.cgi?id=564288 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564288&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288) [diff] [details] [review] [diff] [details] [review]
> > use ANGLE built-in-function-emulation feature
> >
> > [Triage Comment]
> > Triggers a major feature regression that will need to be fixed before this
> > lands. Denying for Aurora.
> >
> > I believe this made the merge (and is thus in Aurora now). Please back out
> > if so.
>
> What's the regression you're talking about?
The one you reported :-) that ANGLE generates shaders that fail to compile. [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]").
Your latest patch removes the problem on 10.7 by disabling that workaround there, but if I understand correctly we still break useful content on 10.6, such as the WebGL Water demo, [comment 78](/show_bug.cgi?id=665578#c78 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]").
That's why in today's aurora meeting I said we should not take this stuff in Firefox 9.
For Firefox 10, there's still time and hope that the ANGLE bug will get fixed. So I wouldn't back out from Firefox 10 just yet. Again, this is a lose-lose game. If we back out, we get the security issue back; if we don't back out, we break useful content.

|  | [Doug Sherk (:drs) (inactive)](/user_profile?user_id=422990) |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=665578#c92)• 13 years ago |
|  | |

(In reply to Benoit Jacob [:bjacob] from [comment #91](/show_bug.cgi?id=665578#c91 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> (In reply to Doug Sherk (:dRdR) from [comment #90](/show_bug.cgi?id=665578#c90 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> > (In reply to Alex Keybl [:akeybl] from [comment #89](/show_bug.cgi?id=665578#c89 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]"))
> > > Comment on [attachment 564288](/attachment.cgi?id=564288 "use ANGLE built-in-function-emulation feature") [[details]](/attachment.cgi?id=564288&action=edit "use ANGLE built-in-function-emulation feature") [[diff]](/attachment.cgi?id=564288&action=diff "use ANGLE built-in-function-emulation feature") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665578&attachment=564288) [diff] [details] [review] [diff] [details] [review] [diff] [details] [review]
> > > use ANGLE built-in-function-emulation feature
> > >
> > > [Triage Comment]
> > > Triggers a major feature regression that will need to be fixed before this
> > > lands. Denying for Aurora.
> > >
> > > I believe this made the merge (and is thus in Aurora now). Please back out
> > > if so.
> >
> > What's the regression you're talking about?
>
> The one you reported :-) that ANGLE generates shaders that fail to compile.
> [comment 73](/show_bug.cgi?id=665578#c73 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]").
>
> Your latest patch removes the problem on 10.7 by disabling that workaround
> there, but if I understand correctly we still break useful content on 10.6,
> such as the WebGL Water demo, [comment 78](/show_bug.cgi?id=665578#c78 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]").
>
> That's why in today's aurora meeting I said we should not take this stuff in
> Firefox 9.
>
> For Firefox 10, there's still time and hope that the ANGLE bug will get
> fixed. So I wouldn't back out from Firefox 10 just yet. Again, this is a
> lose-lose game. If we back out, we get the security issue back; if we don't
> back out, we break useful content.
To the best of my knowledge, this works fine in 10.6 and earlier. The problem wasn't caught until recently because we don't have any 10.7 slaves (or didn't until recently). I don't see any reason to back this out, at least based on what we know now, as long as my patch is with it.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a13332936_279076)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a14187718_1689)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a15482713_382769)• 13 years ago |

Depends on: [711592](/show_bug.cgi?id=711592 "RESOLVED FIXED - Update ANGLE to r924")

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=665578#c93)• 13 years ago |
|  | |

Angle r910 seems like the fix for the ANGLE bug we're hitting here.

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=665578#c94)• 13 years ago |
|  | |

Cannot reproduce this bug on Firefox 9.0.1 on Mac OS X with the two test cases attached and the reproduction steps given in the [comment 0](/show_bug.cgi?id=665578#c0 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]").
about:support graphics
Adapter Description: 0x21aa00,0x20400
WebGL Renderer: ATI Technologies Inc. -- ATI Radeon HD 2600 PRO OpenGL Engine -- 2.1 ATI-1.6.36
GPU Accelerated Windows: 1/1 OpenGL

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=665578#c95)• 13 years ago |
|  | |

Although I was originally able to repro this at one time on my 10.6 machine that has similar specs to Jesse's - ATI Technologies Inc. -- ATI Radeon HD 6750M OpenGL Engine -- 2.1 ATI-1.6.42 - I now cannot reproduce this on 9.0.1 or any other versions I Have on my machine currently. I am using both the site and the testcases to try to test.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665578#a23946831_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=665578&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_a0dc4950_20250125_103013.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/714600)
* [XML](/show_bug.cgi?ctype=xml&id=714600)

Closed
[Bug 714600](/show_bug.cgi?id=714600)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox-esr10 | [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 |  | wontfix |
| firefox10 | + | verified |
| firefox11 | + | verified |
| firefox12 | + | verified |
| firefox-esr10 | 10+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa+:ashughes] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa+:ashughes] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c18 "12 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=585308)  [13 years ago](#c1)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   4.35 KB, patch | dvander : [review+](#a123031_309316 "13 years ago")  curtisk : [approval-mozilla-aurora+](#a299583_406847 "13 years ago")  curtisk : [approval-mozilla-beta+](#a299583_406847 "13 years ago") | [Details](/attachment.cgi?id=585308&action=edit) | [Diff](/attachment.cgi?id=585308&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714600&attachment=585308) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=714600#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision d98fbf3cbd71 (options -m -n):
var UBound = 0;
var actual = '';
var actualvalues = [];
var expect= '';
var expectedvalues = [];
function addThis() {
actualvalues[UBound] = actual;
expectedvalues[UBound] = expect;
UBound++;
}
function testLengthOnNonNativeProto() {
var o2 = {};
o2.\_\_proto\_\_ = [];
for (var j = 0; j < 5; (({})[addThis()]))
o2.length;
}
assertEq(testLengthOnNonNativeProto(), "no assertion");
S-s due to previous infer failures being security-relevant.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=714600#c1)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=585308&action=diff)
— [Details](attachment.cgi?id=585308&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714600&attachment=585308)

TI bug involving mutable proto. When the prototype of an object is dynamically mutated, the object's type changes and we mark all type sets containing the object as unknown. If a GC occurs then all type sets in the script are purged, along with the original type of the object (if it is not live), forgetting the information that objects with that type have had their prototypes mutated. If we reanalyze the script after the GC, information about the prototype change has been lost and accesses on the initializer objects are treated as if they still had their original prototype. This fix marks initializer opcodes as JOF\_TYPESET, so that persistent type sets retain information about initializers which have seen their prototypes mutated.Assignee: general → bhackett1024
[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a123031_309316)• 13 years ago |

[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a136953_294323)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=714600#c2)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/1a8a06e6c634>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=714600#c3)• 13 years ago |
|  | |

Comment on [attachment 585308](/attachment.cgi?id=585308 "patch") [[details]](/attachment.cgi?id=585308&action=edit "patch") [[diff]](/attachment.cgi?id=585308&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=714600&attachment=585308)
patch
[Approval Request Comment]
User impact if declined: Potential security exploit
Risk to taking this patch (and alternatives if risky): Minimal, this only has an effect when an absurd language corner case is being used (mutable prototypes).
[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a293320_406847)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a299583_406847)• 13 years ago |

[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #585308](/attachment.cgi?id=585308&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=714600#c4)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/1a8a06e6c634>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=714600#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/a0027a963235>
<https://hg.mozilla.org/releases/mozilla-beta/rev/139e57394142>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a725063_346231)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)Target Milestone: --- → mozilla10

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a899647_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a1347812_294323)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a2624846_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=714600#c6)• 13 years ago |
|  | |

No assertion reproduced with the test in [comment 0](/show_bug.cgi?id=714600#c0 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349") with js-shell built from today's mozilla-beta.
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a6350310_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a7029926_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a7041627_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=714600#c7)• 13 years ago |
|  | |

Any tips on how I can verify this? I tried loading the test in [comment 0](/show_bug.cgi?id=714600#c0 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349") using the 2012-01-01 linux-x64 jsshell but could not reproduce the assertion.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=714600#c8)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #7](/show_bug.cgi?id=714600#c7 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"))
> Any tips on how I can verify this? I tried loading the test in [comment 0](/show_bug.cgi?id=714600#c0 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349")
> using the 2012-01-01 linux-x64 jsshell but could not reproduce the assertion.
What branch are we talking about? :)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=714600#c9)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #8](/show_bug.cgi?id=714600#c8 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"))
> (In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #7](/show_bug.cgi?id=714600#c7 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"))
> > Any tips on how I can verify this? I tried loading the test in [comment 0](/show_bug.cgi?id=714600#c0 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349")
> > using the 2012-01-01 linux-x64 jsshell but could not reproduce the assertion.
>
> What branch are we talking about? :)
I was trying to test this on mozilla-central so I know I can reproduce the original issue before verifying on Beta.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=714600#c10)• 13 years ago |
|  | |

Just testing something :)Whiteboard: [sg:critical][qa+] → [sg:critical][qa+][jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=714600#c11)• 13 years ago |
|  | |

JSBugMon: The testcase found in this bug does not reproduce on branch mozilla-aurora (tried revision 883536e3b5da).
JSBugMon: The testcase found in this bug does not reproduce on branch mozilla-beta (tried revision e4ed83ba6eb9).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a8080914_395101)• 13 years ago |

Whiteboard: [sg:critical][qa+][jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta] → [sg:critical][qa+] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=714600#c12)• 13 years ago |
|  | |

The last comment means the bot successfully reproduced the issue on mozilla-central with the specified revision in [comment 0](/show_bug.cgi?id=714600#c0 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"), but it was not able to reproduce the issue on beta or aurora tip.

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=714600#c13)• 13 years ago |
|  | |

Ubuntu 11.04 32bit:
I built jsshell for the latest beta release (12.0b4, rev 9bfe6330d055) and ran the test from [comment #0](/show_bug.cgi?id=714600#c0 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"): the test ran for several minutes until it went out of memory.
Is this expected?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=714600#c14)• 13 years ago |
|  | |

(In reply to Mihaela Velimiroviciu [QA] from [comment #13](/show_bug.cgi?id=714600#c13 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"))
>
> Is this expected?
Very likely, yes. My fuzz testcases usually don't have a "useful" behavior once they are fixed. Some just loop infinitely long, others go oom, again others just throw some exception, but all of that is fine usually. Note that on Linux, per [comment 11](/show_bug.cgi?id=714600#c11 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"), this has been verified fixed on aurora and beta with the given revisions :) Or do you need to verify for a specific revision?

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=714600#c15)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #14](/show_bug.cgi?id=714600#c14 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349"))
Verification on any Firefox 12.0 beta revision is ok.
Changing the flag status-firefox12 to verified.
Thank you!
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore] → [sg:critical][qa!] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore]

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714600#a8219705_421899)• 13 years ago |

Whiteboard: [sg:critical][qa!] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore] → [sg:critical][qa+] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore]

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=714600#c16)• 13 years ago |
|  | |

Decoder, it would be nice if you tried to remove/shorten the iloops before posting. It makes bisecting and verifying easier :)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=714600#c17)• 13 years ago |
|  | |

Verified fixed in Firefox 10 and ESR:10.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore] → [sg:critical][qa+:ashughes] [jsbugmon:verify-branch=mozilla-aurora,verify-branch=mozilla-beta,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=714600#c18)• 12 years ago |
|  | |

Even without iloop, this test takes very long to complete, not taking into the testsuite.Flags: in-testsuite-
You need to [log in](/show_bug.cgi?id=714600&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_5ff39eeb_20250126_080052.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 00:00:52 PST

* **Bug ID:**
  695076,
  696748,
  712169,
  713209,
  714600,
  692817,
  715662,
  665578,
  711651,
  712289,
  684938,
  707051

---

12 bugs found.

| [ID](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [692817](/show_bug.cgi?id=692817 "RESOLVED FIXED - nsA(C)String::SetLength overflow in EncodeInputStream") |  | [nsA(C)String::SetLength overflow in EncodeInputStream](/show_bug.cgi?id=692817) | Core | XPCOM | benjamin | RESO | FIXE | 2015-10-16 |
| [707051](/show_bug.cgi?id=707051 "RESOLVED FIXED - Failure to mark some shapes during delayed marking") |  | [Failure to mark some shapes during delayed marking](/show_bug.cgi?id=707051) | Core | JavaScript Engine | bill.mccloskey | RESO | FIXE | 2012-03-23 |
| [665578](/show_bug.cgi?id=665578 "RESOLVED FIXED - [ATI on Mac] WebGL demo \"To the Road of Ribbon\" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]") |  | [[ATI on Mac] WebGL demo "To the Road of Ribbon" crashes in useProgram [@ ATIRadeonX3000GLDriver@0x5a4fc]](/show_bug.cgi?id=665578) | Core | Graphics: CanvasWebG | jacob.benoit.1 | RESO | FIXE | 2012-03-23 |
| [684938](/show_bug.cgi?id=684938 "RESOLVED FIXED - Proxy nsXPCWrappedJS::Release to the main thread") |  | [Proxy nsXPCWrappedJS::Release to the main thread](/show_bug.cgi?id=684938) | Core | XPConnect | peterv | RESO | FIXE | 2015-10-16 |
| [713209](/show_bug.cgi?id=713209 "VERIFIED FIXED - Crash [@ __memcpy_ssse3_rep] through JSRope::flatten") |  | [Crash [@ \_\_memcpy\_ssse3\_rep] through JSRope::flatten](/show_bug.cgi?id=713209) | Core | JavaScript Engine | bhackett1024 | VERI | FIXE | 2013-01-19 |
| [714600](/show_bug.cgi?id=714600 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349") |  | [Assertion failure: [infer failure] Missing type pushed 0: [0xf6c001c0], at jsinfer.cpp:349](/show_bug.cgi?id=714600) | Core | JavaScript Engine | bhackett1024 | VERI | FIXE | 2013-03-11 |
| [715662](/show_bug.cgi?id=715662 "VERIFIED FIXED - browser-only methodjit crash (triggered by CSS transform tests)") |  | [browser-only methodjit crash (triggered by CSS transform tests)](/show_bug.cgi?id=715662) | Core | JavaScript Engine | bhackett1024 | VERI | FIXE | 2012-12-10 |
| [712289](/show_bug.cgi?id=712289 "VERIFIED FIXED - jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)") |  | [jsval has different alignments in C and C++ (jsdIValue.getWrappedValue broken on 32-bit)](/show_bug.cgi?id=712289) | Core | JavaScript Engine | bzbarsky | VERI | FIXE | 2012-03-30 |
| [712169](/show_bug.cgi?id=712169 "VERIFIED FIXED - Assertion failure: canAllocUnaligned(n), at js/src/ds/LifoAlloc.cpp:100 or Crash [@ __memcpy_ssse3_rep]") |  | [Assertion failure: canAllocUnaligned(n), at js/src/ds/LifoAlloc.cpp:100 or Crash [@ \_\_memcpy\_ssse3\_rep]](/show_bug.cgi?id=712169) | Core | JavaScript Engine | cdleary | VERI | FIXE | 2013-03-11 |
| [695076](/show_bug.cgi?id=695076 "VERIFIED FIXED - Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface") |  | [Crash in ANGLE's libGLESv2, in glTexImage2D on a cube map, invalid read in gl::Texture::createSurface](/show_bug.cgi?id=695076) | Core | Graphics: CanvasWebG | jacob.benoit.1 | VERI | FIXE | 2012-02-17 |
| [696748](/show_bug.cgi?id=696748 "VERIFIED FIXED - [ARM] Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56") |  | [[ARM] Assertion failure: (inst & mask) == expected, at ../methodjit/ICChecker.h:56](/show_bug.cgi?id=696748) | Core | JavaScript Engine | marty.rosenberg | VERI | FIXE | 2013-03-20 |
| [711651](/show_bug.cgi?id=711651 "VERIFIED FIXED - Crash after mutating DOM from MozBeforeResize event") |  | [Crash after mutating DOM from MozBeforeResize event](/show_bug.cgi?id=711651) | Core | DOM: Core & HTML | smaug | VERI | FIXE | 2019-03-13 |

12 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=695076%2C696748%2C712169%2C713209%2C714600%2C692817%2C715662%2C665578%2C711651%2C712289%2C684938%2C707051&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |

[File
a new bug
in the "Core" product](/enter_bug.cgi?product=Core)



=== Content from bugzilla.mozilla.org_7f69667f_20250125_103000.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/692817)
* [XML](/show_bug.cgi?ctype=xml&id=692817)

Closed
[Bug 692817](/show_bug.cgi?id=692817)

Opened 13 years ago
Closed 13 years ago

# nsA(C)String::SetLength overflow in EncodeInputStream

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsA(C)String::SetLength overflow in EncodeInputStream

## Categories

### (Core :: XPCOM, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPCOM#XPCOM)

XPCOM
▾

Core :: XPCOM
This is the basis of our component technology; this covers the mozilla/xpcom source directory and includes the "repository". Unlikely a tester would be able to tell there was an XPCOM problem specifically.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPCOM)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox-esr10 | [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | + | fixed |
| firefox11 | + | fixed |
| firefox12 | + | fixed |
| firefox-esr10 | 10+ | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mayhemer, Assigned: benjamin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/3301a62f3707d6bcef9542d316fb587f?d=mm&size=40)  [benjamin](/user_profile?user_id=7044)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [mayhemer](/user_profile?user_id=269762)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Use 64-bit math and check for overflow, rev. 1](/attachment.cgi?id=576997)  [13 years ago](#c4)  [Benjamin Smedberg](/user_profile?user_id=7044)   946 bytes, patch | dbaron : [review+](#c5 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c12 "13 years ago")  akeybl : [approval-mozilla-beta+](#c12 "13 years ago") | [Details](/attachment.cgi?id=576997&action=edit) | [Diff](/attachment.cgi?id=576997&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=692817&attachment=576997) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=692817#c0)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/annotate/bd1411e362fb/xpcom/io/Base64.cpp#l198>
Result of |(aCount + 2) / 3 \* 4 + aOffset| may overflow based on the argument aCount and aOffset. The resulting buffer size result could be truncated and we'll write (potentially attacker controlled content) past the buffer.
Reporting as unconfirmed since I'm not sure there is somewhere an overflow check, but doesn't seems to be, and also not sure this is easily exploitable.
I can try to create a test case.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=692817#c1)• 13 years ago |
|  | |

All potential consumers:
<http://mxr.mozilla.org/mozilla-central/ident?i=Base64EncodeInputStream>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=692817#c2)• 13 years ago |
|  | |

Clearing sg:critical to trigger triage while we confirm a problem hereKeywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)Whiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=692817#c3)• 13 years ago |
|  | |

This has been sg:critical in the past (we had a case in a user of the nspr base64 implementation) and we should just fix it.Assignee: nobody → benjaminStatus: UNCONFIRMED → NEWEver confirmed: trueWhiteboard: [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a3558795_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Benjamin Smedberg](/user_profile?user_id=7044)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=692817#c4)• 13 years ago |
|  | |

Attached patch

[Use 64-bit math and check for overflow, rev. 1](attachment.cgi?id=576997&action=diff)
— [Details](attachment.cgi?id=576997&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=692817&attachment=576997)

I don't know how to write an automated test for this without allocating 2G of memory, but suggestions welcome.
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: review?(dbaron)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=692817#c5)• 13 years ago |
|  | |

Comment on [attachment 576997](/attachment.cgi?id=576997 "Use 64-bit math and check for overflow, rev. 1") [[details]](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") [[diff]](/attachment.cgi?id=576997&action=diff "Use 64-bit math and check for overflow, rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=692817&attachment=576997)
Use 64-bit math and check for overflow, rev. 1
r=dbaron, though it seems like it's probably better to have PRUint64(aCount), i.e.:
PRUint64 countlong = (PRUint64(aCount) + 2) / 3 \* 4;
in case aCount itself is within 2 of PR\_UINT32\_MAX.
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: review?(dbaron) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a5374832_1689)• 13 years ago |

[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=692817#c6)• 13 years ago |
|  | |

bsmedberg, can we get this landed on m-c?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=692817#c7)• 13 years ago |
|  | |

Comment on [attachment 576997](/attachment.cgi?id=576997 "Use 64-bit math and check for overflow, rev. 1") [[details]](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") [[diff]](/attachment.cgi?id=576997&action=diff "Use 64-bit math and check for overflow, rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=692817&attachment=576997)
Use 64-bit math and check for overflow, rev. 1
[Triage Comment]
Minusing for aurora and beta, but please re-nominate for aurora once this lands on m-c (we'll stick with - for beta given where we are in the cycle now).
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta-
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora-

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=692817#c8)• 13 years ago |
|  | |

I'd still like to get this in for 10, it's a trivial patch for an exploitable bug.
Benjamin, can you land this on m-c?
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Benjamin Smedberg](/user_profile?user_id=7044)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=692817#c9)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/aa47e51cbd8a>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=692817#c10)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/aa47e51cbd8a>
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=692817#c11)• 13 years ago |
|  | |

Comment on [attachment 576997](/attachment.cgi?id=576997 "Use 64-bit math and check for overflow, rev. 1") [[details]](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") [[diff]](/attachment.cgi?id=576997&action=diff "Use 64-bit math and check for overflow, rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=692817&attachment=576997)
Use 64-bit math and check for overflow, rev. 1
Trivial patch for an sg:critical bug, we should IMO fix this on aurora and beta.
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta-
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora-

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a7793700_12352)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=692817#c12)• 13 years ago |
|  | |

Comment on [attachment 576997](/attachment.cgi?id=576997 "Use 64-bit math and check for overflow, rev. 1") [[details]](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") [[diff]](/attachment.cgi?id=576997&action=diff "Use 64-bit math and check for overflow, rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=692817&attachment=576997)
Use 64-bit math and check for overflow, rev. 1
[Triage Comment]
Approved for aurora and beta based upon the trivial nature of this sg:crit patch.
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-beta+
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora?
[Attachment #576997](/attachment.cgi?id=576997&action=edit "Use 64-bit math and check for overflow, rev. 1") -
Flags: approval-mozilla-aurora+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=692817#c13)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/bb54e4c3ad09>
<http://hg.mozilla.org/releases/mozilla-beta/rev/a7beadd61664>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a8413131_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=692817#c14)• 13 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #0](/show_bug.cgi?id=692817#c0 "RESOLVED FIXED - nsA(C)String::SetLength overflow in EncodeInputStream"))
> I can try to create a test case.
Were you able to come up with a testcase? QA needs it to verify the fix. Thanks.Whiteboard: [sg:critical] → [sg:critical][qa?]

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=692817#c15)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #14](/show_bug.cgi?id=692817#c14 "RESOLVED FIXED - nsA(C)String::SetLength overflow in EncodeInputStream"))
> (In reply to Honza Bambas (:mayhemer) from [comment #0](/show_bug.cgi?id=692817#c0 "RESOLVED FIXED - nsA(C)String::SetLength overflow in EncodeInputStream"))
> > I can try to create a test case.
>
> Were you able to come up with a testcase? QA needs it to verify the fix.
> Thanks.
I wasn't. I could try, but please be patient.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=692817#c16)• 13 years ago |
|  | |

Sure Honza, thanks. I'd like to get this verified before Firefox 11 is released if at all possible so if I can have it in the next month that would be fine.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a13249858_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a13849714_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [10+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=10%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=692817#c17)• 13 years ago |
|  | |

Any luck on a testcase here?

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=692817#c18)• 13 years ago |
|  | |

No time so far, sorry.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a14529424_1689)• 13 years ago |

Group: core-security

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=692817#c19)• 13 years ago |
|  | |

qa- until testcase-wanted is satisfied.Whiteboard: [sg:critical][qa?] → [sg:critical][qa-]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=692817#a127015578_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=692817&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Benjamin Smedberg](/user_profile?user_id=7044)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_74aec31c_20250125_103006.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/711651)
* [XML](/show_bug.cgi?ctype=xml&id=711651)

Closed
[Bug 711651](/show_bug.cgi?id=711651)

Opened 13 years ago
Closed 13 years ago

# Crash after mutating DOM from MozBeforeResize event

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash after mutating DOM from MozBeforeResize event

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | --- | [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) |
| firefox10 | --- | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | --- | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| firefox12 | --- | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 |  | affected |
| firefox10 |  | verified |
| firefox11 |  | verified |
| firefox12 |  | verified |
| firefox-esr10 |  | unaffected |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ PresShell::ResizeReflowIgnoreOverride ]](https://crash-stats.mozilla.org/signature/?signature=PresShell%3A%3AResizeReflowIgnoreOverride)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=582420)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   495 bytes, text/html |  | [Details](/attachment.cgi?id=582420&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=582421)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   5.20 KB, text/plain |  | [Details](/attachment.cgi?id=582421&action=edit) |
| [patch](/attachment.cgi?id=582431)  [13 years ago](#c2)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   2.73 KB, patch | roc : [review+](#a18240_5038 "13 years ago")  christian : [approval-mozilla-aurora+](#a245136_482154 "13 years ago") | [Details](/attachment.cgi?id=582431&action=edit) | [Diff](/attachment.cgi?id=582431&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=711651&attachment=582431) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=711651#c0)• 13 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=582420)
— [Details](attachment.cgi?id=582420&action=edit)

Crash [@ PresShell::ResizeReflowIgnoreOverride]

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=711651#c1)• 13 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=582421)
— [Details](attachment.cgi?id=582421&action=edit)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a474_39966)• 13 years ago |

Assignee: nobody → bugsOS: Mac OS X → All

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a2270_39966)• 13 years ago |

Group: core-security

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=711651#c2)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=582431&action=diff)
— [Details](attachment.cgi?id=582431&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=711651&attachment=582431)

Keep things alive, and make sure rootFrame points always to a valid object.
Moving kungFuDeathGrip is enough to fix this bug, but rootFrame handling
looks extremely suspicious.
[Attachment #582431](/attachment.cgi?id=582431&action=edit "patch") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a18240_5038)• 13 years ago |

[Attachment #582431](/attachment.cgi?id=582431&action=edit "patch") -
Flags: review?(roc) → review+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=711651#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2cff3f89e54b>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a62645_39966)• 13 years ago |

[Attachment #582431](/attachment.cgi?id=582431&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a245060_482154)• 13 years ago |

Whiteboard: [sg:?]

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a245136_482154)• 13 years ago |

[Attachment #582431](/attachment.cgi?id=582431&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=711651#c4)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/0d8490e27457>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a1026950_279076)• 13 years ago |

Whiteboard: [sg:?] → [sg:?][qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=711651#c5)• 13 years ago |
|  | |

The need to add a "kungFuDeathGrip" is usually the sign of a potential sg:critical bug, marking as such.
The 1.9.2 branch is unaffected.
from [comment #2](/show_bug.cgi?id=711651#c2 "VERIFIED FIXED - Crash after mutating DOM from MozBeforeResize event")
> Moving kungFuDeathGrip is enough to fix this bug, but rootFrame handling
> looks extremely suspicious.
Do we need another bug to investigate that before un-hiding this one?
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)Whiteboard: [sg:?][qa+] → [sg:critical][qa+]Target Milestone: --- → mozilla11

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a7007406_432443)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a7007869_432443)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a7007993_432443)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a7008104_432443)• 13 years ago |

Status: RESOLVED → VERIFIEDWhiteboard: [sg:critical][qa+] → [sg:critical]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a9066032_1689)• 13 years ago |

Group: core-security
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=711651#a228405090_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=711651&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_c70cec35_20250125_102947.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/#3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK)

# [security-announce] openSUSE-SU-2012:0234-1: important: MozillaFirefox: Version 10

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

9 Feb
2012

9 Feb
'12

18:10

openSUSE Security Update: MozillaFirefox: Version 10
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2012:0234-1
Rating: important
References: #744275
Affected Products:
openSUSE 11.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that contains security fixes can now be
installed. It includes 5 new package versions.
Description:
Mozilla Firefox was updated to version 10 to fix bugs and
security issues.
MFSA 2012-01: Mozilla developers identified and fixed
several memory safety bugs in the browser engine used in
Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain
circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary
code.
In general these flaws cannot be exploited through email in
the Thunderbird and SeaMonkey products because scripting is
disabled, but are potentially a risk in browser or
browser-like contexts in those products. References
CVE-2012-0443: Ben Hawkes, Christian Holler, Honza Bombas,
Jason Orendorff, Jesse Ruderman, Jan Odvarko, Peter Van Der
Beken, and Bill McCloskey reported memory safety problems
that were fixed in Firefox 10.
CVE-2012-0442: Jesse Ruderman and Bob Clary reported memory
safety problems that were fixed in both Firefox 10 and
Firefox 3.6.26.
MFSA 2012-02/CVE-2011-3670: For historical reasons Firefox
has been generous in its interpretation of web addresses
containing square brackets around the host. If this host
was not a valid IPv6 literal address, Firefox attempted to
interpret the host as a regular domain name. Gregory
Fleischer reported that requests made using IPv6 syntax
using XMLHttpRequest objects through a proxy may generate
errors depending on proxy configuration for IPv6. The
resulting error messages from the proxy may disclose
sensitive data because Same-Origin Policy (SOP) will allow
the XMLHttpRequest object to read these error messages,
allowing user privacy to be eroded. Firefox now enforces
RFC 3986 IPv6 literal syntax and that may break links
written using the non-standard Firefox-only forms that were
previously accepted.
This was fixed previously for Firefox 7.0, Thunderbird 7.0,
and SeaMonkey 2.4 but only fixed in Firefox 3.6.26 and
Thunderbird 3.1.18 during 2012.
MFSA 2012-03/CVE-2012-0445: Alex Dvorov reported that an
attacker could replace a sub-frame in another domain's
document by using the name attribute of the sub-frame as a
form submission target. This can potentially allow for
phishing attacks against users and violates the HTML5 frame
navigation policy.
Firefox 3.6 and Thunderbird 3.1 are not affected by this
vulnerability
MFSA 2012-04/CVE-2011-3659: Security researcher regenrecht
reported via TippingPoint's Zero Day Initiative that
removed child nodes of nsDOMAttribute can be accessed under
certain circumstances because of a premature notification
of AttributeChildRemoved. This use-after-free of the child
nodes could possibly allow for for remote code execution.
MFSA 2012-05/CVE-2012-0446: Mozilla security researcher
moz\_bug\_r\_a4 reported that frame scripts bypass XPConnect
security checks when calling untrusted objects. This allows
for cross-site scripting (XSS) attacks through web pages
and Firefox extensions. The fix enables the Script Security
Manager (SSM) to force security checks on all frame scripts.
Firefox 3.6 and Thunderbird 3.1 are not affected by this
vulnerability
MFSA 2012-06/CVE-2012-0447: Mozilla developer Tim Abraldes
reported that when encoding images as
image/vnd.microsoft.icon the resulting data was always a
fixed size, with uninitialized memory appended as padding
beyond the size of the actual image. This is the result of
mImageBufferSize in the encoder being initialized with a
value different than the size of the source image. There is
the possibility of sensitive data from uninitialized memory
being appended to a PNG image when converted fron an ICO
format image. This sensitive data may then be disclosed in
the resulting image.
Firefox 3.6 and Thunderbird 3.1 are not affected by this
vulnerability
MFSA 2012-07/CVE-2012-0444: Security researcher regenrecht
reported via TippingPoint's Zero Day Initiative the
possibility of memory corruption during the decoding of Ogg
Vorbis files. This can cause a crash during decoding and
has the potential for remote code execution.
MFSA 2012-08/CVE-2012-0449: Security researchers Nicolas
Gregoire and Aki Helin independently reported that when
processing a malformed embedded XSLT stylesheet, Firefox
can crash due to a memory corruption. While there is no
evidence that this is directly exploitable, there is a
possibility of remote code execution.
MFSA 2012-09/CVE-2012-0450: magicant starmen reported that
if a user chooses to export their Firefox Sync key the
"Firefox Recovery Key.html" file is saved with incorrect
permissions, making the file contents potentially readable
by other users on Linux and OS X systems.
Firefox 3.6 is not affected by this vulnerability.
Special Instructions and Notes:
Please reboot the system after installing this update.This
update triggers a restart of the software management stack.
More updates will be available for installation after
applying this update and restarting the application. This
update triggers a restart of the software management stack.
More updates will be available for installation after
applying this update and restarting the application.
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 11.4:
zypper in -t patch MozillaFirefox-5750 MozillaThunderbird-5751 mozilla-js192-5749 seamonkey-5768
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 11.4 (i586 x86\_64) [New Version: 1.9.2.26,10.0,2.7 and 3.1.18]:
MozillaFirefox-10.0-0.2.1
MozillaFirefox-branding-upstream-10.0-0.2.1
MozillaFirefox-buildsymbols-10.0-0.2.1
MozillaFirefox-devel-10.0-0.2.1
MozillaFirefox-translations-common-10.0-0.2.1
MozillaFirefox-translations-other-10.0-0.2.1
MozillaThunderbird-3.1.18-0.23.1
MozillaThunderbird-buildsymbols-3.1.18-0.23.1
MozillaThunderbird-devel-3.1.18-0.23.1
MozillaThunderbird-translations-common-3.1.18-0.23.1
MozillaThunderbird-translations-other-3.1.18-0.23.1
enigmail-1.1.2+3.1.18-0.23.1
mozilla-js192-1.9.2.26-0.2.1
mozilla-xulrunner192-1.9.2.26-0.2.1
mozilla-xulrunner192-buildsymbols-1.9.2.26-0.2.1
mozilla-xulrunner192-devel-1.9.2.26-0.2.1
mozilla-xulrunner192-gnome-1.9.2.26-0.2.1
mozilla-xulrunner192-translations-common-1.9.2.26-0.2.1
mozilla-xulrunner192-translations-other-1.9.2.26-0.2.1
seamonkey-2.7-0.2.1
seamonkey-dom-inspector-2.7-0.2.1
seamonkey-irc-2.7-0.2.1
seamonkey-translations-common-2.7-0.2.1
seamonkey-translations-other-2.7-0.2.1
seamonkey-venkman-2.7-0.2.1
- openSUSE 11.4 (x86\_64) [New Version: 1.9.2.26]:
mozilla-js192-32bit-1.9.2.26-0.2.1
mozilla-xulrunner192-32bit-1.9.2.26-0.2.1
mozilla-xulrunner192-gnome-32bit-1.9.2.26-0.2.1
mozilla-xulrunner192-translations-common-32bit-1.9.2.26-0.2.1
mozilla-xulrunner192-translations-other-32bit-1.9.2.26-0.2.1
References:
<https://bugzilla.novell.com/744275>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK/#3ZFJ6IKXLQWJORGW33W7YTSNG7NG4HRK)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.


