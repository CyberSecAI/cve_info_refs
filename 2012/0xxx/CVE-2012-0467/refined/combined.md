=== Content from bugzilla.mozilla.org_1958ba25_20250125_084245.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/737384)
* [XML](/show_bug.cgi?ctype=xml&id=737384)

Closed
[Bug 737384](/show_bug.cgi?id=737384)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox14 | + | fixed |
| firefox-esr10 | 12+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: billm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, crash, testcase, Whiteboard: [sg:critical][qa-] js-triage-done)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-] js-triage-done

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c22 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::gc::MarkInternal ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Agc%3A%3AMarkInternal)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [fix](/attachment.cgi?id=607768)  [13 years ago](#c1)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   1.53 KB, patch | luke : [review+](#c3 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c13 "13 years ago")  akeybl : [approval-mozilla-beta+](#c13 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c13 "13 years ago") | [Details](/attachment.cgi?id=607768&action=edit) | [Diff](/attachment.cgi?id=607768&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737384&attachment=607768) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=737384#c0)• 13 years ago |
|  | |

The following test asserts/crashes on mozilla-central revision 58a2cd0203ee (options -m -n):
a = evalcx('');
for (var i = 0; i < 1000; i++) {
a[i] = i;
}
function foo(x) {
for (var i in x)
var summary = "Basic support for iterable objects and for-in";
}
schedulegc(1234);
foo(a);
Crash trace:
==8882== Invalid read of size 8
==8882== at 0x45B745: void js::gc::MarkInternal<JSString>(JSTracer\*, JSString\*\*) (jsgc.h:674)
==8882== by 0x45C5FE: js::gc::MarkIdInternal(JSTracer\*, long\*) (jsgcmark.cpp:275)
==8882== by 0x45C65E: js::gc::MarkIdRootRange(JSTracer\*, unsigned long, long\*, char const\*) (jsgcmark.cpp:314)
==8882== by 0x452E3E: JS::AutoGCRooter::trace(JSTracer\*) (jsgc.cpp:2280)
==8882== by 0x4530DA: JS::AutoGCRooter::traceAll(JSTracer\*) (jsgc.cpp:2320)
==8882== by 0x455623: \_ZN2jsL11MarkRuntimeEP8JSTracerb.clone.239 (jsgc.cpp:2336)
==8882== by 0x455F3B: BeginMarkPhase(JSRuntime\*) (jsgc.cpp:2989)
==8882== by 0x4594D5: GCCycle(JSContext\*, JSCompartment\*, long, js::JSGCInvocationKind) (jsgc.cpp:3295)
==8882== by 0x45A51E: Collect(JSContext\*, JSCompartment\*, long, js::JSGCInvocationKind, js::gcreason::Reason) (jsgc.cpp:3739)
==8882== by 0x45A835: js::gc::RunDebugGC(JSContext\*) (jsgc.cpp:3760)
==8882== by 0x4D1FE4: \_ZN2js2gc10NewGCThingI8JSStringEEPT\_P9JSContextNS0\_9AllocKindEm.clone.228 (jsgcinlines.h:415)
==8882== by 0x4D462C: js\_NewStringCopyN(JSContext\*, unsigned short const\*, unsigned long) (jsgcinlines.h:474)
==8882== Address 0xfc0b8 is not stack'd, malloc'd or (recently) free'd
I confirmed this is not [bug 733979](/show_bug.cgi?id=733979 "VERIFIED FIXED - Opt-only Crash [@ js::gc::MarkInternal]"), or at least this issue is not fixed by the patch in that bug :) Assuming s-s and sg:critical due to GC-related crash at non-zero address.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=737384#c1)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=607768&action=diff)
— [Details](attachment.cgi?id=607768&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737384&attachment=607768)

Hmm, a bug from long ago. After the resize op, the vector contained uninitialized data that was scanned by the GC.
I wonder if schedulegc is what exposed this to the fuzzers? Christian, do you remember when you started fuzzing with that one?Assignee: general → wmccloskeyStatus: NEW → ASSIGNED
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: review?(luke)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=737384#c2)• 13 years ago |
|  | |

I added schedulegc to the list of builtin functions as soon as you added it. But maybe this test is derived from a recently added test, or just very hard to find :)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=737384#c3)• 13 years ago |
|  | |

Comment on [attachment 607768](/attachment.cgi?id=607768 "fix") [[details]](/attachment.cgi?id=607768&action=edit "fix") [[diff]](/attachment.cgi?id=607768&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737384&attachment=607768)
fix
The fix is good, but I'm pretty sure this isn't a crash because of unitialized memory: resize() will initialize to 0, which will be interpreted as a string jsid. Did you see a segfault at 0 bill? Assuming I'm right, I think this would not be s-s as it is a safe crash at a low address.
On a side-note, if "int" had the low bit unset, then 0 would be interpreted as the int 0, which would be safe for GC.
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: review?(luke) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=737384#c4)• 13 years ago |
|  | |

On the assumption that it /is/ exploitable we should land this in Fx12 (current beta) because landing a patch switching to .infallibleAppend() might attract attention.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=737384#c5)• 13 years ago |
|  | |

After looking at the code for Vector, I agree with Luke that the memory should be zero-initialized. What's weird is that the run in [comment 0](/show_bug.cgi?id=737384#c0 "RESOLVED FIXED - Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]") seems to crash at a non-zero address. (When I ran it, I asserted with a zero address.) How did you run that, Christian? If I run in Valgrind, it just prints the assert and exits. If I use an opt shell, it says that schedulegc isn't defined.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=737384#c6)• 13 years ago |
|  | |

(In reply to Bill McCloskey (:billm) from [comment #5](/show_bug.cgi?id=737384#c5 "RESOLVED FIXED - Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]"))
> How did you run that, Christian? If I run in Valgrind, it just
> prints the assert and exits. If I use an opt shell, it says that schedulegc
> isn't defined.
This is a valgrind run with an opt shell, compiled with these options:
--disable-debug --enable-optimize --enable-valgrind --enable-gczeal
I just verified that this still crashes at non-zero address in opt build.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=737384#c7)• 13 years ago |
|  | |

Thanks, Christian. I looked at this a little more, and it turns out that the address it's crashing on is the address of the mark bit for NULL. So it will always be the same low address (0xfc0b8, just below 1MB), which I think is pretty safe. Consequently, I think this should be sg:dos. Is that correct?
<https://hg.mozilla.org/integration/mozilla-inbound/rev/4f5d0ac5f3a6>Whiteboard: [sg:critical] js-triage-needed → [sg:critical] js-triage-doneTarget Milestone: --- → mozilla14

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=737384#c8)• 13 years ago |
|  | |

> So it will always be the same low address (0xfc0b8, just below 1MB), which I think
> is pretty safe.
I'm comfortable relying on the first page of memory never being mapped, but I'm not comfortable doing the same for 0xfc0b8. Dan, do you know our tier-1 platforms behave?

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=737384#c9)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4f5d0ac5f3a6>Status: ASSIGNED → RESOLVEDClosed: 13 years ago
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=737384#c10)• 13 years ago |
|  | |

[Triage Comment]
Please nominate the fix for ESR landing as per <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=737384#c11)• 13 years ago |
|  | |

A fixed address that an attacker could realistically target is pretty bad.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=737384#c12)• 13 years ago |
|  | |

Comment on [attachment 607768](/attachment.cgi?id=607768 "fix") [[details]](/attachment.cgi?id=607768&action=edit "fix") [[diff]](/attachment.cgi?id=607768&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737384&attachment=607768)
fix
[Approval Request Comment]
User impact if declined: possible security vulnerability
Testing completed (on m-c, etc.): two weeks of nightly testing, verification
Risk to taking this patch (and alternatives if risky):
String changes made by this patch: none
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-esr10?
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=737384#c13)• 13 years ago |
|  | |

Comment on [attachment 607768](/attachment.cgi?id=607768 "fix") [[details]](/attachment.cgi?id=607768&action=edit "fix") [[diff]](/attachment.cgi?id=607768&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737384&attachment=607768)
fix
[Triage Comment]
Low risk and sg:crit, approved for all branches.
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-esr10?
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-esr10+
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-beta+
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #607768](/attachment.cgi?id=607768&action=edit "fix") -
Flags: approval-mozilla-aurora+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=737384#c14)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/e158b91dd28a>
<https://hg.mozilla.org/releases/mozilla-beta/rev/e6be81269d27>
<https://hg.mozilla.org/releases/mozilla-esr10/rev/07c08a7dc1ea>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737384#a2349467_279076)• 13 years ago |

Whiteboard: [sg:critical] js-triage-done → [sg:critical][qa+] js-triage-done

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=737384#c15)• 13 years ago |
|  | |

Having problems trying to reproduce this; I get "schedulegc is not defined" errors. Do I need to build a special shell? Trying to test with 2012-04-16 mozilla-esr10 js-shell.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=737384#c16)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #15](/show_bug.cgi?id=737384#c15 "RESOLVED FIXED - Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]"))
> Having problems trying to reproduce this; I get "schedulegc is not defined"
> errors. Do I need to build a special shell? Trying to test with 2012-04-16
> mozilla-esr10 js-shell.
Are you using a debug shell?

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=737384#c17)• 13 years ago |
|  | |

gkw on IRC suggested I use the following:
<https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-esr10-linux64-debug/1334598618/jsshell-linux-x86_64.zip>
Using that I am able to execute the test successfully; no crashes nor assertions.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=737384#c18)• 13 years ago |
|  | |

Is it really fixed on esr ? because the changeset is empty...
<https://hg.mozilla.org/releases/mozilla-esr10/rev/07c08a7dc1ea>
Or was esr not affected to begin with?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=737384#c19)• 13 years ago |
|  | |

I tried the test from [comment 0](/show_bug.cgi?id=737384#c0 "RESOLVED FIXED - Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]") on esr10 and it does not assert. That either means it was never affected or the test does not reproduce the issue there in general.
Bill, can you check this?

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=737384#c20)• 13 years ago |
|  | |

That's embarrassing. I somehow screwed up the push. Anyway, here's the right fix:
<https://hg.mozilla.org/releases/mozilla-esr10/rev/665a4cfb95cf>
I don't think the testcase will reproduce on branches, with or without the fix. It relied on cross-compartment exceptions to trigger the incorrect behavior. However, the code is still broken.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=737384#c21)• 13 years ago |
|  | |

Given [comment 20](/show_bug.cgi?id=737384#c20 "RESOLVED FIXED - Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]"), I don't think this is something QA can verify so marking qa-. Please correct me if I am wrong.Whiteboard: [sg:critical][qa+] js-triage-done → [sg:critical][qa-] js-triage-done

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737384#a5126249_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=737384#c22)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/jit-test/tests/basic/[bug737384](/show_bug.cgi?id=737384 "RESOLVED FIXED - Assertion failure: thing, at js/src/jsgcmark.cpp:7 or Crash [@ js::gc::MarkInternal]").js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=737384&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from blog.mozilla.org_02ca07ef_20250126_073605.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.o)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.o)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.o)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.o)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_30184bdc_20250125_084200.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/726502)
* [XML](/show_bug.cgi?ctype=xml&id=726502)

Closed
[Bug 726502](/show_bug.cgi?id=726502)

Opened 13 years ago
Closed 13 years ago

# nsDeviceMotion::DeviceMotionChanged may index out of bounds mWindowListeners array

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsDeviceMotion::DeviceMotionChanged may index out of bounds mWindowListeners array

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

12 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | - | wontfix |
| firefox11 | + | wontfix |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: smaug, Assigned: dougt)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/c4f245bb4b1441900aba849213666b04?d=mm&size=40)  [dougt](/user_profile?user_id=302291)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 2 obsolete files)

| [patch v.1](/attachment.cgi?id=604352)  [13 years ago](#c4)  [Doug Turner (:dougt)](/user_profile?user_id=302291)   2.08 KB, patch | smaug : [review-](#c6 "13 years ago") | [Details](/attachment.cgi?id=604352&action=edit) | [Diff](/attachment.cgi?id=604352&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604352) |
| --- | --- | --- |
| [patch .2](/attachment.cgi?id=604416)  [13 years ago](#c9)  [Doug Turner (:dougt)](/user_profile?user_id=302291)   4.08 KB, patch | smaug : [review-](#c10 "13 years ago") | [Details](/attachment.cgi?id=604416&action=edit) | [Diff](/attachment.cgi?id=604416&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604416) |
| [patch v.3](/attachment.cgi?id=604419)  [13 years ago](#c11)  [Doug Turner (:dougt)](/user_profile?user_id=302291)   2.90 KB, patch | smaug : [review+](#c12 "13 years ago") | [Details](/attachment.cgi?id=604419&action=edit) | [Diff](/attachment.cgi?id=604419&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604419) |
| [patch of what landed on m-c](/attachment.cgi?id=604713)  [13 years ago](#c15)  [Doug Turner (:dougt)](/user_profile?user_id=302291)   2.94 KB, patch | dougt : [review+](#c15 "13 years ago")  akeybl : [approval-mozilla-aurora-](#c19 "13 years ago")  akeybl : [approval-mozilla-beta+](#c19 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c21 "13 years ago") | [Details](/attachment.cgi?id=604713&action=edit) | [Diff](/attachment.cgi?id=604713&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604713) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=726502#c0)• 13 years ago |
|  | |

The code dispatches DOM events synchronously, and DOM event listeners can do anything,
like close windows. As far as I see nothing guarantees that
mWindowListeners is still long enough when next iteration starts (after event dispatch).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a855852_1689)• 13 years ago |

Whiteboard: [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=726502#c1)• 13 years ago |
|  | |

We should probably protect mListeners here as well.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=726502#c2)• 13 years ago |
|  | |

Doug, any chance you could look into this? If you're too pressured with mobile stuff right now, do you know someone else who could look into this?Assignee: nobody → doug.turner
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a929607_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a2040545_1689)• 13 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [(not currently active) Ted Mielczarek](/user_profile?user_id=39022) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=726502#c3)• 13 years ago |
|  | |

Presumably a testcase would be something like:
Have a page with an iframe. The iframe adds an event listener for "devicemotion" the notifies the parent, at which time the parent adds an event listener for "devicemotion". In the parent's "devicemotion" handler function, close the window. This should result in nsDeviceMotion touching freed memory. (Presumably we could validate this with valgrind.)
I guess this might be easier if the parent page was itself an iframe, so it could just remove itself from the parent document or something instead of relying on being able to close the window.

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=726502#c4)• 13 years ago |
|  | |

Attached patch

[patch v.1](attachment.cgi?id=604352&action=diff) (obsolete)
— [Details](attachment.cgi?id=604352&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604352)

I couldn't reproduce any failure with the code as it is. My test case was to create 100 iframe each using device motion. In the device motion callback, the iframe would ask the parent document (top) to randomly remove one of the iframes. The test would complete when all of the iframes were removed. I ran this test a few hundred times without any failure.
Ted, is this similar to what you were thinking?
I do not see any harm in making a copy of the listeners before calling out through the callback. This is what the attach patch does. We do not need any locking because all of this code is main thread only.
[Attachment #604352](/attachment.cgi?id=604352&action=edit "patch v.1") -
Flags: review?(bugs)

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=726502#c5)• 13 years ago |
|  | |

i see a few crashes in crash stats that are probably this bug.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=726502#c6)• 13 years ago |
|  | |

Comment on [attachment 604352](/attachment.cgi?id=604352 "patch v.1") [[details]](/attachment.cgi?id=604352&action=edit "patch v.1") [[diff]](/attachment.cgi?id=604352&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604352)
patch v.1
>+ nsCOMArray<nsIDeviceMotionListener> listeners = mListeners;
>+ for (PRUint32 i = listeners.Count(); i > 0 ; ) {
> --i;
> nsRefPtr<nsDeviceMotionData> a = new nsDeviceMotionData(type, x, y, z);
>- mListeners[i]->OnMotionChange(a);
>+ listeners[i]->OnMotionChange(a);
> }
>
>- for (PRUint32 i = mWindowListeners.Length(); i > 0 ; ) {
>+ nsTArray<nsIDOMWindow\*> windowListeners = mWindowListeners;
Nothing keeps the objects in windowListeners alive.
You need to make an nsCOMArray<nsIDOMWindow> or nsTArray<nsCOMPtr<nsIDOMWindow> >
[Attachment #604352](/attachment.cgi?id=604352&action=edit "patch v.1") -
Flags: review?(bugs) → review-

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=726502#c7)• 13 years ago |
|  | |

okay. But I am not seeing ~() being called when RemoveWindowListener is called. Something is keeping the window alive. Maybe we just don't have the right test case.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=726502#c8)• 13 years ago |
|  | |

I'm sure Jesse or mw22 could create you a testcase where window object is deleted ;)
But since the bug is rather obvious here, I wouldn't spend time for the testcase.

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=726502#c9)• 13 years ago |
|  | |

Attached patch

[patch .2](attachment.cgi?id=604416&action=diff) (obsolete)
— [Details](attachment.cgi?id=604416&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604416)

I don't remember why we weren't using nsCOMArray<nsIDOMWindow>. I think it was a shutdown leak. I pushed this patch to try.
<https://hg.mozilla.org/try/rev/e48f12163d10>
Alternatively we can just use a nsCOMArray in nsDeviceMotion::DeviceMotionChanged.
[Attachment #604352](/attachment.cgi?id=604352&action=edit "patch v.1") -
Attachment is obsolete: true
[Attachment #604416](/attachment.cgi?id=604416&action=edit "patch .2") -
Flags: review?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=726502#c10)• 13 years ago |
|  | |

Comment on [attachment 604416](/attachment.cgi?id=604416 "patch .2") [[details]](/attachment.cgi?id=604416&action=edit "patch .2") [[diff]](/attachment.cgi?id=604416&action=diff "patch .2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604416)
patch .2
This leads most certainly to leaks
(which lead to huge cycle collection times).
Could you just copy the values in
nsTArray<nsIDOMWindow\*> mWindowListeners;
to nsTArray<nsCOMPtr<nsIDOMWindow> > and then iterate that.
[Attachment #604416](/attachment.cgi?id=604416&action=edit "patch .2") -
Flags: review?(bugs) → review-

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=726502#c11)• 13 years ago |
|  | |

Attached patch

[patch v.3](attachment.cgi?id=604419&action=diff)
— [Details](attachment.cgi?id=604419&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604419)

[Attachment #604416](/attachment.cgi?id=604416&action=edit "patch .2") -
Attachment is obsolete: true
[Attachment #604419](/attachment.cgi?id=604419&action=edit "patch v.3") -
Flags: review?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=726502#c12)• 13 years ago |
|  | |

Comment on [attachment 604419](/attachment.cgi?id=604419 "patch v.3") [[details]](/attachment.cgi?id=604419&action=edit "patch v.3") [[diff]](/attachment.cgi?id=604419&action=diff "patch v.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604419)
patch v.3
>- for (PRUint32 i = mWindowListeners.Length(); i > 0 ; ) {
>+ nsCOMArray<nsIDOMWindow> windowListeners;
>+ for (PRUint32 i = windowListeners.Count(); i > 0 ; ) {
>+ windowListeners.AppendObject(mWindowListeners[i]);
>+ }
2 space indentation, please.
[Attachment #604419](/attachment.cgi?id=604419&action=edit "patch v.3") -
Flags: review?(bugs) → review+

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=726502#c13)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/4a1f94ebd302>

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=726502#c14)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/6737b6762eb8>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=726502#c15)• 13 years ago |
|  | |

Attached patch

[patch of what landed on m-c](attachment.cgi?id=604713&action=diff)
— [Details](attachment.cgi?id=604713&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604713)

[Attachment #604713](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") -
Flags: review+
[Attachment #604713](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") -
Flags: approval-mozilla-aurora?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=726502#c16)• 13 years ago |
|  | |

Argh, I didn't review the commit message. I guess I should have.
We don't want commit messages to say "hey, here is a possible sg:crit" bug.
Could we take the patch to FF11, if we're going to fix that Pwn2Own bug too.
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) → [?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F)

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=726502#c17)• 13 years ago |
|  | |

i think it is pretty obvious to look at csets that have bugs that are marked as Security-Sensitive. Check-in comments should not lie.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=726502#c18)• 13 years ago |
|  | |

Can we get a risk evaluation of this bug before uplifting to Aurora 12, and therefore Beta 12 in a couple of days?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a2657272_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=726502#c19)• 13 years ago |
|  | |

Comment on [attachment 604713](/attachment.cgi?id=604713 "patch of what landed on m-c") [[details]](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") [[diff]](/attachment.cgi?id=604713&action=diff "patch of what landed on m-c") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604713)
patch of what landed on m-c
[Triage Comment]
Approving this sg:crit fix for Beta 12 since Aurora is now 13.
[Attachment #604713](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") -
Flags: approval-mozilla-beta+
[Attachment #604713](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") -
Flags: approval-mozilla-aurora?
[Attachment #604713](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") -
Flags: approval-mozilla-aurora-

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=726502#c20)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/0209c4988d0d>
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a2750714_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=726502#c21)• 13 years ago |
|  | |

Comment on [attachment 604713](/attachment.cgi?id=604713 "patch of what landed on m-c") [[details]](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") [[diff]](/attachment.cgi?id=604713&action=diff "patch of what landed on m-c") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726502&attachment=604713)
patch of what landed on m-c
[Triage Comment]
Approving for landing on ESR branch, see <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for details.
[Attachment #604713](/attachment.cgi?id=604713&action=edit "patch of what landed on m-c") -
Flags: approval-mozilla-esr10+

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=726502#c22)• 13 years ago |
|  | |

qa- until testcase-wanted is satisfiedWhiteboard: [sg:critical] → [sg:critical][qa-]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=726502#c23)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/a288423859c5>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a8269232_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a115917162_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726502#a223380961_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=726502&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Doug Turner (:dougt)](/user_profile?user_id=302291)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_66f987f7_20250125_084143.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from www.mandriva.com_cc369937_20250125_084147.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_ed4c0831_20250125_084156.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/720305)
* [XML](/show_bug.cgi?ctype=xml&id=720305)

Closed
[Bug 720305](/show_bug.cgi?id=720305)

Opened 13 years ago
Closed 13 years ago

# "Assertion failure: compartment mismatched" with nodelist, custom length setter

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"Assertion failure: compartment mismatched" with nodelist, custom length setter

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla12

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 | - | wontfix |
| firefox12 | + | verified |
| firefox-esr10 | 12+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: mrbkap)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/89d2149736265010bfe669ce8c3075c0?d=mm&size=40)  [mrbkap](/user_profile?user_id=69426)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[756584](/show_bug.cgi?id=756584 "RESOLVED FIXED - Check in crashtest from bug 720305")

Dependency [tree](/showdependencytree.cgi?id=720305&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=720305)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[714663](/show_bug.cgi?id=714663 "RESOLVED DUPLICATE - Crash [@ js::HeapPtr] or [@ js::PropDesc::initialize] with Proxy")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c12 "13 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [testcase (asserts fatally when loaded)](/attachment.cgi?id=590635)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   165 bytes, text/html |  | [Details](/attachment.cgi?id=590635&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=590636)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   9.17 KB, text/plain |  | [Details](/attachment.cgi?id=590636&action=edit) |
| [Proposed fix v1](/attachment.cgi?id=591148)  [13 years ago](#c2)  [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)   2.98 KB, patch | Waldo : [review+](#c4 "13 years ago")  akeybl : [approval-mozilla-esr10+](#a6366862_425645 "13 years ago")  mrbkap : [checkin+](#c7 "13 years ago") | [Details](/attachment.cgi?id=591148&action=edit) | [Diff](/attachment.cgi?id=591148&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591148) |
| [crashtest](/attachment.cgi?id=591744)  [13 years ago](#c6)  [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)   867 bytes, patch |  | [Details](/attachment.cgi?id=591744&action=edit) | [Diff](/attachment.cgi?id=591744&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591744) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=720305#c0)• 13 years ago |
|  | |

Attached file
[testcase (asserts fatally when loaded)](attachment.cgi?id=590635)
— [Details](attachment.cgi?id=590635&action=edit)

*No description provided.*

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=720305#c1)• 13 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=590636)
— [Details](attachment.cgi?id=590636&action=edit)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=720305#c2)• 13 years ago |
|  | |

Attached patch

[Proposed fix v1](attachment.cgi?id=591148&action=diff)
— [Details](attachment.cgi?id=591148&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591148)

Waldo explained over IRC that the construct Object.defineProperty(..., ..., { set: undefined }); creates a property that has a null setter but attributes with JSPROP\_SETTER (and ditto for getters). I didn't realize this when writing this code, so we need an additional check to get this right.Assignee: general → mrbkapStatus: NEW → ASSIGNED
[Attachment #591148](/attachment.cgi?id=591148&action=edit "Proposed fix v1") -
Flags: review?(jwalden+bmo)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a234800_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)Whiteboard: [sg:high]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=720305#c3)• 13 years ago |
|  | |

totally guessing at sg:high due to "compartment mismatch". help?

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=720305#c4)• 13 years ago |
|  | |

Comment on [attachment 591148](/attachment.cgi?id=591148 "Proposed fix v1") [[details]](/attachment.cgi?id=591148&action=edit "Proposed fix v1") [[diff]](/attachment.cgi?id=591148&action=diff "Proposed fix v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591148)
Proposed fix v1
Review of [attachment 591148](/attachment.cgi?id=591148 "Proposed fix v1") [[details]](/attachment.cgi?id=591148&action=edit "Proposed fix v1") [[diff]](/attachment.cgi?id=591148&action=diff "Proposed fix v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591148):
-----------------------------------------------------------------
I so wish our property descriptor API were like the ECMA one.
[Attachment #591148](/attachment.cgi?id=591148&action=edit "Proposed fix v1") -
Flags: review?(jwalden+bmo) → review+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=720305#c5)• 13 years ago |
|  | |

(In reply to Daniel Veditz from [comment #3](/show_bug.cgi?id=720305#c3 "VERIFIED FIXED - \"Assertion failure: compartment mismatched\" with nodelist, custom length setter"))
> totally guessing at sg:high due to "compartment mismatch". help?
This might be critical: we're treating an object that isn't a JSObject as a JSObject.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=720305#c6)• 13 years ago |
|  | |

Attached patch

[crashtest](attachment.cgi?id=591744&action=diff)
— [Details](attachment.cgi?id=591744&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591744)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=720305#c7)• 13 years ago |
|  | |

Comment on [attachment 591148](/attachment.cgi?id=591148 "Proposed fix v1") [[details]](/attachment.cgi?id=591148&action=edit "Proposed fix v1") [[diff]](/attachment.cgi?id=591148&action=diff "Proposed fix v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=720305&attachment=591148)
Proposed fix v1
<https://hg.mozilla.org/integration/mozilla-inbound/rev/8085a3fff93c>
[Attachment #591148](/attachment.cgi?id=591148&action=edit "Proposed fix v1") -
Flags: checkin+

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=720305#c8)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/8085a3fff93c>Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDTarget Milestone: --- → mozilla12

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a3334788_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)Whiteboard: [sg:high] → [sg:critical]

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=720305#c10)• 13 years ago |
|  | |

[Triage Comment]
If this is ready to land on ESR, please nominate as per <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a5745197_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a6161930_69426)• 13 years ago |

[Attachment #591148](/attachment.cgi?id=591148&action=edit "Proposed fix v1") -
Flags: approval-mozilla-esr10?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a6366862_425645)• 13 years ago |

[Attachment #591148](/attachment.cgi?id=591148&action=edit "Proposed fix v1") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=720305#c11)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/e94f766c56d9>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a7916245_18566)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a10069600_1689)• 13 years ago |

Blocks: [756584](/show_bug.cgi?id=756584 "RESOLVED FIXED - Check in crashtest from bug 720305")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a10069633_1689)• 13 years ago |

Group: core-securityFlags: in-testsuite?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=720305#a10139406_75935)• 13 years ago |

No longer blocks: [756584](/show_bug.cgi?id=756584 "RESOLVED FIXED - Check in crashtest from bug 720305")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=720305#c12)• 13 years ago |
|  | |

Crashtest:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/72d9b373a2b8>Blocks: [756584](/show_bug.cgi?id=756584 "RESOLVED FIXED - Check in crashtest from bug 720305")Flags: in-testsuite? → in-testsuite+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=720305#c13)• 13 years ago |
|  | |

(In reply to Ryan VanderMeulen from [comment #12](/show_bug.cgi?id=720305#c12 "VERIFIED FIXED - \"Assertion failure: compartment mismatched\" with nodelist, custom length setter"))
> Crashtest:
> <https://hg.mozilla.org/integration/mozilla-inbound/rev/72d9b373a2b8>
<https://hg.mozilla.org/mozilla-central/rev/72d9b373a2b8>

|  | [Naoki Hirata :nhirata (please use needinfo instead of cc)](/user_profile?user_id=391803) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=720305#c14)• 13 years ago |
|  | |

Verified on 10 esr, 13 beta, and nightly on 10.7Status: RESOLVED → VERIFIED
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)
You need to [log in](/show_bug.cgi?id=720305&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_6a02cda4_20250125_084243.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/737182)
* [XML](/show_bug.cgi?ctype=xml&id=737182)

Closed
[Bug 737182](/show_bug.cgi?id=737182)

Opened 13 years ago
Closed 13 years ago

# 2D texture corruption on Mac/Intel with large texture sizes >= 4993

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

2D texture corruption on Mac/Intel with large texture sizes >= 4993

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | --- | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | --- | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | verified |
| firefox13 |  | verified |
| firefox14 |  | verified |
| firefox-esr10 | 12+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: hhall, Assigned: bjacob)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/28b928b4a53fde072eee450694b8a56c?d=mm&size=40)  [hhall](/user_profile?user_id=386341)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

### ( [URL](http://www.dannijo.com/product_info.php?products_id=766 "http://www.dannijo.com/product_info.php?products_id=766 ") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1310222](/show_bug.cgi?id=1310222 "RESOLVED FIXED - MAX_TEXTURE_SIZE on Firefox is much smaller than Chrome")

Dependency [tree](/showdependencytree.cgi?id=737182&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=737182)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[dannijo.com/product\_info.php?products...](http://www.dannijo.com/product_info.php?products_id=766  "http://www.dannijo.com/product_info.php?products_id=766 ")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:vector-high])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:vector-high]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 3 obsolete files)

| [Image corruption image](/attachment.cgi?id=607300)  [13 years ago](#c0)  [Hilary Hall [:hillzy]](/user_profile?user_id=386341)   621.35 KB, image/png |  | [Details](/attachment.cgi?id=607300&action=edit) |
| --- | --- | --- |
| [testcase](/attachment.cgi?id=607633)  [13 years ago](#c6)  [Joe Drew (not getting mail)](/user_profile?user_id=94)   1.95 MB, application/zip |  | [Details](/attachment.cgi?id=607633&action=edit) |
| [small testcase using WebGL](/attachment.cgi?id=607753)  [13 years ago](#c9)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   4.55 KB, text/html |  | [Details](/attachment.cgi?id=607753&action=edit) |
| [near-minimal testcase using only canvas2D](/attachment.cgi?id=607893)  [13 years ago](#c10)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   314 bytes, text/html |  | [Details](/attachment.cgi?id=607893&action=edit) |
| [limit max tex size on mac/intel](/attachment.cgi?id=607909)  [13 years ago](#c11)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   4.39 KB, patch |  | [Details](/attachment.cgi?id=607909&action=edit) | [Diff](/attachment.cgi?id=607909&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607909) |
| [limit max tex size on mac/intel](/attachment.cgi?id=607910)  [13 years ago](#c12)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   4.97 KB, patch | joe : [review-](#c24 "13 years ago") | [Details](/attachment.cgi?id=607910&action=edit) | [Diff](/attachment.cgi?id=607910&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910) |
| [drop WebGL cube map workaround](/attachment.cgi?id=607912)  [13 years ago](#c13)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.57 KB, text/plain | jrmuizel : [review+](#a834129_309398 "13 years ago") | [Details](/attachment.cgi?id=607912&action=edit) |
| [limit max tex size on mac/intel](/attachment.cgi?id=609188)  [13 years ago](#c26)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   6.21 KB, patch | BenWa : [review+](#c27 "13 years ago") | [Details](/attachment.cgi?id=609188&action=edit) | [Diff](/attachment.cgi?id=609188&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609188) |
| [limit max tex size on mac/intel](/attachment.cgi?id=609343)  [13 years ago](#c29)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   6.37 KB, patch | BenWa : [review+](#c30 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c34 "13 years ago")  akeybl : [approval-mozilla-beta+](#c34 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#a1996440_272375 "13 years ago") | [Details](/attachment.cgi?id=609343&action=edit) | [Diff](/attachment.cgi?id=609343&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609343) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Hilary Hall [:hillzy]](/user_profile?user_id=386341)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=737182#c0)• 13 years ago |
|  | |

Attached image
[Image corruption image](attachment.cgi?id=607300)
— [Details](attachment.cgi?id=607300&action=edit)

When I go to: <http://www.dannijo.com/product_info.php?products_id=766> and click on the image to view details, check the file I attached to see what happens:
Hardware Info:
11" Macbook Air - Mid 2011
Graphics Intel HD Graphics 3000 384 MB
Software Mac OS X Lion 10.7.3 (11D50b)
Running Firefox 11.0

|  | [Benoit Girard (:BenWa)](/user_profile?user_id=368375) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=737182#c1)• 13 years ago |
|  | |

STR: Click on the image
I can confirm the bug by running on my integrated gpu, not discrete:
15-inch, Early 2011
Intel Inc. -- Intel HD Graphics 3000 OpenGL Engine -- 2.1 APPLE-7.14.5
Vague regression range (between firefox 9 and 10):
<http://hg.mozilla.org/releases/mozilla-release/rev/72ad46d416ce> is affected
<http://hg.mozilla.org/releases/mozilla-release/rev/c4405d7a95f6> is not

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=737182#c2)• 13 years ago |
|  | |

This is a really big image -
(gdb) p iwidth
$1 = 5455
(gdb) p iheight
$2 = 5455
While the Intel card apparently allows 8192, this makes me suspicious....Assignee: nobody → joe

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a76236_94)• 13 years ago |

URL: [http://www.dannijo.com/product\_info.p...](http://www.dannijo.com/product_info.php?products_id=766 )

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=737182#c3)• 13 years ago |
|  | |

Our experience in [bug 684882](/show_bug.cgi?id=684882 "VERIFIED FIXED - Random video memory grabbed into WebGL cube map textures on Mac OS, including on 10.7.1, on Intel GPUs") may be worth keeping in mind here (intel/mac driver too optimistic with its max tex size)

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=737182#c4)• 13 years ago |
|  | |

It's not a strict image size problem; resizing the image to 4097x4097 lets it work, as does 4500x4500, but 5000x5000 doesn't.

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=737182#c5)• 13 years ago |
|  | |

Given that this is not a simple problem, I'm going to bow out of this in favour of working on higher-priority items.Assignee: joe → nobody

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=737182#c6)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=607633)
— [Details](attachment.cgi?id=607633&action=edit)

This is a simple save-as of the website, and reproduces the bug on load.

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a88806_94)• 13 years ago |

Group: core-securityWhiteboard: [sg:high]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=737182#c7)• 13 years ago |
|  | |

Thanks for hiding this bug. uninitialized-video-memory-exposed bugs with a reproducible testcase are definitely sg:high.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=737182#c8)• 13 years ago |
|  | |

Here is a testcase using WebGL, showing this to be a driver bug with huge 2D textures. It uses a 5455x5455 texture. This was directly adapted from the cube map testcase from [bug 684882](/show_bug.cgi?id=684882 "VERIFIED FIXED - Random video memory grabbed into WebGL cube map textures on Mac OS, including on 10.7.1, on Intel GPUs").
<http://people.mozilla.org/~bjacob/webgltexture2D5k.html>
STR:
1. use gfxCardStatus to force usage of the Intel GPU
2. go to above testcase
Confirmed to reproduce in both Firefox and Chrome.
Probable solution: like in [bug 684882](/show_bug.cgi?id=684882 "VERIFIED FIXED - Random video memory grabbed into WebGL cube map textures on Mac OS, including on 10.7.1, on Intel GPUs"), limit texture size on Mac/Intel. Here, 4096 seems like the natural choice, unless someone can reproduce the bug at sizes <= 4096. By that occasion, we should probably move the existing cube map workaround from WebGL implementation into GLContext as well.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=737182#c9)• 13 years ago |
|  | |

Attached file
[small testcase using WebGL](attachment.cgi?id=607753)
— [Details](attachment.cgi?id=607753&action=edit)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a93893_382769)• 13 years ago |

Assignee: nobody → bjacob

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a93977_382769)• 13 years ago |

Summary: Image corruption → 2D texture corruption on Mac/Intel with large texture sizes >= 5k

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=737182#c10)• 13 years ago |
|  | |

Attached file
[near-minimal testcase using only canvas2D](attachment.cgi?id=607893)
— [Details](attachment.cgi?id=607893&action=edit)

Here's a more or less minimal testcase, without WebGL, which means in particular that the Mac will naturally stay on the integrated Intel GPU i.e. no need for gfxCardStatus anymore to reproduce.
public URL:
<http://people.mozilla.org/~bjacob/canvas2D5k.html>
STR:
1. use Mac OSX 10.6+ (so we do accelerated layers) with Intel graphics, make sure that the integrated Intel GPU is in use.
2. click above link
Confirmed to reproduce in Firefox.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=737182#c11)• 13 years ago |
|  | |

Attached patch

[limit max tex size on mac/intel](attachment.cgi?id=607909&action=diff) (obsolete)
— [Details](attachment.cgi?id=607909&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607909)

This should fix it, assuming that 2D texture sizes <= 4096 are safe.
I wasn't sure what was the best way to simulate a ERROR\_INVALID\_VALUE. In WebGLContext we supplant the native GL error system, but that's not the case in GLContext outside of debug mode at the moment. So I thought the simplest was to change the width and height to -1. Indeed, GLsizei is signed, negative values explicitly generate INVALID\_VALUE, and even if they were interpreted as a huge positive value (in case of a driver bug), that would still be INVALID\_VALUE (larger than max value).
I've been wondering how safe it is to let this workaround depend on the VENDOR string, given Mac GPU switching. I think it's quite safe as the GLContext is the LayerManager's, which is created when the Window is created, which is earlier than when content can force a GPU switch (by creating a WebGL context). One possible attack though would go as follows:
1. browser starts, main window using GL layers on Intel GPU
2. create a WebGL context -> switch all to discrete GPU
3. create a new window. This step probably requires some social engineering i.e. I don't think that content can create new windows entirely by itself.
4. New window's GLContext is created on discrete GPU, hence it doesn't have the texture size restriction.
5. drop reference to WebGL context object and canvas
6. wait for GC to happen (about 20 seconds)
7. When the WebGL context is GC'd, the Mac switches back to Intel GPU
8. in the second browser window created at step 3, create a very large 2d canvas as in the testcase here.
Should we worry about such a convoluted attack path?
[Attachment #607909](/attachment.cgi?id=607909&action=edit "limit max tex size on mac/intel") -
Flags: review?(joe)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=737182#c12)• 13 years ago |
|  | |

Attached patch

[limit max tex size on mac/intel](attachment.cgi?id=607910&action=diff) (obsolete)
— [Details](attachment.cgi?id=607910&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910)

Let's initialize these max-size variables in the ctor to avoid any headache if the initialization code setting them is ever not called.
[Attachment #607909](/attachment.cgi?id=607909&action=edit "limit max tex size on mac/intel") -
Attachment is obsolete: true
[Attachment #607909](/attachment.cgi?id=607909&action=edit "limit max tex size on mac/intel") -
Flags: review?(joe)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=737182#c13)• 13 years ago |
|  | |

Attached file
[drop WebGL cube map workaround](attachment.cgi?id=607912)
— [Details](attachment.cgi?id=607912&action=edit)

Once the above GLContext patch lands, we won't need the WebGL-specific tweak anymore.
Keeping this a separate patch because I want to only ask for aurora/beta approval for the GLContext patch, not for this one.
[Attachment #607912](/attachment.cgi?id=607912&action=edit "drop WebGL cube map workaround") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a140363_382769)• 13 years ago |

[Attachment #607910](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") -
Flags: review?(joe)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=737182#c14)• 13 years ago |
|  | |

(In reply to Benoit Girard (:BenWa) from [comment #1](/show_bug.cgi?id=737182#c1 "VERIFIED FIXED - 2D texture corruption on Mac/Intel with large texture sizes >= 4993"))
> Vague regression range (between firefox 9 and 10):
> <http://hg.mozilla.org/releases/mozilla-release/rev/72ad46d416ce> is affected
> <http://hg.mozilla.org/releases/mozilla-release/rev/c4405d7a95f6> is not
This could be explained by the fact that we used to have a bug whereby we stayed on the discrete GPU all the time (see [bug 646043](/show_bug.cgi?id=646043 "RESOLVED FIXED - Hardware acceleration seems to require discrete GPU on Macs with two GPUs")) and eventually fixed it.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=737182#c15)• 13 years ago |
|  | |

We bisected the minimum texture size reproducing this on Etienne's Mac. The smallest size reproducing this is 4993.Summary: 2D texture corruption on Mac/Intel with large texture sizes >= 5k → 2D texture corruption on Mac/Intel with large texture sizes >= 4993

|  | [Benoit Girard (:BenWa)](/user_profile?user_id=368375) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=737182#c16)• 13 years ago |
|  | |

(In reply to Benoit Jacob [:bjacob] from [comment #14](/show_bug.cgi?id=737182#c14 "VERIFIED FIXED - 2D texture corruption on Mac/Intel with large texture sizes >= 4993"))
> (In reply to Benoit Girard (:BenWa) from [comment #1](/show_bug.cgi?id=737182#c1 "VERIFIED FIXED - 2D texture corruption on Mac/Intel with large texture sizes >= 4993"))
> > Vague regression range (between firefox 9 and 10):
> > <http://hg.mozilla.org/releases/mozilla-release/rev/72ad46d416ce> is affected
> > <http://hg.mozilla.org/releases/mozilla-release/rev/c4405d7a95f6> is not
>
> This could be explained by the fact that we used to have a bug whereby we
> stayed on the discrete GPU all the time (see [bug 646043](/show_bug.cgi?id=646043 "RESOLVED FIXED - Hardware acceleration seems to require discrete GPU on Macs with two GPUs")) and eventually
> fixed it.
That's true, I didn't pay attention to that.

|  | [Benoit Girard (:BenWa)](/user_profile?user_id=368375) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=737182#c17)• 13 years ago |
|  | |

Comment on [attachment 607910](/attachment.cgi?id=607910 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=607910&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910)
limit max tex size on mac/intel
Review of [attachment 607910](/attachment.cgi?id=607910 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=607910&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910):
-----------------------------------------------------------------
::: gfx/gl/GLContext.h
@@ +1691,5 @@
> + // max texture size that they report. So we check ourselves against our own values
> + // (mMax[CubeMap]TextureSize) which we tweak as needed.
> + GLsizei maxSize = target == LOCAL\_GL\_TEXTURE\_2D
> + ? mMaxTextureSize
> + : mMaxCubeMapTextureSize;
Why do we want to use MaxCubeMapTextureSize for non GL\_TEXTURE\_2D target? I know for example on mobile we want to use the external image target and I don't think it has any relationship with CubeMaps.
@@ +2399,5 @@
> AFTER\_GL\_CALL;
> }
>
> void fTexImage2D(GLenum target, GLint level, GLint internalformat, GLsizei width, GLsizei height, GLint border, GLenum format, GLenum type, const GLvoid \*pixels) {
> + HandleIllegalTextureSizes(target, &width, &height);
This will return w=-1,h=-1. Do we know for sure that glTexImage2D and the likes will handle this? I don't like relaying on drivers for error checking. If so I'd like to see a comment explaining why we know it's safe.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=737182#c18)• 13 years ago |
|  | |

(In reply to Benoit Girard (:BenWa) from [comment #17](/show_bug.cgi?id=737182#c17 "VERIFIED FIXED - 2D texture corruption on Mac/Intel with large texture sizes >= 4993"))
> Comment on [attachment 607910](/attachment.cgi?id=607910 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=607910&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910)
> limit max tex size on mac/intel
>
> Review of [attachment 607910](/attachment.cgi?id=607910 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=607910&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910):
> -----------------------------------------------------------------
>
> ::: gfx/gl/GLContext.h
> @@ +1691,5 @@
> > + // max texture size that they report. So we check ourselves against our own values
> > + // (mMax[CubeMap]TextureSize) which we tweak as needed.
> > + GLsizei maxSize = target == LOCAL\_GL\_TEXTURE\_2D
> > + ? mMaxTextureSize
> > + : mMaxCubeMapTextureSize;
>
> Why do we want to use MaxCubeMapTextureSize for non GL\_TEXTURE\_2D target? I
> know for example on mobile we want to use the external image target and I
> don't think it has any relationship with CubeMaps.
Oh. I didn't know of other texture targets than 2D and Cube Maps. Are you referring to some extension that we are using somewhere? Link needed.
>
> @@ +2399,5 @@
> > AFTER\_GL\_CALL;
> > }
> >
> > void fTexImage2D(GLenum target, GLint level, GLint internalformat, GLsizei width, GLsizei height, GLint border, GLenum format, GLenum type, const GLvoid \*pixels) {
> > + HandleIllegalTextureSizes(target, &width, &height);
>
> This will return w=-1,h=-1. Do we know for sure that glTexImage2D and the
> likes will handle this? I don't like relaying on drivers for error checking.
> If so I'd like to see a comment explaining why we know it's safe.
True. I was just thinking that we've never seen a driver bug whereby texImage2D would fail to generate INVALID\_VALUE on -1 sizes, but OK. So, if we don't want to rely on the driver to generate INVALID\_VALUE for us, we have to implement our own GL error system, like we do in the WebGL impl. The patch is going to be a lot more intrusive. Do you prefer that still?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=737182#c19)• 13 years ago |
|  | |

Alternative approach: to further increase the likelihood that the GL impl will generate INVALID\_VALUE on our texImage2D call, we could set level to -1.

|  | [Benoit Girard (:BenWa)](/user_profile?user_id=368375) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=737182#c20)• 13 years ago |
|  | |

I was thinking of just having an early return (We could use a macro maybe). I know that we could use GL\_TEXTURE\_RECTANGLE, the other target isn't used for glTexImage2D but is used for others calls like glBind.
<http://www.khronos.org/registry/gles/extensions/OES/OES_EGL_image_external.txt>
I don't want to implement our own GL error system. If your sure we will get INVALID\_VALUE everywhere just add a comment to explain that we rely on this behavior.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=737182#c21)• 13 years ago |
|  | |

If we just early-return without somehow generating INVALID\_VALUE, we break the GL spec and we'll be scratching our heads some time down the road about strange bugs ("why is this texture not correctly uploaded?").
I'd much rather keep GLContext compliant with the GL spec as much as possible.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a178948_1689)• 13 years ago |

Whiteboard: [sg:high] → [sg:vector-high]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=737182#c22)• 13 years ago |
|  | |

I don't understand why this would be only vector-high and not high. This bug directly, by itself, allows an attacker to read random video memory.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=737182#c23)• 13 years ago |
|  | |

Is it vector-high only because this is a bug in the Mac/Intel driver that's exposed by Firefox, not a bug in Firefox itself?

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=737182#c24)• 13 years ago |
|  | |

Comment on [attachment 607910](/attachment.cgi?id=607910 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=607910&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910)
limit max tex size on mac/intel
Review of [attachment 607910](/attachment.cgi?id=607910 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=607910&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=607910):
-----------------------------------------------------------------
I take Benoit's review comments and adopt them as my own!
[Attachment #607910](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") -
Flags: review?(joe) → review-

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=737182#c25)• 13 years ago |
|  | |

Comment on [attachment 607912](/attachment.cgi?id=607912 "drop WebGL cube map workaround") [[details]](/attachment.cgi?id=607912&action=edit "drop WebGL cube map workaround")
drop WebGL cube map workaround
Dropping review until the issues with the other patch are sorted out.
[Attachment #607912](/attachment.cgi?id=607912&action=edit "drop WebGL cube map workaround") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=737182#c26)• 13 years ago |
|  | |

Attached patch

[limit max tex size on mac/intel](attachment.cgi?id=609188&action=diff) (obsolete)
— [Details](attachment.cgi?id=609188&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609188)

How about this approach instead. The helper becomes IsTextureSizeLegalForTarget() returning bool; it checks for cube map targets and assumes that anything else behaves like TEXTURE\_2D, which is probably safer; and in case of an illegal size, it now also passes -1 for |level| and for |border|, maximizing chances to get an INVALID\_VALUE (there are now 4 different invalid values passed to these GL functions, so the GL would have to be really wrong to fail to generate INVALID\_VALUE). Also, |null| is passed for the texture data pointer so that in the worst case, we'd be derefing null instead of an arbitrary pointer.
If you don't like that, here are the other possibilities, choose one:
1. we use a different GL function to artificially generate a INVALID\_VALUE. Downside: APItraces will look very, very mysterious ("wtf does glCopyTexImage2D call glSomeUnrelatedFunc??")
2. we implement our own GL error system cooperating with the native GL error system. There is all the code for that in the WebGL impl. Downside: more intrusive change, won't get beta approval.
3. we fail silently without generating an error. Downside: we break the GL spec, will cause headaches.
[Attachment #607910](/attachment.cgi?id=607910&action=edit "limit max tex size on mac/intel") -
Attachment is obsolete: true
[Attachment #609188](/attachment.cgi?id=609188&action=edit "limit max tex size on mac/intel") -
Flags: review?(bgirard)

|  | [Benoit Girard (:BenWa)](/user_profile?user_id=368375) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=737182#c27)• 13 years ago |
|  | |

Comment on [attachment 609188](/attachment.cgi?id=609188 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=609188&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=609188&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609188)
limit max tex size on mac/intel
Review of [attachment 609188](/attachment.cgi?id=609188 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=609188&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=609188&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609188):
-----------------------------------------------------------------
Looks good, minot comment nit.
::: gfx/gl/GLContext.cpp
@@ +446,5 @@
> + if (mVendor == VendorIntel) {
> + // see [bug 737182](/show_bug.cgi?id=737182 "VERIFIED FIXED - 2D texture corruption on Mac/Intel with large texture sizes >= 4993") for 2D textures, [bug 684822](/show_bug.cgi?id=684822 "RESOLVED WORKSFORME - Google Videos search is not working as expected") for cube map textures.
> + mMaxTextureSize = NS\_MIN(mMaxTextureSize, 4096);
> + mMaxCubeMapTextureSize = NS\_MIN(mMaxCubeMapTextureSize, 512);
> + // for good measure, we align renderbuffers on what we do for 2D textures
The grammar seems off to me. How about:
For good measure we do the same for renderbuffers.
::: gfx/gl/GLContext.h
@@ +2405,5 @@
> }
>
> void fTexImage2D(GLenum target, GLint level, GLint internalformat, GLsizei width, GLsizei height, GLint border, GLenum format, GLenum type, const GLvoid \*pixels) {
> BEFORE\_GL\_CALL;
> + if (IsTextureSizeLegalForTarget(target, width, height)) {
If we cared about performance we could add the check only for Intel by setting fTexImage2D to a wrapper function. But we shouldn't be calling these often.
[Attachment #609188](/attachment.cgi?id=609188&action=edit "limit max tex size on mac/intel") -
Flags: review?(bgirard) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=737182#c28)• 13 years ago |
|  | |

Regarding the performance comment: maybe we can rename IsTextureSizeLegalForTarget to something slightly different and have it do the platform check.
I am not worried about texImage2D which is very expensive anyway, but it is indeed not great to add overhead to copyTexImage2D as a matter of principle (in practice, this is still negligible overhead).

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=737182#c29)• 13 years ago |
|  | |

Attached patch

[limit max tex size on mac/intel](attachment.cgi?id=609343&action=diff)
— [Details](attachment.cgi?id=609343&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609343)

How about this, for performance?
[Attachment #609188](/attachment.cgi?id=609188&action=edit "limit max tex size on mac/intel") -
Attachment is obsolete: true
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: review?(bgirard)

|  | [Benoit Girard (:BenWa)](/user_profile?user_id=368375) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=737182#c30)• 13 years ago |
|  | |

Comment on [attachment 609343](/attachment.cgi?id=609343 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=609343&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609343)
limit max tex size on mac/intel
LGTM
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: review?(bgirard) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a587864_382769)• 13 years ago |

[Attachment #607912](/attachment.cgi?id=607912&action=edit "drop WebGL cube map workaround") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=737182#c31)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/7474b9e08e0d>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a588181_382769)• 13 years ago |

Target Milestone: --- → mozilla14

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=737182#c32)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/7474b9e08e0d>Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a834129_309398)• 13 years ago |

[Attachment #607912](/attachment.cgi?id=607912&action=edit "drop WebGL cube map workaround") -
Flags: review?(jmuizelaar) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=737182#c33)• 13 years ago |
|  | |

Comment on [attachment 609343](/attachment.cgi?id=609343 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=609343&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609343)
limit max tex size on mac/intel
[Approval Request Comment]
Regression caused by (bug #): ever since we enabled GL layers and WebGL on Mac (pre-Firefox 4)
User impact if declined: video memory leakage (information exposure) vulnerability on Mac. Exploitable just by creating a 2d canvas of size 5kx5k, or an image of that size, or a WebGL texture of that size.
Testing completed (on m-c, etc.): Been on m-c for a few days
Risk to taking this patch (and alternatives if risky): seems low risk. At worst (if we were crazy unlucky) it could expose a different driver bug.
String changes made by this patch: none
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-beta?
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=737182#c34)• 13 years ago |
|  | |

Comment on [attachment 609343](/attachment.cgi?id=609343 "limit max tex size on mac/intel") [[details]](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") [[diff]](/attachment.cgi?id=609343&action=diff "limit max tex size on mac/intel") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737182&attachment=609343)
limit max tex size on mac/intel
[Triage Comment]
We'll be on the lookout for driver regressions after this lands - approving for Aurora 13 and Beta 12.
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-beta?
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-beta+
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-aurora?
[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-aurora+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=737182#c35)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/3674e711982a>
<http://hg.mozilla.org/releases/mozilla-beta/rev/f80a1c880b7a>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=737182#c36)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/bd9c99b055ab>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=737182#c37)• 13 years ago |
|  | |

(In reply to Benoit Jacob [:bjacob] from [comment #36](/show_bug.cgi?id=737182#c36 "VERIFIED FIXED - 2D texture corruption on Mac/Intel with large texture sizes >= 4993"))
> <http://hg.mozilla.org/integration/mozilla-inbound/rev/bd9c99b055ab>
<https://hg.mozilla.org/mozilla-central/rev/bd9c99b055ab>

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a1216688_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=737182#c38)• 13 years ago |
|  | |

[Triage Comment]
Now that there's been some bake time on aurora/beta please go ahead and nominate for ESR landing as per <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a1882741_382769)• 13 years ago |

[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-esr10?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a1996440_272375)• 13 years ago |

[Attachment #609343](/attachment.cgi?id=609343&action=edit "limit max tex size on mac/intel") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a2083471_1689)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=737182#c39)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-esr10/rev/d35ae8519966>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a2393748_279076)• 13 years ago |

Whiteboard: [sg:vector-high] → [sg:vector-high][qa+]

|  | [Huzaifa Sidhpurwala](/user_profile?user_id=331752) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=737182#c40)• 13 years ago |
|  | |

Does this issue have a CVE id?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=737182#c41)• 13 years ago |
|  | |

Notice that this bug is completely Mac-specific (seeing your redhat email address ;-) )

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=737182#c42)• 13 years ago |
|  | |

Verified with Fx 12 beta6Status: RESOLVED → VERIFIED

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a3025942_18566)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)Whiteboard: [sg:vector-high][qa+] → [sg:vector-high]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=737182#c43)• 13 years ago |
|  | |

Can we unhide this bug now? It's fixed in Release and in ESR.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=737182#c44)• 13 years ago |
|  | |

What's the status of the underlying driver bug? Will we be exposing users of other applications?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=737182#c45)• 13 years ago |
|  | |

See my reply in [bug 684882 comment 92](/show_bug.cgi?id=684882#c92 "VERIFIED FIXED - Random video memory grabbed into WebGL cube map textures on Mac OS, including on 10.7.1, on Intel GPUs") as this is very similar.
Yes, other applications are affected, all the more since this bug is about 2D textures which are used by all the applications that use OpenGL to accelerate any kind of graphics. However, this has been known publicly for a while as a google search suggests:
<https://www.google.ca/search?q=mac+texture+corruption>
The discussions returned by this search don't have as specific information as we discussed in this bug though, but I don't think that our conclusion here, "2D texture uploads are garbage above a certain critical size that is roughly 5000", is particularly hard to arrive to.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=737182#c46)• 13 years ago |
|  | |

Tracy, can you please take a moment to verify this fixed with Firefox 14 and the latest ESR nightly? Thanks.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a9917177_1689)• 13 years ago |

Group: core-security

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a9924588_18566)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)

|  | [Biru [:poiru]](/user_profile?user_id=473193) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737182#a161984582_473193)• 8 years ago |

Blocks: [1310222](/show_bug.cgi?id=1310222 "RESOLVED FIXED - MAX_TEXTURE_SIZE on Firefox is much smaller than Chrome")
You need to [log in](/show_bug.cgi?id=737182&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Hilary Hall [:hillzy]](/user_profile?user_id=386341)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.debian.org_68319d56_20250125_084143.html ===


---

[[Date Prev](msg00087.html)][[Date Next](msg00089.html)]
[[Thread Prev](msg00087.html)][[Thread Next](msg00089.html)]
[[Date Index](maillist.html#00088)]
[[Thread Index](threads.html#00088)]

# [SECURITY] [DSA 2457-1] iceweasel security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 2457-1] iceweasel security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Tue, 24 Apr 2012 22:35:21 +0200
* *Message-id*: <[[🔎]](/msgid-search/20120424203520.GA5157%40pisco.westfalen.local) [20120424203520.GA5157@pisco.westfalen.local](msg00088.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- -------------------------------------------------------------------------
Debian Security Advisory DSA-2457-1                   security@debian.org
<http://www.debian.org/security/>                        Moritz Muehlenhoff
April 24, 2012                         <http://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : iceweasel
Vulnerability  : several
Problem type   : remote
Debian-specific: no
CVE ID         : CVE-2012-0467 CVE-2012-0470 CVE-2012-0471 CVE-2012-0477
                 CVE-2012-0479

Several vulnerabilities have been discovered in Iceweasel, a web
browser based on Firefox. The included XULRunner library provides
rendering services for several other applications included in Debian.

CVE-2012-0467

   Bob Clary, Christian Holler, Brian Hackett, Bobby Holley, Gary
   Kwong, Hilary Hall, Honza Bambas, Jesse Ruderman, Julian Seward,
   and Olli Pettay discovered memory corruption bugs, which may lead
   to the execution of arbitrary code.

CVE-2012-0470

   Atte Kettunen discovered that a memory corruption bug in
   gfxImageSurface may lead to the execution of arbitrary code.

CVE-2012-0471

   Anne van Kesteren discovered that incorrect multibyte octet
   decoding may lead to cross-site scripting.

CVE-2012-0477

   Masato Kinugawa discovered that incorrect encoding of
   Korean and Chinese character sets may lead to cross-site scripting.

CVE-2012-0479

   Jeroen van der Gun discovered a spoofing vulnerability in the
   presentation of Atom and RSS feeds over HTTPS.

For the stable distribution (squeeze), this problem has been fixed in
version 3.5.16-14.

For the unstable distribution (sid), this problem has been fixed in
version 10.0.4esr-1.

For the experimental distribution, this problem will be fixed soon.

We recommend that you upgrade your iceweasel packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <http://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAk+XDkoACgkQXm3vHE4uylqfngCaAt6fHj+dr/zvoi0c4J3skHfR
ftcAoLCxfj+mh6m0Uv0lJ734BoVYAYmd
=m0na
-----END PGP SIGNATURE-----

```

---



=== Content from secunia.com_b4e223ef_20250125_084142.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from blog.mozilla.org_0753cb36_20250126_073606.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from www.debian.org_a9920227_20250125_084144.html ===


---

[[Date Prev](msg00095.html)][[Date Next](msg00097.html)]
[[Thread Prev](msg00095.html)][[Thread Next](msg00097.html)]
[[Date Index](maillist.html#00096)]
[[Thread Index](threads.html#00096)]

# [SECURITY] [DSA 2464-1] icedove security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 2464-1] icedove security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Thu, 3 May 2012 17:45:46 +0200
* *Message-id*: <[[🔎]](/msgid-search/20120503154546.GA3675%40pisco.westfalen.local) [20120503154546.GA3675@pisco.westfalen.local](msg00096.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- -------------------------------------------------------------------------
Debian Security Advisory DSA-2464-1                   security@debian.org
<http://www.debian.org/security/>                        Moritz Muehlenhoff
May 02, 2012                           <http://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : icedove
Vulnerability  : several
Problem type   : remote
Debian-specific: no
CVE ID         : CVE-2012-0467 CVE-2012-0470 CVE-2012-0471 CVE-2012-0477
                 CVE-2012-0479

Several vulnerabilities have been discovered in Icedove, an unbranded
version of the Thunderbird mail/news client.

CVE-2012-0467

   Bob Clary, Christian Holler, Brian Hackett, Bobby Holley, Gary
   Kwong, Hilary Hall, Honza Bambas, Jesse Ruderman, Julian Seward,
   and Olli Pettay discovered memory corruption bugs, which may lead
   to the execution of arbitrary code.

CVE-2012-0470

   Atte Kettunen discovered that a memory corruption bug in
   gfxImageSurface may lead to the execution of arbitrary code.

CVE-2012-0471

   Anne van Kesteren discovered that incorrect multibyte octet
   decoding may lead to cross-site scripting.

CVE-2012-0477

   Masato Kinugawa discovered that incorrect encoding of
   Korean and Chinese character sets may lead to cross-site scripting.

CVE-2012-0479

   Jeroen van der Gun discovered a spoofing vulnerability in the
   presentation of Atom and RSS feeds over HTTPS.

For the stable distribution (squeeze), this problem has been fixed in
version 3.0.11-1+squeeze9.

For the unstable distribution (sid), this problem will be fixed soon.

We recommend that you upgrade your icedove packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <http://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAk+hWBsACgkQXm3vHE4uylpUpgCePI+7qkAjfvp/Ml8PKfatTwDL
ih4AmQFWRb0ykHkec0yI5AgH0V54TfVS
=tNcW
-----END PGP SIGNATURE-----

```

---



=== Content from www.mozilla.org_f2c6fe30_20250125_084148.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2012-20

## Miscellaneous memory safety hazards (rv:12.0/ rv:10.0.4)

Announced
April 24, 2012
Impact
Critical
Products
Firefox, Firefox ESR, SeaMonkey, Thunderbird, Thunderbird ESR
Fixed in

* Firefox 12
* Firefox ESR 10.0.4
* SeaMonkey 2.9
* Thunderbird 12
* Thunderbird ESR 10.0.4

### Description

Mozilla developers identified and fixed several memory safety bugs
in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption
under certain circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the Thunderbird
and SeaMonkey products because scripting is disabled, but are potentially a risk
in browser or browser-like contexts in those products.

### References

Christian Holler a reported memory safety and security problem affecting
Firefox 11.

* [Assertion failure: (ptrBits & 0x7) == 0, at ../../jsval.h:873 or Crash [@
  compartment] or [@ js::array\_shift]](https://bugzilla.mozilla.org/show_bug.cgi?id=714616)
* [CVE-2012-0468](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0468)

Bob Clary, Christian Holler, Brian Hackett, Bobby Holley, Gary Kwong, Hilary
Hall, Honza Bambas, Jesse Ruderman, Julian Seward, and Olli Pettay reported
memory safety problems and crashes that affect Firefox ESR and
Firefox 11.

* [Memory safety bugs fixed in Firefox 12 and Firefox ESR 10.0.4](https://bugzilla.mozilla.org/buglist.cgi?bug_id=706381,733282,737129,737875,714614,732941,732951,733979,737384,737875,680456,735073,736609,740595,737182,716556,708825,720305,735943,736589,723453,726332,726502)
* [CVE-2012-0467](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0467)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_7a0932c6_20250125_084159.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/726332)
* [XML](/show_bug.cgi?ctype=xml&id=726332)

Closed
[Bug 726332](/show_bug.cgi?id=726332)

Opened 13 years ago
Closed 13 years ago

# nsFormFillController's MutationObserver handling is suspicious

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsFormFillController's MutationObserver handling is suspicious

## Categories

### (Toolkit :: Autocomplete, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Autocomplete#Autocomplete)

Autocomplete
▾

Toolkit :: Autocomplete
Auto-completing text entry widget.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Autocomplete&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Autocomplete&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Autocomplete)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

12 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: smaug, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical][qa-] fixed in 726334, 730470)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-] fixed in 726334, 730470

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [patch for bug 726334 updated for esr10](/attachment.cgi?id=615035)  [13 years ago](#c10)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   15.16 KB, patch |  | [Details](/attachment.cgi?id=615035&action=edit) | [Diff](/attachment.cgi?id=615035&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615035) |
| --- | --- | --- |
| [patch for bug Bug 730470 updated for esr10](/attachment.cgi?id=615039)  [13 years ago](#c11)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   5.12 KB, patch |  | [Details](/attachment.cgi?id=615039&action=edit) | [Diff](/attachment.cgi?id=615039&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615039) |
| [both](/attachment.cgi?id=615040)  [13 years ago](#c12)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   15.58 KB, patch | Gavin : [review+](#a5624274_103593 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c15 "13 years ago") | [Details](/attachment.cgi?id=615040&action=edit) | [Diff](/attachment.cgi?id=615040&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615040) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=726332#c0)• 13 years ago |
|  | |

nsFormFillController uses MutationObserver for input.list, but nothing,
if I read the code correctly, enforces that MutationObserver is actually removed.
Everything works usually ok, but if list element gets moved to some other document
and modified there, there could be some sg:crit crashes, I think.

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=726332#c1)• 13 years ago |
|  | |

nsFormFillController::StopControllingInput (called on blur and pagehide of the input) seems to call RemoveMutationObserver(). Is that not sufficient?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=726332#c2)• 13 years ago |
|  | |

That doesn't help at all. The element input.list returns may not be there anymore.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=726332#c3)• 13 years ago |
|  | |

This will be fixed as a part of [Bug 726334](/show_bug.cgi?id=726334 "RESOLVED FIXED - nsFormFillController::mFocusedInput can keep nodes alive longer than needed").

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=726332#c4)• 13 years ago |
|  | |

The patch in [bug 726334](/show_bug.cgi?id=726334 "RESOLVED FIXED - nsFormFillController::mFocusedInput can keep nodes alive longer than needed") guarantees that a deleted formfillcontroller is never a mutationobserver
of a live dom node.Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=726332#c5)• 13 years ago |
|  | |

Marking sg:critical assuming [comment 0](/show_bug.cgi?id=726332#c0 "RESOLVED FIXED - nsFormFillController's MutationObserver handling is suspicious") meant web content could do that. And if that's the case we probably need to land [bug 726334](/show_bug.cgi?id=726334 "RESOLVED FIXED - nsFormFillController::mFocusedInput can keep nodes alive longer than needed") and [bug 730470](/show_bug.cgi?id=730470 "RESOLVED FIXED - crash in nsFormFillController::RemoveForDocumentEnumerator @ nsINode::OwnerDoc") on ESR10.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)Whiteboard: [sg:critical] fixed in 726334, 730470

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=726332#c6)• 13 years ago |
|  | |

Some more testing would be great, but I'll prepare patches for ESR10

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726332#a4417320_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=726332#c7)• 13 years ago |
|  | |

What can QA do to verify this fix?Whiteboard: [sg:critical] fixed in 726334, 730470 → [sg:critical][qa?] fixed in 726334, 730470

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=726332#c8)• 13 years ago |
|  | |

Unfortunately there isn't any testcase for this.
One could create one if needed: the test case would first have input.list set, and then
remove the element to which input.list points to.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726332#a4671418_279076)• 13 years ago |

Whiteboard: [sg:critical][qa?] fixed in 726334, 730470 → [sg:critical][qa-] fixed in 726334, 730470

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=726332#c9)• 13 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #6](/show_bug.cgi?id=726332#c6 "RESOLVED FIXED - nsFormFillController's MutationObserver handling is suspicious"))
> Some more testing would be great, but I'll prepare patches for ESR10
Hey Olli, how are the patches coming for ESR? It would be great to get some approvals/landings for this soon.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=726332#c10)• 13 years ago |
|  | |

Attached patch

[patch for bug 726334 updated for esr10](attachment.cgi?id=615035&action=diff)
— [Details](attachment.cgi?id=615035&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615035)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=726332#c11)• 13 years ago |
|  | |

Attached patch

[patch for bug Bug 730470 updated for esr10](attachment.cgi?id=615039&action=diff)
— [Details](attachment.cgi?id=615039&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615039)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=726332#c12)• 13 years ago |
|  | |

Attached patch

[both](attachment.cgi?id=615040&action=diff)
— [Details](attachment.cgi?id=615040&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615040)

Both patches needed just some minor merging.Assignee: nobody → bugs
[Attachment #615040](/attachment.cgi?id=615040&action=edit "both") -
Flags: review?
[Attachment #615040](/attachment.cgi?id=615040&action=edit "both") -
Flags: approval-mozilla-esr10?

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=726332#c13)• 13 years ago |
|  | |

Should this bug have a specific reviewer or is it meant to dangle in the wind? Mounir, perhaps?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=726332#c14)• 13 years ago |
|  | |

Comment on [attachment 615040](/attachment.cgi?id=615040 "both") [[details]](/attachment.cgi?id=615040&action=edit "both") [[diff]](/attachment.cgi?id=615040&action=diff "both") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615040)
both
Oops, I thought I had asked gavin to review this.
[Attachment #615040](/attachment.cgi?id=615040&action=edit "both") -
Flags: review? → review?(gavin.sharp)

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726332#a5624274_103593)• 13 years ago |

[Attachment #615040](/attachment.cgi?id=615040&action=edit "both") -
Flags: review?(gavin.sharp) → review+

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=726332#c15)• 13 years ago |
|  | |

Comment on [attachment 615040](/attachment.cgi?id=615040 "both") [[details]](/attachment.cgi?id=615040&action=edit "both") [[diff]](/attachment.cgi?id=615040&action=diff "both") [[review]](/page.cgi?id=splinter.html&ignore=&bug=726332&attachment=615040)
both
Approved to land, as per <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>
[Attachment #615040](/attachment.cgi?id=615040&action=edit "both") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=726332#c16)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/ddec781cfc63>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=726332#a8384641_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=726332&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_931a6cb2_20250125_084153.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/714614)
* [XML](/show_bug.cgi?ctype=xml&id=714614)

Closed
[Bug 714614](/show_bug.cgi?id=714614)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: self->nativeContains(cx, \*aprop), at jsscope.cpp:1000

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: self->nativeContains(cx, \*aprop), at jsscope.cpp:1000

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla13

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 |  | wontfix |
| firefox10 | - | wontfix |
| firefox11 | - | wontfix |
| firefox12 | + | verified |
| firefox13 | + | verified |
| firefox-esr10 | 12+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: dmandelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a86fae4b06c1570a6c1a1bc1c5a6c1f6?d=mm&size=40)  [dmandelin](/user_profile?user_id=294323)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c29 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 2 obsolete files)

| [qnd fix](/attachment.cgi?id=592306)  [13 years ago](#c6)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   6.40 KB, patch | luke : [review+](#c7 "13 years ago") | [Details](/attachment.cgi?id=592306&action=edit) | [Diff](/attachment.cgi?id=592306&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=592306) |
| --- | --- | --- |
| [WIP](/attachment.cgi?id=592963)  [13 years ago](#c14)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   7.83 KB, patch |  | [Details](/attachment.cgi?id=592963&action=edit) | [Diff](/attachment.cgi?id=592963&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=592963) |
| [Patch](/attachment.cgi?id=594860)  [13 years ago](#c15)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   9.69 KB, patch | bhackett1024 : [review+](#c16 "13 years ago")  akeybl : [approval-mozilla-beta+](#c21 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c21 "13 years ago") | [Details](/attachment.cgi?id=594860&action=edit) | [Diff](/attachment.cgi?id=594860&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=594860) |
| [Patch for ESR10](/attachment.cgi?id=612058)  [13 years ago](#c25)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   6.63 KB, patch | bhackett1024 : [feedback+](#a8037817_346231 "13 years ago") | [Details](/attachment.cgi?id=612058&action=edit) | [Diff](/attachment.cgi?id=612058&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=612058) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=714614#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision d98fbf3cbd71 (options -m -a -n):
function testForVarInWith(foo, foo) {
return eval("with ({}) { for (var x = 0; x < 5; x++); } (function() { return delete x; })");
}
f = testForVarInWith()();

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=714614#c1)• 13 years ago |
|  | |

The duplicate parameter names end up causing bindings and call objects to be created with multiple shapes with the same id, which is a pretty big object layout invariant violation (and one which existed before objshrink). This doesn't fail with a pre-objshrink tree, but that is only because the 'delete x' converts the call object to a dictionary instead of unwinding the scope (necessary because the object flags are different between the last and previous properties).
s-s because I don't know how far back this goes, and accesses on the call objects could behave incorrectly and break e.g. TI information.Group: core-security

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a129929_294323)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=714614#c2)• 13 years ago |
|  | |

Dave, can you assign this appropriately?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=714614#c3)• 13 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 81298:33962bb21403
user: Brian Hackett
date: Tue Nov 08 16:56:00 2011 -0800
summary: Set DELEGATE for parents of other objects, [bug 700300](/show_bug.cgi?id=700300 "RESOLVED FIXED - [ObjShrink]: Assertion failure: pobj == found, at jsinterp.cpp:1456").Blocks: [700300](/show_bug.cgi?id=700300 "RESOLVED FIXED - [ObjShrink]: Assertion failure: pobj == found, at jsinterp.cpp:1456")
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → ---
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → ---
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → ---
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) → ---
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → ---
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → ---
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) → ---
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) → ---

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=714614#c4)• 13 years ago |
|  | |

(In reply to Gary Kwong [:gkw, :nth10sd] from [comment #3](/show_bug.cgi?id=714614#c3 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000"))
> autoBisect shows this is probably related to the following changeset:
No, this isn't, see [comment 1](/show_bug.cgi?id=714614#c1 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000").

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a288340_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a317815_11608)• 13 years ago |

No longer blocks: [700300](/show_bug.cgi?id=700300 "RESOLVED FIXED - [ObjShrink]: Assertion failure: pobj == found, at jsinterp.cpp:1456")

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=714614#c5)• 13 years ago |
|  | |

This won't be fixed in time for 10.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a2102537_1689)• 13 years ago |

Assignee: general → dmandelin

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=714614#c6)• 13 years ago |
|  | |

Attached patch

[qnd fix](attachment.cgi?id=592306&action=diff) (obsolete)
— [Details](attachment.cgi?id=592306&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=592306)

Quick and dirty fix.
The problem is that the bindings object gets two properties with the same name, which is sketchy but probably OK in itself--but that causes the Call objects to get two properties with the same name, which is bad. The real fix (which is planned for some point in the future) is to use a special name mapping object for bindings and call objects.
To close the vulnerability for now, this fix instead just doesn't create a duplicate-named property in the bindings object. For the most part, that just works, except (yay) the decompiler, which uses the bindings to print the parameters. For now, we just flag the object as having holes, and fill in the parameter names with fake values in the decompiler.
If that turns out not to be good enough, we could store a list of duplicate names on the side, but that bloats scripts by a word and would be generally a pain, which doesn't seem worth it for such an obscure use case (recompilation of string representations of functions with duplicate parameter names).
[Attachment #592306](/attachment.cgi?id=592306&action=edit "qnd fix") -
Flags: review?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=714614#c7)• 13 years ago |
|  | |

Comment on [attachment 592306](/attachment.cgi?id=592306 "qnd fix") [[details]](/attachment.cgi?id=592306&action=edit "qnd fix") [[diff]](/attachment.cgi?id=592306&action=diff "qnd fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=592306)
qnd fix
>+ \* Hack: see comment in Bindings::hasHoles.
This can be a single-line comment
>+ if (hasHoles) {
>+ AutoKeepAtoms keep(cx->runtime);
>+ const char \*dupchars = "<duplicate name>";
>+ JSAtom \*dup = js\_Atomize(cx, dupchars, strlen(dupchars));
>+ if (!dup)
>+ return false;
>+ for (unsigned i = 0; i < n; i++)
>+ names[i] = dup;
>+ }
I don't think AutoKeepAtoms is necessary, since there is only once GC allocation in its scope. Second, I don't think its sufficient since the atom is used after we leave the scope of 'keep'. Instead, why don't you just pass js::InternAtom to js\_Atomize, effectively rooting the atom for life.
[Attachment #592306](/attachment.cgi?id=592306&action=edit "qnd fix") -
Flags: review?(luke) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=714614#c8)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/602d30678cac>Target Milestone: --- → mozilla12

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=714614#c9)• 13 years ago |
|  | |

That patch got backed out. It hit some failures in JSD tests that want to get the duplicate parameter names back from the decompiler, for which we could just change the tests, but there's a more serious problem:
function f(x,x) { "use strict" };
That's a syntax error, and the error message should be able to give us the name of the duplicate parameter. In order for that to work, we do need to record full information about the duplicate parameters in some form or another inside Bindings, and we have to do it even if we don't know the function is in strict mode while parsing arguments.
One idea would be to have two shapes in the binding: one that has duplicate parameters for decompilation and strict mode checking and another that omits them for creating Call objects. But it seems wasteful to create an entire extra copy of the shapes all the time given that duplicate parameters should be rare.
The other idea I had earlier (but didn't want to bother with) was to have an optional array of information about duplicates. So the shapes would omit duplicates, but there would be an optional array on the side saying which parameters are duplicates of which other parameters, and that could be used by duplicates and the strict mode checks.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=714614#c10)• 13 years ago |
|  | |

It might work to tolerate the duplicates just in the script's bindings, but when creating call objects make sure that duplicates are filtered out and the resulting object has a valid no-duplicate shape lineage. JSScript can just have a bit indicating whether there are any duplicate names in the bindings, and if this bit is found then call object creation takes a slow path.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=714614#c11)• 13 years ago |
|  | |

(In reply to Brian Hackett (:bhackett) from [comment #10](/show_bug.cgi?id=714614#c10 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000"))
> It might work to tolerate the duplicates just in the script's bindings, but
> when creating call objects make sure that duplicates are filtered out and
> the resulting object has a valid no-duplicate shape lineage. JSScript can
> just have a bit indicating whether there are any duplicate names in the
> bindings, and if this bit is found then call object creation takes a slow
> path.
Yes, I think that's good, I was just thinking the same thing while waking up. It even allows the decompiler to work correctly as long as no call objects have been created yet. Wheee...

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=714614#c12)• 13 years ago |
|  | |

(In reply to David Mandelin from [comment #11](/show_bug.cgi?id=714614#c11 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000"))
> (In reply to Brian Hackett (:bhackett) from [comment #10](/show_bug.cgi?id=714614#c10 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000"))
> > It might work to tolerate the duplicates just in the script's bindings, but
> > when creating call objects make sure that duplicates are filtered out and
> > the resulting object has a valid no-duplicate shape lineage. JSScript can
> > just have a bit indicating whether there are any duplicate names in the
> > bindings, and if this bit is found then call object creation takes a slow
> > path.
>
> Yes, I think that's good, I was just thinking the same thing while waking
> up. It even allows the decompiler to work correctly as long as no call
> objects have been created yet. Wheee...
Or I guess you probably meant the slow path creates the call object without the dups while still keeping the dups within the binding, so the decompiler always works correctly. So I think that's correct always, and the only cost is that creating call objects is slow if there are dup arguments, which should not matter at all.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=714614#c13)• 13 years ago |
|  | |

(In reply to David Mandelin from [comment #12](/show_bug.cgi?id=714614#c12 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000"))
> Or I guess you probably meant the slow path creates the call object without
> the dups while still keeping the dups within the binding, so the decompiler
> always works correctly. So I think that's correct always, and the only cost
> is that creating call objects is slow if there are dup arguments, which
> should not matter at all.
Yeah, the bindings should keep any duplicate names after any no-duplicate call objects have been created.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=714614#c14)• 13 years ago |
|  | |

Attached patch

[WIP](attachment.cgi?id=592963&action=diff) (obsolete)
— [Details](attachment.cgi?id=592963&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=592963)

Doesn't work yet--crashes in getChildBinding probably due to using it wrong or something. Also I'm not actually eliminating the duplicates yet but that should be easy once the "manual" shape construction actually works.
[Attachment #592306](/attachment.cgi?id=592306&action=edit "qnd fix") -
Attachment is obsolete: true

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=714614#c15)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=594860&action=diff)
— [Details](attachment.cgi?id=594860&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=594860)

[Attachment #592963](/attachment.cgi?id=592963&action=edit "WIP") -
Attachment is obsolete: true
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: review?(bhackett1024)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=714614#c16)• 13 years ago |
|  | |

Comment on [attachment 594860](/attachment.cgi?id=594860 "Patch") [[details]](/attachment.cgi?id=594860&action=edit "Patch") [[diff]](/attachment.cgi?id=594860&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=594860)
Patch
Review of [attachment 594860](/attachment.cgi?id=594860 "Patch") [[details]](/attachment.cgi?id=594860&action=edit "Patch") [[diff]](/attachment.cgi?id=594860&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=594860):
-----------------------------------------------------------------
::: js/src/jsscript.h
@@ +175,5 @@
> HeapPtr<Shape> lastBinding;
> uint16\_t nargs;
> uint16\_t nvars;
> uint16\_t nupvars;
> + uint16\_t hasDup\_; // nonzero if there are duplicate argument names
This can be a bool hasDup\_:1
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: review?(bhackett1024) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=714614#c17)• 13 years ago |
|  | |

Good idea on the bitfield--thanks.
<http://hg.mozilla.org/integration/mozilla-inbound/rev/2322fe48476e>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=714614#c18)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2322fe48476e>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDTarget Milestone: mozilla12 → mozilla13

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=714614#c19)• 13 years ago |
|  | |

Dave, is this patch good for aurora? If so, please nominate there. What about esr?
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a5214230_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=714614#c20)• 13 years ago |
|  | |

Comment on [attachment 594860](/attachment.cgi?id=594860 "Patch") [[details]](/attachment.cgi?id=594860&action=edit "Patch") [[diff]](/attachment.cgi?id=594860&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=594860)
Patch
[Approval Request Comment]
Regression caused by (bug #): 700300
User impact if declined: leaves a potential security vulnerability in place
Testing completed (on m-c, etc.): running on m-c for 5 weeks
Risk to taking this patch (and alternatives if risky): Low. Mostly it affects processing only if there are duplicate argument names in a function, which is a rare (and not useful to the programmer) case. It's unlikely but possible I got something wrong in the refactoring of the normal cases.
String changes made by this patch: none
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: approval-mozilla-esr10?
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: approval-mozilla-beta?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a6684547_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=714614#c21)• 13 years ago |
|  | |

Comment on [attachment 594860](/attachment.cgi?id=594860 "Patch") [[details]](/attachment.cgi?id=594860&action=edit "Patch") [[diff]](/attachment.cgi?id=594860&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=594860)
Patch
[Triage Comments]
Approved for Beta 12 and the ESR branch given the low risk evaluation of this sg:crit and where we are in the cycle.
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: approval-mozilla-esr10?
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: approval-mozilla-esr10+
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #594860](/attachment.cgi?id=594860&action=edit "Patch") -
Flags: approval-mozilla-beta+

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a6752018_272375)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=714614#c22)• 13 years ago |
|  | |

Landed to beta:
<http://hg.mozilla.org/releases/mozilla-beta/rev/c6c5fbe3eb36>
Patch doesn't apply cleanly to ESR10. The bug is there, but the affected code was refactored significantly between then and now, so the first cut rebase just crashes all over the place in tests. Is it still worth landing to ESR10?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=714614#c23)• 13 years ago |
|  | |

Test committed with fix, marking verified by that.Status: RESOLVED → VERIFIED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=714614#c24)• 13 years ago |
|  | |

(In reply to David Mandelin from [comment #22](/show_bug.cgi?id=714614#c22 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000"))
> Landed to beta:
> <http://hg.mozilla.org/releases/mozilla-beta/rev/c6c5fbe3eb36>
>
> Patch doesn't apply cleanly to ESR10. The bug is there, but the affected
> code was refactored significantly between then and now, so the first cut
> rebase just crashes all over the place in tests. Is it still worth landing
> to ESR10?
We're committed to taking all sg:crit bugs that affect FF10 on the ESR. We should move forward with a new fix.
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=714614#c25)• 13 years ago |
|  | |

Attached patch

[Patch for ESR10](attachment.cgi?id=612058&action=diff)
— [Details](attachment.cgi?id=612058&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=714614&attachment=612058)

For some reason I didn't see akeybl's comment in my bugmail, but oddly enough on the same day I decided I needed to rebase this for a JS source release. With a manual rebase to ESR10, it seems to work fine. Brian, would you mind giving it a quick glance just to see if I made any mistakes? The only thing I really question is this line in jsscript.cpp:
shape = shape->getChild(cx, \*shapes[i], &shape);
[Attachment #612058](/attachment.cgi?id=612058&action=edit "Patch for ESR10") -
Flags: feedback?(bhackett1024)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a8037817_346231)• 13 years ago |

[Attachment #612058](/attachment.cgi?id=612058&action=edit "Patch for ESR10") -
Flags: feedback?(bhackett1024) → feedback+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=714614#c26)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-esr10/rev/dfaa5f24bd4a>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a9085051_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=714614#c27)• 13 years ago |
|  | |

Verified this does not assert using 2012-04-16 latest-mozilla-esr10 js-shell.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a9705527_18566)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=714614#a11861070_1689)• 13 years ago |

Group: core-security

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=714614#c28)• 13 years ago |
|  | |

Ubuntu 11.10 32bit
Verified that the test from [comment #0](/show_bug.cgi?id=714614#c0 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000") doesn't assert on the latest mozilla-beta revision (8072115a9e89)
Marking verified for Firefox 13.
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=714614#c29)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/jit-test/tests/basic/[bug714614](/show_bug.cgi?id=714614 "VERIFIED FIXED - Assertion failure: self->nativeContains(cx, *aprop), at jsscope.cpp:1000").js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=714614&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_2f86897c_20250125_084150.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/706381)
* [XML](/show_bug.cgi?ctype=xml&id=706381)

Closed
[Bug 706381](/show_bug.cgi?id=706381)

Opened 13 years ago
Closed 13 years ago

# Java related crash with deleted pointer in esx

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Java related crash with deleted pointer in esx

## Categories

### (Core Graveyard :: Plug-ins, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Plug-ins#Plug-ins)

Plug-ins
▾

Core Graveyard :: Plug-ins
Bugs in core Mozilla code that supports registering and using plug-ins. For bugs in specific plugins, please file those bugs under External Software Affecting Firefox.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Plug-ins)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

9 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (firefox8- wontfix, firefox9- wontfix, firefox10+ wontfix, firefox11- wontfix, firefox12+ fixed, firefox13+ fixed, firefox-esr1012+ fixed, blocking1.9.2 needed, status1.9.2 ?)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |
| blocking1.9.2 | --- | [needed](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=needed) |
| status1.9.2 | --- | [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | + | wontfix |
| firefox11 | - | wontfix |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| blocking1.9.2 |  |  |
| status1.9.2 |  | ? |

## People

### (Reporter: bc, Assigned: jst)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1e8a6f9ec1e854e31b94b2edc0c56b81?d=mm&size=40)  [jst](/user_profile?user_id=12352)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

### (Blocks 1 open bug, [URL](http://www.sheru100.in/view/index585.html "http://www.sheru100.in/view/index585.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[malware-attacks](/show_bug.cgi?id=512788 "NEW - [meta] instances of malware reports -- tracking bug")

Dependency [tree](/showdependencytree.cgi?id=706381&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=706381)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[sheru100.in/view/index585.html](http://www.sheru100.in/view/index585.html "http://www.sheru100.in/view/index585.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ mozalloc\_abort(char const\* const) | NS\_DebugBreak\_P | mozilla::plugins::PluginModuleChild::ShouldContinueFromReplyTimeout() ]](https://crash-stats.mozilla.org/signature/?signature=mozalloc_abort%28char%20const%2A%20const%29%20%7C%20NS_DebugBreak_P%20%7C%20mozilla%3A%3Aplugins%3A%3APluginModuleChild%3A%3AShouldContinueFromReplyTimeout%28%29)

[[@ nsNPAPIPluginInstance::InvalidateOwner ]](https://crash-stats.mozilla.org/signature/?signature=nsNPAPIPluginInstance%3A%3AInvalidateOwner)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [crash report](/attachment.cgi?id=577852)  [13 years ago](#c0)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   128.87 KB, text/plain |  | [Details](/attachment.cgi?id=577852&action=edit) |
| --- | --- | --- |
| [log](/attachment.cgi?id=577853)  [13 years ago](#c1)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   508.77 KB, text/plain |  | [Details](/attachment.cgi?id=577853&action=edit) |
| [Possible fix.](/attachment.cgi?id=578507)  [13 years ago](#c4)  [Johnny Stenback (:jst)](/user_profile?user_id=12352)   762 bytes, patch | jaas : [review+](#c10 "13 years ago")  akeybl : [approval-mozilla-esr10+](#a11039661_425645 "13 years ago") | [Details](/attachment.cgi?id=578507&action=edit) | [Diff](/attachment.cgi?id=578507&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=706381&attachment=578507) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=706381#c0)• 13 years ago |
|  | |

Attached file
[crash report](attachment.cgi?id=577852)
— [Details](attachment.cgi?id=577852&action=edit)

0. enable Java(TM) Platform SE 6 U29
1. enable popups
2. disable malware detector
3. <http://www.sheru100.in/view/index585.html>
4. shutdown
<http://cpm1.jmxy.com:899/cpm/tg_href.aspx?tg_d=www.ads80.com> will be loaded which is reported as a malware attack site.
Nightly/11 Windows 7
[bp-f1059123-a28f-499c-9003-5ed772111129](https://crash-stats.mozilla.org/report/index/f1059123-a28f-499c-9003-5ed772111129)
Crash Report [@ mozalloc\_abort(char const\* const) | NS\_DebugBreak\_P | mozilla::plugins::PluginModuleChild::ShouldContinueFromReplyTimeout() ]
See also [bug 681385](/show_bug.cgi?id=681385 "RESOLVED DUPLICATE - plugin-side crash/hang in mozilla::plugins::PluginModuleChild::ShouldContinueFromReplyTimeout")
Automation hit this with ecx pointing to deleted memory. I wasn't able to reproduce locally though.
Operating system: Windows NT
6.1.7601 Service Pack 1
CPU: x86
GenuineIntel family 6 model 44 stepping 2
2 CPUs
Crash reason: EXCEPTION\_ACCESS\_VIOLATION\_WRITE
Crash address: 0xffffffffddddde1d
Thread 0 (crashed)
0 xul.dll!nsNPAPIPluginInstance::InvalidateOwner() [nsNPAPIPluginInstance.cpp : 1431 + 0x3]
eip = 0x6f9ed2ea esp = 0x0031b128 ebp = 0x0031b12c ebx = 0x00000001
esi = 0x04ae00e8 edi = 0xffffff87 eax = 0xdddddddd ecx = 0xdddddddd
edx = 0x00000001 efl = 0x00210246
Found by: given as instruction pointer in context
1 xul.dll!nsDummyJavaPluginOwner::Destroy() [nsGlobalWindow.cpp : 483 + 0x11]
eip = 0x6f28450a esp = 0x0031b134 ebp = 0x0031b138
Found by: call frame info
2 xul.dll!nsGlobalWindow::FreeInnerObjects(int) [nsGlobalWindow.cpp : 1311 + 0x14]
eip = 0x6f2874ff esp = 0x0031b140 ebp = 0x0031b168
Found by: call frame info
3 xul.dll!nsGlobalWindow::SetDocShell(nsIDocShell \*) [nsGlobalWindow.cpp : 2397 + 0x10]
eip = 0x6f28bde4 esp = 0x0031b170 ebp = 0x0031b1c8
Found by: call frame info
4 xul.dll!nsDocShell::Destroy() [nsDocShell.cpp : 4611 + 0x1c]
eip = 0x6f82852a esp = 0x0031b1d0 ebp = 0x0031b22c
Found by: call frame info
5 xul.dll!nsFrameLoader::Finalize() [nsFrameLoader.cpp : 573 + 0x18]
eip = 0x6efbc3a1 esp = 0x0031b234 ebp = 0x0031b248
Found by: call frame info

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=706381#c1)• 13 years ago |
|  | |

Attached file
[log](attachment.cgi?id=577853)
— [Details](attachment.cgi?id=577853&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=706381#c2)• 13 years ago |
|  | |

Can we capture the testcase? If the site is already flagged as a malware site the contents might go away at any time.Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)Whiteboard: [sg:critical]

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=706381#c3)• 13 years ago |
|  | |

I'll try again. It was late and the attempts I made using wget didn't seem to catch anything useful.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a145422_12352)• 13 years ago |

Assignee: nobody → jstblocking1.9.2: --- → ?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=706381#c4)• 13 years ago |
|  | |

Attached patch

[Possible fix.](attachment.cgi?id=578507&action=diff)
— [Details](attachment.cgi?id=578507&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=706381&attachment=578507)

It's unclear exactly how this crash happens, but I did find this inconsistency where we can create a dummy java plugin (which we create when accessing window.java n friends) and then navigate switch documents in the window w/o creating a new inner. In that case we end up with a dummy java plugin whose owner has a reference to the old document rather than the new one. This fixes that case, but I have not had a chance to test whether this fixes the problem here.
Bob, any chance you can test this out? I can spin a try build if that helps.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=706381#c5)• 13 years ago |
|  | |

dveditz was right that this might be fleeting. I couldn't get anything to reproduce except for some really high cpu usage. I can retry again. A try build would be cool, though I can build my own with the patch if needed. I'll get to this after I take care of some other things this morning.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=706381#c6)• 13 years ago |
|  | |

Have we seen evidence of this on the 1.9.2 branch, or is it a relatively-new-build crash?blocking1.9.2: ? → needed
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=706381#c7)• 13 years ago |
|  | |

I have seen only once instance of a related crash with signature mozilla::plugins::PluginModuleChild::ShouldContinueFromReplyTimeout. Socorro shows 300 in the last week though: <https://crash-stats.mozilla.com/query/query?do_query=1&query_type=contains&query=mozilla%3A%3Aplugins%3A%3APluginModuleChild%3A%3AShouldContinueFromReplyTimeout>
I have seen only one instance of a related crash with signature nsNPAPIPluginInstance::InvalidateOwner. There are no instances of this in Socorro.
I haven't been able to reproduce locally.
The original SocorroRecord where the crash automation obtained the url to test had signature mozilla::widget::WindowHook::Lookup(unsigned int) which has ~3000 crashes in the last week. <https://crash-stats.mozilla.com/query/query?do_query=1&query_type=contains&query=mozilla%3A%3Awidget%3A%3AWindowHook%3A%3ALookup>
See 556524. There were two mozilla::widget::WindowHook::Lookup at sheru100 in Nov/Dec. I'll try to collect a set of urls to retest to see if I can get more information.
Johnny, without more information want to go ahead and see if this helps in other ways? Perhaps the fix will affect other "unrelated" signatures.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=706381#c8)• 13 years ago |
|  | |

Comment on [attachment 578507](/attachment.cgi?id=578507 "Possible fix.") [[details]](/attachment.cgi?id=578507&action=edit "Possible fix.") [[diff]](/attachment.cgi?id=578507&action=diff "Possible fix.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706381&attachment=578507)
Possible fix.
Yeah, I think we should just land this patch, requesting review.
[Attachment #578507](/attachment.cgi?id=578507&action=edit "Possible fix.") -
Flags: review?(joshmoz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=706381#c9)• 13 years ago |
|  | |

Looks like this applies to 1.9.2 as wellblocking1.9.2: needed → .26+
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) → [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=706381#c10)• 13 years ago |
|  | |

Comment on [attachment 578507](/attachment.cgi?id=578507 "Possible fix.") [[details]](/attachment.cgi?id=578507&action=edit "Possible fix.") [[diff]](/attachment.cgi?id=578507&action=diff "Possible fix.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706381&attachment=578507)
Possible fix.
Review of [attachment 578507](/attachment.cgi?id=578507 "Possible fix.") [[details]](/attachment.cgi?id=578507&action=edit "Possible fix.") [[diff]](/attachment.cgi?id=578507&action=diff "Possible fix.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706381&attachment=578507):
-----------------------------------------------------------------
::: dom/base/nsGlobalWindow.cpp
@@ +2177,5 @@
> + // this window.
> + mDummyJavaPluginOwner->Destroy();
> + mDummyJavaPluginOwner = nsnull;
> +
> + mDidInitJavaProperties = PR\_FALSE;
How come we don't set mDidInitJavaProperties to false in the other places where we destroy the dummy instance, like in "nsGlobalWindow::FreeInnerObjects"?
[Attachment #578507](/attachment.cgi?id=578507&action=edit "Possible fix.") -
Flags: review?(joshmoz) → review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=706381#c11)• 13 years ago |
|  | |

All other places that tear down the dummy java plugin we're at the very end of the lifetime of the window, so it doesn't matter. But for consistency's sake it wouldn't hurt to do the same there as well.blocking1.9.2: .26+ → needed
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted) → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → ---
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) → ---Target Milestone: --- → mozilla11

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=706381#c12)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/025fa101a51b>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=706381#c13)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/025fa101a51b>
Leaving this bug open though, as it's not clear whether this patch actually changes things here, so we should track this in crash-stats etc for a while before we can tell.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=706381#c14)• 13 years ago |
|  | |

Probably not much chance of getting this into Fx10 at this point, but it is a safe contained fix. Are there enough crashes that we could decide in a couple of days?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=706381#c15)• 13 years ago |
|  | |

If this patch did help then we should get it into the ESR at some point.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a5940334_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [.1+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=.1%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a6611427_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[.1+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=.1%2B) → [11+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=11%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=706381#c16)• 13 years ago |
|  | |

Setting the ESR tracking flag to 12+ since this hasn't yet been uplifted to 11.
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[11+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=11%2B) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=706381#c17)• 13 years ago |
|  | |

Bob, any signs of this left? Or can we even tell?
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=706381#c18)• 13 years ago |
|  | |

I haven't seen any signs of this but it is hard to tell. I wonder if this is related at all to [bug 724781](/show_bug.cgi?id=724781 "VERIFIED FIXED - Java related crash with deleted this | [@ nsPluginInstanceOwner::Destroy() ] [@ nsObjectFrame::SetInstanceOwner(nsPluginInstanceOwner*) ]")

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=706381#c19)• 13 years ago |
|  | |

Ok, calling this fixed then. We can always reopen this bug if additional information emerges.Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=706381#c20)• 13 years ago |
|  | |

[Triage Comment]
Can this patch be landed as is to ESR branch? Please nominate for approval-mozilla-esr10 if so. See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for details.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=706381#c21)• 13 years ago |
|  | |

qa- until testcase-wanted is satisfiedWhiteboard: [sg:critical] → [sg:critical][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=706381#c22)• 13 years ago |
|  | |

Comment on [attachment 578507](/attachment.cgi?id=578507 "Possible fix.") [[details]](/attachment.cgi?id=578507&action=edit "Possible fix.") [[diff]](/attachment.cgi?id=578507&action=diff "Possible fix.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706381&attachment=578507)
Possible fix.
This applies to ESR10
[Attachment #578507](/attachment.cgi?id=578507&action=edit "Possible fix.") -
Flags: approval-mozilla-esr10?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a11039661_425645)• 13 years ago |

[Attachment #578507](/attachment.cgi?id=578507&action=edit "Possible fix.") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=706381#c23)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/c8a79e73f18f>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=706381#c24)• 13 years ago |
|  | |

Nothing much to verify here since we've never been able to reproduce the problem again.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a14743231_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a122391335_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706381#a330101091_546015)• 3 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=706381&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_30f4b334_20250125_084235.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/735073)
* [XML](/show_bug.cgi?ctype=xml&id=735073)

Closed
[Bug 735073](/show_bug.cgi?id=735073)

Opened 13 years ago
Closed 13 years ago

# Plugins can be fooled by window.location (again)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Plugins can be fooled by window.location (again)

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 | --- | [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 |  | affected |
| firefox12 | + | verified |
| firefox13 | + | verified |
| firefox14 | + | verified |
| firefox-esr10 | 12+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bholley, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[736694](/show_bug.cgi?id=736694 "RESOLVED DUPLICATE - Object.defineProperty allows setting window.location.*")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, sec-high, Whiteboard: [sg:high (at least)][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high (at least)][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [bholley](/user_profile?user_id=313730) | [in-testsuite](#c21 "12 years ago") | + |
| --- | --- | --- |
| [bholley](/user_profile?user_id=313730) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [testcase](/attachment.cgi?id=605161)  [13 years ago](#c0)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   255 bytes, text/html |  | [Details](/attachment.cgi?id=605161&action=edit) |
| --- | --- | --- |
| [updated test coverage to expose the issue](/attachment.cgi?id=605209)  [13 years ago](#c2)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.65 KB, patch |  | [Details](/attachment.cgi?id=605209&action=edit) | [Diff](/attachment.cgi?id=605209&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=605209) |
| [aurora fix - v1](/attachment.cgi?id=613501)  [13 years ago](#c12)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   6.95 KB, patch | mrbkap : [review+](#a2447469_69426 "13 years ago")  akeybl : [approval-mozilla-aurora+](#a2494947_425645 "13 years ago") | [Details](/attachment.cgi?id=613501&action=edit) | [Diff](/attachment.cgi?id=613501&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=613501) |
| [beta/esr10 fix](/attachment.cgi?id=613503)  [13 years ago](#c13)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   6.94 KB, patch | mrbkap : [review+](#a2447475_69426 "13 years ago")  akeybl : [approval-mozilla-beta+](#c15 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c15 "13 years ago") | [Details](/attachment.cgi?id=613503&action=edit) | [Diff](/attachment.cgi?id=613503&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=613503) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=735073#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=605161)
— [Details](attachment.cgi?id=605161&action=edit)

Looks like we regressed [CVE-2010-0170](https://www.cve.org/CVERecord?id=CVE-2010-0170) ([bug 541530](/show_bug.cgi?id=541530 "VERIFIED FIXED - Restore paranoid location object protecting code")) some time ago. Probably with compartments.
We've theoretically got test coverage for it: <http://mxr.mozilla.org/mozilla-central/source/dom/tests/mochitest/bugs/test_bug541530.html>
Unfortunately, the test coverage gets fooled when window.location.\_\_defineGetter\_\_ doesn't exist, and incorrectly concludes that the object is immutable. But we can easily do window.\_\_defineGetter\_\_.apply(window.location, ...) and do the same thing. Ruh roh (testcase attached).
I discovered this when I broke this test with my location wrapper changes in compartment-per-global, and started wondering how we currently deal with the problem.
I already need to change this stuff around to work right with my compartment-per-global changes. So I think the safest and most discrete approach is for me to just fix it there ([bug 733984](/show_bug.cgi?id=733984 "RESOLVED FIXED - Prepare Location object wrappers for a compartment-per-global world")), and then backport to branches later if need be.
Thoughts?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=735073#c1)• 13 years ago |
|  | |

> So I think the safest and most discrete approach is for me to just fix it
> there ([bug 733984](/show_bug.cgi?id=733984 "RESOLVED FIXED - Prepare Location object wrappers for a compartment-per-global world")), and then backport to branches later if need be.
I'm fine with the first half of that sentence; the second half needs to be "backport to branches ASAP".
The backport patches can/should live in this bug once you figure out all the places that need fixing in the other bug.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: [sg:high (at least)]

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a3057_313730)• 13 years ago |

Assignee: nobody → bobbyholley+bmo

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=735073#c2)• 13 years ago |
|  | |

Attached patch

[updated test coverage to expose the issue](attachment.cgi?id=605209&action=diff)
— [Details](attachment.cgi?id=605209&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=605209)

I've added the updated test coverage that tests things properly. It's probably best to avoid landing it right now, so I'll take responsibility for landing it in a month or so.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=735073#c3)• 13 years ago |
|  | |

jst and I just talked about this for a little bit.
I'm finding it cumbersome for various reasons to avoid fixing the tests in the same patch as I update the behavior ([bug 733984](/show_bug.cgi?id=733984 "RESOLVED FIXED - Prepare Location object wrappers for a compartment-per-global world")). I'm going to have to update the test anyway for other reasons, so I might as well just fix it. I don't think the test fixes make it at all obvious that we were previously vulnerable.
A bigger concern is backporting this. Backporting any of the new Location object machinery I'm writing will make it crystal clear what the problem is. So if we're trying to keep it a secret, we might need to figure out something clever there.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=735073#c4)• 13 years ago |
|  | |

The "clever" thing is to not leave much of a window between landing an shipping. Depends on how big a change the back-port turns out to be, and how different from what got tested on mozilla-central, but if we can hold off landing on beta and aurora until last minute (two weeks before merge, say) that might be best.

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=735073#c5)• 13 years ago |
|  | |

[Triage Comment]
Removing the tracking on this, leaving status-firefox-esr10 affected, we'll track it for the right esr release once it's fixed.
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=735073#c6)• 13 years ago |
|  | |

Is [bug 736694](/show_bug.cgi?id=736694 "RESOLVED DUPLICATE - Object.defineProperty allows setting window.location.*") due to the same problem?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=735073#c7)• 13 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #6](/show_bug.cgi?id=735073#c6 "VERIFIED FIXED - Plugins can be fooled by window.location (again)"))
> Is [bug 736694](/show_bug.cgi?id=736694 "RESOLVED DUPLICATE - Object.defineProperty allows setting window.location.*") due to the same problem?
Yep. Same issue. Object.defineProperty is just a newfangled mechanism for \_\_defineGetter\_\_/\_\_defineSetter\_\_.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=735073#c8)• 13 years ago |
|  | |

\_\_define{G,S}etter\_\_ just calls the same method used to implement Object.defineProperty, actually. (There's one case where they're not the same -- if the property in question is quickstubbed -- but we definitely want to kill that.)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=735073#c9)• 13 years ago |
|  | |

(In reply to Jeff Walden (:Waldo) (remove +bmo to email) from [comment #8](/show_bug.cgi?id=735073#c8 "VERIFIED FIXED - Plugins can be fooled by window.location (again)"))
> (There's one case where they're not the
> same -- if the property in question is quickstubbed -- but we definitely
> want to kill that.)
Well, we're killing quickstubs entirely once the new DOM bindings are all settled. Hopefully the new bindings will do the right thing here.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=735073#c10)• 13 years ago |
|  | |

Well...see [bug 738525](/show_bug.cgi?id=738525 "RESOLVED FIXED - Add IC for JSNative getters"). :-(

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=735073#c12)• 13 years ago |
|  | |

Attached patch

[aurora fix - v1](attachment.cgi?id=613501&action=diff)
— [Details](attachment.cgi?id=613501&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=613501)

Aurora fix, more or less identical to the one in [bug 733984](/show_bug.cgi?id=733984 "RESOLVED FIXED - Prepare Location object wrappers for a compartment-per-global world"). Flagging mrbkap for rubberstamp.
[Attachment #613501](/attachment.cgi?id=613501&action=edit "aurora fix - v1") -
Flags: review?(mrbkap)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=735073#c13)• 13 years ago |
|  | |

Attached patch

[beta/esr10 fix](attachment.cgi?id=613503&action=diff)
— [Details](attachment.cgi?id=613503&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=613503)

Beta/ESR10 fix. Mostly identical modulo a few merge conflicts. Flagging mrbkap for rubberstamp.
[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: review?(mrbkap)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a2447469_69426)• 13 years ago |

[Attachment #613501](/attachment.cgi?id=613501&action=edit "aurora fix - v1") -
Flags: review?(mrbkap) → review+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a2447475_69426)• 13 years ago |

[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: review?(mrbkap) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=735073#c14)• 13 years ago |
|  | |

Comment on [attachment 613501](/attachment.cgi?id=613501 "aurora fix - v1") [[details]](/attachment.cgi?id=613501&action=edit "aurora fix - v1") [[diff]](/attachment.cgi?id=613501&action=diff "aurora fix - v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=613501)
aurora fix - v1
[Approval Request Comment]
Regression caused by (bug #): brain transplants (ff4)
User impact if declined: Vulnerable plugins can be fooled into giving local privileges to untrusted content.
Testing completed (on m-c, etc.): baked on m-c for ~2 weeks.
Risk to taking this patch (and alternatives if risky): low-medium. The main risk is that developers may have started depending on shadowing location object expandos in the gap since FF4. It's unlikely though, since webkit disallows shadowing entirely.
String changes made by this patch: An exception string was added ("Permission denied to shadow native property"). I don't believe that these are localized.
dveditz wanted to wait until the last minute to land this on all branches, since the exploit is obvious. As such, I'm flagging for approval on all three branches, rather than waiting for it to bake on m-a.
[Attachment #613501](/attachment.cgi?id=613501&action=edit "aurora fix - v1") -
Flags: approval-mozilla-aurora?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a2485091_313730)• 13 years ago |

[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: approval-mozilla-esr10?
[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: approval-mozilla-beta?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=735073#c15)• 13 years ago |
|  | |

Comment on [attachment 613503](/attachment.cgi?id=613503 "beta/esr10 fix") [[details]](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") [[diff]](/attachment.cgi?id=613503&action=diff "beta/esr10 fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=735073&attachment=613503)
beta/esr10 fix
[Triage Comment]
Approved for all branches. Please land ASAP (esp. for mozilla-beta), and include any info on what we should be on the lookout for w/r/t where we might expect to find regressions.
[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: approval-mozilla-esr10?
[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: approval-mozilla-esr10+
[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: approval-mozilla-beta?
[Attachment #613503](/attachment.cgi?id=613503&action=edit "beta/esr10 fix") -
Flags: approval-mozilla-beta+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a2494947_425645)• 13 years ago |

[Attachment #613501](/attachment.cgi?id=613501&action=edit "aurora fix - v1") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=735073#c16)• 13 years ago |
|  | |

Pushed to m-a: <http://hg.mozilla.org/releases/mozilla-aurora/rev/01ffc413b4cc>
I'll let this build before pushing to m-b.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=735073#c17)• 13 years ago |
|  | |

Pushed to m-b at lsblakk's requests: <http://hg.mozilla.org/releases/mozilla-beta/rev/bb3d8a18edd5>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=735073#c18)• 13 years ago |
|  | |

And, for good measure, esr10: <http://hg.mozilla.org/releases/mozilla-esr10/rev/f00f7011a218>

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a2504684_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a4227820_1689)• 13 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=735073#c19)• 13 years ago |
|  | |

This landed everywhere, so I think it should be ok to resolve.Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5088329_279076)• 13 years ago |

Whiteboard: [sg:high (at least)] → [sg:high (at least)][qa+]

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5711130_432443)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5711211_432443)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5711266_432443)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5711334_432443)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5711644_432443)• 13 years ago |

[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5711939_432443)• 13 years ago |

Whiteboard: [sg:high (at least)][qa+] → [sg:high (at least)][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735073#a5781710_1689)• 13 years ago |

Group: core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=735073#c20)• 12 years ago |
|  | |

Bobby, did the tests here ever land? (There's no evidence of that in this bug, but perhaps elsewhere.)Flags: in-testsuite?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=735073#c21)• 12 years ago |
|  | |

Yes, this landed with [bug 733984](/show_bug.cgi?id=733984 "RESOLVED FIXED - Prepare Location object wrappers for a compartment-per-global world").Flags: in-testsuite? → in-testsuite+
You need to [log in](/show_bug.cgi?id=735073&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_fc44f823_20250125_084247.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/737875)
* [XML](/show_bug.cgi?ctype=xml&id=737875)

Closed
[Bug 737875](/show_bug.cgi?id=737875)

Opened 13 years ago
Closed 13 years ago

# OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory

## Categories

### (Core :: DOM: HTML Parser, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20HTML%20Parser#DOM%3A%20HTML%20Parser)

DOM: HTML Parser
▾

Core :: DOM: HTML Parser
This system consumes content from the web, parses, validates and builds a content model (document)
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20HTML%20Parser)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | fixed |
| firefox13 |  | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: khuey)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d8bebbee32670ee5755ce1bc535cd251?d=mm&size=40)  [khuey](/user_profile?user_id=336670)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL"), [737129](/show_bug.cgi?id=737129 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[oomfuzz](/show_bug.cgi?id=687256 "RESOLVED FIXED - [meta] Need fuzz testing of OOM conditions to find exploitable crashes")

Dependency [tree](/showdependencytree.cgi?id=737875&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=737875)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, Whiteboard: [sg:high][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsQueryInterfaceWithError::operator ]](https://crash-stats.mozilla.org/signature/?signature=nsQueryInterfaceWithError%3A%3Aoperator)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Log with failed allocations](/attachment.cgi?id=607962)  [13 years ago](#c0)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   15.25 KB, text/plain |  | [Details](/attachment.cgi?id=607962&action=edit) |
| --- | --- | --- |
| [Patch](/attachment.cgi?id=608404)  [13 years ago](#c2)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   2.81 KB, patch | hsivonen : [review+](#c4 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c7 "13 years ago")  akeybl : [approval-mozilla-beta+](#c7 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c7 "13 years ago") | [Details](/attachment.cgi?id=608404&action=edit) | [Diff](/attachment.cgi?id=608404&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737875&attachment=608404) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=737875#c0)• 13 years ago |
|  | |

Attached file
[Log with failed allocations](attachment.cgi?id=607962)
— [Details](attachment.cgi?id=607962&action=edit)

+++ This bug was initially created as a clone of [Bug #733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL") +++
Tested on m-c revision 08809a43e082: During OOM testing for [bug 737129](/show_bug.cgi?id=737129 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack") I got a crash shown in the attached log. The trace is very similar to that in [bug 733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL") but we're not trying to execute NULL here but random memory.
The log shows 6 failed allocations before the crash, and the crash location (address) varies (I had, "(bad)" and "Cannot access memory at", as well as random instructions).
Could it be that one of the failed allocations leaves a pointer uninitialized here?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=737875#c1)• 13 years ago |
|  | |

Not sure this is different than [bug 733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL"), maybe it's the same and we need to raise the severity over there.Whiteboard: [sg:high]

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737875#a98269_336670)• 13 years ago |

Component: DOM → HTML: ParserQA Contact: general → parser

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=737875#c2)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=608404&action=diff)
— [Details](attachment.cgi?id=608404&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=737875&attachment=608404)

What happens here is that we fail to append the nsIContent\* to the nsCOMArray that holds it alive, and we end up with a dead pointer floating around. The solution is to use an infallible array for mOwnedElements.Assignee: nobody → khueyStatus: NEW → ASSIGNED
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: review?(hsivonen)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=737875#c3)• 13 years ago |
|  | |

And I'm pretty sure this and [bug 733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL") are the same.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=737875#c4)• 13 years ago |
|  | |

Comment on [attachment 608404](/attachment.cgi?id=608404 "Patch") [[details]](/attachment.cgi?id=608404&action=edit "Patch") [[diff]](/attachment.cgi?id=608404&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737875&attachment=608404)
Patch
Thanks for figuring this out!
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: review?(hsivonen) → review+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=737875#c5)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/8042c37b8100>Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDTarget Milestone: --- → mozilla14

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=737875#c6)• 13 years ago |
|  | |

Comment on [attachment 608404](/attachment.cgi?id=608404 "Patch") [[details]](/attachment.cgi?id=608404&action=edit "Patch") [[diff]](/attachment.cgi?id=608404&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737875&attachment=608404)
Patch
fwiw, I think this would be next to impossible to exploit, but the fix is safe enough that we could take it anywhere.
[Approval Request Comment]
Regression caused by (bug #): the HTML5 parser landing presumably
User impact if declined: in certain OOM scenarios we will crash in an uncontrolled way instead of in a controlled way
Testing completed (on m-c, etc.): landed on m-c
Risk to taking this patch (and alternatives if risky): the risk is about as low as it gets
String changes made by this patch: N/A
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-esr10?
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=737875#c7)• 13 years ago |
|  | |

Comment on [attachment 608404](/attachment.cgi?id=608404 "Patch") [[details]](/attachment.cgi?id=608404&action=edit "Patch") [[diff]](/attachment.cgi?id=608404&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=737875&attachment=608404)
Patch
[Triage Comment]
Approved for Aurora 13, Beta 12, and the ESR given the possible user impact and where we are in the schedule.
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-esr10?
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-esr10+
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-beta+
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-aurora?
[Attachment #608404](/attachment.cgi?id=608404&action=edit "Patch") -
Flags: approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737875#a453793_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=737875#c8)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/3074d3eb0f34>
<http://hg.mozilla.org/releases/mozilla-beta/rev/0b4ec3bcf064>
<http://hg.mozilla.org/releases/mozilla-esr10/rev/5dd4295eae1c>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=737875#c9)• 13 years ago |
|  | |

qa- until testcase-wanted has been satisfied.Whiteboard: [sg:high] → [sg:high][qa-]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=737875#c10)• 13 years ago |
|  | |

Are this and [bug 733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL") the same? This one is resolved fixed but [bug 733047](/show_bug.cgi?id=733047 "RESOLVED DUPLICATE - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute NULL") is not even assigned and is still open.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=737875#c11)• 13 years ago |
|  | |

Christian thinks this is probably the same issue.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=737875#c13)• 13 years ago |
|  | |

Christian, is there any way to verify this fix or [bug 737129](/show_bug.cgi?id=737129 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack"), which is the same overall issue?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=737875#c14)• 13 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #13](/show_bug.cgi?id=737875#c13 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory"))
> Christian, is there any way to verify this fix or [bug 737129](/show_bug.cgi?id=737129 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack"), which is the
> same overall issue?
Not really, bug if this is not fixed, then it will pop up again during OOM testing. I'm not doing that right now though since I'm too busy with other stuff :/

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737875#a5030019_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737875#a112677933_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=737875&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9a5d85c6_20250125_084240.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/736609)
* [XML](/show_bug.cgi?ctype=xml&id=736609)

Closed
[Bug 736609](/show_bug.cgi?id=736609)

Opened 13 years ago
Closed 13 years ago

# Malloc error with ArrayBuffer, Uint32Array and Uint8Array

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Malloc error with ArrayBuffer, Uint32Array and Uint8Array

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox14 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: dmandelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a86fae4b06c1570a6c1a1bc1c5a6c1f6?d=mm&size=40)  [dmandelin](/user_profile?user_id=294323)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[664249](/show_bug.cgi?id=664249 "RESOLVED FIXED - Step 2 of Typed Array creation speedups")

Dependency [tree](/showdependencytree.cgi?id=736609&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=736609)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c18 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=606742)  [13 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   10.32 KB, text/plain |  | [Details](/attachment.cgi?id=606742&action=edit) |
| --- | --- | --- |
| [Patch](/attachment.cgi?id=609492)  [13 years ago](#c4)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   1004 bytes, patch | sfink : [review+](#c6 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c11 "13 years ago")  akeybl : [approval-mozilla-beta+](#c11 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c11 "13 years ago") | [Details](/attachment.cgi?id=609492&action=edit) | [Diff](/attachment.cgi?id=609492&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736609&attachment=609492) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=736609#c0)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=606742)
— [Details](attachment.cgi?id=606742&action=edit)

try {
a = ArrayBuffer(76);
b = Uint32Array(a);
uneval()
c = Uint8Array(a);
c.set(b)
} catch (e) {}
crashes js debug and opt shell on m-c changeset c7ef262e3024 with a malloc error:
Tested on 32-bit.
malloc: \*\*\* error for object 0xb74ae4: incorrect checksum for freed object - object was probably modified after being freed.
\*\*\* set a breakpoint in malloc\_error\_break to debug
s-s because malloc errors seem scary. A Valgrind log is attached.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=736609#c1)• 13 years ago |
|  | |

a = Int32Array(6)
Uint8Array(a.buffer).set(a)
is a testcase which causes a similar error - the testcase manifests as the following on Linux:
\*\*\* glibc detected \*\*\* ./js-opt-32-im-linux: free(): invalid next size (fast): 0x095e3a18 \*\*\*
======= Backtrace: =========
/lib32/libc.so.6(+0x6ff02)[0xf751cf02]
/lib32/libc.so.6(+0x70ba2)[0xf751dba2]
/lib32/libc.so.6(cfree+0x6d)[0xf7520c5d]
./js-opt-32-im-linux[0x81844d0]
/snip

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=736609#c2)• 13 years ago |
|  | |

autoBisect.py -p -a64 --valgrind t.js
Due to skipped revisions, the first bad revision could be any of:
changeset: 96f52c040d20
user: Nikhil Marathe
date: Mon Aug 01 15:26:54 2011 -0700
summary: [Bug 667047](/show_bug.cgi?id=667047 "RESOLVED FIXED - ArrayBuffer: __proto__ inconsistent behaviour") - Ensure proper \_\_proto\_\_ behaviour as a normal property after setting it to null once. r=mrbkap
changeset: 794fe3408d3a
user: Nikhil Marathe
date: Mon Aug 01 15:49:51 2011 -0700
summary: [Bug 664249](/show_bug.cgi?id=664249 "RESOLVED FIXED - Step 2 of Typed Array creation speedups") - Inline TypedArray properties into slots. r=mrbkapBlocks: [664249](/show_bug.cgi?id=664249 "RESOLVED FIXED - Step 2 of Typed Array creation speedups")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a417893_1689)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical] js-triage-needed

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a417908_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=736609#c3)• 13 years ago |
|  | |

Assigning to dmandelin to find a real assignee. This flaw has been in the code a while but was recently found when we changed our fuzzers to look for more things like the flaw that was used in the Pwn2Own contest. Others may be out there looking for things like this too (at the very least, Willem and Vincenzo might be).Assignee: general → dmandelin
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a863345_294323)• 13 years ago |

[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)Whiteboard: [sg:critical] js-triage-needed → [sg:critical]

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=736609#c4)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=609492&action=diff)
— [Details](attachment.cgi?id=609492&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736609&attachment=609492)

Great test case: it's a bad bug but very easy to spot with this test case + the memory corruption thing Visual Studio has.
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: review?(sphink)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=736609#c5)• 13 years ago |
|  | |

Alex, can I get your advice on landing this? If you look at the patch you'll see that it's \*very\* easy to spot what's going on here. We have some typed array feature work scheduled to land in the next few weeks that might work as cover bugs if that would be useful. I don't think we could land those bugs on the ESR though.

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=736609#c6)• 13 years ago |
|  | |

Comment on [attachment 609492](/attachment.cgi?id=609492 "Patch") [[details]](/attachment.cgi?id=609492&action=edit "Patch") [[diff]](/attachment.cgi?id=609492&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736609&attachment=609492)
Patch
Review of [attachment 609492](/attachment.cgi?id=609492 "Patch") [[details]](/attachment.cgi?id=609492&action=edit "Patch") [[diff]](/attachment.cgi?id=609492&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736609&attachment=609492):
-----------------------------------------------------------------
::: js/src/jstypedarray.cpp
@@ +1955,5 @@
> }
>
> // We have to make a copy of the source array here, since
> // there's overlap, and we have to convert types.
> + void \*srcbuf = cx->malloc\_(getByteLength(tarray));
Um, yeah. Your version is better.
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: review?(sphink) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=736609#c7)• 13 years ago |
|  | |

Thanks for the quick review. I guess now we need a cover bug to land it in. Steve, do you think we can land it in one of your typed array bugs? That would cover it pretty well, but we probably don't want to land those bugs on ESR. But I'm not sure how we do land things on ESR. Do we use cover bugs, or do we just land the security fixes directly because it's the last place they go?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=736609#c8)• 13 years ago |
|  | |

Cover bugs are useful sometimes, if we have something plausible at hand. For ESR and non-trunk branches (e.g. Firefox 12) you don't want to land array feature changes and I can't imagine any bug you could write that would obscure what's going on here if what's actually checked in is a one-line patch.
Landing this safe patch right at the release freeze date for Firefox 12 and ESR will have to be good enough. It's a pretty straightforward heap buffer overrun and likely to be easy to incorporate into an exploit.
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=736609#c9)• 13 years ago |
|  | |

[Triage Comment]
Please nominate the patch for ESR landing as per <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=736609#c10)• 13 years ago |
|  | |

Comment on [attachment 609492](/attachment.cgi?id=609492 "Patch") [[details]](/attachment.cgi?id=609492&action=edit "Patch") [[diff]](/attachment.cgi?id=609492&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736609&attachment=609492)
Patch
[Approval Request Comment]
Regression caused by (bug #): probably 667047 or 664249
User impact if declined: leaves in a buffer overflow vulnerability
Testing completed (on m-c, etc.): standard js regression test suite
Risk to taking this patch (and alternatives if risky): none, AFAICT
String changes made by this patch: none
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: approval-mozilla-esr10?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=736609#c11)• 13 years ago |
|  | |

Comment on [attachment 609492](/attachment.cgi?id=609492 "Patch") [[details]](/attachment.cgi?id=609492&action=edit "Patch") [[diff]](/attachment.cgi?id=609492&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736609&attachment=609492)
Patch
(In reply to David Mandelin from [comment #5](/show_bug.cgi?id=736609#c5 "VERIFIED FIXED - Malloc error with ArrayBuffer, Uint32Array and Uint8Array"))
> Alex, can I get your advice on landing this? If you look at the patch you'll
> see that it's \*very\* easy to spot what's going on here. We have some typed
> array feature work scheduled to land in the next few weeks that might work
> as cover bugs if that would be useful. I don't think we could land those
> bugs on the ESR though.
Let's move forward with landing this fix on Aurora/Beta/ESR before our code freeze date (4/13). Pre-approving for Aurora 13 and Beta 12, assuming this patch applies.
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: approval-mozilla-esr10?
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: approval-mozilla-esr10+
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: approval-mozilla-beta+
[Attachment #609492](/attachment.cgi?id=609492&action=edit "Patch") -
Flags: approval-mozilla-aurora+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=736609#c12)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/8f783fc30dd3>
<http://hg.mozilla.org/releases/mozilla-esr10/rev/14c0e5f4ad2a>
<http://hg.mozilla.org/releases/mozilla-beta/rev/07381182a1e8>
<http://hg.mozilla.org/releases/mozilla-aurora/rev/863691ed9f15>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)Target Milestone: --- → mozilla14

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a2670000_294323)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=736609#c13)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a2672705_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a5438854_1689)• 13 years ago |

Group: core-security

|  | [Scoobidiver (away)](/user_profile?user_id=386758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736609#a5442506_386758)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=736609#c14)• 13 years ago |
|  | |

Could someone please point me to directions for how to create a 32-bit opt debug shell for verification?Whiteboard: [sg:critical] → [sg:critical][qa?]

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=736609#c15)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #14](/show_bug.cgi?id=736609#c14 "VERIFIED FIXED - Malloc error with ArrayBuffer, Uint32Array and Uint8Array"))
> Could someone please point me to directions for how to create a 32-bit opt
> debug shell for verification?
Which platform (Win/Lin/Mac 10.6/10.7)?

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=736609#c16)• 13 years ago |
|  | |

Mac 10.7, I guess.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=736609#c17)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #16](/show_bug.cgi?id=736609#c16 "VERIFIED FIXED - Malloc error with ArrayBuffer, Uint32Array and Uint8Array"))
> Mac 10.7, I guess.
I run something like:
LD=ld CROSS\_COMPILE=1 CC="clang -Qunused-arguments -fcolor-diagnostics -arch i386" RANLIB=ranlib CXX="clang++ -Qunused-arguments -fcolor-diagnostics -arch i386" AS=$CC AR=ar STRIP="strip -x -S" HOST\_CC="clang -Qunused-arguments -fcolor-diagnostics" HOST\_CXX="clang++ -Qunused-arguments -fcolor-diagnostics" sh ./configure --target=i386-apple-darwin8.0.0 --enable-optimize --disable-debug
in my js/src directory. (I use Clang)
(I also removed parameters that you aren't likely to need, e.g. --enable-profiling --enable-methodjit --enable-type-inference --enable-more-deterministic --disable-tests --enable-valgrind )

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=736609#c18)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=736609&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_40c3cceb_20250125_084249.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/740595)
* [XML](/show_bug.cgi?ctype=xml&id=740595)

Closed
[Bug 740595](/show_bug.cgi?id=740595)

Opened 13 years ago
Closed 13 years ago

# "Assertion failure: [infer failure] Missing type pushed 0:"

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"Assertion failure: [infer failure] Missing type pushed 0:"

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla12

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | + | fixed |
| firefox13 | + | verified |
| firefox14 | + | verified |
| firefox-esr10 | 12+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[670185](/show_bug.cgi?id=670185 "RESOLVED FIXED - TI: Lazily create type objects for singleton JS objects")

Dependency [tree](/showdependencytree.cgi?id=740595&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=740595)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, testcase, Whiteboard: [sg:critical][qa!] js-triage-needed)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!] js-triage-needed

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c17 "12 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=610679)  [13 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   4.64 KB, text/plain |  | [Details](/attachment.cgi?id=610679&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=613384)  [13 years ago](#c1)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1018 bytes, patch | luke : [review+](#c2 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c7 "13 years ago")  akeybl : [approval-mozilla-beta+](#c7 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c7 "13 years ago") | [Details](/attachment.cgi?id=613384&action=edit) | [Diff](/attachment.cgi?id=613384&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=740595&attachment=613384) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=740595#c0)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=610679)
— [Details](attachment.cgi?id=610679&action=edit)

MLList.prototype.(Function)
asserts js debug shell on m-c changeset 92fe907ddac8 with -m, -a and -n at Assertion failure: [infer failure] Missing type pushed 0: [0xf7400180],
s-s because infer failures are bad, assuming worse case [sg:critical].
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 76042:b769a2b79e6b
user: Brian Hackett
date: Fri Jul 15 10:14:07 2011 -0700
summary: [INFER] Lazily create type objects for singleton JS objects, [bug 670185](/show_bug.cgi?id=670185 "RESOLVED FIXED - TI: Lazily create type objects for singleton JS objects").

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=740595#a601226_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=740595#a601242_1689)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=740595#c1)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=613384&action=diff)
— [Details](attachment.cgi?id=613384&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=740595&attachment=613384)

Treat FILTER/ENDFILTER as unknown. Sorry about the delay here.Assignee: general → bhackett1024
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: review?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=740595#c2)• 13 years ago |
|  | |

Comment on [attachment 613384](/attachment.cgi?id=613384 "patch") [[details]](/attachment.cgi?id=613384&action=edit "patch") [[diff]](/attachment.cgi?id=613384&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=740595&attachment=613384)
patch
<http://mozillamemes.tumblr.com/post/20381316930/inspired-by-a-bugfix-which-caused-a>
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: review?(luke) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=740595#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/d32163dc9902>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=740595#c4)• 13 years ago |
|  | |

Comment on [attachment 613384](/attachment.cgi?id=613384 "patch") [[details]](/attachment.cgi?id=613384&action=edit "patch") [[diff]](/attachment.cgi?id=613384&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=740595&attachment=613384)
patch
[Approval Request Comment]
User impact if declined: Potential, difficult to exploit vulnerability.
Risk to taking this patch (and alternatives if risky): None.
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-esr10?
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=740595#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/d32163dc9902>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=740595#c6)• 13 years ago |
|  | |

Since it's a small, safe fix we should take it on branches: a single-line testcase could easily be discovered by other people's fuzzers.
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=740595#c7)• 13 years ago |
|  | |

Comment on [attachment 613384](/attachment.cgi?id=613384 "patch") [[details]](/attachment.cgi?id=613384&action=edit "patch") [[diff]](/attachment.cgi?id=613384&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=740595&attachment=613384)
patch
(In reply to Daniel Veditz [:dveditz] from [comment #6](/show_bug.cgi?id=740595#c6 "VERIFIED FIXED - \"Assertion failure: [infer failure] Missing type pushed 0:\""))
> Since it's a small, safe fix we should take it on branches: a single-line
> testcase could easily be discovered by other people's fuzzers.
Agreed. Approving for all branches.
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-esr10?
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-esr10+
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #613384](/attachment.cgi?id=613384&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=740595#c8)• 13 years ago |
|  | |

Resolving fixed since it is on mozilla central.Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=740595#c9)• 13 years ago |
|  | |

> Resolving fixed since it is on mozilla central.
<http://hg.mozilla.org/mozilla-central/rev/d32163dc9902>
Thanks for helping to resolve. It would be great if one could add the hgweb link of the landing on mozilla-central too. :)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=740595#c10)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=740595#a1220858_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=740595#c11)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/7dfac7263e72>
<https://hg.mozilla.org/releases/mozilla-beta/rev/0f0c508e014d>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=740595#c12)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #10](/show_bug.cgi?id=740595#c10 "VERIFIED FIXED - \"Assertion failure: [infer failure] Missing type pushed 0:\""))
> JSBugMon: This bug has been automatically verified fixed.
I love this tool.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=740595#c13)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-esr10/rev/cb77dd01451f>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=740595#a1354718_346231)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Target Milestone: --- → mozilla12

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=740595#a1541291_279076)• 13 years ago |

Whiteboard: [sg:critical] js-triage-needed → [sg:critical][qa+] js-triage-needed

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=740595#c14)• 13 years ago |
|  | |

Verified fixed for esr10 using 2012-04-16 mozilla-esr10 js-shell
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=740595#a4317407_1689)• 13 years ago |

Group: core-security

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=740595#c15)• 13 years ago |
|  | |

Ubuntu 11.10 32bit
Verified that the testcase from [comment #0](/show_bug.cgi?id=740595#c0 "VERIFIED FIXED - \"Assertion failure: [infer failure] Missing type pushed 0:\"") produces no assertion with latest mozilla-beta revision (8072115a9e89)
Marking verified for Firefox 13
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=740595#c16)• 13 years ago |
|  | |

Ubuntu 11.10 32bit
Verified that the testcase from [comment #0](/show_bug.cgi?id=740595#c0 "VERIFIED FIXED - \"Assertion failure: [infer failure] Missing type pushed 0:\"") produces no assertion with Firefox 14 beta 6 (revision 89ec8943347a)
Marking verified for Firefox 14
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] js-triage-needed → [sg:critical][qa!] js-triage-needed

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=740595#c17)• 12 years ago |
|  | |

E4X has been removed, in-testsuite-.Flags: in-testsuite-
You need to [log in](/show_bug.cgi?id=740595&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_5cb0a65e_20250125_084238.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/736589)
* [XML](/show_bug.cgi?ctype=xml&id=736589)

Closed
[Bug 736589](/show_bug.cgi?id=736589)

Opened 13 years ago
Closed 13 years ago

# Crash [@ nsDOMStorage::GetNamedItem] with sessionStorage, GC

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsDOMStorage::GetNamedItem] with sessionStorage, GC

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | + | verified |
| firefox13 | + | verified |
| firefox14 | + | verified |
| firefox-esr10 | 12+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: mayhemer)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [mayhemer](/user_profile?user_id=269762)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsDOMStorage::GetNamedItem ]](https://crash-stats.mozilla.org/signature/?signature=nsDOMStorage%3A%3AGetNamedItem)

[[@ nsDOMStorage::CacheStoragePermissions ]](https://crash-stats.mozilla.org/signature/?signature=nsDOMStorage%3A%3ACacheStoragePermissions)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [testcase (requires extension for GC)](/attachment.cgi?id=606719)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   297 bytes, text/html |  | [Details](/attachment.cgi?id=606719&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=606720)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   5.96 KB, text/plain |  | [Details](/attachment.cgi?id=606720&action=edit) |
| [v1 for m-c and m-a](/attachment.cgi?id=609555)  [13 years ago](#c6)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   6.33 KB, patch | jst : [review+](#a897565_12352 "13 years ago")  akeybl : [approval-mozilla-aurora+](#a1132563_425645 "13 years ago")  mayhemer : [checkin+](#c19 "13 years ago") | [Details](/attachment.cgi?id=609555&action=edit) | [Diff](/attachment.cgi?id=609555&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609555) |
| [v1 for m-b and m-r](/attachment.cgi?id=609571)  [13 years ago](#c7)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   7.02 KB, patch | jst : [review+](#a898091_12352 "13 years ago") | [Details](/attachment.cgi?id=609571&action=edit) | [Diff](/attachment.cgi?id=609571&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609571) |
| [v1.1 for m-b and m-r](/attachment.cgi?id=609929)  [13 years ago](#c11)  [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)   7.17 KB, patch | mayhemer : [review+](#c11 "13 years ago")  akeybl : [approval-mozilla-beta+](#c18 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c23 "13 years ago")  mayhemer : [checkin+](#c20 "13 years ago") | [Details](/attachment.cgi?id=609929&action=edit) | [Diff](/attachment.cgi?id=609929&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=736589#c0)• 13 years ago |
|  | |

Attached file
[testcase (requires extension for GC)](attachment.cgi?id=606719)
— [Details](attachment.cgi?id=606719&action=edit)

1. Install <https://www.squarefree.com/extensions/domFuzzLite3.xpi>
2. Load the testcase
3. Click the button
Result: Firefox crashes in one of the following ways:
[@ nsDOMStorage::GetNamedItem] calling a random address
[@ nsDOMStorage::CacheStoragePermissions] accessing null

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=736589#c1)• 13 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=606720)
— [Details](attachment.cgi?id=606720&action=edit)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a253030_269762)• 13 years ago |

Assignee: nobody → honzab.moz

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=736589#c2)• 13 years ago |
|  | |

Thanks a lot for the test case!
I identified the cause and I more or less know how to fix this.
I can crash consistently on access to deleted mSecurityChecker that is a raw non-addrefing pointer.
I can see we create nsDOMStorage2 and set its mStorage to a new nsDOMStorage that gets set mSecurityChecker to the nsDOMStorage2 instance. Later we fork nsDOMStorage2 to a new nsDOMStorage2 instance (the forking mechanism is part of storage event implementation). Later the first nsDOMStorage2 instance get released (no longer needed). But we still refer it in nsDOMStorage->mSecurityChecker.
A valid fix is to fix [bug 732708](/show_bug.cgi?id=732708 "RESOLVED FIXED - Remove globalStorage artifacts"). But that is not acceptable on branches since depends on removal of globalStorage ([bug 687579](/show_bug.cgi?id=687579 "RESOLVED FIXED - Remove support for globalStorage")).
Solutions for branches:
- change the mSecurityChecker referencing (either addref it when not |this| or let forks ref the original instance) / easy+dangerous
- change the algorithm for security decision ; there is also mEventBroadcaster (also about to be removed as part of [bug 732708](/show_bug.cgi?id=732708 "RESOLVED FIXED - Remove globalStorage artifacts")) that could suffer the same way, so needs to be changed as well / more work+saferStatus: NEW → ASSIGNED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a420969_1689)• 13 years ago |

Whiteboard: [sg:critical]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a516411_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=736589#c3)• 13 years ago |
|  | |

If [bug 732708](/show_bug.cgi?id=732708 "RESOLVED FIXED - Remove globalStorage artifacts") is coming soon (say Firefox 13, the release globalStorage was removed) we could go with easy+dangerous for Firefox 12. If [bug 732708](/show_bug.cgi?id=732708 "RESOLVED FIXED - Remove globalStorage artifacts") is going to take a while then we should go with "more work+safer".

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=736589#c4)• 13 years ago |
|  | |

I have a wip patch that needs testing and actually a separate slightly modified version for each channel. But it is doable.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=736589#c5)• 13 years ago |
|  | |

Try run for mozilla-central (just fresh):
<https://tbpl.mozilla.org/?tree=Try&rev=42c9415848a2>

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a868205_425645)• 13 years ago |

[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=736589#c6)• 13 years ago |
|  | |

Attached patch

[v1 for m-c and m-a](attachment.cgi?id=609555&action=diff)
— [Details](attachment.cgi?id=609555&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609555)

This applies cleanly to aurora (13) as well. There had been two bugs interfering with this landed on version 13: [bug 495337](/show_bug.cgi?id=495337 "RESOLVED FIXED - Make sessionStorage use principals instead of string domains.") and [bug 687579](/show_bug.cgi?id=687579 "RESOLVED FIXED - Remove support for globalStorage").
So I need a bit different patch for version 12 and 11 (beta and release).
[Attachment #609555](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") -
Flags: review?(jst)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=736589#c7)• 13 years ago |
|  | |

Attached patch

[v1 for m-b and m-r](attachment.cgi?id=609571&action=diff) (obsolete)
— [Details](attachment.cgi?id=609571&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609571)

This preserves security check for globalStorage and sessionStorage using just domain, as we currently do on Beta and Release channels.
[Attachment #609571](/attachment.cgi?id=609571&action=edit "v1 for m-b and m-r") -
Flags: review?(jst)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=736589#c8)• 13 years ago |
|  | |

(I cannot push to try, some ssh server issues)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=736589#c9)• 13 years ago |
|  | |

Comment on [attachment 609571](/attachment.cgi?id=609571 "v1 for m-b and m-r") [[details]](/attachment.cgi?id=609571&action=edit "v1 for m-b and m-r") [[diff]](/attachment.cgi?id=609571&action=diff "v1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609571)
v1 for m-b and m-r
<https://tbpl.mozilla.org/?tree=Try&rev=1d2d565ecd0d>

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=736589#c10)• 13 years ago |
|  | |

Comment on [attachment 609571](/attachment.cgi?id=609571 "v1 for m-b and m-r") [[details]](/attachment.cgi?id=609571&action=edit "v1 for m-b and m-r") [[diff]](/attachment.cgi?id=609571&action=diff "v1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609571)
v1 for m-b and m-r
<https://tbpl.mozilla.org/?tree=Try&rev=d368596306d3> (m-r)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a897565_12352)• 13 years ago |

[Attachment #609555](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") -
Flags: review?(jst) → review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a898091_12352)• 13 years ago |

[Attachment #609571](/attachment.cgi?id=609571&action=edit "v1 for m-b and m-r") -
Flags: review?(jst) → review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=736589#c11)• 13 years ago |
|  | |

Attached patch

[v1.1 for m-b and m-r](attachment.cgi?id=609929&action=diff)
— [Details](attachment.cgi?id=609929&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)

Linux didn't like missing return for default: case. Otherwise identical to v1.
Try for this particular patch: <https://tbpl.mozilla.org/?tree=Try&rev=37902a4693f9> (on m-b branch)
[Attachment #609571](/attachment.cgi?id=609571&action=edit "v1 for m-b and m-r") -
Attachment is obsolete: true
[Attachment #609929](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") -
Flags: review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=736589#c12)• 13 years ago |
|  | |

Comment on [attachment 609555](/attachment.cgi?id=609555 "v1 for m-c and m-a") [[details]](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") [[diff]](/attachment.cgi?id=609555&action=diff "v1 for m-c and m-a") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609555)
v1 for m-c and m-a
[Approval Request Comment]
Regression caused by (bug #): 495112
User impact if declined: potentially exploitable crash
Testing completed (on m-c, etc.): none so far landed, now having only try results
Risk to taking this patch (and alternatives if risky): low, the logic is identical, just not using unsafe dereference anymore
String changes made by this patch: none
[Attachment #609555](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") -
Flags: approval-mozilla-aurora?

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=736589#c13)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
[Approval Request Comment]
Regression caused by (bug #): 495112
User impact if declined: potentially exploitable crash
Testing completed (on m-c, etc.): none so far, now having only try results (this patch is for beta and release only, so it cannot be tested on m-c or m-a)
Risk to taking this patch (and alternatives if risky): low, the logic is identical, just not using unsafe dereference anymore
String changes made by this patch: none
[Attachment #609929](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") -
Flags: approval-mozilla-beta?

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=736589#c14)• 13 years ago |
|  | |

Side note: there is also mEventBroadcaster member (raw ptr). That is safe to use, since it is either null or set immediately before use to an object valid for the time of the operation with mEventBroadcaster.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=736589#c15)• 13 years ago |
|  | |

Comment on [attachment 609555](/attachment.cgi?id=609555 "v1 for m-c and m-a") [[details]](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") [[diff]](/attachment.cgi?id=609555&action=diff "v1 for m-c and m-a") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609555)
v1 for m-c and m-a
<https://hg.mozilla.org/integration/mozilla-inbound/rev/3eea0725665e>

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=736589#c16)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
<https://tbpl.mozilla.org/?tree=Try&rev=e011283d7a2e> (m-b, android, xul)

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=736589#c17)• 13 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #15](/show_bug.cgi?id=736589#c15 "VERIFIED FIXED - Crash [@ nsDOMStorage::GetNamedItem] with sessionStorage, GC"))
> Comment on [attachment 609555](/attachment.cgi?id=609555 "v1 for m-c and m-a") [[details]](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") [[diff]](/attachment.cgi?id=609555&action=diff "v1 for m-c and m-a") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609555)
> v1 for m-c and m-a
>
> <https://hg.mozilla.org/integration/mozilla-inbound/rev/3eea0725665e>
<https://hg.mozilla.org/mozilla-central/rev/3eea0725665e>Status: ASSIGNED → RESOLVEDClosed: 13 years ago
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla14

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=736589#c18)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
[Triage Comment]
Approved for Beta 12 and Aurora 13 - we need to make sure to land this on the ESR branch as well, since 10.0.4 will be shipped simultaneously with FF12.
[Attachment #609929](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a1132563_425645)• 13 years ago |

[Attachment #609555](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a1132614_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=736589#c19)• 13 years ago |
|  | |

Comment on [attachment 609555](/attachment.cgi?id=609555 "v1 for m-c and m-a") [[details]](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") [[diff]](/attachment.cgi?id=609555&action=diff "v1 for m-c and m-a") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609555)
v1 for m-c and m-a
<https://hg.mozilla.org/releases/mozilla-aurora/rev/b5ac0b502079>
[Attachment #609555](/attachment.cgi?id=609555&action=edit "v1 for m-c and m-a") -
Flags: checkin+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=736589#c20)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
<https://hg.mozilla.org/releases/mozilla-beta/rev/be73dfc96f93>
[Attachment #609929](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") -
Flags: checkin+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=736589#c21)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
Try on esr10:
<https://tbpl.mozilla.org/?tree=Try&rev=400d24cd8799>

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=736589#c22)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
<https://hg.mozilla.org/releases/mozilla-esr10/rev/cea3a82f3f24>
(In reply to Alex Keybl [:akeybl] from [comment #18](/show_bug.cgi?id=736589#c18 "VERIFIED FIXED - Crash [@ nsDOMStorage::GetNamedItem] with sessionStorage, GC"))
> Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
> v1.1 for m-b and m-r
>
> [Triage Comment]
> Approved for Beta 12 and Aurora 13 - we need to make sure to land this on
> the ESR branch as well, since 10.0.4 will be shipped simultaneously with
> FF12.
I took this as a+ for esr10, but now I spot the flag. I presume it should be set (postfacto, sorry).
[Attachment #609929](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") -
Flags: approval-mozilla-esr10?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a1547467_425645)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=736589#c23)• 13 years ago |
|  | |

Comment on [attachment 609929](/attachment.cgi?id=609929 "v1.1 for m-b and m-r") [[details]](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") [[diff]](/attachment.cgi?id=609929&action=diff "v1.1 for m-b and m-r") [[review]](/page.cgi?id=splinter.html&ignore=&bug=736589&attachment=609929)
v1.1 for m-b and m-r
[Triage Comment]
post-facto a+ :)
[Attachment #609929](/attachment.cgi?id=609929&action=edit "v1.1 for m-b and m-r") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a1559701_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a1822295_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Huzaifa Sidhpurwala](/user_profile?user_id=331752) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=736589#c24)• 13 years ago |
|  | |

any CVE for this one?

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a3287736_18566)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a5441820_1689)• 13 years ago |

Group: core-security

|  | [Vlad [QA]](/user_profile?user_id=408941) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=736589#c25)• 13 years ago |
|  | |

This bug has to be verified on a debug build?
I've followed the steps from the description on Firefox 11 beta and I didn't got no crash, so I'm guessing that I'm doing something wrong.
Tracy can you help with some clarifications?
Thanks

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=736589#c26)• 13 years ago |
|  | |

If no crash occurred when clicking the "Start test" button of the test case, then that is verified fixed.Status: RESOLVED → VERIFIED
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a5679103_18566)• 13 years ago |

Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=736589#c27)• 13 years ago |
|  | |

Verified fixed in Firefox 10.0.6esrpre 2012-06-21.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=736589#a220553550_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=736589&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.debian.org_3775f10c_20250125_084144.html ===

[![Debian](./Pics/openlogo-50.png)](./ "Debian Home")

[Skip Quicknav](#content)

* [Blog](https://bits.debian.org/ "Bits from Debian")
* [Micronews](https://micronews.debian.org "Micronews from Debian")
* [Planet](https://planet.debian.org/ "The Planet of Debian")

# Debian

# The Community

## Debian is a Community of People!

### DC24 Group Photo

![DebConf23 Group Photo](Pics/debconf24_group_photo.jpg)

### MiniDebConf Berlin 2024

![Group photo of the MiniDebConf Berlin 2024](Pics/mini-dc24-berlin.jpg)

### MiniDebConf BrasÃ­lia 2023

![Group photo of the MiniDebConf BrasÃ­lia 2023](Pics/mini-dc23-brasilia.jpg)

### Screenshot Calamares Installer

![Screenshot from the Calamares installer](Pics/calamares-bookworm.png)

### Debian is like a Swiss Army Knife

![Debian is like a Swiss Army Knife](Pics/debian-swiss-knife-hands-1024x576.jpg)

### People have fun with Debian

![Debian people at Debconf18 in Hsinchu really having fun](Pics/debian-funny-people-1024x576.jpg)

[![](Pics/users.svg)](intro/people)

## [People](intro/people)

Who we are and what we do

[![](Pics/heartbeat.svg)](intro/philosophy)

## [Our Philosophy](intro/philosophy)

Why we do it, and how we do it

[![](Pics/user-plus.svg)](devel/join/)

## [Get Involved, Contribute](devel/join/)

How you can join us!

[![](Pics/list.svg)](intro/index#community)

## [More...](intro/index#community)

Additional information about the Debian community

# The Operating System

## Debian is a complete Free Operating System!

![Debian](Pics/debian-logo-1024x576.png)
[Download](https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.9.0-amd64-netinst.iso)
[Other downloads](distrib)

[![](Pics/trophy.svg)](intro/why_debian)

## [Why Debian](intro/why_debian)

What makes Debian special

[![](Pics/life-ring.svg)](support)

## [User Support](support)

Getting help and documentation

[![](Pics/security.svg)](security/)

## [Security Updates](security/)

Debian Security Advisories (DSA)

[![](Pics/list.svg)](intro/index#software)

## [More...](intro/index#software)

Further links to downloads and software

---

# Project News

## News and Announcements about Debian

17January2025[The Debian Project mourns the loss of Steve Langasek (vorlon)](News/2025/20250117)
11January2025[Updated Debian 12: 12.9 released](News/2025/20250111)
19November2024[The Debian Project mourns the loss of JÃ©rÃ©my Bobbio (Lunar)](News/2024/20241119)
31August2024[Updated Debian 11: 11.11 released](News/2024/2024083102)
14August2024[Security support for Bullseye handed over to the LTS team](News/2024/20240814)

[All the news](News)
[RSS](News/news)

---

This page is also available in the following languages:
Select your language
català
dansk
Deutsch
español
français
Galego
Indonesia
Italiano
magyar
Nederlands
norsk (bokmål)
polski
Português
suomi
svenska
Tiếng Việt
Български (Bəlgarski)
Русский (Russkij)
українська (ukrajins'ka)
عربية (Arabiya)
中文(简)
中文(HK)
中文(繁)
한국어 (Korean)
Ελληνικά (Ellinika)
فارسی (Farsi)

How to set [the default document language](./intro/cn)

---

See our [contact page](./contact) to get in touch. Web site source code is [available](https://salsa.debian.org/webmaster-team/webwml).

Last Modified: Sat, Sep 16 13:09:56 UTC 2023

Last Built: Sun, Jan 19 23:26:10 UTC 2025

Copyright © 1997-2025 [SPI](https://www.spi-inc.org/) and others; See [license terms](./license)

Debian is a registered [trademark](./trademark) of Software in the Public Interest, Inc.



=== Content from bugzilla.mozilla.org_fa633b03_20250125_084157.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/723453)
* [XML](/show_bug.cgi?ctype=xml&id=723453)

Closed
[Bug 723453](/show_bug.cgi?id=723453)

Opened 13 years ago
Closed 13 years ago

# Heap overrun (read + write) in nsBMPEncoder::ConvertHostARGBRow

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Heap overrun (read + write) in nsBMPEncoder::ConvertHostARGBRow

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla13

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox14 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jseward, Assigned: jgilbert)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5edb95922c89f29d92b7febcba5669de?d=mm&size=40)  [jseward](/user_profile?user_id=346453)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[650720](/show_bug.cgi?id=650720 "RESOLVED FIXED - [HTML5] canvas.toDataURL(\"image/jpeg\") should composite onto black")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=723453&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=723453)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: valgrind, Whiteboard: [sg:vector-critical (gcc)][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[valgrind](/buglist.cgi?keywords=valgrind&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:vector-critical (gcc)][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Split out the 32-bit case from ConvertHostARGB](/attachment.cgi?id=595172)  [13 years ago](#c6)  [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)   1.88 KB, patch | joe : [review+](#a724553_94 "13 years ago")  akeybl : [approval-mozilla-beta+](#c16 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c16 "13 years ago") | [Details](/attachment.cgi?id=595172&action=edit) | [Diff](/attachment.cgi?id=595172&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=723453&attachment=595172) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=723453#c0)• 13 years ago |
|  | |

x86\_64-linux, running on a 16 bit deep vnc server.
TEST\_PATH=content/canvas/test/test\_toDataURL\_alpha.html
(DISPLAY=:1 TEST\_PATH=content/canvas/test/test\_toDataURL\_alpha.html make -C ff-opt mochitest-plain EXTRA\_TEST\_ARGS='--close-when-done --debugger=vTRUNK --debugger-args="--tool=memcheck --suppressions=/home/sewardj/MOZ/fglrx-supp.supp --suppressions=/home/sewardj/MOZ/moz-supp.supp --error-limit=no --stats=yes --smc-check=all-non-file --trace-children=yes --child-silent-after-fork=yes '--trace-children-skip=/usr/bin/hg,/bin/rm,\*/bin/certutil,\*/bin/pk12util,\*/bin/ssltunnel' --track-origins=no"') 2>&1 | tee spew2-memcheck-1
produces the errors below -- looks like a read-modify-write of an invalid address
Invalid read of size 1
at 0x808209D: nsBMPEncoder::ConvertHostARGBRow(unsigned char const\*, unsigned char\*, unsigned int) (nsBMPEncoder.cpp:450)
by 0x80828CD: nsBMPEncoder::AddImageFrame(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (nsBMPEncoder.cpp:228)
by 0x8081EE9: nsBMPEncoder::InitFromData(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (nsBMPEncoder.cpp:107)
by 0x835111B: nsCanvasRenderingContext2D::GetInputStream(char const\*, unsigned short const\*, nsIInputStream\*\*) (nsCanvasRenderingContext2D.cpp:1345)
by 0x83E9C9D: nsHTMLCanvasElement::ExtractData(nsAString\_internal const&, nsAString\_internal const&, nsIInputStream\*\*, bool&) (nsHTMLCanvasElement.cpp:247)
by 0x83EA1B2: nsHTMLCanvasElement::ToDataURLImpl(nsAString\_internal const&, nsIVariant\*, nsAString\_internal&) (nsHTMLCanvasElement.cpp:340)
by 0x88607FA: nsIDOMHTMLCanvasElement\_ToDataURL(JSContext\*, unsigned int, JS::Value\*) (dom\_quickstubs.cpp:17910)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
by 0x908762D: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2801)
by 0x908DACC: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jsinterp.cpp:537)
by 0x90554C2: js\_fun\_apply(JSContext\*, unsigned int, JS::Value\*) (jsinterp.h:157)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
Address 0x201e63ac is 0 bytes after a block of size 300 alloc'd
at 0x4C28223: malloc (vg\_replace\_malloc.c:263)
by 0x8082787: nsBMPEncoder::AddImageFrame(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (mozalloc.h:309)
by 0x8081EE9: nsBMPEncoder::InitFromData(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (nsBMPEncoder.cpp:107)
by 0x835111B: nsCanvasRenderingContext2D::GetInputStream(char const\*, unsigned short const\*, nsIInputStream\*\*) (nsCanvasRenderingContext2D.cpp:1345)
by 0x83E9C9D: nsHTMLCanvasElement::ExtractData(nsAString\_internal const&, nsAString\_internal const&, nsIInputStream\*\*, bool&) (nsHTMLCanvasElement.cpp:247)
by 0x83EA1B2: nsHTMLCanvasElement::ToDataURLImpl(nsAString\_internal const&, nsIVariant\*, nsAString\_internal&) (nsHTMLCanvasElement.cpp:340)
by 0x88607FA: nsIDOMHTMLCanvasElement\_ToDataURL(JSContext\*, unsigned int, JS::Value\*) (dom\_quickstubs.cpp:17910)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
by 0x908762D: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2801)
by 0x908DACC: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jsinterp.cpp:537)
by 0x90554C2: js\_fun\_apply(JSContext\*, unsigned int, JS::Value\*) (jsinterp.h:157)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
Invalid write of size 1
at 0x80820A6: nsBMPEncoder::ConvertHostARGBRow(unsigned char const\*, unsigned char\*, unsigned int) (nsBMPEncoder.cpp:450)
by 0x80828CD: nsBMPEncoder::AddImageFrame(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (nsBMPEncoder.cpp:228)
by 0x8081EE9: nsBMPEncoder::InitFromData(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (nsBMPEncoder.cpp:107)
by 0x835111B: nsCanvasRenderingContext2D::GetInputStream(char const\*, unsigned short const\*, nsIInputStream\*\*) (nsCanvasRenderingContext2D.cpp:1345)
by 0x83E9C9D: nsHTMLCanvasElement::ExtractData(nsAString\_internal const&, nsAString\_internal const&, nsIInputStream\*\*, bool&) (nsHTMLCanvasElement.cpp:247)
by 0x83EA1B2: nsHTMLCanvasElement::ToDataURLImpl(nsAString\_internal const&, nsIVariant\*, nsAString\_internal&) (nsHTMLCanvasElement.cpp:340)
by 0x88607FA: nsIDOMHTMLCanvasElement\_ToDataURL(JSContext\*, unsigned int, JS::Value\*) (dom\_quickstubs.cpp:17910)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
by 0x908762D: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2801)
by 0x908DACC: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jsinterp.cpp:537)
by 0x90554C2: js\_fun\_apply(JSContext\*, unsigned int, JS::Value\*) (jsinterp.h:157)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
Address 0x201e63ac is 0 bytes after a block of size 300 alloc'd
at 0x4C28223: malloc (vg\_replace\_malloc.c:263)
by 0x8082787: nsBMPEncoder::AddImageFrame(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (mozalloc.h:309)
by 0x8081EE9: nsBMPEncoder::InitFromData(unsigned char const\*, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int, nsAString\_internal const&) (nsBMPEncoder.cpp:107)
by 0x835111B: nsCanvasRenderingContext2D::GetInputStream(char const\*, unsigned short const\*, nsIInputStream\*\*) (nsCanvasRenderingContext2D.cpp:1345)
by 0x83E9C9D: nsHTMLCanvasElement::ExtractData(nsAString\_internal const&, nsAString\_internal const&, nsIInputStream\*\*, bool&) (nsHTMLCanvasElement.cpp:247)
by 0x83EA1B2: nsHTMLCanvasElement::ToDataURLImpl(nsAString\_internal const&, nsIVariant\*, nsAString\_internal&) (nsHTMLCanvasElement.cpp:340)
by 0x88607FA: nsIDOMHTMLCanvasElement\_ToDataURL(JSContext\*, unsigned int, JS::Value\*) (dom\_quickstubs.cpp:17910)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)
by 0x908762D: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2801)
by 0x908DACC: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jsinterp.cpp:537)
by 0x90554C2: js\_fun\_apply(JSContext\*, unsigned int, JS::Value\*) (jsinterp.h:157)
by 0x908D9D6: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:311)

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a10458_346453)• 13 years ago |

Keywords: [valgrind](/buglist.cgi?keywords=valgrind&resolution=---)

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=723453#c1)• 13 years ago |
|  | |

Given that the offending line, allegedly nsBMPEncoder.cpp:450 is
if (mBMPInfoHeader.bpp == 32) {
pixelOut[3] = alpha; // line 450
}
it seems odd that there's invalid read as well as an invalid write.
It looks as if gcc has compiled it as if it were
pixelOut[3] = mBMPInfoHeader.bpp == 32 ? alpha : pixelOut[3];
which is bizarre, and (I thought) disallowed by the C++11 memory model.
862096: 66 83 7f 2a 20 cmpw $0x20,0x2a(%rdi)
86209b: 74 05 je 8620a2
<\_ZN12nsBMPEncoder18ConvertHostARGBRowEPKhPhj+0x52>
86209d: 44 0f b6 50 03 movzbl 0x3(%rax),%r10d
8620a2: 49 83 c0 01 add $0x1,%r8
8620a6: 44 88 50 03 mov %r10b,0x3(%rax)

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=723453#c2)• 13 years ago |
|  | |

Jeff is working on changing a lot of the ARGB conversion code, so he should be aware of this.
Brian did a significant amount of work on the BMP encoder; perhaps he has some ideas?

|  | [Bas Schouten (:bas.schouten)](/user_profile?user_id=272464) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=723453#c3)• 13 years ago |
|  | |

I have to agree with Julian on this one. This seems to be gcc compiling to illegal code. I can see why this would be a useful optimization if pixelOut[3] were a legal address. But since it is perfectly fine in this case for that to only be a valid address when mBMPInfoHeader.bpp == 32 it cannot make that assumption.

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=723453#c4)• 13 years ago |
|  | |

Ah; slight misunderstanding. I was merely trying to figure out why
pixelOut[3] = alpha; lead to a read as well as a write. But now Bas
points it out, perhaps we have no error at all, and both the invalid
read and write are caused gcc's code generation strategy.
In fact, if our code was really broken, we'd only see an invalid
write. The invalid (read,write) pair implies gcc is broken. I wonder
if there's a gcc bug open on this. This was with vanilla 4.6.2, built
from source, building Fx at -O2 (IIRC).

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=723453#c5)• 13 years ago |
|  | |

This is annoying, but at least the workaround should be easy.
The worrisome part is that this meme is not uncommon. Generally, you don't want to put a branch in the loop, but when we choose to, we shouldn't need to worry about an invalid access popping out of a branch.
Can we reduce the testcase and file a GCC bug?

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=723453#c6)• 13 years ago |
|  | |

Attached patch

[Split out the 32-bit case from ConvertHostARGB](attachment.cgi?id=595172&action=diff)
— [Details](attachment.cgi?id=595172&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=723453&attachment=595172)

This should do it.Assignee: nobody → jgilbertStatus: NEW → ASSIGNED
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: review?(joe)

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a724553_94)• 13 years ago |

[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: review?(joe) → review+

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=723453#c7)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/b84e21604bc4>Target Milestone: --- → mozilla13

|  | [Rafael Ávila de Espíndola (:espindola) (not reading bugmail)](/user_profile?user_id=402561) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=723453#c8)• 13 years ago |
|  | |

> Can we reduce the testcase and file a GCC bug?
I started a build of firefox to try to reproduce this, but if someone has a .ii file and the necessary command line, that would save some time.

|  | [Rafael Ávila de Espíndola (:espindola) (not reading bugmail)](/user_profile?user_id=402561) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=723453#c9)• 13 years ago |
|  | |

This reproduces with just
void
foo(char\* aDest, int y)
{
aDest[0] = 41;
if (y == 32) {
aDest[1] = 42;
}
}
and
/usr/libexec/gcc/x86\_64-redhat-linux/4.6.2/cc1plus test.ii -quiet -Os -o nsBMPEncoder.s
This doesn't happen with our gcc, it produces:
\_Z3fooPci:
.LFB0:
cmpl $32, %esi
movb $41, (%rdi)
jne .L1
movb $42, 1(%rdi)
.L1:
ret
Should we make this bug block one about upgrading gcc?

|  | [Rafael Ávila de Espíndola (:espindola) (not reading bugmail)](/user_profile?user_id=402561) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=723453#c10)• 13 years ago |
|  | |

This still reproduces with gcc trunk [r184188](https://viewvc.svn.mozilla.org/vc?view=rev&revision=184188).

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=723453#c11)• 13 years ago |
|  | |

Looks like this made it to m-c a month ago (shortly after the inbound landing in [comment 7](/show_bug.cgi?id=723453#c7 "RESOLVED FIXED - Heap overrun (read + write) in nsBMPEncoder::ConvertHostARGBRow")):
<https://hg.mozilla.org/mozilla-central/rev/b84e21604bc4>
(I'll leave it to someone else to determine whether this should be RESOLVED|FIXED, given [comment 10](/show_bug.cgi?id=723453#c10 "RESOLVED FIXED - Heap overrun (read + write) in nsBMPEncoder::ConvertHostARGBRow"))

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=723453#c12)• 13 years ago |
|  | |

I'm calling this fixed based on the workaround checkin, although it's troubling we probably have more places like this. Although we do run Valgrind a fair bit and don't seem to hit this that I've seen.
Do we need a separate bug to track the gcc issue or did we file a bug in their tracker? If we did please add it to the See Also fieldStatus: ASSIGNED → RESOLVEDClosed: 13 years ago
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)Resolution: --- → FIXEDWhiteboard: [sg:vector-critical (gcc)]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a3767257_1689)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=723453#c13)• 13 years ago |
|  | |

Tracking for ESR 13+, since this is first fixed on 13. Is there something we can uplift to resolve this security bug on Beta 12?
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) → [13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B)

|  | [Rafael Ávila de Espíndola (:espindola) (not reading bugmail)](/user_profile?user_id=402561) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=723453#c14)• 13 years ago |
|  | |

> Do we need a separate bug to track the gcc issue or did we file a bug in
> their tracker? If we did please add it to the See Also field
We should probably have a bug in our bugzilla so that we can block upgrading gcc on it.

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=723453#c15)• 13 years ago |
|  | |

Comment on [attachment 595172](/attachment.cgi?id=595172 "Split out the 32-bit case from ConvertHostARGB") [[details]](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") [[diff]](/attachment.cgi?id=595172&action=diff "Split out the 32-bit case from ConvertHostARGB") [[review]](/page.cgi?id=splinter.html&ignore=&bug=723453&attachment=595172)
Split out the 32-bit case from ConvertHostARGB
[Approval Request Comment]
Regression caused by (bug #): None.
User impact if declined: Potential security issue with BMPs.
Testing completed (on m-c, etc.): m-c, currently on aurora.
Risk to taking this patch (and alternatives if risky): Very low.
String changes made by this patch: None.
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: approval-mozilla-esr10?
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: approval-mozilla-beta?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a6005305_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=723453#c16)• 13 years ago |
|  | |

Comment on [attachment 595172](/attachment.cgi?id=595172 "Split out the 32-bit case from ConvertHostARGB") [[details]](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") [[diff]](/attachment.cgi?id=595172&action=diff "Split out the 32-bit case from ConvertHostARGB") [[review]](/page.cgi?id=splinter.html&ignore=&bug=723453&attachment=595172)
Split out the 32-bit case from ConvertHostARGB
[Triage Comment]
Approving for Beta 12 and the ESR branch given the fact that this is a critical security vulnerability and has been deemed low risk.
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: approval-mozilla-esr10?
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: approval-mozilla-esr10+
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: approval-mozilla-beta?
[Attachment #595172](/attachment.cgi?id=595172&action=edit "Split out the 32-bit case from ConvertHostARGB") -
Flags: approval-mozilla-beta+

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=723453#c17)• 13 years ago |
|  | |

Going to try to autoland this - might not get comments back here from automation because this is a security bug and our release@ account doesn't have sec-group permissions, but I will monitor this push and report back if successful.

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=723453#c18)• 13 years ago |
|  | |

(In reply to Lukas Blakk [:lsblakk] from [comment #17](/show_bug.cgi?id=723453#c17 "RESOLVED FIXED - Heap overrun (read + write) in nsBMPEncoder::ConvertHostARGBRow"))
> Going to try to autoland this - might not get comments back here from
> automation because this is a security bug and our release@ account doesn't
> have sec-group permissions, but I will monitor this push and report back if
> successful.
Autoland for security bugs doesn't currently work, so nothing has landed here - please go ahead with a normal landing.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=723453#c19)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-beta/rev/6e53f939f795>
<http://hg.mozilla.org/releases/mozilla-esr10/rev/40c57cc64bbe>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a6414128_382769)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=723453#c20)• 13 years ago |
|  | |

Sorry for the mis-push on esr10. Re-landed:
<https://hg.mozilla.org/releases/mozilla-esr10/rev/9fe4480ebd01>
What happened is the patch failed to apply and I didn't pay attention. The reject was ugly, so I copied and pasted the body of ConvertHostARGBRow from the mozilla-beta patch. Seems entirely safe...

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=723453#c21)• 13 years ago |
|  | |

Note that this changes the functionality slightly, in that we no longer zero the pixel if alpha is zero. This should have no significant effect, though.
Functionality change is from [bug 650720](/show_bug.cgi?id=650720 "RESOLVED FIXED - [HTML5] canvas.toDataURL(\"image/jpeg\") should composite onto black"):
<http://hg.mozilla.org/mozilla-central/diff/8abaa54efb2a/image/encoders/bmp/nsBMPEncoder.cpp>Depends on: [650720](/show_bug.cgi?id=650720 "RESOLVED FIXED - [HTML5] canvas.toDataURL(\"image/jpeg\") should composite onto black")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a9194913_1689)• 13 years ago |

Group: core-security

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=723453#c22)• 13 years ago |
|  | |

Julian, are you able to reproduce this bug anymore in Firefox 13.0 Beta 6?

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=723453#a12141498_279076)• 13 years ago |

Whiteboard: [sg:vector-critical (gcc)] → [sg:vector-critical (gcc)][qa-]
You need to [log in](/show_bug.cgi?id=723453&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_c2756251_20250125_084149.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/680456)
* [XML](/show_bug.cgi?ctype=xml&id=680456)

Closed
[Bug 680456](/show_bug.cgi?id=680456)

Opened 13 years ago
Closed 13 years ago

# Don't run compileAndGo scripts on globals with a cleared scope

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Don't run compileAndGo scripts on globals with a cleared scope

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla13

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | - | unaffected |
| firefox7 | - | unaffected |
| firefox8 | - | unaffected |
| firefox9 | - | wontfix |
| firefox10 | - | wontfix |
| firefox11 | - | affected |
| firefox12 | + | fixed |
| firefox13 |  | fixed |
| firefox-esr10 | 12+ | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bhackett1024, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows"), [723910](/show_bug.cgi?id=723910 "RESOLVED FIXED - Account Provisioner fails to close order form tab and report success")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[679247](/show_bug.cgi?id=679247 "RESOLVED WORKSFORME - TI: intermittent \"Assertion failure: [infer failure] Missing type pushed 0: <0x7efed65f3980>:new\" resulting in test_Scriptaculous.html | Exited with code 1 during test run"), [679599](/show_bug.cgi?id=679599 "RESOLVED WORKSFORME - TI: Frequent \"callStack.push is not a function item 1\" errors in random jsreftests"), [683756](/show_bug.cgi?id=683756 "RESOLVED INVALID - Firefox 9.0a1 Crash @ js::mjit::Assembler::objSlotRef(JSObject*"), [711695](/show_bug.cgi?id=711695 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0:"), [715149](/show_bug.cgi?id=715149 "RESOLVED FIXED - Assertion failure: [infer failure] Missing type pushed 0: void"), [730703](/show_bug.cgi?id=730703 "RESOLVED FIXED - Crash [@ js::mjit::EnterMethodJIT ] and friends")

Dependency [tree](/showdependencytree.cgi?id=680456&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=680456)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical][qa-] wanted-standalone-js)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-] wanted-standalone-js

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [partial fix](/attachment.cgi?id=592130)  [13 years ago](#c10)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   2.31 KB, patch | dmandelin : [review+](#c13 "13 years ago")  asa : [approval-mozilla-aurora+](#c21 "13 years ago")  asa : [approval-mozilla-beta-](#c21 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c24 "13 years ago") | [Details](/attachment.cgi?id=592130&action=edit) | [Diff](/attachment.cgi?id=592130&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=680456#c0)• 13 years ago |
|  | |

Clearing a global's scope wrecks a whole host of assumptions which the JITs and TI make about scripts compiled against that global. There are some guards against this when executing scripts, but these are not enough, and compileAndGo scripts can (and do) still run against the global after clearing it.
This is causing [bug 679247](/show_bug.cgi?id=679247 "RESOLVED WORKSFORME - TI: intermittent \"Assertion failure: [infer failure] Missing type pushed 0: <0x7efed65f3980>:new\" resulting in test_Scriptaculous.html | Exited with code 1 during test run") (intermittent TI tinderbox failure); I added some instrumentation, and found that a particular script is getting analyzed by inference, has its global cleared, and later on starts/resumes execution in the interpreter. When the script executes a JSOP\_LAMBDA it pushes a function with a different (reconstructed) Function.prototype, which TI assertions catch.
From cursory examination of the code, it looks like we only check for a cleared global in RunScript, and not when making inline calls from the interpreter. It seems like interpreter inline calls could cross from an uncleared global to a cleared global, with no isCleared check occurring.
I don't know if fixing this would be enough, however. Under what constraints are scopes cleared? Can scripts associated with the global have frames on the stack? Can such scripts still have mjit code? If the latter holds, this would be a problem for the full call stubs which the mjit generates, which allow mjit frames to call arbitrary scripts which have jitcode, without a cleared global check.
The real fix here is to remove scope clearing entirely ([bug 637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows")).

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a27_346231)• 13 years ago |

Summary: Don't run compileAndGo on globals with a cleared scope → Don't run compileAndGo scripts on globals with a cleared scope

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=680456#c1)• 13 years ago |
|  | |

Heh, so it seems the answer to [bug 630072 comment 113](/show_bug.cgi?id=630072#c113 "RESOLVED FIXED - quora.com bloats out of control, part 1: js_UnbrandAndClearSlots leaks") is 'yes'. I wonder if this is causing other random crashes.
peterv: I heard the major ClearScope call is going away soon, do you have a time estimate? jst indicated this call site was the major offender for scripts-run-on-cleared-globals; do you know if this is the \*sole\* source of clear-scoped globals which have script run on them?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=680456#c2)• 13 years ago |
|  | |

JS\_ClearScope is also causing the other intermittent TI tinderbox orange, [bug 679599](/show_bug.cgi?id=679599 "RESOLVED WORKSFORME - TI: Frequent \"callStack.push is not a function item 1\" errors in random jsreftests"). This case is somewhat different: JS\_ClearScope is called on Array.prototype (I have no idea why), and when code later runs in the interpreter it can't find Array.prototype.push. I'm not sure why this works on m-c, but one possibility is that the script runs in jitcode on m-c, and some assumption the jitcode makes is being subtly broken.Blocks: [679599](/show_bug.cgi?id=679599 "RESOLVED WORKSFORME - TI: Frequent \"callStack.push is not a function item 1\" errors in random jsreftests")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=680456#c3)• 13 years ago |
|  | |

> do you know if this is the \*sole\* source of clear-scoped globals
Gecko currently makes ClearScope calls in 3 places:
1) Outer windows are cleared when a new inner is being set up. Now that outer
windows are proxies that presumably have no slots, this may not be needed,
but the comments claim this was at once point needed for correctness.
2) When nulling out the docshell of an outer window. This is presumably just
leak-prevention.
3) When calling nsGlobalWindow::FreeInnerObjects. I assume this is also meant
as leak-prevention.
> JS\_ClearScope is called on Array.prototype
That's pretty odd. It should, as things stand, be called up the proto chain of the window, but not on Object.prototype.... and Array.prototype should not be there, unless someome manually munged the proto chain.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=680456#c4)• 13 years ago |
|  | |

There's also 4) When unloading a component. Also for leak prevention.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=680456#c5)• 13 years ago |
|  | |

Is this only on the TI branch or is any shipping version of Firefox affected?Depends on: [637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows")Whiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=680456#c6)• 13 years ago |
|  | |

The JS\_ClearScope() removal bug is really close to done (right, peterv?), and that removes the clearing of the global window objects completely. But there's some cases left, like storage objects and what bz and mrbkap pointed out that's still left, but they're all non-global objects AFAIK.No longer depends on: [637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows")Whiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a460777_12352)• 13 years ago |

Depends on: [637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows")Whiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a533192_12352)• 13 years ago |

[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a1062927_346231)• 13 years ago |

Blocks: [683756](/show_bug.cgi?id=683756 "RESOLVED INVALID - Firefox 9.0a1 Crash @ js::mjit::Assembler::objSlotRef(JSObject*")

|  | [Wesley W. Garland](/user_profile?user_id=122472) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a3187604_122472)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?] wanted-standalone-js

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=680456#c7)• 13 years ago |
|  | |

Do we still want to track this for 9? AFAICT, the plan is to remote ClearScope, that will obviate this bug and another one.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=680456#c8)• 13 years ago |
|  | |

(In reply to David Mandelin from [comment #7](/show_bug.cgi?id=680456#c7 "RESOLVED FIXED - Don't run compileAndGo scripts on globals with a cleared scope"))
> Do we still want to track this for 9? AFAICT, the plan is to remote
> ClearScope, that will obviate this bug and another one.
No, I think we can wait for ClearScope to be removed entirely.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a5812224_294323)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=680456#c9)• 13 years ago |
|  | |

Seems unlikely we'd remove ClearScope during beta, should we not expect this in Fx10?
Is Firefox 11 realistic?
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a10912998_346231)• 13 years ago |

Blocks: [711695](/show_bug.cgi?id=711695 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0:")

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a12028473_406847)• 13 years ago |

Whiteboard: [sg:critical?] wanted-standalone-js → [sg:critical] wanted-standalone-js

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a13238611_1689)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a13844407_1689)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a13904258_346231)• 13 years ago |

Blocks: [715149](/show_bug.cgi?id=715149 "RESOLVED FIXED - Assertion failure: [infer failure] Missing type pushed 0: void")

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=680456#c10)• 13 years ago |
|  | |

Attached patch

[partial fix](attachment.cgi?id=592130&action=diff)
— [Details](attachment.cgi?id=592130&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130)

This fixes the cases where the global is cleared when scripts have compiled code against it, and where the interpreter tries to push an inline frame for a script with a cleared global. It is still possible to run code against the global in the interpreter (no security problem there), but only for frames which were on the stack when the global was cleared. It's not clear what to do should the latter case come up, as JS\_ClearScope is infallible and I don't want to change its callers.
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: review?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a13907258_346231)• 13 years ago |

[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: review? → review?(dmandelin)

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=680456#c11)• 13 years ago |
|  | |

JS\_ClearScope should simply be eliminated. The browser is pretty much ready to drop it I think. peterv probably knows the exact status.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=680456#c12)• 13 years ago |
|  | |

(In reply to Andreas Gal :gal from [comment #11](/show_bug.cgi?id=680456#c11 "RESOLVED FIXED - Don't run compileAndGo scripts on globals with a cleared scope"))
> JS\_ClearScope should simply be eliminated. The browser is pretty much ready
> to drop it I think. peterv probably knows the exact status.
Yeah, that was my opinion in [comment 8](/show_bug.cgi?id=680456#c8 "RESOLVED FIXED - Don't run compileAndGo scripts on globals with a cleared scope"). That was 3 months ago though, I don't think there has been progress on [bug 637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows") since then, and this is a small fix which removes an existing security risk and cuts off this steady trickle of issues like [bug 715149](/show_bug.cgi?id=715149 "RESOLVED FIXED - Assertion failure: [infer failure] Missing type pushed 0: void").

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=680456#c13)• 13 years ago |
|  | |

Comment on [attachment 592130](/attachment.cgi?id=592130 "partial fix") [[details]](/attachment.cgi?id=592130&action=edit "partial fix") [[diff]](/attachment.cgi?id=592130&action=diff "partial fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130)
partial fix
Review of [attachment 592130](/attachment.cgi?id=592130 "partial fix") [[details]](/attachment.cgi?id=592130&action=edit "partial fix") [[diff]](/attachment.cgi?id=592130&action=diff "partial fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130):
-----------------------------------------------------------------
::: js/src/vm/GlobalObject.cpp
@@ +365,5 @@
> \*/
> cx->compartment->newObjectCache.reset();
> +
> +#ifdef JS\_METHODJIT
> + /\* Destroy compiled code for any scripts parented to this global. \*/
r+ with comment revised to something like "If the global was cleared, for safety ..."
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: review?(dmandelin) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=680456#c14)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/4d8f729aa1aa>
There was a test (js/xpconnect/tests/mochitest/test\_bug605167.html) which consistently tried to run a script against a cleared global, and which was failing because of this change --- a different exception was being thrown than the one it was testing for (it expected a permission-denied exception, and got the compile-and-go one instead). I just relaxed the test itself.Target Milestone: --- → mozilla12Version: unspecified → Trunk

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a14286729_346231)• 13 years ago |

Target Milestone: mozilla12 → mozilla13

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=680456#c15)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4d8f729aa1aa>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a14509683_112088)• 13 years ago |

Depends on: [723910](/show_bug.cgi?id=723910 "RESOLVED FIXED - Account Provisioner fails to close order form tab and report success")

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=680456#c16)• 13 years ago |
|  | |

This broke Thunderbird's account provisioner - see [bug 723910](/show_bug.cgi?id=723910 "RESOLVED FIXED - Account Provisioner fails to close order form tab and report success").

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=680456#c17)• 13 years ago |
|  | |

Unless there is a bug in the patch, that would mean thunderbird was running script on a cleared global, which is unsafe and can cause crashes.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=680456#c18)• 13 years ago |
|  | |

See [bug 730703](/show_bug.cgi?id=730703 "RESOLVED FIXED - Crash [@ js::mjit::EnterMethodJIT ] and friends"). Alice's fix range includes this bug.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=680456#c19)• 13 years ago |
|  | |

Comment on [attachment 592130](/attachment.cgi?id=592130 "partial fix") [[details]](/attachment.cgi?id=592130&action=edit "partial fix") [[diff]](/attachment.cgi?id=592130&action=diff "partial fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130)
partial fix
From the error in [bug 730703 comment 2](/show_bug.cgi?id=730703#c2 "RESOLVED FIXED - Crash [@ js::mjit::EnterMethodJIT ] and friends") it seems likely that crash was fixed by this bug. I'm guessing it's too late for beta but asking anyways.
[Approval Request Comment]
User impact if declined: Potential repeatable crashes, e.g. [bug 730703](/show_bug.cgi?id=730703 "RESOLVED FIXED - Crash [@ js::mjit::EnterMethodJIT ] and friends").
Testing completed (on m-c, etc.): Has been on m-c for ~1 month
Risk to taking this patch (and alternatives if risky): Some risk for changes in website behavior, can cause websites to behave differently if they run scripts on globals which have been cleared.
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-beta?
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-aurora?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=680456#c20)• 13 years ago |
|  | |

I have yet another case (a commercial 3d model viewer) that is fixed by this patch. I think this patch could really help stability.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a16685502_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=680456#c21)• 13 years ago |
|  | |

Comment on [attachment 592130](/attachment.cgi?id=592130 "partial fix") [[details]](/attachment.cgi?id=592130&action=edit "partial fix") [[diff]](/attachment.cgi?id=592130&action=diff "partial fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130)
partial fix
Please land the patch on Aurora. We can jump one train here for a crash fix and a security hole, but it's just too late to try to get something into Beta which might break web sites.
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-beta?
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-beta-
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-aurora?
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=680456#c22)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/7bb6bf824139>

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=680456#c23)• 13 years ago |
|  | |

[Triage Comment]
Don't land this until Firefox 12 is on mozilla-beta please.
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a16868775_1689)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a16868793_1689)• 13 years ago |

Assignee: general → bhackett1024

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=680456#c24)• 13 years ago |
|  | |

Comment on [attachment 592130](/attachment.cgi?id=592130 "partial fix") [[details]](/attachment.cgi?id=592130&action=edit "partial fix") [[diff]](/attachment.cgi?id=592130&action=diff "partial fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=680456&attachment=592130)
partial fix
[Triage Comment]
Please go ahead and land this on ESR branch (see <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>).
[Attachment #592130](/attachment.cgi?id=592130&action=edit "partial fix") -
Flags: approval-mozilla-esr10+

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=680456#c25)• 13 years ago |
|  | |

qa- until testcase-wanted is satisfiedWhiteboard: [sg:critical] wanted-standalone-js → [sg:critical][qa-] wanted-standalone-js

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=680456#c26)• 13 years ago |
|  | |

Brian, could you rebase this for ESR10? Most of the bustage is trivial, but the patch landed to aurora uses Recompiler::clearStackReferences, which ESR10 doesn't have (and it seems to lack some of the machinery used by that function too).

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=680456#c27)• 13 years ago |
|  | |

Is there any direct way to verify this fix?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=680456#c28)• 13 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #27](/show_bug.cgi?id=680456#c27 "RESOLVED FIXED - Don't run compileAndGo scripts on globals with a cleared scope"))
> Is there any direct way to verify this fix?
Don't worry about it--this bug is a partial fix. The real fix is [bug 637099](/show_bug.cgi?id=637099 "VERIFIED FIXED - Remove JS_ClearScope calls on windows").

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=680456#c29)• 13 years ago |
|  | |

Heh. That bug isn't frightening at all. :-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a20395106_1689)• 13 years ago |

Blocks: [730703](/show_bug.cgi?id=730703 "RESOLVED FIXED - Crash [@ js::mjit::EnterMethodJIT ] and friends")

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=680456#c30)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-esr10/rev/4d3de4e1417d>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=680456#c31)• 13 years ago |
|  | |

Backed out for orange.
<https://hg.mozilla.org/releases/mozilla-esr10/rev/57aed64e01f3>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=680456#c32)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-esr10/rev/241d9ff102a5>

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a20838062_272375)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a23602787_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680456#a131251430_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=680456&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_73851fed_20250125_084154.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/716556)
* [XML](/show_bug.cgi?ctype=xml&id=716556)

Closed
[Bug 716556](/show_bug.cgi?id=716556)

Opened 13 years ago
Closed 13 years ago

# Potential buffer overflow in nsScriptableInputStream::Read with 4GB data

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Potential buffer overflow in nsScriptableInputStream::Read with 4GB data

## Categories

### (Core :: XPCOM, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPCOM#XPCOM)

XPCOM
▾

Core :: XPCOM
This is the basis of our component technology; this covers the mozilla/xpcom source directory and includes the "repository". Unlikely a tester would be able to tell there was an XPCOM problem specifically.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPCOM)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla13

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |
| blocking1.9.2 | --- | [needed](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=needed) |
| status1.9.2 | --- | [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | - | wontfix |
| firefox10 | - | wontfix |
| firefox11 | - | wontfix |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox14 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| blocking1.9.2 |  |  |
| status1.9.2 |  | wanted |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mayhemer, Assigned: johns)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e015aca8c2ea64974b5d4c29ae1ee603?d=mm&size=40)  [johns](/user_profile?user_id=429621)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [mayhemer](/user_profile?user_id=269762)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, Whiteboard: [sg:moderate][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 4 obsolete files)

| [Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE\_MAX](/attachment.cgi?id=588532)  [13 years ago](#c4)  [John Schoenick [:johns]](/user_profile?user_id=429621)   1.87 KB, patch | benjamin : [review-](#c5 "13 years ago") | [Details](/attachment.cgi?id=588532&action=edit) | [Diff](/attachment.cgi?id=588532&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=588532) |
| --- | --- | --- |
| [Cap reads to PR\_UINT32\_MAX - 1](/attachment.cgi?id=595495)  [13 years ago](#c8)  [John Schoenick [:johns]](/user_profile?user_id=429621)   1.08 KB, patch | benjamin : [review+](#a2609428_7044 "13 years ago") | [Details](/attachment.cgi?id=595495&action=edit) | [Diff](/attachment.cgi?id=595495&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=595495) |
| [Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg](/attachment.cgi?id=595545)  [13 years ago](#c9)  [John Schoenick [:johns]](/user_profile?user_id=429621)   1.10 KB, patch |  | [Details](/attachment.cgi?id=595545&action=edit) | [Diff](/attachment.cgi?id=595545&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=595545) |
| [Cap reads to PR\_UINT32\_MAX - 1, attempt 2](/attachment.cgi?id=596154)  [13 years ago](#c12)  [John Schoenick [:johns]](/user_profile?user_id=429621)   1.11 KB, patch | benjamin : [review+](#a3025479_7044 "13 years ago") | [Details](/attachment.cgi?id=596154&action=edit) | [Diff](/attachment.cgi?id=596154&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596154) |
| [Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg](/attachment.cgi?id=596731)  [13 years ago](#c13)  [John Schoenick [:johns]](/user_profile?user_id=429621)   1.12 KB, patch | akeybl : [approval-mozilla-aurora+](#c18 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c23 "13 years ago") | [Details](/attachment.cgi?id=596731&action=edit) | [Diff](/attachment.cgi?id=596731&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596731) |
| [[1.9.2] Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg](/attachment.cgi?id=605446)  [13 years ago](#c20)  [John Schoenick [:johns]](/user_profile?user_id=429621)   1.11 KB, patch |  | [Details](/attachment.cgi?id=605446&action=edit) | [Diff](/attachment.cgi?id=605446&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=605446) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=716556#c0)• 13 years ago |
|  | |

NS\_IMETHODIMP
nsScriptableInputStream::Read(PRUint32 aCount, char \*\*\_retval) {
nsresult rv = NS\_OK;
PRUint32 count = 0;
char \*buffer = nsnull;
if (!mInputStream) return NS\_ERROR\_NOT\_INITIALIZED;
rv = mInputStream->Available(&count);
if (NS\_FAILED(rv)) return rv;
count = NS\_MIN(count, aCount);
buffer = (char\*)nsMemory::Alloc(count+1); // make room for '\0'
if (!buffer) return NS\_ERROR\_OUT\_OF\_MEMORY;
- have mInputStream having exactly 4GB of data, its available will return PR\_UINT32\_MAX
- try to read all this 4GB of data with the scriptable stream
- count+1 will evaluate as 0
It is not well defined what result of malloc (if nsMemory::Alloc resolve to it) is with 0 as an arg.
So, we may potentially get an invalid pointer and write to it.

|  | [Ian Melven :imelven](/user_profile?user_id=416294) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=716556#c1)• 13 years ago |
|  | |

looks like an sg:crit to me - potential memory overwrite - dveditz ?Whiteboard: [sg:crit]

|  | [Ian Melven :imelven](/user_profile?user_id=416294) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=716556#c2)• 13 years ago |
|  | |

sg:critical is the right tag, not sg:critWhiteboard: [sg:crit] → [sg:critical]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a277294_1689)• 13 years ago |

blocking1.9.2: --- → needed
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a277332_1689)• 13 years ago |

[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=716556#c3)• 13 years ago |
|  | |

John, can you hack up a fix here? I.e. check the math so we don't overflow etc.Assignee: nobody → jschoenick
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a277406_12352)• 13 years ago |

[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=716556#c4)• 13 years ago |
|  | |

Attached patch

[Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE\_MAX](attachment.cgi?id=588532&action=diff) (obsolete)
— [Details](attachment.cgi?id=588532&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=588532)

This checks that aCount is not >= SIZE\_MAX, which avoids capping reads to 4GiB on 64bit systems, and ensures this wont regress if these interfaces are changed off of PRUint32 in the future.
[Attachment #588532](/attachment.cgi?id=588532&action=edit "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") -
Flags: review?(benjamin)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=716556#c5)• 13 years ago |
|  | |

Comment on [attachment 588532](/attachment.cgi?id=588532 "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") [[details]](/attachment.cgi?id=588532&action=edit "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") [[diff]](/attachment.cgi?id=588532&action=diff "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") [[review]](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=588532)
Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE\_MAX
aCount is a PRUint32. If you want to prevent it from overflowing, you need to use PR\_UINT32\_MAX, not SIZE\_MAX... size\_t could be a 64-bit size.
[Attachment #588532](/attachment.cgi?id=588532&action=edit "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") -
Flags: review?(benjamin) → review-

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=716556#c6)• 13 years ago |
|  | |

(In reply to Benjamin Smedberg [:bsmedberg] from [comment #5](/show_bug.cgi?id=716556#c5 "RESOLVED FIXED - Potential buffer overflow in nsScriptableInputStream::Read with 4GB data"))
> Comment on [attachment 588532](/attachment.cgi?id=588532 "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") [[details]](/attachment.cgi?id=588532&action=edit "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") [[diff]](/attachment.cgi?id=588532&action=diff "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") [[review]](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=588532)
> Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE\_MAX
>
> aCount is a PRUint32. If you want to prevent it from overflowing, you need
> to use PR\_UINT32\_MAX, not SIZE\_MAX... size\_t could be a 64-bit size.
With the patch, (size\_t)aCount+1 is passed to Alloc, so we only need to check that aCount isn't going to overflow a size\_t. This prevents having a wierd edge case with 4GiB reads on 64bit systems (where such a thing is feasible, if unlikely at present).

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=716556#c7)• 13 years ago |
|  | |

Could we just add - 1 to the second NS\_MIN arg?
This indirectly blocks [bug 215450](/show_bug.cgi?id=215450 "RESOLVED FIXED - uploading files that are larger the 2GB fails").

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=716556#c8)• 13 years ago |
|  | |

Attached patch

[Cap reads to PR\_UINT32\_MAX - 1](attachment.cgi?id=595495&action=diff) (obsolete)
— [Details](attachment.cgi?id=595495&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=595495)

Per conversation on IRC, preventing the 4GiB edge case isn't worth the added code complexity - just cap reads at PR\_UINT32\_MAX - 1.
[Attachment #588532](/attachment.cgi?id=588532&action=edit "Fix buffer overflow with nsScriptableInputStream for aCount >= SIZE_MAX") -
Attachment is obsolete: true
[Attachment #595495](/attachment.cgi?id=595495&action=edit "Cap reads to PR_UINT32_MAX - 1") -
Flags: review?(benjamin)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a2609428_7044)• 13 years ago |

[Attachment #595495](/attachment.cgi?id=595495&action=edit "Cap reads to PR_UINT32_MAX - 1") -
Flags: review?(benjamin) → review+

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a2615219_429621)• 13 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=716556#c9)• 13 years ago |
|  | |

Attached patch

[Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg](attachment.cgi?id=595545&action=diff) (obsolete)
— [Details](attachment.cgi?id=595545&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=595545)

Proper commit message, needs checkin
[Attachment #595495](/attachment.cgi?id=595495&action=edit "Cap reads to PR_UINT32_MAX - 1") -
Attachment is obsolete: true

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=716556#c10)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/20ad3570d599>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a2636353_12352)• 13 years ago |

[Attachment #595545](/attachment.cgi?id=595545&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: checkin+

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=716556#c11)• 13 years ago |
|  | |

Philor backed this out for causing xpcshell bustage:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/9e23446b3559>
The xpcshell failure looks like this:
{
TEST-UNEXPECTED-FAIL | c:\talos-slave\test\build\xpcshell\tests\content\test\unit\test\_xml\_serializer.js | test failed (with xpcshell return code: 0), see following log:
TEST-UNEXPECTED-FAIL | xpcshell/head.js | [Exception... "Component returned failure code: 0x80070057 (NS\_ERROR\_ILLEGAL\_VALUE) [nsIScriptableInputStream.read]" nsresult: "0x80070057 (NS\_ERROR\_ILLEGAL\_VALUE)" location: "JS frame :: c:/talos-slave/test/build/xpcshell/tests/content/test/unit/test\_xml\_serializer.js :: test8 :: line 289" data: no]
}
Sample orange xpcshell logs:
<https://tbpl.mozilla.org/php/getParsedLog.php?id=9199851&tree=Mozilla-Inbound>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=9199677&tree=Mozilla-Inbound>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=9199868&tree=Mozilla-Inbound>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=9200717&tree=Mozilla-Inbound>

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a2643040_278074)• 13 years ago |

[Attachment #595545](/attachment.cgi?id=595545&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: checkin+ → checkin?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a2643067_278074)• 13 years ago |

[Attachment #595545](/attachment.cgi?id=595545&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Attachment description: [checkin-needed] Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg → Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg
[Attachment #595545](/attachment.cgi?id=595545&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: checkin?

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=716556#c12)• 13 years ago |
|  | |

Attached patch

[Cap reads to PR\_UINT32\_MAX - 1, attempt 2](attachment.cgi?id=596154&action=diff) (obsolete)
— [Details](attachment.cgi?id=596154&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596154)

Per more conversations in IRC
The interface doesn't guarantee that bytes read will be min(available, requested), so just reading max-1 bytes when 4GiB is requested is acceptable. This lets scripts continue to do read(-1) as a shorthand for getting all available bytes, which is what broke the tests.
For good measure I pushed this version to try:
<https://tbpl.mozilla.org/?tree=Try&rev=b60d2d4ea351>
[Attachment #595545](/attachment.cgi?id=595545&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Attachment is obsolete: true
[Attachment #596154](/attachment.cgi?id=596154&action=edit "Cap reads to PR_UINT32_MAX - 1, attempt 2") -
Flags: review?(benjamin)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a3025479_7044)• 13 years ago |

[Attachment #596154](/attachment.cgi?id=596154&action=edit "Cap reads to PR_UINT32_MAX - 1, attempt 2") -
Flags: review?(benjamin) → review+

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=716556#c13)• 13 years ago |
|  | |

Attached patch

[Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg](attachment.cgi?id=596731&action=diff)
— [Details](attachment.cgi?id=596731&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596731)

Proper commit message, checkin-needed
[Attachment #596154](/attachment.cgi?id=596154&action=edit "Cap reads to PR_UINT32_MAX - 1, attempt 2") -
Attachment is obsolete: true

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a3035504_429621)• 13 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=716556#c14)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/e0e35faac08c>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=716556#c15)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e0e35faac08c>Status: NEW → RESOLVEDClosed: 13 years agoKeywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Resolution: --- → FIXEDTarget Milestone: --- → mozilla13

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a4511743_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)Whiteboard: [sg:critical] → [sg:moderate]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=716556#c16)• 13 years ago |
|  | |

John, can you check if this applies to aurora (I'd be surprised if it didn't) and request approval for aurora if it does? Thanks.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a4521980_1689)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=716556#c17)• 13 years ago |
|  | |

Comment on [attachment 596731](/attachment.cgi?id=596731 "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[details]](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[diff]](/attachment.cgi?id=596731&action=diff "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[review]](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596731)
Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg
[Approval Request Comment]
User impact if declined: [sg-moderate]
Testing completed (on m-c, etc.): on m-c
Risk to taking this patch (and alternatives if risky): Very low
[Attachment #596731](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=716556#c18)• 13 years ago |
|  | |

Comment on [attachment 596731](/attachment.cgi?id=596731 "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[details]](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[diff]](/attachment.cgi?id=596731&action=diff "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[review]](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596731)
Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg
[Triage Comment]
Low risk security fix - approved for Aurora 12.
[Attachment #596731](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=716556#c19)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/2e6e504f7407>
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a5534214_429621)• 13 years ago |

[Attachment #596731](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Attachment description: [checkin-needed] Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg → Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=716556#c20)• 13 years ago |
|  | |

Attached patch

[[1.9.2] Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg](attachment.cgi?id=605446&action=diff)
— [Details](attachment.cgi?id=605446&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=605446)

1.9.2 version - NS\_MIN -> PR\_MIN

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a5534278_429621)• 13 years ago |

[Attachment #605446](/attachment.cgi?id=605446&action=edit "[1.9.2] Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: approval1.9.2.28?

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=716556#c21)• 13 years ago |
|  | |

[Approval Request Comment]
For 1.9.2:
User impact if declined: [sg-moderate]
Testing completed (on m-c, etc.): on m-c, on aurora
Risk to taking this patch (and alternatives if risky): Very low

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=716556#c22)• 13 years ago |
|  | |

Comment on [attachment 596731](/attachment.cgi?id=596731 "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[details]](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[diff]](/attachment.cgi?id=596731&action=diff "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[review]](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596731)
Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg
Approval for esr10 - see c17-18
[Attachment #596731](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: approval-mozilla-esr10?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=716556#c23)• 13 years ago |
|  | |

Comment on [attachment 596731](/attachment.cgi?id=596731 "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[details]](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[diff]](/attachment.cgi?id=596731&action=diff "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") [[review]](/page.cgi?id=splinter.html&ignore=&bug=716556&attachment=596731)
Cap reads to PR\_UINT32\_MAX - 1, r=bsmedberg
[Triage Comment]
Please go ahead and land on ESR branch, see <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for details.
[Attachment #596731](/attachment.cgi?id=596731&action=edit "Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=716556#c24)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/582b3b404829>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=716556#c25)• 13 years ago |
|  | |

qa- until testcase-wanted is satisfiedWhiteboard: [sg:moderate] → [sg:moderate][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a11247016_1689)• 13 years ago |

Group: core-security

|  | [John Schoenick [:johns]](/user_profile?user_id=429621)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a34494330_429621)• 12 years ago |

[Attachment #605446](/attachment.cgi?id=605446&action=edit "[1.9.2] Cap reads to PR_UINT32_MAX - 1, r=bsmedberg") -
Flags: approval1.9.2.28?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=716556#a118895767_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=716556&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [John Schoenick [:johns]](/user_profile?user_id=429621)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_fec343af_20250125_084202.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/732951)
* [XML](/show_bug.cgi?ctype=xml&id=732951)

Closed
[Bug 732951](/show_bug.cgi?id=732951)

Opened 13 years ago
Closed 13 years ago

# EnsureMutable() returns true (success) even when it failed due to OOM

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

EnsureMutable() returns true (success) even when it failed due to OOM

## Categories

### (Core :: XPCOM, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPCOM#XPCOM)

XPCOM
▾

Core :: XPCOM
This is the basis of our component technology; this covers the mozilla/xpcom source directory and includes the "repository". Unlikely a tester would be able to tell there was an XPCOM problem specifically.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPCOM)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | - | wontfix |
| firefox11 | - | wontfix |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox14 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| status1.9.2 |  | wanted |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[oomfuzz](/show_bug.cgi?id=687256 "RESOLVED FIXED - [meta] Need fuzz testing of OOM conditions to find exploitable crashes")

Dependency [tree](/showdependencytree.cgi?id=732951&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=732951)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsContentUtils::ASCIIToLower ]](https://crash-stats.mozilla.org/signature/?signature=nsContentUtils%3A%3AASCIIToLower)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 2 obsolete files)

| [Like so?](/attachment.cgi?id=603088)  [13 years ago](#c5)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.80 KB, patch |  | [Details](/attachment.cgi?id=603088&action=edit) | [Diff](/attachment.cgi?id=603088&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=603088) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=603410)  [13 years ago](#c13)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.80 KB, patch |  | [Details](/attachment.cgi?id=603410&action=edit) | [Diff](/attachment.cgi?id=603410&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=603410) |
| [fix, v2](/attachment.cgi?id=604114)  [13 years ago](#c17)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   2.54 KB, patch | benjamin : [review+](#c28 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c34 "13 years ago")  akeybl : [approval-mozilla-beta+](#c34 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c34 "13 years ago") | [Details](/attachment.cgi?id=604114&action=edit) | [Diff](/attachment.cgi?id=604114&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604114) |
| [Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS\_ERROR\_OUT\_OF\_MEMORY when string allocation fails](/attachment.cgi?id=604115)  [13 years ago](#c18)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   4.42 KB, patch | bzbarsky : [review+](#c26 "13 years ago")  akeybl : [approval-mozilla-aurora+](#a3125863_425645 "13 years ago")  akeybl : [approval-mozilla-beta+](#a3125863_425645 "13 years ago")  akeybl : [approval-mozilla-esr10+](#a3125863_425645 "13 years ago") | [Details](/attachment.cgi?id=604115&action=edit) | [Diff](/attachment.cgi?id=604115&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604115) |
| [Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error](/attachment.cgi?id=604117)  [13 years ago](#c19)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   4.45 KB, patch | bzbarsky : [review+](#c27 "13 years ago")  akeybl : [approval-mozilla-aurora+](#a3125869_425645 "13 years ago")  akeybl : [approval-mozilla-beta+](#a3125869_425645 "13 years ago")  akeybl : [approval-mozilla-esr10+](#a3125869_425645 "13 years ago") | [Details](/attachment.cgi?id=604117&action=edit) | [Diff](/attachment.cgi?id=604117&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604117) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=732951#c0)• 13 years ago |
|  | |

Tested on m-c revision 8ea5c983743f: I don't know exactly what's wrong here, but the OOM condition as indicated by the allocation trace below (after crash trace), led to this crash which looks potentially dangerous:
Program received signal SIGSEGV, Segmentation fault.
nsContentUtils::ASCIIToLower (aStr=...) at /srv/repos/browser/mozilla-central/content/base/src/nsContentUtils.cpp:5042
5042 PRUnichar c = \*iter;
(gdb) bt 8
#0 nsContentUtils::ASCIIToLower (aStr=...) at /srv/repos/browser/mozilla-central/content/base/src/nsContentUtils.cpp:5042
#1 0x00002aaaac77f6b0 in RuleHash\_CIHashKey (table=<optimized out>, key=<optimized out>) at /srv/repos/browser/mozilla-central/layout/style/nsCSSRuleProcessor.cpp:166
#2 0x00002aaaad249529 in PL\_DHashTableOperate (table=0x2bde9d8, key=0x22bae90, op=PL\_DHASH\_ADD)
at /srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/xpcom/build/pldhash.cpp:615
#3 0x00002aaaac780659 in RuleHash::AppendRuleToTable (this=0x2bde9a0, aTable=<optimized out>, aKey=<optimized out>, aRuleInfo=...)
at /srv/repos/browser/mozilla-central/layout/style/nsCSSRuleProcessor.cpp:566
#4 0x00002aaaac780745 in RuleHash::AppendRule (this=0x2bde9a0, aRuleInfo=...) at /srv/repos/browser/mozilla-central/layout/style/nsCSSRuleProcessor.cpp:610
#5 0x00002aaaac783648 in AddRule (aCascade=0x2bde9a0, aRuleInfo=0x2446cf0) at /srv/repos/browser/mozilla-central/layout/style/nsCSSRuleProcessor.cpp:2808
#6 RefreshRuleCascade (aPresContext=<optimized out>, this=0x27ef130) at /srv/repos/browser/mozilla-central/layout/style/nsCSSRuleProcessor.cpp:3148
#7 nsCSSRuleProcessor::RefreshRuleCascade (this=0x27ef130, aPresContext=<optimized out>) at /srv/repos/browser/mozilla-central/layout/style/nsCSSRuleProcessor.cpp:3095
(gdb) l
5037 nsContentUtils::ASCIIToLower(nsAString& aStr)
5038 {
5039 PRUnichar\* iter = aStr.BeginWriting();
5040 PRUnichar\* end = aStr.EndWriting();
5041 while (iter != end) {
5042 PRUnichar c = \*iter;
5043 if (c >= 'A' && c <= 'Z') {
5044 \*iter = c + ('a' - 'A');
5045 }
5046 ++iter;
(gdb) p iter
$1 = (PRUnichar \*) 0x2aaaae4b3000
(gdb) p \*iter
Cannot access memory at address 0x2aaaae4b3000
(gdb) p end
$2 = (PRUnichar \*) 0x7fffffffa4a0
The backtrace of the failing allocation is as follows:
#0 /srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/dist/bin/libmozalloc.so(moz\_malloc+0x5f)
#1 nsStringBuffer::Alloc(unsigned long) at xpcom/string/src/nsSubstring.cpp:210
#2 nsAString\_internal::MutatePrep(unsigned int, unsigned short\*\*, unsigned int\*) at xpcom/string/src/nsTSubstring.cpp:163
#3 nsAString\_internal::ReplacePrepInternal(unsigned int, unsigned int, unsigned int, unsigned int) at xpcom/string/src/nsTSubstring.cpp:199
#4 nsAString\_internal::Assign(unsigned short const\*, unsigned int) at xpcom/string/src/nsTSubstring.cpp:335
#5 nsAString\_internal::Assign(unsigned short const\*, unsigned int) at xpcom/string/src/nsTSubstring.cpp:331
#6 nsAString\_internal::EnsureMutable(unsigned int) at xpcom/string/src/nsTSubstring.cpp:295
#7 nsAString\_internal::BeginWriting() at objdir-ff-gcc64dbg/content/base/src/../../../dist/include/nsTSubstring.h:159
#8 nsContentUtils::ASCIIToLower(nsAString\_internal&) at content/base/src/nsContentUtils.cpp:5040
#9 RuleHash\_CIHashKey at layout/style/nsCSSRuleProcessor.cpp:167
#10 PL\_DHashTableOperate at objdir-ff-gcc64dbg/xpcom/build/pldhash.cpp:616
#11 AddSelector at layout/style/nsCSSRuleProcessor.cpp:2742
#12 AddRule at layout/style/nsCSSRuleProcessor.cpp:2848
#13 nsCSSRuleProcessor::GetRuleCascade(nsPresContext\*) at layout/style/nsCSSRuleProcessor.cpp:3089
#14 nsCSSRuleProcessor::RulesMatching(AnonBoxRuleProcessorData\*) at layout/style/nsCSSRuleProcessor.cpp:2320
#15 EnumRulesMatching<AnonBoxRuleProcessorData> at layout/style/nsStyleSet.cpp:479
If you need longer traces, more GDB information or a reproduction of this, let me know. Guessing Layout as component, but not sure about that of course.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=732951#c1)• 13 years ago |
|  | |

nsStringBuffer::Alloc returns NULL if the malloc fails
nsAString\_internal::MutatePrep returns false
nsAString\_internal::ReplacePrepInternal returns false
nsAString\_internal::ReplacePrep (inlined) returns false
nsAString\_internal::Assign @335 is a NOP
nsAString\_internal::Assign @331 (nsTSubstring.cpp):
315 void
316 nsTSubstring\_CharT::Assign( const char\_type\* data, size\_type length )
317 {
318 // unfortunately, some callers pass null :-(
319 if (!data)
320 {
321 Truncate();
322 return;
323 }
324
325 if (length == size\_type(-1))
326 length = char\_traits::length(data);
327
328 if (IsDependentOn(data, data + length))
329 {
330 // take advantage of sharing here...
331 Assign(string\_type(data, length));
332 return;
333 }
334
335 if (ReplacePrep(0, mLength, length))
336 char\_traits::copy(mData, data, length);
337 }
Line 331 creates a temporary nsTString\_CharT (nsTString.h):
70 nsTString\_CharT( const char\_type\* data,
size\_type length = size\_type(-1) )
71 : substring\_type()
72 {
73 Assign(data, length);
74 }
and substring\_type() is (nsTSubstring.h):
620 nsTSubstring\_CharT()
621 : mData(char\_traits::sEmptyBuffer),
622 mLength(0),
623 mFlags(F\_TERMINATED) {}
since the Assign call on line 73 is a NOP this temp has the above values.
Then, on line 331 again, we Assign from the temp:
364 nsTSubstring\_CharT::Assign( const self\_type& str )
365 {
366 // |str| could be sharable. we need to check its flags to know how to
367 // deal with it.
368
369 if (&str == this)
370 return;
371
372 if (!str.mLength)
373 {
374 Truncate();
375 mFlags |= str.mFlags & F\_VOIDED;
376 }
...
since str.mLength is zero we Truncate, aka SetCapacity(0):
533 nsTSubstring\_CharT::SetCapacity( size\_type capacity )
534 {
535 // capacity does not include room for the terminating null char
536
537 // if our capacity is reduced to zero, then free our buffer.
538 if (capacity == 0)
539 {
540 ::ReleaseData(mData, mFlags);
541 mData = char\_traits::sEmptyBuffer;
542 mLength = 0;
543 SetDataFlags(F\_TERMINATED);
544 }
545 else
...
assigning mData!
nsAString\_internal::EnsureMutable :
292 // promote to a shared string buffer
293 char\_type\* prevData = mData;
294 Assign(mData, mLength);
295 return mData != prevData;
EnsureMutable returns true!
char\_iterator BeginWriting()
{
return EnsureMutable() ? mData : char\_iterator(0);
}
=> we will write to char\_traits::sEmptyBuffer !!!Component: Layout → XPCOMQA Contact: layout → xpcom

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=732951#c2)• 13 years ago |
|  | |

Christian, if my theory above is correct, the value of 'iter' should be
the same as &gNullChar or thereabout, can you confirm?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=732951#c3)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #2](/show_bug.cgi?id=732951#c2 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> Christian, if my theory above is correct, the value of 'iter' should be
> the same as &gNullChar or thereabout, can you confirm?
Like this?
(gdb) p &gNullChar
$1 = (PRUnichar \*) 0x2aaaae464cb8
(gdb) p iter
$2 = (PRUnichar \*) 0x2aaaae4b3000
If you need anything else, let me know :)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=732951#c4)• 13 years ago |
|  | |

Yes, thanks. So 0x2aaaae4b3000 - 0x2aaaae464cb8 = 320328 (decimal),
which seems to support my theory.
Do you do your own builds? if so, can you try saving the start value for 'iter',
like so:
/\* static \*/
+PRUnichar\* start;
void
nsContentUtils::ASCIIToLower(nsAString& aStr)
{
PRUnichar\* iter = aStr.BeginWriting();
PRUnichar\* end = aStr.EndWriting();
+ start = iter;
while (iter != end) {
...
then the values of 'start' and &gNullChar should be the same.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=732951#c5)• 13 years ago |
|  | |

Attached patch

[Like so?](attachment.cgi?id=603088&action=diff) (obsolete)
— [Details](attachment.cgi?id=603088&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=603088)

Perhaps would could mark the string as F\_VOIDED when MutatePrep fails
and have EnsureMutable() check for that instead.
Also, does making gNullChar const put it in a non-writable section
on some platforms? (should cause a safer crash)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=732951#c6)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #4](/show_bug.cgi?id=732951#c4 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> then the values of 'start' and &gNullChar should be the same.
Confirmed:
(gdb) p start
$2 = (PRUnichar \*) 0x2aaaae464cc8
(gdb) p &gNullChar
$3 = (PRUnichar \*) 0x2aaaae464cc8
:) I'll try your patch now.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=732951#c7)• 13 years ago |
|  | |

With the patch from [comment 5](/show_bug.cgi?id=732951#c5 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM") I get a crash due to iter being NULL now:
Program received signal SIGSEGV, Segmentation fault.
nsContentUtils::ASCIIToLower (aStr=...) at /srv/repos/browser/mozilla-central/content/base/src/nsContentUtils.cpp:5042
5042 PRUnichar c = \*iter;
(gdb) p iter
$1 = (PRUnichar \*) 0x0
If this is intended, then I would like to suggest to use the mozmalloc\_abort function instead of crashing here, to keep crash stats consistent and allow automated detection of unhandled OOM bugs (such as my tool here does).

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=732951#c8)• 13 years ago |
|  | |

Yes, 0x0 is expected, that's what BeginWriting()/EndWriting() returns when
EnsureMutable() fails. I'm not sure if we can make them infallible.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=732951#c9)• 13 years ago |
|  | |

I think [sg:critical] is warranted given the large number of consumers that indirectly
depends on a correct return value of ns\*String::EnsureMutable().Assignee: nobody → matspalWhiteboard: [sg:critical]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=732951#c10)• 13 years ago |
|  | |

> If this is intended, then I would like to suggest to use the mozmalloc\_abort
I'm not going to do that in this bug, because there's too many consumers
of BeginWriting/EndWriting which would become infallible. And I think
it would be confusing to have some string methods be infallible while
others are fallible.
I'm in favor of making strings infallible eventually though, but not here
and now.Summary: OOM Crash [@ nsContentUtils::ASCIIToLower] → EnsureMutable() returns true (success) even when it failed due to OOM

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=732951#c11)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #10](/show_bug.cgi?id=732951#c10 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> I'm not going to do that in this bug, because there's too many consumers
> of BeginWriting/EndWriting which would become infallible. And I think
> it would be confusing to have some string methods be infallible while
> others are fallible.
>
> I'm in favor of making strings infallible eventually though, but not here
> and now.
I didn't actually mean to make strings infallible in general (although that would of course be good). What I meant is that if we crash in this particular piece of code anyway guaranteed on OOM (in ASCIIToLower), can we check the pointer and abort instead?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=732951#c12)• 13 years ago |
|  | |

Oh, I misunderstood you then. I haven't actually looked at who calls
nsContentUtils::ASCIIToLower and if we can make that infallible. I guess
I morphed this bug into the more general problem. I'll make a separate patch
for ASCIIToLower...

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=732951#c13)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=603410&action=diff) (obsolete)
— [Details](attachment.cgi?id=603410&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=603410)

Now using SetIsVoid(true) instead of just adding the F\_VOIDED bit --
to maintain the invariant that mData == sEmptyBuffer:
<http://mxr.mozilla.org/mozilla-central/source/xpcom/string/public/nsTSubstring.h#795>
Try results pending:
<https://tbpl.mozilla.org/?usebuildbot=1&tree=Try&rev=fe31ec4a4c33>
[Attachment #603410](/attachment.cgi?id=603410&action=edit "fix") -
Flags: review?(bzbarsky)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a107311_5168)• 13 years ago |

[Attachment #603088](/attachment.cgi?id=603088&action=edit "Like so?") -
Attachment is obsolete: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=732951#c14)• 13 years ago |
|  | |

Comment on [attachment 603410](/attachment.cgi?id=603410 "fix") [[details]](/attachment.cgi?id=603410&action=edit "fix") [[diff]](/attachment.cgi?id=603410&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=603410)
fix
I'd really like someone who knows the string code to review this....
[Attachment #603410](/attachment.cgi?id=603410&action=edit "fix") -
Flags: review?(bzbarsky) → review?(benjamin)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=732951#c15)• 13 years ago |
|  | |

I don't think I understand yet why we should mark the string as void if mutateprep fails.
Void strings have a particular meaning for the DOM which is different from a failure case. I would expect that if mutateprep fails, we should leave the string unchanged (and return false). Can we not just unwind by checking the return value of mutateprep?
I definitely think we ought to end up making string infallible by default and requiring explicit fallible\_t calls in the cases where we can commonly expect incoming buffers to cause DOS-style crashes.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=732951#c16)• 13 years ago |
|  | |

(In reply to Benjamin Smedberg [:bsmedberg] from [comment #15](/show_bug.cgi?id=732951#c15 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> I don't think I understand yet why we should mark the string as void if
> mutateprep fails.
I needed some state to signal that the Assign inside the ctor failed.
Since we currently truncate the original string on OOM anyway, I figured
marking it Void would be acceptable.
> if mutateprep fails, we should leave the string unchanged
I agree.
> Can we not just unwind by checking the return value of mutateprep?
I guess I could invent a new flag to signal the failed Assign...
But I don't see why we need to use that, I think SetLength should work.
Assign(mData, mLength) is really slow too -- it \*always\* allocates
a temporary string, copies the characters there, then Mutateprep
the original (allocating again in this case), copies the characters
back, then deallocates the temp string.
Also, making sEmptyBuffer 'static const' didn't really work since
some consumers actually overwrite the terminating NUL.
(It did crash on Linux64, I just missed the orange on Try)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=732951#c17)• 13 years ago |
|  | |

Attached patch

[fix, v2](attachment.cgi?id=604114&action=diff)
— [Details](attachment.cgi?id=604114&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604114)

I think we can use SetLength() in this case too. As a bonus, it's
faster because it just allocates a new StringBuffer and copies the
characters to that, avoiding an extra malloc/free and copying the
characters twice.
[Attachment #603410](/attachment.cgi?id=603410&action=edit "fix") -
Attachment is obsolete: true
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: review?(benjamin)
[Attachment #603410](/attachment.cgi?id=603410&action=edit "fix") -
Flags: review?(benjamin)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=732951#c18)• 13 years ago |
|  | |

Attached patch

[Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS\_ERROR\_OUT\_OF\_MEMORY when string allocation fails](attachment.cgi?id=604115&action=diff)
— [Details](attachment.cgi?id=604115&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604115)

[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: review?(bzbarsky)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=732951#c19)• 13 years ago |
|  | |

Attached patch

[Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error](attachment.cgi?id=604117&action=diff)
— [Details](attachment.cgi?id=604117&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604117)

[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: review?(bzbarsky)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=732951#c20)• 13 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=625d184c44c9>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=732951#c21)• 13 years ago |
|  | |

Comment on [attachment 604114](/attachment.cgi?id=604114 "fix, v2") [[details]](/attachment.cgi?id=604114&action=edit "fix, v2") [[diff]](/attachment.cgi?id=604114&action=diff "fix, v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604114)
fix, v2
... and this leaves the string unchanged if the allocation fails.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=732951#c22)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #16](/show_bug.cgi?id=732951#c16 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> (In reply to Benjamin Smedberg [:bsmedberg] from [comment #15](/show_bug.cgi?id=732951#c15 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> > I don't think I understand yet why we should mark the string as void if
> > mutateprep fails.
>
> I needed some state to signal that the Assign inside the ctor failed.
> Since we currently truncate the original string on OOM anyway, I figured
> marking it Void would be acceptable.
I don't like the idea of using Void for this. Void-ness should be as opaque as possible to the string library -- it's a hack designed to support the DOM string-or-null concept, and otherwise shouldn't be used. As far as the string library is concerned you should think of "void" as having as much meaning as "purple".

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=732951#c23)• 13 years ago |
|  | |

OK, the new patch doesn't use it.

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a283559_152868)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=732951#c24)• 13 years ago |
|  | |

bsmedberg: If we change the string code signatures what binary components break? Do people link against the Firefox copy of strings, or do they compile in their own copy of the string library through the SDK? Since the ESR is affected we need to figure out the impact.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a283592_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) → [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=732951#c25)• 13 years ago |
|  | |

This doesn't affect the external string API at all, so I don't think this affects anything.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=732951#c26)• 13 years ago |
|  | |

Comment on [attachment 604115](/attachment.cgi?id=604115 "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") [[details]](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") [[diff]](/attachment.cgi?id=604115&action=diff "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604115)
Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS\_ERROR\_OUT\_OF\_MEMORY when string allocation fails
r=me
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=732951#c27)• 13 years ago |
|  | |

Comment on [attachment 604117](/attachment.cgi?id=604117 "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") [[details]](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") [[diff]](/attachment.cgi?id=604117&action=diff "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604117)
Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error
r=me
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: review?(bzbarsky) → review+

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=732951#c28)• 13 years ago |
|  | |

Comment on [attachment 604114](/attachment.cgi?id=604114 "fix, v2") [[details]](/attachment.cgi?id=604114&action=edit "fix, v2") [[diff]](/attachment.cgi?id=604114&action=diff "fix, v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604114)
fix, v2
I assume that we currently cannot make SetLength be NS\_WARN\_UNUSED\_RESULT because large parts of the tree would fail to compile? Please make sure there is a followup to make an infallible version of this API and make the fallible version use NS\_WARN\_UNUSED\_RESULT.
In nsTSubstring\_CharT::SetLength I think it would be more readable to switch the conditionals:
if (!SetCapacity(length))
return false;
mLength = length;
return true;
r=me with that note & change
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: review?(benjamin) → review+

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a885184_152868)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=732951#c29)• 13 years ago |
|  | |

(I assume [bug 737164](/show_bug.cgi?id=737164 "RESOLVED FIXED - Make strings malloc-infallible by default") handles the "infallible string API" comment)
<https://hg.mozilla.org/integration/mozilla-inbound/rev/7a0ad2623e73>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/a1184da0d6ea>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/95bdf5f7298a>Target Milestone: --- → mozilla14

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=732951#c30)• 13 years ago |
|  | |

mounir merged this to m-c:
<http://hg.mozilla.org/mozilla-central/rev/7a0ad2623e73>
<http://hg.mozilla.org/mozilla-central/rev/a1184da0d6ea>
<http://hg.mozilla.org/mozilla-central/rev/95bdf5f7298a>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a1490249_1689)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=732951#c31)• 13 years ago |
|  | |

[Triage Comment]
Now that this has been on central for a bit can someone set a? on the patches for ESR landing? Please nominate if this is not showing any regressions.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=732951#c32)• 13 years ago |
|  | |

Comment on [attachment 604114](/attachment.cgi?id=604114 "fix, v2") [[details]](/attachment.cgi?id=604114&action=edit "fix, v2") [[diff]](/attachment.cgi?id=604114&action=diff "fix, v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604114)
fix, v2
[Approval Request Comment]
Regression caused by (bug #):
User impact if declined: crash, some risk of being exploitable
Testing completed (on m-c, etc.): baked on trunk since 2012-03-21
Risk to taking this patch (and alternatives if risky): medium risk, no alternatives
String changes made by this patch: none
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-esr10?
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-beta?
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-aurora?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a2880019_5168)• 13 years ago |

[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-esr10?
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-beta?
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-aurora?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a2880042_5168)• 13 years ago |

[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-esr10?
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-beta?
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-aurora?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a2880078_5168)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=732951#c33)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #32](/show_bug.cgi?id=732951#c32 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> Risk to taking this patch (and alternatives if risky): medium risk, no
> alternatives
What kind of fallout would we be on the lookout for if approved for FF12? Would this show up as a crash, web regression, or something else entirely?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=732951#c34)• 13 years ago |
|  | |

Comment on [attachment 604114](/attachment.cgi?id=604114 "fix, v2") [[details]](/attachment.cgi?id=604114&action=edit "fix, v2") [[diff]](/attachment.cgi?id=604114&action=diff "fix, v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732951&attachment=604114)
fix, v2
[Triage Comment]
Approving for all branches given this is sg:crit and there's still 2 weeks before release to hopefully shake out any fallout.
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-esr10?
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-esr10+
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-beta?
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-beta+
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-aurora?
[Attachment #604114](/attachment.cgi?id=604114&action=edit "fix, v2") -
Flags: approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a3125863_425645)• 13 years ago |

[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-esr10?
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-esr10+
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-beta?
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-beta+
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-aurora?
[Attachment #604115](/attachment.cgi?id=604115&action=edit "Make nsContentUtils::ASCIIToLower/ASCIIToUpper return NS_ERROR_OUT_OF_MEMORY when string allocation fails") -
Flags: approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a3125869_425645)• 13 years ago |

[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-esr10?
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-esr10+
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-beta?
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-beta+
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-aurora?
[Attachment #604117](/attachment.cgi?id=604117&action=edit "Propagate nsContentUtils::ASCIIToLower/ASCIIToUpper error") -
Flags: approval-mozilla-aurora+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=732951#c35)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-beta/rev/775ca6f1dd65>
<http://hg.mozilla.org/releases/mozilla-beta/rev/6395e457aec8>
<http://hg.mozilla.org/releases/mozilla-beta/rev/e08b72a676c4>
<http://hg.mozilla.org/releases/mozilla-aurora/rev/9d0f242dd277>
<http://hg.mozilla.org/releases/mozilla-aurora/rev/89759fa12b92>
<http://hg.mozilla.org/releases/mozilla-aurora/rev/3afc314d0de3>
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=732951#c36)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-esr10/rev/e54fd2b4ae5e>
<http://hg.mozilla.org/releases/mozilla-esr10/rev/5170890831db>
<http://hg.mozilla.org/releases/mozilla-esr10/rev/e3c662effd43>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=732951#c37)• 13 years ago |
|  | |

Is this something QA is able to verify?Whiteboard: [sg:critical] → [sg:critical][qa?]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=732951#c38)• 13 years ago |
|  | |

> Is this something QA is able to verify?
I think you would need the Reporter's OOM-testing tool for that.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=732951#c39)• 13 years ago |
|  | |

Christian, would you mind testing this to confirm it's fixed in Firefox 12 Beta, 13 Aurora, 14 Nightly and latest-esr10 nightly?Whiteboard: [sg:critical][qa?] → [sg:critical][qa-]

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=732951#c40)• 13 years ago |
|  | |

Is it an expected side effect that e.g. the following returns a pointer to char\_traits::sEmptyBuffer (which wasn't the case before):
nsCAutoString a;
nsCAutoString b(a);
char \*c = b.BeginWriting();
It's not entirely a problem because [bug 504660](/show_bug.cgi?id=504660 "RESOLVED FIXED - EnsureMutable(0) doesn't?") removed the constness of sEmptyBuffer, but that seems dangerous...

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=732951#c41)• 13 years ago |
|  | |

Yes, that is expected.

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=732951#c42)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #41](/show_bug.cgi?id=732951#c41 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> Yes, that is expected.
But is it right? Doesn't it get you back to [comment 1](/show_bug.cgi?id=732951#c1 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM") scenario.

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=732951#c43)• 13 years ago |
|  | |

(In reply to Mike Hommey [:glandium] from [comment #42](/show_bug.cgi?id=732951#c42 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> (In reply to Mats Palmgren [:mats] from [comment #41](/show_bug.cgi?id=732951#c41 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM"))
> > Yes, that is expected.
>
> But is it right? Doesn't it get you back to [comment 1](/show_bug.cgi?id=732951#c1 "RESOLVED FIXED - EnsureMutable() returns true (success) even when it failed due to OOM") scenario.
Forget it, I see what's happening.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732951#a6414338_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=732951&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mats Palmgren (inactive)](/user_profile?user_id=5168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_0454f97d_20250125_084141.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.mozilla.org_2ee4a966_20250125_084203.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/733282)
* [XML](/show_bug.cgi?ctype=xml&id=733282)

Closed
[Bug 733282](/show_bug.cgi?id=733282)

Opened 13 years ago
Closed 13 years ago

# Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS\_HTML5\_STREAM\_PARSER\_READ\_BUFFER\_SIZE' | ASSERTION: The decoder signaled an error other than NS\_ERROR\_ILLEGAL\_INPUT.: 'convResult == NS\_ERROR\_ILLEGAL\_INPUT'

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS\_HTML5\_STREAM\_PARSER\_READ\_BUFFER\_SIZE' | ASSERTION: The decoder signaled an error other than NS\_ERROR\_ILLEGAL\_INPUT.: 'convResult == NS\_ERROR\_ILLEGAL\_INPUT'

## Categories

### (Core Graveyard :: History: Global, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=History%3A%20Global#History%3A%20Global)

History: Global
▾

Core Graveyard :: History: Global
This is the global history which tracks all URLs that a user has visited, across all sessions of the browser. This also includes the history window and link coloring. Examples of appropriate bugs: Chrome URLs incorrectly added to global history, Reproducible crash when sorting by Title in History window, misbehaviour in the History sidebar tab.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=History%3A%20Global&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=History%3A%20Global&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=History%3A%20Global)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (firefox11 wontfix, firefox12+ verified, firefox13+ verified, firefox14+ verified, firefox-esr1012+ verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 |  | wontfix |
| firefox12 | + | verified |
| firefox13 | + | verified |
| firefox14 | + | verified |
| firefox-esr10 | 12+ | verified |

## People

### (Reporter: bc, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0d674a646529b0795088d7a8075fbaea?d=mm&size=40)  [mak](/user_profile?user_id=240353)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

### ( [URL](http://www.kogakkan-u.ac.jp/users/sirayama/index.html "http://www.kogakkan-u.ac.jp/users/sirayama/index.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[kogakkan-u.ac.jp/users/sirayama/index...](http://www.kogakkan-u.ac.jp/users/sirayama/index.html "http://www.kogakkan-u.ac.jp/users/sirayama/index.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical][qa+:ashughes])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa+:ashughes]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ small\_free\_list\_remove\_ptr | small\_malloc\_from\_free\_list | szone\_malloc ]](https://crash-stats.mozilla.org/signature/?signature=small_free_list_remove_ptr%20%7C%20small_malloc_from_free_list%20%7C%20szone_malloc)

[[@ small\_free\_list\_remove\_ptr | szone\_free | free | nsHtml5DataAvailable::~nsHtml5DataAvailable ]](https://crash-stats.mozilla.org/signature/?signature=small_free_list_remove_ptr%20%7C%20szone_free%20%7C%20free%20%7C%20nsHtml5DataAvailable%3A%3A~nsHtml5DataAvailable)

[[@ nsHtml5TreeBuilder::flushCharacters() ]](https://crash-stats.mozilla.org/signature/?signature=nsHtml5TreeBuilder%3A%3AflushCharacters%28%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [sirayama.tar.bz2](/attachment.cgi?id=603165)  [13 years ago](#c1)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   19.63 KB, application/x-bzip2 |  | [Details](/attachment.cgi?id=603165&action=edit) |
| --- | --- | --- |
| [Fix for the bug](/attachment.cgi?id=604370)  [13 years ago](#c4)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   1.75 KB, patch | smontagu : [review+](#c13 "13 years ago")  lsblakk : [approval-mozilla-aurora+](#c19 "13 years ago")  lsblakk : [approval-mozilla-beta+](#c19 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c19 "13 years ago") | [Details](/attachment.cgi?id=604370&action=edit) | [Diff](/attachment.cgi?id=604370&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370) |
| [Documentation, test and converter result code correctness](/attachment.cgi?id=604371)  [13 years ago](#c5)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   10.52 KB, patch | smontagu : [review+](#c11 "13 years ago") | [Details](/attachment.cgi?id=604371&action=edit) | [Diff](/attachment.cgi?id=604371&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604371) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=733282#c0)• 13 years ago |
|  | |

1. <http://www.kogakkan-u.ac.jp/users/sirayama/index.html>
perhaps reload
2. Crash Nightly/13. I can't reproduce with Aurora/12 or Beta/11.
###!!! ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS\_HTML5\_STREAM\_PARSER\_READ\_BUFFER\_SIZE', file /work/mozilla/builds/nightly/mozilla/parser/html/nsHtml5StreamParser.cpp, line 829
###!!! ASSERTION: The decoder signaled an error other than NS\_ERROR\_ILLEGAL\_INPUT.: 'convResult == NS\_ERROR\_ILLEGAL\_INPUT', file /work/mozilla/builds/nightly/mozilla/parser/html/nsHtml5StreamParser.cpp, line 836
Mac OS X 10.5
[bp-d4c07014-dc00-4446-9f2d-f27532120306](https://crash-stats.mozilla.org/report/index/d4c07014-dc00-4446-9f2d-f27532120306)
Firefox 13.0a1 Crash Report [@ small\_free\_list\_remove\_ptr | small\_malloc\_from\_free\_list | szone\_malloc ]
[bp-1cdb6ee0-3e92-4686-8a82-bb2d72120306](https://crash-stats.mozilla.org/report/index/1cdb6ee0-3e92-4686-8a82-bb2d72120306)
Firefox 13.0a1 Crash Report [@ small\_free\_list\_remove\_ptr | szone\_free | free | nsHtml5DataAvailable::~nsHtml5DataAvailable ]
Windows XP
[bp-fafa95bc-780e-4162-a0e0-7d8cd2120306](https://crash-stats.mozilla.org/report/index/fafa95bc-780e-4162-a0e0-7d8cd2120306)
Firefox 13.0a1 Crash Report [@ nsHtml5TreeBuilder::flushCharacters() ]
Windows 7
[bp-f10abc9a-e10d-4d73-aaa5-99d232120306](https://crash-stats.mozilla.org/report/index/f10abc9a-e10d-4d73-aaa5-99d232120306)
Firefox 13.0a1 Crash Report [@ RtlEnterCriticalSection ]
On Windows 7 with a debug build I saw
Assertion failure: local < script->nfixed, at c:/work/mozilla/builds/nightly/moz
illa/js/src/jsanalyze.cpp:186
And in Crash automation on Mac OS X 10.6 I saw
Assertion failure: (ptrBits & 0x7) == 0
Operating system: Mac OS X
10.6.8 10K549
CPU: amd64
family 6 model 23 stepping 10
2 CPUs
Crash reason: EXC\_BAD\_ACCESS / KERN\_INVALID\_ADDRESS
Crash address: 0x0
Thread 0 (crashed)
0 libmozglue.dylib!MOZ\_Crash [Assertions.cpp : 76 + 0x5]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x0000000100010e17
rsp = 0x00007fff5fbf8f80 rbp = 0x00007fff5fbf8f80
Found by: given as instruction pointer in context
1 libmozglue.dylib!MOZ\_Assert [Assertions.cpp : 88 + 0x4]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x0000000100010e79
rsp = 0x00007fff5fbf8f90 rbp = 0x00007fff5fbf8fb0
Found by: call frame info
2 XUL!JSVAL\_TO\_OBJECT\_IMPL [jsval.h : 766 + 0x23]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x0000000103654032
rsp = 0x00007fff5fbf8fc0 rbp = 0x00007fff5fbf8fe0
Found by: call frame info
3 XUL!JS::Value::toObject [jsapi.h : 544 + 0xb]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x0000000103678308
rsp = 0x00007fff5fbf8ff0 rbp = 0x00007fff5fbf9000
Found by: call frame info
4 XUL!js::GCMarker::processMarkStackTop [jsgcmark.cpp : 1090 + 0x8]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x0000000103701752
rsp = 0x00007fff5fbf9010 rbp = 0x00007fff5fbf90b0
Found by: call frame info
5 XUL!js::GCMarker::drainMarkStack [jsgcmark.cpp : 1172 + 0xc]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x00000001036fe751
rsp = 0x00007fff5fbf90c0 rbp = 0x00007fff5fbf9100
Found by: call frame info
6 XUL!MarkAndSweep [jsgc.cpp : 3293 + 0x13]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x00000001036e2efb
rsp = 0x00007fff5fbf9110 rbp = 0x00007fff5fbf9190
Found by: call frame info
7 XUL!GCCycle [jsgc.cpp : 3644 + 0xb]
rbx = 0x00000001002078d0 r12 = 0x0000000103082502
r13 = 0x0000000100107bb0 r14 = 0x0000000000000010
r15 = 0x0000000100107bb0 rip = 0x00000001036e30e6
rsp = 0x00007fff5fbf91a0 rbp = 0x00007fff5fbf9210
Found by: call frame info
s-s due to all of the various crashes related to memory and gc.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=733282#c1)• 13 years ago |
|  | |

Attached file
[sirayama.tar.bz2](attachment.cgi?id=603165)
— [Details](attachment.cgi?id=603165&action=edit)

1. install <https://www.squarefree.com/extensions/quitter.xpi>
2. tar jxvf sirayama.tar.bz2
3. firefox ./sirayama/index.html
Another nice assertion:
###!!! ASSERTION: Pointer overrun even before check: 'aDest <= aDestEnd', file /work/mozilla/builds/nightly/mozilla/intl/uconv/ucvja/../util/nsUCSupport.h, line 51

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a3119_23402)• 13 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=733282#c2)• 13 years ago |
|  | |

Henri, can you look into this? I'm guessing sg:critical here as this is a buffer overrun, which could lead to controllable crashes. If you disagree with that rating please let me know.Assignee: nobody → hsivonenWhiteboard: [sg:critical]

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a231484_152868)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=733282#c3)• 13 years ago |
|  | |

(In reply to Bob Clary [:bc:] from [comment #0](/show_bug.cgi?id=733282#c0 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> 1. <http://www.kogakkan-u.ac.jp/users/sirayama/index.html>
> perhaps reload
So this is Shift\_JIS content mislabeled as iso-2022-jp. There's a bug in the iso-2022-jp decoder that's tickled by Shift\_JIS input.
> ###!!! ASSERTION: The Unicode decoder wrote too much data.: 'end <=
> NS\_HTML5\_STREAM\_PARSER\_READ\_BUFFER\_SIZE', file
> /work/mozilla/builds/nightly/mozilla/parser/html/nsHtml5StreamParser.cpp,
> line 829
This is a bad bug in nsISO2022JPToUnicodeV2::Convert. Investigating.
> ###!!! ASSERTION: The decoder signaled an error other than
> NS\_ERROR\_ILLEGAL\_INPUT.: 'convResult == NS\_ERROR\_ILLEGAL\_INPUT', file
> /work/mozilla/builds/nightly/mozilla/parser/html/nsHtml5StreamParser.cpp,
> line 836
At least this one is trivial: nsISO2022JPToUnicodeV2::Convert can return NS\_ERROR\_UNEXPECTED even though it shouldn't do that.Status: NEW → ASSIGNED

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=733282#c4)• 13 years ago |
|  | |

Attached patch

[Fix for the bug](attachment.cgi?id=604370&action=diff)
— [Details](attachment.cgi?id=604370&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370)

I changed from == to >= to mitigate the damage in case a buffer overrun happens in the future by other means. When the operation is correct, == can be true but > should never.
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: review?

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a285182_5490)• 13 years ago |

[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: review? → review?(smontagu)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=733282#c5)• 13 years ago |
|  | |

Attached patch

[Documentation, test and converter result code correctness](attachment.cgi?id=604371&action=diff)
— [Details](attachment.cgi?id=604371&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604371)

[Attachment #604371](/attachment.cgi?id=604371&action=edit "Documentation, test and converter result code correctness") -
Flags: review?(smontagu)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=733282#c6)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #2](/show_bug.cgi?id=733282#c2 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> I'm guessing sg:critical here as this is a
> buffer overrun, which could lead to controllable crashes. If you disagree
> with that rating please let me know.
This bug indeed would allow data of the attackers choice to be written past the end of the buffer with the limitations that such a run of data would be prefixed with the REPLACEMENT CHARACTER and the data would need to be representable as iso-2022-jp.
(In reply to Henri Sivonen (:hsivonen) from [comment #3](/show_bug.cgi?id=733282#c3 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> There's a bug in the iso-2022-jp decoder
Well, hunting that "bug" was the wrong approach. The problem was that the HTML5 parser assumed that the Unicode decoders work in a certain way (signal that the output is full when it is full), but they aren't guaranteed to work that way. Instead, a decoder can check for illegal input before checking for the space in the output buffer and can signal illegal input when the output buffer is full also.
So this is yet another case of the decoder API contract being insufficiently documented. :-(
I split the fix into two patches: The first one can be landed as a security fix and the second one as a follow-up after the first one has been delivered to users so that it's OK to reveal more details.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=733282#c7)• 13 years ago |
|  | |

Henri, could this be a root cause for [bug 608994](/show_bug.cgi?id=608994 "RESOLVED DUPLICATE - ASSERTION: iconv failed: 'Error' | Crash [@ utf16_to_isolatin1 ] | [@ NS_CopyUnicodeToNative ]") ?

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=733282#c8)• 13 years ago |
|  | |

(In reply to Bob Clary [:bc:] from [comment #7](/show_bug.cgi?id=733282#c7 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> Henri, could this be a root cause for [bug 608994](/show_bug.cgi?id=608994 "RESOLVED DUPLICATE - ASSERTION: iconv failed: 'Error' | Crash [@ utf16_to_isolatin1 ] | [@ NS_CopyUnicodeToNative ]") ?
I'm not authorized to see that bug.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=733282#c9)• 13 years ago |
|  | |

(In reply to Bob Clary [:bc:] from [comment #7](/show_bug.cgi?id=733282#c7 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> Henri, could this be a root cause for [bug 608994](/show_bug.cgi?id=608994 "RESOLVED DUPLICATE - ASSERTION: iconv failed: 'Error' | Crash [@ utf16_to_isolatin1 ] | [@ NS_CopyUnicodeToNative ]") ?
Looks unrelated. Different converter back end. Different direction of conversion. Different caller.

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=733282#c10)• 13 years ago |
|  | |

Comment on [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370)
Fix for the bug
Review of [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370):
-----------------------------------------------------------------
::: parser/html/nsHtml5StreamParser.cpp
@@ +855,5 @@
> + nsHtml5OwningUTF16Buffer::FalliblyCreate(
> + NS\_HTML5\_STREAM\_PARSER\_READ\_BUFFER\_SIZE);
> + if (!newBuf) {
> + return NS\_ERROR\_OUT\_OF\_MEMORY;
> + }
Can you not share this code instead of adding another copy of it?

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=733282#c11)• 13 years ago |
|  | |

Comment on [attachment 604371](/attachment.cgi?id=604371 "Documentation, test and converter result code correctness") [[details]](/attachment.cgi?id=604371&action=edit "Documentation, test and converter result code correctness") [[diff]](/attachment.cgi?id=604371&action=diff "Documentation, test and converter result code correctness") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604371)
Documentation, test and converter result code correctness
Review of [attachment 604371](/attachment.cgi?id=604371 "Documentation, test and converter result code correctness") [[details]](/attachment.cgi?id=604371&action=edit "Documentation, test and converter result code correctness") [[diff]](/attachment.cgi?id=604371&action=diff "Documentation, test and converter result code correctness") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604371):
-----------------------------------------------------------------
::: parser/htmlparser/tests/crashtests/733282-1.html
@@ +1,1 @@
> +<meta charset=iso-2022-jp>
The raw bytes make this rather obfuscated. Perhaps you can make it clearer by using <iframe src="data:text/html;charset=iso-2022-jp,%80%80%80%80.... or something similar?
[Attachment #604371](/attachment.cgi?id=604371&action=edit "Documentation, test and converter result code correctness") -
Flags: review?(smontagu) → review+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=733282#c12)• 13 years ago |
|  | |

(In reply to Simon Montagu from [comment #10](/show_bug.cgi?id=733282#c10 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> Comment on [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370)
> Fix for the bug
>
> Review of [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370):
> -----------------------------------------------------------------
>
> ::: parser/html/nsHtml5StreamParser.cpp
> @@ +855,5 @@
> > + nsHtml5OwningUTF16Buffer::FalliblyCreate(
> > + NS\_HTML5\_STREAM\_PARSER\_READ\_BUFFER\_SIZE);
> > + if (!newBuf) {
> > + return NS\_ERROR\_OUT\_OF\_MEMORY;
> > + }
>
> Can you not share this code instead of adding another copy of it?
The repeated bit needs to be able to return early and needs to set a local variable in one flavor of the repeated bit. Having a function whose return value needs to be checked in order to return early didn't seem much of a win.
Should I share the code and have a return value check and early return outside the shared bit?

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=733282#c13)• 13 years ago |
|  | |

Comment on [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370)
Fix for the bug
Review of [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370):
-----------------------------------------------------------------
> The repeated bit needs to be able to return early and needs to set a local
> variable in one flavor of the repeated bit. Having a function whose return
> value needs to be checked in order to return early didn't seem much of a win.
A matter of taste, I suppose.
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: review?(smontagu) → review+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=733282#c14)• 13 years ago |
|  | |

Thanks. I landed the fix without landing the test & documentation patch yet:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/2e3760562b6c>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → ---
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) → ---
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) → ---
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → ---
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → ---
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) → ---
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) → ---Target Milestone: --- → mozilla13Version: Trunk → Other Branch

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=733282#c15)• 13 years ago |
|  | |

(Restoring flags reset by the last comment; also trunk is now mozilla14)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F)Target Milestone: mozilla13 → mozilla14Version: Other Branch → Trunk

|  | [Justin Wood (:Callek)](/user_profile?user_id=129968) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=733282#c16)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2e3760562b6c>Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a843943_1689)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=733282#c17)• 13 years ago |
|  | |

Another example: <http://www.tbs.co.jp/anime/kmb/radio/radio.html>

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=733282#c18)• 13 years ago |
|  | |

Comment on [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370)
Fix for the bug
[Approval Request Comment]
Regression caused by (bug #): Not really a regression unless you count the HTML5 landing as the cause.
User impact if declined: The user's system might get attacked by an attacker writing data past the end of a buffer. Non-malicious mislabeled pages can crash the browser.
Testing completed (on m-c, etc.): Has baked on m-c for a few days.
Risk to taking this patch (and alternatives if risky): Very low risk. Adds a buffer allocation in one place.
String changes made by this patch: None.
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-esr10?
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-beta?
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-aurora?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=733282#c19)• 13 years ago |
|  | |

Comment on [attachment 604370](/attachment.cgi?id=604370 "Fix for the bug") [[details]](/attachment.cgi?id=604370&action=edit "Fix for the bug") [[diff]](/attachment.cgi?id=604370&action=diff "Fix for the bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=733282&attachment=604370)
Fix for the bug
[Triage Comment]
Approving to land given low risk and being early in the beta cycle. For ESR see <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-esr10?
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-esr10+
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-beta?
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-beta+
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-aurora?
[Attachment #604370](/attachment.cgi?id=604370&action=edit "Fix for the bug") -
Flags: approval-mozilla-aurora+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=733282#c20)• 13 years ago |
|  | |

Thanks for the approvals.
<http://hg.mozilla.org/releases/mozilla-aurora/rev/772477595ea4>
<http://hg.mozilla.org/releases/mozilla-beta/rev/35f34594bd5e>
<http://hg.mozilla.org/releases/mozilla-esr10/rev/0325ae38d384>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=733282#c21)• 13 years ago |
|  | |

tested using Nightly/14, Aurora/13, Beta/12 on Linux, OS X 10.6, Windows XP/7
<http://www.tbs.co.jp/anime/kmb/radio/radio.html>
<http://www.kogakkan-u.ac.jp/users/sirayama/index.html>
-> No Crashes

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a2036210_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=733282#c22)• 13 years ago |
|  | |

(In reply to Bob Clary [:bc:] from [comment #21](/show_bug.cgi?id=733282#c21 "VERIFIED FIXED - Crash in nsHtml5TreeBuilder | ASSERTION: The Unicode decoder wrote too much data.: 'end <= NS_HTML5_STREAM_PARSER_READ_BUFFER_SIZE' | ASSERTION: The decoder signaled an error other than NS_ERROR_ILLEGAL_INPUT.: 'convResult == NS_ERROR_ILLEGAL_INPUT'"))
> tested using Nightly/14, Aurora/13, Beta/12 on Linux, OS X 10.6, Windows XP/7
> <http://www.tbs.co.jp/anime/kmb/radio/radio.html>
> <http://www.kogakkan-u.ac.jp/users/sirayama/index.html>
> -> No Crashes
So we can call this verified fixed on all three.Assignee: hsivonen → nobodyStatus: RESOLVED → VERIFIED
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)Component: HTML: Parser → History: GlobalQA Contact: parser → history.global

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a6362021_1689)• 13 years ago |

Group: core-security

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=733282#c23)• 13 years ago |
|  | |

Verified fixed in Firefox 10.0.4esr and 10.0.5esrpre.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] → [sg:critical][qa+:ashughes]

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=733282#a202166797_546015)• 6 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=733282&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mandriva.com_aa001e1f_20250125_084146.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_9202652f_20250125_084241.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/737129)
* [XML](/show_bug.cgi?ctype=xml&id=737129)

Closed
[Bug 737129](/show_bug.cgi?id=737129)

Opened 13 years ago
Closed 13 years ago

# Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 | --- | [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 |  | affected |
| firefox12 | + | fixed |
| firefox13 | + | fixed |
| firefox14 | + | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bc, Assigned: mccr8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

### ( [URL](http://members.home.nl/bdr/files/fusker.html?http://members.home.nl/bdr/files/fusker.html%3Fhttp://i.crackedcdn.com/phpimages/photoshop/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D%5B00-99%5D_slide.jpg "http://members.home.nl/bdr/files/fusker.html?http://members.home.nl/bdr/files/fusker.html%3Fhttp://i.crackedcdn.com/phpimages/photoshop/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D%5B00-99%5D_slide.jpg") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory")

Dependency [tree](/showdependencytree.cgi?id=737129&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=737129)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[members.home.nl/bdr/files/fusker.html...](http://members.home.nl/bdr/files/fusker.html?http://members.home.nl/bdr/files/fusker.html%3Fhttp://i.crackedcdn.com/phpimages/photoshop/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D%5B00-99%5D_slide.jpg "http://members.home.nl/bdr/files/fusker.html?http://members.home.nl/bdr/files/fusker.html%3Fhttp://i.crackedcdn.com/phpimages/photoshop/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D%5B00-99%5D_slide.jpg")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, reproducible, Whiteboard: [sg:critical][fixed by bug 737875][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][fixed by bug 737875][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ EMPTY: no crashing thread identified; corrupt dump ]](https://crash-stats.mozilla.org/signature/?signature=EMPTY%3A%20no%20crashing%20thread%20identified%3B%20corrupt%20dump)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [sample crash report](/attachment.cgi?id=607258)  [13 years ago](#c0)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   52.50 KB, text/plain |  | [Details](/attachment.cgi?id=607258&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=737129#c0)• 13 years ago |
|  | |

Attached file
[sample crash report](attachment.cgi?id=607258)
— [Details](attachment.cgi?id=607258&action=edit)

1. <http://members.home.nl/bdr/files/fusker.html?http://members.home.nl/bdr/files/fusker.html%3Fhttp://i.crackedcdn.com/phpimages/photoshop/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D/%5B1-9%5D%5B00-99%5D_slide.jpg>
2. Consume CPU and RAM until you crash
###!!! ASSERTION: Inserting node that already has parent: '!aKid->GetNodeParent()', file c:/work/mozilla/builds/nightly/mozilla/cont
ent/base/src/nsGenericElement.cpp, line 3757
Crashes Nightly/14, Aurora/13, Beta/12, Firefox/11 on Windows XP and Windows 7.
Firefox/11
[bp-9c5f6e84-81d0-49ff-83f4-385fd2120319](https://crash-stats.mozilla.org/report/index/9c5f6e84-81d0-49ff-83f4-385fd2120319)
[@ EMPTY: no crashing thread identified; corrupt dump ]
Nightly/14
[bp-6d234ff4-7365-4282-8f8b-db3ca2120319](https://crash-stats.mozilla.org/report/index/6d234ff4-7365-4282-8f8b-db3ca2120319)
[@ EMPTY: no crashing thread identified; corrupt dump ]
Operating system: Windows NT
6.1.7601 Service Pack 1
CPU: x86
GenuineIntel family 6 model 37 stepping 1
2 CPUs
Crash reason: EXCEPTION\_ACCESS\_VIOLATION\_EXEC
Crash address: 0xffffffffb0fdfdfd
Thread 0 (crashed)
0 0xb0fdfdfd
eip = 0xb0fdfdfd esp = 0x0052aba8 ebp = 0x0052abc4 ebx = 0x1f4bb790
esi = 0x063479b0 edi = 0x04e605c0 eax = 0xff00a5f0 ecx = 0xdddddddd
edx = 0xb0fdfdfd efl = 0x00010286
Found by: given as instruction pointer in context
Note the heap fenceposts 0xfd and the deleted memory. Other reports show 0xfeeefeee which is freed Heap memory from HeapFree. Common pattern in all reports so far is ecx = 0xdddddddd
Running under windbg I crash at [@ nsiNodeInfo::NodeInfoManager ]
More reports are available in Bughunter.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=737129#c1)• 13 years ago |
|  | |

Christian, can you run your OOM tool with this page and see if making certain allocations fail leads to badness?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=737129#c2)• 13 years ago |
|  | |

I'm testing this right now but it'll take a while until I can post possible results :)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737129#a157500_395101)• 13 years ago |

Blocks: [737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737129#a165670_1689)• 13 years ago |

Whiteboard: [sg:critical]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=737129#c3)• 13 years ago |
|  | |

Kyle: are you volunteering to take this bug? :-)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=737129#c4)• 13 years ago |
|  | |

No.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=737129#c5)• 13 years ago |
|  | |

Andrew says he can look into this. Tracking for 12 onwards, but whether we can fix this for 12 etc depends on what the fix ends up looking like...Assignee: nobody → continuation
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=737129#c6)• 13 years ago |
|  | |

It is possible that this is fixed by [bug 737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory"). The assertion here and the crash there both have "aKid" and I derived that crash from the testcase here using OOM testing. Since khuey has a fix for that bug, maybe bc can retest this once that fix landed.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=737129#c7)• 13 years ago |
|  | |

The page is a script that creates a page with a bunch of inline images (656100 to be precise). Running it on a bogus URL (so that it wasn't loading images at the same time) caused a lot of these:
WARNING: NS\_ENSURE\_SUCCESS(rv, rv) failed with result 0x80004005: file /Users/amccreight/mz/cent3/content/base/src/nsGenericElement.cpp, line 3780

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=737129#c8)• 13 years ago |
|  | |

I'll wait to see if the other bug fixed this before investigating further.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=737129#c9)• 13 years ago |
|  | |

I retested Beta/12, Aurora/13 and Nightly/14 in automation and only crashed in Windows 7 32 bit Beta/12, Aurora/13 and Nightly/14 without getting a crash dump. The last time Beta or Aurora showed an exploitable crash was 3/20 on Windows 7 64bit with 32bit builds.
Testing locally I only have seen oom aborts Windows XP 32bit and Windows 7 32bit Nightly/14. On Window 7 64bit (32bit builds) it just cranks along without crashing.
Testing locally with Aurora/Beta on Windows XP, I've seen the exploitable crashes with eax and ecx = 0xfeeefeee. Aurora/Beta on Windows 7 32bit only showed oom.
Not sure why automation didn't show the exploitable crashes on xp. Based on local testing I would say this is fixed on Nightly though. I haven't checked if the particular patch is responsible though.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=737129#c10)• 13 years ago |
|  | |

Should we close/dupe this bug?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=737129#c11)• 13 years ago |
|  | |

lets call it fixed by [bug 737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory")Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical] → [sg:critical][fixed by bug 737875]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=737129#c12)• 13 years ago |
|  | |

[bug 737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory") has now been checked in to beta/aurora/esr10
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=737129#c13)• 13 years ago |
|  | |

As given by the testcase-wanted keyword, is there a testcase QA can use to verify this fix? [Comment 0](/show_bug.cgi?id=737129#c0 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack") perhaps?Whiteboard: [sg:critical][fixed by bug 737875] → [sg:critical][fixed by bug 737875][qa?]

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=737129#c14)• 13 years ago |
|  | |

The testcase-wanted was to ask someone to develop a reduced test case but I don't know if it is possible to get a reproducible one given the nature of these low/oom bugs.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=737129#c15)• 13 years ago |
|  | |

(In reply to Bob Clary [:bc:] from [comment #14](/show_bug.cgi?id=737129#c14 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack"))
> The testcase-wanted was to ask someone to develop a reduced test case but I
> don't know if it is possible to get a reproducible one given the nature of
> these low/oom bugs.
Given that we'll qa- this bug and put faith in crashstats data.Whiteboard: [sg:critical][fixed by bug 737875][qa?] → [sg:critical][fixed by bug 737875][qa-]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=737129#c16)• 13 years ago |
|  | |

Can this be verified through verification of [bug 737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory")?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=737129#c17)• 13 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #16](/show_bug.cgi?id=737129#c16 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack"))
> Can this be verified through verification of [bug 737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory")?
I assert that to be the case, yes.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737129#a5187544_1689)• 13 years ago |

Group: core-security

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737129#a5630744_272375)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=737129#c18)• 13 years ago |
|  | |

calling this fixed as per [comment 11](/show_bug.cgi?id=737129#c11 "RESOLVED FIXED - Possible Exploitable Crashes with Low Memory [@ nsiNodeInfo::NodeInfoManager ] with js::mjit::EnterMethodJIT on the stack"), this was landed on 14 in [bug 737875](/show_bug.cgi?id=737875 "RESOLVED FIXED - OOM Crash [@ nsQueryInterfaceWithError::operator] trying to execute random memory")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=737129#a112835553_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=737129&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_c4085b4a_20250125_084201.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/732941)
* [XML](/show_bug.cgi?ctype=xml&id=732941)

Closed
[Bug 732941](/show_bug.cgi?id=732941)

Opened 13 years ago
Closed 13 years ago

# OOM Crash [@ nsCOMArray<nsISelectionListener>::operator[]] due to unhandled alloc failure in nsTypedSelection::NotifySelectionListeners

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

OOM Crash [@ nsCOMArray<nsISelectionListener>::operator[]] due to unhandled alloc failure in nsTypedSelection::NotifySelectionListeners

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla13

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) |
| firefox13 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | fixed |
| firefox13 |  | fixed |
| firefox-esr10 | 12+ | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[oomfuzz](/show_bug.cgi?id=687256 "RESOLVED FIXED - [meta] Need fuzz testing of OOM conditions to find exploitable crashes")

Dependency [tree](/showdependencytree.cgi?id=732941&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=732941)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, crash, Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsCOMArray<nsISelectionListener>::operator[] ]](https://crash-stats.mozilla.org/signature/?signature=nsCOMArray%3CnsISelectionListener%3E%3A%3Aoperator%5B%5D)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [fix](/attachment.cgi?id=604662)  [13 years ago](#c1)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   1.58 KB, patch | bzbarsky : [review+](#c3 "13 years ago")  akeybl : [approval-mozilla-beta+](#c9 "13 years ago")  lsblakk : [approval-mozilla-esr10+](#c12 "13 years ago") | [Details](/attachment.cgi?id=604662&action=edit) | [Diff](/attachment.cgi?id=604662&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=732941#c0)• 13 years ago |
|  | |

Tested on m-c revision 8ea5c983743f: The code in nsTypedSelection::NotifySelectionListeners does not properly handle an OOM condition (I assume it's while cloning selectionListeners) that leads to the following assertion and crash:
###!!! ASSERTION: nsVoidArray::FastElementAt: index out of range: '0 <= aIndex && aIndex < Count()', file ../../dist/include/nsVoidArray.h, line 78
Program received signal SIGSEGV, Segmentation fault.
nsCOMArray<nsISelectionListener>::operator[] (this=0x7fffffff8620, aIndex=0) at ../../dist/include/nsCOMArray.h:186
186 return ObjectAt(aIndex);
#0 nsCOMArray<nsISelectionListener>::operator[] (this=0x7fffffff8620, aIndex=0) at ../../dist/include/nsCOMArray.h:186
#1 0x00002aaaac7382ed in nsTypedSelection::NotifySelectionListeners (this=0x4e90470) at /srv/repos/browser/mozilla-central/layout/generic/nsSelection.cpp:5712
#2 0x00002aaaac738408 in nsTypedSelection::EndBatchChanges (this=<optimized out>) at /srv/repos/browser/mozilla-central/layout/generic/nsSelection.cpp:5734
#3 0x00002aaaacbb44e2 in nsEditor::DoTransaction (this=0x5c71bb0, aTxn=0x5c72210) at /srv/repos/browser/mozilla-central/editor/libeditor/base/nsEditor.cpp:716
#4 0x00002aaaacbacea0 in nsEditor::InsertNode (this=0x5c71bb0, aNode=0x5c72108, aParent=0x4e90668, aPosition=0) at /srv/repos/browser/mozilla-central/editor/libeditor/base/nsEditor.cpp:1404
#5 0x00002aaaacba81cd in CreateBogusNodeIfNeeded (aSelection=0x4e90470, this=0x5c71ee0) at /srv/repos/browser/mozilla-central/editor/libeditor/text/nsTextEditRules.cpp:1168
#6 nsTextEditRules::CreateBogusNodeIfNeeded (this=0x5c71ee0, aSelection=0x4e90470) at /srv/repos/browser/mozilla-central/editor/libeditor/text/nsTextEditRules.cpp:1115
#7 0x00002aaaacba97eb in Init (aEditor=<optimized out>, this=0x5c71ee0) at /srv/repos/browser/mozilla-central/editor/libeditor/text/nsTextEditRules.cpp:139
=> 0x2aaaac736e73 <nsCOMArray<nsISelectionListener>::operator[](int) const+73>: mov 0x8(%rax,%rbx,8),%rax
rax 0x0 0
rbx 0x0 0
(gdb) f 1
#1 0x00002aaaac7382ed in nsTypedSelection::NotifySelectionListeners (this=0x4fef960) at /srv/repos/browser/mozilla-central/layout/generic/nsSelection.cpp:5712
5712 nsISelectionListener\* thisListener = selectionListeners[i];
(gdb) p selectionListeners
$1 = {<nsCOMArray\_base> = {mArray = {mImpl = 0x0}}, <No data fields>}
The backtrace of the failing allocation is as follows:
#0 /srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/dist/bin/libmozalloc.so(moz\_malloc+0x5f)
#1 nsVoidArray::SizeTo(int) at objdir-ff-gcc64dbg/xpcom/build/nsVoidArray.cpp:231
#2 nsVoidArray::Count() const at xpcom/glue/nsVoidArray.h:67
#3 nsCOMPtr<nsIPresShell>::begin\_assignment() at objdir-ff-gcc64dbg/dist/include/nsCOMPtr.h:1241
#4 nsTypedSelection::EndBatchChanges() at layout/generic/nsSelection.cpp:5737
#5 nsEditor::DoTransaction(nsITransaction\*) at editor/libeditor/base/nsEditor.cpp:702
#6 nsEditor::InsertNode(nsIDOMNode\*, nsIDOMNode\*, int) at editor/libeditor/base/nsEditor.cpp:1404
#7 nsTextEditRules::CreateBogusNodeIfNeeded(nsISelection\*) at editor/libeditor/text/nsTextEditRules.cpp:1169
#8 nsTextEditRules::Init(nsPlaintextEditor\*) at editor/libeditor/text/nsTextEditRules.cpp:140
#9 nsPlaintextEditor::EndEditorInit() at editor/libeditor/text/nsPlaintextEditor.cpp:221
#10 ~nsAutoEditInitRulesTrigger at editor/libeditor/text/nsTextEditUtils.cpp:123
#11 nsPlaintextEditor::Init(nsIDOMDocument\*, nsIContent\*, nsISelectionController\*, unsigned int) at editor/libeditor/text/nsPlaintextEditor.cpp:159
#12 nsTextEditorState::PrepareEditor(nsAString\_internal const\*) at content/html/content/src/nsTextEditorState.cpp:1225
#13 nsTextEditorState::GetEditor() at content/html/content/src/nsTextEditorState.cpp:1010
#14 ns\_if\_addref<nsIEditor\*> at objdir-ff-gcc64dbg/dist/include/nsISupportsUtils.h:93
#15 /srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/dist/bin/libxul.so(NS\_InvokeByIndex\_P+0x23a)
I'm marking this as s-s for now because it's not clear to me what mSelectionListeners contains exactly, especially if the attacker can control how many listeners are in there (which could turn the crash into a controlled read). However, even in that case, exploitation is likely very hard because creating a controlled OOM in that location is surely not trivial.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732941#a391466_5168)• 13 years ago |

Assignee: nobody → matspal

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=732941#c1)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=604662&action=diff)
— [Details](attachment.cgi?id=604662&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662)

Check that we copied the whole array.
I'm also removing the null-check inside the loop since
nsTypedSelection::AddSelectionListener rejects null and mSelectionListeners
isn't inserted to from anywhere else.
<https://tbpl.mozilla.org/?usebuildbot=1&tree=Try&rev=b147664bf01a>
[Attachment #604662](/attachment.cgi?id=604662&action=edit "fix") -
Flags: review?(bzbarsky)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=732941#c2)• 13 years ago |
|  | |

'thisListener' used to be the result of a QI at some point so that's where the
null-check came from:
<http://bonsai.mozilla.org/cvsblame.cgi?file=/mozilla/layout/generic/nsSelection.cpp&rev=3.1&root=/cvsroot#1849>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=732941#c3)• 13 years ago |
|  | |

Comment on [attachment 604662](/attachment.cgi?id=604662 "fix") [[details]](/attachment.cgi?id=604662&action=edit "fix") [[diff]](/attachment.cgi?id=604662&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662)
fix
r=me
[Attachment #604662](/attachment.cgi?id=604662&action=edit "fix") -
Flags: review?(bzbarsky) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=732941#c4)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/eeb3752c717c>Whiteboard: [inbound]Target Milestone: --- → mozilla13

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=732941#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/eeb3752c717c>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [inbound]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=732941#c6)• 13 years ago |
|  | |

This looks like a null deref unless I'm reading over this too quickly. If I've gotten that wrong please nominate for the ESR branch (and ask for approval on the patch).
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)Whiteboard: [sg:dos null deref]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=732941#c7)• 13 years ago |
|  | |

It's not a null deref. We're reading beyond the array buffer end and interpreting
that as a nsISelectionListener object and calling a virtual function on that
bogus object.Whiteboard: [sg:dos null deref] → [sg:critical]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=732941#c8)• 13 years ago |
|  | |

Comment on [attachment 604662](/attachment.cgi?id=604662 "fix") [[details]](/attachment.cgi?id=604662&action=edit "fix") [[diff]](/attachment.cgi?id=604662&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662)
fix
see [comment 7](/show_bug.cgi?id=732941#c7 "RESOLVED FIXED - OOM Crash [@ nsCOMArray<nsISelectionListener>::operator[]] due to unhandled alloc failure in nsTypedSelection::NotifySelectionListeners"). Low risk.
[Attachment #604662](/attachment.cgi?id=604662&action=edit "fix") -
Flags: approval-mozilla-beta?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732941#a2452030_5168)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix) → [?](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=%3F)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=732941#c9)• 13 years ago |
|  | |

Comment on [attachment 604662](/attachment.cgi?id=604662 "fix") [[details]](/attachment.cgi?id=604662&action=edit "fix") [[diff]](/attachment.cgi?id=604662&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662)
fix
[Triage Comment]
Low risk sg: crit fix. Please land on m-b and prepare a patch for the ESR.
[Attachment #604662](/attachment.cgi?id=604662&action=edit "fix") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732941#a2522452_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=732941#c10)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/8486e1b8a256>
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=732941#c11)• 13 years ago |
|  | |

Comment on [attachment 604662](/attachment.cgi?id=604662 "fix") [[details]](/attachment.cgi?id=604662&action=edit "fix") [[diff]](/attachment.cgi?id=604662&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662)
fix
The patch also applies to esr10.
[Attachment #604662](/attachment.cgi?id=604662&action=edit "fix") -
Flags: approval-mozilla-esr10?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=732941#c12)• 13 years ago |
|  | |

Comment on [attachment 604662](/attachment.cgi?id=604662 "fix") [[details]](/attachment.cgi?id=604662&action=edit "fix") [[diff]](/attachment.cgi?id=604662&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=732941&attachment=604662)
fix
low risk, go ahead and land on ESR.
[Attachment #604662](/attachment.cgi?id=604662&action=edit "fix") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=732941#c13)• 13 years ago |
|  | |

Is there anything QA can do to verify this fix?Whiteboard: [sg:critical] → [sg:critical][qa?]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=732941#c14)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/076f467733b4>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=732941#c15)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #13](/show_bug.cgi?id=732941#c13 "RESOLVED FIXED - OOM Crash [@ nsCOMArray<nsISelectionListener>::operator[]] due to unhandled alloc failure in nsTypedSelection::NotifySelectionListeners"))
> Is there anything QA can do to verify this fix?
Christian triggered this crash with a OOM testing tool, presumably it's
repeatable.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=732941#c16)• 13 years ago |
|  | |

There is no portable solution yet to trigger this crash because my tool uses absolute addresses to indicate which functions to cause failure in. I'm not entirely sure if there can be any way to test this in a portable way without instrumenting the particular code in question.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=732941#c17)• 13 years ago |
|  | |

Christian, can you verify that this is fixed on trunk and, if you have builds, 12?

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=732941#c18)• 13 years ago |
|  | |

qa- for verification given recent comments. Christian is there any assistance you can give in verifying this for Firefox 12, 13 and ESR 10.0.4?Whiteboard: [sg:critical][qa?] → [sg:critical][qa-]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=732941#c19)• 13 years ago |
|  | |

Unfortunately there is no direct way for me to verify this, other than performing another full run of my scripts on the initial test/url which takes really long.
The reason for this is that there is no portable way (portable across builds) to indicate where an OOM condition should be triggered. I might be working on that in the future but right now, we can't verify this directly.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=732941#c20)• 13 years ago |
|  | |

Okay, thanks Christian. Does this go for all OOM crashes?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=732941#c21)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #20](/show_bug.cgi?id=732941#c20 "RESOLVED FIXED - OOM Crash [@ nsCOMArray<nsISelectionListener>::operator[]] due to unhandled alloc failure in nsTypedSelection::NotifySelectionListeners"))
> Okay, thanks Christian. Does this go for all OOM crashes?
At least for those that I filed blocking [bug 687256](/show_bug.cgi?id=687256 "RESOLVED FIXED - [meta] Need fuzz testing of OOM conditions to find exploitable crashes"), yes.
For other OOM crashes (e.g. those that Bob Clary files), it is usually also very hard to verify a fix, because OOM conditions are very fragile, so not seeing a crash anymore does not mean it is fixed.
The only OOM conditions that can somewhat be verified fixed are those triggered in the JS shell, either by a fuzz test or those involving -A parameter. The parameter varies with builds too, but it's possible to cover a certain range for that parameter to ensure the issue is gone, and I do have scripts for that.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=732941#a6415742_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=732941&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mats Palmgren (inactive)](/user_profile?user_id=5168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_ac3db01c_20250125_084152.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/708825)
* [XML](/show_bug.cgi?ctype=xml&id=708825)

Closed
[Bug 708825](/show_bug.cgi?id=708825)

Opened 13 years ago
Closed 13 years ago

# "ASSERTION: Fault in cycle collector: traversed refs exceed refcount" closing window nearScriptStackLimit

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: Fault in cycle collector: traversed refs exceed refcount" closing window nearScriptStackLimit

## Categories

### (Core :: XPCOM, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPCOM#XPCOM)

XPCOM
▾

Core :: XPCOM
This is the basis of our component technology; this covers the mozilla/xpcom source directory and includes the "repository". Unlikely a tester would be able to tell there was an XPCOM problem specifically.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPCOM&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPCOM)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla12

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) |
| firefox10 | [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | - | wontfix |
| firefox10 | - | wontfix |
| firefox11 | - | wontfix |
| firefox12 | + | verified |
| firefox13 | + | verified |
| firefox14 | + | verified |
| firefox-esr10 | 12+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: mccr8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase](/attachment.cgi?id=580173)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   624 bytes, text/html |  | [Details](/attachment.cgi?id=580173&action=edit) |
| --- | --- | --- |
| [fix an error path, patch against Fx11 and 12](/attachment.cgi?id=604576)  [13 years ago](#c16)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   1.25 KB, patch |  | [Details](/attachment.cgi?id=604576&action=edit) | [Diff](/attachment.cgi?id=604576&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604576) |
| [fix for 13](/attachment.cgi?id=604590)  [13 years ago](#c18)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   1.32 KB, patch | bholley : [review+](#c22 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c31 "13 years ago")  akeybl : [approval-mozilla-beta+](#c31 "13 years ago")  akeybl : [approval-mozilla-esr10+](#c31 "13 years ago") | [Details](/attachment.cgi?id=604590&action=edit) | [Diff](/attachment.cgi?id=604590&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604590) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=708825#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=580173)
— [Details](attachment.cgi?id=580173&action=edit)

1. Load the testcase
2. Click the button
3. Close the testcase
4. Force a CC (e.g. by quitting Firefox or using about:memory)
Result:
###!!! ASSERTION: Fault in cycle collector: traversed refs exceed refcount (ptr: 127319dc0)
: 'Not Reached', file /Users/jruderman/trees/mozilla-central/xpcom/base/nsCycleCollector.cpp, line 1235
In addition, everything leaks.
I can reproduce with both Tinderbox debug builds and a local debug build (Mac OS X 10.6, 64-bit Firefox).
Some variants crash instead, in exploitable-looking ways.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a1921_406194)• 13 years ago |

Assignee: nobody → continuation

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=708825#c1)• 13 years ago |
|  | |

When the cycle collector hits a fault like this, it turns itself off, which would explain the leaks.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=708825#c2)• 13 years ago |
|  | |

The easiest way for me to reproduce this was to load the test case, click the button, then just exit the browser. The first shutdown CC will hit the assertion, I believe.
The node in question is an <html> element. It has a refcount of 3, with 4 references to it. Those references are its 3 children, plus the document it is in. The children are a <head>, <body> and a nsGenericDOMDataNode. The nsGenericDOMDataNode seems like it has the most possibility for being what is wrong, but I'm not sure.
The DOM isn't traversed until it isn't part of a currently displayed window, which is probably why you have to close the testcase before the assertion triggers.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=708825#c3)• 13 years ago |
|  | |

I'm curious which <html> element. The testcase, about:blank, or data:text/html,1 ?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=708825#c4)• 13 years ago |
|  | |

The test case. It looks like there's no data:test/html document by the time the CC fires off, but I could be wrong.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=708825#c5)• 13 years ago |
|  | |

Oh, that explains why I had to leave in the line
void ((new XMLSerializer).serializeToString(document.documentElement));

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=708825#c6)• 13 years ago |
|  | |

Is this a recent regression or has it been around for a while (e.g. does it affect Fx9 or earlier)?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a603117_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a2419704_12352)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=708825#c7)• 13 years ago |
|  | |

I'll start looking at this again. Though I worry the recent CC changes will make the test case succeed, but the problem still remains. I can always go back to a slightly older build.
I'm curious about what is causing it, but I wonder if in general we should just quit the browser if we hit this fault. It seems to me that if you have more references to something than the refcount thinks there are, that's just a dangling pointer waiting to happen. This is the first time I've ever heard of this happening, so hopefully it isn't a common problem. And by turning them into crashes, at least we'd have an idea if it was.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=708825#c8)• 13 years ago |
|  | |

John glanced at the serializer code, and he said it looked like it was manually patching up some ref count related stuff, and had some scary comments, so that sounds promising.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a6653639_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=708825#c9)• 13 years ago |
|  | |

Andrew, ping?
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=708825#c10)• 13 years ago |
|  | |

Oh right this. I'll look at it after [bug 723971](/show_bug.cgi?id=723971 "RESOLVED FIXED - black-gray edges due to shapes in UnmarkGrayChildren").

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=708825#c11)• 13 years ago |
|  | |

I can't reproduce this on a recent Nightly debug build. I even tried making all CCs WANT\_ALL\_TRACES which should disable most of the recent CC optimizations, but that didn't seem to matter.
On a debug Aurora build, it crashes immediately:
Assertion failure: !cx->isExceptionPending(), at /builds/slave/m-aurora-osx-dbg/build/js/src/jscntxtinlines.h:314
I'm not sure what that means.
On a recent 11 debug nightly, it doesn't seem to reproduce either.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=708825#c12)• 13 years ago |
|  | |

Jesse, can you still reproduce this? Do you happen to have some similar test cases that do reproduce it?
If not, I think I'll do a bisection on 11 to try to figure out where it stopped hitting the assertion, as I'm not really convinced this has been fixed magically.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=708825#c13)• 13 years ago |
|  | |

Okay, now I can't reproduce this on a 12-08 nightly from here:
ftp://ftp.mozilla.org/pub/firefox/nightly/2011/12/2011-12-08-mozilla-central-debug/
or on a couple of other December nightlies. I'm not sure what I'm doing wrong here.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a7704266_1689)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical] [need answer to comment 12 from jruderman]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=708825#c14)• 13 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #0](/show_bug.cgi?id=708825#c0 "VERIFIED FIXED - \"ASSERTION: Fault in cycle collector: traversed refs exceed refcount\" closing window nearScriptStackLimit"))
> Some variants crash instead, in exploitable-looking ways.
Can we get one or two of those attached here? Might help mccr8 find the problem.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=708825#c15)• 13 years ago |
|  | |

Okay, "fortunately" I can reproduce this issue on a local build of beta. I'll go from there.Whiteboard: [sg:critical] [need answer to comment 12 from jruderman] → [sg:critical]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a7862409_1689)• 13 years ago |

[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=708825#c16)• 13 years ago |
|  | |

Attached patch

[fix an error path, patch against Fx11 and 12](attachment.cgi?id=604576&action=diff)
— [Details](attachment.cgi?id=604576&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604576)

Thanks a lot to jst for helping me work through this.
When we're morphing a slim wrapper into a regular wrapper, we create a new XPCWrappedNative, and set it to point at the native. We do not addref to do this, because the plan is to make the JS Object wrapper point to the XPCWN, so the ref count will stay the same. But we're in an inconsistent state until we make the update.
We then attempt to enter the compartment of the existing JS object (the wrapper). This fails due to stack overflow. We then drop the last reference to the XPCWrappedNative, causing it to call its destructor. When the destructor runs, it sees that the XPCWN points to a native, so it calls release on this object, because it thinks it owns it, but it doesn't actually. This causes the ref count to be too low, causing the cycle collector assertion.
The fix is to null out the pointer to the native in the XPCWN before we release it.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=708825#c17)• 13 years ago |
|  | |

It looks like this was broken by brain transplants ([bug 580128](/show_bug.cgi?id=580128 "RESOLVED FIXED - Implement brain transplants")):
<http://hg.mozilla.org/mozilla-central/diff/9dc0c11e8eb8/js/src/xpconnect/src/xpcwrappednative.cpp>
That added the compartment enter check.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a7966831_406194)• 13 years ago |

[Attachment #604576](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") -
Attachment description: fix an error path, patch against Fx11 → fix an error path, patch against Fx11 and 12

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=708825#c18)• 13 years ago |
|  | |

Attached patch

[fix for 13](attachment.cgi?id=604590&action=diff)
— [Details](attachment.cgi?id=604590&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604590)

Basically the same.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a7967259_406194)• 13 years ago |

[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: review?(bobbyholley+bmo)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=708825#c19)• 13 years ago |
|  | |

\o/
Think we'll be able to fix this on the Firefox 10 branch? The bug will be fairly easy to discover once the nearScriptStackLimit gadget becomes public. It might become public as the result of other bugs being fixed, or as the result of the planned fuzzer release in April.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=708825#c20)• 13 years ago |
|  | |

Isn't 11 releasing within a week?
Pretty cool fuzzer tool, though! jst suggested that having a enter compartment thing that could be triggered to fail might help find weird error paths like this.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=708825#c21)• 13 years ago |
|  | |

This is certainly fx10 esr material, but I think the fx11 ship has sailed at this point. If we do end up doing a 11.0.1 or what not this one could maybe ride along, but I wouldn't re-spin for this at this late of a time.
Reliably exploiting this seems significantly less than trivial, even if people figure out how to reliably trigger this particular error, you still need to predict when the object in question gets prematurely destroyed, then write to the memory that held this object, and then wait for the existing references to this object to be touched, either by the CC, or some other code.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a8025866_406194)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=708825#c22)• 13 years ago |
|  | |

Comment on [attachment 604590](/attachment.cgi?id=604590 "fix for 13") [[details]](/attachment.cgi?id=604590&action=edit "fix for 13") [[diff]](/attachment.cgi?id=604590&action=diff "fix for 13") [[review]](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604590)
fix for 13
I'd love a comment here, but I can understand if we want to keep the commit low-profile. And slim wrappers are going away in the near future, so this will probably stay in my memory until then.
Sorry for the delay. r=bholley
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: review?(bobbyholley+bmo) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=708825#c23)• 13 years ago |
|  | |

We should land this toward the middle-end of the Fx12 cycle, and then land everywhere.
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=708825#c24)• 13 years ago |
|  | |

You mean the current Firefox 14 cycle? Sounds good to me.
For my own reference, that's the very end of March.

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=708825#c25)• 13 years ago |
|  | |

[Triage Comment]
Removing the tracking on this, leaving status-firefox-esr10 affected, we'll track it for the right esr release once it's fixed.
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) → ---

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=708825#c26)• 13 years ago |
|  | |

Comment on [attachment 604576](/attachment.cgi?id=604576 "fix an error path, patch against Fx11 and 12") [[details]](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") [[diff]](/attachment.cgi?id=604576&action=diff "fix an error path, patch against Fx11 and 12") [[review]](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604576)
fix an error path, patch against Fx11 and 12
[Approval Request Comment]
Regression caused by (bug #): 580128
User impact if declined: users of 12 and 13 may be exposed to vulnerability once this lands
Testing completed (on m-c, etc.): Passed a try run. I can land this on m-c a few days before I land it elsewhere to make sure it doesn't go crazy, but I'd prefer to have some kind of conditional approval before I do that, if possible.
Risk to taking this patch (and alternatives if risky): Low. This patch only alters the behavior of a very rarely taken path that will probably crash anyways.
String changes made by this patch: none
[Attachment #604576](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") -
Flags: approval-mozilla-beta?
[Attachment #604576](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=708825#c27)• 13 years ago |
|  | |

Comment on [attachment 604576](/attachment.cgi?id=604576 "fix an error path, patch against Fx11 and 12") [[details]](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") [[diff]](/attachment.cgi?id=604576&action=diff "fix an error path, patch against Fx11 and 12") [[review]](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604576)
fix an error path, patch against Fx11 and 12
[Triage Comment]
The process for landing sg:crit bugs hasn't changed since the FF11 security post-mortem, although other landing strategies were discussed. Unless this bug has special circumstances, let's land on m-c and then nominate once it's had a couple of days to bake for stability's sake.
[Attachment #604576](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") -
Flags: approval-mozilla-beta?
[Attachment #604576](/attachment.cgi?id=604576&action=edit "fix an error path, patch against Fx11 and 12") -
Flags: approval-mozilla-aurora?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=708825#c28)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/428dbcf861b5>Target Milestone: --- → mozilla14

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=708825#c29)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/428dbcf861b5>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a9867350_373476)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a10024415_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [14+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=14%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=708825#c30)• 13 years ago |
|  | |

Comment on [attachment 604590](/attachment.cgi?id=604590 "fix for 13") [[details]](/attachment.cgi?id=604590&action=edit "fix for 13") [[diff]](/attachment.cgi?id=604590&action=diff "fix for 13") [[review]](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604590)
fix for 13
[Approval Request Comment]
Regression caused by (bug #): [bug 580128](/show_bug.cgi?id=580128 "RESOLVED FIXED - Implement brain transplants")
User impact if declined: security vulnerability. Apparently this may become easy to find with fuzzer tool release in April (see [comment 19](/show_bug.cgi?id=708825#c19 "VERIFIED FIXED - \"ASSERTION: Fault in cycle collector: traversed refs exceed refcount\" closing window nearScriptStackLimit")).
Testing completed (on m-c, etc.): it has been on m-c for a few days
Risk to taking this patch (and alternatives if risky): should be low. This only alters the behavior of a rarely taken control path that is currently broken to the point where it will probably always crash it we hit it.
String changes made by this patch: none
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-esr10?
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-beta?
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=708825#c31)• 13 years ago |
|  | |

Comment on [attachment 604590](/attachment.cgi?id=604590 "fix for 13") [[details]](/attachment.cgi?id=604590&action=edit "fix for 13") [[diff]](/attachment.cgi?id=604590&action=diff "fix for 13") [[review]](/page.cgi?id=splinter.html&ignore=&bug=708825&attachment=604590)
fix for 13
[Triage Comment]
Low risk sg:crit fix - approved for all branches.
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-esr10?
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-esr10+
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-beta?
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-beta+
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-aurora?
[Attachment #604590](/attachment.cgi?id=604590&action=edit "fix for 13") -
Flags: approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a10099232_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[14+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=14%2B) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=708825#c32)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/8ea9983dc063>
<https://hg.mozilla.org/releases/mozilla-beta/rev/92b07ee2bfc2>
<https://hg.mozilla.org/releases/mozilla-esr10/rev/8772f3d527ac>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)Target Milestone: mozilla14 → mozilla12

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a11208064_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a11838348_18566)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=708825#a13992561_1689)• 13 years ago |

Group: core-security

|  | [Paul Silaghi, QA [:pauly]](/user_profile?user_id=428011) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=708825#c33)• 13 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #0](/show_bug.cgi?id=708825#c0 "VERIFIED FIXED - \"ASSERTION: Fault in cycle collector: traversed refs exceed refcount\" closing window nearScriptStackLimit"))
> Created [attachment 580173](/attachment.cgi?id=580173 "testcase") [[details]](/attachment.cgi?id=580173&action=edit "testcase")
> testcase
>
> 1. Load the testcase
> 2. Click the button
> 3. Close the testcase
> 4. Force a CC (e.g. by quitting Firefox or using about:memory)
>
> Result:
>
> ###!!! ASSERTION: Fault in cycle collector: traversed refs exceed refcount
> (ptr: 127319dc0)
> : 'Not Reached', file
> /Users/jruderman/trees/mozilla-central/xpcom/base/nsCycleCollector.cpp, line
> 1235
Crashes after step 2 on ftp://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2012-05-18-mozilla-beta-debug on Win 7, Ubuntu 12.04 and Mac OS X 10.6:
Assertion failure: !cx->isExceptionPending(), at e:\builds\moz2\_slave\m-beta-w32
-dbg\build\js\src\jscntxtinlines.h:317
<https://crash-stats.mozilla.com/report/pending/6a95f8f1-1b4c-483b-b125-999632120521>

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=708825#c34)• 13 years ago |
|  | |

Paul, can you file a new bug report for that? Do you know if it's a regression that happened after this bug's patch landed?

|  | [Paul Silaghi, QA [:pauly]](/user_profile?user_id=428011) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=708825#c35)• 13 years ago |
|  | |

Sure Jesse. [Bug 757004](/show_bug.cgi?id=757004 "RESOLVED WORKSFORME - \"Assertion failure: !cx->isExceptionPending()\" with nearScriptStackLimit") submitted. I'll look for a regression range and post there the results

|  | [Paul Silaghi, QA [:pauly]](/user_profile?user_id=428011) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=708825#c36)• 13 years ago |
|  | |

Based on [comment 34](/show_bug.cgi?id=708825#c34 "VERIFIED FIXED - \"ASSERTION: Fault in cycle collector: traversed refs exceed refcount\" closing window nearScriptStackLimit") marking this as verified. No "ASSERTION: Fault in cycle collector: traversed refs exceed refcount" occurs in FF 13, 14 and ESR 10.0.5.Status: RESOLVED → VERIFIED
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Paul Silaghi, QA [:pauly]](/user_profile?user_id=428011) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=708825#c37)• 13 years ago |
|  | |

Executing the steps in [comment 0](/show_bug.cgi?id=708825#c0 "VERIFIED FIXED - \"ASSERTION: Fault in cycle collector: traversed refs exceed refcount\" closing window nearScriptStackLimit") and closing Firefox after --> [bug 404828](/show_bug.cgi?id=404828 "RESOLVED FIXED - ASSERTION: Uh, IsInModalState() called w/o a reachable top window?")
ftp://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2012-05-18-mozilla-central-debug
You need to [log in](/show_bug.cgi?id=708825&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_e4f3ad2c_20250125_084237.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/735943)
* [XML](/show_bug.cgi?ctype=xml&id=735943)

Closed
[Bug 735943](/show_bug.cgi?id=735943)

Opened 13 years ago
Closed 13 years ago

# Crash @ nsCSSFrameConstructor::ProcessPendingRestyles

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash @ nsCSSFrameConstructor::ProcessPendingRestyles

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified) |
| firefox14 | --- | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox-esr10 | [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B) | [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | + | verified |
| firefox13 | + | verified |
| firefox14 |  | verified |
| firefox-esr10 | 12+ | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)")

Dependency [tree](/showdependencytree.cgi?id=735943&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=735943)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#c10 "13 years ago") | + |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsCSSFrameConstructor::ProcessPendingRestyles() ]](https://crash-stats.mozilla.org/signature/?signature=nsCSSFrameConstructor%3A%3AProcessPendingRestyles%28%29)

[[@ nsCSSFrameConstructor::ProcessPendingRestyles ]](https://crash-stats.mozilla.org/signature/?signature=nsCSSFrameConstructor%3A%3AProcessPendingRestyles)

[[@ PresShell::FlushPendingNotifications(mozFlushType) ]](https://crash-stats.mozilla.org/signature/?signature=PresShell%3A%3AFlushPendingNotifications%28mozFlushType%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=606033)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   1.15 KB, text/html |  | [Details](/attachment.cgi?id=606033&action=edit) |
| --- | --- | --- |
| [stack trace with popups allowed](/attachment.cgi?id=606034)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   9.40 KB, text/plain |  | [Details](/attachment.cgi?id=606034&action=edit) |
| [stack trace with popups blocked](/attachment.cgi?id=606035)  [13 years ago](#c2)  [Jesse Ruderman](/user_profile?user_id=11608)   3.28 KB, text/plain |  | [Details](/attachment.cgi?id=606035&action=edit) |
| [stack](/attachment.cgi?id=606052)  [13 years ago](#c3)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   6.56 KB, text/html |  | [Details](/attachment.cgi?id=606052&action=edit) |
| [fix+test](/attachment.cgi?id=606076)  [13 years ago](#c4)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   4.19 KB, patch | bzbarsky : [review+](#c9 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c17 "13 years ago")  akeybl : [approval-mozilla-beta+](#c17 "13 years ago") | [Details](/attachment.cgi?id=606076&action=edit) | [Diff](/attachment.cgi?id=606076&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=606076) |
| [for esr10](/attachment.cgi?id=611648)  [13 years ago](#c18)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.33 KB, patch | lsblakk : [approval-mozilla-esr10+](#c21 "13 years ago") | [Details](/attachment.cgi?id=611648&action=edit) | [Diff](/attachment.cgi?id=611648&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=611648) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=735943#c0)• 13 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=606033)
— [Details](attachment.cgi?id=606033&action=edit)

About 50% of the time, this testcase causes a crash in nsCSSFrameConstructor::ProcessPendingRestyles.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=735943#c1)• 13 years ago |
|  | |

Attached file
[stack trace with popups allowed](attachment.cgi?id=606034)
— [Details](attachment.cgi?id=606034&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=735943#c2)• 13 years ago |
|  | |

Attached file
[stack trace with popups blocked](attachment.cgi?id=606035)
— [Details](attachment.cgi?id=606035&action=edit)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a4060_5168)• 13 years ago |

Assignee: nobody → matspalComponent: DOM: Core & HTML → LayoutOS: Mac OS X → AllQA Contact: general → layoutHardware: x86\_64 → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=735943#c3)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=606052)
— [Details](attachment.cgi?id=606052&action=edit)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=735943#c4)• 13 years ago |
|  | |

Attached patch

[fix+test](attachment.cgi?id=606076&action=diff)
— [Details](attachment.cgi?id=606076&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=606076)

FYI, the document has a strong pointer to the nsSMILAnimationController
object, which keeps a raw pointer to it (mDocument).
Try results pending:
<https://tbpl.mozilla.org/?usebuildbot=1&tree=Try&rev=0281d2f4f580>
Filed [bug 735966](/show_bug.cgi?id=735966 "NEW - ASSERTION: This is unsafe! Fix the caller!: content/events/src/nsEventDispatcher.cpp, line 558") on the assertion when running the crash test.
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: review?(bzbarsky)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=735943#c5)• 13 years ago |
|  | |

Again, with just this change this time (there's a jsreftest crash in the one above):
<https://tbpl.mozilla.org/?usebuildbot=1&tree=Try&rev=8316f137ca46>

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=735943#c6)• 13 years ago |
|  | |

My testcase (reduced from what the fuzzer created) is an insane tangle of setTimeouts. It might be possible to create a more robust regression test ;)

|  | [Scoobidiver (away)](/user_profile?user_id=386758) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=735943#c7)• 13 years ago |
|  | |

I hit [bp-d0df45dc-63db-44d8-a6d8-f76722120315](https://crash-stats.mozilla.org/report/index/d0df45dc-63db-44d8-a6d8-f76722120315) (popups blocked) and [bp-3d521fe3-cc02-44fc-8058-d85972120315](https://crash-stats.mozilla.org/report/index/3d521fe3-cc02-44fc-8058-d85972120315) (popups allowed).Crash Signature: [@ nsCSSFrameConstructor::ProcessPendingRestyles()]
[@ nsCSSFrameConstructor::ProcessPendingRestyles]
[@ PresShell::FlushPendingNotifications(mozFlushType)]Summary: Crash [@ nsCSSFrameConstructor::ProcessPendingRestyles] → Crash @ nsCSSFrameConstructor::ProcessPendingRestyles

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=735943#c8)• 13 years ago |
|  | |

Hmm, there's a couple of "ASSERTION: This is unsafe! Fix the caller!: 'Error', content/events/src/nsEventDispatcher.cpp, line 558" on the new crash test.
<https://tbpl.mozilla.org/php/getParsedLog.php?id=10090225&tree=Try&full=1#error0>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=735943#c9)• 13 years ago |
|  | |

Comment on [attachment 606076](/attachment.cgi?id=606076 "fix+test") [[details]](/attachment.cgi?id=606076&action=edit "fix+test") [[diff]](/attachment.cgi?id=606076&action=diff "fix+test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=606076)
fix+test
Document (probably in the header and at the presshell check for mIsDestroying) that FlushResampleRequests can trigger style flushes, and r=me
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: review?(bzbarsky) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=735943#c10)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/75f461e05221>Flags: in-testsuite+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=735943#c11)• 13 years ago |
|  | |

This crash fix seems worth taking on branches after baking it for a while...
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F)Target Milestone: --- → mozilla14

|  | [Mounir Lamouri (:mounir)](/user_profile?user_id=342786) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=735943#c12)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/75f461e05221>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=735943#c13)• 13 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #11](/show_bug.cgi?id=735943#c11 "VERIFIED FIXED - Crash @ nsCSSFrameConstructor::ProcessPendingRestyles"))
> This crash fix seems worth taking on branches after baking it for a while...
Do we know what the regressing bug is or whether this is a pain point for users? If not, this can ride the trains.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=735943#c14)• 13 years ago |
|  | |

I would guess the addition of the FlushResampleRequests() call in
<http://hg.mozilla.org/mozilla-central/rev/d6dbb4231c11>
is what caused the regression ([bug 547333](/show_bug.cgi?id=547333 "RESOLVED FIXED - Leak gfxTextRun with svg:animate")).
The reason I recommend merging this fix to branches is that without it we
run script from inside a destroyed pres shell, which I think is unsafe.
The fix is very low-risk.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=735943#c15)• 13 years ago |
|  | |

Comment on [attachment 606076](/attachment.cgi?id=606076 "fix+test") [[details]](/attachment.cgi?id=606076&action=edit "fix+test") [[diff]](/attachment.cgi?id=606076&action=diff "fix+test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=606076)
fix+test
See [comment 14](/show_bug.cgi?id=735943#c14 "VERIFIED FIXED - Crash @ nsCSSFrameConstructor::ProcessPendingRestyles").
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: approval-mozilla-beta?
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: approval-mozilla-aurora?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a1622217_1689)• 13 years ago |

Group: core-security
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)Whiteboard: [sg:critical]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a1624613_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [12+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=12%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=735943#c17)• 13 years ago |
|  | |

Comment on [attachment 606076](/attachment.cgi?id=606076 "fix+test") [[details]](/attachment.cgi?id=606076&action=edit "fix+test") [[diff]](/attachment.cgi?id=606076&action=diff "fix+test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=606076)
fix+test
[Triage Comment]
Low risk fix, and both Mats and the security team agree that this is something we should fix all the way up to FF12. Please land asap, as we'll go to build with Beta 4 tomorrow (4/3) at 5PM PT.
Please make sure to prepare a patch for the ESR branch as well.
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: approval-mozilla-beta?
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: approval-mozilla-beta+
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: approval-mozilla-aurora?
[Attachment #606076](/attachment.cgi?id=606076&action=edit "fix+test") -
Flags: approval-mozilla-aurora+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=735943#c18)• 13 years ago |
|  | |

Attached patch

[for esr10](attachment.cgi?id=611648&action=diff)
— [Details](attachment.cgi?id=611648&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=611648)

The fix applies also to esr10, but without the test since the pref()
reftest feature doesn't exist there, afaict.
[Attachment #611648](/attachment.cgi?id=611648&action=edit "for esr10") -
Flags: approval-mozilla-esr10?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=735943#c19)• 13 years ago |
|  | |

Verified fixed in nightly Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:14.0) Gecko/20120402 Firefox/14.0a1. The testcase pretty reliably crashes my Aurora build.Status: RESOLVED → VERIFIED

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=735943#c20)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/18753a4ee7cd>
<https://hg.mozilla.org/releases/mozilla-beta/rev/a958bd24a213>
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=735943#c21)• 13 years ago |
|  | |

Comment on [attachment 611648](/attachment.cgi?id=611648 "for esr10") [[details]](/attachment.cgi?id=611648&action=edit "for esr10") [[diff]](/attachment.cgi?id=611648&action=diff "for esr10") [[review]](/page.cgi?id=splinter.html&ignore=&bug=735943&attachment=611648)
for esr10
Thanks, please go ahead and land as per <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process>
[Attachment #611648](/attachment.cgi?id=611648&action=edit "for esr10") -
Flags: approval-mozilla-esr10? → approval-mozilla-esr10+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=735943#c22)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr10/rev/f66c6b1c5ee6>
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a2825689_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a3445566_18566)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a5549851_432443)• 13 years ago |

[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a5549986_432443)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=verified)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a5550117_432443)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=735943#a5601647_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=735943&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


