=== Content from bugzilla.mozilla.org_64948fb8_20250125_192911.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/752662)
* [XML](/show_bug.cgi?ctype=xml&id=752662)

Closed
[Bug 752662](/show_bug.cgi?id=752662)

Opened 13 years ago
Closed 13 years ago

# Graphite 2 use-after-free crash

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Graphite 2 use-after-free crash

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla15

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox13 | + | affected |
| firefox14 | + | fixed |
| firefox15 |  | fixed |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: posidron, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=40)  [posidron](/user_profile?user_id=368570)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fuzzing-fonts](/show_bug.cgi?id=750695 "NEW - [meta] Fuzzing: Fonts")

Dependency [tree](/showdependencytree.cgi?id=752662&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=752662)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [asan][sg:high][advisory-tracking+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[asan][sg:high][advisory-tracking+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase](/attachment.cgi?id=621710)  [13 years ago](#c0)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   32.25 KB, application/zip |  | [Details](/attachment.cgi?id=621710&action=edit) |
| --- | --- | --- |
| [callstack](/attachment.cgi?id=621711)  [13 years ago](#c1)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   11.18 KB, text/plain |  | [Details](/attachment.cgi?id=621711&action=edit) |
| [patch, cherry-pick fix from graphite repository](/attachment.cgi?id=621912)  [13 years ago](#c3)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   1.28 KB, patch | jtd : [review+](#a118578_280585 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c11 "13 years ago") | [Details](/attachment.cgi?id=621912&action=edit) | [Diff](/attachment.cgi?id=621912&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=752662&attachment=621912) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=752662#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=621710)
— [Details](attachment.cgi?id=621710&action=edit)

The testcase is reproducible with a ASAN enabled build. If necessary, reload the testcase a few times.
If you have not a ASAN enabled build yet, follow the instructions described here: <https://developer.mozilla.org/en/Building_Firefox_with_Address_Sanitizer>

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=752662#c1)• 13 years ago |
|  | |

Attached file
[callstack](attachment.cgi?id=621711)
— [Details](attachment.cgi?id=621711&action=edit)

|  | [martin\_hosken](/user_profile?user_id=405861) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=752662#c2)• 13 years ago |
|  | |

Fixed in repo. Keep 'em coming :)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=752662#c3)• 13 years ago |
|  | |

Attached patch

[patch, cherry-pick fix from graphite repository](attachment.cgi?id=621912&action=diff)
— [Details](attachment.cgi?id=621912&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=752662&attachment=621912)

[Attachment #621912](/attachment.cgi?id=621912&action=edit "patch, cherry-pick fix from graphite repository") -
Flags: review?(jdaggett)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=752662#a118578_280585)• 13 years ago |

[Attachment #621912](/attachment.cgi?id=621912&action=edit "patch, cherry-pick fix from graphite repository") -
Flags: review?(jdaggett) → review+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=752662#c4)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/8789a1dc555d>Target Milestone: --- → mozilla15

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=752662#a162697_1689)• 13 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Whiteboard: [asan][sec-critical] → [asan][sg:high]

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=752662#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/8789a1dc555d>Assignee: nobody → jfkthameStatus: NEW → RESOLVEDClosed: 13 years ago
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=752662#c6)• 13 years ago |
|  | |

Is the ESR10 branch affected by this sg:high?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=752662#c7)• 13 years ago |
|  | |

No; the graphite lib isn't present there.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=752662#c8)• 13 years ago |
|  | |

Verified fixed in my May 10 post-fix ASAN build on OS X.Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=752662#c9)• 13 years ago |
|  | |

If we have graphite2 in Firefox 13 we need to uplift this patch.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=752662#c10)• 13 years ago |
|  | |

Comment on [attachment 621912](/attachment.cgi?id=621912 "patch, cherry-pick fix from graphite repository") [[details]](/attachment.cgi?id=621912&action=edit "patch, cherry-pick fix from graphite repository") [[diff]](/attachment.cgi?id=621912&action=diff "patch, cherry-pick fix from graphite repository") [[review]](/page.cgi?id=splinter.html&ignore=&bug=752662&attachment=621912)
patch, cherry-pick fix from graphite repository
[Approval Request Comment]
Bug caused by (feature/regressing bug #): graphite font-shaping library
User impact if declined: users who enable graphite may be vulnerable to a crash caused by a malicious/buggy font
Testing completed (on m-c, etc.): see [comment #8](/show_bug.cgi?id=752662#c8 "VERIFIED FIXED - Graphite 2 use-after-free crash")
Risk to taking this patch (and alternatives if risky): minimal risk, just adds a missing bounds check
String or UUID changes made by this patch: none
Nominating this for aurora (14) on the basis of [comment #9](/show_bug.cgi?id=752662#c9 "VERIFIED FIXED - Graphite 2 use-after-free crash").
The patch here doesn't apply to beta (13), because we took a complete graphite refresh for mozilla-14 in [bug 746975](/show_bug.cgi?id=746975 "RESOLVED FIXED - update graphite2 library to latest release").
IMO, the security concern here is relatively minor, given that graphite is preffed off by default and only likely to be enabled by a small minority of users with a specific interest in trying it (primarily for "exotic" writing systems). I see no point in trying to backport just this specific patch to the mozilla-13 version; if we're sufficiently concerned about it, we should backport the complete graphite update (but personally I don't think it is important to do so for a preffed-off feature).
[Attachment #621912](/attachment.cgi?id=621912&action=edit "patch, cherry-pick fix from graphite repository") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=752662#c11)• 13 years ago |
|  | |

Comment on [attachment 621912](/attachment.cgi?id=621912 "patch, cherry-pick fix from graphite repository") [[details]](/attachment.cgi?id=621912&action=edit "patch, cherry-pick fix from graphite repository") [[diff]](/attachment.cgi?id=621912&action=diff "patch, cherry-pick fix from graphite repository") [[review]](/page.cgi?id=splinter.html&ignore=&bug=752662&attachment=621912)
patch, cherry-pick fix from graphite repository
[Triage Comment]
Approving for Aurora 14 given the sg:high rating.
[Attachment #621912](/attachment.cgi?id=621912&action=edit "patch, cherry-pick fix from graphite repository") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=752662#c12)• 13 years ago |
|  | |

Transplanted to aurora:
<https://hg.mozilla.org/releases/mozilla-aurora/rev/9e96c2d39ced>

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=752662#a991766_329583)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=752662#a5457462_280903)• 13 years ago |

Whiteboard: [asan][sg:high] → [asan][sg:high][advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=752662#a6411446_1689)• 13 years ago |

Group: core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=752662#a144205167_1689)• 8 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)
You need to [log in](/show_bug.cgi?id=752662&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_aafc9040_20250126_112132.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 03:21:31 PST

* **Bug ID:**
  712914,
  738841,
  743876,
  754725,
  757431,
  717488,
  718290,
  752662,
  765179,
  766018,
  766304,
  725499

---

12 bugs found.

| [ID](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [766018](/show_bug.cgi?id=766018 "RESOLVED FIXED - Use-after-free during GC on shutdown") |  | [Use-after-free during GC on shutdown](/show_bug.cgi?id=766018) | Core | XPConnect | bholley | RESO | FIXE | 2017-05-09 |
| [717488](/show_bug.cgi?id=717488 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR") |  | ["ASSERTION: Uh, mDocument doesn't match the current inner window document!" with nearNativeStackLimit, sync XHR](/show_bug.cgi?id=717488) | Core | DOM: Navigation | hsivonen | RESO | FIXE | 2012-07-20 |
| [725499](/show_bug.cgi?id=725499 "RESOLVED FIXED - WorkerFinishedRunnable should not be a control runnable.") |  | [WorkerFinishedRunnable should not be a control runnable.](/show_bug.cgi?id=725499) | Core | DOM: Core & HTML | khuey | RESO | FIXE | 2019-03-13 |
| [766304](/show_bug.cgi?id=766304 "RESOLVED FIXED - ScopedGfxFeatureReporter uses preference service off the main thread") |  | [ScopedGfxFeatureReporter uses preference service off the main thread](/show_bug.cgi?id=766304) | Core | Graphics | lassey | RESO | FIXE | 2016-01-06 |
| [712914](/show_bug.cgi?id=712914 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info") |  | [Disk cache does not verify that it correctly serialized/deserialized security info](/show_bug.cgi?id=712914) | Core | Networking: Cache | u408661 | RESO | FIXE | 2019-02-12 |
| [738841](/show_bug.cgi?id=738841 "VERIFIED FIXED - \"Assertion failure: allocated(),\" with TypeInference disabled") |  | ["Assertion failure: allocated()," with TypeInference disabled](/show_bug.cgi?id=738841) | Core | JavaScript Engine | bill.mccloskey | VERI | FIXE | 2013-01-14 |
| [754725](/show_bug.cgi?id=754725 "VERIFIED FIXED - Assertion failure: (ptrBits & 0x7) == 0, at jsval.h:760 or Crash [@ compartment]") |  | [Assertion failure: (ptrBits & 0x7) == 0, at jsval.h:760 or Crash [@ compartment]](/show_bug.cgi?id=754725) | Core | JavaScript Engine | bill.mccloskey | VERI | FIXE | 2013-03-11 |
| [757431](/show_bug.cgi?id=757431 "VERIFIED FIXED - Assertion failure: v->toGCThing(), at gc/Marking.cpp:327 or Crash [@ js::gc::ArenaHeader::allocated]") |  | [Assertion failure: v->toGCThing(), at gc/Marking.cpp:327 or Crash [@ js::gc::ArenaHeader::allocated]](/show_bug.cgi?id=757431) | Core | JavaScript Engine | bill.mccloskey | VERI | FIXE | 2013-01-14 |
| [718290](/show_bug.cgi?id=718290 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines") |  | [Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines](/show_bug.cgi?id=718290) | Core | Layout | dbaron | VERI | FIXE | 2013-12-10 |
| [765179](/show_bug.cgi?id=765179 "VERIFIED FIXED - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier]") |  | [WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier]](/show_bug.cgi?id=765179) | Core | Graphics: CanvasWebG | jacob.benoit.1 | VERI | FIXE | 2012-07-20 |
| [752662](/show_bug.cgi?id=752662 "VERIFIED FIXED - Graphite 2 use-after-free crash") |  | [Graphite 2 use-after-free crash](/show_bug.cgi?id=752662) | Core | Graphics | jfkthame | VERI | FIXE | 2016-12-01 |
| [743876](/show_bug.cgi?id=743876 "VERIFIED FIXED - Assertion failure: (ptrBits & 0x7) == 0, at ../../jsval.h:763 or Crash [@ js::gc::Cell::compartment] or [@ js_GetMethod]") |  | [Assertion failure: (ptrBits & 0x7) == 0, at ../../jsval.h:763 or Crash [@ js::gc::Cell::compartment] or [@ js\_GetMethod]](/show_bug.cgi?id=743876) | Core | JavaScript Engine | mail | VERI | FIXE | 2013-01-19 |

12 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=712914%2C738841%2C743876%2C754725%2C757431%2C717488%2C718290%2C752662%2C765179%2C766018%2C766304%2C725499&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |

[File
a new bug
in the "Core" product](/enter_bug.cgi?product=Core)



=== Content from bugzilla.mozilla.org_dab121ea_20250125_192901.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/717488)
* [XML](/show_bug.cgi?ctype=xml&id=717488)

Closed
[Bug 717488](/show_bug.cgi?id=717488)

Opened 13 years ago
Closed 13 years ago

# "ASSERTION: Uh, mDocument doesn't match the current inner window document!" with nearNativeStackLimit, sync XHR

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: Uh, mDocument doesn't match the current inner window document!" with nearNativeStackLimit, sync XHR

## Categories

### (Core :: DOM: Navigation, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Navigation#DOM%3A%20Navigation)

DOM: Navigation
▾

Core :: DOM: Navigation
For bugs with HTML’s [navigate](https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate) algorithm and browsing contexts.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Navigation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix) |
| firefox13 | --- | [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) |
| firefox14 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | wontfix |
| firefox13 |  | affected |
| firefox14 |  | fixed |
| firefox-esr10 | - | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: hsivonen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0030426a5e04e85c33fe02480bc4ca81?d=mm&size=40)  [hsivonen](/user_profile?user_id=5490)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:moderate][advisory-tracking+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate][advisory-tracking+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=587905)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   900 bytes, text/html |  | [Details](/attachment.cgi?id=587905&action=edit) |
| --- | --- | --- |
| [stack traces](/attachment.cgi?id=587906)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   5.54 KB, text/plain |  | [Details](/attachment.cgi?id=587906&action=edit) |
| [Paper over the problem](/attachment.cgi?id=605382)  [13 years ago](#c5)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   1.08 KB, patch |  | [Details](/attachment.cgi?id=605382&action=edit) | [Diff](/attachment.cgi?id=605382&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=717488&attachment=605382) |
| [Paper over the problem, propagate the brokenness reason](/attachment.cgi?id=605837)  [13 years ago](#c6)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   11.46 KB, patch | smaug : [review+](#c12 "13 years ago") | [Details](/attachment.cgi?id=605837&action=edit) | [Diff](/attachment.cgi?id=605837&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=717488&attachment=605837) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=717488#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=587905)
— [Details](attachment.cgi?id=587905&action=edit)

###!!! ASSERTION: Script global object not ready: '!mDocShell || GetDocument()->GetScriptGlobalObject()', file parser/html/nsHtml5TreeOpExecutor.h, line 157
###!!! ASSERTION: Uh, mDocument doesn't match the current inner window document!: '!GetCurrentInnerWindow() || GetCurrentInnerWindow()->GetExtantDocument() == mDocument', file dom/base/nsGlobalWindow.cpp, line 1877

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=717488#c1)• 13 years ago |
|  | |

Attached file
[stack traces](attachment.cgi?id=587906)
— [Details](attachment.cgi?id=587906&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=717488#c2)• 13 years ago |
|  | |

giving to hsivonen for a first look per jst. more likely resource exhaustion than a security bug?Assignee: nobody → hsivonen

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=717488#c3)• 13 years ago |
|  | |

The assertion fires for data:text/html,1. That is, inserting a new iframe and spinning the event loop makes OnStartRequest for the new iframe fire before the document has been set up the usual way.
The HTML parser is prepared to handle OnDataAvailable and executor flushes when sync XHR is spinning the event loop, but it's not prepared for OnStartRequest firing prematurely.
Maybe the script global object for the iframe is waiting to be set up from a script runner that won't run until the script that inserted the iframe and started XHR finishes?

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=717488#c4)• 13 years ago |
|  | |

On the HTML parser side, what could be done here is calling MarkAsBroken() instead of asserting here:
<http://mxr.mozilla.org/mozilla-central/source/parser/html/nsHtml5TreeOpExecutor.h#156>
Still need a real fix for the iframe/docshell part, though.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=717488#c5)• 13 years ago |
|  | |

Attached patch

[Paper over the problem](attachment.cgi?id=605382&action=diff) (obsolete)
— [Details](attachment.cgi?id=605382&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=717488&attachment=605382)

This patch doesn't make Gecko behave correctly, but hopefully this makes Gecko behave less dangerously. I think we should at least take this patch.
I'm not quite happy with marking the parser broken for non-OOM reasons, because all code that checks if the parser is broken claims OOM if marked broken. OTOH, propagating the right brokenness reason seems like an overkill.
I still need to understand how OnStartRequest and script global object initialization can change order.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=717488#c6)• 13 years ago |
|  | |

Attached patch

[Paper over the problem, propagate the brokenness reason](attachment.cgi?id=605837&action=diff)
— [Details](attachment.cgi?id=605837&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=717488&attachment=605837)

Oh well. I guess it's better to propagate the brokenness reason to avoid confusion about incorrect NS\_ERROR\_OUT\_OF\_MEMORY later on.
[Attachment #605382](/attachment.cgi?id=605382&action=edit "Paper over the problem") -
Attachment is obsolete: true

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=717488#c7)• 13 years ago |
|  | |

Henri, any ideas what this could lead to? We're having a hard time figuring out what sg: rating to put on this bug, so any help would be appreciated!

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=717488#a5461176_5490)• 13 years ago |

[Attachment #605837](/attachment.cgi?id=605837&action=edit "Paper over the problem, propagate the brokenness reason") -
Flags: review?(bugs)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=717488#c8)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #7](/show_bug.cgi?id=717488#c7 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> Henri, any ideas what this could lead to? We're having a hard time figuring
> out what sg: rating to put on this bug, so any help would be appreciated!
I don't know what this could lead to. Lacking a script global object is the normal situation for documents loaded via XHR, so it's possible that this isn't really a security bug and instead just prevents some scripts from compiling.
But I don't really know how not having a script global object interacts with \*having\* a docshell.Status: NEW → ASSIGNED

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=717488#c9)• 13 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #5](/show_bug.cgi?id=717488#c5 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> I still need to understand how OnStartRequest and script global object
> initialization can change order.
nsDocument::MaybeInitializeFinalizeFrameLoaders looks like a suspect for varying when script global object gets set on an iframed doc.
Still unclear how the stream OnStartRequest doesn't vary together with that.Status: ASSIGNED → NEW

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=717488#c10)• 13 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #9](/show_bug.cgi?id=717488#c9 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> (In reply to Henri Sivonen (:hsivonen) from [comment #5](/show_bug.cgi?id=717488#c5 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> > I still need to understand how OnStartRequest and script global object
> > initialization can change order.
>
> nsDocument::MaybeInitializeFinalizeFrameLoaders looks like a suspect for
> varying when script global object gets set on an iframed doc.
That's removing the script global object of the previous doc.
I don't find anything of interest on the script global object initialization path.
I wonder if sometimes the removal of the previous script global object gets deferred and the deferred removal overwrites the new script global object with null...Status: NEW → ASSIGNED

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=717488#c11)• 13 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #8](/show_bug.cgi?id=717488#c8 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> I don't know what this could lead to. Lacking a script global object is the
> normal situation for documents loaded via XHR, so it's possible that this
> isn't really a security bug and instead just prevents some scripts from
> compiling.
Documents without script global or script handling object used to be security problems.
But nowadays nsDOMClassInfo shouldn't allow creating wrappers for nodes in such documents.
Henri, when the assertion fires, is nsIDocument::mHasHadScriptHandlingObject true?
Since I would feel better if it was.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=717488#c12)• 13 years ago |
|  | |

Comment on [attachment 605837](/attachment.cgi?id=605837 "Paper over the problem, propagate the brokenness reason") [[details]](/attachment.cgi?id=605837&action=edit "Paper over the problem, propagate the brokenness reason") [[diff]](/attachment.cgi?id=605837&action=diff "Paper over the problem, propagate the brokenness reason") [[review]](/page.cgi?id=splinter.html&ignore=&bug=717488&attachment=605837)
Paper over the problem, propagate the brokenness reason
> nsHtml5Parser::Parse(const nsAString& aSourceBuffer,
> void\* aKey,
> const nsACString& aContentType,
> bool aLastCall,
> nsDTDMode aMode) // ignored
> {
>- if (mExecutor->IsBroken()) {
>- return NS\_ERROR\_OUT\_OF\_MEMORY;
>+ nsresult rv;
>+ if ((rv = mExecutor->IsBroken())) {
>+ return rv;
Could you use NS\_SUCCEEDED().
>+nsHtml5TreeOpExecutor::WillBuildModel(nsDTDMode aDTDMode) {
{ should be in the next line
> bool mCallContinueInterruptedParsingIfEnabled;
>
> /\*\*
>- \* True if this parser should refuse to process any more input.
>- \* Currently, the only way a parser can break is if it drops some input
>- \* due to a memory allocation failure. In such a case, the whole parser
>- \* needs to be marked as broken, because some input has been lost and
>- \* parsing more input could lead to a DOM where pieces of HTML source
>+ \* Non-NS\_OK if this parser should refuse to process any more input.
>+ \* For example, the parser needs to be marked as broken if it drops some
>+ \* input due to a memory allocation failure. In such a case, the whole
>+ \* parser needs to be marked as broken, because some input has been lost
>+ \* and parsing more input could lead to a DOM where pieces of HTML source
> \* that weren't supposed to become scripts become scripts.
>+ \*
>+ \* Since NS\_OK is actually 0, zeroing operator new takes care of
>+ \* initializing this.
> \*/
>- bool mBroken;
>+ nsresult mBroken;
1 extra space before mBroken
r=me, but please check the value of mHasHadScriptHandlingObject.
If it is false, we should probably mark it true somewhere.
[Attachment #605837](/attachment.cgi?id=605837&action=edit "Paper over the problem, propagate the brokenness reason") -
Flags: review?(bugs) → review+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=717488#c13)• 13 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #12](/show_bug.cgi?id=717488#c12 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> >+ if ((rv = mExecutor->IsBroken())) {
> >+ return rv;
> Could you use NS\_SUCCEEDED().
Even though NS\_OK is known to be 0, any non-NS\_OK value means the parser is broken and NS\_SUCCEEDED does a bitwise operation that's useless here?

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=717488#c14)• 13 years ago |
|  | |

But what if the parser starts returning NS\_SUCCESS\_I\_DID\_SOMETHING!?

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=717488#c15)• 13 years ago |
|  | |

(In reply to Gavin Sharp (use gavin@gavinsharp.com for email) from [comment #14](/show_bug.cgi?id=717488#c14 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> But what if the parser starts returning NS\_SUCCESS\_I\_DID\_SOMETHING!?
As a marker that the parser is broken???

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=717488#c16)• 13 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #12](/show_bug.cgi?id=717488#c12 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> Comment on [attachment 605837](/attachment.cgi?id=605837 "Paper over the problem, propagate the brokenness reason") [[details]](/attachment.cgi?id=605837&action=edit "Paper over the problem, propagate the brokenness reason") [[diff]](/attachment.cgi?id=605837&action=diff "Paper over the problem, propagate the brokenness reason") [[review]](/page.cgi?id=splinter.html&ignore=&bug=717488&attachment=605837)
> Paper over the problem, propagate the brokenness reason
>
> > nsHtml5Parser::Parse(const nsAString& aSourceBuffer,
> > void\* aKey,
> > const nsACString& aContentType,
> > bool aLastCall,
> > nsDTDMode aMode) // ignored
> > {
> >- if (mExecutor->IsBroken()) {
> >- return NS\_ERROR\_OUT\_OF\_MEMORY;
> >+ nsresult rv;
> >+ if ((rv = mExecutor->IsBroken())) {
> >+ return rv;
> Could you use NS\_SUCCEEDED().
I think you meant NS\_FAILED. I used NS\_FAILED, though I don't think it adds value (adds a useless and operation).
> >+nsHtml5TreeOpExecutor::WillBuildModel(nsDTDMode aDTDMode) {
> { should be in the next line
Fixed.
> > bool mCallContinueInterruptedParsingIfEnabled;
> >
> > /\*\*
> >- \* True if this parser should refuse to process any more input.
> >- \* Currently, the only way a parser can break is if it drops some input
> >- \* due to a memory allocation failure. In such a case, the whole parser
> >- \* needs to be marked as broken, because some input has been lost and
> >- \* parsing more input could lead to a DOM where pieces of HTML source
> >+ \* Non-NS\_OK if this parser should refuse to process any more input.
> >+ \* For example, the parser needs to be marked as broken if it drops some
> >+ \* input due to a memory allocation failure. In such a case, the whole
> >+ \* parser needs to be marked as broken, because some input has been lost
> >+ \* and parsing more input could lead to a DOM where pieces of HTML source
> > \* that weren't supposed to become scripts become scripts.
> >+ \*
> >+ \* Since NS\_OK is actually 0, zeroing operator new takes care of
> >+ \* initializing this.
> > \*/
> >- bool mBroken;
> >+ nsresult mBroken;
> 1 extra space before mBroken
Fixed.
> r=me,
Thank you. Landed: <https://hg.mozilla.org/integration/mozilla-inbound/rev/d07ba367be52>
> but please check the value of mHasHadScriptHandlingObject.
> If it is false, we should probably mark it true somewhere.
The trunk has changed so that I have trouble catching the bug in a debugger again. This bug needs more investigation but at least we have some mitigation now.Whiteboard: [please leave open after inbound merge; not done here yet]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=717488#c17)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/d07ba367be52>Whiteboard: [please leave open after inbound merge; not done here yet]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=717488#c18)• 13 years ago |
|  | |

Is work going to continue with a part 2 patch in this bug? I assume so but I wanted to confirm.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=717488#c19)• 13 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #18](/show_bug.cgi?id=717488#c18 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> Is work going to continue with a part 2 patch in this bug? I assume so but I
> wanted to confirm.
In principle, yes, hopefully, but not with an immediate top priority. I suppose we could spin part 2 into a different bug number in order to better manage bug state.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=717488#c20)• 13 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #19](/show_bug.cgi?id=717488#c19 "RESOLVED FIXED - \"ASSERTION: Uh, mDocument doesn't match the current inner window document!\" with nearNativeStackLimit, sync XHR"))
> I
> suppose we could spin part 2 into a different bug number in order to better
> manage bug state.
To make things clearer, I'm closing this bug as FIXED since the consequences were mitigated. I filed [bug 744102](/show_bug.cgi?id=744102 "RESOLVED WONTFIX") about fixing the root cause.Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=717488#a7830140_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Whiteboard: [sg:moderate]Target Milestone: --- → mozilla14

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=717488#a7938447_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=717488#a15545593_280903)• 13 years ago |

Whiteboard: [sg:moderate] → [sg:moderate][advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=717488#a16499587_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=717488&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_409bd57f_20250125_192846.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from www.ubuntu.com_8945c89b_20250125_192852.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1509-1: Firefox vulnerabilities

17 July 2012

Several security issues were fixed in Firefox.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)
* [Ubuntu 11.10](/security/notices?release=oneiric)
* [Ubuntu 11.04](/security/notices?release=natty)
* [Ubuntu 10.04](/security/notices?release=lucid)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Benoit Jacob, Jesse Ruderman, Christian Holler, Bill McCloskey, Brian Smith,

Gary Kwong, Christoph Diehl, Chris Jones, Brad Lassey, and Kyle Huey discovered

memory safety issues affecting Firefox. If the user were tricked into opening a

specially crafted page, an attacker could possibly exploit these to cause a

denial of service via application crash, or potentially execute code with the

privileges of the user invoking Firefox. ([CVE-2012-1948](/security/CVE-2012-1948), [CVE-2012-1949](/security/CVE-2012-1949))

Mario Gomes discovered that the address bar may be incorrectly updated.

Drag-and-drop events in the address bar may cause the address of the previous

site to be displayed while a new page is loaded. An attacker could exploit this

to conduct phishing attacks. ([CVE-2012-1950](/security/CVE-2012-1950))

Abhishek Arya discovered four memory safety issues affecting Firefox. If the

user were tricked into opening a specially crafted page, an attacker could

possibly exploit these to cause a denial of service via application crash, or

potentially execute code with the privileges of the user invoking Firefox.

([CVE-2012-1951](/security/CVE-2012-1951), [CVE-2012-1952](/security/CVE-2012-1952), [CVE-2012-1953](/security/CVE-2012-1953), [CVE-2012-1954](/security/CVE-2012-1954))

Mariusz Mlynski discovered that the address bar may be incorrectly updated.

Calls to history.forward and history.back could be used to navigate to a site

while the address bar still displayed the previous site. A remote attacker

could exploit this to conduct phishing attacks. ([CVE-2012-1955](/security/CVE-2012-1955))

Mario Heiderich discovered that HTML  tags were not filtered out of the

HTML  of RSS feeds. A remote attacker could exploit this to

conduct cross-site scripting (XSS) attacks via javascript execution in the HTML

feed view. ([CVE-2012-1957](/security/CVE-2012-1957))

Arthur Gerkis discovered a use-after-free vulnerability. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit this to cause a denial of service via application crash, or potentially

execute code with the privileges of the user invoking Firefox. ([CVE-2012-1958](/security/CVE-2012-1958))

Bobby Holley discovered that same-compartment security wrappers (SCSW) could be

bypassed to allow XBL access. If the user were tricked into opening a specially

crafted page, an attacker could possibly exploit this to execute code with the

privileges of the user invoking Firefox. ([CVE-2012-1959](/security/CVE-2012-1959))

Tony Payne discovered an out-of-bounds memory read in Mozilla's color

management library (QCMS). If the user were tricked into opening a specially

crafted color profile, an attacker could possibly exploit this to cause a

denial of service via application crash. ([CVE-2012-1960](/security/CVE-2012-1960))

Frédéric Buclin discovered that the X-Frame-Options header was ignored when its

value was specified multiple times. An attacker could exploit this to conduct

clickjacking attacks. ([CVE-2012-1961](/security/CVE-2012-1961))

Bill Keese discovered a memory corruption vulnerability. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit this to cause a denial of service via application crash, or potentially

execute code with the privileges of the user invoking Firefox. ([CVE-2012-1962](/security/CVE-2012-1962))

Karthikeyan Bhargavan discovered an information leakage vulnerability in the

Content Security Policy (CSP) 1.0 implementation. If the user were tricked into

opening a specially crafted page, an attacker could possibly exploit this to

access a user's OAuth 2.0 access tokens and OpenID credentials. ([CVE-2012-1963](/security/CVE-2012-1963))

Matt McCutchen discovered a clickjacking vulnerability in the certificate

warning page. A remote attacker could trick a user into accepting a malicious

certificate via a crafted certificate warning page. ([CVE-2012-1964](/security/CVE-2012-1964))

Mario Gomes and Soroush Dalili discovered that javascript was not filtered out

of feed URLs. If the user were tricked into opening a specially crafted URL, an

attacker could possibly exploit this to conduct cross-site scripting (XSS)

attacks. ([CVE-2012-1965](/security/CVE-2012-1965))

A vulnerability was discovered in the context menu of data: URLs. If the user

were tricked into opening a specially crafted URL, an attacker could possibly

exploit this to conduct cross-site scripting (XSS) attacks. ([CVE-2012-1966](/security/CVE-2012-1966))

It was discovered that the execution of javascript: URLs was not properly

handled in some cases. A remote attacker could exploit this to execute code

with the privileges of the user invoking Firefox. ([CVE-2012-1967](/security/CVE-2012-1967))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [14.0.1+build1-0ubuntu0.12.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/14.0.1%2Bbuild1-0ubuntu0.12.04.1)

##### Ubuntu 11.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [14.0.1+build1-0ubuntu0.11.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox/14.0.1%2Bbuild1-0ubuntu0.11.10.1)

##### Ubuntu 11.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [14.0.1+build1-0ubuntu0.11.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/14.0.1%2Bbuild1-0ubuntu0.11.04.1)

##### Ubuntu 10.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [14.0.1+build1-0ubuntu0.10.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/14.0.1%2Bbuild1-0ubuntu0.10.04.1)

When upgrading, users should be aware of the following:

* In Ubuntu 11.04, unity-2d users may lose the ability to view drop-down menus,

  context menus, and perform drag-and-drop operations in Firefox. This is a known

  issue being tracked in <https://launchpad.net/bugs/1020198> and may be fixed in a

  later update.

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2012-1948](/security/CVE-2012-1948)
* [CVE-2012-1949](/security/CVE-2012-1949)
* [CVE-2012-1950](/security/CVE-2012-1950)
* [CVE-2012-1951](/security/CVE-2012-1951)
* [CVE-2012-1952](/security/CVE-2012-1952)
* [CVE-2012-1953](/security/CVE-2012-1953)
* [CVE-2012-1954](/security/CVE-2012-1954)
* [CVE-2012-1955](/security/CVE-2012-1955)
* [CVE-2012-1957](/security/CVE-2012-1957)
* [CVE-2012-1958](/security/CVE-2012-1958)
* [CVE-2012-1959](/security/CVE-2012-1959)
* [CVE-2012-1960](/security/CVE-2012-1960)
* [CVE-2012-1961](/security/CVE-2012-1961)
* [CVE-2012-1962](/security/CVE-2012-1962)
* [CVE-2012-1963](/security/CVE-2012-1963)
* [CVE-2012-1964](/security/CVE-2012-1964)
* [CVE-2012-1965](/security/CVE-2012-1965)
* [CVE-2012-1966](/security/CVE-2012-1966)
* [CVE-2012-1967](/security/CVE-2012-1967)
* <https://launchpad.net/bugs/1024562>
* <https://launchpad.net/bugs/1020198>

## Related notices

* [USN-1510-1](/security/notices/USN-1510-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugzilla.mozilla.org_977c21cd_20250125_192858.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/712914)
* [XML](/show_bug.cgi?ctype=xml&id=712914)

Closed
[Bug 712914](/show_bug.cgi?id=712914)

Opened 13 years ago
Closed 13 years ago

# Disk cache does not verify that it correctly serialized/deserialized security info

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Disk cache does not verify that it correctly serialized/deserialized security info

## Categories

### (Core :: Networking: Cache, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20Cache#Networking%3A%20Cache)

Networking: Cache
▾

Core :: Networking: Cache
For bugs in the cache, which stores recently accessed data for more rapid access. Includes the disk cache, memory cache, and all cache preferences.

Examples of appropriate bugs: Implement compression of network cache data; or Implement partial HTTP caching.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cache&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cache&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20Cache)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 |  | fixed |
| firefox-esr10 | - | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: briansmith, Assigned: u408661)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a57dffdcf7ec07da4820a55afdc5d3bc?d=mm&size=40)  [u408661](/user_profile?user_id=408661)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/708ad4f6494aae9c1711a823f447d415?d=mm&size=40)  [briansmith](/user_profile?user_id=14661)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### (Blocks 2 open bugs)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[722033](/show_bug.cgi?id=722033 "RESOLVED FIXED - Remove calls to synchronous openCacheEntry in nsHttpChannel")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2011-0082](/show_bug.cgi?id=660749 "NEW - Firefox doesn't (re)validate certificates when loading a HTTPS page from the cache"), [697781](/show_bug.cgi?id=697781 "NEW - Cache entries for HTTPS pages store their TLS metadata inefficiently")

Dependency [tree](/showdependencytree.cgi?id=712914&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=712914)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: addon-compat, Whiteboard: [sg:moderate][advisory-tracking+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[addon-compat](/buglist.cgi?keywords=addon-compat&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate][advisory-tracking+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 19 obsolete files)

| [proposed patch](/attachment.cgi?id=589887)  [13 years ago](#c7)  [u408661](/user_profile?user_id=408661)   4.52 KB, patch |  | [Details](/attachment.cgi?id=589887&action=edit) | [Diff](/attachment.cgi?id=589887&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887) |
| --- | --- | --- |
| [patch v2](/attachment.cgi?id=600051)  [13 years ago](#c11)  [u408661](/user_profile?user_id=408661)   72.44 KB, patch | briansmith : [feedback+](#c12 "13 years ago") | [Details](/attachment.cgi?id=600051&action=edit) | [Diff](/attachment.cgi?id=600051&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=600051) |
| [patch](/attachment.cgi?id=602034)  [13 years ago](#c13)  [u408661](/user_profile?user_id=408661)   80.75 KB, patch |  | [Details](/attachment.cgi?id=602034&action=edit) | [Diff](/attachment.cgi?id=602034&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=602034) |
| [patch](/attachment.cgi?id=602241)  [13 years ago](#c14)  [u408661](/user_profile?user_id=408661)   80.73 KB, patch | bzbarsky : [superreview-](#c18 "13 years ago") | [Details](/attachment.cgi?id=602241&action=edit) | [Diff](/attachment.cgi?id=602241&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=602241) |
| [proposed idl changes](/attachment.cgi?id=603348)  [13 years ago](#c27)  [u408661](/user_profile?user_id=408661)   5.06 KB, patch | briansmith : [feedback+](#c29 "13 years ago")  bzbarsky : [feedback+](#c33 "13 years ago") | [Details](/attachment.cgi?id=603348&action=edit) | [Diff](/attachment.cgi?id=603348&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=603348) |
| [patch](/attachment.cgi?id=606710)  [13 years ago](#c34)  [u408661](/user_profile?user_id=408661)   63.54 KB, patch | briansmith : [feedback+](#c35 "13 years ago") | [Details](/attachment.cgi?id=606710&action=edit) | [Diff](/attachment.cgi?id=606710&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=606710) |
| [patch](/attachment.cgi?id=608347)  [13 years ago](#c39)  [u408661](/user_profile?user_id=408661)   48.42 KB, patch | briansmith : [review-](#c41 "13 years ago")  bzbarsky : [superreview+](#c42 "13 years ago") | [Details](/attachment.cgi?id=608347&action=edit) | [Diff](/attachment.cgi?id=608347&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=608347) |
| [Nick's "for-brian.patch"](/attachment.cgi?id=609367)  [13 years ago](#c43)  [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)   45.35 KB, patch |  | [Details](/attachment.cgi?id=609367&action=edit) | [Diff](/attachment.cgi?id=609367&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609367) |
| ["for-brian" merged on top of Michal's patch](/attachment.cgi?id=609368)  [13 years ago](#c44)  [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)   4.34 KB, patch |  | [Details](/attachment.cgi?id=609368&action=edit) | [Diff](/attachment.cgi?id=609368&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609368) |
| [Patch on top of the previous two that simplifies the new cache API based on the merge of the two patches](/attachment.cgi?id=609369)  [13 years ago](#c45)  [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)   11.30 KB, patch |  | [Details](/attachment.cgi?id=609369&action=edit) | [Diff](/attachment.cgi?id=609369&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609369) |
| [coalesced patch](/attachment.cgi?id=609395)  [13 years ago](#c46)  [u408661](/user_profile?user_id=408661)   44.95 KB, patch | briansmith : [review-](#c49 "13 years ago")  u408661 : [superreview+](#c46 "13 years ago") | [Details](/attachment.cgi?id=609395&action=edit) | [Diff](/attachment.cgi?id=609395&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609395) |
| [coalesced patch](/attachment.cgi?id=609533)  [13 years ago](#c50)  [u408661](/user_profile?user_id=408661)   44.99 KB, patch | michal : [review-](#c52 "13 years ago")  u408661 : [superreview+](#c50 "13 years ago") | [Details](/attachment.cgi?id=609533&action=edit) | [Diff](/attachment.cgi?id=609533&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609533) |
| [coalesced patch](/attachment.cgi?id=609878)  [13 years ago](#c57)  [u408661](/user_profile?user_id=408661)   46.24 KB, patch | u408661 : [superreview+](#c57 "13 years ago") | [Details](/attachment.cgi?id=609878&action=edit) | [Diff](/attachment.cgi?id=609878&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609878) |
| [Show how host/port is used by patch for bug 660749](/attachment.cgi?id=610042)  [13 years ago](#c62)  [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)   36.80 KB, patch | u408661 : [feedback+](#c63 "13 years ago") | [Details](/attachment.cgi?id=610042&action=edit) | [Diff](/attachment.cgi?id=610042&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610042) |
| [coalesced patch](/attachment.cgi?id=610244)  [13 years ago](#c64)  [u408661](/user_profile?user_id=408661)   50.77 KB, patch | u408661 : [superreview+](#c64 "13 years ago") | [Details](/attachment.cgi?id=610244&action=edit) | [Diff](/attachment.cgi?id=610244&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610244) |
| [coalesced patch](/attachment.cgi?id=610305)  [13 years ago](#c75)  [u408661](/user_profile?user_id=408661)   52.47 KB, patch |  | [Details](/attachment.cgi?id=610305&action=edit) | [Diff](/attachment.cgi?id=610305&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610305) |
| [patch (simple version)](/attachment.cgi?id=610413)  [13 years ago](#c77)  [u408661](/user_profile?user_id=408661)   7.84 KB, patch |  | [Details](/attachment.cgi?id=610413&action=edit) | [Diff](/attachment.cgi?id=610413&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610413) |
| [patch (simple version)](/attachment.cgi?id=610571)  [13 years ago](#c80)  [u408661](/user_profile?user_id=408661)   8.05 KB, patch | michal : [review+](#c81 "13 years ago") | [Details](/attachment.cgi?id=610571&action=edit) | [Diff](/attachment.cgi?id=610571&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610571) |
| [patch (simple version)](/attachment.cgi?id=610684)  [13 years ago](#c82)  [u408661](/user_profile?user_id=408661)   8.17 KB, patch | u408661 : [review+](#c82 "13 years ago") | [Details](/attachment.cgi?id=610684&action=edit) | [Diff](/attachment.cgi?id=610684&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610684) |
| [patch (simple version)](/attachment.cgi?id=610687)  [13 years ago](#c83)  [u408661](/user_profile?user_id=408661)   8.18 KB, patch | u408661 : [review+](#c83 "13 years ago") | [Details](/attachment.cgi?id=610687&action=edit) | [Diff](/attachment.cgi?id=610687&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610687) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=712914#c0)• 13 years ago |
|  | |

If the security info is corrupted for whatever reason, we will silently ignore the corruption. This means we may report the wrong security info and/or make same-origin/mixed-content decisions wrongly.
See
<http://mxr.mozilla.org/mozilla-central/source/netwerk/cache/nsDiskCacheEntry.cpp?rev=ec7577dec4fc#90>
As a consequence, we will probably have to change the disk cache version, blowing away the user's disk cache when they upgrade, when we resolve [bug 697781](/show_bug.cgi?id=697781 "NEW - Cache entries for HTTPS pages store their TLS metadata inefficiently"). I am marking [bug 697781](/show_bug.cgi?id=697781 "NEW - Cache entries for HTTPS pages store their TLS metadata inefficiently") as depending on this one because we should fix this and any similar issues before doing anything that would cause us to need to bump the disk cache version again

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=712914#c1)• 13 years ago |
|  | |

Same problem on serializing:
<http://mxr.mozilla.org/mozilla-central/source/netwerk/cache/nsDiskCacheMap.cpp?rev=ec7577dec4fc#784>

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=712914#c2)• 13 years ago |
|  | |

In this code:
// Store security info, if it is serializable
nsCOMPtr<nsISerializable> serializable =
do\_QueryInterface(entry->SecurityInfo());
if (serializable) {
nsCString info;
NS\_SerializeToString(serializable, info);
entry->SetMetaDataElement("security-info", info.get());
}
We should know whether the security info should be serialized, not by whether it is serializable, but by the scheme of the URL of the item.Summary: Disk cache does not verify that it correctly deserialized security info → Disk cache does not verify that it correctly serialized/deserialized security info

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a1256366_14661)• 13 years ago |

Depends on: [715752](/show_bug.cgi?id=715752 "RESOLVED DUPLICATE - Put the cache entry format version number in each cache entry so we can change the format of cache entries without blowing away the entire cache each time we do so")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=712914#c3)• 13 years ago |
|  | |

Sounds like it might be an sg:high bug if we knew how to corrupt security info at will, but I don't think we do so I'm bumping the security severity down a notch.Whiteboard: [sg:moderate]

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a2214429_18821)• 13 years ago |

Assignee: nobody → hurley

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=712914#c4)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #0](/show_bug.cgi?id=712914#c0 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> As a consequence, we will probably have to change the disk cache version,
> blowing away the user's disk cache when they upgrade, when we resolve bug
> 697781.
We need to blow away the https://\* in the the cache because there is a small but real chance that some of those entries have invalid security info in them. Changing the disk cache version number is the easiest way to do that, but it might not be the best. Another way of doing it would be to doom all entries that use the previous security-info format, as was suggested by :hurley in private email. If we do that, it is really important that we fix this bug before fixing [bug 697781](/show_bug.cgi?id=697781 "NEW - Cache entries for HTTPS pages store their TLS metadata inefficiently").

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=712914#c5)• 13 years ago |
|  | |

First run of a proposed solution running through try right now, will upload patch if all goes well
<https://tbpl.mozilla.org/?tree=Try&rev=66a9de4d328d>

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=712914#c6)• 13 years ago |
|  | |

\*sigh\* let's go with this link, instead <https://tbpl.mozilla.org/?tree=Try&rev=9f80027ca47c>

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=712914#c7)• 13 years ago |
|  | |

Attached patch

[proposed patch](attachment.cgi?id=589887&action=diff) (obsolete)
— [Details](attachment.cgi?id=589887&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887)

Here's a first run (try is green with it). It adds a new metadata entry for parity of the security-info and refuses to read any security-info without one. I'm not tied to using parity (given how simple it is), maybe doing a CRC or some other checksum of the security-info is a better idea? We're never going to get cryptographic-level integrity on the security-info, so I'm not even going to try for that.
The only thing we don't actively do is doom the entries, but that's a bigger issue with the cache so far as I can tell (if any entry fails to be properly read, it seems on my quick inspection that we just leave that space used until an eviction event occurs that reaps the unused entry).
[Attachment #589887](/attachment.cgi?id=589887&action=edit "proposed patch") -
Flags: feedback?(bsmith)

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a2965397_18821)• 13 years ago |

[Attachment #589887](/attachment.cgi?id=589887&action=edit "proposed patch") -
Flags: feedback?(bjarne)

|  | [Bjarne (:bjarne)](/user_profile?user_id=323714) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=712914#c8)• 13 years ago |
|  | |

Comment on [attachment 589887](/attachment.cgi?id=589887 "proposed patch") [[details]](/attachment.cgi?id=589887&action=edit "proposed patch") [[diff]](/attachment.cgi?id=589887&action=diff "proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887)
proposed patch
Review of [attachment 589887](/attachment.cgi?id=589887 "proposed patch") [[details]](/attachment.cgi?id=589887&action=edit "proposed patch") [[diff]](/attachment.cgi?id=589887&action=diff "proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887):
-----------------------------------------------------------------
Looks good in general.
I agree that parity might be a little simple. You may look at nsHttpChannel::Hash() which is used when comparing cookies and there is also the hash used to map URLs in the disk-cache map. Few CPU-cycles is a goal here, I guess, but some simple profiling may defend a proper hash.
You have a point about handling cache-entries not successfully read. I suggest you enter a new bug to discuss and handle this, which would then take care of dooming "old" https entries. Make sure to fix this new bug before [bug #697781](/show_bug.cgi?id=697781 "NEW - Cache entries for HTTPS pages store their TLS metadata inefficiently"), as emphasized in [comment #4](/show_bug.cgi?id=712914#c4 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info").
::: netwerk/cache/nsDiskCacheMap.cpp
@@ +788,4 @@
> nsCacheEntry \* entry = binding->mCacheEntry;
> if (!entry) return nsnull;
>
> // Store security info, if it is serializable
Please consider proposal in [comment #2](/show_bug.cgi?id=712914#c2 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info") here.
[Attachment #589887](/attachment.cgi?id=589887&action=edit "proposed patch") -
Flags: feedback?(bjarne)

|  | [Bjarne (:bjarne)](/user_profile?user_id=323714) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=712914#c9)• 13 years ago |
|  | |

Comment on [attachment 589887](/attachment.cgi?id=589887 "proposed patch") [[details]](/attachment.cgi?id=589887&action=edit "proposed patch") [[diff]](/attachment.cgi?id=589887&action=diff "proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887)
proposed patch
Review of [attachment 589887](/attachment.cgi?id=589887 "proposed patch") [[details]](/attachment.cgi?id=589887&action=edit "proposed patch") [[diff]](/attachment.cgi?id=589887&action=diff "proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887):
-----------------------------------------------------------------
Oh - and please add a test.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=712914#c10)• 13 years ago |
|  | |

Comment on [attachment 589887](/attachment.cgi?id=589887 "proposed patch") [[details]](/attachment.cgi?id=589887&action=edit "proposed patch") [[diff]](/attachment.cgi?id=589887&action=diff "proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=589887)
proposed patch
I spoke with Nick about this IRL. I merely want us to:
1. Check the return value from the serialize/deserialize operations.
2. For TLS-protected cache entries (FTPS, SFTP, HTTPS), instead of silently ignoring a missing security-info metadata element, we should do NS\_WARNING and then doom the entry. This requires the cache lookup operation to take a flag indicating whether or not we require a security-info metadata element to be present.
[Attachment #589887](/attachment.cgi?id=589887&action=edit "proposed patch") -
Flags: feedback?(bsmith)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=712914#c11)• 13 years ago |
|  | |

Attached patch

[patch v2](attachment.cgi?id=600051&action=diff) (obsolete)
— [Details](attachment.cgi?id=600051&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=600051)

Here's an updated patch to use the scheme to determine whether or not we should be able to serialize the security info. If this approach seems good to you, Brian, I'll r? you for the netwerk/ stuff and others for the tests in their modules as appropriate.
[Attachment #589887](/attachment.cgi?id=589887&action=edit "proposed patch") -
Attachment is obsolete: true
[Attachment #600051](/attachment.cgi?id=600051&action=edit "patch v2") -
Flags: feedback?(bsmith)

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=712914#c12)• 13 years ago |
|  | |

Comment on [attachment 600051](/attachment.cgi?id=600051 "patch v2") [[details]](/attachment.cgi?id=600051&action=edit "patch v2") [[diff]](/attachment.cgi?id=600051&action=diff "patch v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=600051)
patch v2
Review of [attachment 600051](/attachment.cgi?id=600051 "patch v2") [[details]](/attachment.cgi?id=600051&action=edit "patch v2") [[diff]](/attachment.cgi?id=600051&action=diff "patch v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=600051):
-----------------------------------------------------------------
Yes, this is exactly what I had in mind when filing the bug.
::: netwerk/cache/nsICacheSession.idl
@@ +72,5 @@
> \* descriptor has been given WRITE access but hasn't validated the entry yet.
> \*/
> nsICacheEntryDescriptor openCacheEntry(in ACString key,
> in nsCacheAccessMode accessRequested,
> + in boolean isSecure,
I recommend naming this parameter isSSL.
It would be better to pass symbolic names like "SECURITY\_INFO\_REQUIRED" and "SECURITY\_INFO\_NOT\_REQUIRED" instead of "true" and "false" when calling this method, because symbol names make the callers easier to read.
Also, "isSecure" is a bad name, because there are many things that go into making something "secure" besides the TLS-related information. securityInfoRequired is a better name.
::: netwerk/protocol/http/nsHttpChannel.cpp
@@ +2102,5 @@
> nsCOMPtr<nsICacheSession> session;
>
> + bool entryIsSecure = false;
> + if (mURI) {
> + mURI->SchemeIs("https", &entryIsSecure);
See [bug 718002](/show_bug.cgi?id=718002 "RESOLVED WONTFIX - Add a new public API that can be used to map a scheme to its TLS-secured variant and/or determine if a scheme implies TLS will be used").
It seems dangerous to have this logic spread out across the various \*Channel classes and across multiple methods in those classes. It would be better to implement a function that takes a scheme and returns "Is TLS," "Is NOT TLS," or "Unknown", as that is needed for other things as well.
::: netwerk/protocol/wyciwyg/nsWyciwygChannel.cpp
@@ +705,5 @@
> if (!cacheSession)
> return NS\_ERROR\_FAILURE;
>
> if (aAccessMode == nsICache::ACCESS\_WRITE)
> + rv = cacheSession->OpenCacheEntry(aCacheKey, aAccessMode, false, false,
Often WYCIWYG channels are for HTTPS documents, so we shouldn't be hard-coding false here...
@@ +710,3 @@
> getter\_AddRefs(mCacheEntry));
> else
> + rv = cacheSession->AsyncOpenCacheEntry(aCacheKey, aAccessMode, false, this);
...or here.
[Attachment #600051](/attachment.cgi?id=600051&action=edit "patch v2") -
Flags: feedback?(bsmith) → feedback+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=712914#c13)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=602034&action=diff) (obsolete)
— [Details](attachment.cgi?id=602034&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=602034)

Here's the latest patch, it's running through try now <https://tbpl.mozilla.org/?tree=Try&rev=42e537f2aa38>
I'll request review after (assuming) it goes well
[Attachment #600051](/attachment.cgi?id=600051&action=edit "patch v2") -
Attachment is obsolete: true

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=712914#c14)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=602241&action=diff) (obsolete)
— [Details](attachment.cgi?id=602241&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=602241)

OK, that last one had some issues. Here's one that looks good on try <https://tbpl.mozilla.org/?tree=Try&rev=6f93d841f343>
I'm not a big fan of how I named NS\_SchemeIsTLS and associated enums, but my head's a bit hazy today, so I'm open to suggestions.
[Attachment #602034](/attachment.cgi?id=602034&action=edit "patch") -
Attachment is obsolete: true
[Attachment #602241](/attachment.cgi?id=602241&action=edit "patch") -
Flags: superreview?(bzbarsky)
[Attachment #602241](/attachment.cgi?id=602241&action=edit "patch") -
Flags: review?(bsmith)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=712914#c15)• 13 years ago |
|  | |

So a question about the IDL changes. Was there a reason to not put the new argument last and make it optional? That would leave the APIs compatible with existing JS callers, right? Seems like that would be way better for extension compat.

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=712914#c16)• 13 years ago |
|  | |

My reasoning was twofold: (1) that just felt like the right-ish place for that argument in the parameter list (not the greatest reason, I know), and (2) it feels a little wrong to leave a security-related parameter be optional. If we prefer to go for better extension compat, though, that's fine, it'll make the patch smaller :)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=712914#c17)• 13 years ago |
|  | |

You're adding the default "0" value to a ton of places in your patch.
I think making it optional, defaulting to that behavior, would be perfectly reasonable.
Brian?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=712914#c18)• 13 years ago |
|  | |

Comment on [attachment 602241](/attachment.cgi?id=602241 "patch") [[details]](/attachment.cgi?id=602241&action=edit "patch") [[diff]](/attachment.cgi?id=602241&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=602241)
patch
I think we want to keep extension compat here.
[Attachment #602241](/attachment.cgi?id=602241&action=edit "patch") -
Flags: superreview?(bzbarsky) → superreview-

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=712914#c19)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #15](/show_bug.cgi?id=712914#c15 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> So a question about the IDL changes. Was there a reason to not put the new
> argument last and make it optional? That would leave the APIs compatible
> with existing JS callers, right?
Boris, below I will argue that it is better to change the interface in an incompatible way. But, I am interested also in understanding why you think we should keep the interface compatible. Is it just because you think the break would be gratuitous? Or, is there some other reason.
AFAICT, existing JS callers need to change to indicate whether they are expecting the security-info to be there or not. We are going to change break this anyway with other changes waiting for review ([bug 722033](/show_bug.cgi?id=722033 "RESOLVED FIXED - Remove calls to synchronous openCacheEntry in nsHttpChannel"), [bug 695399](/show_bug.cgi?id=695399 "RESOLVED FIXED - Remove calls to nsICacheSession::openCacheEntry on the main thread")). Over the course of the next few quarters, we need flexibility in changing the API, so I would like to make almost the entire cache API private (at least warn addons not to use it) until it can become stable again (if ever).
If we need to keep addon compatibility for this change, then the default should be fail-safe: that is, the default should be to require the security-info to be present.
We can reduce the number of times the interface changes by changing (Async)OpenCacheEntry to take a bitfield flags argument. One flag of which would be for this bug (IS\_NOT\_TLS), and another flag would be for [bug 722033](/show_bug.cgi?id=722033 "RESOLVED FIXED - Remove calls to synchronous openCacheEntry in nsHttpChannel") and [bug 695399](/show_bug.cgi?id=695399 "RESOLVED FIXED - Remove calls to nsICacheSession::openCacheEntry on the main thread") (LOAD\_BYPASS\_LOCAL\_CACHE\_IF\_BUSY).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=712914#c20)• 13 years ago |
|  | |

> Is it just because you think the break would be gratuitous?
As far as I can tell from the patch, yes. Maybe I'm missing context?
> AFAICT, existing JS callers need to change to indicate whether they are expecting the
> security-info to be there or not.
OK. All the JS callers I saw in the patch at first skim don't expect it, so are passing 0 effectively, right?
> If we need to keep addon compatibility for this change, then the default should be
> fail-safe
That seems reasonable.
> We can reduce the number of times the interface changes by changing
> (Async)OpenCacheEntry to take a bitfield flags argument.
That seems like a good idea, yes.
Can we do it in a way that preserves JS source-level compat by just changing the access mode argument to be the low two bits of this field? Seems like it would work...
For the rest, I believe this interface is pretty commonly used in extensions, so if we do decide to break it we should give the AMO folks some heads-up here.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=712914#c21)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #20](/show_bug.cgi?id=712914#c20 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > Is it just because you think the break would be gratuitous?
>
> As far as I can tell from the patch, yes. Maybe I'm missing context?
For security reasons, the caller needs to determine whether the resource was loaded over a TLS-based connection, and pass that information to the cache. (The cache doesn't understand URLs or schemes.) We can make the change fail-safe, but that would break cache users that open HTTP (vs. HTTPS) entries, which I suspect are the majority of users.
> For the rest, I believe this interface is pretty commonly used in
> extensions, so if we do decide to break it we should give the AMO folks some
> heads-up here.
<https://mxr.mozilla.org/addons/search?string=asyncOpenCacheEntry>
<https://mxr.mozilla.org/addons/search?string=openCacheEntry>
Most of them are using the synchronous openCacheEntry method that blocks the main thread on disk I/O :(.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=712914#c22)• 13 years ago |
|  | |

> but that would break cache users that open HTTP (vs. HTTPS) entries
Every single JS caller in the attached patch passes SECURITY\_INFO\_NOT\_REQUIRED, right? Are they just buggy?
> Most of them are using the synchronous openCacheEntry method
Yep. If you give people an easy path...

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=712914#c23)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #22](/show_bug.cgi?id=712914#c22 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > but that would break cache users that open HTTP (vs. HTTPS) entries
>
> Every single JS caller in the attached patch passes
> SECURITY\_INFO\_NOT\_REQUIRED, right? Are they just buggy?
Most of them are tests, and either we don't test storing HTTPS (or FTPS, etc.) entries in the cache or the modifications to the tests are buggy.
The JS changes under browser/\* do seem buggy to me. I would expect them to work more like the changes to the channel implementations. Even if the immediate use of a cache entry doesn't require the security info, we must still pass SECURITY\_INFO\_REQUIRED if the scheme of the URL of the cached resource indicates TLS, in case future accesses to the entry require the security-info.
I just realized that I will need (Asnyc)OpenCacheEntry to also take the host and port, at least, to implement [bug 660749](/show_bug.cgi?id=660749 "NEW - Firefox doesn't (re)validate certificates when loading a HTTPS page from the cache") and [bug 722034](/show_bug.cgi?id=722034 "RESOLVED FIXED - Cache entry check--CheckCache()--is done on the main thread, causing the main thread to wait on the cache service lock, which may be blocked on disk I/O"). Perhaps it would be better to do the following:
\* Define AsyncOpenCacheEntryForOrigin that takes a (scheme, host, port) and some currently-unused flags in addition to the existing AsyncOpenCacheEntry arguments, checks if the scheme is one of { https, ftps } requiring security-info if so (and, eventually, verifying the certificate against host:port), or otherwise refusing to open the cache entry if the scheme isn't one of { http, ftp }. (i.e. This method would only support caching HTTPS, HTTP, FTP, and FTPS schemes.) (This would subsume the NS\_IsSchemeTLS method, which IMO isn't general-purpose enough to be in NetUtils.)
\* Define AsyncOpenCacheEntryForNonNetworkResource with the same signature as AsyncOpenCacheEntry + some currently-unused flags.
\* Replace callers of AsyncOpenCacheEntry in Gecko and Firefox with AsyncOpenCacheEntryForOrigin.
\* Mark AsyncOpenCacheEntry and OpenCacheEntry deprecated, have them warn when used in debug builds, post a follow-up bug for their removal, post a note about their imminent removal to dev.platform, and directly email the developers of the addons known to use these obsolete methods.
Thoughts?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=712914#c24)• 13 years ago |
|  | |

OK, if the JS changes in the patch are just wrong your objections make more sense. ;)
I'm not the best person to ask about global cache architecture changes, unfortunately....

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=712914#c25)• 13 years ago |
|  | |

As in, no useful thoughts, but worth checking with Honza and maybe biesi.

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=712914#c26)• 13 years ago |
|  | |

I'm fine with pretty much everything suggested so far. Turning the existing access argument into flags for compatibility sounds pretty good, with the caveat that doing fail-safe will break addons (which is what we're trying to avoid, here).
I can certainly buy some of the changes under browser/ being buggy (specifically the pageinfo.js changes, hence code review), but I can't buy the thumbnail storage changes being buggy (how does a thumbnail have security info?!), unless I'm misunderstanding what's going on in those files (entirely possible).
The cache interface changes Brian suggested in [comment 23](/show_bug.cgi?id=712914#c23 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info") may or may not be useful in the long run (I haven't looked at them in depth), but I don't want this to get bogged down in things that aren't necessary to get this bug fixed.

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=712914#c27)• 13 years ago |
|  | |

Attached patch

[proposed idl changes](attachment.cgi?id=603348&action=diff) (obsolete)
— [Details](attachment.cgi?id=603348&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=603348)

Brian, Boris:
Here's my proposal for changes to the cache IDLs to resolve (I think) all the issues with the first patch I put up for review. All the implementation is still the same underneath, but before I put in the effort to go through and change all the tests, etc, I wanted to run this by you guys to see how you feel about it (that way we can get the API mostly nailed down without longer back-and-forth cycles needed for a full patch).
This preserves the existing API, but marks it deprecated, and adds new APIs to do what we need to do here, as well as adding in flags for later usage to expand the API. I added one new synchronous API that's already marked deprecated, because we will only need it until [bug 695399](/show_bug.cgi?id=695399 "RESOLVED FIXED - Remove calls to nsICacheSession::openCacheEntry on the main thread") is resolved (which is the bug to remove all synchronous OpenCacheEntry calls). I also marked that API noscript so we don't get addons using that API, making it less painful to remove in the future.
[Attachment #603348](/attachment.cgi?id=603348&action=edit "proposed idl changes") -
Flags: feedback?(bzbarsky)
[Attachment #603348](/attachment.cgi?id=603348&action=edit "proposed idl changes") -
Flags: feedback?(bsmith)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=712914#c28)• 13 years ago |
|  | |

I'd really like Brian to OK things before reviewing the details...

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=712914#c29)• 13 years ago |
|  | |

Comment on [attachment 603348](/attachment.cgi?id=603348 "proposed idl changes") [[details]](/attachment.cgi?id=603348&action=edit "proposed idl changes") [[diff]](/attachment.cgi?id=603348&action=diff "proposed idl changes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=603348)
proposed idl changes
Update the documentation for each method (new and old) to indicate that their use by addons is not supported.
I suggest making all the new methods [noscript]. This, combined with the above, will allow us to change the signatures as we need to, unless some popular addon just totally ignores the rules.
With this in mind, maybe we don't need to have separate key and uri parameters for the new functions? If we need to support non-URI keys then I suggest we have the methods take (scheme, host, port) parameters (i.e. an origin) instead of a whole URI, since we'll only be inspecting the origin part anyway.
nsCacheFlags should be defined in the idl it is used in.
[Attachment #603348](/attachment.cgi?id=603348&action=edit "proposed idl changes") -
Flags: feedback?(bsmith) → feedback+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=712914#c30)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #29](/show_bug.cgi?id=712914#c29 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Comment on [attachment 603348](/attachment.cgi?id=603348 "proposed idl changes") [[details]](/attachment.cgi?id=603348&action=edit "proposed idl changes") [[diff]](/attachment.cgi?id=603348&action=diff "proposed idl changes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=603348)
> proposed idl changes
>
> Update the documentation for each method (new and old) to indicate that
> their use by addons is not supported.
Was already planning on it, this was just to see how people felt about the interface itself :)
> I suggest making all the new methods [noscript]. This, combined with the
> above, will allow us to change the signatures as we need to, unless some
> popular addon just totally ignores the rules.
We need to leave these scriptable, since they are, in fact, accessed from script in browser/ (and not just for tests). I personally find xpcshell unit tests much nicer and easier to write than C++ unit tests, anyway, so there's another point in favor of scriptability :)
> With this in mind, maybe we don't need to have separate key and uri
> parameters for the new functions? If we need to support non-URI keys then I
> suggest we have the methods take (scheme, host, port) parameters (i.e. an
> origin) instead of a whole URI, since we'll only be inspecting the origin
> part anyway.
The URI and key need to be kept separate. HTTP already makes use of the fact that the key is an opaque (to the cache) string by incorporating the post ID into the cache key (if applicable).
As far as taking just scheme/host/port, I can see where you're coming from, but (for this patch, at least) we're only inspecting the scheme, so if we're going to generalize, we may as well generalize all the way out to the URI. This also centralizes the extraction of the origin info from the URI into one place, so if we ever feel the need to add to what we're currently calling "origin", we're free to do that at will, without breaking even internal consumers of the API.
> nsCacheFlags should be defined in the idl it is used in.
These types (and their values, of which nsCacheFlags currently has none) are all currently defined in nsICache (for whatever reason), and it makes more sense to me to keep them all together, so there's one centralized location for knowing what values are valid. If we were starting from scratch, I'd agree with you, but since we've already got a canonical location, let's keep them there.

|  | [Jorge Villalobos [:jorgev] (he/him)](/user_profile?user_id=189742) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=712914#c31)• 13 years ago |
|  | |

What is the status of this bug? I assume this isn't landing for 12. Am I right?Keywords: [addon-compat](/buglist.cgi?keywords=addon-compat&resolution=---)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=712914#c32)• 13 years ago |
|  | |

(In reply to Jorge Villalobos [:jorgev] from [comment #31](/show_bug.cgi?id=712914#c31 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> What is the status of this bug? I assume this isn't landing for 12. Am I
> right?
That's correct, this will not be in 12. New patch should be forthcoming later tonight or tomorrow morning (PDT) assuming try looks good.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=712914#c33)• 13 years ago |
|  | |

Comment on [attachment 603348](/attachment.cgi?id=603348 "proposed idl changes") [[details]](/attachment.cgi?id=603348&action=edit "proposed idl changes") [[diff]](/attachment.cgi?id=603348&action=diff "proposed idl changes") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=603348)
proposed idl changes
>+++ b/netwerk/cache/nsICache.idl
>-[scriptable, uuid(ec1c0063-197d-44bb-84ba-7525d50fc937)]
>+[scriptable, uuid(81b5506c-c2ef-4992-a88b-250150aa35da)]
This change doesn't seem to be needed.
>+++ b/netwerk/cache/nsICacheSession.idl
Something should define what the flags in nsCacheFlags mean, right?
I'm not quite sure what "restricted to http/ftp (and TLS variant) schemes"
means. What happens if you pass some other nsIURI in?
The rest looks fine.
[Attachment #603348](/attachment.cgi?id=603348&action=edit "proposed idl changes") -
Flags: feedback?(bzbarsky) → feedback+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=712914#c34)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=606710&action=diff) (obsolete)
— [Details](attachment.cgi?id=606710&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=606710)

Thanks for the feedback, guys. It's all looking good so far, with the exception of WYCIWYG channels. Right now, I'm not seeing any way to determine whether security info is necessary for a wyciwyg channel or not. When writing the cache entry, I could conceivably just say "does this have security info?" and if so, pass in a flag that says "force security info required" to AsyncOpenCacheEntryForNonURI, but when opening a wyciwyg channel for reading, I'm not seeing any way to tell. Both mURI and mOriginalURI in the channel seem to have wyciwyg:// as the scheme, so there's no way to figure out if it corresponds to an https resource, and AsyncOpenCacheEntryForURI is useless, given the scheme isn't one of the ones it handles. I'm not seeing any reference to the "original" channel being kept in the wyciwyg channel (mOwner \*may\* be it, but I have zero proof of that), so I can't get the URI from there, either.
Right now, the patch uses the NonURI interfaces, and "works" in that all the tests are green. However, I'm concerned that, given how we never really test anything with SSL anyway, this will cause issues in the real world.
I'm marking this iteration of the patch f? for both of you just to make sure it gets on your radars so we can get a solution figured out to this.
Any thoughts on how to proceed next?
[Attachment #602241](/attachment.cgi?id=602241&action=edit "patch") -
Attachment is obsolete: true
[Attachment #606710](/attachment.cgi?id=606710&action=edit "patch") -
Flags: feedback?(bzbarsky)
[Attachment #606710](/attachment.cgi?id=606710&action=edit "patch") -
Flags: feedback?(bsmith)
[Attachment #602241](/attachment.cgi?id=602241&action=edit "patch") -
Flags: review?(bsmith)

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=712914#c35)• 13 years ago |
|  | |

Comment on [attachment 606710](/attachment.cgi?id=606710 "patch") [[details]](/attachment.cgi?id=606710&action=edit "patch") [[diff]](/attachment.cgi?id=606710&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=606710)
patch
Review of [attachment 606710](/attachment.cgi?id=606710 "patch") [[details]](/attachment.cgi?id=606710&action=edit "patch") [[diff]](/attachment.cgi?id=606710&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=606710):
-----------------------------------------------------------------
Looks reasonable except for the WYCIWYG bits. Please get a review from Michal if he has time.
::: netwerk/cache/nsCacheSession.cpp
@@ +118,5 @@
> return rv;
> }
>
> +
> +static nsresult IsSecurityInfoRequired(nsIURI \*uri, bool \*result)
namespace {
// XXX: Ideally, we should be able to determine whether any
// support scheme is TLS-protected or not, instead of
// hard-coding these schemes.
nsresult
IsSecurityInfoRequired(nsIURI \*uri, bool \*result)
{
...
}
}
@@ +139,5 @@
> +
> +
> +NS\_IMETHODIMP
> +nsCacheSession::OpenCacheEntryForURI(nsIURI \*uri,
> + const nsACString &key,
Key is always uri without the fragment. I think we should just define this method as taking an nsIURI without the key argument.
::: netwerk/cache/nsICacheSession.idl
@@ +126,5 @@
> + \* have a scheme of http, ftp, https, or ftps. Any other scheme
> + \* will result in NS\_ERROR\_NOT\_AVAILABLE being returned.
> + \*/
> + void asyncOpenCacheEntryForURI(in nsIURI uri,
> + in ACString key,
Remove the key argument.
::: netwerk/protocol/wyciwyg/nsWyciwygChannel.cpp
@@ +705,5 @@
> if (!cacheSession)
> return NS\_ERROR\_FAILURE;
>
> if (aAccessMode == nsICache::ACCESS\_WRITE)
> + rv = cacheSession->OpenCacheEntryForNonURI(aCacheKey,
I also am unsure how to map a WYCIWYG URI to the original URI. Michal and Honza should know.
[Attachment #606710](/attachment.cgi?id=606710&action=edit "patch") -
Flags: feedback?(bsmith) → feedback+

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=712914#c36)• 13 years ago |
|  | |

If we don't have any tests that store HTTPS resources then we should add at least one. If there is some problem with creating the test, please let me know how I can help.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=712914#c37)• 13 years ago |
|  | |

Oops! I made a mistake in my feedback:
Do NOT add or implement the synchronous openCacheEntryForURI method. It cannot be implemented correctly, because [bug 660749](/show_bug.cgi?id=660749 "NEW - Firefox doesn't (re)validate certificates when loading a HTTPS page from the cache") cannot be fixed (with reasonable effort) for a synchronous API.

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=712914#c38)• 13 years ago |
|  | |

Comment on [attachment 606710](/attachment.cgi?id=606710 "patch") [[details]](/attachment.cgi?id=606710&action=edit "patch") [[diff]](/attachment.cgi?id=606710&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=606710)
patch
Cancelling feedback until 2 last bits are decided with Brian
[Attachment #606710](/attachment.cgi?id=606710&action=edit "patch") -
Flags: feedback?(bzbarsky)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a7643721_408661)• 13 years ago |

Depends on: [722033](/show_bug.cgi?id=722033 "RESOLVED FIXED - Remove calls to synchronous openCacheEntry in nsHttpChannel")
No longer depends on: [715752](/show_bug.cgi?id=715752 "RESOLVED DUPLICATE - Put the cache entry format version number in each cache entry so we can change the format of cache entries without blowing away the entire cache each time we do so")

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=712914#c39)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=608347&action=diff) (obsolete)
— [Details](attachment.cgi?id=608347&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=608347)

Here's what should be the final patch (modulo perhaps some minor changes, I hope). It still has the synchronous openCacheEntryForURI until nsHttpChannel is fixed (Michal is working on this) and wyciwyg channels, as well (I opened a bug for this a couple days ago, should be an easy fix). However, I don't want to block getting this landed on those things.
[Attachment #606710](/attachment.cgi?id=606710&action=edit "patch") -
Attachment is obsolete: true
[Attachment #608347](/attachment.cgi?id=608347&action=edit "patch") -
Flags: superreview?(bzbarsky)
[Attachment #608347](/attachment.cgi?id=608347&action=edit "patch") -
Flags: review?(bsmith)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=712914#c40)• 13 years ago |
|  | |

And of course, I forgot to put the link to try in: <https://tbpl.mozilla.org/?tree=Try&rev=74a67d597608>

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=712914#c41)• 13 years ago |
|  | |

Comment on [attachment 608347](/attachment.cgi?id=608347 "patch") [[details]](/attachment.cgi?id=608347&action=edit "patch") [[diff]](/attachment.cgi?id=608347&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=608347)
patch
Review of [attachment 608347](/attachment.cgi?id=608347 "patch") [[details]](/attachment.cgi?id=608347&action=edit "patch") [[diff]](/attachment.cgi?id=608347&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=608347):
-----------------------------------------------------------------
Looks pretty good to me. Please address the few small issues I noted and upload a new patch.
::: netwerk/cache/nsCacheDevice.h
@@ +63,5 @@
> virtual nsresult Init() = 0;
> virtual nsresult Shutdown() = 0;
>
> virtual const char \* GetDeviceID(void) = 0;
> + virtual nsCacheEntry \* FindEntry( nsCString \* key, bool securityInfoRequired, bool \*collision ) = 0;
Please keep line length to 80 chars for the lines you modify/add. Otherwise, splinter doesn't work well.
::: netwerk/cache/nsCacheEntry.h
@@ +223,5 @@
> bool RemoveRequest( nsCacheRequest \* request);
> bool RemoveDescriptor( nsCacheEntryDescriptor \* descriptor);
> +
> + void SetSecurityInfoRequired() { mSecurityInfoRequired = true; }
> + bool IsSecurityInfoRequired() { return mSecurityInfoRequired; }
GetSecurityInfo() should be made to fail if mSecurityInfoRequired but there is no security info.
::: netwerk/cache/nsCacheService.cpp
@@ +1567,5 @@
> if (mMaxKeyLength < key->Length()) mMaxKeyLength = key->Length();
>
> // create request
> + \*request = new nsCacheRequest(key, listener, accessRequested,
> + securityInfoRequired, blockingMode, session);
Remove extra space in "new " and wrap the second line at the parenthesis (like in the signature to this method).
@@ +1813,5 @@
> if (!entry) {
> // search cache devices for entry
> bool collision = false;
> + entry = SearchCacheDevices(request->mKey, request->StoragePolicy(),
> + request->mSecurityInfoRequired, &collision);
wrap at perenthesis.
@@ +1891,5 @@
>
>
> nsCacheEntry \*
> +nsCacheService::SearchCacheDevices(nsCString \* key, nsCacheStoragePolicy policy,
> + bool securityInfoRequired, bool \*collision)
wrap at parenthesis.
::: netwerk/cache/nsICacheSession.idl
@@ +95,5 @@
> + \* descriptor will be granted. If 'blockingMode' is set to false, it will
> + \* return NS\_ERROR\_CACHE\_WAIT\_FOR\_VALIDATION rather than block when another
> + \* descriptor has been given WRITE access but hasn't validated the entry yet.
> + \* The URI passed in must have a scheme of http, ftp, https, or ftps. Any other
> + \* schemes will result in a return of NS\_ERROR\_NOT\_AVAILABLE.
I would replace "Any other schemes..." With "or the function will fail." (We don't need to promise specific error codes.)
@@ +112,5 @@
> + /\*\*
> + \* Asynchronous cache access. Does not block the calling thread.
> + \* Instead, the listener will be notified when the descriptor is
> + \* available. The uri passed in must have a scheme of http, ftp,
> + \* https, or ftps. Any other scheme will result in NS\_ERROR\_NOT\_AVAILABLE
Some comment on the error case.
::: netwerk/cache/nsMemoryCacheDevice.h
@@ +63,5 @@
>
> virtual const char \* GetDeviceID(void);
>
> virtual nsresult BindEntry( nsCacheEntry \* entry );
> + virtual nsCacheEntry \* FindEntry( nsCString \* key, bool securityInfoRequired, bool \*collision );
Line length.
::: netwerk/protocol/wyciwyg/nsWyciwygChannel.cpp
@@ +148,5 @@
> mOriginalURI = uri;
> + mResourceURI = nsnull;
> +
> + // Get the URI used for the cache here, since nsIOService
> + // expects to only create a URI on the main thread
This would be clearer if it said "Extract the original URI from the wyciwyg URI by stripping wyciwyg:<whatever else gets stripped>. We must do so here because nsIOService expects..."
By the way, what happens if we have wyciwyg://<http://foo> but foo is HSTS? In that case, we would have to rewrite <http://foo> to <https://foo>. But, also, we never should have created the wyciwyg:// URI in the first place.
@@ +151,5 @@
> + // Get the URI used for the cache here, since nsIOService
> + // expects to only create a URI on the main thread
> + nsCAutoString path;
> + rv = mURI->GetPath(path);
> + if (NS\_SUCCEEDED(rv)) {
Why not NS\_ENSURE\_SUCCESS(rv, rv);?
@@ +152,5 @@
> + // expects to only create a URI on the main thread
> + nsCAutoString path;
> + rv = mURI->GetPath(path);
> + if (NS\_SUCCEEDED(rv)) {
> + PRInt32 secondSlash = path.FindChar('/', 2);
What if there aren't two slashes?
@@ +154,5 @@
> + rv = mURI->GetPath(path);
> + if (NS\_SUCCEEDED(rv)) {
> + PRInt32 secondSlash = path.FindChar('/', 2);
> +
> + rv = NS\_NewURI(getter\_AddRefs(mResourceURI), path.get() + secondSlash + 1);
Again, why not NS\_ENSURE\_SUCCESS(rv, rv);?
[Attachment #608347](/attachment.cgi?id=608347&action=edit "patch") -
Flags: review?(bsmith) → review-

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=712914#c42)• 13 years ago |
|  | |

Comment on [attachment 608347](/attachment.cgi?id=608347 "patch") [[details]](/attachment.cgi?id=608347&action=edit "patch") [[diff]](/attachment.cgi?id=608347&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=608347)
patch
> It'd be best if we knew whether ANY
> \* supported scheme is TLS-protected or not.
Add an nsIProtocolHandler flag for this? Followup bug fine.
sr=me
[Attachment #608347](/attachment.cgi?id=608347&action=edit "patch") -
Flags: superreview?(bzbarsky) → superreview+

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=712914#c43)• 13 years ago |
|  | |

Attached patch

[Nick's "for-brian.patch"](attachment.cgi?id=609367&action=diff) (obsolete)
— [Details](attachment.cgi?id=609367&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609367)

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=712914#c44)• 13 years ago |
|  | |

Attached patch

["for-brian" merged on top of Michal's patch](attachment.cgi?id=609368&action=diff) (obsolete)
— [Details](attachment.cgi?id=609368&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609368)

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=712914#c45)• 13 years ago |
|  | |

Attached patch

[Patch on top of the previous two that simplifies the new cache API based on the merge of the two patches](attachment.cgi?id=609369&action=diff) (obsolete)
— [Details](attachment.cgi?id=609369&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609369)

You must apply "for-brian.patch" and then then "for-brian-fixed" before applying this patch.
This patch simplifies the API created by this patch and by Michal's patch in [bug 722033](/show_bug.cgi?id=722033 "RESOLVED FIXED - Remove calls to synchronous openCacheEntry in nsHttpChannel").

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a8227064_14661)• 13 years ago |

Blocks: [CVE-2011-0082](/show_bug.cgi?id=660749 "NEW - Firefox doesn't (re)validate certificates when loading a HTTPS page from the cache")

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=712914#c46)• 13 years ago |
|  | |

Attached patch

[coalesced patch](attachment.cgi?id=609395&action=diff) (obsolete)
— [Details](attachment.cgi?id=609395&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609395)

This coalesces all the patches into one (with some compile fixes & removal of unnecessary code from earlier versions). Carrying forward sr+ since IDLs are the same.
Michal, can you get to this soon, so we can get this in for Q1, or should I get someone else to review this?
[Attachment #608347](/attachment.cgi?id=608347&action=edit "patch") -
Attachment is obsolete: true
[Attachment #609367](/attachment.cgi?id=609367&action=edit "Nick's \"for-brian.patch\"") -
Attachment is obsolete: true
[Attachment #609368](/attachment.cgi?id=609368&action=edit "\"for-brian\" merged on top of Michal's patch") -
Attachment is obsolete: true
[Attachment #609369](/attachment.cgi?id=609369&action=edit "Patch on top of the previous two that simplifies the new cache API based on the merge of the two patches") -
Attachment is obsolete: true
[Attachment #609395](/attachment.cgi?id=609395&action=edit "coalesced patch") -
Flags: superreview+
[Attachment #609395](/attachment.cgi?id=609395&action=edit "coalesced patch") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=712914#c47)• 13 years ago |
|  | |

Once again, I forgot the try link: <https://tbpl.mozilla.org/?tree=Try&rev=2ae48dcbe615> (still running, will keep an eye on it until it completes)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=712914#c48)• 13 years ago |
|  | |

For future reference, try looks nice & green.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=712914#c49)• 13 years ago |
|  | |

Comment on [attachment 609395](/attachment.cgi?id=609395 "coalesced patch") [[details]](/attachment.cgi?id=609395&action=edit "coalesced patch") [[diff]](/attachment.cgi?id=609395&action=diff "coalesced patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609395)
coalesced patch
Review of [attachment 609395](/attachment.cgi?id=609395 "coalesced patch") [[details]](/attachment.cgi?id=609395&action=edit "coalesced patch") [[diff]](/attachment.cgi?id=609395&action=diff "coalesced patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609395):
-----------------------------------------------------------------
::: netwerk/cache/nsCacheSession.cpp
@@ +198,5 @@
> + nsCacheAccessMode accessRequested,
> + bool securityInfoRequired,
> + nsICacheListener \*listener,
> + bool noWait)
> +{
You must have NS\_ENSURE\_ARG\_POINTER(listener) here because the semantics of the patch for [bug 739307](/show_bug.cgi?id=739307 "RESOLVED INVALID - Make asyncOpenCacheEntry* always asynchronous") require it.
I did not review the rest of the patch.
[Attachment #609395](/attachment.cgi?id=609395&action=edit "coalesced patch") -
Flags: review-

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=712914#c50)• 13 years ago |
|  | |

Attached patch

[coalesced patch](attachment.cgi?id=609533&action=diff) (obsolete)
— [Details](attachment.cgi?id=609533&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609533)

Adds NS\_ENSURE\_ARG\_POINTER as brian requested.
[Attachment #609395](/attachment.cgi?id=609395&action=edit "coalesced patch") -
Attachment is obsolete: true
[Attachment #609533](/attachment.cgi?id=609533&action=edit "coalesced patch") -
Flags: superreview+
[Attachment #609533](/attachment.cgi?id=609533&action=edit "coalesced patch") -
Flags: review?(michal.novotny)
[Attachment #609395](/attachment.cgi?id=609395&action=edit "coalesced patch") -
Flags: review?(michal.novotny)

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=712914#c51)• 13 years ago |
|  | |

Thanks Nick! I just hopped over here to tell you that I should be doing it in my patch, instead of you doing it in yours. You can leave the check in your patch and I am sorry I wasted your time making you do my work here!

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=712914#c52)• 13 years ago |
|  | |

Comment on [attachment 609533](/attachment.cgi?id=609533 "coalesced patch") [[details]](/attachment.cgi?id=609533&action=edit "coalesced patch") [[diff]](/attachment.cgi?id=609533&action=diff "coalesced patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609533)
coalesced patch
> // Store security info, if it is serializable
> - nsCOMPtr<nsISerializable> serializable =
> - do\_QueryInterface(entry->SecurityInfo());
> - if (serializable) {
> + if (entry->IsSecurityInfoRequired()) {
The comment is wrong. The security info is stored when it is required and not when it is serializable.
> // Restore security info, if present
The same as above.
> + if (securityInfoRequired) {
> + const char\* info = entry->GetMetaDataElement("security-info");
> + if (!info) {
> + delete entry;
> + return nsnull;
> + }
> +
> nsCOMPtr<nsISupports> infoObj;
> - NS\_DeserializeObject(nsDependentCString(info), getter\_AddRefs(infoObj));
> + rv = NS\_DeserializeObject(nsDependentCString(info), getter\_AddRefs(infoObj));
> + if (NS\_FAILED(rv)) {
> + delete entry;
> + return nsnull;
> + }
Returning null won't delete the wrong entry. SearchCacheDevices() won't just see it, so a new duplicate one will be created.
> /\*\*
> \* Asynchronous cache access. Does not block the calling thread. Instead,
> \* the listener will be notified when the descriptor is available. If
> \* 'noWait' is set to true, the listener will be notified immediately with
> \* status NS\_ERROR\_CACHE\_WAIT\_FOR\_VALIDATION rather than queuing the request
> \* when another descriptor has been given WRITE access but hasn't validated
> \* the entry yet.
> \*/
> void asyncOpenCacheEntry(in ACString key,
> in nsCacheAccessMode accessRequested,
> - in nsICacheListener listener,
> - [optional] in boolean noWait);
> + in nsICacheListener listener);
What is the reason for removing noWait argument here? BTW you did't remove it from the comment.
> + /\*\*
> + \* Asynchronous cache access. Does not block the calling thread.
> + \* Instead, the listener will be notified when the descriptor is
> + \* available. The uri passed in must have a scheme of http, ftp,
> + \* https, or ftps, otherwise this will fail.
> + \*/
> + void asyncOpenCacheEntryForURI(in nsIURI uri,
> + in ACString key,
> + in nsCacheAccessMode accessRequested,
> + in nsICacheListener listener,
> + in boolean noWait);
And you should probably add a description of noWait here.
> + // Extract the original URI by stripping "wyciwyg://". We do this here
> + // because nsIOService expects to only create a URI on the main thread.
The code is correct but the comment is wrong. In fact, you are stripping "wyciwyg://123/" from the URI.
These changes need definitely a test. Existing tests won't cover edge cases like opening entry with invalid/missing security info etc.
Otherwise it looks good, but I have probably a totally dump question. Why we must determine if the security info is required on the cache level? Why we just can't fail in nsDiskCacheMap::CreateDiskCacheEntry() when entry->SecurityInfo() is non-null and we can't serialize it? In nsDiskCacheEntry::CreateCacheEntry() we would fail (and doom the entry) when the security info is present but can't be deserialized. And if it's not present but it should be, shouldn't this case be handled on the protocol level (in nsHttpChannel, nsFtpChannel, etc..)? I.e. the cache API wouldn't need any change. I believe that this would be much more elegant and as well as more correct solution.
[Attachment #609533](/attachment.cgi?id=609533&action=edit "coalesced patch") -
Flags: review?(michal.novotny) → review-

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=712914#c53)• 13 years ago |
|  | |

(In reply to Michal Novotny (:michal) from [comment #52](/show_bug.cgi?id=712914#c52 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Comment on [attachment 609533](/attachment.cgi?id=609533 "coalesced patch") [[details]](/attachment.cgi?id=609533&action=edit "coalesced patch") [[diff]](/attachment.cgi?id=609533&action=diff "coalesced patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609533)
> coalesced patch
>
> > // Store security info, if it is serializable
> > - nsCOMPtr<nsISerializable> serializable =
> > - do\_QueryInterface(entry->SecurityInfo());
> > - if (serializable) {
> > + if (entry->IsSecurityInfoRequired()) {
>
> The comment is wrong. The security info is stored when it is required and
> not when it is serializable.
>
>
> > // Restore security info, if present
>
> The same as above.
Easy fixes, will do.
> > + if (securityInfoRequired) {
> > + const char\* info = entry->GetMetaDataElement("security-info");
> > + if (!info) {
> > + delete entry;
> > + return nsnull;
> > + }
> > +
> > nsCOMPtr<nsISupports> infoObj;
> > - NS\_DeserializeObject(nsDependentCString(info), getter\_AddRefs(infoObj));
> > + rv = NS\_DeserializeObject(nsDependentCString(info), getter\_AddRefs(infoObj));
> > + if (NS\_FAILED(rv)) {
> > + delete entry;
> > + return nsnull;
> > + }
>
> Returning null won't delete the wrong entry. SearchCacheDevices() won't just
> see it, so a new duplicate one will be created.
Ah, indeed. The original (bad) entry will need to be doomed.
> > /\*\*
> > \* Asynchronous cache access. Does not block the calling thread. Instead,
> > \* the listener will be notified when the descriptor is available. If
> > \* 'noWait' is set to true, the listener will be notified immediately with
> > \* status NS\_ERROR\_CACHE\_WAIT\_FOR\_VALIDATION rather than queuing the request
> > \* when another descriptor has been given WRITE access but hasn't validated
> > \* the entry yet.
> > \*/
> > void asyncOpenCacheEntry(in ACString key,
> > in nsCacheAccessMode accessRequested,
> > - in nsICacheListener listener,
> > - [optional] in boolean noWait);
> > + in nsICacheListener listener);
>
> What is the reason for removing noWait argument here? BTW you did't remove
> it from the comment.
I \*think\* it was removed because we never need to use it in this API any more, now that we've added the ForURI variant (Brian is responsible for this change, so he'll have to verify my thinking). I'll make sure to either fix the comment or re-add the parameter for the final patch, once Brian confirms (or not).
> > + /\*\*
> > + \* Asynchronous cache access. Does not block the calling thread.
> > + \* Instead, the listener will be notified when the descriptor is
> > + \* available. The uri passed in must have a scheme of http, ftp,
> > + \* https, or ftps, otherwise this will fail.
> > + \*/
> > + void asyncOpenCacheEntryForURI(in nsIURI uri,
> > + in ACString key,
> > + in nsCacheAccessMode accessRequested,
> > + in nsICacheListener listener,
> > + in boolean noWait);
>
> And you should probably add a description of noWait here.
Will do.
> > + // Extract the original URI by stripping "wyciwyg://". We do this here
> > + // because nsIOService expects to only create a URI on the main thread.
>
> The code is correct but the comment is wrong. In fact, you are stripping
> "wyciwyg://123/" from the URI.
That's easy to fix, but shows how little I know about both FindChar and wyciwyg URIs. Is the "123" literally in the URI, or is that just an example text, and the URI looks like "wyciwyg://<sometext>/<original uri>"?
> These changes need definitely a test. Existing tests won't cover edge cases
> like opening entry with invalid/missing security info etc.
Yes, I'm working with Brian on getting a setup that makes it easy to test these cases (we need an easy-to-create security info object, which he should be providing me a way to get).
> Otherwise it looks good, but I have probably a totally dump question. Why we
> must determine if the security info is required on the cache level? Why we
> just can't fail in nsDiskCacheMap::CreateDiskCacheEntry() when
> entry->SecurityInfo() is non-null and we can't serialize it? In
> nsDiskCacheEntry::CreateCacheEntry() we would fail (and doom the entry) when
> the security info is present but can't be deserialized. And if it's not
> present but it should be, shouldn't this case be handled on the protocol
> level (in nsHttpChannel, nsFtpChannel, etc..)? I.e. the cache API wouldn't
> need any change. I believe that this would be much more elegant and as well
> as more correct solution.
FWIW, I agree, it would be better to handle the decision about whether or not to use an entry in the channel itself (at least in theory), as it makes the cache very "dumb" in terms of not having to know at all what's being stuck in it. However, we already have broken the pure "dumb"-ness of the cache (it already has to know about security info and serializing it, etc), and doing that logic in each channel would be more invasive and quite probably more error-prone, since each channel's implementation could have its own unique bugs.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=712914#c54)• 13 years ago |
|  | |

(In reply to Michal Novotny (:michal) from [comment #52](/show_bug.cgi?id=712914#c52 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Returning null won't delete the wrong entry. SearchCacheDevices() won't just
> see it, so a new duplicate one will be created.
You are saying that we should doom the entry in this case, right? I agree.
> What is the reason for removing noWait argument here? BTW you did't remove
> it from the comment.
> And you should probably add a description of noWait here.
Like Nick said, we only need noWait on the new API currently. We should move the comment.
> Otherwise it looks good, but I have probably a totally dump question. Why we
> must determine if the security info is required on the cache level? Why we
> just can't fail in nsDiskCacheMap::CreateDiskCacheEntry() when
> entry->SecurityInfo() is non-null and we can't serialize it? In
> nsDiskCacheEntry::CreateCacheEntry() we would fail (and doom the entry) when
> the security info is present but can't be deserialized. And if it's not
> present but it should be, shouldn't this case be handled on the protocol
> level (in nsHttpChannel, nsFtpChannel, etc..)? I.e. the cache API wouldn't
> need any change. I believe that this would be much more elegant and as well
> as more correct solution.
That is what I originally wanted to do. Nick's patch ensures that every SSL-secured page that is in the cache has valid security-info. If we did the check "does this have security info? If so, deserialize it; if this fails, then fail" then we wouldn't handle the (admittedly extremely unusual) case where the security-info is missing when it should be there. The approach in the patch avoids us even needing to worry about if that is possible or not.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=712914#c55)• 13 years ago |
|  | |

Also, the approach in this bug makes it much easier to fix [bug 660749](/show_bug.cgi?id=660749 "NEW - Firefox doesn't (re)validate certificates when loading a HTTPS page from the cache") in an efficient way. In particular, with Nick's patch, I am able to do have control flow like this:
Cache Thread -> Cert Verification Thread -> Main Thread
instead of this:
Cache Thread -> Main Thread -> Cert Verification Thread -> Main Thread
which helps to minimize the performance regression from doing the certificate verification.

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=712914#c56)• 13 years ago |
|  | |

(In reply to Nick Hurley [:hurley] from [comment #53](/show_bug.cgi?id=712914#c53 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > The code is correct but the comment is wrong. In fact, you are stripping
> > "wyciwyg://123/" from the URI.
>
> That's easy to fix, but shows how little I know about both FindChar and
> wyciwyg URIs. Is the "123" literally in the URI, or is that just an example
> text, and the URI looks like "wyciwyg://<sometext>/<original uri>"?
It is just an example. "sometext" is a version of the document. E.g. first wyciwyg document for the <http://foo.com/> is wyciwyg://0/<http://foo.com/> and another document.write() for the same URI increases the version.

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=712914#c57)• 13 years ago |
|  | |

Attached patch

[coalesced patch](attachment.cgi?id=609878&action=diff) (obsolete)
— [Details](attachment.cgi?id=609878&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=609878)

Here's the patch with everything in Michal's comments BUT the test.
Brian, is there an ETA for your patch containing the separated TransportSecurityInfo? (In other words, will it be possible to get that AND this landed in Q1, or should we either not land this in Q1 or land this without a test?)
Carrying forward sr+, leaving without review until we determine what we want to do about the test.
[Attachment #609533](/attachment.cgi?id=609533&action=edit "coalesced patch") -
Attachment is obsolete: true
[Attachment #609878](/attachment.cgi?id=609878&action=edit "coalesced patch") -
Flags: superreview+

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=712914#c58)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #54](/show_bug.cgi?id=712914#c54 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> (In reply to Michal Novotny (:michal) from [comment #52](/show_bug.cgi?id=712914#c52 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > Returning null won't delete the wrong entry. SearchCacheDevices() won't just
> > see it, so a new duplicate one will be created.
>
> You are saying that we should doom the entry in this case, right? I agree.
Right.
> That is what I originally wanted to do. Nick's patch ensures that every
> SSL-secured page that is in the cache has valid security-info. If we did the
> check "does this have security info? If so, deserialize it; if this fails,
> then fail" then we wouldn't handle the (admittedly extremely unusual) case
> where the security-info is missing when it should be there. The approach in
> the patch avoids us even needing to worry about if that is possible or not.
Hmm, but the more I'm thinking about the new API, the less I like it. I will just sum up what I don't like... One would assume from the name of asyncOpenCacheEntryForURI() method that the entry is identified by the URI but we take from URI just the information whether the security info should be present or not (and then we pass this bool argument to the tons of functions that just forward it to the lower level). We could of course remove the key and take it from the URI but this would not work for wyciwyg channel. Also IsSecurityInfoRequired() is something that really shouldn't be part of the cache code.
> + /\*\*
> + \* For use by nsWyciwygChannel only. This will be removed after
> + \* bugs 695399 and 737614 are resolved.
> + \*/
> + [noscript,deprecated] nsICacheEntryDescriptor
> + openWriteCacheEntryForURI(in nsIURI uri, in ACString key);
I don't think we will remove the sync call from the wyciwyg channel, so it shouldn't be marked as deprecated. Instead of removing openCacheEntry() and keeping this method as noscript, I'd prefer to keep openCacheEntry(), but change it so that it fails when it is not called on the cache IO thread or maybe on any background thread.

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=712914#c59)• 13 years ago |
|  | |

(In reply to Nick Hurley [:hurley] from [comment #53](/show_bug.cgi?id=712914#c53 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > These changes need definitely a test. Existing tests won't cover edge cases
> > like opening entry with invalid/missing security info etc.
>
> Yes, I'm working with Brian on getting a setup that makes it easy to test
> these cases (we need an easy-to-create security info object, which he should
> be providing me a way to get).
I assume that you need this to test successful parsing of security info, but you shouldn't need it to test missing or corrupted security info. Or am I missing something?

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=712914#c60)• 13 years ago |
|  | |

(In reply to Michal Novotny (:michal) from [comment #58](/show_bug.cgi?id=712914#c58 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Hmm, but the more I'm thinking about the new API, the less I like it. I will
> just sum up what I don't like... One would assume from the name of
> asyncOpenCacheEntryForURI() method that the entry is identified by the URI
Ignoring (for now) the rest of your concerns with the new API, would this portion change if the function were renamed? (I'm certainly not tied to the name, it's just the first thing I came up with.)
> > + /\*\*
> > + \* For use by nsWyciwygChannel only. This will be removed after
> > + \* bugs 695399 and 737614 are resolved.
> > + \*/
> > + [noscript,deprecated] nsICacheEntryDescriptor
> > + openWriteCacheEntryForURI(in nsIURI uri, in ACString key);
>
> I don't think we will remove the sync call from the wyciwyg channel, so it
> shouldn't be marked as deprecated. Instead of removing openCacheEntry() and
> keeping this method as noscript, I'd prefer to keep openCacheEntry(), but
> change it so that it fails when it is not called on the cache IO thread or
> maybe on any background thread.
I've already filed [bug 739473](/show_bug.cgi?id=739473 "RESOLVED INVALID - Remove OpenWriteCacheEntryForURI from XPCOM interface in nsICacheSession") to remove openwritecacheentryforuri from the xpcom interface entirely, and just use it in wyciwyg without xpcom (trying to keep it as a follow-up so we can get this bug landed by the end of the quarter without too much churn). In terms of changing openCacheEntry, that might be OK eventually (though I would prefer to just remove it entirely), but for now we have consumers of that API in browser/ (bugs have also been filed to get those uses removed).
To answer your question in [comment 59](/show_bug.cgi?id=712914#c59 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"), I suppose it would be possible to test missing security info without Brian's changes, not sure how to test corrupted security info without either custom-creating the cache directory (is that even possible?) or having some security info class that intentionally corrupts itself when it serializes (which would be even more work).

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=712914#c61)• 13 years ago |
|  | |

(In reply to Nick Hurley [:hurley] from [comment #60](/show_bug.cgi?id=712914#c60 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> To answer your question in [comment 59](/show_bug.cgi?id=712914#c59 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"), I suppose it would be possible to
> test missing security info without Brian's changes, not sure how to test
> corrupted security info
It should be clear from inspecting the code that missing security-info is treated the same as corrupted security info. So, writing a cache entry with NULL security info, and then opening it, would be a good test.
Please test both the memory cache and disk cache.
(In reply to Michal Novotny (:michal) from [comment #58](/show_bug.cgi?id=712914#c58 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Hmm, but the more I'm thinking about the new API, the less I like it. I will
> just sum up what I don't like... One would assume from the name of
> asyncOpenCacheEntryForURI() method that the entry is identified by the URI
> but we take from URI just the information whether the security info should
> be present or not (and then we pass this bool argument to the tons of
> functions that just forward it to the lower level).
> Also IsSecurityInfoRequired() is something that really shouldn't be
> part of the cache code.
In the patch I am building on top of this one, we extract the hostname and port from the URI to pass to the cert verifier. We could pass (bool isTLS, in ACString hostname, long port) parameters instead of the URI if anyone cares strongly about the above. But, we are running out of time before our deadline so...let's decide one way or the other.
> I don't think we will remove the sync call from the wyciwyg channel, so it
> shouldn't be marked as deprecated. Instead of removing openCacheEntry() and
> keeping this method as noscript, I'd prefer to keep openCacheEntry(), but
> change it so that it fails when it is not called on the cache IO thread or
> maybe on any background thread.
Let's just remove [deprecated] then. If/when we have a more concrete plan for removing it in the next few weeks, we can deprecate and/or remove it before Firefox 14 release, which is more than 12 weeks away.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=712914#c62)• 13 years ago |
|  | |

Attached patch

[Show how host/port is used by patch for bug 660749](attachment.cgi?id=610042&action=diff) (obsolete)
— [Details](attachment.cgi?id=610042&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610042)

I hope this patch clarifies my previous comment.
[Attachment #610042](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") -
Flags: feedback?(michal.novotny)
[Attachment #610042](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") -
Flags: feedback?(hurley)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=712914#c63)• 13 years ago |
|  | |

Comment on [attachment 610042](/attachment.cgi?id=610042 "Show how host/port is used by patch for bug 660749") [[details]](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") [[diff]](/attachment.cgi?id=610042&action=diff "Show how host/port is used by patch for bug 660749") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610042)
Show how host/port is used by patch for [bug 660749](/show_bug.cgi?id=660749 "NEW - Firefox doesn't (re)validate certificates when loading a HTTPS page from the cache")
Review of [attachment 610042](/attachment.cgi?id=610042 "Show how host/port is used by patch for bug 660749") [[details]](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") [[diff]](/attachment.cgi?id=610042&action=diff "Show how host/port is used by patch for bug 660749") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610042):
-----------------------------------------------------------------
This all seems sensible enough, to me. It kind of sucks that we have to keep shoving stuff into the cache that it shouldn't care about (in an ideal world), but if it keeps work off the main thread and keeps thread round trips low, that seems like an acceptable tradeoff, IMHO.
[Attachment #610042](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") -
Flags: feedback?(hurley) → feedback+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=712914#c64)• 13 years ago |
|  | |

Attached patch

[coalesced patch](attachment.cgi?id=610244&action=diff) (obsolete)
— [Details](attachment.cgi?id=610244&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610244)

Here's a patch that contains all the testing that can be done until Brian's changes land. I'll post the try URL once I have it, but I'll note that the previous try run (<https://tbpl.mozilla.org/?tree=Try&rev=843f0a8a0c27>) is fine, and the new xpcshell test runs fine on my machine. The only reasons I'm doing a new full try run are (1) to make sure the xpcshell test runs fine on other platforms, and (2) to make sure the deleting of disk records in FindEntry (the only native code change in this version) doesn't accidentally break anything. I'm confident those 2 conditions will be met, but I'm also paranoid :)
The only thing left that we have to decide on is what to do about the ForURI async API. My personal inclination is to say leave it (especially given that Brian has work that builds on it), but I'm open to good arguments otherwise, and also to renaming to make it less confusing (if anyone has any suggestions, I'll also mull that over during lunch.)
[Attachment #609878](/attachment.cgi?id=609878&action=edit "coalesced patch") -
Attachment is obsolete: true
[Attachment #610244](/attachment.cgi?id=610244&action=edit "coalesced patch") -
Flags: superreview+
[Attachment #610244](/attachment.cgi?id=610244&action=edit "coalesced patch") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=712914#c65)• 13 years ago |
|  | |

Try run at <https://tbpl.mozilla.org/?tree=Try&rev=40fb03d4f332>

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=712914#c66)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #61](/show_bug.cgi?id=712914#c61 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> In the patch I am building on top of this one, we extract the hostname and
> port from the URI to pass to the cert verifier.
Where exactly is the certification verified? I can't find it in the patch #610042. The only effect of this 50k patch is that we set host and port of the security info in nsDiskCacheEntry::CreateCacheEntry(), right? Why can't we change security info so that it includes host and port in its serialized form?

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=712914#c67)• 13 years ago |
|  | |

(In reply to Michal Novotny (:michal) from [comment #66](/show_bug.cgi?id=712914#c66 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Where exactly is the certification verified? I can't find it in the patch
> #610042. The only effect of this 50k patch is that we set host and port of
> the security info in nsDiskCacheEntry::CreateCacheEntry(), right?
> Why can't we change security info so that it includes host and port in its
> serialized form?
1. This would be a change in the cache disk format.
2. This would make the metadata larger, which would be (slightly) worse for performance.
3. This patch avoids #1 and #2, so it is a less risky change.
4. When we have the opportunity to make a breaking change to the cache disk format we will completely redo the serialization of the security info to be significantly more compact. This requires this bug to be fixed first.
The certificate verification will happen from nsCacheService::NotifyListener. Here is a portion of that patch:
nsresult
nsCacheService::NotifyListener(nsCacheRequest \* request,
- nsICacheEntryDescriptor \* descriptor,
+ nsCacheEntryDescriptor \* descriptor,
nsCacheAccessMode accessGranted,
nsresult status)
{
NS\_ASSERTION(request->mThread, "no thread set in async request!");
// Swap ownership, and release listener on target thread...
nsICacheListener \*listener = request->mListener;
request->mListener = nsnull;
+ if (descriptor && NS\_SUCCEEDED(status) && request->mIsTLS) {
+ // Cannot use descriptor->GetSecurityInfo() because we are holding the
+ // cache service lock, and GetSecurityInfo() would attempt to acquire it.
+
+ // If we do NOT have an infoObject, then we must have just created an
+ // empty cache entry, so we have nothing to validate yet. The caller is
+ // expected to set the security info before closing the cache entry to
+ // security info that was already validated.
+ if (descriptor->CacheEntry()->SecurityInfo()) {
+ status = descriptor->CacheEntry()->SecurityInfo()
+ ->VerifySecurityInfoFromCacheLookup(
+ listener, request->mThread,
+ descriptor, accessGranted);
+ if (NS\_SUCCEEDED(status)) {
+ return status;
+ }
+ }
+ }
+
+ // Do not pass a descriptor to the listener when there was an error. In
+ // particular, we avoided validating the security-info (if any) because of
+ // the error.
+ if (NS\_FAILED(status)) {
+ descriptor = nsnull;
+ }
+
nsCOMPtr<nsIRunnable> ev =
new nsCacheListenerEvent(listener, descriptor,
accessGranted, status);
return request->mThread->Dispatch(ev, NS\_DISPATCH\_NORMAL);
}
VerifySecurityInfoFromCacheLookup() sends a request to the cert verification thread to verify the certificate. When certificate verification is complete, the certificate verification thread will call mRequest->listener->OnCacheEntryAvailable on request->mThread.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=712914#c68)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #67](/show_bug.cgi?id=712914#c67 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> (In reply to Michal Novotny (:michal) from [comment #66](/show_bug.cgi?id=712914#c66 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > Where exactly is the certification verified? I can't find it in the patch
> > #610042. The only effect of this 50k patch is that we set host and port of
> > the security info in nsDiskCacheEntry::CreateCacheEntry(), right?
Right. This is a prerequisite for the cert verification patch.

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=712914#c69)• 13 years ago |
|  | |

Comment on [attachment 610244](/attachment.cgi?id=610244 "coalesced patch") [[details]](/attachment.cgi?id=610244&action=edit "coalesced patch") [[diff]](/attachment.cgi?id=610244&action=diff "coalesced patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610244)
coalesced patch
> - nsCacheEntry \* entry = diskEntry->CreateCacheEntry(this);
> + bool doomEntry = false;
> + nsCacheEntry \* entry = diskEntry->CreateCacheEntry(this,
> + securityInfoRequired,
> + &doomEntry);
> + if (doomEntry) {
> + // Make sure this can never be found by FindRecord again
> +#ifdef DEBUG
> + nsresult rv =
> +#endif
> + mCacheMap.DeleteRecord(&record);
> + NS\_ASSERTION(NS\_SUCCEEDED(rv),"DeleteRecord failed.");
> + return nsnull;
> + }
You need to delete storage too, i.e. add mCacheMap.DeleteStorage(&record). Also you don't need to add doomEntry parameter. Simple delete the entry when nsDiskCacheEntry::CreateCacheEntry() returns null. This will delete the entry also in case when metadata can't be unflatten, but that's actually what we want to do.
> +function write\_no\_secinfo(entry, accessGranted, status) {
> + write\_data(entry);
> +
> + try {
> + entry.close();
> + } catch (e) {
> + do\_throw("Unexpected exception closing bare entry: " + e);
> + }
> +
> + test\_missing\_secinfo();
> +}
You can write invalid security info simply by doing entry.setMetaDataElement("security-info", "blablabla");
Ideally the test should also check that the invalid entry was removed (enumerate all entries in the cache), and that all space was freed (check cache size).

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=712914#c70)• 13 years ago |
|  | |

(In reply to Michal Novotny (:michal) from [comment #69](/show_bug.cgi?id=712914#c69 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> Ideally the test should also check that the invalid entry was removed
> (enumerate all entries in the cache), and that all space was freed (check
> cache size).
I agree that it makes sense to check that the entry was removed, but I think that the test that the disk space is freed should be covered by other tests (not to be done in this bug) that verify that space is freed when a cache entry is removed.

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=712914#c71)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #70](/show_bug.cgi?id=712914#c70 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> I agree that it makes sense to check that the entry was removed, but I think
> that the test that the disk space is freed should be covered by other tests
> (not to be done in this bug) that verify that space is freed when a cache
> entry is removed.
Such test would point out the missing DeleteStorage(), but I'm fine with omitting this test.

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=712914#c72)• 13 years ago |
|  | |

(In reply to Michal Novotny (:michal) from [comment #71](/show_bug.cgi?id=712914#c71 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> (In reply to Brian Smith (:bsmith) from [comment #70](/show_bug.cgi?id=712914#c70 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> > I agree that it makes sense to check that the entry was removed, but I think
> > that the test that the disk space is freed should be covered by other tests
> > (not to be done in this bug) that verify that space is freed when a cache
> > entry is removed.
>
> Such test would point out the missing DeleteStorage(), but I'm fine with
> omitting this test.
Gotcha. I forgot that the existing tests don't try to test anything with security-info.

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=712914#c73)• 13 years ago |
|  | |

(In reply to Brian Smith (:bsmith) from [comment #67](/show_bug.cgi?id=712914#c67 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> + if (descriptor && NS\_SUCCEEDED(status) && request->mIsTLS) {
> + // Cannot use descriptor->GetSecurityInfo() because we are holding
> the
> + // cache service lock, and GetSecurityInfo() would attempt to
> acquire it.
> +
> + // If we do NOT have an infoObject, then we must have just created
> an
> + // empty cache entry, so we have nothing to validate yet. The
> caller is
> + // expected to set the security info before closing the cache entry
> to
> + // security info that was already validated.
> + if (descriptor->CacheEntry()->SecurityInfo()) {
> + status = descriptor->CacheEntry()->SecurityInfo()
> + ->VerifySecurityInfoFromCacheLookup(
> + listener, request->mThread,
> + descriptor, accessGranted);
> + if (NS\_SUCCEEDED(status)) {
> + return status;
> + }
> + }
> + }
This whole concept is IMO wrong. We should probably create a new interface nsISecureCacheSession that would be a wrapper for nsICacheSession. This new interface would implement the asyncOpenCacheEntryForURI() method, it would call nsICacheSession::asyncOpenCacheEntry() and listen for the result. In the listener it would do all the security checks (if the secinfo is needed, if it is valid, otherwise doom the entry at this level). Then it would call the original listener. And this code could (or even should) live outside the netwerk/cache directory.
BTW I think that the current patch won't handle following scenario correctly:
1) Open the cache entry using asyncOpenCacheEntry()
2) It is inactive so it is read from the disk without the security info (because of asyncOpenCacheEntry())
3) Open the cache entry using asyncOpenCacheEntryForURI()
4) The request is queued since the entry is in use.
5) The request is processed when the previous descriptor is closed, but since the cache entry is active, the security info isn't deserialized.
6) Now you got a problem in nsCacheService::NotifyListener().

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=712914#c74)• 13 years ago |
|  | |

Comment on [attachment 610244](/attachment.cgi?id=610244 "coalesced patch") [[details]](/attachment.cgi?id=610244&action=edit "coalesced patch") [[diff]](/attachment.cgi?id=610244&action=diff "coalesced patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610244)
coalesced patch
I'm clearing the review request for now since I'm really not sure that this is the right way to go.
[Attachment #610244](/attachment.cgi?id=610244&action=edit "coalesced patch") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=712914#c75)• 13 years ago |
|  | |

Attached patch

[coalesced patch](attachment.cgi?id=610305&action=diff) (obsolete)
— [Details](attachment.cgi?id=610305&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610305)

Here's the patch with the more robust testing requested by Michal in [comment 74](/show_bug.cgi?id=712914#c74 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info").
[Attachment #610244](/attachment.cgi?id=610244&action=edit "coalesced patch") -
Attachment is obsolete: true
[Attachment #610305](/attachment.cgi?id=610305&action=edit "coalesced patch") -
Flags: superreview+
[Attachment #610305](/attachment.cgi?id=610305&action=edit "coalesced patch") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=712914#c76)• 13 years ago |
|  | |

Go me, not seeing these comments before I upload the most recent patch (you can ignore the r? since it seems to be irrelevant at this point)
(In reply to Michal Novotny (:michal) from [comment #73](/show_bug.cgi?id=712914#c73 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info"))
> This whole concept is IMO wrong. We should probably create a new interface
> nsISecureCacheSession that would be a wrapper for nsICacheSession. This new
> interface would implement the asyncOpenCacheEntryForURI() method, it would
> call nsICacheSession::asyncOpenCacheEntry() and listen for the result. In
> the listener it would do all the security checks (if the secinfo is needed,
> if it is valid, otherwise doom the entry at this level). Then it would call
> the original listener. And this code could (or even should) live outside the
> netwerk/cache directory.
As much as I hate to admit it (given how much work it's going to create for me + reviewers over the next 2 days), I think you're right, especially in light of the scenario you outline below. Even though I can't imagine that scenario playing out often (if at all) in the current state of things, but it's better to protect against it (in case someone does the Wrong Thing at some point later down the line).
> BTW I think that the current patch won't handle following scenario correctly:
>
> 1) Open the cache entry using asyncOpenCacheEntry()
> 2) It is inactive so it is read from the disk without the security info
> (because of asyncOpenCacheEntry())
> 3) Open the cache entry using asyncOpenCacheEntryForURI()
> 4) The request is queued since the entry is in use.
> 5) The request is processed when the previous descriptor is closed, but
> since the cache entry is active, the security info isn't deserialized.
> 6) Now you got a problem in nsCacheService::NotifyListener().

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a8432724_408661)• 13 years ago |

[Attachment #610305](/attachment.cgi?id=610305&action=edit "coalesced patch") -
Flags: superreview+
[Attachment #610305](/attachment.cgi?id=610305&action=edit "coalesced patch") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=712914#c77)• 13 years ago |
|  | |

Attached patch

[patch (simple version)](attachment.cgi?id=610413&action=diff) (obsolete)
— [Details](attachment.cgi?id=610413&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610413)

OK, here's the simple version that we agreed on via email. I added in the cleanup of the on-disk entry if we fail to deserialise properly. That's easy to strip out if we want to make that a follow-up instead (I'm obviously of the opinion that cleaning up is The Right Thing to do). I'll add the try URL once it appears in my inbox. The only thing I can see that \*might\* go wrong on the try run is breaking android xpcshell tests (since disk cache is disabled there, and the test insists on caching to disk). If that happens, we can just skip-if this test on android until we enable the disk cache there.
[Attachment #610305](/attachment.cgi?id=610305&action=edit "coalesced patch") -
Attachment is obsolete: true
[Attachment #610413](/attachment.cgi?id=610413&action=edit "patch (simple version)") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=712914#c78)• 13 years ago |
|  | |

Here's that try link I promised: <https://tbpl.mozilla.org/?tree=Try&rev=a2393f8c7775>

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=712914#c79)• 13 years ago |
|  | |

Comment on [attachment 610413](/attachment.cgi?id=610413 "patch (simple version)") [[details]](/attachment.cgi?id=610413&action=edit "patch (simple version)") [[diff]](/attachment.cgi?id=610413&action=diff "patch (simple version)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610413)
patch (simple version)
> nsCacheEntry \* entry = diskEntry->CreateCacheEntry(this);
> - if (!entry) return nsnull;
> + if (!entry) goto cleanup;
>
> binding = mBindery.CreateBinding(entry, &record);
> if (!binding) {
> delete entry;
> - return nsnull;
> + goto cleanup;
> }
>
> return entry;
> +
> +cleanup:
> + (void) mCacheMap.DeleteStorage(&record);
> + (void) mCacheMap.DeleteRecord(&record);
> + return nsnull;
> }
I don't like goto too much. Although it is sometimes reasonable to use goto, I don't think this is the case. Could you please change it to something like this?
nsCacheEntry \* entry = diskEntry->CreateCacheEntry(this);
if (entry) {
binding = mBindery.CreateBinding(entry, &record);
if (!binding) {
delete entry;
entry = nsnull;
}
if (!entry) {
(void) mCacheMap.DeleteStorage(&record);
(void) mCacheMap.DeleteRecord(&record);
}
return entry;
> nsCOMPtr<nsISerializable> serializable =
> do\_QueryInterface(entry->SecurityInfo());
> if (serializable) {
> nsCString info;
> - NS\_SerializeToString(serializable, info);
> + nsresult rv = NS\_SerializeToString(serializable, info);
> + if (NS\_FAILED(rv)) return nsnull;
> entry->SetMetaDataElement("security-info", info.get());
> }
We should also fail in case when we have a security info but QueryInterface to nsISerializable fails.
> + visitDevice: function (deviceID, deviceInfo) {
> + if (deviceID == "disk") {
> + // We only care about the disk device, since that's the only place we
> + // actually serialize security info
> + return true;
> + }
> +
> + // We don't care about visiting entries on non-disk devices
> + return false;
> + },
> +
> + visitEntry: function (deviceID, entryInfo) {
> + if (deviceID == "disk") {
> + this.nentries++;
> + this.size += entryInfo.dataSize;
> + return true;
> + }
In [comment #69](/show_bug.cgi?id=712914#c69 "RESOLVED FIXED - Disk cache does not verify that it correctly serialized/deserialized security info") I meant to check size in device info. Only this counter would be affected by missing DeleteStorage(). For example see <http://hg.mozilla.org/mozilla-central/annotate/563ea372f000/netwerk/test/unit/test_bug651100.js#l86>
[Attachment #610413](/attachment.cgi?id=610413&action=edit "patch (simple version)") -
Flags: review?(michal.novotny)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=712914#c80)• 13 years ago |
|  | |

Attached patch

[patch (simple version)](attachment.cgi?id=610571&action=diff) (obsolete)
— [Details](attachment.cgi?id=610571&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610571)

Here's a version of the patch that addresses your comments, Michal
[Attachment #610413](/attachment.cgi?id=610413&action=edit "patch (simple version)") -
Attachment is obsolete: true
[Attachment #610571](/attachment.cgi?id=610571&action=edit "patch (simple version)") -
Flags: review?(michal.novotny)

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=712914#c81)• 13 years ago |
|  | |

Comment on [attachment 610571](/attachment.cgi?id=610571 "patch (simple version)") [[details]](/attachment.cgi?id=610571&action=edit "patch (simple version)") [[diff]](/attachment.cgi?id=610571&action=diff "patch (simple version)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610571)
patch (simple version)
> + nsresult rv = NS\_SerializeToString(serializable, info);
> + if (NS\_FAILED(rv)) return nsnull;
> entry->SetMetaDataElement("security-info", info.get());
Maybe we should check the return value of SetMetaDataElement(). I don't know if it can fail. Or more precisely, it can fail iff PR\_REALLOC is fallible (in nsCacheMetaData::EnsureBuffer), which I'm not sure it is. I'm sorry that I overlooked this in the previous review.
r+ with this fixed
[Attachment #610571](/attachment.cgi?id=610571&action=edit "patch (simple version)") -
Flags: review?(michal.novotny) → review+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=712914#c82)• 13 years ago |
|  | |

Attached patch

[patch (simple version)](attachment.cgi?id=610684&action=diff) (obsolete)
— [Details](attachment.cgi?id=610684&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610684)

Alright, here's the final version. The try run looks good <https://tbpl.mozilla.org/?tree=Try&rev=59e2f556dfbd> (still a couple android tests running, but I'm confident they'll be fine, since disk cache is disabled on android).
[Attachment #610571](/attachment.cgi?id=610571&action=edit "patch (simple version)") -
Attachment is obsolete: true
[Attachment #610684](/attachment.cgi?id=610684&action=edit "patch (simple version)") -
Flags: review+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a8498323_408661)• 13 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=712914#c83)• 13 years ago |
|  | |

Attached patch

[patch (simple version)](attachment.cgi?id=610687&action=diff)
— [Details](attachment.cgi?id=610687&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=712914&attachment=610687)

Forgot to add r=michal to the commit message in the last patch.
[Attachment #610684](/attachment.cgi?id=610684&action=edit "patch (simple version)") -
Attachment is obsolete: true
[Attachment #610687](/attachment.cgi?id=610687&action=edit "patch (simple version)") -
Flags: review+

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=712914#c84)• 13 years ago |
|  | |

Ignore that comment about disk cache being disabled on android, I must've dreamt it. Still, try looks good so far, and previous versions of the patch have gone green no problem.

|  | [u408661](/user_profile?user_id=408661)  Assignee |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=712914#c85)• 13 years ago |
|  | |

ok, try is all green. can either brian or michal land this? thanks!

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625) |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=712914#c86)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/461760e5dbd5>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=712914#c87)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/461760e5dbd5>Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: mozilla12 → mozilla14

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a8846926_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [14+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=14%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=712914#c88)• 13 years ago |
|  | |

We don't think the ESR is affected by this bug - please let us know if that's not the case.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[14+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=14%2B) → [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-)

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a10564848_14661)• 13 years ago |

[Attachment #603348](/attachment.cgi?id=603348&action=edit "proposed idl changes") -
Attachment is obsolete: true

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a10564866_14661)• 13 years ago |

[Attachment #610042](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") -
Attachment is obsolete: true
[Attachment #610042](/attachment.cgi?id=610042&action=edit "Show how host/port is used by patch for bug 660749") -
Flags: feedback?(michal.novotny)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a17312858_280903)• 13 years ago |

Whiteboard: [sg:moderate] → [sg:moderate][advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=712914#a18276285_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=712914&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [u408661](/user_profile?user_id=408661)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_2beb74c5_20250125_192914.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/757431)
* [XML](/show_bug.cgi?ctype=xml&id=757431)

Closed
[Bug 757431](/show_bug.cgi?id=757431)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: v->toGCThing(), at gc/Marking.cpp:327 or Crash [@ js::gc::ArenaHeader::allocated]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: v->toGCThing(), at gc/Marking.cpp:327 or Crash [@ js::gc::ArenaHeader::allocated]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla16

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox16 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 |  | fixed |
| firefox15 |  | fixed |
| firefox16 |  | fixed |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: billm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:ignore][advisory-tracking+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:ignore][advisory-tracking+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c13 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::gc::ArenaHeader::allocated ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Agc%3A%3AArenaHeader%3A%3Aallocated)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Test case for shell (run with -n -m -a)](/attachment.cgi?id=625998)  [13 years ago](#c0)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   1.38 KB, application/javascript |  | [Details](/attachment.cgi?id=625998&action=edit) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=632088)  [13 years ago](#c3)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   2.85 KB, patch | bhackett1024 : [review+](#a2013854_346231 "13 years ago")  lsblakk : [approval-mozilla-aurora+](#c9 "13 years ago")  lsblakk : [approval-mozilla-beta+](#c9 "13 years ago") | [Details](/attachment.cgi?id=632088&action=edit) | [Diff](/attachment.cgi?id=632088&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=757431&attachment=632088) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=757431#c0)• 13 years ago |
|  | |

Attached file
[Test case for shell (run with -n -m -a)](attachment.cgi?id=625998)
— [Details](attachment.cgi?id=625998&action=edit)

The attached test asserts/crashes on mozilla-central revision 5586efaf687d (options -m -n -a).
Crash trace (debug build):
Program received signal SIGSEGV, Segmentation fault.
0x0804c753 in js::gc::ArenaHeader::allocated (this=0x0) at ../../gc/Heap.h:467
467 JS\_ASSERT(allocKind <= size\_t(FINALIZE\_LIMIT));
(gdb) bt 8
#0 0x0804c753 in js::gc::ArenaHeader::allocated (this=0x0) at ../../gc/Heap.h:467
#1 0x0804c7b7 in js::gc::ArenaHeader::getAllocKind (this=0x0) at ../../gc/Heap.h:497
#2 0x0806b1f5 in js::gc::Cell::getAllocKind (this=0x0) at ../gc/Heap.h:941
#3 0x080f29e0 in js::gc::GetGCThingTraceKind (thing=0x0) at /srv/repos/mozilla-central/js/src/jsgcinlines.h:30
#4 0x0832568e in js::gc::MarkKind (trc=0x86495b8, thingp=0xffffb48c, kind=JSTRACE\_OBJECT) at /srv/repos/mozilla-central/js/src/gc/Marking.cpp:231
#5 0x08325c00 in js::gc::MarkValueInternal (trc=0x86495b8, v=0xf77021a0) at /srv/repos/mozilla-central/js/src/gc/Marking.cpp:330
#6 0x08325d2c in js::gc::MarkValueRoot (trc=0x86495b8, v=0xf77021a0, name=0x848f00a "vm\_stack") at /srv/repos/mozilla-central/js/src/gc/Marking.cpp:352
#7 0x082b20cf in js::StackSpace::markFrameSlots (this=0x8616b30, trc=0x86495b8, fp=0xf7702160, slotsEnd=0xf77021b0, pc=0x8647dfe "W") at /srv/repos/mozilla-central/js/src/vm/Stack.cpp:501
(More stack frames follow...)
(gdb) x /i $pc
=> 0x804c753 <js::gc::ArenaHeader::allocated() const+21>: movzbl 0xc(%eax),%eax
(gdb) info reg eax
eax 0x0 0
S-s due to GC-related assertion with crash, until the crash is confirmed to be harmless and always a null-deref.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=757431#a12874_389993)• 13 years ago |

Assignee: general → wmccloskey

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=757431#c1)• 13 years ago |
|  | |

Fuzzer came up with an even simpler test that shows the same assertion and crash:
function setterFunction(v) { called = true; }
function getterFunction(v) { return "getter"; }
Object.defineProperty(Array.prototype, 1,{
get: getterFunction,
set: setterFunction
});
gczeal(4);
var N = 350;
var source = "".concat(
repeat\_str("try { f(); } finally {\n", N),
repeat\_str("}", N));
function repeat\_str(str, repeat\_count) {
var arr = new Array(--repeat\_count);
while (repeat\_count != 0)
arr[--repeat\_count] = str;
return str.concat.apply(str, arr);
}
If you think this is not the same bug though, let me know and I'll clone :)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=757431#c2)• 13 years ago |
|  | |

The first bug is a dupe of [bug 753283](/show_bug.cgi?id=753283 "RESOLVED FIXED - Assertion failure: allocated(), at ../../gc/Heap.h:497 or Crash [@ js::gc::Arena::isAligned]"), which I'm having trouble landing. I'm working on it, though.
The second one is a separate bug, as far as I can tell. Let's make this bug be about the second test case and ignore the first one. Hopefully that won't screw up your tools too much.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=757431#c3)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=632088&action=diff)
— [Details](attachment.cgi?id=632088&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=757431&attachment=632088)

Another VM stack scanning bug. We can GC inside of GetElements before all the elements have been initialized.
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: review?(bhackett1024)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=757431#c4)• 13 years ago |
|  | |

No problem, we'll just ignore this bug for the tool so it does not get accidentally verified the wrong way.Whiteboard: js-triage-needed → [jsbugmon:ignore]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=757431#a2013854_346231)• 13 years ago |

[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: review?(bhackett1024) → review+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=757431#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/a79fe8932e3f>Target Milestone: --- → mozilla16

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=757431#c6)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/a79fe8932e3f>Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=757431#c7)• 13 years ago |
|  | |

Guessing sec-critical since the fix is "MakeRangeGCSafe(f.regs.sp, delta);", and we appear to have this code back to at least ESR. Is there any reason we shouldn't take this fix on old branches?
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=757431#c8)• 13 years ago |
|  | |

Comment on [attachment 632088](/attachment.cgi?id=632088 "fix") [[details]](/attachment.cgi?id=632088&action=edit "fix") [[diff]](/attachment.cgi?id=632088&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=757431&attachment=632088)
fix
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [Bug 723313](/show_bug.cgi?id=723313 "RESOLVED FIXED - Stop using conservative stack scanner for VM stack marking")
User impact if declined: Low likelihood of GC crashes, exploits.
Testing completed (on m-c, etc.): On m-c.
Risk to taking this patch (and alternatives if risky): Low. It just overwrites unused memory with NULLs.
String or UUID changes made by this patch: None.
No need to take on ESR. We used to handle the undefined memory more gracefully before [bug 723313](/show_bug.cgi?id=723313 "RESOLVED FIXED - Stop using conservative stack scanner for VM stack marking").
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=757431#c9)• 13 years ago |
|  | |

Comment on [attachment 632088](/attachment.cgi?id=632088 "fix") [[details]](/attachment.cgi?id=632088&action=edit "fix") [[diff]](/attachment.cgi?id=632088&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=757431&attachment=632088)
fix
low risk, sec critical - approved.
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: approval-mozilla-beta+
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #632088](/attachment.cgi?id=632088&action=edit "fix") -
Flags: approval-mozilla-aurora+

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=757431#c10)• 13 years ago |
|  | |

adjusting the esr tracking/status flags according to [comment 8](/show_bug.cgi?id=757431#c8 "VERIFIED FIXED - Assertion failure: v->toGCThing(), at gc/Marking.cpp:327 or Crash [@ js::gc::ArenaHeader::allocated]")
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → ---

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=757431#c11)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/733e912f7e05>
<https://hg.mozilla.org/releases/mozilla-beta/rev/0ad2987252b2>
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=757431#c12)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=757431#a3220808_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=757431#a4245977_280903)• 13 years ago |

Whiteboard: [jsbugmon:ignore] → [jsbugmon:ignore][advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=757431#a5137393_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=757431#c13)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/jit-test/tests/basic/[bug757431](/show_bug.cgi?id=757431 "VERIFIED FIXED - Assertion failure: v->toGCThing(), at gc/Marking.cpp:327 or Crash [@ js::gc::ArenaHeader::allocated]").js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=757431&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_13a289e6_20250125_192849.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2012-42

## Miscellaneous memory safety hazards (rv:14.0/ rv:10.0.6)

Announced
July 17, 2012
Reporter
Mozilla Developers
Impact
Critical
Products
Firefox, Firefox ESR, SeaMonkey, Thunderbird, Thunderbird ESR
Fixed in

* Firefox 14
* Firefox ESR 10.0.6
* SeaMonkey 2.11
* Thunderbird 14
* Thunderbird ESR 10.0.6

### Description

Mozilla developers identified and fixed several memory safety bugs
in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption
under certain circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the Thunderbird
and SeaMonkey products because scripting is disabled, but are potentially a risk
in browser or browser-like contexts in those products.

### References

Brian Smith, Gary Kwong, Christian Holler, Jesse Ruderman, Christoph Diehl,
Chris Jones, Brad Lassey, and Kyle Huey reported memory safety problems and crashes that
affect Firefox 13.

* [Memory safety bugs fixed in Firefox 14](https://bugzilla.mozilla.org/buglist.cgi?bug_id=712914,738841,743876,754725,757431,717488,718290,752662,765179,766018,766304,725499)
* [CVE-2012-1949](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1949)

Benoit Jacob, Jesse Ruderman, Christian Holler, and Bill McCloskey reported
memory safety problems and crashes that affect Firefox ESR 10 and
Firefox 13.

* [Memory safety bugs fixed in Firefox ESR 10.0.6 and Firefox 14](https://bugzilla.mozilla.org/buglist.cgi?bug_id=732233,746896,750575,763225,746103,756600,749385,758471,754989,772282)
* [CVE-2012-1948](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1948)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from secunia.com_50f0c81c_20250125_192845.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from lists.opensuse.org_01801748_20250125_192841.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/#VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND)

# [security-announce] openSUSE-SU-2012:0917-1: important: MozillaThunderbird: update to Thunderbird 14.0

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

27 Jul
2012

27 Jul
'12

11:08

openSUSE Security Update: MozillaThunderbird: update to Thunderbird 14.0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2012:0917-1
Rating: important
References: #771583
Affected Products:
openSUSE 12.1
openSUSE 11.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that contains security fixes can now be installed.
Description:
Mozilla Thunderbird was updated to version 14.0 (bnc#771583)
\* MFSA 2012-42/CVE-2012-1949/CVE-2012-1948 Miscellaneous
memory safety hazards
\* MFSA
2012-44/CVE-2012-1951/CVE-2012-1954/CVE-2012-1953/CVE-2012-1
952 Gecko memory corruption
\* MFSA 2012-45/CVE-2012-1955 (bmo#757376) Spoofing issue
with location
\* MFSA 2012-47/CVE-2012-1957 (bmo#750096) Improper
filtering of javascript in HTML feed-view
\* MFSA 2012-48/CVE-2012-1958 (bmo#750820) use-after-free
in nsGlobalWindow::PageHidden
\* MFSA 2012-49/CVE-2012-1959 (bmo#754044, bmo#737559)
Same-compartment Security Wrappers can be bypassed
\* MFSA 2012-50/CVE-2012-1960 (bmo#761014) Out of bounds
read in QCMS
\* MFSA 2012-51/CVE-2012-1961 (bmo#761655) X-Frame-Options
header ignored when duplicated
\* MFSA 2012-52/CVE-2012-1962 (bmo#764296)
JSDependentString::undepend string conversion results
in memory corruption
\* MFSA 2012-53/CVE-2012-1963 (bmo#767778) Content
Security Policy 1.0 implementation errors cause data
leakage
\* MFSA 2012-56/CVE-2012-1967 (bmo#758344) Code execution
through javascript: URLs
\* relicensed to MPL-2.0
- update Enigmail to 1.4.3
- no crashreport on %arm, fixing build
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.1:
zypper in -t patch openSUSE-2012-443
- openSUSE 11.4:
zypper in -t patch openSUSE-2012-443
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.1 (x86\_64):
MozillaThunderbird-14.0-33.26.1
MozillaThunderbird-buildsymbols-14.0-33.26.1
MozillaThunderbird-debuginfo-14.0-33.26.1
MozillaThunderbird-debugsource-14.0-33.26.1
MozillaThunderbird-devel-14.0-33.26.1
MozillaThunderbird-devel-debuginfo-14.0-33.26.1
MozillaThunderbird-translations-common-14.0-33.26.1
MozillaThunderbird-translations-other-14.0-33.26.1
enigmail-1.4.3+14.0-33.26.1
enigmail-debuginfo-1.4.3+14.0-33.26.1
- openSUSE 12.1 (i586):
MozillaThunderbird-14.0-33.26.2
MozillaThunderbird-buildsymbols-14.0-33.26.2
MozillaThunderbird-debuginfo-14.0-33.26.2
MozillaThunderbird-debugsource-14.0-33.26.2
MozillaThunderbird-devel-14.0-33.26.2
MozillaThunderbird-devel-debuginfo-14.0-33.26.2
MozillaThunderbird-translations-common-14.0-33.26.2
MozillaThunderbird-translations-other-14.0-33.26.2
enigmail-1.4.3+14.0-33.26.2
enigmail-debuginfo-1.4.3+14.0-33.26.2
- openSUSE 11.4 (x86\_64):
MozillaThunderbird-14.0-24.1
MozillaThunderbird-buildsymbols-14.0-24.1
MozillaThunderbird-debuginfo-14.0-24.1
MozillaThunderbird-debugsource-14.0-24.1
MozillaThunderbird-devel-14.0-24.1
MozillaThunderbird-devel-debuginfo-14.0-24.1
MozillaThunderbird-translations-common-14.0-24.1
MozillaThunderbird-translations-other-14.0-24.1
enigmail-1.4.3+14.0-24.1
enigmail-debuginfo-1.4.3+14.0-24.1
- openSUSE 11.4 (i586):
MozillaThunderbird-14.0-24.2
MozillaThunderbird-buildsymbols-14.0-24.2
MozillaThunderbird-debuginfo-14.0-24.2
MozillaThunderbird-debugsource-14.0-24.2
MozillaThunderbird-devel-14.0-24.2
MozillaThunderbird-devel-debuginfo-14.0-24.2
MozillaThunderbird-translations-common-14.0-24.2
MozillaThunderbird-translations-other-14.0-24.2
enigmail-1.4.3+14.0-24.2
enigmail-debuginfo-1.4.3+14.0-24.2
References:
<https://bugzilla.novell.com/771583>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND/#VSILWTK5QEZYZHLWN5GOY5K5KJWK7WND)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.ubuntu.com_489bd12a_20250125_192854.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1510-1: Thunderbird vulnerabilities

17 July 2012

Several security issues were fixed in Thunderbird.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)
* [Ubuntu 11.10](/security/notices?release=oneiric)
* [Ubuntu 11.04](/security/notices?release=natty)
* [Ubuntu 10.04](/security/notices?release=lucid)

## Packages

* [thunderbird](/security/cves?package=thunderbird) - Mozilla Open Source mail and newsgroup client

## Details

Benoit Jacob, Jesse Ruderman, Christian Holler, Bill McCloskey, Brian Smith,

Gary Kwong, Christoph Diehl, Chris Jones, Brad Lassey, and Kyle Huey discovered

memory safety issues affecting Thunderbird. If the user were tricked into

opening a specially crafted page, an attacker could possibly exploit these to

cause a denial of service via application crash, or potentially execute code

with the privileges of the user invoking Thunderbird. ([CVE-2012-1948](/security/CVE-2012-1948),

[CVE-2012-1949](/security/CVE-2012-1949))

Abhishek Arya discovered four memory safety issues affecting Thunderbird. If

the user were tricked into opening a specially crafted page, an attacker could

possibly exploit these to cause a denial of service via application crash, or

potentially execute code with the privileges of the user invoking Thunderbird.

([CVE-2012-1951](/security/CVE-2012-1951), [CVE-2012-1952](/security/CVE-2012-1952), [CVE-2012-1953](/security/CVE-2012-1953), [CVE-2012-1954](/security/CVE-2012-1954))

Mariusz Mlynski discovered that the address bar may be incorrectly updated.

Calls to history.forward and history.back could be used to navigate to a site

while the address bar still displayed the previous site. A remote attacker

could exploit this to conduct phishing attacks. ([CVE-2012-1955](/security/CVE-2012-1955))

Mario Heiderich discovered that HTML  tags were not filtered out of the

HTML  of RSS feeds. A remote attacker could exploit this to

conduct cross-site scripting (XSS) attacks via javascript execution in the HTML

feed view. ([CVE-2012-1957](/security/CVE-2012-1957))

Arthur Gerkis discovered a use-after-free vulnerability. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit this to cause a denial of service via application crash, or potentially

execute code with the privileges of the user invoking Thunderbird.

([CVE-2012-1958](/security/CVE-2012-1958))

Bobby Holley discovered that same-compartment security wrappers (SCSW) could be

bypassed to allow XBL access. If the user were tricked into opening a specially

crafted page, an attacker could possibly exploit this to execute code with the

privileges of the user invoking Thunderbird. ([CVE-2012-1959](/security/CVE-2012-1959))

Tony Payne discovered an out-of-bounds memory read in Mozilla's color

management library (QCMS). If the user were tricked into opening a specially

crafted color profile, an attacker could possibly exploit this to cause a

denial of service via application crash. ([CVE-2012-1960](/security/CVE-2012-1960))

Frédéric Buclin discovered that the X-Frame-Options header was ignored when its

value was specified multiple times. An attacker could exploit this to conduct

clickjacking attacks. ([CVE-2012-1961](/security/CVE-2012-1961))

Bill Keese discovered a memory corruption vulnerability. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit this to cause a denial of service via application crash, or potentially

execute code with the privileges of the user invoking Thunderbird.

([CVE-2012-1962](/security/CVE-2012-1962))

Karthikeyan Bhargavan discovered an information leakage vulnerability in the

Content Security Policy (CSP) 1.0 implementation. If the user were tricked into

opening a specially crafted page, an attacker could possibly exploit this to

access a user's OAuth 2.0 access tokens and OpenID credentials. ([CVE-2012-1963](/security/CVE-2012-1963))

It was discovered that the execution of javascript: URLs was not properly

handled in some cases. A remote attacker could exploit this to execute code

with the privileges of the user invoking Thunderbird. ([CVE-2012-1967](/security/CVE-2012-1967))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [14.0+build1-0ubuntu0.12.04.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/14.0%2Bbuild1-0ubuntu0.12.04.1)

##### Ubuntu 11.10

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [14.0+build1-0ubuntu0.11.10.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/14.0%2Bbuild1-0ubuntu0.11.10.1)

##### Ubuntu 11.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [14.0+build1-0ubuntu0.11.04.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/14.0%2Bbuild1-0ubuntu0.11.04.1)

##### Ubuntu 10.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [14.0+build1-0ubuntu0.10.04.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/14.0%2Bbuild1-0ubuntu0.10.04.1)

When upgrading, users should be aware of the following:

* In Ubuntu 11.04, unity-2d users may lose the ability to view drop-down menus,

  context menus, and perform drag-and-drop operations in Thunderbird. This is a

  known issue being tracked in <https://launchpad.net/bugs/1020198> and may be

  fixed in a later update.

After a standard system update you need to restart Thunderbird to make

all the necessary changes.

## References

* [CVE-2012-1948](/security/CVE-2012-1948)
* [CVE-2012-1949](/security/CVE-2012-1949)
* [CVE-2012-1951](/security/CVE-2012-1951)
* [CVE-2012-1952](/security/CVE-2012-1952)
* [CVE-2012-1953](/security/CVE-2012-1953)
* [CVE-2012-1954](/security/CVE-2012-1954)
* [CVE-2012-1955](/security/CVE-2012-1955)
* [CVE-2012-1957](/security/CVE-2012-1957)
* [CVE-2012-1958](/security/CVE-2012-1958)
* [CVE-2012-1959](/security/CVE-2012-1959)
* [CVE-2012-1960](/security/CVE-2012-1960)
* [CVE-2012-1961](/security/CVE-2012-1961)
* [CVE-2012-1962](/security/CVE-2012-1962)
* [CVE-2012-1963](/security/CVE-2012-1963)
* [CVE-2012-1967](/security/CVE-2012-1967)
* <https://launchpad.net/bugs/1020198>
* <https://launchpad.net/bugs/1024564>

## Related notices

* [USN-1509-1](/security/notices/USN-1509-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugzilla.mozilla.org_a8bab5dc_20250125_192918.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/766018)
* [XML](/show_bug.cgi?ctype=xml&id=766018)

Closed
[Bug 766018](/show_bug.cgi?id=766018)

Opened 13 years ago
Closed 13 years ago

# Use-after-free during GC on shutdown

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Use-after-free during GC on shutdown

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla16

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox16 | [+](/buglist.cgi?f1=cf_tracking_firefox16&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 | + | fixed |
| firefox15 | + | fixed |
| firefox16 | + | fixed |
| firefox-esr10 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: cjones, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/442a41cc04228fc929f063aa7d5b419d?d=mm&size=40)  [cjones](/user_profile?user_id=336288)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[755255](/show_bug.cgi?id=755255 "RESOLVED FIXED - Remove XPCPerThreadData")

Dependency [tree](/showdependencytree.cgi?id=766018&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=766018)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, csectype-uaf, sec-moderate, Whiteboard: [advisory-tracking+][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[advisory-tracking+][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1](/attachment.cgi?id=634350)  [13 years ago](#c2)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.31 KB, patch | peterv : [review+](#a202702_24295 "13 years ago")  lsblakk : [approval-mozilla-aurora+](#c12 "13 years ago")  lsblakk : [approval-mozilla-beta+](#c12 "13 years ago") | [Details](/attachment.cgi?id=634350&action=edit) | [Diff](/attachment.cgi?id=634350&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=766018&attachment=634350) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Chris Jones [:cjones] inactive; ni?/f?/r? if you need me](/user_profile?user_id=336288)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=766018#c0)• 13 years ago |
|  | |

STR
(1) Make b2g "desktop" build: <https://wiki.mozilla.org/Gaia/Hacking#Building_B2G>
(2) Start up b2g
(3) Shut it down
I crash during shutdown 100% of the time. valgrind tells me the problem is here
==24266== Invalid read of size 4
==24266== at 0x94970C2: nsBaseHashtable<nsDepCharHashKey, JSObject\*, JSObject\*>::IsInitialized() const (nsBaseHashtable.h:84)
==24266== by 0x949694B: XPCWrappedNativeScope::TraceDOMPrototypes(JSTracer\*) (XPCWrappedNativeScope.cpp:777)
==24266== by 0x9420F23: TraceXPCGlobal(JSTracer\*, JSObject\*) (nsXPConnect.cpp:1047)
==24266== by 0xA7B1F7F: js::GCMarker::processMarkStackTop(js::SliceBudget&) (Marking.cpp:1181)
==24266== by 0xA7B2162: js::GCMarker::drainMarkStack(js::SliceBudget&) (Marking.cpp:1225)
==24266== by 0xA5A4F00: MarkGrayAndWeak(JSRuntime\*) (jsgc.cpp:3130)
==24266== by 0xA5A4FEC: EndMarkPhase(JSRuntime\*) (jsgc.cpp:3146)
==24266== by 0xA5A6199: NonIncrementalMark(JSRuntime\*, js::JSGCInvocationKind) (jsgc.cpp:3435)
==24266== by 0xA5A7135: GCCycle(JSRuntime\*, bool, long, js::JSGCInvocationKind) (jsgc.cpp:3779)
==24266== by 0xA5A762D: Collect(JSRuntime\*, bool, long, js::JSGCInvocationKind, js::gcreason::Reason) (jsgc.cpp:3886)
==24266== by 0xA5A7771: js::GC(JSRuntime\*, js::JSGCInvocationKind, js::gcreason::Reason) (jsgc.cpp:3910)
==24266== by 0xA566EC6: js::DestroyContext(JSContext\*, js::DestroyContextMode) (jscntxt.cpp:316)
==24266== by 0xA521A44: JS\_DestroyContext (jsapi.cpp:1164)
==24266== by 0x941E696: nsXPConnect::~nsXPConnect() (nsXPConnect.cpp:114)
==24266== by 0x941E7AD: nsXPConnect::~nsXPConnect() (nsXPConnect.cpp:128)
==24266== by 0x941E1BF: nsXPConnect::Release() (in /home/cjones/mozilla/gaia-dbg/toolkit/library/libxul.so)
==24266== by 0x941EBA2: nsXPConnect::ReleaseXPConnectSingleton() (nsXPConnect.cpp:221)
==24266== by 0x94693A7: xpcModuleDtor() (XPCModule.cpp:25)
==24266== by 0x862735F: LayoutModuleDtor() (nsLayoutModule.cpp:1202)
==24266== by 0x9D777BC: nsComponentManagerImpl::KnownModule::~KnownModule() (nsComponentManager.h:175)
==24266== by 0x9D80576: nsAutoPtr<nsComponentManagerImpl::KnownModule>::~nsAutoPtr() (nsAutoPtr.h:71)
==24266== by 0x9D801C8: nsTArrayElementTraits<nsAutoPtr<nsComponentManagerImpl::KnownModule> >::Destruct(nsAutoPtr<nsComponentManagerImpl::KnownModule>\*) (nsTArray.h:348)
==24266== by 0x9D7F888: nsTArray<nsAutoPtr<nsComponentManagerImpl::KnownModule>, nsTArrayDefaultAllocator>::DestructRange(unsigned int, unsigned int) (nsTArray.h:1211)
==24266== by 0x9D7E89F: nsTArray<nsAutoPtr<nsComponentManagerImpl::KnownModule>, nsTArrayDefaultAllocator>::RemoveElementsAt(unsigned int, unsigned int) (nsTArray.h:931)
==24266== by 0x9D7D670: nsTArray<nsAutoPtr<nsComponentManagerImpl::KnownModule>, nsTArrayDefaultAllocator>::Clear() (nsTArray.h:942)
==24266== by 0x9D79CBD: nsComponentManagerImpl::Shutdown() (nsComponentManager.cpp:737)
==24266== by 0x9D24EDF: mozilla::ShutdownXPCOM(nsIServiceManager\*) (nsXPComInit.cpp:680)
==24266== by 0x9D2490F: NS\_ShutdownXPCOM\_P (nsXPComInit.cpp:542)
==24266== by 0x8331AF5: ScopedXPCOMStartup::~ScopedXPCOMStartup() (nsAppRunner.cpp:1103)
==24266== by 0x833B394: XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) (nsAppRunner.cpp:3875)
==24266== Address 0x26c842c4 is 132 bytes inside a block of size 168 free'd
==24266== at 0x4C2A403: free (vg\_replace\_malloc.c:427)
==24266== by 0x687DFA1: moz\_free (mozalloc.cpp:48)
==24266== by 0x949588B: XPCWrappedNativeScope::~XPCWrappedNativeScope() (mozalloc.h:224)
==24266== by 0x9496110: XPCWrappedNativeScope::KillDyingScopes() (XPCWrappedNativeScope.cpp:521)
==24266== by 0x9496328: XPCWrappedNativeScope::SystemIsBeingShutDown() (XPCWrappedNativeScope.cpp:604)
==24266== by 0x941E67A: nsXPConnect::~nsXPConnect() (nsXPConnect.cpp:111)
==24266== by 0x941E7AD: nsXPConnect::~nsXPConnect() (nsXPConnect.cpp:128)
==24266== by 0x941E1BF: nsXPConnect::Release() (in /home/cjones/mozilla/gaia-dbg/toolkit/library/libxul.so)
==24266== by 0x941EBA2: nsXPConnect::ReleaseXPConnectSingleton() (nsXPConnect.cpp:221)
==24266== by 0x94693A7: xpcModuleDtor() (XPCModule.cpp:25)
==24266== by 0x862735F: LayoutModuleDtor() (nsLayoutModule.cpp:1202)
==24266== by 0x9D777BC: nsComponentManagerImpl::KnownModule::~KnownModule() (nsComponentManager.h:175)
==24266== by 0x9D80576: nsAutoPtr<nsComponentManagerImpl::KnownModule>::~nsAutoPtr() (nsAutoPtr.h:71)
==24266== by 0x9D801C8: nsTArrayElementTraits<nsAutoPtr<nsComponentManagerImpl::KnownModule> >::Destruct(nsAutoPtr<nsComponentManagerImpl::KnownModule>\*) (nsTArray.h:348)
==24266== by 0x9D7F888: nsTArray<nsAutoPtr<nsComponentManagerImpl::KnownModule>, nsTArrayDefaultAllocator>::DestructRange(unsigned int, unsigned int) (nsTArray.h:1211)
==24266== by 0x9D7E89F: nsTArray<nsAutoPtr<nsComponentManagerImpl::KnownModule>, nsTArrayDefaultAllocator>::RemoveElementsAt(unsigned int, unsigned int) (nsTArray.h:931)
==24266== by 0x9D7D670: nsTArray<nsAutoPtr<nsComponentManagerImpl::KnownModule>, nsTArrayDefaultAllocator>::Clear() (nsTArray.h:942)
==24266== by 0x9D79CBD: nsComponentManagerImpl::Shutdown() (nsComponentManager.cpp:737)
==24266== by 0x9D24EDF: mozilla::ShutdownXPCOM(nsIServiceManager\*) (nsXPComInit.cpp:680)
==24266== by 0x9D2490F: NS\_ShutdownXPCOM\_P (nsXPComInit.cpp:542)
==24266== by 0x8331AF5: ScopedXPCOMStartup::~ScopedXPCOMStartup() (nsAppRunner.cpp:1103)
==24266== by 0x833B394: XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) (nsAppRunner.cpp:3875)
==24266== by 0x833B568: XRE\_main (nsAppRunner.cpp:3929)
==24266== by 0x401EDD: do\_main(int, char\*\*) (nsBrowserApp.cpp:153)
==24266== by 0x402133: main (nsBrowserApp.cpp:236)
==24266==
Marking ss because I have no idea what the extent of the underlying issue is here. If I had to guess, I would be it's some XPCOM thing staying alive too long in b2g, but I dunno.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=766018#c1)• 13 years ago |
|  | |

Ahah! I ran into this over in [bug 755255](/show_bug.cgi?id=755255 "RESOLVED FIXED - Remove XPCPerThreadData"), but misdiagnosed it. Patch coming right up.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=766018#c2)• 13 years ago |
|  | |

Attached patch

[Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1](attachment.cgi?id=634350&action=diff)
— [Details](attachment.cgi?id=634350&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=766018&attachment=634350)

[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: review?(peterv)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a36191_313730)• 13 years ago |

Blocks: [755255](/show_bug.cgi?id=755255 "RESOLVED FIXED - Remove XPCPerThreadData")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=766018#c3)• 13 years ago |
|  | |

The feasibility of exploiting this seems low, the attackers script would have to reallocate and prep that chunk of memory after it was freed earlier in shutdown and before it's referenced. If they could, though, it would be remote code execution.Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a202702_24295)• 13 years ago |

[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: review?(peterv) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=766018#c4)• 13 years ago |
|  | |

Pushed to m-i: <http://hg.mozilla.org/integration/mozilla-inbound/rev/da7795985d8f>Assignee: nobody → bobbyholley+bmo

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=766018#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/da7795985d8f>Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla16

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=766018#c6)• 13 years ago |
|  | |

Is this fix needed on previous releases (aurora/beta/esr)?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=766018#c7)• 13 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #6](/show_bug.cgi?id=766018#c6 "RESOLVED FIXED - Use-after-free during GC on shutdown"))
> Is this fix needed on previous releases (aurora/beta/esr)?
Eh. It theoretically affects them, but it's not clear to me that it's ever possible to trigger this hazard on those branches. If it was, we'd have seen crashes.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=766018#c8)• 13 years ago |
|  | |

Bobby - you mentioned in [bug 759402](/show_bug.cgi?id=759402 "RESOLVED FIXED - crash in TraceXPCGlobal") that it may be fixed by this bug. What's the risk profile here?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=766018#c9)• 13 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #7](/show_bug.cgi?id=766018#c7 "RESOLVED FIXED - Use-after-free during GC on shutdown"))
> it's not clear to me that it's ever
> possible to trigger this hazard on those branches. If it was, we'd have seen
> crashes.
(In reply to Alex Keybl [:akeybl] from [comment #8](/show_bug.cgi?id=766018#c8 "RESOLVED FIXED - Use-after-free during GC on shutdown"))
> Bobby - you mentioned in [bug 759402](/show_bug.cgi?id=759402 "RESOLVED FIXED - crash in TraceXPCGlobal") that it may be fixed by this bug. What's
> the risk profile here?
Oh right - I stand corrected. In that case we should probably take this anywhere we want to fix that crash. It's a low-risk fix IMO.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=766018#c10)• 13 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #9](/show_bug.cgi?id=766018#c9 "RESOLVED FIXED - Use-after-free during GC on shutdown"))
> (In reply to Alex Keybl [:akeybl] from [comment #8](/show_bug.cgi?id=766018#c8 "RESOLVED FIXED - Use-after-free during GC on shutdown"))
> > Bobby - you mentioned in [bug 759402](/show_bug.cgi?id=759402 "RESOLVED FIXED - crash in TraceXPCGlobal") that it may be fixed by this bug. What's
> > the risk profile here?
>
> Oh right - I stand corrected. In that case we should probably take this
> anywhere we want to fix that crash. It's a low-risk fix IMO.
Yep - let's get this into Aurora 15 and Beta 14 in that case. Can you nominate/land tomorrow before EOD?
[tracking-firefox15](/buglist.cgi?f1=cf_tracking_firefox15&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B)
[tracking-firefox16](/buglist.cgi?f1=cf_tracking_firefox16&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox16&o1=equals&v1=%2B)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=766018#c11)• 13 years ago |
|  | |

Comment on [attachment 634350](/attachment.cgi?id=634350 "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") [[details]](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") [[diff]](/attachment.cgi?id=634350&action=diff "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=766018&attachment=634350)
Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1
Nominating per [comment 10](/show_bug.cgi?id=766018#c10 "RESOLVED FIXED - Use-after-free during GC on shutdown"). Low-risk crash fix.
[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: approval-mozilla-beta?
[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: approval-mozilla-aurora?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=766018#c12)• 13 years ago |
|  | |

Comment on [attachment 634350](/attachment.cgi?id=634350 "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") [[details]](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") [[diff]](/attachment.cgi?id=634350&action=diff "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=766018&attachment=634350)
Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1
approving - please land immediately to aurora/beta branches as we need the builds to complete before giving today's go to build for beta.
[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: approval-mozilla-beta?
[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: approval-mozilla-beta+
[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: approval-mozilla-aurora?
[Attachment #634350](/attachment.cgi?id=634350&action=edit "Null out the XPCWrappedNativeScope slot when scopes are deleted on shutdown. v1") -
Flags: approval-mozilla-aurora+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a1271668_1689)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=766018#c13)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/84241548fe12>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/a52296e14e00>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a1273489_406194)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=766018#c14)• 13 years ago |
|  | |

Thanks Andrew!

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=766018#c15)• 13 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #7](/show_bug.cgi?id=766018#c7 "RESOLVED FIXED - Use-after-free during GC on shutdown"))
> Eh. It theoretically affects them, but it's not clear to me that it's ever
> possible to trigger this hazard on those branches. If it was, we'd have seen
> crashes.
Given that, marking as wontfix.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a1865635_280903)• 13 years ago |

Whiteboard: [advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a2754811_1689)• 13 years ago |

Group: core-security

|  | [Ioana (away)](/user_profile?user_id=422957) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a4877759_422957)• 12 years ago |

Whiteboard: [advisory-tracking+] → [advisory-tracking+][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766018#a154275066_1689)• 8 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)
You need to [log in](/show_bug.cgi?id=766018&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_80c773b1_20250125_192909.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/743876)
* [XML](/show_bug.cgi?ctype=xml&id=743876)

Closed
[Bug 743876](/show_bug.cgi?id=743876)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: (ptrBits & 0x7) == 0, at ../../jsval.h:763 or Crash [@ js::gc::Cell::compartment] or [@ js\_GetMethod]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: (ptrBits & 0x7) == 0, at ../../jsval.h:763 or Crash [@ js::gc::Cell::compartment] or [@ js\_GetMethod]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=unaffected) |
| firefox13 | [-](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | unaffected |
| firefox13 | - | wontfix |
| firefox14 | + | fixed |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: luke)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [luke](/user_profile?user_id=347312)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[740446](/show_bug.cgi?id=740446 "RESOLVED FIXED - fix overwritten-arguments handling in the front-end")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[720316](/show_bug.cgi?id=720316 "RESOLVED INVALID - Remove indexbase support")

Dependency [tree](/showdependencytree.cgi?id=743876&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=743876)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [advisory-tracking+] fixed by bug 740446)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[advisory-tracking+] fixed by bug 740446

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c14 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::gc::Cell::compartment ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Agc%3A%3ACell%3A%3Acompartment)

[[@ js\_GetMethod ]](https://crash-stats.mozilla.org/signature/?signature=js_GetMethod)

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=743876#c0)• 13 years ago |
|  | |

The following test asserts/crashes on mozilla-central revision 434f50e70815 (options -m -n -a):
var lfcode = new Array();
lfcode.push("3");
lfcode.push("\
evaluate(\"mjitChunkLimit(5)\");\
function slice(a, b) {\
return slice(index, ++(ArrayBuffer));\
}\
");
lfcode.push("0");
lfcode.push("var arr = [0, 1, 2, 3, 4];\
function replacer() {\
assertEq(arguments.length, 2);\
var key = arguments[0], value = arguments[1];\
return value;\
}\
assertEq(JSON.stringify(arr, replacer), '[0,1,2,3,4]');\
");
while (true) {
var file = lfcode.shift(); if (file == undefined) { break; }
loadFile(file);
}
function loadFile(lfVarx) {
if (!isNaN(lfVarx)) {
lfRunTypeId = parseInt(lfVarx);
} else {
switch (lfRunTypeId) {
case 0: evaluate(lfVarx); break;
case 3: function newFunc(x) { new Function(x)(); }; newFunc(lfVarx); break;
}
}
}
Crash Trace when stepping through assertion:
Program received signal SIGSEGV, Segmentation fault.
0x0000000000405350 in js::gc::Cell::compartment (this=0x7fff00000002) at ../../jsgc.h:984
984 return arenaHeader()->compartment;
(gdb) bt
#0 0x0000000000405350 in js::gc::Cell::compartment (this=0x7fff00000002) at ../../jsgc.h:984
#1 0x000000000042503f in js::CompartmentChecker::check (this=0x7fffffffa6c0, obj=0x7fff00000002) at ../jscntxtinlines.h:180
#2 0x00000000004250d6 in js::CompartmentChecker::check (this=0x7fffffffa6c0, v=...) at ../jscntxtinlines.h:190
#3 0x00000000004f5971 in js::CompartmentChecker::check (this=0x7fffffffa6c0, args=...) at ../jscntxtinlines.h:207
#4 0x0000000000510f90 in js::assertSameCompartment<js::CallArgs> (cx=0xb77a80, t1=...) at ../jscntxtinlines.h:254
#5 0x00000000004f59df in js::CallJSNative (cx=0xb77a80, native=0x409cca <AssertEq(JSContext\*, unsigned int, jsval\*)>, args=...) at ../jscntxtinlines.h:313
#6 0x0000000000739cd8 in js::mjit::CallCompiler::generateNativeStub (this=0x7fffffffb0a0) at /srv/repos/mozilla-central/js/src/methodjit/MonoIC.cpp:811
#7 0x000000000073abe7 in js::mjit::ic::NativeCall (f=..., ic=0xb8abb8) at /srv/repos/mozilla-central/js/src/methodjit/MonoIC.cpp:1041
#8 0x00007ffff7f4728a in ?? ()
#9 0x00007ffff7f46eb0 in ?? ()
#10 0x0000000000000000 in ?? ()
Opt Crash:
Program received signal SIGSEGV, Segmentation fault.
js\_GetMethod (cx=0x8de820, obj=0x7fff00000002, id=140737322830464, getHow=0, vp=0x7fffffffbac0) at /srv/repos/mozilla-central/js/src/jsobj.cpp:5144
5144 GenericIdOp op = obj->getOps()->getGeneric;
(gdb) bt
#0 js\_GetMethod (cx=0x8de820, obj=0x7fff00000002, id=140737322830464, getHow=0, vp=0x7fffffffbac0) at /srv/repos/mozilla-central/js/src/jsobj.cpp:5144
#1 0x00000000004d9757 in js\_ValueToSource (cx=0x8de820, v=...) at /srv/repos/mozilla-central/js/src/jsstr.cpp:3315
#2 0x0000000000412580 in JS\_ValueToSource (cx=<value optimized out>, v=...) at /srv/repos/mozilla-central/js/src/jsapi.cpp:533
#3 0x00000000004082ec in ToSource (cx=0x8de820, argc=2, vp=0x7ffff63fb2a0) at /srv/repos/mozilla-central/js/src/shell/js.cpp:1160
#4 AssertEq (cx=0x8de820, argc=2, vp=0x7ffff63fb2a0) at /srv/repos/mozilla-central/js/src/shell/js.cpp:1190
#5 0x00000000005db576 in CallJSNative (this=0x7fffffffc370) at ../jscntxtinlines.h:314
#6 js::mjit::CallCompiler::generateNativeStub (this=0x7fffffffc370) at /srv/repos/mozilla-central/js/src/methodjit/MonoIC.cpp:811
#7 0x00000000005dbe23 in js::mjit::ic::NativeCall (f=..., ic=0x8edcf8) at /srv/repos/mozilla-central/js/src/methodjit/MonoIC.cpp:1041
#8 0x00007ffff7f470f2 in ?? ()
#9 0x00007ffff7f46d50 in ?? ()
#10 0x0000000000000000 in ?? ()
S-s and sg:critical due to gc-related memory safety problem.

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=743876#c1)• 13 years ago |
|  | |

Setting affected 14 for now. Gary will grab a window.
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=743876#a244310_152868)• 13 years ago |

[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=743876#c2)• 13 years ago |
|  | |

This seems not to reproduce on 32-bit Mac, but I could reproduce on 64-bit Linux.
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 87695:f4e955f78de9
user: Jeff Walden
date: Fri Feb 03 18:53:29 2012 -0800
summary: [Bug 720316](/show_bug.cgi?id=720316 "RESOLVED INVALID - Remove indexbase support") - Use uint32\_t indexes for JOF\_ATOM opcodes. r=jorendorff
I think this means Firefox 13 is affected.Blocks: [720316](/show_bug.cgi?id=720316 "RESOLVED INVALID - Remove indexbase support")

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=743876#c3)• 13 years ago |
|  | |

I can't reproduce this on 64-bit Linux. :-(

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=743876#c4)• 13 years ago |
|  | |

I just rechecked and it seems like it got fixed by [bug 740446](/show_bug.cgi?id=740446 "RESOLVED FIXED - fix overwritten-arguments handling in the front-end") on mozilla-central tip.
autoBisect shows this is probably related to the following changeset:
The first good revision is:
changeset: 91358:fa24b215d49e
user: Luke Wagner
date: Mon Apr 02 08:58:30 2012 -0700
summary: [Bug 740446](/show_bug.cgi?id=740446 "RESOLVED FIXED - fix overwritten-arguments handling in the front-end") - make 'arguments' more like a normal local binding (r=bhackett)
[Bug 740446](/show_bug.cgi?id=740446 "RESOLVED FIXED - fix overwritten-arguments handling in the front-end") should be backported, but the patches there are very large (~150kb).
A spot-fix for this in Firefox 13 should be needed. Updating flags accordingly.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=unaffected)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=743876#c5)• 13 years ago |
|  | |

> A spot-fix for this in Firefox 13 should be needed. Updating flags
> accordingly.
Confirming to still fail on mozilla-aurora (13) changeset e158b91dd28a, but does not fail on mozilla-beta (12) changeset e6be81269d27.
Tested on Mac 64-bit js opt shells.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=743876#c6)• 13 years ago |
|  | |

I don't know that it makes sense to back-port the fix for [bug 740446](/show_bug.cgi?id=740446 "RESOLVED FIXED - fix overwritten-arguments handling in the front-end") to fix this bug. I guess we'd have another cycle to fix any regressions if it landed now in Aurora, but that seems riskier than simply waiting another six weeks for the problem to resolve itself. Trying to disentangle some small part of that bug's patch to fix this problem seems equally risky.
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)Depends on: [740446](/show_bug.cgi?id=740446 "RESOLVED FIXED - fix overwritten-arguments handling in the front-end")

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=743876#c7)• 13 years ago |
|  | |

[Triage Comment]
Setting to track for now, will check with Dan to determine if we want to take the risk when Aurora gets to Beta of detangling some of this.
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=743876#a849728_1689)• 13 years ago |

Assignee: general → luke

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=743876#c8)• 13 years ago |
|  | |

Fixed on trunk. This may not be worth fixing on Firefox 13
- esr10 branch unaffected, so we're not driven to create a spot-fix
to meet our enterprise committments
- may not be a reliable testcase
- known/tested patch is bigger than we'd want to back-port
- fixes itself by waiting another 6 weeks.Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=-)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Resolution: --- → FIXED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=743876#c9)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=743876#c10)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=743876#c11)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=743876#c12)• 13 years ago |
|  | |

Does anybody know if this bug has been automatically verified fixed or not?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=743876#c13)• 13 years ago |
|  | |

Seems like Bugzilla responded with an error while setting VERIFIED which caused the script to comment multiple times.Status: RESOLVED → VERIFIED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=743876#a7861982_280903)• 13 years ago |

Whiteboard: [sg:critical] js-triage-needed → [sg:critical][advisory-tracking+] js-triage-needed

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=743876#a7976336_1689)• 13 years ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)Whiteboard: [sg:critical][advisory-tracking+] js-triage-needed → [advisory-tracking+] fixed by bug 740446

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=743876#a8817044_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=743876#c14)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=743876&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_a7363030_20250125_192905.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/725499)
* [XML](/show_bug.cgi?ctype=xml&id=725499)

Closed
[Bug 725499](/show_bug.cgi?id=725499)

Opened 13 years ago
Closed 13 years ago

# WorkerFinishedRunnable should not be a control runnable.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WorkerFinishedRunnable should not be a control runnable.

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla15

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix) |
| firefox11 | [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox-esr10 | [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox10 |  | wontfix |
| firefox11 | - | wontfix |
| firefox12 | + | wontfix |
| firefox13 | + | wontfix |
| firefox14 | + | fixed |
| firefox15 | + | fixed |
| firefox-esr10 | - | wontfix |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: khuey, Assigned: khuey)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d8bebbee32670ee5755ce1bc535cd251?d=mm&size=40)  [khuey](/user_profile?user_id=336670)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d8bebbee32670ee5755ce1bc535cd251?d=mm&size=40)  [khuey](/user_profile?user_id=336670)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-critical, testcase, Whiteboard: [sg:critical][advisory-tracking+] Don't unhide or check in test until ESR-10 fixed or EOL)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][advisory-tracking+] Don't unhide or check in test until ESR-10 fixed or EOL

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [in-testsuite](#c20 "13 years ago") | ? |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Testcase](/attachment.cgi?id=612990)  [13 years ago](#c4)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   2.50 KB, patch |  | [Details](/attachment.cgi?id=612990&action=edit) | [Diff](/attachment.cgi?id=612990&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=612990) |
| --- | --- | --- |
| [Patch for trunk](/attachment.cgi?id=612993)  [13 years ago](#c5)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   3.39 KB, patch | bent.mozilla : [review+](#a6032064_200444 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c12 "13 years ago") | [Details](/attachment.cgi?id=612993&action=edit) | [Diff](/attachment.cgi?id=612993&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=612993) |
| [WIP for beta](/attachment.cgi?id=613019)  [13 years ago](#c6)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   5.57 KB, patch |  | [Details](/attachment.cgi?id=613019&action=edit) | [Diff](/attachment.cgi?id=613019&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=613019) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=725499#c0)• 13 years ago |
|  | |

Consider the following scenario:
A parent worker creates a child worker. The child worker sends two messages to its parent and then closes itself. If the parent is running the first message event handler when the delete runnable is posted to the parent thread, the parent will enter the OperationCallback and run the delete runnable. Then when the event handler returns and we proceed to the second message we will have a WorkerPrivate\* that has been deleted.
Ben believes the fix is to make the WorkerFinishRunnable not be a control runnable.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=725499#c1)• 13 years ago |
|  | |

Jesse, Christian: Is this anything you could play with through the js fuzzer?Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a1289609_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=wontfix)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a1888031_336670)• 13 years ago |

Assignee: bent.mozilla → khuey

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a2500501_152868)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=wontfix)

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a3100357_152868)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=725499#c2)• 13 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #1](/show_bug.cgi?id=725499#c1 "RESOLVED FIXED - WorkerFinishedRunnable should not be a control runnable."))
> Jesse, Christian: Is this anything you could play with through the js fuzzer?
We cannot specifically test this behavior in the JS shell (there are workers there but they seem to be too different from the browser implementation). The only thing I see that I could do is run LangFuzz on the browser and have the driver execute some tests in Workers rather than adding them to the main page as <script> elements. I'm not sure though if this would have caught this bug though, or other worker specific bugs.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=725499#c3)• 13 years ago |
|  | |

Fuzzing workers is on my list. It's exactly this kind of closing/timing issue that makes it tricky to fuzz effectively, and especially tricky to fuzz as part of the existing fuzzers.
Seeing a testcase for this bug might help me ;)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=725499#c4)• 13 years ago |
|  | |

Attached patch

[Testcase](attachment.cgi?id=612990&action=diff)
— [Details](attachment.cgi?id=612990&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=612990)

The attached testcase will crash Beta debug/opt and Trunk debug.
Example crash report: <https://crash-stats.mozilla.com/report/index/cf6fdfb8-43c2-47dc-8a6d-7d44a2120406>

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a5002776_336670)• 13 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---) → [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=725499#c5)• 13 years ago |
|  | |

Attached patch

[Patch for trunk](attachment.cgi?id=612993&action=diff)
— [Details](attachment.cgi?id=612993&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=612993)

Trunk has reference counted WorkerPrivates, so this is easy to fix there.
[Attachment #612993](/attachment.cgi?id=612993&action=edit "Patch for trunk") -
Flags: review?(bent.mozilla)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=725499#c6)• 13 years ago |
|  | |

Attached patch

[WIP for beta](attachment.cgi?id=613019&action=diff)
— [Details](attachment.cgi?id=613019&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=613019)

Attempting to port this to beta but it crashes in the finalizer for some reason I don't understand.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a6032064_200444)• 13 years ago |

[Attachment #612993](/attachment.cgi?id=612993&action=edit "Patch for trunk") -
Flags: review?(bent.mozilla) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a6729854_1689)• 13 years ago |

[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B)
[tracking-firefox15](/buglist.cgi?f1=cf_tracking_firefox15&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B)

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=725499#c7)• 13 years ago |
|  | |

Is there a reason the trunk patch couldn't land right now? It should also apply to Aurora at this point which might be as far back as we're comfortable backporting anyway.

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a7317046_406847)• 13 years ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=725499#c8)• 13 years ago |
|  | |

Yeah, there's no easy way to fix this short of refcounting, and I'm not 100% convinced it's exploitable, so Aurora might be far enough.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=725499#c9)• 13 years ago |
|  | |

Landing-ping?

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=725499#c10)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/498d2784a240>Status: ASSIGNED → RESOLVEDClosed: 13 years ago
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla15

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=725499#c11)• 13 years ago |
|  | |

Comment on [attachment 612993](/attachment.cgi?id=612993 "Patch for trunk") [[details]](/attachment.cgi?id=612993&action=edit "Patch for trunk") [[diff]](/attachment.cgi?id=612993&action=diff "Patch for trunk") [[review]](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=612993)
Patch for trunk
[Approval Request Comment]
Regression caused by (bug #): Existed forever
User impact if declined: Possibly exploitable crashes
Testing completed (on m-c, etc.): Landed on m-c
Risk to taking this patch (and alternatives if risky): Low risk
String changes made by this patch: N/A
[Attachment #612993](/attachment.cgi?id=612993&action=edit "Patch for trunk") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=725499#c12)• 13 years ago |
|  | |

Comment on [attachment 612993](/attachment.cgi?id=612993 "Patch for trunk") [[details]](/attachment.cgi?id=612993&action=edit "Patch for trunk") [[diff]](/attachment.cgi?id=612993&action=diff "Patch for trunk") [[review]](/page.cgi?id=splinter.html&ignore=&bug=725499&attachment=612993)
Patch for trunk
[Triage Comment]
Low-risk sg:crit fix, approved for Aurora 14. If we're thinking about landing this for FF13 as well, please nominate for approval ahead of tomorrow's (5/15) go-to-build.
[Attachment #612993](/attachment.cgi?id=612993&action=edit "Patch for trunk") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=725499#c13)• 13 years ago |
|  | |

Are we really tracking this for ESR 13+ or should it be 14+?

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=725499#c14)• 13 years ago |
|  | |

Lets let this ride to 14.
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix)

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=725499#c15)• 13 years ago |
|  | |

This still needs to land for 14 though, right?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a9594566_425645)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[13+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=13%2B) → [14+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=14%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=725499#c16)• 13 years ago |
|  | |

(In reply to Jonas Sicking (:sicking) from [comment #15](/show_bug.cgi?id=725499#c15 "RESOLVED FIXED - WorkerFinishedRunnable should not be a control runnable."))
> This still needs to land for 14 though, right?
Yes.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=725499#c17)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/c53704c5e1e7>
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=725499#c18)• 13 years ago |
|  | |

So, there's a bit of a problem here for ESR. A fix on ESR would be radically different (because in ESR these objects aren't reference counted, they're allocated with new and delete) and much more invasive.
Given that this was discovered internally, the crashes we did see weren't super scary (access violations on read, as opposed to write or execute), and the difficulty of backporting, I'd like to wontfix this for ESR.
Thoughts?

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=725499#c19)• 13 years ago |
|  | |

Are we sure that this can only cause out-of-bounds reads? Rather than that that's the only thing we've seen testcases for so far.
Leaving up to security team to decide of how important out-of-bounds reads are for ESR.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=725499#c20)• 13 years ago |
|  | |

Out of bounds reads of a dead object with virtual methods (at the very least the EventTarget destructor) and pointers to objects with virtual methods (various nsI\* things) could very well be exploitable.
How reliably? Dunno, but I don't want to tempt fate by publishing the testcase if we don't fix it.Flags: in-testsuite?Whiteboard: [sg:critical] → [sg:critical] Don't unhide or check in test until ESR-10 fixed or EOL

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=725499#c21)• 13 years ago |
|  | |

Are we going to fix this for ESR or should we hide this forever?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a13202620_280903)• 13 years ago |

Whiteboard: [sg:critical] Don't unhide or check in test until ESR-10 fixed or EOL → [sg:critical][advisory-tracking+] Don't unhide or check in test until ESR-10 fixed or EOL

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=725499#c22)• 13 years ago |
|  | |

There is no safe way to get this into 10.0.6 at this point. Without answering [comment 21](/show_bug.cgi?id=725499#c21 "RESOLVED FIXED - WorkerFinishedRunnable should not be a control runnable.") definitively I can still say "14+" is a lie. Flipped back to nomination.
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[14+](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=14%2B) → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=725499#c23)• 13 years ago |
|  | |

Removing tracking for advisory. No advisory for this until fixed in ESR.Whiteboard: [sg:critical][advisory-tracking+] Don't unhide or check in test until ESR-10 fixed or EOL → [sg:critical] Don't unhide or check in test until ESR-10 fixed or EOL

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=725499#c24)• 13 years ago |
|  | |

After discussion in triage (including dveditz and abillings), as per [https://wiki.mozilla.org/Enterprise/Firefox/ExtendedSupport:Proposal](https://wiki.mozilla.org/Enterprise/Firefox/ExtendedSupport%3AProposal) "there may be cases where a backport cannot be applied with reasonable effort, and those cases are expected to be exceptional". We consider this to be such a case and will wontfix this for ESR10.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a13470786_280903)• 13 years ago |

Whiteboard: [sg:critical] Don't unhide or check in test until ESR-10 fixed or EOL → [sg:critical][advisory-tracking+] Don't unhide or check in test until ESR-10 fixed or EOL

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a13996463_272375)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a55109421_1689)• 11 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=725499#a223741442_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=725499&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_7d2bb21a_20250125_192840.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/#WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV)

# [security-announce] SUSE-SU-2012:0896-1: important: Security update for Mozilla Firefox

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

20 Jul
2012

20 Jul
'12

19:08

SUSE Security Update: Security update for Mozilla Firefox
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2012:0896-1
Rating: important
References: #771583
Cross-References: CVE-2012-1948 CVE-2012-1949 CVE-2012-1950
CVE-2012-1951 CVE-2012-1952 CVE-2012-1953
CVE-2012-1954 CVE-2012-1955 CVE-2012-1957
CVE-2012-1958 CVE-2012-1959 CVE-2012-1961
CVE-2012-1962 CVE-2012-1963 CVE-2012-1964
CVE-2012-1965 CVE-2012-1966 CVE-2012-1967
Affected Products:
SUSE Linux Enterprise Server 11 SP2
SUSE Linux Enterprise Server 11 SP1 for VMware
SUSE Linux Enterprise Server 11 SP1
SUSE Linux Enterprise Desktop 11 SP2
SUSE Linux Enterprise Desktop 11 SP1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 18 vulnerabilities is now available.
It includes two new package versions.
Description:
MozillaFirefox has been updated to the 10.0.6ESR security
release fixing various bugs and several security issues,
some critical.
The following security issues have been fixed:
\*
MFSA 2012-42: Mozilla developers identified and fixed
several memory safety bugs in the browser engine used in
Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain
circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary
code.
\*
CVE-2012-1948: Benoit Jacob, Jesse Ruderman,
Christian Holler, and Bill McCloskey reported memory safety
problems and crashes that affect Firefox ESR 10 and Firefox
13.
\*
MFSA 2012-43 / CVE-2012-1950: Security researcher
Mario Gomes andresearch firm Code Audit Labs reported a
mechanism to short-circuit page loads through drag and drop
to the addressbar by canceling the page load. This causes
the address of the previously site entered to be displayed
in the addressbar instead of the currently loaded page.
This could lead to potential phishing attacks on users.
\*
MFSA 2012-44 Google security researcher Abhishek Arya
used the Address Sanitizer tool to uncover four issues: two
use-after-free problems, one out of bounds read bug, and a
bad cast. The first use-afte.r-free problem is caused when
an array of nsSMILTimeValueSpec objects is destroyed but
attempts are made to call into objects in this array later.
The second use-after-free problem is in
nsDocument::AdoptNode when it adopts into an empty document
and then adopts into another document, emptying the first
one. The heap buffer overflow is in ElementAnimations when
data is read off of end of an array and then pointers are
dereferenced. The bad cast happens when
nsTableFrame::InsertFrames is called with frames in
aFrameList that are a mix of row group frames and column
group frames. AppendFrames is not able to handle this mix.
All four of these issues are potentially exploitable.
o CVE-2012-1951: Heap-use-after-free in
nsSMILTimeValueSpec::IsEventBased o CVE-2012-1954:
Heap-use-after-free in nsDocument::AdoptNode o
CVE-2012-1953: Out of bounds read in
ElementAnimations::EnsureStyleRuleFor o CVE-2012-1952: Bad
cast in nsTableFrame::InsertFrames
\*
MFSA 2012-45 / CVE-2012-1955: Security researcher
Mariusz Mlynski reported an issue with spoofing of the
location property. In this issue, calls to history.forward
and history.back are used to navigate to a site while
displaying the previous site in the addressbar but changing
the baseURI to the newer site. This can be used for
phishing by allowing the user input form or other data on
the newer, attacking, site while appearing to be on the
older, displayed site.
\*
MFSA 2012-46 / CVE-2012-1966: Mozilla security
researcher moz\_bug\_r\_a4 reported a cross-site scripting
(XSS) attack through the context menu using a data: URL. In
this issue, context menu functionality ("View Image", "Show
only this frame", and "View background image") are
disallowed in a javascript: URL but allowed in a data: URL,
allowing for XSS. This can lead to arbitrary code execution.
\*
MFSA 2012-47 / CVE-2012-1957: Security researcher
Mario Heiderich reported that javascript could be executed
in the HTML feed-view using tag within the RSS . This
problem is due to tags not being filtered out during
parsing and can lead to a potential cross-site scripting
(XSS) attack. The flaw existed in a parser utility class
and could affect other parts of the browser or add-ons
which rely on that class to sanitize untrusted input.
\*
MFSA 2012-48 / CVE-2012-1958: Security researcher
Arthur Gerkis used the Address Sanitizer tool to find a
use-after-free in nsGlobalWindow::PageHidden when
mFocusedContent is released and oldFocusedContent is used
afterwards. This use-after-free could possibly allow for
remote code execution.
\*
MFSA 2012-49 / CVE-2012-1959: Mozilla developer Bobby
Holley found that same-compartment security wrappers (SCSW)
can be bypassed by passing them to another compartment.
Cross-compartment wrappers often do not go through SCSW,
but have a filtering policy built into them. When an object
is wrapped cross-compartment, the SCSW is stripped off and,
when the object is read read back, it is not known that
SCSW was previously present, resulting in a bypassing of
SCSW. This could result in untrusted content having access
to the XBL that implements browser functionality.
\*
MFSA 2012-50 / CVE-2012-1960: Google developer Tony
Payne reported an out of bounds (OOB) read in QCMS,
Mozilla's color management library. With a carefully
crafted color profile portions of a user's memory could be
incorporated into a transformed image and possibly
deciphered.
\*
MFSA 2012-51 / CVE-2012-1961: Bugzilla developer
Frederic Buclin reported that the "X-Frame-Options header
is ignored when the value is duplicated, for example
X-Frame-Options: SAMEORIGIN, SAMEORIGIN. This duplication
occurs for unknown reasons on some websites and when it
occurs results in Mozilla browsers not being protected
against possible clickjacking attacks on those pages.
\*
MFSA 2012-52 / CVE-2012-1962: Security researcher
Bill Keese reported a memory corruption. This is caused by
JSDependentString::undepend changing a dependent string
into a fixed string when there are additional dependent
strings relying on the same base. When the undepend occurs
during conversion, the base data is freed, leaving other
dependent strings with dangling pointers. This can lead to
a potentially exploitable crash.
\*
MFSA 2012-53 / CVE-2012-1963: Security researcher
Karthikeyan Bhargavan of Prosecco at INRIA reported Content
Security Policy (CSP) 1.0 implementation errors. CSP
violation reports generated by Firefox and sent to the
"report-uri" location include sensitive data within the
"blocked-uri" parameter. These include fragment components
and query strings even if the "blocked-uri" parameter has a
different origin than the protected resource. This can be
used to retrieve a user's OAuth 2.0 access tokens and
OpenID credentials by malicious sites.
\*
MFSA 2012-54 / CVE-2012-1964: Security Researcher
Matt McCutchen reported that a clickjacking attack using
the certificate warning page. A man-in-the-middle (MITM)
attacker can use an iframe to display its own certificate
error warning page (about:certerror) with the "Add
Exception" button of a real warning page from a malicious
site. This can mislead users to adding a certificate
exception for a different site than the perceived one. This
can lead to compromised communications with the user
perceived site through the MITM attack once the certificate
exception has been added.
\*
MFSA 2012-55 / CVE-2012-1965: Security researchers
Mario Gomes and Soroush Dalili reported that since Mozilla
allows the pseudo-protocol feed: to prefix any valid URL,
it is possible to construct feed:javascript: URLs that will
execute scripts in some contexts. On some sites it may be
possible to use this to evade output filtering that would
otherwise strip javascript: URLs and thus contribute to
cross-site scripting (XSS) problems on these sites.
\*
MFSA 2012-56 / CVE-2012-1967: Mozilla security
researcher moz\_bug\_r\_a4 reported a arbitrary code execution
attack using a javascript: URL. The Gecko engine features a
JavaScript sandbox utility that allows the browser or
add-ons to safely execute script in the context of a web
page. In certain cases, javascript: URLs are executed in
such a sandbox with insufficient context that can allow
those scripts to escape from the sandbox and run with
elevated privilege. This can lead to arbitrary code
execution.
Security Issue references:
\* CVE-2012-1967
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1967>

...

\* CVE-2012-1948
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1948>

...

\* CVE-2012-1949
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1949>

...

\* CVE-2012-1951
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1951>

...

\* CVE-2012-1952
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1952>

...

\* CVE-2012-1953
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1953>

...

\* CVE-2012-1954
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1954>

...

\* CVE-2012-1966
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1966>

...

\* CVE-2012-1958
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1958>

...

\* CVE-2012-1959
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1959>

...

\* CVE-2012-1962
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1962>

...

\* CVE-2012-1950
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1950>

...

\* CVE-2012-1955
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1955>

...

\* CVE-2012-1957
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1957>

...

\* CVE-2012-1961
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1961>

...

\* CVE-2012-1963
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1963>

...

\* CVE-2012-1964
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1964>

...

\* CVE-2012-1965
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1965>

...

Patch Instructions:
To install this SUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- SUSE Linux Enterprise Server 11 SP2:
zypper in -t patch slessp1-firefox-201207-6574
- SUSE Linux Enterprise Server 11 SP1 for VMware:
zypper in -t patch slessp1-firefox-201207-6574
- SUSE Linux Enterprise Server 11 SP1:
zypper in -t patch slessp1-firefox-201207-6574
- SUSE Linux Enterprise Desktop 11 SP2:
zypper in -t patch sledsp1-firefox-201207-6574
- SUSE Linux Enterprise Desktop 11 SP1:
zypper in -t patch sledsp1-firefox-201207-6574
To bring your system up-to-date, use "zypper patch".
Package List:
- SUSE Linux Enterprise Server 11 SP2 (i586 ia64 ppc64 s390x x86\_64) [New Version: 10.0.6 and 7]:
MozillaFirefox-10.0.6-0.4.1
MozillaFirefox-branding-SLED-7-0.6.7.70
MozillaFirefox-translations-10.0.6-0.4.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (i586 x86\_64) [New Version: 10.0.6]:
MozillaFirefox-10.0.6-0.4.1
MozillaFirefox-translations-10.0.6-0.4.1
- SUSE Linux Enterprise Server 11 SP1 (i586 ia64 ppc64 s390x x86\_64) [New Version: 10.0.6 and 7]:
MozillaFirefox-10.0.6-0.4.1
MozillaFirefox-branding-SLED-7-0.6.7.70
MozillaFirefox-translations-10.0.6-0.4.1
- SUSE Linux Enterprise Desktop 11 SP2 (i586 x86\_64) [New Version: 10.0.6 and 7]:
MozillaFirefox-10.0.6-0.4.1
MozillaFirefox-branding-SLED-7-0.6.7.70
MozillaFirefox-translations-10.0.6-0.4.1
- SUSE Linux Enterprise Desktop 11 SP1 (i586 x86\_64) [New Version: 10.0.6 and 7]:
MozillaFirefox-10.0.6-0.4.1
MozillaFirefox-branding-SLED-7-0.6.7.70
MozillaFirefox-translations-10.0.6-0.4.1
References:
<http://support.novell.com/security/cve/CVE-2012-1948.html>
<http://support.novell.com/security/cve/CVE-2012-1949.html>
<http://support.novell.com/security/cve/CVE-2012-1950.html>
<http://support.novell.com/security/cve/CVE-2012-1951.html>
<http://support.novell.com/security/cve/CVE-2012-1952.html>
<http://support.novell.com/security/cve/CVE-2012-1953.html>
<http://support.novell.com/security/cve/CVE-2012-1954.html>
<http://support.novell.com/security/cve/CVE-2012-1955.html>
<http://support.novell.com/security/cve/CVE-2012-1957.html>
<http://support.novell.com/security/cve/CVE-2012-1958.html>
<http://support.novell.com/security/cve/CVE-2012-1959.html>
<http://support.novell.com/security/cve/CVE-2012-1961.html>
<http://support.novell.com/security/cve/CVE-2012-1962.html>
<http://support.novell.com/security/cve/CVE-2012-1963.html>
<http://support.novell.com/security/cve/CVE-2012-1964.html>
<http://support.novell.com/security/cve/CVE-2012-1965.html>
<http://support.novell.com/security/cve/CVE-2012-1966.html>
<http://support.novell.com/security/cve/CVE-2012-1967.html>
<https://bugzilla.novell.com/771583>
[http://download.novell.com/patch/finder/?keywords=0b1471bd5af6e54566551a32a2...](http://download.novell.com/patch/finder/?keywords=0b1471bd5af6e54566551a32a23095d3)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV/#WKFKMCBMARKWIJ3DDEEJD47TIC3OBYXV)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from secunia.com_7bbe3160_20250125_192844.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.mozilla.org_4344f72a_20250125_192921.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/766304)
* [XML](/show_bug.cgi?ctype=xml&id=766304)

Closed
[Bug 766304](/show_bug.cgi?id=766304)

Opened 13 years ago
Closed 13 years ago

# ScopedGfxFeatureReporter uses preference service off the main thread

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ScopedGfxFeatureReporter uses preference service off the main thread

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

ARM

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla16

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |
| blocking-fennec1.0 | --- | [.N+](/buglist.cgi?f1=cf_blocking_fennec10&o1=equals&v1=.N%2B) |
| fennec | [14+](/buglist.cgi?f1=cf_blocking_fennec&o1=equals&v1=14%2B) | --- |

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 |  | fixed |
| firefox15 |  | fixed |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| blocking-fennec1.0 |  | .N+ |
| fennec | 14+ |  |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: blassey, Assigned: blassey)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/2e65c829d6f9d9ccf3e84753a00fb8aa?d=mm&size=40)  [blassey](/user_profile?user_id=181004)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/2e65c829d6f9d9ccf3e84753a00fb8aa?d=mm&size=40)  [blassey](/user_profile?user_id=181004)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[737413](/show_bug.cgi?id=737413 "RESOLVED DUPLICATE - gfxCrashReporterUtils.cpp is not thread safe")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [advisory-tracking+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[advisory-tracking+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=634585)  [13 years ago](#c0)  [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)   4.20 KB, patch | joe : [review+](#a4487_94 "13 years ago")  akeybl : [approval-mozilla-aurora+](#a81298_425645 "13 years ago")  akeybl : [approval-mozilla-beta+](#a81298_425645 "13 years ago") | [Details](/attachment.cgi?id=634585&action=edit) | [Diff](/attachment.cgi?id=634585&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=766304&attachment=634585) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=766304#c0)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=634585&action=diff)
— [Details](attachment.cgi?id=634585&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=766304&attachment=634585)

seeing this in the log:
I/Gecko ( 890): ###!!! ASSERTION: Using observer service off the main thread!: 'Error', file /home/blassey/src/mozilla-central/xpcom/ds/nsObserverService.cpp, line 95
not seeing it with this patch
[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: review?(joe)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a1273_382769)• 13 years ago |

Summary: ScopedGfxFeatureReporter accesses the preferences on the wrong thread → ScopedGfxFeatureReporter uses observer service off the main thread

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a4487_94)• 13 years ago |

[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: review?(joe) → review+

|  | [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=766304#c1)• 13 years ago |
|  | |

Comment on [attachment 634585](/attachment.cgi?id=634585 "patch") [[details]](/attachment.cgi?id=634585&action=edit "patch") [[diff]](/attachment.cgi?id=634585&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=766304&attachment=634585)
patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #):
User impact if declined:
Testing completed (on m-c, etc.):
Risk to taking this patch (and alternatives if risky):
String or UUID changes made by this patch:
[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=766304#c2)• 13 years ago |
|  | |

landed on inbound <https://hg.mozilla.org/integration/mozilla-inbound/rev/7bcd7c51ce46> and a follow up to fix windows <https://hg.mozilla.org/integration/mozilla-inbound/rev/77804de74060>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=766304#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/7bcd7c51ce46>
<https://hg.mozilla.org/mozilla-central/rev/77804de74060>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDTarget Milestone: --- → mozilla16

|  | [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a70895_181004)• 13 years ago |

Summary: ScopedGfxFeatureReporter uses observer service off the main thread → ScopedGfxFeatureReporter uses preference service off the main thread

|  | [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a81192_181004)• 13 years ago |

tracking-fennec: ? → 14+blocking-fennec1.0: ? → .N+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a81250_425645)• 13 years ago |

Group: core-security

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=766304#c4)• 13 years ago |
|  | |

jst believes this could be exploitable. Approving for Aurora 15 and Beta 14 (tip only, not the release branch).

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a81298_425645)• 13 years ago |

[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #634585](/attachment.cgi?id=634585&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a250048_1689)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=766304#c5)• 13 years ago |
|  | |

Sending over to you, Brad, since you requested the approval.Assignee: nobody → blassey.bugs

|  | [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=766304#c6)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/bc28779c3dab>
<https://hg.mozilla.org/releases/mozilla-beta/rev/a93c4915208a>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/3717bb23ff0f>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/ca8bf9e97234>
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a1804650_280903)• 13 years ago |

Whiteboard: [advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a1851955_1689)• 13 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=766304#a2693791_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=766304&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brad Lassey [:blassey] (use needinfo?)](/user_profile?user_id=181004)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.ubuntu.com_b3eb30fa_20250125_192853.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1509-2: ubufox update

18 July 2012

This update provides compatible ubufox packages for the latest Firefox.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)
* [Ubuntu 11.10](/security/notices?release=oneiric)
* [Ubuntu 11.04](/security/notices?release=natty)
* [Ubuntu 10.04](/security/notices?release=lucid)

## Packages

* [ubufox](/security/cves?package=ubufox) - Ubuntu Firefox specific configuration defaults and apt support

## Details

USN-1509-1 fixed vulnerabilities in Firefox. This update provides an updated

ubufox package for use with the lastest Firefox.

Original advisory details:

Benoit Jacob, Jesse Ruderman, Christian Holler, Bill McCloskey, Brian Smith,

Gary Kwong, Christoph Diehl, Chris Jones, Brad Lassey, and Kyle Huey discovered

memory safety issues affecting Firefox. If the user were tricked into opening a

specially crafted page, an attacker could possibly exploit these to cause a

denial of service via application crash, or potentially execute code with the

privileges of the user invoking Firefox. ([CVE-2012-1948](/security/CVE-2012-1948), [CVE-2012-1949](/security/CVE-2012-1949))

Mario Gomes discovered that the address bar may be incorrectly updated.

Drag-and-drop events in the address bar may cause the address of the previous

site to be displayed while a new page is loaded. An attacker could exploit this

to conduct phishing attacks. ([CVE-2012-1950](/security/CVE-2012-1950))

Abhishek Arya discovered four memory safety issues affecting Firefox. If the

user were tricked into opening a specially crafted page, an attacker could

possibly exploit these to cause a denial of service via application crash, or

potentially execute code with the privileges of the user invoking Firefox.

([CVE-2012-1951](/security/CVE-2012-1951), [CVE-2012-1952](/security/CVE-2012-1952), [CVE-2012-1953](/security/CVE-2012-1953), [CVE-2012-1954](/security/CVE-2012-1954))

Mariusz Mlynski discovered that the address bar may be incorrectly updated.

Calls to history.forward and history.back could be used to navigate to a site

while the address bar still displayed the previous site. A remote attacker

could exploit this to conduct phishing attacks. ([CVE-2012-1955](/security/CVE-2012-1955))

Mario Heiderich discovered that HTML  tags were not filtered out of the

HTML  of RSS feeds. A remote attacker could exploit this to

conduct cross-site scripting (XSS) attacks via javascript execution in the HTML

feed view. ([CVE-2012-1957](/security/CVE-2012-1957))

Arthur Gerkis discovered a use-after-free vulnerability. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit this to cause a denial of service via application crash, or potentially

execute code with the privileges of the user invoking Firefox. ([CVE-2012-1958](/security/CVE-2012-1958))

Bobby Holley discovered that same-compartment security wrappers (SCSW) could be

bypassed to allow XBL access. If the user were tricked into opening a specially

crafted page, an attacker could possibly exploit this to execute code with the

privileges of the user invoking Firefox. ([CVE-2012-1959](/security/CVE-2012-1959))

Tony Payne discovered an out-of-bounds memory read in Mozilla's color

management library (QCMS). If the user were tricked into opening a specially

crafted color profile, an attacker could possibly exploit this to cause a

denial of service via application crash. ([CVE-2012-1960](/security/CVE-2012-1960))

Frédéric Buclin discovered that the X-Frame-Options header was ignored when its

value was specified multiple times. An attacker could exploit this to conduct

clickjacking attacks. ([CVE-2012-1961](/security/CVE-2012-1961))

Bill Keese discovered a memory corruption vulnerability. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit this to cause a denial of service via application crash, or potentially

execute code with the privileges of the user invoking Firefox. ([CVE-2012-1962](/security/CVE-2012-1962))

Karthikeyan Bhargavan discovered an information leakage vulnerability in the

Content Security Policy (CSP) 1.0 implementation. If the user were tricked into

opening a specially crafted page, an attacker could possibly exploit this to

access a user's OAuth 2.0 access tokens and OpenID credentials. ([CVE-2012-1963](/security/CVE-2012-1963))

Matt McCutchen discovered a clickjacking vulnerability in the certificate

warning page. A remote attacker could trick a user into accepting a malicious

certificate via a crafted certificate warning page. ([CVE-2012-1964](/security/CVE-2012-1964))

Mario Gomes and Soroush Dalili discovered that javascript was not filtered out

of feed URLs. If the user were tricked into opening a specially crafted URL, an

attacker could possibly exploit this to conduct cross-site scripting (XSS)

attacks. ([CVE-2012-1965](/security/CVE-2012-1965))

A vulnerability was discovered in the context menu of data: URLs. If the user

were tricked into opening a specially crafted URL, an attacker could possibly

exploit this to conduct cross-site scripting (XSS) attacks. ([CVE-2012-1966](/security/CVE-2012-1966))

It was discovered that the execution of javascript: URLs was not properly

handled in some cases. A remote attacker could exploit this to execute code

with the privileges of the user invoking Firefox. ([CVE-2012-1967](/security/CVE-2012-1967))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.12.04.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.12.04.1)
* [xul-ext-ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.12.04.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.12.04.1)

##### Ubuntu 11.10

* [ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.11.10.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.11.10.1)
* [xul-ext-ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.11.10.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.11.10.1)

##### Ubuntu 11.04

* [ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.11.04.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.11.04.1)
* [xul-ext-ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.11.04.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.11.04.1)

##### Ubuntu 10.04

* [ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.10.04.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.10.04.1)
* [xul-ext-ubufox](https://launchpad.net/ubuntu/%2Bsource/ubufox)
  -
  [2.1.1-0ubuntu0.10.04.1](https://launchpad.net/ubuntu/%2Bsource/ubufox/2.1.1-0ubuntu0.10.04.1)

When upgrading, users should be aware of the following:

* In Ubuntu 11.04, unity-2d users may lose the ability to view drop-down menus,

  context menus, and perform drag-and-drop operations in Firefox. This is a known

  issue being tracked in <https://launchpad.net/bugs/1020198> and may be fixed in a

  later update.

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* <https://launchpad.net/bugs/1024562>

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugzilla.mozilla.org_5ae88e90_20250125_192907.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/738841)
* [XML](/show_bug.cgi?ctype=xml&id=738841)

Closed
[Bug 738841](/show_bug.cgi?id=738841)

Opened 13 years ago
Closed 13 years ago

# "Assertion failure: allocated()," with TypeInference disabled

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"Assertion failure: allocated()," with TypeInference disabled

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla14

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=unaffected) |
| firefox13 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix) |
| firefox14 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox-esr10 | [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox12 |  | unaffected |
| firefox13 |  | wontfix |
| firefox14 |  | fixed |
| firefox-esr10 | - | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: billm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[723313](/show_bug.cgi?id=723313 "RESOLVED FIXED - Stop using conservative stack scanner for VM stack marking")

Dependency [tree](/showdependencytree.cgi?id=738841&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=738841)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[738846](/show_bug.cgi?id=738846 "RESOLVED DUPLICATE - \"Assertion failure: addr % Cell::CellSize == 0,\"")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, testcase, Whiteboard: [sg:moderate][advisory-tracking+] js-triage-needed)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate][advisory-tracking+] js-triage-needed

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c9 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=608898)  [13 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   7.97 KB, text/plain |  | [Details](/attachment.cgi?id=608898&action=edit) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=609528)  [13 years ago](#c4)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   3.69 KB, patch | bhackett1024 : [review+](#a261295_346231 "13 years ago") | [Details](/attachment.cgi?id=609528&action=edit) | [Diff](/attachment.cgi?id=609528&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=738841&attachment=609528) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=738841#c0)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=608898)
— [Details](attachment.cgi?id=608898&action=edit)

try {
for (let z = 0; z < 1; ++evalcx("[]", newGlobal("new-compartment"))) {}
} catch (e) {}
try {
for (y in [schedulegc(58)]) {
b
}
} catch (e) {}
try {
e
} catch (e) {}
try {
(function() {
h
}())
} catch (e) {}
try {
(function() {
this.m.f = function() {}
}())
} catch (e) {}
try {
t()
} catch (e) {}
try {
p
} catch (e) {}
try {
gc()
p
} catch (e) {}
try {
(function() {
for (var v of m) {}
}())
} catch (e) {}
try {
m
} catch (e) {}
try {
(function() {
{
print(new function(q)("", s))
let u
}
}())
} catch (e) {}
asserts 64-bit js debug shell on m-c changeset 6470fe2fc4de with -m and -a at Assertion failure: allocated(),
Setting s-s because gc is on the stack.
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 87736:fbef6a165cf8
user: Bill McCloskey
date: Fri Feb 10 18:32:08 2012 -0800
summary: [Bug 723313](/show_bug.cgi?id=723313 "RESOLVED FIXED - Stop using conservative stack scanner for VM stack marking") - Stop using conservative stack scanner for VM stack marking (r=luke,bhackett)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=738841#c1)• 13 years ago |
|  | |

One needs to pass the testcase in as a CLI argument.
Related to [bug 738846](/show_bug.cgi?id=738846 "RESOLVED DUPLICATE - \"Assertion failure: addr % Cell::CellSize == 0,\"")?

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=738841#c2)• 13 years ago |
|  | |

This does appear to be the same issue as [bug 738846](/show_bug.cgi?id=738846 "RESOLVED DUPLICATE - \"Assertion failure: addr % Cell::CellSize == 0,\""). I'll dupe when I know for sure.
We crash on this line:
print(new function(q)("", s))
While we're in the middle of running JSOP\_NEW, we do a GC and crash. We crash while marking a stack slot which is supposed to contain undefined, but contains garbage. The problem seems to be that we're not syncing the stack slot in JSOP\_NEW. Here is the relevant code:
/\*
\* 'this' does not need to be synced for constructing. :FIXME: is it
\* possible that one of the arguments is directly copying the 'this'
\* entry (something like 'new x.f(x)')?
\*/
if (callingNew) {
frame.discardFe(origThis);
/\*
\* If inference is enabled, the 'this' value of the pushed frame always
\* needs to be coherent. If a GC gets triggered before the callee can
\* fill in the slot (i.e. the GC happens on constructing the 'new'
\* object or the call object for a heavyweight callee), it needs to be
\* able to read the 'this' value to tell whether newScript constraints
\* will need to be regenerated afterwards.
\*/
if (cx->typeInferenceEnabled())
masm.storeValue(NullValue(), frame.addressOf(origThis));
}
If I just comment out this entire block, the test case runs fine. However, I don't totally understand the comment about TI. Is it important that we have NULL there, or is it only important that there be some valid GC thing there?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=738841#c3)• 13 years ago |
|  | |

(In reply to Bill McCloskey (:billm) from [comment #2](/show_bug.cgi?id=738841#c2 "VERIFIED FIXED - \"Assertion failure: allocated(),\" with TypeInference disabled"))
> If I just comment out this entire block, the test case runs fine. However, I
> don't totally understand the comment about TI. Is it important that we have
> NULL there, or is it only important that there be some valid GC thing there?
I think TI will want there to be a non-object value there, so that it doesn't get confused if it resets the 'this' object's properties while in the call prologue (type changes which happen before constructing the new object). See TypeObject::clearNewScript. It should be fine to just remove the cx->typeInferenceEnabled() test, so that the sync happens whether TI is on or off.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=738841#c4)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=609528&action=diff)
— [Details](attachment.cgi?id=609528&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=738841&attachment=609528)

Thanks.Assignee: general → wmccloskeyStatus: NEW → ASSIGNED
[Attachment #609528](/attachment.cgi?id=609528&action=edit "fix") -
Flags: review?(bhackett1024)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=738841#a261295_346231)• 13 years ago |

[Attachment #609528](/attachment.cgi?id=609528&action=edit "fix") -
Flags: review?(bhackett1024) → review+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=738841#c6)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/f6b7b4b9f235>
This affects Firefox 13, but it does not affect people who have TI enabled (i.e., virtually everyone). I'm not going to request approval.Target Milestone: --- → mozilla14

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=738841#c7)• 13 years ago |
|  | |

Calling this "moderate" because it's a non-default configuration.
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=unaffected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix)
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-)Summary: "Assertion failure: allocated()," → "Assertion failure: allocated()," with TypeInference disabledWhiteboard: js-triage-needed → [sg:moderate] js-triage-needed

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=738841#c8)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/f6b7b4b9f235>Status: ASSIGNED → RESOLVEDClosed: 13 years ago
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=738841#a908335_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=738841#a9334799_280903)• 13 years ago |

Whiteboard: [sg:moderate] js-triage-needed → [sg:moderate][advisory-tracking+] js-triage-needed

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=738841#a10290224_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=738841#c9)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/jit-test/tests/basic/[bug738841](/show_bug.cgi?id=738841 "VERIFIED FIXED - \"Assertion failure: allocated(),\" with TypeInference disabled").js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=738841&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_73bb0faf_20250125_192839.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/#44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3)

# [security-announce] SUSE-SU-2012:0895-1: important: Security update for Mozilla Firefox

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

20 Jul
2012

20 Jul
'12

17:08

SUSE Security Update: Security update for Mozilla Firefox
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2012:0895-1
Rating: important
References: #712248 #771583
Cross-References: CVE-2012-1948 CVE-2012-1949 CVE-2012-1950
CVE-2012-1951 CVE-2012-1952 CVE-2012-1953
CVE-2012-1954 CVE-2012-1955 CVE-2012-1957
CVE-2012-1958 CVE-2012-1959 CVE-2012-1961
CVE-2012-1962 CVE-2012-1963 CVE-2012-1964
CVE-2012-1965 CVE-2012-1966 CVE-2012-1967
Affected Products:
SUSE Linux Enterprise Server 10 SP4
SUSE Linux Enterprise Desktop 10 SP4
SLE SDK 10 SP4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 18 vulnerabilities is now available.
It includes one version update.
Description:
MozillaFirefox have been updated to the 10.0.6ESR security
release fixing various bugs and several security issues,
some critical.
The ollowing security issues have been fixed:
\*
MFSA 2012-42: Mozilla developers identified and fixed
several memory safety bugs in the browser engine used in
Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain
circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary
code.
\*
CVE-2012-1948: Benoit Jacob, Jesse Ruderman,
Christian Holler, and Bill McCloskey reported memory safety
problems and crashes that affect Firefox ESR 10 and Firefox
13.
\*
MFSA 2012-43 / CVE-2012-1950: Security researcher
Mario Gomes andresearch firm Code Audit Labs reported a
mechanism to short-circuit page loads through drag and drop
to the addressbar by canceling the page load. This causes
the address of the previously site entered to be displayed
in the addressbar instead of the currently loaded page.
This could lead to potential phishing attacks on users.
\*
MFSA 2012-44 Google security researcher Abhishek Arya
used the Address Sanitizer tool to uncover four issues: two
use-after-free problems, one out of bounds read bug, and a
bad cast. The first use-afte.r-free problem is caused when
an array of nsSMILTimeValueSpec objects is destroyed but
attempts are made to call into objects in this array later.
The second use-after-free problem is in
nsDocument::AdoptNode when it adopts into an empty document
and then adopts into another document, emptying the first
one. The heap buffer overflow is in ElementAnimations when
data is read off of end of an array and then pointers are
dereferenced. The bad cast happens when
nsTableFrame::InsertFrames is called with frames in
aFrameList that are a mix of row group frames and column
group frames. AppendFrames is not able to handle this mix.
All four of these issues are potentially exploitable.
o CVE-2012-1951: Heap-use-after-free in
nsSMILTimeValueSpec::IsEventBased o CVE-2012-1954:
Heap-use-after-free in nsDocument::AdoptNode o
CVE-2012-1953: Out of bounds read in
ElementAnimations::EnsureStyleRuleFor o CVE-2012-1952: Bad
cast in nsTableFrame::InsertFrames
\*
MFSA 2012-45 / CVE-2012-1955: Security researcher
Mariusz Mlynski reported an issue with spoofing of the
location property. In this issue, calls to history.forward
and history.back are used to navigate to a site while
displaying the previous site in the addressbar but changing
the baseURI to the newer site. This can be used for
phishing by allowing the user input form or other data on
the newer, attacking, site while appearing to be on the
older, displayed site.
\*
MFSA 2012-46 / CVE-2012-1966: Mozilla security
researcher moz\_bug\_r\_a4 reported a cross-site scripting
(XSS) attack through the context menu using a data: URL. In
this issue, context menu functionality ("View Image", "Show
only this frame", and "View background image") are
disallowed in a javascript: URL but allowed in a data: URL,
allowing for XSS. This can lead to arbitrary code execution.
\*
MFSA 2012-47 / CVE-2012-1957: Security researcher
Mario Heiderich reported that javascript could be executed
in the HTML feed-view using tag within the RSS . This
problem is due to tags not being filtered out during
parsing and can lead to a potential cross-site scripting
(XSS) attack. The flaw existed in a parser utility class
and could affect other parts of the browser or add-ons
which rely on that class to sanitize untrusted input.
\*
MFSA 2012-48 / CVE-2012-1958: Security researcher
Arthur Gerkis used the Address Sanitizer tool to find a
use-after-free in nsGlobalWindow::PageHidden when
mFocusedContent is released and oldFocusedContent is used
afterwards. This use-after-free could possibly allow for
remote code execution.
\*
MFSA 2012-49 / CVE-2012-1959: Mozilla developer Bobby
Holley found that same-compartment security wrappers (SCSW)
can be bypassed by passing them to another compartment.
Cross-compartment wrappers often do not go through SCSW,
but have a filtering policy built into them. When an object
is wrapped cross-compartment, the SCSW is stripped off and,
when the object is read read back, it is not known that
SCSW was previously present, resulting in a bypassing of
SCSW. This could result in untrusted content having access
to the XBL that implements browser functionality.
\*
MFSA 2012-50 / CVE-2012-1960: Google developer Tony
Payne reported an out of bounds (OOB) read in QCMS,
Mozilla's color management library. With a carefully
crafted color profile portions of a user's memory could be
incorporated into a transformed image and possibly
deciphered.
\*
MFSA 2012-51 / CVE-2012-1961: Bugzilla developer
Frederic Buclin reported that the "X-Frame-Options header
is ignored when the value is duplicated, for example
X-Frame-Options: SAMEORIGIN, SAMEORIGIN. This duplication
occurs for unknown reasons on some websites and when it
occurs results in Mozilla browsers not being protected
against possible clickjacking attacks on those pages.
\*
MFSA 2012-52 / CVE-2012-1962: Security researcher
Bill Keese reported a memory corruption. This is caused by
JSDependentString::undepend changing a dependent string
into a fixed string when there are additional dependent
strings relying on the same base. When the undepend occurs
during conversion, the base data is freed, leaving other
dependent strings with dangling pointers. This can lead to
a potentially exploitable crash.
\*
MFSA 2012-53 / CVE-2012-1963: Security researcher
Karthikeyan Bhargavan of Prosecco at INRIA reported Content
Security Policy (CSP) 1.0 implementation errors. CSP
violation reports generated by Firefox and sent to the
"report-uri" location include sensitive data within the
"blocked-uri" parameter. These include fragment components
and query strings even if the "blocked-uri" parameter has a
different origin than the protected resource. This can be
used to retrieve a user's OAuth 2.0 access tokens and
OpenID credentials by malicious sites.
\*
MFSA 2012-54 / CVE-2012-1964: Security Researcher
Matt McCutchen reported that a clickjacking attack using
the certificate warning page. A man-in-the-middle (MITM)
attacker can use an iframe to display its own certificate
error warning page (about:certerror) with the "Add
Exception" button of a real warning page from a malicious
site. This can mislead users to adding a certificate
exception for a different site than the perceived one. This
can lead to compromised communications with the user
perceived site through the MITM attack once the certificate
exception has been added.
\*
MFSA 2012-55 / CVE-2012-1965: Security researchers
Mario Gomes and Soroush Dalili reported that since Mozilla
allows the pseudo-protocol feed: to prefix any valid URL,
it is possible to construct feed:javascript: URLs that will
execute scripts in some contexts. On some sites it may be
possible to use this to evade output filtering that would
otherwise strip javascript: URLs and thus contribute to
cross-site scripting (XSS) problems on these sites.
\*
MFSA 2012-56 / CVE-2012-1967: Mozilla security
researcher moz\_bug\_r\_a4 reported a arbitrary code execution
attack using a javascript: URL. The Gecko engine features a
JavaScript sandbox utility that allows the browser or
add-ons to safely execute script in the context of a web
page. In certain cases, javascript: URLs are executed in
such a sandbox with insufficient context that can allow
those scripts to escape from the sandbox and run with
elevated privilege. This can lead to arbitrary code
execution.
Security Issue references:
\* CVE-2012-1967
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1967>

...

\* CVE-2012-1948
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1948>

...

\* CVE-2012-1949
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1949>

...

\* CVE-2012-1951
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1951>

...

\* CVE-2012-1952
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1952>

...

\* CVE-2012-1953
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1953>

...

\* CVE-2012-1954
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1954>

...

\* CVE-2012-1966
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1966>

...

\* CVE-2012-1958
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1958>

...

\* CVE-2012-1959
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1959>

...

\* CVE-2012-1962
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1962>

...

\* CVE-2012-1950
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1950>

...

\* CVE-2012-1955
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1955>

...

\* CVE-2012-1957
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1957>

...

\* CVE-2012-1961
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1961>

...

\* CVE-2012-1963
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1963>

...

\* CVE-2012-1964
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1964>

...

\* CVE-2012-1965
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1965>

...

Package List:
- SUSE Linux Enterprise Server 10 SP4 (i586 ia64 ppc s390x x86\_64):
firefox3-gtk2-2.10.6-0.12.1
- SUSE Linux Enterprise Server 10 SP4 (i586 ia64 ppc s390x) [New Version: 7]:
MozillaFirefox-10.0.6-0.6.1
MozillaFirefox-branding-SLED-7-0.8.25
MozillaFirefox-translations-10.0.6-0.6.1
- SUSE Linux Enterprise Server 10 SP4 (s390x x86\_64):
firefox3-gtk2-32bit-2.10.6-0.12.1
- SUSE Linux Enterprise Desktop 10 SP4 (i586 x86\_64):
firefox3-gtk2-2.10.6-0.12.1
- SUSE Linux Enterprise Desktop 10 SP4 (x86\_64):
firefox3-gtk2-32bit-2.10.6-0.12.1
- SUSE Linux Enterprise Desktop 10 SP4 (i586) [New Version: 7]:
MozillaFirefox-10.0.6-0.6.1
MozillaFirefox-branding-SLED-7-0.8.25
MozillaFirefox-translations-10.0.6-0.6.1
- SLE SDK 10 SP4 (i586 ia64 ppc s390x x86\_64):
firefox3-gtk2-devel-2.10.6-0.12.1
firefox3-gtk2-doc-2.10.6-0.12.1
- SLE SDK 10 SP4 (i586 ia64 ppc s390x):
MozillaFirefox-branding-upstream-10.0.6-0.6.1
References:
<http://support.novell.com/security/cve/CVE-2012-1948.html>
<http://support.novell.com/security/cve/CVE-2012-1949.html>
<http://support.novell.com/security/cve/CVE-2012-1950.html>
<http://support.novell.com/security/cve/CVE-2012-1951.html>
<http://support.novell.com/security/cve/CVE-2012-1952.html>
<http://support.novell.com/security/cve/CVE-2012-1953.html>
<http://support.novell.com/security/cve/CVE-2012-1954.html>
<http://support.novell.com/security/cve/CVE-2012-1955.html>
<http://support.novell.com/security/cve/CVE-2012-1957.html>
<http://support.novell.com/security/cve/CVE-2012-1958.html>
<http://support.novell.com/security/cve/CVE-2012-1959.html>
<http://support.novell.com/security/cve/CVE-2012-1961.html>
<http://support.novell.com/security/cve/CVE-2012-1962.html>
<http://support.novell.com/security/cve/CVE-2012-1963.html>
<http://support.novell.com/security/cve/CVE-2012-1964.html>
<http://support.novell.com/security/cve/CVE-2012-1965.html>
<http://support.novell.com/security/cve/CVE-2012-1966.html>
<http://support.novell.com/security/cve/CVE-2012-1967.html>
<https://bugzilla.novell.com/712248>
<https://bugzilla.novell.com/771583>
[http://download.novell.com/patch/finder/?keywords=96da6f10cbe978aeccb3ac8d9d...](http://download.novell.com/patch/finder/?keywords=96da6f10cbe978aeccb3ac8d9d6b7ef8)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3/#44VIHO7FDFXXVM3UIVGUCWIV5D57B5U3)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_d38fc7b0_20250125_192903.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/718290)
* [XML](/show_bug.cgi?ctype=xml&id=718290)

Closed
[Bug 718290](/show_bug.cgi?id=718290)

Opened 13 years ago
Closed 13 years ago

# Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla16

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=unaffected) |
| firefox12 | [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix) |
| firefox13 | [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified) |
| firefox15 | [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=verified) |
| firefox16 | [+](/buglist.cgi?f1=cf_tracking_firefox16&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=verified) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |
| blocking-fennec1.0 | --- | [.N+](/buglist.cgi?f1=cf_blocking_fennec10&o1=equals&v1=.N%2B) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox11 |  | unaffected |
| firefox12 | + | wontfix |
| firefox13 | + | wontfix |
| firefox14 | + | verified |
| firefox15 | + | verified |
| firefox16 | + | verified |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| blocking-fennec1.0 |  | .N+ |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: dbaron)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a32391d55cfa63276f87eb9819dfbd0?d=mm&size=40)  [dbaron](/user_profile?user_id=3881)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

23 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[stirdom](/show_bug.cgi?id=306663 "RESOLVED FIXED - [meta] Bugs found by \"Stir DOM\" module of DOMFuzz"), [randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [font-inflation](/show_bug.cgi?id=627842 "RESOLVED FIXED - Allow minimum font size based on size of frame")

[framedest](/show_bug.cgi?id=334514 "RESOLVED FIXED - FrameArena::~FrameArena should assert that it's empty")

Dependency [tree](/showdependencytree.cgi?id=718290&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=718290)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, sec-critical, testcase, Whiteboard: [sg:critical][advisory-tracking+] readability)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][advisory-tracking+] readability

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase](/attachment.cgi?id=588736)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   412 bytes, text/html |  | [Details](/attachment.cgi?id=588736&action=edit) |
| --- | --- | --- |
| [stack trace+](/attachment.cgi?id=588737)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   3.93 KB, text/plain |  | [Details](/attachment.cgi?id=588737&action=edit) |
| [patch](/attachment.cgi?id=635926)  [13 years ago](#c39)  [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)   7.28 KB, patch | roc : [review+](#c40 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c46 "13 years ago")  lsblakk : [approval-mozilla-beta+](#c48 "13 years ago") | [Details](/attachment.cgi?id=635926&action=edit) | [Diff](/attachment.cgi?id=635926&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=718290#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=588736)
— [Details](attachment.cgi?id=588736&action=edit)

1. Create a new profile.
2. Set user\_pref("font.size.inflation.minTwips", 3000);
3. Load the testcase in a debug build of Firefox.
4. Quit Firefox.
Result: Crash [@ ClearAllTextRunReferences] during shutdown.
I think it crashes while trying to evaluate an assertion condition, which might explain why it's debug-only.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=718290#c1)• 13 years ago |
|  | |

Attached file
[stack trace+](attachment.cgi?id=588737)
— [Details](attachment.cgi?id=588737&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=718290#c2)• 13 years ago |
|  | |

This was reduced from a testcase that, instead of crashing, triggers:
###!!! ASSERTION: Some pres arena objects were not freed: 'mPresArenaAllocCount == 0', file layout/base/nsPresShell.cpp, line 973

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a271_11608)• 13 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a306_11608)• 13 years ago |

Blocks: [framedest](/show_bug.cgi?id=334514 "RESOLVED FIXED - FrameArena::~FrameArena should assert that it's empty")

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a6426_3881)• 13 years ago |

Blocks: [font-inflation](/show_bug.cgi?id=627842 "RESOLVED FIXED - Allow minimum font size based on size of frame")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=718290#c3)• 13 years ago |
|  | |

Presumably this problem could happen at times other than shutdown if the victim waited long enough that these things got cleaned up?Assignee: nobody → dbaron

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=718290#c4)• 13 years ago |
|  | |

I'm leaning toward calling this a DoS? null deref during shutdown?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=718290#c5)• 13 years ago |
|  | |

Why do you think it's a guaranteed null deref?

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=718290#c6)• 13 years ago |
|  | |

I made the bug security-sensitive because of [comment 2](/show_bug.cgi?id=718290#c2 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"), fwiw. That assertion often indicates that there could be dangling pointers into the pres arena.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=718290#c7)• 13 years ago |
|  | |

This was filed against Fx12, and Fx10 doesn't have font inflation. Fx11 is probably affected but needs to be tested.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=unaffected)
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected)Whiteboard: [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a3391587_12352)• 13 years ago |

[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox12](/buglist.cgi?f1=cf_tracking_firefox12&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox12&o1=equals&v1=%2B)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=718290#c8)• 13 years ago |
|  | |

QA, can we get help with checking whether Fx11 is affected here? Thanks!

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=718290#c9)• 13 years ago |
|  | |

Using the beta4 debug build on OS X 10.7.3, I got [bp-b25c3d6f-9244-4855-9266-76b9c2120225](https://crash-stats.mozilla.org/report/index/b25c3d6f-9244-4855-9266-76b9c2120225) when I ran the testcase from [comment 0](/show_bug.cgi?id=718290#c0 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines").

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a3490023_280903)• 13 years ago |

Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a3815608_280903)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=718290#c10)• 13 years ago |
|  | |

But we're not shipping font inflation turned on for any Fx11 builds, right?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=718290#c11)• 13 years ago |
|  | |

Dunno, looks turned on in mobile beta (fx11) to me:
<https://mxr.mozilla.org/mozilla-beta/source/mobile/android/app/mobile.js#421>
Or should I be looking somewhere else?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=718290#c12)• 13 years ago |
|  | |

OK, Firefox Beta on my phone has 0.
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=unaffected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a3997726_1689)• 13 years ago |

Keywords: [fennecnative-betablocker](/buglist.cgi?keywords=fennecnative-betablocker&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=718290#c13)• 13 years ago |
|  | |

lowering to sg:moderate on the assumption most users won't change their minTwips pref to a ridiculous value. Can content CSS achieve the equivalent of inflation through a combination of font properties? That would change the calculus.Whiteboard: [sg:critical] → [sg:moderate]

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=718290#c14)• 13 years ago |
|  | |

IIRC, I discovered this bug using a less ridiculous font-inflation setting, so it could affect the default settings of mobile Firefox.Whiteboard: [sg:moderate] → [sg:critical]

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a5202677_152868)• 13 years ago |

[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a8833044_1689)• 13 years ago |

[tracking-firefox15](/buglist.cgi?f1=cf_tracking_firefox15&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B)

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a9419700_406847)• 13 years ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a9426484_406670)• 13 years ago |

tracking-fennec: --- → ?

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=718290#c15)• 13 years ago |
|  | |

Not sure if this should block fennec-1.0. It is a sg:crit but it seems to be a footgun case.

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a9431887_406670)• 13 years ago |

blocking-fennec1.0: --- → ?

|  | [Mark Finkle (:mfinkle) (use needinfo?)](/user_profile?user_id=252194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a9517591_252194)• 13 years ago |

blocking-fennec1.0: ? → +

|  | [JP Rosevear [:jpr]](/user_profile?user_id=407310) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=718290#c16)• 13 years ago |
|  | |

Should we be fixing this still for first release?Whiteboard: [sg:critical] → [sg:critical] readability

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=718290#c17)• 13 years ago |
|  | |

Aaron, can you confirm default settings for font inflation on fennec beta?

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=718290#c18)• 13 years ago |
|  | |

(In reply to David Bolter [:davidb] from [comment #17](/show_bug.cgi?id=718290#c17 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> Aaron, can you confirm default settings for font inflation on fennec beta?
font.size.inflation.minTwips: 120

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=718290#c19)• 13 years ago |
|  | |

Fennec's UI settings:
Tiny: font.size.inflation.minTwips: 0
Small: font.size.inflation.minTwips: 80
Medium: font.size.inflation.minTwips: 120 -- default
Large: font.size.inflation.minTwips: 160
Extra Large: font.size.inflation.minTwips: 240

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=718290#c20)• 13 years ago |
|  | |

Valgrind isn't particularly helpful. With DEBUG\_TRACEMALLOC\_PRESARENA, I see:
==25555== Invalid read of size 8
==25555== at 0x6EC9020: ClearAllTextRunReferences(nsTextFrame\*, gfxTextRun\*, nsTextFrame\*) (nsIFrame.h:1354)
==25555== by 0x6EC915C: \_ZL23UnhookTextRunFromFramesP10gfxTextRunP11nsTextFrame.part.204 (nsTextFrameThebes.cpp:451)
==25555== by 0x6ECD2A2: FrameTextRunCache::NotifyExpired(gfxTextRun\*) (gfxFont.h:2624)
==25555== by 0x6ED2932: nsExpirationTracker<gfxTextRun, 3u>::AgeOneGeneration() (nsExpirationTracker.h:188)
==25555== by 0x6ED2A6E: nsExpirationTracker<gfxTextRun, 3u>::TimerCallback(nsITimer\*, void\*) (nsExpirationTracker.h:311)
==25555== by 0x844C907: nsTimerImpl::Fire() (nsTimerImpl.cpp:473)
==25555== by 0x844CDB4: nsTimerEvent::Run() (nsTimerImpl.cpp:556)
==25555== by 0x844407F: nsThread::ProcessNextEvent(bool, bool\*) (nsThread.cpp:624)
==25555== by 0x83C770C: NS\_ProcessNextEvent\_P(nsIThread\*, bool) (nsThreadUtils.cpp:213)
==25555== by 0x8259B7A: mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) (MessagePump.cpp:113)
==25555== by 0x8494742: MessageLoop::Run() (message\_loop.cc:208)
==25555== by 0x80AE971: nsBaseAppShell::Run() (nsBaseAppShell.cpp:163)
==25555== by 0x7D8F802: nsAppStartup::Run() (nsAppStartup.cpp:256)
==25555== by 0x6A1E569: XREMain::XRE\_mainRun() (nsAppRunner.cpp:3768)
==25555== by 0x6A253CB: XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) (nsAppRunner.cpp:3845)
==25555== by 0x6A2576A: XRE\_main (nsAppRunner.cpp:3921)
==25555== by 0x4023EF: main (nsBrowserApp.cpp:157)
==25555== Address 0x268c4400 is not stack'd, malloc'd or (recently) free'd
(twice), followed by:
pure virtual method called
terminate called without an active exception

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=718290#c21)• 13 years ago |
|  | |

But with a larger --freelist-vol, I get:
==28053== Invalid read of size 8
==28053== at 0x6EC9020: ClearAllTextRunReferences(nsTextFrame\*, gfxTextRun\*, nsTextFrame\*) (nsIFrame.h:1354)
==28053== by 0x6EC915C: \_ZL23UnhookTextRunFromFramesP10gfxTextRunP11nsTextFrame.part.204 (nsTextFrameThebes.cpp:451)
==28053== by 0x6ECD2A2: FrameTextRunCache::NotifyExpired(gfxTextRun\*) (gfxFont.h:2624)
==28053== by 0x6ED2932: nsExpirationTracker<gfxTextRun, 3u>::AgeOneGeneration() (nsExpirationTracker.h:188)
==28053== by 0x6ED2A6E: nsExpirationTracker<gfxTextRun, 3u>::TimerCallback(nsITimer\*, void\*) (nsExpirationTracker.h:311)
==28053== by 0x844C907: nsTimerImpl::Fire() (nsTimerImpl.cpp:473)
==28053== by 0x844CDB4: nsTimerEvent::Run() (nsTimerImpl.cpp:556)
==28053== by 0x844407F: nsThread::ProcessNextEvent(bool, bool\*) (nsThread.cpp:624)
==28053== by 0x83C770C: NS\_ProcessNextEvent\_P(nsIThread\*, bool) (nsThreadUtils.cpp:213)
==28053== by 0x8259B7A: mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) (MessagePump.cpp:113)
==28053== by 0x8494742: MessageLoop::Run() (message\_loop.cc:208)
==28053== by 0x80AE971: nsBaseAppShell::Run() (nsBaseAppShell.cpp:163)
==28053== by 0x7D8F802: nsAppStartup::Run() (nsAppStartup.cpp:256)
==28053== by 0x6A1E569: XREMain::XRE\_mainRun() (nsAppRunner.cpp:3768)
==28053== by 0x6A253CB: XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) (nsAppRunner.cpp:3845)
==28053== by 0x6A2576A: XRE\_main (nsAppRunner.cpp:3921)
==28053== by 0x4023EF: main (nsBrowserApp.cpp:157)
==28053== Address 0x2fb8b380 is 64 bytes inside a block of size 120 free'd
==28053== at 0x4C282E0: free (vg\_replace\_malloc.c:366)
==28053== by 0x8482FC3: free (nsTraceMalloc.c:1289)
==28053== by 0x6E3036B: nsContainerFrame::DeleteNextInFlowChild(nsPresContext\*, nsIFrame\*, bool) (nsIFrame.h:564)
==28053== by 0x6E9A09E: nsLineLayout::ReflowFrame(nsIFrame\*, unsigned int&, nsHTMLReflowMetrics\*, bool&) (nsLineLayout.cpp:965)
==28053== by 0x6E9055E: nsInlineFrame::ReflowInlineFrame(nsPresContext\*, nsHTMLReflowState const&, nsInlineFrame::InlineReflowState&, nsIFrame\*, unsigned int&) (nsInlineFrame.cpp:680)
==28053== by 0x6E909A9: nsInlineFrame::ReflowFrames(nsPresContext\*, nsHTMLReflowState const&, nsInlineFrame::InlineReflowState&, nsHTMLReflowMetrics&, unsigned int&) (nsInlineFrame.cpp:543)
==28053== by 0x6E91D4C: nsInlineFrame::Reflow(nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) (nsInlineFrame.cpp:397)
==28053== by 0x6E99711: nsLineLayout::ReflowFrame(nsIFrame\*, unsigned int&, nsHTMLReflowMetrics\*, bool&) (nsLineLayout.cpp:825)
==28053== by 0x6E0B75D: \_ZN12nsBlockFrame17ReflowInlineFrameER18nsBlockReflowStateR12nsLineLayout19nsLineList\_iteratorP8nsIFrameP16LineReflowStatus.constprop.192 (nsBlockFrame.cpp:3884)
==28053== by 0x6E17836: nsBlockFrame::ReflowInlineFrames(nsBlockReflowState&, nsLineList\_iterator, bool\*) (nsBlockFrame.cpp:3680)
==28053== by 0x6E187C3: nsBlockFrame::ReflowLine(nsBlockReflowState&, nsLineList\_iterator, bool\*) (nsBlockFrame.cpp:2550)
==28053== by 0x6E1A949: nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) (nsBlockFrame.cpp:2000)
==28053== by 0x6E1F162: nsBlockFrame::Reflow(nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) (nsBlockFrame.cpp:1043)
==28053== by 0x6E212A3: nsBlockReflowContext::ReflowBlock(nsRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox\*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) (nsBlockReflowContext.cpp:262)
==28053== by 0x6E0F486: nsBlockFrame::ReflowFloat(nsBlockReflowState&, nsRect const&, nsIFrame\*, nsMargin&, bool, unsigned int&) (nsBlockFrame.cpp:5966)
==28053== by 0x6E23C15: nsBlockReflowState::FlowAndPlaceFloat(nsIFrame\*) (nsBlockReflowState.cpp:757)
==28053== by 0x6E24318: nsBlockReflowState::AddFloat(nsLineLayout\*, nsIFrame\*, int) (nsBlockReflowState.cpp:509)
==28053== by 0x6E9A6D0: nsLineLayout::ReflowFrame(nsIFrame\*, unsigned int&, nsHTMLReflowMetrics\*, bool&) (nsLineLayout.h:195)
==28053== by 0x6E0B75D: \_ZN12nsBlockFrame17ReflowInlineFrameER18nsBlockReflowStateR12nsLineLayout19nsLineList\_iteratorP8nsIFrameP16LineReflowStatus.constprop.192 (nsBlockFrame.cpp:3884)
==28053== by 0x6E17836: nsBlockFrame::ReflowInlineFrames(nsBlockReflowState&, nsLineList\_iterator, bool\*) (nsBlockFrame.cpp:3680)
==28053== by 0x6E187C3: nsBlockFrame::ReflowLine(nsBlockReflowState&, nsLineList\_iterator, bool\*) (nsBlockFrame.cpp:2550)
==28053== by 0x6E1A949: nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) (nsBlockFrame.cpp:2000)
==28053== by 0x6E1F162: nsBlockFrame::Reflow(nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) (nsBlockFrame.cpp:1043)
==28053== by 0x6E30027: nsContainerFrame::ReflowChild(nsIFrame\*, nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, int, int, unsigned int, unsigned int&, nsOverflowContinuationTracker\*) (nsContainerFrame.cpp:907)
==28053== by 0x6E79327: nsCanvasFrame::Reflow(nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) (nsCanvasFrame.cpp:426)
==28053== by 0x6E30027: nsContainerFrame::ReflowChild(nsIFrame\*, nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, int, int, unsigned int, unsigned int&, nsOverflowContinuationTracker\*) (nsContainerFrame.cpp:907)
==28053== by 0x6E68B19: nsHTMLScrollFrame::ReflowScrolledFrame(ScrollReflowState\*, bool, bool, nsHTMLReflowMetrics\*, bool) (nsGfxScrollFrame.cpp:518)
==28053== by 0x6E6BCE1: nsHTMLScrollFrame::ReflowContents(ScrollReflowState\*, nsHTMLReflowMetrics const&) (nsGfxScrollFrame.cpp:616)
==28053== by 0x6E6E313: nsHTMLScrollFrame::Reflow(nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) (nsGfxScrollFrame.cpp:857)
==28053== by 0x6E30027: nsContainerFrame::ReflowChild(nsIFrame\*, nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, int, int, unsigned int, unsigned int&, nsOverflowContinuationTracker\*) (nsContainerFrame.cpp:907)
==28053== by 0x6EEA7C3: ViewportFrame::Reflow(nsPresContext\*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) (nsViewportFrame.cpp:201)
==28053== by 0x6DB6D4F: PresShell::DoReflow(nsIFrame\*, bool) (nsPresShell.cpp:7361)
==28053== by 0x6DBB5F5: PresShell::ProcessReflowCommands(bool) (nsPresShell.cpp:7508)
==28053== by 0x6DBBD59: PresShell::FlushPendingNotifications(mozFlushType) (nsPresShell.cpp:3839)
==28053== by 0x6DC9EFC: \_ZN15nsRefreshDriver6NotifyEP8nsITimer.part.60 (nsRefreshDriver.cpp:395)
==28053== by 0x6DCA4C7: nsRefreshDriver::Notify(nsITimer\*) (nsRefreshDriver.cpp:306)
==28053== by 0x844C536: nsTimerImpl::Fire() (nsTimerImpl.cpp:476)
==28053== by 0x844CDB4: nsTimerEvent::Run() (nsTimerImpl.cpp:556)
==28053== by 0x844407F: nsThread::ProcessNextEvent(bool, bool\*) (nsThread.cpp:624)
==28053== by 0x83C770C: NS\_ProcessNextEvent\_P(nsIThread\*, bool) (nsThreadUtils.cpp:213)
==28053== by 0x8445CED: nsThread::Shutdown() (nsThread.cpp:466)
==28053== by 0x6A311BD: nsRunnableMethodImpl<void (nsPACMan::\*)(), true>::Run() (nsThreadUtils.h:313)
==28053== by 0x844407F: nsThread::ProcessNextEvent(bool, bool\*) (nsThread.cpp:624)
==28053== by 0x83C770C: NS\_ProcessNextEvent\_P(nsIThread\*, bool) (nsThreadUtils.cpp:213)
==28053== by 0x8259B0A: mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) (MessagePump.cpp:82)
==28053== by 0x8494742: MessageLoop::Run(==28053== by 0x80AE971: nsBaseAppShell::Run() (nsBaseAppShell.cpp:163)
==28053== by 0x7D8F802: nsAppStartup::Run() (nsAppStartup.cpp:256)
==28053== by 0x6A1E569: XREMain::XRE\_mainRun() (nsAppRunner.cpp:3768)
==28053== by 0x6A253CB: XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) (nsAppRunner.cpp:3845)
) (message\_loop.cc:208)

|  | [JP Rosevear [:jpr]](/user_profile?user_id=407310) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=718290#c22)• 13 years ago |
|  | |

Based on current analysis, does this crash impact us when using default settings? If so, we should keep it as a release blocker, if not I think we track it for 15.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=718290#c23)• 13 years ago |
|  | |

One thing I'm suspicious of is that TEXT\_IN\_TEXTRUN\_USER\_DATA probably needs to be tracked separately for the inflated and non-inflated text runs.

|  | [Allison Naaktgeboren :ally](/user_profile?user_id=384312) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=718290#c24)• 13 years ago |
|  | |

dbaron, have you investigated or vetted that suspicion? I for one, am interested in knowing if there is more than one issue in play.
JP, did you ever get an answer for [comment 22](/show_bug.cgi?id=718290#c22 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"), and if not, who should? It is not clear to me who owns that analysis.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=718290#c25)• 13 years ago |
|  | |

(In reply to JP Rosevear [:jpr] from [comment #22](/show_bug.cgi?id=718290#c22 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> Based on current analysis, does this crash impact us when using default
> settings?
IIUC, it only affects products where font-inflation is enabled by default.
So, desktop Firefox: no. Fennec: yes.

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=718290#c26)• 13 years ago |
|  | |

That was understood. The question is what values of font.size.inflation.minTwips causes the issue? Are any of the default values we ship with a concern?
Tiny: 0
Small: 80
Normal: 120
Large: 160
Extra large: 240

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=718290#c27)• 13 years ago |
|  | |

If emPerLine and/or minTwips is non-zero then font-inflation is enabled.

|  | [Mark Finkle (:mfinkle) (use needinfo?)](/user_profile?user_id=252194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a12200179_252194)• 13 years ago |

blocking-fennec1.0: + → .N+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=718290#c28)• 13 years ago |
|  | |

We considered blocking Fennec 1.0 on this bug given it has font inflation enabled by default. We decided to instead continue tracking for FF14. This is a very desirable bug to resolve, however, and we would definitely consider taking this before FN14's 1.0 release.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=718290#c29)• 13 years ago |
|  | |

(In reply to David Baron [:dbaron] from [comment #23](/show_bug.cgi?id=718290#c23 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> One thing I'm suspicious of is that TEXT\_IN\_TEXTRUN\_USER\_DATA probably needs
> to be tracked separately for the inflated and non-inflated text runs.
So removing the line:
aFrame->RemoveStateBits(TEXT\_IN\_TEXTRUN\_USER\_DATA);
from ClearAllTextRunReferences doesn't make the crash go away, so maybe this isn't the problem.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a13670651_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) → ---
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=unaffected) → ---
[status-firefox12](/buglist.cgi?f1=cf_status_firefox12&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox12&o1=equals&v1=wontfix)
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected)
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-) → ---
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=-) → ---
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=-) → ---
[tracking-firefox16](/buglist.cgi?f1=cf_tracking_firefox16&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox16&o1=equals&v1=%2B)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=718290#c30)• 13 years ago |
|  | |

Reproducing this bug with this testcase now requires commenting out the lines quoted in [bug 764354 comment 12](/show_bug.cgi?id=764354#c12 "VERIFIED FIXED - Flash plugin text \"Tap here to activate plugin\" is aligned to the left").

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=718290#c31)• 13 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #2](/show_bug.cgi?id=718290#c2 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> This was reduced from a testcase that, instead of crashing, triggers:
>
> ###!!! ASSERTION: Some pres arena objects were not freed:
> 'mPresArenaAllocCount == 0', file layout/base/nsPresShell.cpp, line 973
I think I've figured out why this bit is important: it looks like the problem is that the crash is because a text run has a dangling pointer to a text frame. That text frame has its memory full of 0xdadadada, but it's never had its DestroyFrom method called. So I think the "not freed" is the underlying cause of the dangling pointer.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=718290#c32)• 13 years ago |
|  | |

(In reply to David Baron [:dbaron] from [comment #31](/show_bug.cgi?id=718290#c31 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> (In reply to Jesse Ruderman from [comment #2](/show_bug.cgi?id=718290#c2 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> > This was reduced from a testcase that, instead of crashing, triggers:
> >
> > ###!!! ASSERTION: Some pres arena objects were not freed:
> > 'mPresArenaAllocCount == 0', file layout/base/nsPresShell.cpp, line 973
>
> I think I've figured out why this bit is important: it looks like the
> problem is that the crash is because a text run has a dangling pointer to a
> text frame. That text frame has its memory full of 0xdadadada, but it's
> never had its DestroyFrom method called. So I think the "not freed" is the
> underlying cause of the dangling pointer.
Er, never mind. I just wasn't looking at nsContinuingTextFrame::DestroyFrom.
That said, I think this may be related to there being another case in which nsContinuingTextFrame::DestroyFrom needs to clear text runs.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=718290#c33)• 13 years ago |
|  | |

So, more details:
the problem in this case is the \*uninflated\* text run has a dangling back-pointer to the frame.
The frame in question is the third of three continuations for the piece of text "aaaaaaaaaaaaaaaa bbbbbbbbbbbbbbbb\nc". However, it's destroyed during reflow, whereas the others stick around.
When the continuations are initially set up, this third continuation has a different \*uninflated\* text run from the previous two continuations, but the same \*inflated\* text run as the previous two continuations, thanks to:
<http://hg.mozilla.org/mozilla-central/file/da85d45f39ef/layout/generic/nsTextFrameThebes.cpp#l1458>
1458 nsStyleContext\* sc1 = aFrame1->GetStyleContext();
1459 const nsStyleText\* textStyle1 = sc1->GetStyleText();
1460 // If the first frame ends in a preformatted newline, then we end the textrun
1461 // here. This avoids creating giant textruns for an entire plain text file.
1462 // Note that we create a single text frame for a preformatted text node,
1463 // even if it has newlines in it, so typically we won't see trailing newlines
1464 // until after reflow has broken up the frame into one (or more) frames per
1465 // line. That's OK though.
1466 if (textStyle1->NewlineIsSignificant() && HasTerminalNewline(aFrame1))
1467 return false;
Disabling this optimization makes the crash go away.
I think the conditions in nsContinuingTextFrame::Destroy for whether we clear text runs need to account for this optimization better.Summary: Crash [@ ClearAllTextRunReferences] with font inflation → Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=718290#c34)• 13 years ago |
|  | |

Then again, given that the problem is that the textrun has a reference to the text frame, I'd have thought that TEXT\_IN\_TEXTRUN\_USER\_DATA would be being set, and it's not.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=718290#c35)• 13 years ago |
|  | |

Though it's not clear to me whether TEXT\_IN\_TEXTRUN\_USER\_DATA is supposed to be set for \*all\* cases when the textrun has a pointer to a frame, or just some of them.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=718290#c36)• 13 years ago |
|  | |

And, to be clear, the pointer from the text run to the frame is the one we dereference here:
<http://hg.mozilla.org/mozilla-central/file/da85d45f39ef/layout/generic/nsTextFrameThebes.cpp#l435>
435 if (aTextRun->GetFlags() & nsTextFrameUtils::TEXT\_IS\_SIMPLE\_FLOW) {
436 nsIFrame\* userDataFrame = static\_cast<nsIFrame\*>(aTextRun->GetUserData());
437 DebugOnly<bool> found =
438 ClearAllTextRunReferences(static\_cast<nsTextFrame\*>(userDataFrame),
439 aTextRun, aStartContinuation);

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=718290#c37)• 13 years ago |
|  | |

(In reply to David Baron [:dbaron] from [comment #34](/show_bug.cgi?id=718290#c34 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> Then again, given that the problem is that the textrun has a reference to
> the text frame, I'd have thought that TEXT\_IN\_TEXTRUN\_USER\_DATA would be
> being set, and it's not.
Yes, it should have been set.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=718290#c38)• 13 years ago |
|  | |

(In reply to David Baron [:dbaron] from [comment #29](/show_bug.cgi?id=718290#c29 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> (In reply to David Baron [:dbaron] from [comment #23](/show_bug.cgi?id=718290#c23 "VERIFIED FIXED - Crash [@ ClearAllTextRunReferences] with font inflation and 'white-space' that preserves newlines"))
> > One thing I'm suspicious of is that TEXT\_IN\_TEXTRUN\_USER\_DATA probably needs
> > to be tracked separately for the inflated and non-inflated text runs.
>
> So removing the line:
> aFrame->RemoveStateBits(TEXT\_IN\_TEXTRUN\_USER\_DATA);
> from ClearAllTextRunReferences doesn't make the crash go away, so maybe this
> isn't the problem.
Actually, maybe removing that line isn't a sufficient experiment to determine if this is the problem, because of this code in UnhookTextRunFromFrames:
if (aTextRun->GetFlags() & nsTextFrameUtils::TEXT\_IS\_SIMPLE\_FLOW) {
nsIFrame\* userDataFrame = static\_cast<nsIFrame\*>(aTextRun->GetUserData());
DebugOnly<bool> found =
ClearAllTextRunReferences(static\_cast<nsTextFrame\*>(userDataFrame),
aTextRun, aStartContinuation);
NS\_ASSERTION(!aStartContinuation || found,
"aStartContinuation wasn't found in simple flow text run");
if (!(userDataFrame->GetStateBits() & TEXT\_IN\_TEXTRUN\_USER\_DATA)) {
aTextRun->SetUserData(nsnull);
}
} else {
which seems to assume that ClearAllTextRunReferences does that removal. If I also comment out this test:
//if (!(userDataFrame->GetStateBits() & TEXT\_IN\_TEXTRUN\_USER\_DATA)) {
aTextRun->SetUserData(nsnull);
//}
then that does fix the crash. So maybe the need to split this bit is the problem.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=718290#c39)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=635926&action=diff)
— [Details](attachment.cgi?id=635926&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926)

[Attachment #635926](/attachment.cgi?id=635926&action=edit "patch") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=718290#c40)• 13 years ago |
|  | |

Comment on [attachment 635926](/attachment.cgi?id=635926 "patch") [[details]](/attachment.cgi?id=635926&action=edit "patch") [[diff]](/attachment.cgi?id=635926&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926)
patch
Review of [attachment 635926](/attachment.cgi?id=635926 "patch") [[details]](/attachment.cgi?id=635926&action=edit "patch") [[diff]](/attachment.cgi?id=635926&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926):
-----------------------------------------------------------------
::: layout/generic/nsTextFrameThebes.cpp
@@ +462,5 @@
> nsTextFrame\* userDataFrame = userData->mMappedFlows[i].mStartFrame;
> + nsFrameState whichTextRunState =
> + userDataFrame->GetTextRun(nsTextFrame::eInflated) == aTextRun
> + ? TEXT\_IN\_TEXTRUN\_USER\_DATA
> + : TEXT\_IN\_UNINFLATED\_TEXTRUN\_USER\_DATA;
Hoist this out of the if so you don't have to duplicate it.
[Attachment #635926](/attachment.cgi?id=635926&action=edit "patch") -
Flags: review?(roc) → review+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=718290#c41)• 13 years ago |
|  | |

The frame variables are inside the if, though, and in the second half inside the loop. (And there may be cases where the result could actually vary across frames.)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=718290#c42)• 13 years ago |
|  | |

Right. Never mind then.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=718290#c43)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/dd9f0911976b>Target Milestone: --- → mozilla16

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=718290#c44)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/dd9f0911976b>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=718290#c45)• 13 years ago |
|  | |

Comment on [attachment 635926](/attachment.cgi?id=635926 "patch") [[details]](/attachment.cgi?id=635926&action=edit "patch") [[diff]](/attachment.cgi?id=635926&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926)
patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 627842](/show_bug.cgi?id=627842 "RESOLVED FIXED - Allow minimum font size based on size of frame")
User impact if declined: potential for crashes or exploits
Testing completed (on m-c, etc.): on mozilla-central; tested that it fixes testcase
Risk to taking this patch (and alternatives if risky): I think it's relatively low risk; it tracks one bit of information separately for the inflated and non-inflated text runs so we don't get confused. The biggest risk is probably that something could go wrong in the code to decide which bit to use.
String or UUID changes made by this patch: none
[Attachment #635926](/attachment.cgi?id=635926&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #635926](/attachment.cgi?id=635926&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=718290#c46)• 13 years ago |
|  | |

Comment on [attachment 635926](/attachment.cgi?id=635926 "patch") [[details]](/attachment.cgi?id=635926&action=edit "patch") [[diff]](/attachment.cgi?id=635926&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926)
patch
[Triage Comment]
Please land on aurora 15 in preparation for beta 14 consideration. Thanks!
[Attachment #635926](/attachment.cgi?id=635926&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=718290#c47)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/c3a418c44e8c>
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=718290#c48)• 13 years ago |
|  | |

Comment on [attachment 635926](/attachment.cgi?id=635926 "patch") [[details]](/attachment.cgi?id=635926&action=edit "patch") [[diff]](/attachment.cgi?id=635926&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=718290&attachment=635926)
patch
Looks good on Aurora, go ahead with landing to Beta if possible in the next hour so that it stands a chance of being in the beta go to build later today.
[Attachment #635926](/attachment.cgi?id=635926&action=edit "patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=718290#c49)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/4e4dd48e0b31>
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a15230267_280903)• 13 years ago |

Whiteboard: [sg:critical] readability → [sg:critical][advisory-tracking+] readability

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a16193737_1689)• 13 years ago |

Group: core-security

|  | [Vlad [QA]](/user_profile?user_id=408941) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=718290#c50)• 13 years ago |
|  | |

Verified on:
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:15.0) Gecko/20120720 Firefox/15.0 beta debug build
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:14.0) Gecko/20120713 Firefox/14.0.1 release debug build
Following the steps from the description and using the testcase attached I didn't manage to crash Firefox thus marking this as verified.
I've verified this on Firefox 13 debug build with the same steps and it crashes every time.
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=verified)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=verified)

|  | [Paul Silaghi, QA [:pauly]](/user_profile?user_id=428011) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=718290#c51)• 12 years ago |
|  | |

Verified fixed on FF 16 2012-09-17-mozilla-beta-debug build on Mac OS X 10.6.8
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=verified)

|  | [Paul Silaghi, QA [:pauly]](/user_profile?user_id=428011) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a23992294_428011)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=718290#a60058098_1)• 11 years ago |

tracking-fennec: ? → ---
You need to [log in](/show_bug.cgi?id=718290&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_1f2a3693_20250125_192841.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/#2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B)

# [security-announce] openSUSE-SU-2012:0899-1: critical: MozillaFirefox to 14.0.1

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

23 Jul
2012

23 Jul
'12

06:08

openSUSE Security Update: MozillaFirefox to 14.0.1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2012:0899-1
Rating: critical
References: #771583
Cross-References: CVE-2012-1948 CVE-2012-1949 CVE-2012-1950
CVE-2012-1951 CVE-2012-1952 CVE-2012-1953
CVE-2012-1954 CVE-2012-1955 CVE-2012-1957
CVE-2012-1958 CVE-2012-1959 CVE-2012-1961
CVE-2012-1962 CVE-2012-1963 CVE-2012-1964
CVE-2012-1965 CVE-2012-1966 CVE-2012-1967
Affected Products:
openSUSE 12.1
openSUSE 11.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 18 vulnerabilities is now available.
Description:
MozillaFirefox was updated to 14.0.1 to fix various bugs
and security issues.
Following security issues were fixed: MFSA 2012-42: Mozilla
developers identified and fixed several memory safety bugs
in the browser engine used in Firefox and other
Mozilla-based products. Some of these bugs showed evidence
of memory corruption under certain circumstances, and we
presume that with enough effort at least some of these
could be exploited to run arbitrary code.
CVE-2012-1949: Brian Smith, Gary Kwong, Christian Holler,
Jesse Ruderman, Christoph Diehl, Chris Jones, Brad Lassey,
and Kyle Huey reported memory safety problems and crashes
that affect Firefox 13.
CVE-2012-1948: Benoit Jacob, Jesse Ruderman, Christian
Holler, and Bill McCloskey reported memory safety problems
and crashes that affect Firefox ESR 10 and Firefox 13.
MFSA 2012-43 / CVE-2012-1950: Security researcher Mario
Gomes andresearch firm Code Audit Labs reported a mechanism
to short-circuit page loads through drag and drop to the
addressbar by canceling the page load. This causes the
address of the previously site entered to be displayed in
the addressbar instead of the currently loaded page. This
could lead to potential phishing attacks on users.
MFSA 2012-44 Google security researcher Abhishek Arya used
the Address Sanitizer tool to uncover four issues: two
use-after-free problems, one out of bounds read bug, and a
bad cast. The first use-after-free problem is caused when
an array of nsSMILTimeValueSpec objects is destroyed but
attempts are made to call into objects in this array later.
The second use-after-free problem is in
nsDocument::AdoptNode when it adopts into an empty document
and then adopts into another document, emptying the first
one. The heap buffer overflow is in ElementAnimations when
data is read off of end of an array and then pointers are
dereferenced. The bad cast happens when
nsTableFrame::InsertFrames is called with frames in
aFrameList that are a mix of row group frames and column
group frames. AppendFrames is not able to handle this mix.
All four of these issues are potentially exploitable.
CVE-2012-1951: Heap-use-after-free in
nsSMILTimeValueSpec::IsEventBased CVE-2012-1954:
Heap-use-after-free in nsDocument::AdoptNode CVE-2012-1953:
Out of bounds read in ElementAnimations::EnsureStyleRuleFor
CVE-2012-1952: Bad cast in nsTableFrame::InsertFrames
MFSA 2012-45 / CVE-2012-1955: Security researcher Mariusz
Mlynski reported an issue with spoofing of the location
property. In this issue, calls to history.forward and
history.back are used to navigate to a site while
displaying the previous site in the addressbar but changing
the baseURI to the newer site. This can be used for
phishing by allowing the user input form or other data on
the newer, attacking, site while appearing to be on the
older, displayed site.
MFSA 2012-46 / CVE-2012-1966: Mozilla security researcher
moz\_bug\_r\_a4 reported a cross-site scripting (XSS) attack
through the context menu using a data: URL. In this issue,
context menu functionality ("View Image", "Show only this
frame", and "View background image") are disallowed in a
javascript: URL but allowed in a data: URL, allowing for
XSS. This can lead to arbitrary code execution.
MFSA 2012-47 / CVE-2012-1957: Security researcher Mario
Heiderich reported that javascript could be executed in the
HTML feed-view using <embed> tag within the RSS
<description>. This problem is due to <embed> tags not
being filtered out during parsing and can lead to a
potential cross-site scripting (XSS) attack. The flaw
existed in a parser utility class and could affect other
parts of the browser or add-ons which rely on that class to
sanitize untrusted input.
MFSA 2012-48 / CVE-2012-1958: Security researcher Arthur
Gerkis used the Address Sanitizer tool to find a
use-after-free in nsGlobalWindow::PageHidden when
mFocusedContent is released and oldFocusedContent is used
afterwards. This use-after-free could possibly allow for
remote code execution.
MFSA 2012-49 / CVE-2012-1959: Mozilla developer Bobby
Holley found that same-compartment security wrappers (SCSW)
can be bypassed by passing them to another compartment.
Cross-compartment wrappers often do not go through SCSW,
but have a filtering policy built into them. When an object
is wrapped cross-compartment, the SCSW is stripped off and,
when the object is read read back, it is not known that
SCSW was previously present, resulting in a bypassing of
SCSW. This could result in untrusted content having access
to the XBL that implements browser functionality.
MFSA 2012-50 / CVE-2012-1960: Google developer Tony Payne
reported an out of bounds (OOB) read in QCMS, Mozilla’s
color management library. With a carefully crafted color
profile portions of a user's memory could be incorporated
into a transformed image and possibly deciphered.
MFSA 2012-51 / CVE-2012-1961: Bugzilla developer Frédéric
Buclin reported that the "X-Frame-Options header is ignored
when the value is duplicated, for example X-Frame-Options:
SAMEORIGIN, SAMEORIGIN. This duplication occurs for unknown
reasons on some websites and when it occurs results in
Mozilla browsers not being protected against possible
clickjacking attacks on those pages.
MFSA 2012-52 / CVE-2012-1962: Security researcher Bill
Keese reported a memory corruption. This is caused by
JSDependentString::undepend changing a dependent string
into a fixed string when there are additional dependent
strings relying on the same base. When the undepend occurs
during conversion, the base data is freed, leaving other
dependent strings with dangling pointers. This can lead to
a potentially exploitable crash.
MFSA 2012-53 / CVE-2012-1963: Security researcher
Karthikeyan Bhargavan of Prosecco at INRIA reported Content
Security Policy (CSP) 1.0 implementation errors. CSP
violation reports generated by Firefox and sent to the
"report-uri" location include sensitive data within the
"blocked-uri" parameter. These include fragment components
and query strings even if the "blocked-uri" parameter has a
different origin than the protected resource. This can be
used to retrieve a user's OAuth 2.0 access tokens and
OpenID credentials by malicious sites.
MFSA 2012-54 / CVE-2012-1964: Security Researcher Matt
McCutchen reported that a clickjacking attack using the
certificate warning page. A man-in-the-middle (MITM)
attacker can use an iframe to display its own certificate
error warning page (about:certerror) with the "Add
Exception" button of a real warning page from a malicious
site. This can mislead users to adding a certificate
exception for a different site than the perceived one. This
can lead to compromised communications with the user
perceived site through the MITM attack once the certificate
exception has been added.
MFSA 2012-55 / CVE-2012-1965: Security researchers Mario
Gomes and Soroush Dalili reported that since Mozilla allows
the pseudo-protocol feed: to prefix any valid URL, it is
possible to construct feed:javascript: URLs that will
execute scripts in some contexts. On some sites it may be
possible to use this to evade output filtering that would
otherwise strip javascript: URLs and thus contribute to
cross-site scripting (XSS) problems on these sites.
MFSA 2012-56 / CVE-2012-1967: Mozilla security researcher
moz\_bug\_r\_a4 reported a arbitrary code execution attack
using a javascript: URL. The Gecko engine features a
JavaScript sandbox utility that allows the browser or
add-ons to safely execute script in the context of a web
page. In certain cases, javascript: URLs are executed in
such a sandbox with insufficient context that can allow
those scripts to escape from the sandbox and run with
elevated privilege. This can lead to arbitrary code
execution.
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.1:
zypper in -t patch openSUSE-2012-410
- openSUSE 11.4:
zypper in -t patch openSUSE-2012-410
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.1 (i586 x86\_64):
MozillaFirefox-14.0.1-2.33.1
MozillaFirefox-branding-upstream-14.0.1-2.33.1
MozillaFirefox-buildsymbols-14.0.1-2.33.1
MozillaFirefox-debuginfo-14.0.1-2.33.1
MozillaFirefox-debugsource-14.0.1-2.33.1
MozillaFirefox-devel-14.0.1-2.33.1
MozillaFirefox-translations-common-14.0.1-2.33.1
MozillaFirefox-translations-other-14.0.1-2.33.1
- openSUSE 11.4 (i586 x86\_64):
MozillaFirefox-14.0.1-28.1
MozillaFirefox-branding-upstream-14.0.1-28.1
MozillaFirefox-buildsymbols-14.0.1-28.1
MozillaFirefox-debuginfo-14.0.1-28.1
MozillaFirefox-debugsource-14.0.1-28.1
MozillaFirefox-devel-14.0.1-28.1
MozillaFirefox-translations-common-14.0.1-28.1
MozillaFirefox-translations-other-14.0.1-28.1
References:
<http://support.novell.com/security/cve/CVE-2012-1948.html>
<http://support.novell.com/security/cve/CVE-2012-1949.html>
<http://support.novell.com/security/cve/CVE-2012-1950.html>
<http://support.novell.com/security/cve/CVE-2012-1951.html>
<http://support.novell.com/security/cve/CVE-2012-1952.html>
<http://support.novell.com/security/cve/CVE-2012-1953.html>
<http://support.novell.com/security/cve/CVE-2012-1954.html>
<http://support.novell.com/security/cve/CVE-2012-1955.html>
<http://support.novell.com/security/cve/CVE-2012-1957.html>
<http://support.novell.com/security/cve/CVE-2012-1958.html>
<http://support.novell.com/security/cve/CVE-2012-1959.html>
<http://support.novell.com/security/cve/CVE-2012-1961.html>
<http://support.novell.com/security/cve/CVE-2012-1962.html>
<http://support.novell.com/security/cve/CVE-2012-1963.html>
<http://support.novell.com/security/cve/CVE-2012-1964.html>
<http://support.novell.com/security/cve/CVE-2012-1965.html>
<http://support.novell.com/security/cve/CVE-2012-1966.html>
<http://support.novell.com/security/cve/CVE-2012-1967.html>
<https://bugzilla.novell.com/771583>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B/#2QN5R2ILBMVRYQO2D4JZFUMQ5C3OYF3B)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_f2be0ec9_20250125_192916.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/765179)
* [XML](/show_bug.cgi?ctype=xml&id=765179)

Closed
[Bug 765179](/show_bug.cgi?id=765179)

Opened 13 years ago
Closed 13 years ago

# WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier]

## Categories

### (Core :: Graphics: CanvasWebGL, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20CanvasWebGL#Graphics%3A%20CanvasWebGL)

Graphics: CanvasWebGL
▾

Core :: Graphics: CanvasWebGL
Bugs with the WebGL Canvas Context.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20CanvasWebGL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla15

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox16 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox14 |  | fixed |
| firefox15 |  | fixed |
| firefox16 |  | fixed |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: posidron, Assigned: bjacob)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=40)  [posidron](/user_profile?user_id=368570)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[765161](/show_bug.cgi?id=765161 "RESOLVED DUPLICATE - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier] (dupe)")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [asan][advisory-tracking+] webgl-test-needed)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[asan][advisory-tracking+] webgl-test-needed

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [testcase](/attachment.cgi?id=633467)  [13 years ago](#c0)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   1.60 KB, text/html |  | [Details](/attachment.cgi?id=633467&action=edit) |
| --- | --- | --- |
| [callstack](/attachment.cgi?id=633469)  [13 years ago](#c1)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   6.70 KB, text/plain |  | [Details](/attachment.cgi?id=633469&action=edit) |
| [check for empty variable names](/attachment.cgi?id=633539)  [13 years ago](#c3)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   905 bytes, patch | jgilbert : [review+](#c10 "13 years ago")  lsblakk : [approval-mozilla-aurora+](#a303588_272375 "13 years ago")  lsblakk : [approval-mozilla-beta+](#a303588_272375 "13 years ago") | [Details](/attachment.cgi?id=633539&action=edit) | [Diff](/attachment.cgi?id=633539&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633539) |
| [check for empty string in SplitLastSquareBracket](/attachment.cgi?id=633661)  [13 years ago](#c9)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.09 KB, patch | jgilbert : [review+](#a37524_419431 "13 years ago")  lsblakk : [approval-mozilla-aurora+](#a303612_272375 "13 years ago")  lsblakk : [approval-mozilla-beta+](#a303612_272375 "13 years ago") | [Details](/attachment.cgi?id=633661&action=edit) | [Diff](/attachment.cgi?id=633661&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633661) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=765179#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=633467)
— [Details](attachment.cgi?id=633467&action=edit)

This bug is related to [bug 765161](/show_bug.cgi?id=765161 "RESOLVED DUPLICATE - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier] (dupe)").
A square bracket value as the third parameter of bindAttribLocation() will result in a crash. An empty string '' will also lead to a crash. Although this bug is most likely caused by the same issue described in [bug 765161](/show_bug.cgi?id=765161 "RESOLVED DUPLICATE - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier] (dupe)"), I have created a separate bug for this particular method.
gl.bindAttribLocation(pg, 1, []);

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=765179#c1)• 13 years ago |
|  | |

Attached file
[callstack](attachment.cgi?id=633469)
— [Details](attachment.cgi?id=633469&action=edit)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a115_280903)• 13 years ago |

Group: core-security

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=765179#c2)• 13 years ago |
|  | |

[] stringifies to "", so this is exactly the same as [bug 765161](/show_bug.cgi?id=765161 "RESOLVED DUPLICATE - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier] (dupe)").Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → DUPLICATE

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=765179#c3)• 13 years ago |
|  | |

Attached patch

[check for empty variable names](attachment.cgi?id=633539&action=diff)
— [Details](attachment.cgi?id=633539&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633539)

This should fix it, although i am running in Valgrind at the moment to confirm.
When the testcase calls BindAttribLocation with [] as the attribute name string parameter, the string that the DOM bindings pass to WebGLContext::BindAttribLocation is an empty string (but not a null string). So IsEmpty() is the right check for that. Doing it in ValidateGLSLVariableName() allows to fix this bug also in other functions that take such strings and do this long-identifier-mapping work on them: GetAttribLocation and GetUniformLocation.
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: review?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=765179#c4)• 13 years ago |
|  | |

Boris: is it normal that the DOM bindings silently accept [] as a DOMString parameter and silently convert [] to an empty string?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=765179#c5)• 13 years ago |
|  | |

Oh, I hadn't seen [comment 2](/show_bug.cgi?id=765179#c2 "VERIFIED FIXED - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier]"). OK.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=765179#c6)• 13 years ago |
|  | |

Moving to [bug 765161](/show_bug.cgi?id=765161 "RESOLVED DUPLICATE - WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier] (dupe)") which is more to the point indeed.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a17319_382769)• 13 years ago |

[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: review?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=765179#c7)• 13 years ago |
|  | |

No valgrind errors with this patch.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=765179#c8)• 13 years ago |
|  | |

> Boris: is it normal that the DOM bindings silently accept [] as a DOMString parameter
Yes. When something is passed to a string parameter, the normal ToString() algorithm from the JS spec is applied; for an empty array that produces "".

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=765179#c9)• 13 years ago |
|  | |

Attached patch

[check for empty string in SplitLastSquareBracket](attachment.cgi?id=633661&action=diff)
— [Details](attachment.cgi?id=633661&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633661)

As Jeff points out, this is the real fix, the other patch was just avoiding the problem. For safety, we probably want both.
[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: review?(jgilbert)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a37524_419431)• 13 years ago |

[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: review?(jgilbert) → review+

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=765179#c10)• 13 years ago |
|  | |

Comment on [attachment 633539](/attachment.cgi?id=633539 "check for empty variable names") [[details]](/attachment.cgi?id=633539&action=edit "check for empty variable names") [[diff]](/attachment.cgi?id=633539&action=diff "check for empty variable names") [[review]](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633539)
check for empty variable names
Review of [attachment 633539](/attachment.cgi?id=633539 "check for empty variable names") [[details]](/attachment.cgi?id=633539&action=edit "check for empty variable names") [[diff]](/attachment.cgi?id=633539&action=diff "check for empty variable names") [[review]](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633539):
-----------------------------------------------------------------
This is good to have even just as an early-out.
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=765179#c11)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/cbe259c0ba18>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/cebbfb5c0e02>
Reopening just because the patch review ended up happening on this bug rather than the other one.Assignee: nobody → bjacobStatus: RESOLVED → REOPENEDResolution: DUPLICATE → ---Whiteboard: [asan] → [asan] webgl-test-neededTarget Milestone: --- → mozilla15

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=765179#c13)• 13 years ago |
|  | |

Comment on [attachment 633539](/attachment.cgi?id=633539 "check for empty variable names") [[details]](/attachment.cgi?id=633539&action=edit "check for empty variable names") [[diff]](/attachment.cgi?id=633539&action=diff "check for empty variable names") [[review]](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633539)
check for empty variable names
[Approval Request Comment]
Bug caused by (feature/regressing bug #): at least the crash on empty string has occurred ever since we did long identifier mapping (Gecko 13).
User impact if declined: serious crash, security sensitive
Testing completed (on m-c, etc.): m-i
Risk to taking this patch (and alternatives if risky): no risk, trivial patch checking for empty strings
String or UUID changes made by this patch: none
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: approval-mozilla-aurora?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=765179#c14)• 13 years ago |
|  | |

Comment on [attachment 633661](/attachment.cgi?id=633661 "check for empty string in SplitLastSquareBracket") [[details]](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") [[diff]](/attachment.cgi?id=633661&action=diff "check for empty string in SplitLastSquareBracket") [[review]](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633661)
check for empty string in SplitLastSquareBracket
[Approval Request Comment]
Bug caused by (feature/regressing bug #): at least the crash on empty string has occurred ever since we did long identifier mapping (Gecko 13).
User impact if declined: serious crash, security sensitive
Testing completed (on m-c, etc.): m-i
Risk to taking this patch (and alternatives if risky): no risk, trivial patch checking for empty strings
String or UUID changes made by this patch: none
[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a46283_425645)• 13 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=765179#c15)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/cbe259c0ba18>
<https://hg.mozilla.org/mozilla-central/rev/cebbfb5c0e02>Status: REOPENED → RESOLVEDClosed: 13 years ago → 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=765179#c16)• 13 years ago |
|  | |

I'm not sure what "sec-other" signifies here, that means "not s security bug, hidden for some other reason" but this looks like it's either a security bug or not sensitive at all.
If you were clever enough to arrange memory blocks (see upcoming blackhat talk on jemalloc) so that the block allocated next to string ended in a ']' then SplitLastSquareBracket would back up into some other block's memory until you found a '[' (or crashed harmlessly on an access violation, but we're already assuming a clever attacker who arranged a ']' at the end of the block). Then it'd slurp up the contents into the bracketPart (could the attacker read this back?) and stomp a null in this other block. Potentially exploitable but wouldn't be easy.
Shouldn't we try to get this into Beta as well?
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed)Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---) → [regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=765179#c17)• 13 years ago |
|  | |

Comment on [attachment 633539](/attachment.cgi?id=633539 "check for empty variable names") [[details]](/attachment.cgi?id=633539&action=edit "check for empty variable names") [[diff]](/attachment.cgi?id=633539&action=diff "check for empty variable names") [[review]](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633539)
check for empty variable names
[Approval Request Comment]
Same as for aurora. This does affect beta as well.
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: approval-mozilla-beta?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=765179#c18)• 13 years ago |
|  | |

Comment on [attachment 633661](/attachment.cgi?id=633661 "check for empty string in SplitLastSquareBracket") [[details]](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") [[diff]](/attachment.cgi?id=633661&action=diff "check for empty string in SplitLastSquareBracket") [[review]](/page.cgi?id=splinter.html&ignore=&bug=765179&attachment=633661)
check for empty string in SplitLastSquareBracket
[Approval Request Comment]
Same as for aurora. This does affect beta as well.
[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: approval-mozilla-beta?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a111776_382769)• 13 years ago |

Summary: WebGL crash with bindAttribLocation bracket parameter [@mozilla::WebGLProgram::MapIdentifier] → WebGL crash when empty string is passed to getUniformLocation, getAttribLocation or bindAttribLocation [@mozilla::WebGLProgram::MapIdentifier]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=765179#c19)• 13 years ago |
|  | |

I just tried the testcase on OS X with the current Aurora build (6-18) and the last released Firefox and I cannot get a crash with it. Is there a particular video card or environment needed to trigger this issue?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=765179#c20)• 13 years ago |
|  | |

No, it should be independent of the video card, but since it's undefined behavior depending on the contents of memory beyond the end of an allocated buffer, it's not too surprising that this doesn't reproduce everywhere.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=765179#c21)• 13 years ago |
|  | |

(I reproduced on first try on Linux 64-bit)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a303588_272375)• 13 years ago |

[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: approval-mozilla-beta?
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: approval-mozilla-beta+
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: approval-mozilla-aurora?
[Attachment #633539](/attachment.cgi?id=633539&action=edit "check for empty variable names") -
Flags: approval-mozilla-aurora+

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a303612_272375)• 13 years ago |

[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: approval-mozilla-beta?
[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: approval-mozilla-beta+
[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: approval-mozilla-aurora?
[Attachment #633661](/attachment.cgi?id=633661&action=edit "check for empty string in SplitLastSquareBracket") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=765179#c22)• 13 years ago |
|  | |

All right. Well, I have OS X and virtual machines of others, which may or may not help. I tried in Windows 7 and Ubuntu 12.04 64-bit and could not reproduce the crash in these either. I guess someone in QA will have to verify this fix.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=765179#c23)• 13 years ago |
|  | |

I can verify that the bug is fixed.Status: RESOLVED → VERIFIED

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=765179#c24)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/25409d56dde5>
<http://hg.mozilla.org/releases/mozilla-aurora/rev/dc053a16a5d9>
<http://hg.mozilla.org/releases/mozilla-beta/rev/61d6118ed89d>
<http://hg.mozilla.org/releases/mozilla-beta/rev/1a95b498abe3>
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a2187761_280903)• 13 years ago |

Whiteboard: [asan] webgl-test-needed → [asan][advisory-tracking+] webgl-test-needed

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=765179#a3077234_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=765179&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_179e9bbd_20250125_192912.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/754725)
* [XML](/show_bug.cgi?ctype=xml&id=754725)

Closed
[Bug 754725](/show_bug.cgi?id=754725)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: (ptrBits & 0x7) == 0, at jsval.h:760 or Crash [@ compartment]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: (ptrBits & 0x7) == 0, at jsval.h:760 or Crash [@ compartment]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla16

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox13 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix) |
| firefox14 | [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed) |
| firefox15 | [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed) |
| firefox16 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox13 |  | wontfix |
| firefox14 | + | fixed |
| firefox15 | + | fixed |
| firefox16 |  | fixed |
| firefox-esr10 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: billm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [js:p1:fx16][sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore][advisory-tracking+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[js:p1:fx16][sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore][advisory-tracking+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c14 "12 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::gc::MarkInternal<JSString> ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Agc%3A%3AMarkInternal%3CJSString%3E)

[[@ compartment ]](https://crash-stats.mozilla.org/signature/?signature=compartment)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=632965)  [13 years ago](#c5)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   2.26 KB, patch | bhackett1024 : [review+](#a2763011_346231 "13 years ago")  lsblakk : [approval-mozilla-aurora+](#c11 "13 years ago")  lsblakk : [approval-mozilla-beta+](#c11 "13 years ago") | [Details](/attachment.cgi?id=632965&action=edit) | [Diff](/attachment.cgi?id=632965&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=754725&attachment=632965) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=754725#c0)• 13 years ago |
|  | |

The following test asserts/crashes on mozilla-central revision c758cc9b60e5 (options -m -n):
try {
function fun() {
(new fun (("10"))) ('function pf' + (((true) )[ fun ]) + '() {}');
}
fun();
} catch(exc1) {}
function eval() { eval( ) ; }
function DoWhile\_3()
eval();
try {
DoWhile\_3( ) ;
} catch(e) { }
function f()
test();
function test() {
try {
for (var i in f());
} catch ( foopy ) { }
gc();
}
test();
Backtrace in Opt build:
==7571== Invalid read of size 8
==7571== at 0x5781C1: void js::gc::MarkInternal<JSString>(JSTracer\*, JSString\*\*) (Heap.h:969)
==7571== by 0x5799BD: js::gc::MarkValueInternal(JSTracer\*, JS::Value\*) (Marking.cpp:329)
==7571== by 0x579BBE: js::gc::MarkValueRootRange(JSTracer\*, unsigned long, JS::Value\*, char const\*) (Marking.cpp:369)
==7571== by 0x5384B1: js::StackSpace::mark(JSTracer\*) (Stack.cpp:527)
==7571== by 0x4567DD: \_ZN2jsL11MarkRuntimeEP8JSTracerb.clone.246 (jsgc.cpp:2325)
==7571== by 0x456D37: BeginMarkPhase(JSRuntime\*) (jsgc.cpp:2975)
==7571== by 0x45A210: GCCycle(JSRuntime\*, bool, long, js::JSGCInvocationKind) (jsgc.cpp:3271)
==7571== by 0x45B38F: Collect(JSRuntime\*, bool, long, js::JSGCInvocationKind, js::gcreason::Reason) (jsgc.cpp:3719)
==7571== by 0x56C80C: GC(JSContext\*, unsigned int, JS::Value\*) (TestingFunctions.cpp:52)
==7571== by 0x47E337: js::InvokeKernel(JSContext\*, js::CallArgs, js::MaybeConstruct) (jscntxtinlines.h:426)
==7571== by 0x47A234: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2744)
==7571== by 0x5F9DDD: UncachedInlineCall(js::VMFrame&, js::InitialFrameFlags, void\*\*, bool\*, unsigned int) (InvokeHelpers.cpp:376)
==7571== Address 0xe3000 is not stack'd, malloc'd or (recently) free'd
Assuming s-s and sec-critical due to GC related crash. Furthermore, this crash affects mozilla-aurora and mozilla-beta as well.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a431_389993)• 13 years ago |

Assignee: general → wmccloskey

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=754725#c1)• 13 years ago |
|  | |

Just testing some new JSBugMon functionality here.Whiteboard: [sg:critical] js-triage-needed → [sg:critical] js-triage-needed [jsbugmon:verify-branch:mozilla-aurora,mozilla-beta,mozilla-release]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=754725#c2)• 13 years ago |
|  | |

Should probably learn my own syntax...Whiteboard: [sg:critical] js-triage-needed [jsbugmon:verify-branch:mozilla-aurora,mozilla-beta,mozilla-release] → [sg:critical] js-triage-needed [jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=754725#c3)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically confirmed to be still valid on branch mozilla-aurora (reproduced on revision 56d137349efc).
JSBugMon: This bug has been automatically confirmed to be still valid on branch mozilla-beta (reproduced on revision 0540130b5f2f).
JSBugMon: The testcase found in this bug does not reproduce on branch mozilla-release (tried revision 5bcfa0da3be9).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a50733_395101)• 13 years ago |

Crash Signature: [@ js::gc::MarkInternal<JSString>]
[@ compartment] → [@ js::gc::MarkInternal<JSString>]
[@ compartment]Whiteboard: [sg:critical] js-triage-needed [jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release] → [sg:critical] js-triage-needed [jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a85139_425645)• 13 years ago |

Crash Signature: [@ js::gc::MarkInternal<JSString>]
[@ compartment] → [@ js::gc::MarkInternal<JSString>]
[@ compartment]
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B)
[tracking-firefox14](/buglist.cgi?f1=cf_tracking_firefox14&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox14&o1=equals&v1=%2B)
[tracking-firefox15](/buglist.cgi?f1=cf_tracking_firefox15&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox15&o1=equals&v1=%2B)

|  | [Naveed Ihsanullah [:naveed]](/user_profile?user_id=441971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a324959_441971)• 13 years ago |

Whiteboard: [sg:critical] js-triage-needed [jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore] → [sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore][js:p1:fx15]]

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=754725#c4)• 13 years ago |
|  | |

Moving this back a cycle--IGC takes priority.Whiteboard: [sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore][js:p1:fx15]] → [js:p1:fx16][sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore]

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=754725#c5)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=632965&action=diff)
— [Details](attachment.cgi?id=632965&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=754725&attachment=632965)

In this test, we have a dead value on the VM stack. It contains garbage--in this case, the tag makes it look like a NullValue, but the low bits are nonzero so that isNull() is false. We do one GC and avoid marking the value because it's dead. However, we don't overwrite it with anything because it's not an object or a string. Later, we do a second GC and try to mark it. isGCThing() returns true because something with a NULL tag counts as a GC thing. But then when we convert it to a Cell and try to mark it, we crash.
The fix is to normalize the low bits of the value while still leaving the tag unaffected.
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: review?(bhackett1024)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a2763011_346231)• 13 years ago |

[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: review?(bhackett1024) → review+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=754725#c6)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/84af366e007f>Target Milestone: --- → mozilla16

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=754725#c7)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/84af366e007f>Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox16](/buglist.cgi?f1=cf_status_firefox16&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox16&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=754725#c8)• 13 years ago |
|  | |

Am I interpreting [comment 3](/show_bug.cgi?id=754725#c3 "VERIFIED FIXED - Assertion failure: (ptrBits & 0x7) == 0, at jsval.h:760 or Crash [@ compartment]") correctly that this is a regression in Firefox 13, and therefore doesn't affect the ESR branch? Although if we don't know the cause of the regression we might still need it if it was due to a security fix taken on that branch.
qawanted: please find when this bug crept in.
[status-firefox13](/buglist.cgi?f1=cf_status_firefox13&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox13&o1=equals&v1=wontfix)
[tracking-firefox13](/buglist.cgi?f1=cf_tracking_firefox13&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox13&o1=equals&v1=%2B) → ---Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=754725#c9)• 13 years ago |
|  | |

Comment on [attachment 632965](/attachment.cgi?id=632965 "patch") [[details]](/attachment.cgi?id=632965&action=edit "patch") [[diff]](/attachment.cgi?id=632965&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=754725&attachment=632965)
patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [Bug 723313](/show_bug.cgi?id=723313 "RESOLVED FIXED - Stop using conservative stack scanner for VM stack marking")
User impact if declined: Low likelihood of GC crashes, exploits.
Testing completed (on m-c, etc.): On m-c.
Risk to taking this patch (and alternatives if risky): Low. Semantics should be unchanged except when the bug happens.
String or UUID changes made by this patch: None
Regarding ESR, there's no need to take this. It regressed in FF13.
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=754725#c10)• 13 years ago |
|  | |

(removing keywords because [bug 723313](/show_bug.cgi?id=723313 "RESOLVED FIXED - Stop using conservative stack scanner for VM stack marking") has been identified as the regressor)Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=754725#c11)• 13 years ago |
|  | |

Comment on [attachment 632965](/attachment.cgi?id=632965 "patch") [[details]](/attachment.cgi?id=632965&action=edit "patch") [[diff]](/attachment.cgi?id=632965&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=754725&attachment=632965)
patch
low risk, sec critical - approving.
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #632965](/attachment.cgi?id=632965&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=754725#c12)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/1f4ac5f52188>
<https://hg.mozilla.org/releases/mozilla-beta/rev/6a43080525ab>
[status-firefox14](/buglist.cgi?f1=cf_status_firefox14&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox14&o1=equals&v1=fixed)
[status-firefox15](/buglist.cgi?f1=cf_status_firefox15&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox15&o1=equals&v1=fixed)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=754725#c13)• 13 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a3968515_395101)• 13 years ago |

Status: RESOLVED → VERIFIEDCrash Signature: [@ js::gc::MarkInternal<JSString>]
[@ compartment] → [@ js::gc::MarkInternal<JSString>]
[@ compartment]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a4581527_425645)• 13 years ago |

Crash Signature: [@ js::gc::MarkInternal<JSString>]
[@ compartment] → [@ js::gc::MarkInternal<JSString>]
[@ compartment]
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=unaffected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a4993377_280903)• 13 years ago |

Whiteboard: [js:p1:fx16][sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore] → [js:p1:fx16][sg:critical][jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release,ignore][advisory-tracking+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=754725#a5885100_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=754725#c14)• 12 years ago |
|  | |

Test is too slow to be added and I did not succeed in rewriting, marking in-testsuite-.Flags: in-testsuite-
You need to [log in](/show_bug.cgi?id=754725&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


