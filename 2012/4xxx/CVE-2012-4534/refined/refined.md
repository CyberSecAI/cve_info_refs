```
RELATED
```

**Root cause of vulnerability:**

The vulnerability is triggered when using the NIO connector with sendfile and HTTPS enabled. If a client breaks the connection while reading the response, an infinite loop is entered. This occurs due to incorrect handling of socket registration during sendfile operations.

**Weaknesses/vulnerabilities present:**

- Improper handling of connection closure during sendfile operations.
- Incomplete fix for a previous similar issue.

**Impact of exploitation:**

- Remote Denial of Service (DoS): By breaking the connection during a sendfile operation, an attacker can cause the server to enter an infinite loop, consuming CPU resources and preventing it from serving other requests.

**Attack vectors:**

- A remote attacker can send a request for a large file over HTTPS using the NIO connector, then prematurely terminate the connection.

**Required attacker capabilities/position:**

- The attacker needs to be able to make requests to the vulnerable service and then abruptly close the connection.
- No special permissions or credentials are required.

**Additional details:**

- The fix involves making sure that interest in OP_READ is not registered while a sendfile write is still in progress.
- A workaround is to set useSendfile="false" on the NIO connector, which avoids the problematic code path.
- The issue was originally reported as bug 52858 in the Apache Bugzilla and is related to the fix for CVE-2012-2733.
- The bug was introduced in Tomcat 7.0.27 and fixed in 7.0.28, as well as in Tomcat 6.0.36.
- Several distributions (e.g., openSUSE, Ubuntu, Red Hat) have also issued patches for this vulnerability.
```