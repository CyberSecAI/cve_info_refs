=== Content from access.redhat.com_75cf800a_20250126_123345.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from git.kernel.org_f5687af7_20250126_123346.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Darren Hart <dvhart@linux.intel.com> | 2012-07-20 11:53:31 -0700 |
| --- | --- | --- |
| committer | Thomas Gleixner <tglx@linutronix.de> | 2012-07-24 16:02:57 +0200 |
| commit | [6f7b0a2a5c0fb03be7c25bd1745baa50582348ef](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)) | |
| tree | [23bf0f7ccfeea44ef9aa8057d53ade47b69a8a44](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef) | |
| parent | [f27071cb7fe3e1d37a9dbe6c0dfc5395cd40fa43](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f27071cb7fe3e1d37a9dbe6c0dfc5395cd40fa43) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef&id2=f27071cb7fe3e1d37a9dbe6c0dfc5395cd40fa43)) | |
| download | [linux-6f7b0a2a5c0fb03be7c25bd1745baa50582348ef.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6f7b0a2a5c0fb03be7c25bd1745baa50582348ef.tar.gz) | |

futex: Forbid uaddr == uaddr2 in futex\_wait\_requeue\_pi()If uaddr == uaddr2, then we have broken the rule of only requeueing
from a non-pi futex to a pi futex with this call. If we attempt this,
as the trinity test suite manages to do, we miss early wakeups as
q.key is equal to key2 (because they are the same uaddr). We will then
attempt to dereference the pi\_mutex (which would exist had the futex\_q
been properly requeued to a pi futex) and trigger a NULL pointer
dereference.
Signed-off-by: Darren Hart <dvhart@linux.intel.com>
Cc: Dave Jones <davej@redhat.com>
Cc: stable@vger.kernel.org
Link: [http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart@linux.intel.com](http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart%40linux.intel.com)
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)

| -rw-r--r-- | [kernel/futex.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/futex.c?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 5 deletions

| diff --git a/kernel/futex.c b/kernel/futex.cindex 5551adaf7cdfda..3717e7b306e08c 100644--- a/[kernel/futex.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/futex.c?id=f27071cb7fe3e1d37a9dbe6c0dfc5395cd40fa43)+++ b/[kernel/futex.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/futex.c?id=6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)@@ -2231,11 +2231,11 @@ int handle\_early\_requeue\_pi\_wakeup(struct futex\_hash\_bucket \*hb, \* @uaddr2: the pi futex we will take prior to returning to user-space \* \* The caller will wait on uaddr and will be requeued by futex\_requeue() to- \* uaddr2 which must be PI aware. Normal wakeup will wake on uaddr2 and- \* complete the acquisition of the rt\_mutex prior to returning to userspace.- \* This ensures the rt\_mutex maintains an owner when it has waiters; without- \* one, the pi logic wouldn't know which task to boost/deboost, if there was a- \* need to.+ \* uaddr2 which must be PI aware and unique from uaddr. Normal wakeup will wake+ \* on uaddr2 and complete the acquisition of the rt\_mutex prior to returning to+ \* userspace. This ensures the rt\_mutex maintains an owner when it has waiters;+ \* without one, the pi logic would not know which task to boost/deboost, if+ \* there was a need to. \* \* We call schedule in futex\_wait\_queue\_me() when we enqueue and return there \* via the following:@@ -2272,6 +2272,9 @@ static int futex\_wait\_requeue\_pi(u32 \_\_user \*uaddr, unsigned int flags, struct futex\_q q = futex\_q\_init; int res, ret; + if (uaddr == uaddr2)+ return -EINVAL;+ if (!bitset) return -EINVAL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 12:32:23 +0000



=== Content from bugzilla.redhat.com_a86adb42_20250125_225058.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1097746)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1097746)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1097746)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1097746

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1097746**](show_bug.cgi?id=1097746)
(CVE-2012-6647)
- [CVE-2012-6647](https://access.redhat.com/security/cve/CVE-2012-6647) Kernel: futex: forbid uaddr == uaddr2 in futex\_wait\_requeue\_pi()

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2012-6647 Kernel: futex: forbid uaddr == uaddr2 in futex\_wait\_requeue\_pi()

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2012-6647 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1097759](show_bug.cgi?id=1097759) [1097760](show_bug.cgi?id=1097760) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1097133](show_bug.cgi?id=1097133) | | TreeView+ | [depends on](buglist.cgi?bug_id=1097746&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1097746&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2014-05-14 12:48 UTC by Prasad Pandit | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 06:33 UTC ([History](show_activity.cgi?id=1097746)) | | [CC List:](page.cgi?id=fields.html#cclist) | 33 users (show)  agordeev aquini bhu carnil davej dhoward esammons fhrbata gansalmon iboverma itamar jforbes jkacur jkurik jonathan jross jwboyer kernel-maint kernel-mgr lgoncalv lwang madhu.chinakonda matt mchehab mcressma nobody npajkovs pholasek plougher pmatouse rt-maint rvrbovsk williams | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A NULL pointer dereference flaw was found in the way the futex\_wait\_requeue\_pi() function of the Linux kernel's futex subsystem handled the requeuing of certain Priority Inheritance (PI) futexes. A local, unprivileged user could use this flaw to crash the system. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2014-07-29 16:16:03 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2014:0981](https://access.redhat.com/errata/RHSA-2014%3A0981) | 0 | normal | SHIPPED\_LIVE | Important: kernel security, bug fix, and enhancement update | 2014-07-29 19:51:12 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1097746#c0)  Prasad Pandit    2014-05-14 12:48:01 UTC  ``` Linux kernel built with the fast userspace mutexes(CONFIG_FUTEX) support is vulnerable to a NULL pointer dereference flaw. It could occur when a waiting task requests wait to be re-queued from non-PI futex to a PI-aware futex via FUTEX_WAIT_REQUEUE_PI operation.  An unprivileged user/program could use this flaw to crash the system kernel resulting in DoS.  Upstream fix: -------------   -> <https://git.kernel.org/linus/6f7b0a2a5c0fb03be7c25bd1745baa50582348ef>  Introduced in: --------------   -> <https://git.kernel.org/linus/52400ba946759af28442dee6265c5c0180ac7122>   ```  [Comment 1](show_bug.cgi?id=1097746#c1)  Prasad Pandit    2014-05-14 13:16:53 UTC  ``` Statement:  This issue does not affect the versions of the kernel package as shipped with Red Hat Enterprise Linux 5 and 7, and Red Hat Enterprise MRG 2.   ```  [Comment 4](show_bug.cgi?id=1097746#c4)  Martin Prpič    2014-07-29 11:20:57 UTC  ``` IssueDescription:  A NULL pointer dereference flaw was found in the way the futex_wait_requeue_pi() function of the Linux kernel's futex subsystem handled the requeuing of certain Priority Inheritance (PI) futexes. A local, unprivileged user could use this flaw to crash the system.   ```  [Comment 5](show_bug.cgi?id=1097746#c5)  errata-xmlrpc    2014-07-29 15:53:38 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2014:0981 <https://rhn.redhat.com/errata/RHSA-2014-0981.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1097746&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.kernel.org_b73fa9ce_20250125_225050.html ===
commit cbd3c20ba161fdb64c37b3a28e22a9d9ae92f8fc
Author: Greg Kroah-Hartman
Date: Thu Aug 9 08:23:56 2012 -0700
Linux 3.5.1
commit d96a21b1f4a68be68d2dcf7f02e224b9daee0c2c
Author: Darren Hart
Date: Fri Jul 20 11:53:31 2012 -0700
futex: Forbid uaddr == uaddr2 in futex\_wait\_requeue\_pi()
commit 6f7b0a2a5c0fb03be7c25bd1745baa50582348ef upstream.
If uaddr == uaddr2, then we have broken the rule of only requeueing
from a non-pi futex to a pi futex with this call. If we attempt this,
as the trinity test suite manages to do, we miss early wakeups as
q.key is equal to key2 (because they are the same uaddr). We will then
attempt to dereference the pi\_mutex (which would exist had the futex\_q
been properly requeued to a pi futex) and trigger a NULL pointer
dereference.
Signed-off-by: Darren Hart
Cc: Dave Jones
Link: http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart@linux.intel.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 20b8502553fb79a8ff3afc7562be25d592620430
Author: Darren Hart
Date: Fri Jul 20 11:53:30 2012 -0700
futex: Fix bug in WARN\_ON for NULL q.pi\_state
commit f27071cb7fe3e1d37a9dbe6c0dfc5395cd40fa43 upstream.
The WARN\_ON in futex\_wait\_requeue\_pi() for a NULL q.pi\_state was testing
the address (&q.pi\_state) of the pointer instead of the value
(q.pi\_state) of the pointer. Correct it accordingly.
Signed-off-by: Darren Hart
Cc: Dave Jones
Link: http://lkml.kernel.org/r/1c85d97f6e5f79ec389a4ead3e367363c74bd09a.1342809673.git.dvhart@linux.intel.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 2af04b6882c1200d0d2a2ab4d4925564c577ad5c
Author: Darren Hart
Date: Fri Jul 20 11:53:29 2012 -0700
futex: Test for pi\_mutex on fault in futex\_wait\_requeue\_pi()
commit b6070a8d9853eda010a549fa9a09eb8d7269b929 upstream.
If fixup\_pi\_state\_owner() faults, pi\_mutex may be NULL. Test
for pi\_mutex != NULL before testing the owner against current
and possibly unlocking it.
Signed-off-by: Darren Hart
Cc: Dave Jones
Cc: Dan Carpenter
Link: http://lkml.kernel.org/r/dc59890338fc413606f04e5c5b131530734dae3d.1342809673.git.dvhart@linux.intel.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 34fbbeb1bd9c5d68d136eeaba9b305bed45417f5
Author: Andreas Schwab
Date: Sat Jul 28 00:20:34 2012 +0200
m68k: Make sys\_atomic\_cmpxchg\_32 work on classic m68k
commit 9e2760d18b3cf179534bbc27692c84879c61b97c upstream.
User space access must always go through uaccess accessors, since on
classic m68k user space and kernel space are completely separate.
Signed-off-by: Andreas Schwab
Tested-by: Thorsten Glaser
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Greg Kroah-Hartman
commit c36bb21c03a24e94c2897d16372b736ab2ebbec6
Author: Mark Brown
Date: Fri Jun 22 17:21:17 2012 +0100
ASoC: wm8994: Ensure there are enough BCLKs for four channels
commit b8edf3e5522735c8ce78b81845f7a1a2d4a08626 upstream.
Otherwise if someone tries to use all four channels on AIF1 with the
device in master mode we won't be able to clock out all the data.
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 4bf81b7590da5bf13f7ac0a52f0032dd16f149b1
Author: Mark Brown
Date: Mon Jul 30 18:24:19 2012 +0100
ASoC: wm8962: Allow VMID time to fully ramp
commit 9d40e5582c9c4cfb6977ba2a0ca9c2ed82c56f21 upstream.
Required for reliable power up from cold.
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 8f6a527268146a563bbdee2421cb8b22d7354a61
Author: Takashi Iwai
Date: Thu Aug 2 09:04:39 2012 +0200
ALSA: hda - Support dock on Lenovo Thinkpad T530 with ALC269VC
commit 707fba3fa76a4c8855552f5d4c1a12430c09bce8 upstream.
Lenovo Thinkpad T530 with ALC269VC codec has a dock port but BIOS
doesn't set up the pins properly. Enable the pins as well as on
Thinkpad X230 Tablet.
Reported-and-tested-by: Mario
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 0186cfbb3c0036f896df6b72fd195997d6c865d8
Author: Takashi Iwai
Date: Tue Jul 31 10:40:05 2012 +0200
ALSA: hda - Fix mute-LED GPIO initialization for IDT codecs
commit 1f43f6c1bc8d740e75b4177eb29110858bb5fea2 upstream.
The IDT codecs initializes the GPIO setup for mute LEDs via
snd\_hda\_sync\_vmaster\_hook(). This works in most cases except for the
very first call, which is called before PCM and control creations.
Thus before Master switch is set manually via alsactl, the mute LED
may show the wrong state, depending on the polarity.
Now it's fixed by calling the LED-status update function manually when
no vmaster is set yet.
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 96eea0fe908f3bdc58a08f70b274e72c88f2b834
Author: Takashi Iwai
Date: Tue Jul 31 10:16:59 2012 +0200
ALSA: hda - Fix polarity of mute LED on HP Mini 210
commit ff8a1e274cbc11da6b57849f925b895a212b56c9 upstream.
The commit a3e199732b made the LED working again on HP Mini 210 but
with a wrong polarity. This patch fixes the polarity for this
machine, and also introduce a new model string "hp-inv-led".
Bugzilla: https://bugzilla.novell.com/show\_bug.cgi?id=772923
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 08c77b80953536c1efb75690471f8ecd3f59f4dd
Author: Takashi Iwai
Date: Thu Jul 26 08:17:20 2012 +0200
ALSA: hda - Fix mute-LED GPIO setup for HP Mini 210
commit a3e199732b8e2b272e82cc1ccc49c35239ed6c5a upstream.
BIOS on HP Mini 210 doesn't provide the proper "HP\_Mute\_LED" DMI
string, thus the driver doesn't initialize the GPIO, too. In the
earlier kernel, the driver falls back to GPIO1, but since 3.3 we've
stopped this due to other wrongly advertised machines.
For fixing this particular case, add a new model type to specify the
default polarity explicitly so that the fallback to GPIO1 is handled.
Bugzilla: https://bugzilla.novell.com/show\_bug.cgi?id=772923
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 41fb99e03f1f46d8d96498bb8553e4034f5c5c8b
Author: Takashi Iwai
Date: Wed Jul 25 13:54:55 2012 +0200
ALSA: hda - Fix invalid D3 of headphone DAC on VT202x codecs
commit 6162552b0de6ba80937c3dd53e084967851cd199 upstream.
We've got a bug report about the silent output from the headphone on a
mobo with VT2021, and spotted out that this was because of the wrong
D3 state on the DAC for the headphone output. The bug is triggered by
the incomplete check for this DAC in set\_widgets\_power\_state\_vt1718S().
It checks only the connectivity of the primary output (0x27) but
doesn't consider the path from the headphone pin (0x28).
Now this patch fixes the problem by checking both pins for DAC 0x0b.
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 24da61a63c0b48b831f8ed92835da74b265437d1
Author: Takashi Iwai
Date: Mon Jul 23 11:35:55 2012 +0200
ALSA: mpu401: Fix missing initialization of irq field
commit bc733d495267a23ef8660220d696c6e549ce30b3 upstream.
The irq field of struct snd\_mpu401 is supposed to be initialized to -1.
Since it's set to zero as of now, a probing error before the irq
installation results in a kernel warning "Trying to free already-free
IRQ 0".
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=44821
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 59b4151a5d0587dceafe3275cb972634fca88606
Author: Daniel Mack
Date: Wed Aug 1 10:16:53 2012 +0200
ALSA: snd-usb: fix clock source validity index
commit aff252a848ce21b431ba822de3dab9c4c94571cb upstream.
uac\_clock\_source\_is\_valid() uses the control selector value to access
the bmControls bitmap of the clock source unit. This is wrong, as
control selector values start from 1, while the bitmap uses all
available bits.
In other words, "Clock Validity Control" is stored in D3..2, not D5..4
of the clock selector unit's bmControls.
Signed-off-by: Daniel Mack
Reported-by: Andreas Koch
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit df665bff98f8b26731343193dd741c458455b57b
Author: Colin Ian King
Date: Mon Jul 30 16:06:42 2012 +0100
USB: echi-dbgp: increase the controller wait time to come out of halt.
commit f96a4216e85050c0a9d41a41ecb0ae9d8e39b509 upstream.
The default 10 microsecond delay for the controller to come out of
halt in dbgp\_ehci\_startup is too short, so increase it to 1 millisecond.
This is based on emperical testing on various USB debug ports on
modern machines such as a Lenovo X220i and an Ivybridge development
platform that needed to wait ~450-950 microseconds.
Signed-off-by: Colin Ian King
Signed-off-by: Jason Wessel
Signed-off-by: Greg Kroah-Hartman
commit df4322f2f1310a7269df9841bfcee6274981a19f
Author: Mathias Krause
Date: Sun Jul 29 19:45:14 2012 +0000
net/tun: fix ioctl() based info leaks
[ Upstream commits a117dacde0288f3ec60b6e5bcedae8fa37ee0dfc
and 8bbb181308bc348e02bfdbebdedd4e4ec9d452ce ]
The tun module leaks up to 36 bytes of memory by not fully initializing
a structure located on the stack that gets copied to user memory by the
TUNGETIFF and SIOCGIFHWADDR ioctl()s.
Signed-off-by: Mathias Krause
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b35581f9e750bce76d305f2fb2551d3ab9cddede
Author: Jiri Kosina
Date: Fri Jul 27 10:38:50 2012 +0000
tcp: perform DMA to userspace only if there is a task waiting for it
[ Upstream commit 59ea33a68a9083ac98515e4861c00e71efdc49a1 ]
Back in 2006, commit 1a2449a87b ("[I/OAT]: TCP recv offload to I/OAT")
added support for receive offloading to IOAT dma engine if available.
The code in tcp\_rcv\_established() tries to perform early DMA copy if
applicable. It however does so without checking whether the userspace
task is actually expecting the data in the buffer.
This is not a problem under normal circumstances, but there is a corner
case where this doesn't work -- and that's when MSG\_TRUNC flag to
recvmsg() is used.
If the IOAT dma engine is not used, the code properly checks whether
there is a valid ucopy.task and the socket is owned by userspace, but
misses the check in the dmaengine case.
This problem can be observed in real trivially -- for example 'tbench' is a
good reproducer, as it makes a heavy use of MSG\_TRUNC. On systems utilizing
IOAT, you will soon find tbench waiting indefinitely in sk\_wait\_data(), as they
have been already early-copied in tcp\_rcv\_established() using dma engine.
This patch introduces the same check we are performing in the simple
iovec copy case to the IOAT case as well. It fixes the indefinite
recvmsg(MSG\_TRUNC) hangs.
Signed-off-by: Jiri Kosina
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b71b10d6e9c2e3ddded0204be9b75719991a62b6
Author: Jiri Benc
Date: Fri Jul 27 02:58:22 2012 +0000
net: fix rtnetlink IFF\_PROMISC and IFF\_ALLMULTI handling
[ Upstream commit b1beb681cba5358f62e6187340660ade226a5fcc ]
When device flags are set using rtnetlink, IFF\_PROMISC and IFF\_ALLMULTI
flags are handled specially. Function dev\_change\_flags sets IFF\_PROMISC and
IFF\_ALLMULTI bits in dev->gflags according to the passed value but
do\_setlink passes a result of rtnl\_dev\_combine\_flags which takes those bits
from dev->flags.
This can be easily trigerred by doing:
tcpdump -i eth0 &
ip l s up eth0
ip sets IFF\_UP flag in ifi\_flags and ifi\_change, which is combined with
IFF\_PROMISC by rtnl\_dev\_combine\_flags, causing \_\_dev\_change\_flags to set
IFF\_PROMISC in gflags.
Reported-by: Max Matveev
Signed-off-by: Jiri Benc
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 78b13444e02adaff85200e40103afdc851e88479
Author: Dan Carpenter
Date: Fri Jul 27 01:46:51 2012 +0000
USB: kaweth.c: use GFP\_ATOMIC under spin\_lock
[ Upstream commit e4c7f259c5be99dcfc3d98f913590663b0305bf8 ]
The problem is that we call this with a spin lock held. The call tree
is:
kaweth\_start\_xmit() holds kaweth->device\_lock.
-> kaweth\_async\_set\_rx\_mode()
-> kaweth\_control()
-> kaweth\_internal\_control\_msg()
The kaweth\_internal\_control\_msg() function is only called from
kaweth\_control() which used GFP\_ATOMIC for its allocations.
Signed-off-by: Dan Carpenter
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ae8effff91107fec667a7240d25978fe994da30b
Author: Hangbin Liu
Date: Thu Jul 26 22:52:21 2012 +0000
tcp: Add TCP\_USER\_TIMEOUT negative value check
[ Upstream commit 42493570100b91ef663c4c6f0c0fdab238f9d3c2 ]
TCP\_USER\_TIMEOUT is a TCP level socket option that takes an unsigned int. But
patch "tcp: Add TCP\_USER\_TIMEOUT socket option"(dca43c75) didn't check the negative
values. If a user assign -1 to it, the socket will set successfully and wait
for 4294967295 miliseconds. This patch add a negative value check to avoid
this issue.
Signed-off-by: Hangbin Liu
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a4631a7743f79abd92433e8b3da0cfb77d8c3b15
Author: Alan Cox
Date: Tue Jul 24 08:16:25 2012 +0000
wanmain: comparing array with NULL
[ Upstream commit 8b72ff6484fe303e01498b58621810a114f3cf09 ]
gcc really should warn about these !
Signed-off-by: Alan Cox
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 22010b5d2ba8704513ad8a5328c382c3b718a96b
Author: Alan Cox
Date: Tue Jul 24 02:42:14 2012 +0000
caif: fix NULL pointer check
[ Upstream commit c66b9b7d365444b433307ebb18734757cb668a02 ]
Reported-by:
Resolves-bug: http://bugzilla.kernel.org/show\_bug?44441
Signed-off-by: Alan Cox
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c7f9b8461b56298fb8e60df446097f64ef71b9ee
Author: Francois Romieu
Date: Mon Jul 23 22:55:55 2012 +0200
r8169: revert "add byte queue limit support".
[ Upstream commit 17bcb684f08649a2ab6a7dcd8288332e72d208f1 ]
This reverts commit 036dafa28da1e2565a8529de2ae663c37b7a0060.
First it appears in bisection, then reverting it solves the usual
netdev watchdog problem for different people. I don't have a proper
fix yet so get rid of it.
Bisected-and-reported-by: Alex Villacís Lasso
Signed-off-by: Francois Romieu
Cc: Josh Boyer
Cc: Hayes Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 806079ebdd18dacc3c4502a6f967a08e95b41379
Author: Jesper Juhl
Date: Sun Jul 22 11:37:20 2012 +0000
net: Fix references to out-of-scope variables in put\_cmsg\_compat()
[ Upstream commit 818810472b129004c16fc51bf0a570b60776bfb7 ]
In net/compat.c::put\_cmsg\_compat() we may assign 'data' the address of
either the 'ctv' or 'cts' local variables inside the 'if
(!COMPAT\_USE\_64BIT\_TIME)' branch.
Those variables go out of scope at the end of the 'if' statement, so
when we use 'data' further down in 'copy\_to\_user(CMSG\_COMPAT\_DATA(cm),
data, cmlen - sizeof(struct compat\_cmsghdr))' there's no telling what
it may be refering to - not good.
Fix the problem by simply giving 'ctv' and 'cts' function scope.
Signed-off-by: Jesper Juhl
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5b8fb491fae20415d04323c34109cd9fcfa28f15
Author: Tao Ma
Date: Mon Jul 9 16:29:27 2012 -0400
ext4: use s\_csum\_seed instead of i\_csum\_seed for xattr block
commit 41eb70dde42b2360074a559a6f1fc49860a50179 upstream.
In xattr block operation, we use h\_refcount to indicate whether the
xattr block is shared among many inodes. And xattr block csum uses
s\_csum\_seed if it is shared and i\_csum\_seed if it belongs to
one inode. But this has a problem. So consider the block is shared
first bewteen inode A and B, and B has some xattr update and CoW
the xattr block. When it updates the \*old\* xattr block(because
of the h\_refcount change) and calls ext4\_xattr\_release\_block, we
has no idea that inode A is the real owner of the \*old\* xattr
block and we can't use the i\_csum\_seed of inode A either in xattr
block csum calculation. And I don't think we have an easy way to
find inode A.
So this patch just removes the tricky i\_csum\_seed and we now uses
s\_csum\_seed every time for the xattr block csum. The corresponding
patch for the e2fsprogs will be sent in another patch.
This is spotted by xfstests 117.
Signed-off-by: Tao Ma
Signed-off-by: "Theodore Ts'o"
Acked-by: Darrick J. Wong
Signed-off-by: Greg Kroah-Hartman
commit 3fc50cb8a1117a2591f05be284e85432d6c234c1
Author: Tao Ma
Date: Mon Jul 9 16:29:05 2012 -0400
ext4: use proper csum calculation in ext4\_rename
commit ef58f69c3c34f6377f1e21d3533c806dbd980ad0 upstream.
In ext4\_rename, when the old name is a dir, we need to
change ".." to its new parent and journal the change, so
with metadata\_csum enabled, we have to re-calc the csum.
As the first block of the dir can be either a htree root
or a normal directory block and we have different csum
calculation for these 2 types, we have to choose the right
one in ext4\_rename.
btw, it is found by xfstests 013.
Signed-off-by: Tao Ma
Signed-off-by: "Theodore Ts'o"
Acked-by: Darrick J. Wong
Signed-off-by: Greg Kroah-Hartman
commit 564dfa3370843d10d376c9e72085d266557e043e
Author: Theodore Ts'o
Date: Mon Jul 23 00:00:20 2012 -0400
ext4: undo ext4\_calc\_metadata\_amount if we fail to claim space
commit 03179fe92318e7934c180d96f12eff2cb36ef7b6 upstream.
The function ext4\_calc\_metadata\_amount() has side effects, although
it's not obvious from its function name. So if we fail to claim
space, regardless of whether we retry to claim the space again, or
return an error, we need to undo these side effects.
Otherwise we can end up incorrectly calculating the number of metadata
blocks needed for the operation, which was responsible for an xfstests
failure for test #271 when using an ext2 file system with delalloc
enabled.
Reported-by: Brian Foster
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 586430435cfe694265ad28f8fdcebeeb2b521a62
Author: Brian Foster
Date: Sun Jul 22 23:59:40 2012 -0400
ext4: don't let i\_reserved\_meta\_blocks go negative
commit 97795d2a5b8d3c8dc4365d4bd3404191840453ba upstream.
If we hit a condition where we have allocated metadata blocks that
were not appropriately reserved, we risk underflow of
ei->i\_reserved\_meta\_blocks. In turn, this can throw
sbi->s\_dirtyclusters\_counter significantly out of whack and undermine
the nondelalloc fallback logic in ext4\_nonda\_switch(). Warn if this
occurs and set i\_allocated\_meta\_blocks to avoid this problem.
This condition is reproduced by xfstests 270 against ext2 with
delalloc enabled:
Mar 28 08:58:02 localhost kernel: [ 171.526344] EXT4-fs (loop1): delayed block allocation failed for inode 14 at logical offset 64486 with max blocks 64 with error -28
Mar 28 08:58:02 localhost kernel: [ 171.526346] EXT4-fs (loop1): This should not happen!! Data will be lost
270 ultimately fails with an inconsistent filesystem and requires an
fsck to repair. The cause of the error is an underflow in
ext4\_da\_update\_reserve\_space() due to an unreserved meta block
allocation.
Signed-off-by: Brian Foster
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit d9643ee37ddd4da0ed9afac3cdf2cc7c4930d7a6
Author: Ashish Sangwan
Date: Sun Jul 22 22:49:08 2012 -0400
ext4: fix hole punch failure when depth is greater than 0
commit 968dee77220768a5f52cf8b21d0bdb73486febef upstream.
Whether to continue removing extents or not is decided by the return
value of function ext4\_ext\_more\_to\_rm() which checks 2 conditions:
a) if there are no more indexes to process.
b) if the number of entries are decreased in the header of "depth -1".
In case of hole punch, if the last block to be removed is not part of
the last extent index than this index will not be deleted, hence the
number of valid entries in the extent header of "depth - 1" will
remain as it is and ext4\_ext\_more\_to\_rm will return 0 although the
required blocks are not yet removed.
This patch fixes the above mentioned problem as instead of removing
the extents from the end of file, it starts removing the blocks from
the particular extent from which removing blocks is actually required
and continue backward until done.
Signed-off-by: Ashish Sangwan
Signed-off-by: Namjae Jeon
Reviewed-by: Lukas Czerner
Signed-off-by: Greg Kroah-Hartman
commit 8aeb00ff85ad25453765dd339b408c0087db1527
Author: Theodore Ts'o
Date: Mon Jul 9 16:27:05 2012 -0400
ext4: fix overhead calculation used by ext4\_statfs()
commit 952fc18ef9ec707ebdc16c0786ec360295e5ff15 upstream.
Commit f975d6bcc7a introduced bug which caused ext4\_statfs() to
miscalculate the number of file system overhead blocks. This causes
the f\_blocks field in the statfs structure to be larger than it should
be. This would in turn cause the "df" output to show the number of
data blocks in the file system and the number of data blocks used to
be larger than they should be.
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 74c429a11be427b0f2a7f02e585dc49a148a0e82
Author: Theodore Ts'o
Date: Sat Jun 30 19:14:57 2012 -0400
ext4: pass a char \* to ext4\_count\_free() instead of a buffer\_head ptr
commit f6fb99cadcd44660c68e13f6eab28333653621e6 upstream.
Make it possible for ext4\_count\_free to operate on buffers and not
just data in buffer\_heads.
Signed-off-by: "Theodore Ts'o"
Signed-off-by: Greg Kroah-Hartman
commit 5f66feb6035d82c46c1a63f540366ad7748e0719
Author: Maarten Lankhorst
Date: Mon Jun 4 12:00:31 2012 +0200
nouveau: Fix alignment requirements on src and dst addresses
commit ce806a30470bcd846d148bf39d46de3ad7748228 upstream.
Linear copy works by adding the offset to the buffer address,
which may end up not being 16-byte aligned.
Some tests I've written for prime\_pcopy show that the engine
allows this correctly, so the restriction on lowest 4 bits of
address can be lifted safely.
The comments added were by envyas, I think because I used
a newer version.
Signed-off-by: Maarten Lankhorst
Signed-off-by: Greg Kroah-Hartman
commit df4c3fd716e3565c6ab83ec4b6617cc180f062a1
Author: David Howells
Date: Wed Jul 25 16:53:36 2012 +0100
NFS: Fix a number of bugs in the idmapper
commit a427b9ec4eda8cd6e641ea24541d30b641fc3140 upstream.
Fix a number of bugs in the NFS idmapper code:
(1) Only registered key types can be passed to the core keys code, so
register the legacy idmapper key type.
This is a requirement because the unregister function cleans up keys
belonging to that key type so that there aren't dangling pointers to the
module left behind - including the key->type pointer.
(2) Rename the legacy key type. You can't have two key types with the same
name, and (1) would otherwise require that.
(3) complete\_request\_key() must be called in the error path of
nfs\_idmap\_legacy\_upcall().
(4) There is one idmap struct for each nfs\_client struct. This means that
idmap->idmap\_key\_cons is shared without the use of a lock. This is a
problem because key\_instantiate\_and\_link() - as called indirectly by
idmap\_pipe\_downcall() - releases anyone waiting for the key to be
instantiated.
What happens is that idmap\_pipe\_downcall() running in the rpc.idmapd
thread, releases the NFS filesystem in whatever thread that is running in
to continue. This may then make another idmapper call, overwriting
idmap\_key\_cons before idmap\_pipe\_downcall() gets the chance to call
complete\_request\_key().
I \*think\* that reading idmap\_key\_cons only once, before
key\_instantiate\_and\_link() is called, and then caching the result in a
variable is sufficient.
Bug (4) is the cause of:
BUG: unable to handle kernel NULL pointer dereference at (null)
IP: [< (null)>] (null)
PGD 0
Oops: 0010 [#1] SMP
CPU 1
Modules linked in: ppdev parport\_pc lp parport ip6table\_filter ip6\_tables ebtable\_nat ebtables ipt\_MASQUERADE iptable\_nat nf\_nat nf\_conntrack\_ipv4 nf\_defrag\_ipv4 xt\_state nf\_conntrack nfs fscache xt\_CHECKSUM auth\_rpcgss iptable\_mangle nfs\_acl bridge stp llc lockd be2iscsi iscsi\_boot\_sysfs bnx2i cnic uio cxgb4i cxgb4 cxgb3i libcxgbi cxgb3 mdio ib\_iser rdma\_cm ib\_cm iw\_cm ib\_sa ib\_mad ib\_core ib\_addr iscsi\_tcp libiscsi\_tcp libiscsi scsi\_transport\_iscsi snd\_hda\_codec\_realtek snd\_usb\_audio snd\_hda\_intel snd\_hda\_codec snd\_seq snd\_pcm snd\_hwdep snd\_usbmidi\_lib snd\_rawmidi snd\_timer uvcvideo videobuf2\_core videodev media videobuf2\_vmalloc snd\_seq\_device videobuf2\_memops e1000e vhost\_net iTCO\_wdt joydev coretemp snd soundcore macvtap macvlan i2c\_i801 snd\_page\_alloc tun iTCO\_vendor\_support microcode kvm\_intel kvm sunrpc hid\_logitech\_dj usb\_storage i915 drm\_kms\_helper drm i2c\_algo\_bit i2c\_core video [last unloaded: scsi\_wait\_scan]
Pid: 1229, comm: rpc.idmapd Not tainted 3.4.2-1.fc16.x86\_64 #1 Gateway DX4710-UB801A/G33M05G1
RIP: 0010:[<0000000000000000>] [< (null)>] (null)
RSP: 0018:ffff8801a3645d40 EFLAGS: 00010246
RAX: ffff880077707e30 RBX: ffff880077707f50 RCX: ffff8801a18ccd80
RDX: 0000000000000006 RSI: ffff8801a3645e75 RDI: ffff880077707f50
RBP: ffff8801a3645d88 R08: ffff8801a430f9c0 R09: ffff8801a3645db0
R10: 000000000000000a R11: 0000000000000246 R12: ffff8801a18ccd80
R13: ffff8801a3645e75 R14: ffff8801a430f9c0 R15: 0000000000000006
FS: 00007fb6fb51a700(0000) GS:ffff8801afc80000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000000000 CR3: 00000001a49b0000 CR4: 00000000000027e0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
Process rpc.idmapd (pid: 1229, threadinfo ffff8801a3644000, task ffff8801a3bf9710)
Stack:
ffffffff81260878 ffff8801a3645db0 ffff8801a3645db0 ffff880077707a90
ffff880077707f50 ffff8801a18ccd80 0000000000000006 ffff8801a3645e75
ffff8801a430f9c0 ffff8801a3645dd8 ffffffff81260983 ffff8801a3645de8
Call Trace:
[] ? \_\_key\_instantiate\_and\_link+0x58/0x100
[] key\_instantiate\_and\_link+0x63/0xa0
[] idmap\_pipe\_downcall+0x1cb/0x1e0 [nfs]
[] rpc\_pipe\_write+0x67/0x90 [sunrpc]
[] vfs\_write+0xb3/0x180
[] sys\_write+0x4a/0x90
[] system\_call\_fastpath+0x16/0x1b
Code: Bad RIP value.
RIP [< (null)>] (null)
RSP
CR2: 0000000000000000
Signed-off-by: David Howells
Reviewed-by: Steve Dickson
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 1e6ddec244966bc0c4322cfeb6200370eb1bc83e
Author: Jeff Layton
Date: Mon Jul 23 13:58:51 2012 -0400
nfs: skip commit in releasepage if we're freeing memory for fs-related reasons
commit 5cf02d09b50b1ee1c2d536c9cf64af5a7d433f56 upstream.
We've had some reports of a deadlock where rpciod ends up with a stack
trace like this:
PID: 2507 TASK: ffff88103691ab40 CPU: 14 COMMAND: "rpciod/14"
#0 [ffff8810343bf2f0] schedule at ffffffff814dabd9
#1 [ffff8810343bf3b8] nfs\_wait\_bit\_killable at ffffffffa038fc04 [nfs]
#2 [ffff8810343bf3c8] \_\_wait\_on\_bit at ffffffff814dbc2f
#3 [ffff8810343bf418] out\_of\_line\_wait\_on\_bit at ffffffff814dbcd8
#4 [ffff8810343bf488] nfs\_commit\_inode at ffffffffa039e0c1 [nfs]
#5 [ffff8810343bf4f8] nfs\_release\_page at ffffffffa038bef6 [nfs]
#6 [ffff8810343bf528] try\_to\_release\_page at ffffffff8110c670
#7 [ffff8810343bf538] shrink\_page\_list.clone.0 at ffffffff81126271
#8 [ffff8810343bf668] shrink\_inactive\_list at ffffffff81126638
#9 [ffff8810343bf818] shrink\_zone at ffffffff8112788f
#10 [ffff8810343bf8c8] do\_try\_to\_free\_pages at ffffffff81127b1e
#11 [ffff8810343bf958] try\_to\_free\_pages at ffffffff8112812f
#12 [ffff8810343bfa08] \_\_alloc\_pages\_nodemask at ffffffff8111fdad
#13 [ffff8810343bfb28] kmem\_getpages at ffffffff81159942
#14 [ffff8810343bfb58] fallback\_alloc at ffffffff8115a55a
#15 [ffff8810343bfbd8] \_\_\_\_cache\_alloc\_node at ffffffff8115a2d9
#16 [ffff8810343bfc38] kmem\_cache\_alloc at ffffffff8115b09b
#17 [ffff8810343bfc78] sk\_prot\_alloc at ffffffff81411808
#18 [ffff8810343bfcb8] sk\_alloc at ffffffff8141197c
#19 [ffff8810343bfce8] inet\_create at ffffffff81483ba6
#20 [ffff8810343bfd38] \_\_sock\_create at ffffffff8140b4a7
#21 [ffff8810343bfd98] xs\_create\_sock at ffffffffa01f649b [sunrpc]
#22 [ffff8810343bfdd8] xs\_tcp\_setup\_socket at ffffffffa01f6965 [sunrpc]
#23 [ffff8810343bfe38] worker\_thread at ffffffff810887d0
#24 [ffff8810343bfee8] kthread at ffffffff8108dd96
#25 [ffff8810343bff48] kernel\_thread at ffffffff8100c1ca
rpciod is trying to allocate memory for a new socket to talk to the
server. The VM ends up calling ->releasepage to get more memory, and it
tries to do a blocking commit. That commit can't succeed however without
a connected socket, so we deadlock.
Fix this by setting PF\_FSTRANS on the workqueue task prior to doing the
socket allocation, and having nfs\_release\_page check for that flag when
deciding whether to do a commit call. Also, set PF\_FSTRANS
unconditionally in rpc\_async\_schedule since that function can also do
allocations sometimes.
Signed-off-by: Jeff Layton
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 28b25222cd3dee210d9736c2776a95d6b3d915ee
Author: Vivek Trivedi
Date: Tue Jul 24 21:18:20 2012 +0530
nfsd4: fix cr\_principal comparison check in same\_creds
commit 5559b50acdcdcad7e362882d3261bf934c9436f6 upstream.
This fixes a wrong check for same cr\_principal in same\_creds
Introduced by 8fbba96e5b327665265ad02b7f331b68536828bf "nfsd4: stricter
cred comparison for setclientid/exchange\_id".
Signed-off-by: Vivek Trivedi
Signed-off-by: Namjae Jeon
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit ebe58c7cec891804c413072c81d6e66a81eb8e99
Author: J. Bruce Fields
Date: Tue Jun 5 16:52:06 2012 -0400
nfsd4: our filesystems are normally case sensitive
commit 2930d381d22b9c56f40dd4c63a8fa59719ca2c3c upstream.
Actually, xfs and jfs can optionally be case insensitive; we'll handle
that case in later patches.
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit cd40c442bcf13696b2e0dfcc158945ff0ee64356
Author: Joe Thornber
Date: Fri Jul 27 15:08:05 2012 +0100
dm thin: fix memory leak in process\_prepared\_mapping error paths
commit 905386f82d08f66726912f303f3e6605248c60a3 upstream.
Fix memory leak in process\_prepared\_mapping by always freeing
the dm\_thin\_new\_mapping structs from the mapping\_pool mempool on
the error paths.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit ac9d9e65b673fa34f12002df33211d11432b86cf
Author: Alasdair G Kergon
Date: Fri Jul 27 15:07:57 2012 +0100
dm thin: reduce endio\_hook pool size
commit 7768ed33ccdc02801c4483fc5682dc66ace14aea upstream.
Reduce the slab size used for the dm\_thin\_endio\_hook mempool.
Allocation has been seen to fail on machines with smaller amounts
of memory due to fragmentation.
lvm: page allocation failure. order:5, mode:0xd0
device-mapper: table: 253:38: thin-pool: Error creating pool's endio\_hook mempool
Signed-off-by: Alasdair G Kergon
Signed-off-by: Greg Kroah-Hartman
commit f74a7c968090d6db642c70657c742bc313524e9b
Author: Josh Boyer
Date: Wed Jul 25 10:40:34 2012 -0400
posix\_types.h: Cleanup stale \_\_NFDBITS and related definitions
commit 8ded2bbc1845e19c771eb55209aab166ef011243 upstream.
Recently, glibc made a change to suppress sign-conversion warnings in
FD\_SET (glibc commit ceb9e56b3d1). This uncovered an issue with the
kernel's definition of \_\_NFDBITS if applications #include
 after including . A build failure would
be seen when passing the -Werror=sign-compare and -D\_FORTIFY\_SOURCE=2
flags to gcc.
It was suggested that the kernel should either match the glibc
definition of \_\_NFDBITS or remove that entirely. The current in-kernel
uses of \_\_NFDBITS can be replaced with BITS\_PER\_LONG, and there are no
uses of the related \_\_FDELT and \_\_FDMASK defines. Given that, we'll
continue the cleanup that was started with commit 8b3d1cda4f5f
("posix\_types: Remove fd\_set macros") and drop the remaining unused
macros.
Additionally, linux/time.h has similar macros defined that expand to
nothing so we'll remove those at the same time.
Reported-by: Jeff Law
Suggested-by: Linus Torvalds
Signed-off-by: Josh Boyer
[ .. and fix up whitespace as per akpm ]
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 4e83939ad0536a120f62006e359668a8fbe0db91
Author: Marcin Slusarz
Date: Wed Jul 25 20:42:05 2012 +0200
drm/nouveau: init vblank requests list
commit 715855457e6bc93e148caf8cb3b5dcabbf605b0d upstream.
Fixes kernel panic when vblank interrupt triggers before first sync to
vblank request.
(Besides init, remove some relevant leftovers from vblank rework)
Reported-by: Ortwin Glück
Signed-off-by: Marcin Slusarz
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 9445d24c2ec8c948a626bce69d0c0c4af4380181
Author: Jerome Glisse
Date: Tue Jul 24 17:06:11 2012 -0400
drm/radeon: fix dpms on/off on trinity/aruba v2
commit fcedac670c3da0d17aaa5db1708694971e8024a9 upstream.
The external encoder need to be setup again before enabling the
transmiter. This seems to be only needed on some trinity/aruba
to fix dpms on.
v2: Add comment, only setup again on dce6 ie aruba or newer.
Signed-off-by: Jerome Glisse
Reviewed-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit bae97dae8b51958f56c8ec79f3811b1203209c0f
Author: Jerome Glisse
Date: Thu Jul 19 17:25:55 2012 -0400
drm/radeon: on hotplug force link training to happen (v2)
commit ca2ccde5e2f24a792caa4cca919fc5c6f65d1887 upstream.
To have DP behave like VGA/DVI we need to retrain the link
on hotplug. For this to happen we need to force link
training to happen by setting connector dpms to off
before asking it turning it on again.
v2: agd5f
- drop the dp\_get\_link\_status() change in atombios\_dp.c
for now. We still need the dpms OFF change.
Signed-off-by: Jerome Glisse
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 1cdd2586d1bec975068a7aa3d195720cd413c30b
Author: Jerome Glisse
Date: Thu Jul 19 17:15:56 2012 -0400
drm/radeon: fix hotplug of DP to DVI|HDMI passive adapters (v2)
commit 266dcba541a1ef7e5d82d9e67c67fde2910636e8 upstream.
No need to retrain the link for passive adapters.
v2: agd5f
- no passive DP to VGA adapters, update comments
- assign radeon\_connector\_atom\_dig after we are sure
we have a digital connector as analog connectors
have different private data.
- get new sink type before checking for retrain. No
need to check if it's no longer a DP connection.
Signed-off-by: Jerome Glisse
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 4c8245f41013f8fd42da2e758d88ec25ff301b81
Author: Jerome Glisse
Date: Tue Jul 17 17:17:16 2012 -0400
drm/radeon: fix non revealent error message
commit 8d1c702aa0b2c4b22b0742b72a1149d91690674b upstream.
We want to print link status query failed only if it's
an unexepected fail. If we query to see if we need
link training it might be because there is nothing
connected and thus link status query have the right
to fail in that case.
To avoid printing failure when it's expected, move the
failure message to proper place.
Signed-off-by: Jerome Glisse
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 7918c27c1e1925655fa139aea4093ecd939a091b
Author: Michel Dänzer
Date: Tue Jul 17 19:02:09 2012 +0200
drm/radeon: Try harder to avoid HW cursor ending on a multiple of 128 columns.
commit f60ec4c7df043df81e62891ac45383d012afe0da upstream.
This could previously fail if either of the enabled displays was using a
horizontal resolution that is a multiple of 128, and only the leftmost column
of the cursor was (supposed to be) visible at the right edge of that display.
The solution is to move the cursor one pixel to the left in that case.
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=33183
Signed-off-by: Michel Dänzer
Reviewed-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 8fbaa37e12d83fe586e593bba3af8bd907117d50
Author: Jerome Glisse
Date: Thu Jul 12 18:23:05 2012 -0400
drm/radeon: fix bo creation retry path
commit d1c7871ddb1f588b8eb35affd9ee1a3d5e11cd0c upstream.
Retry label was at wrong place in function leading to memory
leak.
Signed-off-by: Jerome Glisse
Reviewed-by: Michel Dänzer
Reviewed-by: Christian König
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 2c742f74ec5ab6a2ae3f0821dd18985d3320e104
Author: Christian König
Date: Tue Jul 3 14:05:41 2012 +0200
drm/radeon: fix fence related segfault in CS
commit 93bf888c5c730605e3470f5d2381f296eda88d79 upstream.
Don't return success if scheduling the IB fails, otherwise
we end up with an oops in ttm\_eu\_fence\_buffer\_objects.
Signed-off-by: Christian König
Reviewed-by: Jerome Glisse
Reviewed-by: Michel Dänzer
Reviewed-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 787852ce0cf80eaef0350798da92c27c8a43d624
Author: Michael Chan
Date: Sun Jul 29 19:15:44 2012 +0000
tg3: Fix race condition in tg3\_get\_stats64()
commit 0f566b208b41918053b2e67399673aaec02dde5d upstream.
Spinlock should be taken before checking for tp->hw\_stats.
Signed-off-by: Michael Chan
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 27b8d8aa03709385782938a7e622ff71dde5b17a
Author: Michael Chan
Date: Sun Jul 29 19:15:42 2012 +0000
tg3: Fix Read DMA workaround for 5719 A0.
commit 10ce95d6ef36c65df7dcd3b8fcf86913f8b298bd upstream.
The workaround was mis-applied to all 5719 and 5720 chips.
Signed-off-by: Michael Chan
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b3b3b489af33f578c76366eece947cf5d41a81e4
Author: Greg KH
Date: Thu Jul 12 15:39:44 2012 +0000
tg3: add device id of Apple Thunderbolt Ethernet device
commit 02eca3f5f5e458c3a5d7b772bc8042ee2a4ebedf upstream.
The Apple Thunderbolt ethernet device is already listed in the driver,
but not hooked up in the MODULE\_DEVICE\_TABLE(). This fixes that and
allows it to work properly.
Signed-off-by: Greg Kroah-Hartman
Acked-by: Michael Chan
Signed-off-by: David S. Miller
commit dc249d0f2c815d6af901d12253fc1cf215773f01
Author: Frank Blaschka
Date: Tue Jul 24 22:34:29 2012 +0000
qeth: repair crash in qeth\_l3\_vlan\_rx\_kill\_vid()
commit eabfbe6230ee7363681e7a561948d362b87169f0 upstream.
Commit efc73f4b "net: Fix memory leak - vlan\_info struct" adds deletion of
VLAN 0 for devices with feature NETIF\_F\_HW\_VLAN\_FILTER. For driver
qeth these are the layer 3 devices. Usually there exists no
separate vlan net\_device for VLAN 0. Thus the qeth functions
qeth\_l3\_free\_vlan\_addresses4() and qeth\_l3\_free\_vlan\_addresses6()
require an extra checking if function \_\_vlan\_find\_dev\_deep()
returns with a net\_device.
Signed-off-by: Ursula Braun
Signed-off-by: Frank Blaschka
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit be142c0eac7a427fe4c7e4564466be9d826fefd4
Author: Virupax Sadashivpetimath
Date: Tue Jun 12 15:10:58 2012 +0200
spi/pl022: disable port when unused
commit fd316941cfee1fbd12746afea83720fb7823888a upstream.
Commit ffbbdd21329f3e15eeca6df2d4bc11c04d9d91c0
"spi: create a message queueing infrastructure"
Accidentally deleted the logic to disable the port
when unused leading to higher power consumption.
Fix this up.
Cc: Vinit Shenoy
Signed-off-by: Virupax Sadashivpetimath
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit a130e9e48f95bbec9cb9b8ac3f938e552760fbf6
Author: Jeff Layton
Date: Wed Jul 25 14:59:54 2012 -0400
cifs: ensure that we always do cifsFileInfo\_get under the spinlock
commit 764a1b1acecedfe204cb2e80d8e2cc7c6df1b0b8 upstream.
The readpages bug is a regression that was introduced in 6993f74a5.
This also fixes a couple of similar bugs in the uncached read and write
codepaths.
Also, prevent this sort of thing in the future by having cifsFileInfo\_get
take the spinlock itself, and adding a \_locked variant for use in places
that are already holding the lock. The \_put code has always done that
so this makes for a less confusing interface.
Reviewed-by: Pavel Shilovsky
Signed-off-by: Jeff Layton
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 6f51cd3bb2b88c2da4666ff9a6f3a8d9b04875ad
Author: Jeff Layton
Date: Mon Jul 23 20:34:17 2012 -0400
cifs: reinstate sec=ntlmv2 mount option
commit 7659624ffb550d69c87f9af9ae63e717daa874bd upstream.
sec=ntlmv2 as a mount option got dropped in the mount option overhaul.
Cc: Sachin Prabhu
Reported-by: Günter Kukkukk
Signed-off-by: Jeff Layton
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 516d933b3060018ab8d6e953ab657a04656b0549
Author: Chris Mason
Date: Wed Jul 25 15:57:13 2012 -0400
Btrfs: call the ordered free operation without any locks held
commit e9fbcb42201c862fd6ab45c48ead4f47bb2dea9d upstream.
Each ordered operation has a free callback, and this was called with the
worker spinlock held. Josef made the free callback also call iput,
which we can't do with the spinlock.
This drops the spinlock for the free operation and grabs it again before
moving through the rest of the list. We'll circle back around to this
and find a cleaner way that doesn't bounce the lock around so much.
Signed-off-by: Chris Mason
Signed-off-by: Greg Kroah-Hartman
commit 8901aca058c3eeb25f0325f491ef4119c507eb2b
Author: Kay Sievers
Date: Mon Jul 16 18:35:29 2012 -0700
kmsg - properly print over-long continuation lines
commit 70498253186586e5dca7bc3ebd3415203b059fbc upstream.
Reserve PREFIX\_MAX bytes in the LOG\_LINE\_MAX line when buffering a
continuation line, to be able to properly prefix the LOG\_LINE\_MAX
line with the syslog prefix and timestamp when printing it.
Reported-By: Dave Jones
Signed-off-by: Kay Sievers
Signed-off-by: Greg Kroah-Hartman
commit ca118568299f5e4ec8ad2dcd6776038fb16e6ad3
Author: Lan Tianyu
Date: Fri Jul 20 13:29:16 2012 +0800
ACPI/AC: prevent OOPS on some boxes due to missing check power\_supply\_register() return value check
commit f197ac13f6eeb351b31250b9ab7d0da17434ea36 upstream.
In the ac.c, power\_supply\_register()'s return value is not checked.
As a result, the driver's add() ops may return success
even though the device failed to initialize.
For example, some BIOS may describe two ACADs in the same DSDT.
The second ACAD device will fail to register,
but ACPI driver's add() ops returns sucessfully.
The ACPI device will receive ACPI notification and cause OOPS.
https://bugzilla.redhat.com/show\_bug.cgi?id=772730
Signed-off-by: Lan Tianyu
Signed-off-by: Len Brown
Signed-off-by: Greg Kroah-Hartman
commit 1cd9be20fd920c807696f7fa2a2f55dcf187f6c0
Author: Jean Delvare
Date: Tue Jun 12 10:43:28 2012 +0200
ACPI, APEI: Fixup common access width firmware bug
commit f712c71f7b2b43b894d1e92e1b77385fcad8815f upstream.
Many firmwares have a common register definition bug where 8-bit
access width is specified for a 32-bit register. Ideally this should
be fixed in the BIOS, but earlier versions of the kernel did not
complain, so fix that up silently.
This closes kernel bug #43282:
https://bugzilla.kernel.org/show\_bug.cgi?id=43282
Signed-off-by: Jean Delvare
Acked-by: Huang Ying
Acked-by: Gary Hade
Signed-off-by: Len Brown
Signed-off-by: Greg Kroah-Hartman
commit 20e2d5cef027128b99b459aeb2eca282146d15ba
Author: Tejun Heo
Date: Tue Jul 17 12:39:26 2012 -0700
workqueue: perform cpu down operations from low priority cpu\_notifier()
commit 6575820221f7a4dd6eadecf7bf83cdd154335eda upstream.
Currently, all workqueue cpu hotplug operations run off
CPU\_PRI\_WORKQUEUE which is higher than normal notifiers. This is to
ensure that workqueue is up and running while bringing up a CPU before
other notifiers try to use workqueue on the CPU.
Per-cpu workqueues are supposed to remain working and bound to the CPU
for normal CPU\_DOWN\_PREPARE notifiers. This holds mostly true even
with workqueue offlining running with higher priority because
workqueue CPU\_DOWN\_PREPARE only creates a bound trustee thread which
runs the per-cpu workqueue without concurrency management without
explicitly detaching the existing workers.
However, if the trustee needs to create new workers, it creates
unbound workers which may wander off to other CPUs while
CPU\_DOWN\_PREPARE notifiers are in progress. Furthermore, if the CPU
down is cancelled, the per-CPU workqueue may end up with workers which
aren't bound to the CPU.
While reliably reproducible with a convoluted artificial test-case
involving scheduling and flushing CPU burning work items from CPU down
notifiers, this isn't very likely to happen in the wild, and, even
when it happens, the effects are likely to be hidden by the following
successful CPU down.
Fix it by using different priorities for up and down notifiers - high
priority for up operations and low priority for down operations.
Workqueue cpu hotplug operations will soon go through further cleanup.
Signed-off-by: Tejun Heo
Acked-by: "Rafael J. Wysocki"
Signed-off-by: Greg Kroah-Hartman
commit 452c0a67cbd71210049be5366cac7fd14556eeec
Author: Ben Hutchings
Date: Wed Jun 20 02:31:11 2012 +0100
staging: zsmalloc: Finish conversion to a separate module
commit 069f101fa463351f528773d73b74e9b606b3f66a upstream.
ZSMALLOC is tristate, but the code has no MODULE\_LICENSE and since it
depends on GPL-only symbols it cannot be loaded as a module. This in
turn breaks zram which now depends on it. I assume it's meant to be
Dual BSD/GPL like the other z-stuff.
There is also no module\_exit, which will make it impossible to unload.
Add the appropriate module\_init and module\_exit declarations suggested
by comments.
Reported-by: Christian Ohm
References: http://bugs.debian.org/677273
Signed-off-by: Ben Hutchings
Reviewed-by: Jonathan Nieder
Signed-off-by: Greg Kroah-Hartman
commit 05a11f37859624fabb4e0d00fdba020768350833
Author: Paul Gortmaker
Date: Tue Jun 5 11:15:50 2012 -0400
stable: update references to older 2.6 versions for 3.x
commit 2584f5212d97b664be250ad5700a2d0fee31a10d upstream.
Also add information on where the respective trees are.
Signed-off-by: Paul Gortmaker
Acked-by: Rob Landley
Signed-off-by: Greg Kroah-Hartman
commit ee0fcc97c489f4fe29a66f1615ca3fb1513c4c99
Author: Jan Kara
Date: Tue Jul 10 17:58:04 2012 +0200
udf: Improve table length check to avoid possible overflow
commit 57b9655d01ef057a523e810d29c37ac09b80eead upstream.
When a partition table length is corrupted to be close to 1 << 32, the
check for its length may overflow on 32-bit systems and we will think
the length is valid. Later on the kernel can crash trying to read beyond
end of buffer. Fix the check to avoid possible overflow.
Reported-by: Ben Hutchings
Signed-off-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 06fac439bbc3549d5402fb736895a76e3b668a38
Author: Joerg Roedel
Date: Thu Jul 19 13:42:54 2012 +0200
iommu/amd: Fix hotplug with iommu=pt
commit 2c9195e990297068d0f1f1bd8e2f1d09538009da upstream.
This did not work because devices are not put into the
pt\_domain. Fix this.
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit a29c227ce9bd49ad85a202ee6603d7a41cd096fd
Author: Joerg Roedel
Date: Thu Jul 19 10:56:10 2012 +0200
iommu/amd: Add missing spin\_lock initialization
commit 2c13d47a1a7ee8808796016c617aef25fd1d1925 upstream.
Add missing spin\_lock initialization in
amd\_iommu\_bind\_pasid() function and make lockdep happy
again.
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit ffa6a041840728be548e45243ccf37303f68a8e9
Author: Tejun Heo
Date: Tue Jul 3 10:38:06 2012 -0700
cgroup: cgroup\_rm\_files() was calling simple\_unlink() with the wrong inode
commit ce27e317ba22b359bde02216afab934dac3af095 upstream.
While refactoring cgroup file removal path, 05ef1d7c4a "cgroup:
introduce struct cfent" incorrectly changed the @dir argument of
simple\_unlink() to the inode of the file being deleted instead of that
of the containing directory.
The effect of this bug is minor - ctime and mtime of the parent
weren't properly updated on file deletion.
Fix it by using @cgrp->dentry->d\_inode instead.
Signed-off-by: Tejun Heo
Reported-by: Al Viro
Acked-by: Li Zefan
Signed-off-by: Greg Kroah-Hartman
commit 05e4b43a37ef048498d4b326d9014923de4d4cd1
Author: Heiko Carstens
Date: Fri Jul 27 09:45:39 2012 +0200
s390/mm: fix fault handling for page table walk case
commit 008c2e8f247f0a8db1e8e26139da12f3a3abcda0 upstream.
Make sure the kernel does not incorrectly create a SIGBUS signal during
user space accesses:
For user space accesses in the switched addressing mode case the kernel
may walk page tables and access user address space via the kernel
mapping. If a page table entry is invalid the function \_\_handle\_fault()
gets called in order to emulate a page fault and trigger all the usual
actions like paging in a missing page etc. by calling handle\_mm\_fault().
If handle\_mm\_fault() returns with an error fixup handling is necessary.
For the switched addressing mode case all errors need to be mapped to
-EFAULT, so that the calling uaccess function can return -EFAULT to
user space.
Unfortunately the \_\_handle\_fault() incorrectly calls do\_sigbus() if
VM\_FAULT\_SIGBUS is set. This however should only happen if a page fault
was triggered by a user space instruction. For kernel mode uaccesses
the correct action is to only return -EFAULT.
So user space may incorrectly see SIGBUS signals because of this bug.
For current machines this would only be possible for the switched
addressing mode case in conjunction with futex operations.
Signed-off-by: Heiko Carstens
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit 6f1498585789591dc5ab066149bd091d7aac84fd
Author: Martin Schwidefsky
Date: Thu Jul 26 08:53:06 2012 +0200
s390/mm: downgrade page table after fork of a 31 bit process
commit 0f6f281b731d20bfe75c13f85d33f3f05b440222 upstream.
The downgrade of the 4 level page table created by init\_new\_context is
currently done only in start\_thread31. If a 31 bit process forks the
new mm uses a 4 level page table, including the task size of 2<<42
that goes along with it. This is incorrect as now a 31 bit process
can map memory beyond 2GB. Define arch\_dup\_mmap to do the downgrade
after fork.
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit 465f25e8db7cfdc04fad80250f141bcacb865ce2
Author: Heiko Carstens
Date: Fri Jul 13 15:45:33 2012 +0200
s390/idle: fix sequence handling vs cpu hotplug
commit 0008204ffe85d23382d6fd0f971f3f0fbe70bae2 upstream.
The s390 idle accounting code uses a sequence counter which gets used
when the per cpu idle statistics get updated and read.
One assumption on read access is that only when the sequence counter is
even and did not change while reading all values the result is valid.
On cpu hotplug however the per cpu data structure gets initialized via
a cpu hotplug notifier on CPU\_ONLINE.
CPU\_ONLINE however is too late, since the onlined cpu is already running
and might access the per cpu data. Worst case is that the data structure
gets initialized while an idle thread is updating its idle statistics.
This will result in an uneven sequence counter after an update.
As a result user space tools like top, which access /proc/stat in order
to get idle stats, will busy loop waiting for the sequence counter to
become even again, which will never happen until the queried cpu will
update its idle statistics again. And even then the sequence counter
will only have an even value for a couple of cpu cycles.
Fix this by moving the initialization of the per cpu idle statistics
to cpu\_init(). I prefer that solution in favor of changing the
notifier to CPU\_UP\_PREPARE, which would be a different solution to
the problem.
Signed-off-by: Heiko Carstens
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit ded29f2aa5ee4df0ae405a9be4ce75f6f9854d3e
Author: Amitkumar Karwar
Date: Wed Jul 11 18:12:57 2012 -0700
mwifiex: correction in mcs index check
commit fe020120cb863ba918c6d603345342a880272c4d upstream.
mwifiex driver supports 2x2 chips as well. Hence valid mcs values
are 0 to 15. The check for mcs index is corrected in this patch.
For example: if 40MHz is enabled and mcs index is 11, "iw link"
command would show "tx bitrate: 108.0 MBit/s" without this patch.
Now it shows "tx bitrate: 108.0 MBit/s MCS 11 40Mhz" with the patch.
Signed-off-by: Amitkumar Karwar
Signed-off-by: Bing Zhao
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 955441c4790f59078f762a0cc844add6c6a537fe
Author: Forest Bond
Date: Fri Jul 13 12:26:06 2012 -0400
rtlwifi: rtl8192de: Fix phy-based version calculation
commit f1b00f4dab29b57bdf1bc03ef12020b280fd2a72 upstream.
Commit d83579e2a50ac68389e6b4c58b845c702cf37516 incorporated some
changes from the vendor driver that made it newly important that the
calculated hardware version correctly include the CHIP\_92D bit, as all
of the IS\_92D\_\* macros were changed to depend on it. However, this bit
was being unset for dual-mac, dual-phy devices. The vendor driver
behavior was modified to not do this, but unfortunately this change was
not picked up along with the others. This caused scanning in the 2.4GHz
band to be broken, and possibly other bugs as well.
This patch brings the version calculation logic in parity with the
vendor driver in this regard, and in doing so fixes the regression.
However, the version calculation code in general continues to be largely
incoherent and messy, and needs to be cleaned up.
Signed-off-by: Forest Bond
Signed-off-by: Larry Finger
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 6f87baecc2b149ee54dfd79cc126d5b4f7c4dc0d
Author: Larry Finger
Date: Wed Jul 11 14:37:28 2012 -0500
rtlwifi: rtl8192cu: Change buffer allocation for synchronous reads
commit 3ce4d85b76010525adedcc2555fa164bf706a2f3 upstream.
In commit a7959c1, the USB part of rtlwifi was switched to convert
\_usb\_read\_sync() to using a preallocated buffer rather than one
that has been acquired using kmalloc. Although this routine is named
as though it were synchronous, there seem to be simultaneous users,
and the selection of the index to the data buffer is not multi-user
safe. This situation is addressed by adding a new spinlock. The routine
cannot sleep, thus a mutex is not allowed.
Signed-off-by: Larry Finger
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit c366e8b007d8713039a464b87f7dbd402d3861ab
Author: Cloud Ren
Date: Thu Jul 19 17:01:58 2012 +0000
atl1c: fix issue of io access mode for AR8152 v2.1
commit fa0afcd10951afad2022dda09777d2bf70cdab3d upstream.
When io access mode is enabled by BOOTROM or BIOS for AR8152 v2.1,
the register can't be read/write by memory access mode.
Clearing Bit 8 of Register 0x21c could fixed the issue.
Signed-off-by: Cloud Ren
Signed-off-by: xiong
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit eb27206f8996842b550770a0fd41cae1f3d91acb
Author: Meenakshi Venkataraman
Date: Wed May 16 22:40:50 2012 +0200
iwlwifi: fix debug print in iwl\_sta\_calc\_ht\_flags
commit a35e270881a5db1ec9ac8bc6d61ebc3e85c14f33 upstream.
We missed passing an argument to the
debug print. Fix it.
Signed-off-by: Meenakshi Venkataraman
Reviewed-by: Emmanuel Grumbach
Signed-off-by: Johannes Berg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit b7ad4aebc763c09f6792dae95c74fb289d76c641
Author: Ilan Peer
Date: Thu May 10 15:53:14 2012 +0300
iwlwifi: Check BSS ctx active before call mac80211
commit e19ebcab01cc130fa832764d453b263460ec3b91 upstream.
It is possible that the BSS context is not active (for example
when the current mode is set to GO), or that the vif->type is
different than station. In such a case we cannot
call mac80211 to report the average rssi for the interface
(the function assumes that the vif is valid and that the type
is station).
Reported-by: Daniel J Blueman
Reviewed-by: Emmanuel Grumbach
Signed-off-by: Ilan Peer
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit bd9f6140e697f52bdc7225d39a46c6b82d50cacc
Author: Eliad Peller
Date: Sun May 13 18:07:04 2012 +0300
mac80211: fail authentication when AP denied authentication
commit dac211ec10d268b9d09000093a9fa2ac1773894f upstream.
ieee80211\_rx\_mgmt\_auth() doesn't handle denied authentication
properly - it authenticates the station and waits for association
(for 5 seconds) instead of failing the authentication.
Fix it by destroying auth\_data and bailing out instead.
Signed-off-by: Eliad Peller
Acked-by: Johannes Berg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit b8e69df8d54f9458b38aee32a66ac82e3eaf2a6c
Author: Christian Lamparter
Date: Sat Jul 7 15:07:13 2012 +0200
mac80211: fix read outside array bounds
commit 353d09c6ceedc1cb0c54fe5002c0ca80b6ee6e4f upstream.
ieee802\_1d\_to\_ac is defined as a const int[8],
but the tid parameter has a range from 0 to 15.
Signed-off-by: Christian Lamparter
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 77a797164fa64308ead7da0b1898895979f10b15
Author: Johannes Berg
Date: Tue Jul 17 17:12:29 2012 +0200
b43: fix crash with OpenFWWF
commit 097b0e1bf18a00195cd89bb13565ddbc9b0df942 upstream.
b43 with open firmware crashes mac80211 because
it changes the number of queues at runtime which,
while it was never really supported, now crashes
mac80211 due to the new hardware queue logic.
Fix this by detecting open vs. proprietary fw
earlier and registering with mac80211 with the
right number of queues.
Tested-by: Stefan Lippers-Hollmann
Signed-off-by: Johannes Berg
Signed-off-by: John W. Linville
commit f616071b3dc6a09b4b364ba9f020aa744df68b61
Author: Johannes Berg
Date: Wed Jul 4 12:49:59 2012 +0200
mac80211: fix crash with single-queue drivers
commit a6f38ac3cc853189705006cc1e0f17ce8467a1df upstream.
Larry (and some others I think) reported that with
single-queue drivers mac80211 crashes when waking
the queues. This happens because we allocate just
a single queue for each virtual interface in case
the driver doesn't have at least 4 queues, but the
code stopping/waking the virtual interface queues
wasn't taking this into account.
Reported-by: Larry Finger
Tested-by: Larry Finger
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 5d87eafc65b032f71078008f9395503c366330bb
Author: Mikulas Patocka
Date: Thu Jul 19 06:13:36 2012 +0000
tun: fix a crash bug and a memory leak
commit b09e786bd1dd66418b69348cb110f3a64764626a upstream.
This patch fixes a crash
tun\_chr\_close -> netdev\_run\_todo -> tun\_free\_netdev -> sk\_release\_kernel ->
sock\_release -> iput(SOCK\_INODE(sock))
introduced by commit 1ab5ecb90cb6a3df1476e052f76a6e8f6511cb3d
The problem is that this socket is embedded in struct tun\_struct, it has
no inode, iput is called on invalid inode, which modifies invalid memory
and optionally causes a crash.
sock\_release also decrements sockets\_in\_use, this causes a bug that
"sockets: used" field in /proc/\*/net/sockstat keeps on decreasing when
creating and closing tun devices.
This patch introduces a flag SOCK\_EXTERNALLY\_ALLOCATED that instructs
sock\_release to not free the inode and not decrement sockets\_in\_use,
fixing both memory corruption and sockets\_in\_use underflow.
It should be backported to 3.3 an 3.4 stabke.
Signed-off-by: Mikulas Patocka
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7d9c864282b93edf60959aac2320cf8166aa0202
Author: Rajiv Andrade
Date: Tue Apr 24 17:38:17 2012 -0300
TPM: chip disabled state erronously being reported as error
commit 24ebe6670de3d1f0dca11c9eb372134c7ab05503 upstream.
tpm\_do\_selftest() attempts to read a PCR in order to
decide if one can rely on the TPM being used or not.
The function that's used by \_\_tpm\_pcr\_read() does not
expect the TPM to be disabled or deactivated, and if so,
reports an error.
It's fine if the TPM returns this error when trying to
use it for the first time after a power cycle, but it's
definitely not if it already returned success for a
previous attempt to read one of its PCRs.
The tpm\_do\_selftest() was modified so that the driver only
reports this return code as an error when it really is.
Reported-and-tested-by: Paul Bolle
Signed-off-by: Rajiv Andrade
Signed-off-by: Greg Kroah-Hartman
commit 87f2dfbf9bfd65659c2ac4ae68ad19d6ed569b6d
Author: Colin Cross
Date: Thu Jul 19 10:38:06 2012 +0200
PM / Sleep: call early resume handlers when suspend\_noirq fails
commit 064b021fbe470ecc9ca10f9f87af48c0fc0865fb upstream.
Commit cf579dfb82550e34de7ccf3ef090d8b834ccd3a9 (PM / Sleep: Introduce
"late suspend" and "early resume" of devices) introduced a bug where
suspend\_late handlers would be called, but if dpm\_suspend\_noirq returned
an error the early\_resume handlers would never be called. All devices
would end up on the dpm\_late\_early\_list, and would never be resumed
again.
Fix it by calling dpm\_resume\_early when dpm\_suspend\_noirq returns
an error.
Signed-off-by: Colin Cross
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 4a8a3f40f83b93cb1a3f8392b669d8640c976448
Author: Rafael J. Wysocki
Date: Thu Jul 19 00:00:58 2012 +0200
PM / Sleep: Require CAP\_BLOCK\_SUSPEND to use wake\_lock/wake\_unlock
commit 11388c87d2abca1f01975ced28ce9eacea239104 upstream.
Require processes wanting to use the wake\_lock/wake\_unlock sysfs
files to have the CAP\_BLOCK\_SUSPEND capability, which also is
required for the eventpoll EPOLLWAKEUP flag to be effective, so that
all interfaces related to blocking autosleep depend on the same
capability.
Signed-off-by: Rafael J. Wysocki
Acked-by: Michael Kerrisk
Signed-off-by: Greg Kroah-Hartman
commit 8d0c5f5b12ef71e5656f2eae8dea498271c7cd75
Author: Srivatsa S. Bhat
Date: Sat Jun 16 15:30:45 2012 +0200
ftrace: Disable function tracing during suspend/resume and hibernation, again
commit 443772d408a25af62498793f6f805ce3c559309a upstream.
If function tracing is enabled for some of the low-level suspend/resume
functions, it leads to triple fault during resume from suspend, ultimately
ending up in a reboot instead of a resume (or a total refusal to come out
of suspended state, on some machines).
This issue was explained in more detail in commit f42ac38c59e0a03d (ftrace:
disable tracing for suspend to ram). However, the changes made by that commit
got reverted by commit cbe2f5a6e84eebb (tracing: allow tracing of
suspend/resume & hibernation code again). So, unfortunately since things are
not yet robust enough to allow tracing of low-level suspend/resume functions,
suspend/resume is still broken when ftrace is enabled.
So fix this by disabling function tracing during suspend/resume & hibernation.
Signed-off-by: Srivatsa S. Bhat
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit db7711b459e7ba26be8818f24d22446606194b26
Author: J. Bruce Fields
Date: Mon Jul 23 15:17:17 2012 -0400
locks: fix checking of fcntl\_setlease argument
commit 0ec4f431eb56d633da3a55da67d5c4b88886ccc7 upstream.
The only checks of the long argument passed to fcntl(fd,F\_SETLEASE,.)
are done after converting the long to an int. Thus some illegal values
may be let through and cause problems in later code.
[ They actually \*don't\* cause problems in mainline, as of Dave Jones's
commit 8d657eb3b438 "Remove easily user-triggerable BUG from
generic\_setlease", but we should fix this anyway. And this patch will
be necessary to fix real bugs on earlier kernels. ]
Signed-off-by: J. Bruce Fields
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 1a556b7cf880f1bc1edc7d8617c6ac53274e9e02
Author: Tony Luck
Date: Wed Jul 11 10:20:47 2012 -0700
x86/mce: Fix siginfo\_t->si\_addr value for non-recoverable memory faults
commit 6751ed65dc6642af64f7b8a440a75563c8aab7ae upstream.
In commit dad1743e5993f1 ("x86/mce: Only restart instruction after machine
check recovery if it is safe") we fixed mce\_notify\_process() to force a
signal to the current process if it was not restartable (RIPV bit not
set in MCG\_STATUS). But doing it here means that the process doesn't
get told the virtual address of the fault via siginfo\_t->si\_addr. This
would prevent application level recovery from the fault.
Make a new MF\_MUST\_KILL flag bit for memory\_failure() et al. to use so
that we will provide the right information with the signal.
Signed-off-by: Tony Luck
Acked-by: Borislav Petkov
Signed-off-by: Greg Kroah-Hartman
commit 7d5fdbb9069bbdc679a24cd6ca634c0dc2d66442
Author: Borislav Petkov
Date: Thu Jun 21 14:07:16 2012 +0200
x86, microcode: Sanitize per-cpu microcode reloading interface
commit c9fc3f778a6a215ace14ee556067c73982b6d40f upstream.
Microcode reloading in a per-core manner is a very bad idea for both
major x86 vendors. And the thing is, we have such interface with which
we can end up with different microcode versions applied on different
cores of an otherwise homogeneous wrt (family,model,stepping) system.
So turn off the possibility of doing that per core and allow it only
system-wide.
This is a minimal fix which we'd like to see in stable too thus the
more-or-less arbitrary decision to allow system-wide reloading only on
the BSP:
$ echo 1 > /sys/devices/system/cpu/cpu0/microcode/reload
...
and disable the interface on the other cores:
$ echo 1 > /sys/devices/system/cpu/cpu23/microcode/reload
-bash: echo: write error: Invalid argument
Also, allowing the reload only from one CPU (the BSP in
that case) doesn't allow the reload procedure to degenerate
into an O(n^2) deal when triggering reloads from all
/sys/devices/system/cpu/cpuX/microcode/reload sysfs nodes
simultaneously.
A more generic fix will follow.
Cc: Henrique de Moraes Holschuh
Cc: Peter Zijlstra
Signed-off-by: Borislav Petkov
Link: http://lkml.kernel.org/r/1340280437-7718-2-git-send-email-bp@amd64.org
Signed-off-by: H. Peter Anvin
Signed-off-by: Greg Kroah-Hartman
commit cb285339057b99c92ba1704d4ca0361abd8c92b8
Author: David Henningsson
Date: Fri Jul 20 10:37:25 2012 +0200
ALSA: hda - add dock support for Thinkpad X230 Tablet
commit 108cc108a3bb42fe4705df1317ff98e1e29428a6 upstream.
Also add a model/fixup string "lenovo-dock", so that other Thinkpad
users will be able to test this fixup easily, to see if it enables
dock I/O for them as well.
BugLink: https://bugs.launchpad.net/bugs/1026953
Tested-by: John McCarron
Signed-off-by: David Henningsson
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 7d9d6c8657eb8542dbe2d22a9135883c0cc4663c
Author: Sarah Sharp
Date: Thu Jul 5 14:09:30 2012 -0700
USB: Fix LPM disable count mismatch on driver unbind.
commit 249719121bc2b841bdfcab5eb21b10d8b871743b upstream.
When a user runs `echo 0 > bConfigurationValue` for a USB 3.0 device,
usb\_disable\_device() is called. This function disables all drivers,
deallocates interfaces, and sets the device configuration value to 0
(unconfigured).
With the new scheme to ensure that unconfigured devices have LPM
disabled, usb\_disable\_device() must call usb\_unlocked\_disable\_lpm() once
it unconfigures the device.
This commit should be backported to kernels as old as 3.5, that contain
the commit 8306095fd2c1100e8244c09bf560f97aca5a311d "USB: Disable USB
3.0 LPM in critical sections."
Signed-off-by: Sarah Sharp
Signed-off-by: Greg Kroah-Hartman
commit 92e6be29a445e0a3d2edceea5d2e8659864ed52d
Author: Sarah Sharp
Date: Thu Jul 5 09:41:22 2012 -0700
USB: Remove unused LPM variable.
commit c5c4bdf02e518a281b229ae0891b346919e2d291 upstream.
hub\_initiated\_lpm\_disable\_count is not used by any code, so remove it.
This commit should be backported to kernels as old as 3.5, that contain
the commit 8306095fd2c1100e8244c09bf560f97aca5a311d "USB: Disable USB
3.0 LPM in critical sections."
Signed-off-by: Sarah Sharp
Signed-off-by: Greg Kroah-Hartman
commit 04947ee17649afcaf53fe40ae74c79c2e81b0615
Author: Sarah Sharp
Date: Tue Jul 3 22:49:04 2012 -0700
USB: Fix LPM disable/enable during device reset.
commit 6d1d051330ee096f575523647fbd8ffe703600b5 upstream.
The USB 3.0 specification says that sending a Set Feature or Clear
Feature for U1/U2 Enable is not a valid request when the device is in
the Default or Addressed state. It is only valid when the device is in
the Configured state.
The original LPM patch attempted to disable LPM after the device had
been reset by hub\_port\_init(), before it had the configuration
reinstalled. The TI hub I tested with did not fail the Clear Feature
U1/U2 Enable request that khubd sent while it was in the addressed
state, which is why I didn't catch it.
Move the LPM disable before the device reset, so that we can send the
Clear Feature U1/U2 Enable successfully, and balance the LPM disable
count.
Also delete any calls to usb\_enable\_lpm() on error paths that lead to
re-enumeration. The calls will fail because the device isn't
configured, and it's not useful to balance the LPM disable count because
the usb\_device is about to be destroyed before re-enumeration.
Fix the early exit path ("done" label) to call usb\_enable\_lpm() to
balance the LPM disable count.
Note that calling usb\_reset\_and\_verify\_device() with an unconfigured
device may fail on the first call to usb\_disable\_lpm(). That's because
the LPM disable count is initialized to 0 (LPM enabled), and
usb\_disable\_lpm() will attempt to send a Clear Feature U1/U2 request to
a device in the Addressed state. The next patch will fix that.
This commit should be backported to kernels as old as 3.5, that contain
the commit 8306095fd2c1100e8244c09bf560f97aca5a311d "USB: Disable USB
3.0 LPM in critical sections."
Signed-off-by: Sarah Sharp
Signed-off-by: Greg Kroah-Hartman
commit 9d8d9322bf9445bc2a9241a5c64fcd98f1cb41cd
Author: Sarah Sharp
Date: Tue Jul 3 23:22:38 2012 -0700
USB: Disable LPM while the device is unconfigured.
commit 9cf65991dd93ac3d5f97f536171c388918b7c1a9 upstream.
The USB 3.0 Set/Clear Feature U1/U2 Enable cannot be sent to a device in
the Default or Addressed state. It can only be sent to a configured
device. Change the USB core to initialize the LPM disable count to 1
(disabled), which reflects this limitation.
Change usb\_set\_configuration() to ensure that if the device is
unconfigured on entry, usb\_lpm\_disable() is not called. This avoids
sending the Clear Feature U1/U2 when the device is in the Addressed
state. When usb\_set\_configuration() exits with a successfully installed
configuration, usb\_lpm\_enable() will be called.
Once the new configuration is installed, make sure
usb\_set\_configuration() only calls usb\_enable\_lpm() if the device moved
to the Configured state. If we have unconfigured the device by sending
it a Set Configuration for config 0, don't enable LPM.
This commit should be backported to kernels as old as 3.5, that contain
the commit 8306095fd2c1100e8244c09bf560f97aca5a311d "USB: Disable USB
3.0 LPM in critical sections."
Signed-off-by: Sarah Sharp
Signed-off-by: Greg Kroah-Hartman
commit 4d86eca2853bfc96b7644b00a18236876984c732
Author: Gerd Hoffmann
Date: Tue Jun 19 09:54:48 2012 +0200
Revert "usb/uas: make sure data urb is gone if we receive status before that"
commit c621a81edecdee85da32c566c21836332c764fda upstream.
This reverts commit e4d8318a85779b25b880187b1b1c44e797bd7d4b.
This patch makes uas.c call usb\_unlink\_urb on data urbs. The data urbs
get freed in the completion callback. This is illegal according to the
usb\_unlink\_urb documentation.
This patch also makes the code expect the data completion callback
being called before the status completion callback. This isn't
guaranteed to be the case, even though the actual data transfer should
be finished by the time the status is received.
Background: The ehci irq handler for example only know that there are
finished transfers, it then has go check the QHs & TDs to see which
transfers did actually finish. It has no way to figure in which order
the transfers did complete. The xhci driver can call the callbacks in
completion order thanks to the event queue. This does nicely explain
why the driver is solid on a (usb2) xhci port whereas it goes crazy on
ehci in my testing.
Signed-off-by: Gerd Hoffmann
Signed-off-by: Greg Kroah-Hartman
commit ba8d80173baddb3ff4926c320b78fd07b5277185
Author: Bjørn Mork
Date: Thu Jul 12 12:37:32 2012 +0200
USB: option: add ZTE MF821D
commit 09110529780890804b22e997ae6b4fe3f0b3b158 upstream.
Sold by O2 (telefonica germany) under the name "LTE4G"
Tested-by: Thomas Schäfer
Signed-off-by: Bjørn Mork
Signed-off-by: Greg Kroah-Hartman
commit 70264a590873e34ee57e3dff9e8962d4516fe6ba
Author: Kevin Cernekee
Date: Sun Jun 24 21:11:22 2012 -0700
usb: gadget: Fix g\_ether interface link status
commit 31bde1ceaa873bcaecd49e829bfabceacc4c512d upstream.
A "usb0" interface that has never been connected to a host has an unknown
operstate, and therefore the IFF\_RUNNING flag is (incorrectly) asserted
when queried by ifconfig, ifplugd, etc. This is a result of calling
netif\_carrier\_off() too early in the probe function; it should be called
after register\_netdev().
Similar problems have been fixed in many other drivers, e.g.:
e826eafa6 (bonding: Call netif\_carrier\_off after register\_netdevice)
0d672e9f8 (drivers/net: Call netif\_carrier\_off at the end of the probe)
6a3c869a6 (cxgb4: fix reported state of interfaces without link)
Fix is to move netif\_carrier\_off() to the end of the function.
Signed-off-by: Kevin Cernekee
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 98b8cee65f67067befa26159b1feeba2251659b5
Author: Hans de Goede
Date: Wed Jul 4 09:18:01 2012 +0200
usbdevfs: Correct amount of data copied to user in processcompl\_compat
commit 2102e06a5f2e414694921f23591f072a5ba7db9f upstream.
iso data buffers may have holes in them if some packets were short, so for
iso urbs we should always copy the entire buffer, just like the regular
processcompl does.
Signed-off-by: Hans de Goede
Acked-by: Alan Stern
Signed-off-by: Greg Kroah-Hartman
commit aa24e180a53bccf941e9f4d1e2a996c44191cfa9
Author: Benjamin Tissoires
Date: Tue Jun 19 14:39:52 2012 +0200
HID: hid-multitouch: fix input mode feature command
commit 4aceed37e315e8eaa26cb4c8dfd619a32fa24669 upstream.
Zytronic panels shows a new way of setting the Input Mode feature.
This feature is put in the second usage in the HID feature, instead
of the first, as the majority of the multitouch devices.
This patch adds a detection step when the feature is presented to know
where the feature is located in the report. We can then trigger the right
command to the device. This removes the magic number "0" in the function
mt\_set\_input\_mode.
Signed-off-by: Benjamin Tissoires
Signed-off-by: Jiri Kosina
Cc: Simon Farnsworth
Signed-off-by: Greg Kroah-Hartman
commit a491efddf2e4696794f17a38c77433409a8a52bb
Author: Dylan Reid
Date: Thu Jun 21 21:51:22 2012 -0700
ALSA: hda - Don't power up when not powered down.
commit b43d224767e426cf1a8b6622d1d172f2b2b0e857 upstream.
After cancel\_delayed\_work\_sync returns, the power down work either never
started (power\_on == 1) or finished (power\_on == 0). In the former case
there is no need to power up again.
Signed-off-by: Dylan Reid
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 7eb31a7c9f3d531078e85e461a35db20d3c74ba7
Author: Dylan Reid
Date: Thu Jul 19 17:52:58 2012 -0700
ALSA: hda - Turn on PIN\_OUT from hdmi playback prepare.
commit 9e76e6d031482194a5b24d8e9ab88063fbd6b4b5 upstream.
Turn on the pin widget's PIN\_OUT bit from playback prepare. The pin is
enabled in open, but is disabled in hdmi\_init\_pin which is called during
system resume. This causes a system suspend/resume during playback to
mute HDMI/DP. Enabling the pin in prepare instead of open allows calling
snd\_pcm\_prepare after a system resume to restore audio.
Signed-off-by: Dylan Reid
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 1569d721a9f667c4ad7ad6485759c85e45111137
Author: David Henningsson
Date: Wed Jul 18 07:38:46 2012 +0200
ALSA: hda - Add support for Realtek ALC282
commit 4e01ec636e64707d202a1ca21a47bbc6d53085b7 upstream.
This codec has a separate dmic path (separate dmic only ADC),
and thus it looks mostly like ALC275.
BugLink: https://bugs.launchpad.net/bugs/1025377
Tested-by: Ray Chen
Signed-off-by: David Henningsson
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit f872122ebb0a43181addd465bbfbc5bd66e27f84
Author: Mark Brown
Date: Wed Jul 11 19:03:48 2012 +0100
ASoC: wm8962: Redo early init of the part on resume
commit e4dd76788c7e5b27165890d712c8c4f6f0abd645 upstream.
Ensure robust startup of the part by going through the reset procedure
prior to resyncing the full register cache, avoiding potential intermittent
faults in some designs.
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit b1f7d1337973f019c812a042f25a8679839514e4
Author: Mark Brown
Date: Fri Jul 20 17:29:34 2012 +0100
ASoC: dapm: Fix \_PRE and \_POST events for DAPM performance improvements
commit 0ff97ebf0804d2e519d578fcb4db03f104d2ca8c upstream.
Ever since the DAPM performance improvements we've been marking all widgets
as not dirty after each DAPM run. Since \_PRE and \_POST events aren't part
of the DAPM graph this has rendered them non-functional, they will never be
marked dirty again and thus will never be run again.
Fix this by skipping them when marking widgets as not dirty.
Signed-off-by: Mark Brown
Acked-by: Liam Girdwood
Signed-off-by: Greg Kroah-Hartman
commit 1bcf4064cc1abefe860d6b3716f4e21a030cefc1
Author: Liam Girdwood
Date: Fri Jul 6 16:57:05 2012 +0100
ASoC: dapm: Fix locking during codec shutdown
commit 01005a729a17ab419f61a366e22f3419e7a2c3fe upstream.
Codec shutdown performs a DAPM power sequence that might cause conflicts
and/or race conditions if another stream power event is running simultaneously.
Use card's dapm mutex to protect any potential race condition between them.
Signed-off-by: Misael Lopez Cruz
Signed-off-by: Liam Girdwood
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 91352cfc7d2b1029a2659fadf69cf278aa2f1557
Author: Stephen Warren
Date: Wed Jul 25 14:02:44 2012 -0600
ARM: dt: tegra trimslice: add vbus-gpio property
commit 01ad8063a5db9ac8320f197577a34b423ba64eca upstream.
On TrimSlice, Tegra's USB1 port may be routed to either an external micro
USB port, or an internal USB->SATA bridge for SSD or HDD. This muxing is
controlled by a GPIO. Whilst not strictly a VBUS GPIO, the TrimSlice
board files caused this GPIO to be set appropriately to enable the SATA
bridge by passing it as the VBUS GPIO to the USB driver. Echo this same
configuration in device tree to enable the SATA bridge.
An alternative might be to implement a full USB bus mux driver. However,
that seems over-complex right now.
Signed-off-by: Stephen Warren
Signed-off-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit ca32dc5c86cc621749853495b9244231f0b2e6e3
Author: Nishanth Menon
Date: Fri May 18 12:26:19 2012 -0500
ARM: OMAP2+: OPP: Fix to ensure check of right oppdef after bad one
commit b110547e586eb5825bc1d04aa9147bff83b57672 upstream.
Commit 9fa2df6b90786301b175e264f5fa9846aba81a65
(ARM: OMAP2+: OPP: allow OPP enumeration to continue if device is not present)
makes the logic:
for (i = 0; i < opp\_def\_size; i++) {
if (!oh || !oh->od) {
continue;
}
opp\_def++;
}
In short, the moment we hit a "Bad OPP", we end up looping the list
comparing against the bad opp definition pointer for the rest of the
iteration count. Instead, increment opp\_def in the for loop itself
and allow continue to be used in code without much thought so that
we check the next set of OPP definition pointers :)
Cc: Steve Sakoman
Cc: Tony Lindgren
Signed-off-by: Nishanth Menon
Signed-off-by: Kevin Hilman
Signed-off-by: Greg Kroah-Hartman
commit 9f1dc74c1378d02d9cbc318851300b8c341da904
Author: Stephen Warren
Date: Wed Jul 25 14:02:43 2012 -0600
ARM: dt: tegra trimslice: enable USB2 port
commit a6a3dd1aed31ace7c827236c53d83f4e845dcff2 upstream.
This was accidentally disabled by commit 2a5fdc9 "ARM: dt: tegra:
invert status=disable vs status=okay".
Signed-off-by: Stephen Warren
Signed-off-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit a37ef829d05aa53b09d02471987e6dc5b8fc6ffb
Author: Albert Pool
Date: Mon May 14 18:08:32 2012 +0200
rt2800usb: 2001:3c17 is an RT3370 device
commit 8fd9d059af12786341dec5a688e607bcdb372238 upstream.
D-Link DWA-123 rev A1
Signed-off-by: Albert Pool
Acked-by: Gertjan van Wingerde
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit cc13f1fb2f029fb2d4689252470029309a7ff682
Author: Bart Van Assche
Date: Fri Jun 29 15:34:26 2012 +0000
SCSI: Avoid dangling pointer in scsi\_requeue\_command()
commit 940f5d47e2f2e1fa00443921a0abf4822335b54d upstream.
When we call scsi\_unprep\_request() the command associated with the request
gets destroyed and therefore drops its reference on the device. If this was
the only reference, the device may get released and we end up with a NULL
pointer deref when we call blk\_requeue\_request.
Reported-by: Mike Christie
Signed-off-by: Bart Van Assche
Reviewed-by: Mike Christie
Reviewed-by: Tejun Heo
[jejb: enhance commend and add commit log for stable]
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 4d9157ec5aecf5eab7c94b09c24131fc53424118
Author: Bart Van Assche
Date: Fri Jun 29 15:33:22 2012 +0000
SCSI: Fix device removal NULL pointer dereference
commit 67bd94130015c507011af37858989b199c52e1de upstream.
Use blk\_queue\_dead() to test whether the queue is dead instead
of !sdev. Since scsi\_prep\_fn() may be invoked concurrently with
\_\_scsi\_remove\_device(), keep the queuedata (sdev) pointer in
\_\_scsi\_remove\_device(). This patch fixes a kernel oops that
can be triggered by USB device removal. See also
http://www.spinics.net/lists/linux-scsi/msg56254.html.
Other changes included in this patch:
- Swap the blk\_cleanup\_queue() and kfree() calls in
scsi\_host\_dev\_release() to make that code easier to grasp.
- Remove the queue dead check from scsi\_run\_queue() since the
queue state can change anyway at any point in that function
where the queue lock is not held.
- Remove the queue dead check from the start of scsi\_request\_fn()
since it is redundant with the scsi\_device\_online() check.
Reported-by: Jun'ichi Nomura
Signed-off-by: Bart Van Assche
Reviewed-by: Mike Christie
Reviewed-by: Tejun Heo
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 10f8d5b86743b33d841a175303e2bf67fd620f42
Author: Dan Williams
Date: Thu Jun 21 23:47:28 2012 -0700
SCSI: fix hot unplug vs async scan race
commit 3b661a92e869ebe2358de8f4b3230ad84f7fce51 upstream.
The following crash results from cases where the end\_device has been
removed before scsi\_sysfs\_add\_sdev has had a chance to run.
BUG: unable to handle kernel NULL pointer dereference at 0000000000000098
IP: [] sysfs\_create\_dir+0x32/0xb6
...
Call Trace:
[] kobject\_add\_internal+0x120/0x1e3
[] ? trace\_hardirqs\_on+0xd/0xf
[] kobject\_add\_varg+0x41/0x50
[] kobject\_add+0x64/0x66
[] device\_add+0x12d/0x63a
[] ? \_raw\_spin\_unlock\_irqrestore+0x47/0x56
[] ? module\_refcount+0x89/0xa0
[] scsi\_sysfs\_add\_sdev+0x4e/0x28a
[] do\_scan\_async+0x9c/0x145
...teach scsi\_sysfs\_add\_devices() to check for deleted devices() before
trying to add them, and teach scsi\_remove\_target() how to remove targets
that have not been added via device\_add().
Reported-by: Dariusz Majchrzak
Signed-off-by: Dan Williams
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 443960954ee2e09b480822188e6c1b9f857e872f
Author: Dan Williams
Date: Thu Jun 21 23:25:32 2012 -0700
SCSI: fix eh wakeup (scsi\_schedule\_eh vs scsi\_restart\_operations)
commit 57fc2e335fd3c2f898ee73570dc81426c28dc7b4 upstream.
Rapid ata hotplug on a libsas controller results in cases where libsas
is waiting indefinitely on eh to perform an ata probe.
A race exists between scsi\_schedule\_eh() and scsi\_restart\_operations()
in the case when scsi\_restart\_operations() issues i/o to other devices
in the sas domain. When this happens the host state transitions from
SHOST\_RECOVERY (set by scsi\_schedule\_eh) back to SHOST\_RUNNING and
->host\_busy is non-zero so we put the eh thread to sleep even though
->host\_eh\_scheduled is active.
Before putting the error handler to sleep we need to check if the
host\_state needs to return to SHOST\_RECOVERY for another trip through
eh. Since i/o that is released by scsi\_restart\_operations has been
blocked for at least one eh cycle, this implementation allows those
i/o's to run before another eh cycle starts to discourage hung task
timeouts.
Reported-by: Tom Jackson
Tested-by: Tom Jackson
Signed-off-by: Dan Williams
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit f3d5671d07294ba382ac9ab08177304409a7e548
Author: Dan Williams
Date: Thu Jun 21 23:36:20 2012 -0700
SCSI: libsas: fix sas\_discover\_devices return code handling
commit b17caa174a7e1fd2e17b26e210d4ee91c4c28b37 upstream.
commit 198439e4 [SCSI] libsas: do not set res = 0 in sas\_ex\_discover\_dev()
commit 19252de6 [SCSI] libsas: fix wide port hotplug issues
The above commits seem to have confused the return value of
sas\_ex\_discover\_dev which is non-zero on failure and
sas\_ex\_join\_wide\_port which just indicates short circuiting discovery on
already established ports. The result is random discovery failures
depending on configuration.
Calls to sas\_ex\_join\_wide\_port are the source of the trouble as its
return value is errantly assigned to 'res'. Convert it to bool and stop
returning its result up the stack.
Tested-by: Dan Melnic
Reported-by: Dan Melnic
Signed-off-by: Dan Williams
Reviewed-by: Jack Wang
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 6a3723a73edfe5fecf3ab44dd50f11172d523780
Author: Dan Williams
Date: Thu Jun 21 23:36:15 2012 -0700
SCSI: libsas: continue revalidation
commit 26f2f199ff150d8876b2641c41e60d1c92d2fb81 upstream.
Continue running revalidation until no more broadcast devices are
discovered. Fixes cases where re-discovery completes too early in a
domain with multiple expanders with pending re-discovery events.
Servicing BCNs can get backed up behind error recovery.
Signed-off-by: Dan Williams
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 4e9cca830222266bc4d456d0ce7f13a376088e56
Author: Alan Cox
Date: Thu Jul 26 14:47:11 2012 -0700
smack: off by one error
commit 3b9fc37280c521b086943f9aedda767f5bf3b2d3 upstream.
Consider the input case of a rule that consists entirely of non space
symbols followed by a \0. Say 64 + \0
In this case strlen(data) = 64
kzalloc of subject and object are 64 byte objects
sscanfdata, "%s %s %s", subject, ...)
will put 65 bytes into subject.
Signed-off-by: Alan Cox
Acked-by: Casey Schaufler
Signed-off-by: James Morris
Signed-off-by: Greg Kroah-Hartman
commit 69f699e6189772036175b3b7d362c82b0d944d4d
Author: Timur Tabi
Date: Thu Jul 5 10:08:28 2012 -0500
powerpc/85xx: use the BRx registers to enable indirect mode on the P1022DS
commit 6bd825f02966be8ba544047cab313d6032c23819 upstream.
In order to enable the DIU video controller on the P1022DS, the FPGA needs
to be switched to "indirect mode", where the localbus is disabled and
the FPGA is accessed via writes to localbus chip select signals CS0 and CS1.
To obtain the address of CS0 and CS1, the platform driver uses an "indirect
pixis mode" device tree node. This node assumes that the localbus 'ranges'
property is sorted in chip-select order. That is, reg value 0 maps to
CS0, reg value 1 maps to CS1, etc. This is how the 'ranges' property is
supposed to be arranged.
Unfortunately, the 'ranges' property is often mis-arranged, and not just on
the P1022DS. Linux normally does not care, since it does not program the
localbus. But the indirect-mode code on the P1022DS does care.
The "proper" fix is to have U-Boot fix the 'ranges' property, but this would
be too cumbersome. The names and 'reg' properties of all the localbus
devices would also need to be updated, and determining which localbus device
maps to which chip select is board-specific.
Instead, we determine the CS0/CS1 base addresses the same way that U-boot
does -- by reading the BRx registers directly and mapping them to physical
addresses. This code is simpler and more reliable, and it does not require
a U-boot or device tree change.
Since the indirect pixis device tree node is no longer needed, the node is
deleted from the DTS.
Signed-off-by: Timur Tabi
Signed-off-by: Kumar Gala
Signed-off-by: Greg Kroah-Hartman
commit 0a24745eefd8896295afec304f7d52941f336734
Author: Anton Blanchard
Date: Tue Jul 24 15:05:25 2012 +0000
be2net: Missing byteswap in be\_get\_fw\_log\_level causes oops on PowerPC
commit ac46a4623815113a0305b2a491c125f473a88c53 upstream.
We are seeing an oops in be\_get\_fw\_log\_level on ppc64 where we walk
off the end of memory.
commit 941a77d582c8 (be2net: Fix to allow get/set of debug levels in
the firmware.) requires byteswapping of num\_modes and num\_modules.
Signed-off-by: Anton Blanchard
Acked-by: Sathya Perla
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ed29dbdecb478f6bb8eb40e3f053f3ca76faaff8
Author: Kleber Sacilotto de Souza
Date: Thu Jul 12 17:14:36 2012 +0000
powerpc/eeh: Check handle\_eeh\_events() return value
commit 10db8d212864cb6741df7d7fafda5ab6661f6f88 upstream.
Function eeh\_event\_handler() dereferences the pointer returned by
handle\_eeh\_events() without checking, causing a crash if NULL was
returned, which is expected in some situations.
This patch fixes this bug by checking for the value returned by
handle\_eeh\_events() before dereferencing it.
Signed-off-by: Kleber Sacilotto de Souza
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit b78ea743c537868531ad05c161d2c6cb617c3ecc
Author: Tiejun Chen
Date: Wed Jul 11 14:22:46 2012 +1000
powerpc: Add "memory" attribute for mfmsr()
commit b416c9a10baae6a177b4f9ee858b8d309542fbef upstream.
Add "memory" attribute in inline assembly language as a compiler
barrier to make sure 4.6.x GCC don't reorder mfmsr().
Signed-off-by: Tiejun Chen
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 47f679f142db9df3006a342e9a0643495fa955a3
Author: roger blofeld
Date: Thu Jun 21 05:27:14 2012 +0000
powerpc/ftrace: Fix assembly trampoline register usage
commit fd5a42980e1cf327b7240adf5e7b51ea41c23437 upstream.
Just like the module loader, ftrace needs to be updated to use r12
instead of r11 with newer gcc's.
Signed-off-by: Roger Blofeld
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Paul Gortmaker
Signed-off-by: Greg Kroah-Hartman
commit 471963efff64303be0d80ac6a47a70ef55b8e7b6
Author: Aaron Lu
Date: Tue Jul 3 17:27:49 2012 +0800
mmc: sdhci: fix incorrect command used in tuning
commit 473b095a72a95ba719905b1f2e82cd18d099a427 upstream.
For SD hosts using retuning mode 1, when retuning timer expired, it will
need to do retuning in sdhci\_request before processing the actual
request. But the retuning command is fixed: cmd19 for SD card and cmd21
for eMMC card, so we can't use the original request's command to do the
tuning.
And since the tuning command depends on the card type attached to the
host, we will need to know the card type to use the correct tuning
command.
Signed-off-by: Aaron Lu
Reviewed-by: Philip Rakity
Signed-off-by: Chris Ball
Signed-off-by: Greg Kroah-Hartman
commit 8f475b5ca690666cf4f4e465eb4e90dda08567e6
Author: Daniel Drake
Date: Tue Jul 3 23:13:39 2012 +0100
mmc: sdhci-pci: CaFe has broken card detection
commit 55fc05b7414274f17795cd0e8a3b1546f3649d5e upstream.
At http://dev.laptop.org/ticket/11980 we have determined that the
Marvell CaFe SDHCI controller reports bad card presence during
resume. It reports that no card is present even when it is.
This is a regression -- resume worked back around 2.6.37.
Around 400ms after resuming, a "card inserted" interrupt is
generated, at which point it starts reporting presence.
Work around this hardware oddity by setting the
SDHCI\_QUIRK\_BROKEN\_CARD\_DETECTION flag.
Thanks to Chris Ball for helping with diagnosis.
Signed-off-by: Daniel Drake
Signed-off-by: Chris Ball
Signed-off-by: Greg Kroah-Hartman
commit d2dcab7be28c5431ac85bc88face77fcb91503d5
Author: Al Viro
Date: Sat Jul 21 08:55:18 2012 +0100
iscsi-target: Drop bogus struct file usage for iSCSI/SCTP
commit bf6932f44a7b3fa7e2246a8b18a44670e5eab6c2 upstream.
From Al Viro:
BTW, speaking of struct file treatment related to sockets -
there's this piece of code in iscsi:
/\*
\* The SCTP stack needs struct socket->file.
\*/
if ((np->np\_network\_transport == ISCSI\_SCTP\_TCP) ||
(np->np\_network\_transport == ISCSI\_SCTP\_UDP)) {
if (!new\_sock->file) {
new\_sock->file = kzalloc(
sizeof(struct file), GFP\_KERNEL);
For one thing, as far as I can see it'not true - sctp does \*not\* depend on
socket->file being non-NULL; it does, in one place, check socket->file->f\_flags
for O\_NONBLOCK, but there it treats NULL socket->file as "flag not set".
Which is the case here anyway - the fake struct file created in
\_\_iscsi\_target\_login\_thread() (and in iscsi\_target\_setup\_login\_socket(), with
the same excuse) do \*not\* get that flag set.
Moreover, it's a bloody serious violation of a bunch of asserts in VFS;
all struct file instances should come from filp\_cachep, via get\_empty\_filp()
(or alloc\_file(), which is a wrapper for it). FWIW, I'm very tempted to
do this and be done with the entire mess:
Signed-off-by: Al Viro
Cc: Andy Grover
Cc: Hannes Reinecke
Cc: Christoph Hellwig
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit a3c28db4f6072325d4a72e0adcd969c290dc9560
Author: Roland Dreier
Date: Mon Jul 16 15:34:21 2012 -0700
target: Add generation of LOGICAL BLOCK ADDRESS OUT OF RANGE
commit e2397c704429025bc6b331a970f699e52f34283e upstream.
Many SCSI commands are defined to return a CHECK CONDITION / ILLEGAL
REQUEST with ASC set to LOGICAL BLOCK ADDRESS OUT OF RANGE if the
initiator sends a command that accesses a too-big LBA. Add an enum
value and case entries so that target code can return this status.
Signed-off-by: Roland Dreier
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman


=== Content from github.com_668261d3_20250125_225100.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  438](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

futex: Forbid uaddr == uaddr2 in futex\_wait\_requeue\_pi()

[Browse files](/torvalds/linux/tree/6f7b0a2a5c0fb03be7c25bd1745baa50582348ef)
Browse the repository at this point in the history

```
If uaddr == uaddr2, then we have broken the rule of only requeueing
from a non-pi futex to a pi futex with this call. If we attempt this,
as the trinity test suite manages to do, we miss early wakeups as
q.key is equal to key2 (because they are the same uaddr). We will then
attempt to dereference the pi_mutex (which would exist had the futex_q
been properly requeued to a pi futex) and trigger a NULL pointer
dereference.

Signed-off-by: Darren Hart <dvhart@linux.intel.com>
Cc: Dave Jones <davej@redhat.com>
Cc: stable@vger.kernel.org
Link: [http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart@linux.intel.com](http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart%40linux.intel.com)
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
```

* Loading branch information

[![@dvhart](https://avatars.githubusercontent.com/u/36253?s=40&v=4)](/dvhart) [![@KAGA-KOKO](https://avatars.githubusercontent.com/u/171241280?s=40&v=4)](/KAGA-KOKO)

[dvhart](/torvalds/linux/commits?author=dvhart "View all commits by dvhart")
authored and
[KAGA-KOKO](/torvalds/linux/commits?author=KAGA-KOKO "View all commits by KAGA-KOKO")
committed
Jul 24, 2012

1 parent
[f27071c](/torvalds/linux/commit/f27071cb7fe3e1d37a9dbe6c0dfc5395cd40fa43)

commit 6f7b0a2

Showing
**1 changed file**
with
**8 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

13 changes: 8 additions & 5 deletions

13
[kernel/futex.c](#diff-a0e09fac216f72474730fca968820dba5f2b4c2155797f5008cc5a0df70cbcf2 "kernel/futex.c")

Show comments

[View file](/torvalds/linux/blob/6f7b0a2a5c0fb03be7c25bd1745baa50582348ef/kernel/futex.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2231,11 +2231,11 @@ int handle\_early\_requeue\_pi\_wakeup(struct futex\_hash\_bucket \*hb, |
|  |  | \* @uaddr2: the pi futex we will take prior to returning to user-space |
|  |  | \* |
|  |  | \* The caller will wait on uaddr and will be requeued by futex\_requeue() to |
|  |  | \* uaddr2 which must be PI aware. Normal wakeup will wake on uaddr2 and |
|  |  | \* complete the acquisition of the rt\_mutex prior to returning to userspace. |
|  |  | \* This ensures the rt\_mutex maintains an owner when it has waiters; without |
|  |  | \* one, the pi logic wouldn't know which task to boost/deboost, if there was a |
|  |  | \* need to. |
|  |  | \* uaddr2 which must be PI aware and unique from uaddr. Normal wakeup will wake |
|  |  | \* on uaddr2 and complete the acquisition of the rt\_mutex prior to returning to |
|  |  | \* userspace. This ensures the rt\_mutex maintains an owner when it has waiters; |
|  |  | \* without one, the pi logic would not know which task to boost/deboost, if |
|  |  | \* there was a need to. |
|  |  | \* |
|  |  | \* We call schedule in futex\_wait\_queue\_me() when we enqueue and return there |
|  |  | \* via the following: |
| Expand Down  Expand Up | | @@ -2272,6 +2272,9 @@ static int futex\_wait\_requeue\_pi(u32 \_\_user \*uaddr, unsigned int flags, |
|  |  | struct futex\_q q = futex\_q\_init; |
|  |  | int res, ret; |
|  |  |  |
|  |  | if (uaddr == uaddr2) |
|  |  | return -EINVAL; |
|  |  |  |
|  |  | if (!bitset) |
|  |  | return -EINVAL; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6f7b0a2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F6f7b0a2a5c0fb03be7c25bd1745baa50582348ef) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_338701fc_20250125_225051.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](8) [[next>]](10) [[<thread-prev]](8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <201405141616.s4EGGG73004673@linus.mitre.org>
Date: Wed, 14 May 2014 12:16:16 -0400 (EDT)
From: cve-assign@...re.org
To: ppandit@...hat.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE request Linux kernel: forbid uaddr == uaddr2 in futex_wait_requeue_pi() to avoid null dereference

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> Linux kernel built with the fast userspace mutexes(CONFIG_FUTEX) support is
> vulnerable to a NULL pointer dereference flaw. It could occur when a waiting
> task requests wait to be re-queued from non-PI futex to a PI-aware futex via
> FUTEX_WAIT_REQUEUE_PI operation.
>
> An unprivileged user/program could use this flaw to crash the system kernel
> resulting in DoS.
>
> <https://git.kernel.org/linus/6f7b0a2a5c0fb03be7c25bd1745baa50582348ef>

Use CVE-2012-6647.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJTc5Z5AAoJEKllVAevmvmsmSkH/0eNY313nX9uZpL0ODQFolgq
mNjz1UE8XJd9ZeQYamteDtZu7K4xJfiuqtlImbkBEZ8gCnXuDIwKNisgCnkbpolE
/X8OzQVR3HL/ZVOJhuKtjztMxZenyEIpVNwHFnPWMs2fbsTHYCBP53KdaA1kW1tY
EPZ19X0AroIpMBBh1suzTLcxkIJEOCghQ/2lledEvx05ok+dgTstwe2FJ16tyKX1
M+6WQLhts42Rlhf/07bAMTRf03UsMmeDr9gWLtVsX6JXvzXqYHEEUUIzyDLZQjA+
ezfp/vL6sp67fPj8uz0DKWaJl2dMBk7W6p7fZYed4a66SCsNCgptWxpDsi5IvxI=
=T8n3
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


