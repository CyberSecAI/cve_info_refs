=== Content from www.cynops.de_aa092e16_20250125_182134.html ===


| Cynops Logo | Cynops network security engineering |
| --- | --- |

* [Consulting](../index.html "Consulting")
* [Open Source](../oss/index.html "Open Source")
* [Tech Zone](../techzone/index.html "Tech Zone")
* [Advisories](index.html "Advisories")
* [Impressum](../impressum.html "Impressum")

## HTTP over X.509 — a whitepaper

### Abstract

This whitepaper describes a security issue inherent in [RFC 3280](http://www.faqs.org/rfcs/rfc3280.html) (Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile). If a certain feature (the authority information access caIssuers extension) is implemented as proposed by the RFC, unauthenticated users can potentially send arbitrary HTTP requests from the machine parsing a sent certificate. The whitepaper describes the issue in depth, provides information on which applications are vulnerable and which are not and looks at potential mitigation paths.

### Background

To understand the vulnerability, we first have to understand how (non-trivial) certificate chains work. In a typical setting with one root certificate authority (CA) and one intermediate CA, there are basically three different ways on how to handle the validation of the certificate path.

#### Different ways of handling intermediate CA certificates

| certificate chain, intermediate CA certificate stored on server | certificate chain, intermediate CA certificate sent by client | certificate chain, intermediate CA certificate referenced using authorityInformationAccess caIssuers extension |
| --- | --- | --- |
| | 1. | Intermediate certificate stored on server | | --- | --- | | | 2. | Intermediate certificate sent by client | | --- | --- | | | 3. | Intermediate certificate referenced in end-entity certificate (authorityInfoAccess caIssuers extension) | | --- | --- | |

The images above show the different methods that the intermediate CA certificate can be included in the certificate verification. In the first version, the intermediate CA certificate(s) are stored on the server. This has the disadvantage of having to roll out the intermediate CA certificates on the server. Alternatively, the client can also send the intermediate CA certificate, which similarly has the disadvantage of having to install it on the client (and additional overhead in the messages from client to server). The most elegant solution is to use the authority information access extension as defined in section 4.2.2.1 and specify the URI of the intermediate certificate within the end-entity certificate itself. The server then fetches the intermediate certificate from the given URI and uses it for the certificate chain validation. It can also cache the intermediate certificate, so that it does not have to fetch it again.

### The issue

However, elegant does not usually mean secure. The problem in this case is that until the certificate chain is verified, the user sending the certificate is usually untrusted. This means that the specified URI has to be treated as potentially evil input from an unauthenticated user. This simple fact is missing from the »Security Considerations« section of the RFC and thus implementors have gotten it wrong.

When implemented naively, this means that an unauthenticated user can embed arbitrary URIs within a certificate and can thus force the verifier to send out arbitrary HTTP requests on its behalf — for example to networks formerly unreachable to an attacker. The response itself is not forwarded to the attacker, so he is limited to blind attacks. A specific case of this can be used to gain information about the verifier — for example whether he has opened a certain email or office document. As more than one URI can be embedded in the certificate, it would also theoretically be possible to gain information on internal networks using timing information. For this, one would create a certificate with one URI controlled by the attacker, one URI internal to the attacked, one URI controlled by the attacker and measure the timing distance between the two accesses to the attacker-controlled URIs. In practical experience, this is still theoretical, though.

### Vulnerable applications

We have looked at a number of different applications that use certificates and how they deal with the authority information access extension. Currently, three vulnerable applications have been identified, Microsoft Outlook, Windows Live Mail and Microsoft Office 2007. Below you will find an abstract of the vulnerabilities, links to the corresponding advisories as well as proof of concepts.

#### Microsoft Outlook & Windows Live Mail

Microsoft Outlook and Windows Live Mail (the successor of Outlook Express) both support the [S/MIME](http://en.wikipedia.org/wiki/S/MIME) standard for signed and encrypted emails. When opening an S/MIME-signed email (even using just the preview pane), the applications will try to fetch the URIs specified in the certificate using the Microsoft CryptoAPI. This vulnerability could for example be used by spammers to verify email addresses and that their email has not been filtered by a spam filter on the mail server. Note that this is computationally cheap for the spammer, as the S/MIME signature does not even have to be valid. Combined with IP geolocation, the spammer could also learn where the user fetches his mail from, which could be used in targeted advertising or phishing attacks.

To verify whether you are vulnerable to this attack, send a blank email to **smime-http@klink.name**. You will be sent an S/MIME-signed email with a link to verify whether HTTP requests have been received.

Detailed information about the vulnerability is contained in the advisories: [Microsoft Outlook](https://www.cynops.de/advisories/AKLINK-SA-2008-002.txt), [Windows Live Mail](https://www.cynops.de/advisories/AKLINK-SA-2008-003.txt)

#### Microsoft Office 2007

The Microsoft Office 2007 suite offers the possiblity to sign documents using X.509 certificates. Similarly to the email case, when opening a document, the application tries to verify the certificate chain. Contrary to the S/MIME case, the signature has to be correct for this to work. This vulnerability could for example be used by someone who wants to track when and by whom his document has been opened.

To verify whether you are vulnerable to this attack, you can download the [PoC Word 2007 document](http://www.klink.name/security/HTTP_over_Office_2007_PoC.docx). The document includes a link to a page that lists the last 10 HTTP requests received by the server — you are vulnerable if your IP is on this list shortly after opening the document.

Detailed information about the vulnerability can be found in the [advisory](https://www.cynops.de/advisories/AKLINK-SA-2008-004.txt).

### Applications which are not vulnerable

Several other applications have been tested and have proven not to be vulnerable. This is mostly because they (or rather their respective crypto libraries) do not implement the caIssuers extension.

The following S/MIME applications are not vulnerable to this attack:

* Lotus Notes 8* Mozilla Thunderbird (or anything based on the NSS library)* Apple's Mail.app* OpenSSL-based mail clients

Theoretically, IPSec gateways could be vulnerable as well, but both the IPSec implementation in Microsoft Server 2003 and on a Cisco ASA 5540 running IOS 7.2.3 have proven to be not vulnerable. Smartcard-based Windows logon has also proven not to be vulnerable to this attack.

### Potentially vulnerable applications

Potentially, anything that parses certificates and implements the authority information access caIssuers extension could be vulnerable to this attack. The following instances should provide for some interesting research:

* S/MIME gateways* EAP/TLS* Applications which use TLS client authentication

If you want to test whether your S/MIME infrastructure is vulnerable to this issue, you can send a blank email to smime-http@klink.name. You will be sent an S/MIME-signed email with a link to verify whether HTTP requests have been received.

### Mitigation

As of April 2008, no fixes for the vulnerabilities found in the Microsoft products are available. Currently, blocking the corresponding network traffic somewhere is the only option you have. The easiest fix would be to set an incorrect proxy in the internet options, but this of course breaks Internet Explorer, etc. as well. Alternatively, one could filter outgoing user agents of "Microsoft-CryptoAPI/\*" on a proxy or application level gateway.

### Similar attack vectors

RFC 3280 specifies some more extensions which contain URIs:

* CPS Pointer (section 4.2.1.5)* CRL Distribution Points (section 4.2.1.14)* Authority Information Access OCSP (section 4.2.2.1)

CPS Pointers are of an informational nature and not needed for the automatic validation of a certificate, so typical software does not access it automatically.

CRL Distribution Points and OCSP URIs are only accessed once the rest of the certificate validation succeeds, i.e. the root CA certificate has to be trusted already. This largely decreases the people who can attack you, but still leaves a hole — if you trust a business partner's CA to issue certificates correctly, do you also trust him to do arbitrary HTTP requests within your network?

### Credits

The vulnerability was found by Alexander Klink of [Cynops GmbH](http://www.cynops.de). Thanks to the following people who helped with verifying or disproving certain scenarios:

* Jaromir Likavec and Alexander Opel at [Fraunhofer Institute for Computer Graphics Research IGD](http://www.igd.fraunhofer.de), for going out of their way in providing me with a Cisco and Microsoft test environment. Alexander Nouak for asking around about who was willing to help* Philipp Südmeyer helped in trying out the first attacks using Outlook

### Updates

This section lists updates to the information above which was known to us only after the initial publication of this whitepaper.

* 03.04.2008: Simon Josefsson, the maintainer of the GnuTLS project informs us that GnuTLS is not vulnerable to this problem either (as they do not implement the caIssuers extension).

[Valid
XHTML 1.0](http://validator.w3.org/check?uri=referer) | Copyright © Cynops GmbH



=== Content from www.cynops.de_f37e83ab_20250125_182134.html ===
============================================
||| Security Advisory AKLINK-SA-2008-002 |||
============================================
HTTP over X.509 (S/MIME) - Microsoft Outlook
============================================
Date released: 01.04.2008
Date reported: 11.01.2008
$Revision: 1.1 $
by Alexander Klink
Cynops GmbH
a.klink@cynops.de
https://www.cynops.de/advisories/AKLINK-SA-2008-002.txt
(S/MIME signed: https://www.cynops.de/advisories/AKLINK-SA-2008-002-signed.txt)
https://www.klink.name/security/aklink-sa-2008-002-outlook-smime.txt
Vendor: Microsoft
Product: Outlook
Type of vulnerability: design problem
Class: remote
Status: unpatched
Severity: moderate
Releases known to be affected: Outlook 2007 (12.0.4518.1014)
Releases known NOT to be affected: none
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Background:
S/MIME (Secure / Multipurpose Internet Mail Extensions) is a standard
for public key encryption and signing of e-mail based on X.509 certificates.
X.509 certificates allow a number of extension which specify URIs for
additional information regarding the certificate - for example a location
where to download the issuer certificate(s). For details see RFC 3851/3850.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Overview:
When receiving an S/MIME-signed email, Outlook attempts to
use the additional URIs contained in the certificate to download
information relevant for the verification of the certificate. It
will automatically send out HTTP requests to any location that
is reachable from the client - which might include networks previously
unreachable to an attacker.
Results are unnoticed access to both external or internal webservers,
which in turn could be attacked using other vectors and - in the simplest
case - a "reading confirmation", which is often undesired by the
recipient as well (for example if the sender is a spammer).
For an overview of this class of attacks, see the »HTTP over X.509«
whitepaper at https://www.cynops.de/techzone/http\_over\_x509.html.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Technical details:
For an introduction to the technical details, please see the whitepaper.
In this particular case, Microsoft Crypto API handles the
authorityInfoAccess caIssuers extension. The HTTP requests are sent
out as soon as the e-mail is opened in the preview pane.
The Microsoft Crypto API accepts up to five CA Issuer URIs in the
given certificate which may be up to 8 kibibit each (so there is
enough space for a potential attack payload). Contrary to the RFC,
it only accepts HTTP URIs. The Crypto API connects to arbitrary
TCP ports (both privileged and unprivileged) specified in the HTTP
URI.
In one test, the attempt to connect to a running machine
(more or less regardless whether the particular requested port is
open or not) took about 3 seconds and attempting to connect to
an unreachable machine took about 10-16 seconds. If this could
be confirmed to be always the case (some preliminary tests indicated
otherwise), this would allow one to scan for internal hosts via mail
(at the great speed of two hosts per opened mail - it is not as fast as
PortBunny, granted).
In yet undetermined intervals, it also seems to occasionally try
to get the CA issuer certificates again, leading to more HTTP requests.
Also to be noted is that the certificate validation takes place even if the
S/MIME signature itself is invalid - this means than a clever spammer
would not even have to burn CPU cycles on creating correct signatures.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Proof of Concept:
To receive such an S/MIME-signed email that triggers a HTTP request
and to verify that this request reaches an outside server, send a
blank email to smime-http@klink.name.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Communication:
11.01.2008, 17:20 UTC:
Contacted secure@microsoft.com with information, advisory
draft (in an S/MIME-encrypted mail) and an example mail.
11.01.2008, 18:30 and 18:49 UTC:
The example mail triggers HTTP requests from 131.107.0.[104|75]
with a user agent of "Microsoft-CryptoAPI/5.131.3790.3959".
11.01.2008, 21:54 UTC:
Nate from Microsoft replies with case number (7897) and case manager
(Geoff). The original mail is fullquoted in this unencrypted reply -
why did I bother to install their certificate again?
14.01.2008, 17:33 UTC:
The example mail triggers more HTTP requests from 131.107.0.103,
this time with a user agent of "Microsoft-CryptoAPI/5.131.2600.2180".
31.01.2008/01.02.2008:
The example mail regularly triggers HTTP requests from 207.46.55.29,
with user agents of
"Microsoft-CryptoAPI/5.131.2600.2180"
"Microsoft-CryptoAPI/5.131.2600.3285",
"Microsoft-CryptoAPI/5.131.2600.3297",
"Microsoft-CryptoAPI/5.131.3790.1830",
"Microsoft-CryptoAPI/5.131.3790.3959" and
"Microsoft-CryptoAPI/6.0",
01.02.2008, 00:14 UTC:
Geoff replies to let me know they are working on it (yes, I can see
that :-). Dave and a few additional teams are assisting with the
investigation of the issue, no requests for additional information,
they will stay in contact within the next few weeks to provide me
with an update. The original report is again sent along unencrypted
and fullquoted.
February/March 2008:
The occasional Microsoft HTTP request appears in the webserver logfiles
18.03.2008:
Requested update on the issue, informed them that Office 2007 is
vulnerable to the same problem as well (as are signed executables,
but the signature is not checked automatically) and IPSec does not
seem to be vulnerable.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Solution:
None so far.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Workarounds:
- limit Outlook's ability to do HTTP requests, for example by setting an
invalid proxy in the internet options. If possible, filter outgoing
HTTP requests with a user-agent matching "Microsoft-CryptoAPI/\*"
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Why this advisory has no CVE ID:
Normally, I make sure every advisory I release has a CVE ID to ensure that
the issue can be identified without doubt. In the past, I have been
assigned CVE IDs directly and promptly by Steve Christey of MITRE.
The communication in this case went like this:
17.01.2008: contacted Steve Christey with the question on how to handle
CVEs for a generic issue in an RFC that is vulnerable in
a specific implementation.
01.02.2008: contact Steve again to ask for an update
01.02.2008: Steve replies saying that he must have missed the first
email and says:
| This can be a tough one for CVE, but if it's a fundamental design problem
| in a single RFC, and \*any\* conformant implementation will have the issue,
| then it gets a single CVE.
02.02.2008: Updated Steve with details on the vulnerability
07.02.2008: Contacted Steve again for an update
26.02.2008: Contacted Steve again with the explicit wish for CVE IDs
for the issues in Outlook, Windows Live Mail and Office 2007
28.02.2008: Contacted Steve again asking for the assignment of the CVE IDs
28.02.2008: Contacted cve@mitre.org as well in case Steve is no longer the
correct contact
From what I read on the CVE website, it looks like Microsoft assigns
the CVE IDs for their own issues themselves, but they don't talk to me
very much either. I like the CVE idea and would like to use CVE IDs
whenever possible, but someone would have to answer my mails for that.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Credits:
- Alexander Klink, Cynops GmbH (discovery)
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Thanks to:
- Philipp Südmeyer for the help in trying out the first attacks


=== Content from securityreason.com_17e4dc84_20250125_182134.html ===


---

# Security check:

Captcha. You know what to do. (CXSECURITYIDS)

---



=== Content from www.cynops.de_b5de6587_20250125_182134.html ===
============================================
||| Security Advisory AKLINK-SA-2008-003 |||
============================================
HTTP over X.509 (S/MIME) - Windows Live Mail
============================================
Date released: 01.04.2008
Date reported: 11.01.2008
$Revision: 1.1 $
by Alexander Klink
Cynops GmbH
a.klink@cynops.de
https://www.cynops.de/advisories/AKLINK-SA-2008-003.txt
(S/MIME signed: https://www.cynops.de/advisories/AKLINK-SA-2008-003-signed.txt)
https://www.klink.name/security/aklink-sa-2008-003-live-mail-smime.txt
Vendor: Microsoft
Product: Windows Live Mail
Type of vulnerability: design problem
Class: remote
Status: unpatched
Severity: moderate
Releases known to be affected: 2008 (Build 12.0.1606)
Releases known NOT to be affected: none
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Background:
S/MIME (Secure / Multipurpose Internet Mail Extensions) is a standard
for public key encryption and signing of e-mail based on X.509 certificates.
X.509 certificates allow a number of extension which specify URIs for
additional information regarding the certificate - for example a location
where to download the issuer certificate(s). For details see RFC 3851/3850.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Overview:
When receiving an S/MIME-signed email, Windows Live Mail attempts to
use the additional URIs contained in the certificate to download
information relevant for the verification of the certificate. It
will automatically send out HTTP requests to any location that
is reachable from the client - which might include networks previously
unreachable to an attacker.
Results are unnoticed access to both external or internal webservers,
which in turn could be attacked using other vectors and - in the simplest
case - a "reading confirmation", which is often undesired by the
recipient as well (for example if the sender is a spammer).
For an overview of this class of attacks, see the »HTTP over X.509«
whitepaper at https://www.cynops.de/techzone/http\_over\_x509.html.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Technical details:
For an introduction to the technical details, please see the whitepaper.
In this particular case, Microsoft Crypto API handles the
authorityInfoAccess caIssuers extension. The HTTP requests are sent
out as soon as the e-mail is opened in the preview pane.
The Microsoft Crypto API accepts up to five CA Issuer URIs in the
given certificate which may be up to 8 kibibit each (so there is
enough space for a potential attack payload). Contrary to the RFC,
it only accepts HTTP URIs. The Crypto API connects to arbitrary
TCP ports (both privileged and unprivileged) specified in the HTTP
URI.
In one test, the attempt to connect to a running machine
(more or less regardless whether the particular requested port is
open or not) took about 3 seconds and attempting to connect to
an unreachable machine took about 10-16 seconds. If this could
be confirmed to be always the case (some preliminary tests indicated
otherwise), this would allow one to scan for internal hosts via mail
(at the great speed of two hosts per opened mail - it is not as fast as
PortBunny, granted).
In yet undetermined intervals, it also seems to occasionally try
to get the CA issuer certificates again, leading to more HTTP requests.
Also to be noted is that the certificate validation takes place even if the
S/MIME signature itself is invalid - this means than a clever spammer
would not even have to burn CPU cycles on creating correct signatures.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Proof of Concept:
To receive such an S/MIME-signed email that triggers a HTTP request
and to verify that this request reaches an outside server, send a
blank email to smime-http@klink.name.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Communication:
11.01.2008, 17:20 UTC:
Contacted secure@microsoft.com with information, advisory
draft (in an S/MIME-encrypted mail) and an example mail.
11.01.2008, 18:30 and 18:49 UTC:
The example mail triggers HTTP requests from 131.107.0.[104|75]
with a user agent of "Microsoft-CryptoAPI/5.131.3790.3959".
11.01.2008, 21:54 UTC:
Nate from Microsoft replies with case number (7897) and case manager
(Geoff). The original mail is fullquoted in this unencrypted reply -
why did I bother to install their certificate again?
14.01.2008, 17:33 UTC:
The example mail triggers more HTTP requests from 131.107.0.103,
this time with a user agent of "Microsoft-CryptoAPI/5.131.2600.2180".
31.01.2008/01.02.2008:
The example mail regularly triggers HTTP requests from 207.46.55.29,
with user agents of
"Microsoft-CryptoAPI/5.131.2600.2180"
"Microsoft-CryptoAPI/5.131.2600.3285",
"Microsoft-CryptoAPI/5.131.2600.3297",
"Microsoft-CryptoAPI/5.131.3790.1830",
"Microsoft-CryptoAPI/5.131.3790.3959" and
"Microsoft-CryptoAPI/6.0",
01.02.2008, 00:14 UTC:
Geoff replies to let me know they are working on it (yes, I can see
that :-). Dave and a few additional teams are assisting with the
investigation of the issue, no requests for additional information,
they will stay in contact within the next few weeks to provide me
with an update. The original report is again sent along unencrypted
and fullquoted.
February/March 2008:
The occasional Microsoft HTTP request appears in the webserver logfiles
18.03.2008:
Requested update on the issue, informed them that Office 2007 is
vulnerable to the same problem as well (as are signed executables,
but the signature is not checked automatically) and IPSec does not
seem to be vulnerable.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Solution:
None so far.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Workarounds:
- limit Live Mail's ability to do HTTP requests, for example by setting an
invalid proxy in the internet options. If possible, filter outgoing
HTTP requests with a user-agent matching "Microsoft-CryptoAPI/\*"
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Why this advisory has no CVE ID:
Normally, I make sure every advisory I release has a CVE ID to ensure that
the issue can be identified without doubt. In the past, I have been
assigned CVE IDs directly and promptly by Steve Christey of MITRE.
The communication in this case went like this:
17.01.2008: contacted Steve Christey with the question on how to handle
CVEs for a generic issue in an RFC that is vulnerable in
a specific implementation.
01.02.2008: contact Steve again to ask for an update
01.02.2008: Steve replies saying that he must have missed the first
email and says:
| This can be a tough one for CVE, but if it's a fundamental design problem
| in a single RFC, and \*any\* conformant implementation will have the issue,
| then it gets a single CVE.
02.02.2008: Updated Steve with details on the vulnerability
07.02.2008: Contacted Steve again for an update
26.02.2008: Contacted Steve again with the explicit wish for CVE IDs
for the issues in Outlook, Windows Live Mail and Office 2007
28.02.2008: Contacted Steve again asking for the assignment of the CVE IDs
28.02.2008: Contacted cve@mitre.org as well in case Steve is no longer the
correct contact
From what I read on the CVE website, it looks like Microsoft assigns
the CVE IDs for their own issues themselves, but they don't talk to me
very much either. I like the CVE idea and would like to use CVE IDs
whenever possible, but someone would have to answer my mails for that.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Credits:
- Alexander Klink, Cynops GmbH (discovery)
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Thanks to:
- Philipp Südmeyer for the help in trying out the first attacks using Outlook


=== Content from www.cynops.de_802562d3_20250125_182134.html ===
============================================
||| Security Advisory AKLINK-SA-2008-004 |||
============================================
HTTP over X.509 - Microsoft Office 2007
=======================================
Date released: 01.04.2008
Date reported: 18.03.2008 (a similar issue was reported on 11.01.2008)
$Revision: 1.1 $
by Alexander Klink
Cynops GmbH
a.klink@cynops.de
https://www.cynops.de/advisories/AKLINK-SA-2008-004.txt
(S/MIME signed: https://www.cynops.de/advisories/AKLINK-SA-2008-004-signed.txt)
https://www.klink.name/security/aklink-sa-2008-004-office2007-signatures.txt
Vendor: Microsoft
Product: Office 2007
Type of vulnerability: design problem
Class: remote
Status: unpatched
Severity: moderate
Releases known to be affected: 12.0.6212.1000 SP1 MSO (12.0.6213.1000)
Releases known NOT to be affected: none
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Background:
Microsoft Office 2007 allows a user to sign documents using X.509
certificates.
X.509 certificates allow a number of extension which specify URIs for
additional information regarding the certificate - for example a location
where to download the issuer certificate(s).
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Overview:
When opening a document with a digital signature, Office 2007 attempts to
use the additional URIs contained in the certificate to download
information relevant for the verification of the certificate. It
will automatically send out HTTP requests to any location that
is reachable from the client - which might include networks previously
unreachable to an attacker.
Results are unnoticed access to both external or internal webservers,
which in turn could be attacked using other vectors and - in the simplest
case - an "opening confirmation", which is often undesired by the
recipient as well (as it can be used to track who opened which document
at what time).
For an overview of this class of attacks, see the »HTTP over X.509«
whitepaper at https://www.cynops.de/techzone/http\_over\_x509.html.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Technical details:
For an introduction to the technical details, please see the whitepaper.
In this particular case, Microsoft Crypto API handles the
authorityInfoAccess caIssuers extension. The HTTP requests are sent
out as soon as the document is opened.
The Microsoft Crypto API accepts up to five CA Issuer URIs in the
given certificate which may be up to 8 kibibit each (so there is
enough space for a potential attack payload). Contrary to the RFC,
it only accepts HTTP URIs. The Crypto API connects to arbitrary
TCP ports (both privileged and unprivileged) specified in the HTTP
URI.
In one test, the attempt to connect to a running machine
(more or less regardless whether the particular requested port is
open or not) took about 3 seconds and attempting to connect to
an unreachable machine took about 10-16 seconds. If this could
be confirmed to be always the case (some preliminary tests indicated
otherwise), this would allow one to scan for internal hosts via mail
(at the great speed of two hosts per opened mail - it is not as fast as
PortBunny, granted).
Contrary to the vulnerabilities in Microsoft Outlook and Windows Live
Mail, the certificate is only verified if the signature is intact.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Proof of Concept:
A signed Word 2007 document that triggers an HTTP request is available at
http://www.klink.name/security/HTTP\_over\_Office\_2007\_PoC.docx
The document contains a link which shows the last 10 HTTP requests
triggered by this document. By verifying whether you are on the
list, you can verify if you are affected by this vulnerability.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Communication:
18.03.2008:
As part of a communication on a similar issue in Outlook and
Windows Live Mail, informed them that Office 2007 is vulnerable
as well. For details on the earlier communication, see
AKLINK-SA-2008-002 or AKLINK-SA-2008-003.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Solution:
None so far.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Workarounds:
- limit Office's ability to do HTTP requests, for example by setting an
invalid proxy in the internet options. If possible, filter outgoing
HTTP requests with a user-agent matching "Microsoft-CryptoAPI/\*"
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Why this advisory has no CVE ID:
Normally, I make sure every advisory I release has a CVE ID to ensure that
the issue can be identified without doubt. In the past, I have been
assigned CVE IDs directly and promptly by Steve Christey of MITRE.
The communication in this case went like this:
17.01.2008: contacted Steve Christey with the question on how to handle
CVEs for a generic issue in an RFC that is vulnerable in
a specific implementation.
01.02.2008: contact Steve again to ask for an update
01.02.2008: Steve replies saying that he must have missed the first
email and says:
| This can be a tough one for CVE, but if it's a fundamental design problem
| in a single RFC, and \*any\* conformant implementation will have the issue,
| then it gets a single CVE.
02.02.2008: Updated Steve with details on the vulnerability
07.02.2008: Contacted Steve again for an update
26.02.2008: Contacted Steve again with the explicit wish for CVE IDs
for the issues in Outlook, Windows Live Mail and Office 2007
28.02.2008: Contacted Steve again asking for the assignment of the CVE IDs
28.02.2008: Contacted cve@mitre.org as well in case Steve is no longer the
correct contact
From what I read on the CVE website, it looks like Microsoft assigns
the CVE IDs for their own issues themselves, but they don't talk to me
very much either. I like the CVE idea and would like to use CVE IDs
whenever possible, but someone would have to answer my mails for that.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Credits:
- Alexander Klink, Cynops GmbH (discovery)

