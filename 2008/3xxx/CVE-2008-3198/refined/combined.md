=== Content from www.mozilla.org_4eed9bb1_20250125_073020.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2008-35

## Command-line URLs launch multiple tabs when Firefox not running

Announced
July 15, 2008
Reporter
Billy Rios, Ben Turner, Dan Veditz
Impact
Critical
Products
Firefox
Fixed in

* Firefox 2.0.0.16
* Firefox 3.0.1

### Description

Security researcher **Billy Rios** reported that if Firefox
is not already running, passing it a command-line URI with pipe ("|") symbols
will open multiple tabs. This URI splitting could be used to launch `chrome:` URIs from the command-line, a partial bypass of the fix for
[MFSA 2005-53](../2005/mfsa2005-53.html) which was intended to
block external applications from loading such URIs (that vulnerability
remains fixed, however).

This vulnerability could also be used by an attacker to pass URIs to
Firefox that would normally be handled by a vector application by appending it
to a URI not handled by the vector application. For example, web browsers
normally handle `file:` URIs themselves, or block them from web
content altogether, but this flaw enabled attackers to pass them from another
browser into Firefox. In Firefox 2 scripts running from file: URIs can read
data from a user's entire disk, a risk if the attacker could first place a
malicious file in a guessable location on the local disk. Rios demonstrated that
the so-called "Safari Carpet-bombing vulnerability" could be used for this,
as well as another technique that does not rely on that now-fixed Safari
vulnerability.

In Firefox 3 scripts running in local files have limited access to
other files, almost entirely mitigating the `file:` attack.
However, combined with a vulnerability which allows an attacker to inject
script into a chrome document the above issue could be used to run
arbitrary code on a victim's computer. Such a chrome injection vulnerability
was discovered in Firefox 3 by Mozilla developers **Ben Turner**
and **Dan Veditz**. In the absence of the attack described
by Billy Rios this injection attack would not run with any special privilege
and would be at best a spoofing vulnerability.

### Workaround

This attack only works if the user is using another internet-connected
application with Firefox not running. Using Firefox, or making sure
it is at least running, prevents this attack.

### References

*Bug details embargoed until after the upgrade period*

* [Firefox multiple tabs bug](https://bugzilla.mozilla.org/show_bug.cgi?id=441120)
* [Injection into XUL error page bug](https://bugzilla.mozilla.org/show_bug.cgi?id=441169)
* [CVE-2008-2933](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-2933)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_94bfa2c6_20250125_073021.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/441169)
* [XML](/show_bug.cgi?ctype=xml&id=441169)

Closed
[Bug 441169](/show_bug.cgi?id=441169)

Opened 17 years ago
Closed 17 years ago

# HTML injection into XUL error pages through badcert parameters

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

HTML injection into XUL error pages through badcert parameters

## Categories

### (Core Graveyard :: Security: UI, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Security%3A%20UI#Security%3A%20UI)

Security: UI
▾

Core Graveyard :: Security: UI
PSM client library
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Security%3A%20UI&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Security%3A%20UI&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Security%3A%20UI)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (Not tracked)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

## People

### (Reporter: dveditz, Assigned: johnath)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/57c4d202970ce02ce9ade7755a4cbc13?d=mm&size=40)  [johnath](/user_profile?user_id=210757)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.9.1, verified1.9.0.1, Whiteboard: [sg:critical] critical combined with a chrome-loading bug like 441120)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---),
[verified1.9.0.1](/buglist.cgi?keywords=verified1.9.0.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical] critical combined with a chrome-loading bug like 441120

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [beltzner](/user_profile?user_id=137548) | [blocking1.9.1](#a193378_137548 "17 years ago") | + |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.1 | + |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | [blocking1.9.0.1](#a193378_137548 "17 years ago") | + |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.0.1 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.8.1.x](#c0 "17 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.8.1.x | - |
| --- | --- | --- |
| [asac](/user_profile?user_id=113760) | [blocking1.8.0.next](#c0 "17 years ago") | - |
| --- | --- | --- |
| [asac](/user_profile?user_id=113760) | blocking1.8.0.next | - |
| --- | --- | --- |
| [reed](/user_profile?user_id=159758) | [in-testsuite](#a733694_159758 "17 years ago") | + |
| --- | --- | --- |
| [reed](/user_profile?user_id=159758) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 2 obsolete files)

| [build elements manually to prevent overpermissive innerHTML treatment](/attachment.cgi?id=326564)  [17 years ago](#c4)  [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)   2.60 KB, patch | bzbarsky : [review+](#c6 "17 years ago") | [Details](/attachment.cgi?id=326564&action=edit) | [Diff](/attachment.cgi?id=326564&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=326564) |
| --- | --- | --- |
| [With bz's nits and a test](/attachment.cgi?id=327406)  [17 years ago](#c7)  [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)   4.99 KB, patch | johnath : [review+](#c7 "17 years ago")  dveditz : [superreview+](#c8 "17 years ago") | [Details](/attachment.cgi?id=327406&action=edit) | [Diff](/attachment.cgi?id=327406&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=327406) |
| [With dveditz' nits](/attachment.cgi?id=327498)  [17 years ago](#c9)  [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)   3.46 KB, patch | johnath : [review+](#c9 "17 years ago")  johnath : [superreview+](#c9 "17 years ago")  beltzner : [approval1.9.0.1+](#c10 "17 years ago") | [Details](/attachment.cgi?id=327498&action=edit) | [Diff](/attachment.cgi?id=327498&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=327498) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=441169#c0)• 17 years ago |
|  | |

Ben Turner found that the changes to XUL error pages to handle SSL errors works by passing display text as a parameter and that this text is not sanitized against HTML injection. In fact, the intended behavior of those dialogs \_relies\_ on it. This is now trivial to inject arbitrary code into.
chrome://global/content/netError.xhtml?e=nssBadCert&u=https%3A//test.kuix.de/&c=UTF-8&d=%3Cspan%20onmouseover%3d%22try{alert(Components.stack)}catch(e){alert(e)}%22%3Etest.kuix.de%20uses%20an%20%3Cb%3Einvalid%3C/b%3E%20security%20certificate.%0A%0AThe%20certificate%20is%20only%20valid%20for%20%3Cscript%3Ealert(123)%3C/script%3E%3Ca%20id%3D%22cert\_domain\_link%22%20title%3D%22kuix.de%22%20href%3D%22http://www.mozilla.com%22%3Ekuix.de%3C/a%3E%0A%0A(Error%20code%3A%20ssl\_error\_bad\_cert\_domain)%0A%3C/span%3E
about:neterror?e=nssBadCert&u=https%3A//test.kuix.de/&c=UTF-8&d=<span%20onmouseover%3d"try{alert(Components.stack)}catch(e){alert(e)}">test.kuix.de%20uses%20an%20<b>invalid</b>%20security%20certificate.%0A%0AThe%20certificate%20is%20only%20valid%20for%20<script>alert(123)</script><a%20id%3D"cert\_domain\_link"%20title%3D"kuix.de"%20href%3D"<http://www.mozilla.com>">kuix.de</a>%0A%0A(Error%20code%3A%20ssl\_error\_bad\_cert\_domain)%0A</span>
when called via about:neterror any injected script only has normal privileges, it's primarily a spoofing vector.
When called as a chrome: uri this allows arbitrary code execution. Normally remote content can't load user code can't load chrome: URIs directly, but a potential danger when combined with other flaws.
There is currently such a flaw: this can be combined with [bug 441120](/show_bug.cgi?id=441120 "RESOLVED FIXED - command-line URLs launch multi-tabs if Firefox not running, exploitable with Safari Carpet bombing") to create an arbitrary code execution exploit.Flags: wanted1.8.1.x-Flags: blocking1.9.1?Flags: blocking1.9.0.1?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=441169#c1)• 17 years ago |
|  | |

Is there a way to get scripts to run on-load? So far I've only gotten event-based exploits to work like adding a link and luring users to click, or the onmouseover used in [comment 0](/show_bug.cgi?id=441169#c0 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a152_1689)• 17 years ago |

Assignee: kaie → johnath

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a198_1689)• 17 years ago |

Whiteboard: [sg:moderate] sg:critical combined with a chrome-loading bug

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a249_1689)• 17 years ago |

Whiteboard: [sg:moderate] sg:critical combined with a chrome-loading bug → [sg:critical] critical combined with a chrome-loading bug like 441120

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=441169#c2)• 17 years ago |
|  | |

Grr. I was quite deliberate about double checking that neterror didn't have privilege before landing this, but obviously if other bugs give it privilege, all bets are off. Okay, so how do we fix this? I see a few options:
1) Back out 402210. This means a string change (and a loss of functionality, but the string change is the kicker)
2) Trivially, use .textContent instead of .innerHTML - which would neuter the attack, but also make the error pages look stupid, since they'd have plain-text tags.
3) Sanitize the string in netError's javascript. It's intended to contain a single, specifically identified <a> tag, but everything else can be sanitized out. Is there a general purpose sanitizer we can use, or do we write something specific here? If the latter, a two-step sanitize that basically did:
- s/</&lt;/, s/>/&gt;/
- and then went back and repaired the specific <a id="cert\_domain\_link" title="localhost.localdomain"> tags should work?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=441169#c3)• 17 years ago |
|  | |

(In reply to [comment #2](/show_bug.cgi?id=441169#c2 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"))
> 1) Back out 402210. This means a string change (and a loss of functionality,
> but the string change is the kicker)
Please note [bug 439062](/show_bug.cgi?id=439062 "RESOLVED FIXED - Wording in SSL error dialogs contain inappropriate HTML tags") where I have proposed a patch to strip away the html tags.
Right now the patch only strips the tags when reporting in an error dialog. If you want to revert the change from [bug 402210](/show_bug.cgi?id=402210 "RESOLVED FIXED - Should SSL Error page for domain mismatch hyperlink to correct site?"), but avoid the string change, we could extend the patch to always strip the tag.

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=441169#c4)• 17 years ago |
|  | |

Attached patch

[build elements manually to prevent overpermissive innerHTML treatment](attachment.cgi?id=326564&action=diff) (obsolete)
— [Details](attachment.cgi?id=326564&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=326564)

This patch changes the code to build two text nodes and an anchor element explicitly, instead of just handing off to innerHTML. I've confirmed that it continues to link for the typical cases, but barfs all the attempted attack source in [comment 0](/show_bug.cgi?id=441169#c0 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters") as plaintext. Not pretty but also not, I think, exploitable.
I'd like to attach tests, but I'm flying in a few hours and it was either get the process started now, or wait a day or two while travelling before I can get those tests written. I think the obvious test here is just to use browser-chrome to visit a chrome url like the one in [comment 0](/show_bug.cgi?id=441169#c0 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"), and the DOM-walk to ensure none of the elements in the string become real DOM elements.
[Attachment #326564](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") -
Flags: superreview?(dveditz)
[Attachment #326564](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") -
Flags: review?(cbiesinger)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a193378_137548)• 17 years ago |

Flags: blocking1.9.1?Flags: blocking1.9.1+Flags: blocking1.9.0.1?Flags: blocking1.9.0.1+

|  | [Mike Schroepfer](/user_profile?user_id=210162) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a371216_210162)• 17 years ago |

[Attachment #326564](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") -
Flags: review?(cbiesinger) → review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=441169#c5)• 17 years ago |
|  | |

Is the string we're parsing always XHTML-wellformed? Would it make sense to parse it outside the document then verify that it only has the bits we want (the nodes and the attributes)? I guess that's even more complex than the proposed patch code...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=441169#c6)• 17 years ago |
|  | |

Comment on [attachment 326564](/attachment.cgi?id=326564 "build elements manually to prevent overpermissive innerHTML treatment") [[details]](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") [[diff]](/attachment.cgi?id=326564&action=diff "build elements manually to prevent overpermissive innerHTML treatment") [[review]](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=326564)
build elements manually to prevent overpermissive innerHTML treatment
>Index: docshell/resources/content/netError.xhtml
>+ // Remove sd's children
>+ while(sd.firstChild)
>+ sd.removeChild(sd.firstChild);
sd.textContent = "";
is faster. Not that it matters much here, all things considered.
>+ anchorEl.appendChild(document.createTextNode(result[1]));
So the title and text are always the same thing?
sd.appendChild(document.createTextNode(desc.slice(desc.indexOf("</a>") + 4)));
Please replace |4| with |"</a>".length| to make it clear what's going on.
r=bzbarsky with the nits picked.
[Attachment #326564](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") -
Flags: review?(bzbarsky) → review+

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=441169#c7)• 17 years ago |
|  | |

Attached patch

[With bz's nits and a test](attachment.cgi?id=327406&action=diff) (obsolete)
— [Details](attachment.cgi?id=327406&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=327406)

(In reply to [comment #6](/show_bug.cgi?id=441169#c6 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"))
> >+ // Remove sd's children
> >+ while(sd.firstChild)
> >+ sd.removeChild(sd.firstChild);
>
> sd.textContent = "";
>
> is faster. Not that it matters much here, all things considered.
No, but might as well. Done.
> >+ anchorEl.appendChild(document.createTextNode(result[1]));
>
> So the title and text are always the same thing?
They are, by design. See:
<http://mxr.mozilla.org/mozilla/source/security/manager/locales/en-US/chrome/pipnss/pipnss.properties#353>
> sd.appendChild(document.createTextNode(desc.slice(desc.indexOf("</a>") + 4)));
>
> Please replace |4| with |"</a>".length| to make it clear what's going on.
Done.
> r=bzbarsky with the nits picked.
Carried forward on to the new patch.
I've included a browser-chrome test that just loads a chrome url like the one in [comment 0](/show_bug.cgi?id=441169#c0 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"), and then checks to ensure that its markup isn't parsed into the DOM. I confirm that with my netError patch, the test passes, and without it, it fails.
[Attachment #326564](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") -
Attachment is obsolete: true
[Attachment #327406](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") -
Flags: superreview?(dveditz)
[Attachment #327406](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") -
Flags: review+
[Attachment #327406](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") -
Flags: approval1.9.0.1?
[Attachment #326564](/attachment.cgi?id=326564&action=edit "build elements manually to prevent overpermissive innerHTML treatment") -
Flags: superreview?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=441169#c8)• 17 years ago |
|  | |

Comment on [attachment 327406](/attachment.cgi?id=327406 "With bz's nits and a test") [[details]](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") [[diff]](/attachment.cgi?id=327406&action=diff "With bz's nits and a test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=327406)
With bz's nits and a test
>+ // Treating description as innerHTML makes it possible to inject
>+ // tags/scripting. This page is unprivileged, but combined with
>+ // a chrome-loading bug, this could be injection with privilege.
>+ // Instead we'll have to build up the elements manually. [Bug 441169](/show_bug.cgi?id=441169 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters")
This comment is a bit of a red flag, could you vagueify a bit and leave the bug reference for more detail? In fact, do you need the comment at all -- doesn't cvs blame cover it well enough? "innerHTML" should be minimized and protected everywhere it's used in our code.
If you need the comment it might be sufficient to say
// sanitize tags to prevent HTML injection; see [bug 441169](/show_bug.cgi?id=441169 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters")
calling attention to the chrome escalation variant seems unnecessary.
>+ // Finally, append text for anything after the closing </a>
>+ sd.appendChild(document.createTextNode(desc.slice(desc.indexOf("</a>") + "</a>".length)));
I can't think of a way to abuse this, but if someone had a "<a></a>" early in the text before the matching link there'd be some amount of duplicated text (but safe plain text). Could use desc.indexOf("</a>", result.index) if that's something we cared about.
I don't care if trying to hack the page results in extra ugliness, your call.
>Index: docshell/test/browser/browser\_bug441169.js
>===================================================================
>+var chromeURL = "chrome://global/content/netError.xhtml?e=nssBadCert&u=https%3A//test.kuix.de/&c=UTF-8&d=This%20sentence%20should%20not%20be%20parsed%20to%20include%20a%20%3Cspan%20id=%22test\_span%22%3Enamed%3C/span%3E%20span%20tag.%0A%0AThe%20certificate%20is%20only%20valid%20for%20%3Ca%20id=%22cert\_domain\_link%22%20title=%22kuix.de%22%3Ekuix.de%3C/a%3E%0A%0A(Error%20code%3A%20ssl\_error\_bad\_cert\_domain)";
Could you use the about:neterror form for the test? chrome: is not required to show that the fix does what it's supposed to.
sr=dveditz with the comment and test nits.
[Attachment #327406](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") -
Flags: superreview?(dveditz) → superreview+

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=441169#c9)• 17 years ago |
|  | |

Attached patch

[With dveditz' nits](attachment.cgi?id=327498&action=diff)
— [Details](attachment.cgi?id=327498&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=327498)

(In reply to [comment #8](/show_bug.cgi?id=441169#c8 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"))
> If you need the comment it might be sufficient to say
> // sanitize tags to prevent HTML injection; see [bug 441169](/show_bug.cgi?id=441169 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters")
Done (kept the bug reference, dropped the mention of injection)
> calling attention to the chrome escalation variant seems unnecessary.
Agreed, gone.
> >+ // Finally, append text for anything after the closing </a>
> >+ sd.appendChild(document.createTextNode(desc.slice(desc.indexOf("</a>") + "</a>".length)));
>
> I can't think of a way to abuse this, but if someone had a "<a></a>" early in
> the text before the matching link there'd be some amount of duplicated text
> (but safe plain text). Could use desc.indexOf("</a>", result.index) if that's
> something we cared about.
>
> I don't care if trying to hack the page results in extra ugliness, your call.
Yeah, I think the ugliness of attacker pages is a non-issue here, and every time I try to think of another way to exploit this (e.g. by using it to somehow control the message contents) I remember that an attacker can put any text they want in there, or for that matter make a page that looks like our error page, but has totally arbitrary content (and behaviour!) As long as they can't insert script here which risks running \*with privilege\*, I'm happy.
> Could you use the about:neterror form for the test? chrome: is not required to
> show that the fix does what it's supposed to.
>
> sr=dveditz with the comment and test nits.
Done and confirmed that the new test still passes with the patch, fails without it.
Carrying forward r and sr, and tagging for approval. I might not be able to land this in time, and the tree has been misbehaving all day, so I'll flag it checkin-needed once I have approval.
[Attachment #327406](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") -
Attachment is obsolete: true
[Attachment #327498](/attachment.cgi?id=327498&action=edit "With dveditz' nits") -
Flags: superreview+
[Attachment #327498](/attachment.cgi?id=327498&action=edit "With dveditz' nits") -
Flags: review+
[Attachment #327498](/attachment.cgi?id=327498&action=edit "With dveditz' nits") -
Flags: approval1.9.0.1?
[Attachment #327406](/attachment.cgi?id=327406&action=edit "With bz's nits and a test") -
Flags: approval1.9.0.1?

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a709997_210757)• 17 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=441169#c10)• 17 years ago |
|  | |

Comment on [attachment 327498](/attachment.cgi?id=327498 "With dveditz' nits") [[details]](/attachment.cgi?id=327498&action=edit "With dveditz' nits") [[diff]](/attachment.cgi?id=327498&action=diff "With dveditz' nits") [[review]](/page.cgi?id=splinter.html&ignore=&bug=441169&attachment=327498)
With dveditz' nits
a=beltzner
[Attachment #327498](/attachment.cgi?id=327498&action=edit "With dveditz' nits") -
Flags: approval1.9.0.1? → approval1.9.0.1+

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=441169#c11)• 17 years ago |
|  | |

Marking checkin-needed as per.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=441169#c12)• 17 years ago |
|  | |

cc'ing reed so he can check this in.

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=441169#c13)• 17 years ago |
|  | |

Checking in docshell/resources/content/netError.xhtml;
/cvsroot/mozilla/docshell/resources/content/netError.xhtml,v <-- netError.xhtml
new revision: 1.35; previous revision: 1.34
done
Checking in docshell/test/browser/Makefile.in;
/cvsroot/mozilla/docshell/test/browser/Makefile.in,v <-- Makefile.in
new revision: 1.7; previous revision: 1.6
done
RCS file: /cvsroot/mozilla/docshell/test/browser/browser\_bug441169.js,v
done
Checking in docshell/test/browser/browser\_bug441169.js;
/cvsroot/mozilla/docshell/test/browser/browser\_bug441169.js,v <-- browser\_bug441169.js
initial revision: 1.1
doneStatus: NEW → RESOLVEDClosed: 17 years agoKeywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Resolution: --- → FIXEDTarget Milestone: --- → mozilla1.9

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a733694_159758)• 17 years ago |

Flags: in-testsuite+

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a733809_159758)• 17 years ago |

Status: RESOLVED → REOPENEDKeywords: [fixed1.9.0.1](/buglist.cgi?keywords=fixed1.9.0.1&resolution=---)Resolution: FIXED → ---

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a734166_159758)• 17 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Hasham](/user_profile?user_id=311401) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=441169#c14)• 17 years ago |
|  | |

Hmm, any testcases or STR to verify this for the 3.0.1 release?

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=441169#c15)• 17 years ago |
|  | |

(In reply to [comment #14](/show_bug.cgi?id=441169#c14 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"))
> Hmm, any testcases or STR to verify this for the 3.0.1 release?
There's an automated test in the patch. If you want to verify manually, load the URLs in [comment 0](/show_bug.cgi?id=441169#c0 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters"). If the onmouseover works, the bug is not fixed. If, instead, you get all the html rendered out as plaintext and no mouseover, the bug is no longer exploitable.

|  | [Hasham](/user_profile?user_id=311401) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=441169#c16)• 17 years ago |
|  | |

The URL's in [comment 0](/show_bug.cgi?id=441169#c0 "RESOLVED FIXED - HTML injection into XUL error pages through badcert parameters") are too long to fit in the Run field. It cuts them off. Is it possible to shorten it without losing the testcase? Or is there another URL that is a bit shorter?
BTW, thanks Johnathan for the response! Since the automated tests in the patch passed, this bug is probably verified but I just want to be sure with a manual testcase.

|  | [Hasham](/user_profile?user_id=311401) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a1563114_311401)• 17 years ago |

Keywords: [fixed1.9.0.1](/buglist.cgi?keywords=fixed1.9.0.1&resolution=---) → [verified1.9.0.1](/buglist.cgi?keywords=verified1.9.0.1&resolution=---)

|  | [Alexander Sack](/user_profile?user_id=113760) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a1611533_113760)• 17 years ago |

Flags: blocking1.8.0.15-

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=441169#c17)• 17 years ago |
|  | |

Pushed in 15866:ed55fa85231d.Status: REOPENED → RESOLVEDClosed: 17 years ago → 17 years agoKeywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Resolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a7362916_1689)• 16 years ago |

Group: core-security

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a14795319_137548)• 16 years ago |

Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=441169#a260847732_1)• 8 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=441169&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


