```
Message-Id: <200809091443.53823.rbu@gentoo.org>
Date: Tue, 9 Sep 2008 14:43:51 +0200
From: Robert Buchholz <rbu@...too.org>
To: oss-security@...ts.openwall.com
Subject: ssmtp =2.62 unitialized memory disclosure

Hi,

Maurice van der Pot of Gentoo reported a bug in ssmtp 2.62:
The from_format() function in ssmtp.c will call strdup() on an
unitialized memory if the user's gecos is unset and "FromLineOverride"
is disabled in the configuration. This might disclose memory contents
by sending them off in the the "From:" field of an email or cause a
(client) crash.
```
- **Root cause of vulnerability**: The `from_format()` function in `ssmtp.c` calls `strdup()` on uninitialized memory when the user's GECOS field is unset and `FromLineOverride` is disabled.
- **Weaknesses/vulnerabilities present**: Uninitialized memory usage.
- **Impact of exploitation**: Memory disclosure by sending uninitialized memory contents in the "From:" field of an email, or a client crash.
- **Attack vectors**: Sending an email with ssmtp.
- **Required attacker capabilities/position**: An attacker needs to be able to trigger the vulnerable code path, which includes having an unset GECOS field and `FromLineOverride` disabled.
```
Message-ID: <Pine.GSO.4.51.0809091022190.6699@faron.mitre.org>
Date: Tue, 9 Sep 2008 10:29:38 -0400 (EDT)
From: "Steven M. Christey" <coley@...us.mitre.org>
To: oss-security@...ts.openwall.com
Subject: Re: ssmtp =2.62 unitialized memory disclosure
On Tue, 9 Sep 2008, Robert Buchholz wrote:
> Maurice van der Pot of Gentoo reported a bug in ssmtp 2.62:
> The from_format() function in ssmtp.c will call strdup() on an
> unitialized memory if the user's gecos is unset and "FromLineOverride"
> is disabled in the configuration. This might disclose memory contents
> by sending them off in the the "From:" field of an email or cause a
> (client) crash.

Wow, this is definitely an edge case.  Technically the memory disclosure
is a security issue, at least for the couple emails that get sent before
the user gives up in frustration.

So, use CVE-2008-3962 (to be filled in later).
```
- This confirms that CVE-2008-3962 has been assigned for this issue.
```
mail-mta/ssmtp <2.62-r3 unitialized memory disclosure (CVE-2008-3962)
Last modified: 2008-11-26 22:35:07 UTC node [vulture]

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
mail-mta/ssmtp <2.62-r3 unitialized memory disclosure (CVE-2008-3962)
```
- Confirms the vulnerability in `ssmtp` is identified by CVE-2008-3962.
```
 In ssmtp.c the function fd_gets more or less looks like this:  char *fd_gets(char *buf, int size, int fd) {         while((i < size) && (fd_getc(fd, &c) == 1)) {                         buf[i++] = c;         }         buf[i] = (char)NULL;         return(buf); }  Coming out of the loop, i can be size, causing a 0-byte to be written past the end of the buffer.  There are also lots of "char c = (char)NULL;" and "char *p = (char)NULL;" occurrences that may be indicative of careless programming and may warrant a code review.
```
-  There's an additional off-by-one write bug in `fd_gets`, though the description explains that the buffer is one byte larger so it's not an exploitable bug.
```
 In addition to fixing the "(char)NULL" things and the off-by-one, this also addresses a problem in from_format() that caused a call to strdup on a local buffer with uninitialized contents.  This last problem was introduced in 2.62 and was the reason I started looking at the source code in the first place (the From: line wasn't properly formatted).
```
- This confirms that the uninitialized memory issue was present in the `from_format()` function and caused problems with the "From:" line formatting.
```
  As Tomas Hoger pointed out, this has been a re-introduction of [bug 127592](show_bug.cgi?id=127592 "RESOLVED FIXED - mail-mta/ssmtp-2.61-r2 stabilization request") since that patch was dropped in the ebuild when 2.62 was bumped.  2.61 is also affected, but we patched it in 2006.
```
-  The bug was a reintroduction of a previously fixed vulnerability. Both versions 2.61 and 2.62 are affected
```
On Tuesday 09 September 2008, Robert Buchholz wrote:
> Hi,
>
> Maurice van der Pot of Gentoo reported a bug in ssmtp 2.62:
> The from_format() function in ssmtp.c will call strdup() on an
> unitialized memory if the user's gecos is unset and
> "FromLineOverride" is disabled in the configuration. This might
> disclose memory contents by sending them off in the the "From:" field
> of an email or cause a (client) crash.
>
> We're handling this as bug 234391 [ <https://bugs.gentoo.org/234391> ].
> Patch: <https://bugs.gentoo.org/attachment.cgi?id=165005>
>
> ssmtp 2.61 is not affected.

As Tomas Hoger pointed out on IRC, 2.61 is affected as well -- I
accidently checked our patched sources and not the vanilla tarball.
We added a patch to 2.61 in 2006, and accidently dropped it when bumping
to 2.62.
Back then, this was bug 127592 [ <https://bugs.gentoo.org/127592> ].
```
-  Confirms that both ssmtp 2.61 and 2.62 are affected.