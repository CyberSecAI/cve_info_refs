=== Content from bugzilla.mozilla.org_0bcce02f_20250124_143903.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/448564)
* [XML](/show_bug.cgi?ctype=xml&id=448564)

Closed
[Bug 448564](/show_bug.cgi?id=448564)
(CVE-2008-3444)

Opened 16 years ago
Closed 16 years ago

# Radware DoS report [@ nsSubDocumentFrame::Reflow]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Radware DoS report [@ nsSubDocumentFrame::Reflow]

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows NT

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: dveditz, Assigned: mozilla+ben)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a54c256e7b32a16eaf115e4be4dbf70?d=mm&size=40)  [mozilla+ben](/user_profile?user_id=318596)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[launchpad.net/bugs/256624](https://launchpad.net/bugs/256624 "https://launchpad.net/bugs/256624")

## Details

### (Keywords: fixed1.9.0.5, fixed1.9.1, Whiteboard: [sg:dos])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2008-3444

[Keywords:](/describekeywords.cgi)

[fixed1.9.0.5](/buglist.cgi?keywords=fixed1.9.0.5&resolution=---),
[fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:dos]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [sicking](/user_profile?user_id=9186) | [blocking1.9.1](#c7 "16 years ago") | + |
| --- | --- | --- |
| [sicking](/user_profile?user_id=9186) | blocking1.9.1 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.5](#c59 "16 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.5 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [wanted1.9.0.x](#a434531_190622 "16 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | wanted1.9.0.x | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.8.1.x](#a6479631_1689 "16 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.8.1.x | - |
| --- | --- | --- |
| [asac](/user_profile?user_id=113760) | [wanted1.8.0.x](#a12008357_113760 "16 years ago") | - |
| --- | --- | --- |
| [asac](/user_profile?user_id=113760) | wanted1.8.0.x | - |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c56 "16 years ago") | + |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 8 obsolete files)

| [radware testcase](/attachment.cgi?id=331760)  [16 years ago](#c0)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   94 bytes, text/html |  | [Details](/attachment.cgi?id=331760&action=edit) |
| --- | --- | --- |
| [proposed patch with (very tentative) test cases](/attachment.cgi?id=333828)  [16 years ago](#c16)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   16.34 KB, patch |  | [Details](/attachment.cgi?id=333828&action=edit) | [Diff](/attachment.cgi?id=333828&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=333828) |
| [new patch, same lousy test cases](/attachment.cgi?id=335807)  [16 years ago](#c30)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   4.49 KB, patch |  | [Details](/attachment.cgi?id=335807&action=edit) | [Diff](/attachment.cgi?id=335807&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335807) |
| [same patch, spiffy new reftests](/attachment.cgi?id=335828)  [16 years ago](#c31)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   4.99 KB, patch |  | [Details](/attachment.cgi?id=335828&action=edit) | [Diff](/attachment.cgi?id=335828&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335828) |
| [decomposed SinkContext::Node::Add](/attachment.cgi?id=335944)  [16 years ago](#c36)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   9.92 KB, patch |  | [Details](/attachment.cgi?id=335944&action=edit) | [Diff](/attachment.cgi?id=335944&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335944) |
| [FlushTags in HTMLContentSink::EndContext](/attachment.cgi?id=335973)  [16 years ago](#c37)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   12.72 KB, patch |  | [Details](/attachment.cgi?id=335973&action=edit) | [Diff](/attachment.cgi?id=335973&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335973) |
| [stray Makefile changes removed from previous patch](/attachment.cgi?id=335976)  [16 years ago](#c39)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   12.11 KB, patch |  | [Details](/attachment.cgi?id=335976&action=edit) | [Diff](/attachment.cgi?id=335976&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335976) |
| [no more back-propagation of mInsertionPoint](/attachment.cgi?id=335997)  [16 years ago](#c43)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   11.92 KB, patch |  | [Details](/attachment.cgi?id=335997&action=edit) | [Diff](/attachment.cgi?id=335997&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335997) |
| [proposed patch (no longer calling FlushTags)](/attachment.cgi?id=337156)  [16 years ago](#c48)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   20.75 KB, patch |  | [Details](/attachment.cgi?id=337156&action=edit) | [Diff](/attachment.cgi?id=337156&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=337156) |
| [new forms tests, back to calling FlushTags for good measure](/attachment.cgi?id=337795)  [16 years ago](#c50)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   26.33 KB, patch | mrbkap : [review+](#a3726379_69426 "16 years ago")  bzbarsky : [superreview+](#c53 "16 years ago") | [Details](/attachment.cgi?id=337795&action=edit) | [Diff](/attachment.cgi?id=337795&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=337795) |
| [now with newlines](/attachment.cgi?id=340626)  [16 years ago](#c54)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   25.86 KB, patch | mozilla+ben : [review+](#c54 "16 years ago") | [Details](/attachment.cgi?id=340626&action=edit) | [Diff](/attachment.cgi?id=340626&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=340626) |
| [backport to CVS HEAD](/attachment.cgi?id=345176)  [16 years ago](#c64)  [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)   30.46 KB, patch | dveditz : [approval1.9.0.5+](#c67 "16 years ago") | [Details](/attachment.cgi?id=345176&action=edit) | [Diff](/attachment.cgi?id=345176&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=345176) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=448564#c0)• 16 years ago |
|  | |

Attached file
[radware testcase](attachment.cgi?id=331760)
— [Details](attachment.cgi?id=331760&action=edit)

Radware reported a DoS crash on the attached testcase
<s>
<form>a</form>
<iframe></iframe>
<script src=a></script>
<form></form>
<table>
<optgroup>
I have not been able to reproduce the crash on Mac or Windows with a 3.0.1 or thereabouts build (nor could jst in 3.0), but the reported stack is a null dereference:
Unhandled exception at 0x606fe7b1 (xul.dll) in firefox.exe: 0xC0000005: Access violation reading location 0x00000004.
> xul.dll!nsSubDocumentFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 507 + 0xb bytes C++
xul.dll!nsLineLayout::ReflowFrame(nsIFrame \* aFrame=0x0258d8b8, unsigned int & aReflowStatus=0x00000000, nsHTMLReflowMetrics \* aMetrics=0x00000000, int & aPushedFrame=0x00000000) Line 857 C++
xul.dll!nsInlineFrame::ReflowInlineFrame(nsPresContext \* aPresContext=0x00b9dae0, const nsHTMLReflowState & aReflowState={...}, nsInlineFrame::InlineReflowState & irs={...}, nsIFrame \* aFrame=0x00000000, unsigned int & aStatus=0x00000000) Line 611 C++
xul.dll!nsInlineFrame::ReflowFrames(nsPresContext \* aPresContext=0x00b9dae0, const nsHTMLReflowState & aReflowState={...}, nsInlineFrame::InlineReflowState & irs={...}, nsHTMLReflowMetrics & aMetrics={...}, unsigned int & aStatus=0x00000000) Line 479 C++
xul.dll!nsInlineFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aMetrics={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 399 C++
xul.dll!nsLineLayout::ReflowFrame(nsIFrame \* aFrame=0x0258d848, unsigned int & aReflowStatus=0x00000000, nsHTMLReflowMetrics \* aMetrics=0x00000000, int & aPushedFrame=0x00000000) Line 857 C++
xul.dll!nsBlockFrame::ReflowInlineFrame(nsBlockReflowState & aState={...}, nsLineLayout & aLineLayout={...}, nsLineList\_iterator aLine={...}, nsIFrame \* aFrame=0x0258d848, LineReflowStatus \* aLineReflowStatus=0x0012e29c) Line 3608 C++
xul.dll!nsBlockFrame::DoReflowInlineFrames(nsBlockReflowState & aState={...}, nsLineLayout & aLineLayout={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012e4c4, LineReflowStatus \* aLineReflowStatus=0x0012e388, int aAllowPullUp=0x00000001) Line 3430 C++
xul.dll!nsBlockFrame::ReflowInlineFrames(nsBlockReflowState & aState={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012e4c4) Line 3279 C++
xul.dll!nsBlockFrame::ReflowLine(nsBlockReflowState & aState={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012e4c4) Line 2335 + 0x17 bytes C++
xul.dll!nsBlockFrame::ReflowDirtyLines(nsBlockReflowState & aState={...}) Line 1898 C++
xul.dll!nsBlockFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aMetrics={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 938 C++
xul.dll!nsBlockReflowContext::ReflowBlock(const nsRect & aSpace={...}, int aApplyTopMargin=0x00000001, nsCollapsingMargin & aPrevMargin={...}, int aClearance=0x00000000, int aIsAdjacentWithTop=0x00000000, nsMargin & aComputedOffsets={...}, nsLineBox \* aLine=0x0258db50, nsHTMLReflowState & aFrameRS={...}, unsigned int & aFrameReflowStatus=0x00000000, nsBlockReflowState & aState={...}) Line 339 + 0x24 bytes C++
xul.dll!nsBlockFrame::ReflowBlockFrame(nsBlockReflowState & aState={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012eb64) Line 3023 C++
xul.dll!nsBlockFrame::ReflowLine(nsBlockReflowState & aState={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012eb64) Line 2282 + 0xf bytes C++
xul.dll!nsBlockFrame::ReflowDirtyLines(nsBlockReflowState & aState={...}) Line 1898 C++
xul.dll!nsBlockFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aMetrics={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 938 C++
xul.dll!nsBlockReflowContext::ReflowBlock(const nsRect & aSpace={...}, int aApplyTopMargin=0x00000001, nsCollapsingMargin & aPrevMargin={...}, int aClearance=0x00000000, int aIsAdjacentWithTop=0x00000001, nsMargin & aComputedOffsets={...}, nsLineBox \* aLine=0x022a358c, nsHTMLReflowState & aFrameRS={...}, unsigned int & aFrameReflowStatus=0x00000000, nsBlockReflowState & aState={...}) Line 339 + 0x24 bytes C++
xul.dll!nsBlockFrame::ReflowBlockFrame(nsBlockReflowState & aState={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012f204) Line 3023 C++
xul.dll!nsBlockFrame::ReflowLine(nsBlockReflowState & aState={...}, nsLineList\_iterator aLine={...}, int \* aKeepReflowGoing=0x0012f204) Line 2282 + 0xf bytes C++
xul.dll!nsBlockFrame::ReflowDirtyLines(nsBlockReflowState & aState={...}) Line 1898 C++
xul.dll!nsBlockFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aMetrics={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 938 C++
xul.dll!nsContainerFrame::ReflowChild(nsIFrame \* aKidFrame=0x00000000, nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, int aX=0x00000000, int aY=0x00000000, unsigned int aFlags=0x00000000, unsigned int & aStatus=, nsOverflowContinuationTracker \* aTracker=0x00000000) Line 755 + 0x13 bytes C++
xul.dll!CanvasFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 589 C++
xul.dll!nsContainerFrame::ReflowChild(nsIFrame \* aKidFrame=0x00000000, nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, int aX=0x00000000, int aY=0x00000000, unsigned int aFlags=0x00000003, unsigned int & aStatus=, nsOverflowContinuationTracker \* aTracker=0x00000000) Line 755 + 0x13 bytes C++
xul.dll!nsHTMLScrollFrame::ReflowScrolledFrame(ScrollReflowState \* aState=0x0012f808, int aAssumeHScroll=0x00000000, int aAssumeVScroll=0x00000000, nsHTMLReflowMetrics \* aMetrics=0x0012f720, int aFirstPass=0x0012f7b8) Line 493 C++
xul.dll!nsHTMLScrollFrame::ReflowContents(ScrollReflowState \* aState=0x0012f808, const nsHTMLReflowMetrics & aDesiredSize={...}) Line 570 C++
xul.dll!nsHTMLScrollFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 771 C++
xul.dll!nsContainerFrame::ReflowChild(nsIFrame \* aKidFrame=0x00000000, nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, int aX=0x00000000, int aY=0x00000000, unsigned int aFlags=0x00000000, unsigned int & aStatus=, nsOverflowContinuationTracker \* aTracker=0x00000000) Line 755 + 0x13 bytes C++
xul.dll!ViewportFrame::Reflow(nsPresContext \* aPresContext=0x00b9dae0, nsHTMLReflowMetrics & aDesiredSize={...}, const nsHTMLReflowState & aReflowState={...}, unsigned int & aStatus=0x00000000) Line 288 C++
xul.dll!PresShell::DoReflow(nsIFrame \* target=0x00000000) Line 6215 C++
xul.dll!PresShell::ProcessReflowCommands(int aInterruptible=0x00000001) Line 6307 C++
xul.dll!PresShell::DoFlushPendingNotifications(mozFlushType aType=Flush\_Layout, int aInterruptibleReflow=0x00000001) Line 4513 C++
xul.dll!PresShell::ReflowEvent::Run() Line 6067
xul.dll!nsThread::ProcessNextEvent(int mayWait=0x00000001, int \* result=0x0012fc68) Line 511 C++
xul.dll!NS\_ProcessNextEvent\_P(nsIThread \* thread=0x00000000, int mayWait=0x0012ff14) Line 227 + 0xc bytes C++
xul.dll!nsBaseAppShell::Run() Line 153 C++
xul.dll!nsAppStartup::Run() Line 182 C++
xul.dll!XRE\_main(int argc=0x00000001, char \* \* argv=0x00349bc8, const nsXREAppData \* aAppData=0x00349f60) Line 3137 C++
firefox.exe!NS\_internal\_main(int argc=0x00000001) Line 159 C++
firefox.exe!wmain(int argc=0x00000001, wchar\_t \* \* argv=0x00347c90) Line 55 + 0x8 bytes C++
firefox.exe!\_\_tmainCRTStartup() Line 594 + 0x17 bytes C
kernel32.dll!\_BaseProcessStart@4() + 0x23 bytes
Source nsframeframe.cpp, line 507:
mInnerView is 0x00;
nsIViewManager\* vm = mInnerView->GetViewManager();

|  | [Window Snyder](/user_profile?user_id=254605) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a160_254605)• 16 years ago |

Group: security

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=448564#c1)• 16 years ago |
|  | |

When loading the testcase (from bugzilla, loading from local file doesn't show the crash) I hit a couple of assertions that don't look related, and then I hit the assertion:
NS\_ASSERTION(aPresContext->GetPresShell()->GetPrimaryFrameFor(mContent) == this,
"Shouldn't happen");
in nsSubDocumentFrame::Reflow(), and then after that we cash in nsIView::GetViewManager() because this is null.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a4252_55600)• 16 years ago |

Summary: Radware DoS report → Radware DoS report [@ nsSubDocumentFrame::Reflow]

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=448564#c2)• 16 years ago |
|  | |

This regressed between 2006-04-10 and 2006-04-11:
<http://bonsai.mozilla.org/cvsquery.cgi?treeid=default&module=all&branch=HEAD&branchtype=match&dir=&file=&filetype=match&who=&whotype=match&sortby=Date&hours=2&date=explicit&mindate=2006-04-10+04&maxdate=2006-04-11+09&cvsroot=%2Fcvsroot>
My guess is a regression form [bug 332927](/show_bug.cgi?id=332927 "RESOLVED FIXED - Clean up iframe/frame printing code"), somehow.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=448564#c3)• 16 years ago |
|  | |

Maybe some of the comments in [bug 369547](/show_bug.cgi?id=369547 "RESOLVED WORKSFORME - Crash [@ nsSubDocumentFrame::Reflow] with testcase, using first-letter, first-line, inline-block and iframes") are useful for this?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=448564#c4)• 16 years ago |
|  | |

This looks like a parser/content-sink bug. We're getting a ContentAppended on the body aIndexInContainer == 2, coming from nsHTMLContentSink::CloseBody. At this point, the relevant part of the DOM looks like this (containment indicated by nesting):
<body>
<s>
#text
<form>
<select>
<optgroup>
#text
<form>
<s>
#text
<iframe>
#text
<script>
#text
<form>
#text
<table>
#text
Thing is, when we last notified (from HandleSavedTokens calling BeginContext), that second form wasn't there, and the third one was. So in other words, we're double-notifying on the entire subtree rooted at that third form, which naturally breaks things.
Somewhere in here we should have had a ContentInserted notification (when we created the <form> containing the <select>), and updated the mNumFlushed for the <body> accordingly.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=448564#c5)• 16 years ago |
|  | |

This is a null deref, right? Any reason for it to be security-sensitive?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=448564#c6)• 16 years ago |
|  | |

Given [comment 4](/show_bug.cgi?id=448564#c4 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"), it should be possible to trigger other (not just null-deref) crashes here, I think. The frame tree is just badly broken.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=448564#c7)• 16 years ago |
|  | |

Given that, i'm gonna set some flags to up the priority on this one.
I'll take this for now, but if someone wants to, feel free to take it. I won't be able to look at this for at least a couple of weeks.Assignee: nobody → jonasFlags: wanted1.9.0.x?Flags: blocking1.9.1+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a434531_190622)• 16 years ago |

Flags: wanted1.9.0.x? → wanted1.9.0.x+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=448564#c8)• 16 years ago |
|  | |

cc:ing Ben Newman who said he could help look into this. Ben, in this case we end up creating two nsSubDocumentFrame's (and other frames too) for a single DOM node, the construction of the frames happens off of notifications from the content sink (ContentAppended() most likely, in either nsHTMLContentSink or nsContentSink). We should only ever get one notification for any given DOM node being inserted into the DOM tree, but in this case we most likely fire two of them, and thus end up with the duplicated frames etc.
Feel free to take this bug if you'll be able to get to it before Jonas does...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=448564#c9)• 16 years ago |
|  | |

Ben, see [comment 4](/show_bug.cgi?id=448564#c4 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]") for some details of when the incorrect notifications happen... the real question is what mutated the DOM without updating the notification indices in the sink.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=448564#c10)• 16 years ago |
|  | |

(In reply to [comment #1](/show_bug.cgi?id=448564#c1 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> When loading the testcase (from bugzilla, loading from local file doesn't show
> the crash) I hit a couple of assertions that don't look related, and then I hit
> the assertion:
>
> NS\_ASSERTION(aPresContext->GetPresShell()->GetPrimaryFrameFor(mContent) ==
> this,
> "Shouldn't happen");
>
> in nsSubDocumentFrame::Reflow(), and then after that we cash in
> nsIView::GetViewManager() because this is null.
>
For what it's worth, this particular point of failure can be blamed on the changeset Martijn identified above:
<https://bugzilla.mozilla.org/attachment.cgi?id=217746&action=diff#mozilla/layout/generic/nsFrameFrame.cpp_sec3>
I see no reason not to reinstate the null check, but the problem runs deeper than that.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=448564#c11)• 16 years ago |
|  | |

We (or at least I :) ) generally don't add nullchecks in cases when something "is fairly certain never to be null and we know of case where it happens, and if it does much worse things are going to fail anyway". Otherwise we end up nullchecking ourselves to death.
However I'm not sure if that is the case here or not. Obviously it does happen that it is null sometimes :)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=448564#c12)• 16 years ago |
|  | |

(In reply to [comment #11](/show_bug.cgi?id=448564#c11 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> if it does much worse things are going to fail anyway
I definitely think this passes the "bigger problems elsewhere" test :) I'm okay with leaving the null check out.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=448564#c13)• 16 years ago |
|  | |

Small update:
Running under gdb sometimes triggers the correct behavior. After a few rounds of binary-search debugging, I isolated the last instruction I can break on without altering normal notification behavior. In other words, if I step over this instruction and then continue, the page renders just fine.
The instruction is mLastNotificationTime = PR\_Now(), at nsContentSink.cpp:1087
Setting mLastNotificationTime to 0, which makes it appear that the last notification hasn't happened since 1970, is a hacky way to suppress the problem. This may or may not represent any progress; in any case, I need to make sure that a notification gets fired deterministically, rather than depending on periodical notifications.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=448564#c14)• 16 years ago |
|  | |

You could turn off notifications completely in the sink (there are prefs for it), then trigger notifications by tossing <script> nodes into the DOM. Especially if the script just does |document.body.offsetWidth|

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=448564#c15)• 16 years ago |
|  | |

Looks like this has been assigned a CVE number
<http://nvd.nist.gov/nvd.cfm?cvename=CVE-2008-3444>Alias: CVE-2008-3444

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=448564#c16)• 16 years ago |
|  | |

Attached patch

[proposed patch with (very tentative) test cases](attachment.cgi?id=333828&action=diff) (obsolete)
— [Details](attachment.cgi?id=333828&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=333828)

The DOM mutation that wasn't being followed by a notification was the call to mSink->InsertChildAt in SinkContext::OpenContainer. Mimicking other parts of the content sink code, I added a call to DidAddContent at the end of OpenContainer. Then I realized that DidAddContent could be made to handle NotifyAppend as well as NotifyInsert. With that change, several other chunks of code became redundant (specifically, code calling both NotifyAppend and OpenContainer/DidAddContent). The only sticky part was in OpenFrameset, but I moved that logic into the switch statement at the end of OpenContainer.
Since NotifyAppend and NotifyInsert are now called in OpenContainer, CloseContainer has less work to do. It still calls DidAddContent, but this call rarely if ever results in a notification. This is a good thing, I think, because the order of CloseContainer calls is the reverse of the order in which we want to be notifying. If I am not mistaken, the purpose of mNotifyLevel was to reduce the number of notifications stemming from these CloseContainer calls, so I believe it's now safe to remove the mNotifyLevel altogether.
If any of my assumptions are off the mark, those last two paragraphs may be complete nonsense. I look forward to your feedback :)
One big question: I have no idea how to test this stuff, because I'm not sure how to detect double rendering using mochitest, given that the DOM gets constructed just fine. Nevertheless, my patch includes the mochitests that I used during my debugging.
[Attachment #333828](/attachment.cgi?id=333828&action=edit "proposed patch with (very tentative) test cases") -
Flags: superreview?
[Attachment #333828](/attachment.cgi?id=333828&action=edit "proposed patch with (very tentative) test cases") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a1307729_318596)• 16 years ago |

[Attachment #333828](/attachment.cgi?id=333828&action=edit "proposed patch with (very tentative) test cases") -
Flags: superreview? → superreview?(jonas)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=448564#c17)• 16 years ago |
|  | |

Ben, it sounds like you want to test this using a reftest instead of a mochitest.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=448564#c18)• 16 years ago |
|  | |

I'd say you should test with both, while watching out for any assertions that this might trigger. Not sure if we have any good assertions in there currently, or if new ones should be added.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=448564#c19)• 16 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=448564#c17 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Ben, it sounds like you want to test this using a reftest instead of a
> mochitest.
From <http://developer.mozilla.org/en/docs/Creating_reftest-based_unit_tests>:
"So, if the effect of complex markup is being tested, put that complex markup into a page and create another page that uses simple markup to achieve the same visual effect. Reftest will then compare them and verify whether they produce the same visual construct."
That's just what I need. Thanks!

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=448564#c20)• 16 years ago |
|  | |

Ah, sorry, to write a regression test using reftest sounds like the right choise. But to make sure you don't regress anything else follow the steps in my last comment :)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=448564#c21)• 16 years ago |
|  | |

This can be mochitested too, I bet. getElementsByTagName("iframe") up front, get its length, then finish parsing, then get its length again. With the old code it might well be off....

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=448564#c22)• 16 years ago |
|  | |

I'll try to get to this review tomorrow.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=448564#c23)• 16 years ago |
|  | |

Gah. Sorry for the lag... So in this case, mStack[mStackPos - 2].mInsertionPoint != -1 but mStack[mStackPos-2].mNumFlushed > mStack[mStackPos - 2].mInsertionPoint ? That's the only way I can see for the notifications to get confused by the InsertChildAt call, right?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=448564#c24)• 16 years ago |
|  | |

So looking at the patch, DidAddContent will now eagerly notify any time mNumFlushed < GetChildCount(). That's wrong. We want to limit the eager notification to the insert case, and in the usual append case we want to not do it. I suspect that this patch as written leads to a significant pageload regression. The fact that the "walk up the tree and notify" code in CloseContainer could be removed is a result of this eager notification, I assume?
Also, the check for IsTimeToNotify() needs to stay in CloseContainer(), ideally: we don't really want to be constructing frames as we open containers, but rather as we close them. Again, for performance.
Did the notifications on body/frameset get to go away because DidAddContent is now being called on those opens instead or something?
Thinking back to the cause of this bug, is the problem that we end up flushing out the sink or notifying between the OpenContainer (which adds the node to the DOM) and the CloseContainer (which notifies the insert), and as a result flush totally bogus information?
It seems like the right solution would be to notify eagerly on insert (either when inserting before mNumFlushed, or in general; the latter is probably easier since it doesn't involve keeping track of whether you still need to notify on the insert), not to switch to eager notifications for everything.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a2414167_318596)• 16 years ago |

[Attachment #333828](/attachment.cgi?id=333828&action=edit "proposed patch with (very tentative) test cases") -
Attachment is obsolete: true
[Attachment #333828](/attachment.cgi?id=333828&action=edit "proposed patch with (very tentative) test cases") -
Flags: superreview?(jonas)
[Attachment #333828](/attachment.cgi?id=333828&action=edit "proposed patch with (very tentative) test cases") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=448564#c25)• 16 years ago |
|  | |

(In reply to [comment #24](/show_bug.cgi?id=448564#c24 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> It seems like the right solution would be to notify eagerly on insert (either
> when inserting before mNumFlushed, or in general; the latter is probably easier
> since it doesn't involve keeping track of whether you still need to notify on
> the insert), not to switch to eager notifications for everything.
Notifying after InsertChildAt in OpenContainer (but not after AppendChildTo) almost works, except that notifications do not happen for children of the inserted child. I assume this is because the children haven't been appended yet, because the notification is happening in OpenContainer. I need to figure out why the parent of the InsertChildAt call appears fully flushed when it gets closed in CloseContainer.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=448564#c26)• 16 years ago |
|  | |

Hmm. Yeah, if we close an already-notified-on child we need to notify on its kids. There's code in CloseContainer that does that now, and would need to be called even in this situation.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=448564#c27)• 16 years ago |
|  | |

Update / note to self. Looks like we've lost the InsertChildAt insertion point by the time we FlushTags in CloseBody. In other words, we can tell that the parent has a new child, but not which child is new (or, rather, we assume we appended and thus double-notify for the last child). The problem is that mCurrentContext has changed since the insertion happened, and the stack node corresponding to the parent in the new context is distinct from the stack node whose insertion point we updated when we called InsertChildAt. The mContent fields of the two stack nodes point to the same object, but the mInsertionPoint fields are inconsistent.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=448564#c28)• 16 years ago |
|  | |

(In reply to [comment #27](/show_bug.cgi?id=448564#c27 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Update / note to self. Looks like we've lost the InsertChildAt insertion point
> by the time we FlushTags in CloseBody. In other words, we can tell that the
> parent has a new child, but not which child is new (or, rather, we assume we
> appended and thus double-notify for the last child). The problem is that
> mCurrentContext has changed since the insertion happened, and the stack node
> corresponding to the parent in the new context is distinct from the stack node
> whose insertion point we updated when we called InsertChildAt. The mContent
> fields of the two stack nodes point to the same object, but the mInsertionPoint
> fields are inconsistent.
Is it reasonable to have more than one context whose stack contains a particular node? If not, then I need to figure out how the duplication happened. If so, then it seems problematic that the mContent fields of different nodes are aliases but the integer fields are not.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=448564#c29)• 16 years ago |
|  | |

I would have thought we'd flush all pending notifications when switching contexts...
And yes, you can definitely have multiple contexts which all have the <body> on the stack. Peter, Jonas, or Blake may know more; I've never really understood the details of the sinkcontext stuff, to be honest.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=448564#c30)• 16 years ago |
|  | |

Attached patch

[new patch, same lousy test cases](attachment.cgi?id=335807&action=diff) (obsolete)
— [Details](attachment.cgi?id=335807&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335807)

This patch should be a lot easier to review. The trick was to back-propagate mInsertionPoint when closing a context. mNumFlushed was already getting propagated back, but no such love for mInsertionPoint. This exposed a bug in FlushTags: the inserted child is not necessarily the next node on the stack, but since we know the insertion point, it's easy enough to determine which child was actually inserted.
Going to start working on proper reftests as soon as I post this patch.
[Attachment #335807](/attachment.cgi?id=335807&action=edit "new patch, same lousy test cases") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=448564#c31)• 16 years ago |
|  | |

Attached patch

[same patch, spiffy new reftests](attachment.cgi?id=335828&action=diff) (obsolete)
— [Details](attachment.cgi?id=335828&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335828)

2 reftests, 1 crashtest
[Attachment #335807](/attachment.cgi?id=335807&action=edit "new patch, same lousy test cases") -
Attachment is obsolete: true
[Attachment #335828](/attachment.cgi?id=335828&action=edit "same patch, spiffy new reftests") -
Flags: review?(bzbarsky)
[Attachment #335807](/attachment.cgi?id=335807&action=edit "new patch, same lousy test cases") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=448564#c32)• 16 years ago |
|  | |

(In reply to [comment #30](/show_bug.cgi?id=448564#c30 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> This patch should be a lot easier to review.
s/should be a lot easier to review/is considerably simpler/

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=448564#c33)• 16 years ago |
|  | |

Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or are we guaranteed to have notified on all but one of them?
Also, when would the child on the stack not be the one at the insertion point?
Here's what I worry about. The following sequence of events:
1) Append two kids. Notify on them.
2) Insert a kid at position 1 (between the two). Don't notify.
3) Append another kid
Can this happen? Or are we guaranteed to notify on the inserted kids if mInsertionPoint becomes -1 again?
I really wish someone who knows this insertion point stuff better would chime in here... ;)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=448564#c34)• 16 years ago |
|  | |

(In reply to [comment #33](/show_bug.cgi?id=448564#c33 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or
> are we guaranteed to have notified on all but one of them?
Bad times. I suspect the author of the content sink intended to make such a guarantee, but it's implicit at best. Code like the following appears in multiple places:
if (parent.numFlushed < childCount) {
notify(parent, child, ...);
parent.numFlushed = childCount;
}
This assumes childCount - parent.numFlushed <= 1, since the notification only flushes one child. This assumption probably does warrant investigation, even if it's not directly responsible for the current bug.
> Also, when would the child on the stack not be the one at the insertion point?
As far as I can tell, this would never happen if HTMLContentSink::EndContext called FlushTags, but it doesn't, so it's possible for nodes to get inserted in a new context but notified only after the context is closed. Such nodes won't be on the stack in the old context, but their parents might be.
> Here's what I worry about. The following sequence of events:
>
> 1) Append two kids. Notify on them.
> 2) Insert a kid at position 1 (between the two). Don't notify.
> 3) Append another kid
>
> Can this happen? Or are we guaranteed to notify on the inserted kids if
> mInsertionPoint becomes -1 again?
I share this concern. There may be an argument that two children are never inserted/appended into the same parent without a notification, but we are definitely hosed if that happens, since we don't keep track of enough information to recover. If we want to enforce this invariant explicitly, we have to do it at insertion-time (when we're about to insert/append a child, make sure the parent is fully flushed).

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=448564#c35)• 16 years ago |
|  | |

(In reply to [comment #33](/show_bug.cgi?id=448564#c33 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or
> are we guaranteed to have notified on all but one of them?
I added a method to the SinkContext::Node struct to handle all insertions/appendings and also to check whether multiple children are ever inserted or appended without first flushing the parent. We append multiple children without flushing quite frequently, which seems okay because we can later assume all the unflushed children are at the end of the child list. But your question still stands: do multiple \*insertions\* ever happen without intervening notifications? I don't have direct evidence one way or the other, but it would be easy to prevent multiple insertions preemptively.
Maybe someone familiar with the content sink can comment on the necessity of such preemptive measures...

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=448564#c36)• 16 years ago |
|  | |

Attached patch

[decomposed SinkContext::Node::Add](attachment.cgi?id=335944&action=diff) (obsolete)
— [Details](attachment.cgi?id=335944&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335944)

Simplify/centralize child addition logic. Add an assertion to ensure we only insert into fully flushed nodes.
[Attachment #335828](/attachment.cgi?id=335828&action=edit "same patch, spiffy new reftests") -
Attachment is obsolete: true
[Attachment #335944](/attachment.cgi?id=335944&action=edit "decomposed SinkContext::Node::Add") -
Flags: review?(bzbarsky)
[Attachment #335828](/attachment.cgi?id=335828&action=edit "same patch, spiffy new reftests") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=448564#c37)• 16 years ago |
|  | |

Attached patch

[FlushTags in HTMLContentSink::EndContext](attachment.cgi?id=335973&action=diff) (obsolete)
— [Details](attachment.cgi?id=335973&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335973)

Now calling FlushTags in EndContext, both to be more symmetrical with BeginContext (call FlushTags whenever switching contexts) and to avoid having to worry about flushing children not on the stack in FlushTags and DidAddContent. Assertions now verify that inserted children are in the expected place on the stack.
Also added another reftest to catch a double rendering bug that I concocted earlier this afternoon.
[Attachment #335944](/attachment.cgi?id=335944&action=edit "decomposed SinkContext::Node::Add") -
Attachment is obsolete: true
[Attachment #335973](/attachment.cgi?id=335973&action=edit "FlushTags in HTMLContentSink::EndContext") -
Flags: review?(bzbarsky)
[Attachment #335944](/attachment.cgi?id=335944&action=edit "decomposed SinkContext::Node::Add") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=448564#c38)• 16 years ago |
|  | |

Comment on [attachment 335973](/attachment.cgi?id=335973 "FlushTags in HTMLContentSink::EndContext") [[details]](/attachment.cgi?id=335973&action=edit "FlushTags in HTMLContentSink::EndContext") [[diff]](/attachment.cgi?id=335973&action=diff "FlushTags in HTMLContentSink::EndContext") [[review]](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335973)
FlushTags in HTMLContentSink::EndContext
><html><body><pre style="word-wrap: break-word; white-space: pre-wrap;">diff --git a/content/html/document/crashtests/448564.html b/content/html/document/crashtests/448564.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/crashtests/448564.html
>@@ -0,0 +1,7 @@
>+<s>
>+<form>a</form>
>+<iframe></iframe>
>+<script src=a></script>
>+<form></form>
>+<table>
>+<optgroup>
>\ No newline at end of file
>diff --git a/content/html/document/crashtests/crashtests.list b/content/html/document/crashtests/crashtests.list
>--- a/content/html/document/crashtests/crashtests.list
>+++ b/content/html/document/crashtests/crashtests.list
>@@ -1,3 +1,4 @@ load 388183-1.html
> load 388183-1.html
> load 395340-1.html
> load 407053.html
>+load 448564.html
>diff --git a/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_malformed.html b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_malformed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_malformed.html
>@@ -0,0 +1,11 @@
>+<html>
>+<body>
>+ <script src=></script>
>+ <b>
>+ <form>a</form>
>+ <form>b</form>
>+ <table>
>+ <optgroup></optgroup>
>+ </b>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_well-formed.html b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_well-formed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_well-formed.html
>@@ -0,0 +1,13 @@
>+<html>
>+<body>
>+ <b>a</b>
>+ <form>
>+ <select>
>+ <optgroup />
>+ </select>
>+ </form>
>+ <form>
>+ <b>b</b>
>+ </form>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_malformed.html b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_malformed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_malformed.html
>@@ -0,0 +1,11 @@
>+<html>
>+<body>
>+ <s>
>+ <form>a</form>
>+ <iframe></iframe>
>+ <script src=a></script>
>+ <form></form>
>+ <table>
>+ <optgroup>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_well-formed.html b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_well-formed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_well-formed.html
>@@ -0,0 +1,15 @@
>+<html>
>+<body>
>+ <form>
>+ <select>
>+ <optgroup />
>+ </select>
>+ </form>
>+ <form>
>+ <s>
>+ a
>+ <iframe></iframe>
>+ </s>
>+ </form>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_malformed.html b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_malformed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_malformed.html
>@@ -0,0 +1,4 @@
>+<table>
>+ <th>head</th>
>+ <optgroup>b</optgroup>
>+</table>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_well-formed.html b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_well-formed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/[bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_well-formed.html
>@@ -0,0 +1,8 @@
>+<form>
>+ <select>
>+ <optgroup>b</optgroup>
>+ </select>
>+</form>
>+<table>
>+ <th>head</th>
>+</table>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/reftests.list b/content/html/document/reftests/reftests.list
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/reftests.list
>@@ -0,0 +1,3 @@
>+== [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_well-formed.html [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_malformed.html
>+== [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_well-formed.html [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-2\_malformed.html
>+== [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_well-formed.html [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-3\_malformed.html
>diff --git a/content/html/document/src/nsHTMLContentSink.cpp b/content/html/document/src/nsHTMLContentSink.cpp
>--- a/content/html/document/src/nsHTMLContentSink.cpp
>+++ b/content/html/document/src/nsHTMLContentSink.cpp
>@@ -368,16 +368,18 @@ public:
> nsCOMPtr<nsIContent> mLastTextNode;
> PRInt32 mLastTextNodeSize;
>
> struct Node {
> nsHTMLTag mType;
> nsGenericHTMLElement\* mContent;
> PRUint32 mNumFlushed;
> PRInt32 mInsertionPoint;
>+
>+ nsIContent \*Add(nsIContent \*child);
> };
>
> Node\* mStack;
> PRInt32 mStackSize;
> PRInt32 mStackPos;
>
> PRUnichar\* mText;
> PRInt32 mTextLength;
>@@ -725,20 +727,22 @@ SinkContext::DidAddContent(nsIContent\* a
> SINK\_TRACE(gSinkLogModuleInfo, SINK\_TRACE\_REFLOW,
> ("SinkContext::DidAddContent: Insertion notification for "
> "parent=%s at position=%d and stackPos=%d",
> str.get(), mStack[mStackPos - 1].mInsertionPoint - 1,
> mStackPos - 1));
> }
> #endif
>
>- mSink->NotifyInsert(parent, aContent,
>- mStack[mStackPos - 1].mInsertionPoint - 1);
>+ PRInt32 childIndex = mStack[mStackPos - 1].mInsertionPoint - 1;
>+ NS\_ASSERTION(parent->GetChildAt(childIndex) == aContent,
>+ "Flushing the wrong child.");
>+ mSink->NotifyInsert(parent, aContent, childIndex);
> mStack[mStackPos - 1].mNumFlushed = parent->GetChildCount();
>- } else if (mSink->IsTimeToNotify()) {
>+ } else if (false && mSink->IsTimeToNotify()) {
> SINK\_TRACE(gSinkLogModuleInfo, SINK\_TRACE\_REFLOW,
> ("SinkContext::DidAddContent: Notification as a result of the "
> "interval expiring; backoff count: %d", mSink->mBackoffCount));
> FlushTags();
> }
> }
>
> nsresult
>@@ -830,25 +834,17 @@ SinkContext::OpenContainer(const nsIPars
> break;
> default:
> break;
> }
>
> rv = mSink->AddAttributes(aNode, content);
> MaybeSetForm(content, nodeType, mSink);
>
>- nsGenericHTMLElement\* parent = mStack[mStackPos - 2].mContent;
>-
>- if (mStack[mStackPos - 2].mInsertionPoint != -1) {
>- parent->InsertChildAt(content,
>- mStack[mStackPos - 2].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(content, PR\_FALSE);
>- }
>+ mStack[mStackPos - 2].Add(content);
>
> NS\_ENSURE\_SUCCESS(rv, rv);
>
> if (mSink->IsMonolithicContainer(nodeType)) {
> mSink->mInMonolithicContainer++;
> }
>
> // Special handling for certain tags
>@@ -895,16 +891,29 @@ SinkContext::HaveNotifiedForCurrentConte
> SinkContext::HaveNotifiedForCurrentContent() const
> {
> if (0 < mStackPos) {
> nsIContent\* parent = mStack[mStackPos - 1].mContent;
> return mStack[mStackPos-1].mNumFlushed == parent->GetChildCount();
> }
>
> return PR\_TRUE;
>+}
>+
>+nsIContent \*
>+SinkContext::Node::Add(nsIContent \*child)
>+{
>+ if (mInsertionPoint != -1) {
>+ NS\_ASSERTION(mNumFlushed == mContent->GetChildCount(),
>+ "Inserting multiple children without flushing.");
>+ mContent->InsertChildAt(child, mInsertionPoint++, PR\_FALSE);
>+ } else {
>+ mContent->AppendChildTo(child, PR\_FALSE);
>+ }
>+ return child;
> }
>
> nsresult
> SinkContext::CloseContainer(const nsHTMLTag aTag, PRBool aMalformed)
> {
> nsresult result = NS\_OK;
>
> // Flush any collected text content. Release the last text
>@@ -1148,29 +1157,18 @@ SinkContext::AddLeaf(const nsIParserNode
>
> nsresult
> SinkContext::AddLeaf(nsGenericHTMLElement\* aContent)
> {
> NS\_ASSERTION(mStackPos > 0, "leaf w/o container");
> if (mStackPos <= 0) {
> return NS\_ERROR\_FAILURE;
> }
>-
>- nsGenericHTMLElement\* parent = mStack[mStackPos - 1].mContent;
>-
>- // If the parent has an insertion point, insert rather than append.
>- if (mStack[mStackPos - 1].mInsertionPoint != -1) {
>- parent->InsertChildAt(aContent,
>- mStack[mStackPos - 1].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(aContent, PR\_FALSE);
>- }
>-
>- DidAddContent(aContent);
>+
>+ DidAddContent(mStack[mStackPos - 1].Add(aContent));
>
> #ifdef DEBUG
> if (SINK\_LOG\_TEST(gSinkLogModuleInfo, SINK\_ALWAYS\_REFLOW)) {
> mSink->ForceReflow();
> }
> #endif
>
> return NS\_OK;
>@@ -1196,35 +1194,26 @@ SinkContext::AddComment(const nsIParserN
>
> comment->SetText(aNode.GetText(), PR\_FALSE);
>
> NS\_ASSERTION(mStackPos > 0, "stack out of bounds");
> if (mStackPos <= 0) {
> return NS\_ERROR\_FAILURE;
> }
>
>- nsGenericHTMLElement\* parent;
>- if (!mSink->mBody && !mSink->mFrameset && mSink->mHead) {
>- // XXXbz but this will make DidAddContent use the wrong parent for
>- // the notification! That seems so bogus it's not even funny.
>- parent = mSink->mHead;
>- } else {
>- parent = mStack[mStackPos - 1].mContent;
>+ {
>+ Node &parentNode = mStack[mStackPos - 1];
>+ nsGenericHTMLElement \*parent = parentNode.mContent;
>+ if (!mSink->mBody && !mSink->mFrameset && mSink->mHead)
>+ // XXXbz but this will make DidAddContent use the wrong parent for
>+ // the notification! That seems so bogus it's not even funny.
>+ parentNode.mContent = mSink->mHead;
>+ DidAddContent(parentNode.Add(comment));
>+ parentNode.mContent = parent;
> }
>-
>- // If the parent has an insertion point, insert rather than append.
>- if (mStack[mStackPos - 1].mInsertionPoint != -1) {
>- parent->InsertChildAt(comment,
>- mStack[mStackPos - 1].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(comment, PR\_FALSE);
>- }
>-
>- DidAddContent(comment);
>
> #ifdef DEBUG
> if (SINK\_LOG\_TEST(gSinkLogModuleInfo, SINK\_ALWAYS\_REFLOW)) {
> mSink->ForceReflow();
> }
> #endif
>
> return rv;
>@@ -1380,20 +1369,21 @@ SinkContext::FlushTags()
> SINK\_TRACE(gSinkLogModuleInfo, SINK\_TRACE\_REFLOW,
> ("SinkContext::FlushTags: tag=%s from newindex=%d at "
> "stackPos=%d", tagStr,
> mStack[stackPos].mNumFlushed, stackPos));
> }
> #endif
> if ((mStack[stackPos].mInsertionPoint != -1) &&
> (mStackPos > (stackPos + 1))) {
>+ PRInt32 childIndex = mStack[stackPos].mInsertionPoint - 1;
> nsIContent\* child = mStack[stackPos + 1].mContent;
>- mSink->NotifyInsert(content,
>- child,
>- mStack[stackPos].mInsertionPoint - 1);
>+ NS\_ASSERTION(content->GetChildAt(childIndex) == child,
>+ "Flushing the wrong child.");
>+ mSink->NotifyInsert(content, child, childIndex);
> } else {
> mSink->NotifyAppend(content, mStack[stackPos].mNumFlushed);
> }
>
> flushed = PR\_TRUE;
> }
>
> mStack[stackPos].mNumFlushed = childCount;
>@@ -1484,28 +1474,19 @@ SinkContext::FlushText(PRBool\* aDidFlush
> mTextLength = 0;
>
> // Add text to its parent
> NS\_ASSERTION(mStackPos > 0, "leaf w/o container");
> if (mStackPos <= 0) {
> return NS\_ERROR\_FAILURE;
> }
>
>- nsGenericHTMLElement\* parent = mStack[mStackPos - 1].mContent;
>- if (mStack[mStackPos - 1].mInsertionPoint != -1) {
>- parent->InsertChildAt(mLastTextNode,
>- mStack[mStackPos - 1].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(mLastTextNode, PR\_FALSE);
>- }
>+ DidAddContent(mStack[mStackPos - 1].Add(mLastTextNode));
>
> didFlush = PR\_TRUE;
>-
>- DidAddContent(mLastTextNode);
> }
> }
>
> if (aDidFlush) {
> \*aDidFlush = didFlush;
> }
>
> if (aReleaseLast) {
>@@ -1939,18 +1920,20 @@ HTMLContentSink::EndContext(PRInt32 aPos
>
> PRInt32 n = mContextStack.Count() - 1;
> SinkContext\* sc = (SinkContext\*) mContextStack.ElementAt(n);
>
> NS\_ASSERTION(sc->mStack[aPosition].mType == mCurrentContext->mStack[0].mType,
> "ending a wrong context");
>
> mCurrentContext->FlushTextAndRelease();
>+ mCurrentContext->FlushTags();
>
> sc->mStack[aPosition].mNumFlushed = mCurrentContext->mStack[0].mNumFlushed;
>+ sc->mStack[aPosition].mInsertionPoint = mCurrentContext->mStack[0].mInsertionPoint;
>
> for (PRInt32 i = 0; i<mCurrentContext->mStackPos; i++) {
> NS\_IF\_RELEASE(mCurrentContext->mStack[i].mContent);
> }
>
> delete [] mCurrentContext->mStack;
>
> mCurrentContext->mStack = nsnull;
>diff --git a/layout/reftests/reftest.list b/layout/reftests/reftest.list
>--- a/layout/reftests/reftest.list
>+++ b/layout/reftests/reftest.list
>@@ -105,8 +105,11 @@ include text-transform/reftest.list
> # xul-document-load/
> include xul-document-load/reftest.list
>
> # xul grid
> include ../xul/base/src/grid/reftests/reftest.list
>
> # z-index/
> include z-index/reftest.list
>+
>+# reftest(s) to verify content bugfixes
>+include ../../content/html/document/reftests/reftests.list

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=448564#c39)• 16 years ago |
|  | |

Attached patch

[stray Makefile changes removed from previous patch](attachment.cgi?id=335976&action=diff) (obsolete)
— [Details](attachment.cgi?id=335976&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335976)

Please disregard my previous comment. "Edit attachment as comment" did exactly what it said, if not what I intended...
[Attachment #335973](/attachment.cgi?id=335973&action=edit "FlushTags in HTMLContentSink::EndContext") -
Attachment is obsolete: true
[Attachment #335976](/attachment.cgi?id=335976&action=edit "stray Makefile changes removed from previous patch") -
Flags: review?(bzbarsky)
[Attachment #335973](/attachment.cgi?id=335973&action=edit "FlushTags in HTMLContentSink::EndContext") -
Flags: review?(bzbarsky)

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=448564#c40)• 16 years ago |
|  | |

Contexts are basically insertion points. We create them for two reasons:
1. Insert into the head vs. the body. So for example we keep a head context
around to insert some set of elements in the head always. At this point that
set might simply be the <title> element.
2. Insert misplaced table stuff before the table. So given the markup
<table><tr><span><td>, when we hit the <span> we create a new context and tell
it to insert stuff before the <table> element.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=448564#c41)• 16 years ago |
|  | |

So given that, propagating mInsertionPoint from context to context would be wrong, sounds like.
Ben, I think I've more or less managed to convince myself that we can't insert multiple nodes in a single insertion point without notifying, but I'll need to double-check some of that tomorrow. I'll also look at that patch first thing in the morning.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=448564#c42)• 16 years ago |
|  | |

(In reply to [comment #41](/show_bug.cgi?id=448564#c41 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> So given that, propagating mInsertionPoint from context to context would be
> wrong, sounds like.
Yep, and calling FlushTags in EndContext makes that unnecessary anyhow. This patch is essentially a one-liner (ignoring tests and assertions and the SinkContext::Node::Add refactoring).
Jonas's post suggests that context switching happens relatively infrequently, so there shouldn't be any appreciable performance hit.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=448564#c43)• 16 years ago |
|  | |

Attached patch

[no more back-propagation of mInsertionPoint](attachment.cgi?id=335997&action=diff) (obsolete)
— [Details](attachment.cgi?id=335997&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=335997)

The only remaining functional change is the addition of mCurrentContext->FlushTags() to HTMLContentSink::EndContext. Rest of the patch consists of tests and some refactoring (to use SinkContext::Node::Add).
[Attachment #335976](/attachment.cgi?id=335976&action=edit "stray Makefile changes removed from previous patch") -
Attachment is obsolete: true
[Attachment #335997](/attachment.cgi?id=335997&action=edit "no more back-propagation of mInsertionPoint") -
Flags: review?(bzbarsky)
[Attachment #335976](/attachment.cgi?id=335976&action=edit "stray Makefile changes removed from previous patch") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=448564#c44)• 16 years ago |
|  | |

So. Let's posit a parent with an insertion point. We're parsing its kids. When we OpenContainer a kid or AddLeaf a kid, we stick it into the insertion point. Then when we call DidAddContent either in the same AddLeaf or when we CloseContainer the kid. Since we have an insertion point, DidAddContent notifies. Therefore, we cannot insert multiple kids into the insertion point without notifying on all but maybe the last of them.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=448564#c45)• 16 years ago |
|  | |

OK. So given that, I'm back to being confused about why this bug happens. Do we EndContext before we make the DidAddContent call for the insertion point content?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=448564#c46)• 16 years ago |
|  | |

That is, can we assert in EndContext that mNumFlushed == GetChildCount()? I assume that this bug's testcase would trigger the assert, right?

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=448564#c47)• 16 years ago |
|  | |

(In reply to [comment #45](/show_bug.cgi?id=448564#c45 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> OK. So given that, I'm back to being confused about why this bug happens. Do
> we EndContext before we make the DidAddContent call for the insertion point
> content?
Yes, we do. Think CNavDTD::CloseContainersTo has something to do with that; going to look into it after lunch.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=448564#c48)• 16 years ago |
|  | |

Attached patch

[proposed patch (no longer calling FlushTags)](attachment.cgi?id=337156&action=diff) (obsolete)
— [Details](attachment.cgi?id=337156&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=337156)

Summary of changes:
- CNavDTD::HandleSavedTokens is now responsible for instructing
the content sink to close forms created (e.g., by
CNavDTD::CreateContextStackFor) during the execution of
HandleSavedTokens. Intuitively, CNavDTD::CloseContainersTo
should do this, but the parser forgets about forms after
opening them (a deliberate design choice that I didn't make).
Closing these forms before calling HTMLContentSink::EndContext
ensures that the sink is completely flushed before it throws
away the current context (with its mInsertionPoint
information), which solves the double rendering bug without
requiring any calls to FlushTags.
- Introduced CNavDTD::CloseResidualStyleTags to fix another bug
that was involved in the original test case but orthogonal to
the double rendering issue. To explain: residual tags get
pushed inside block elements when the document has any
malformed tags, and the sink refuses to close a form if any
tags inside the form are still open. So form closure fails
when there are any malformed tags, unless we close all the
residual tags still open within the form. This failure causes
subsequent nodes to nest inside the unclosed form (sometimes
forms within forms!), as reftest [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")-1\_\*.html
demonstrates. My [bug448564](/show_bug.cgi?id=448564 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]")\_4\*.html reftest verifies that
CNavDTD::OpenTransientStyles reopens the residual tags.
- Decomposition of SinkContext::Node::Add. Not a functional
change, just a little cleanup.
- Miscellaneous assertions.
- Six reftests and one crashtest.
[Attachment #335997](/attachment.cgi?id=335997&action=edit "no more back-propagation of mInsertionPoint") -
Attachment is obsolete: true
[Attachment #337156](/attachment.cgi?id=337156&action=edit "proposed patch (no longer calling FlushTags)") -
Flags: review?(bzbarsky)
[Attachment #335997](/attachment.cgi?id=335997&action=edit "no more back-propagation of mInsertionPoint") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=448564#c49)• 16 years ago |
|  | |

Oh... Right. Forms. How does this last patch handle:
<table>
<form>
<tr><td><input name="a" value="aval"></td></tr>
<input type="hidden" name="b" value="bval">
<input name="c" value="cval">
<tr><td><input name="d" value="dval" type="submit"></td></tr>
</form>
</table>
When you submit the form, are all the inputs submitted? Does anything change if the form is opened before the table open and closed after the table close? What about:
<table>
<span><form>
<tr><td><input name="a" value="aval"></td></tr>
<input type="hidden" name="b" value="bval">
<input name="c" value="cval">
<tr><td><input name="d" value="dval" type="submit"></td></tr>
</form></span>
</table>
or some such? In any case, with forms involved like this I can almost see how we could switch contexts while the form is still open. Given that, the FlushTags is probably what we want. I just wanted to understand what about this testcase was tickling that situation...
If you do want to make changes to CNavDTD, then mrbkap is your review man for those. I'm willing to review the sink, but CNavDTD is black magic. ;)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=448564#c50)• 16 years ago |
|  | |

Attached patch

[new forms tests, back to calling FlushTags for good measure](attachment.cgi?id=337795&action=diff)
— [Details](attachment.cgi?id=337795&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=337795)

Blake, can you review the CNavDTD changes in this patch? Hope my comments in the code make it clear what I was trying to do.
[Attachment #337156](/attachment.cgi?id=337156&action=edit "proposed patch (no longer calling FlushTags)") -
Attachment is obsolete: true
[Attachment #337795](/attachment.cgi?id=337795&action=edit "new forms tests, back to calling FlushTags for good measure") -
Flags: review?(mrbkap)
[Attachment #337156](/attachment.cgi?id=337156&action=edit "proposed patch (no longer calling FlushTags)") -
Flags: review?(bzbarsky)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=448564#c51)• 16 years ago |
|  | |

(In reply to [comment #49](/show_bug.cgi?id=448564#c49 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> When you submit the form, are all the inputs submitted? Does anything change
> if the form is opened before the table open and closed after the table close?
All the input fields do get submitted, according to the tests I added in the most recent patch.
> In any case, with forms involved like this I can almost see how
> we could switch contexts while the form is still open. Given that, the
> FlushTags is probably what we want.
I think it was worthwhile to drill a little deeper (i.e., into the parser), but I'm also inclined to keep FlushTags in EndContext.
> If you do want to make changes to CNavDTD, then mrbkap is your review man for
> those. I'm willing to review the sink, but CNavDTD is black magic. ;)
Don't blame you :)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a3726379_69426)• 16 years ago |

[Attachment #337795](/attachment.cgi?id=337795&action=edit "new forms tests, back to calling FlushTags for good measure") -
Flags: review?(mrbkap) → review+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=448564#c52)• 16 years ago |
|  | |

Comment on [attachment 337795](/attachment.cgi?id=337795 "new forms tests, back to calling FlushTags for good measure") [[details]](/attachment.cgi?id=337795&action=edit "new forms tests, back to calling FlushTags for good measure") [[diff]](/attachment.cgi?id=337795&action=diff "new forms tests, back to calling FlushTags for good measure") [[review]](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=337795)
new forms tests, back to calling FlushTags for good measure
The CNavDTD changes look good. [bug 136397](/show_bug.cgi?id=136397 "RESOLVED FIXED - Do not always treat FORM as a leaf in CNavDTD.") tracks the most correct fix for <form> closure (namely, tracking whether we've opened one in CNavDTD, not in the content sink).

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a4335648_318596)• 16 years ago |

[Attachment #337795](/attachment.cgi?id=337795&action=edit "new forms tests, back to calling FlushTags for good measure") -
Flags: superreview?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=448564#c53)• 16 years ago |
|  | |

Comment on [attachment 337795](/attachment.cgi?id=337795 "new forms tests, back to calling FlushTags for good measure") [[details]](/attachment.cgi?id=337795&action=edit "new forms tests, back to calling FlushTags for good measure") [[diff]](/attachment.cgi?id=337795&action=diff "new forms tests, back to calling FlushTags for good measure") [[review]](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=337795)
new forms tests, back to calling FlushTags for good measure
sr=bzbarsky, with newlines added to the ends of all those files that have no newlines at the end. Thanks a ton for digging into this code and getting this sorted out!
[Attachment #337795](/attachment.cgi?id=337795&action=edit "new forms tests, back to calling FlushTags for good measure") -
Flags: superreview?(bzbarsky) → superreview+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a5010566_20209)• 16 years ago |

Assignee: jonas → bnewman

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=448564#c54)• 16 years ago |
|  | |

Attached patch

[now with newlines](attachment.cgi?id=340626&action=diff)
— [Details](attachment.cgi?id=340626&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=340626)

[Attachment #340626](/attachment.cgi?id=340626&action=edit "now with newlines") -
Flags: review+

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a5012876_318596)• 16 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=448564#c55)• 16 years ago |
|  | |

Pushed changeset 39f61d918dae.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=448564#c56)• 16 years ago |
|  | |

Do we need this on any branches, btw?Status: NEW → RESOLVEDClosed: 16 years agoFlags: in-testsuite+Resolution: --- → FIXED

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=448564#c57)• 16 years ago |
|  | |

Maybe; nominating for now so we can discuss it on Monday.Flags: blocking1.9.0.4?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a6479631_1689)• 16 years ago |

Flags: wanted1.8.1.x-Flags: blocking1.9.0.4?Flags: blocking1.9.0.4+Whiteboard: [sg:nse dos]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=448564#c58)• 16 years ago |
|  | |

Do we need a different 1.9.0.x patch or have things not changed too much?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=448564#c59)• 16 years ago |
|  | |

Ben: please create a FF3.0.x patch (if necessary) and request approval for 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this early in the next cycle (for which the tree is only going to be open for about a week).Flags: blocking1.9.0.4+ → blocking1.9.0.5+

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=448564#c60)• 16 years ago |
|  | |

(In reply to [comment #59](/show_bug.cgi?id=448564#c59 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Ben: please create a FF3.0.x patch (if necessary) and request approval for
> 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this
> early in the next cycle (for which the tree is only going to be open for about
> a week).
Sure thing. Should this backpatch include tests, or just the functional changes? It's just a few lines if tests are not necessary.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=448564#c61)• 16 years ago |
|  | |

Tests would be good since we don't want to regress on the 3.0 branch either (actually, almost even more important there).
We have the same test infrastructure running on the branch though so you should be able to use the same tests.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=448564#c62)• 16 years ago |
|  | |

(In reply to [comment #59](/show_bug.cgi?id=448564#c59 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Ben: please create a FF3.0.x patch (if necessary) and request approval for
> 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this
> early in the next cycle (for which the tree is only going to be open for about
> a week).
Is that the hg tag MOZILLA\_1\_9\_a7\_BASE?

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=448564#c63)• 16 years ago |
|  | |

(In reply to [comment #62](/show_bug.cgi?id=448564#c62 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Is that the hg tag MOZILLA\_1\_9\_a7\_BASE?
Nope, it's CVS HEAD (see <https://developer.mozilla.org/en/Mozilla_Source_Code_Via_CVS>)

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=448564#c64)• 16 years ago |
|  | |

Attached patch

[backport to CVS HEAD](attachment.cgi?id=345176&action=diff)
— [Details](attachment.cgi?id=345176&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=345176)

Passes my tests. Waiting on the tryserver; will update when that's done.

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=448564#c65)• 16 years ago |
|  | |

(In reply to [comment #64](/show_bug.cgi?id=448564#c64 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> Created an attachment (id=345176) [details]
> backport to CVS HEAD
>
> Passes my tests. Waiting on the tryserver; will update when that's done.
And it builds on all three platforms: [https://build.mozilla.org/tryserver-builds/2008-10-28\_15:02-bnewman@mozilla.com-1225231280/](https://build.mozilla.org/tryserver-builds/2008-10-28_15%3A02-bnewman%40mozilla.com-1225231280/)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=448564#c66)• 16 years ago |
|  | |

Comment on [attachment 345176](/attachment.cgi?id=345176 "backport to CVS HEAD") [[details]](/attachment.cgi?id=345176&action=edit "backport to CVS HEAD") [[diff]](/attachment.cgi?id=345176&action=diff "backport to CVS HEAD") [[review]](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=345176)
backport to CVS HEAD
Applied cleanly and everything. Requesting approval for 1.9.0.5.
[Attachment #345176](/attachment.cgi?id=345176&action=edit "backport to CVS HEAD") -
Flags: approval1.9.0.5?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a8297519_1689)• 16 years ago |

Whiteboard: [sg:nse dos] → [sg:dos]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=448564#c67)• 16 years ago |
|  | |

Comment on [attachment 345176](/attachment.cgi?id=345176 "backport to CVS HEAD") [[details]](/attachment.cgi?id=345176&action=edit "backport to CVS HEAD") [[diff]](/attachment.cgi?id=345176&action=diff "backport to CVS HEAD") [[review]](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=345176)
backport to CVS HEAD
approved for 1.9.0.5, a=dveditz for release-drivers
(please wait for tree to open before landing)
[Attachment #345176](/attachment.cgi?id=345176&action=edit "backport to CVS HEAD") -
Flags: approval1.9.0.5? → approval1.9.0.5+

|  | [Ben Newman (:bnewman) (:benjamn)](/user_profile?user_id=318596)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=448564#c68)• 16 years ago |
|  | |

(In reply to [comment #67](/show_bug.cgi?id=448564#c67 "RESOLVED FIXED - Radware DoS report [@ nsSubDocumentFrame::Reflow]"))
> (From update of [attachment 345176](/attachment.cgi?id=345176 "backport to CVS HEAD") [[details]](/attachment.cgi?id=345176&action=edit "backport to CVS HEAD") [[diff]](/attachment.cgi?id=345176&action=diff "backport to CVS HEAD") [[review]](/page.cgi?id=splinter.html&ignore=&bug=448564&attachment=345176))
> approved for 1.9.0.5, a=dveditz for release-drivers
>
> (please wait for tree to open before landing)
Since I don't yet have commit access, any ideas whom I should ask to land this?

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=448564#c69)• 16 years ago |
|  | |

I'll land this in a couple of hours.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=448564#c70)• 16 years ago |
|  | |

Fixed on the 1.9 branch.Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---) → [fixed1.9.0.5](/buglist.cgi?keywords=fixed1.9.0.5&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=448564#c71)• 16 years ago |
|  | |

This seems to be working based on the checked in tests. Can we get anyone from Radware to verify the fix?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a11510722_137548)• 16 years ago |

Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

|  | [Alexander Sack](/user_profile?user_id=113760) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a12008357_113760)• 16 years ago |

Flags: wanted1.8.0.x-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a12040034_1689)• 16 years ago |

Group: core-security

|  | [Launchpad](/user_profile?user_id=363145) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=448564#a67327703_363145)• 14 years ago |

See Also: → <https://launchpad.net/bugs/256624>
You need to [log in](/show_bug.cgi?id=448564&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from launchpad.net_3e1d4c51_20250126_013803.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[firefox-3.0 package](https://launchpad.net/ubuntu/%2Bsource/firefox-3.0)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/firefox-3.0)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/firefox-3.0)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/firefox-3.0)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/firefox-3.0)

# [CVE-2008-3444] Firefox 3.0.1 crash via a crafted but well-formed web page

Bug #256624 reported by
[Till Ulen](https://launchpad.net/~tillulen)
on 2008-08-10

[256](/%2Bhelp-bugs/bug-heat.html)

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Mozilla Firefox](https://bugs.launchpad.net/firefox) | Fix Released | Medium | [mozilla-bugs #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564) |  |
|  | [firefox-3.0 (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0 "No current release for this source package in Ubuntu") | Fix Released | Undecided | Unassigned |  |

### Bug Description

Binary package hint: firefox-3.0

CVE-2008-3444 description:

"The content layout component in Mozilla Firefox 3.0 and 3.0.1 allows remote attackers to cause a denial of service (NULL pointer dereference and application crash) via a crafted but well-formed web page that contains "a simple set of legitimate HTML tags." "

<http://nvd.nist.gov/nvd.cfm?cvename=CVE-2008-3444>

More information:

<http://blog.mozilla.com/security/2008/07/30/low-risk-denial-of-service-in-firefox/>

<https://bugzilla.mozilla.org/show_bug.cgi?id=448564> (private bug)

See [original description](comments/0)

## CVE References

* [2008-3444](/bugs/cve/2008-3444 "The content layout component in Mozil...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jst (jst)](https://launchpad.net/~jst) wrote on 2008-07-30: |  |  | [#1](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/1) |
| --- | --- | --- | --- |

When loading the testcase (from bugzilla, loading from local file doesn't show the crash) I hit a couple of assertions that don't look related, and then I hit the assertion:

NS\_ASSERTION(aPresContext->GetPresShell()->GetPrimaryFrameFor(mContent) == this,

               "Shouldn't happen");

in nsSubDocumentFrame::Reflow(), and then after that we cash in nsIView::GetViewManager() because this is null.

When loading the testcase (from bugzilla, loading from local file doesn't show the crash) I hit a couple of assertions that don't look related, and then I hit the assertion:
NS\_ASSERTION(aPresContext->GetPresShell()->GetPrimaryFrameFor(mContent) == this,
"Shouldn't happen");
in nsSubDocumentFrame::Reflow(), and then after that we cash in nsIView::GetViewManager() because this is null.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Martijn-martijn (martijn-martijn)](https://launchpad.net/~martijn-martijn) wrote on 2008-07-30: |  |  | [#2](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/2) |
| --- | --- | --- | --- |

This regressed between 2006-04-10 and 2006-04-11:

<http://bonsai.mozilla.org/cvsquery.cgi?treeid=default&module=all&branch=HEAD&branchtype=match&dir=&file=&filetype=match&who=&whotype=match&sortby=Date&hours=2&date=explicit&mindate=2006-04-10+04&maxdate=2006-04-11+09&cvsroot=%2Fcvsroot>

My guess is a regression form [bug 332927](/bugs/332927), somehow.

This regressed between 2006-04-10 and 2006-04-11:
http://bonsai.mozilla.org/cvsquery.cgi?treeid=default&module=all&branch=HEAD&branchtype=match&dir=&file=&filetype=match&who=&whotype=match&sortby=Date&hours=2&date=explicit&mindate=2006-04-10+04&maxdate=2006-04-11+09&cvsroot=%2Fcvsroot
My guess is a regression form bug 332927, somehow.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Martijn-martijn (martijn-martijn)](https://launchpad.net/~martijn-martijn) wrote on 2008-07-30: |  |  | [#3](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/3) |
| --- | --- | --- | --- |

Maybe some of the comments in [bug 369547](/bugs/369547) are useful for this?

Maybe some of the comments in bug 369547 are useful for this?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-07-30: |  |  | [#4](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/4) |
| --- | --- | --- | --- |

This looks like a parser/content-sink bug. We're getting a ContentAppended on the body aIndexInContainer == 2, coming from nsHTMLContentSink::CloseBody. At this point, the relevant part of the DOM looks like this (containment indicated by nesting):

<body>

    <s>

      #text

    <form>

      <select>

        <optgroup>

          #text

    <form>

      <s>

        #text

        <iframe>

        #text

        <script>

        #text

      <form>

      #text

      <table>

        #text

Thing is, when we last notified (from HandleSavedTokens calling BeginContext), that second form wasn't there, and the third one was. So in other words, we're double-notifying on the entire subtree rooted at that third form, which naturally breaks things.

Somewhere in here we should have had a ContentInserted notification (when we created the <form> containing the <select>), and updated the mNumFlushed for the <body> accordingly.

This looks like a parser/content-sink bug. We're getting a ContentAppended on the body aIndexInContainer == 2, coming from nsHTMLContentSink::CloseBody. At this point, the relevant part of the DOM looks like this (containment indicated by nesting):
<body>
<s>
#text
<form>
<select>
<optgroup>
#text
<form>
<s>
#text
<iframe>
#text
<script>
#text
<form>
#text
<table>
#text
Thing is, when we last notified (from HandleSavedTokens calling BeginContext), that second form wasn't there, and the third one was. So in other words, we're double-notifying on the entire subtree rooted at that third form, which naturally breaks things.
Somewhere in here we should have had a ContentInserted notification (when we created the <form> containing the <select>), and updated the mNumFlushed for the <body> accordingly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jruderman (jruderman)](https://launchpad.net/~jruderman) wrote on 2008-08-03: |  |  | [#5](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/5) |
| --- | --- | --- | --- |

This is a null deref, right? Any reason for it to be security-sensitive?

This is a null deref, right? Any reason for it to be security-sensitive?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-04: |  |  | [#6](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/6) |
| --- | --- | --- | --- |

Given comment 4, it should be possible to trigger other (not just null-deref) crashes here, I think. The frame tree is just badly broken.

Given comment 4, it should be possible to trigger other (not just null-deref) crashes here, I think. The frame tree is just badly broken.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jonas-sicking (jonas-sicking)](https://launchpad.net/~jonas-sicking) wrote on 2008-08-04: |  |  | [#7](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/7) |
| --- | --- | --- | --- |

Given that, i'm gonna set some flags to up the priority on this one.

I'll take this for now, but if someone wants to, feel free to take it. I won't be able to look at this for at least a couple of weeks.

Given that, i'm gonna set some flags to up the priority on this one.
I'll take this for now, but if someone wants to, feel free to take it. I won't be able to look at this for at least a couple of weeks.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jst (jst)](https://launchpad.net/~jst) wrote on 2008-08-04: |  |  | [#8](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/8) |
| --- | --- | --- | --- |

cc:ing Ben Newman who said he could help look into this. Ben, in this case we end up creating two nsSubDocumentFrame's (and other frames too) for a single DOM node, the construction of the frames happens off of notifications from the content sink (ContentAppended() most likely, in either nsHTMLContentSink or nsContentSink). We should only ever get one notification for any given DOM node being inserted into the DOM tree, but in this case we most likely fire two of them, and thus end up with the duplicated frames etc.

Feel free to take this bug if you'll be able to get to it before Jonas does...

cc:ing Ben Newman who said he could help look into this. Ben, in this case we end up creating two nsSubDocumentFrame's (and other frames too) for a single DOM node, the construction of the frames happens off of notifications from the content sink (ContentAppended() most likely, in either nsHTMLContentSink or nsContentSink). We should only ever get one notification for any given DOM node being inserted into the DOM tree, but in this case we most likely fire two of them, and thus end up with the duplicated frames etc.
Feel free to take this bug if you'll be able to get to it before Jonas does...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-04: |  |  | [#9](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/9) |
| --- | --- | --- | --- |

Ben, see comment 4 for some details of when the incorrect notifications happen... the real question is what mutated the DOM without updating the notification indices in the sink.

Ben, see comment 4 for some details of when the incorrect notifications happen... the real question is what mutated the DOM without updating the notification indices in the sink.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-04: |  |  | [#10](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/10) |
| --- | --- | --- | --- |

(In reply to comment #1)

> When loading the testcase (from bugzilla, loading from local file doesn't show

> the crash) I hit a couple of assertions that don't look related, and then I hit

> the assertion:

>

> NS\_ASSERTION(aPresContext->GetPresShell()->GetPrimaryFrameFor(mContent) ==

> this,

> "Shouldn't happen");

>

> in nsSubDocumentFrame::Reflow(), and then after that we cash in

> nsIView::GetViewManager() because this is null.

>

For what it's worth, this particular point of failure can be blamed on the changeset Martijn identified above:

<https://bugzilla.mozilla.org/attachment.cgi?id=217746&action=diff#mozilla/layout/generic/nsFrameFrame.cpp_sec3>

I see no reason not to reinstate the null check, but the problem runs deeper than that.

(In reply to comment #1)
> When loading the testcase (from bugzilla, loading from local file doesn't show
> the crash) I hit a couple of assertions that don't look related, and then I hit
> the assertion:
>
> NS\_ASSERTION(aPresContext->GetPresShell()->GetPrimaryFrameFor(mContent) ==
> this,
> "Shouldn't happen");
>
> in nsSubDocumentFrame::Reflow(), and then after that we cash in
> nsIView::GetViewManager() because this is null.
>
For what it's worth, this particular point of failure can be blamed on the changeset Martijn identified above:
https://bugzilla.mozilla.org/attachment.cgi?id=217746&action=diff#mozilla/layout/generic/nsFrameFrame.cpp\_sec3
I see no reason not to reinstate the null check, but the problem runs deeper than that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jonas-sicking (jonas-sicking)](https://launchpad.net/~jonas-sicking) wrote on 2008-08-04: |  |  | [#11](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/11) |
| --- | --- | --- | --- |

We (or at least I :) ) generally don't add nullchecks in cases when something "is fairly certain never to be null and we know of case where it happens, and if it does much worse things are going to fail anyway". Otherwise we end up nullchecking ourselves to death.

However I'm not sure if that is the case here or not. Obviously it does happen that it is null sometimes :)

We (or at least I :) ) generally don't add nullchecks in cases when something "is fairly certain never to be null and we know of case where it happens, and if it does much worse things are going to fail anyway". Otherwise we end up nullchecking ourselves to death.
However I'm not sure if that is the case here or not. Obviously it does happen that it is null sometimes :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-04: |  |  | [#12](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/12) |
| --- | --- | --- | --- |

(In reply to comment #11)

> if it does much worse things are going to fail anyway

I definitely think this passes the "bigger problems elsewhere" test :) I'm okay with leaving the null check out.

(In reply to comment #11)
> if it does much worse things are going to fail anyway
I definitely think this passes the "bigger problems elsewhere" test :) I'm okay with leaving the null check out.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-06: |  |  | [#13](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/13) |
| --- | --- | --- | --- |

Small update:

Running under gdb sometimes triggers the correct behavior. After a few rounds of binary-search debugging, I isolated the last instruction I can break on without altering normal notification behavior. In other words, if I step over this instruction and then continue, the page renders just fine.

The instruction is mLastNotificationTime = PR\_Now(), at nsContentSink.cpp:1087

Setting mLastNotificationTime to 0, which makes it appear that the last notification hasn't happened since 1970, is a hacky way to suppress the problem. This may or may not represent any progress; in any case, I need to make sure that a notification gets fired deterministically, rather than depending on periodical notifications.

Small update:
Running under gdb sometimes triggers the correct behavior. After a few rounds of binary-search debugging, I isolated the last instruction I can break on without altering normal notification behavior. In other words, if I step over this instruction and then continue, the page renders just fine.
The instruction is mLastNotificationTime = PR\_Now(), at nsContentSink.cpp:1087
Setting mLastNotificationTime to 0, which makes it appear that the last notification hasn't happened since 1970, is a hacky way to suppress the problem. This may or may not represent any progress; in any case, I need to make sure that a notification gets fired deterministically, rather than depending on periodical notifications.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-06: |  |  | [#14](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/14) |
| --- | --- | --- | --- |

You could turn off notifications completely in the sink (there are prefs for it), then trigger notifications by tossing <script> nodes into the DOM. Especially if the script just does |document.body.offsetWidth|

You could turn off notifications completely in the sink (there are prefs for it), then trigger notifications by tossing <script> nodes into the DOM. Especially if the script just does |document.body.offsetWidth|

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Dveditz (dveditz)](https://launchpad.net/~dveditz) wrote on 2008-08-06: |  |  | [#15](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/15) |
| --- | --- | --- | --- |

Looks like this has been assigned a CVE number

<http://nvd.nist.gov/nvd.cfm?cvename=CVE-2008-3444>

Looks like this has been assigned a CVE number
http://nvd.nist.gov/nvd.cfm?cvename=CVE-2008-3444

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Till Ulen (tillulen)](https://launchpad.net/~tillulen) wrote on 2008-08-10: |  |  | [#16](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/16) |
| --- | --- | --- | --- |

Binary package hint: firefox-3.0

CVE-2008-3444 description:

"The content layout component in Mozilla Firefox 3.0 and 3.0.1 allows remote attackers to cause a denial of service (NULL pointer dereference and application crash) via a crafted but well-formed web page that contains "a simple set of legitimate HTML tags." "

<http://nvd.nist.gov/nvd.cfm?cvename=CVE-2008-3444>

More information:

<http://blog.mozilla.com/security/2008/07/30/low-risk-denial-of-service-in-firefox/>

<https://bugzilla.mozilla.org/show_bug.cgi?id=448564> (private bug)

Binary package hint: firefox-3.0
CVE-2008-3444 description:
"The content layout component in Mozilla Firefox 3.0 and 3.0.1 allows remote attackers to cause a denial of service (NULL pointer dereference and application crash) via a crafted but well-formed web page that contains "a simple set of legitimate HTML tags." "
http://nvd.nist.gov/nvd.cfm?cvename=CVE-2008-3444
More information:
http://blog.mozilla.com/security/2008/07/30/low-risk-denial-of-service-in-firefox/
https://bugzilla.mozilla.org/show\_bug.cgi?id=448564 (private bug)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Till Ulen (tillulen)](https://launchpad.net/~tillulen) wrote on 2008-08-10: |  |  | [#17](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/17) |
| --- | --- | --- | --- |

Adding CVE reference: CVE-2008-3444

Adding CVE reference: CVE-2008-3444

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-14: |  |  | [#18](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/18) |
| --- | --- | --- | --- |

Created attachment 333828

proposed patch with (very tentative) test cases

The DOM mutation that wasn't being followed by a notification was the call to mSink->InsertChildAt in SinkContext::OpenContainer. Mimicking other parts of the content sink code, I added a call to DidAddContent at the end of OpenContainer. Then I realized that DidAddContent could be made to handle NotifyAppend as well as NotifyInsert. With that change, several other chunks of code became redundant (specifically, code calling both NotifyAppend and OpenContainer/DidAddContent). The only sticky part was in OpenFrameset, but I moved that logic into the switch statement at the end of OpenContainer.

Since NotifyAppend and NotifyInsert are now called in OpenContainer, CloseContainer has less work to do. It still calls DidAddContent, but this call rarely if ever results in a notification. This is a good thing, I think, because the order of CloseContainer calls is the reverse of the order in which we want to be notifying. If I am not mistaken, the purpose of mNotifyLevel was to reduce the number of notifications stemming from these CloseContainer calls, so I believe it's now safe to remove the mNotifyLevel altogether.

If any of my assumptions are off the mark, those last two paragraphs may be complete nonsense. I look forward to your feedback :)

One big question: I have no idea how to test this stuff, because I'm not sure how to detect double rendering using mochitest, given that the DOM gets constructed just fine. Nevertheless, my patch includes the mochitests that I used during my debugging.

Created attachment 333828
proposed patch with (very tentative) test cases
The DOM mutation that wasn't being followed by a notification was the call to mSink->InsertChildAt in SinkContext::OpenContainer. Mimicking other parts of the content sink code, I added a call to DidAddContent at the end of OpenContainer. Then I realized that DidAddContent could be made to handle NotifyAppend as well as NotifyInsert. With that change, several other chunks of code became redundant (specifically, code calling both NotifyAppend and OpenContainer/DidAddContent). The only sticky part was in OpenFrameset, but I moved that logic into the switch statement at the end of OpenContainer.
Since NotifyAppend and NotifyInsert are now called in OpenContainer, CloseContainer has less work to do. It still calls DidAddContent, but this call rarely if ever results in a notification. This is a good thing, I think, because the order of CloseContainer calls is the reverse of the order in which we want to be notifying. If I am not mistaken, the purpose of mNotifyLevel was to reduce the number of notifications stemming from these CloseContainer calls, so I believe it's now safe to remove the mNotifyLevel altogether.
If any of my assumptions are off the mark, those last two paragraphs may be complete nonsense. I look forward to your feedback :)
One big question: I have no idea how to test this stuff, because I'm not sure how to detect double rendering using mochitest, given that the DOM gets constructed just fine. Nevertheless, my patch includes the mochitests that I used during my debugging.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mrbkap (mrbkap)](https://launchpad.net/~mrbkap) wrote on 2008-08-14: |  |  | [#19](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/19) |
| --- | --- | --- | --- |

Ben, it sounds like you want to test this using a reftest instead of a mochitest.

Ben, it sounds like you want to test this using a reftest instead of a mochitest.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jonas-sicking (jonas-sicking)](https://launchpad.net/~jonas-sicking) wrote on 2008-08-14: |  |  | [#20](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/20) |
| --- | --- | --- | --- |

I'd say you should test with both, while watching out for any assertions that this might trigger. Not sure if we have any good assertions in there currently, or if new ones should be added.

I'd say you should test with both, while watching out for any assertions that this might trigger. Not sure if we have any good assertions in there currently, or if new ones should be added.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-14: |  |  | [#21](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/21) |
| --- | --- | --- | --- |

(In reply to comment #17)

> Ben, it sounds like you want to test this using a reftest instead of a

> mochitest.

From <http://developer.mozilla.org/en/docs/Creating_reftest-based_unit_tests>:

"So, if the effect of complex markup is being tested, put that complex markup into a page and create another page that uses simple markup to achieve the same visual effect. Reftest will then compare them and verify whether they produce the same visual construct."

That's just what I need. Thanks!

(In reply to comment #17)
> Ben, it sounds like you want to test this using a reftest instead of a
> mochitest.
From http://developer.mozilla.org/en/docs/Creating\_reftest-based\_unit\_tests:
"So, if the effect of complex markup is being tested, put that complex markup into a page and create another page that uses simple markup to achieve the same visual effect. Reftest will then compare them and verify whether they produce the same visual construct."
That's just what I need. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jonas-sicking (jonas-sicking)](https://launchpad.net/~jonas-sicking) wrote on 2008-08-14: |  |  | [#22](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/22) |
| --- | --- | --- | --- |

Ah, sorry, to write a regression test using reftest sounds like the right choise. But to make sure you don't regress anything else follow the steps in my last comment :)

Ah, sorry, to write a regression test using reftest sounds like the right choise. But to make sure you don't regress anything else follow the steps in my last comment :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-19: |  |  | [#23](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/23) |
| --- | --- | --- | --- |

This can be mochitested too, I bet. getElementsByTagName("iframe") up front, get its length, then finish parsing, then get its length again. With the old code it might well be off....

This can be mochitested too, I bet. getElementsByTagName("iframe") up front, get its length, then finish parsing, then get its length again. With the old code it might well be off....

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-19: |  |  | [#24](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/24) |
| --- | --- | --- | --- |

I'll try to get to this review tomorrow.

I'll try to get to this review tomorrow.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-26: |  |  | [#25](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/25) |
| --- | --- | --- | --- |

Gah. Sorry for the lag... So in this case, mStack[mStackPos - 2].mInsertionPoint != -1 but mStack[mStackPos-2].mNumFlushed > mStack[mStackPos - 2].mInsertionPoint ? That's the only way I can see for the notifications to get confused by the InsertChildAt call, right?

Gah. Sorry for the lag... So in this case, mStack[mStackPos - 2].mInsertionPoint != -1 but mStack[mStackPos-2].mNumFlushed > mStack[mStackPos - 2].mInsertionPoint ? That's the only way I can see for the notifications to get confused by the InsertChildAt call, right?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-26: |  |  | [#26](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/26) |
| --- | --- | --- | --- |

So looking at the patch, DidAddContent will now eagerly notify any time mNumFlushed < GetChildCount(). That's wrong. We want to limit the eager notification to the insert case, and in the usual append case we want to not do it. I suspect that this patch as written leads to a significant pageload regression. The fact that the "walk up the tree and notify" code in CloseContainer could be removed is a result of this eager notification, I assume?

Also, the check for IsTimeToNotify() needs to stay in CloseContainer(), ideally: we don't really want to be constructing frames as we open containers, but rather as we close them. Again, for performance.

Did the notifications on body/frameset get to go away because DidAddContent is now being called on those opens instead or something?

Thinking back to the cause of this bug, is the problem that we end up flushing out the sink or notifying between the OpenContainer (which adds the node to the DOM) and the CloseContainer (which notifies the insert), and as a result flush totally bogus information?

It seems like the right solution would be to notify eagerly on insert (either when inserting before mNumFlushed, or in general; the latter is probably easier since it doesn't involve keeping track of whether you still need to notify on the insert), not to switch to eager notifications for everything.

So looking at the patch, DidAddContent will now eagerly notify any time mNumFlushed < GetChildCount(). That's wrong. We want to limit the eager notification to the insert case, and in the usual append case we want to not do it. I suspect that this patch as written leads to a significant pageload regression. The fact that the "walk up the tree and notify" code in CloseContainer could be removed is a result of this eager notification, I assume?
Also, the check for IsTimeToNotify() needs to stay in CloseContainer(), ideally: we don't really want to be constructing frames as we open containers, but rather as we close them. Again, for performance.
Did the notifications on body/frameset get to go away because DidAddContent is now being called on those opens instead or something?
Thinking back to the cause of this bug, is the problem that we end up flushing out the sink or notifying between the OpenContainer (which adds the node to the DOM) and the CloseContainer (which notifies the insert), and as a result flush totally bogus information?
It seems like the right solution would be to notify eagerly on insert (either when inserting before mNumFlushed, or in general; the latter is probably easier since it doesn't involve keeping track of whether you still need to notify on the insert), not to switch to eager notifications for everything.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-27: |  |  | [#27](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/27) |
| --- | --- | --- | --- |

(In reply to comment #24)

> It seems like the right solution would be to notify eagerly on insert (either

> when inserting before mNumFlushed, or in general; the latter is probably easier

> since it doesn't involve keeping track of whether you still need to notify on

> the insert), not to switch to eager notifications for everything.

Notifying after InsertChildAt in OpenContainer (but not after AppendChildTo) almost works, except that notifications do not happen for children of the inserted child. I assume this is because the children haven't been appended yet, because the notification is happening in OpenContainer. I need to figure out why the parent of the InsertChildAt call appears fully flushed when it gets closed in CloseContainer.

(In reply to comment #24)
> It seems like the right solution would be to notify eagerly on insert (either
> when inserting before mNumFlushed, or in general; the latter is probably easier
> since it doesn't involve keeping track of whether you still need to notify on
> the insert), not to switch to eager notifications for everything.
Notifying after InsertChildAt in OpenContainer (but not after AppendChildTo) almost works, except that notifications do not happen for children of the inserted child. I assume this is because the children haven't been appended yet, because the notification is happening in OpenContainer. I need to figure out why the parent of the InsertChildAt call appears fully flushed when it gets closed in CloseContainer.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-27: |  |  | [#28](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/28) |
| --- | --- | --- | --- |

Hmm. Yeah, if we close an already-notified-on child we need to notify on its kids. There's code in CloseContainer that does that now, and would need to be called even in this situation.

Hmm. Yeah, if we close an already-notified-on child we need to notify on its kids. There's code in CloseContainer that does that now, and would need to be called even in this situation.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-27: |  |  | [#29](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/29) |
| --- | --- | --- | --- |

Update / note to self. Looks like we've lost the InsertChildAt insertion point by the time we FlushTags in CloseBody. In other words, we can tell that the parent has a new child, but not which child is new (or, rather, we assume we appended and thus double-notify for the last child). The problem is that mCurrentContext has changed since the insertion happened, and the stack node corresponding to the parent in the new context is distinct from the stack node whose insertion point we updated when we called InsertChildAt. The mContent fields of the two stack nodes point to the same object, but the mInsertionPoint fields are inconsistent.

Update / note to self. Looks like we've lost the InsertChildAt insertion point by the time we FlushTags in CloseBody. In other words, we can tell that the parent has a new child, but not which child is new (or, rather, we assume we appended and thus double-notify for the last child). The problem is that mCurrentContext has changed since the insertion happened, and the stack node corresponding to the parent in the new context is distinct from the stack node whose insertion point we updated when we called InsertChildAt. The mContent fields of the two stack nodes point to the same object, but the mInsertionPoint fields are inconsistent.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-27: |  |  | [#30](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/30) |
| --- | --- | --- | --- |

(In reply to comment #27)

> Update / note to self. Looks like we've lost the InsertChildAt insertion point

> by the time we FlushTags in CloseBody. In other words, we can tell that the

> parent has a new child, but not which child is new (or, rather, we assume we

> appended and thus double-notify for the last child). The problem is that

> mCurrentContext has changed since the insertion happened, and the stack node

> corresponding to the parent in the new context is distinct from the stack node

> whose insertion point we updated when we called InsertChildAt. The mContent

> fields of the two stack nodes point to the same object, but the mInsertionPoint

> fields are inconsistent.

Is it reasonable to have more than one context whose stack contains a particular node? If not, then I need to figure out how the duplication happened. If so, then it seems problematic that the mContent fields of different nodes are aliases but the integer fields are not.

(In reply to comment #27)
> Update / note to self. Looks like we've lost the InsertChildAt insertion point
> by the time we FlushTags in CloseBody. In other words, we can tell that the
> parent has a new child, but not which child is new (or, rather, we assume we
> appended and thus double-notify for the last child). The problem is that
> mCurrentContext has changed since the insertion happened, and the stack node
> corresponding to the parent in the new context is distinct from the stack node
> whose insertion point we updated when we called InsertChildAt. The mContent
> fields of the two stack nodes point to the same object, but the mInsertionPoint
> fields are inconsistent.
Is it reasonable to have more than one context whose stack contains a particular node? If not, then I need to figure out how the duplication happened. If so, then it seems problematic that the mContent fields of different nodes are aliases but the integer fields are not.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-27: |  |  | [#31](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/31) |
| --- | --- | --- | --- |

I would have thought we'd flush all pending notifications when switching contexts...

And yes, you can definitely have multiple contexts which all have the <body> on the stack. Peter, Jonas, or Blake may know more; I've never really understood the details of the sinkcontext stuff, to be honest.

I would have thought we'd flush all pending notifications when switching contexts...
And yes, you can definitely have multiple contexts which all have the <body> on the stack. Peter, Jonas, or Blake may know more; I've never really understood the details of the sinkcontext stuff, to be honest.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-27: |  |  | [#32](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/32) |
| --- | --- | --- | --- |

Created attachment 335807

new patch, same lousy test cases

This patch should be a lot easier to review. The trick was to back-propagate mInsertionPoint when closing a context. mNumFlushed was already getting propagated back, but no such love for mInsertionPoint. This exposed a bug in FlushTags: the inserted child is not necessarily the next node on the stack, but since we know the insertion point, it's easy enough to determine which child was actually inserted.

Going to start working on proper reftests as soon as I post this patch.

Created attachment 335807
new patch, same lousy test cases
This patch should be a lot easier to review. The trick was to back-propagate mInsertionPoint when closing a context. mNumFlushed was already getting propagated back, but no such love for mInsertionPoint. This exposed a bug in FlushTags: the inserted child is not necessarily the next node on the stack, but since we know the insertion point, it's easy enough to determine which child was actually inserted.
Going to start working on proper reftests as soon as I post this patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#33](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/33) |
| --- | --- | --- | --- |

Created attachment 335828

same patch, spiffy new reftests

2 reftests, 1 crashtest

Created attachment 335828
same patch, spiffy new reftests
2 reftests, 1 crashtest

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#34](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/34) |
| --- | --- | --- | --- |

(In reply to comment #30)

> This patch should be a lot easier to review.

s/should be a lot easier to review/is considerably simpler/

(In reply to comment #30)
> This patch should be a lot easier to review.
s/should be a lot easier to review/is considerably simpler/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-28: |  |  | [#35](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/35) |
| --- | --- | --- | --- |

Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or are we guaranteed to have notified on all but one of them?

Also, when would the child on the stack not be the one at the insertion point?

Here's what I worry about. The following sequence of events:

1) Append two kids. Notify on them.

2) Insert a kid at position 1 (between the two). Don't notify.

3) Append another kid

Can this happen? Or are we guaranteed to notify on the inserted kids if mInsertionPoint becomes -1 again?

I really wish someone who knows this insertion point stuff better would chime in here... ;)

Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or are we guaranteed to have notified on all but one of them?
Also, when would the child on the stack not be the one at the insertion point?
Here's what I worry about. The following sequence of events:
1) Append two kids. Notify on them.
2) Insert a kid at position 1 (between the two). Don't notify.
3) Append another kid
Can this happen? Or are we guaranteed to notify on the inserted kids if mInsertionPoint becomes -1 again?
I really wish someone who knows this insertion point stuff better would chime in here... ;)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#36](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/36) |
| --- | --- | --- | --- |

(In reply to comment #33)

> Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or

> are we guaranteed to have notified on all but one of them?

Bad times. I suspect the author of the content sink intended to make such a guarantee, but it's implicit at best. Code like the following appears in multiple places:

if (parent.numFlushed < childCount) {

        notify(parent, child, ...);

        parent.numFlushed = childCount;

    }

This assumes childCount - parent.numFlushed <= 1, since the notification only flushes one child. This assumption probably does warrant investigation, even if it's not directly responsible for the current bug.

> Also, when would the child on the stack not be the one at the insertion point?

As far as I can tell, this would never happen if HTMLContentSink::EndContext called FlushTags, but it doesn't, so it's possible for nodes to get inserted in a new context but notified only after the context is closed. Such nodes won't be on the stack in the old context, but their parents might be.

> Here's what I worry about. The following sequence of events:

>

> 1) Append two kids. Notify on them.

> 2) Insert a kid at position 1 (between the two). Don't notify.

> 3) Append another kid

>

> Can this happen? Or are we guaranteed to notify on the inserted kids if

> mInsertionPoint becomes -1 again?

I share this concern. There may be an argument that two children are never inserted/appended into the same parent without a notification, but we are definitely hosed if that happens, since we don't keep track of enough information to recover. If we want to enforce this invariant explicitly, we have to do it at insertion-time (when we're about to insert/append a child, make sure the parent is fully flushed).

(In reply to comment #33)
> Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or
> are we guaranteed to have notified on all but one of them?
Bad times. I suspect the author of the content sink intended to make such a guarantee, but it's implicit at best. Code like the following appears in multiple places:
if (parent.numFlushed < childCount) {
notify(parent, child, ...);
parent.numFlushed = childCount;
}
This assumes childCount - parent.numFlushed <= 1, since the notification only flushes one child. This assumption probably does warrant investigation, even if it's not directly responsible for the current bug.
> Also, when would the child on the stack not be the one at the insertion point?
As far as I can tell, this would never happen if HTMLContentSink::EndContext called FlushTags, but it doesn't, so it's possible for nodes to get inserted in a new context but notified only after the context is closed. Such nodes won't be on the stack in the old context, but their parents might be.
> Here's what I worry about. The following sequence of events:
>
> 1) Append two kids. Notify on them.
> 2) Insert a kid at position 1 (between the two). Don't notify.
> 3) Append another kid
>
> Can this happen? Or are we guaranteed to notify on the inserted kids if
> mInsertionPoint becomes -1 again?
I share this concern. There may be an argument that two children are never inserted/appended into the same parent without a notification, but we are definitely hosed if that happens, since we don't keep track of enough information to recover. If we want to enforce this invariant explicitly, we have to do it at insertion-time (when we're about to insert/append a child, make sure the parent is fully flushed).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#37](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/37) |
| --- | --- | --- | --- |

(In reply to comment #33)

> Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or

> are we guaranteed to have notified on all but one of them?

I added a method to the SinkContext::Node struct to handle all insertions/appendings and also to check whether multiple children are ever inserted or appended without first flushing the parent. We append multiple children without flushing quite frequently, which seems okay because we can later assume all the unflushed children are at the end of the child list. But your question still stands: do multiple \*insertions\* ever happen without intervening notifications? I don't have direct evidence one way or the other, but it would be easy to prevent multiple insertions preemptively.

Maybe someone familiar with the content sink can comment on the necessity of such preemptive measures...

(In reply to comment #33)
> Hmm. What happens if we have inserted multiple kids at mInsertionPoint? Or
> are we guaranteed to have notified on all but one of them?
I added a method to the SinkContext::Node struct to handle all insertions/appendings and also to check whether multiple children are ever inserted or appended without first flushing the parent. We append multiple children without flushing quite frequently, which seems okay because we can later assume all the unflushed children are at the end of the child list. But your question still stands: do multiple \*insertions\* ever happen without intervening notifications? I don't have direct evidence one way or the other, but it would be easy to prevent multiple insertions preemptively.
Maybe someone familiar with the content sink can comment on the necessity of such preemptive measures...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#38](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/38) |
| --- | --- | --- | --- |

Created attachment 335944

decomposed SinkContext::Node::Add

Simplify/centralize child addition logic. Add an assertion to ensure we only insert into fully flushed nodes.

Created attachment 335944
decomposed SinkContext::Node::Add
Simplify/centralize child addition logic. Add an assertion to ensure we only insert into fully flushed nodes.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#39](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/39) |
| --- | --- | --- | --- |

Created attachment 335973

FlushTags in HTMLContentSink::EndContext

Now calling FlushTags in EndContext, both to be more symmetrical with BeginContext (call FlushTags whenever switching contexts) and to avoid having to worry about flushing children not on the stack in FlushTags and DidAddContent. Assertions now verify that inserted children are in the expected place on the stack.

Also added another reftest to catch a double rendering bug that I concocted earlier this afternoon.

Created attachment 335973
FlushTags in HTMLContentSink::EndContext
Now calling FlushTags in EndContext, both to be more symmetrical with BeginContext (call FlushTags whenever switching contexts) and to avoid having to worry about flushing children not on the stack in FlushTags and DidAddContent. Assertions now verify that inserted children are in the expected place on the stack.
Also added another reftest to catch a double rendering bug that I concocted earlier this afternoon.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#40](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/40) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/40/%2Bdownload) (12.6 KiB)

Comment on attachment 335973

FlushTags in HTMLContentSink::EndContext

><html><body><pre style="word-wrap: break-word; white-space: pre-wrap;">diff --git a/content/html/document/crashtests/448564.html b/content/html/document/crashtests/448564.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/crashtests/448564.html

>@@ -0,0 +1,7 @@

>+<s>

>+<form>a</form>

>+<iframe></iframe>

>+<script src=a></script>

>+<form></form>

>+<table>

>+<optgroup>

>\ No newline at end of file

>diff --git a/content/html/document/crashtests/crashtests.list b/content/html/document/crashtests/crashtests.list

>--- a/content/html/document/crashtests/crashtests.list

>+++ b/content/html/document/crashtests/crashtests.list

>@@ -1,3 +1,4 @@ load 388183-1.html

> load 388183-1.html

> load 395340-1.html

> load 407053.html

>+load 448564.html

>diff --git a/content/html/document/reftests/[bug448564](/bugs/448564)-1\_malformed.html b/content/html/document/reftests/[bug448564](/bugs/448564)-1\_malformed.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/reftests/[bug448564](/bugs/448564)-1\_malformed.html

>@@ -0,0 +1,11 @@

>+<html>

>+<body>

>+ <script src=></script>

>+ <b>

>+ <form>a</form>

>+ <form>b</form>

>+ <table>

>+ <optgroup></optgroup>

>+ </b>

>+</body>

>+</html>

>\ No newline at end of file

>diff --git a/content/html/document/reftests/[bug448564](/bugs/448564)-1\_well-formed.html b/content/html/document/reftests/[bug448564](/bugs/448564)-1\_well-formed.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/reftests/[bug448564](/bugs/448564)-1\_well-formed.html

>@@ -0,0 +1,13 @@

>+<html>

>+<body>

>+ <b>a</b>

>+ <form>

>+ <select>

>+ <optgroup />

>+ </select>

>+ </form>

>+ <form>

>+ <b>b</b>

>+ </form>

>+</body>

>+</html>

>\ No newline at end of file

>diff --git a/content/html/document/reftests/[bug448564](/bugs/448564)-2\_malformed.html b/content/html/document/reftests/[bug448564](/bugs/448564)-2\_malformed.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/reftests/[bug448564](/bugs/448564)-2\_malformed.html

>@@ -0,0 +1,11 @@

>+<html>

>+<body>

>+ <s>

>+ <form>a</form>

>+ <iframe></iframe>

>+ <script src=a></script>

>+ <form></form>

>+ <table>

>+ <optgroup>

>+</body>

>+</html>

>\ No newline at end of file

>diff --git a/content/html/document/reftests/[bug448564](/bugs/448564)-2\_well-formed.html b/content/html/document/reftests/[bug448564](/bugs/448564)-2\_well-formed.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/reftests/[bug448564](/bugs/448564)-2\_well-formed.html

>@@ -0,0 +1,15 @@

>+<html>

>+<body>

>+ <form>

>+ <select>

>+ <optgroup />

>+ </select>

>+ </form>

>+ <form>

>+ <s>

>+ a

>+ <iframe></iframe>

>+ </s>

>+ </form>

>+</body>

>+</html>

>\ No newline at end of file

>diff --git a/content/html/document/reftests/[bug448564](/bugs/448564)-3\_malformed.html b/content/html/document/reftests/[bug448564](/bugs/448564)-3\_malformed.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/reftests/[bug448564](/bugs/448564)-3\_malformed.html

>@@ -0,0 +1,4 @@

>+<table>

>+ <th>head</th>

>+ <optgroup>b</optgroup>

>+</table>

>\ No newline at end of file

>diff --git a/content/html/document/reftests/[bug448564](/bugs/448564)-3\_well-formed.html b/content/html/document/reftests/[bug448564](/bugs/448564)-3\_well-formed.html

>new file mode 100644

>--- /dev/null

>+++ b/content/html/document/...

Comment on attachment 335973
FlushTags in HTMLContentSink::EndContext
><html><body><pre style="word-wrap: break-word; white-space: pre-wrap;">diff --git a/content/html/document/crashtests/448564.html b/content/html/document/crashtests/448564.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/crashtests/448564.html
>@@ -0,0 +1,7 @@
>+<s>
>+<form>a</form>
>+<iframe></iframe>
>+<script src=a></script>
>+<form></form>
>+<table>
>+<optgroup>
>\ No newline at end of file
>diff --git a/content/html/document/crashtests/crashtests.list b/content/html/document/crashtests/crashtests.list
>--- a/content/html/document/crashtests/crashtests.list
>+++ b/content/html/document/crashtests/crashtests.list
>@@ -1,3 +1,4 @@ load 388183-1.html
> load 388183-1.html
> load 395340-1.html
> load 407053.html
>+load 448564.html
>diff --git a/content/html/document/reftests/bug448564-1\_malformed.html b/content/html/document/reftests/bug448564-1\_malformed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/bug448564-1\_malformed.html
>@@ -0,0 +1,11 @@
>+<html>
>+<body>
>+ <script src=></script>
>+ <b>
>+ <form>a</form>
>+ <form>b</form>
>+ <table>
>+ <optgroup></optgroup>
>+ </b>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/bug448564-1\_well-formed.html b/content/html/document/reftests/bug448564-1\_well-formed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/bug448564-1\_well-formed.html
>@@ -0,0 +1,13 @@
>+<html>
>+<body>
>+ <b>a</b>
>+ <form>
>+ <select>
>+ <optgroup />
>+ </select>
>+ </form>
>+ <form>
>+ <b>b</b>
>+ </form>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/bug448564-2\_malformed.html b/content/html/document/reftests/bug448564-2\_malformed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/bug448564-2\_malformed.html
>@@ -0,0 +1,11 @@
>+<html>
>+<body>
>+ <s>
>+ <form>a</form>
>+ <iframe></iframe>
>+ <script src=a></script>
>+ <form></form>
>+ <table>
>+ <optgroup>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/bug448564-2\_well-formed.html b/content/html/document/reftests/bug448564-2\_well-formed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/bug448564-2\_well-formed.html
>@@ -0,0 +1,15 @@
>+<html>
>+<body>
>+ <form>
>+ <select>
>+ <optgroup />
>+ </select>
>+ </form>
>+ <form>
>+ <s>
>+ a
>+ <iframe></iframe>
>+ </s>
>+ </form>
>+</body>
>+</html>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/bug448564-3\_malformed.html b/content/html/document/reftests/bug448564-3\_malformed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/bug448564-3\_malformed.html
>@@ -0,0 +1,4 @@
>+<table>
>+ <th>head</th>
>+ <optgroup>b</optgroup>
>+</table>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/bug448564-3\_well-formed.html b/content/html/document/reftests/bug448564-3\_well-formed.html
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/bug448564-3\_well-formed.html
>@@ -0,0 +1,8 @@
>+<form>
>+ <select>
>+ <optgroup>b</optgroup>
>+ </select>
>+</form>
>+<table>
>+ <th>head</th>
>+</table>
>\ No newline at end of file
>diff --git a/content/html/document/reftests/reftests.list b/content/html/document/reftests/reftests.list
>new file mode 100644
>--- /dev/null
>+++ b/content/html/document/reftests/reftests.list
>@@ -0,0 +1,3 @@
>+== bug448564-1\_well-formed.html bug448564-1\_malformed.html
>+== bug448564-2\_well-formed.html bug448564-2\_malformed.html
>+== bug448564-3\_well-formed.html bug448564-3\_malformed.html
>diff --git a/content/html/document/src/nsHTMLContentSink.cpp b/content/html/document/src/nsHTMLContentSink.cpp
>--- a/content/html/document/src/nsHTMLContentSink.cpp
>+++ b/content/html/document/src/nsHTMLContentSink.cpp
>@@ -368,16 +368,18 @@ public:
> nsCOMPtr<nsIContent> mLastTextNode;
> PRInt32 mLastTextNodeSize;
>
> struct Node {
> nsHTMLTag mType;
> nsGenericHTMLElement\* mContent;
> PRUint32 mNumFlushed;
> PRInt32 mInsertionPoint;
>+
>+ nsIContent \*Add(nsIContent \*child);
> };
>
> Node\* mStack;
> PRInt32 mStackSize;
> PRInt32 mStackPos;
>
> PRUnichar\* mText;
> PRInt32 mTextLength;
>@@ -725,20 +727,22 @@ SinkContext::DidAddContent(nsIContent\* a
> SINK\_TRACE(gSinkLogModuleInfo, SINK\_TRACE\_REFLOW,
> ("SinkContext::DidAddContent: Insertion notification for "
> "parent=%s at position=%d and stackPos=%d",
> str.get(), mStack[mStackPos - 1].mInsertionPoint - 1,
> mStackPos - 1));
> }
> #endif
>
>- mSink->NotifyInsert(parent, aContent,
>- mStack[mStackPos - 1].mInsertionPoint - 1);
>+ PRInt32 childIndex = mStack[mStackPos - 1].mInsertionPoint - 1;
>+ NS\_ASSERTION(parent->GetChildAt(childIndex) == aContent,
>+ "Flushing the wrong child.");
>+ mSink->NotifyInsert(parent, aContent, childIndex);
> mStack[mStackPos - 1].mNumFlushed = parent->GetChildCount();
>- } else if (mSink->IsTimeToNotify()) {
>+ } else if (false && mSink->IsTimeToNotify()) {
> SINK\_TRACE(gSinkLogModuleInfo, SINK\_TRACE\_REFLOW,
> ("SinkContext::DidAddContent: Notification as a result of the "
> "interval expiring; backoff count: %d", mSink->mBackoffCount));
> FlushTags();
> }
> }
>
> nsresult
>@@ -830,25 +834,17 @@ SinkContext::OpenContainer(const nsIPars
> break;
> default:
> break;
> }
>
> rv = mSink->AddAttributes(aNode, content);
> MaybeSetForm(content, nodeType, mSink);
>
>- nsGenericHTMLElement\* parent = mStack[mStackPos - 2].mContent;
>-
>- if (mStack[mStackPos - 2].mInsertionPoint != -1) {
>- parent->InsertChildAt(content,
>- mStack[mStackPos - 2].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(content, PR\_FALSE);
>- }
>+ mStack[mStackPos - 2].Add(content);
>
> NS\_ENSURE\_SUCCESS(rv, rv);
>
> if (mSink->IsMonolithicContainer(nodeType)) {
> mSink->mInMonolithicContainer++;
> }
>
> // Special handling for certain tags
>@@ -895,16 +891,29 @@ SinkContext::HaveNotifiedForCurrentConte
> SinkContext::HaveNotifiedForCurrentContent() const
> {
> if (0 < mStackPos) {
> nsIContent\* parent = mStack[mStackPos - 1].mContent;
> return mStack[mStackPos-1].mNumFlushed == parent->GetChildCount();
> }
>
> return PR\_TRUE;
>+}
>+
>+nsIContent \*
>+SinkContext::Node::Add(nsIContent \*child)
>+{
>+ if (mInsertionPoint != -1) {
>+ NS\_ASSERTION(mNumFlushed == mContent->GetChildCount(),
>+ "Inserting multiple children without flushing.");
>+ mContent->InsertChildAt(child, mInsertionPoint++, PR\_FALSE);
>+ } else {
>+ mContent->AppendChildTo(child, PR\_FALSE);
>+ }
>+ return child;
> }
>
> nsresult
> SinkContext::CloseContainer(const nsHTMLTag aTag, PRBool aMalformed)
> {
> nsresult result = NS\_OK;
>
> // Flush any collected text content. Release the last text
>@@ -1148,29 +1157,18 @@ SinkContext::AddLeaf(const nsIParserNode
>
> nsresult
> SinkContext::AddLeaf(nsGenericHTMLElement\* aContent)
> {
> NS\_ASSERTION(mStackPos > 0, "leaf w/o container");
> if (mStackPos <= 0) {
> return NS\_ERROR\_FAILURE;
> }
>-
>- nsGenericHTMLElement\* parent = mStack[mStackPos - 1].mContent;
>-
>- // If the parent has an insertion point, insert rather than append.
>- if (mStack[mStackPos - 1].mInsertionPoint != -1) {
>- parent->InsertChildAt(aContent,
>- mStack[mStackPos - 1].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(aContent, PR\_FALSE);
>- }
>-
>- DidAddContent(aContent);
>+
>+ DidAddContent(mStack[mStackPos - 1].Add(aContent));
>
> #ifdef DEBUG
> if (SINK\_LOG\_TEST(gSinkLogModuleInfo, SINK\_ALWAYS\_REFLOW)) {
> mSink->ForceReflow();
> }
> #endif
>
> return NS\_OK;
>@@ -1196,35 +1194,26 @@ SinkContext::AddComment(const nsIParserN
>
> comment->SetText(aNode.GetText(), PR\_FALSE);
>
> NS\_ASSERTION(mStackPos > 0, "stack out of bounds");
> if (mStackPos <= 0) {
> return NS\_ERROR\_FAILURE;
> }
>
>- nsGenericHTMLElement\* parent;
>- if (!mSink->mBody && !mSink->mFrameset && mSink->mHead) {
>- // XXXbz but this will make DidAddContent use the wrong parent for
>- // the notification! That seems so bogus it's not even funny.
>- parent = mSink->mHead;
>- } else {
>- parent = mStack[mStackPos - 1].mContent;
>+ {
>+ Node &parentNode = mStack[mStackPos - 1];
>+ nsGenericHTMLElement \*parent = parentNode.mContent;
>+ if (!mSink->mBody && !mSink->mFrameset && mSink->mHead)
>+ // XXXbz but this will make DidAddContent use the wrong parent for
>+ // the notification! That seems so bogus it's not even funny.
>+ parentNode.mContent = mSink->mHead;
>+ DidAddContent(parentNode.Add(comment));
>+ parentNode.mContent = parent;
> }
>-
>- // If the parent has an insertion point, insert rather than append.
>- if (mStack[mStackPos - 1].mInsertionPoint != -1) {
>- parent->InsertChildAt(comment,
>- mStack[mStackPos - 1].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(comment, PR\_FALSE);
>- }
>-
>- DidAddContent(comment);
>
> #ifdef DEBUG
> if (SINK\_LOG\_TEST(gSinkLogModuleInfo, SINK\_ALWAYS\_REFLOW)) {
> mSink->ForceReflow();
> }
> #endif
>
> return rv;
>@@ -1380,20 +1369,21 @@ SinkContext::FlushTags()
> SINK\_TRACE(gSinkLogModuleInfo, SINK\_TRACE\_REFLOW,
> ("SinkContext::FlushTags: tag=%s from newindex=%d at "
> "stackPos=%d", tagStr,
> mStack[stackPos].mNumFlushed, stackPos));
> }
> #endif
> if ((mStack[stackPos].mInsertionPoint != -1) &&
> (mStackPos > (stackPos + 1))) {
>+ PRInt32 childIndex = mStack[stackPos].mInsertionPoint - 1;
> nsIContent\* child = mStack[stackPos + 1].mContent;
>- mSink->NotifyInsert(content,
>- child,
>- mStack[stackPos].mInsertionPoint - 1);
>+ NS\_ASSERTION(content->GetChildAt(childIndex) == child,
>+ "Flushing the wrong child.");
>+ mSink->NotifyInsert(content, child, childIndex);
> } else {
> mSink->NotifyAppend(content, mStack[stackPos].mNumFlushed);
> }
>
> flushed = PR\_TRUE;
> }
>
> mStack[stackPos].mNumFlushed = childCount;
>@@ -1484,28 +1474,19 @@ SinkContext::FlushText(PRBool\* aDidFlush
> mTextLength = 0;
>
> // Add text to its parent
> NS\_ASSERTION(mStackPos > 0, "leaf w/o container");
> if (mStackPos <= 0) {
> return NS\_ERROR\_FAILURE;
> }
>
>- nsGenericHTMLElement\* parent = mStack[mStackPos - 1].mContent;
>- if (mStack[mStackPos - 1].mInsertionPoint != -1) {
>- parent->InsertChildAt(mLastTextNode,
>- mStack[mStackPos - 1].mInsertionPoint++,
>- PR\_FALSE);
>- } else {
>- parent->AppendChildTo(mLastTextNode, PR\_FALSE);
>- }
>+ DidAddContent(mStack[mStackPos - 1].Add(mLastTextNode));
>
> didFlush = PR\_TRUE;
>-
>- DidAddContent(mLastTextNode);
> }
> }
>
> if (aDidFlush) {
> \*aDidFlush = didFlush;
> }
>
> if (aReleaseLast) {
>@@ -1939,18 +1920,20 @@ HTMLContentSink::EndContext(PRInt32 aPos
>
> PRInt32 n = mContextStack.Count() - 1;
> SinkContext\* sc = (SinkContext\*) mContextStack.ElementAt(n);
>
> NS\_ASSERTION(sc->mStack[aPosition].mType == mCurrentContext->mStack[0].mType,
> "ending a wrong context");
>
> mCurrentContext->FlushTextAndRelease();
>+ mCurrentContext->FlushTags();
>
> sc->mStack[aPosition].mNumFlushed = mCurrentContext->mStack[0].mNumFlushed;
>+ sc->mStack[aPosition].mInsertionPoint = mCurrentContext->mStack[0].mInsertionPoint;
>
> for (PRInt32 i = 0; i<mCurrentContext->mStackPos; i++) {
> NS\_IF\_RELEASE(mCurrentContext->mStack[i].mContent);
> }
>
> delete [] mCurrentContext->mStack;
>
> mCurrentContext->mStack = nsnull;
>diff --git a/layout/reftests/reftest.list b/layout/reftests/reftest.list
>--- a/layout/reftests/reftest.list
>+++ b/layout/reftests/reftest.list
>@@ -105,8 +105,11 @@ include text-transform/reftest.list
> # xul-document-load/
> include xul-document-load/reftest.list
>
> # xul grid
> include ../xul/base/src/grid/reftests/reftest.list
>
> # z-index/
> include z-index/reftest.list
>+
>+# reftest(s) to verify content bugfixes
>+include ../../content/html/document/reftests/reftests.list

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-28: |  |  | [#41](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/41) |
| --- | --- | --- | --- |

Created attachment 335976

stray Makefile changes removed from previous patch

Please disregard my previous comment. "Edit attachment as comment" did exactly what it said, if not what I intended...

Created attachment 335976
stray Makefile changes removed from previous patch
Please disregard my previous comment. "Edit attachment as comment" did exactly what it said, if not what I intended...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jonas-sicking (jonas-sicking)](https://launchpad.net/~jonas-sicking) wrote on 2008-08-28: |  |  | [#42](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/42) |
| --- | --- | --- | --- |

Contexts are basically insertion points. We create them for two reasons:

1. Insert into the head vs. the body. So for example we keep a head context

   around to insert some set of elements in the head always. At this point that

   set might simply be the <title> element.

2. Insert misplaced table stuff before the table. So given the markup

   <table><tr><span><td>, when we hit the <span> we create a new context and tell

   it to insert stuff before the <table> element.

Contexts are basically insertion points. We create them for two reasons:
1. Insert into the head vs. the body. So for example we keep a head context
around to insert some set of elements in the head always. At this point that
set might simply be the <title> element.
2. Insert misplaced table stuff before the table. So given the markup
<table><tr><span><td>, when we hit the <span> we create a new context and tell
it to insert stuff before the <table> element.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-29: |  |  | [#43](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/43) |
| --- | --- | --- | --- |

So given that, propagating mInsertionPoint from context to context would be wrong, sounds like.

Ben, I think I've more or less managed to convince myself that we can't insert multiple nodes in a single insertion point without notifying, but I'll need to double-check some of that tomorrow. I'll also look at that patch first thing in the morning.

So given that, propagating mInsertionPoint from context to context would be wrong, sounds like.
Ben, I think I've more or less managed to convince myself that we can't insert multiple nodes in a single insertion point without notifying, but I'll need to double-check some of that tomorrow. I'll also look at that patch first thing in the morning.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-29: |  |  | [#44](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/44) |
| --- | --- | --- | --- |

(In reply to comment #41)

> So given that, propagating mInsertionPoint from context to context would be

> wrong, sounds like.

Yep, and calling FlushTags in EndContext makes that unnecessary anyhow. This patch is essentially a one-liner (ignoring tests and assertions and the SinkContext::Node::Add refactoring).

Jonas's post suggests that context switching happens relatively infrequently, so there shouldn't be any appreciable performance hit.

(In reply to comment #41)
> So given that, propagating mInsertionPoint from context to context would be
> wrong, sounds like.
Yep, and calling FlushTags in EndContext makes that unnecessary anyhow. This patch is essentially a one-liner (ignoring tests and assertions and the SinkContext::Node::Add refactoring).
Jonas's post suggests that context switching happens relatively infrequently, so there shouldn't be any appreciable performance hit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-29: |  |  | [#45](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/45) |
| --- | --- | --- | --- |

Created attachment 335997

no more back-propagation of mInsertionPoint

The only remaining functional change is the addition of mCurrentContext->FlushTags() to HTMLContentSink::EndContext. Rest of the patch consists of tests and some refactoring (to use SinkContext::Node::Add).

Created attachment 335997
no more back-propagation of mInsertionPoint
The only remaining functional change is the addition of mCurrentContext->FlushTags() to HTMLContentSink::EndContext. Rest of the patch consists of tests and some refactoring (to use SinkContext::Node::Add).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-29: |  |  | [#46](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/46) |
| --- | --- | --- | --- |

So. Let's posit a parent with an insertion point. We're parsing its kids. When we OpenContainer a kid or AddLeaf a kid, we stick it into the insertion point. Then when we call DidAddContent either in the same AddLeaf or when we CloseContainer the kid. Since we have an insertion point, DidAddContent notifies. Therefore, we cannot insert multiple kids into the insertion point without notifying on all but maybe the last of them.

So. Let's posit a parent with an insertion point. We're parsing its kids. When we OpenContainer a kid or AddLeaf a kid, we stick it into the insertion point. Then when we call DidAddContent either in the same AddLeaf or when we CloseContainer the kid. Since we have an insertion point, DidAddContent notifies. Therefore, we cannot insert multiple kids into the insertion point without notifying on all but maybe the last of them.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-29: |  |  | [#47](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/47) |
| --- | --- | --- | --- |

OK. So given that, I'm back to being confused about why this bug happens. Do we EndContext before we make the DidAddContent call for the insertion point content?

OK. So given that, I'm back to being confused about why this bug happens. Do we EndContext before we make the DidAddContent call for the insertion point content?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-08-29: |  |  | [#48](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/48) |
| --- | --- | --- | --- |

That is, can we assert in EndContext that mNumFlushed == GetChildCount()? I assume that this bug's testcase would trigger the assert, right?

That is, can we assert in EndContext that mNumFlushed == GetChildCount()? I assume that this bug's testcase would trigger the assert, right?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-08-29: |  |  | [#49](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/49) |
| --- | --- | --- | --- |

(In reply to comment #45)

> OK. So given that, I'm back to being confused about why this bug happens. Do

> we EndContext before we make the DidAddContent call for the insertion point

> content?

Yes, we do. Think CNavDTD::CloseContainersTo has something to do with that; going to look into it after lunch.

(In reply to comment #45)
> OK. So given that, I'm back to being confused about why this bug happens. Do
> we EndContext before we make the DidAddContent call for the insertion point
> content?
Yes, we do. Think CNavDTD::CloseContainersTo has something to do with that; going to look into it after lunch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-09-06: |  |  | [#50](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/50) |
| --- | --- | --- | --- |

Created attachment 337156

proposed patch (no longer calling FlushTags)

Summary of changes:

- CNavDTD::HandleSavedTokens is now responsible for instructing

  the content sink to close forms created (e.g., by

  CNavDTD::CreateContextStackFor) during the execution of

  HandleSavedTokens. Intuitively, CNavDTD::CloseContainersTo

  should do this, but the parser forgets about forms after

  opening them (a deliberate design choice that I didn't make).

  Closing these forms before calling HTMLContentSink::EndContext

  ensures that the sink is completely flushed before it throws

  away the current context (with its mInsertionPoint

  information), which solves the double rendering bug without

  requiring any calls to FlushTags.

- Introduced CNavDTD::CloseResidualStyleTags to fix another bug

  that was involved in the original test case but orthogonal to

  the double rendering issue. To explain: residual tags get

  pushed inside block elements when the document has any

  malformed tags, and the sink refuses to close a form if any

  tags inside the form are still open. So form closure fails

  when there are any malformed tags, unless we close all the

  residual tags still open within the form. This failure causes

  subsequent nodes to nest inside the unclosed form (sometimes

  forms within forms!), as reftest [bug448564](/bugs/448564)-1\_\*.html

  demonstrates. My [bug448564](/bugs/448564)\_4\*.html reftest verifies that

  CNavDTD::OpenTransientStyles reopens the residual tags.

- Decomposition of SinkContext::Node::Add. Not a functional

  change, just a little cleanup.

- Miscellaneous assertions.

- Six reftests and one crashtest.

Created attachment 337156
proposed patch (no longer calling FlushTags)
Summary of changes:
- CNavDTD::HandleSavedTokens is now responsible for instructing
the content sink to close forms created (e.g., by
CNavDTD::CreateContextStackFor) during the execution of
HandleSavedTokens. Intuitively, CNavDTD::CloseContainersTo
should do this, but the parser forgets about forms after
opening them (a deliberate design choice that I didn't make).
Closing these forms before calling HTMLContentSink::EndContext
ensures that the sink is completely flushed before it throws
away the current context (with its mInsertionPoint
information), which solves the double rendering bug without
requiring any calls to FlushTags.
- Introduced CNavDTD::CloseResidualStyleTags to fix another bug
that was involved in the original test case but orthogonal to
the double rendering issue. To explain: residual tags get
pushed inside block elements when the document has any
malformed tags, and the sink refuses to close a form if any
tags inside the form are still open. So form closure fails
when there are any malformed tags, unless we close all the
residual tags still open within the form. This failure causes
subsequent nodes to nest inside the unclosed form (sometimes
forms within forms!), as reftest bug448564-1\_\*.html
demonstrates. My bug448564\_4\*.html reftest verifies that
CNavDTD::OpenTransientStyles reopens the residual tags.
- Decomposition of SinkContext::Node::Add. Not a functional
change, just a little cleanup.
- Miscellaneous assertions.
- Six reftests and one crashtest.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-09-06: |  |  | [#51](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/51) |
| --- | --- | --- | --- |

Oh... Right. Forms. How does this last patch handle:

<table>

  <form>

    <tr><td><input name="a" value="aval"></td></tr>

    <input type="hidden" name="b" value="bval">

    <input name="c" value="cval">

    <tr><td><input name="d" value="dval" type="submit"></td></tr>

  </form>

</table>

When you submit the form, are all the inputs submitted? Does anything change if the form is opened before the table open and closed after the table close? What about:

<table>

  <span><form>

    <tr><td><input name="a" value="aval"></td></tr>

    <input type="hidden" name="b" value="bval">

    <input name="c" value="cval">

    <tr><td><input name="d" value="dval" type="submit"></td></tr>

  </form></span>

</table>

or some such? In any case, with forms involved like this I can almost see how we could switch contexts while the form is still open. Given that, the FlushTags is probably what we want. I just wanted to understand what about this testcase was tickling that situation...

If you do want to make changes to CNavDTD, then mrbkap is your review man for those. I'm willing to review the sink, but CNavDTD is black magic. ;)

Oh... Right. Forms. How does this last patch handle:
<table>
<form>
<tr><td><input name="a" value="aval"></td></tr>
<input type="hidden" name="b" value="bval">
<input name="c" value="cval">
<tr><td><input name="d" value="dval" type="submit"></td></tr>
</form>
</table>
When you submit the form, are all the inputs submitted? Does anything change if the form is opened before the table open and closed after the table close? What about:
<table>
<span><form>
<tr><td><input name="a" value="aval"></td></tr>
<input type="hidden" name="b" value="bval">
<input name="c" value="cval">
<tr><td><input name="d" value="dval" type="submit"></td></tr>
</form></span>
</table>
or some such? In any case, with forms involved like this I can almost see how we could switch contexts while the form is still open. Given that, the FlushTags is probably what we want. I just wanted to understand what about this testcase was tickling that situation...
If you do want to make changes to CNavDTD, then mrbkap is your review man for those. I'm willing to review the sink, but CNavDTD is black magic. ;)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-09-10: |  |  | [#52](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/52) |
| --- | --- | --- | --- |

Created attachment 337795

new forms tests, back to calling FlushTags for good measure

Blake, can you review the CNavDTD changes in this patch? Hope my comments in the code make it clear what I was trying to do.

Created attachment 337795
new forms tests, back to calling FlushTags for good measure
Blake, can you review the CNavDTD changes in this patch? Hope my comments in the code make it clear what I was trying to do.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-09-10: |  |  | [#53](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/53) |
| --- | --- | --- | --- |

(In reply to comment #49)

> When you submit the form, are all the inputs submitted? Does anything change

> if the form is opened before the table open and closed after the table close?

All the input fields do get submitted, according to the tests I added in the most recent patch.

> In any case, with forms involved like this I can almost see how

> we could switch contexts while the form is still open. Given that, the

> FlushTags is probably what we want.

I think it was worthwhile to drill a little deeper (i.e., into the parser), but I'm also inclined to keep FlushTags in EndContext.

> If you do want to make changes to CNavDTD, then mrbkap is your review man for

> those. I'm willing to review the sink, but CNavDTD is black magic. ;)

Don't blame you :)

(In reply to comment #49)
> When you submit the form, are all the inputs submitted? Does anything change
> if the form is opened before the table open and closed after the table close?
All the input fields do get submitted, according to the tests I added in the most recent patch.
> In any case, with forms involved like this I can almost see how
> we could switch contexts while the form is still open. Given that, the
> FlushTags is probably what we want.
I think it was worthwhile to drill a little deeper (i.e., into the parser), but I'm also inclined to keep FlushTags in EndContext.
> If you do want to make changes to CNavDTD, then mrbkap is your review man for
> those. I'm willing to review the sink, but CNavDTD is black magic. ;)
Don't blame you :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mrbkap (mrbkap)](https://launchpad.net/~mrbkap) wrote on 2008-09-11: |  |  | [#54](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/54) |
| --- | --- | --- | --- |

Comment on attachment 337795

new forms tests, back to calling FlushTags for good measure

The CNavDTD changes look good. [bug 136397](/bugs/136397) tracks the most correct fix for <form> closure (namely, tracking whether we've opened one in CNavDTD, not in the content sink).

Comment on attachment 337795
new forms tests, back to calling FlushTags for good measure
The CNavDTD changes look good. bug 136397 tracks the most correct fix for <form> closure (namely, tracking whether we've opened one in CNavDTD, not in the content sink).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-09-26: |  |  | [#55](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/55) |
| --- | --- | --- | --- |

Comment on attachment 337795

new forms tests, back to calling FlushTags for good measure

sr=bzbarsky, with newlines added to the ends of all those files that have no newlines at the end. Thanks a ton for digging into this code and getting this sorted out!

Comment on attachment 337795
new forms tests, back to calling FlushTags for good measure
sr=bzbarsky, with newlines added to the ends of all those files that have no newlines at the end. Thanks a ton for digging into this code and getting this sorted out!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-09-26: |  |  | [#56](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/56) |
| --- | --- | --- | --- |

Created attachment 340626

now with newlines

Created attachment 340626
now with newlines

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-10-12: |  |  | [#57](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/57) |
| --- | --- | --- | --- |

Pushed changeset 39f61d918dae.

Pushed changeset 39f61d918dae.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Bzbarsky (bzbarsky)](https://launchpad.net/~bzbarsky) wrote on 2008-10-12: |  |  | [#58](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/58) |
| --- | --- | --- | --- |

Do we need this on any branches, btw?

Do we need this on any branches, btw?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Samuel-sidler+old (samuel-sidler+old)](https://launchpad.net/~samuel-sidler%2Bold) wrote on 2008-10-12: |  |  | [#59](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/59) |
| --- | --- | --- | --- |

Maybe; nominating for now so we can discuss it on Monday.

Maybe; nominating for now so we can discuss it on Monday.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Dveditz (dveditz)](https://launchpad.net/~dveditz) wrote on 2008-10-15: |  |  | [#60](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/60) |
| --- | --- | --- | --- |

Do we need a different 1.9.0.x patch or have things not changed too much?

Do we need a different 1.9.0.x patch or have things not changed too much?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Dveditz (dveditz)](https://launchpad.net/~dveditz) wrote on 2008-10-22: |  |  | [#61](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/61) |
| --- | --- | --- | --- |

Ben: please create a FF3.0.x patch (if necessary) and request approval for 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this early in the next cycle (for which the tree is only going to be open for about a week).

Ben: please create a FF3.0.x patch (if necessary) and request approval for 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this early in the next cycle (for which the tree is only going to be open for about a week).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-10-22: |  |  | [#62](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/62) |
| --- | --- | --- | --- |

(In reply to comment #59)

> Ben: please create a FF3.0.x patch (if necessary) and request approval for

> 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this

> early in the next cycle (for which the tree is only going to be open for about

> a week).

Sure thing. Should this backpatch include tests, or just the functional changes? It's just a few lines if tests are not necessary.

(In reply to comment #59)
> Ben: please create a FF3.0.x patch (if necessary) and request approval for
> 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this
> early in the next cycle (for which the tree is only going to be open for about
> a week).
Sure thing. Should this backpatch include tests, or just the functional changes? It's just a few lines if tests are not necessary.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Jonas-sicking (jonas-sicking)](https://launchpad.net/~jonas-sicking) wrote on 2008-10-23: |  |  | [#63](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/63) |
| --- | --- | --- | --- |

Tests would be good since we don't want to regress on the 3.0 branch either (actually, almost even more important there).

We have the same test infrastructure running on the branch though so you should be able to use the same tests.

Tests would be good since we don't want to regress on the 3.0 branch either (actually, almost even more important there).
We have the same test infrastructure running on the branch though so you should be able to use the same tests.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-10-23: |  |  | [#64](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/64) |
| --- | --- | --- | --- |

(In reply to comment #59)

> Ben: please create a FF3.0.x patch (if necessary) and request approval for

> 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this

> early in the next cycle (for which the tree is only going to be open for about

> a week).

Is that the hg tag MOZILLA\_1\_9\_a7\_BASE?

(In reply to comment #59)
> Ben: please create a FF3.0.x patch (if necessary) and request approval for
> 1.9.0.5 on it or on this one if it applies. Missed 1.9.0.4, will want this
> early in the next cycle (for which the tree is only going to be open for about
> a week).
Is that the hg tag MOZILLA\_1\_9\_a7\_BASE?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Gavin Sharp (gavin-sharp)](https://launchpad.net/~gavin-sharp) wrote on 2008-10-23: |  |  | [#65](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/65) |
| --- | --- | --- | --- |

(In reply to comment #62)

> Is that the hg tag MOZILLA\_1\_9\_a7\_BASE?

Nope, it's CVS HEAD (see <https://developer.mozilla.org/en/Mozilla_Source_Code_Via_CVS>)

(In reply to comment #62)
> Is that the hg tag MOZILLA\_1\_9\_a7\_BASE?
Nope, it's CVS HEAD (see https://developer.mozilla.org/en/Mozilla\_Source\_Code\_Via\_CVS)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-10-28: |  |  | [#66](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/66) |
| --- | --- | --- | --- |

Created attachment 345176

backport to CVS HEAD

Passes my tests. Waiting on the tryserver; will update when that's done.

Created attachment 345176
backport to CVS HEAD
Passes my tests. Waiting on the tryserver; will update when that's done.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-10-29: |  |  | [#67](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/67) |
| --- | --- | --- | --- |

(In reply to comment #64)

> Created an attachment (id=345176) [details]

> backport to CVS HEAD

>

> Passes my tests. Waiting on the tryserver; will update when that's done.

And it builds on all three platforms: <https://build.mozilla.org/tryserver-builds/2008-10-28_15>:<email address hidden>/

(In reply to comment #64)
> Created an attachment (id=345176) [details]
> backport to CVS HEAD
>
> Passes my tests. Waiting on the tryserver; will update when that's done.
And it builds on all three platforms: https://build.mozilla.org/tryserver-builds/2008-10-28\_15:02-bnewman@mozilla.com-1225231280/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Samuel-sidler+old (samuel-sidler+old)](https://launchpad.net/~samuel-sidler%2Bold) wrote on 2008-10-29: |  |  | [#68](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/68) |
| --- | --- | --- | --- |

Comment on attachment 345176

backport to CVS HEAD

Applied cleanly and everything. Requesting approval for 1.9.0.5.

Comment on attachment 345176
backport to CVS HEAD
Applied cleanly and everything. Requesting approval for 1.9.0.5.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Dveditz (dveditz)](https://launchpad.net/~dveditz) wrote on 2008-11-03: |  |  | [#69](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/69) |
| --- | --- | --- | --- |

Comment on attachment 345176

backport to CVS HEAD

approved for 1.9.0.5, a=dveditz for release-drivers

(please wait for tree to open before landing)

Comment on attachment 345176
backport to CVS HEAD
approved for 1.9.0.5, a=dveditz for release-drivers
(please wait for tree to open before landing)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mozilla+ben (mozilla+ben)](https://launchpad.net/~mozilla%2Bben) wrote on 2008-11-17: |  |  | [#70](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/70) |
| --- | --- | --- | --- |

(In reply to comment #67)

> (From update of attachment 345176 [details])

> approved for 1.9.0.5, a=dveditz for release-drivers

>

> (please wait for tree to open before landing)

Since I don't yet have commit access, any ideas whom I should ask to land this?

(In reply to comment #67)
> (From update of attachment 345176 [details])
> approved for 1.9.0.5, a=dveditz for release-drivers
>
> (please wait for tree to open before landing)
Since I don't yet have commit access, any ideas whom I should ask to land this?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mrbkap (mrbkap)](https://launchpad.net/~mrbkap) wrote on 2008-11-18: |  |  | [#71](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/71) |
| --- | --- | --- | --- |

I'll land this in a couple of hours.

I'll land this in a couple of hours.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Mrbkap (mrbkap)](https://launchpad.net/~mrbkap) wrote on 2008-11-18: |  |  | [#72](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/72) |
| --- | --- | --- | --- |

Fixed on the 1.9 branch.

Fixed on the 1.9 branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| In [Mozilla Bugzilla #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564), [Abillings (abillings)](https://launchpad.net/~abillings) wrote on 2008-11-26: |  |  | [#73](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/73) |
| --- | --- | --- | --- |

This seems to be working based on the checked in tests. Can we get anyone from Radware to verify the fix?

This seems to be working based on the checked in tests. Can we get anyone from Radware to verify the fix?

[Bug Watch Updater (bug-watch-updater)](https://launchpad.net/~bug-watch-updater)
on 2008-12-17

| Changed in firefox: | |
| --- | --- |
| **status**: | Unknown → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Martin Mai (mrkanister-deactivatedaccount-deactivatedaccount)](https://launchpad.net/~mrkanister-deactivatedaccount-deactivatedaccount) wrote on 2009-01-22: |  |  | [#74](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/74) |
| --- | --- | --- | --- |

Fixed upstream.

Fixed upstream.

| Changed in firefox-3.0: | |
| --- | --- |
| **status**: | New → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Micah Gersten (micahg)](https://launchpad.net/~micahg) wrote on 2009-07-23: |  |  | [#75](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/comments/75) |
| --- | --- | --- | --- |

This was released in FF 3.0.5.

This was released in FF 3.0.5.

| Changed in firefox-3.0 (Ubuntu): | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Bug Watch Updater (bug-watch-updater)](https://launchpad.net/~bug-watch-updater)
on 2010-09-18

| Changed in firefox: | |
| --- | --- |
| **importance**: | Unknown → Medium |

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/firefox-3.0/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/firefox-3.0/%2Bbug/256624/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

* [mozilla-bugs #448564](https://bugzilla.mozilla.org/show_bug.cgi?id=448564)

  [RESOLVED FIXED]
  [Edit](/bugs/256624/%2Bwatch/45155 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from wiki.mozilla.org_73f8d6fa_20250126_013800.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from blog.mozilla.com_2335e09f_20250124_143859.html ===

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav "Visit mozilla.org")
Menu

* [About Mozilla](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)
* [Products](https://www.mozilla.org/firefox/products/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)
* [Give](https://donate.mozilla.org/?presets=50,30,20,10&amount=30&currency=usd&utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)
* [Discover Firefox](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

[#### Mozilla Security Blog](https://blog.mozilla.org/security/ "Go to the front page")

* Search this site

  Search

**Categories:**
[Firefox](https://blog.mozilla.org/security/category/firefox/) [Security](https://blog.mozilla.org/security/category/security/)
# Low Risk Denial of Service in Firefox

Window Snyder
July 30, 2008

[15 responses](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comments)

**Issue**

A null pointer dereference in the content layout component of Firefox allows an attacker to crash the browser when a user navigates to a malicious page.

**Impact**

If a user browses to a malicious page that takes advantage of this vulnerability, the browser will crash.  A feature in Firefox called Session Restore will restore the browser session when Firefox is restarted and will likely save user typed content in text areas as well.  This feature is designed to save users’ work in the event of a crash or browser restart.

**Status**

This issue is currently under investigation.  Mozilla has assigned this bug an initial severity rating of low because of the minimal security risk to users.

**Credit**

Radware reported this issue to Mozilla.

**Tags:** [Vulnerabilities](https://blog.mozilla.org/security/tag/vulnerabilities/)

#### Browse fast. Browse free.

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=firefox_frontier&utm_medium=referral)

[Previous article
**TippingPoint vulnerability patched in Firefox 3.0.1 and 2.0.0.16**
July 16, 2008](https://blog.mozilla.org/security/2008/07/16/tippingpoint-vulnerability-patched-in-firefox-301-and-20016/)

[Next article
**Malicious Firefox Plugin**
December 8, 2008](https://blog.mozilla.org/security/2008/12/08/malicious-firefox-plugin/)

#### More articles in “Firefox”

* ##### [Behind the Scenes: Fixing an In-the-Wild Firefox Exploit](https://blog.mozilla.org/security/2024/10/11/behind-the-scenes-fixing-an-in-the-wild-firefox-exploit/)

  October 11, 2024
* ##### [Firefox will upgrade more Mixed Content in Version 127](https://blog.mozilla.org/security/2024/06/05/firefox-will-upgrade-more-mixed-content-in-version-127/)

  June 5, 2024
* ##### [Version 2.9 of the Mozilla Root Store Policy](https://blog.mozilla.org/security/2023/09/13/version-2-9-of-the-mozilla-root-store-policy/)

  September 13, 2023
* ##### [Securing the proxy API for Firefox add-ons](https://blog.mozilla.org/security/2021/10/25/securing-the-proxy-api-for-firefox-add-ons/)

  October 25, 2021
* ##### [Firefox 93 features an improved SmartBlock and new Referrer Tracking Protections](https://blog.mozilla.org/security/2021/10/05/firefox-93-features-an-improved-smartblock-and-new-referrer-tracking-protections/)

  October 5, 2021

#### Recent articles

* ##### [Behind the Scenes: Fixing an In-the-Wild Firefox Exploit](https://blog.mozilla.org/security/2024/10/11/behind-the-scenes-fixing-an-in-the-wild-firefox-exploit/)

  October 11, 2024
* ##### [Firefox will upgrade more Mixed Content in Version 127](https://blog.mozilla.org/security/2024/06/05/firefox-will-upgrade-more-mixed-content-in-version-127/)

  June 5, 2024
* ##### [Rapidly Leveling up Firefox Security](https://blog.mozilla.org/security/2024/04/04/rapidly-leveling-up-firefox-security/)

  April 4, 2024
* ##### [Mozilla VPN Security Audit 2023](https://blog.mozilla.org/security/2023/12/06/mozilla-vpn-security-audit-2023/)

  December 6, 2023
* ##### [Version 2.9 of the Mozilla Root Store Policy](https://blog.mozilla.org/security/2023/09/13/version-2-9-of-the-mozilla-root-store-policy/)

  September 13, 2023

### Keep up with all things Firefox.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
Bahasa Indonesia
Deutsch
English
Español
Français
Polski
Português
Русский
正體中文

 HTML
 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now

We will only send you Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

### 15 comments on “Low Risk Denial of Service in Firefox”

1. #### Sam Hasler wrote on [July 30, 2008 at 2:22 pm:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-76601 "Permanent link to this comment by Sam Hasler")

   > If the page that you crashed on is in the session won’t you just crash as soon as you start up again though?
3. #### Jesse Ruderman wrote on [July 30, 2008 at 8:05 pm:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-76652 "Permanent link to this comment by Jesse Ruderman")

   > What’s special about this crash bug that merits a post on the Security Blog? Most such bugs are public and not treated as security holes.
5. #### Mook wrote on [July 30, 2008 at 10:18 pm:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-76673 "Permanent link to this comment by Mook")

   > Is there some sort of bug number we can refer to? (Even if the bug is private, so that we would be able to refer back to it once it has been removed from the group)
7. #### Window Snyder wrote on [July 31, 2008 at 1:44 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-76704 "Permanent link to this comment by Window Snyder")

   > Mook, the bug is here: <https://bugzilla.mozilla.org/show_bug.cgi?id=448564>
   >
   > Jesse, I posted about this issue because Radware issued a press release and I wanted to make sure our users had enough context to understand that this is a low risk issue.
9. #### Thomas Jedenfelt wrote on [September 2, 2008 at 7:54 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-83618 "Permanent link to this comment by Thomas Jedenfelt")

   > If this is the same security issue as in Firefox 2, then there is a temporary solution, as stated in [Mozilla Firefox 2.0.0.3 Release Notes, March 2007]. See also [Firefox 3 Knowledge Base / Session Restore]:
11. #### Security Software Developer wrote on [December 5, 2008 at 6:44 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-100118 "Permanent link to this comment by Security Software Developer")

    > The blog is alive or dead? The latest post was written on 07.30.08 but today is december 2008.
    >
    > Good luck
13. #### .NET Component Library wrote on [December 8, 2008 at 1:58 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-100216 "Permanent link to this comment by .NET Component Library")

    > I think the blog is dead :(.
15. #### Dicks wrote on [December 25, 2008 at 9:22 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-101503 "Permanent link to this comment by Dicks")

    > Hey, is there a german blog of firefox and co?
    >
    > I searched up google but i don’t found anything.
    >
    > Regards M. Dicks (Is my real name :D)
17. #### loren salmonson wrote on [January 1, 2009 at 6:19 pm:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-101974 "Permanent link to this comment by loren salmonson")

    > My latest version of Firefox, installed just a few days ago, just jumped to full-screen and the messages there said that my system had been attacked and someone now knew my IP address. I was unable to X out, nor minimize the screen. The system repeatedly tried to install something called Install.exe, in order to as it said it wanted to installed better security programs. I rebooted my system and again Firefox did that same thing, so I assume that this all means that something in Firefox files has been infected. So I removed Firefox from my desktop. I know that this is probably not the Low Risk Denial of Service in Firefox problem, but would someone advise me if these symptoms have been seen before, and if I can safely reinstall Firefox without a recurrence. (I already removed all associated data including cookies.)
19. #### Hari Krish wrote on [January 4, 2009 at 10:16 pm:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-102189 "Permanent link to this comment by Hari Krish")

    > I would like to know, if this bug has been fixed in any of the firefox version released till now or can anyone tell in which forth coming release, this issue will be fixed?????
21. #### BigD wrote on [January 26, 2009 at 2:42 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-103644 "Permanent link to this comment by BigD")

    > I have a program called glue that keeps popping up every time I start Firefox, Does anyone know how to get rid of this program? It is not in add or remove programs and I have not found any related files at least yet. I have found no way to remove it and it is a fricken pest.
23. #### Ann froshaug wrote on [February 7, 2009 at 5:32 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-104462 "Permanent link to this comment by Ann froshaug")

    > Firefox claims re safety and comparisons re safety as compared with internet explorer only take us to 2006/7 it’s February 2009 now why not update please?
25. #### catrina williams wrote on [February 7, 2009 at 12:28 pm:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-104511 "Permanent link to this comment by catrina williams")

    > i was using Firefox one day and all of a sudden my browser crashed and now when i try to pull it up,it tells me to send an error report. but i can’t get to any pages.
27. #### Daniel Veditz wrote on [February 8, 2009 at 9:31 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-104572 "Permanent link to this comment by Daniel Veditz")

    > @Ann Froshaug: Those comparison reports were authored by third parties (the most recent by a technology reporter for the Washington Post). We would love more recent reports but we’re afraid that if we author them ourselves people will focus on looking for evidence of bias.
29. #### Peter wrote on [February 9, 2009 at 1:56 am:](https://blog.mozilla.org/security/2008/07/30/low-risk-denial-of-service-in-firefox/#comment-104592 "Permanent link to this comment by Peter")

    > My Firefox crashes a lot, especially when I go to websites as “www.prisonplanet.com , brasscheck.com etc”, but also some erotic pages (lets be honest people !). The crashes really look like DOS attacks, cause sometimes, days on end, when I don’t visit these websites everything is fine, but when I do visit them, then suddenly I get dozens of DOS attacks within a few hours.
    >
    > I work on a MAC computer

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### [Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30&currency=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* + [Twitter (@mozilla)](https://twitter.com/mozilla)
  + [Instagram (@mozillagram)](https://www.instagram.com/mozillagram/)

##### [Firefox](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* + [Twitter (@firefox)](https://twitter.com/firefox)
  + [YouTube (firefoxchannel)](https://www.youtube.com/firefoxchannel)

* [Website Privacy Notice](https://www.mozilla.org/privacy/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)

Visit Mozilla Corporation’s not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org).

Portions of this content are ©1998-2025 by individual contributors. Content available under a [Creative Commons license](https://www.mozilla.org/foundation/licensing/website-content/).



=== Content from wiki.mozilla.org_3659d679_20250126_013759.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.radware.com_3a47ef9c_20250124_143901.html ===


[![Radware](/RadwareNext/images/logo.svg)](/)

* [Solutions](#menu-tab-for-solutions)
* [Products](#menu-tab-for-products)
* [Partners](/partners/)
* [Company](#menu-tab-company)
* [Resources](#menu-tab-resources-downloads)
* [Support](https://support.radware.com/)

* ![Search](/RadwareNext/images/icons/icon-search.svg)
* [Under Attack](/underattack/)
* [Contact
  Sales](/contactus/)

![Press Releases](/RadwareSite/MediaLibraries/Images/Hero/2024/hero_pr_xl.jpg)

* [News Room](/newsroom/)
* Press Releases

# Press Releases

## Discover Radware's latest updates on DDoS protection and cybersecurity achievements in our Press Releases.

* [2025](?tab=2025)
* [2024](?tab=2024)
* [Archive](?tab=archive)

TEL AVIV, Israel

 January 7, 2025 06:00 AM

[![Twitter](/RadwareNext/images/icons/icon-twitter-cyan.svg)](https://twitter.com/intent/tweet?text=Radware Schedules Conference Call for Its Fourth Quarter and Full Year 2024 Earnings&url=https://radware.com/newsevents/pressreleases/2025/radware-schedules-conference-call-for-its-fourth-quarter-and-full-year-2024-earnings/)
[![LinkedIn](/RadwareNext/images/icons/icon-linkedin-cyan.svg)](https://www.linkedin.com/shareArticle?mini=true&url=https://radware.com/newsevents/pressreleases/2025/radware-schedules-conference-call-for-its-fourth-quarter-and-full-year-2024-earnings/&title=Radware Schedules Conference Call for Its Fourth Quarter and Full Year 2024 Earnings)

[#### **Radware Schedules Conference Call for Its Fourth Quarter and Full Year 2024 Earnings**](/newsevents/pressreleases/2025/radware-schedules-conference-call-for-its-fourth-quarter-and-full-year-2024-earnings/)

Radware® (NASDAQ: RDWR), a global leader in application security and delivery solutions for multi-cloud environments, will announce its fourth quarter and full year 2024 financial results on Wednesday, February 12, 2025.

* [2025](?tab=2025)
* [2024](?tab=2024)
* [Archive](?tab=archive)

[![Radware: Press Releases](/CMSPages/GetResource.ashx?image=%5bImages.zip%5d%2fDesign%2fControls%2fIconSelector%2fRSS%2f01_Orange%2f16.png)](https://www.radware.com/newsevents/pressreleases/?id=6459&rss=Radware-Press-Releases)[RSS 2.0](https://www.radware.com/newsevents/pressreleases/?id=6459&rss=Radware-Press-Releases)

#### Contact Radware Sales

Our experts will answer your questions, assess your needs, and help you understand which products are best for your business.

[Contact Us Now](/contactus/)

#### Already a Customer?

We’re ready to help, whether you need support, additional services, or answers to your questions about our products and solutions.

[Locations](/locations/?utm_source=getstartedpage&utm_campaign=getstarted&utm_content=locations)

[Get Answers Now from KnowledgeBase](https://support.radware.com/?utm_source=getstartedpage&utm_campaign=getstarted&utm_content=knowledgebase)

[Get Free Online Product Training](/training/?utm_source=getstartedpage&utm_campaign=getstarted&utm_content=training)

[Engage with Radware Technical Support](/support/?utm_source=getstartedpage&utm_campaign=getstarted&utm_content=support)

[Join the Radware Customer Program](https://radware.customershome.com/home)
#### Get Social

Connect with experts and join the conversation about Radware technologies.

[Blog](/blog/)

[Security Research Center](/security)

[CyberPedia](/cyberpedia/)

[![](/RadwareNext/images/social-icons/facebook.svg)](https://www.facebook.com/Radware)  [![](/RadwareNext/images/social-icons/youtube.svg)](https://www.youtube.com/user/radwareinc)   [![](/RadwareNext/images/social-icons/linkedin.svg)](https://www.linkedin.com/company/radware)   [![](/RadwareSite/MediaLibraries/Images/icons-social/x.svg)](https://twitter.com/radware)

![Close](/RadwareNext/images/icons/icon-close.svg)

#### What are you looking for?

#### [Menu By Industry By Industry](/solutions/industries/)

* [Carriers & Service
  Providers](/solutions/#solutions-service-providers)
* [eCommerce](/solutions/ecommerce/)
* [Education](/solutions/education/)
* [Financial Services](/solutions/financial/)
* [Government](/solutions/government/)
* [Healthcare](/solutions/healthcare/)
* [MSSPs](/solutions/build-business/)
* [SaaS](/solutions/saas/)

#### Menu By Use Case By Use Case

#### [Menu Application Protection Application Protection](/solutions/application-protection-service/)

* [Protect Web
  Applications](/solutions/application-protection-service/)
* [Secure APIs](/solutions/api-protection/)
* [Mitigate Bad Bots & Automated Threats](/products/bot-manager/)
* [Stop Supply Chain Attacks](/solutions/client-side-protection/)
* [Mitigate Web DDoS
  Attacks](/solutions/cloud-web-ddos-protection/)
* [Compliance](/solutions/compliance/)
* [Protect Applications in Kubernetes](/products/kubernetes-waf/)
* [Protect Applications
  Across Multiple Clouds](/solutions/application-protection-cloud/)
* [Discover & Analyze
  Vulnerabilities](/security/security-analysis-services/)
* [Open Banking](/solutions/open-banking-cybersecurity/)

#### [Menu DDoS Protection DDoS Protection](/solutions/ddos-protection/)

* [Protect Your Infrastructure](/solutions/ddos-protection/)
* [Mitigate Web DDoS & Encrypted
  Threats](/solutions/web-ddos-protection/)
* [Stop DNS Attacks](/solutions/dns-ddos-protection/)
* [Compliance](/solutions/compliance/)
* [Advanced Network analytics](/solutions/cloud-network-analytics/)
* [AI SOC Xpert](/products/ai-soc-xpert/)

#### [Menu Application Delivery Application Delivery](/solutions/adc-hybrid-environments/)

* [SSL
  Inspection, Offloading & Acceleration](/solutions/ssl-inspection/)
* [Automated
  App Delivery for Private Clouds](/solutions/alteon-automation/)
* [Secured
  Application Delivery](/solutions/application-delivery-and-protection/)

#### [Menu Solutions Application Protection](/products/#products-application-protection)

* [Cloud Application
  Protection Service](/solutions/application-protection-service/)
* [Cloud WAF](/products/cloud-waf-service/)
* [Bot Manager](/products/bot-manager/)
* [API Protection](/solutions/api-protection/)
* [Web DDoS Protection](/solutions/cloud-web-ddos-protection/)
* [Client-Side Protection](/solutions/client-side-protection/)
* [Threat Intelligence](/products/threat-intelligence-service/)
* [Kubernetes WAAP](/products/kubernetes-waf/)
* [Alteon Integrated WAF](/products/appwall/)

#### [Menu DDoS Protection DDoS Protection](/products/#products-ddos-protection)

* [Cloud DDoS Protection
  Service](/products/cloud-ddos-services/)
* [Web DDoS Protection](/solutions/cloud-web-ddos-protection/)
* [DefensePro X](/products/defensepro/)
* [Cyber Controller](/products/cyber-controller/)
* [Threat Intelligence](/products/threat-intelligence-service/)
* [Firewall as-a-Service](/products/cloud-firewall-as-a-service/)

#### [Menu Application Delivery Application Delivery](/products/#products-application-delivery)

* [Alteon](/products/alteon/)
* [LinkProof NG](/products/linkproofng/)
* [Cyber Controller](/products/cyber-controller/)
* [SSL Inspection](/solutions/ssl-inspection/)

![](/RadwareSite/MediaLibraries/Images/nav/t2.jpg)
#### Protect Your Website From Dangerous Bad Bots

Get a free Bad Bot Vulnerability scan to secure your eCommerce site today.

[Learn More](/security/security-analysis-services/bad-bot-vulnerability-scanner/)

#### [Menu Documents](/documents/)

* [White Papers](/documents/?type=WhitePapers6442498600)
* [Research](/documents/?type=Research6442499639)
* [Case Studies](/documents/?type=CaseStudy6442498604)
* [Data Sheets](/documents/?type=DataSheets6442498599)
* [Analyst Report](/documents/?type=AnalystReport6442498602)

* [Solution Briefs](/documents/?type=SolutionsBrief6442498614)
* [Infographics](/documents/?type=Infographics6442499495)
* [Integration Guides](/documents?type=IntegrationGuides6442498618)
* [eGuides](/documents/?type=eGuide6442499487)
* [Tech Specs](/documents/?type=TechSpecs6442498616)

#### [Menu Blog Blog](/blog/)

* [Application Delivery](/blog/applicationdelivery/)
* [Application
  Protection](/blog/application-protection/)

* [DDoS Protection](/blog/ddos-protection/)
* [Threat Intelligence](/blog/threat-intelligence/)

#### [Menu Free Assessment Tools Free Assessment Tools](/security/security-analysis-services/)

* [API Vulnerability
  Scanner](/security/security-analysis-services/api-vulnerability-scanner/)
* [Bad Bot Analyzer](/security/security-analysis-services/bad-bot-analyzer/)
* [Bad Bot Vulnerability
  Scanner](/security/security-analysis-services/bad-bot-vulnerability-scanner/)
* [Application
  Vulnerability Analyzer](/security/security-analysis-services/application-vulnerability-analyzer/)
* [API Vulnerability
  Scanner](/security/security-analysis-services/api-vulnerability-scanner/)

#### [Menu Events Events](/newsroom/events/)

* [Webinars & Virtual Events](/newsroom/events/)

* [In Person Events](/newsroom/events/in-person/)

#### [Menu Security Research Center Security Research Center](/security/)

* [Threat Alerts
  Get updates and analysis on major cybersecurity events.](/security/threat-advisories-attack-reports/)
* [Threat Analysis Center
  Discover stats, trends and analysis from our threat report.](/threat-analysis-report/)
* [Live Threat Map
  Watch real-time attack data visualized by Radware.](https://livethreatmap.radware.com/)
* [CyberPedia
  Learn about common cybersecurity terms and threat groups.](/cyberpedia/)

#### Radware icon [WHY RADWARE?](/about/why-radware/) Learn how Radware EPIC-AI™ rapidly resolves issues

#### Menu Customers [CUSTOMERS](/customers/) Read case studies, reviews and customer testimonials

#### Menu Diversity & Inclusion [DIVERSITY & INCLUSION](/corporategovernance/dei-mission/) Get to know Radware’s fair and supportive culture

#### Menu Investors [INVESTORS](/ir/) Get the latest news, earnings and upcoming events

#### Menu Partners [PARTNERS](/partners/) Access the new partner tools, services and expertise

#### Menu Locations [LOCATIONS](/locations/) Discover Radware’s offices and strong global presence

#### Menu Careers [CAREERS](/careers/) Learn about our team, values and latest job openings

#### Menu Training [TRAINING](/training/) Join in-depth training, live classes, workshops and more

#### Menu Contact Us [CONTACT US](/contactus/) Connect with a Radware expert today

![](/RadwareSite/MediaLibraries/Images/nav/t1.jpg)
#### Watch Radware’s New Series: Threat Bytes

Get the latest global cyberthreat updates quickly, in just a few bytes.

[Watch Now](https://www.youtube.com/playlist?list=PLpQk88W8mWuWT8WDz0qIOMzISzOoFIj0s)

#### Solutions

* [![Menu By Industry](/RadwareNext/images/icons/icon-industry.svg)](/solutions/industries/)
  + [Carriers &
    Service Providers](/solutions/#solutions-service-providers)
  + [eCommerce](/solutions/ecommerce/)
  + [Education](/solutions/education/)
  + [Financial
    Services](/solutions/financial/)
  + [Government](/solutions/government/)
  + [Healthcare](/solutions/healthcare/)
  + [MSSPs](/solutions/build-business/)
  + [SaaS](/solutions/saas/)
* [![Menu Application Protection](/RadwareNext/images/icons/menu-solutions.svg)
  Application Protection](/solutions/application-protection-service/)
  + [Protect Web Applications](/solutions/application-protection-service/)
  + [Secure
    APIs](/solutions/api-protection/)
  + [Mitigate Bad Bots &
    Automated Threats](/products/bot-manager/)
  + [Stop Supply Chain Attacks](/solutions/client-side-protection/)
  + [Mitigate Web DDoS Attacks](/solutions/cloud-web-ddos-protection/)
  + [Compliance](/solutions/compliance/)
  + [Discover & Analyze
    Vulnerabilities](/security/security-analysis-services/)
  + [Open
    Banking](/solutions/open-banking-cybersecurity/)
* [![Menu DDoS Protection](/RadwareNext/images/icons/menu-ddos-protection.svg)
  DDoS Protection](/solutions/ddos-protection/)
  + [Protect Your Infrastructure](/solutions/ddos-protection/)
  + [Mitigate Web DDoS &
    Encrypted Threats](/solutions/web-ddos-protection/)
  + [Stop
    DNS Attacks](/solutions/dns-ddos-protection/)
  + [Compliance](/solutions/compliance/)
  + [Advanced Network analytics](/solutions/cloud-network-analytics/)
  + [AI SOC Xpert](/products/ai-soc-xpert/)
* [![Menu Application Delivery](/RadwareNext/images/icons/menu-app-delivery.svg)
  Application Delivery](/solutions/adc-hybrid-environments/)
  + [SSL Inspection,
    Offloading & Acceleration](/solutions/ssl-inspection/)
  + [Automated App
    Delivery for Private Clouds](/solutions/alteon-automation/)
  + [Secured Application
    Delivery](/solutions/application-delivery-and-protection/)

#### Products

* [![Menu Application Protection](/RadwareNext/images/icons/menu-solutions.svg)
  Application Protection](/products/#products-application-protection)
  + [Cloud WAF](/products/cloud-waf-service/)
  + [Bot Manager](/products/bot-manager/)
  + [API
    Protection](/solutions/api-protection/)
  + [Web DDoS Protection](/solutions/cloud-web-ddos-protection/)
  + [Client-Side Protection](/solutions/client-side-protection/)
  + [Threat Intelligence](/products/threat-intelligence-service/)
  + [Kubernetes
    WAAP](/products/kubernetes-waf/)
  + [Alteon
    Integrated WAF](/products/appwall/)
* [![Menu DDoS Protection](/RadwareNext/images/icons/menu-ddos-protection.svg)
  DDoS Protection](/products/#products-ddos-protection)
  + [Cloud DDoS Protection
    Service](/products/cloud-ddos-services/)
  + [Web DDoS Protection](/solutions/cloud-web-ddos-protection/)
  + [DefensePro X](/products/defensepro/)
  + [Cyber
    Controller](/products/cyber-controller/)
  + [Threat Intelligence](/products/threat-intelligence-service/)
* [![Menu Application Delivery](/RadwareNext/images/icons/menu-app-delivery.svg)
  Application Delivery](/products/#products-application-delivery)
  + [Alteon](/products/alteon/)
  + [LinkProof NG](/products/linkproofng/)
  + [Cyber
    Controller](/products/cyber-controller/)
  + [SSL
    Inspection](/solutions/ssl-inspection/)

#### [Partners](/partners/)

#### Company

* + [WHY RADWARE?](/about/why-radware/)
  + [CUSTOMERS](/customers/)
  + [DIVERSITY & INCLUSION](/corporategovernance/dei-mission/)
  + [INVESTORS](/ir/)
  + [PARTNERS](/partners/)
  + [LOCATIONS](/locations/)
  + [CAREERS](/careers/)
  + [TRAINING](/training/)
  + [CONTACT US](/contactus/)

#### Resources

* [![Menu Documents](/RadwareSite/MediaLibraries/Images/Icons/rdw_adaptive_security_icon.svg)
  Documents](/documents/)
  + [White Papers](/documents/?type=WhitePapers6442498600)
  + [Research](/documents/?type=Research6442499639)
  + [Case Studies](/documents/?type=CaseStudy6442498604)
  + [Data Sheets](/documents/?type=DataSheets6442498599)
  + [Solution Briefs](/documents/?type=SolutionsBrief6442498614)
  + [Infographics](/documents/?type=Infographics6442499495)
  + [Integration Guides](/documents?type=IntegrationGuides6442498618)
  + [eGuides](/documents/?type=eGuide6442499487)
  + [Analyst Report](/documents/?type=AnalystReport6442498602)
  + [Tech Specs](/documents/?type=TechSpecs6442498616)
* [![Menu Events](/RadwareSite/MediaLibraries/Images/Icons/rdw_events_icon.svg)
  Events](/newsroom/events/)
  + [Webinars & Virtual
    Events](/newsroom/events/)
  + [In Person Events](/newsroom/events/in-person/)
* [![Menu Security Research Center](/RadwareSite/MediaLibraries/Images/icons2018/rdw_cloud_workload_protection_icon.svg)
  Security Research Center](/security/)
  + [Threat Alerts](/security/threat-advisories-attack-reports/)
  + [Threat Analysis Center](/threat-analysis-report/)
  + [Live Threat Map](https://livethreatmap.radware.com/)
  + [Security Research &
    Reports](/security/research/)
  + [CyberPedia](/cyberpedia/)
* [![Menu Free Assessment Tools](/RadwareSite/MediaLibraries/Images/Icons/rdw_assesment_tools01_icon.svg)
  Free Assessment Tools](/security/security-analysis-services/)
  + [API Vulnerability Scanner](/security/security-analysis-services/api-vulnerability-scanner/)
  + [Bad Bot Analyzer](/security/security-analysis-services/bad-bot-analyzer/)
  + [Bad Bot Vulnerability
    Scanner](/security/security-analysis-services/bad-bot-vulnerability-scanner/)
  + [Application
    Vulnerability Analyzer](/security/security-analysis-services/application-vulnerability-analyzer/)
  + [API Vulnerability Scanner](/security/security-analysis-services/api-vulnerability-scanner/)
* [![Menu Blog](/RadwareSite/MediaLibraries/Images/Icons/rdw_blog_icon.svg)
  Blog](/blog/)
  + [Application Delivery](/blog/applicationdelivery/)
  + [Application Protection](/blog/application-protection/)
  + [DDoS Protection](/blog/ddos-protection/)
  + [Threat Intelligence](/blog/threat-intelligence/)
  + [Customers](/blog/customers/)
  + [Partners](/blog/partners/)
  + [Public Cloud Protection](/blog/public-cloud-protection/)
  + [Service
    Providers](/blog/service-providers/)

#### [Support](https://support.radware.com/)

##### [About Radware](/about)

* [Why Radware?](/about/why-radware/)
* [Customers](/customers/)
* [Partners](/partners/)
* [Investor Relations](/ir/)
* [Diversity & Inclusion](/corporategovernance/dei-mission/)
* [Corporate
  Responsibility](/corporategovernance/)
* [Careers](/careers/)
* [Locations](/locations/)
* [Contact Us](/contactus/)

##### [Online Services](/online-services)

* [Support](https://support.radware.com/)
* [Training](/training/)
* [Portals](https://enablement.radware.com)
* [Cloud Services Portal](https://portal.radwarecloud.com/login)
* [Radware Linkers](https://portals.radware.com/Customer/Home/Forum/)
* [Knowledge
  Base](https://support.radware.com)
* [Professional
  Services](/support/professionalservices/)

##### [News Room](/newsroom/)

* [Press
  Releases](/newsevents/pressreleases/)
* [Media
  Coverage](/newsevents/mediacoverage/)
* [Digital Events](/newsroom/events/)
* [In
  Person Events](/newsroom/events/in-person/)
* [Awards](/newsroom/awards/)
* [Certifications](/newsroom/certifications/)
* [Media Kit](/newsroom/mediakit/)

##### [Engage With Us](/community/)

* [Blog](/blog/)
* [Live
  Threat Map](https://livethreatmap.radware.com)

[![](/RadwareNext/images/social-icons/facebook.svg)](https://www.facebook.com/Radware)
[![](/RadwareNext/images/social-icons/youtube.svg)](https://www.youtube.com/user/radwareinc)
[![](/RadwareNext/images/social-icons/linkedin.svg)](https://www.linkedin.com/company/radware)
[![](/RadwareSite/MediaLibraries/Images/icons-social/x.svg)](https://twitter.com/radware)

© Copyright 2025 Radware – All Rights
Reserved.

* [Sitemap](/sitemap/)
* [Privacy
  Policy](/privacypolicy/)
* [Site Feedback](/feedback/)
* [Terms of Use](/termsofuse/)
* [Legal Notice](/legalnotice/)
* [Accessibility
  Statement](/accessibility-statement/)

[Privacy
Policy](/privacypolicy.aspx/)  |
[Terms of Use](/termsofuse/)  |
[Legal Notice](/legalnotice/)

##### Local Websites

×

* [English (US)](https://radware.com/)
* [Chinese](https://cn.radware.com/)
* [Korean](https://kr.radware.com/)

* [German](https://de.radware.com/)
* [French](https://fr.radware.com/)

* [Japanese](https://jp.radware.com/)
* [Spanish](https://es.radware.com/)


