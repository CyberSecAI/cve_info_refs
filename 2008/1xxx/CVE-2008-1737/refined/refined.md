```
{
  "vulnerability_details": {
    "root_cause": "Insufficient argument validation of hooked SSDT functions.",
    "weaknesses": [
      "The Sophos Antivirus 7.x driver hooks the 'NtCreateKey' SSDT function. When this hooked function is called, it retrieves the 'ObjectAttributes' parameter, which contains a handle and a pointer to an 'UNICODE_STRING' structure. The driver then retrieves the 'Length' field from the 'UNICODE_STRING' structure without proper validation. This length is later used in a 'ProbeForRead' operation. If a crafted 'UNICODE_STRING' structure with a length of zero is provided by a user-mode application, 'ProbeForRead' will not raise any exception even if the provided address is invalid. Subsequently, the driver will dereference the invalid address, leading to a system crash.",
       "The vulnerability is triggered because the driver does not validate if the length parameter within the UNICODE_STRING structure is valid before passing it to ProbeForRead. This allows for a crafted UNICODE_STRING structure with an invalid buffer pointer and a zero length to bypass the ProbeForRead check, and eventually crash the system when the buffer is dereferenced.",
      "The issue stems from the lack of proper validation on the length parameter of UNICODE_STRING structure before using it in ProbeForRead"
    ],
    "impact": "Denial of Service (DoS) leading to a system crash (BSOD).",
    "attack_vectors": "Local exploitation through a crafted user-mode application calling the vulnerable kernel function.",
    "attacker_capabilities": "The attacker needs to be able to execute code locally on the target system."
  },
  "affected_products": [
    "Sophos Antivirus 7.0.5 for Windows 2000, 2003 and XP"
  ],
    "more_details": "The vulnerability exists in the 'NtCreateKey' function hook within Sophos Antivirus 7.x. The issue occurs because of a lack of validation on the `Length` field of the `UNICODE_STRING` structure passed to the hooked function. When a user-mode application calls `NtCreateKey` with a crafted `UNICODE_STRING` structure where the `Length` field is set to 0, and the Buffer field points to invalid memory, the `ProbeForRead` check will not raise an exception since the length parameter is zero.  Later, when the driver dereferences the `Buffer` pointer of the crafted structure, it will result in a crash as it will attempt to access invalid memory. This can be triggered locally with minimal permissions."
}
```