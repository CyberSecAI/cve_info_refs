=== Content from code.google.com_b09d5a4c_20250125_042848.html ===

[# Google Code](/archive/)

[## Archive](/archive/)
[Skip to content](#content)

The Google Code Archive requires JavaScript to be enabled in your browser.

* [Google](//www.google.com/)
* [About Google](//www.google.com/intl/en/about/)
* [Privacy](//www.google.com/intl/en/policies/privacy/)
* [Terms](//www.google.com/intl/en/policies/terms/)



=== Content from scarybeastsecurity.blogspot.com_b9028ce4_20250125_042851.html ===


# [Security](https://scarybeastsecurity.blogspot.com/)

Hacking everything, by Chris Evans / scarybeasts

## Monday, November 24, 2008

### Cookie forcing

It's time to write some coherent details about "cookie forcing", which is the name I've given for a new way to attempt to break into secure https sessions. This is surfjacking to the max - attacks an active MITM (man-in-the-middle) can attempt against an https application that follows best practices like marking its cookies secure; avoiding XSS and XSRF; etc.

Cookie forcing relies on slightly broken browser behaviour. Namely, an http response can set, overwrite or delete cookies used by an https session. This is a minor violation of https session integrity that can have significant consequences. Unfortunately, the cookie model works this way **by specification** and the addition of the Secure flag did not clean this up.

This means that every cookie value used by https applications could be malicious. This is somewhat counter-intuitive for developers of https-only apps, so it's understandable that vulnerabilities result from too much trust here. Looking at specific classes of vulnerability that can result from this, we have:

* XSS
* XSRF
* Login XSRF
* DoS
* Logic abuse

Regarding XSS, any trust of the cookie value to be properly escaped (before e.g. pasting it into the DOM or `document.write`) is a vulnerability. Properly escaping the cookie value on write and relying on https for integrity is not sufficient, unfortunately.

There's another increasingly common application construct which cookie forcing can abuse to cause XSS. An increasing number of frameworks are writing JSON into cookie values for fast deserialization of complex data types. Some of these frameworks read the values back in using the fast option of e.g. `eval('var x = ' + getCookieValue('STATE'))`. I'm sure you can see the pitfall here.

Regarding XSRF, there is a certain type of XSRF protection that can be subverted by cookie forcing. If the XSRF protection is a simple comparison between a URL parameter value and a cookie value, the active MITM attacker can now fake both of these. The mitigation is to ensure that the value is cryptographically attached to the current user's session via e.g. an HMAC.

Regarding login XSRF, I recommend [the very recent paper by Adam Barth, Collin Jackson and John Mitchell](http://www.adambarth.com/papers/2008/barth-jackson-mitchell-b.pdf) which covers this topic nicely. These guys are great - they don't just moan about breakage in the browsers, they work to fix it up too. See the "Cookie-Integrity" header suggestion. In the absence of this header, one possible mitigation is to randomize the name of the session cookie. But that's going to a somewhat extreme measure to work around a browser deficiency. I'm not going to recommend every web app does something complex, when the fix should be driven by the browsers. Also note that logout XSRF will be near impossible to fix; an attacker can just spray cookies into a browser until it drops the session cookie.

Regarding DoS and logic abuse, there is the possibility to mess with any cookies an https app uses, to try and make is misbehave when it encounters unexpected values. The mitigation is to sign any sensitive cookies (tying to the current user, preferably current session).

Cookie forcing works very well in conjunction with [my previous post regarding browser background http requests](http://scarybeastsecurity.blogspot.com/2008/11/owning-paranoid-browser-background.html). In such an attack, a victim won't see anything untoward. The redirections all happen behind the scenes and do not change the URL status bar.

Remember that this attack is only relevant against https applications without any more obvious vulnerabilities. You need an active MITM capability (e.g. public wireless) to attempt it. Any applications without https support are already ruined against such a threat model.

*Credit to Filipe Almeida for being about two years ahead of the rest of the web app security community, as usual. The XSRF issue was his originally, and a long time ago. More recently, there appears to have been an [independent discovery by Collin Jackson and friends at Stanford](http://crypto.stanford.edu/websec/csrf/csrf.ppt).*

Posted by

[Chris Evans](https://www.blogger.com/profile/01004765479735675808 "author profile")

at

[11:32 AM](https://scarybeastsecurity.blogspot.com/2008/11/cookie-forcing.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=3024470480937744884&postID=4999509871635538870&from=pencil "Edit Post")

#### 3 comments:

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

If you're a pure HTTPS application, which HTTP responses are you overwriting to force in your malicious cookies?

[November 25, 2008 at 8:47 AM](https://scarybeastsecurity.blogspot.com/2008/11/cookie-forcing.html?showComment=1227631620000#c6086000475119032592 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=6086000475119032592 "Delete Comment")

[![](//www.blogger.com/img/blogger_logo_round_35.png "Chris Evans")](https://www.blogger.com/profile/01004765479735675808)
[Chris Evans](https://www.blogger.com/profile/01004765479735675808)
said...

Hey Anonymous,

There are two possibilites:
1) Hijack HTTP responses from other sites that the victim is browsing in parallel.
2) Hijack HTTP responses that the browsing is sending in the background (see previous post).

Let's say you're logged into https://bank.com/. In both cases above, the HTTP response can be forged so that it redirects to http://bank.com/. This results in a new HTTP request to http://bank.com/, and the response here can again be forged, this time to set malicious cookies.

[November 25, 2008 at 3:19 PM](https://scarybeastsecurity.blogspot.com/2008/11/cookie-forcing.html?showComment=1227655140000#c5449291659154644983 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=5449291659154644983 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

At first glance it seems that HSTS may stop this (aside from the first visit).

[August 5, 2012 at 7:52 AM](https://scarybeastsecurity.blogspot.com/2008/11/cookie-forcing.html?showComment=1344178324914#c408656261517407351 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=408656261517407351 "Delete Comment")

[Post a Comment](https://www.blogger.com/comment/fullpage/post/3024470480937744884/4999509871635538870)

[Newer Post](https://scarybeastsecurity.blogspot.com/2008/12/firefox-cross-domain-text-theft.html "Newer Post")

[Older Post](https://scarybeastsecurity.blogspot.com/2008/11/owning-paranoid-browser-background.html "Older Post")

[Home](https://scarybeastsecurity.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://scarybeastsecurity.blogspot.com/feeds/4999509871635538870/comments/default)

Subscribe to my Twitter feed: [@scarybeasts](https://twitter.com/scarybeasts).

## Subscribe To ScarybeastSecurity

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/posts/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F4999509871635538870%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F4999509871635538870%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/4999509871635538870/comments/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

## Blog Archive

* ►
  [2021](https://scarybeastsecurity.blogspot.com/2021/)
  (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2021/05/)
    (1)

* ►
  [2020](https://scarybeastsecurity.blogspot.com/2020/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2020/12/)
    (1)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2020/11/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2020/07/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2020/06/)
    (3)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2020/04/)
    (1)

* ►
  [2017](https://scarybeastsecurity.blogspot.com/2017/)
  (10)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2017/09/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2017/06/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2017/05/)
    (7)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2017/03/)
    (1)

* ►
  [2016](https://scarybeastsecurity.blogspot.com/2016/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2016/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2016/11/)
    (4)

* ►
  [2015](https://scarybeastsecurity.blogspot.com/2015/)
  (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2015/07/)
    (1)

* ►
  [2014](https://scarybeastsecurity.blogspot.com/2014/)
  (5)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2014/09/)
    (2)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2014/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2014/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2014/02/)
    (1)

* ►
  [2013](https://scarybeastsecurity.blogspot.com/2013/)
  (2)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2013/12/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2013/02/)
    (1)

* ►
  [2012](https://scarybeastsecurity.blogspot.com/2012/)
  (9)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2012/09/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2012/07/)
    (1)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2012/04/)
    (2)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2012/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2012/02/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2012/01/)
    (1)

* ►
  [2011](https://scarybeastsecurity.blogspot.com/2011/)
  (10)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2011/07/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2011/05/)
    (2)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2011/04/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2011/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2011/02/)
    (2)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://scarybeastsecurity.blogspot.com/2010/)
  (11)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2010/10/)
    (1)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2010/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2010/08/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2010/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2010/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2010/03/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2010/01/)
    (3)

* ►
  [2009](https://scarybeastsecurity.blogspot.com/2009/)
  (29)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2009/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2009/11/)
    (2)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2009/10/)
    (3)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2009/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2009/08/)
    (2)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2009/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2009/06/)
    (4)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2009/05/)
    (3)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2009/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2009/02/)
    (4)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2009/01/)
    (1)

* ▼
  [2008](https://scarybeastsecurity.blogspot.com/2008/)
  (20)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2008/12/)
    (2)
  + ▼
    [November](https://scarybeastsecurity.blogspot.com/2008/11/)
    (5)
    - [Cookie forcing](https://scarybeastsecurity.blogspot.com/2008/11/cookie-forcing.html)
    - [Owning the paranoid: browser background traffic](https://scarybeastsecurity.blogspot.com/2008/11/owning-paranoid-browser-background.html)
    - [E4X and a Firefox XML injection bug](https://scarybeastsecurity.blogspot.com/2008/11/e4x-and-firefox-xml-injection-bug.html)
    - [Firefox cross-domain image theft... and the "302 r...](https://scarybeastsecurity.blogspot.com/2008/11/firefox-cross-domain-image-theft-and.html)
    - [PacSec presentation](https://scarybeastsecurity.blogspot.com/2008/11/pacsec-presentation.html)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2008/10/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2008/08/)
    (3)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2008/07/)
    (5)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2008/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2008/02/)
    (3)

## My other stuff

* [My security advisories](http://scary.beasts.org/)
* [vsftpd home page](http://vsftpd.beasts.org/)
* [Tavis' security advisories](http://taviso.decsystem.org/research.html)

|  |  |
| --- | --- |

Simple theme. Theme images by [gaffera](https://www.istockphoto.com/googleimages.php?id=4072573&platform=blogger&langregion=en). Powered by [Blogger](https://www.blogger.com).



=== Content from michael-coates.blogspot.com_86b06e04_20250125_042850.html ===


# [A Journey in Security](http://michael-coates.blogspot.com/)

## Pages

* [Home](http://michael-coates.blogspot.com/)
* [About](http://michael-coates.blogspot.com/p/about.html)
* [Twitter](http://michael-coates.blogspot.com/p/twitter.html)

## Friday, January 22, 2010

### Cookie Forcing - Trust your cookies no more

Cookies are most often used to simply hold and exchange the session id with the application server. However, in some cases an application decides to implement a custom cookie. We all know this is generally a dangerous idea because the user can easily tamper with their cookies.

But, did you know that any attacker can easily tamper with your cookies too? In fact, an attacker executing an HTTP based man-in-the-middle attack can edit any of your cookies for any site? This includes cookies that have been marked "secure" or are set and exchanged with a site purely over HTTPS.

What does this mean?

* Cookie integrity is dead. Any cookie can be modified by an attacker without any warnings to the user.
* Custom cookies must now be eliminated. Any predictable information in a cookie could be modified by an attacker to cause undesirable results for the victim.
* Cookie confidentiality is still secure. This issue allows an attacker to modify your cookies, but does not allow them to view your cookies.
* This attack is an HTTP MitM attack. This is important because there will not be any certificate error messages to the user, this attack is nearly undetectable.

I have to admit, I didn't discover this issue on my own. I stumbled upon it one day [here](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&ved=0CAcQFjAA&url=http%3A%2F%2Fscarybeastsecurity.blogspot.com%2F2008%2F11%2Fcookie-forcing.html&ei=mL1ZS6zEEJXmM6uuwZEP&usg=AFQjCNGw5Q__aM8VO0NpGD4Ud4KdW6AhKw&sig2=6pE_exJNeAnw2kIOaeHoDA). I couldn't believe this item had slipped by with little discussion for the past year. In my disbelief I setup a few test cases in IE8 and Firefox 3.5 to confirm it is true.

To fully illustrate the issue, take a look at this chart I put together. A few things to note:

* The man-in-the-middle never attempts to be in the middle of HTTPS traffic. That traffic stream is left untouched.
* The MitM simply waits for any unrelated HTTP request from the victim (your browser sends plenty of these for updates, google prediction searches, or any unrelated browsing by the user)
* The MitM intercepts and responds to an HTTP request with a meta refresh to the HTTP page of the site of the cookies to be attacked (http://bank.com in this case)
* The MitM then intercepts the HTTP request and responds with the set-cookie statement.
* Here is where the magic happens. The browser happily accepts the set-cookie statement from HTTP even though the cookies are marked "secure" and had previously been set via HTTPS.
* In the last step you'll note that the MitM cookie is now active for the victim.

Potential Solution:
Change browser behavior to disallow HTTP set-cookie messages to modify cookies that had been originally set via HTTPS set-cookie message.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgGrpr6Ih2gqr95F22QtpXgkHLNy1CttWfHJQGva4MUdgGcxjnsG7cCBW6Vs97edbq9gIBFI80kTktf4RpWqfFE5OVpLbUU4G2i79qVhKcqYhz6ja9nwHQXZ1lF_E9ckiSI9gr9vGpn2i4/s400/CookieForcing.jpg)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgGrpr6Ih2gqr95F22QtpXgkHLNy1CttWfHJQGva4MUdgGcxjnsG7cCBW6Vs97edbq9gIBFI80kTktf4RpWqfFE5OVpLbUU4G2i79qVhKcqYhz6ja9nwHQXZ1lF_E9ckiSI9gr9vGpn2i4/s1600-h/CookieForcing.jpg)

-[Michael Coates](http://michael-coates.blogspot.com/)

Posted by
Michael Coates

[Newer Post](http://michael-coates.blogspot.com/2010/01/chrome-supports-strict-transport.html "Newer Post")

[Older Post](http://michael-coates.blogspot.com/2010/01/appsensor-podcast-listen-now.html "Older Post")

[Home](http://michael-coates.blogspot.com/)

[Follow @\_mwc](https://twitter.com/_mwc)
[Tweets by \_mwc](https://twitter.com/_mwc)

![](https://www.linkedin.com/in/mcoates/)
![](https://www.linkedin.com/in/joshmcfarland/)
![](https://www.linkedin.com/in/bryanschreier/)

|  |  |
| --- | --- |

Simple theme. Powered by [Blogger](https://www.blogger.com).



=== Content from scarybeastsecurity.blogspot.com_1aa8b575_20250125_042852.html ===


# [Security](https://scarybeastsecurity.blogspot.com/)

Hacking everything, by Chris Evans / scarybeasts

## Wednesday, February 16, 2011

### Some less obvious benefits of HSTS

[HSTS](http://tools.ietf.org/html/draft-hodges-strict-transport-sec-02), standing for HTTP Strict Transport Security, is a relatively new standard that aims to bolster the strength of HTTPS connections.

Hopefully it's about to catch on. Google Chrome has supported HSTS for a while now, and [Firefox support is imminent](http://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/).

The stated benefits of HSTS include:

* Defenses against sslstrip-like attacks. The initial navigation to blah.com is automatically upgraded to HTTPS.

* Zero tolerance for certification problems. The user is not permitted to "click through" anything such as a self-signed cert.

HSTS also comes with some less obvious benefits and security boosts, which it's worth noting:

* Mixed-content defense. For same domain mixed-content situations, the fetches are automatically upgraded to HTTPS. This can sometimes sidestep nasty bugs.

* Secure cookie defense. It's a pretty egregious bug for an HTTPS-only site to fail to mark its cookies "Secure", but HSTS can defend against the cookie value being sent out plaintext.

* [Cookie forcing](http://scarybeastsecurity.blogspot.com/2008/11/cookie-forcing.html) defense. Cookie forcing is a pretty nasty MITM attack that I was playing with back in 2008. As long as HSTS is used in "includeSubDomains" mode, it can provide a defense against this subtle attack.

* Latency win. User who navigate to or bookmark the plain HTTP blah.com are automatically bounced straight to HTTPS, without having to go via an HTTP redirect

In the future, I'm hopeful HSTS can be extended to provide defenses against possibly rogue CAs.

Posted by

[Chris Evans](https://www.blogger.com/profile/01004765479735675808 "author profile")

at

[3:57 AM](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=3024470480937744884&postID=8652337038128359766&from=pencil "Edit Post")

#### 5 comments:

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

I'm totally with you on including for instance an optional flag "rememberRootCA"

This would mean we could have headers such as:

Strict-Transport-Security: max-age=15768000 ; includeSubDomains ; rememberRootCA

The new flag would instruct the browser to either point out the domain's root CA in its trusted CAs list, or save the fingerprint of the root CA certificate used to sign the server cert. This would effectively rule out subsequent man-in-the-middle attacks with rouge server certs signed by any of the 150-250 default root CAs trusted by the user's operating system or browser.

[February 16, 2011 at 7:25 AM](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html?showComment=1297869921279#c585437963086470264 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=585437963086470264 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "adrian")

adrian
said...

Defenses against sslstrip-like attacks. The initial navigation to blah.com is automatically upgraded to HTTPS.
-> not really, you assume you already have marked the site as a HSTS one.

Zero tolerance for certification problems.
-> I would not put all my money on that.

Mixed-content defense. For same domain mixed-content situations, the fetches are automatically upgraded to HTTPS.
-> perhaps or perhaps not, depends from where it loads the pages and how the "same domain"(exmaple.net and www.example.net may be the "same domain") was marked as an HSTS site(the HSTS vs canonical redirects issues).

I'm hopeful HSTS can be extended to provide defenses against possibly rogue CAs.
-> there is a proposed extension, lockCA. but things are not so simple though.

I wrote a HSTS post with HSTS currently (main) known issues:
http://www.carbonwind.net/blog/post/Random-SSLTLS-101-HTTP-Strict-Transport-Security.aspx

Cheers!
Adrian

[February 16, 2011 at 1:41 PM](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html?showComment=1297892475733#c6657375958069298511 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=6657375958069298511 "Delete Comment")

[![](//www.blogger.com/img/blogger_logo_round_35.png "Chris Evans")](https://www.blogger.com/profile/01004765479735675808)
[Chris Evans](https://www.blogger.com/profile/01004765479735675808)
said...

@adrian: the first and most significant problem (first http:// navigation not HSTS protected) is tackled via HSTS lists built in to the browser.

[February 16, 2011 at 3:23 PM](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html?showComment=1297898624631#c9208130986231897900 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=9208130986231897900 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

Maybe I'm missing something, but couldn't HSTS be arranged like the following for safe autonegotiation of HSTS?

1) If the HSTS policy is explicitly defined in the browser settings for a particular domain (ON or OFF), honor that.

2) But if (a) the client-side policy isn't defined for a domain, and (b) the user-agent attempts to initiate contact without TLS to a particular domain, first have the browser immediately try to get the HSTS policy over 443 TLS before doing anything else.

If the HSTS policy isn't available over 443 TLS, then the browser can operate without HSTS.

The big concern would be TLS handshake penalties. But if there's only one handshake penalty per domain for the duration of the browser window being open or if there's a notion of TTL for an HSTS policy (or both) it doesn't much matter.

To make this the default on most browsers, browser vendors could have the following message display after browser install or upgrade:

===
When you type in a web server name do you want to always try to connect securely?

(\*) Yes ( ) No

===

[February 18, 2011 at 10:24 AM](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html?showComment=1298053487574#c322816041354622813 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=322816041354622813 "Delete Comment")

[![](//resources.blogblog.com/img/blank.gif "lukepad")](http://3tech.org)
[lukepad](http://3tech.org)
said...

This is very good news, I hope HSTS will become a standard.

[February 19, 2011 at 10:25 AM](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html?showComment=1298139904917#c2338660587293274057 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=2338660587293274057 "Delete Comment")

[Post a Comment](https://www.blogger.com/comment/fullpage/post/3024470480937744884/8652337038128359766)

[Newer Post](https://scarybeastsecurity.blogspot.com/2011/02/i-got-accidental-code-execution-via.html "Newer Post")

[Older Post](https://scarybeastsecurity.blogspot.com/2011/01/harmless-svg-xslt-curiousity.html "Older Post")

[Home](https://scarybeastsecurity.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://scarybeastsecurity.blogspot.com/feeds/8652337038128359766/comments/default)

Subscribe to my Twitter feed: [@scarybeasts](https://twitter.com/scarybeasts).

## Subscribe To ScarybeastSecurity

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/posts/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F8652337038128359766%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F8652337038128359766%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/8652337038128359766/comments/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

## Blog Archive

* ►
  [2021](https://scarybeastsecurity.blogspot.com/2021/)
  (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2021/05/)
    (1)

* ►
  [2020](https://scarybeastsecurity.blogspot.com/2020/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2020/12/)
    (1)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2020/11/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2020/07/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2020/06/)
    (3)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2020/04/)
    (1)

* ►
  [2017](https://scarybeastsecurity.blogspot.com/2017/)
  (10)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2017/09/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2017/06/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2017/05/)
    (7)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2017/03/)
    (1)

* ►
  [2016](https://scarybeastsecurity.blogspot.com/2016/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2016/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2016/11/)
    (4)

* ►
  [2015](https://scarybeastsecurity.blogspot.com/2015/)
  (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2015/07/)
    (1)

* ►
  [2014](https://scarybeastsecurity.blogspot.com/2014/)
  (5)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2014/09/)
    (2)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2014/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2014/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2014/02/)
    (1)

* ►
  [2013](https://scarybeastsecurity.blogspot.com/2013/)
  (2)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2013/12/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2013/02/)
    (1)

* ►
  [2012](https://scarybeastsecurity.blogspot.com/2012/)
  (9)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2012/09/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2012/07/)
    (1)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2012/04/)
    (2)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2012/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2012/02/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2012/01/)
    (1)

* ▼
  [2011](https://scarybeastsecurity.blogspot.com/2011/)
  (10)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2011/07/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2011/05/)
    (2)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2011/04/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2011/03/)
    (3)
  + ▼
    [February](https://scarybeastsecurity.blogspot.com/2011/02/)
    (2)
    - [I got accidental code execution via glibc?!](https://scarybeastsecurity.blogspot.com/2011/02/i-got-accidental-code-execution-via.html)
    - [Some less obvious benefits of HSTS](https://scarybeastsecurity.blogspot.com/2011/02/some-less-obvious-benefits-of-hsts.html)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://scarybeastsecurity.blogspot.com/2010/)
  (11)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2010/10/)
    (1)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2010/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2010/08/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2010/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2010/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2010/03/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2010/01/)
    (3)

* ►
  [2009](https://scarybeastsecurity.blogspot.com/2009/)
  (29)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2009/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2009/11/)
    (2)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2009/10/)
    (3)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2009/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2009/08/)
    (2)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2009/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2009/06/)
    (4)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2009/05/)
    (3)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2009/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2009/02/)
    (4)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2009/01/)
    (1)

* ►
  [2008](https://scarybeastsecurity.blogspot.com/2008/)
  (20)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2008/12/)
    (2)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2008/11/)
    (5)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2008/10/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2008/08/)
    (3)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2008/07/)
    (5)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2008/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2008/02/)
    (3)

## My other stuff

* [My security advisories](http://scary.beasts.org/)
* [vsftpd home page](http://vsftpd.beasts.org/)
* [Tavis' security advisories](http://taviso.decsystem.org/research.html)

|  |  |
| --- | --- |

Simple theme. Theme images by [gaffera](https://www.istockphoto.com/googleimages.php?id=4072573&platform=blogger&langregion=en). Powered by [Blogger](https://www.blogger.com).



=== Content from hacks.mozilla.org_c0b34f80_20250125_042849.html ===

# [Mozilla Hacks](https://hacks.mozilla.org)

[Hacks on YouTube](http://www.youtube.com/user/mozhacks "YouTube")
[@mozhacks on Twitter](https://twitter.com/mozhacks "Twitter")
[Hacks RSS Feed](https://hacks.mozilla.org/feed/ "RSS Feed")
[Download Firefox](https://www.mozilla.org/firefox/download/thanks/?utm_source=hacks.mozilla.org&utm_medium=referral&utm_campaign=header-download-button&utm_content=header-download-button)

# Firefox 4: HTTP Strict Transport Security (force HTTPS)

### Avatar photo

*This article is about a new HTTPS header: `Strict-Transport-Security`, which force a website to be fetched through HTTPS. This feature will be part of Firefox 4.*

How do you type URLs?

Do you prefix them with **http://** or **https://** systematically? Or do you just type **example.com** and let your browser add **http://**, like most of the people do?

If a web page provide has an **https** version but you access it through **http**, what happens? The **http** version of the Website re-direct you to the **https**, but you first *talked* to the non-encrypted version of the website.

These behaviors can be exploited to run a *[man-in-the-middle](http://en.wikipedia.org/wiki/Man-in-the-middle_attack)* attack.

To avoid this, you may want to force your website to be visited through **https** to transform any **http://x.com** request to **https://x.com** (with no client-server dialog).

[Sid Stamm](http://blog.sidstamm.com/) recently integrated HTTP Strict Transport Security (HSTS) into

Firefox. HSTS, specified in an [IETF draft](http://tools.ietf.org/html/draft-hodges-strict-transport-sec-02), allows sites to specify when they wish to be accessed only over **https**.

A website can specify strict transport security for their domain via an HTTP header sent by the server set **during an HTTPS response**:

```

Strict-Transport-Security: max-age=15768000

```

or

```

Strict-Transport-Security: max-age=15768000 ; includeSubDomains

```

`max-age` sets how long to remember the forced HTTPS (seconds). If

`includeSubDomains` is set, then this rule will apply to all the sub-domains too.

In the future, any requests to **x.com** are modified to be via **https** if they are attempted through **http** before the request hits the network.

*This header is not considered during a non-encrypted HTTP transaction because the User-Agent doesn’t know if the **https** actually exists and also because the header can be injected by an attacker.*

## About [Paul Rouget](http://paulrouget.com) Paul is a Firefox developer. * [paulrouget.com](http://paulrouget.com) [More articles by Paul Rouget…](https://hacks.mozilla.org/author/paul/)

## Discover great resources for web development

Sign up for the Mozilla Developer Newsletter:

E-mail

I'm okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now

## Thanks! Please check your inbox to confirm your subscription.

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an email from us.

---

### 41 comments

1. **zoonman**
   > This is a really good idea, tell browser about HTTPS, but HTTPS is create greater load on server than regular HTTP. This no good decision for highload projects, social and media network.

   [August 26th, 2010 at 10:59](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4807 "Permanent link to this comment by zoonman")
   1. **kl**
      > This has been debunked. Gmail switched to all-HTTPS and used only 1% extra CPU.
      >
      > <http://www.imperialviolet.org/2010/06/25/overclocking-ssl.html>

      [July 12th, 2011 at 15:01](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4847 "Permanent link to this comment by kl")
3. **Ferdinand**
   > @ zoonman Guess you didn’t read the article where they mention that the website has to choose to enable this feature.

   [August 26th, 2010 at 14:00](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4808 "Permanent link to this comment by Ferdinand")
   1. **zoonman**
      > Your right!

      [August 26th, 2010 at 22:51](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4811 "Permanent link to this comment by zoonman")
5. **Tomer**
   > Why this is good for? I prefer, for example, the secured version of Twitter to be persistent. Why is it better than just forcing the site to serve us content over HTTPS?

   [August 26th, 2010 at 14:23](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4809 "Permanent link to this comment by Tomer")
   1. **Sid**
      > @Tomer: I think you have in mind those security-savvy users who intentionally access a site over HTTPS because they wants to protect themselves. HSTS helps sites protect \*all\* their users (not just the security-savvy ones) by telling the browser to use HTTPS by default. The goal is to give a tool to the sites so they can silently protect their users from these MITM attacks.
      >
      > Perhaps in an ideal world all sites would use HTTPS, or that would be the default, but this is not the case. As @zoonman mentioned, it’s not always important or even sometimes impractical.

      [August 26th, 2010 at 16:38](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4810 "Permanent link to this comment by Sid")
      1. **Tomer**
         > I do prefer to choose HTTPS connection by myself, as some sites do not transfer us automatically to the secured version, and even doesn’t restrict cookies being set-up on the secured zone to only the secured zone. Telling people to access the regular version to see if the site suggest switching to HTTPS is less secured, as it require an HTTP request, which may transfer the user authentication cookie in plain text.
         >
         > How is it better than using HTTP 101 SWITCH status code?

         [August 26th, 2010 at 23:53](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4812 "Permanent link to this comment by Tomer")
         1. **Sid**
            > @Tomer: The HTTP 101 SWITCH status code works most of the time, but when a user is on an unsafe network a man-in-the-middle attacker could intercept that response causing the user to instead see an HTTP copy of the site controlled by the attacker.
            >
            > With HSTS, the user only has to get to the HTTPS version of the site once (probably using the HTTP 101 reply you mention), where the Strict-Transport-Security header is provided to the browser. After that, the browser will automatically assume HTTPS for that site in the future greatly reducing chance of man-in-the-middle attacks and also reducing the number of insecure HTTP requests sent to their server.
            >
            > In general, \*you\* are going to be mostly protected already since you manually pick HTTPS, but for those users that don’t notice security indicators this is a way for the site to help them out.

            [August 27th, 2010 at 07:47](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4814 "Permanent link to this comment by Sid")
7. **James**
   > @Tomer: HTTP 101 is issued as a request sent by the client to the server. HSTS is a request sent by the server to the client.
   >
   > @Sid: Thanks for your hard work. I know that PayPal was involved in the development of the draft, but I wish you had used another example domain but x.com.

   [August 27th, 2010 at 00:28](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4813 "Permanent link to this comment by James")
9. **annie**
   > Will force HTTPS prevent the likes of the Palo Alto Application Firewall from performing a man in the middle attack so that it can decrypt and analyse the HTTPS traffic. As the Palo Alto Application Firewall can intercept all HTTPS traffic by providing its own certificate to the client browser, and then using its own certificate to connect to the website and thus perform a man in the middle attack for traffic analysis. Can DNS-Sec be used in conjunction with HTTPS for certificate verification, so that a browser can perform a DNS query to obtain to obtain the encrypted checksum of the valid certificate. If the HTTPS certificate checksum does not match the encrypted DNS-Sec record, the browser indicates a “Security Violation – Man in the middle attack detected”

   [August 29th, 2010 at 01:08](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4815 "Permanent link to this comment by annie")
   1. **Sid**
      > @annie: I don’t know the specifics of how the firewall works, but the firewall will have to get valid certificates for each site it intercepts that chain up to the root certificates in Firefox. Self-signed certificates will result in the usual “connection error” page, but for HSTS hosts, the user won’t be able to ignore the warning and will have no way to access the site via the erroneous certificate.
      >
      > Potentially DNS-Sec could be useful, but we’re still exploring how that can be used to tighten site security in conjunction with features like HSTS.

      [August 31st, 2010 at 08:55](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4819 "Permanent link to this comment by Sid")
11. **Sten**
    > Hi \*
    >
    > A simple DNS spoof will IMHO bypass HSTS.
    >
    > Keep also in mind that a SSL connection based on server certificate only is also vulnerable for MiM attacks.
    >
    > No, HSTS is not the solution. We must find something better.
    >
    > g,
    >
    > sten

    [August 29th, 2010 at 04:42](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4816 "Permanent link to this comment by Sten")
13. **Mike**
    > Since users are generally uneducated in the use of browsers and internet, I doubt HSTS will prevent Man-in-the-Middle.
    >
    > Main reason being that users will frequently still trust an untrusted SSL certificate and simply click yes.
    >
    > Also enforcing HTTPS will not solve the problem from an information point of view.
    >
    > Frequently a website’s HTTP pages contain different information than the HTTPS version of the website.

    [August 30th, 2010 at 23:12](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4817 "Permanent link to this comment by Mike")
15. **Sid**
    > @Sten: While DNS spoofing will throw things off a bit, that attack still requires the attacker to get a valid certificate for the spoofed site that chains up to a CA in Firefox.
    >
    > @Mike: for brevity and to not bore non-technical audiences, I omitted some technical details in the blog entries. If you look at the spec, HSTS means more than just “access me over https in the future”. It also requires the browser to drop the connection with \*no recourse\* if an invalid cert is encountered. This means if mozilla.org is an HSTS host, not only will HTTPS connections be automatic, but any self-signed, expired, or otherwise erroneous certificate will cause the connection to drop and the users won’t be presented with a prompt to get around the blockage.
    >
    > In our specific implementation, the usual certificate error page has an “add exception” button for users who “know what they’re doing.” If the connection being stopped is for an HSTS host, that button won’t be there. (Also, if an invalid certificate exception was added in the past, it will be ignored once the host has been given HSTS status.)

    [August 31st, 2010 at 08:52](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4818 "Permanent link to this comment by Sid")
17. **Sten**
    > @sid: No, after spoofing DNS I will use vanilla HTTP connection.
    >
    > Simple and effective.
    >
    > @mike: I agree with you about the (ICT) ignorance of the end user.

    [September 1st, 2010 at 01:47](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4820 "Permanent link to this comment by Sten")
    1. **Sid**
       > @Sten: If you spoof the DNS record, you get to control the traffic, but the browser will still require HTTPS to all hosts (regardless of the IP address) that have HSTS set. For example, if I go to <https://useshsts.com> at home, where Firefox sees that the site wants HSTS. I then go to a cafe where you spoof DNS and redirect me to your site, my browser will refuse to let me connect to your site over HTTP since it requires a valid, secure HTTPS connection to useshsts.com.
       >
       > Maybe I misunderstand the attack, can you elaborate?

       [September 1st, 2010 at 15:35](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4821 "Permanent link to this comment by Sid")
19. **Sten**
    > @sid: You discribe a cashed data from previous connection. In that case you might be protected.
    >
    > My attack will work when this cache is non existing.
    >
    > HSTS will lookup the DNS to determine if HSTS action is required.
    >
    > Now if I spoof the DNS, and I mean DNS spoof, not IP spoofing using ARP spoof for example, I will gain control.
    >
    > The browser will not use HSTS simply by the fact that the spoofed DNS will not ask the browser to do so.
    >
    > How do you solve the following situation?
    >
    > Website used HSTS in the past but wants to stop using it. The users are unable to connect? the HTTP site because of the cashed data?!

    [September 2nd, 2010 at 12:10](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4822 "Permanent link to this comment by Sten")
    1. **Sid**
       > @Sten, yes, for HSTS to work you have to successfully visit the real site via HTTPS once.
       >
       > HSTS isn’t tied into DNS at all, so I’m not sure how that ties into your attack. The server’s indication to use HSTS comes through HTTP.
       >
       > To prevent the bootstrapping need, we could pre-load sites that want HSTS when we ship Firefox — much like the CA roots, these are sites that will never be requested over HTTP. Additionally, we could add a UI so users can set up HTTPS-only-access for sites that they want to only access over HTTPS (and we’re working on this).
       >
       > A site’s Strict-Transport-Security header is considered from each HTTPS response that Firefox sees. The most recent data from that header is understood to be an update for the site’s preference. If a site wants to stop using HSTS, it can set “max-age=0” to tell the browser not to remember HSTS for the site.

       [September 2nd, 2010 at 13:57](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4823 "Permanent link to this comment by Sid")
21. **Sten**
    > @sid: Sorry, somehow I mixed DNS sec and HSTS.
    >
    > The preload described by you will solve the security issue we discussed previously. Also the attack scenario is less or more academical. The very first visit must be the spoofed one…The distribution will probably create more pain than it will cure.
    >
    > Let’s look at the following situation:
    >
    > The hacker will spoof the original website (DNS spoof) and provide the
    >
    > max-age=0 when the browser request arrives at the evil web server page.

    [September 2nd, 2010 at 14:30](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4824 "Permanent link to this comment by Sten")
    1. **Sid**
       > @Sten: The situation you mention shouldn’t happen. Once HSTS is set for a site, connections will only be made via HTTPS and only if the HTTPS connection has no errors. Not only that, but the Strict-Transport-Security header is ignored unless the connection is over HTTPS and there are no certificate errors (regardless of whether or not the site already has HSTS set). That means the attacker will need to have a valid SSL certificate for the site he is spoofing in order to change the HSTS state of the site.

       [September 2nd, 2010 at 14:36](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4825 "Permanent link to this comment by Sid")
23. **Sten**
    > @sid: Ok, this sounds good. The software in the browser takes actions in stead of the user. Good because the joe user is not a security expert.
    >
    > HSTS looks promising, you convinced me… at least 4 now ;-)

    [September 2nd, 2010 at 14:55](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4826 "Permanent link to this comment by Sten")
25. **Mike**
    > @Sid
    >
    > Thanks for the additional explanations.
    >
    > Just wondering: HSTS is triggered server side and drops the connection when “something” is wrong. IE the certificate.
    >
    > What will be the HSTS effect when the server has the correct certificate, yet the user does not?
    >
    > I.e. the server requires a user to have a valid certificate to access the contents of the HTTPS site.
    >
    > I’m assuming the first time you visit the site, it will drop the connection since “something” is wrong. Yet what happens when the user visits the 2nd time when he does have a valid certificate?
    >
    > Slight variation 1: What happens when the certificate of the site expires while the user is visiting the site, after the HSTS verification?
    >
    > Slight variation 2: What happens when the certificate of the user expires while the user is visiting the site, after the HSTS verification?
    >
    > Would variation 1&2 follow regular behaviour as without HSTS, or will HSTS result in a different behaviour compared to what we are used to now?

    [September 2nd, 2010 at 15:28](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4827 "Permanent link to this comment by Mike")
    1. **Sid**
       > @Mike: HSTS doesn’t deal with client certificates.
       >
       > HSTS also does not remember what certs it has seen in the past; it only kicks in when the certificate being used for a connection does not chain up to a root in the browser \_and\_ the host has requested HSTS status. At that point, all that matters is that (1) the certificate chain is valid and (2) the certificate is authorized for encrypting communication for the given host.
       >
       > Variation 1 (server cert expiry during connection): results in the same behavior as without HSTS. HSTS is only enforced when a connection is being established.
       >
       > Variation 2 (client cert expiry during connection): results in the same behavior as without HSTS; HSTS doesn’t affect client cert behavior.

       [September 2nd, 2010 at 16:35](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4828 "Permanent link to this comment by Sid")
27. **Pat**
    > With HSTS what is the best way for my wireless captive portal to handle users who have https as their home page? I need them to be redirected to the portal authentication page prior to accessing the network.
    >
    > If my site intercepts with its own certificate what will firefox 4 do? Prior to HSTS the browser would give the certificate warning and users could click through.

    [September 6th, 2010 at 09:04](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4829 "Permanent link to this comment by Pat")
29. **Pat**
    > Is it part of beta 4?

    [September 6th, 2010 at 09:15](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4830 "Permanent link to this comment by Pat")
    1. **Sid**
       > @Pat: HSTS is in beta 5.
       >
       > Your captive portal will continue to work for https home pages that are not actively using HSTS, but for those that do, there will be no “add exception” button on the https error page.
       >
       > I would prefer alternatives to asking users to intercepting with your own certificate for a captive portal landing page, because that is effectively asking the user for rights to intercept their encrypted home page traffic. Instead, you could ask the users to initiate a connection to your portal site directly– which will work happily in parallel to home pages that use HSTS.

       [September 8th, 2010 at 09:24](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4832 "Permanent link to this comment by Sid")
       1. **Pat**
          > I agree that intercepting with our certificate is not a good method. In fact although we have tested and it “works” we have not deployed it as it is a bad practice.
          >
          > Our FAQ does let users know to use a non-secure web site to get redirected. Unfortunately some users never get passed the timeout with https. They assume it is a network issue.
          >
          > There are a couple of other options:
          >
          > – On the HSTS error page can you list something to the effect of “if you are connecting via a WiFi hotspot you may need to register before connecting to the network.” Possibly include a url to Mozilla FF FAQ. If the user selects the Mozilla FF url they will get redirected.
          >
          > – Could the browser detect the WISPr tags and let the user know they are connecting via a WiFi hotspot?

          [September 8th, 2010 at 12:53](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4834 "Permanent link to this comment by Pat")
          1. **Pat**
             > Just to clarify, in a wifi hotspot scenario, when the HTTPS request times out it would be very helpful if the browser error page implemented either of the above suggestions.

             [September 8th, 2010 at 16:01](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4835 "Permanent link to this comment by Pat")
       3. **Pat**
          > Sid,
          >
          > I tested beta5 and HSTS works as expected. When I intercepted with our certificated I received the warning page with no click through capability. In fact clicking the “get me out of here button” does cause the user to get redirected to the WiFi hotspot.
          >
          > It would be nice if the browser timeout page had a similar button.

          [September 9th, 2010 at 12:11](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4836 "Permanent link to this comment by Pat")
          1. **Audin Malmin**
             > Indeed, this is becoming more and more important. Captive portals are becoming more painful to develop and use as features such as these are implemented without forethought. “Enhanced Security” Certs are another feature which causes huge problems for captive portals. It will frequently simply cause the browser to apparently freeze up. Not the ideal UI treatment…

             [November 2nd, 2010 at 16:44](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4840 "Permanent link to this comment by Audin Malmin")
31. **Hans W.**
    > @Pat: Intercepting like this is a bad idea for a number of reasons, you should stop doing it.

    [September 8th, 2010 at 05:36](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4831 "Permanent link to this comment by Hans W.")
    1. **Pat**
       > @Hans: This is testing only. We don’t do it in production. Still need a way to handle https users though. Many people do not know what to do when the https request times out.

       [September 11th, 2010 at 07:29](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4837 "Permanent link to this comment by Pat")
33. **zink**
    > Is there any option in about:config to disable HSTS?

    [September 8th, 2010 at 12:30](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4833 "Permanent link to this comment by zink")
35. **steven olson**
    > YOUR FIREFOX DOWNLOAD IS CROUPT NO GOOD SO CAN YOU FIX YOUR FIREFOX FILES
    >
    > THEY DONT WORK

    [September 17th, 2010 at 08:08](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4838 "Permanent link to this comment by steven olson")
37. **Joshua**
    > Is there an about:config option for disabling this feature? I’d like to use Firefox 4 beta 6 from behind a proxy, but this isn’t possible for HTTPS sites without entering private browsing.

    [October 20th, 2010 at 09:26](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4839 "Permanent link to this comment by Joshua")
39. **Doug Wright**
    > Is there a way of telling Firefox to “forget” about any HSTS headers it’s seen for a particular site? Would seem to be quite important for QA/testing of a site.

    [November 4th, 2010 at 07:56](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4841 "Permanent link to this comment by Doug Wright")
41. **Ano Nym**
    > It just took me two hours to figure out why all at once HTTP requests to my server were performed as HTTPS requests. I had to debug entries in permissions.sqlite.
    >
    > Thank you for implementing this valuable feature.

    [December 19th, 2010 at 08:07](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4842 "Permanent link to this comment by Ano Nym")
43. **valchazzz**
    > And what will be, when max-age runs out? If hacker present again hacked HTTP page, when max-age runs out? Browser will force check Strict-Transport-Security header in HTTPS site, or stays on hacked HTTP page?

    [January 6th, 2011 at 09:14](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4843 "Permanent link to this comment by valchazzz")
45. **Jason**
    > With the speed of today’s servers, the load for HTTPS is tiny.

    [March 16th, 2011 at 08:23](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4844 "Permanent link to this comment by Jason")
47. **Leandro**
    > The new Iframe-app tabs in facebook pages can´t been seen with Firefox 4 because of all this… I´m a big fan of FF, but going against facebook it has no future

    [April 1st, 2011 at 15:06](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4845 "Permanent link to this comment by Leandro")
49. **ouinonoui**
    > Dont understand this weird attitude.
    >
    > “””
    >
    > If a web page provide has an https version but you access it through http, what happens? The http version of the Website re-direct you to the https, but you first talked to the non-encrypted version of the website.
    >
    > These behaviors can be exploited to run a man-in-the-middle attack.”””
    >
    > I do need to be explained a little more precisely that part?
    >
    > https is secure or not? How because we ask a page <http://x.com> before <https://x.com> is not anymore secure?
    >
    > How can this link to wikipedia article man\_in\_the\_middle apply?
    >
    > If reasons are so light, is HSTC secure too? What are we doing, always changing things with no reasons?

    [June 14th, 2011 at 03:29](https://hacks.mozilla.org/2010/08/firefox-4-http-strict-transport-security-force-https/#comment-4846 "Permanent link to this comment by ouinonoui")

**Comments are closed for this article.**

Except where otherwise noted, content on this site is licensed
under the
[Creative Commons Attribution Share-Alike License v3.0](https://creativecommons.org/licenses/by-sa/3.0/)
or any later version.

![the Mozilla dino logo](https://hacks.mozilla.org/wp-content/themes/Hax/img/dino.svg)



=== Content from bugzilla.mozilla.org_e05dcbdf_20250125_042856.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/660053)
* [XML](/show_bug.cgi?ctype=xml&id=660053)

Closed
[Bug 660053](/show_bug.cgi?id=660053)
(CVE-2011-2976)

Opened 14 years ago
Closed 13 years ago

# [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show\_bug.cgi and inject HTML into <head>

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show\_bug.cgi and inject HTML into <head>

## Categories

### (Bugzilla :: Creating/Changing Bugs, defect)

[Product:](/describecomponents.cgi?product=Bugzilla)

Bugzilla
▾

Bugzilla
The [Bugzilla](http://www.bugzilla.org) bug-tracking system.

**Note:** This is **not** the place to request configuration, permission, or account changes to this installation of Bugzilla (bugzilla.mozilla.org). File such changes under the appropriate component in the [**bugzilla.mozilla.org**](enter_bug.cgi?product=bugzilla.mozilla.org) product.
[See Open Bugs in This Product](/buglist.cgi?product=Bugzilla&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Bugzilla)
Watch This Product

[Component:](/describecomponents.cgi?product=Bugzilla&component=Creating%2FChanging%20Bugs#Creating%2FChanging%20Bugs)

Creating/Changing Bugs
▾

Bugzilla :: Creating/Changing Bugs
Creating, changing, and viewing bugs. `enter_bug.cgi, post_bug.cgi, show_bug.cgi, process_bug.cgi`
[See Open Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Creating%2FChanging%20Bugs&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Creating%2FChanging%20Bugs&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Bugzilla&component=Creating%2FChanging%20Bugs)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

2.16

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Bugzilla 3.4

## People

### (Reporter: mkanat, Assigned: mkanat)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8d3dd762c1c841898a384ebc42abec97?d=mm&size=40)  [mkanat](/user_profile?user_id=73187)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/9df24a05a7e63cf07e49d30ddfeee31a?d=mm&size=40)  [default-qa](/user_profile?user_id=5086)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8d3dd762c1c841898a384ebc42abec97?d=mm&size=40)  [mkanat](/user_profile?user_id=73187)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

### ( [URL](http://www.cloudscan.me/2011/05/bugzilla-version-323-cookie-xss-cross.html "http://www.cloudscan.me/2011/05/bugzilla-version-323-cookie-xss-cross.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[660528](/show_bug.cgi?id=660528 "RESOLVED FIXED - Security Advisory for Bugzilla 4.1.3, 4.0.2, 3.6.6 and 3.4.12")

Dependency [tree](/showdependencytree.cgi?id=660053&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=660053)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[667503](/show_bug.cgi?id=667503 "RESOLVED DUPLICATE - [SECURITY] BUGLIST cookie cross-site scripting (xss) vulnerability")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[cloudscan.me/2011/05/bugzilla-version...](http://www.cloudscan.me/2011/05/bugzilla-version-323-cookie-xss-cross.html "http://www.cloudscan.me/2011/05/bugzilla-version-323-cookie-xss-cross.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [3.4.x and older only; 3.6 and newer not affected][infrasec:xss][ws:moderate])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2011-2976

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[3.4.x and older only; 3.6 and newer not affected][infrasec:xss][ws:moderate]

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [LpSolit](/user_profile?user_id=120380) | [approval3.4](#a6047418_120380 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval3.4 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [blocking3.4.12](#c10 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | blocking3.4.12 | + |
| --- | --- | --- |
|  | approval | ? |
| --- | --- | --- |
|  | approval5.0 | ? |
|  | approval5.2 | ? |
|  | approval6.0 | ? |
|  | blocking5.0.4.1 | ? |
|  | blocking5.2 | ? |
|  | blocking6.0 | ? |
|  | approval4.4 | ? |
|  | blocking4.4.14 | ? |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | documentation | ? + - |
|  | testcase |  | | |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [v1](/attachment.cgi?id=535428)  [14 years ago](#c1)  [Max Kanat-Alexander](/user_profile?user_id=73187)   1.75 KB, patch | LpSolit : [review-](#c3 "14 years ago") | [Details](/attachment.cgi?id=535428&action=edit) | [Diff](/attachment.cgi?id=535428&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660053&attachment=535428) |
| --- | --- | --- |
| [v2](/attachment.cgi?id=535431)  [14 years ago](#c4)  [Max Kanat-Alexander](/user_profile?user_id=73187)   3.41 KB, patch | LpSolit : [review+](#c5 "14 years ago") | [Details](/attachment.cgi?id=535431&action=edit) | [Diff](/attachment.cgi?id=535431&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660053&attachment=535431) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=660053#c0)• 14 years ago |
|  | |

Bugzilla 3.4.11 and below are affected by an XSS that is only possible if the user's BUGLIST cookie is somehow compromised. The bug\_list.first and bug\_list.last variables in the bug/navigate.html.tmpl template are not properly escaped when displayed.
As far as we know, it is not possible to compromise the BUGLIST cookie in Bugzilla, and as such we are not treating this as a high-priority security issue, but still something that we should fix for the 3.4 branch in case administrators have customized their installation in such a way that BUGLIST could have been compromised, or there are other programs on the user's system that could somehow have compromised the cookie.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=660053#c1)• 14 years ago |
|  | |

Attached patch

[v1](attachment.cgi?id=535428&action=diff) (obsolete)
— [Details](attachment.cgi?id=535428&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660053&attachment=535428)

Simple untested patch for the issue. (It does pass 008filter.t.)Assignee: create-and-change → mkanatStatus: NEW → ASSIGNED
[Attachment #535428](/attachment.cgi?id=535428&action=edit "v1") -
Flags: review?(dkl)

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=660053#c2)• 14 years ago |
|  | |

For the record, 3.6 and newer are not affected as [bug 509108](/show_bug.cgi?id=509108 "RESOLVED FIXED - Don't require a bug_list parameter to show the bug template") added filters.Severity: normal → minorWhiteboard: [3.4.x and older only; 3.6 and newer not affected]

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=660053#c3)• 14 years ago |
|  | |

Comment on [attachment 535428](/attachment.cgi?id=535428 "v1") [[details]](/attachment.cgi?id=535428&action=edit "v1") [[diff]](/attachment.cgi?id=535428&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=660053&attachment=535428)
v1
You also have to fix global/site-navigation.html.tmpl.
[Attachment #535428](/attachment.cgi?id=535428&action=edit "v1") -
Flags: review?(dkl) → review-

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a684_159758)• 14 years ago |

Severity: minor → normalSummary: If a BUGLIST cookie is compromised, it can be used to XSS show\_bug.cgi → [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show\_bug.cgiWhiteboard: [3.4.x and older only; 3.6 and newer not affected] → [3.4.x and older only; 3.6 and newer not affected][infrasec:xss][ws:high]

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=660053#c4)• 14 years ago |
|  | |

Attached patch

[v2](attachment.cgi?id=535431&action=diff)
— [Details](attachment.cgi?id=535431&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660053&attachment=535431)

Thanks, fixed in this patch.
[Attachment #535428](/attachment.cgi?id=535428&action=edit "v1") -
Attachment is obsolete: true
[Attachment #535431](/attachment.cgi?id=535431&action=edit "v2") -
Flags: review?(LpSolit)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a1150_159758)• 14 years ago |

URL: [http://www.cloudscan.me/2011/05/bugzi...](http://www.cloudscan.me/2011/05/bugzilla-version-401-cookie-xss-cross.html) → [http://www.cloudscan.me/2011/05/bugzi...](http://www.cloudscan.me/2011/05/bugzilla-version-323-cookie-xss-cross.html)Whiteboard: [3.4.x and older only; 3.6 and newer not affected][infrasec:xss][ws:high] → [3.4.x and older only; 3.6 and newer not affected][infrasec:xss][ws:moderate]

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a1381_73187)• 14 years ago |

Summary: [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show\_bug.cgi → [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show\_bug.cgi and inject HTML into <head>

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=660053#c5)• 14 years ago |
|  | |

Comment on [attachment 535431](/attachment.cgi?id=535431 "v2") [[details]](/attachment.cgi?id=535431&action=edit "v2") [[diff]](/attachment.cgi?id=535431&action=diff "v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=660053&attachment=535431)
v2
r=LpSolit
[Attachment #535431](/attachment.cgi?id=535431&action=edit "v2") -
Flags: review?(LpSolit) → review+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a2295_120380)• 14 years ago |

Flags: approval3.4?

|  | [Michael Coates [:mcoates] (acct no longer active)](/user_profile?user_id=376659) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=660053#c6)• 14 years ago |
|  | |

(In reply to [comment #0](/show_bug.cgi?id=660053#c0 "VERIFIED FIXED - [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show_bug.cgi and inject HTML into <head>"))
> As far as we know, it is not possible to compromise the BUGLIST cookie in
> Bugzilla, and as such we are not treating this as a high-priority security
> issue, but still something that we should fix for the 3.4 branch in case
> administrators have customized their installation in such a way that BUGLIST
> could have been compromised, or there are other programs on the user's
> system that could somehow have compromised the cookie.
Unfortunately this is not true. One of the peculiarities with cookie handling in all browsers is that anyone can set a cookie for any user on any site provided they are able to intercept some traffic from the victim to any other HTTP site.
I wrote a post and diagram on this issue which further describes the issue:
<http://michael-coates.blogspot.com/2010/01/cookie-forcing-trust-your-cookies-no.html>
The only solution to this issue is to enable HSTS. HSTS will prevent the victim's browser from being forced by the MITM to issue a HTTP request to the site in question.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=660053#c7)• 14 years ago |
|  | |

> anyone can set a cookie for any user on any
> site provided they are able to intercept some traffic from the victim to any
> other HTTP site.
But being able to set cookies is a significantly worse vulnerability than this, no? That is, if you can MITM somebody, you've already entirely encompassed this vulnerability and then some.

|  | [Michael Coates [:mcoates] (acct no longer active)](/user_profile?user_id=376659) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=660053#c8)• 14 years ago |
|  | |

(In reply to [comment #7](/show_bug.cgi?id=660053#c7 "VERIFIED FIXED - [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show_bug.cgi and inject HTML into <head>"))
> > anyone can set a cookie for any user on any
> > site provided they are able to intercept some traffic from the victim to any
> > other HTTP site.
>
> But being able to set cookies is a significantly worse vulnerability than
> this, no? That is, if you can MITM somebody, you've already entirely
> encompassed this vulnerability and then some.
So the difference here is that the attacker is not actually MITM the SSL connection, that connection is totally valid and untouched. Instead the attacker MITMs other HTTP request made by the victim to different sites (e.g. maybe they are also browsing google or there browsing is sending requests for HTTP updates of some sort).
That's what makes this issue so frustrating, the attacker can intercept and modify a HTTP request by the victim to foo.com and use this to ultimately cause a new cookie to be set for the user's interaction with the bugzilla site.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=660053#c9)• 14 years ago |
|  | |

(In reply to [comment #8](/show_bug.cgi?id=660053#c8 "VERIFIED FIXED - [SECURITY] If a BUGLIST cookie is compromised, it can be used to XSS show_bug.cgi and inject HTML into <head>"))
> That's what makes this issue so frustrating, the attacker can intercept and
> modify a HTTP request by the victim to foo.com and use this to ultimately
> cause a new cookie to be set for the user's interaction with the bugzilla
> site.
Yes, but what could you do with an XSS that you couldn't already completely do with that MITM? If you can MITM somebody you own them, period, unless there's SSL, right?

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=660053#c10)• 14 years ago |
|  | |

Let's mark it as a blocker to keep it in our radar for the next security releases.Flags: blocking3.4.12+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a238191_120380)• 14 years ago |

Blocks: [660528](/show_bug.cgi?id=660528 "RESOLVED FIXED - Security Advisory for Bugzilla 4.1.3, 4.0.2, 3.6.6 and 3.4.12")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=660053#c12)• 13 years ago |
|  | |

Use [CVE-2011-2976](https://www.cve.org/CVERecord?id=CVE-2011-2976) for this bugAlias: CVE-2011-2976

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=660053#c13)• 13 years ago |
|  | |

2.16rc1 is the first version affected by this problem, see [bug 110012](/show_bug.cgi?id=110012 "RESOLVED FIXED - Spank show_bug.cgi hard - templatize and combine").Version: 3.4.11 → 2.16

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a6047418_120380)• 13 years ago |

Flags: approval3.4? → approval3.4+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=660053#c14)• 13 years ago |
|  | |

Committing to: bzr+ssh://lpsolit%40gmail.com@bzr.mozilla.org/bugzilla/3.4/
modified template/en/default/filterexceptions.pl
modified template/en/default/bug/navigate.html.tmpl
modified template/en/default/global/site-navigation.html.tmpl
Committed revision 6805.Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Max Kanat-Alexander](/user_profile?user_id=73187)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=660053#c15)• 13 years ago |
|  | |

Security advisory sent, unlocking this bug.Group: bugzilla-security

|  | [Raymond Forbes[:rforbes]](/user_profile?user_id=411311) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660053#a7782142_411311)• 13 years ago |

Status: RESOLVED → VERIFIED
You need to [log in](/show_bug.cgi?id=660053&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Max Kanat-Alexander](/user_profile?user_id=73187)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


