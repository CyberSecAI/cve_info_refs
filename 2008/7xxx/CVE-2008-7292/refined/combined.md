=== Content from bugzilla.mozilla.org_a88502a3_20250125_064509.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/660502)
* [XML](/show_bug.cgi?ctype=xml&id=660502)

Closed
[Bug 660502](/show_bug.cgi?id=660502)
(CVE-2011-2977)

Opened 14 years ago
Closed 13 years ago

# [SECURITY] Temporary files for uploaded attachments are not deleted on Windows (again)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[SECURITY] Temporary files for uploaded attachments are not deleted on Windows (again)

## Categories

### (Bugzilla :: Attachments & Requests, defect)

[Product:](/describecomponents.cgi?product=Bugzilla)

Bugzilla
▾

Bugzilla
The [Bugzilla](http://www.bugzilla.org) bug-tracking system.

**Note:** This is **not** the place to request configuration, permission, or account changes to this installation of Bugzilla (bugzilla.mozilla.org). File such changes under the appropriate component in the [**bugzilla.mozilla.org**](enter_bug.cgi?product=bugzilla.mozilla.org) product.
[See Open Bugs in This Product](/buglist.cgi?product=Bugzilla&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Bugzilla)
Watch This Product

[Component:](/describecomponents.cgi?product=Bugzilla&component=Attachments%20%26%20Requests#Attachments%20%26%20Requests)

Attachments & Requests
▾

Bugzilla :: Attachments & Requests
For problems with attachment creation/management and request creation/management. attachment.cgi, request.cgi
[See Open Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Attachments%20%26%20Requests&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Attachments%20%26%20Requests&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Bugzilla&component=Attachments%20%26%20Requests)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

3.6

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Bugzilla 3.6

## People

### (Reporter: LpSolit, Assigned: LpSolit)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [LpSolit](/user_profile?user_id=120380)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/9df24a05a7e63cf07e49d30ddfeee31a?d=mm&size=40)  [default-qa](/user_profile?user_id=5086)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [LpSolit](/user_profile?user_id=120380)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

1 person

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[660528](/show_bug.cgi?id=660528 "RESOLVED FIXED - Security Advisory for Bugzilla 4.1.3, 4.0.2, 3.6.6 and 3.4.12")

Dependency [tree](/showdependencytree.cgi?id=660502&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=660502)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, Whiteboard: [Bugzilla 3.6rc1 and older not affected])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2011-2977

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[Bugzilla 3.6rc1 and older not affected]

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [LpSolit](/user_profile?user_id=120380) | [approval](#a5854554_120380 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [blocking4.2](#c0 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | blocking4.2 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [approval4.0](#a5854554_120380 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval4.0 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [blocking4.0.2](#c0 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | blocking4.0.2 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [approval3.6](#a5854554_120380 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval3.6 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [blocking3.6.6](#c0 "14 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | blocking3.6.6 | + |
| --- | --- | --- |
|  | approval5.0 | ? |
| --- | --- | --- |
|  | approval5.2 | ? |
|  | approval6.0 | ? |
|  | blocking5.0.4.1 | ? |
|  | blocking5.2 | ? |
|  | blocking6.0 | ? |
|  | approval4.4 | ? |
|  | blocking4.4.14 | ? |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | documentation | ? + - |
|  | testcase |  | | |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [patch for 3.6 and 4.0, v1](/attachment.cgi?id=535918)  [14 years ago](#c5)  [Frédéric Buclin](/user_profile?user_id=120380)   382 bytes, patch | glob : [review+](#c8 "14 years ago") | [Details](/attachment.cgi?id=535918&action=edit) | [Diff](/attachment.cgi?id=535918&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660502&attachment=535918) |
| --- | --- | --- |
| [patch for 4.2, v1](/attachment.cgi?id=535919)  [14 years ago](#c7)  [Frédéric Buclin](/user_profile?user_id=120380)   652 bytes, patch | glob : [review+](#c9 "14 years ago") | [Details](/attachment.cgi?id=535919&action=edit) | [Diff](/attachment.cgi?id=535919&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660502&attachment=535919) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=660502#c0)• 14 years ago |
|  | |

We already fixed this problem in Bugzilla 2.20.5 in [bug 414002](/show_bug.cgi?id=414002 "RESOLVED FIXED - Temporary files for uploaded attachments are not deleted on Windows"), and it's still working fine in Bugzilla 3.2 and 3.4, but we regressed this again in Bugzilla 3.6. No idea so far what regressed this.
As a user having local access to the server can access the Temp\ directory on Windows, attachments which are uploaded to security bugs or marked as private are still accessible to such users, even if they cannot access them using Bugzilla.Flags: blocking4.2+Flags: blocking4.0.2+Flags: blocking3.6.6+

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660502#a80_120380)• 14 years ago |

Whiteboard: [Bugzilla 3.4.x and older not affected]

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=660502#c1)• 14 years ago |
|  | |

A good candidate for the regression is [bug 454251](/show_bug.cgi?id=454251 "RESOLVED FIXED - Implement Bugzilla::Attachment->create() and $attachment->update()"), but it's just a guess.

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=660502#c2)• 14 years ago |
|  | |

(In reply to [comment #1](/show_bug.cgi?id=660502#c1 "RESOLVED FIXED - [SECURITY] Temporary files for uploaded attachments are not deleted on Windows (again)"))
> A good candidate for the regression is [bug 454251](/show_bug.cgi?id=454251 "RESOLVED FIXED - Implement Bugzilla::Attachment->create() and $attachment->update()"), but it's just a guess.
It's not this one. revno 6854 is fine (Bugzilla 3.5.2), but revno 7167 is not.

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=660502#c3)• 14 years ago |
|  | |

It's a regression due to [bug 556429](/show_bug.cgi?id=556429 "RESOLVED FIXED - Stop sending email notifications from inside the template"). revno 7112 works fine. revno 7113 is broken.Depends on: [556429](/show_bug.cgi?id=556429 "RESOLVED FIXED - Stop sending email notifications from inside the template")

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=660502#c4)• 14 years ago |
|  | |

Bugzilla 3.6 and 3.7.1 are the first ones to be affected. 3.5.3 and older are fine.Whiteboard: [Bugzilla 3.4.x and older not affected] → [Bugzilla 3.5.3 and older not affected]Version: 4.0.1 → 3.6

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=660502#c5)• 14 years ago |
|  | |

Attached patch

[patch for 3.6 and 4.0, v1](attachment.cgi?id=535918&action=diff)
— [Details](attachment.cgi?id=535918&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660502&attachment=535918)

Explicitly closing the filehandle fixes the problem. The temporary file is now correctly purged (and the uploaded attachment integrity is correct). Tested on both 3.6.5 and 4.0.1.Assignee: attach-and-request → LpSolitStatus: NEW → ASSIGNED
[Attachment #535918](/attachment.cgi?id=535918&action=edit "patch for 3.6 and 4.0, v1") -
Flags: review?(mkanat)

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=660502#c6)• 14 years ago |
|  | |

Despite this bug appears after the commit of [bug 556429](/show_bug.cgi?id=556429 "RESOLVED FIXED - Stop sending email notifications from inside the template"), that bug is not the culprit. It only made this bug visible, but is not responsible for it.No longer depends on: [556429](/show_bug.cgi?id=556429 "RESOLVED FIXED - Stop sending email notifications from inside the template")

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=660502#c7)• 14 years ago |
|  | |

Attached patch

[patch for 4.2, v1](attachment.cgi?id=535919&action=diff)
— [Details](attachment.cgi?id=535919&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=660502&attachment=535919)

[Attachment #535919](/attachment.cgi?id=535919&action=edit "patch for 4.2, v1") -
Flags: review?(mkanat)

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660502#a45272_120380)• 14 years ago |

Blocks: [660528](/show_bug.cgi?id=660528 "RESOLVED FIXED - Security Advisory for Bugzilla 4.1.3, 4.0.2, 3.6.6 and 3.4.12")

|  | [:glob ✱](/user_profile?user_id=13647) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=660502#c8)• 14 years ago |
|  | |

Comment on [attachment 535918](/attachment.cgi?id=535918 "patch for 3.6 and 4.0, v1") [[details]](/attachment.cgi?id=535918&action=edit "patch for 3.6 and 4.0, v1") [[diff]](/attachment.cgi?id=535918&action=diff "patch for 3.6 and 4.0, v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=660502&attachment=535918)
patch for 3.6 and 4.0, v1
r=glob
[Attachment #535918](/attachment.cgi?id=535918&action=edit "patch for 3.6 and 4.0, v1") -
Flags: review?(mkanat) → review+

|  | [:glob ✱](/user_profile?user_id=13647) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=660502#c9)• 14 years ago |
|  | |

Comment on [attachment 535919](/attachment.cgi?id=535919 "patch for 4.2, v1") [[details]](/attachment.cgi?id=535919&action=edit "patch for 4.2, v1") [[diff]](/attachment.cgi?id=535919&action=diff "patch for 4.2, v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=660502&attachment=535919)
patch for 4.2, v1
r=glob
please add a comment on checkin explaining why this is required.
[Attachment #535919](/attachment.cgi?id=535919&action=edit "patch for 4.2, v1") -
Flags: review?(mkanat) → review+

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=660502#c10)• 14 years ago |
|  | |

(In reply to [comment #9](/show_bug.cgi?id=660502#c9 "RESOLVED FIXED - [SECURITY] Temporary files for uploaded attachments are not deleted on Windows (again)"))
> please add a comment on checkin explaining why this is required.
ok, will do. Thanks for the reviews! :)

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660502#a139931_120380)• 14 years ago |

Flags: approval?Flags: approval4.0?Flags: approval3.6?

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660502#a297796_120380)• 14 years ago |

Summary: Temporary files for uploaded attachments are not deleted on Windows (again) → [SECURITY] Temporary files for uploaded attachments are not deleted on Windows (again)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=660502#c11)• 13 years ago |
|  | |

Use [CVE-2011-2977](https://www.cve.org/CVERecord?id=CVE-2011-2977) for this bugAlias: CVE-2011-2977

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660502#a5655335_120380)• 13 years ago |

Whiteboard: [Bugzilla 3.5.3 and older not affected] → [Bugzilla 3.6rc1 and older not affected]

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=660502#a5854554_120380)• 13 years ago |

Flags: approval?Flags: approval4.0?Flags: approval4.0+Flags: approval3.6?Flags: approval3.6+Flags: approval+

|  | [Frédéric Buclin](/user_profile?user_id=120380)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=660502#c12)• 13 years ago |
|  | |

Committing to: bzr+ssh://lpsolit%40gmail.com@bzr.mozilla.org/bugzilla/trunk/
modified Bugzilla/Attachment.pm
Committed revision 7889.
Committing to: bzr+ssh://lpsolit%40gmail.com@bzr.mozilla.org/bugzilla/4.0/
modified Bugzilla/Attachment.pm
Committed revision 7635.
Committing to: bzr+ssh://lpsolit%40gmail.com@bzr.mozilla.org/bugzilla/3.6/
modified Bugzilla/Attachment.pm
Committed revision 7252.Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=660502#c13)• 13 years ago |
|  | |

Security advisory sent, unlocking this bug.Group: bugzilla-security
You need to [log in](/show_bug.cgi?id=660502&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Frédéric Buclin](/user_profile?user_id=120380)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_ace6e464_20250125_064508.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/414002)
* [XML](/show_bug.cgi?ctype=xml&id=414002)

Closed
[Bug 414002](/show_bug.cgi?id=414002)

Opened 17 years ago
Closed 17 years ago

# Temporary files for uploaded attachments are not deleted on Windows

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Temporary files for uploaded attachments are not deleted on Windows

## Categories

### (Bugzilla :: Attachments & Requests, defect)

[Product:](/describecomponents.cgi?product=Bugzilla)

Bugzilla
▾

Bugzilla
The [Bugzilla](http://www.bugzilla.org) bug-tracking system.

**Note:** This is **not** the place to request configuration, permission, or account changes to this installation of Bugzilla (bugzilla.mozilla.org). File such changes under the appropriate component in the [**bugzilla.mozilla.org**](enter_bug.cgi?product=bugzilla.mozilla.org) product.
[See Open Bugs in This Product](/buglist.cgi?product=Bugzilla&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Bugzilla)
Watch This Product

[Component:](/describecomponents.cgi?product=Bugzilla&component=Attachments%20%26%20Requests#Attachments%20%26%20Requests)

Attachments & Requests
▾

Bugzilla :: Attachments & Requests
For problems with attachment creation/management and request creation/management. attachment.cgi, request.cgi
[See Open Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Attachments%20%26%20Requests&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Attachments%20%26%20Requests&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Bugzilla&component=Attachments%20%26%20Requests)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

3.0.3

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Bugzilla 2.20

## People

### (Reporter: SteveHay, Assigned: SteveHay)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/c555e119357149d984dc53cd4fbbd3c4?d=mm&size=40)  [SteveHay](/user_profile?user_id=298884)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/9df24a05a7e63cf07e49d30ddfeee31a?d=mm&size=40)  [default-qa](/user_profile?user_id=5086)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/c555e119357149d984dc53cd4fbbd3c4?d=mm&size=40)  [SteveHay](/user_profile?user_id=298884)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

4 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [LpSolit](/user_profile?user_id=120380) | [approval](#a267313_120380 "17 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [approval3.0](#a267313_120380 "17 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval3.0 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [approval2.22](#a267313_120380 "17 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval2.22 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [approval2.20](#a267313_120380 "17 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval2.20 | + |
| --- | --- | --- |
|  | approval5.0 | ? |
| --- | --- | --- |
|  | approval5.2 | ? |
|  | approval6.0 | ? |
|  | blocking5.0.4.1 | ? |
|  | blocking5.2 | ? |
|  | blocking6.0 | ? |
|  | approval4.4 | ? |
|  | blocking4.4.14 | ? |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | documentation | ? + - |
|  | testcase |  | | |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [Patch (against 3.0.3) to fix this bug](/attachment.cgi?id=299715)  [17 years ago](#c7)  [Steve Hay](/user_profile?user_id=298884)   546 bytes, patch | LpSolit : [review+](#c8 "17 years ago") | [Details](/attachment.cgi?id=299715&action=edit) | [Diff](/attachment.cgi?id=299715&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=414002&attachment=299715) |
| --- | --- | --- |
| [checked in patch](/attachment.cgi?id=300077)  [17 years ago](#c9)  [Frédéric Buclin](/user_profile?user_id=120380)   682 bytes, patch | LpSolit : [review+](#c9 "17 years ago") | [Details](/attachment.cgi?id=300077&action=edit) | [Diff](/attachment.cgi?id=300077&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=414002&attachment=300077) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Steve Hay](/user_profile?user_id=298884)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=414002#c0)• 17 years ago |
|  | |

User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
Build Identifier: 3.0.3
After uploading an attachment, I find that a CGItempXXXXX file is left behind in the temporary files directory.
I notice that Bugzilla/CGI.pm uses the :private\_tempfiles feature of CGI.pm, but this doesn't work on Windows because you cannot delete an open file on Windows (unless you start using some low-level Win32API::File trickery. Therefore, it is the CGI::DESTROY() method that normally deletes the temporary files for uploads on Windows, but this never gets called by Bugzilla::CGI. It has its own DESTROY() method which does nothing.
This is probably a hang-over from the past when CGI::DESTROY() itself was empty, but now that CGI::DESTROY() does something useful Bugzilla::CGI::DESTROY() needs to call it. (The deletion of temporary files in CGI::DESTROY() was added in CGI.pm version 3.01, from a patch by me.)
Reproducible: Always
Steps to Reproduce:
1. Add an attachment to a bug in a Bugzilla system running on Windows.
2. Look in the temporary files directory (probably the folder specified by the TEMP or TMP environment variables, or else something like C:\WINDOWS\TEMP--see the BEGIN {} block in Bugzilla::CGI).
Actual Results:
You'll find a CGItempXXXXX file has been left behind in that directory.
Expected Results:
These temporary files should be deleted after the upload is done.
The following patch to Bugzilla/CGI.pm fixes it (as long as you're using CGI.pm $VERSION >= 3.01).
--- CGI.pm.orig 2008-01-25 16:42:13.904661500 +0000
+++ CGI.pm 2008-01-25 16:42:18.389180000 +0000
@@ -54,7 +54,7 @@
# We need to do so, too, otherwise perl dies when the object is destroyed
# and we don't have a DESTROY method (because CGI.pm's AUTOLOAD will |die|
# on getting an unknown sub to try to call)
-sub DESTROY {};
+sub DESTROY { shift->SUPER::DESTROY(@\_); };
sub new {
my ($invocant, @args) = @\_;
End of Patch.

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=414002#c1)• 17 years ago |
|  | |

Could you attach this patch as an attachment and request review instead? Thanks.Version: unspecified → 3.0.3

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=414002#c2)• 17 years ago |
|  | |

justdave and me both agree to take it for 2.x too.Assignee: attach-and-request → SteveHayStatus: UNCONFIRMED → NEWEver confirmed: trueKeywords: [relnote](/buglist.cgi?keywords=relnote&resolution=---)Target Milestone: --- → Bugzilla 2.20

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=414002#c3)• 17 years ago |
|  | |

I'm pretty sure the required version of CGI.pm in the 2.x series is not high enough for this.

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=414002#c4)• 17 years ago |
|  | |

(In reply to [comment #3](/show_bug.cgi?id=414002#c3 "RESOLVED FIXED - Temporary files for uploaded attachments are not deleted on Windows"))
> I'm pretty sure the required version of CGI.pm in the 2.x series is not high
> enough for this.
Even old versions of CGI.pm have DESTROY() defined (I checked in CGI.pm 2.93, which is the version required by Bugzilla 2.20). It's just empty. So this won't hurt.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=414002#c5)• 17 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=414002#c4 "RESOLVED FIXED - Temporary files for uploaded attachments are not deleted on Windows"))
> Even old versions of CGI.pm have DESTROY() defined (I checked in CGI.pm 2.93,
> which is the version required by Bugzilla 2.20). It's just empty. So this won't
> hurt.
Ah. Won't hurt, but also won't do anything.

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=414002#c6)• 17 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=414002#c5 "RESOLVED FIXED - Temporary files for uploaded attachments are not deleted on Windows"))
> Ah. Won't hurt, but also won't do anything.
Which is fine. We don't care about DESTROY doing nothing. But we do care about DESTROY doing something and taking this into consideration.
Steve, could you attach your patch to the bug, please? Or do you prefer us to do it?

|  | [Steve Hay](/user_profile?user_id=298884)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=414002#c7)• 17 years ago |
|  | |

Attached patch

[Patch (against 3.0.3) to fix this bug](attachment.cgi?id=299715&action=diff) (obsolete)
— [Details](attachment.cgi?id=299715&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=414002&attachment=299715)

Attaching patch for review as requested.
[Attachment #299715](/attachment.cgi?id=299715&action=edit "Patch (against 3.0.3) to fix this bug") -
Flags: review?

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=414002#c8)• 17 years ago |
|  | |

Comment on [attachment 299715](/attachment.cgi?id=299715 "Patch (against 3.0.3) to fix this bug") [[details]](/attachment.cgi?id=299715&action=edit "Patch (against 3.0.3) to fix this bug") [[diff]](/attachment.cgi?id=299715&action=diff "Patch (against 3.0.3) to fix this bug") [[review]](/page.cgi?id=splinter.html&ignore=&bug=414002&attachment=299715)
Patch (against 3.0.3) to fix this bug
Works fine on Windows 2000, even with CGI::DESTROY() being empty. r=LpSolit
On checkin, I will write:
my $self = shift;
$self->SUPER::DESTROY(@\_);
to match the way we do it in other methods.
[Attachment #299715](/attachment.cgi?id=299715&action=edit "Patch (against 3.0.3) to fix this bug") -
Flags: review? → review+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=414002#a267313_120380)• 17 years ago |

Status: NEW → ASSIGNEDFlags: approval3.0+Flags: approval2.22+Flags: approval2.20+Flags: approval+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=414002#c9)• 17 years ago |
|  | |

Attached patch

[checked in patch](attachment.cgi?id=300077&action=diff)
— [Details](attachment.cgi?id=300077&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=414002&attachment=300077)

Here is the patch as checked in.
[Attachment #299715](/attachment.cgi?id=299715&action=edit "Patch (against 3.0.3) to fix this bug") -
Attachment is obsolete: true
[Attachment #300077](/attachment.cgi?id=300077&action=edit "checked in patch") -
Flags: review+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=414002#c10)• 17 years ago |
|  | |

tip:
Checking in Bugzilla/CGI.pm;
/cvsroot/mozilla/webtools/bugzilla/Bugzilla/CGI.pm,v <-- CGI.pm
new revision: 1.36; previous revision: 1.35
done
3.0.3:
Checking in Bugzilla/CGI.pm;
/cvsroot/mozilla/webtools/bugzilla/Bugzilla/CGI.pm,v <-- CGI.pm
new revision: 1.31.2.1; previous revision: 1.31
done
2.22.3:
Checking in Bugzilla/CGI.pm;
/cvsroot/mozilla/webtools/bugzilla/Bugzilla/CGI.pm,v <-- CGI.pm
new revision: 1.20.2.4; previous revision: 1.20.2.3
done
2.20.5:
Checking in Bugzilla/CGI.pm;
/cvsroot/mozilla/webtools/bugzilla/Bugzilla/CGI.pm,v <-- CGI.pm
new revision: 1.16.2.2; previous revision: 1.16.2.1
done
Status: ASSIGNED → RESOLVEDClosed: 17 years agoResolution: --- → FIXED

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=414002#c11)• 17 years ago |
|  | |

relnoted in a 3.0.x release a while ago, removing relnote keyword.Keywords: [relnote](/buglist.cgi?keywords=relnote&resolution=---)

|  | [sabb](/user_profile?user_id=438367) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=414002#c12)• 13 years ago |
|  | |

<h1>nice job</h1>

|  | [sabb](/user_profile?user_id=438367) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=414002#c13)• 13 years ago |
|  | |

<script>alert(12345)</script>
You need to [log in](/show_bug.cgi?id=414002&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Steve Hay](/user_profile?user_id=298884)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


