```
Message-ID: <Pine.GSO.4.51.0810141450350.1682@faron.mitre.org>
Date: Tue, 14 Oct 2008 14:51:16 -0400 (EDT)
From: "Steven M. Christey" <coley@...us.mitre.org>
To: oss-security@...ts.openwall.com
Subject: Re: CVE request: kernel: don't allow splice() to
 files opened with O_APPEND

On Mon, 13 Oct 2008, Eugene Teo wrote:

> "[PATCH] Don't allow splice() to files opened with O_APPEND
>
> But Miklos convinced me that we should at least give it some thought,
> and that accepting writes at arbitrary offsets is wrong at least for
> IS_APPEND() files (which always have O_APPEND set, even if the reverse
> isn't true: you can obviously have O_APPEND set on a regular file).

Use CVE-2008-4554, to be filled in later.

- Steve

```
- **Root cause of vulnerability**: The Linux kernel's `splice()` system call does not properly handle file descriptors opened with the `O_APPEND` flag. Specifically, the `do_splice_from` function does not reject file descriptors with `O_APPEND`, allowing writes at arbitrary offsets, which bypasses the append-only mode.
- **Weaknesses/vulnerabilities present**: The vulnerability is a logic error in the `splice()` implementation, leading to an unintended bypass of the `O_APPEND` flag, which is meant to enforce that writes only occur at the end of a file.
- **Impact of exploitation**: A local user can bypass the intended append-only behavior and write to arbitrary locations within a file opened with `O_APPEND`. This can lead to data corruption or other unintended consequences if the program relies on the append-only semantics.
- **Attack vectors**: The vulnerability is triggered by a local user using the `splice()` system call with a file descriptor that has the `O_APPEND` flag set.
- **Required attacker capabilities/position**: A local user with the ability to execute code on the affected system is required to exploit this vulnerability.

```
  CVE-2008-4554: The do_splice_from function in fs/splice.c in the
  Linux kernel does not reject file descriptors that have the O_APPEND
  flag set, which allows local users to bypass append mode and make
  arbitrary changes to other locations in the file.
```
- **Root cause of vulnerability**: The `do_splice_from` function in `fs/splice.c` within the Linux kernel improperly handles file descriptors that have the `O_APPEND` flag set.
- **Weaknesses/vulnerabilities present**: The vulnerability lies in the fact that the `splice()` system call implementation does not properly check for or enforce the `O_APPEND` flag when writing data. This oversight allows for writing to locations other than the end of the file.
- **Impact of exploitation**: A local user can bypass the intended append-only behavior of files opened with `O_APPEND`, allowing arbitrary writes to any location within the file. This can lead to data corruption or privilege escalation if append-only semantics are relied upon.
- **Attack vectors**: Exploitation occurs through the `splice()` system call, using a file descriptor that was opened with the `O_APPEND` flag.
- **Required attacker capabilities/position**: A local user with the ability to execute arbitrary code on the target system is required.

```
CVE-2008-4554

    Milos Szeredi reported that the usage of splice() on files opened
    with O_APPEND allows users to write to the file at arbitrary
    offsets, enabling a bypass of possible assumed semantics of the
    O_APPEND flag.
```

- **Root cause of vulnerability**: The Linux kernel's `splice()` system call implementation has a flaw when handling files opened with the `O_APPEND` flag.
- **Weaknesses/vulnerabilities present**: The weakness is that the `splice()` implementation does not honor the `O_APPEND` flag, which should restrict writes to the end of the file. Instead, the system call allows writing to arbitrary offsets.
- **Impact of exploitation**: A local user can write to any location in a file opened with `O_APPEND`, thereby bypassing the append-only restriction and potentially corrupting data or exploiting assumptions about append-only behavior.
- **Attack vectors**: The attack vector is the `splice()` system call with a file descriptor opened with `O_APPEND`.
- **Required attacker capabilities/position**: A local user with the ability to execute programs on the affected system is required.

```
CVE-2008-4554: The do_splice_from function in fs/splice.c in the
Linux kernel does not reject file descriptors that have the O_APPEND
flag set, which allows local users to bypass append mode and make
arbitrary changes to other locations in the file.
```
-   **Root cause of vulnerability:** The `do_splice_from` function in the Linux kernel's `fs/splice.c` file fails to properly handle file descriptors with the `O_APPEND` flag set.
-   **Weaknesses/vulnerabilities present:** The kernel does not reject files with the `O_APPEND` flag when they're used as destinations with the `splice()` syscall, effectively allowing writes to any offset in the file, bypassing the append-only restriction.
-   **Impact of exploitation:** A local attacker can write to arbitrary locations within a file that was supposed to be append-only. This bypass can lead to data corruption or other unintended consequences, particularly if software relies on the append-only behavior.
-   **Attack vectors:** The vulnerability is triggered by calling the `splice()` system call with a file descriptor that has the `O_APPEND` flag set as a target.
-   **Required attacker capabilities/position:** The attacker must be a local user with the ability to execute code on the affected system and call the `splice()` system call.