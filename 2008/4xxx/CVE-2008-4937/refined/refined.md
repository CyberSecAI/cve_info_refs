```
Message-Id: <200810302253.40409.rbu@gentoo.org>
Date: Thu, 30 Oct 2008 22:53:29 +0100
From: Robert Buchholz <rbu@...too.org>
To: oss-security <oss-security@...ts.openwall.com>
Subject: CVE requests: tempfile issues for aview, mgetty, openoffice, crossfire

Hi,

Gentoo could need CVEs for some more of the insecure tempfile issues
found by Debian. For others, we have gathered a list of all the bugs
created at our tracker <https://bugs.gentoo.org/show_bug.cgi?id=235770>

* openoffice.org
DEBIAN: <http://bugs.debian.org/496361>
GENTOO: <https://bugs.gentoo.org/235824>
<http://www.securityfocus.com/bid/30925>
FILES: senddoc
CODE:
<http://dev.gentoo.org/~rbu/security/debiantemp/openoffice.org-common>
   [etch] - openoffice.org <not-affected> (Vulnerable code not present)
   NOTE: also not present in 3.0.0, only in 2.4.1. Fix pending upload.
```
- Root cause of vulnerability: The `senddoc` script in OpenOffice.org creates temporary files in an insecure manner. Specifically, it uses predictable filenames within the `/tmp` directory, which can be exploited using symlink attacks.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability.
- Impact of exploitation: A local attacker can exploit a race condition to overwrite arbitrary files on the system with the privileges of the user running the `senddoc` script.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position: Ability to create symlinks in the `/tmp` directory, and the knowledge of how the `senddoc` script creates its temporary files.

```
# OpenOffice.org: Multiple vulnerabilities â€” GLSA **200812-13**

Multiple vulnerabilities in OpenOffice.org might allow for user-assisted
execution of arbitrary code or symlink attacks.

### Description

Dmitry
E. Oboukhov also reported an insecure temporary file usage within the
senddoc script (CVE-2008-4937).

### Impact

A local
attacker could perform symlink attacks to overwrite arbitrary files on
the system. Both cases happen with the privileges of the user running
the application.
```
- Root cause of vulnerability: The `senddoc` script in OpenOffice.org creates temporary files in an insecure manner, using predictable filenames in `/tmp` leading to a symlink vulnerability.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability
- Impact of exploitation:  A local attacker can overwrite arbitrary files on the system with the privileges of the user running OpenOffice.org.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position: Ability to create symlinks in the /tmp directory and knowledge of how `senddoc` creates its temporary files.

```
# Debian Bug report logs - #496361 The possibility of attack with the help of symlinks in some Debian packages

Binary-package: openoffice.org-common (1:2.4.1-6)
    file: /usr/lib/openoffice/program/senddoc
```
- Root cause of vulnerability: The `senddoc` script in OpenOffice.org uses predictable temporary filenames within the `/tmp` directory, making it vulnerable to symlink attacks.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability.
- Impact of exploitation: A local attacker can exploit a race condition to overwrite arbitrary files on the system with the privileges of the user running the `senddoc` script.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position: Ability to create symlinks in the `/tmp` directory, knowledge of how `senddoc` creates its temporary files.

```
RE> I guess you mean this snippet in the mutt handling part of senddoc?

[...]
                                --body)
                                        TEMPLATE="`basename $0`.mutt.XXXXXXXX"
                                        BODY=`mktemp -q -t ${TEMPLATE}`
                                        echo "$2" > $BODY
                                        shift
[...]
                x-terminal-emulator -e ${MAILER} \
                        ${FROM:+-e} ${FROM:+"set from=\"${FROM}\""} \
                        ${CC:+-c} ${CC:+"${CC}"} \
                        ${BCC:+-b} ${BCC:+"${BCC}"} \
                        ${SUBJECT:+-s} ${SUBJECT:+"${SUBJECT}"} \
                        ${BODY:+-i} ${BODY:+"${BODY}"} \
                        ${ATTACH:+-a} ${ATTACH:+"${ATTACH}"} \
                        ${TO:+"${TO}"} &
                rm -f $BODY
[...]

I so far thought mktemp was safe enough? (of course, we get
senddoc.mutt.<number>, but...
```
This section of the code is **not vulnerable** as it uses `mktemp` to create temporary files. However, the following part is vulnerable as it uses hardcoded filenames.
```
>    $ grep -A5 -B5 /tmp/ /usr/lib/openoffice/program/senddoc
>     #!/bin/sh
>     URI_ENCODE="`dirname $0`/uri-encode"
>
>     echo "$@" > /tmp/log.obr.$$
>     echo "$#" >> /tmp/log.obr.$$

example for attacker script:

#!...perl

$file_for_attack='/path/to/file';

while(1)
{
    exit unless fork;
    symlink $file_for_attack, "/tmp//tmp/log.obr.$_" for ($$ .. $$+10000);
}
```
This snippet shows that the issue lies in creating predictable files named `/tmp/log.obr.$$`, not the `mktemp` snippet.

```
> mktemp is safe enough. I think Dmitry refers to lines 3 and 4 of that script:
>
> echo "$@" > /tmp/log.obr.$$
> echo "$#" >> /tmp/log.obr.$$
>
> which I agree should not be there, probably leftover debug code?
```
This confirms that the vulnerability is due to the `echo` lines creating predictable files, not `mktemp`.
```
* [CVE-2008-4937](/security/CVE-2008-4937)

Dmitry E. Oboukhov discovered that senddoc, as included in OpenOffice.org,

created temporary files in an insecure way. Local users could exploit a race

condition to create or overwrite files with the privileges of the user invoking

the program. This issue only affected Ubuntu 8.04 LTS. ([CVE-2008-4937](/security/CVE-2008-4937))
```
- Root cause of vulnerability: The `senddoc` script creates temporary files with predictable names in `/tmp` without sufficient protection against race conditions.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability
- Impact of exploitation: A local user can overwrite arbitrary files with the privileges of the user invoking the `senddoc` program.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position: Ability to create symlinks in `/tmp`, and know how `senddoc` generates temporary filenames.

```
  [Comment 1](#c1)  Christian Hoffmann (RETIRED)   gentoo-dev  2008-08-26 20:17:39 UTC  ``` Confirmed, we are installing /usr/lib/openoffice/program/senddoc and it contains code which allows for overwriting arbitrary files via symlink attacks. Tested 2.4.1, 3* is still hardmasked on Gentoo and is not vulnerable according to $URL.  This (lines 3 and 4 in the mentioned script) just looks like debug code which could probably removed without problems. ```
```
Confirmed, we are installing /usr/lib/openoffice/program/senddoc and it contains code which allows for overwriting arbitrary files via symlink attacks. Tested 2.4.1, 3* is still hardmasked on Gentoo and is not vulnerable according to $URL. This (lines 3 and 4 in the mentioned script) just looks like debug code which could probably removed without problems.
```
- Root cause of vulnerability: The `senddoc` script in OpenOffice.org 2.4.1 includes code that creates temporary files in an insecure way, susceptible to symlink attacks.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability.
- Impact of exploitation: A local attacker can overwrite arbitrary files via symlink attacks by exploiting the vulnerable `senddoc` script.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position: Local access, and ability to create symlinks to exploit the insecure temp file creation.

```
     - remove leftover debugging echos to /tmp/log.obr.$$ in senddoc
       (closes: #[496361](bugreport.cgi?bug=496361))
```
This indicates that the fix was to remove the insecure lines of code.

```
  * debian/rules:
     - remove leftover debugging echos to /tmp/log.obr.$$ in senddoc
       (closes: #[496361](bugreport.cgi?bug=496361))
```
- Vulnerable code: Lines that echo debug statements to predictable file names in /tmp, like `/tmp/log.obr.$$`
- Fix: Removal of the debugging `echo` statements that create predictable temporary files in /tmp.
```
Multiple memory overflow flaws were discovered in OpenOffice.org's handling of

WMF and EMF files. If a user were tricked into opening a specially crafted

document, a remote attacker might be able to execute arbitrary code with user

privileges. ([CVE-2008-2237](/security/CVE-2008-2237), [CVE-2008-2238](/security/CVE-2008-2238))

Dmitry E. Oboukhov discovered that senddoc, as included in OpenOffice.org,

created temporary files in an insecure way. Local users could exploit a race

condition to create or overwrite files with the privileges of the user invoking

the program. This issue only affected Ubuntu 8.04 LTS. ([CVE-2008-4937](/security/CVE-2008-4937))
```
- Root cause of vulnerability: The `senddoc` script creates temporary files in an insecure way with predictable names in `/tmp`.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability.
- Impact of exploitation: A local user can create or overwrite files with the privileges of the user invoking the `senddoc` program via a symlink race condition.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position:  Ability to create symlinks in the `/tmp` directory, and knowledge of how `senddoc` script creates temporary files.

```
(CVE-2008-4937)
- app-office/openoffice < 3.0.0 insecure temp file usage (CVE-2008-4937)
```
- Root cause of vulnerability: The `senddoc` script in versions of `app-office/openoffice` prior to 3.0.0 uses insecure temporary file creation methods within the `/tmp` directory.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability.
- Impact of exploitation: A local attacker could perform symlink attacks to overwrite arbitrary files on the system with the privileges of the user invoking the affected application.
- Attack vectors: Local. An attacker needs local access to the system.
- Required attacker capabilities/position: Local access, and the ability to create symlinks in the `/tmp` directory, plus knowledge of how `senddoc` creates its temporary files.

```
  [Comment 1](#c1)  Christian Hoffmann (RETIRED)   gentoo-dev  2008-08-26 20:17:39 UTC  ``` Confirmed, we are installing /usr/lib/openoffice/program/senddoc and it contains code which allows for overwriting arbitrary files via symlink attacks. Tested 2.4.1, 3* is still hardmasked on Gentoo and is not vulnerable according to $URL.  This (lines 3 and 4 in the mentioned script) just looks like debug code which could probably removed without problems.
```
- Root cause of vulnerability: The `senddoc` script in OpenOffice.org version 2.4.1 contains vulnerable code related to creating temporary files that is susceptible to symlink attacks.
- Weaknesses/vulnerabilities present: Insecure temporary file creation, symlink vulnerability.
- Impact of exploitation: A local attacker can overwrite arbitrary files with the privileges of the user executing `senddoc`.
- Attack vectors: Local. The attacker requires local access.
- Required attacker capabilities/position: Local system access, ability to create symlinks, and knowledge of how the script generates temporary filenames.

```
 Dm-crypt/hu
  DISTDIR/hu
  Monit/hu
  PKGDIR/hu
```
These are wiki pages in Hungarian, and do not provide any information about CVE-2008-4937.

```
Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...
```
This is about the NVD backlog and not related to this CVE.

```
A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 496361@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Rene Engelhard <rene@debian.org> (supplier of updated openoffice.org package)
```
This indicates that the bug is fixed by removing the vulnerable code.

```
# Minimal Installation CD
2025-01-19 601 MiB
```
This is just a download link for a minimal installation CD.
```
     - remove leftover debugging echos to /tmp/log.obr.$$ in senddoc
       (closes: #[496361](bugreport.cgi?bug=496361))
```
This shows that the fix was done by removing the vulnerable lines.