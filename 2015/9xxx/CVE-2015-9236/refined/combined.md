=== Content from github.com_5cb68681_20250125_041810.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhapijs%2Fhapi%2Fissues%2F2840)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhapijs%2Fhapi%2Fissues%2F2840)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=hapijs%2Fhapi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hapijs](/hapijs)
/
**[hapi](/hapijs/hapi)**
Public

* [Notifications](/login?return_to=%2Fhapijs%2Fhapi) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fhapijs%2Fhapi)
* [Star
   14.7k](/login?return_to=%2Fhapijs%2Fhapi)

* [Code](/hapijs/hapi)
* [Issues
  70](/hapijs/hapi/issues)
* [Pull requests
  15](/hapijs/hapi/pulls)
* [Actions](/hapijs/hapi/actions)
* [Projects
  0](/hapijs/hapi/projects)
* [Security](/hapijs/hapi/security)
* [Insights](/hapijs/hapi/pulse)

Additional navigation options

* [Code](/hapijs/hapi)
* [Issues](/hapijs/hapi/issues)
* [Pull requests](/hapijs/hapi/pulls)
* [Actions](/hapijs/hapi/actions)
* [Projects](/hapijs/hapi/projects)
* [Security](/hapijs/hapi/security)
* [Insights](/hapijs/hapi/pulse)

# CORS route-specific override can conflict with connection defaults #2840

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[CORS route-specific override can conflict with connection defaults](#top)#2840Copy linkAssignees [![hueniverse](https://avatars.githubusercontent.com/u/56631?s=64&u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4)](/hueniverse)Labels[breaking changesChange that can breaking existing code](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22breaking%20changes%22)Change that can breaking existing code[bugBug or defect](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22bug%22)Bug or defect[securityIssue with security impact](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22security%22)Issue with security impactMilestone[11.0.0](https://github.com/hapijs/hapi/milestone/168)[![@hueniverse](https://avatars.githubusercontent.com/u/56631?u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4&size=80)](/hueniverse)
## Description

[![@hueniverse](https://avatars.githubusercontent.com/u/56631?u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4&size=48)](/hueniverse)[hueniverse](https://github.com/hueniverse)opened [on Oct 14, 2015](https://github.com/hapijs/hapi/issues/2840#issue-111349802)

If the connection has CORS enabled but one route has it off, and the route is not GET, the OPTIONS prefetch request will return the default CORS headers and then the actual request will go through and return no CORS headers. This defeats the purpose of turning CORS on the route.

Also, try to automate Access-Control-Allow-Methods

## Metadata

### Assignees

* [![@hueniverse](https://avatars.githubusercontent.com/u/56631?s=64&u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4)hueniverse](/hueniverse)
### Labels

[breaking changesChange that can breaking existing code](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22breaking%20changes%22)Change that can breaking existing code[bugBug or defect](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22bug%22)Bug or defect[securityIssue with security impact](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22security%22)Issue with security impact
### Type

No type
### Projects

No projects
### Milestone

* [11.0.0](https://github.com/hapijs/hapi/milestone/168)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dc78b6c2_20250125_041811.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhapijs%2Fhapi%2Fissues%2F2850)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhapijs%2Fhapi%2Fissues%2F2850)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=hapijs%2Fhapi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hapijs](/hapijs)
/
**[hapi](/hapijs/hapi)**
Public

* [Notifications](/login?return_to=%2Fhapijs%2Fhapi) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fhapijs%2Fhapi)
* [Star
   14.7k](/login?return_to=%2Fhapijs%2Fhapi)

* [Code](/hapijs/hapi)
* [Issues
  70](/hapijs/hapi/issues)
* [Pull requests
  15](/hapijs/hapi/pulls)
* [Actions](/hapijs/hapi/actions)
* [Projects
  0](/hapijs/hapi/projects)
* [Security](/hapijs/hapi/security)
* [Insights](/hapijs/hapi/pulse)

Additional navigation options

* [Code](/hapijs/hapi)
* [Issues](/hapijs/hapi/issues)
* [Pull requests](/hapijs/hapi/pulls)
* [Actions](/hapijs/hapi/actions)
* [Projects](/hapijs/hapi/projects)
* [Security](/hapijs/hapi/security)
* [Insights](/hapijs/hapi/pulse)

# 11.0.0 Release Notes #2850

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[11.0.0 Release Notes](#top)#2850Copy linkAssignees [![hueniverse](https://avatars.githubusercontent.com/u/56631?s=64&u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4)](/hueniverse)Labels[breaking changesChange that can breaking existing code](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22breaking%20changes%22)Change that can breaking existing code[release notesMajor release documentation](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22release%20notes%22)Major release documentationMilestone[11.0.0](https://github.com/hapijs/hapi/milestone/168)[![@hueniverse](https://avatars.githubusercontent.com/u/56631?u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4&size=80)](/hueniverse)
## Description

[![@hueniverse](https://avatars.githubusercontent.com/u/56631?u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4&size=48)](/hueniverse)[hueniverse](https://github.com/hueniverse)opened [on Oct 16, 2015](https://github.com/hapijs/hapi/issues/2850#issue-111895000)
## Summary

**hapi** v11.0.0 is primarily a rewrite of the CORS implementation. The previous code was both confusing, an incorrect implementation of the protocol, and allowed for configurations that at best returned inconsistent headers and at worst allowed cross-origin activities that were expected to be forbidden. The change removes half the CORS options available and moves the implementation to be truly per-route without any connection-wide catch-all.

* **Upgrade time**: low - no time to a couple of hours for most users
* **Complexity**: low - a bit of search and replace and removal of unsupported configs
* **Risk**: low - low risk of side effects and few changes to keep track of overall
* **Dependencies**: medium - removed the `server.after()` method

## Sponsor

[![](https://camo.githubusercontent.com/f1a30eb9d22d76bab14c345cde88d4b5f8f669b3eee6b011f8aa40db8d2fb919/687474703a2f2f626c6f672e736964657761792e636f6d2f77702d636f6e74656e742f75706c6f6164732f6c6f676f2d333030783131342e706e67)](https://sideway.com)

The v11.0.0 major release is sponsored by [Sideway](https://sideway.com).

## Breaking Changes

* Removed the CORS configuration options: `methods`, `additionalMethods`, `matchOrigin`, `isOriginExposed`, and `override`.
* Added the `204` HTTP status code to the default list of cached responses.
* The qs module no longer parses dot notation names into sub objects by default.
* Removed `server.after()`.
* Removed `id` from the `'received'` event data (was already available as a generic event property).

## New Features

* Allow response validation of non-object responses (string, number, etc).
* New option to override empty `200` HTTP status responses with `204`.

## Bug fixes

* Fixes multiple issues with CORS, including a few security related.

## Updated dependencies

* **qs** from v4.0.0 to v5.2.0

## Migration Checklist

### CORS

You don't have to change anything if:

* not setting the `cors` route option
* using it with the defaults by setting the value to `true`
* not using the `cors` options: `methods`, `additionalMethods`, `matchOrigin`, `isOriginExposed`, and `override`

The main changes are:

* CORS preflight headers are now set only on preflight requests and not on resource requests. This means that the `methods` and `additionalMethods` options are no longer needed because the preflight response will return the requested method as specified by the protocol. This will ensure other methods which may not allow cross-origin access to be separately configured.
* The `override` flag is no longer needed as the only header which you may manually set at the handler level is Access-Control-Expose-Headers which will be appended to by default. Setting any other CORS headers manually will result in a conflict with the preflight response.
* The Access-Control-Allow-Origin header is now always set to the incoming Origin header value. If the incoming value does not match the allowed origins, no CORS headers are set.

Checklist:

* Make sure that if you are using the internal CORS feature, you are not setting **ANY** CORS headers yourself other than optionally Access-Control-Expose-Headers. If you need to set any other header manually, do not use the CORS feature! You will end up with a broken and potentially insecure implementation.
* Remove the options no longer supported. There is no need to replace them.

### Misc

* If you rely on the previous **qs** query parsing behavior of breaking dot-notation into segments, you must set the `allowDots` option to `true`. This is available in route config `payload.qs` and connection config `query.qs`.
* Replace `server.after(method, deps)` with `server.ext('onPreStart', method, { after: deps })`.
* If you listen to the request `'received'` event, use the `event.request` value instead of the removed `event.data.id` value.
## Metadata

### Assignees

* [![@hueniverse](https://avatars.githubusercontent.com/u/56631?s=64&u=e53e16a9474a6852a696d6bba11943f7a35d9b1a&v=4)hueniverse](/hueniverse)
### Labels

[breaking changesChange that can breaking existing code](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22breaking%20changes%22)Change that can breaking existing code[release notesMajor release documentation](https://github.com/hapijs/hapi/issues?q=state%3Aopen%20label%3A%22release%20notes%22)Major release documentation
### Type

No type
### Projects

No projects
### Milestone

* [11.0.0](https://github.com/hapijs/hapi/milestone/168)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


