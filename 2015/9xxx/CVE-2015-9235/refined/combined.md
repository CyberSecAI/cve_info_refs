=== Content from www.timmclean.net_81d45dc6_20250125_123802.html ===

[Chosen Plaintext](/blog/)
[Blog](/blog)
[Open Source](/open-source)
[Subscribe](/subscribe)

# Critical vulnerabilities in JSON Web Token libraries

March 2015

*This article originally appeared as a guest post on [Auth0âs
blog](https://auth0.com/blog/2015/03/31/critical-vulnerabilities-in-json-web-token-libraries/).
Many thanks to them for publishing it and for helping me track down library
maintainers.*

Recently, while reviewing the security of various JSON Web Token
implementations, I found many libraries with critical vulnerabilities allowing
attackers to bypass the verification step. The same two flaws were found
across many implementations and languages, so I thought it would be helpful to
write up exactly where the problems occur. I believe that a change to the
standard could help prevent future vulnerabilities.

For those who are unfamiliar, JSON Web Token (JWT) is a standard for creating
tokens that assert some number of claims. For example, a server could generate
a token that has the claim âlogged in as adminâ and provide that to a client.
The client could then use that token to prove that they are logged in as admin.
The tokens are signed by the serverâs key, so the server is able to verify that
the token is legitimate.

JWTs generally have three parts: a header, a payload, and a signature. The
header identifies which algorithm is used to generate the signature, and looks
something like this:

```
header = '{"alg":"HS256","typ":"JWT"}'
```

`HS256` indicates that this token is signed using HMAC-SHA256.

The payload contains the claims that we wish to make:

```
payload = '{"loggedInAs":"admin","iat":1422779638}'
```

As suggested in the JWT spec, we include a timestamp called `iat`, short for
âissued atâ.

The signature is calculated by base64url encoding the header and payload and
concatenating them with a period as a separator:

```
key = 'secretkey'
unsignedToken = encodeBase64(header) + '.' + encodeBase64(payload)
signature = HMAC-SHA256(key, unsignedToken)
```

To put it all together, we base64url encode the signature, and join together
the three parts using periods:

```
token = encodeBase64(header) + '.' + encodeBase64(payload) + '.' + encodeBase64(signature)

# token is now:
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dnZWRJbkFzIjoiYWRtaW4iLCJpYXQiOjE0MjI3Nzk2Mzh9.gzSraSYS8EXBxLN_oWnFSRgCzcmJmMjLiuyu5CSpyHI
```
## Great. So, whatâs wrong with that?

Well, letâs try to verify a token.

First, we need to determine what algorithm was used to generate the
signature. No problem, thereâs an `alg` field in the header that tells us just
that.

But wait, we havenât validated this token yet, which means that we havenât
validated the header. This puts us in an awkward position: in order to
validate the token, we have to allow attackers to select which method we use to
verify the signature.

This has disastrous implications for some implementations.

## Meet the ânoneâ algorithm

The `none` algorithm is a curious addition to JWT. It is intended to be used
for situations where the integrity of the token has already been verified.
Interestingly enough, it is one of only two algorithms that are mandatory to
implement (the other being `HS256`).

Unfortunately, some libraries treated tokens signed with the `none` algorithm
as a valid token with a verified signature. The result? Anyone can create
their own âsignedâ tokens with whatever payload they want, allowing arbitrary
account access on some systems.

Putting together such a token is easy. Modify the above example header to
contain `"alg": "none"` instead of `HS256`. Make any desired changes to the
payload. Use an empty signature (i.e. `signature = ""`).

Most (hopefully all?) implementations now have a basic check to prevent this
attack: if a secret key was provided, then token verification will fail for
tokens using the `none` algorithm. This is a good idea, but it doesnât solve
the underlying problem: attackers control the choice of algorithm. Letâs keep
digging.

## RSA or HMAC?

The JWT spec also defines a number of asymmetric signing algorithms (based on
RSA and ECDSA). With these algorithms, tokens are created and signed using a
private key, but verified using a corresponding public key. This is pretty
neat: if you publish the public key but keep the private key to yourself, only
you can sign tokens, but anyone can check if a given token is correctly signed.

Most of the JWT libraries that Iâve looked at have an API like this:

```
# sometimes called "decode"
verify(string token, string verificationKey)
# returns payload if valid token, else throws an error
```

In systems using HMAC signatures, `verificationKey` will be the serverâs secret
signing key (since HMAC uses the same key for signing and verifying):

```
verify(clientToken, serverHMACSecretKey)
```

In systems using an asymmetric algorithm, `verificationKey` will be the public
key against which the token should be verified:

```
verify(clientToken, serverRSAPublicKey)
```

Unfortunately, an attacker can abuse this. If a server is expecting a token
signed with RSA, but actually receives a token signed with HMAC, **it will
think the public key is actually an HMAC secret key**.

How is this a disaster? HMAC secret keys are supposed to be kept private,
while public keys are, well, public. This means that your typical [ski
mask-wearing attacker](https://i.imgur.com/18fM5ja.jpg) has access to the
public key, and can use this to forge a token that the server will accept.

Doing so is pretty straightforward. First, grab your favourite JWT library,
and choose a payload for your token. Then, get the public key used on the
server as a verification key (most likely in the text-based PEM format).
Finally, sign your token using the PEM-formatted public key as an HMAC key.
Essentially:

```
forgedToken = sign(tokenPayload, 'HS256', serverRSAPublicKey)
```

The trickiest part is making sure that `serverRSAPublicKey` is identical to the
verification key used on the server. The strings must match exactly for the
attack to work â exact same format, and no extra or missing line breaks.

End result? Anyone with knowledge of the public key can forge tokens that will
pass verification.

## How can libraries fix this?

I suggest that JWT libraries add an `algorithm` parameter to their verification function:

```
verify(string token, string algorithm, string verificationKey)
```

The server should already know what algorithm it uses to sign tokens, and itâs
not safe to allow attackers to provide this value.

Some might argue that some servers need to support more than one algorithm for
compatibility reasons. In this case, a separate key can (and should) be used
for each supported algorithm. JWT conveniently provides a âkey IDâ field
(`kid`) for exactly this purpose. Since servers can use the key ID to look up
the key and its corresponding algorithm, attackers are no longer able to
control the manner in which a key is used for verification. In any case, I
donât think JWT libraries should even look at the `alg` field in the header,
except maybe to check that it matches what was the expected algorithm.

Anyone using a JWT implementation should make sure that tokens with a different
signature type are guaranteed to be rejected. Some libraries have an optional
mechanism for whitelisting or blacklisting algorithms; take advantage of it or
you might end up at risk. Even better: have a policy of performing security
audits on any open source libraries that you use to provide mission-critical
funtionality.

## Improving the JWT/JWS standard

I would like to propose deprecating the headerâs `alg` field. As weâve seen
here, its misuse can have a devastating impact on the security of a JWT/JWS
implementation. As far as I can tell, key IDs provide an adequate alternative.
This warrants a change to the spec: JWT libraries continue to be written with
security flaws due to their dependence on `alg`.

JWT (and JOSE) present the opportunity to have a cross-platform suite of secure
cryptography implementations. With these fixes, hopefully weâre a little bit
closer to making that a reality.

[![Creative Commons License](https://i.creativecommons.org/l/by/4.0/88x31.png)](http://creativecommons.org/licenses/by/4.0/)
The above work is licensed under a [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/).

[↵ Back to article list](/blog)

## Subscribe for more

Did you enjoy this article?
Subscribe below to receive future posts:

First Name

Email Address

© 2014-2023 Chosen Plaintext Consulting Inc.

[Mastodon](https://infosec.exchange/%40timmclean)
[Twitter](https://twitter.com/McLean0)



=== Content from github.com_962878ae_20250125_123800.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fauth0%2Fnode-jsonwebtoken%2Fcommit%2F1bb584bc382295eeb7ee8c4452a673a77a68b687)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fauth0%2Fnode-jsonwebtoken%2Fcommit%2F1bb584bc382295eeb7ee8c4452a673a77a68b687)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=auth0%2Fnode-jsonwebtoken)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[auth0](/auth0)
/
**[node-jsonwebtoken](/auth0/node-jsonwebtoken)**
Public

* [Notifications](/login?return_to=%2Fauth0%2Fnode-jsonwebtoken) You must be signed in to change notification settings
* [Fork
  1.2k](/login?return_to=%2Fauth0%2Fnode-jsonwebtoken)
* [Star
   17.8k](/login?return_to=%2Fauth0%2Fnode-jsonwebtoken)

* [Code](/auth0/node-jsonwebtoken)
* [Issues
  125](/auth0/node-jsonwebtoken/issues)
* [Pull requests
  44](/auth0/node-jsonwebtoken/pulls)
* [Actions](/auth0/node-jsonwebtoken/actions)
* [Projects
  0](/auth0/node-jsonwebtoken/projects)
* [Wiki](/auth0/node-jsonwebtoken/wiki)
* [Security](/auth0/node-jsonwebtoken/security)
* [Insights](/auth0/node-jsonwebtoken/pulse)

Additional navigation options

* [Code](/auth0/node-jsonwebtoken)
* [Issues](/auth0/node-jsonwebtoken/issues)
* [Pull requests](/auth0/node-jsonwebtoken/pulls)
* [Actions](/auth0/node-jsonwebtoken/actions)
* [Projects](/auth0/node-jsonwebtoken/projects)
* [Wiki](/auth0/node-jsonwebtoken/wiki)
* [Security](/auth0/node-jsonwebtoken/security)
* [Insights](/auth0/node-jsonwebtoken/pulse)

## Commit

[Permalink](/auth0/node-jsonwebtoken/commit/1bb584bc382295eeb7ee8c4452a673a77a68b687)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Verification with an asymmetric key of a token signed with a symmetri…

[Browse files](/auth0/node-jsonwebtoken/tree/1bb584bc382295eeb7ee8c4452a673a77a68b687)
Browse the repository at this point in the history

```
…c key

There is a vulnerability in this module when the verification part is expecting a token digitally signed with an asymetric key (RS/ES family) of algorithms but instead the attacker send a token digitally signed with a symmetric algorithm (HS* family).

The issue is because this library has the very same signature to verify both type of tokens (parameter: `secretOrPublicKey`).

This change adds a new parameter to the verify called `algorithms`. This can be used to specify a list of supported algorithms, but the default value depends on the secret used: if the secretOrPublicKey contains the string `BEGIN CERTIFICATE` the default is `[ 'RS256','RS384','RS512','ES256','ES384','ES512' ]` otherwise is `[ 'HS256','HS384','HS512' ]`.
```

* Loading branch information

[![@jfromaniello](https://avatars.githubusercontent.com/u/178512?s=40&v=4)](/jfromaniello)

[jfromaniello](/auth0/node-jsonwebtoken/commits?author=jfromaniello "View all commits by jfromaniello")
committed
Mar 16, 2015

1 parent
[f9f3c34](/auth0/node-jsonwebtoken/commit/f9f3c34f8478b1b81070bf0a6da3fd48f2ee70be)

commit 1bb584b

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**33 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .jshintrc
  [.jshintrc](#diff-c3ca886e85c3a97b5cc4c34d04e5b9d5c78359b1e69fd09b74a842b5dea81bb0)
* index.js
  [index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346)
* test

  + test/wrong\_alg.tests.js
    [wrong\_alg.tests.js](#diff-39a14b6466916670295a9dd9c34d0aa28b9916b77c7baaaddee2a90d2f434883)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[.jshintrc](#diff-c3ca886e85c3a97b5cc4c34d04e5b9d5c78359b1e69fd09b74a842b5dea81bb0 ".jshintrc")

Show comments

[View file](/auth0/node-jsonwebtoken/blob/1bb584bc382295eeb7ee8c4452a673a77a68b687/.jshintrc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,6 +15,7 @@ |
|  |  | "it": true, |
|  |  | "require": true, |
|  |  | "atob": false, |
|  |  | "escape": true |
|  |  | "escape": true, |
|  |  | "before": true |
|  |  | } |
|  |  | } |

11 changes: 11 additions & 0 deletions

11
[index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346 "index.js")

Show comments

[View file](/auth0/node-jsonwebtoken/blob/1bb584bc382295eeb7ee8c4452a673a77a68b687/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -107,6 +107,12 @@ module.exports.verify = function(jwtString, secretOrPublicKey, options, callback |
|  |  | return done(new JsonWebTokenError('jwt signature is required')); |
|  |  | } |
|  |  |  |
|  |  | if (!options.algorithms) { |
|  |  | options.algorithms = ~secretOrPublicKey.toString().indexOf('BEGIN CERTIFICATE') ? |
|  |  | [ 'RS256','RS384','RS512','ES256','ES384','ES512' ] : |
|  |  | [ 'HS256','HS384','HS512' ]; |
|  |  | } |
|  |  |  |
|  |  | var valid; |
|  |  |  |
|  |  | try { |
| Expand All | | @@ -126,6 +132,11 @@ module.exports.verify = function(jwtString, secretOrPublicKey, options, callback |
|  |  | return done(err); |
|  |  | } |
|  |  |  |
|  |  | var header = jws.decode(jwtString).header; |
|  |  | if (!~options.algorithms.indexOf(header.alg)) { |
|  |  | return done(new JsonWebTokenError('invalid signature')); |
|  |  | } |
|  |  |  |
|  |  | if (typeof payload.exp !== 'undefined' && !options.ignoreExpiration) { |
|  |  | if (typeof payload.exp !== 'number') { |
|  |  | return done(new JsonWebTokenError('invalid exp value')); |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[test/wrong\_alg.tests.js](#diff-39a14b6466916670295a9dd9c34d0aa28b9916b77c7baaaddee2a90d2f434883 "test/wrong_alg.tests.js")

Show comments

[View file](/auth0/node-jsonwebtoken/blob/1bb584bc382295eeb7ee8c4452a673a77a68b687/test/wrong_alg.tests.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,20 @@ |
|  |  | var fs = require('fs'); |
|  |  | var path = require('path'); |
|  |  | var jwt = require('../index'); |
|  |  | var JsonWebTokenError = require('../lib/JsonWebTokenError'); |
|  |  | var expect = require('chai').expect; |
|  |  |  |
|  |  |  |
|  |  | var pub = fs.readFileSync(path.join(\_\_dirname, 'pub.pem'), 'utf8'); |
|  |  | // priv is never used |
|  |  | // var priv = fs.readFileSync(path.join(\_\_dirname, 'priv.pem')); |
|  |  |  |
|  |  | var TOKEN = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE0MjY1NDY5MTl9.ETgkTn8BaxIX4YqvUWVFPmum3moNZ7oARZtSBXb\_vP4'; |
|  |  |  |
|  |  | describe('signing with pub key as symmetric', function () { |
|  |  | it('should not verify', function () { |
|  |  | expect(function () { |
|  |  | jwt.verify(TOKEN, pub); |
|  |  | }).to.throw(JsonWebTokenError, /invalid signature/); |
|  |  | }); |
|  |  | }); |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1bb584b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fauth0%2Fnode-jsonwebtoken%2Fcommit%2F1bb584bc382295eeb7ee8c4452a673a77a68b687) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


