=== Content from bugzilla.redhat.com_9feee95f_20250124_134329.html ===
From b71b11b835214e29b8bf9e45139efbfaa03f1a16 Mon Sep 17 00:00:00 2001
From: Jan Cholasta
Date: Mon, 21 Sep 2015 08:32:04 +0200
Subject: [PATCH] install: fix KRA agent PEM file permissions
---
install/restart\_scripts/renew\_ra\_cert | 8 +-------
ipaserver/install/dogtaginstance.py | 22 ++++++++++++++++++++++
ipaserver/install/krainstance.py | 12 +++---------
ipaserver/install/server/upgrade.py | 19 +++++++++++++++++++
4 files changed, 45 insertions(+), 16 deletions(-)
diff --git a/install/restart\_scripts/renew\_ra\_cert b/install/restart\_scripts/renew\_ra\_cert
index 4337e7a..57cfd92 100644
--- a/install/restart\_scripts/renew\_ra\_cert
+++ b/install/restart\_scripts/renew\_ra\_cert
@@ -63,13 +63,7 @@ def \_main():
kra = krainstance.KRAInstance(api.env.realm)
if kra.is\_installed():
- # export ipaCert with private key for client authentication
- args = ["/usr/bin/pki",
- "-d", paths.HTTPD\_ALIAS\_DIR,
- "-C", paths.ALIAS\_PWDFILE\_TXT,
- "client-cert-show", "ipaCert",
- "--client-cert", paths.KRA\_AGENT\_PEM]
- ipautil.run(args)
+ krainstance.export\_kra\_agent\_pem()
finally:
shutil.rmtree(tmpdir)
diff --git a/ipaserver/install/dogtaginstance.py b/ipaserver/install/dogtaginstance.py
index e8d17cb..20d5e4e 100644
--- a/ipaserver/install/dogtaginstance.py
+++ b/ipaserver/install/dogtaginstance.py
@@ -23,6 +23,7 @@ import shutil
import tempfile
import traceback
import dbus
+import pwd
from pki.client import PKIConnection
import pki.system
@@ -88,6 +89,27 @@ def is\_installing\_replica(sys\_type):
return False
+def export\_kra\_agent\_pem():
+ """
+ Export ipaCert with private key for client authentication.
+ """
+ fd, filename = tempfile.mkstemp(dir=paths.HTTPD\_ALIAS\_DIR)
+ os.close(fd)
+
+ args = ["/usr/bin/pki",
+ "-d", paths.HTTPD\_ALIAS\_DIR,
+ "-C", paths.ALIAS\_PWDFILE\_TXT,
+ "client-cert-show", "ipaCert",
+ "--client-cert", filename]
+ ipautil.run(args)
+
+ pent = pwd.getpwnam("apache")
+ os.chown(filename, 0, pent.pw\_gid)
+ os.chmod(filename, 0o440)
+
+ os.rename(filename, paths.KRA\_AGENT\_PEM)
+
+
class DogtagInstance(service.Service):
"""
This is the base class for a Dogtag 10+ instance, which uses a
diff --git a/ipaserver/install/krainstance.py b/ipaserver/install/krainstance.py
index 48268b0..0000192 100644
--- a/ipaserver/install/krainstance.py
+++ b/ipaserver/install/krainstance.py
@@ -37,8 +37,8 @@ from ipaserver.install import cainstance
from ipaserver.install import installutils
from ipaserver.install import ldapupdate
from ipaserver.install import service
-from ipaserver.install.dogtaginstance import DogtagInstance
-from ipaserver.install.dogtaginstance import DEFAULT\_DSPORT, PKI\_USER
+from ipaserver.install.dogtaginstance import (
+ DEFAULT\_DSPORT, PKI\_USER, export\_kra\_agent\_pem, DogtagInstance)
from ipaserver.plugins import ldap2
from ipapython.ipa\_log\_manager import log\_mgr
@@ -262,13 +262,7 @@ class KRAInstance(DogtagInstance):
shutil.move(paths.KRA\_BACKUP\_KEYS\_P12, paths.KRACERT\_P12)
- # export ipaCert with private key for client authentication
- args = ["/usr/bin/pki",
- "-d", paths.HTTPD\_ALIAS\_DIR,
- "-C", paths.ALIAS\_PWDFILE\_TXT,
- "client-cert-show", "ipaCert",
- "--client-cert", paths.KRA\_AGENT\_PEM]
- ipautil.run(args)
+ export\_kra\_agent\_pem()
self.log.debug("completed creating KRA instance")
diff --git a/ipaserver/install/server/upgrade.py b/ipaserver/install/server/upgrade.py
index 571e71b..8c32fe2 100644
--- a/ipaserver/install/server/upgrade.py
+++ b/ipaserver/install/server/upgrade.py
@@ -38,6 +38,7 @@ from ipaserver.install import otpdinstance
from ipaserver.install import schemaupdate
from ipaserver.install import sysupgrade
from ipaserver.install import dnskeysyncinstance
+from ipaserver.install import krainstance
from ipaserver.install.upgradeinstance import IPAUpgrade
from ipaserver.install.ldapupdate import BadSyntax
@@ -1250,6 +1251,23 @@ def fix\_trust\_flags():
sysupgrade.set\_upgrade\_state('http', 'fix\_trust\_flags', True)
+def export\_kra\_agent\_pem():
+ root\_logger.info('[Exporting KRA agent PEM file]')
+
+ if sysupgrade.get\_upgrade\_state('http', 'export\_kra\_agent\_pem'):
+ root\_logger.info("KRA agent PEM file already exported")
+ return
+
+ kra = krainstance.KRAInstance(api.env.realm)
+ if not kra.is\_installed():
+ root\_logger.info("KRA is not installed")
+ return
+
+ krainstance.export\_kra\_agent\_pem()
+
+ sysupgrade.set\_upgrade\_state('http', 'export\_kra\_agent\_pem', True)
+
+
def update\_mod\_nss\_protocol(http):
root\_logger.info('[Updating mod\_nss protocol versions]')
@@ -1451,6 +1469,7 @@ def upgrade\_configuration():
http.stop()
update\_mod\_nss\_protocol(http)
fix\_trust\_flags()
+ export\_kra\_agent\_pem()
http.start()
uninstall\_selfsign(ds, http)
--
2.4.3


=== Content from access.redhat.com_11c09e7c_20250126_012240.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from pagure.io_55255834_20250124_134331.html ===


[![pagure Logo](/theme/static/pagure-logo.png?version=5.14.1)](/)

* [Log In](/login/?next=https://pagure.io/freeipa/issue/5347)

###

### [**freeipa**](/freeipa)

Clone
##### **Source Code**

GIT

* [Source](/freeipa)
* [Issues
  1040](/freeipa/issues)
* [Roadmap](/freeipa/roadmap)
* [Stats](/freeipa/stats)

#### #5347 ipa-kra-install includes certificate and private key in world readable file Closed: Fixed None Opened 9 years ago by jcholast.

Closed: Fixed
Reopen Issue

It was discovered that ipa-kra-install puts the CA agent certificate and private key to a world readable file, /etc/httpd/alias/kra-agent.pem. This allows users on an IPA server where ipa-kra-install was run to issue arbitrary certificates with the IPA CA.

The ipa-kra-install script configures the KRA subsystem of Dogtag, which is used for the Password Vault feature of IPA. During the configuration process, a KRA agent user account is created in Dogtag, which is used by IPA to authenticate to the KRA. Currently the KRA agent uses the same certificate and private key as the CA agent, which IPA uses to authenticate to the CA.

The kra-agent.pem file is necessary because the Dogtag client Python library does not support using a certificate and private key from a NSS database for authentication, so it is not possible to use the CA agent certificate and private key directly from their primary location, which is the NSS database at /etc/httpd/alias.

---

![](https://seccdn.libravatar.org/avatar/a80b1f00cda52344c7127fa375f8e8bc9a1fdb06fb357ca34dfaada4530d77d7?s=16&d=retro)
[jcholast](/user/jcholast "Jan Cholasta (jcholast)")
[commented
9 years ago](#comment-333997 "Permalink to this headline")

master:

* [110e85c](/freeipa/c/110e85cc74051b02556ca2c43176c9ded40e75aa "Commit 110e85cc74051b02556ca2c43176c9ded40e75aa") install: fix KRA agent PEM file permissions

ipa-4-2:

* [55a66cc](/freeipa/c/55a66ccba3e2181a50e7733b7476991975b7455f "Commit 55a66ccba3e2181a50e7733b7476991975b7455f") install: fix KRA agent PEM file permissions

![](https://seccdn.libravatar.org/avatar/a80b1f00cda52344c7127fa375f8e8bc9a1fdb06fb357ca34dfaada4530d77d7?s=16&d=retro)

**Metadata Update from [@jcholast](https://pagure.io/user/jcholast)**:

- Issue assigned to jcholast

- Issue set to the milestone: FreeIPA 4.2.2

7 years ago

[Log in](/login/?next=https%3A%2F%2Fpagure.io%2Ffreeipa%2Fissue%2F5347)
to comment on this ticket.

##### Metadata

  **Assignee**
![](https://seccdn.libravatar.org/avatar/a80b1f00cda52344c7127fa375f8e8bc9a1fdb06fb357ca34dfaada4530d77d7?s=24&d=retro)
[jcholast](/freeipa/issues?assignee=jcholast "Jan Cholasta (jcholast)")

 **Tags**
None

  **Blocking**
None

  **Depending on**
None

  **Priority**
important

  **Milestone**
[FreeIPA 4.2.2](/freeipa/roadmap/FreeIPA%204.2.2/)

  **cc**
None

  **affects\_doc**
None

  **source**
None

  **knownissue**
None

  **type**
defect

  **blockedby**
None

  **test\_case**
None

  **component**
IPA

  **blocking**
None

  **on\_review**
0

  **keywords**
None

  **test\_coverage**
None

  **reviewer**
None

  **external\_tracker**
None

  **tester**
None

  **changelog**
None

  **design**
None

  **rhbz**
None

Powered by [Pagure](https://pagure.io/pagure) 5.14.1
[Documentation](https://docs.pagure.org/pagure/usage/index.html) •
[File an Issue](https://pagure.io/pagure/new_issue) •
[About](/about) •
[SSH Hostkey/Fingerprint](/ssh_info)

© Red Hat, Inc. and others.



=== Content from bugzilla.redhat.com_fb4874f5_20250124_134330.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1264790)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1264790)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1264790)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1264790

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1264790**](show_bug.cgi?id=1264790)
(CVE-2015-5284)
- [CVE-2015-5284](https://access.redhat.com/security/cve/CVE-2015-5284) ipa: ipa-kra-install includes certificate and private key in world readable file

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2015-5284 ipa: ipa-kra-install includes certificate and private key in wo...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2015-5284 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1264793](show_bug.cgi?id=1264793) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1264794](show_bug.cgi?id=1264794) | | TreeView+ | [depends on](buglist.cgi?bug_id=1264790&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1264790&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-09-21 08:46 UTC by Martin Prpič | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-05-12 18:36 UTC ([History](show_activity.cgi?id=1264790)) | | [CC List:](page.cgi?id=fields.html#cclist) | 8 users (show)  edewata jcholast mbasti mkosek nkinder rcritten security-response-team ssorce | | Fixed In Version: | ipa 4.2.2 | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2015-10-08 11:45:54 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**Proposed patch**](attachment.cgi?id=1075455 "View the content of the attachment") (5.27 KB, patch)  [2015-09-21 10:48 UTC](#attach_1075455 "Go to the comment associated with the attachment"), Jan Cholasta | *no flags* | [Details](attachment.cgi?id=1075455&action=edit) | [Diff](attachment.cgi?id=1075455&action=diff) | | [**Proposed patch**](attachment.cgi?id=1075511 "View the content of the attachment") (5.03 KB, patch)  [2015-09-21 12:39 UTC](#attach_1075511 "Go to the comment associated with the attachment"), Jan Cholasta | mbasti: review+ | [Details](attachment.cgi?id=1075511&action=edit) | [Diff](attachment.cgi?id=1075511&action=diff) | | [Show Obsolete](#a0) (1) [View All](attachment.cgi?bugid=1264790&action=viewall&hide_obsolete=1) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1264790#c0)  Martin Prpič    2015-09-21 08:46:26 UTC  ``` It was discovered that ipa-kra-install puts the CA agent certificate and private key to a world readable file, /etc/httpd/alias/kra-agent.pem. This allows users on an IPA server where ipa-kra-install was run to issue arbitrary certificates with the IPA CA.  The ipa-kra-install script configures the KRA subsystem of Dogtag, which is used for the Password Vault feature of IPA. During the configuration process, a KRA agent user account is created in Dogtag, which is used by IPA to authenticate to the KRA. Currently the KRA agent uses the same certificate and private key as the CA agent, which IPA uses to authenticate to the CA.  The kra-agent.pem file is necessary because the Dogtag client Python library does not support using a certificate and private key from a NSS database for authentication, so it is not possible to use the CA agent certificate and private key directly from their primary location, which is the NSS database at /etc/httpd/alias.   ```  [Comment 2](show_bug.cgi?id=1264790#c2)  Martin Prpič    2015-09-21 08:56:04 UTC  ``` Statement:  This issue did not affect the versions of ipa as shipped with Red Hat Enterprise Linux 6 and 7 as they did not include the affected KRA subsystem.   ```  [Comment 3](show_bug.cgi?id=1264790#c3)  Martin Prpič    2015-09-21 09:53:19 UTC  ``` Acknowledgements:  This issue was discovered by Jan Cholasta of Red Hat.   ```  [Comment 4](show_bug.cgi?id=1264790#c4)  Jan Cholasta    2015-09-21 10:48:38 UTC  ``` Created [attachment 1075455](attachment.cgi?id=1075455&action=diff "Proposed patch") [[details]](attachment.cgi?id=1075455&action=edit "Proposed patch") Proposed patch  See attachment for a patch fixing the issue.   ```  [Comment 5](show_bug.cgi?id=1264790#c5)  Jan Cholasta    2015-09-21 12:39:21 UTC  ``` Created [attachment 1075511](attachment.cgi?id=1075511&action=diff "Proposed patch") [[details]](attachment.cgi?id=1075511&action=edit "Proposed patch") Proposed patch  Found a copy & paste issue in the patch, updated patch attached.   ```  [Comment 6](show_bug.cgi?id=1264790#c6)  Martin Bašti    2015-09-22 06:51:08 UTC  ``` The updated patch works for me, ACK.   ```  [Comment 7](show_bug.cgi?id=1264790#c7)  Simo Sorce    2015-09-22 22:05:32 UTC  ``` Patch looks good to me.   ```  [Comment 8](show_bug.cgi?id=1264790#c8)  Tomas Hoger    2015-09-25 11:37:20 UTC  ``` Just to explicitly confirm, do the upgrade.py part of the patch take care of automatically fixing existing installations that already have the file with bad permissions?  I see ipa-server's %posttrans runs ipa-server-upgrade.  Is no manual action required after that?   ```  [Comment 9](show_bug.cgi?id=1264790#c9)  Martin Bašti    2015-09-25 11:45:27 UTC  ``` Yes, upgrade will fix permissions on file, no manual action is needed.   ```  [Comment 10](show_bug.cgi?id=1264790#c10)  Tomas Hoger    2015-09-25 11:53:43 UTC  ``` Affected functionality was introduced in IPA 4.2.  Therefore, this issue did not affect IPA versions as shipped with Red Hat Enterprise Linux 6 and 7.  The new IPA 4.2 is part of Red Hat Enterprise Linux 7.2 Beta and it is planned to be addressed before the final release of Red Hat Enterprise Linux 7.2.   ```  [Comment 11](show_bug.cgi?id=1264790#c11)  Jan Cholasta    2015-09-30 05:24:28 UTC  ``` Actually, the certificate is not revoked during the upgrade, so anyone with a copy of kra-agent.pem can still authenticate with it after the upgrade. To prevent this, the private key and certificate must be manually replaced after the upgrade.   ```  [Comment 12](show_bug.cgi?id=1264790#c12)  Tomas Hoger    2015-10-08 11:42:46 UTC  ``` Lifting embargo.   ```  [Comment 13](show_bug.cgi?id=1264790#c13)  Tomas Hoger    2015-10-08 11:45:54 UTC  ``` No released Red Hat Enterprise Linux or Fedora version was affected by this flaw.   ```  [Comment 14](show_bug.cgi?id=1264790#c14)  Tomas Hoger    2015-10-08 21:44:28 UTC  ``` Upstream ticket: <https://fedorahosted.org/freeipa/ticket/5347>  Upstream commit: <https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=55a66ccba3e2181a50e7733b7476991975b7455f>  Fixed upstream in version 4.2.2: <https://www.redhat.com/archives/freeipa-interest/2015-October/msg00000.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1264790&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


