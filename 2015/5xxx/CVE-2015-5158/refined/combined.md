=== Content from lists.nongnu.org_72bab4a1_20250125_070204.html ===


| | **qemu-devel** | | --- | |
| --- | --- |

[[Top](../)][[All Lists](/archive/html)]

[Advanced](/archive/cgi-bin/namazu.cgi?idxname=qemu-devel)

---

[[Date Prev](msg04557.html)][[Date Next](msg04559.html)][[Thread Prev](msg04550.html)][[Thread Next](msg04562.html)][[Date Index](index.html#04558)][[Thread Index](threads.html#04558)]

## [Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CV

---

| **From**: | Paolo Bonzini |
| --- | --- |

| **Subject**: | [Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CVE-2015-5158) |
| **Date**: | Wed, 22 Jul 2015 16:18:00 +0200 |

---

```
This is a guest-triggerable buffer overflow present in QEMU 2.2.0
and newer.  scsi_cdb_length returns -1 as an error value, but the
caller does not check it.

Luckily, the massive overflow means that QEMU will just SIGSEGV,
making the impact much smaller.

Reported-by: Zhu Donghai (æ±ä¸æµ·) <address@hidden>
Fixes: 1894df02811f6b79ea3ffbf1084599d96f316173
Cc: address@hidden
---
 hw/scsi/scsi-bus.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/hw/scsi/scsi-bus.c b/hw/scsi/scsi-bus.c
index f50b2f0..f0ae462 100644
--- a/hw/scsi/scsi-bus.c
+++ b/hw/scsi/scsi-bus.c
@@ -1239,10 +1239,15 @@ int scsi_cdb_length(uint8_t *buf) {
 int scsi_req_parse_cdb(SCSIDevice *dev, SCSICommand *cmd, uint8_t *buf)
 {
     int rc;
+    int len;

     cmd->lba = -1;
-    cmd->len = scsi_cdb_length(buf);
+    len = scsi_cdb_length(buf);
+    if (len < 0) {
+        return -1;
+    }

+    cmd->len = len;
     switch (dev->type) {
     case TYPE_TAPE:
         rc = scsi_req_stream_xfer(cmd, dev, buf);
--
2.4.3

```

---

reply via email to

---

| [Prev in Thread] | **Current Thread** | [[Next in Thread](msg04562.html)] |
| --- | --- | --- |

* **[Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CVE-2015-5158)**,
  *Paolo Bonzini* **<=**
  + **[Re: [Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CVE-2015-5158)](msg04562.html)**, *Daniel P. Berrange*, 2015/07/22
    - **[Re: [Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CVE-2015-5158)](msg04582.html)**, *Paolo Bonzini*, 2015/07/22
  + **[Re: [Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CVE-2015-5158)](msg04636.html)**, *Fam Zheng*, 2015/07/22

---

* Prev by Date:
  **[Re: [Qemu-devel] [PATCH] scsi: Handle no media case for scsi\_get\_configuration](msg04557.html)**
* Next by Date:
  **[[Qemu-devel] [PATCH] rcu: actually register threads that have RCU read-side critical sections](msg04559.html)**
* Previous by thread:
  **[[Qemu-devel] [PATCH] target-mips: fix passing incompatible pointer type in machine.c](msg04550.html)**
* Next by thread:
  **[Re: [Qemu-devel] [PATCH] scsi: fix buffer overflow in scsi\_req\_parse\_cdb (CVE-2015-5158)](msg04562.html)**
* Index(es):
  + [**Date**](index.html#04558)
  + [**Thread**](threads.html#04558)



=== Content from security.gentoo.org_a2a5ef35_20250125_070204.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# QEMU: Arbitrary code execution — GLSA **201510-02**

A heap-based buffer overflow in QEMU could result in execution of
arbitrary code.

### Affected packages

| Package | **app-emulation/qemu** on all architectures |
| --- | --- |
| Affected versions | < **2.3.0-r4** |
| Unaffected versions | >= **2.3.0-r4** |

### Background

QEMU is a generic and open source machine emulator and virtualizer.

### Description

Heap-based buffer overflow has been found in QEMU’s PCNET controller.

### Impact

A remote attacker could execute arbitrary code via a specially crafted
packets.

### Workaround

There is no known workaround at this time.

### Resolution

All QEMU users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-emulation/qemu-2.3.0-r4"

```
### References

* [CVE-2015-3209](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-3209)
* [CVE-2015-3214](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-3214)
* [CVE-2015-5154](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-5154)
* [CVE-2015-5158](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-5158)

**Release date**

October 31, 2015

**Latest revision**

October 31, 2015: 1

**Severity**

normal

**Exploitable**

local, remote

**Bugzilla entries**

* [551752](https://bugs.gentoo.org/show_bug.cgi?id=551752)
* [555680](https://bugs.gentoo.org/show_bug.cgi?id=555680)
* [556050](https://bugs.gentoo.org/show_bug.cgi?id=556050)
* [556052](https://bugs.gentoo.org/show_bug.cgi?id=556052)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


