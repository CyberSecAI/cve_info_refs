=== Content from codereview.chromium.org_bbb2c5e4_20250125_212621.html ===


Keyboard Shortcuts

---

| |  | File | | --- | --- | | u **:** | up to issue | | j / k **:** | jump to file after / before current file | | J / K **:** | jump to next file with a comment after / before current file | |  | Side-by-side diff | | i **:** | toggle intra-line diffs | | e **:** | expand all comments | | c **:** | collapse all comments | | s **:** | toggle showing all comments | | n / p **:** | next / previous diff chunk or comment | | N / P **:** | next / previous comment | | <Up> / <Down> **:** | next / previous line | | |  | Issue | | --- | --- | | u **:** | up to list of issues | | j / k **:** | jump to patch after / before current patch | | o / <Enter> **:** | open current patch in side-by-side view | | i **:** | open current patch in unified diff view | |  | |  | Issue List | | j / k **:** | jump to issue after / before current issue | | o / <Enter> **:** | open current issue | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

![](/static/chromium-24.png) Chromium Code Reviews
**chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)**
|
Please choose your nickname with
[Settings](/settings)
|
[Help](http://code.google.com/p/rietveld/wiki/CodeReviewHelp)
|
[Chromium Project](http://www.chromium.org/)
|
[Gerrit Changes](https://chromium-review.googlesource.com/dashboard/self?polygerrit=1)
|
[Sign out](https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1226493003%252526ust%25253D1608714105262606%252526usg%25253DAFQjCNHDnToul1LU2ZxHjzf5jq983Slj8A%26service%3Dah)

(78)

[Issues](/)
[Search](/search)

[My Issues](/mine)
|
[Starred](/starred)

[Open](/all?closed=0)
|
[Closed](/all?closed=1)
|
[All](/all)

## Issue [1226493003](/1226493003/): unicode-decoder: fix out-of-band write in utf16 (Closed)

| **Created:** 5 years, 5 months ago by [fedor.indutny](/user/fedor.indutny)  **Modified:** 5 years, 5 months ago  **Reviewers:** [jochen (gone - plz use gerrit)](/user/jochen%20%28gone%20-%20plz%20use%20gerrit%29), [svenpanne](/user/svenpanne), [danno](/user/danno)  **Base URL:** https://chromium.googlesource.com/v8/v8.git@master  **Target Ref:** refs/pending/heads/master  **Project:** [v8](/search?project=v8)  **Visibility:** Public.  [**More Reviews**](/search?repo_guid=33f2fb0e53d135f0ee17cfccd9d993eb2a6f47de "Find reviews for the same repository ID - 33f2fb0e53d135f0ee17cfccd9d993eb2a6f47de") | Descriptionunicode-decoder: fix out-of-band write in utf16 `WriteUtf16Slow` should not assume that the output buffer has enough bytes to hold both words of surrogate pair. It should pass the number of remaining bytes to the `Utf8::ValueOf` instead, just as we already do in `Utf8DecoderBase::Reset`. Otherwise it will attempt to write the trail uint16\_t past the buffer boundary, leading to memory corruption and possible crash. Originally reported by: Kris Reeves <kris.re@bbhmedia.com>; BUG=[v8:4274](https://bugs.chromium.org/p/v8/issues/detail?id=4274) R=danno R=svenpanne LOG=y Committed: <https://crrev.com/b199bcdd47ae97ec116b430e34ab42001c8f04c0> Cr-Commit-Position: refs/heads/master@{#29485} [Patch Set 1 #](/1226493003/#ps1) [Patch Set 2 : fix memory leak #](/1226493003/#ps20001) [Patch Set 3 : better fix #](/1226493003/#ps40001) *Total comments:* 4  [Patch Set 4 : fixes #](/1226493003/#ps60001) *Created:* 5 years, 5 months ago  Download [[raw]](/download/issue1226493003_60001.diff "Patchset in text format") [[tar.bz2]](/tarball/1226493003/60001 "Tarball containing the original and patched files")   |  | | Unified diffs | Side-by-side diffs | Delta from patch set | Stats (*+64 lines, -5 lines*) | | | Patch | | --- | --- | --- | --- | --- | --- | --- | --- | --- | |  | M | [src/unicode-decoder.h](/1226493003/patch/60001/70002) | [View](/1226493003/diff/60001/src/unicode-decoder.h) | [1](/1226493003/diff2/1%3A60001/src/unicode-decoder.h "Delta from patch set 1") [2](/1226493003/diff2/20001%3A60001/src/unicode-decoder.h "Delta from patch set 2") | 3 chunks | +5 lines, -3 lines | 0 comments | [Download](/download/issue1226493003_60001_70002.diff "Download patch for src/unicode-decoder.h") | |  | M | [src/unicode-decoder.cc](/1226493003/patch/60001/70001) | [View](/1226493003/diff/60001/src/unicode-decoder.cc) | [1](/1226493003/diff2/1%3A60001/src/unicode-decoder.cc "Delta from patch set 1") [2](/1226493003/diff2/20001%3A60001/src/unicode-decoder.cc "Delta from patch set 2") [3](/1226493003/diff2/40001%3A60001/src/unicode-decoder.cc "Delta from patch set 3") | 3 chunks | +8 lines, -2 lines | 0 comments | [Download](/download/issue1226493003_60001_70001.diff "Download patch for src/unicode-decoder.cc") | |  | M | [test/cctest/test-api.cc](/1226493003/patch/60001/70003) | [View](/1226493003/diff/60001/test/cctest/test-api.cc) | [1](/1226493003/diff2/1%3A60001/test/cctest/test-api.cc "Delta from patch set 1") [2](/1226493003/diff2/20001%3A60001/test/cctest/test-api.cc "Delta from patch set 2") [3](/1226493003/diff2/40001%3A60001/test/cctest/test-api.cc "Delta from patch set 3") | 1 chunk | +51 lines, -0 lines | 0 comments | [Download](/download/issue1226493003_60001_70003.diff "Download patch for test/cctest/test-api.cc") |   Messages*Total messages: 18 (4 generated)* Expand Messages | Collapse Messages | Show Generated Messages | Hide Generated Messages  | **fedor.indutny** | | This is a security issue for node.js, io.js and maybe chromium! | | --- | | 5 years, 5 months ago (2015-07-02 19:42:47 UTC) [#1](#msg1) | | --- | --- | --- | --- |   ``` This is a security issue for node.js, io.js and maybe chromium! ```     | **fedor.indutny** | | Aaargh, didn't see the CC field. Looks like it is out for everyone now. | | --- | | 5 years, 5 months ago (2015-07-02 19:45:58 UTC) [#2](#msg2) | | --- | --- | --- | --- |   ``` Aaargh, didn't see the CC field. Looks like it is out for everyone now. ```     | **fedor.indutny** | | Just pushed out a follow up commit to fix handling of trailing 3 byte sequences. ... | | --- | | 5 years, 5 months ago (2015-07-03 19:16:37 UTC) [#3](#msg3) | | --- | --- | --- | --- |   ``` Just pushed out a follow up commit to fix handling of trailing 3 byte sequences. I figured it is not possible to fix it without storing the number of bytes in the unhandled stream.  Please let me know what you think, it is very critical for node.js/io.js ```     | **jochen (gone - plz use gerrit)** | | jochen@chromium.org changed reviewers: + jochen@chromium.org | | --- | | 5 years, 5 months ago (2015-07-04 08:05:17 UTC) [#4](#msg4) | | --- | --- | --- | --- |   ``` jochen@chromium.org changed reviewers: + jochen@chromium.org ```     | **jochen (gone - plz use gerrit)** | | https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc File test/cctest/test-api.cc (right): https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc#newcode7436 test/cctest/test-api.cc:7436: v8::Handle<v8::String> str = v8::String::NewFromUtf8( please don't use deprecated APIs ... | | --- | | 5 years, 5 months ago (2015-07-04 08:05:18 UTC) [#5](#msg5) | | --- | --- | --- | --- |   ``` <https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc> File test/cctest/test-api.cc (right):  [https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc...](https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc#newcode7436) test/cctest/test-api.cc:7436: v8::Handle<v8::String> str = v8::String::NewFromUtf8( please don't use deprecated APIs in tests.  Handle -> Local  [https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc...](https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc#newcode7438) test/cctest/test-api.cc:7438: v8::String::kNormalString, size - 3); v8::NewStringType::kNormal, size - 3).ToLocalChecked() ```     | **fedor.indutny** | | https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc File test/cctest/test-api.cc (right): https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc#newcode7436 test/cctest/test-api.cc:7436: v8::Handle<v8::String> str = v8::String::NewFromUtf8( On 2015/07/04 08:05:18, jochen wrote: ... | | --- | | 5 years, 5 months ago (2015-07-04 17:02:39 UTC) [#6](#msg6) | | --- | --- | --- | --- |   ``` <https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc> File test/cctest/test-api.cc (right):  [https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc...](https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc#newcode7436) test/cctest/test-api.cc:7436: v8::Handle<v8::String> str = v8::String::NewFromUtf8( On 2015/07/04 08:05:18, jochen wrote: > please don't use deprecated APIs in tests. >  > Handle -> Local  Fixed.  [https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc...](https://codereview.chromium.org/1226493003/diff/40001/test/cctest/test-api.cc#newcode7438) test/cctest/test-api.cc:7438: v8::String::kNormalString, size - 3); On 2015/07/04 08:05:18, jochen wrote: > v8::NewStringType::kNormal, size - 3).ToLocalChecked()  Fixed, thank you! ```     | **fedor.indutny** | |  | | --- | | 5 years, 5 months ago (2015-07-04 17:02:40 UTC) [#7](#msg7) | | --- | --- | --- | --- |     | **jochen (gone - plz use gerrit)** | | lgtm | | --- | | 5 years, 5 months ago (2015-07-06 07:30:02 UTC) [#8](#msg8) | | --- | --- | --- | --- |   ``` lgtm ```     | **jochen (gone - plz use gerrit)** | | The CQ bit was checked by jochen@chromium.org | | --- | | 5 years, 5 months ago (2015-07-06 10:30:15 UTC) [#9](#msg9) | | --- | --- | --- | --- |   ``` The CQ bit was checked by jochen@chromium.org ```     | **commit-bot: I haz the power** | | CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1226493003/60001 | | --- | | 5 years, 5 months ago (2015-07-06 10:30:20 UTC) [#10](#msg10) | | --- | --- | --- | --- |   ``` CQ is trying da patch. Follow status at  <https://chromium-cq-status.appspot.com/patch-status/1226493003/60001> ```     | **Michael Hablich** | | On 2015/07/06 07:30:02, jochen wrote: > lgtm I unprotected CL so it can be processed ... | | --- | | 5 years, 5 months ago (2015-07-06 10:30:26 UTC) [#11](#msg11) | | --- | --- | --- | --- |   ``` On 2015/07/06 07:30:02, jochen wrote: > lgtm  I unprotected CL so it can be processed by CQ.  I also updated the description so that it references the bug. ```     | **commit-bot: I haz the power** | | The CQ bit was unchecked by commit-bot@chromium.org | | --- | | 5 years, 5 months ago (2015-07-06 10:41:57 UTC) [#12](#msg12) | | --- | --- | --- | --- |   ``` The CQ bit was unchecked by commit-bot@chromium.org ```     | **commit-bot: I haz the power** | | Try jobs failed on following builders: v8\_presubmit on tryserver.v8 (JOB\_FAILED, http://build.chromium.org/p/tryserver.v8/builders/v8\_presubmit/builds/3975) | | --- | | 5 years, 5 months ago (2015-07-06 10:41:58 UTC) [#13](#msg13) | | --- | --- | --- | --- |   ``` Try jobs failed on following builders:   v8_presubmit on tryserver.v8 (JOB_FAILED, <http://build.chromium.org/p/tryserver.v8/builders/v8_presubmit/builds/3975>) ```     | **jochen (gone - plz use gerrit)** | | The CQ bit was checked by jochen@chromium.org | | --- | | 5 years, 5 months ago (2015-07-06 10:42:55 UTC) [#14](#msg14) | | --- | --- | --- | --- |   ``` The CQ bit was checked by jochen@chromium.org ```     | **commit-bot: I haz the power** | | CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1226493003/60001 | | --- | | 5 years, 5 months ago (2015-07-06 10:43:05 UTC) [#15](#msg15) | | --- | --- | --- | --- |   ``` CQ is trying da patch. Follow status at  <https://chromium-cq-status.appspot.com/patch-status/1226493003/60001> ```     | **commit-bot: I haz the power** | | Committed patchset #4 (id:60001) | | --- | | 5 years, 5 months ago (2015-07-06 11:00:09 UTC) [#16](#msg16) | | --- | --- | --- | --- |   Message was sent while issue was closed. ``` Committed patchset #4 (id:60001) ```     | **commit-bot: I haz the power** | | Patchset 4 (id:??) landed as https://crrev.com/b199bcdd47ae97ec116b430e34ab42001c8f04c0 Cr-Commit-Position: refs/heads/master@{#29485} | | --- | | 5 years, 5 months ago (2015-07-06 11:00:22 UTC) [#17](#msg17) | | --- | --- | --- | --- |   Message was sent while issue was closed. ``` Patchset 4 (id:??) landed as <https://crrev.com/b199bcdd47ae97ec116b430e34ab42001c8f04c0> Cr-Commit-Position: refs/heads/master@{#29485} ```     | **fedor.indutny** | | On 2015/07/06 11:00:22, commit-bot: I haz the power wrote: > Patchset 4 (id:??) landed as ... | | --- | | 5 years, 5 months ago (2015-07-06 16:40:16 UTC) [#18](#msg18) | | --- | --- | --- | --- |   Message was sent while issue was closed. ``` On 2015/07/06 11:00:22, commit-bot: I haz the power wrote: > Patchset 4 (id:??) landed as > <https://crrev.com/b199bcdd47ae97ec116b430e34ab42001c8f04c0> > Cr-Commit-Position: refs/heads/master@{#29485}  Thank you! ```     Expand Messages | Collapse Messages | Show Generated Messages | Hide Generated Messages |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

**Issue 1226493003: unicode-decoder: fix out-of-band write in utf16
(Closed)**

Created 5 years, 5 months ago by fedor.indutny

Modified 5 years, 5 months ago

Reviewers: jochen (gone - plz use gerrit), danno, svenpanne

Base URL: https://chromium.googlesource.com/v8/v8.git@master

Comments: 4
[![Powered by Google App Engine](/static/appengine-noborder-120x30.gif)](http://code.google.com/appengine/)

This is Rietveld [408576698](http://code.google.com/p/rietveld/source/list)



=== Content from github.com_1e20f828_20250125_212622.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnodejs%2Fnode-v0.x-archive%2Fissues%2F25583)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnodejs%2Fnode-v0.x-archive%2Fissues%2F25583)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nodejs%2Fnode-v0.x-archive)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 22, 2023. It is now read-only.

[nodejs](/nodejs)
/
**[node-v0.x-archive](/nodejs/node-v0.x-archive)**
Public archive

* [Notifications](/login?return_to=%2Fnodejs%2Fnode-v0.x-archive) You must be signed in to change notification settings
* [Fork
  7.3k](/login?return_to=%2Fnodejs%2Fnode-v0.x-archive)
* [Star
   34.4k](/login?return_to=%2Fnodejs%2Fnode-v0.x-archive)

* [Code](/nodejs/node-v0.x-archive)
* [Issues
  0](/nodejs/node-v0.x-archive/issues)
* [Pull requests
  0](/nodejs/node-v0.x-archive/pulls)
* [Actions](/nodejs/node-v0.x-archive/actions)
* [Projects
  0](/nodejs/node-v0.x-archive/projects)
* [Wiki](/nodejs/node-v0.x-archive/wiki)
* [Security](/nodejs/node-v0.x-archive/security)
* [Insights](/nodejs/node-v0.x-archive/pulse)

Additional navigation options

* [Code](/nodejs/node-v0.x-archive)
* [Issues](/nodejs/node-v0.x-archive/issues)
* [Pull requests](/nodejs/node-v0.x-archive/pulls)
* [Actions](/nodejs/node-v0.x-archive/actions)
* [Projects](/nodejs/node-v0.x-archive/projects)
* [Wiki](/nodejs/node-v0.x-archive/wiki)
* [Security](/nodejs/node-v0.x-archive/security)
* [Insights](/nodejs/node-v0.x-archive/pulse)

This repository has been archived by the owner on Apr 22, 2023. It is now read-only.

# Segfault on node 0.12.4, to do with unicode and buffers #25583

[Jump to bottom](#comment-composer-heading)Copy link[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Segfault on node 0.12.4, to do with unicode and buffers](#top)#25583Copy link[![@myndzi](https://avatars.githubusercontent.com/u/1588419?u=103791e97cfc70771bbf75f74caa85649d12b689&v=4&size=80)](/myndzi)
## Description

[![@myndzi](https://avatars.githubusercontent.com/u/1588419?u=103791e97cfc70771bbf75f74caa85649d12b689&v=4&size=48)](/myndzi)[myndzi](https://github.com/myndzi)opened [on Jun 26, 2015](https://github.com/nodejs/node-v0.x-archive/issues/25583#issue-91329699)

I have a core dump now from a binary compiled with symbols, but I'm not sure what to do with it. I've managed to dump the data from the buffer being operated on to a file, but I cannot reproduce the crash in javascript code. I'm uncertain how exactly things got passed through and along. The backtrace looks like this:

```
#0  v8::base::OS::Abort () at ../deps/v8/src/base/platform/platform-posix.cc:278
#1  0x08bfd8b4 in V8_Fatal (file=0x8d58527 "../deps/v8/src/unicode.cc", line=320, format=0x8d58516 "CHECK(%s) failed") at ../deps/v8/src/base/logging.cc:87
#2  0x08a8d695 in unibrow::Utf8DecoderBase::WriteUtf16Slow (stream=0xb24203d "<data>"..., data=0x5b4d7c3e, data_length=1) at ../deps/v8/src/unicode.cc:320
#3  0x0879f02e in unibrow::Utf8Decoder<512u>::WriteUtf16 (this=0xa10ba40, data=0x5b4d3ff8, length=7714) at ../deps/v8/src/unicode-inl.h:197
#4  0x0878ed6d in v8::internal::Factory::NewStringFromUtf8 (this=0xa0fe080, string=..., pretenure=v8::internal::NOT_TENURED) at ../deps/v8/src/factory.cc:263
#5  0x0862c24c in v8::(anonymous namespace)::NewString (factory=0xa0fe080, type=v8::String::kNormalString, string=...) at ../deps/v8/src/api.cc:5333
#6  0x0863b37d in v8::(anonymous namespace)::NewString<char> (v8_isolate=0xa0fe080, location=0x8c4d06c "v8::String::NewFromUtf8()", env=0x8c4d058 "String::NewFromUtf8", data=0xb2401a0 "<data>"..., type=v8::String::kNormalString, length=7834) at ../deps/v8/src/api.cc:5378
#7  0x0862c37d in v8::String::NewFromUtf8 (isolate=0xa0fe080, data=0xb2401a0 "<data>"..., type=v8::String::kNormalString, length=7834) at ../deps/v8/src/api.cc:5397
#8  0x08b99bfd in node::StringBytes::Encode (isolate=0xa0fe080, buf=0xb2401a0 "<data>"..., buflen=7834, encoding=node::UTF8) at ../src/string_bytes.cc:727
#9  0x08b69f43 in node::Buffer::StringSlice<(node::encoding)1> (args=...) at ../src/node_buffer.cc:266
#10 0x08b685a5 in node::Buffer::Utf8Slice (args=...) at ../src/node_buffer.cc:281
#11 0x08649a59 in v8::internal::FunctionCallbackArguments::Call (this=0xbf7fe95c, f=0x8b68594 <node::Buffer::Utf8Slice(v8::FunctionCallbackInfo<v8::Value> const&)>) at ../deps/v8/src/arguments.cc:33
#12 0x0867f8a5 in v8::internal::HandleApiCallHelper<false> (args=..., isolate=0xa0fe080) at ../deps/v8/src/builtins.cc:1144
#13 0x0867a996 in v8::internal::Builtin_Impl_HandleApiCall (args=..., isolate=0xa0fe080) at ../deps/v8/src/builtins.cc:1161
#14 0x0867a975 in v8::internal::Builtin_HandleApiCall (args_length=4, args_object=0xbf7fea34, isolate=0xa0fe080) at ../deps/v8/src/builtins.cc:1160
#15 0x5340a3f6 in ?? ()
#16 0x5347d7ea in ?? ()
#17 0x5340b93b in ?? ()
#18 0x5563ccc4 in ?? ()
#19 0x534332f7 in ?? ()
#20 0x53430b73 in ?? ()
#21 0x5f01ad25 in ?? ()
#22 0x53b36df8 in ?? ()
#23 0xb152490f in ?? ()
#24 0x5340b93b in ?? ()
#25 0x2b9bc4b4 in ?? ()
#26 0x2b97af56 in ?? ()
#27 0x53bf31e2 in ?? ()
#28 0x5340b93b in ?? ()
#29 0x53b3bb00 in ?? ()
#30 0x53447015 in ?? ()
#31 0x5342574a in ?? ()
#32 0x0877cdbf in v8::internal::Invoke (is_construct=false, function=..., receiver=..., argc=2, args=0xbf7feeec) at ../deps/v8/src/execution.cc:91
#33 0x0877d148 in v8::internal::Execution::Call (isolate=0xa0fe080, callable=..., receiver=..., argc=2, argv=0xbf7feeec, convert_receiver=true) at ../deps/v8/src/execution.cc:141
#34 0x086287ff in v8::Function::Call (this=0xa128928, recv=..., argc=2, argv=0xbf7feeec) at ../deps/v8/src/api.cc:4020
#35 0x08b4bae2 in node::AsyncWrap::MakeCallback (this=0xa13c8b8, cb=..., argc=2, argv=0xbf7feeec) at ../src/async-wrap.cc:136
#36 0x08b4d650 in node::AsyncWrap::MakeCallback (this=0xa13c8b8, symbol=..., argc=2, argv=0xbf7feeec) at ../src/async-wrap-inl.h:99
#37 0x08b8f596 in node::ZCtx::After (work_req=0xa13c92c, status=0) at ../src/node_zlib.cc:341
#38 0x08be72c6 in uv__queue_done (w=0xa13c958, err=0) at ../deps/uv/src/threadpool.c:257
#39 0x08be720a in uv__work_done (handle=0x917c3a0 <default_loop_struct+96>) at ../deps/uv/src/threadpool.c:236
#40 0x08be9106 in uv__async_event (loop=0x917c340 <default_loop_struct>, w=0x917c42c <default_loop_struct+236>, nevents=1) at ../deps/uv/src/unix/async.c:92
#41 0x08be9263 in uv__async_io (loop=0x917c340 <default_loop_struct>, w=0x917c430 <default_loop_struct+240>, events=1) at ../deps/uv/src/unix/async.c:132
#42 0x08bfa7d0 in uv__io_poll (loop=0x917c340 <default_loop_struct>, timeout=0) at ../deps/uv/src/unix/linux-core.c:324
#43 0x08be9c87 in uv_run (loop=0x917c340 <default_loop_struct>, mode=UV_RUN_ONCE) at ../deps/uv/src/unix/core.c:324
#44 0x08b61c41 in node::Start (argc=2, argv=0xa0fe008) at ../src/node.cc:3722
#45 0x08b88b58 in main (argc=2, argv=0xbf802664) at ../src/node_main.cc:65

```

(I've omitted the actual data snippits for readability)

As best as I can tell, the buffer being worked with is split on the first byte of a four-byte utf-8 sequence representing a > 0xFFFF value (U+1F495); it's part of an HTTP response. The error is obvious:

<https://github.com/joyent/node/blob/v0.12.4/deps/v8/src/unicode.cc#L317-L321>

An assumption is made here, that if there's a UTF-16 surrogate pair, both parts exist, but that's not what's happening. It seems assumed that such a case won't reach this code. I was unable to follow the code here well enough to come up with a way to reproduce the problem in JS code:

<https://github.com/joyent/node/blob/v0.12.4/deps/v8/src/factory.cc#L231-L265>

Please let me know what if anything I can do to help nail this down further!

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from medium.com_2c82c39a_20250125_212623.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8ac14ece5852&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2Fnode-js-javascript%2Fimportant-security-upgrades-for-node-js-and-io-js-8ac14ece5852&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2Fnode-js-javascript%2Fimportant-security-upgrades-for-node-js-and-io-js-8ac14ece5852&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Important security upgrades for node.js and io.js

[![io.js](https://miro.medium.com/v2/resize:fill:88:88/0*Z-3VWCQoTPOs9SHs.png)](/%40iojs?source=post_page---byline--8ac14ece5852--------------------------------)[![Node & JavaScript](https://miro.medium.com/v2/resize:fill:48:48/1*iPSSMcb2x24mPoFfKEatoA.png)](https://medium.com/node-js-javascript?source=post_page---byline--8ac14ece5852--------------------------------)

[io.js](/%40iojs?source=post_page---byline--8ac14ece5852--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd3acf9cb7159&operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnode-js-javascript%2Fimportant-security-upgrades-for-node-js-and-io-js-8ac14ece5852&user=io.js&userId=d3acf9cb7159&source=post_page-d3acf9cb7159--byline--8ac14ece5852---------------------post_header-----------)

Published in[Node & JavaScript](https://medium.com/node-js-javascript?source=post_page---byline--8ac14ece5852--------------------------------)·2 min read·Jul 4, 2015

--

4

Listen

Share

Critical security releases for node.js and io.js

* [node.js-v0.12.6](http://nodejs.org/dist/v0.12.6/)
* [io.js-v2.3.3](https://iojs.org/dist/v2.3.3/)
* [io.js-v1.8.3](https://iojs.org/dist/v1.8.3/)

First, the obvious: the handling of this hasn’t been ideal, it would have been nice to take our time and do this more strategically. It’s evening in the USA and it’s the weekend of the 4th of July.

We made the call to push forward because details about the bug and potential exploit has inadvertently made its way to a public forum so we’d rather given companies and users the tools to protect themselves and mitigate DoS if they happen to become a reality than sit on it and cross our fingers. The timing sucks, particularly for the USA where it’s hitting the weekend and the whole 4th of July thing makes this a nightmare for people managing large deployments but this is the call we made with the information available.

## A short history

Kris Reeves and Trevor Norris pinpointed a bug in V8 in the way it decodes UTF strings. This impacts Node at the Buffer to UTF8 String conversion and can cause a process to crash. The security concern comes from the fact that a lot of data from outside of an application is delivered to Node via this mechanism which means that users can potentially deliver specially crafted input data that can cause an application to crash when it goes through this path. We know that most networking and filesystem operations are impacted as would be many user-land uses of Buffer to UTF8 String conversion. We know that HTTP(S) header parsing is *not* vulnerable because Node does not convert this data as UTF8. This is a small consolation because it restricts the way HTTP(S) can be exploited but there is more to HTTP(S) than header parsing obviously. We also have no information yet on how the various TLS terminators and forward-proxies in use may potentially mitigate against the form of data required for this exploit.

The initial ETA was midday PDT. Unfortunately, the patch wasn’t quite ready and there was an extended test and verification process for V8, io.js and Node.js during the day. The builds also take some time on top of that, hence the delay. Fedor Indutny created the fix, Ben Noordhuis, Trevor Norris, Julien Gilli, Rod Vagg, Michael Dawson and Jeremiah Senkpiel all worked very hard to make this land successfully.

--

--

4

[![Node & JavaScript](https://miro.medium.com/v2/resize:fill:96:96/1*iPSSMcb2x24mPoFfKEatoA.png)](https://medium.com/node-js-javascript?source=post_page---post_publication_info--8ac14ece5852--------------------------------)[![Node & JavaScript](https://miro.medium.com/v2/resize:fill:128:128/1*iPSSMcb2x24mPoFfKEatoA.png)](https://medium.com/node-js-javascript?source=post_page---post_publication_info--8ac14ece5852--------------------------------)[## Published in Node & JavaScript](https://medium.com/node-js-javascript?source=post_page---post_publication_info--8ac14ece5852--------------------------------)[6.6K Followers](/node-js-javascript/followers?source=post_page---post_publication_info--8ac14ece5852--------------------------------)·[Last published Jan 12, 2017](/node-js-javascript/make-node-js-core-bigger-97ca7ef62b77?source=post_page---post_publication_info--8ac14ece5852--------------------------------)

Javascript is fun and so Node is fun!

[![io.js](https://miro.medium.com/v2/resize:fill:96:96/0*Z-3VWCQoTPOs9SHs.png)](/%40iojs?source=post_page---post_author_info--8ac14ece5852--------------------------------)[![io.js](https://miro.medium.com/v2/resize:fill:128:128/0*Z-3VWCQoTPOs9SHs.png)](/%40iojs?source=post_page---post_author_info--8ac14ece5852--------------------------------)Follow[## Written by io.js](/%40iojs?source=post_page---post_author_info--8ac14ece5852--------------------------------)[8.3K Followers](/%40iojs/followers?source=post_page---post_author_info--8ac14ece5852--------------------------------)·[10 Following](/%40iojs/following?source=post_page---post_author_info--8ac14ece5852--------------------------------)

Bringing ES6 to the Node Community!

Follow
## Responses (4)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----8ac14ece5852--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----8ac14ece5852--------------------------------)[About](/about?autoplay=1&source=post_page-----8ac14ece5852--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----8ac14ece5852--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----8ac14ece5852--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----8ac14ece5852--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8ac14ece5852--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8ac14ece5852--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----8ac14ece5852--------------------------------)[Teams](/business?source=post_page-----8ac14ece5852--------------------------------)


