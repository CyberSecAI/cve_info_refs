=== Content from www.zerodayinitiative.com_26bbcdf3_20250125_034451.html ===

[![thezdi](/images/logo.svg)](/)

Menu

* [PRIVACY](https://www.trendmicro.com/privacy)
* [WHO WE ARE](/about/)
* [HOW IT WORKS](/about/benefits/)
* [BLOG](/blog/)
* [ADVISORIES](/advisories/)
* [LOG IN](/portal/)
  [SIGN UP](/portal/register/)

Menu

* [PRIVACY](https://www.trendmicro.com/privacy/)
* [WHO WE ARE](/about/)
* [HOW IT WORKS](/about/benefits/)
* [BLOG](/blog/)
* [ADVISORIES](/advisories/)
* [LOG IN](/portal/)
* [SIGN UP](/portal/register/)

* [![thezdi](/images/logo.svg)](/)
* [Trend Micro](https://www.trendmicro.com/)

# Advisory Details

July 20th, 2015
## Apache Groovy Deserialization of Untrusted Data Remote Code Execution Vulnerability

### ZDI-15-365ZDI-CAN-2947

| CVE ID | [CVE-2015-3253](https://www.cve.org/CVERecord?id=CVE-2015-3253) |
| --- | --- |
| CVSS SCORE | 7.5, [AV:N/AC:L/Au:N/C:P/I:P/A:P](http://nvd.nist.gov/cvss.cfm?calculator&version=2.0&vector=AV:N/AC:L/Au:N/C:P/I:P/A:P) |
| AFFECTED VENDORS | Apache |
| AFFECTED PRODUCTS | [Groovy](http://www.groovy-lang.org/index.html) [Elasticsearch](https://www.elastic.co/products/elasticsearch) |
| VULNERABILITY DETAILS | This vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of Apache Groovy. Authentication is not required to exploit this vulnerability.  The specific flaw exists within the Closure implementation which accepts and deserializes a Java serialized binary stream. An attacker can leverage this vulnerability to execute arbitrary code under the context of the user. |
| ADDITIONAL DETAILS | Apache has issued an update to correct this vulnerability. More details can be found at: |
| DISCLOSURE TIMELINE | * 2015-06-30 - Vulnerability reported to vendor * 2015-07-20 - Coordinated public release of advisory |
| CREDIT | cpnrodzc7 |

[BACK TO ADVISORIES](/advisories/)

### General Inquiries

zdi@trendmicro.com

### Find us on X

[@thezdi](https://twitter.com/thezdi)

### Find us on Mastodon

[Mastodon](https://infosec.exchange/%40thezdi)

### Media Inquiries

media\_relations@trendmicro.com

### Sensitive Email Communications

[PGP Key](https://www.zerodayinitiative.com/documents/zdi-pgp-key.asc)

[WHO WE ARE](/about/)

* [Our Mission](/about/)
* [Trend Micro](https://www.trendmicro.com)
* [TippingPoint IPS](https://www.trendmicro.com/en_us/business/products/network/integrated-atp/next-gen-intrusion-prevention-system.html)

[HOW IT WORKS](/about/benefits/)

* [Process](/about/benefits/#process)
* [Researcher Rewards](/about/benefits/#researcher-rewards)
* [FAQS](/about/faq/)
* [Privacy](https://www.trendmicro.com/privacy/)

[ADVISORIES](/advisories)

* [Published Advisories](/advisories/published)
* [Upcoming Advisories](/advisories/upcoming)
* [RSS Feeds](/rss)

[BLOG](/blog)

[![thezdi](/images/logo-footer.svg)](/)



=== Content from github.com_541dfe32_20250125_034453.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch%2Fcommit%2Fbf3052d14c874aead7da8855c5fcadf5428a43f2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch%2Fcommit%2Fbf3052d14c874aead7da8855c5fcadf5428a43f2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=elastic%2Felasticsearch)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[elastic](/elastic)
/
**[elasticsearch](/elastic/elasticsearch)**
Public

* [Notifications](/login?return_to=%2Felastic%2Felasticsearch) You must be signed in to change notification settings
* [Fork
  25k](/login?return_to=%2Felastic%2Felasticsearch)
* [Star
   71.4k](/login?return_to=%2Felastic%2Felasticsearch)

* [Code](/elastic/elasticsearch)
* [Issues
  3.9k](/elastic/elasticsearch/issues)
* [Pull requests
  861](/elastic/elasticsearch/pulls)
* [Actions](/elastic/elasticsearch/actions)
* [Projects
  0](/elastic/elasticsearch/projects)
* [Security](/elastic/elasticsearch/security)
* [Insights](/elastic/elasticsearch/pulse)

Additional navigation options

* [Code](/elastic/elasticsearch)
* [Issues](/elastic/elasticsearch/issues)
* [Pull requests](/elastic/elasticsearch/pulls)
* [Actions](/elastic/elasticsearch/actions)
* [Projects](/elastic/elasticsearch/projects)
* [Security](/elastic/elasticsearch/security)
* [Insights](/elastic/elasticsearch/pulse)

## Commit

[Permalink](/elastic/elasticsearch/commit/bf3052d14c874aead7da8855c5fcadf5428a43f2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Restrict Exception deserialization to Core and JDK classes

[Browse files](/elastic/elasticsearch/tree/bf3052d14c874aead7da8855c5fcadf5428a43f2)
Browse the repository at this point in the history

```
when 3rd party exceptions are deserialized they might carry
classes not present on the deserializing node. This causes hard
exceptions and looses the exception entirely. This commit restricts
the classes we support for deserialization for core and selected JDK
classes to guarantee they are present on both source and target nodes
```

* Loading branch information

[![@s1monw](https://avatars.githubusercontent.com/u/973334?s=40&v=4)](/s1monw)

[s1monw](/elastic/elasticsearch/commits?author=s1monw "View all commits by s1monw")
committed
Jul 13, 2015

1 parent
[178aa26](/elastic/elasticsearch/commit/178aa26a4ea6e741a176962d2212fd62a863542f)

commit bf3052d

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**177 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/org/elasticsearch

    - common/io

      * src/main/java/org/elasticsearch/common/io/ThrowableObjectInputStream.java
        [ThrowableObjectInputStream.java](#diff-844c817a909140a96213169aa07132af713d3c72d3972a2579a26aba6b5e0d14)
      * src/main/java/org/elasticsearch/common/io/ThrowableObjectOutputStream.java
        [ThrowableObjectOutputStream.java](#diff-d8f9431dab724928717bb258b3d728bfa42b0595cf01f5feb857f971582c2b6e)
    - transport

      * local

        + src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java
          [LocalTransportChannel.java](#diff-fb50f06bcbbd04d281ad83d341c6f76e990400620a164f35ff941b9e8160262b)
      * netty

        + src/main/java/org/elasticsearch/transport/netty/NettyTransportChannel.java
          [NettyTransportChannel.java](#diff-faa6861f4998f95ba70739d037f8132ed022159b98d8bd9293386d7887bc8c8b)
  + test/java/org/elasticsearch

    - src/test/java/org/elasticsearch/ExceptionsSerializationTests.java
      [ExceptionsSerializationTests.java](#diff-f2e7b0915ed803ef8004ba42f4c1a57a390cb2ea3280ac9c4082578f570ae1ca)

## There are no files selected for viewing

46 changes: 44 additions & 2 deletions

46
[src/main/java/org/elasticsearch/common/io/ThrowableObjectInputStream.java](#diff-844c817a909140a96213169aa07132af713d3c72d3972a2579a26aba6b5e0d14 "src/main/java/org/elasticsearch/common/io/ThrowableObjectInputStream.java")

Show comments

[View file](/elastic/elasticsearch/blob/bf3052d14c874aead7da8855c5fcadf5428a43f2/src/main/java/org/elasticsearch/common/io/ThrowableObjectInputStream.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,9 +19,15 @@ |
|  |  |  |
|  |  | package org.elasticsearch.common.io; |
|  |  |  |
|  |  | import com.fasterxml.jackson.core.JsonLocation; |
|  |  | import com.google.common.collect.ImmutableMap; |
|  |  | import org.elasticsearch.common.Classes; |
|  |  | import org.elasticsearch.common.collect.IdentityHashSet; |
|  |  | import org.joda.time.DateTimeFieldType; |
|  |  |  |
|  |  | import java.io.\*; |
|  |  | import java.net.\*; |
|  |  | import java.util.\*; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
| Expand Down  Expand Up | | @@ -61,11 +67,11 @@ protected ObjectStreamClass readClassDescriptor() |
|  |  | case ThrowableObjectOutputStream.TYPE\_STACKTRACEELEMENT: |
|  |  | return ObjectStreamClass.lookup(StackTraceElement.class); |
|  |  | case ThrowableObjectOutputStream.TYPE\_FAT\_DESCRIPTOR: |
|  |  | return super.readClassDescriptor(); |
|  |  | return verify(super.readClassDescriptor()); |
|  |  | case ThrowableObjectOutputStream.TYPE\_THIN\_DESCRIPTOR: |
|  |  | String className = readUTF(); |
|  |  | Class<?> clazz = loadClass(className); |
|  |  | return ObjectStreamClass.lookup(clazz); |
|  |  | return verify(ObjectStreamClass.lookup(clazz)); |
|  |  | default: |
|  |  | throw new StreamCorruptedException( |
|  |  | "Unexpected class descriptor type: " + type); |
| Expand Down  Expand Up | | @@ -96,4 +102,40 @@ protected Class<?> loadClass(String className) throws ClassNotFoundException { |
|  |  | } |
|  |  | return clazz; |
|  |  | } |
|  |  |  |
|  |  | private static final Set<Class<?>> CLASS\_WHITELIST; |
|  |  | private static final Set<Package> PKG\_WHITELIST; |
|  |  | static { |
|  |  | IdentityHashSet<Class<?>> classes = new IdentityHashSet<>(); |
|  |  | classes.add(String.class); |
|  |  | // inet stuff is needed for DiscoveryNode |
|  |  | classes.add(Inet6Address.class); |
|  |  | classes.add(Inet4Address.class); |
|  |  | classes.add(InetAddress.class); |
|  |  | classes.add(InetSocketAddress.class); |
|  |  | classes.add(SocketAddress.class); |
|  |  | classes.add(StackTraceElement.class); |
|  |  | classes.add(JsonLocation.class); // JsonParseException uses this |
|  |  | IdentityHashSet<Package> packages = new IdentityHashSet<>(); |
|  |  | packages.add(Integer.class.getPackage()); // java.lang |
|  |  | packages.add(List.class.getPackage()); // java.util |
|  |  | packages.add(ImmutableMap.class.getPackage()); // com.google.common.collect |
|  |  | packages.add(DateTimeFieldType.class.getPackage()); // org.joda.time |
|  |  | CLASS\_WHITELIST = Collections.unmodifiableSet(classes); |
|  |  | PKG\_WHITELIST = Collections.unmodifiableSet(packages); |
|  |  | } |
|  |  |  |
|  |  | private ObjectStreamClass verify(ObjectStreamClass streamClass) throws IOException, ClassNotFoundException { |
|  |  | Class<?> aClass = resolveClass(streamClass); |
|  |  | Package pkg = aClass.getPackage(); |
|  |  | if (aClass.isPrimitive() // primitives are fine |
|  |  | || aClass.isArray() // arrays are ok too |
|  |  | || Throwable.class.isAssignableFrom(aClass)// exceptions are fine |
|  |  | || CLASS\_WHITELIST.contains(aClass) // whitelist JDK stuff we need |
|  |  | || PKG\_WHITELIST.contains(aClass.getPackage()) |
|  |  | || pkg.getName().startsWith("org.elasticsearch")) { // es classes are ok |
|  |  | return streamClass; |
|  |  | } |
|  |  | throw new NotSerializableException(aClass.getName()); |
|  |  | } |
|  |  | } |

31 changes: 27 additions & 4 deletions

31
[src/main/java/org/elasticsearch/common/io/ThrowableObjectOutputStream.java](#diff-d8f9431dab724928717bb258b3d728bfa42b0595cf01f5feb857f971582c2b6e "src/main/java/org/elasticsearch/common/io/ThrowableObjectOutputStream.java")

Show comments

[View file](/elastic/elasticsearch/blob/bf3052d14c874aead7da8855c5fcadf5428a43f2/src/main/java/org/elasticsearch/common/io/ThrowableObjectOutputStream.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,10 +19,7 @@ |
|  |  |  |
|  |  | package org.elasticsearch.common.io; |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.io.ObjectOutputStream; |
|  |  | import java.io.ObjectStreamClass; |
|  |  | import java.io.OutputStream; |
|  |  | import java.io.\*; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
| Expand Down  Expand Up | | @@ -65,4 +62,30 @@ protected void writeClassDescriptor(ObjectStreamClass desc) throws IOException { |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Simple helper method to roundtrip a serializable object within the ThrowableObjectInput/Output stream |
|  |  | \*/ |
|  |  | public static <T extends Serializable> T serialize(T t) throws IOException, ClassNotFoundException { |
|  |  | ByteArrayOutputStream stream = new ByteArrayOutputStream(); |
|  |  | try (ThrowableObjectOutputStream outputStream = new ThrowableObjectOutputStream(stream)) { |
|  |  | outputStream.writeObject(t); |
|  |  | } |
|  |  | try (ThrowableObjectInputStream in = new ThrowableObjectInputStream(new ByteArrayInputStream(stream.toByteArray()))) { |
|  |  | return (T) in.readObject(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Returns <code>true</code> iff the exception can be serialized and deserialized using |
|  |  | \* {@link ThrowableObjectOutputStream} and {@link ThrowableObjectInputStream}. Otherwise <code>false</code> |
|  |  | \*/ |
|  |  | public static boolean canSerialize(Throwable t) { |
|  |  | try { |
|  |  | serialize(t); |
|  |  | return true; |
|  |  | } catch (Throwable throwable) { |
|  |  | return false; |
|  |  | } |
|  |  | } |
|  |  | } |

4 changes: 4 additions & 0 deletions

4
[src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java](#diff-fb50f06bcbbd04d281ad83d341c6f76e990400620a164f35ff941b9e8160262b "src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java")

Show comments

[View file](/elastic/elasticsearch/blob/bf3052d14c874aead7da8855c5fcadf5428a43f2/src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -86,6 +86,10 @@ public void run() { |
|  |  | @Override |
|  |  | public void sendResponse(Throwable error) throws IOException { |
|  |  | BytesStreamOutput stream = new BytesStreamOutput(); |
|  |  | if (ThrowableObjectOutputStream.canSerialize(error) == false) { |
|  |  | assert false : "Can not serialize exception: " + error; // make sure tests fail |
|  |  | error = new NotSerializableTransportException(error); |
|  |  | } |
|  |  | try { |
|  |  | writeResponseExceptionHeader(stream); |
|  |  | RemoteTransportException tx = new RemoteTransportException(targetTransport.nodeName(), targetTransport.boundAddress().boundAddress(), action, error); |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[src/main/java/org/elasticsearch/transport/netty/NettyTransportChannel.java](#diff-faa6861f4998f95ba70739d037f8132ed022159b98d8bd9293386d7887bc8c8b "src/main/java/org/elasticsearch/transport/netty/NettyTransportChannel.java")

Show comments

[View file](/elastic/elasticsearch/blob/bf3052d14c874aead7da8855c5fcadf5428a43f2/src/main/java/org/elasticsearch/transport/netty/NettyTransportChannel.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -117,6 +117,10 @@ public void sendResponse(TransportResponse response, TransportResponseOptions op |
|  |  | @Override |
|  |  | public void sendResponse(Throwable error) throws IOException { |
|  |  | BytesStreamOutput stream = new BytesStreamOutput(); |
|  |  | if (ThrowableObjectOutputStream.canSerialize(error) == false) { |
|  |  | assert false : "Can not serialize exception: " + error; // make sure tests fail |
|  |  | error = new NotSerializableTransportException(error); |
|  |  | } |
|  |  | try { |
|  |  | stream.skip(NettyHeader.HEADER\_SIZE); |
|  |  | RemoteTransportException tx = new RemoteTransportException(transport.nodeName(), transport.wrapAddress(channel.getLocalAddress()), action, error); |
| Expand Down | |  |

98 changes: 98 additions & 0 deletions

98
[src/test/java/org/elasticsearch/ExceptionsSerializationTests.java](#diff-f2e7b0915ed803ef8004ba42f4c1a57a390cb2ea3280ac9c4082578f570ae1ca "src/test/java/org/elasticsearch/ExceptionsSerializationTests.java")

Show comments

[View file](/elastic/elasticsearch/blob/bf3052d14c874aead7da8855c5fcadf5428a43f2/src/test/java/org/elasticsearch/ExceptionsSerializationTests.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,98 @@ |
|  |  | /\* |
|  |  | \* Licensed to Elasticsearch under one or more contributor |
|  |  | \* license agreements. See the NOTICE file distributed with |
|  |  | \* this work for additional information regarding copyright |
|  |  | \* ownership. Elasticsearch licenses this file to you under |
|  |  | \* the Apache License, Version 2.0 (the "License"); you may |
|  |  | \* not use this file except in compliance with the License. |
|  |  | \* You may obtain a copy of the License at |
|  |  | \* |
|  |  | \* http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, |
|  |  | \* software distributed under the License is distributed on an |
|  |  | \* "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY |
|  |  | \* KIND, either express or implied. See the License for the |
|  |  | \* specific language governing permissions and limitations |
|  |  | \* under the License. |
|  |  | \*/ |
|  |  | package org.elasticsearch; |
|  |  |  |
|  |  | import com.google.common.collect.ImmutableMap; |
|  |  | import com.google.common.reflect.TypeToken; |
|  |  | import org.apache.lucene.store.AlreadyClosedException; |
|  |  | import org.elasticsearch.cluster.node.DiscoveryNode; |
|  |  | import org.elasticsearch.common.collect.Tuple; |
|  |  | import org.elasticsearch.common.io.ThrowableObjectInputStream; |
|  |  | import org.elasticsearch.common.transport.InetSocketTransportAddress; |
|  |  | import org.elasticsearch.index.shard.IndexShard; |
|  |  | import org.elasticsearch.index.shard.IndexShardState; |
|  |  | import org.elasticsearch.index.shard.ShardId; |
|  |  | import org.elasticsearch.indices.recovery.RecoveryFailedException; |
|  |  | import org.elasticsearch.test.ElasticsearchTestCase; |
|  |  | import org.elasticsearch.transport.ConnectTransportException; |
|  |  | import org.junit.Test; |
|  |  |  |
|  |  | import java.io.\*; |
|  |  | import java.net.InetAddress; |
|  |  | import java.util.\*; |
|  |  | import java.util.concurrent.atomic.AtomicBoolean; |
|  |  |  |
|  |  | import static org.elasticsearch.common.io.ThrowableObjectOutputStream.serialize; |
|  |  |  |
|  |  | public class ExceptionsSerializationTests extends ElasticsearchTestCase { |
|  |  |  |
|  |  | public void testBasicExceptions() throws IOException, ClassNotFoundException { |
|  |  | ShardId id = new ShardId("foo", 1); |
|  |  | DiscoveryNode src = new DiscoveryNode("someNode", new InetSocketTransportAddress("127.0.0.1", 6666), Version.CURRENT); |
|  |  | DiscoveryNode target = new DiscoveryNode("otherNode", new InetSocketTransportAddress("127.0.0.1", 8888), Version.CURRENT); |
|  |  |  |
|  |  | RecoveryFailedException ex = new RecoveryFailedException(id, src, target, new AlreadyClosedException("closed", new SecurityException("booom booom boom", new FileNotFoundException("no such file")))); |
|  |  | RecoveryFailedException serialize = serialize(ex); |
|  |  | assertEquals(ex.getMessage(), serialize.getMessage()); |
|  |  | assertEquals(AlreadyClosedException.class, serialize.getCause().getClass()); |
|  |  | assertEquals(SecurityException.class, serialize.getCause().getCause().getClass()); |
|  |  | assertEquals(FileNotFoundException.class, serialize.getCause().getCause().getCause().getClass()); |
|  |  | ConnectTransportException tpEx = new ConnectTransportException(src, "foo", new IllegalArgumentException("boom")); |
|  |  | ConnectTransportException serializeTpEx = serialize(tpEx); |
|  |  | assertEquals(tpEx.getMessage(), serializeTpEx.getMessage()); |
|  |  | assertEquals(src, tpEx.node()); |
|  |  |  |
|  |  | TestException testException = new TestException(Arrays.asList("foo"), EnumSet.allOf(IndexShardState.class), ImmutableMap.<String,String>builder().put("foo", "bar").build(), InetAddress.getByName("localhost"), new Number[] {new Integer(1)}); |
|  |  | assertEquals(serialize(testException).list.get(0), "foo"); |
|  |  | assertTrue(serialize(testException).set.containsAll(Arrays.asList(IndexShardState.values()))); |
|  |  | assertEquals(serialize(testException).map.get("foo"), "bar"); |
|  |  | } |
|  |  |  |
|  |  | public void testPreventBogusFromSerializing() throws IOException, ClassNotFoundException { |
|  |  | Serializable[] serializables = new Serializable[] { |
|  |  | new AtomicBoolean(false), |
|  |  | TypeToken.of(String.class), |
|  |  | }; |
|  |  | for (Serializable s : serializables) { |
|  |  | try { |
|  |  | serialize(s); |
|  |  | fail(s.getClass() + " should fail"); |
|  |  | } catch (NotSerializableException e) { |
|  |  | // all is well |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | public static class TestException extends Throwable { |
|  |  | final List<String> list; |
|  |  | final EnumSet<IndexShardState> set; |
|  |  | final Map<String, String> map; |
|  |  | final InetAddress address; |
|  |  | final Object[] someArray; |
|  |  |  |
|  |  | public TestException(List<String> list, EnumSet<IndexShardState> set, Map<String, String> map, InetAddress address, Object[] someArray) { |
|  |  | super("foo", null); |
|  |  | this.list = list; |
|  |  | this.set = set; |
|  |  | this.map = map; |
|  |  | this.address = address; |
|  |  | this.someArray = someArray; |
|  |  | } |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bf3052d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch%2Fcommit%2Fbf3052d14c874aead7da8855c5fcadf5428a43f2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from discuss.elastic.co_deae29ae_20250125_034452.html ===


[Discuss the Elastic Stack](/)

# [Elasticsearch remote code execution CVE-2015-5377](/t/elasticsearch-remote-code-execution-cve-2015-5377/25736)

[Announcements](/c/announcements/security-announcements/31)

[Security Announcements](/c/announcements/security-announcements/31)

[KevinKluge](https://discuss.elastic.co/u/KevinKluge)
(Kevin Kluge)

July 16, 2015, 5:30pm

1

**Summary**

Elasticsearch versions prior to 1.6.1 are vulnerable to an engineered attack on its transport protocol that enables remote code execution. This issue is related to the Groovy announcement in CVE-2015-3253.

Deployments are vulnerable even when Groovy dynamic scripting is disabled.

We have been assigned CVE-2015-5377 for this issue.

**Fixed versions**

Version 1.6.1 and 1.7.0 address the vulnerability.

**Remediation**

Users should upgrade to the 1.6.1 or 1.7.0 release.

Users that do not want to upgrade can address the vulnerability by securing the transport protocol port (default 9300) to allow access by only trusted agents.

**CVSS**

Overall CVSS score: 5.1

**Credits**

cpnrodzc7 working with HP's Zero Day Initiative (ZDI) found a similar issue with Elasticsearch.

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [Groovy scripting vulnerability](https://discuss.elastic.co/t/groovy-scripting-vulnerability/22104)  [Elasticsearch](/c/elastic-stack/elasticsearch/6) | 1 | 327 | July 6, 2017 |
| [Elasticsearch directory traversal vulnerability CVE-2015-5531](https://discuss.elastic.co/t/elasticsearch-directory-traversal-vulnerability-cve-2015-5531/25737)  [Security Announcements](/c/announcements/security-announcements/31) | 1 | 4432 | July 6, 2017 |
| [CVE-2022-1471 Still Applicable in latest 7.\* and 8. \*, not listed on Security Issues Page](https://discuss.elastic.co/t/cve-2022-1471-still-applicable-in-latest-7-and-8-not-listed-on-security-issues-page/342965)  [Endpoint Security](/c/security/endpoint-security/80) [elastic-stack-security](https://discuss.elastic.co/tag/elastic-stack-security) | 4 | 899 | October 12, 2023 |
| [Vulnerabilities in docker image elasticsearch/elasticsearch:7.17.8](https://discuss.elastic.co/t/vulnerabilities-in-docker-image-elasticsearch-elasticsearch-7-17-8/323377)  [Elasticsearch](/c/elastic-stack/elasticsearch/6) [docker](https://discuss.elastic.co/tag/docker) | 6 | 810 | February 15, 2023 |
| [Are any of Elastic's products affected by CVE-2022-22965?](https://discuss.elastic.co/t/are-any-of-elastics-products-affected-by-cve-2022-22965/301576)  [Elastic Security](/c/security/83) | 4 | 943 | May 13, 2022 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://www.elastic.co/legal/terms-of-use)
* [Privacy Policy](https://www.elastic.co/legal/privacy-policy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


