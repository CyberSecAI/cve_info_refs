=== Content from jvn.jp_6ea3518f_20250126_001843.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2015/10/26  Last Updated:2015/11/13
# JVN#97278546 EC-CUBE vulnerable to cross-site request forgery

## Overview

EC-CUBE contains a cross-site request forgery vulnerability.

## Products Affected

* EC-CUBE 2.11.0 to 2.13.4

[Added on November 13, 2015]

Note that the firmware versions released on October 26, 2015 did not address the vulnerability completely. Newer firmware versions have been released.

## Description

EC-CUBE from LOCKON CO.,LTD. is an open source system for creating shopping websites. EC-CUBE contains a cross-site request forgery vulnerability ([CWE-352](//cwe.mitre.org/data/definitions/352.html)).

## Impact

If a user views a malicious page, arbitrary PHP code may be executed on the server.

## Solution

**Update or apply the patch**

Update to the latest version or apply the patch according to the information provided by the developer.

## Vendor Status

| Vendor | Link |
| --- | --- |
| LOCKON CO.,LTD. | [Cross-site request forgery vulnerability](//www.ec-cube.net/info/weakness/weakness.php?id=64) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

**Analyzed on 2015.10.26 (CVSS Base Metrics)**

[What is CVSS?](/en/nav/jvnhelp.html#cvssv2)

| Measures | Severity | | | Description |
| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) | A vulnerability exploitable with network access means the vulnerable software is bound to the network stack and the attacker does not require local network access or local access. Such a vulnerability is often termed "remotely exploitable". |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) | Specialized access conditions exist. |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) | Authentication is not required to exploit the vulnerability. |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) | There is considerable informational disclosure. Access to some system files is possible, but the attacker does not have control over what is obtained, or the scope of the loss is constrained. |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) | Modification of some system files or information is possible, but the attacker does not have control over what can be modified, or the scope of what the attacker can affect is limited. |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) | There is reduced performance or interruptions in resource availability. |

Base Score:5.1

## Credit

Gen Sato of TRADE WORKS Co.,Ltd. Security Dept. reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2015-5665](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5665) |
| JVN iPedia | [JVNDB-2015-000166](http://jvndb.jvn.jp/jvndb/JVNDB-2015-000166) |

## Update History

2015/10/29
Information under the section "Impact" was modified.
2015/11/13
Information under the section "Product Affected" and "Vendor Status" were updated.

* JVN
* [HOME](http://jvn.jp/en/index.html)
* [What is JVN ?](http://jvn.jp/en/nav/jvn.html)
* [Instructions](http://jvn.jp/en/nav/jvnhelp.html)
* [List of Vulnerability Report](http://jvn.jp/en/report/index.html)
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* [TRnotes](http://jvn.jp/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](http://jvn.jp/en/rss/index.html)
* [Vendor List](http://jvn.jp/en/nav/index.html)
* [List of unreachable developers](http://jvn.jp/en/reply/index.html)
* [Contact](http://jvn.jp/en/contact/index.html)

Copyright (c) 2000-2015 JPCERT/CC and IPA. All rights reserved.



=== Content from www.ec-cube.net_4a3d68b2_20250126_001847.html ===


JavaScript を有効にしてご利用下さい.

# [EC-CUBE®](/)

* [選ばれる理由](/reason/)
* [機能](/functions/)
* [決済](/alliance/)
* [導入事例](/cases/)
* [セキュリティ](/security/)
* [ストア](https://www.ec-cube.net/owners/)

[まずは相談する](/advisor/)

[ご利用中の方のお問い合わせはこちら](/support/)

* [資料請求](/document/)
* [ダウンロード](/download/)

# 脆弱性

## クロスサイトリクエストフォージェリの脆弱性

* 情報公開日：2015年 10月 23日
* 危険度：中
* 対象：Ver 2.11.0～2.13.3

```
------------------------------------------------------------------
■最新情報
-------------------------------------------------------------------
本情報については、以下のページにて最新の内容で更新されています。
下記ページでは本情報分も含んでおりますので、ご確認の上ご対応をお願い申し上げます。

▼「クロスサイトリクエストフォージェリの脆弱性」2015/11/13更新
https://www.ec-cube.net/info/weakness/weakness.php?id=64

------------------------------------------------------------------
■脆弱性の種類
-------------------------------------------------------------------
クロスサイトリクエストフォージェリの脆弱性

-------------------------------------------------------------------
■不具合が存在するEC-CUBEのバージョン
-------------------------------------------------------------------
EC-CUBE　2.11.0～2.13.3

-------------------------------------------------------------------
■修正方法について
-------------------------------------------------------------------
※詳細、修正ファイルのダウンロードはこちらをご確認ください
https://www.ec-cube.net/info/weakness/201510_01/

※下記のプルリクエストで修正
https://github.com/EC-CUBE/eccube-2_13/pull/66/commits

以下は、2.13.3 の修正となっております。

/data/Smarty/templates/admin/basis/zip_install.tpl
/data/Smarty/templates/admin/mail/history.tpl
/data/Smarty/templates/admin/mail/template.tpl
/data/Smarty/templates/admin/ownersstore/log.tpl
/data/Smarty/templates/admin/order/subnavi.tpl
/data/Smarty/templates/admin/total/index.tpl
/data/Smarty/templates/admin/system/system.tpl
/data/class/pages/LC_Page.php::doValidToken
に以下の変更を加えます。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
=================================================================================================================
▽data/Smarty/templates/admin/basis/zip_install.tpl
81行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<iframe src="?mode=<!--{$tpl_mode|h}-->&exec=yes&startRowNum=<!--{$arrForm.startRowNum|h}-->" name="progress" height="200" width="750" frameborder="0"></iframe>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<iframe src="?mode=<!--{$tpl_mode|h}-->&exec=yes&startRowNum=<!--{$arrForm.startRowNum|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" name="progress" height="200" width="750" frameborder="0"></iframe>
=================================================================================================================

▽data/Smarty/templates/admin/mail/history.tpl
51行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<td><a href="#script tag escaped#;" onclick="eccube.openWindow('./preview.php?mode=history&send_id=<!--{$arrDataList[cnt].send_id|h}-->', 'confirm', '720', '600', {menubar:'no'}); return false;">確認</a></td>
<td><a href="#script tag escaped#;" onclick="eccube.openWindow('./<!--{$smarty.const.DIR_INDEX_PATH}-->?mode=query&send_id=<!--{$arrDataList[cnt].send_id|h}-->','query','615','800',{menubar:'no'}); return false;">確認</a></td>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<td><a href="#script tag escaped#;" onclick="eccube.openWindow('./preview.php?mode=history&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->', 'confirm', '720', '600', {menubar:'no'}); return false;">確認</a></td>
<td><a href="#script tag escaped#;" onclick="eccube.openWindow('./<!--{$smarty.const.DIR_INDEX_PATH}-->?mode=query&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->','query','615','800',{menubar:'no'}); return false;">確認</a></td>
-------------------------------------------------------------------

63行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<a href="index.php?mode=retry&send_id=<!--{$arrDataList[cnt].send_id|h}-->" onclick="return window.confirm('未配信と配信失敗となった宛先に再送信を試みますか?');">実行</a>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<a href="index.php?mode=retry&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" onclick="return window.confirm('未配信と配信失敗となった宛先に再送信を試みますか?');">実行</a>
-------------------------------------------------------------------

66行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<td><a href="?mode=delete&send_id=<!--{$arrDataList[cnt].send_id|h}-->" onclick="return window.confirm('配信履歴を削除しても宜しいでしょうか');">削除</a></td>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<td><a href="?mode=delete&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" onclick="return window.confirm('配信履歴を削除しても宜しいでしょうか');">削除</a></td>
=================================================================================================================

=================================================================================================================
▽admin/mail/template.tpl
53行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<td><a href="./template_input.php?mode=edit&template_id=<!--{$arrTemplates[data].template_id}-->">編集</a></td>
<td><a href="#" onclick="eccube.moveDeleteUrl('?mode=delete&id=<!--{$arrTemplates[data].template_id}-->'); return false;">削除</a></td>
<td><a href="#" onclick="eccube.openWindow('./preview.php?mode=template&template_id=<!--{$arrTemplates[data].template_id}-->','preview','650','700',{menubar:'no'}); return false;" target="_blank">プレビュー</a></td>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<td><a href="./template_input.php?mode=edit&template_id=<!--{$arrTemplates[data].template_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->">編集</a></td>
<td><a href="#" onclick="eccube.moveDeleteUrl('?mode=delete&id=<!--{$arrTemplates[data].template_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->'); return false;">削除</a></td>
<td><a href="#" onclick="eccube.openWindow('./preview.php?mode=template&template_id=<!--{$arrTemplates[data].template_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->','preview','650','700',{menubar:'no'}); return false;" target="_blank">プレビュー</a></td>
=================================================================================================================

=================================================================================================================
▽admin/ownersstore/log.tpl
45行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->ownersstore/log.php?mode=detail&log_id=<!--{$log.log_id}-->">
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->ownersstore/log.php?mode=detail&log_id=<!--{$log.log_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->">
=================================================================================================================

=================================================================================================================
▽admin/order/subnavi.tpl
27行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<li id="navi-order-add" class="<!--{if $tpl_mainno == 'order' && $tpl_subno == 'add'}-->on<!--{/if}-->"><a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->order/edit.php?mode=add"><span>受注登録</span></a></li>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<li id="navi-order-add" class="<!--{if $tpl_mainno == 'order' && $tpl_subno == 'add'}-->on<!--{/if}-->"><a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->order/edit.php?mode=add&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->"><span>受注登録</span></a></li>
=================================================================================================================

=================================================================================================================
▽admin/total/index.tpl
118行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<img src="?draw_image=true&type=<!--{$smarty.post.type|h}-->&mode=search&search_form=<!--{$smarty.post.search_form|h}-->&page=<!--{$smarty.post.page|h}-->&search_startyear_m=<!--{$smarty.post.search_startyear_m|h}-->&search_startmonth_m=<!--{$smarty.post.search_startmonth_m|h}-->&search_startyear=<!--{$smarty.post.search_startyear|h}-->&search_startmonth=<!--{$smarty.post.search_startmonth|h}-->&search_startday=<!--{$smarty.post.search_startday|h}-->&search_endyear=<!--{$smarty.post.search_endyear|h}-->&search_endmonth=<!--{$smarty.post.search_endmonth|h}-->&search_endday=<!--{$smarty.post.search_endday|h}-->" alt="グラフ" />
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<img src="?draw_image=true&type=<!--{$smarty.post.type|h}-->&mode=search&search_form=<!--{$smarty.post.search_form|h}-->&page=<!--{$smarty.post.page|h}-->&search_startyear_m=<!--{$smarty.post.search_startyear_m|h}-->&search_startmonth_m=<!--{$smarty.post.search_startmonth_m|h}-->&search_startyear=<!--{$smarty.post.search_startyear|h}-->&search_startmonth=<!--{$smarty.post.search_startmonth|h}-->&search_startday=<!--{$smarty.post.search_startday|h}-->&search_endyear=<!--{$smarty.post.search_endyear|h}-->&search_endmonth=<!--{$smarty.post.search_endmonth|h}-->&search_endday=<!--{$smarty.post.search_endday|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" alt="グラフ" />
=================================================================================================================

=================================================================================================================
▽admin/system/system.tpl
40行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
<iframe src="?mode=info" height="500" frameborder="0" style="width: 100%;"></iframe>
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
<iframe src="?mode=info&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" height="500" frameborder="0" style="width: 100%;"></iframe>
=================================================================================================================

=================================================================================================================
▽LC_Page.php::doValidToken
439行目付近を変更下さい。
※2.11系では SC_Response_Ex::actionExit(); は不要です。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
public function doValidToken($is_admin = false)
{
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
        if (!SC_Helper_Session_Ex::isValidToken(false)) {
            if ($is_admin) {
                SC_Utils_Ex::sfDispError(INVALID_MOVE_ERRORR);
            } else {
                SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);
            }
            SC_Response_Ex::actionExit();
        }
    }
}

-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
public function doValidToken($is_admin = false)
{
    if ($is_admin) {
        $mode = $this->getMode();
        if ($_SERVER['REQUEST_METHOD'] == 'POST' || !SC_Utils::isBlank($mode)) {
            if (!SC_Helper_Session_Ex::isValidToken(false)) {
                SC_Utils_Ex::sfDispError(INVALID_MOVE_ERRORR);
                SC_Response_Ex::actionExit();
            }
        }
    } else {
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
            if (!SC_Helper_Session_Ex::isValidToken(false)) {
                SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);
                SC_Response_Ex::actionExit();
            }
        }
    }
}
=================================================================================================================

-------------------------------------------------------------------
■修正後の確認方法について
-------------------------------------------------------------------

以下を御確認ください。
・郵便番号DB登録が行えること。
・メルマガ管理>配信履歴、テンプレート設定の各機能が利用できること。
・オーナーズストア>ログ管理の詳細が確認できること
・売上集計のグラフが表示されること
・受注登録ページ、システム情報ページに遷移できること
・カスタマイズにより追加した管理画面の画面に遷移できること

====================================================================
```

1. [ホーム](/)
3. 脆弱性

 [PageTop](#wrap)

## EC-CUBE公式アドバイザーご相談窓口

* 他社のASPやパッケージとの違いを知りたい
* BtoCのサイトにBtoB機能を追加したい
* 何から手をつければよいかわからない
* オープンソースならではの注意事項を知りたい
* 自社にマッチした制作会社を探したい
* サイト制作だけでなく運営もサポートしてほしい

新規構築・リニューアル・取引先向けのWeb受発注システム（BtoB）や事業の拡大など、
今抱えている課題を解決する最適な業者探しを、アドバイザーがお手伝いします。

* [まずは相談する](/advisor/)
* [資料請求する](/document/)
* [ご利用中の方のお問い合わせはこちら](/support/)

* ## EC-CUBE導入をお考えの方

  + [選ばれる理由](/reason/)
  + [導入事例](/cases/)
  + [デモサイト](/demo/)
  + [機能一覧](/functions/)
  + [マニュアル](https://www.ec-cube.net/manual/ec-cube4/)
  + [ライセンス](/license/)
  + [メールマガジン登録](https://www.ec-cube.net/mail/)
  + [EC開業・運営ノウハウ](/know-how/)
* ## EC-CUBEをインストールしたい

  + [最新版ダウンロード](/download/)
  + [機能一覧](/functions/)
  + [開発情報](/developers/)
  + [レンタルサーバ](/server/)
* ## EC-CUBEをご利用中の方

  + [EC-CUBEメンバー登録](https://www.ec-cube.net/entry/)
  + [メンバーページログイン](https://www.ec-cube.net/mypage/login.php)
  + [オーナーズストア](https://www.ec-cube.net/owners/)
  + [セキュリティ対策](/security/)
  + [開発コミュニティ](https://xoops.ec-cube.net/)
* ## お問い合わせ

  + [サポート](/support/)
  + [よくあるご質問](https://support.ec-cube.net/hc/ja)
  + [お問い合わせ](https://www.ec-cube.net/contact/)
  + [ec-cube.coに関するお問い合わせ](https://www.ec-cube.net/product/co/support.php)
* ## ニュース・イベント

  + [ニュースリリース](https://www.ec-cube.net/newsrelease/)
  + [イベント](https://www.ec-cube.net/event/)
  + [X（旧Twitter）](https://x.com/EC_CUBE)
  + [Facebook](https://www.facebook.com/eccube/)
* ## パートナーについて

  + [パートナー登録（無料）](https://www.ec-cube.net/entry/partner.php)
  + [パートナーページログイン](https://www.ec-cube.net/partnerpage/login.php)
  + [パートナー制度のご案内](https://www.ec-cube.net/partnerpage/top.php)
  + [インテグレートパートナー 一覧](https://www.ec-cube.net/integrate/partner/)
  + [エバンジェリスト紹介](/evangelist/)
  + [EC-CUBEのロゴ](/brand-assets/)
* ## 決済サービス

  + [決済サービス一覧](/alliance/)
  + [EC-CUBEペイメントPlus](/lp/payment/)
  + [EC-CUBEペイメントPlus・BtoB向けプラン](/lp/epsilon-btob/)
  + [Amazon Pay](https://www.ec-cube.net/products/detail.php?product_id=2490)
* ## その他サービス

  + [基幹システム](/lp/core-system/)
  + [物流サービス一覧](/logistics/)
  + [サイトマップ](/sitemap/)

## [EC-CUBE®](/)

* [X](https://x.com/EC_CUBE)
* [Facebook](https://www.facebook.com/eccube/)
* [Wantedly](https://www.wantedly.com/companies/ec-cube)

* [個人情報の取扱いについて](/policy/)
* [個人情報保護方針](/policy/privacy/)
* [Cookieによる情報収集について](/policy/cookie/)
* [外的環境の把握](/policy/foreign-corporation/)
* [情報セキュリティ方針](/policy/security-policy/)

* [サイトマップ](/sitemap/)
* [運営会社](https://www.ec-cube.co.jp/)

© EC-CUBE CO.,LTD.

![](https://www.facebook.com/tr?id=736682659717992&ev=NoScript)



=== Content from www.ec-cube.net_4497eb54_20250126_001847.html ===


| | EC-CUBE2.13.3以下の1件の脆弱性に関しまして | | --- |  |  | | --- | | 更新履歴 | | 2015/10/23 9:00 事象について再度検証を重ねた結果、危険度を高から中に変更いたしました。 2015/10/23 9:00 2.11系の修正ファイルから SC\_Response\_Ex::actionExit(); の記述を削除 | |  | | [本件の概要](#summery)   [修正方法](#modifi) | | EC-CUBE 脆弱性に関するお知らせ | | いつもEC-CUBEをご利用いただきまして、誠にありがとうございます。  **EC-CUBE（2.11系/2.12系/2.13系）**に緊急度の高い1件の脆弱性があることが判明いたしました。 （本脆弱性における被害報告は現時点でございません。）  脆弱性そのものは該当ファイルのソースコード修正、またはファイルの上書きにより、すぐに解決するものです。  皆様にはお手数おかけしまして誠に申し訳ございませんが、対策を早急に講じていただきますよう、どうかよろしくお願い申し上げます。 | |  | | 修正方法につきまして | | 1.修正ファイルをダウンロードしEC-CUBEバージョンごとに適用してください。   ※バージョンの確認方法   EC-CUBE管理画面へログイン後のホーム画面にてご確認頂けます。   また、カスタマイズによってシステム情報が表示されない場合は、以下のファイルをご確認ください。   - data/class/SC\_Initial.php(38行目付近)   <例>-------------------------------------   /\*\* EC-CUBEのバージョン \*/   define('ECCUBE\_VERSION', '2.12.2');   -----------------------------------------   上記の例の場合、EC-CUBEのバージョンは2.12.2となります。  ・ [修正ファイル(2.11.0～2.13.3)](./weakness_update_files_201510_01.zip)   md5：78cbd8bf373e5535f2a2d9348d9914e6  2.修正する該当ファイル、もしくはEC-CUBEファイル全体のバックアップをとってください。 3.ダウンロードしたファイルを解凍し、お使いのバージョンの該当ファイルを既存ファイルへ上書きしてください。   ※ディレクトリ付きファイルですので、ルートディレクトリからそのままファイルの上書きが可能です。   （EC-CUBEデフォルトのディレクトリ構造以外で使用されている場合、ファイルの上書きができない可能性がございますのでご注意ください）   ※既存ファイルをカスタマイズしている場合、以下個別の修正方法をご参考に修正をお願いします。  4.動作確認をしてください。 | |  |  | | 本不具合に対する対応方法 | | --- | | ```  ----------------------------------------------------------------------------------------------------------------- ■不具合が存在するEC-CUBEのバージョン -----------------------------------------------------------------------------------------------------------------  [(1)【危険度：中】クロスサイトリクエストフォージェリの脆弱性](#01)  - EC-CUBE　2.11.0～2.11.5  - EC-CUBE　2.12.0～2.12.6  - EC-CUBE　2.13.0～2.13.3   ``` | |  | | ```  ----------------------------------------------------------------------------------------------------------------- ■個別の脆弱性情報に関しまして -----------------------------------------------------------------------------------------------------------------  ``` ```  以下、個別の脆弱性情報を記載いたします。 該当ファイルをカスタマイズしている場合は以下をご参考いだだき個別で修正をお願いいたします。 /data/Smarty/templates/admin/basis/zip_install.tpl /data/Smarty/templates/admin/mail/history.tpl /data/Smarty/templates/admin/mail/template.tpl /data/Smarty/templates/admin/ownersstore/log.tpl /data/Smarty/templates/admin/order/subnavi.tpl /data/Smarty/templates/admin/total/index.tpl /data/Smarty/templates/admin/system/system.tpl /data/class/pages/LC_Page.php::doValidToken  ※行数はバージョン・カスタマイズの内容によって異なりますので、ご注意ください。  ``` | |  | | ```  ================================================================================================================= ▼(1)クロスサイトリクエストフォージェリの脆弱性 ----------------------------------------------------------------------------------------------------------------- 【危険度】 中 ※2015年10月22日 再度事象を確認・検討し危険度を高から中に変更いたしました。  【対象バージョン】 2.11.0 ～ 2.13.3  【修正方法について】 /data/Smarty/templates/admin/basis/zip_install.tpl /data/Smarty/templates/admin/mail/history.tpl /data/Smarty/templates/admin/mail/template.tpl /data/Smarty/templates/admin/ownersstore/log.tpl /data/Smarty/templates/admin/order/subnavi.tpl /data/Smarty/templates/admin/total/index.tpl /data/Smarty/templates/admin/system/system.tpl /data/class/pages/LC_Page.php::doValidToken に以下の変更を加えます。  【修正後の確認方法について】 以下を御確認ください。 ・郵便番号DB登録が行えること。 ・メルマガ管理＞配信履歴、テンプレート設定の各機能が利用できること。 ・オーナーズストア＞ログ管理の詳細が確認できること ・売上集計のグラフが表示されること ・受注登録ページ、システム情報ページに遷移できること  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ================================================================================================================= ▽data/Smarty/templates/admin/basis/zip_install.tpl 81行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <iframe src="?mode=<!--{$tpl_mode|h}-->&exec=yes&startRowNum=<!--{$arrForm.startRowNum|h}-->" name="progress" height="200" width="750" frameborder="0"></iframe> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <iframe src="?mode=<!--{$tpl_mode|h}-->&exec=yes&startRowNum=<!--{$arrForm.startRowNum|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" name="progress" height="200" width="750" frameborder="0"></iframe> =================================================================================================================  ▽data/Smarty/templates/admin/mail/history.tpl 51行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <td><a href="javascript:;" onclick="eccube.openWindow('./preview.php?mode=history&send_id=<!--{$arrDataList[cnt].send_id|h}-->', 'confirm', '720', '600', {menubar:'no'}); return false;">確認</a></td> <td><a href="javascript:;" onclick="eccube.openWindow('./<!--{$smarty.const.DIR_INDEX_PATH}-->?mode=query&send_id=<!--{$arrDataList[cnt].send_id|h}-->','query','615','800',{menubar:'no'}); return false;">確認</a></td> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <td><a href="javascript:;" onclick="eccube.openWindow('./preview.php?mode=history&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->', 'confirm', '720', '600', {menubar:'no'}); return false;">確認</a></td> <td><a href="javascript:;" onclick="eccube.openWindow('./<!--{$smarty.const.DIR_INDEX_PATH}-->?mode=query&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->','query','615','800',{menubar:'no'}); return false;">確認</a></td> -------------------------------------------------------------------  63行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <a href="index.php?mode=retry&send_id=<!--{$arrDataList[cnt].send_id|h}-->" onclick="return window.confirm('未配信と配信失敗となった宛先に再送信を試みますか?');">実行</a> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <a href="index.php?mode=retry&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" onclick="return window.confirm('未配信と配信失敗となった宛先に再送信を試みますか?');">実行</a> -------------------------------------------------------------------  66行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <td><a href="?mode=delete&send_id=<!--{$arrDataList[cnt].send_id|h}-->" onclick="return window.confirm('配信履歴を削除しても宜しいでしょうか');">削除</a></td> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <td><a href="?mode=delete&send_id=<!--{$arrDataList[cnt].send_id|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" onclick="return window.confirm('配信履歴を削除しても宜しいでしょうか');">削除</a></td> =================================================================================================================  ================================================================================================================= ▽admin/mail/template.tpl 53行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <td><a href="./template_input.php?mode=edit&template_id=<!--{$arrTemplates[data].template_id}-->">編集</a></td> <td><a href="#" onclick="eccube.moveDeleteUrl('?mode=delete&id=<!--{$arrTemplates[data].template_id}-->'); return false;">削除</a></td> <td><a href="#" onclick="eccube.openWindow('./preview.php?mode=template&template_id=<!--{$arrTemplates[data].template_id}-->','preview','650','700',{menubar:'no'}); return false;" target="_blank">プレビュー</a></td> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <td><a href="./template_input.php?mode=edit&template_id=<!--{$arrTemplates[data].template_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->">編集</a></td> <td><a href="#" onclick="eccube.moveDeleteUrl('?mode=delete&id=<!--{$arrTemplates[data].template_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->'); return false;">削除</a></td> <td><a href="#" onclick="eccube.openWindow('./preview.php?mode=template&template_id=<!--{$arrTemplates[data].template_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->','preview','650','700',{menubar:'no'}); return false;" target="_blank">プレビュー</a></td> =================================================================================================================  ================================================================================================================= ▽admin/ownersstore/log.tpl 45行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->ownersstore/log.php?mode=detail&log_id=<!--{$log.log_id}-->"> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->ownersstore/log.php?mode=detail&log_id=<!--{$log.log_id}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->"> =================================================================================================================  ================================================================================================================= ▽admin/order/subnavi.tpl 27行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <li id="navi-order-add" class="<!--{if $tpl_mainno == 'order' && $tpl_subno == 'add'}-->on<!--{/if}-->"><a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->order/edit.php?mode=add"><span>受注登録</span></a></li> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <li id="navi-order-add" class="<!--{if $tpl_mainno == 'order' && $tpl_subno == 'add'}-->on<!--{/if}-->"><a href="<!--{$smarty.const.ROOT_URLPATH}--><!--{$smarty.const.ADMIN_DIR}-->order/edit.php?mode=add&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->"><span>受注登録</span></a></li> =================================================================================================================  ================================================================================================================= ▽admin/total/index.tpl 118行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <img src="?draw_image=true&type=<!--{$smarty.post.type|h}-->&mode=search&search_form=<!--{$smarty.post.search_form|h}-->&page=<!--{$smarty.post.page|h}-->&search_startyear_m=<!--{$smarty.post.search_startyear_m|h}-->&search_startmonth_m=<!--{$smarty.post.search_startmonth_m|h}-->&search_startyear=<!--{$smarty.post.search_startyear|h}-->&search_startmonth=<!--{$smarty.post.search_startmonth|h}-->&search_startday=<!--{$smarty.post.search_startday|h}-->&search_endyear=<!--{$smarty.post.search_endyear|h}-->&search_endmonth=<!--{$smarty.post.search_endmonth|h}-->&search_endday=<!--{$smarty.post.search_endday|h}-->" alt="グラフ" /> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <img src="?draw_image=true&type=<!--{$smarty.post.type|h}-->&mode=search&search_form=<!--{$smarty.post.search_form|h}-->&page=<!--{$smarty.post.page|h}-->&search_startyear_m=<!--{$smarty.post.search_startyear_m|h}-->&search_startmonth_m=<!--{$smarty.post.search_startmonth_m|h}-->&search_startyear=<!--{$smarty.post.search_startyear|h}-->&search_startmonth=<!--{$smarty.post.search_startmonth|h}-->&search_startday=<!--{$smarty.post.search_startday|h}-->&search_endyear=<!--{$smarty.post.search_endyear|h}-->&search_endmonth=<!--{$smarty.post.search_endmonth|h}-->&search_endday=<!--{$smarty.post.search_endday|h}-->&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" alt="グラフ" /> =================================================================================================================  ================================================================================================================= ▽admin/system/system.tpl 40行目付近を変更下さい。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- <iframe src="?mode=info" height="500" frameborder="0" style="width: 100%;"></iframe> -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- <iframe src="?mode=info&<!--{$smarty.const.TRANSACTION_ID_NAME}-->=<!--{$transactionid}-->" height="500" frameborder="0" style="width: 100%;"></iframe> =================================================================================================================  ================================================================================================================= ▽LC_Page.php::doValidToken 439行目付近を変更下さい。 ※2.11系では SC_Response_Ex::actionExit(); は不要です。 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- public function doValidToken($is_admin = false) {     if ($_SERVER['REQUEST_METHOD'] == 'POST') {         if (!SC_Helper_Session_Ex::isValidToken(false)) {             if ($is_admin) {                 SC_Utils_Ex::sfDispError(INVALID_MOVE_ERRORR);             } else {                 SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);             }             SC_Response_Ex::actionExit();         }     } }  -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- public function doValidToken($is_admin = false) {     if ($is_admin) {         $mode = $this->getMode();         if ($_SERVER['REQUEST_METHOD'] == 'POST' || !SC_Utils::isBlank($mode)) {             if (!SC_Helper_Session_Ex::isValidToken(false)) {                 SC_Utils_Ex::sfDispError(INVALID_MOVE_ERRORR);                 SC_Response_Ex::actionExit();             }         }     } else {         if ($_SERVER['REQUEST_METHOD'] == 'POST') {             if (!SC_Helper_Session_Ex::isValidToken(false)) {                 SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);                 SC_Response_Ex::actionExit();             }         }     } } =================================================================================================================   ``` | | | --- | --- | --- | --- | --- | --- | --- |  |  | | --- |  |  | | --- | | FAQ | | **Q. 私のサイトは大丈夫か？** A. まずは対象バージョンをお確かめください。 脆弱性対象バージョンのEC-CUBEをお使いの場合、対象ファイルを確認ください。 修正がされていない場合、修正方法に沿って修正の対応をお願いいたします。 《[オフィシャルホスティングパートナー](http://www.ec-cube.net/partner/search.php)をご利用の場合》 《[インテグレートパートナー](http://www.ec-cube.net/integrate/partner/place.php)が構築している場合》 既に対策されている場合がございます。各パートナー担当者さまへお問い合わせ下さい。  この度は、お手数をおかけいたしますことを深くお詫び申し上げます。 |  |  | | --- | | 謝辞 | | 本情報の一部は、お問い合わせいただきました開発者様よりご提供いただきました。この場をお借りして、厚く御礼申し上げます。 |  |  | | --- | | 問い合わせ先 | | EC-CUBE 運営チーム 足立、金 | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |



=== Content from jvndb.jvn.jp_7f025543_20250126_001845.html ===


![JVN iPedia](/en/common/img/en_logo.gif)
Last Updated:2015/11/13

| [[Japanese]](/ja/contents/2015/JVNDB-2015-000166.html) | |
| --- | --- |
| JVNDB-2015-000166 | |
| EC-CUBE vulnerable to cross-site request forgery | |
| Overview | |
| EC-CUBE from LOCKON CO.,LTD. is an open source system for creating shopping websites. EC-CUBE contains a cross-site request forgery vulnerability (CWE-352). | |
| CVSS Severity ([What is CVSS?](/en/nav/jvndbhelp.html#jvndb3)) | |
| **CVSS V2 Severity:Base Metrics [5.1](/cvss/en/v2.html#AV:N/AC:H/Au:N/C:P/I:P/A:P) (Medium) [IPA Score]**  * Access Vector: Network * Access Complexity: High * Authentication: None * Confidentiality Impact: Partial * Integrity Impact: Partial * Availability Impact: Partial | |
| Affected Products | |
|  | |
| LOCKON CO.,LTD  * EC-CUBE 2.11.0 to 2.13.4 | |
| [Added on November 13, 2015] Note that the firmware versions released on October 26, 2015 did not address the vulnerability completely. Newer firmware versions have been released. | |
| Impact | |
| If a user views a malicious page, arbitrary PHP code may be executed on the server. | |
| Solution | |
| [Update or apply the patch] | |
| Vendor Information | |
| LOCKON CO.,LTD  * EC-CUBE : [About the vulnerability in EC-CUBE](https://www.ec-cube.net/info/weakness/201510_01/) (in Japanese) * EC-CUBE : [Cross-site request forgery vulnerability (2015/10/23)](https://www.ec-cube.net/info/weakness/weakness.php?id=63) (in Japanese) * EC-CUBE : [Cross-site request forgery vulnerability (2015/11/13)](http://www.ec-cube.net/info/weakness/weakness.php?id=64) (in Japanese) | |
| CWE ([What is CWE?](http://www.ipa.go.jp/security/english/vuln/CWE_en.html)) | |
| 1. [Cross-Site Request Forgery](http://www.ipa.go.jp/security/english/vuln/CWE_en.html#CWE352)(CWE-352) [IPA Evaluation] | |
| CVE ([What is CVE?](http://www.ipa.go.jp/security/english/vuln/CVE_en.html)) | |
| 1. [CVE-2015-5665](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5665) | |
| References | |
| 1. JVN : [JVN#97278546](http://jvn.jp/en/jp/JVN97278546/index.html) 2. National Vulnerability Database (NVD) : [CVE-2015-5665](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-5665) | |
| Revision History | |
| * [2015/10/26] | |

| --- | |
| --- | --- |
| Date Public | 2015/10/26 |
| Date First Published | 2015/10/26 |
| Date Last Updated | 2015/11/13 |
| --- | |

* JVN
* [HOME](http://jvn.jp/en/)
* [What is JVN ?](http://jvn.jp/en/nav/jvn.html)
* [Instructions](http://jvn.jp/en/nav/jvnhelp.html)
* [List of Vulnerability Report](http://jvn.jp/en/report/index.html)
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* [TRnotes](http://jvn.jp/en/tr/index.html)
* [JVN iPedia](/en/)
* [Search](/search/index.php?mode=_vulnerability_search_IA_VulnSearch&lang=en)
* [What is JVN iPedia?](/en/nav/jvndb.html)
* [How to Use?](/en/nav/jvndbhelp.html)
* [MyJVN](/en/apis/myjvn/index.html)
* [JVNJS/RSS](http://jvn.jp/en/rss/index.html)
* [Vendor List](http://jvn.jp/en/nav/index.html)
* [List of unreachable developers](http://jvn.jp/en/reply/index.html)
* [Contact](http://jvn.jp/en/contact/index.html)

![Copyright © 2007- IPA. All rights reserved.](/common/img/copyright.png)


