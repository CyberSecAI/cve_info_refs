=== Content from bugzilla.redhat.com_3bc6e78c_20250126_030157.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1258458)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1258458)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1258458)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1258458

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1258458**](show_bug.cgi?id=1258458)
(CVE-2015-5240)
- [CVE-2015-5240](https://access.redhat.com/security/cve/CVE-2015-5240) openstack-neutron: Firewall rules bypass through port update

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2015-5240 openstack-neutron: Firewall rules bypass through port update

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2015-5240 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1260495](show_bug.cgi?id=1260495) [1261385](show_bug.cgi?id=1261385) [1261386](show_bug.cgi?id=1261386 "CLOSED EOL - CVE-2015-5240 openstack-neutron: Firewall rules bypass through port update [fedora-all]") [1264272](show_bug.cgi?id=1264272) [1264273](show_bug.cgi?id=1264273) [1264274](show_bug.cgi?id=1264274) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1258461](show_bug.cgi?id=1258461) | | TreeView+ | [depends on](buglist.cgi?bug_id=1258458&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1258458&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-08-31 12:43 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-05-12 10:31 UTC ([History](show_activity.cgi?id=1258458)) | | [CC List:](page.cgi?id=fields.html#cclist) | 25 users (show)  abaron amuller aortega apevec ayoung chrisw dallan gkotton gmollett jjoyce jschluet kbasil lhh lpeer markmc mburns nyechiel rbryant sclewis security-response-team slinaber slong srevivo tdecacqu yeylon | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A race-condition flaw leading to ACL bypass was discovered in OpenStack Networking (neutron). An authenticated user could change the owner of a port after it was created but before firewall rules were applied, thus preventing firewall control checks from occurring. All OpenStack Networking deployments that used either the ML2 plug-in or a plug-in that relied on the security groups AMQP API were affected. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2015-10-15 23:02:54 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2015:1909](https://access.redhat.com/errata/RHSA-2015%3A1909) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-neutron security and bug fix update | 2015-10-15 20:09:00 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1258458#c0)  Adam Mariš    2015-08-31 12:43:01 UTC  ``` It was reported that a vulnerability was found in Neutron. By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls. All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API are affected. All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API are affected.  Vulnerability affects versions through 2014.2.3 and 2015.1 versions through 2015.1.1  Acknowledgements:  Red Hat would like to thank the OpenStack project for reporting this issue. Upstream acknowledges Kevin Benton from Mirantis as the original reporter.   ```  [Comment 10](show_bug.cgi?id=1258458#c10)  Martin Prpič    2015-09-09 08:01:28 UTC  ``` Public via:  <http://www.openwall.com/lists/oss-security/2015/09/08/9>   ```  [Comment 11](show_bug.cgi?id=1258458#c11)  Adam Mariš    2015-09-09 08:44:38 UTC  ```  Created openstack-neutron tracking bugs for this issue:  Affects: openstack-rdo [[bug 1261385](show_bug.cgi?id=1261385)] Affects: fedora-all [[bug 1261386](show_bug.cgi?id=1261386 "CLOSED EOL - CVE-2015-5240 openstack-neutron: Firewall rules bypass through port update [fedora-all]")]   ```  [Comment 13](show_bug.cgi?id=1258458#c13)  errata-xmlrpc    2015-10-15 16:09:32 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 7   OpenStack 5 for RHEL 6   OpenStack 7 For RHEL 7   OpenStack 6 for RHEL 7  Via RHSA-2015:1909 <https://rhn.redhat.com/errata/RHSA-2015-1909.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1258458&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from launchpad.net_9b3883b9_20250126_030145.html ===

[Log in / Register](https://launchpad.net/~kevinbenton/%2Blogin)

[![](https://launchpadlibrarian.net/146250579/me_small.jpeg)](https://launchpad.net/~kevinbenton)

## [Kevin Benton](https://launchpad.net/~kevinbenton)

* Overview
* [Code](https://code.launchpad.net/~kevinbenton)
* [Bugs](https://bugs.launchpad.net/~kevinbenton)
* [Blueprints](https://blueprints.launchpad.net/~kevinbenton)
* [Translations](https://translations.launchpad.net/~kevinbenton)
* [Answers](https://answers.launchpad.net/~kevinbenton)

* [Related packages](https://launchpad.net/~kevinbenton/%2Brelated-packages)
* [Related projects](https://launchpad.net/~kevinbenton/%2Brelated-projects)

## User information

Launchpad Id:
kevinbenton

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-06-04

[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

SSH keys:

[administrator@teststack](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~kevinbenton/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**kevinbenton**
 on
**chat.freenode.net**

## [All memberships](https://launchpad.net/~kevinbenton/%2Bparticipation) Latest memberships

| [bigswitch](/~networking-bigswitch)  Joined on 2015-10-22 | |
| --- | --- |
| [Neutron Bugs](/~neutron-bugs)  Joined on 2015-07-30 | |
| [MOS Neutron](/~mos-neutron)  Joined on 2015-03-31 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_87093b76_20250124_191643.html ===

[Log in / Register](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* [Answers](https://answers.launchpad.net/neutron)

# [OSSA 2015-018] IP, MAC, and DHCP spoofing rules can by bypassed by changing device\_owner (CVE-2015-5240)

Bug #1489111 reported by
[Kevin Benton](https://launchpad.net/~kevinbenton)
on 2015-08-26

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |
|  | [neutron](https://bugs.launchpad.net/neutron) | Fix Released | Undecided | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | [neutron 7.0.0 "liberty"](https://launchpad.net/neutron/%2Bmilestone/7.0.0) |
|  | [Juno](https://bugs.launchpad.net/neutron/juno) | Fix Released | Undecided | Unassigned | [neutron 2014.2.4](https://launchpad.net/neutron/%2Bmilestone/2014.2.4) |

### Bug Description

The anti-IP spoofing rules, anti-MAC spoofing rules, and anti-DHCP spoofing rules can be bypassed by changing the device\_owner field of a compute node's port to something that starts with 'network:'.

Steps to reproduce:

Create a port on the target network:

neutron port-create some\_network

Start a repeated update of the device\_owner field to immediately change it back after nova sets it to 'compute:<whatever>' on VM attachment. (This has to be done quickly because the owner has to be set to 'network:something' before the L2 agent wires up the security group rules.)

watch neutron port-update <port-uuid-from-above> --device-owner network:hello

Then boot the VM with the port UUID:

nova boot test --nic port-id=<port-uuid-from-above> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec

This VM will now have no iptables rules applied because it will be treated as a network owned port (e.g. router interface, DHCP interface, etc).

See [original description](comments/0)

Tags:

[in-feature-pecan](/neutron/%2Bbugs?field.tag=in-feature-pecan)
[in-stable-juno](/neutron/%2Bbugs?field.tag=in-stable-juno)
[in-stable-kilo](/neutron/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2015-5240](/bugs/cve/2015-5240 "Race condition in OpenStack Neutron b...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#1](/neutron/%2Bbug/1489111/comments/1) |
| --- | --- | --- | --- |

Hi,

I have a attached a patch that fixes the problem.

It enables a regex match in the policy engine and then changes the default policy to prevent users from using the 'network:' prefix in the device\_owner field unless they own the network, have the advanced services role, or are an admin.

Hi,
I have a attached a patch that fixes the problem.
It enables a regex match in the policy engine and then changes the default policy to prevent users from using the 'network:' prefix in the device\_owner field unless they own the network, have the advanced services role, or are an admin.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#2](/neutron/%2Bbug/1489111/comments/2) |
| --- | --- | --- | --- |

The core issue here is that the L2 agent trusts any devices whose owner field starts with 'network:'. This is necessary because the DHCP port and the router ports can't have DHCP spoofing and IP spoofing rules (respectively).

Here is the logic that skips 'network:' owned ports for security groups.

<https://github.com/openstack/neutron/blob/d66f0e27919a29682d7c65e4f9ce1f9c7b278542/neutron/api/rpc/handlers/securitygroups_rpc.py#L83>

The core issue here is that the L2 agent trusts any devices whose owner field starts with 'network:'. This is necessary because the DHCP port and the router ports can't have DHCP spoofing and IP spoofing rules (respectively).
Here is the logic that skips 'network:' owned ports for security groups.
https://github.com/openstack/neutron/blob/d66f0e27919a29682d7c65e4f9ce1f9c7b278542/neutron/api/rpc/handlers/securitygroups\_rpc.py#L83

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#3](/neutron/%2Bbug/1489111/comments/3) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#4](/neutron/%2Bbug/1489111/comments/4) |
| --- | --- | --- | --- |

Beside having an instance unprotected by iptables, what can the user do with it ?

e.g., can he spoof other tenants' ip ?

Beside having an instance unprotected by iptables, what can the user do with it ?
e.g., can he spoof other tenants' ip ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#5](/neutron/%2Bbug/1489111/comments/5) |
| --- | --- | --- | --- |

Yes, the big risk here is with shared networks. The attacker can spoof other VMs IPs, or give out incorrect information via spoofed DHCP responses to get other VMs to send traffic to it.

Yes, the big risk here is with shared networks. The attacker can spoof other VMs IPs, or give out incorrect information via spoofed DHCP responses to get other VMs to send traffic to it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#6](/neutron/%2Bbug/1489111/comments/6) |
| --- | --- | --- | --- |

Had to update the patch to handle a changed response code in a unit test.

Had to update the patch to handle a changed response code in a unit test.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#7](/neutron/%2Bbug/1489111/comments/7) |
| --- | --- | --- | --- |

Assuming this affect all l2 agents and all supported release, here is the impact description:

Title: Neutron firewall rules bypass through port update

Reporter: Kevin Benton (Mirantis)

Products: Neutron

Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1

Description:

Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the port's device owner of an instance right after it is created, an authenticated user may prevent firewall rules to be applied, potentially resulting in anti spoofing rules to be disabled. All Neutron setups are affected.

Assuming this affect all l2 agents and all supported release, here is the impact description:
Title: Neutron firewall rules bypass through port update
Reporter: Kevin Benton (Mirantis)
Products: Neutron
Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1
Description:
Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the port's device owner of an instance right after it is created, an authenticated user may prevent firewall rules to be applied, potentially resulting in anti spoofing rules to be disabled. All Neutron setups are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#8](/neutron/%2Bbug/1489111/comments/8) |
| --- | --- | --- | --- |

Thanks Kevin for the update, please let me know if the above description is accurate.

@neutron-coresec, is the proposed patch going to be easily backportable ? Not sure what's the rule for policy.json changes...

Anyway, please follow this guide to properly format proposed patch: <https://security.openstack.org/#how-to-propose-and-review-a-security-patch>

Thanks Kevin for the update, please let me know if the above description is accurate.
@neutron-coresec, is the proposed patch going to be easily backportable ? Not sure what's the rule for policy.json changes...
Anyway, please follow this guide to properly format proposed patch: https://security.openstack.org/#how-to-propose-and-review-a-security-patch

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-08-26: |  |  | [#9](/neutron/%2Bbug/1489111/comments/9) |
| --- | --- | --- | --- |

This scenario will likely enable an attacker on a shared network to hijack DHCP traffic as mentioned by Kevin.

IP spoofing could also be possible since the attacker VMs would be able to intercept ARP requests and fabricate ARP replies

It is not possible to do any sort of mitigation using security groups, so this attack is very practical and probably deserves an A in the OSSA taxonomy

This scenario will likely enable an attacker on a shared network to hijack DHCP traffic as mentioned by Kevin.
IP spoofing could also be possible since the attacker VMs would be able to intercept ARP requests and fabricate ARP replies
It is not possible to do any sort of mitigation using security groups, so this attack is very practical and probably deserves an A in the OSSA taxonomy

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#10](/neutron/%2Bbug/1489111/comments/10) |
| --- | --- | --- | --- |

Yes, that description sounds correct. I will format the patch appropriately.

Yes, that description sounds correct. I will format the patch appropriately.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-08-26: |  |  | [#12](/neutron/%2Bbug/1489111/comments/12) |
| --- | --- | --- | --- |

Patch looks good to me. +2,

The shared network flag feature in neutron is such a hack. Thank goodness we have proper RBAC now thanks to the support you added kevin :)

Patch looks good to me. +2,
The shared network flag feature in neutron is such a hack. Thank goodness we have proper RBAC now thanks to the support you added kevin :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-27: |  |  | [#13](/neutron/%2Bbug/1489111/comments/13) |
| --- | --- | --- | --- |

Assuming this affect all the way down to Juno, can you also attach backports for stable/juno and stable/kilo branches as well ?

Assuming this affect all the way down to Juno, can you also attach backports for stable/juno and stable/kilo branches as well ?

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-08-27: |  |  | [#14](/neutron/%2Bbug/1489111/comments/14) |
| --- | --- | --- | --- |

Minor improvement to the wording:

By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls.

Minor improvement to the wording:
By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-27: |  |  | [#15](/neutron/%2Bbug/1489111/comments/15) |
| --- | --- | --- | --- |

Thanks for the review, here is the updated impact description:

Title: Neutron firewall rules bypass through port update

Reporter: Kevin Benton (Mirantis)

Products: Neutron

Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1

Description:

Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls. All Neutron setups are affected.

Thanks for the review, here is the updated impact description:
Title: Neutron firewall rules bypass through port update
Reporter: Kevin Benton (Mirantis)
Products: Neutron
Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1
Description:
Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls. All Neutron setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-27: |  |  | [#18](/neutron/%2Bbug/1489111/comments/18) |
| --- | --- | --- | --- |

CVE have been requested.

@neutron-coresec, please review proposed patch.

CVE have been requested.
@neutron-coresec, please review proposed patch.

| Changed in ossa: | |
| --- | --- |
| **status**: | Triaged → In Progress |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-08-27

| **summary**: | IP, MAC, and DHCP spoofing rules can by bypassed by changing- device\_owner+ device\_owner (CVE-2015-5240) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-08-28:  [**Re: IP, MAC, and DHCP spoofing rules can by bypassed by changing device\_owner (CVE-2015-5240)**](/neutron/%2Bbug/1489111/comments/19) |  |  | [#19](/neutron/%2Bbug/1489111/comments/19) |
| --- | --- | --- | --- |

I verified the patch fixes the security issue. I ran several tests trying to find other the way to exploit the same issue, for instance by re-using system created network ports. Nova does not allow one to boot instances on such ports as nova will return a 409 when attempting to boot on a port with an already-populated device\_owner attribute.

The patch is also resilient to white space padding (eg: " network:" is accepted but won't cause the port\_security\_enabled attribute go to False).

I have minor observations on the code changes:

- the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however.

- Having to prepend ~ to say it's a regex is fine by me. Alternatively one could treat everything as a regex, adding automatically ^ and $ for doing exact matches. But then you'll have to document that regex evaluation will always match on the whole string.

On the CVE it is worth probably stating that as far as we know only affects the ML2 plugin. The logic where the vulnerability is introduced is specific indeed to that plugin. Other plugins might be affected too if they adopted similar logic for determining whether spoofing protections should be installed, but I think it's up to the plugin maintainers to verify that and fix if necessary.

Summarizing: the patch looks good to me, and there's no need of further revisions.

I verified the patch fixes the security issue. I ran several tests trying to find other the way to exploit the same issue, for instance by re-using system created network ports. Nova does not allow one to boot instances on such ports as nova will return a 409 when attempting to boot on a port with an already-populated device\_owner attribute.
The patch is also resilient to white space padding (eg: " network:" is accepted but won't cause the port\_security\_enabled attribute go to False).
I have minor observations on the code changes:
- the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however.
- Having to prepend ~ to say it's a regex is fine by me. Alternatively one could treat everything as a regex, adding automatically ^ and $ for doing exact matches. But then you'll have to document that regex evaluation will always match on the whole string.
On the CVE it is worth probably stating that as far as we know only affects the ML2 plugin. The logic where the vulnerability is introduced is specific indeed to that plugin. Other plugins might be affected too if they adopted similar logic for determining whether spoofing protections should be installed, but I think it's up to the plugin maintainers to verify that and fix if necessary.
Summarizing: the patch looks good to me, and there's no need of further revisions.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-28: |  |  | [#20](/neutron/%2Bbug/1489111/comments/20) |
| --- | --- | --- | --- |

Thanks Salvatore for this prompt review.

About the description, since we only support plugins within the neutron code base, the affects can also be reduced to:

"All Neutron setups using the ML2 plugin"

I'd like to send the advance notification today with this disclosure date/time:

2015-09-03, 1500UTC

Though ?

Thanks Salvatore for this prompt review.
About the description, since we only support plugins within the neutron code base, the affects can also be reduced to:
"All Neutron setups using the ML2 plugin"
I'd like to send the advance notification today with this disclosure date/time:
2015-09-03, 1500UTC
Though ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-28: |  |  | [#21](/neutron/%2Bbug/1489111/comments/21) |
| --- | --- | --- | --- |

"All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API"

Any plugins that have agents calling this method will be affected:

<https://github.com/openstack/neutron/blob/4f802232771d051d0fe076e6458674a995c6bc14/neutron/api/rpc/handlers/securitygroups_rpc.py#L79-L84>

"All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API"
Any plugins that have agents calling this method will be affected:
https://github.com/openstack/neutron/blob/4f802232771d051d0fe076e6458674a995c6bc14/neutron/api/rpc/handlers/securitygroups\_rpc.py#L79-L84

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-28: |  |  | [#22](/neutron/%2Bbug/1489111/comments/22) |
| --- | --- | --- | --- |

pre-OSSA sent with last suggestion from Kevin. Thanks everyone :-)

pre-OSSA sent with last suggestion from Kevin. Thanks everyone :-)

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#23](/neutron/%2Bbug/1489111/comments/23) |
| --- | --- | --- | --- |

There is a mistake in the patches, sending updated versions shortly.

There is a mistake in the patches, sending updated versions shortly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#24](/neutron/%2Bbug/1489111/comments/24) |
| --- | --- | --- | --- |

That's unfortunate. Should we send updated patches to the downstream stakeholders and extend the disclosure date?

That's unfortunate. Should we send updated patches to the downstream stakeholders and extend the disclosure date?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#25](/neutron/%2Bbug/1489111/comments/25) |
| --- | --- | --- | --- |

Yes, we will need to send the updated patches. I'm not sure if the disclosure date needs to be adjusted.

Yes, we will need to send the updated patches. I'm not sure if the disclosure date needs to be adjusted.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#26](/neutron/%2Bbug/1489111/comments/26) |
| --- | --- | --- | --- |

difference between this and the previous version is 'rule:admin\_or\_network\_owner' instead of 'role:admin\_or\_network\_owner' in policy.json

difference between this and the previous version is 'rule:admin\_or\_network\_owner' instead of 'role:admin\_or\_network\_owner' in policy.json

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#27](/neutron/%2Bbug/1489111/comments/27) |
| --- | --- | --- | --- |

* [master patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455837/%2Bfiles/devowner_patch.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455837)
  (7.4 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#28](/neutron/%2Bbug/1489111/comments/28) |
| --- | --- | --- | --- |

* [kilo patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455838/%2Bfiles/devowner_patch_kilo.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455838)
  (7.5 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#29](/neutron/%2Bbug/1489111/comments/29) |
| --- | --- | --- | --- |

Ouch, well then we need to extend the disclosure date. If those new patch are approved by thursday it can be:

2015-09-08, 1500UTC

Ouch, well then we need to extend the disclosure date. If those new patch are approved by thursday it can be:
2015-09-08, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#30](/neutron/%2Bbug/1489111/comments/30) |
| --- | --- | --- | --- |

* [juno patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455839/%2Bfiles/devowner_patch_juno.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455839)
  (6.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-09-01: |  |  | [#31](/neutron/%2Bbug/1489111/comments/31) |
| --- | --- | --- | --- |

I verified the updated patches with Kevin.

I think this explains why I was observing the weird behaviour noted in the review with:

"the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however."

Basically the typo was causing the policy engine to enforce a different kind of check (which always failed afaict). If we merged that patch we would have fixed the security issue, but introduced a functional defect.

The difference between the two patches is minimal, so there's not much else to review.

I verified the updated patches with Kevin.
I think this explains why I was observing the weird behaviour noted in the review with:
"the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however."
Basically the typo was causing the policy engine to enforce a different kind of check (which always failed afaict). If we merged that patch we would have fixed the security issue, but introduced a functional defect.
The difference between the two patches is minimal, so there's not much else to review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#32](/neutron/%2Bbug/1489111/comments/32) |
| --- | --- | --- | --- |

The new patch have been sent, please do not push them until the new disclosure date:

2015-09-08, 1500UTC

The new patch have been sent, please do not push them until the new disclosure date:
2015-09-08, 1500UTC

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-09-08

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to neutron (master)**](/neutron/%2Bbug/1489111/comments/33) |  |  | [#33](/neutron/%2Bbug/1489111/comments/33) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/221342>

Fix proposed to branch: master
Review: https://review.openstack.org/221342

| Changed in neutron: | |
| --- | --- |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to neutron (stable/kilo)**](/neutron/%2Bbug/1489111/comments/34) |  |  | [#34](/neutron/%2Bbug/1489111/comments/34) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/221344>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/221344

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to neutron (stable/juno)**](/neutron/%2Bbug/1489111/comments/35) |  |  | [#35](/neutron/%2Bbug/1489111/comments/35) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/juno

Review: <https://review.openstack.org/221345>

Fix proposed to branch: stable/juno
Review: https://review.openstack.org/221345

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-09-08

| **summary**: | - IP, MAC, and DHCP spoofing rules can by bypassed by changing- device\_owner (CVE-2015-5240)+ [OSSA 2015-018] IP, MAC, and DHCP spoofing rules can by bypassed by+ changing device\_owner (CVE-2015-5240) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix merged to neutron (master)**](/neutron/%2Bbug/1489111/comments/36) |  |  | [#36](/neutron/%2Bbug/1489111/comments/36) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/221342>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=bbca973986fdc99eae9d1b2545e8246c0b2be2e2>

Submitter: Jenkins

Branch: master

commit bbca973986fdc99eae9d1b2545e8246c0b2be2e2

Author: Kevin Benton <email address hidden>

Date: Tue Aug 25 22:03:27 2015 -0700

Stop device\_owner from being set to 'network:\*'

This patch adjusts the FieldCheck class in the policy engine to

    allow a regex rule. It then leverages that to prevent users from

    setting the device\_owner field to anything that starts with

    'network:' on networks which they do not own.

This policy adjustment is necessary because any ports with a

    device\_owner that starts with 'network:' will not have any security

    group rules applied because it is assumed they are trusted network

    devices (e.g. router ports, DHCP ports, etc). These security rules

    include the anti-spoofing protection for DHCP, IPv6 ICMP messages,

    and IP headers.

Without this policy adjustment, tenants can abuse this trust when

    connected to a shared network with other tenants by setting their

    VM port's device\_owner field to 'network:<anything>' and hijack other

    tenants' traffic via DHCP spoofing or MAC/IP spoofing.

Closes-Bug: #1489111

    Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

Reviewed: https://review.openstack.org/221342
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=bbca973986fdc99eae9d1b2545e8246c0b2be2e2
Submitter: Jenkins
Branch: master
commit bbca973986fdc99eae9d1b2545e8246c0b2be2e2
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-09:  [**Fix merged to neutron (stable/juno)**](/neutron/%2Bbug/1489111/comments/37) |  |  | [#37](/neutron/%2Bbug/1489111/comments/37) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/221345>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=ebb0c5403b347ae1a841f578971ed1a3e3b6de53>

Submitter: Jenkins

Branch: stable/juno

commit ebb0c5403b347ae1a841f578971ed1a3e3b6de53

Author: Kevin Benton <email address hidden>

Date: Tue Aug 25 22:03:27 2015 -0700

Stop device\_owner from being set to 'network:\*'

This patch adjusts the FieldCheck class in the policy engine to

    allow a regex rule. It then leverages that to prevent users from

    setting the device\_owner field to anything that starts with

    'network:' on networks which they do not own.

This policy adjustment is necessary because any ports with a

    device\_owner that starts with 'network:' will not have any security

    group rules applied because it is assumed they are trusted network

    devices (e.g. router ports, DHCP ports, etc). These security rules

    include the anti-spoofing protection for DHCP, IPv6 ICMP messages,

    and IP headers.

Without this policy adjustment, tenants can abuse this trust when

    connected to a shared network with other tenants by setting their

    VM port's device\_owner field to 'network:<anything>' and hijack other

    tenants' traffic via DHCP spoofing or MAC/IP spoofing.

Conflicts:

     etc/policy.json

     neutron/api/v2/attributes.py

     neutron/tests/etc/policy.json

     neutron/tests/unit/test\_policy.py

Closes-Bug: #1489111

    Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

    (cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

Reviewed: https://review.openstack.org/221345
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=ebb0c5403b347ae1a841f578971ed1a3e3b6de53
Submitter: Jenkins
Branch: stable/juno
commit ebb0c5403b347ae1a841f578971ed1a3e3b6de53
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Conflicts:
etc/policy.json
neutron/api/v2/attributes.py
neutron/tests/etc/policy.json
neutron/tests/unit/test\_policy.py
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9
(cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

| **tags**: | added: in-stable-juno |
| --- | --- |
| **tags**: | added: in-stable-kilo |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-09:  [**Fix merged to neutron (stable/kilo)**](/neutron/%2Bbug/1489111/comments/38) |  |  | [#38](/neutron/%2Bbug/1489111/comments/38) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/221344>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=767cea23de44a963c6793ffe30ea5c6827d27a38>

Submitter: Jenkins

Branch: stable/kilo

commit 767cea23de44a963c6793ffe30ea5c6827d27a38

Author: Kevin Benton <email address hidden>

Date: Tue Aug 25 22:03:27 2015 -0700

Stop device\_owner from being set to 'network:\*'

This patch adjusts the FieldCheck class in the policy engine to

    allow a regex rule. It then leverages that to prevent users from

    setting the device\_owner field to anything that starts with

    'network:' on networks which they do not own.

This policy adjustment is necessary because any ports with a

    device\_owner that starts with 'network:' will not have any security

    group rules applied because it is assumed they are trusted network

    devices (e.g. router ports, DHCP ports, etc). These security rules

    include the anti-spoofing protection for DHCP, IPv6 ICMP messages,

    and IP headers.

Without this policy adjustment, tenants can abuse this trust when

    connected to a shared network with other tenants by setting their

    VM port's device\_owner field to 'network:<anything>' and hijack other

    tenants' traffic via DHCP spoofing or MAC/IP spoofing.

Closes-Bug: #1489111

    Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

    (cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

Reviewed: https://review.openstack.org/221344
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=767cea23de44a963c6793ffe30ea5c6827d27a38
Submitter: Jenkins
Branch: stable/kilo
commit 767cea23de44a963c6793ffe30ea5c6827d27a38
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9
(cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-09-14

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-16:  [**Fix proposed to neutron (feature/pecan)**](/neutron/%2Bbug/1489111/comments/39) |  |  | [#39](/neutron/%2Bbug/1489111/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/224334>

Fix proposed to branch: feature/pecan
Review: https://review.openstack.org/224334

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-17: |  |  | [#40](/neutron/%2Bbug/1489111/comments/40) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/224357>

Fix proposed to branch: feature/pecan
Review: https://review.openstack.org/224357

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-17:  [**Fix merged to neutron (feature/pecan)**](/neutron/%2Bbug/1489111/comments/41) |  |  | [#41](/neutron/%2Bbug/1489111/comments/41) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1489111/comments/41/%2Bdownload) (73.6 KiB)

Reviewed: <https://review.openstack.org/224357>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=fdc3431ccd219accf6a795079d9b67b8656eed8e>

Submitter: Jenkins

Branch: feature/pecan

commit fe236bdaadb949661a0bfb9b62ddbe432b4cf5f1

Author: Miguel Angel Ajo <email address hidden>

Date: Thu Sep 3 15:40:12 2015 +0200

No network devices on network attached qos policies

Network devices, like internal router legs, or dhcp ports

    should not be affected by bandwidth limiting rules.

This patch disables application of network attached policies

    to network/neutron owned ports.

Closes-bug: #1486039

    DocImpact

Change-Id: I75d80227f1e6c4b3f5fa7762b8dc3b0c0f1abd46

commit db4a06f7caa20a4c7879b58b20e95b223ed8eeaf

Author: Ken'ichi Ohmichi <email address hidden>

Date: Wed Sep 16 10:04:32 2015 +0000

Use tempest-lib's token\_client

Now tempest-lib provides token\_client modules as library and the

    interface is stable. So neutron repogitory doesn't need to contain

    these modules.

    This patch makes neutron use tempest-lib's token\_client and removes

    the own modules for the maintenance.

Change-Id: Ieff7eb003f6e8257d83368dbc80e332aa66a156c

commit 78aed58edbe6eb8a71339c7add491fe9de9a0546

Author: Jakub Libosvar <email address hidden>

Date: Thu Aug 13 09:08:20 2015 +0000

Fix establishing UDP connection

Previously, in establish\_connection() for UDP protocol data were sent

    but never read on peer socket. That lead to successful read on peer side

    if this connection was filtered. Having constant testing string masked

    this issue as we can't distinguish to which test of connectivity data

    belong.

This patch makes unique data string per test\_connectivity() and

    also makes establish\_connection() to create an ASSURED entry in

    conntrack table. Finally, in last test after firewall filter was

    removed, connection is re-established in order to avoid troubles with

    terminated processes or TCP continuing sending packets which weren't

    successfully delivered.

Closes-Bug: 1478847

    Change-Id: I2920d587d8df8d96dc1c752c28f48ba495f3cf0f

commit e6292fcdd6262434a7b713ad8802db6bc8a6d3dc

Author: YAMAMOTO Takashi <email address hidden>

Date: Wed Sep 16 13:20:51 2015 +0900

ovsdb: Fix a few docstring

Change-Id: I53e1e21655b28fe5da60e58aeeb7cbbd103ae014

commit c22949a4449d96a67caa616290cf76b67b182917

Author: fumihiko kakuma <email address hidden>

Date: Wed Sep 16 11:52:59 2015 +0900

Remove requirements.txt for the ofagent mechanism driver

It is no longer used.

Related-Blueprint: core-vendor-decomposition

    [https://blueprints.launchpad.net/neutron/+spec/core-vendor-decomposition](https://blueprints.launchpad.net/neutron/%2Bspec/core-vendor-decomposition)

Change-Id: Ib31fb3febf8968e50d86dd66e1e6e1ea2313f8ac

commit d1d4de19d85f961d388c91e70f31b3bafec418c5

Author: Kevin Benton <email address hidden>

Date: Thu Sep 3 20:25:57 2015 -0700

Always return iterables in L3 get\_candidates

The caller of this function expects iterables.

Closes-Bug: #1494996

    Change-Id: I3d103e63f4e127a77268502415c0ddb0d804b54a

commit 1ad6ac448067306...

Reviewed: https://review.openstack.org/224357
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=fdc3431ccd219accf6a795079d9b67b8656eed8e
Submitter: Jenkins
Branch: feature/pecan
commit fe236bdaadb949661a0bfb9b62ddbe432b4cf5f1
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Thu Sep 3 15:40:12 2015 +0200
No network devices on network attached qos policies
Network devices, like internal router legs, or dhcp ports
should not be affected by bandwidth limiting rules.
This patch disables application of network attached policies
to network/neutron owned ports.
Closes-bug: #1486039
DocImpact
Change-Id: I75d80227f1e6c4b3f5fa7762b8dc3b0c0f1abd46
commit db4a06f7caa20a4c7879b58b20e95b223ed8eeaf
Author: Ken'ichi Ohmichi <ken-oomichi@wx.jp.nec.com>
Date: Wed Sep 16 10:04:32 2015 +0000
Use tempest-lib's token\_client
Now tempest-lib provides token\_client modules as library and the
interface is stable. So neutron repogitory doesn't need to contain
these modules.
This patch makes neutron use tempest-lib's token\_client and removes
the own modules for the maintenance.
Change-Id: Ieff7eb003f6e8257d83368dbc80e332aa66a156c
commit 78aed58edbe6eb8a71339c7add491fe9de9a0546
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Thu Aug 13 09:08:20 2015 +0000
Fix establishing UDP connection
Previously, in establish\_connection() for UDP protocol data were sent
but never read on peer socket. That lead to successful read on peer side
if this connection was filtered. Having constant testing string masked
this issue as we can't distinguish to which test of connectivity data
belong.
This patch makes unique data string per test\_connectivity() and
also makes establish\_connection() to create an ASSURED entry in
conntrack table. Finally, in last test after firewall filter was
removed, connection is re-established in order to avoid troubles with
terminated processes or TCP continuing sending packets which weren't
successfully delivered.
Closes-Bug: 1478847
Change-Id: I2920d587d8df8d96dc1c752c28f48ba495f3cf0f
commit e6292fcdd6262434a7b713ad8802db6bc8a6d3dc
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Wed Sep 16 13:20:51 2015 +0900
ovsdb: Fix a few docstring
Change-Id: I53e1e21655b28fe5da60e58aeeb7cbbd103ae014
commit c22949a4449d96a67caa616290cf76b67b182917
Author: fumihiko kakuma <kakuma@valinux.co.jp>
Date: Wed Sep 16 11:52:59 2015 +0900
Remove requirements.txt for the ofagent mechanism driver
It is no longer used.
Related-Blueprint: core-vendor-decomposition
https://blueprints.launchpad.net/neutron/+spec/core-vendor-decomposition
Change-Id: Ib31fb3febf8968e50d86dd66e1e6e1ea2313f8ac
commit d1d4de19d85f961d388c91e70f31b3bafec418c5
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Sep 3 20:25:57 2015 -0700
Always return iterables in L3 get\_candidates
The caller of this function expects iterables.
Closes-Bug: #1494996
Change-Id: I3d103e63f4e127a77268502415c0ddb0d804b54a
commit 1ad6ac448067306fcf7ea562840e63fd257f0556
Author: Sudhakar Babu Gariganti <sudhakar-babu.gariganti@hp.com>
Date: Fri Sep 11 14:53:27 2015 +0530
Prevent full sync in dhcp\_agent when possible
If an exception occurs in sync\_state method, we try for a full sync
even in the case where we have fewer networks to resync for.
This turns out to be pretty costly in scaled environments.
This patch addresses the above behavior by resyncing only for the
eariler set of failed networks.
Closes-Bug: #1495592
Change-Id: I069e992b3b7814370d409236b6a3c81a25829cc1
commit 1b94f3f3d9c84a20f46000c0801eeb8bad84a6fb
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed Jul 15 10:46:35 2015 +0000
Add QoS fullstack test
Test the qos policy and rule CRUD lifecycle with port. Future plans are
to add similar testing with ports belonging to network with set qos
policy.
Change-Id: Iebe9b3e9d612d3533381a8cf4d0b9c587f8fda42
commit cc698b2ba578e5bc1475f6229bfebd1316c41ffb
Author: Moshe Levi <moshele@mellanox.com>
Date: Mon Aug 10 12:25:59 2015 +0300
QoS agent extension and driver refactoring
Moved some code common to all drivers into base
qos driver abstract class, so related bugfixes go all in one
place and we simplify the logic for every qos drivers.
Port/Policy mapping moved out to a separate class.
Support delete per rule\_type or delete all rules.
Related-bug: #1486039
Co-Authored-By: Miguel Angel Ajo <mangelajo@redhat.com>
Partially-Implements: blueprint ml2-qos
Change-Id: Ia9d8638b9268b5aa8512cbb9d001413751f82649
commit 17765114292217d109c15b220be57fea6c9eed4a
Author: sridhargaddam <sridhar.gaddam@enovance.com>
Date: Tue Jul 14 16:18:06 2015 +0000
Add IPv6 Address Resolution protection
Similar to IPv4 arp protection support, this patch adds the necessary OVS
rules to prevent ports attached to agent from sending any icmpv6 neighbor
advertisement messages that contain an IPv6 address not belonging to the port.
For details please refer to "Figure 3. Attack against IPv6 Address Resolution"
http://www.cisco.com/web/about/security/intelligence/ipv6\_first\_hop.html
DocImpact
SecurityImpact
Closes-Bug: #1491690
Change-Id: I1f8311f1b9ae1be02afde3e9078e49c6da373a88
commit 53c64ff1ac3e92fa1cb8945cfae26b2624f2697d
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Tue Sep 15 11:52:03 2015 +0000
Revert "AsyncProcess: try to kill tender"
This change introduced bug 1495937.
This reverts commit 470a7d8a106a274e06fb1311c6738f333a98f59c.
Change-Id: I84fea4fdac71141da335ccd9e0d4c9d6174dfd86
commit 25e4e13565690fc4bc9e08e34598e18f04b921b7
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon Aug 24 22:24:10 2015 +0200
Remove out-of-tree vendor AGENT\_TYPE\_\* constant
AGENT\_TYPE\_\* constants[1] defines all agent types BUT the only vendor
one(AGENT\_TYPE\_NEC) is only used in out-of-tree networking-nec repo.
This changes removes out-of-tree AGENT\_TYPE\_NEC constant (dependant
change defines it in networking-nec repo).
[1] in neutron.extensions.portbindings
Change-Id: Ia80c33ee7970cfe167c2c9ca6d512f23561455a2
Closes-Bug: #1487598
Depends-On: I955fa48ee2120900e422bab57db250303c3d7bb4
commit f4a76a7a26c0902d61f4fe61091e7fe556923592
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Mon Sep 14 14:54:34 2015 +0000
func: Don't use private method of AsyncProcess
In functional test we simulate crash of AsyncProcess by calling
\_kill\_process(). This method is a private method and such usage
introduced a race where process was respawned prior to calling wait() of
killed process, leading to infinite wait on newly spawned process.
This patch adds manual send of kill and then active waiting for process
to be respawned, similarly like done with recent keepalived patch [1].
[1] https://review.openstack.org/#/c/222460/7/neutron/tests/functional/agent/linux/test\_keepalived.py
Closes-Bug: #1477860
Change-Id: I1c91393304d65a0695311416ecc5b64fd549b192
commit a13f5afcc821e24e40227965491b964fa85c003c
Author: lzklibj <lzklibj@cn.ibm.com>
Date: Fri Sep 11 02:37:47 2015 +0800
Remove unused ovs\_lib method reset\_bridge
Per [1] we are using a better way to keep tunnel connectivity,
so reset\_bridge isn't used anymore. Bug in [2] was caused by
using method reset\_bridge which will delete and recreate bridge.
For [1] makes method reset\_bridge deprecated, it makes sense to
remove this method, and make [2] no longer produce.
[1] https://review.openstack.org/#/c/182920
[2] Related-bug: #1332450
Change-Id: I155f66a37b8d4081126467fe576e8315c2d5560c
commit 573c14659a953164ba556c694062e9242dcca807
Author: Brian Haley <brian.haley@hp.com>
Date: Mon Sep 14 16:12:18 2015 -0400
Fix TypeError caused by delete\_agent\_gateway\_port()
A recent change used a keyword argument when it didn't need to,
correct it to fix the multinode DVR job.
End of typical traceback:
File "/opt/stack/new/neutron/neutron/api/rpc/handlers/l3\_rpc.py",
in delete\_agent\_gateway\_port(admin\_ctx, network\_id, host\_id=host)
TypeError: delete\_floatingip\_agent\_gateway\_port() got multiple
values for keyword argument 'host\_id'
Introduced in commit 639f1893dde0d393a97b29ca5309dba716831a7
Related-bug: #1495147
Change-Id: Id2522bc843bc7b089b7783d3f765900a50a0033f
commit b01f2f08257f5156084ac3e2644e79f220b15b6d
Author: Kyle Mestery <mestery@mestery.com>
Date: Thu Sep 10 15:46:04 2015 +0000
sub\_project\_guidelines: Add richer documentation
Add additional documentation around releasing sub-projects.
Change-Id: I71f31b6b8ed085066491e181074b467435f8d66d
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit bfebc9f8af05b5d4a5dcd2c2b0d521fe2fefa265
Author: Ryan Moats <rmoats@us.ibm.com>
Date: Mon Sep 14 11:29:28 2015 -0500
Fix typo: Large Ops, not Large Opts
Change-Id: I73e64e19275f002fcc2ae2e903611835bfd98f8a
Signed-off-by: Ryan Moats <rmoats@us.ibm.com>
commit 5eaff5fa0720b860ec4c0c75abee942313f93e94
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Mon Sep 14 17:29:22 2015 +0300
Fix query in get\_l3\_agent\_with\_min\_routers
For PostgreSQL if you're using GROUP BY everything in the SELECT
list must be an aggregate count(...) or used in the GROUP BY.
Closes-bug: #1495523
Change-Id: Ieb75d0666ec2f6d2e61686bf2bacea2b9ad6c521
commit a8d0586fdebfd28e407e2d30f72c92e3711d0a1e
Author: Ilya Shakhat <ishakhat@mirantis.com>
Date: Mon Sep 14 15:43:05 2015 +0300
Do not specify host for l2population topics
When creating topics oslo.messaging automatically creates
topic with hostname suffix (e.g. topic.hostname), there's
no need to do this explicitly.
Change-Id: Ia396452e8deb2c8f10bbead936245eeece8066a6
Closes-Bug: #1495508
commit 638d16c8a019cfdafa2b6bb12c95775544bb58df
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Sep 3 10:01:40 2015 -0700
Add utility function for checking trusted port
Ports that have a device\_owner that starts with 'network:'
are trusted in several places throughout the codebase. Each
of these did a startswith check on each field and it's not
immediately obvious why it's done.
This patch adds a utility function called 'is\_port\_trusted'
that performs the same check and makes it obvious what is
being done.
Change-Id: I542c753776d5cfb2fd736b25ea6e111867c89c89
commit 691fae47a4e7468884cb58692ecaf48b9737dae1
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Mon Sep 14 09:19:14 2015 +0000
Fix typo in error message in NetcatTester
Change-Id: Ie00901b1dab6c0c5ad4ec0f0c437426afc60396e
commit a466531aec4cb02469d12756c0151deb59dd4d13
Author: Saju Madhavan <sajuptpm@gmail.com>
Date: Mon Sep 14 14:03:28 2015 +0530
docstring fix
Change-Id: I35e44872c3dc7508d5991dc967bbceb22d6bea51
commit 470a7d8a106a274e06fb1311c6738f333a98f59c
Author: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
Date: Fri Sep 11 19:01:20 2015 +0900
AsyncProcess: try to kill tender
\_kill\_process kills processes with SIGKILL, which prevents the
processes' cleanup from running. Issue SIGTERM first and wait a bit.
Change-Id: Ie7b94011bbd11b1d672c95e3be19bb3c84ef77ec
Closes-bug: 1494363
commit a57b37fc56ffe3c1dade796c4663e95b1bbeea80
Author: Hong Hui Xiao <xiaohhui@cn.ibm.com>
Date: Thu Sep 10 06:38:01 2015 -0400
Enable servicing lbaasV2 vip by DVR
Currently, the vip of lbaasV2 will not have l3 network with DVR.
This prevent the usercase of lbaasV2 + DVR. This patch aims to
enable servicing lbaasv2 vip by DVR.
Change-Id: I1b51550437994fbe78d4db904641d4d9fb75d82e
Closes-Bug: #1493809
commit e5f635ee4fd1fe8a0bd2e5c58db068b51fc94c0b
Author: armando-migliaccio <armamig@gmail.com>
Date: Fri Sep 11 02:32:42 2015 -0700
Switch scheduler drivers to load based schedulers
Cloud deployed at scale most likely will use these scheduler
drivers because they allow a fairer resource allocation compared
to chance schedulers (which randomly place resources on the hosts).
Because of their importance, it's only wise to test them in
the gate on a continuous basis, so that we do not get surprised
by accidental regressions.
Rather than pushing this down through devstack-gate/project-config
patches, this chance alters the default of the scheduler
drivers, so that users can also pick these up out of the box.
This means that after an upgrade they would observe a change in
the scheduling behavior, if they relied on the default config.
DocImpact
UpgradeImpact
Closes-bug: #1494667
Change-Id: I5927914cb88eff66bc7a045340ff68cb8da95ad6
commit dafa61bd46b7eacbc708d17a3fa492de971d6dd2
Author: armando-migliaccio <armamig@gmail.com>
Date: Sat Sep 12 12:07:35 2015 -0700
Fix BadRequest error on add\_router\_interface for DVR
This operation for DVR is made of multiple steps, some of
which are not within the same DB transaction. For this
reason, if a failure occurs, the rollback will be partial.
This inconsistent state leads the retry logic to fail with
BadRequest, because the router is believed to be already
connected to the subnet.
To fix this condition, it is necessary to delete the port
should the DB deadlock occur.
Closes-bug: #1494114
Change-Id: Ia2a73d6f9d1e4746e761ad072d954e64267a3ad1
commit 57b6a651a39099ea76178bdcea51b06bde587e25
Author: Sergey Vilgelm <sergey@vilgelm.info>
Date: Sat Sep 12 21:55:01 2015 +0300
Fix missing value types for log message
This patch add missing value types for some log message of exception.
Change-Id: Ie9f512bc804f0cd70df991b1910c975a2f9d6fcf
Closes-Bug: #1494574
commit 5405d9742b94f203389f555c56727a66925e9454
Author: armando-migliaccio <armamig@gmail.com>
Date: Thu Sep 10 21:54:33 2015 -0700
Tweak test\_keepalived\_respawns test logic
This test initial design is problematic: it spawns keepalived,
it asserts the process is up, then it attempts to kill it.
However, this is when problems may arise:
a) it does so by using the disable method on the process - we
should be more rude than that if we want to simulate a crash!
b) keepalived may be forking while it is starting and it is
possible that for a moment the ppid changes and the process
owner invoking the kill has no rights to kill the spawned
process. This is the most plausible explaination I could find
as to why kill returns 1 with no standard error
c) it does not verify that the process has indeed disappeared
(what if the pm.disable didn't work?) - this means that the
test can pass, and yet the monitor may not work.
Bottom line: this test relied on the correctness of the very code
that was meant to validate...and that's not cool. To this aim, we
wait for the process to be active, kill the process with a kill -9
and verify that the process after the kill is indeed different.
Closes-bug: #1490043
Change-Id: Idaf419a1464d9d0d75b9106a7acd5cd960a7c623
commit 3c9482eb78b8a1e459ea9876a3b9a977690fce0d
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Aug 28 08:55:42 2015 -0700
Reservations: Don't count usage if resource is unlimited
If a resource is unlimited (ie: limit<0) then there is no need
to verify headroom for it. This also means that there no need for
counting it; therefore it is possible to save some DB operations
by skipping the count phase.
Change-Id: Ibe9ca8a1c29fb8ba12df187c25f8f9515968a54d
Related-blueprint: better-quotas
commit 14ef151fe0ca193c341098fcd3910d5e523c140c
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Aug 25 02:28:08 2015 -0700
Restore reservations in API controller
This patch restores the reservation logic in the API controller,
as the DB issues arising from the pymysql switch has been solved.
Change-Id: I98b40925fdceba13d6a2b5a4d0c5793aeb5cf077
Related-Bug: #1486134
Related-Blueprint: better-quotas
commit a19e64c9d95781982d28113c667dbc90d0ea11eb
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Sep 11 14:46:51 2015 -0400
ovs: don't use ARP responder for IPv6 addresses
ARP does not support IPv6 addresses, so when we try to apply the flow, it
fails, with all other flows deferred for the same transaction. It results in
random flow breakages, depending on the order of the bad flow in the
transaction.
Change-Id: I0ecf167653e5a7d0916e091e05050406a026a1e2
Co-Authored-By: Thomas Carroll <Thomas.Carroll@pnnl.gov>
Closes-Bug: #1477253
commit 6ee4343c4ce90423ea6477216519bcb0ef21b816
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Sep 11 16:32:06 2015 +0200
Install sriov-agent.ini on 'setup.py install'
The previous change [1] that split the configuration file into two pieces
missed the update of setup.cfg, so the file was not installed.
[1]: Ie1eda925e051f85d53ad9624d6617d095cf8c7be
Change-Id: Idcdc71b5614463fc0d81a8bc2d2833159be9e6c9
Related-Bug: #1489060
commit c89a4fdd88b0f8832b32af55f64e0d3a35c84388
Author: sridhargaddam <sridhar.gaddam@enovance.com>
Date: Thu Sep 10 16:14:13 2015 +0000
Configure gw\_iface for RAs only in Master HA Router
For an HA Router which does not have any IPv6 subnets in the external network
and when ipv6\_gateway is not set, Neutron configures the gateway interface of
the router to receive Router Advts for default route. In an HA router, only
the Master instance has the IP addresses while the Backup instance does not
have any addresses (including LLA). In Kernel version 3.10, when the last
IPv6 address is removed from the interface, IPv6 proc entries corresponding
to the iface are also deleted. This is however reverted in the later versions
of kernel code.
This patch addresses this issue by configuring the proc entry only for the
Master HA Router instance instead of doing it un-conditionally.
Closes-Bug: #1494336
Change-Id: Ibf8e0ff64cda00314f8fa649ef5019c95c2d6004
commit fb8014294530ac83f209a79612c09c897d80227f
Author: Ryan Moats <rmoats@us.ibm.com>
Date: Fri Sep 11 07:41:38 2015 -0500
Remove useless log from periodic\_sync\_routers\_task
Logging that peridoic\_sync\_routers\_task is starting with fullsync
False just adds noise to devstack logs. Reposition the log
statement to indicate that the task is starting if it is going
to be doing real processing.
Change-Id: I73def1e20218b01c135769d0b8fbce449dad17ea
Signed-off-by: Ryan Moats <rmoats@us.ibm.com>
commit 0f44a874b421e7dc055f409cffddbe52ca96b956
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Thu Sep 10 13:48:46 2015 -0700
Replace is\_this\_snat\_host validation with internal function
There is already a function to validate if it is an snat
host or not. So just use that function instead of additional
validation.
Change-Id: I004d94d1d4b632880ed289ccdc9bf45cffc0e095
commit bcafe20a14048b90d1f3153dad6076e42bf571f5
Author: Assaf Muller <amuller@redhat.com>
Date: Thu Jun 11 17:13:44 2015 -0400
Add l2pop support to full stack tests
Add the l2pop mechanism driver to the ML2 plugin configuration, and set
l2\_population = True, in the OVS agent configuration.
Each test class can enable or disable l2pop in its environment.
Change-Id: If4f2bf07883b763073b5a53f1aa557acb131d176
commit a885c4075ad983b8d68c4843359fa3578c48b575
Author: Assaf Muller <amuller@redhat.com>
Date: Tue Jun 16 08:56:41 2015 -0400
Add tunneling support to full stack tests
\* EnvironmentDescription class now accepts 'network\_type'.
It sets the ML2 segmentation type, passes it to the OVS agents
configuration files, and sets up the host configuration. If
tunnelling type is selected, it sets up a veth pair with an IP
address from the 240.0.0.1+ range. The addressed end of
this pair is configured as the local\_ip for tunneling purposes
in each of the OVS agents. If network type is not tunnelled, it
sets up provider bridges instead and interconnects them.
\* For now we run the basic L3 HA test with VLANs and tunneling just
so we have something to show for.
\* I started using scenarios in fullstack tests to run the same test
with VLANs or tunneling, and because test names are used for log
dirs, and testscenarios changes test names to include characters
that are not shell friendly (Space, parenthesis), I 'sanitized'
some of those characters.
Change-Id: Ic45cc27396452111678cf85ab26b07275846ce44
commit 590ed69918efabc173144f170f2ea5ff0d445a78
Author: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
Date: Thu Sep 10 17:24:47 2015 +0900
Remove an unused DVR function
is\_dvr\_router\_interface isn't used since commit
c5fafcb30a5b86e87309ad4650f7d05a2ca038dc.
Change-Id: Id902e7b4aafcf61f8da29bf7ab543559ea6b7937
commit 29ac69ebe365b597ad5d1510381d3f02643edb3e
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Sep 10 10:51:10 2015 +0300
Handle ObjectDeletedError when deleting network ports/subnets
It appeared there is still a race on port deletion when deleting
networks. So commit a55e10cfd6369533f0cc22edd6611c9549b8f1b4
introduced a regression. It's a bit of ironic that commit message
was "Avoid DB errors when deleting network's ports and subnets".
Shame on me!
Closes-Bug: #1494157
Change-Id: I37727eca5d68e6440f0f93e0f6bbe63b2f18b443
commit d5a8074ec3c67ed68e64a96827da990f1c34e10f
Author: Stephen Ma <stephen.ma@hp.com>
Date: Fri Aug 28 14:00:48 2015 +0000
Descheduling DVR routers when ports are unbound from VM
When a VM is deleted, the DVR port used by the VM could be unbound
from the compute node. When it is unbounded, it is no longer
in use on the node. Currently the unbind doesn't trigger a check
to determine whether the DVR router can be unscheduled from the
L3-agent running on the compute node. This patch makes the check
and unschedule the router, if necessary.
Closes-Bug: 1489184
Change-Id: I882e0682bfc7695b3b23e36eb4d7e35a5d19748e
commit 81dd69caddced348ed26d7a732dc93c9bd10b953
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Sep 10 00:06:08 2015 +0000
Updated from global requirements
Change-Id: I78f123c8e49b6dcd23bda1def9e021df74ffb0ea
commit 4a8c2b875e4abb8e99d62f1530f209147faada2f
Author: ajmiller <al.miller@ajmiller.net>
Date: Wed Sep 9 14:38:41 2015 -0700
Reduce the chance of random check/gate test failures
As previously implemented, the TestTrackedResource class is designed
to inject random failures into the gate. It generates random numbers
within the range of 0..10000, and will fail if it generates duplicate
random numbers during its run.
This patch creates UUIDs instead of random numbers, and makes the
chance of an collision vanishingly small.
Change-Id: I0cf535d1c5a3995a50b506aafce10e983872dcb7
Closes-bug: #1494021
commit 9b7ff6d3bd4059699c54180aca02e11d5fe07f21
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Mon Aug 31 21:31:57 2015 +0000
Allow passing arbitrary ip route parameters to add/delete\_route
There are arguments to ip route like scope and dev that will need to
be passed to add\_route and delete\_route. This patch allows them to be
passed using kwargs.
Change-Id: I06d46bee9ca333c6a308d1af961bd9eadab9db97
Partially-Implements: blueprint address-scopes
commit 46e59d312a46d96860fc1226ec6024d10ef2b1e0
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Tue Sep 1 16:58:22 2015 +0000
Make ip address optional to add\_route and delete\_route
The add\_route and delete\_route methods require that the ip (actually
"via" in ip route terms) be passed. Some routes don't require this.
This patch makes it optional while maintaining the position for those
callers who do pass it by position.
Change-Id: Ic16408c00c77898d8f7663c92e56aa30427469f3
Partially-Implements: blueprint address-scopes
commit da4ee8c8d26880b6b1a20d18f5cbd38e7d5e4b04
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Fri Aug 28 21:28:39 2015 +0000
Add list routes
This adds list routes while refactoring list\_onlink\_routes to share
implementation. It changes test\_onlink\_routes to be consistent in the
type of data that it returns with the new list\_routes.
Change-Id: I386a8e2cb146385bb59a7a8387a29dddbec48d8a
Partially-Implements: blueprint address-scopes
commit 24fa37e05544316b58357b753360b147878e5d94
Author: lzklibj <lzklibj@cn.ibm.com>
Date: Mon Mar 2 02:13:41 2015 -0800
Fix dvr update for subnet attach multi subnets
Fix method dvr\_update\_router\_addvm to notify every
router attached to subnet where the vm will boot
on.
In dvr case, when a subnet only attaches to one router,
the subnet will only have one distributed router interface,
which device\_owner is "network:router\_interface\_distributed".
So in this case, get\_ports in this method will only get
one port, and it should be unnecessary to break in for loop.
But when a subnet attaches multiple routers, get\_ports in
this method will return all distributed router interfaces
and the routers hold those interfaces should be notified
when an instance booted on the subnet. So it should also
be unnecessary to break in for loop.
Change-Id: I3a5808e5b6e8b78abd1a5b924395844507da0764
Closes-Bug: #1427122
Co-Authored-By: Ryan Moats <rmoats@us.ibm.com>
commit 7bd30aa49c24dc65332740e4fa74da28533b92ed
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Fri Aug 28 21:19:40 2015 +0000
Make ip rule comparison more robust
I found that ip rules would be added multiple times in new address
scopes code because the \_exists method was unable to reliably
determine if the rule already existed. This commit improves this by
more robustly canonicalizing what it reads from the ip rule command so
that like rules always compare the same.
Change-Id: I6d0c208f0ed8e65cdb750789321a7ad6ca1b77c2
Partially-Implements: blueprint address-scopes
commit ce5761f15388888038f9c39da886cd0343b734fc
Author: Andrey Kurilin <akurilin@mirantis.com>
Date: Wed Sep 9 16:48:59 2015 +0300
Remove hack for discovery novaclients extension
novaclient provides a common way to discover all extensions, so we can
remove import based on novaclient versioned client object.
Closes-Bug: #1493886
Change-Id: I7ae2eeb2d7e5c56e9284f3b059ff6e3545f42d5f
commit 91c476dcc5cd2192d0c43ca51a1b258b9c331fc4
Author: huangpengtao <huangpengtao@huawei.com>
Date: Sun Aug 30 10:43:50 2015 +0800
Check ICMP codes in range [0,255]
ICMP allows codes between 0 and 255, this change
adds a check for codes range min value.
DocImpact
APIImpact
Closes-Bug: #1486300
Change-Id: Ic7a49458448fad16447b914bb15742515661a851
commit cc9957c747b3caa84ea52c7960d863e587ac66ac
Author: Carl Baldwin <carl.baldwin@hpe.com>
Date: Tue Sep 8 21:04:23 2015 +0000
Remove address scopes from supported extensions
This feature is not ready for prime time, but the cli code is
already landed and shipped.
In order to prevent users from getting mad about an uncooked feature,
let's disable it until it becomes more robust.
Tests must be disabled unconditionally because our CI API test framework
execute tests for 'all' extensions available.
Related-blueprint: address-scopes
Change-Id: I71dc333e210b1f4acf30569711b4442ed8a1dfc3
commit bbaa4abdd5500d30576d63b5a5eb1503363e2f67
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Wed Sep 9 14:32:36 2015 +0300
Add test to check that correct functions is used in expand/contract
This test will check that expand branch does not contain drop SQLAlchemy
operations and contract branch does not contain create/add SQLAlchemy
operations.
Partially-Implements: blueprint online-schema-migrations
Change-Id: Ifda31c0599651931c1a98f673f3b10e64538f18b
Related-bug: #1490767
commit bd07b74045d93c46483aa261b8686072d9b448e8
Author: Moshe Levi <moshele@mellanox.com>
Date: Tue Aug 25 15:50:09 2015 +0300
SR-IOV: devstack support for SR-IOV agent
Change-Id: Ia0649962bd0c68d9c99fd54cc84ce8dd67d792e8
commit 4d831a462e2510ab080be7abae49ca3cff056e61
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Sep 1 15:15:53 2015 +0300
Fix test\_external\_tables\_not\_changed
test\_external\_tables\_not\_changed was not
executed properly as new engine was created in env.py.
Related-bug: #1466704
Change-Id: If02415d7abd17024946f7aee8fb6abc374a7aefe
commit 37430d4bd096a04a0b3e23165ac244ac1f47a774
Author: Yi Zhao <zhaoyi@cmss.chinamobile.com>
Date: Thu Aug 27 15:24:21 2015 +0800
Delete gateway conntrack state when remove external gateway
This fixed the problem that a gateway ip conntrack state not cleared
when user clears a router external gateway.
Change-Id: I77f22d9504430259b01366e6296a99ba1cd6a046
Closes-Bug: #1488730
commit 319920303a22988e418a982eef60f67af321148b
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Sep 8 22:03:54 2015 +0000
Updated from global requirements
Change-Id: Ib9d2e669f3d6e68cced7cd6674ff23ff7642f997
commit 7ca5a26c982084ed0b4cf036917a64580da6385c
Author: Mike Bayer <mike\_mp@zzzcomputing.com>
Date: Fri Aug 14 14:44:28 2015 -0400
Add non-model index names to autogen exclude filters
The SQLAlchemy MySQL dialect generates implicit indexes
in the less-common case of an integer column within a composite
primary key where autoincrement is not set to False.
Add a rule to ignore these indexes when performing
autogenerate against a target database.
Change-Id: I49abb3f7ad9731cde046fa2862cdb9ec16c3aeb3
Partially-Implements: blueprint online-schema-migrations
commit 6576bea07c6c268b16e6c1f118b858e698452e2b
Author: Mike Bayer <mike\_mp@zzzcomputing.com>
Date: Mon Jul 20 18:34:15 2015 -0400
Implement expand/contract autogenerate extension
Makes use of new Alembic 0.8 features to allow
altering of the "alembic revision" stream such
that operations for expand and contract are
directed into separate branches.
Change-Id: Ifa743e2f5b90e59a8de8f4e7a67c4bbe46686804
Partially-Implements: blueprint online-schema-migrations
commit cd45f16442b7c56c4876bef527c9c83ea0907c40
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Mon Jun 22 17:17:15 2015 -0700
Cleanup the fip agent gateway port delete routines
Based on the parent patch, right now the Floatingip
agent gateway ports will only be deleted when the
last gateway port associated with the external
network is deleted.
The Floatingip agent gateway port will not be deleted
for every floatingip dis-association and deletion.
The Floatingip agent gateway port was created on all
nodes as a substitute for the gateway port. So it
makes sense to delete those ports only when the last
gateway port on the external network is deleted.
The agent should be able to delete the floatingip agent
gateway port on a given external network when it is not
required.
This would substantially reduce the burden on the server
to validate, read and delete the port form the DB.
Change-Id: Ie561b19a2e58a2a563d79b75421e9e24c70f36f9
Closes-Bug: #1468007
Closes-Bug: #1408855
Closes-Bug: #1450982
commit 639f1893dde0d393a97b29ca5309dba716831a7f
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Mon Jun 22 16:50:43 2015 -0700
Add RPC command and delete if last FIP on Agent
Today FloatingIP Agent gateway port is deleted and
re-created for DVR based routers based on floatingip
association and disassociation with VMs on compute
nodes by the plugin.
This introduces lot more strain on the plugin to
create and delete these ports when VMs come up and
get deleted that are associated with FloatingIps.
This patch will introduce an RPC call for the agent
to initiate a agent gateway port delete.
Also the agent will look for the last floatingip that
it manages, and if condition satisfies, the agent will
request the server to remove the FloatingIP Agent
Gateway port.
Change-Id: I47694b2ee60c363e2fe59ad5f7d168252da08a45
Related-Bug: #1468007
Related-Bug: #1408855
Related-Bug: #1450982
commit d5aa1659f56601d8f4d5e17273d5ade7a0e202dd
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Mon Jun 22 16:33:32 2015 -0700
Delete FIP agent gateway port with external gw port
FIP agent gateway ports are associated with external
networks and specific host.
Today FIP agent gateway ports are deleted for
every floatingip associate and disassociate. This
introduces race conditions in the port delete and also
un-necessary access to the db.
This patch will delete the FIP agent gateway port when
the last gateway port of the external network is deleted.
The child patch linked to this parent patch will clean
up the FIP agent gateway port delete when associate,
disassociate and delete of floatingip happens.
This should also cover the case when an agent for some
reason was unable to request agent gw port delete.
(agent died).
Related-Bug: #1408855
Related-Bug: #1468007
Related-Bug: #1450982
Change-Id: I6637a771e6a6ce74e848cb74b779043e16a54a84
commit b62b92da9b9dbba953573bc212279c719e08f3ef
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Sep 8 15:23:49 2015 +0000
Remove ebtables\_driver/manager dead code
Previous changes[1] have been merged as enablers[2] to fix the bug
1274034 but an alternative solution has been choosen and now we can
consider the introduced code as dead code.
This changes removes [2], associated tests and rootwrap filters.
[1] I9ef57a86b1a1c1fa4ba1a034c920f23cb40072c0
I3c66e92cbe8883dcad843ad243388def3a96dbe5
[2] neutron.agent.linux.ebtables\_driver
neutron.agent.linux.ebtables\_manager
Closes-Bug: #1493422
Related-Bug: #1274034
Change-Id: I61e38fc0d8cf8e79252aabc19a70240be57e4a32
commit bbca973986fdc99eae9d1b2545e8246c0b2be2e2
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9
commit c0ee8cbcbf98698411e3618b95b1d8c7676c76ad
Author: Assaf Muller <amuller@redhat.com>
Date: Tue Sep 8 10:48:11 2015 -0400
Add oslo rootwrap daemon logging during functional tests
Change-Id: Ie688a1df6e256c0195b8f3937228f65c0463e9c3
Closes-Bug: #1493396
commit d6d0853be34ce783b133a9c39aeb608033f3073b
Author: Aman Kumar <amank@hp.com>
Date: Tue Mar 17 03:41:54 2015 -0700
ovs agent resync may miss port remove event
In OVS Agent rpc\_loop() resync mechanism clears the registered ports and
rescans them again, and it might result in missing some "port removed"
event and treat\_devices\_removed will not be called.
This fix rescans the newly updated ports when resync mechanism called,
without clearing the current registered ports.
The registered ports will be cleared only if there are too many
consecutive resyncs to avoid resycing forever because of the same
faulty port.
Closes-Bug: #1329223
Co-Authored-By: Andrey Epifanov <aepifanov@mirantis.com>
Co-Authored-By: Gandharva S <gandharva.s@hp.com>
Co-Authored-By: Romil Gupta <romilg@hp.com>
Co-Authored-By: Rossella Sblendido <rsblendido@gmail.com>
Change-Id: Ib0db9dcf889d9fd90b623857782c9a6b091e18f5
commit 1b67012794932a06ce90976f9759fc588da269b5
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Sep 8 11:20:10 2015 +0200
tests: disable process monitor before managers
Otherwise the monitor may respawn managers later, leaving them running.
Issue spotted in:
http://logs.openstack.org/02/216902/4/check/gate-neutron-dsvm-functional/a97df90
Change-Id: I0e68b06c87b5770756fdf7b9201e1986cc67e07b
Related-Bug: #1490051
commit 4b2e6842f320405cd963f560bc06849b4b7bb1eb
Author: armando-migliaccio <armamig@gmail.com>
Date: Mon Sep 7 04:53:50 2015 -0700
Retry metadata request on connection refused error
This testcase may fail intermittently on 'Connection refused' error.
This could be due to the fact that the metadata proxy setup is not exactly
complete at the time the request is issued; in fact there is no
synchronization between the router being up and the metadata request being
issued, and clearly this may be the reason of accidental but seldom failures.
In order to rule out this possibility and stabilize the test, let's retry
on connection refused only. If we continue to fail, then the next step would
be to dump the content of iptables to figure out why the error occurs.
Closes-bug: #1461172
Change-Id: I65a5bf4fbbcad6ba93a46d36cabe7844ff528d8d
commit 9e178e42e46317a6f1ac7688340f0f84e4c16c80
Author: Sergey Belous <sbelous@mirantis.com>
Date: Thu Sep 3 16:53:21 2015 +0300
Add ability to use custom config in DHCP-agent
This patch doesn't changes behaviour of dhcp-agent
but adds the opportunity to use user-defined config,
that will make dhcp-agent more flexible
and allows to run functional tests correctly
(without changing global oslo.config CONF)
Closes-Bug: #1492283
Change-Id: Ice807e8fc872b56bb3960b7a3de4110c7675d9d6
commit 7da1724d446b6804c6be7a602532fbae58d9f008
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Aug 25 02:21:06 2015 -0700
Improve DB operations for quota reservation
This patch deals with the lock wait timeout and the deadlock errors
observed under high concurrency (api\_workers >= 4) with the pymysql
driver. It includes the following changes:
- Stop setting dirty status for resource usage when creating
reservation, as usage of reserved resources is not tracked anymore;
- Add a variable, increasing delay when retrying make\_reservation
upon a DBDeadlock error in order to reduce the chances of further
collisions;
- Enable transaction retry upon DBDeadlock errors for set\_quota\_usage;
- Do not resync quota usage while making reservation. This puts a lot
of stress on the database and is also wasteful since resource usage
is very likely to change again once the transaction is committed;
- Use autonested\_transaction to simplify logic around when the
nested flag should be used.
Change-Id: I7a335f9ebea3c0d6fee6e6b757554e045a66075c
Closes-Bug: #1486134
Related-Blueprint: better-quotas
commit 13901bdf6941d17069073f489798faaa86151fae
Author: Moshe Levi <moshele@mellanox.com>
Date: Tue Aug 18 08:48:24 2015 +0300
Qos SR-IOV: Refactor extension delete to get mac and pci slot
When calling delete we need the pci slot details to reset the VF rate. The problem
is that when the VM is deleted libvirt return the VF to the hypervisor and eswitch
manager will mark the pci\_slot as unassigned so can't know from the mac which pci slot (VF)
to reset. Also newer libvirt version reset the mac when deleteing VM, so than it is
not possible at all.
The solution is to keep pci slot details locally in the agent since upon removal event
you cannot get pci\_slot from the neutron server as it is for create/update since port
is already removed from neutron.
This patch pairs the mac and pci\_slot for a device (VF) so when calling the extension
port delete api we can have the pci\_slot and reset the VF rate.
It is also add a mapping between mac to port\_id so we can pass the port\_id
when calling the extention port delete api.
Partially-Implements: blueprint ml2-sriov-qos-with-bwlimiting
Closes-Bug: #1492909
Change-Id: Icc3a9599c6d7a4de9c56b452dfab7909c8d0a576
commit b89879c286cdc5718ee540c2c581a3f500c18b3e
Author: root <mamtaprabhu@in.ibm.com>
Date: Sat Sep 5 10:47:41 2015 -0700
Adds support to provide the csum option for the OVS tunnels
The new option for the ovs agent will enable to set/unset the
csum option for the vxlan/gre tunnels. The default is maintained as False.
Change-Id: I18dcd8946b585e70f8890a5c222ea37059c4a0c5
Implements: bp ovs-tunnel-csum-option
Closes-bug: #1492111
commit 597be0028952f57e6083a674d724978cd9fe599c
Author: huangpengtao <huangpengtao@huawei.com>
Date: Sun Sep 6 23:32:49 2015 +0800
Delete the useless variable agent\_host
Change-Id: I7fb9da4b4b5316ddbc93a89317ee57718da178d3
commit 42f80682d3eff58af60199f817ac402f457491a0
Author: Neil Jerram <Neil.Jerram@metaswitch.com>
Date: Sun Sep 6 01:09:16 2015 +0100
Handle process disappearing before we ask for its PPID
Change-Id: I573aba8e11dca16f8a6565f7e9704be18e938566
Closes-Bug: #1478190
commit 6d51ef5d2e275d0d260a592d3ab8ed8a76a63421
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Sep 3 16:31:33 2015 +0300
OVS agent: handle deleted ports on each rpc\_loop iteration
Currently rpc loop processes ports only in case polling is required
(message from ovsdb monitor) or there are port\_updated notifications from
server or security group notifications.
In case of just port\_deleted notifications port processing is not
triggered during rpc loop.
This may lead to agent accumulating a big amount of deleted ports
and processing all of them at once during next iteration when polling is
required or any notification from server, which might be quite tough for
the agent. Tough means agent will be irresponsive while processing deleted
ports.
The patch makes port deletion processing more gradual.
Closes-Bug: #1491922
Change-Id: I0e1f6dfbf5b56fb18a978d6214e1768560d8ac98
commit b61cd4eaedc3a65657d5dbf8b09ec3c39f250637
Author: Shweta P <shpadubi@cisco.com>
Date: Thu Aug 27 16:53:13 2015 -0400
Final decomposition of Cisco plugin
This patch follows the previous patch(listed as dependent) and moves
the remaining cisco db models from neutron to networking-cisco.
The patch deletes l3\_model and cisco\_router\_plugin and their associated
config and helper files from neutron
Change-Id: I5b71e1dfb683e633e1cd11386dfb7c2ed7cc7d62
Partial-Bug: #1489609
commit d12017ad511a202a12422245cce6204a5731250c
Author: Abhishek Raut <rauta@vmware.com>
Date: Mon Aug 10 20:52:15 2015 -0700
Remove Cisco Meta and N1KV monolithic plugins
This patch removes the Cisco meta plugin and the Cisco
Nexus1000V monolithic plugin as they were deprecated in the
previous cycle.
Closes-bug: #1473217
Change-Id: Id170b9512b2f52a971264336d83b083d487359ee
commit 065275e51ff3852462586d01f5d3dd750bf2d663
Author: Robert Collins <rbtcollins@hp.com>
Date: Sat Sep 5 16:04:42 2015 +1200
Workaround test stream corruption issue.
Change-Id: I4c88f1891f53c6559bca71bf657aa30df2101280
Closes-Bug: #1492505
commit ad9aaa63e5ea427d24c07e6a36a2976d83f1a26f
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 18:27:42 2015 -0700
Fix RBAC filter query for negative case
The query to find networks that aren't shared to the querier was
broken. It was querying for the inverse of RBAC entries that shared
to the querier, so it would return the network for each other tenant
it was shared to. This meant that if a network had multiple RBAC
entries, a shared=False filter wouldn't work in the API.
This patch corrects the behavior by adjusting the query that looks
for objects not shared to the caller to make sure the object ID doesn't
appear in the shared subquery.
This patch also adds a test that reliably reproduces the original issue.
The sporadically failing filter test that revealed this issue depended
on a race to have a network be shared to another tenant and to the wildcard
at the same time.
Change-Id: I9dcd869c1640b223221ba12e97284bbfcabbeb2b
Closes-Bug: #1495040
commit 1886964890e1ba9d13df43d0caeff1546f2090a9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Fri Sep 4 23:06:43 2015 +0000
Updated from global requirements
Change-Id: I6f3dbf989cb6d9d110c2ee6a3a2e2b557bced28f
commit ed3c317ed9182538747f74713154ad94e9d866db
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Sep 4 22:21:41 2015 +0200
Fixed functional test that validates graceful ovs agent restart
The async\_ping function returns a callable that returns True when all ping
futures are done. Since those futures are running for 10 secs, there was no
chance that the result of the callable was True.
The test was bailing out without calling bridge reset even a single time,
effectively leaving the feature untested in gate.
Another thing to note is that for some reason the patch fixed oslo rootwrap
errors in the test when executed locally. Since I still don't understand how
it's possible that it fixes the issue for me, I mark the bug as related only,
and will track logstash after it's merged to see whether it applies unknown
magic to gate jobs too.
Change-Id: Iaa977abddf1a0c6af7e964f1a5cd545ffb79585a
Related-Bug: #1490051
commit 1b25e30800c869dacca58afa6b8bf92f4cf9d377
Author: rossella <rsblendido@suse.com>
Date: Wed Aug 26 16:06:25 2015 +0000
\_bind\_devices query only existing ports
If a port is deleted right before \_bind\_devices is called,
get\_ports\_attributes will throw an exception since the row
corresponding to the port doesn't exist in the OVS DB.
Avoid that setting if\_exists to True. The port will be
processed as deleted by the agent in the following iteration.
Change-Id: Ia6590d76f8683e6cba562cde3c39b051549f6c04
Closes-bug: #1489014
commit a93886278f1308ae78c65b4ad36ee7648cad2914
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 05:33:46 2015 -0700
Stop logging deadlock tracebacks
The oslo db retry decorator logs a traceback everytime a deadlock
is encountered even though it is being retried. With multiple workers
and a Galera cluster, deadlocks are common occurences due to our use
of with\_lockmode update so we should not be polluting the logs.
This patch adjusts our usage of the retry decorator to catch deadlocks
with the exception checker which does not log them until the retries
are exhausted.
Change-Id: I433fbbad61070e20ebe934b9247e36fc190fa3e0
commit e959e474d65211991c12f9495b227da5e4d99ed7
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 04:22:35 2015 -0700
Don't log exceptions in GW update on router create
The LOG.exception statement is not necessary because the exception
is re-raised so if it's a real error it will be logged like any
other failure.
Related-Bug: #1494886
Change-Id: I29aacd8c1187ddf8653009865ed9a62be948c5a7
commit 9b66c82483ab70caf3e09d8dcf5cb8d4d4ecfd60
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 04:28:58 2015 -0700
Remove an unnecessary extension check for rbac
This removes some logic to detect the RBAC extension
that was written when RBAC was being developed as a
service plugin. Since it's part of db base plugin there
is nothing to enable in devstack so it's not necessary.
Change-Id: I37f8060c14d8ad74f5cea649c18ee9ef3912cb2d
commit da81ae88929c389f0ba8660c4c8dfb79eec7c0fd
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Sep 3 15:13:25 2015 +0300
OVS agent: flush firewall rules for all deleted ports at once
In some cases, under high load OVS agent has to delete a big amount of
ports during rpc\_loop. remove\_devices\_filter() does iptables-save/restore
for IPv4 and IPv6 which is 4 system calls. It is very expensive and
inefficient to call it for each port individually.
Closes-Bug: #1491922
Change-Id: I4cfb2dfcef5088436c7aaae22c8f66e1ea052311
commit ef409d9da2ecbf12f9916a9a933231146538cf04
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Sep 1 21:45:55 2015 +0200
Enable most unit tests for py34 job
\* Skip TestWSGIServerWithSSL[1] for Python 3 since it seems wsgi + ssl +
eventlet setup does not behave correctly now,
\* Skip test\_json\_with\_utf8[2] until we solve unicode/utf8 encode/decode,
\* Fix some more tests to pass for py3,
\* Replace print by print() in docs/docstrings.
[1] neutron.tests.unit.test\_wsgi (bug 1482633)
[2] neutron.tests.unit.test\_wsgi.JSONDictSerializerTest (bug 1491824)
Related-Bug: #1482633
Related-Bug: #1491824
Blueprint: neutron-python3
Co-Authored-By: Cyril Roelandt <cyril@redhat.com>
Co-Authored-By: Cedric Brandily <zzelle@gmail.com>
Co-Authored-By: sonu.kumar <sonu.kumar@nectechnologies.in>
Change-Id: I26e513d4dcf473f4cd79728382fc94af3d901b5d
commit cd524065e2ac4f48d8b9810fa9735f0fd925c4d8
Author: Tu Hong Jun <tuhongj@cn.ibm.com>
Date: Thu Aug 20 14:08:07 2015 +0800
Changed filter field to router\_id
The get\_sync\_interfaces query will always return all router ports
from database even it is supposed to query specific ones that
belong to a certain router. In large L3 scale environment with
number of route ports in place, this would lag the response time
for adding router interface and router L3 agent binding.
Closes-Bug: #1489671
Change-Id: Ib78ca766f91783ad2ecca5b728c31602b4ed15d8
commit 997aa86fa12e3209b65741ef95906d491895a493
Author: Sergey Vilgelm <sergey@vilgelm.info>
Date: Mon Aug 31 17:06:48 2015 +0300
Fix a wrong condition for the \_purge\_metering\_info function
Fix a situation for the \_purge\_metering\_info function
when the items will never be deleted from the metering\_info.
Delete the metering\_info dict and use the metering\_infos instead.
Fix the problem with changing a dictionary during iteration.
Add the unit tests for the \_purge\_metering\_info and
\_add\_metering\_info functions.
Co-Authored-By: Yaroslav Isakov <yisakov@mirantis.com>
Change-Id: I9031a5f27ae6438ffd5c5a48b0cf5cdc6867eff3
Closes-Bug: #1490581
commit 2d65cccba29220e46b490871210014b94f086984
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Sep 3 17:43:37 2015 -0700
Don't log deadlock or retry exceptions in L3 DB
We don't want to log exceptions in the l3 DB that will be retried
by the DB retry decorator because it will look like a failure in
the log when it actually ends up being retried.
Change-Id: I024fc2db9022809194178c227d994bc6ed33c78b
Closes-Bug: #1494886
commit f347939fd6c7b5a9e93af2007a0c01d00f29dc2b
Author: armando-migliaccio <armamig@gmail.com>
Date: Thu Sep 3 10:29:12 2015 -0700
Make sure service providers can be loaded correctly
This patch fixes a regression where, if neutron was loaded using
--config-dir, the service\_providers option was no longer available.
We bring the logic back (removed by 61121c5f2af), alongside the ability
to load the option auto-magically. This is especially required for DevStack
deployments as of today, because neutron-server is only loaded by passing
--config-file (...)neutron.conf and --config-file (...)ml2\_conf.ini
Change-Id: I9bfaed9e19a5506e27795a0b7ad47f4c31fefa40
Closes-bug: #1490990
commit 9c466f4d0effa4686ca6744d7b9d015857830cb7
Author: Roman Bogorodskiy <rbogorodskiy@mirantis.com>
Date: Wed Jun 24 14:40:35 2015 +0200
sriov: update port state even if ip link fails
Some SRIOV drivers/devices don't support link state setting,
meaning that 'ip link' fails like this when trying to set state:
# ip l set dev p2p1 vf 6 state disable
RTNETLINK answers: Operation not supported
The sriov-nic-agent tries to do that in
SriovNicSwitchAgent.treat\_device() and fails because of non-zero
exit status from 'ip link' and, therefore, doesn't reach the code
that updates the actual port status, so port could hang in a BUILD
state even if binding was successful.
This patch fixes problem of nova not being able to successfully bind
or cleanup such a port. It does not fix a case when user manually
updates admin\_state\_up for a port via API, it's subject to a separate
fix.
Also, replace LOG.exception with LOG.warning for set\_device\_state()
as the exception would be logged by PciDeviceIPWrapper.set\_vf\_state()
anyway.
Closes-bug: #1468332
Change-Id: Ifa7c128d369ced60b5986aa0ed92527868f7efab
commit a97fd4dabb31019ac7926b4445cd8d8f319b1b6a
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Sep 2 17:23:56 2015 -0700
Retain logs for functional test cases
This helps greatly the debugging process in face of race conditions.
Change-Id: I74235307183cbb15a7179b18b417b38ffb1d2cc9
commit da1ac497d2d10d008925311e3f14e9750f7b86b2
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Sep 2 06:50:36 2015 -0700
Don't setup ARP protection on OVS for network ports
Skip adding ARP spoofing protection on OVS ports with a
device\_owner field starting with 'network:'. This is
already the case for the other iptables-based spoofing
protection and is necessary for floating IPs to function
correctly on router gateway ports.
Closes-Bug: #1487338
Change-Id: I32cef17ff47fd62e6db16b9083104f07239be25f
commit 051ff13771026b015c893a19a89654bf2ca4d018
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Sep 2 07:04:55 2015 -0700
Don't setup ARP protection on LB for network ports
Skip adding ARP spoofing protection on Linux bridge ports
with a device\_owner field starting with 'network:'. This is
already the case for the other iptables-based spoofing
protection and is necessary for floating IPs to function
correctly on router gateway ports.
Change-Id: If53733fb3060e5ab44bac5388f42bdc384bcdb93
Closes-Bug: #1483315
commit 9f6bd17703b7286be9e7d439d15f4dec2774e13a
Author: Terry Wilson <twilson@redhat.com>
Date: Mon Jun 15 22:52:28 2015 -0500
Add support for PluginWorker and Process creation notification
There are several cases where plugin initialization should be
handled after neutron-server forks API/RPC workers. For example,
starting a client connection to an SDN controller before forking
copies the fd of the socket to the child process, but then you have
multiple processes trying to read/write the same socket connection.
It is also useful for a plugin to be able to do something in only
one process, regardless of how many workers are forked. One example
would be handling syncing from an external system to the neutron
database.
This patch does 3 things:
1) Treats rpc\_workers=0 as = 1. This simplifies the code for
handling notification that forking has completed. In the
existing code, calling the notification in the Worker object's
start() method would happen twice in the case where both api
and rpc workers were 0, despite there being only one process.
An earlier patch already changed the default api\_workers to be
the number of processors.
2) Adds notification of forking via the callbacks mechanism.
Plugins can subscribe to resources.PROCESS, event.AFTER\_CREATE
and do any post-fork initialization that needs to be done for
every spawned process.
3) Adds core/service plugin calls to get\_workers() which defaults
to returning (). Plugins that need additional processes to spawn
should just return an iterable of NeutronWorkers that will be
spawned in their own process.
DocImpact
Closes-Bug: #1463129
Change-Id: Ib99954678c2b4f32f486b537979d446aafbea07b
commit bd734811753a99d61e30998c734e465a8d507b8f
Author: Nick <skywalker.nick@gmail.com>
Date: Sun Jul 19 22:41:27 2015 +0800
Implement external physical bridge mapping in linuxbridge
In some deployment scenario, it is not allowed to remove system
ethernet configuration from physical interface to newly-created
physical bridge by neutron due to some IT regulations.
End-users require to take advantage of the pre-existed(user-defined)
physical bridge to connect tap devices for neutron.
Closes-Bug: #1105488
Implements: blueprint phy-net-bridge-mapping
DocImpact
Change-Id: Ia0eaa6233d8da93da32e86404b15184b77937d0a
commit a55e10cfd6369533f0cc22edd6611c9549b8f1b4
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Wed Aug 12 20:02:01 2015 +0300
Avoid DB errors when deleting network's ports and subnets
DB errors may occur when accessing query results
after the transaction was closed (like ObjectDeletedError).
Hence it's better to avoid DB object access especially
when it's not needed.
This patch changes \_delete\_ports() and \_delete\_subnets() to accept
only ids. Indeed, there is no need to pass db objects to these methods.
Closes-Bug: #1484135
Related-Bug: #1454408
Change-Id: I7507cb1c85defb2e6d5144e5832aea713d6251ae
commit 8c3cb79aa54b0ffcdc840c7e95ab809835d05001
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Aug 27 22:12:48 2015 -0700
Better message on allowed address pairs error
Neutron was throwing a 500 error when a non-iterable was passed
into allowed address pairs. This patch just catches that and
converts it into a regular badrequest message.
Closes-Bug: #1477829
Change-Id: I3c6f55df4912c7a9480fa097988f910b254572fd
Signed-off-by: Kevin Benton <blak111@gmail.com>
commit cc20673d673113974c78a2b17a9ff4da47ad6665
Author: Assaf Muller <amuller@redhat.com>
Date: Sat Aug 29 11:32:19 2015 -0400
Add info to debug test\_keepalived\_respawns gate failure
Current theory is that there's a bug in external\_process.active,
it returns True when it shouldn't, then kill -15 on the process
pid fails because the process isn't up. Added ps -p output to
see if the process is up or not.
Change-Id: Ic062be829d5f05a1294f6b2fa54820422871ffcb
Related-Bug: #1490043
commit d02bcb9c3917028948b08c319d1443d487c36846
Author: Hirofumi Ichihara <ichihara.hirofumi@lab.ntt.co.jp>
Date: Tue Aug 25 09:10:00 2015 +0900
Enable to update external network subnet's gateway-ip
This patch enables users to update gateway\_ip of a subnet even if
the subnet is in use for an external network of a router.
Change-Id: I78d2b024c99b1af0001bd454465d2fc02692cbf2
Closes-Bug: #1317363
commit c43cc3eb20101b2d2b19344690fed9892383621b
Author: James Arendt <james.arendt@hp.com>
Date: Fri Aug 28 16:33:44 2015 -0700
Make Neutron service flavor save service\_type
While the service\_type exists in the resource attributes and as
a database field for a Flavor, the creation dictionary did not
pass the value so the service\_type was not being persisted
in the database nor returned.
Enhanced unit test to show problem. Test fails on old code
to save or return the input service\_type.
Change-Id: I4dba287f5972ecebd193d65e7f542dd0a65f055b
Closes-Bug: 1490063
commit db4ea4517886741c2bd3e15e39bee0ecbd1356ae
Author: James Arendt <james.arendt@hp.com>
Date: Wed Aug 26 16:53:24 2015 -0700
Add tenant\_id to flavor service profiles attributes
Neutron v2 base.py auto populates a 'tenant\_id' attribute on
calls if the attribute is not passed. This causes a POST
to create a flavor service binding to fail when verifying
attributes with:
Unrecognized attribute(s) 'tenant\_id'
Solution is to add tenant\_id as expected attribute in the
attribute map as done in other sub resources like QOS.
Fix unit test for non-keystone case.
Change-Id: Ic2bd1271f297fc10b49304ffd5fe617637e3d8f4
Closes-Bug: 1489197
commit 9022fb1ae8f90df59c4da64450eb96de8c011715
Author: armando-migliaccio <armamig@gmail.com>
Date: Mon Jul 27 14:11:46 2015 -0700
Remove implicit registration of \*-aas service providers
Implicit registration can be dropped when explicit registration
for load balancer and vpn is implemented. Firewall does not
use service providers and the ServiceTypeManager, so the
precautionary step can be dropped altogether.
Support for configuring providers via the service\_providers section
in neutron.conf, is no longer available, hence clear the stale
entry points.
DocImpact
Closes-bug: #1473110
Change-Id: I5e1d254b9a3a24121d9e9d3cb82f877d44079296
commit 0a258afc7ee3c03974dffa2c0dd0b7b367034cc7
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Aug 28 00:50:59 2015 -0700
Process user iptables rules before INVALID
Process user-defined iptables rules before the INVALID DROP
rule. This is to allow scenarios where the VMs need to
legitimately receive packets that conntrack doesn't have an
entry for (e.g. SYN-ACK where the SYN wasn't sent by the VM).
A user can accomplish this by adding an allow rule that matches
the headers of these INVALID packets so they get permitted before
they hit the INVALID DROP rule.
Closes-Bug: #1460741
Change-Id: Ie6ce5f3fa688f1bf25b77db5955211922d9fe85b
commit b3e7e21c32a251ba0b7123aa909edeaedd08152a
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Mon Mar 2 16:40:11 2015 +0900
OVS-agent: Introduce Ryu based OpenFlow implementation
Introduce an alternative OpenFlow implementation, "native",
implemented using Ryu ofproto python library from Ryu SDN Framework.
Make it selectable with of\_driver=native agent option.
The aim is to replace the existing ovs-ofctl based implementation
eventually.
It introduces node-local OpenFlow controller embedded in
OVS agent. Benefits include:
\* Reduce the overhead of invoking ovs-ofctl command (and associated
rootwrap)
\* Make future uses of OpenFlow asynchronous messages (e.g. Packet-In,
Port-Status, etc) easier
\* Make XenAPI integration simpler
Highlights:
\* Switch to OpenFlow 1.3.
\* Make OVS-agent act as an OpenFlow controller
\* Configure OVS on the node to connect to the controller
DocImpact
Implements: blueprint ovs-ofctl-to-python
Co-Authored-by: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
Change-Id: I02e65ea7c6083b2c0a686fed2ab04da4d92b21a3
commit 5aab6a577950525d8f656d373f2e46a229fa600b
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Sep 1 19:35:33 2015 -0700
Deprecate external\_network\_bridge option in L3 agent
This option provides another way to attach to a specific bridge
that is not quite equivalent with how bridge\_mappings work in the
L2 agent. This creates inconsistencies between how the L3 agent
behaves when configured with a bridge\_mapping and provider properties
of the Neutron network vs. when it just ignores all L2 stuff and
plugs itself directly into the bridge.
See the bug report for more info.
Change-Id: I37de3cd6eaaf34856fa72753f471f4f0a9381836
Closes-Bug: #1491668
commit e10b008f7a2a1cb45ae5f77082f8d45b51274489
Author: salvatore <salv.orlando@gmail.com>
Date: Fri Aug 21 10:44:25 2015 +0200
Do not track active reservations
Reservations have a transient nature: a reservation lifespan
typically begins and ends with a single request.
Therefore tracking reserved amounts for each tenant and resource
is not nearly as efficient as tracking resource usage.
Indeed it is fairly easy to verify that the overhead for tracking
reserved amounts is much greater than the one needed for counting
active reservations for each tenant and resource.
This patch removes the logic for tracking reservations, and
replaces it with an explicit count of active reservations.
Please note that this patch does not adjust accordingly the
ResourceUsage DB model. This will be done in a separate patch with
an expand migration; this should avoid most merge conflicts before
the final patch for restoring reservation logic merges.
Related-Blueprint: better-quotas
Change-Id: Ib5e3bd61c1bc0fc8a5d612dae5c1740a8834a980
commit 8ba57a2bf1ce3693db47de4ff8dd5a7a9b5347d7
Author: Henry Gessau <gessau@cisco.com>
Date: Tue Sep 1 17:17:01 2015 -0400
Deprecate --service option for neutron-db-manage
Now that https://review.openstack.org/198542 has merged we can
deprecate the --service option. From now on instead of
--service fwaas
we should instead use
--subproject neutron-fwaas
This puts the \*aas subprojects on equal footing with the other
projects in the Neutron Stadium for neutron-db-manage.
In the Liberty release the --service option will be marked as
deprecated. It will be removed in Mitaka.
Related-Bug: #1470625
Change-Id: Iecc678efafd798b62bb83e6e85333c64760f16b5
commit c029954c8ae041e5f15b14ceef0e2aa060928e05
Author: Sachi King <nakato@nakato.io>
Date: Tue Sep 1 15:10:54 2015 +1000
Add constraint target to tox.ini
This adds a pip install command to tox.ini that is only used when the
tox env is passed with the 'constraints' factor appended onto it.
As such this will not effect developer workflows or current unit tests.
The initial use of this will be in a non-voting job, to verify that the
constrained checks with tox are stable. DevStack is already running
constrained jobs, as such problems are no expected.
To run a tox with pip using constraints on a developer system a
developer should run the desired tox environment with -constraints.
For example: $(tox -epy27-constraints)
Pip will pull the current version of the upper-constraints.txt file down
from the git.openstack.org, however this method can be overriden to use
a local file setting the environment variable "UPPER\_CONSTRAINTS\_FILE"
to the local path or a different URL, it is passed directly to pip.
This is currently not enabled in the default tox run, however it is
possible to enable it as a default by adding it to 'envlist' in tox.ini
Change-Id: I13579599dfdf846d06d8c39f33265e8b46db6e68
Depends-On: I17ac389f78af241917b6da7f049085f2b13d30f2
Implements Blueprint: Requirements-Management
commit f3f5940201a9e010c188f83aead7d93e7e8c9b6d
Author: Neil Jerram <Neil.Jerram@metaswitch.com>
Date: Mon Jul 27 14:41:29 2015 +0100
DHCP agent: allow using gateway IPs instead of uniquely allocated
In each place where the DHCP agent runs, and for each subnet for which
DHCP is handing out IP addresses, the DHCP port needs - at the Linux
level - to have an IP address within that subnet. Generally this
needs to be a unique Neutron-allocated IP address, because the
subnet's underlying L2 domain is bridged across multiple compute hosts
and network nodes, and for HA there may be multiple DHCP agents
running on that same bridged L2 domain.
However, if the DHCP ports - on multiple compute/network nodes but for
the same network - are \_not\_ bridged to each other, they do not need
each to have a unique IP address. Instead they can all share the same
address from the relevant subnet. This works, without creating any
ambiguity, because those ports are not all present on the same L2
domain, and because no data within the network is ever sent to that
address. (DHCP requests are broadcast, and it is the network's job to
ensure that such a broadcast will reach at least one of the available
DHCP servers. DHCP responses will be sent \_from\_ the DHCP port
address.)
Specifically, for some networking backends it makes sense to allow all
DHCP ports to use the subnet's gateway IP address, and thereby to
completely avoid any unique IP address allocation.
This change therefore enhances the DHCP agent code to be able to use
gateway IPs as an alternative to uniquely allocated ones, with the
choice between those being made by a new interface driver property,
'use\_gateway\_ips'. The back-compatible default is to use unique IPs.
An interface driver that wants the DHCP agent to use gateway IPs can
achieve that by overriding as follows:
@property
def use\_gateway\_ips(self):
return True
Partial-Bug: #1486649
Change-Id: I17e1dc9231a5ec35bd6f84c4c7aca6350d76e8ec
commit 3de01b39b74d0a23f765b1f9b1a4ba1eb457068c
Author: Stephen Ma <stephen.ma@hp.com>
Date: Thu Aug 27 04:50:14 2015 +0000
Resolve issue where router can't be removed from L3-agent in dvr mode
Fixes the problem where the L3 DVR Scheduler is unable
to remove a DVR router from a L3 agent running in
'dvr' mode.
Closes-bug: 1489091
Change-Id: Id128a81d2cf7108936715ee305012fbff23ffdbf
commit c5d182da588d8dcf107d22735eb37250362043c0
Author: rossella <rsblendido@suse.com>
Date: Thu Jul 23 19:41:20 2015 +0200
OVS agent add functional tests of OVS status
Add a functional tests to verify that the agent
behaves correctly when OVS restarted.
Partially-Implements: blueprint restructure-l2-agent
Change-Id: Ifeb0f2f6a06baead93df2c016ea26bfea990734d
commit 71dd3a0f87eb69072696f6905f8380924dd67c1a
Author: rossella <rsblendido@suse.com>
Date: Fri Jul 31 17:25:37 2015 +0000
check\_changed\_vlans doesn't need registered\_ports as param
check\_changed\_vlans doesn't need registered\_ports since the
ports processed by the agent are accessible from local\_vlan\_map
Partially-Implements: blueprint restructure-l2-agent
Change-Id: I279dcaff469337c553b358f6f5476c7238e89a59
commit 4ea6810d50c0d960c4640f0c12c6ec025449b64d
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Tue Sep 1 16:26:03 2015 +0900
test\_migrations: Remove unnecessary midonetclient mocks
These seem leftovers from plugin decomposition.
Change-Id: Ib05ebbbd6627a1b69c413761b0e5a8e53817d8f2
commit ed392dc5354131b377ebf6aea518fb8e2ca7f893
Author: Sergey Belous <sbelous@mirantis.com>
Date: Mon Aug 31 17:44:19 2015 +0300
Fixed filters for functional tests
Removed filter for unused tee utility.
CommandFilter for curl replaced with more stricted RegExpFilter
and now allow run curl only with specified parameters.
Change-Id: I5d151a63f85cb969f79d4d92f5422e8e88855be5
Closes-Bug: #1487139
commit 599977e20bd480305434168400055fa417aad8b1
Author: Lajos Katona <lajos.katona@ericsson.com>
Date: Tue Jul 7 15:04:35 2015 +0200
Fix locale problem in execute()
Change from new format string to old style formatting.
Change-Id: Ib39de7169416c2cc053d4aa909075c68cd2d7f0b
Closes-bug: #1449897
commit e77eac8611f8fbb333168dc344c0056acaebb8b5
Author: Edgar Magana <emagana@gmail.com>
Date: Sat Aug 29 08:00:17 2015 -0700
Improve python code for missing suggestion
Include a missing suggestion in code already merged
Related-Blueprint: better-quotas
Change-Id: I5983ccf6e2f98d2df41403b3be06748d5556c181
commit 34a329b4de7c801c15b3c214cc2b122ac82d0b72
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Tue Aug 25 16:24:05 2015 -0700
Add a functional test to validate dvr snat namespace
Add a functional test to validate the dvr snat
namespace and its internal interfaces when internal
networks are removed and added.
Change-Id: Id44f5e5899e959be53b09e6f9bc732f553ae9a5a
Related-Bug: #1479130
commit 3a9e778399af8380b11c968da39e08b4a97a9f1f
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Tue Aug 25 22:32:50 2015 +0000
Add snat ports cache to dvr router
This reverses the effect of [1] but in a way that works with the
current structure of the code and keeps DVR details in DVR classes
[1] https://review.openstack.org/#/c/200293
Change-Id: Ia8468881de6538882d4a14725b55db53e23d2e4c
Closes-Bug: #1479130
commit 72e388445eb6f6903ccfc5079aa206ac2cbcfd5e
Author: Sachi King <nakato@nakato.io>
Date: Mon Dec 8 17:42:48 2014 +1100
Return exception when attempting to add duplicate VIP
Neutron should never attempt to add a VIP to keepalived's config
multiple times, and to do so is an error. As such this adds an
exception if this is ever attempted.
Change-Id: If1c41c3164e8a998c73f9b7aa566e2ba6570f54b
Closes-Bug: #1400217

| **tags**: | added: in-feature-pecan |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-21:  [**Change abandoned on neutron (feature/pecan)**](/neutron/%2Bbug/1489111/comments/42) |  |  | [#42](/neutron/%2Bbug/1489111/comments/42) |
| --- | --- | --- | --- |

Change abandoned by Doug Wiegley (<email address hidden>) on branch: feature/pecan

Review: <https://review.openstack.org/224334>

Change abandoned by Doug Wiegley (dougwig@parkside.io) on branch: feature/pecan
Review: https://review.openstack.org/224334

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-09-24

| Changed in neutron: | |
| --- | --- |
| **milestone**: | none → liberty-rc1 |
| **status**: | Fix Committed → Fix Released |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-10-15

| Changed in neutron: | |
| --- | --- |
| **milestone**: | liberty-rc1 → 7.0.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-25: |  |  | [#43](/neutron/%2Bbug/1489111/comments/43) |
| --- | --- | --- | --- |

I won't be able to reproduce the problem on the Juno with steps in Bug Description. I am wondering whether there is any incorrect step. Can anyone help correct me? Thanks.

1) create a neutron security group

neutron security-group-create --description permissive unlocked11

neutron security-group-rule-create --protocol tcp --port-range-min 22 --port-range-max 22 --direction ingress unlocked11

neutron security-group-rule-create --protocol tcp --port-range-min 28 --port-range-max 50000 --direction egress unlocked11

neutron security-group-rule-create --protocol udp --port-range-min 1 --port-range-max 1000 --direction ingress unlocked11

2) create a port with security group created above

neutron port-create --security-group unlocked11 <network>

3) update port immediately after step 2)

watch neutron port-update <port uuid above> --device-owner network:hello

4) boot a vm

nova boot --key-name perry --nic port-id= <port uuid above> --flavor Standard --image <image> test

I found that if VM got ERROR with the following message.

{"message": "Build of instance f5b5090c-4141-44a8-8130-95692c5b1199 aborted: Failed to allocate the network(s), not rescheduling.", "code": 500, "details": " File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2079, in \_do\_build\_and\_run\_instance filter\_properties File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2213, in \_build\_and\_run\_instance reason=msg)

In addition, if I update the port device owner after several seconds after nova boot, the the VM's iptables looks consistent with port security group rules which is the same as normal VM without updating port. There is no any thing missed.

Thanks.

I won't be able to reproduce the problem on the Juno with steps in Bug Description. I am wondering whether there is any incorrect step. Can anyone help correct me? Thanks.
1) create a neutron security group
neutron security-group-create --description permissive unlocked11
neutron security-group-rule-create --protocol tcp --port-range-min 22 --port-range-max 22 --direction ingress unlocked11
neutron security-group-rule-create --protocol tcp --port-range-min 28 --port-range-max 50000 --direction egress unlocked11
neutron security-group-rule-create --protocol udp --port-range-min 1 --port-range-max 1000 --direction ingress unlocked11
2) create a port with security group created above
neutron port-create --security-group unlocked11 <network>
3) update port immediately after step 2)
watch neutron port-update <port uuid above> --device-owner network:hello
4) boot a vm
nova boot --key-name perry --nic port-id= <port uuid above> --flavor Standard --image <image> test
I found that if VM got ERROR with the following message.
{"message": "Build of instance f5b5090c-4141-44a8-8130-95692c5b1199 aborted: Failed to allocate the network(s), not rescheduling.", "code": 500, "details": " File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2079, in \_do\_build\_and\_run\_instance filter\_properties File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2213, in \_build\_and\_run\_instance reason=msg)
In addition, if I update the port device owner after several seconds after nova boot, the the VM's iptables looks consistent with port security group rules which is the same as normal VM without updating port. There is no any thing missed.
Thanks.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-25: |  |  | [#44](/neutron/%2Bbug/1489111/comments/44) |
| --- | --- | --- | --- |

Hi Perry, just a quick check, are you using 2014.2.4 ? Or make sure you don't have the fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) in order to reproduce that bug...

Hi Perry, just a quick check, are you using 2014.2.4 ? Or make sure you don't have the fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) in order to reproduce that bug...

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-26: |  |  | [#45](/neutron/%2Bbug/1489111/comments/45) |
| --- | --- | --- | --- |

Hi Tristan, thanks for your reply. I double checked servers and there is no such fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) applied. The code base is 2014.2.2.

Hi Tristan, thanks for your reply. I double checked servers and there is no such fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) applied. The code base is 2014.2.2.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-11-26: |  |  | [#46](/neutron/%2Bbug/1489111/comments/46) |
| --- | --- | --- | --- |

Can you see why the nova instance failed to build? It may be easier to create the port, start the update loop and then attach it to a running VM.

Can you see why the nova instance failed to build? It may be easier to create the port, start the update loop and then attach it to a running VM.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-27: |  |  | [#47](/neutron/%2Bbug/1489111/comments/47) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1489111/comments/47/%2Bdownload) (5.1 KiB)

Hi Kevin,

compute log:

2015-11-27 03:17:29.480 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Instance failed to spawn

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2310, in \_build\_resources

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] yield resources

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info, disk\_info=disk\_info)

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 4485, in \_create\_domain\_and\_network

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] raise exception.VirtualInterfaceCreateException()

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] VirtualInterfaceCreateException: Virtual Interface creation failed

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20]

2015-11-27 03:17:29.490 6812 AUDIT nova.compute.manager [req-4de7d5b4-69c9-4e62-971c-c67ff32f418c None] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Terminating instance

2015-11-27 03:17:29.512 6812 WARNING nova.virt.libvirt.driver [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] During wait destroy, instance disappeared.

2015-11-27 03:17:29.880 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Failed to allocate network(s)

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager ...

[Read more...](/neutron/%2Bbug/1489111/comments/47)

Hi Kevin,
compute log:
2015-11-27 03:17:29.480 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Instance failed to spawn
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2310, in \_build\_resources
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] yield resources
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info, disk\_info=disk\_info)
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 4485, in \_create\_domain\_and\_network
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] raise exception.VirtualInterfaceCreateException()
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] VirtualInterfaceCreateException: Virtual Interface creation failed
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20]
2015-11-27 03:17:29.490 6812 AUDIT nova.compute.manager [req-4de7d5b4-69c9-4e62-971c-c67ff32f418c None] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Terminating instance
2015-11-27 03:17:29.512 6812 WARNING nova.virt.libvirt.driver [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] During wait destroy, instance disappeared.
2015-11-27 03:17:29.880 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Failed to allocate network(s)
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info, disk\_info=disk\_info)
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 4485, in \_create\_domain\_and\_network
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] raise exception.VirtualInterfaceCreateException()
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] VirtualInterfaceCreateException: Virtual Interface creation failed
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20]
2015-11-27 03:17:29.895 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Build of instance 0b98dcb2-d343-4350-b65a-6615a8c45a20 aborted: Failed to allocate the network(s), not rescheduling.
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2073, in \_do\_build\_and\_run\_instance
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] filter\_properties)
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2207, in \_build\_and\_run\_instance
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] reason=msg)
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] BuildAbortException: Build of instance 0b98dcb2-d343-4350-b65a-6615a8c45a20 aborted: Failed to allocate the network(s), not rescheduling

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-27: |  |  | [#48](/neutron/%2Bbug/1489111/comments/48) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1489111/comments/48/%2Bdownload) (3.2 KiB)

Looks my problem can be workarounded by <https://ask.openstack.org/en/question/57342/spawning-new-instances-fails-to-allocate-the-network/>. After updating vif\_plugging\_timeout=0 and vif\_plugging\_is\_fatal=False, the VM could be created with steps (loop to update port) and able to ping and I observed that there is nothing related to that corresponding VM in compute node iptables. I also observed some error during vm's rebooting which looks separate problem.

ci-info: +-------+--------------+--------------+---------------+-----------+-------+

2015-11-27 06:34:02,362 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [3/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:05,363 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [6/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:09,366 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [10/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:12,367 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [13/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:13,370 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [14/15s]: request error [[Errno 115] Operation now in progress]

2015-11-27 06:34:14,371 - DataSourceEc2.py[CRITICAL]: Giving up on md from ['[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27)] after 15 seconds

2015-11-27 06:34:14,371 - util.py[WARNING]: No instance datasource found! Likely bad things to come!

Starting cloud-init: Can not apply stage config, no datasource found! Likely bad things to come!

------------------------------------------------------------

Traceback (most recent call last):

  File "/usr/bin/cloud-init", line 315, in main\_modules

    init.fetch()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch

    return self.\_get\_data\_source()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source

    pkg\_list)

  File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source

    raise DataSourceNotFoundException(msg)

DataSourceNotFoundException: Did not find any data source, searched classes: ()

------------------------------------------------------------

Starting cloud-init: Can not apply stage final, no datasource found! Likely bad things to come!

------------------------------------------------------------

Traceback (most recent call last):

  File "/usr/bin/cloud-init", line 315, in main\_modules

    init.fetch()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch

    return self.\_get\_data\_source()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source

    pkg\_list)

  File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source

    raise DataSourceNotFoundException(msg)

DataSourceNotFoundException: Did not find any data source, searched classes: ()

---------------------...

[Read more...](/neutron/%2Bbug/1489111/comments/48)

Looks my problem can be workarounded by https://ask.openstack.org/en/question/57342/spawning-new-instances-fails-to-allocate-the-network/. After updating vif\_plugging\_timeout=0 and vif\_plugging\_is\_fatal=False, the VM could be created with steps (loop to update port) and able to ping and I observed that there is nothing related to that corresponding VM in compute node iptables. I also observed some error during vm's rebooting which looks separate problem.
ci-info: +-------+--------------+--------------+---------------+-----------+-------+
2015-11-27 06:34:02,362 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [3/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:05,363 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [6/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:09,366 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [10/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:12,367 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [13/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:13,370 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [14/15s]: request error [[Errno 115] Operation now in progress]
2015-11-27 06:34:14,371 - DataSourceEc2.py[CRITICAL]: Giving up on md from ['http://169.254.169.254/2009-04-04/meta-data/instance-id'] after 15 seconds
2015-11-27 06:34:14,371 - util.py[WARNING]: No instance datasource found! Likely bad things to come!
Starting cloud-init: Can not apply stage config, no datasource found! Likely bad things to come!
------------------------------------------------------------
Traceback (most recent call last):
File "/usr/bin/cloud-init", line 315, in main\_modules
init.fetch()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch
return self.\_get\_data\_source()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source
pkg\_list)
File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source
raise DataSourceNotFoundException(msg)
DataSourceNotFoundException: Did not find any data source, searched classes: ()
------------------------------------------------------------
Starting cloud-init: Can not apply stage final, no datasource found! Likely bad things to come!
------------------------------------------------------------
Traceback (most recent call last):
File "/usr/bin/cloud-init", line 315, in main\_modules
init.fetch()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch
return self.\_get\_data\_source()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source
pkg\_list)
File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source
raise DataSourceNotFoundException(msg)
DataSourceNotFoundException: Did not find any data source, searched classes: ()
------------------------------------------------------------

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hao Jun Wang (shhjwang)](https://launchpad.net/~shhjwang) wrote on 2016-02-03: |  |  | [#50](/neutron/%2Bbug/1489111/comments/50) |
| --- | --- | --- | --- |

I am using Liberty and the patch has been installed. I can ping and ssh with the default security group in devstack through the reproduce steps. I think maybe it should not be permitted. Or there are some incorrect steps. Can anyone help me? Thanks very much.

I am using "demo" user.

My steps:

(1) neutron port-create <net-id> --name port1

(2) watch neutron port-update port1 --device-owner network:hello

step one and two are in one script.

(3) nova boot test --nic port-id=<port-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec

I can see that instance test is active. I can ping and ssh it.

"neutron port-show port1" indicates that the "device\_owner" is "network:hello" and "port\_security\_enabled" is "True"

I have set "vif\_plugging\_timeout=0" and "vif\_plugging\_is\_fatal=False" in nova.conf to ensure that instance can be successfully booted.

The created port id is c05720c0-0259-441c-8c48-f650a4b01202

And I found the following lines in "ip addr".

32: qbrc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc noqueue state UP group default

33: qvoc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master ovs-system state UP

34: qvbc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02

35: tapc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02 state

But when I just execute the command "nova boot test2 --nic net-id=<net-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec",

I cannot ping or ssh the instance "test2".

I am using Liberty and the patch has been installed. I can ping and ssh with the default security group in devstack through the reproduce steps. I think maybe it should not be permitted. Or there are some incorrect steps. Can anyone help me? Thanks very much.
I am using "demo" user.
My steps:
(1) neutron port-create <net-id> --name port1
(2) watch neutron port-update port1 --device-owner network:hello
step one and two are in one script.
(3) nova boot test --nic port-id=<port-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec
I can see that instance test is active. I can ping and ssh it.
"neutron port-show port1" indicates that the "device\_owner" is "network:hello" and "port\_security\_enabled" is "True"
I have set "vif\_plugging\_timeout=0" and "vif\_plugging\_is\_fatal=False" in nova.conf to ensure that instance can be successfully booted.
The created port id is c05720c0-0259-441c-8c48-f650a4b01202
And I found the following lines in "ip addr".
32: qbrc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc noqueue state UP group default
33: qvoc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master ovs-system state UP
34: qvbc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02
35: tapc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02 state
But when I just execute the command "nova boot test2 --nic net-id=<net-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec",
I cannot ping or ssh the instance "test2".

[See full activity log](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/neutron/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

## Duplicates of this bug

* [Bug #1417791](https://bugs.launchpad.net/neutron/%2Bbug/1417791 "Neutron allows non-admin user to circumvent port security via port-update device_owner")

You are
[not directly subscribed to this bug's notifications.](/neutron/%2Bbug/1489111/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [master patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455837/%2Bfiles/devowner_patch.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455837 "Change patch details")
* [kilo patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455838/%2Bfiles/devowner_patch_kilo.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455838 "Change patch details")
* [juno patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455839/%2Bfiles/devowner_patch_juno.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455839 "Change patch details")

* [Add patch](/neutron/%2Bbug/1489111/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.redhat.com_1257f4e0_20250126_030155.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from launchpad.net_358978c3_20250126_030142.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6535](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |
| --- | --- |
| [kolla-ansible](/kolla-ansible) |  |
| [kolla](/kolla) |  |
| [kayobe](/kayobe) |  |
| [OpenStack Compute (nova)](/nova) |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_e19b7cf1_20250126_030153.html ===

[Log in / Register](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* [Answers](https://answers.launchpad.net/neutron)

# [OSSA 2015-018] IP, MAC, and DHCP spoofing rules can by bypassed by changing device\_owner (CVE-2015-5240)

Bug #1489111 reported by
[Kevin Benton](https://launchpad.net/~kevinbenton)
on 2015-08-26

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |
|  | [neutron](https://bugs.launchpad.net/neutron) | Fix Released | Undecided | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | [neutron 7.0.0 "liberty"](https://launchpad.net/neutron/%2Bmilestone/7.0.0) |
|  | [Juno](https://bugs.launchpad.net/neutron/juno) | Fix Released | Undecided | Unassigned | [neutron 2014.2.4](https://launchpad.net/neutron/%2Bmilestone/2014.2.4) |

### Bug Description

The anti-IP spoofing rules, anti-MAC spoofing rules, and anti-DHCP spoofing rules can be bypassed by changing the device\_owner field of a compute node's port to something that starts with 'network:'.

Steps to reproduce:

Create a port on the target network:

neutron port-create some\_network

Start a repeated update of the device\_owner field to immediately change it back after nova sets it to 'compute:<whatever>' on VM attachment. (This has to be done quickly because the owner has to be set to 'network:something' before the L2 agent wires up the security group rules.)

watch neutron port-update <port-uuid-from-above> --device-owner network:hello

Then boot the VM with the port UUID:

nova boot test --nic port-id=<port-uuid-from-above> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec

This VM will now have no iptables rules applied because it will be treated as a network owned port (e.g. router interface, DHCP interface, etc).

See [original description](comments/0)

Tags:

[in-feature-pecan](/neutron/%2Bbugs?field.tag=in-feature-pecan)
[in-stable-juno](/neutron/%2Bbugs?field.tag=in-stable-juno)
[in-stable-kilo](/neutron/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2015-5240](/bugs/cve/2015-5240 "Race condition in OpenStack Neutron b...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#1](/neutron/%2Bbug/1489111/comments/1) |
| --- | --- | --- | --- |

Hi,

I have a attached a patch that fixes the problem.

It enables a regex match in the policy engine and then changes the default policy to prevent users from using the 'network:' prefix in the device\_owner field unless they own the network, have the advanced services role, or are an admin.

Hi,
I have a attached a patch that fixes the problem.
It enables a regex match in the policy engine and then changes the default policy to prevent users from using the 'network:' prefix in the device\_owner field unless they own the network, have the advanced services role, or are an admin.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#2](/neutron/%2Bbug/1489111/comments/2) |
| --- | --- | --- | --- |

The core issue here is that the L2 agent trusts any devices whose owner field starts with 'network:'. This is necessary because the DHCP port and the router ports can't have DHCP spoofing and IP spoofing rules (respectively).

Here is the logic that skips 'network:' owned ports for security groups.

<https://github.com/openstack/neutron/blob/d66f0e27919a29682d7c65e4f9ce1f9c7b278542/neutron/api/rpc/handlers/securitygroups_rpc.py#L83>

The core issue here is that the L2 agent trusts any devices whose owner field starts with 'network:'. This is necessary because the DHCP port and the router ports can't have DHCP spoofing and IP spoofing rules (respectively).
Here is the logic that skips 'network:' owned ports for security groups.
https://github.com/openstack/neutron/blob/d66f0e27919a29682d7c65e4f9ce1f9c7b278542/neutron/api/rpc/handlers/securitygroups\_rpc.py#L83

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#3](/neutron/%2Bbug/1489111/comments/3) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#4](/neutron/%2Bbug/1489111/comments/4) |
| --- | --- | --- | --- |

Beside having an instance unprotected by iptables, what can the user do with it ?

e.g., can he spoof other tenants' ip ?

Beside having an instance unprotected by iptables, what can the user do with it ?
e.g., can he spoof other tenants' ip ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#5](/neutron/%2Bbug/1489111/comments/5) |
| --- | --- | --- | --- |

Yes, the big risk here is with shared networks. The attacker can spoof other VMs IPs, or give out incorrect information via spoofed DHCP responses to get other VMs to send traffic to it.

Yes, the big risk here is with shared networks. The attacker can spoof other VMs IPs, or give out incorrect information via spoofed DHCP responses to get other VMs to send traffic to it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#6](/neutron/%2Bbug/1489111/comments/6) |
| --- | --- | --- | --- |

Had to update the patch to handle a changed response code in a unit test.

Had to update the patch to handle a changed response code in a unit test.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#7](/neutron/%2Bbug/1489111/comments/7) |
| --- | --- | --- | --- |

Assuming this affect all l2 agents and all supported release, here is the impact description:

Title: Neutron firewall rules bypass through port update

Reporter: Kevin Benton (Mirantis)

Products: Neutron

Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1

Description:

Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the port's device owner of an instance right after it is created, an authenticated user may prevent firewall rules to be applied, potentially resulting in anti spoofing rules to be disabled. All Neutron setups are affected.

Assuming this affect all l2 agents and all supported release, here is the impact description:
Title: Neutron firewall rules bypass through port update
Reporter: Kevin Benton (Mirantis)
Products: Neutron
Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1
Description:
Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the port's device owner of an instance right after it is created, an authenticated user may prevent firewall rules to be applied, potentially resulting in anti spoofing rules to be disabled. All Neutron setups are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#8](/neutron/%2Bbug/1489111/comments/8) |
| --- | --- | --- | --- |

Thanks Kevin for the update, please let me know if the above description is accurate.

@neutron-coresec, is the proposed patch going to be easily backportable ? Not sure what's the rule for policy.json changes...

Anyway, please follow this guide to properly format proposed patch: <https://security.openstack.org/#how-to-propose-and-review-a-security-patch>

Thanks Kevin for the update, please let me know if the above description is accurate.
@neutron-coresec, is the proposed patch going to be easily backportable ? Not sure what's the rule for policy.json changes...
Anyway, please follow this guide to properly format proposed patch: https://security.openstack.org/#how-to-propose-and-review-a-security-patch

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-08-26: |  |  | [#9](/neutron/%2Bbug/1489111/comments/9) |
| --- | --- | --- | --- |

This scenario will likely enable an attacker on a shared network to hijack DHCP traffic as mentioned by Kevin.

IP spoofing could also be possible since the attacker VMs would be able to intercept ARP requests and fabricate ARP replies

It is not possible to do any sort of mitigation using security groups, so this attack is very practical and probably deserves an A in the OSSA taxonomy

This scenario will likely enable an attacker on a shared network to hijack DHCP traffic as mentioned by Kevin.
IP spoofing could also be possible since the attacker VMs would be able to intercept ARP requests and fabricate ARP replies
It is not possible to do any sort of mitigation using security groups, so this attack is very practical and probably deserves an A in the OSSA taxonomy

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-26: |  |  | [#10](/neutron/%2Bbug/1489111/comments/10) |
| --- | --- | --- | --- |

Yes, that description sounds correct. I will format the patch appropriately.

Yes, that description sounds correct. I will format the patch appropriately.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-08-26: |  |  | [#12](/neutron/%2Bbug/1489111/comments/12) |
| --- | --- | --- | --- |

Patch looks good to me. +2,

The shared network flag feature in neutron is such a hack. Thank goodness we have proper RBAC now thanks to the support you added kevin :)

Patch looks good to me. +2,
The shared network flag feature in neutron is such a hack. Thank goodness we have proper RBAC now thanks to the support you added kevin :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-27: |  |  | [#13](/neutron/%2Bbug/1489111/comments/13) |
| --- | --- | --- | --- |

Assuming this affect all the way down to Juno, can you also attach backports for stable/juno and stable/kilo branches as well ?

Assuming this affect all the way down to Juno, can you also attach backports for stable/juno and stable/kilo branches as well ?

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-08-27: |  |  | [#14](/neutron/%2Bbug/1489111/comments/14) |
| --- | --- | --- | --- |

Minor improvement to the wording:

By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls.

Minor improvement to the wording:
By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-27: |  |  | [#15](/neutron/%2Bbug/1489111/comments/15) |
| --- | --- | --- | --- |

Thanks for the review, here is the updated impact description:

Title: Neutron firewall rules bypass through port update

Reporter: Kevin Benton (Mirantis)

Products: Neutron

Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1

Description:

Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls. All Neutron setups are affected.

Thanks for the review, here is the updated impact description:
Title: Neutron firewall rules bypass through port update
Reporter: Kevin Benton (Mirantis)
Products: Neutron
Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1
Description:
Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the device owner of an instance's port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls. All Neutron setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-27: |  |  | [#18](/neutron/%2Bbug/1489111/comments/18) |
| --- | --- | --- | --- |

CVE have been requested.

@neutron-coresec, please review proposed patch.

CVE have been requested.
@neutron-coresec, please review proposed patch.

| Changed in ossa: | |
| --- | --- |
| **status**: | Triaged → In Progress |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-08-27

| **summary**: | IP, MAC, and DHCP spoofing rules can by bypassed by changing- device\_owner+ device\_owner (CVE-2015-5240) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-08-28:  [**Re: IP, MAC, and DHCP spoofing rules can by bypassed by changing device\_owner (CVE-2015-5240)**](/neutron/%2Bbug/1489111/comments/19) |  |  | [#19](/neutron/%2Bbug/1489111/comments/19) |
| --- | --- | --- | --- |

I verified the patch fixes the security issue. I ran several tests trying to find other the way to exploit the same issue, for instance by re-using system created network ports. Nova does not allow one to boot instances on such ports as nova will return a 409 when attempting to boot on a port with an already-populated device\_owner attribute.

The patch is also resilient to white space padding (eg: " network:" is accepted but won't cause the port\_security\_enabled attribute go to False).

I have minor observations on the code changes:

- the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however.

- Having to prepend ~ to say it's a regex is fine by me. Alternatively one could treat everything as a regex, adding automatically ^ and $ for doing exact matches. But then you'll have to document that regex evaluation will always match on the whole string.

On the CVE it is worth probably stating that as far as we know only affects the ML2 plugin. The logic where the vulnerability is introduced is specific indeed to that plugin. Other plugins might be affected too if they adopted similar logic for determining whether spoofing protections should be installed, but I think it's up to the plugin maintainers to verify that and fix if necessary.

Summarizing: the patch looks good to me, and there's no need of further revisions.

I verified the patch fixes the security issue. I ran several tests trying to find other the way to exploit the same issue, for instance by re-using system created network ports. Nova does not allow one to boot instances on such ports as nova will return a 409 when attempting to boot on a port with an already-populated device\_owner attribute.
The patch is also resilient to white space padding (eg: " network:" is accepted but won't cause the port\_security\_enabled attribute go to False).
I have minor observations on the code changes:
- the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however.
- Having to prepend ~ to say it's a regex is fine by me. Alternatively one could treat everything as a regex, adding automatically ^ and $ for doing exact matches. But then you'll have to document that regex evaluation will always match on the whole string.
On the CVE it is worth probably stating that as far as we know only affects the ML2 plugin. The logic where the vulnerability is introduced is specific indeed to that plugin. Other plugins might be affected too if they adopted similar logic for determining whether spoofing protections should be installed, but I think it's up to the plugin maintainers to verify that and fix if necessary.
Summarizing: the patch looks good to me, and there's no need of further revisions.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-28: |  |  | [#20](/neutron/%2Bbug/1489111/comments/20) |
| --- | --- | --- | --- |

Thanks Salvatore for this prompt review.

About the description, since we only support plugins within the neutron code base, the affects can also be reduced to:

"All Neutron setups using the ML2 plugin"

I'd like to send the advance notification today with this disclosure date/time:

2015-09-03, 1500UTC

Though ?

Thanks Salvatore for this prompt review.
About the description, since we only support plugins within the neutron code base, the affects can also be reduced to:
"All Neutron setups using the ML2 plugin"
I'd like to send the advance notification today with this disclosure date/time:
2015-09-03, 1500UTC
Though ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-08-28: |  |  | [#21](/neutron/%2Bbug/1489111/comments/21) |
| --- | --- | --- | --- |

"All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API"

Any plugins that have agents calling this method will be affected:

<https://github.com/openstack/neutron/blob/4f802232771d051d0fe076e6458674a995c6bc14/neutron/api/rpc/handlers/securitygroups_rpc.py#L79-L84>

"All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API"
Any plugins that have agents calling this method will be affected:
https://github.com/openstack/neutron/blob/4f802232771d051d0fe076e6458674a995c6bc14/neutron/api/rpc/handlers/securitygroups\_rpc.py#L79-L84

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-28: |  |  | [#22](/neutron/%2Bbug/1489111/comments/22) |
| --- | --- | --- | --- |

pre-OSSA sent with last suggestion from Kevin. Thanks everyone :-)

pre-OSSA sent with last suggestion from Kevin. Thanks everyone :-)

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#23](/neutron/%2Bbug/1489111/comments/23) |
| --- | --- | --- | --- |

There is a mistake in the patches, sending updated versions shortly.

There is a mistake in the patches, sending updated versions shortly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#24](/neutron/%2Bbug/1489111/comments/24) |
| --- | --- | --- | --- |

That's unfortunate. Should we send updated patches to the downstream stakeholders and extend the disclosure date?

That's unfortunate. Should we send updated patches to the downstream stakeholders and extend the disclosure date?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#25](/neutron/%2Bbug/1489111/comments/25) |
| --- | --- | --- | --- |

Yes, we will need to send the updated patches. I'm not sure if the disclosure date needs to be adjusted.

Yes, we will need to send the updated patches. I'm not sure if the disclosure date needs to be adjusted.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#26](/neutron/%2Bbug/1489111/comments/26) |
| --- | --- | --- | --- |

difference between this and the previous version is 'rule:admin\_or\_network\_owner' instead of 'role:admin\_or\_network\_owner' in policy.json

difference between this and the previous version is 'rule:admin\_or\_network\_owner' instead of 'role:admin\_or\_network\_owner' in policy.json

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#27](/neutron/%2Bbug/1489111/comments/27) |
| --- | --- | --- | --- |

* [master patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455837/%2Bfiles/devowner_patch.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455837)
  (7.4 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#28](/neutron/%2Bbug/1489111/comments/28) |
| --- | --- | --- | --- |

* [kilo patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455838/%2Bfiles/devowner_patch_kilo.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455838)
  (7.5 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#29](/neutron/%2Bbug/1489111/comments/29) |
| --- | --- | --- | --- |

Ouch, well then we need to extend the disclosure date. If those new patch are approved by thursday it can be:

2015-09-08, 1500UTC

Ouch, well then we need to extend the disclosure date. If those new patch are approved by thursday it can be:
2015-09-08, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-09-01: |  |  | [#30](/neutron/%2Bbug/1489111/comments/30) |
| --- | --- | --- | --- |

* [juno patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455839/%2Bfiles/devowner_patch_juno.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455839)
  (6.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-09-01: |  |  | [#31](/neutron/%2Bbug/1489111/comments/31) |
| --- | --- | --- | --- |

I verified the updated patches with Kevin.

I think this explains why I was observing the weird behaviour noted in the review with:

"the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however."

Basically the typo was causing the policy engine to enforce a different kind of check (which always failed afaict). If we merged that patch we would have fixed the security issue, but introduced a functional defect.

The difference between the two patches is minimal, so there's not much else to review.

I verified the updated patches with Kevin.
I think this explains why I was observing the weird behaviour noted in the review with:
"the policy change works but it seems weird as it's an or condition and is acting as a "and". Perhaps the policy engine is not operating as expected here. This is unrelated to this patch however."
Basically the typo was causing the policy engine to enforce a different kind of check (which always failed afaict). If we merged that patch we would have fixed the security issue, but introduced a functional defect.
The difference between the two patches is minimal, so there's not much else to review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#32](/neutron/%2Bbug/1489111/comments/32) |
| --- | --- | --- | --- |

The new patch have been sent, please do not push them until the new disclosure date:

2015-09-08, 1500UTC

The new patch have been sent, please do not push them until the new disclosure date:
2015-09-08, 1500UTC

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-09-08

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to neutron (master)**](/neutron/%2Bbug/1489111/comments/33) |  |  | [#33](/neutron/%2Bbug/1489111/comments/33) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/221342>

Fix proposed to branch: master
Review: https://review.openstack.org/221342

| Changed in neutron: | |
| --- | --- |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to neutron (stable/kilo)**](/neutron/%2Bbug/1489111/comments/34) |  |  | [#34](/neutron/%2Bbug/1489111/comments/34) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/221344>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/221344

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to neutron (stable/juno)**](/neutron/%2Bbug/1489111/comments/35) |  |  | [#35](/neutron/%2Bbug/1489111/comments/35) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/juno

Review: <https://review.openstack.org/221345>

Fix proposed to branch: stable/juno
Review: https://review.openstack.org/221345

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-09-08

| **summary**: | - IP, MAC, and DHCP spoofing rules can by bypassed by changing- device\_owner (CVE-2015-5240)+ [OSSA 2015-018] IP, MAC, and DHCP spoofing rules can by bypassed by+ changing device\_owner (CVE-2015-5240) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix merged to neutron (master)**](/neutron/%2Bbug/1489111/comments/36) |  |  | [#36](/neutron/%2Bbug/1489111/comments/36) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/221342>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=bbca973986fdc99eae9d1b2545e8246c0b2be2e2>

Submitter: Jenkins

Branch: master

commit bbca973986fdc99eae9d1b2545e8246c0b2be2e2

Author: Kevin Benton <email address hidden>

Date: Tue Aug 25 22:03:27 2015 -0700

Stop device\_owner from being set to 'network:\*'

This patch adjusts the FieldCheck class in the policy engine to

    allow a regex rule. It then leverages that to prevent users from

    setting the device\_owner field to anything that starts with

    'network:' on networks which they do not own.

This policy adjustment is necessary because any ports with a

    device\_owner that starts with 'network:' will not have any security

    group rules applied because it is assumed they are trusted network

    devices (e.g. router ports, DHCP ports, etc). These security rules

    include the anti-spoofing protection for DHCP, IPv6 ICMP messages,

    and IP headers.

Without this policy adjustment, tenants can abuse this trust when

    connected to a shared network with other tenants by setting their

    VM port's device\_owner field to 'network:<anything>' and hijack other

    tenants' traffic via DHCP spoofing or MAC/IP spoofing.

Closes-Bug: #1489111

    Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

Reviewed: https://review.openstack.org/221342
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=bbca973986fdc99eae9d1b2545e8246c0b2be2e2
Submitter: Jenkins
Branch: master
commit bbca973986fdc99eae9d1b2545e8246c0b2be2e2
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-09:  [**Fix merged to neutron (stable/juno)**](/neutron/%2Bbug/1489111/comments/37) |  |  | [#37](/neutron/%2Bbug/1489111/comments/37) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/221345>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=ebb0c5403b347ae1a841f578971ed1a3e3b6de53>

Submitter: Jenkins

Branch: stable/juno

commit ebb0c5403b347ae1a841f578971ed1a3e3b6de53

Author: Kevin Benton <email address hidden>

Date: Tue Aug 25 22:03:27 2015 -0700

Stop device\_owner from being set to 'network:\*'

This patch adjusts the FieldCheck class in the policy engine to

    allow a regex rule. It then leverages that to prevent users from

    setting the device\_owner field to anything that starts with

    'network:' on networks which they do not own.

This policy adjustment is necessary because any ports with a

    device\_owner that starts with 'network:' will not have any security

    group rules applied because it is assumed they are trusted network

    devices (e.g. router ports, DHCP ports, etc). These security rules

    include the anti-spoofing protection for DHCP, IPv6 ICMP messages,

    and IP headers.

Without this policy adjustment, tenants can abuse this trust when

    connected to a shared network with other tenants by setting their

    VM port's device\_owner field to 'network:<anything>' and hijack other

    tenants' traffic via DHCP spoofing or MAC/IP spoofing.

Conflicts:

     etc/policy.json

     neutron/api/v2/attributes.py

     neutron/tests/etc/policy.json

     neutron/tests/unit/test\_policy.py

Closes-Bug: #1489111

    Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

    (cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

Reviewed: https://review.openstack.org/221345
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=ebb0c5403b347ae1a841f578971ed1a3e3b6de53
Submitter: Jenkins
Branch: stable/juno
commit ebb0c5403b347ae1a841f578971ed1a3e3b6de53
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Conflicts:
etc/policy.json
neutron/api/v2/attributes.py
neutron/tests/etc/policy.json
neutron/tests/unit/test\_policy.py
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9
(cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

| **tags**: | added: in-stable-juno |
| --- | --- |
| **tags**: | added: in-stable-kilo |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-09:  [**Fix merged to neutron (stable/kilo)**](/neutron/%2Bbug/1489111/comments/38) |  |  | [#38](/neutron/%2Bbug/1489111/comments/38) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/221344>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=767cea23de44a963c6793ffe30ea5c6827d27a38>

Submitter: Jenkins

Branch: stable/kilo

commit 767cea23de44a963c6793ffe30ea5c6827d27a38

Author: Kevin Benton <email address hidden>

Date: Tue Aug 25 22:03:27 2015 -0700

Stop device\_owner from being set to 'network:\*'

This patch adjusts the FieldCheck class in the policy engine to

    allow a regex rule. It then leverages that to prevent users from

    setting the device\_owner field to anything that starts with

    'network:' on networks which they do not own.

This policy adjustment is necessary because any ports with a

    device\_owner that starts with 'network:' will not have any security

    group rules applied because it is assumed they are trusted network

    devices (e.g. router ports, DHCP ports, etc). These security rules

    include the anti-spoofing protection for DHCP, IPv6 ICMP messages,

    and IP headers.

Without this policy adjustment, tenants can abuse this trust when

    connected to a shared network with other tenants by setting their

    VM port's device\_owner field to 'network:<anything>' and hijack other

    tenants' traffic via DHCP spoofing or MAC/IP spoofing.

Closes-Bug: #1489111

    Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9

    (cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

Reviewed: https://review.openstack.org/221344
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=767cea23de44a963c6793ffe30ea5c6827d27a38
Submitter: Jenkins
Branch: stable/kilo
commit 767cea23de44a963c6793ffe30ea5c6827d27a38
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9
(cherry picked from commit 959a2f28cbbfc309381ea9ffb55090da6fb9c78f)

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-09-14

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-16:  [**Fix proposed to neutron (feature/pecan)**](/neutron/%2Bbug/1489111/comments/39) |  |  | [#39](/neutron/%2Bbug/1489111/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/224334>

Fix proposed to branch: feature/pecan
Review: https://review.openstack.org/224334

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-17: |  |  | [#40](/neutron/%2Bbug/1489111/comments/40) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/224357>

Fix proposed to branch: feature/pecan
Review: https://review.openstack.org/224357

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-17:  [**Fix merged to neutron (feature/pecan)**](/neutron/%2Bbug/1489111/comments/41) |  |  | [#41](/neutron/%2Bbug/1489111/comments/41) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1489111/comments/41/%2Bdownload) (73.6 KiB)

Reviewed: <https://review.openstack.org/224357>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=fdc3431ccd219accf6a795079d9b67b8656eed8e>

Submitter: Jenkins

Branch: feature/pecan

commit fe236bdaadb949661a0bfb9b62ddbe432b4cf5f1

Author: Miguel Angel Ajo <email address hidden>

Date: Thu Sep 3 15:40:12 2015 +0200

No network devices on network attached qos policies

Network devices, like internal router legs, or dhcp ports

    should not be affected by bandwidth limiting rules.

This patch disables application of network attached policies

    to network/neutron owned ports.

Closes-bug: #1486039

    DocImpact

Change-Id: I75d80227f1e6c4b3f5fa7762b8dc3b0c0f1abd46

commit db4a06f7caa20a4c7879b58b20e95b223ed8eeaf

Author: Ken'ichi Ohmichi <email address hidden>

Date: Wed Sep 16 10:04:32 2015 +0000

Use tempest-lib's token\_client

Now tempest-lib provides token\_client modules as library and the

    interface is stable. So neutron repogitory doesn't need to contain

    these modules.

    This patch makes neutron use tempest-lib's token\_client and removes

    the own modules for the maintenance.

Change-Id: Ieff7eb003f6e8257d83368dbc80e332aa66a156c

commit 78aed58edbe6eb8a71339c7add491fe9de9a0546

Author: Jakub Libosvar <email address hidden>

Date: Thu Aug 13 09:08:20 2015 +0000

Fix establishing UDP connection

Previously, in establish\_connection() for UDP protocol data were sent

    but never read on peer socket. That lead to successful read on peer side

    if this connection was filtered. Having constant testing string masked

    this issue as we can't distinguish to which test of connectivity data

    belong.

This patch makes unique data string per test\_connectivity() and

    also makes establish\_connection() to create an ASSURED entry in

    conntrack table. Finally, in last test after firewall filter was

    removed, connection is re-established in order to avoid troubles with

    terminated processes or TCP continuing sending packets which weren't

    successfully delivered.

Closes-Bug: 1478847

    Change-Id: I2920d587d8df8d96dc1c752c28f48ba495f3cf0f

commit e6292fcdd6262434a7b713ad8802db6bc8a6d3dc

Author: YAMAMOTO Takashi <email address hidden>

Date: Wed Sep 16 13:20:51 2015 +0900

ovsdb: Fix a few docstring

Change-Id: I53e1e21655b28fe5da60e58aeeb7cbbd103ae014

commit c22949a4449d96a67caa616290cf76b67b182917

Author: fumihiko kakuma <email address hidden>

Date: Wed Sep 16 11:52:59 2015 +0900

Remove requirements.txt for the ofagent mechanism driver

It is no longer used.

Related-Blueprint: core-vendor-decomposition

    [https://blueprints.launchpad.net/neutron/+spec/core-vendor-decomposition](https://blueprints.launchpad.net/neutron/%2Bspec/core-vendor-decomposition)

Change-Id: Ib31fb3febf8968e50d86dd66e1e6e1ea2313f8ac

commit d1d4de19d85f961d388c91e70f31b3bafec418c5

Author: Kevin Benton <email address hidden>

Date: Thu Sep 3 20:25:57 2015 -0700

Always return iterables in L3 get\_candidates

The caller of this function expects iterables.

Closes-Bug: #1494996

    Change-Id: I3d103e63f4e127a77268502415c0ddb0d804b54a

commit 1ad6ac448067306...

Reviewed: https://review.openstack.org/224357
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=fdc3431ccd219accf6a795079d9b67b8656eed8e
Submitter: Jenkins
Branch: feature/pecan
commit fe236bdaadb949661a0bfb9b62ddbe432b4cf5f1
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Thu Sep 3 15:40:12 2015 +0200
No network devices on network attached qos policies
Network devices, like internal router legs, or dhcp ports
should not be affected by bandwidth limiting rules.
This patch disables application of network attached policies
to network/neutron owned ports.
Closes-bug: #1486039
DocImpact
Change-Id: I75d80227f1e6c4b3f5fa7762b8dc3b0c0f1abd46
commit db4a06f7caa20a4c7879b58b20e95b223ed8eeaf
Author: Ken'ichi Ohmichi <ken-oomichi@wx.jp.nec.com>
Date: Wed Sep 16 10:04:32 2015 +0000
Use tempest-lib's token\_client
Now tempest-lib provides token\_client modules as library and the
interface is stable. So neutron repogitory doesn't need to contain
these modules.
This patch makes neutron use tempest-lib's token\_client and removes
the own modules for the maintenance.
Change-Id: Ieff7eb003f6e8257d83368dbc80e332aa66a156c
commit 78aed58edbe6eb8a71339c7add491fe9de9a0546
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Thu Aug 13 09:08:20 2015 +0000
Fix establishing UDP connection
Previously, in establish\_connection() for UDP protocol data were sent
but never read on peer socket. That lead to successful read on peer side
if this connection was filtered. Having constant testing string masked
this issue as we can't distinguish to which test of connectivity data
belong.
This patch makes unique data string per test\_connectivity() and
also makes establish\_connection() to create an ASSURED entry in
conntrack table. Finally, in last test after firewall filter was
removed, connection is re-established in order to avoid troubles with
terminated processes or TCP continuing sending packets which weren't
successfully delivered.
Closes-Bug: 1478847
Change-Id: I2920d587d8df8d96dc1c752c28f48ba495f3cf0f
commit e6292fcdd6262434a7b713ad8802db6bc8a6d3dc
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Wed Sep 16 13:20:51 2015 +0900
ovsdb: Fix a few docstring
Change-Id: I53e1e21655b28fe5da60e58aeeb7cbbd103ae014
commit c22949a4449d96a67caa616290cf76b67b182917
Author: fumihiko kakuma <kakuma@valinux.co.jp>
Date: Wed Sep 16 11:52:59 2015 +0900
Remove requirements.txt for the ofagent mechanism driver
It is no longer used.
Related-Blueprint: core-vendor-decomposition
https://blueprints.launchpad.net/neutron/+spec/core-vendor-decomposition
Change-Id: Ib31fb3febf8968e50d86dd66e1e6e1ea2313f8ac
commit d1d4de19d85f961d388c91e70f31b3bafec418c5
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Sep 3 20:25:57 2015 -0700
Always return iterables in L3 get\_candidates
The caller of this function expects iterables.
Closes-Bug: #1494996
Change-Id: I3d103e63f4e127a77268502415c0ddb0d804b54a
commit 1ad6ac448067306fcf7ea562840e63fd257f0556
Author: Sudhakar Babu Gariganti <sudhakar-babu.gariganti@hp.com>
Date: Fri Sep 11 14:53:27 2015 +0530
Prevent full sync in dhcp\_agent when possible
If an exception occurs in sync\_state method, we try for a full sync
even in the case where we have fewer networks to resync for.
This turns out to be pretty costly in scaled environments.
This patch addresses the above behavior by resyncing only for the
eariler set of failed networks.
Closes-Bug: #1495592
Change-Id: I069e992b3b7814370d409236b6a3c81a25829cc1
commit 1b94f3f3d9c84a20f46000c0801eeb8bad84a6fb
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed Jul 15 10:46:35 2015 +0000
Add QoS fullstack test
Test the qos policy and rule CRUD lifecycle with port. Future plans are
to add similar testing with ports belonging to network with set qos
policy.
Change-Id: Iebe9b3e9d612d3533381a8cf4d0b9c587f8fda42
commit cc698b2ba578e5bc1475f6229bfebd1316c41ffb
Author: Moshe Levi <moshele@mellanox.com>
Date: Mon Aug 10 12:25:59 2015 +0300
QoS agent extension and driver refactoring
Moved some code common to all drivers into base
qos driver abstract class, so related bugfixes go all in one
place and we simplify the logic for every qos drivers.
Port/Policy mapping moved out to a separate class.
Support delete per rule\_type or delete all rules.
Related-bug: #1486039
Co-Authored-By: Miguel Angel Ajo <mangelajo@redhat.com>
Partially-Implements: blueprint ml2-qos
Change-Id: Ia9d8638b9268b5aa8512cbb9d001413751f82649
commit 17765114292217d109c15b220be57fea6c9eed4a
Author: sridhargaddam <sridhar.gaddam@enovance.com>
Date: Tue Jul 14 16:18:06 2015 +0000
Add IPv6 Address Resolution protection
Similar to IPv4 arp protection support, this patch adds the necessary OVS
rules to prevent ports attached to agent from sending any icmpv6 neighbor
advertisement messages that contain an IPv6 address not belonging to the port.
For details please refer to "Figure 3. Attack against IPv6 Address Resolution"
http://www.cisco.com/web/about/security/intelligence/ipv6\_first\_hop.html
DocImpact
SecurityImpact
Closes-Bug: #1491690
Change-Id: I1f8311f1b9ae1be02afde3e9078e49c6da373a88
commit 53c64ff1ac3e92fa1cb8945cfae26b2624f2697d
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Tue Sep 15 11:52:03 2015 +0000
Revert "AsyncProcess: try to kill tender"
This change introduced bug 1495937.
This reverts commit 470a7d8a106a274e06fb1311c6738f333a98f59c.
Change-Id: I84fea4fdac71141da335ccd9e0d4c9d6174dfd86
commit 25e4e13565690fc4bc9e08e34598e18f04b921b7
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon Aug 24 22:24:10 2015 +0200
Remove out-of-tree vendor AGENT\_TYPE\_\* constant
AGENT\_TYPE\_\* constants[1] defines all agent types BUT the only vendor
one(AGENT\_TYPE\_NEC) is only used in out-of-tree networking-nec repo.
This changes removes out-of-tree AGENT\_TYPE\_NEC constant (dependant
change defines it in networking-nec repo).
[1] in neutron.extensions.portbindings
Change-Id: Ia80c33ee7970cfe167c2c9ca6d512f23561455a2
Closes-Bug: #1487598
Depends-On: I955fa48ee2120900e422bab57db250303c3d7bb4
commit f4a76a7a26c0902d61f4fe61091e7fe556923592
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Mon Sep 14 14:54:34 2015 +0000
func: Don't use private method of AsyncProcess
In functional test we simulate crash of AsyncProcess by calling
\_kill\_process(). This method is a private method and such usage
introduced a race where process was respawned prior to calling wait() of
killed process, leading to infinite wait on newly spawned process.
This patch adds manual send of kill and then active waiting for process
to be respawned, similarly like done with recent keepalived patch [1].
[1] https://review.openstack.org/#/c/222460/7/neutron/tests/functional/agent/linux/test\_keepalived.py
Closes-Bug: #1477860
Change-Id: I1c91393304d65a0695311416ecc5b64fd549b192
commit a13f5afcc821e24e40227965491b964fa85c003c
Author: lzklibj <lzklibj@cn.ibm.com>
Date: Fri Sep 11 02:37:47 2015 +0800
Remove unused ovs\_lib method reset\_bridge
Per [1] we are using a better way to keep tunnel connectivity,
so reset\_bridge isn't used anymore. Bug in [2] was caused by
using method reset\_bridge which will delete and recreate bridge.
For [1] makes method reset\_bridge deprecated, it makes sense to
remove this method, and make [2] no longer produce.
[1] https://review.openstack.org/#/c/182920
[2] Related-bug: #1332450
Change-Id: I155f66a37b8d4081126467fe576e8315c2d5560c
commit 573c14659a953164ba556c694062e9242dcca807
Author: Brian Haley <brian.haley@hp.com>
Date: Mon Sep 14 16:12:18 2015 -0400
Fix TypeError caused by delete\_agent\_gateway\_port()
A recent change used a keyword argument when it didn't need to,
correct it to fix the multinode DVR job.
End of typical traceback:
File "/opt/stack/new/neutron/neutron/api/rpc/handlers/l3\_rpc.py",
in delete\_agent\_gateway\_port(admin\_ctx, network\_id, host\_id=host)
TypeError: delete\_floatingip\_agent\_gateway\_port() got multiple
values for keyword argument 'host\_id'
Introduced in commit 639f1893dde0d393a97b29ca5309dba716831a7
Related-bug: #1495147
Change-Id: Id2522bc843bc7b089b7783d3f765900a50a0033f
commit b01f2f08257f5156084ac3e2644e79f220b15b6d
Author: Kyle Mestery <mestery@mestery.com>
Date: Thu Sep 10 15:46:04 2015 +0000
sub\_project\_guidelines: Add richer documentation
Add additional documentation around releasing sub-projects.
Change-Id: I71f31b6b8ed085066491e181074b467435f8d66d
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit bfebc9f8af05b5d4a5dcd2c2b0d521fe2fefa265
Author: Ryan Moats <rmoats@us.ibm.com>
Date: Mon Sep 14 11:29:28 2015 -0500
Fix typo: Large Ops, not Large Opts
Change-Id: I73e64e19275f002fcc2ae2e903611835bfd98f8a
Signed-off-by: Ryan Moats <rmoats@us.ibm.com>
commit 5eaff5fa0720b860ec4c0c75abee942313f93e94
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Mon Sep 14 17:29:22 2015 +0300
Fix query in get\_l3\_agent\_with\_min\_routers
For PostgreSQL if you're using GROUP BY everything in the SELECT
list must be an aggregate count(...) or used in the GROUP BY.
Closes-bug: #1495523
Change-Id: Ieb75d0666ec2f6d2e61686bf2bacea2b9ad6c521
commit a8d0586fdebfd28e407e2d30f72c92e3711d0a1e
Author: Ilya Shakhat <ishakhat@mirantis.com>
Date: Mon Sep 14 15:43:05 2015 +0300
Do not specify host for l2population topics
When creating topics oslo.messaging automatically creates
topic with hostname suffix (e.g. topic.hostname), there's
no need to do this explicitly.
Change-Id: Ia396452e8deb2c8f10bbead936245eeece8066a6
Closes-Bug: #1495508
commit 638d16c8a019cfdafa2b6bb12c95775544bb58df
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Sep 3 10:01:40 2015 -0700
Add utility function for checking trusted port
Ports that have a device\_owner that starts with 'network:'
are trusted in several places throughout the codebase. Each
of these did a startswith check on each field and it's not
immediately obvious why it's done.
This patch adds a utility function called 'is\_port\_trusted'
that performs the same check and makes it obvious what is
being done.
Change-Id: I542c753776d5cfb2fd736b25ea6e111867c89c89
commit 691fae47a4e7468884cb58692ecaf48b9737dae1
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Mon Sep 14 09:19:14 2015 +0000
Fix typo in error message in NetcatTester
Change-Id: Ie00901b1dab6c0c5ad4ec0f0c437426afc60396e
commit a466531aec4cb02469d12756c0151deb59dd4d13
Author: Saju Madhavan <sajuptpm@gmail.com>
Date: Mon Sep 14 14:03:28 2015 +0530
docstring fix
Change-Id: I35e44872c3dc7508d5991dc967bbceb22d6bea51
commit 470a7d8a106a274e06fb1311c6738f333a98f59c
Author: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
Date: Fri Sep 11 19:01:20 2015 +0900
AsyncProcess: try to kill tender
\_kill\_process kills processes with SIGKILL, which prevents the
processes' cleanup from running. Issue SIGTERM first and wait a bit.
Change-Id: Ie7b94011bbd11b1d672c95e3be19bb3c84ef77ec
Closes-bug: 1494363
commit a57b37fc56ffe3c1dade796c4663e95b1bbeea80
Author: Hong Hui Xiao <xiaohhui@cn.ibm.com>
Date: Thu Sep 10 06:38:01 2015 -0400
Enable servicing lbaasV2 vip by DVR
Currently, the vip of lbaasV2 will not have l3 network with DVR.
This prevent the usercase of lbaasV2 + DVR. This patch aims to
enable servicing lbaasv2 vip by DVR.
Change-Id: I1b51550437994fbe78d4db904641d4d9fb75d82e
Closes-Bug: #1493809
commit e5f635ee4fd1fe8a0bd2e5c58db068b51fc94c0b
Author: armando-migliaccio <armamig@gmail.com>
Date: Fri Sep 11 02:32:42 2015 -0700
Switch scheduler drivers to load based schedulers
Cloud deployed at scale most likely will use these scheduler
drivers because they allow a fairer resource allocation compared
to chance schedulers (which randomly place resources on the hosts).
Because of their importance, it's only wise to test them in
the gate on a continuous basis, so that we do not get surprised
by accidental regressions.
Rather than pushing this down through devstack-gate/project-config
patches, this chance alters the default of the scheduler
drivers, so that users can also pick these up out of the box.
This means that after an upgrade they would observe a change in
the scheduling behavior, if they relied on the default config.
DocImpact
UpgradeImpact
Closes-bug: #1494667
Change-Id: I5927914cb88eff66bc7a045340ff68cb8da95ad6
commit dafa61bd46b7eacbc708d17a3fa492de971d6dd2
Author: armando-migliaccio <armamig@gmail.com>
Date: Sat Sep 12 12:07:35 2015 -0700
Fix BadRequest error on add\_router\_interface for DVR
This operation for DVR is made of multiple steps, some of
which are not within the same DB transaction. For this
reason, if a failure occurs, the rollback will be partial.
This inconsistent state leads the retry logic to fail with
BadRequest, because the router is believed to be already
connected to the subnet.
To fix this condition, it is necessary to delete the port
should the DB deadlock occur.
Closes-bug: #1494114
Change-Id: Ia2a73d6f9d1e4746e761ad072d954e64267a3ad1
commit 57b6a651a39099ea76178bdcea51b06bde587e25
Author: Sergey Vilgelm <sergey@vilgelm.info>
Date: Sat Sep 12 21:55:01 2015 +0300
Fix missing value types for log message
This patch add missing value types for some log message of exception.
Change-Id: Ie9f512bc804f0cd70df991b1910c975a2f9d6fcf
Closes-Bug: #1494574
commit 5405d9742b94f203389f555c56727a66925e9454
Author: armando-migliaccio <armamig@gmail.com>
Date: Thu Sep 10 21:54:33 2015 -0700
Tweak test\_keepalived\_respawns test logic
This test initial design is problematic: it spawns keepalived,
it asserts the process is up, then it attempts to kill it.
However, this is when problems may arise:
a) it does so by using the disable method on the process - we
should be more rude than that if we want to simulate a crash!
b) keepalived may be forking while it is starting and it is
possible that for a moment the ppid changes and the process
owner invoking the kill has no rights to kill the spawned
process. This is the most plausible explaination I could find
as to why kill returns 1 with no standard error
c) it does not verify that the process has indeed disappeared
(what if the pm.disable didn't work?) - this means that the
test can pass, and yet the monitor may not work.
Bottom line: this test relied on the correctness of the very code
that was meant to validate...and that's not cool. To this aim, we
wait for the process to be active, kill the process with a kill -9
and verify that the process after the kill is indeed different.
Closes-bug: #1490043
Change-Id: Idaf419a1464d9d0d75b9106a7acd5cd960a7c623
commit 3c9482eb78b8a1e459ea9876a3b9a977690fce0d
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Aug 28 08:55:42 2015 -0700
Reservations: Don't count usage if resource is unlimited
If a resource is unlimited (ie: limit<0) then there is no need
to verify headroom for it. This also means that there no need for
counting it; therefore it is possible to save some DB operations
by skipping the count phase.
Change-Id: Ibe9ca8a1c29fb8ba12df187c25f8f9515968a54d
Related-blueprint: better-quotas
commit 14ef151fe0ca193c341098fcd3910d5e523c140c
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Aug 25 02:28:08 2015 -0700
Restore reservations in API controller
This patch restores the reservation logic in the API controller,
as the DB issues arising from the pymysql switch has been solved.
Change-Id: I98b40925fdceba13d6a2b5a4d0c5793aeb5cf077
Related-Bug: #1486134
Related-Blueprint: better-quotas
commit a19e64c9d95781982d28113c667dbc90d0ea11eb
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Sep 11 14:46:51 2015 -0400
ovs: don't use ARP responder for IPv6 addresses
ARP does not support IPv6 addresses, so when we try to apply the flow, it
fails, with all other flows deferred for the same transaction. It results in
random flow breakages, depending on the order of the bad flow in the
transaction.
Change-Id: I0ecf167653e5a7d0916e091e05050406a026a1e2
Co-Authored-By: Thomas Carroll <Thomas.Carroll@pnnl.gov>
Closes-Bug: #1477253
commit 6ee4343c4ce90423ea6477216519bcb0ef21b816
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Sep 11 16:32:06 2015 +0200
Install sriov-agent.ini on 'setup.py install'
The previous change [1] that split the configuration file into two pieces
missed the update of setup.cfg, so the file was not installed.
[1]: Ie1eda925e051f85d53ad9624d6617d095cf8c7be
Change-Id: Idcdc71b5614463fc0d81a8bc2d2833159be9e6c9
Related-Bug: #1489060
commit c89a4fdd88b0f8832b32af55f64e0d3a35c84388
Author: sridhargaddam <sridhar.gaddam@enovance.com>
Date: Thu Sep 10 16:14:13 2015 +0000
Configure gw\_iface for RAs only in Master HA Router
For an HA Router which does not have any IPv6 subnets in the external network
and when ipv6\_gateway is not set, Neutron configures the gateway interface of
the router to receive Router Advts for default route. In an HA router, only
the Master instance has the IP addresses while the Backup instance does not
have any addresses (including LLA). In Kernel version 3.10, when the last
IPv6 address is removed from the interface, IPv6 proc entries corresponding
to the iface are also deleted. This is however reverted in the later versions
of kernel code.
This patch addresses this issue by configuring the proc entry only for the
Master HA Router instance instead of doing it un-conditionally.
Closes-Bug: #1494336
Change-Id: Ibf8e0ff64cda00314f8fa649ef5019c95c2d6004
commit fb8014294530ac83f209a79612c09c897d80227f
Author: Ryan Moats <rmoats@us.ibm.com>
Date: Fri Sep 11 07:41:38 2015 -0500
Remove useless log from periodic\_sync\_routers\_task
Logging that peridoic\_sync\_routers\_task is starting with fullsync
False just adds noise to devstack logs. Reposition the log
statement to indicate that the task is starting if it is going
to be doing real processing.
Change-Id: I73def1e20218b01c135769d0b8fbce449dad17ea
Signed-off-by: Ryan Moats <rmoats@us.ibm.com>
commit 0f44a874b421e7dc055f409cffddbe52ca96b956
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Thu Sep 10 13:48:46 2015 -0700
Replace is\_this\_snat\_host validation with internal function
There is already a function to validate if it is an snat
host or not. So just use that function instead of additional
validation.
Change-Id: I004d94d1d4b632880ed289ccdc9bf45cffc0e095
commit bcafe20a14048b90d1f3153dad6076e42bf571f5
Author: Assaf Muller <amuller@redhat.com>
Date: Thu Jun 11 17:13:44 2015 -0400
Add l2pop support to full stack tests
Add the l2pop mechanism driver to the ML2 plugin configuration, and set
l2\_population = True, in the OVS agent configuration.
Each test class can enable or disable l2pop in its environment.
Change-Id: If4f2bf07883b763073b5a53f1aa557acb131d176
commit a885c4075ad983b8d68c4843359fa3578c48b575
Author: Assaf Muller <amuller@redhat.com>
Date: Tue Jun 16 08:56:41 2015 -0400
Add tunneling support to full stack tests
\* EnvironmentDescription class now accepts 'network\_type'.
It sets the ML2 segmentation type, passes it to the OVS agents
configuration files, and sets up the host configuration. If
tunnelling type is selected, it sets up a veth pair with an IP
address from the 240.0.0.1+ range. The addressed end of
this pair is configured as the local\_ip for tunneling purposes
in each of the OVS agents. If network type is not tunnelled, it
sets up provider bridges instead and interconnects them.
\* For now we run the basic L3 HA test with VLANs and tunneling just
so we have something to show for.
\* I started using scenarios in fullstack tests to run the same test
with VLANs or tunneling, and because test names are used for log
dirs, and testscenarios changes test names to include characters
that are not shell friendly (Space, parenthesis), I 'sanitized'
some of those characters.
Change-Id: Ic45cc27396452111678cf85ab26b07275846ce44
commit 590ed69918efabc173144f170f2ea5ff0d445a78
Author: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
Date: Thu Sep 10 17:24:47 2015 +0900
Remove an unused DVR function
is\_dvr\_router\_interface isn't used since commit
c5fafcb30a5b86e87309ad4650f7d05a2ca038dc.
Change-Id: Id902e7b4aafcf61f8da29bf7ab543559ea6b7937
commit 29ac69ebe365b597ad5d1510381d3f02643edb3e
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Sep 10 10:51:10 2015 +0300
Handle ObjectDeletedError when deleting network ports/subnets
It appeared there is still a race on port deletion when deleting
networks. So commit a55e10cfd6369533f0cc22edd6611c9549b8f1b4
introduced a regression. It's a bit of ironic that commit message
was "Avoid DB errors when deleting network's ports and subnets".
Shame on me!
Closes-Bug: #1494157
Change-Id: I37727eca5d68e6440f0f93e0f6bbe63b2f18b443
commit d5a8074ec3c67ed68e64a96827da990f1c34e10f
Author: Stephen Ma <stephen.ma@hp.com>
Date: Fri Aug 28 14:00:48 2015 +0000
Descheduling DVR routers when ports are unbound from VM
When a VM is deleted, the DVR port used by the VM could be unbound
from the compute node. When it is unbounded, it is no longer
in use on the node. Currently the unbind doesn't trigger a check
to determine whether the DVR router can be unscheduled from the
L3-agent running on the compute node. This patch makes the check
and unschedule the router, if necessary.
Closes-Bug: 1489184
Change-Id: I882e0682bfc7695b3b23e36eb4d7e35a5d19748e
commit 81dd69caddced348ed26d7a732dc93c9bd10b953
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Sep 10 00:06:08 2015 +0000
Updated from global requirements
Change-Id: I78f123c8e49b6dcd23bda1def9e021df74ffb0ea
commit 4a8c2b875e4abb8e99d62f1530f209147faada2f
Author: ajmiller <al.miller@ajmiller.net>
Date: Wed Sep 9 14:38:41 2015 -0700
Reduce the chance of random check/gate test failures
As previously implemented, the TestTrackedResource class is designed
to inject random failures into the gate. It generates random numbers
within the range of 0..10000, and will fail if it generates duplicate
random numbers during its run.
This patch creates UUIDs instead of random numbers, and makes the
chance of an collision vanishingly small.
Change-Id: I0cf535d1c5a3995a50b506aafce10e983872dcb7
Closes-bug: #1494021
commit 9b7ff6d3bd4059699c54180aca02e11d5fe07f21
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Mon Aug 31 21:31:57 2015 +0000
Allow passing arbitrary ip route parameters to add/delete\_route
There are arguments to ip route like scope and dev that will need to
be passed to add\_route and delete\_route. This patch allows them to be
passed using kwargs.
Change-Id: I06d46bee9ca333c6a308d1af961bd9eadab9db97
Partially-Implements: blueprint address-scopes
commit 46e59d312a46d96860fc1226ec6024d10ef2b1e0
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Tue Sep 1 16:58:22 2015 +0000
Make ip address optional to add\_route and delete\_route
The add\_route and delete\_route methods require that the ip (actually
"via" in ip route terms) be passed. Some routes don't require this.
This patch makes it optional while maintaining the position for those
callers who do pass it by position.
Change-Id: Ic16408c00c77898d8f7663c92e56aa30427469f3
Partially-Implements: blueprint address-scopes
commit da4ee8c8d26880b6b1a20d18f5cbd38e7d5e4b04
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Fri Aug 28 21:28:39 2015 +0000
Add list routes
This adds list routes while refactoring list\_onlink\_routes to share
implementation. It changes test\_onlink\_routes to be consistent in the
type of data that it returns with the new list\_routes.
Change-Id: I386a8e2cb146385bb59a7a8387a29dddbec48d8a
Partially-Implements: blueprint address-scopes
commit 24fa37e05544316b58357b753360b147878e5d94
Author: lzklibj <lzklibj@cn.ibm.com>
Date: Mon Mar 2 02:13:41 2015 -0800
Fix dvr update for subnet attach multi subnets
Fix method dvr\_update\_router\_addvm to notify every
router attached to subnet where the vm will boot
on.
In dvr case, when a subnet only attaches to one router,
the subnet will only have one distributed router interface,
which device\_owner is "network:router\_interface\_distributed".
So in this case, get\_ports in this method will only get
one port, and it should be unnecessary to break in for loop.
But when a subnet attaches multiple routers, get\_ports in
this method will return all distributed router interfaces
and the routers hold those interfaces should be notified
when an instance booted on the subnet. So it should also
be unnecessary to break in for loop.
Change-Id: I3a5808e5b6e8b78abd1a5b924395844507da0764
Closes-Bug: #1427122
Co-Authored-By: Ryan Moats <rmoats@us.ibm.com>
commit 7bd30aa49c24dc65332740e4fa74da28533b92ed
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Fri Aug 28 21:19:40 2015 +0000
Make ip rule comparison more robust
I found that ip rules would be added multiple times in new address
scopes code because the \_exists method was unable to reliably
determine if the rule already existed. This commit improves this by
more robustly canonicalizing what it reads from the ip rule command so
that like rules always compare the same.
Change-Id: I6d0c208f0ed8e65cdb750789321a7ad6ca1b77c2
Partially-Implements: blueprint address-scopes
commit ce5761f15388888038f9c39da886cd0343b734fc
Author: Andrey Kurilin <akurilin@mirantis.com>
Date: Wed Sep 9 16:48:59 2015 +0300
Remove hack for discovery novaclients extension
novaclient provides a common way to discover all extensions, so we can
remove import based on novaclient versioned client object.
Closes-Bug: #1493886
Change-Id: I7ae2eeb2d7e5c56e9284f3b059ff6e3545f42d5f
commit 91c476dcc5cd2192d0c43ca51a1b258b9c331fc4
Author: huangpengtao <huangpengtao@huawei.com>
Date: Sun Aug 30 10:43:50 2015 +0800
Check ICMP codes in range [0,255]
ICMP allows codes between 0 and 255, this change
adds a check for codes range min value.
DocImpact
APIImpact
Closes-Bug: #1486300
Change-Id: Ic7a49458448fad16447b914bb15742515661a851
commit cc9957c747b3caa84ea52c7960d863e587ac66ac
Author: Carl Baldwin <carl.baldwin@hpe.com>
Date: Tue Sep 8 21:04:23 2015 +0000
Remove address scopes from supported extensions
This feature is not ready for prime time, but the cli code is
already landed and shipped.
In order to prevent users from getting mad about an uncooked feature,
let's disable it until it becomes more robust.
Tests must be disabled unconditionally because our CI API test framework
execute tests for 'all' extensions available.
Related-blueprint: address-scopes
Change-Id: I71dc333e210b1f4acf30569711b4442ed8a1dfc3
commit bbaa4abdd5500d30576d63b5a5eb1503363e2f67
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Wed Sep 9 14:32:36 2015 +0300
Add test to check that correct functions is used in expand/contract
This test will check that expand branch does not contain drop SQLAlchemy
operations and contract branch does not contain create/add SQLAlchemy
operations.
Partially-Implements: blueprint online-schema-migrations
Change-Id: Ifda31c0599651931c1a98f673f3b10e64538f18b
Related-bug: #1490767
commit bd07b74045d93c46483aa261b8686072d9b448e8
Author: Moshe Levi <moshele@mellanox.com>
Date: Tue Aug 25 15:50:09 2015 +0300
SR-IOV: devstack support for SR-IOV agent
Change-Id: Ia0649962bd0c68d9c99fd54cc84ce8dd67d792e8
commit 4d831a462e2510ab080be7abae49ca3cff056e61
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Sep 1 15:15:53 2015 +0300
Fix test\_external\_tables\_not\_changed
test\_external\_tables\_not\_changed was not
executed properly as new engine was created in env.py.
Related-bug: #1466704
Change-Id: If02415d7abd17024946f7aee8fb6abc374a7aefe
commit 37430d4bd096a04a0b3e23165ac244ac1f47a774
Author: Yi Zhao <zhaoyi@cmss.chinamobile.com>
Date: Thu Aug 27 15:24:21 2015 +0800
Delete gateway conntrack state when remove external gateway
This fixed the problem that a gateway ip conntrack state not cleared
when user clears a router external gateway.
Change-Id: I77f22d9504430259b01366e6296a99ba1cd6a046
Closes-Bug: #1488730
commit 319920303a22988e418a982eef60f67af321148b
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Sep 8 22:03:54 2015 +0000
Updated from global requirements
Change-Id: Ib9d2e669f3d6e68cced7cd6674ff23ff7642f997
commit 7ca5a26c982084ed0b4cf036917a64580da6385c
Author: Mike Bayer <mike\_mp@zzzcomputing.com>
Date: Fri Aug 14 14:44:28 2015 -0400
Add non-model index names to autogen exclude filters
The SQLAlchemy MySQL dialect generates implicit indexes
in the less-common case of an integer column within a composite
primary key where autoincrement is not set to False.
Add a rule to ignore these indexes when performing
autogenerate against a target database.
Change-Id: I49abb3f7ad9731cde046fa2862cdb9ec16c3aeb3
Partially-Implements: blueprint online-schema-migrations
commit 6576bea07c6c268b16e6c1f118b858e698452e2b
Author: Mike Bayer <mike\_mp@zzzcomputing.com>
Date: Mon Jul 20 18:34:15 2015 -0400
Implement expand/contract autogenerate extension
Makes use of new Alembic 0.8 features to allow
altering of the "alembic revision" stream such
that operations for expand and contract are
directed into separate branches.
Change-Id: Ifa743e2f5b90e59a8de8f4e7a67c4bbe46686804
Partially-Implements: blueprint online-schema-migrations
commit cd45f16442b7c56c4876bef527c9c83ea0907c40
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Mon Jun 22 17:17:15 2015 -0700
Cleanup the fip agent gateway port delete routines
Based on the parent patch, right now the Floatingip
agent gateway ports will only be deleted when the
last gateway port associated with the external
network is deleted.
The Floatingip agent gateway port will not be deleted
for every floatingip dis-association and deletion.
The Floatingip agent gateway port was created on all
nodes as a substitute for the gateway port. So it
makes sense to delete those ports only when the last
gateway port on the external network is deleted.
The agent should be able to delete the floatingip agent
gateway port on a given external network when it is not
required.
This would substantially reduce the burden on the server
to validate, read and delete the port form the DB.
Change-Id: Ie561b19a2e58a2a563d79b75421e9e24c70f36f9
Closes-Bug: #1468007
Closes-Bug: #1408855
Closes-Bug: #1450982
commit 639f1893dde0d393a97b29ca5309dba716831a7f
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Mon Jun 22 16:50:43 2015 -0700
Add RPC command and delete if last FIP on Agent
Today FloatingIP Agent gateway port is deleted and
re-created for DVR based routers based on floatingip
association and disassociation with VMs on compute
nodes by the plugin.
This introduces lot more strain on the plugin to
create and delete these ports when VMs come up and
get deleted that are associated with FloatingIps.
This patch will introduce an RPC call for the agent
to initiate a agent gateway port delete.
Also the agent will look for the last floatingip that
it manages, and if condition satisfies, the agent will
request the server to remove the FloatingIP Agent
Gateway port.
Change-Id: I47694b2ee60c363e2fe59ad5f7d168252da08a45
Related-Bug: #1468007
Related-Bug: #1408855
Related-Bug: #1450982
commit d5aa1659f56601d8f4d5e17273d5ade7a0e202dd
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Mon Jun 22 16:33:32 2015 -0700
Delete FIP agent gateway port with external gw port
FIP agent gateway ports are associated with external
networks and specific host.
Today FIP agent gateway ports are deleted for
every floatingip associate and disassociate. This
introduces race conditions in the port delete and also
un-necessary access to the db.
This patch will delete the FIP agent gateway port when
the last gateway port of the external network is deleted.
The child patch linked to this parent patch will clean
up the FIP agent gateway port delete when associate,
disassociate and delete of floatingip happens.
This should also cover the case when an agent for some
reason was unable to request agent gw port delete.
(agent died).
Related-Bug: #1408855
Related-Bug: #1468007
Related-Bug: #1450982
Change-Id: I6637a771e6a6ce74e848cb74b779043e16a54a84
commit b62b92da9b9dbba953573bc212279c719e08f3ef
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Sep 8 15:23:49 2015 +0000
Remove ebtables\_driver/manager dead code
Previous changes[1] have been merged as enablers[2] to fix the bug
1274034 but an alternative solution has been choosen and now we can
consider the introduced code as dead code.
This changes removes [2], associated tests and rootwrap filters.
[1] I9ef57a86b1a1c1fa4ba1a034c920f23cb40072c0
I3c66e92cbe8883dcad843ad243388def3a96dbe5
[2] neutron.agent.linux.ebtables\_driver
neutron.agent.linux.ebtables\_manager
Closes-Bug: #1493422
Related-Bug: #1274034
Change-Id: I61e38fc0d8cf8e79252aabc19a70240be57e4a32
commit bbca973986fdc99eae9d1b2545e8246c0b2be2e2
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Aug 25 22:03:27 2015 -0700
Stop device\_owner from being set to 'network:\*'
This patch adjusts the FieldCheck class in the policy engine to
allow a regex rule. It then leverages that to prevent users from
setting the device\_owner field to anything that starts with
'network:' on networks which they do not own.
This policy adjustment is necessary because any ports with a
device\_owner that starts with 'network:' will not have any security
group rules applied because it is assumed they are trusted network
devices (e.g. router ports, DHCP ports, etc). These security rules
include the anti-spoofing protection for DHCP, IPv6 ICMP messages,
and IP headers.
Without this policy adjustment, tenants can abuse this trust when
connected to a shared network with other tenants by setting their
VM port's device\_owner field to 'network:<anything>' and hijack other
tenants' traffic via DHCP spoofing or MAC/IP spoofing.
Closes-Bug: #1489111
Change-Id: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9
commit c0ee8cbcbf98698411e3618b95b1d8c7676c76ad
Author: Assaf Muller <amuller@redhat.com>
Date: Tue Sep 8 10:48:11 2015 -0400
Add oslo rootwrap daemon logging during functional tests
Change-Id: Ie688a1df6e256c0195b8f3937228f65c0463e9c3
Closes-Bug: #1493396
commit d6d0853be34ce783b133a9c39aeb608033f3073b
Author: Aman Kumar <amank@hp.com>
Date: Tue Mar 17 03:41:54 2015 -0700
ovs agent resync may miss port remove event
In OVS Agent rpc\_loop() resync mechanism clears the registered ports and
rescans them again, and it might result in missing some "port removed"
event and treat\_devices\_removed will not be called.
This fix rescans the newly updated ports when resync mechanism called,
without clearing the current registered ports.
The registered ports will be cleared only if there are too many
consecutive resyncs to avoid resycing forever because of the same
faulty port.
Closes-Bug: #1329223
Co-Authored-By: Andrey Epifanov <aepifanov@mirantis.com>
Co-Authored-By: Gandharva S <gandharva.s@hp.com>
Co-Authored-By: Romil Gupta <romilg@hp.com>
Co-Authored-By: Rossella Sblendido <rsblendido@gmail.com>
Change-Id: Ib0db9dcf889d9fd90b623857782c9a6b091e18f5
commit 1b67012794932a06ce90976f9759fc588da269b5
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Sep 8 11:20:10 2015 +0200
tests: disable process monitor before managers
Otherwise the monitor may respawn managers later, leaving them running.
Issue spotted in:
http://logs.openstack.org/02/216902/4/check/gate-neutron-dsvm-functional/a97df90
Change-Id: I0e68b06c87b5770756fdf7b9201e1986cc67e07b
Related-Bug: #1490051
commit 4b2e6842f320405cd963f560bc06849b4b7bb1eb
Author: armando-migliaccio <armamig@gmail.com>
Date: Mon Sep 7 04:53:50 2015 -0700
Retry metadata request on connection refused error
This testcase may fail intermittently on 'Connection refused' error.
This could be due to the fact that the metadata proxy setup is not exactly
complete at the time the request is issued; in fact there is no
synchronization between the router being up and the metadata request being
issued, and clearly this may be the reason of accidental but seldom failures.
In order to rule out this possibility and stabilize the test, let's retry
on connection refused only. If we continue to fail, then the next step would
be to dump the content of iptables to figure out why the error occurs.
Closes-bug: #1461172
Change-Id: I65a5bf4fbbcad6ba93a46d36cabe7844ff528d8d
commit 9e178e42e46317a6f1ac7688340f0f84e4c16c80
Author: Sergey Belous <sbelous@mirantis.com>
Date: Thu Sep 3 16:53:21 2015 +0300
Add ability to use custom config in DHCP-agent
This patch doesn't changes behaviour of dhcp-agent
but adds the opportunity to use user-defined config,
that will make dhcp-agent more flexible
and allows to run functional tests correctly
(without changing global oslo.config CONF)
Closes-Bug: #1492283
Change-Id: Ice807e8fc872b56bb3960b7a3de4110c7675d9d6
commit 7da1724d446b6804c6be7a602532fbae58d9f008
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Aug 25 02:21:06 2015 -0700
Improve DB operations for quota reservation
This patch deals with the lock wait timeout and the deadlock errors
observed under high concurrency (api\_workers >= 4) with the pymysql
driver. It includes the following changes:
- Stop setting dirty status for resource usage when creating
reservation, as usage of reserved resources is not tracked anymore;
- Add a variable, increasing delay when retrying make\_reservation
upon a DBDeadlock error in order to reduce the chances of further
collisions;
- Enable transaction retry upon DBDeadlock errors for set\_quota\_usage;
- Do not resync quota usage while making reservation. This puts a lot
of stress on the database and is also wasteful since resource usage
is very likely to change again once the transaction is committed;
- Use autonested\_transaction to simplify logic around when the
nested flag should be used.
Change-Id: I7a335f9ebea3c0d6fee6e6b757554e045a66075c
Closes-Bug: #1486134
Related-Blueprint: better-quotas
commit 13901bdf6941d17069073f489798faaa86151fae
Author: Moshe Levi <moshele@mellanox.com>
Date: Tue Aug 18 08:48:24 2015 +0300
Qos SR-IOV: Refactor extension delete to get mac and pci slot
When calling delete we need the pci slot details to reset the VF rate. The problem
is that when the VM is deleted libvirt return the VF to the hypervisor and eswitch
manager will mark the pci\_slot as unassigned so can't know from the mac which pci slot (VF)
to reset. Also newer libvirt version reset the mac when deleteing VM, so than it is
not possible at all.
The solution is to keep pci slot details locally in the agent since upon removal event
you cannot get pci\_slot from the neutron server as it is for create/update since port
is already removed from neutron.
This patch pairs the mac and pci\_slot for a device (VF) so when calling the extension
port delete api we can have the pci\_slot and reset the VF rate.
It is also add a mapping between mac to port\_id so we can pass the port\_id
when calling the extention port delete api.
Partially-Implements: blueprint ml2-sriov-qos-with-bwlimiting
Closes-Bug: #1492909
Change-Id: Icc3a9599c6d7a4de9c56b452dfab7909c8d0a576
commit b89879c286cdc5718ee540c2c581a3f500c18b3e
Author: root <mamtaprabhu@in.ibm.com>
Date: Sat Sep 5 10:47:41 2015 -0700
Adds support to provide the csum option for the OVS tunnels
The new option for the ovs agent will enable to set/unset the
csum option for the vxlan/gre tunnels. The default is maintained as False.
Change-Id: I18dcd8946b585e70f8890a5c222ea37059c4a0c5
Implements: bp ovs-tunnel-csum-option
Closes-bug: #1492111
commit 597be0028952f57e6083a674d724978cd9fe599c
Author: huangpengtao <huangpengtao@huawei.com>
Date: Sun Sep 6 23:32:49 2015 +0800
Delete the useless variable agent\_host
Change-Id: I7fb9da4b4b5316ddbc93a89317ee57718da178d3
commit 42f80682d3eff58af60199f817ac402f457491a0
Author: Neil Jerram <Neil.Jerram@metaswitch.com>
Date: Sun Sep 6 01:09:16 2015 +0100
Handle process disappearing before we ask for its PPID
Change-Id: I573aba8e11dca16f8a6565f7e9704be18e938566
Closes-Bug: #1478190
commit 6d51ef5d2e275d0d260a592d3ab8ed8a76a63421
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Sep 3 16:31:33 2015 +0300
OVS agent: handle deleted ports on each rpc\_loop iteration
Currently rpc loop processes ports only in case polling is required
(message from ovsdb monitor) or there are port\_updated notifications from
server or security group notifications.
In case of just port\_deleted notifications port processing is not
triggered during rpc loop.
This may lead to agent accumulating a big amount of deleted ports
and processing all of them at once during next iteration when polling is
required or any notification from server, which might be quite tough for
the agent. Tough means agent will be irresponsive while processing deleted
ports.
The patch makes port deletion processing more gradual.
Closes-Bug: #1491922
Change-Id: I0e1f6dfbf5b56fb18a978d6214e1768560d8ac98
commit b61cd4eaedc3a65657d5dbf8b09ec3c39f250637
Author: Shweta P <shpadubi@cisco.com>
Date: Thu Aug 27 16:53:13 2015 -0400
Final decomposition of Cisco plugin
This patch follows the previous patch(listed as dependent) and moves
the remaining cisco db models from neutron to networking-cisco.
The patch deletes l3\_model and cisco\_router\_plugin and their associated
config and helper files from neutron
Change-Id: I5b71e1dfb683e633e1cd11386dfb7c2ed7cc7d62
Partial-Bug: #1489609
commit d12017ad511a202a12422245cce6204a5731250c
Author: Abhishek Raut <rauta@vmware.com>
Date: Mon Aug 10 20:52:15 2015 -0700
Remove Cisco Meta and N1KV monolithic plugins
This patch removes the Cisco meta plugin and the Cisco
Nexus1000V monolithic plugin as they were deprecated in the
previous cycle.
Closes-bug: #1473217
Change-Id: Id170b9512b2f52a971264336d83b083d487359ee
commit 065275e51ff3852462586d01f5d3dd750bf2d663
Author: Robert Collins <rbtcollins@hp.com>
Date: Sat Sep 5 16:04:42 2015 +1200
Workaround test stream corruption issue.
Change-Id: I4c88f1891f53c6559bca71bf657aa30df2101280
Closes-Bug: #1492505
commit ad9aaa63e5ea427d24c07e6a36a2976d83f1a26f
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 18:27:42 2015 -0700
Fix RBAC filter query for negative case
The query to find networks that aren't shared to the querier was
broken. It was querying for the inverse of RBAC entries that shared
to the querier, so it would return the network for each other tenant
it was shared to. This meant that if a network had multiple RBAC
entries, a shared=False filter wouldn't work in the API.
This patch corrects the behavior by adjusting the query that looks
for objects not shared to the caller to make sure the object ID doesn't
appear in the shared subquery.
This patch also adds a test that reliably reproduces the original issue.
The sporadically failing filter test that revealed this issue depended
on a race to have a network be shared to another tenant and to the wildcard
at the same time.
Change-Id: I9dcd869c1640b223221ba12e97284bbfcabbeb2b
Closes-Bug: #1495040
commit 1886964890e1ba9d13df43d0caeff1546f2090a9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Fri Sep 4 23:06:43 2015 +0000
Updated from global requirements
Change-Id: I6f3dbf989cb6d9d110c2ee6a3a2e2b557bced28f
commit ed3c317ed9182538747f74713154ad94e9d866db
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Sep 4 22:21:41 2015 +0200
Fixed functional test that validates graceful ovs agent restart
The async\_ping function returns a callable that returns True when all ping
futures are done. Since those futures are running for 10 secs, there was no
chance that the result of the callable was True.
The test was bailing out without calling bridge reset even a single time,
effectively leaving the feature untested in gate.
Another thing to note is that for some reason the patch fixed oslo rootwrap
errors in the test when executed locally. Since I still don't understand how
it's possible that it fixes the issue for me, I mark the bug as related only,
and will track logstash after it's merged to see whether it applies unknown
magic to gate jobs too.
Change-Id: Iaa977abddf1a0c6af7e964f1a5cd545ffb79585a
Related-Bug: #1490051
commit 1b25e30800c869dacca58afa6b8bf92f4cf9d377
Author: rossella <rsblendido@suse.com>
Date: Wed Aug 26 16:06:25 2015 +0000
\_bind\_devices query only existing ports
If a port is deleted right before \_bind\_devices is called,
get\_ports\_attributes will throw an exception since the row
corresponding to the port doesn't exist in the OVS DB.
Avoid that setting if\_exists to True. The port will be
processed as deleted by the agent in the following iteration.
Change-Id: Ia6590d76f8683e6cba562cde3c39b051549f6c04
Closes-bug: #1489014
commit a93886278f1308ae78c65b4ad36ee7648cad2914
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 05:33:46 2015 -0700
Stop logging deadlock tracebacks
The oslo db retry decorator logs a traceback everytime a deadlock
is encountered even though it is being retried. With multiple workers
and a Galera cluster, deadlocks are common occurences due to our use
of with\_lockmode update so we should not be polluting the logs.
This patch adjusts our usage of the retry decorator to catch deadlocks
with the exception checker which does not log them until the retries
are exhausted.
Change-Id: I433fbbad61070e20ebe934b9247e36fc190fa3e0
commit e959e474d65211991c12f9495b227da5e4d99ed7
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 04:22:35 2015 -0700
Don't log exceptions in GW update on router create
The LOG.exception statement is not necessary because the exception
is re-raised so if it's a real error it will be logged like any
other failure.
Related-Bug: #1494886
Change-Id: I29aacd8c1187ddf8653009865ed9a62be948c5a7
commit 9b66c82483ab70caf3e09d8dcf5cb8d4d4ecfd60
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Sep 4 04:28:58 2015 -0700
Remove an unnecessary extension check for rbac
This removes some logic to detect the RBAC extension
that was written when RBAC was being developed as a
service plugin. Since it's part of db base plugin there
is nothing to enable in devstack so it's not necessary.
Change-Id: I37f8060c14d8ad74f5cea649c18ee9ef3912cb2d
commit da81ae88929c389f0ba8660c4c8dfb79eec7c0fd
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Sep 3 15:13:25 2015 +0300
OVS agent: flush firewall rules for all deleted ports at once
In some cases, under high load OVS agent has to delete a big amount of
ports during rpc\_loop. remove\_devices\_filter() does iptables-save/restore
for IPv4 and IPv6 which is 4 system calls. It is very expensive and
inefficient to call it for each port individually.
Closes-Bug: #1491922
Change-Id: I4cfb2dfcef5088436c7aaae22c8f66e1ea052311
commit ef409d9da2ecbf12f9916a9a933231146538cf04
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Sep 1 21:45:55 2015 +0200
Enable most unit tests for py34 job
\* Skip TestWSGIServerWithSSL[1] for Python 3 since it seems wsgi + ssl +
eventlet setup does not behave correctly now,
\* Skip test\_json\_with\_utf8[2] until we solve unicode/utf8 encode/decode,
\* Fix some more tests to pass for py3,
\* Replace print by print() in docs/docstrings.
[1] neutron.tests.unit.test\_wsgi (bug 1482633)
[2] neutron.tests.unit.test\_wsgi.JSONDictSerializerTest (bug 1491824)
Related-Bug: #1482633
Related-Bug: #1491824
Blueprint: neutron-python3
Co-Authored-By: Cyril Roelandt <cyril@redhat.com>
Co-Authored-By: Cedric Brandily <zzelle@gmail.com>
Co-Authored-By: sonu.kumar <sonu.kumar@nectechnologies.in>
Change-Id: I26e513d4dcf473f4cd79728382fc94af3d901b5d
commit cd524065e2ac4f48d8b9810fa9735f0fd925c4d8
Author: Tu Hong Jun <tuhongj@cn.ibm.com>
Date: Thu Aug 20 14:08:07 2015 +0800
Changed filter field to router\_id
The get\_sync\_interfaces query will always return all router ports
from database even it is supposed to query specific ones that
belong to a certain router. In large L3 scale environment with
number of route ports in place, this would lag the response time
for adding router interface and router L3 agent binding.
Closes-Bug: #1489671
Change-Id: Ib78ca766f91783ad2ecca5b728c31602b4ed15d8
commit 997aa86fa12e3209b65741ef95906d491895a493
Author: Sergey Vilgelm <sergey@vilgelm.info>
Date: Mon Aug 31 17:06:48 2015 +0300
Fix a wrong condition for the \_purge\_metering\_info function
Fix a situation for the \_purge\_metering\_info function
when the items will never be deleted from the metering\_info.
Delete the metering\_info dict and use the metering\_infos instead.
Fix the problem with changing a dictionary during iteration.
Add the unit tests for the \_purge\_metering\_info and
\_add\_metering\_info functions.
Co-Authored-By: Yaroslav Isakov <yisakov@mirantis.com>
Change-Id: I9031a5f27ae6438ffd5c5a48b0cf5cdc6867eff3
Closes-Bug: #1490581
commit 2d65cccba29220e46b490871210014b94f086984
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Sep 3 17:43:37 2015 -0700
Don't log deadlock or retry exceptions in L3 DB
We don't want to log exceptions in the l3 DB that will be retried
by the DB retry decorator because it will look like a failure in
the log when it actually ends up being retried.
Change-Id: I024fc2db9022809194178c227d994bc6ed33c78b
Closes-Bug: #1494886
commit f347939fd6c7b5a9e93af2007a0c01d00f29dc2b
Author: armando-migliaccio <armamig@gmail.com>
Date: Thu Sep 3 10:29:12 2015 -0700
Make sure service providers can be loaded correctly
This patch fixes a regression where, if neutron was loaded using
--config-dir, the service\_providers option was no longer available.
We bring the logic back (removed by 61121c5f2af), alongside the ability
to load the option auto-magically. This is especially required for DevStack
deployments as of today, because neutron-server is only loaded by passing
--config-file (...)neutron.conf and --config-file (...)ml2\_conf.ini
Change-Id: I9bfaed9e19a5506e27795a0b7ad47f4c31fefa40
Closes-bug: #1490990
commit 9c466f4d0effa4686ca6744d7b9d015857830cb7
Author: Roman Bogorodskiy <rbogorodskiy@mirantis.com>
Date: Wed Jun 24 14:40:35 2015 +0200
sriov: update port state even if ip link fails
Some SRIOV drivers/devices don't support link state setting,
meaning that 'ip link' fails like this when trying to set state:
# ip l set dev p2p1 vf 6 state disable
RTNETLINK answers: Operation not supported
The sriov-nic-agent tries to do that in
SriovNicSwitchAgent.treat\_device() and fails because of non-zero
exit status from 'ip link' and, therefore, doesn't reach the code
that updates the actual port status, so port could hang in a BUILD
state even if binding was successful.
This patch fixes problem of nova not being able to successfully bind
or cleanup such a port. It does not fix a case when user manually
updates admin\_state\_up for a port via API, it's subject to a separate
fix.
Also, replace LOG.exception with LOG.warning for set\_device\_state()
as the exception would be logged by PciDeviceIPWrapper.set\_vf\_state()
anyway.
Closes-bug: #1468332
Change-Id: Ifa7c128d369ced60b5986aa0ed92527868f7efab
commit a97fd4dabb31019ac7926b4445cd8d8f319b1b6a
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Sep 2 17:23:56 2015 -0700
Retain logs for functional test cases
This helps greatly the debugging process in face of race conditions.
Change-Id: I74235307183cbb15a7179b18b417b38ffb1d2cc9
commit da1ac497d2d10d008925311e3f14e9750f7b86b2
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Sep 2 06:50:36 2015 -0700
Don't setup ARP protection on OVS for network ports
Skip adding ARP spoofing protection on OVS ports with a
device\_owner field starting with 'network:'. This is
already the case for the other iptables-based spoofing
protection and is necessary for floating IPs to function
correctly on router gateway ports.
Closes-Bug: #1487338
Change-Id: I32cef17ff47fd62e6db16b9083104f07239be25f
commit 051ff13771026b015c893a19a89654bf2ca4d018
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Sep 2 07:04:55 2015 -0700
Don't setup ARP protection on LB for network ports
Skip adding ARP spoofing protection on Linux bridge ports
with a device\_owner field starting with 'network:'. This is
already the case for the other iptables-based spoofing
protection and is necessary for floating IPs to function
correctly on router gateway ports.
Change-Id: If53733fb3060e5ab44bac5388f42bdc384bcdb93
Closes-Bug: #1483315
commit 9f6bd17703b7286be9e7d439d15f4dec2774e13a
Author: Terry Wilson <twilson@redhat.com>
Date: Mon Jun 15 22:52:28 2015 -0500
Add support for PluginWorker and Process creation notification
There are several cases where plugin initialization should be
handled after neutron-server forks API/RPC workers. For example,
starting a client connection to an SDN controller before forking
copies the fd of the socket to the child process, but then you have
multiple processes trying to read/write the same socket connection.
It is also useful for a plugin to be able to do something in only
one process, regardless of how many workers are forked. One example
would be handling syncing from an external system to the neutron
database.
This patch does 3 things:
1) Treats rpc\_workers=0 as = 1. This simplifies the code for
handling notification that forking has completed. In the
existing code, calling the notification in the Worker object's
start() method would happen twice in the case where both api
and rpc workers were 0, despite there being only one process.
An earlier patch already changed the default api\_workers to be
the number of processors.
2) Adds notification of forking via the callbacks mechanism.
Plugins can subscribe to resources.PROCESS, event.AFTER\_CREATE
and do any post-fork initialization that needs to be done for
every spawned process.
3) Adds core/service plugin calls to get\_workers() which defaults
to returning (). Plugins that need additional processes to spawn
should just return an iterable of NeutronWorkers that will be
spawned in their own process.
DocImpact
Closes-Bug: #1463129
Change-Id: Ib99954678c2b4f32f486b537979d446aafbea07b
commit bd734811753a99d61e30998c734e465a8d507b8f
Author: Nick <skywalker.nick@gmail.com>
Date: Sun Jul 19 22:41:27 2015 +0800
Implement external physical bridge mapping in linuxbridge
In some deployment scenario, it is not allowed to remove system
ethernet configuration from physical interface to newly-created
physical bridge by neutron due to some IT regulations.
End-users require to take advantage of the pre-existed(user-defined)
physical bridge to connect tap devices for neutron.
Closes-Bug: #1105488
Implements: blueprint phy-net-bridge-mapping
DocImpact
Change-Id: Ia0eaa6233d8da93da32e86404b15184b77937d0a
commit a55e10cfd6369533f0cc22edd6611c9549b8f1b4
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Wed Aug 12 20:02:01 2015 +0300
Avoid DB errors when deleting network's ports and subnets
DB errors may occur when accessing query results
after the transaction was closed (like ObjectDeletedError).
Hence it's better to avoid DB object access especially
when it's not needed.
This patch changes \_delete\_ports() and \_delete\_subnets() to accept
only ids. Indeed, there is no need to pass db objects to these methods.
Closes-Bug: #1484135
Related-Bug: #1454408
Change-Id: I7507cb1c85defb2e6d5144e5832aea713d6251ae
commit 8c3cb79aa54b0ffcdc840c7e95ab809835d05001
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Aug 27 22:12:48 2015 -0700
Better message on allowed address pairs error
Neutron was throwing a 500 error when a non-iterable was passed
into allowed address pairs. This patch just catches that and
converts it into a regular badrequest message.
Closes-Bug: #1477829
Change-Id: I3c6f55df4912c7a9480fa097988f910b254572fd
Signed-off-by: Kevin Benton <blak111@gmail.com>
commit cc20673d673113974c78a2b17a9ff4da47ad6665
Author: Assaf Muller <amuller@redhat.com>
Date: Sat Aug 29 11:32:19 2015 -0400
Add info to debug test\_keepalived\_respawns gate failure
Current theory is that there's a bug in external\_process.active,
it returns True when it shouldn't, then kill -15 on the process
pid fails because the process isn't up. Added ps -p output to
see if the process is up or not.
Change-Id: Ic062be829d5f05a1294f6b2fa54820422871ffcb
Related-Bug: #1490043
commit d02bcb9c3917028948b08c319d1443d487c36846
Author: Hirofumi Ichihara <ichihara.hirofumi@lab.ntt.co.jp>
Date: Tue Aug 25 09:10:00 2015 +0900
Enable to update external network subnet's gateway-ip
This patch enables users to update gateway\_ip of a subnet even if
the subnet is in use for an external network of a router.
Change-Id: I78d2b024c99b1af0001bd454465d2fc02692cbf2
Closes-Bug: #1317363
commit c43cc3eb20101b2d2b19344690fed9892383621b
Author: James Arendt <james.arendt@hp.com>
Date: Fri Aug 28 16:33:44 2015 -0700
Make Neutron service flavor save service\_type
While the service\_type exists in the resource attributes and as
a database field for a Flavor, the creation dictionary did not
pass the value so the service\_type was not being persisted
in the database nor returned.
Enhanced unit test to show problem. Test fails on old code
to save or return the input service\_type.
Change-Id: I4dba287f5972ecebd193d65e7f542dd0a65f055b
Closes-Bug: 1490063
commit db4ea4517886741c2bd3e15e39bee0ecbd1356ae
Author: James Arendt <james.arendt@hp.com>
Date: Wed Aug 26 16:53:24 2015 -0700
Add tenant\_id to flavor service profiles attributes
Neutron v2 base.py auto populates a 'tenant\_id' attribute on
calls if the attribute is not passed. This causes a POST
to create a flavor service binding to fail when verifying
attributes with:
Unrecognized attribute(s) 'tenant\_id'
Solution is to add tenant\_id as expected attribute in the
attribute map as done in other sub resources like QOS.
Fix unit test for non-keystone case.
Change-Id: Ic2bd1271f297fc10b49304ffd5fe617637e3d8f4
Closes-Bug: 1489197
commit 9022fb1ae8f90df59c4da64450eb96de8c011715
Author: armando-migliaccio <armamig@gmail.com>
Date: Mon Jul 27 14:11:46 2015 -0700
Remove implicit registration of \*-aas service providers
Implicit registration can be dropped when explicit registration
for load balancer and vpn is implemented. Firewall does not
use service providers and the ServiceTypeManager, so the
precautionary step can be dropped altogether.
Support for configuring providers via the service\_providers section
in neutron.conf, is no longer available, hence clear the stale
entry points.
DocImpact
Closes-bug: #1473110
Change-Id: I5e1d254b9a3a24121d9e9d3cb82f877d44079296
commit 0a258afc7ee3c03974dffa2c0dd0b7b367034cc7
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Aug 28 00:50:59 2015 -0700
Process user iptables rules before INVALID
Process user-defined iptables rules before the INVALID DROP
rule. This is to allow scenarios where the VMs need to
legitimately receive packets that conntrack doesn't have an
entry for (e.g. SYN-ACK where the SYN wasn't sent by the VM).
A user can accomplish this by adding an allow rule that matches
the headers of these INVALID packets so they get permitted before
they hit the INVALID DROP rule.
Closes-Bug: #1460741
Change-Id: Ie6ce5f3fa688f1bf25b77db5955211922d9fe85b
commit b3e7e21c32a251ba0b7123aa909edeaedd08152a
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Mon Mar 2 16:40:11 2015 +0900
OVS-agent: Introduce Ryu based OpenFlow implementation
Introduce an alternative OpenFlow implementation, "native",
implemented using Ryu ofproto python library from Ryu SDN Framework.
Make it selectable with of\_driver=native agent option.
The aim is to replace the existing ovs-ofctl based implementation
eventually.
It introduces node-local OpenFlow controller embedded in
OVS agent. Benefits include:
\* Reduce the overhead of invoking ovs-ofctl command (and associated
rootwrap)
\* Make future uses of OpenFlow asynchronous messages (e.g. Packet-In,
Port-Status, etc) easier
\* Make XenAPI integration simpler
Highlights:
\* Switch to OpenFlow 1.3.
\* Make OVS-agent act as an OpenFlow controller
\* Configure OVS on the node to connect to the controller
DocImpact
Implements: blueprint ovs-ofctl-to-python
Co-Authored-by: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
Change-Id: I02e65ea7c6083b2c0a686fed2ab04da4d92b21a3
commit 5aab6a577950525d8f656d373f2e46a229fa600b
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Sep 1 19:35:33 2015 -0700
Deprecate external\_network\_bridge option in L3 agent
This option provides another way to attach to a specific bridge
that is not quite equivalent with how bridge\_mappings work in the
L2 agent. This creates inconsistencies between how the L3 agent
behaves when configured with a bridge\_mapping and provider properties
of the Neutron network vs. when it just ignores all L2 stuff and
plugs itself directly into the bridge.
See the bug report for more info.
Change-Id: I37de3cd6eaaf34856fa72753f471f4f0a9381836
Closes-Bug: #1491668
commit e10b008f7a2a1cb45ae5f77082f8d45b51274489
Author: salvatore <salv.orlando@gmail.com>
Date: Fri Aug 21 10:44:25 2015 +0200
Do not track active reservations
Reservations have a transient nature: a reservation lifespan
typically begins and ends with a single request.
Therefore tracking reserved amounts for each tenant and resource
is not nearly as efficient as tracking resource usage.
Indeed it is fairly easy to verify that the overhead for tracking
reserved amounts is much greater than the one needed for counting
active reservations for each tenant and resource.
This patch removes the logic for tracking reservations, and
replaces it with an explicit count of active reservations.
Please note that this patch does not adjust accordingly the
ResourceUsage DB model. This will be done in a separate patch with
an expand migration; this should avoid most merge conflicts before
the final patch for restoring reservation logic merges.
Related-Blueprint: better-quotas
Change-Id: Ib5e3bd61c1bc0fc8a5d612dae5c1740a8834a980
commit 8ba57a2bf1ce3693db47de4ff8dd5a7a9b5347d7
Author: Henry Gessau <gessau@cisco.com>
Date: Tue Sep 1 17:17:01 2015 -0400
Deprecate --service option for neutron-db-manage
Now that https://review.openstack.org/198542 has merged we can
deprecate the --service option. From now on instead of
--service fwaas
we should instead use
--subproject neutron-fwaas
This puts the \*aas subprojects on equal footing with the other
projects in the Neutron Stadium for neutron-db-manage.
In the Liberty release the --service option will be marked as
deprecated. It will be removed in Mitaka.
Related-Bug: #1470625
Change-Id: Iecc678efafd798b62bb83e6e85333c64760f16b5
commit c029954c8ae041e5f15b14ceef0e2aa060928e05
Author: Sachi King <nakato@nakato.io>
Date: Tue Sep 1 15:10:54 2015 +1000
Add constraint target to tox.ini
This adds a pip install command to tox.ini that is only used when the
tox env is passed with the 'constraints' factor appended onto it.
As such this will not effect developer workflows or current unit tests.
The initial use of this will be in a non-voting job, to verify that the
constrained checks with tox are stable. DevStack is already running
constrained jobs, as such problems are no expected.
To run a tox with pip using constraints on a developer system a
developer should run the desired tox environment with -constraints.
For example: $(tox -epy27-constraints)
Pip will pull the current version of the upper-constraints.txt file down
from the git.openstack.org, however this method can be overriden to use
a local file setting the environment variable "UPPER\_CONSTRAINTS\_FILE"
to the local path or a different URL, it is passed directly to pip.
This is currently not enabled in the default tox run, however it is
possible to enable it as a default by adding it to 'envlist' in tox.ini
Change-Id: I13579599dfdf846d06d8c39f33265e8b46db6e68
Depends-On: I17ac389f78af241917b6da7f049085f2b13d30f2
Implements Blueprint: Requirements-Management
commit f3f5940201a9e010c188f83aead7d93e7e8c9b6d
Author: Neil Jerram <Neil.Jerram@metaswitch.com>
Date: Mon Jul 27 14:41:29 2015 +0100
DHCP agent: allow using gateway IPs instead of uniquely allocated
In each place where the DHCP agent runs, and for each subnet for which
DHCP is handing out IP addresses, the DHCP port needs - at the Linux
level - to have an IP address within that subnet. Generally this
needs to be a unique Neutron-allocated IP address, because the
subnet's underlying L2 domain is bridged across multiple compute hosts
and network nodes, and for HA there may be multiple DHCP agents
running on that same bridged L2 domain.
However, if the DHCP ports - on multiple compute/network nodes but for
the same network - are \_not\_ bridged to each other, they do not need
each to have a unique IP address. Instead they can all share the same
address from the relevant subnet. This works, without creating any
ambiguity, because those ports are not all present on the same L2
domain, and because no data within the network is ever sent to that
address. (DHCP requests are broadcast, and it is the network's job to
ensure that such a broadcast will reach at least one of the available
DHCP servers. DHCP responses will be sent \_from\_ the DHCP port
address.)
Specifically, for some networking backends it makes sense to allow all
DHCP ports to use the subnet's gateway IP address, and thereby to
completely avoid any unique IP address allocation.
This change therefore enhances the DHCP agent code to be able to use
gateway IPs as an alternative to uniquely allocated ones, with the
choice between those being made by a new interface driver property,
'use\_gateway\_ips'. The back-compatible default is to use unique IPs.
An interface driver that wants the DHCP agent to use gateway IPs can
achieve that by overriding as follows:
@property
def use\_gateway\_ips(self):
return True
Partial-Bug: #1486649
Change-Id: I17e1dc9231a5ec35bd6f84c4c7aca6350d76e8ec
commit 3de01b39b74d0a23f765b1f9b1a4ba1eb457068c
Author: Stephen Ma <stephen.ma@hp.com>
Date: Thu Aug 27 04:50:14 2015 +0000
Resolve issue where router can't be removed from L3-agent in dvr mode
Fixes the problem where the L3 DVR Scheduler is unable
to remove a DVR router from a L3 agent running in
'dvr' mode.
Closes-bug: 1489091
Change-Id: Id128a81d2cf7108936715ee305012fbff23ffdbf
commit c5d182da588d8dcf107d22735eb37250362043c0
Author: rossella <rsblendido@suse.com>
Date: Thu Jul 23 19:41:20 2015 +0200
OVS agent add functional tests of OVS status
Add a functional tests to verify that the agent
behaves correctly when OVS restarted.
Partially-Implements: blueprint restructure-l2-agent
Change-Id: Ifeb0f2f6a06baead93df2c016ea26bfea990734d
commit 71dd3a0f87eb69072696f6905f8380924dd67c1a
Author: rossella <rsblendido@suse.com>
Date: Fri Jul 31 17:25:37 2015 +0000
check\_changed\_vlans doesn't need registered\_ports as param
check\_changed\_vlans doesn't need registered\_ports since the
ports processed by the agent are accessible from local\_vlan\_map
Partially-Implements: blueprint restructure-l2-agent
Change-Id: I279dcaff469337c553b358f6f5476c7238e89a59
commit 4ea6810d50c0d960c4640f0c12c6ec025449b64d
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Tue Sep 1 16:26:03 2015 +0900
test\_migrations: Remove unnecessary midonetclient mocks
These seem leftovers from plugin decomposition.
Change-Id: Ib05ebbbd6627a1b69c413761b0e5a8e53817d8f2
commit ed392dc5354131b377ebf6aea518fb8e2ca7f893
Author: Sergey Belous <sbelous@mirantis.com>
Date: Mon Aug 31 17:44:19 2015 +0300
Fixed filters for functional tests
Removed filter for unused tee utility.
CommandFilter for curl replaced with more stricted RegExpFilter
and now allow run curl only with specified parameters.
Change-Id: I5d151a63f85cb969f79d4d92f5422e8e88855be5
Closes-Bug: #1487139
commit 599977e20bd480305434168400055fa417aad8b1
Author: Lajos Katona <lajos.katona@ericsson.com>
Date: Tue Jul 7 15:04:35 2015 +0200
Fix locale problem in execute()
Change from new format string to old style formatting.
Change-Id: Ib39de7169416c2cc053d4aa909075c68cd2d7f0b
Closes-bug: #1449897
commit e77eac8611f8fbb333168dc344c0056acaebb8b5
Author: Edgar Magana <emagana@gmail.com>
Date: Sat Aug 29 08:00:17 2015 -0700
Improve python code for missing suggestion
Include a missing suggestion in code already merged
Related-Blueprint: better-quotas
Change-Id: I5983ccf6e2f98d2df41403b3be06748d5556c181
commit 34a329b4de7c801c15b3c214cc2b122ac82d0b72
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Tue Aug 25 16:24:05 2015 -0700
Add a functional test to validate dvr snat namespace
Add a functional test to validate the dvr snat
namespace and its internal interfaces when internal
networks are removed and added.
Change-Id: Id44f5e5899e959be53b09e6f9bc732f553ae9a5a
Related-Bug: #1479130
commit 3a9e778399af8380b11c968da39e08b4a97a9f1f
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Tue Aug 25 22:32:50 2015 +0000
Add snat ports cache to dvr router
This reverses the effect of [1] but in a way that works with the
current structure of the code and keeps DVR details in DVR classes
[1] https://review.openstack.org/#/c/200293
Change-Id: Ia8468881de6538882d4a14725b55db53e23d2e4c
Closes-Bug: #1479130
commit 72e388445eb6f6903ccfc5079aa206ac2cbcfd5e
Author: Sachi King <nakato@nakato.io>
Date: Mon Dec 8 17:42:48 2014 +1100
Return exception when attempting to add duplicate VIP
Neutron should never attempt to add a VIP to keepalived's config
multiple times, and to do so is an error. As such this adds an
exception if this is ever attempted.
Change-Id: If1c41c3164e8a998c73f9b7aa566e2ba6570f54b
Closes-Bug: #1400217

| **tags**: | added: in-feature-pecan |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-21:  [**Change abandoned on neutron (feature/pecan)**](/neutron/%2Bbug/1489111/comments/42) |  |  | [#42](/neutron/%2Bbug/1489111/comments/42) |
| --- | --- | --- | --- |

Change abandoned by Doug Wiegley (<email address hidden>) on branch: feature/pecan

Review: <https://review.openstack.org/224334>

Change abandoned by Doug Wiegley (dougwig@parkside.io) on branch: feature/pecan
Review: https://review.openstack.org/224334

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-09-24

| Changed in neutron: | |
| --- | --- |
| **milestone**: | none → liberty-rc1 |
| **status**: | Fix Committed → Fix Released |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-10-15

| Changed in neutron: | |
| --- | --- |
| **milestone**: | liberty-rc1 → 7.0.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-25: |  |  | [#43](/neutron/%2Bbug/1489111/comments/43) |
| --- | --- | --- | --- |

I won't be able to reproduce the problem on the Juno with steps in Bug Description. I am wondering whether there is any incorrect step. Can anyone help correct me? Thanks.

1) create a neutron security group

neutron security-group-create --description permissive unlocked11

neutron security-group-rule-create --protocol tcp --port-range-min 22 --port-range-max 22 --direction ingress unlocked11

neutron security-group-rule-create --protocol tcp --port-range-min 28 --port-range-max 50000 --direction egress unlocked11

neutron security-group-rule-create --protocol udp --port-range-min 1 --port-range-max 1000 --direction ingress unlocked11

2) create a port with security group created above

neutron port-create --security-group unlocked11 <network>

3) update port immediately after step 2)

watch neutron port-update <port uuid above> --device-owner network:hello

4) boot a vm

nova boot --key-name perry --nic port-id= <port uuid above> --flavor Standard --image <image> test

I found that if VM got ERROR with the following message.

{"message": "Build of instance f5b5090c-4141-44a8-8130-95692c5b1199 aborted: Failed to allocate the network(s), not rescheduling.", "code": 500, "details": " File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2079, in \_do\_build\_and\_run\_instance filter\_properties File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2213, in \_build\_and\_run\_instance reason=msg)

In addition, if I update the port device owner after several seconds after nova boot, the the VM's iptables looks consistent with port security group rules which is the same as normal VM without updating port. There is no any thing missed.

Thanks.

I won't be able to reproduce the problem on the Juno with steps in Bug Description. I am wondering whether there is any incorrect step. Can anyone help correct me? Thanks.
1) create a neutron security group
neutron security-group-create --description permissive unlocked11
neutron security-group-rule-create --protocol tcp --port-range-min 22 --port-range-max 22 --direction ingress unlocked11
neutron security-group-rule-create --protocol tcp --port-range-min 28 --port-range-max 50000 --direction egress unlocked11
neutron security-group-rule-create --protocol udp --port-range-min 1 --port-range-max 1000 --direction ingress unlocked11
2) create a port with security group created above
neutron port-create --security-group unlocked11 <network>
3) update port immediately after step 2)
watch neutron port-update <port uuid above> --device-owner network:hello
4) boot a vm
nova boot --key-name perry --nic port-id= <port uuid above> --flavor Standard --image <image> test
I found that if VM got ERROR with the following message.
{"message": "Build of instance f5b5090c-4141-44a8-8130-95692c5b1199 aborted: Failed to allocate the network(s), not rescheduling.", "code": 500, "details": " File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2079, in \_do\_build\_and\_run\_instance filter\_properties File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2213, in \_build\_and\_run\_instance reason=msg)
In addition, if I update the port device owner after several seconds after nova boot, the the VM's iptables looks consistent with port security group rules which is the same as normal VM without updating port. There is no any thing missed.
Thanks.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-25: |  |  | [#44](/neutron/%2Bbug/1489111/comments/44) |
| --- | --- | --- | --- |

Hi Perry, just a quick check, are you using 2014.2.4 ? Or make sure you don't have the fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) in order to reproduce that bug...

Hi Perry, just a quick check, are you using 2014.2.4 ? Or make sure you don't have the fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) in order to reproduce that bug...

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-26: |  |  | [#45](/neutron/%2Bbug/1489111/comments/45) |
| --- | --- | --- | --- |

Hi Tristan, thanks for your reply. I double checked servers and there is no such fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) applied. The code base is 2014.2.2.

Hi Tristan, thanks for your reply. I double checked servers and there is no such fix (changeId: Ia64cf16142e0e4be44b5b0ed72c8e00792d770f9) applied. The code base is 2014.2.2.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-11-26: |  |  | [#46](/neutron/%2Bbug/1489111/comments/46) |
| --- | --- | --- | --- |

Can you see why the nova instance failed to build? It may be easier to create the port, start the update loop and then attach it to a running VM.

Can you see why the nova instance failed to build? It may be easier to create the port, start the update loop and then attach it to a running VM.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-27: |  |  | [#47](/neutron/%2Bbug/1489111/comments/47) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1489111/comments/47/%2Bdownload) (5.1 KiB)

Hi Kevin,

compute log:

2015-11-27 03:17:29.480 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Instance failed to spawn

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2310, in \_build\_resources

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] yield resources

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info, disk\_info=disk\_info)

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 4485, in \_create\_domain\_and\_network

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] raise exception.VirtualInterfaceCreateException()

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] VirtualInterfaceCreateException: Virtual Interface creation failed

2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20]

2015-11-27 03:17:29.490 6812 AUDIT nova.compute.manager [req-4de7d5b4-69c9-4e62-971c-c67ff32f418c None] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Terminating instance

2015-11-27 03:17:29.512 6812 WARNING nova.virt.libvirt.driver [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] During wait destroy, instance disappeared.

2015-11-27 03:17:29.880 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Failed to allocate network(s)

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn

2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager ...

[Read more...](/neutron/%2Bbug/1489111/comments/47)

Hi Kevin,
compute log:
2015-11-27 03:17:29.480 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Instance failed to spawn
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2310, in \_build\_resources
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] yield resources
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info, disk\_info=disk\_info)
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 4485, in \_create\_domain\_and\_network
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] raise exception.VirtualInterfaceCreateException()
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] VirtualInterfaceCreateException: Virtual Interface creation failed
2015-11-27 03:17:29.480 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20]
2015-11-27 03:17:29.490 6812 AUDIT nova.compute.manager [req-4de7d5b4-69c9-4e62-971c-c67ff32f418c None] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Terminating instance
2015-11-27 03:17:29.512 6812 WARNING nova.virt.libvirt.driver [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] During wait destroy, instance disappeared.
2015-11-27 03:17:29.880 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Failed to allocate network(s)
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2172, in \_build\_and\_run\_instance
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info=block\_device\_info)
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 2661, in spawn
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] block\_device\_info, disk\_info=disk\_info)
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py", line 4485, in \_create\_domain\_and\_network
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] raise exception.VirtualInterfaceCreateException()
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] VirtualInterfaceCreateException: Virtual Interface creation failed
2015-11-27 03:17:29.880 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20]
2015-11-27 03:17:29.895 6812 ERROR nova.compute.manager [-] [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Build of instance 0b98dcb2-d343-4350-b65a-6615a8c45a20 aborted: Failed to allocate the network(s), not rescheduling.
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] Traceback (most recent call last):
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2073, in \_do\_build\_and\_run\_instance
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] filter\_properties)
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] File "/usr/lib/python2.6/site-packages/nova/compute/manager.py", line 2207, in \_build\_and\_run\_instance
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] reason=msg)
2015-11-27 03:17:29.895 6812 TRACE nova.compute.manager [instance: 0b98dcb2-d343-4350-b65a-6615a8c45a20] BuildAbortException: Build of instance 0b98dcb2-d343-4350-b65a-6615a8c45a20 aborted: Failed to allocate the network(s), not rescheduling

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Perry (panxia6679)](https://launchpad.net/~panxia6679) wrote on 2015-11-27: |  |  | [#48](/neutron/%2Bbug/1489111/comments/48) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1489111/comments/48/%2Bdownload) (3.2 KiB)

Looks my problem can be workarounded by <https://ask.openstack.org/en/question/57342/spawning-new-instances-fails-to-allocate-the-network/>. After updating vif\_plugging\_timeout=0 and vif\_plugging\_is\_fatal=False, the VM could be created with steps (loop to update port) and able to ping and I observed that there is nothing related to that corresponding VM in compute node iptables. I also observed some error during vm's rebooting which looks separate problem.

ci-info: +-------+--------------+--------------+---------------+-----------+-------+

2015-11-27 06:34:02,362 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [3/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:05,363 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [6/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:09,366 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [10/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:12,367 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [13/15s]: request error [[Errno 113] No route to host]

2015-11-27 06:34:13,370 - url\_helper.py[WARNING]: Calling '[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27) failed [14/15s]: request error [[Errno 115] Operation now in progress]

2015-11-27 06:34:14,371 - DataSourceEc2.py[CRITICAL]: Giving up on md from ['[http://169.254.169.254/2009-04-04/meta-data/instance-id'](http://169.254.169.254/2009-04-04/meta-data/instance-id%27)] after 15 seconds

2015-11-27 06:34:14,371 - util.py[WARNING]: No instance datasource found! Likely bad things to come!

Starting cloud-init: Can not apply stage config, no datasource found! Likely bad things to come!

------------------------------------------------------------

Traceback (most recent call last):

  File "/usr/bin/cloud-init", line 315, in main\_modules

    init.fetch()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch

    return self.\_get\_data\_source()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source

    pkg\_list)

  File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source

    raise DataSourceNotFoundException(msg)

DataSourceNotFoundException: Did not find any data source, searched classes: ()

------------------------------------------------------------

Starting cloud-init: Can not apply stage final, no datasource found! Likely bad things to come!

------------------------------------------------------------

Traceback (most recent call last):

  File "/usr/bin/cloud-init", line 315, in main\_modules

    init.fetch()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch

    return self.\_get\_data\_source()

  File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source

    pkg\_list)

  File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source

    raise DataSourceNotFoundException(msg)

DataSourceNotFoundException: Did not find any data source, searched classes: ()

---------------------...

[Read more...](/neutron/%2Bbug/1489111/comments/48)

Looks my problem can be workarounded by https://ask.openstack.org/en/question/57342/spawning-new-instances-fails-to-allocate-the-network/. After updating vif\_plugging\_timeout=0 and vif\_plugging\_is\_fatal=False, the VM could be created with steps (loop to update port) and able to ping and I observed that there is nothing related to that corresponding VM in compute node iptables. I also observed some error during vm's rebooting which looks separate problem.
ci-info: +-------+--------------+--------------+---------------+-----------+-------+
2015-11-27 06:34:02,362 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [3/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:05,363 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [6/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:09,366 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [10/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:12,367 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [13/15s]: request error [[Errno 113] No route to host]
2015-11-27 06:34:13,370 - url\_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [14/15s]: request error [[Errno 115] Operation now in progress]
2015-11-27 06:34:14,371 - DataSourceEc2.py[CRITICAL]: Giving up on md from ['http://169.254.169.254/2009-04-04/meta-data/instance-id'] after 15 seconds
2015-11-27 06:34:14,371 - util.py[WARNING]: No instance datasource found! Likely bad things to come!
Starting cloud-init: Can not apply stage config, no datasource found! Likely bad things to come!
------------------------------------------------------------
Traceback (most recent call last):
File "/usr/bin/cloud-init", line 315, in main\_modules
init.fetch()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch
return self.\_get\_data\_source()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source
pkg\_list)
File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source
raise DataSourceNotFoundException(msg)
DataSourceNotFoundException: Did not find any data source, searched classes: ()
------------------------------------------------------------
Starting cloud-init: Can not apply stage final, no datasource found! Likely bad things to come!
------------------------------------------------------------
Traceback (most recent call last):
File "/usr/bin/cloud-init", line 315, in main\_modules
init.fetch()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 307, in fetch
return self.\_get\_data\_source()
File "/usr/lib/python2.6/site-packages/cloudinit/stages.py", line 235, in \_get\_data\_source
pkg\_list)
File "/usr/lib/python2.6/site-packages/cloudinit/sources/\_\_init\_\_.py", line 250, in find\_source
raise DataSourceNotFoundException(msg)
DataSourceNotFoundException: Did not find any data source, searched classes: ()
------------------------------------------------------------

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Hao Jun Wang (shhjwang)](https://launchpad.net/~shhjwang) wrote on 2016-02-03: |  |  | [#50](/neutron/%2Bbug/1489111/comments/50) |
| --- | --- | --- | --- |

I am using Liberty and the patch has been installed. I can ping and ssh with the default security group in devstack through the reproduce steps. I think maybe it should not be permitted. Or there are some incorrect steps. Can anyone help me? Thanks very much.

I am using "demo" user.

My steps:

(1) neutron port-create <net-id> --name port1

(2) watch neutron port-update port1 --device-owner network:hello

step one and two are in one script.

(3) nova boot test --nic port-id=<port-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec

I can see that instance test is active. I can ping and ssh it.

"neutron port-show port1" indicates that the "device\_owner" is "network:hello" and "port\_security\_enabled" is "True"

I have set "vif\_plugging\_timeout=0" and "vif\_plugging\_is\_fatal=False" in nova.conf to ensure that instance can be successfully booted.

The created port id is c05720c0-0259-441c-8c48-f650a4b01202

And I found the following lines in "ip addr".

32: qbrc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc noqueue state UP group default

33: qvoc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master ovs-system state UP

34: qvbc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02

35: tapc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02 state

But when I just execute the command "nova boot test2 --nic net-id=<net-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec",

I cannot ping or ssh the instance "test2".

I am using Liberty and the patch has been installed. I can ping and ssh with the default security group in devstack through the reproduce steps. I think maybe it should not be permitted. Or there are some incorrect steps. Can anyone help me? Thanks very much.
I am using "demo" user.
My steps:
(1) neutron port-create <net-id> --name port1
(2) watch neutron port-update port1 --device-owner network:hello
step one and two are in one script.
(3) nova boot test --nic port-id=<port-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec
I can see that instance test is active. I can ping and ssh it.
"neutron port-show port1" indicates that the "device\_owner" is "network:hello" and "port\_security\_enabled" is "True"
I have set "vif\_plugging\_timeout=0" and "vif\_plugging\_is\_fatal=False" in nova.conf to ensure that instance can be successfully booted.
The created port id is c05720c0-0259-441c-8c48-f650a4b01202
And I found the following lines in "ip addr".
32: qbrc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc noqueue state UP group default
33: qvoc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master ovs-system state UP
34: qvbc05720c0-02: <BROADCAST,MULTICAST,PROMISC,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02
35: tapc05720c0-02: <BROADCAST,MULTICAST,UP,LOWER\_UP> mtu 1500 qdisc pfifo\_fast master qbrc05720c0-02 state
But when I just execute the command "nova boot test2 --nic net-id=<net-id> --flavor m1.tiny --image cirros-0.3.4-x86\_64-uec",
I cannot ping or ssh the instance "test2".

[See full activity log](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/neutron/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

## Duplicates of this bug

* [Bug #1417791](https://bugs.launchpad.net/neutron/%2Bbug/1417791 "Neutron allows non-admin user to circumvent port security via port-update device_owner")

You are
[not directly subscribed to this bug's notifications.](/neutron/%2Bbug/1489111/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [master patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455837/%2Bfiles/devowner_patch.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455837 "Change patch details")
* [kilo patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455838/%2Bfiles/devowner_patch_kilo.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455838 "Change patch details")
* [juno patch](https://bugs.launchpad.net/neutron/%2Bbug/1489111/%2Battachment/4455839/%2Bfiles/devowner_patch_juno.patch)
  [Edit](/neutron/%2Bbug/1489111/%2Battachment/4455839 "Change patch details")

* [Add patch](/neutron/%2Bbug/1489111/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.openwall.com_f208a268_20250124_191642.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](8) [[next>]](../../../2015/09/09/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <55EF7279.7010206@redhat.com>
Date: Tue, 8 Sep 2015 23:42:49 +0000
From: Tristan Cacqueray <tdecacqu@...hat.com>
To: oss-security@...ts.openwall.com
Subject: [OSSA 2015-018] Neutron firewall rules bypass through port update
 (CVE-2015-5240)

================================================================
OSSA-2015-018: Neutron firewall rules bypass through port update
================================================================

:Date: September 08, 2015
:CVE: CVE-2015-5240

Affects
~~~~~~~
- Neutron: versions through 2014.2.3 and
           2015.1 versions through 2015.1.1

Description
~~~~~~~~~~~
Kevin Benton from Mirantis reported a vulnerability in Neutron. By
changing the device owner of an instance's port right after it is
created, an authenticated user may prevent application of firewall
rules and so avoid IP anti-spoofing controls. All Neutron setups using
the ML2 plugin or a plugin that relies on the security groups AMQP API
are affected.

Patches
~~~~~~~
- <https://review.openstack.org/221345> (Juno)
- <https://review.openstack.org/221344> (Kilo)
- <https://review.openstack.org/221342> (Liberty)

Credits
~~~~~~~
- Kevin Benton from Mirantis (CVE-2015-5240)

References
~~~~~~~~~~
- <https://launchpad.net/bugs/1489111>
- <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5240>

Notes
~~~~~
- This fix will be included in future 2014.2.4 (juno) and
  2015.1.2 (kilo) releases.

--
Tristan Cacqueray
OpenStack Vulnerability Management Team

Download attachment "[signature.asc](9/1)" of type "application/pgp-signature" (474 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from bugzilla.redhat.com_869e5372_20250126_030156.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1266977)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1266977)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1266977)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1266977

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1266977**](show_bug.cgi?id=1266977)
- ipset - Hash is full, cannot add more elements

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
ipset - Hash is full, cannot add more elements

| | [Keywords](describekeywords.cgi): | Triaged  ZStream | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-neutron | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 6.0 (Juno) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | x86\_64 | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | urgent | | [Severity:](page.cgi?id=fields.html#bug_severity) | urgent | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | async | | [Target Release](page.cgi?id=fields.html#target_release): | 6.0 (Juno) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Miguel Angel Ajo | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Itzik Brown | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1266977&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1266977&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-09-28 17:30 UTC by Benjamin Schmaus | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-02-22 23:02 UTC ([History](show_activity.cgi?id=1266977)) | | [CC List:](page.cgi?id=fields.html#cclist) | 9 users (show)  amuller chrisw dmaley ihrachys jschluet majopela nyechiel tfreger yeylon | | Fixed In Version: | openstack-neutron-2014.2.3-16.el7ost | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2015-10-15 16:10:20 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Launchpad | [1439817](https://bugs.launchpad.net/bugs/1439817) | 0 | None | None | None | Never | | OpenStack gerrit | [173753](https://review.opendev.org/173753) | 0 | None | None | None | Never | | Red Hat Product Errata | [RHSA-2015:1909](https://access.redhat.com/errata/RHSA-2015%3A1909) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-neutron security and bug fix update | 2015-10-15 20:09:00 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1266977#c0)  Benjamin Schmaus    2015-09-28 17:30:10 UTC  ``` Description of problem:  We have instances failing to boot because users are putting very large subnets (e.g., /15) into allowed_address_pairs in Neutron.  It appears that we're hitting some sort of 64K limit in the ipset implementation.  The users putting subnets into allowed_address_pairs, so it seems that they should be stored in ipset as a subnet as well, not individual addresses.  This results in errors like from an instance booting: 2015-09-25 17:17:21.418 51840 INFO heat.engine.stack [-] Stack CREATE FAILED (VMG-NEC2-OAMA-24ilgto3rllb): Resource CREATE failed: Error: Server VMG-NEC2-OAM-A delete failed: (500) Build of instance 6031be29-f194-43fb-b05b-92e0c2d7cd18 aborted: Failed to allocate the network(s), not rescheduling.   On the compute host, the neutron logs contain items like: 2015-09-25 12:04:13.129 58378 ERROR neutron.agent.linux.utils [req-c8c2e2e2-1cc5-4fab-b1b6-b84f78043459 None] Command: ['sudo', 'neutron-rootwrap', '/etc/neutron/rootwrap.conf', 'ipset', 'add', '-exist', 'IPv4c3742bfb-7f15-4c92-b', '192.168.10.0/15'] Exit code: 1 Stdout: '' Stderr: 'ipset v6.19: Hash is full, cannot add more elements\n'   We can see that the ipset hash is indeed near a 64K limit, if that is problematic: [root@host nova]# ipset list | wc -l 65647   We can see that the sets have a limit of 65536: Name: IPv6f60f0540-fa6c-4a8d-9 Type: hash:ip Revision: 1 Header: family inet6 hashsize 1024 maxelem 65536    Version-Release number of selected component (if applicable): OSP6   How reproducible: 100% in larger deployments  Steps to Reproduce: 1. 2. 3.  Actual results:   Expected results:   Additional info:  Upstream bug: [https://bugs.launchpad.net/neutron/+bug/1439817](https://bugs.launchpad.net/neutron/%2Bbug/1439817)  Upstream code commit for OSP6: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=0325b98c54af276064e367db603bfeb525bbb790>   ```  [Comment 12](show_bug.cgi?id=1266977#c12)  Benjamin Schmaus    2015-10-09 15:21:03 UTC  ``` Hotfix worked for my client where it was applied.   ```  [Comment 16](show_bug.cgi?id=1266977#c16)  Itzik Brown    2015-10-15 11:06:20 UTC  ``` Checked with openstack-neutron-2014.2.3-19.el7ost.noarch   ```  [Comment 18](show_bug.cgi?id=1266977#c18)  errata-xmlrpc    2015-10-15 16:10:20 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory, and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  <https://rhn.redhat.com/errata/RHSA-2015-1909.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1266977&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from launchpad.net_9e50c715_20250126_030145.html ===

[Log in / Register](https://launchpad.net/~tristan-cacqueray/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~tristan-cacqueray)

## [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray)

* Overview
* [Code](https://code.launchpad.net/~tristan-cacqueray)
* [Bugs](https://bugs.launchpad.net/~tristan-cacqueray)
* [Blueprints](https://blueprints.launchpad.net/~tristan-cacqueray)
* [Translations](https://translations.launchpad.net/~tristan-cacqueray)
* [Answers](https://answers.launchpad.net/~tristan-cacqueray)

* [Related packages](https://launchpad.net/~tristan-cacqueray/%2Brelated-packages)
* [Related projects](https://launchpad.net/~tristan-cacqueray/%2Brelated-projects)

## User information

Launchpad Id:
tristan-cacqueray

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-10-25

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English

OpenPGP keys:

EB103DE8B5E69E631C6FF17922B9A05C925CC5D8

SSH keys:

[localadmin@controller](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~tristan-cacqueray/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**tristanC**
 on
**irc.freenode.net**

## [All memberships](https://launchpad.net/~tristan-cacqueray/%2Bparticipation) Latest memberships

| [Swiftsync dev](/~swiftsync-devteam)  Joined on 2014-02-13 | |
| --- | --- |
| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2013-12-12 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_b51f0968_20250126_030154.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1269201)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1269201)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1269201)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1269201

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1269201**](show_bug.cgi?id=1269201)
- Backport request: Improve DVR scale performance

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Backport request: Improve DVR scale performance

| | [Keywords](describekeywords.cgi): | FeatureBackport  Triaged  ZStream | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-neutron | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 6.0 (Juno) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | x86\_64 | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | async | | [Target Release](page.cgi?id=fields.html#target_release): | 6.0 (Juno) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Jakub Libosvar | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Itzik Brown | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1269201&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1269201&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-10-06 15:37 UTC by Randy Rubins | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-02-22 23:02 UTC ([History](show_activity.cgi?id=1269201)) | | [CC List:](page.cgi?id=fields.html#cclist) | 12 users (show)  amuller bhoefer chenders chrisw dcadzow dmaley ihrachys jlibosva nyechiel ohochman tfreger yeylon | | Fixed In Version: | openstack-neutron-2014.2.3-19.el7ost | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2015-10-15 16:10:25 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Launchpad | [1413314](https://bugs.launchpad.net/bugs/1413314) | 0 | None | None | None | Never | | OpenStack gerrit | [150110](https://review.opendev.org/150110) | 0 | None | None | None | Never | | Red Hat Product Errata | [RHSA-2015:1909](https://access.redhat.com/errata/RHSA-2015%3A1909) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-neutron security and bug fix update | 2015-10-15 20:09:00 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1269201#c0)  Randy Rubins    2015-10-06 15:37:17 UTC  ``` Description of problem:  Need to backport upstream Neutron fix 150110 "Improve DVR scale performance" to RHEL-OSP6.  Version-Release number of selected component (if applicable): RHEL-OSP-6 (Juno) A4 (latest)  How reproducible:  Steps to Reproduce: 1. Create 5 or more instances 2. Attach floating ips to the instances 3. Delete instances  Actual results: The deletion causes ERROR in l3-agent (PortNotFound), which in turn triggers ERROR 'Failed to fetch router information' for the involved router.  This in turn causes 'fullsync' of all Neutron routers, which is a very cpu intensive process in an environment with ~100-1000 routers.  The high load averages (70-80% system time) cause the OpenStack environment to become sluggish as the Neutron L3 agent and neutron-server are running on the 3 HA controllers (co-located with other OpenStack services).  Expected results: The deletion of multiple instances should NOT cause PortNotFound error, thus avoiding unnecessary full router sync.  Additional info: The issue discovered/confirmed in IRC session with Assaf Muller. According to amuller, the fix is contained in <https://review.openstack.org/#/c/150110/>   ```  [Comment 2](show_bug.cgi?id=1269201#c2)  Assaf Muller    2015-10-06 15:42:48 UTC  ``` Patch is present in OSP 7+, we need an OSP 6 downstream backport.   ```  [Comment 16](show_bug.cgi?id=1269201#c16)  Itzik Brown    2015-10-15 13:57:48 UTC  ``` Checked with openstack-neutron-2014.2.3-19.el7ost.noarch   ```  [Comment 18](show_bug.cgi?id=1269201#c18)  errata-xmlrpc    2015-10-15 16:10:25 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory, and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  <https://rhn.redhat.com/errata/RHSA-2015-1909.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1269201&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from review.openstack.org_ced42249_20250126_030152.html ===




=== Content from answers.launchpad.net_bbf3e90b_20250126_030144.html ===

[Log in / Register](https://answers.launchpad.net/neutron/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* Answers

# Questions for neutron

**Launchpad does not know where
neutron
tracks support requests.**

neutron questions are
tracked in:
[neutron in Ubuntu](/ubuntu/%2Bsource/neutron),
[neutron-fwaas in Ubuntu](/ubuntu/%2Bsource/neutron-fwaas),
[neutron-lbaas in Ubuntu](/ubuntu/%2Bsource/neutron-lbaas),
[neutron-vpnaas in Ubuntu](/ubuntu/%2Bsource/neutron-vpnaas),
[quantum in Ubuntu](/ubuntu/%2Bsource/quantum).

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_3f4a9887_20250126_030146.html ===

[Log in / Register](https://launchpad.net/~salvatore-orlando/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~salvatore-orlando)

## [Salvatore Orlando](https://launchpad.net/~salvatore-orlando)

* Overview
* [Code](https://code.launchpad.net/~salvatore-orlando)
* [Bugs](https://bugs.launchpad.net/~salvatore-orlando)
* [Blueprints](https://blueprints.launchpad.net/~salvatore-orlando)
* [Translations](https://translations.launchpad.net/~salvatore-orlando)
* [Answers](https://answers.launchpad.net/~salvatore-orlando)

* [Related packages](https://launchpad.net/~salvatore-orlando/%2Brelated-packages)
* [Related projects](https://launchpad.net/~salvatore-orlando/%2Brelated-projects)

## User information

Launchpad Id:
salvatore-orlando

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-11-17

[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English (United Kingdom), Italian

OpenPGP keys:

161C96C04D1D511EA9507782AE648CDD1E35211F

SSH keys:

[root@CubaLinux](%2Bsshkeys)

[salvatore@cuba-ubuntu](%2Bsshkeys)

[salvatore@Taturiello-linux](%2Bsshkeys)

[salvatore@dellina-ubuntu](%2Bsshkeys)

[salvatore@taturiello-virtualubuntu](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~salvatore-orlando/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**salv-orlando**
 on
**irc.freenode.net**

![Jabber](/@@/social-jabber "Jabber")
<email address hidden>

## [All memberships](https://launchpad.net/~salvatore-orlando/%2Bparticipation) Latest memberships

| [vmware-nsx-drivers](/~vmware-nsx-drivers)  Joined on 2014-12-14 | |
| --- | --- |
| [neutron-specs-core](/~neutron-specs-core)  Joined on 2014-04-15 | |
| [Nicira OpenStack Team](/~nicira-openstack)  Joined on 2012-06-28 | |
| [OpenStack Contributors](/~openstack-cla)  Joined on 2012-01-05 | |
| [Nova Orchestration Team](/~nova-orchestration)  Joined on 2011-10-20 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_8285f3da_20250126_030152.html ===




=== Content from security.openstack.org_2bd1a48e_20250124_191645.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2015-018: Neutron firewall rules bypass through port update

# OSSA-2015-018: Neutron firewall rules bypass through port update[Â¶](#ossa-2015-018-neutron-firewall-rules-bypass-through-port-update "Link to this heading")

Date:

September 08, 2015

CVE:

CVE-2015-5240

## Affects[Â¶](#affects "Link to this heading")

* Neutron: versions through 2014.2.3 and 2015.1 versions through 2015.1.1

## Description[Â¶](#description "Link to this heading")

Kevin Benton from Mirantis reported a vulnerability in Neutron. By changing the device owner of an instanceâs port right after it is created, an authenticated user may prevent application of firewall rules and so avoid IP anti-spoofing controls. All Neutron setups using the ML2 plugin or a plugin that relies on the security groups AMQP API are affected.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.openstack.org/221345> (Juno)
* <https://review.openstack.org/221344> (Kilo)
* <https://review.openstack.org/221342> (Liberty)

## Credits[Â¶](#credits "Link to this heading")

* Kevin Benton from Mirantis (CVE-2015-5240)

## References[Â¶](#references "Link to this heading")

* <https://launchpad.net/bugs/1489111>
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5240>

## Notes[Â¶](#notes "Link to this heading")

* This fix will be included in future 2014.2.4 (juno) and 2015.1.2
  (kilo) releases.

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2015-018: Neutron firewall rules bypass through port update
  + [Affects](#affects)
  + [Description](#description)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from rhn.redhat.com_3b933433_20250124_191641.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2015:1909 - Security Advisory

Issued:
2015-10-15
Updated:
2015-10-15
# RHSA-2015:1909 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-neutron security and bug fix update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2015%3A1909)

## Topic

Updated openstack-neutron packages that fix one security issue are now
available for Red Hat Enterprise Linux OpenStack Platform 5.0, 6.0, and 7.0.

Red Hat Product Security has rated this update as having Moderate security
impact. A Common Vulnerability Scoring System (CVSS) base score, which
gives a detailed severity rating, is available from the CVE link in the
References section.

## Description

OpenStack Networking (neutron) is a pluggable, scalable, and API-driven
system that provisions networking services to virtual machines. Its main
function is to manage connectivity to and from virtual machines.

A race-condition flaw leading to ACL bypass was discovered in OpenStack
Networking. An authenticated user could change the owner of a
port after it was created but before firewall rules were applied, thus
preventing firewall control checks from occurring. All OpenStack Networking
deployments that used either the ML2 plug-in or a plug-in that relied on the
security groups AMQP API were affected. (CVE-2015-5240)

Red Hat would like to thank the OpenStack project for reporting this issue.
Upstream acknowledges Kevin Benton from Mirantis as the original reporter.

All openstack-neutron users are advised to upgrade to these updated
packages, which contain backported patches to correct these issues.

## Solution

Before applying this update, ensure all previously released errata
relevant to your system have been applied.

This update is available through the Red Hat Network. Details on how
to use the Red Hat Network to apply this update are available at
<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack 7 x86\_64
* Red Hat OpenStack 6.0 x86\_64
* Red Hat OpenStack 5.0 for RHEL 7 x86\_64
* Red Hat OpenStack 5.0 for RHEL 6 x86\_64

## Fixes

* [BZ - 1258458](https://bugzilla.redhat.com/show_bug.cgi?id=1258458)
  - CVE-2015-5240 openstack-neutron: Firewall rules bypass through port update
* [BZ - 1266977](https://bugzilla.redhat.com/show_bug.cgi?id=1266977)
  - ipset - Hash is full, cannot add more elements
* [BZ - 1269201](https://bugzilla.redhat.com/show_bug.cgi?id=1269201)
  - Backport request: Improve DVR scale performance

## CVEs

* [CVE-2015-5240](https://www.redhat.com/security/data/cve/CVE-2015-5240.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack 7

| SRPM | |
| --- | --- |
| openstack-neutron-2015.1.1-7.el7ost.src.rpm | SHA-256: a81067c2fd36f35a981600a79e01406059d86f032d91115618af7c65294ecda2 |
| x86\_64 | |
| openstack-neutron-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 3c2b10445bdc49dad23b3cde8addcc7ba904dab7494e176e09663b6e1d4b6668 |
| openstack-neutron-bigswitch-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 23767dad35aeb1e0f425f10dabba95f5b09c0712374c0573cd513d6625484018 |
| openstack-neutron-brocade-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 22c00a0050bf77d722938f96ba65f3ff5f1832750f8044af01be73ab1d5f3e93 |
| openstack-neutron-cisco-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 467ac3d6e52103d6d66dc52f7218f95c87a4243cc4f2bd40ac676f9943e90d18 |
| openstack-neutron-common-2015.1.1-7.el7ost.noarch.rpm | SHA-256: fd3607a8c51d086889d1bba2402c161ced89a707821eff52066b8f4197242e63 |
| openstack-neutron-embrane-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 300c77a8c425f241619ff360eee93fa7515841b89c7a6b80b0165101aa8b02c4 |
| openstack-neutron-ibm-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 8158ece8807760baccea6200a976449a92c3bd5f88d3baa808bca740ca0fd3a6 |
| openstack-neutron-linuxbridge-2015.1.1-7.el7ost.noarch.rpm | SHA-256: c4f1dbb85bea193bc28993edfb54d9dc39f0448fdc0340969ebe10dbd72bad96 |
| openstack-neutron-mellanox-2015.1.1-7.el7ost.noarch.rpm | SHA-256: e264ea3e3a5896886bc693dbc58566d43e3badeaf8bb87007f999c71ca085230 |
| openstack-neutron-metaplugin-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 287e527dc2db36b866f57145f030048f6dc9992785311ace1aea88a4a2280faa |
| openstack-neutron-metering-agent-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 61740faca6118a27000eb4c08acde854b0bea6ef61c9b104ddb310179ec5385d |
| openstack-neutron-midonet-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 0fc9d5c4270ccc275455521eca0852b5653bb1711ffc588f2e27af4e305a5a1d |
| openstack-neutron-ml2-2015.1.1-7.el7ost.noarch.rpm | SHA-256: e3bb7b30be5fbe6c63fb849e0b41920369180a42f5d3ce9f25169841bd1fa5b2 |
| openstack-neutron-nec-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 865d3bee0c25078098fe887ee4d2cc6c0219d9bec760a89ba9609f20d04101cc |
| openstack-neutron-nuage-2015.1.1-7.el7ost.noarch.rpm | SHA-256: d528047093bd75366cb46bf56496c0fc2c0e7f5df00de0b7cf1ebeea573a18bd |
| openstack-neutron-ofagent-2015.1.1-7.el7ost.noarch.rpm | SHA-256: f24ddbed208d1b00db6668ae208b5ab301aae27ec276121028e63c46b256ec2a |
| openstack-neutron-oneconvergence-nvsd-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 81850615133ee5b7ff89a61420b641fc89f9d010b4875e05a2f317464b682840 |
| openstack-neutron-opencontrail-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 358bee9c547d005ac76057858b9ea1696332c3071dc15fde63aef9287a304a10 |
| openstack-neutron-openvswitch-2015.1.1-7.el7ost.noarch.rpm | SHA-256: ccef727799e31e2218378be2725347f602902bfaea4eebf1659e9edae5a70255 |
| openstack-neutron-ovsvapp-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 772c01443d3a17d4bc34c03af572fa21970b61077806116723a2a4233a440b50 |
| openstack-neutron-plumgrid-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 4127f863a8b7516a883dfeb363748c7cc93b951570d9726f61edb84f16d23807 |
| openstack-neutron-sriov-nic-agent-2015.1.1-7.el7ost.noarch.rpm | SHA-256: a0cf3aaaf11049ca715fda48f60875a515468a3cd06e3c6954458fe6127cab79 |
| openstack-neutron-vmware-2015.1.1-7.el7ost.noarch.rpm | SHA-256: fbe97f468f356461cbca8a1adc480592d186ab0e8d6320bc101637cea9a8b0dc |
| python-neutron-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 6422d96da494438b65d3d165923fc2a0f4fd109af710e80847320c1b39640f26 |
| python-neutron-tests-2015.1.1-7.el7ost.noarch.rpm | SHA-256: 03259162ab7844b4edf1e5ed5be4ed488bde5e5e815246f298a529492cb361b9 |

## Red Hat OpenStack 6.0

| SRPM | |
| --- | --- |
| openstack-neutron-2014.2.3-19.el7ost.src.rpm | SHA-256: 1c0efca6101ae721a8b5abf311236de55daaa416ebba98db7e3d88397fa4cc5e |
| x86\_64 | |
| openstack-neutron-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 2e45cb7ee14b36b0cc57ef5d95b0ed284e8db0e34f568d436561b2af2889a371 |
| openstack-neutron-bigswitch-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 3cefb12b9ec58321b3969379f53d065502ef5be1610052dc869f9ea02ecf906e |
| openstack-neutron-brocade-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 780e7900a06c92d06b1f946829b3e759c2c473349d4667fb4caba59b6c7586ed |
| openstack-neutron-cisco-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 2e057b418c336417d4681d4643562f1a155951ccf2b6a14582c508302c2d91c2 |
| openstack-neutron-common-2014.2.3-19.el7ost.noarch.rpm | SHA-256: c898978b630939fc9cc78317b3ab9035dfc433bf8e9115fb3a48882ff7aa2837 |
| openstack-neutron-embrane-2014.2.3-19.el7ost.noarch.rpm | SHA-256: a800eaf4853809be5821dbd4e07ead821710c77c1019c2932e4c622739af5745 |
| openstack-neutron-hyperv-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 065a5415092e00e855cb3503e6837521f6c9ff399507d9261236c50ce47baba4 |
| openstack-neutron-ibm-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 3c25b01038ce3e25415048b8ee99f07b73d2d5e4264ed0c4500035c625f44ba7 |
| openstack-neutron-linuxbridge-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 3d861e6ff65961a9650f1ba360e6103635a23816fd8935dc5c21bb7ecf37f20c |
| openstack-neutron-mellanox-2014.2.3-19.el7ost.noarch.rpm | SHA-256: b5e6532a67f8a36bcb936da75030cce767616dadea26b5eaa613a311ae3f555a |
| openstack-neutron-metaplugin-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 692e64e0bd85741f593876c7af0c414a2e8e468d8acb49d25cfc3c8475eaddc7 |
| openstack-neutron-metering-agent-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 771885c85466927ac4b457901661053113bf9691d52216d91132d8bc0800cd6f |
| openstack-neutron-midonet-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 8999aee279e34ab05914960b329f3153a637fceb59ba049829f868ab48168e1c |
| openstack-neutron-ml2-2014.2.3-19.el7ost.noarch.rpm | SHA-256: f71d741b3460cef927ab73ff013300d08797cafb89441c175966baa2d9f10068 |
| openstack-neutron-nec-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 7696cec4717e0d6a3a005819cfe100beebd88415d53a538ecb5056b51b907cad |
| openstack-neutron-nuage-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 4128a64b6280e87beebc175c312520b6b92e2629e88a62a73aa20e0665a8ec48 |
| openstack-neutron-ofagent-2014.2.3-19.el7ost.noarch.rpm | SHA-256: a44b24a65bf09bf94ab392975638ba2abb2b9bc0002def5422b750eafcd90934 |
| openstack-neutron-oneconvergence-nvsd-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 1a8ddd380dc439e607c249f2479efae1a9ff0c799f6478adffe577d63847268d |
| openstack-neutron-opencontrail-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 4058672d829330fc587c2642d46b3c1b6d6bd3e4a3d4d2fa402c369200e27c4e |
| openstack-neutron-openvswitch-2014.2.3-19.el7ost.noarch.rpm | SHA-256: c71489a3d8199299c80573b34e357825fbec4c772ce20cef83d56048e9406756 |
| openstack-neutron-plumgrid-2014.2.3-19.el7ost.noarch.rpm | SHA-256: fe71960c77a2eb40416c3755ee44422e559cea46a9a0705742b6a14e717ba2c1 |
| openstack-neutron-ryu-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 728212b100bbf555eaf99caef76dbd7c764827a8cbf446ff1e7ee45ae5cbfd2c |
| openstack-neutron-sriov-nic-agent-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 3def4d01c1d7f5a41355cd5bb28e45d423b6e978f4f32c033b226d35b52476d8 |
| openstack-neutron-vmware-2014.2.3-19.el7ost.noarch.rpm | SHA-256: b93fc04b84374eff1ba408d0427dba4f1a59f6150ccdc52b4b13c63c7aa24a0f |
| openstack-neutron-vpn-agent-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 0e0fe83b3881ffb66f6d9c460e1d671a666d31c7b10321057e3c7d2e2143c4f9 |
| python-neutron-2014.2.3-19.el7ost.noarch.rpm | SHA-256: 3ed3ff4ab4ef63a02a32bca8e3b5a88e8bf5e67632e898c65e2f82f2ddfa0cc3 |

## Red Hat OpenStack 5.0 for RHEL 7

| SRPM | |
| --- | --- |
| openstack-neutron-2014.1.5-4.el7ost.src.rpm | SHA-256: 54f2d6d05332de70a4b035c8eb9b835a8a92c4d9220763f99a7f4f633500338b |
| x86\_64 | |
| openstack-neutron-2014.1.5-4.el7ost.noarch.rpm | SHA-256: c3b9f6ef8927fee5b1f3e073ddfc17a17fdf24a0809bdd77c9ed50246a2798a4 |
| openstack-neutron-bigswitch-2014.1.5-4.el7ost.noarch.rpm | SHA-256: a47250c10f31bbc5caa74b1087b88f23a72350ce735a6cf5ce67967af1419deb |
| openstack-neutron-brocade-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 6d5705571451a5fc1fdb38b43191c22d534a50103eb8d0f78206dd18beaa0fd7 |
| openstack-neutron-cisco-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 152db84d66fe435254c3fd8284deb44c3d753d4b3e73e691451add237b58d9b0 |
| openstack-neutron-embrane-2014.1.5-4.el7ost.noarch.rpm | SHA-256: a2339e0830c26091344f6c94f0bfa29f5b9bbb06101cdab13e2965182590f920 |
| openstack-neutron-hyperv-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 27cc8a94af799532dc871c232d0f6e461c9f58bdebc15b29aaa8e2fb045b4921 |
| openstack-neutron-ibm-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 1a9ec046af6bdf8cca9f3b9a6e2cd042f11fee7c3305128f4699d416ba8198d6 |
| openstack-neutron-linuxbridge-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 81c6fd1726724f73c769e3d5e05d56e40e2af8dabdf49e08709b95022cba9922 |
| openstack-neutron-mellanox-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 9ae7cc30ad5fe238691d0dfc147a58188efe3bad54c8b9cac1c8f313fbc3b925 |
| openstack-neutron-metaplugin-2014.1.5-4.el7ost.noarch.rpm | SHA-256: f401cbdbe2d66a0555af7dae6d7d8f69d35ea76c3997fc3f62fb23580af1a1a0 |
| openstack-neutron-metering-agent-2014.1.5-4.el7ost.noarch.rpm | SHA-256: c7336d3d7d42267ad389fb9179afcb9136e456920cdca48559cf9021ea61bbf9 |
| openstack-neutron-midonet-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 2af5155170fdef5172801e10d6da192a6771cdb7eb00e479ed7f507479127a6f |
| openstack-neutron-ml2-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 681ec0809523c17d680fa4e46ffff2389402b6ed287a99ead41090363c3b2700 |
| openstack-neutron-nec-2014.1.5-4.el7ost.noarch.rpm | SHA-256: c474049945b9530ac16e5d506ae657b84d67d706888bdfcf80c0c7f4e1e382a4 |
| openstack-neutron-nuage-2014.1.5-4.el7ost.noarch.rpm | SHA-256: acb6e8d5d14b2040c8ce20a6c46c1d70ccb470fa13967eb93076ffbb24ebc8e0 |
| openstack-neutron-ofagent-2014.1.5-4.el7ost.noarch.rpm | SHA-256: d923c79086722f623ed90628886df3aff49c4c2f62c36c121c07268972990096 |
| openstack-neutron-oneconvergence-nvsd-2014.1.5-4.el7ost.noarch.rpm | SHA-256: c65bd394eed9f00c83b4f2fe19d68b1b8c18b0dc6a9974d524682ea8952a63ed |
| openstack-neutron-openvswitch-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 3df2a8965028d84fff0b9e6cd0f4158c671f7983cf3ec366a9eed44534c04123 |
| openstack-neutron-plumgrid-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 50526b82497e32bc638e197195a01c9c0e6262a66765f30b231b18aaec91f5bc |
| openstack-neutron-ryu-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 1a7e080ae42a01a155db04361dc4558dc55d0463e56ccebac2c86b9b1135dfee |
| openstack-neutron-vmware-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 3532eab92b67906ff3dcc4e870291b54762de66bfded5cae71d277bf8809cd7d |
| openstack-neutron-vpn-agent-2014.1.5-4.el7ost.noarch.rpm | SHA-256: ba6922d9911cbed894c3532c899ee40816cdba32366daaedc9aff2d2b46e6ba1 |
| python-neutron-2014.1.5-4.el7ost.noarch.rpm | SHA-256: 3faea97f6542ac2f978afc6445d8348801faebd4554d847f502e9907b446b44e |

## Red Hat OpenStack 5.0 for RHEL 6

| SRPM | |
| --- | --- |
| openstack-neutron-2014.1.5-4.el6ost.src.rpm | SHA-256: abb2745c43060020c097dfa611bed423bafb2850ca2740c694a106a2ea433249 |
| x86\_64 | |
| openstack-neutron-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 05ab3d1a68734805c79572c472c5a7cb00424a4e62736d8dc373743b8f8698cd |
| openstack-neutron-bigswitch-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 0aa6979fd4db1eea4d3909a59cbba9bce4836661ac07152d4c99c98506745a9b |
| openstack-neutron-brocade-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 85d5ef14dccd6eca9c3afccf8d1b5af8b5e9e1c4fb4b13bbaf50f8ff40b96fb9 |
| openstack-neutron-cisco-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 6aad1ee907a036c153313c0a4ce69a03e742838f5e7b2f3ee101967cee769d17 |
| openstack-neutron-embrane-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 15ef22b8812ee8e0e1a2b573b0cb02270f0ef44965424026da2eb8518f28f7c7 |
| openstack-neutron-hyperv-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 2fdf03cfac1c4304375427a9026534b057af813a22b2c9f9041203e6a6ccc5f6 |
| openstack-neutron-ibm-2014.1.5-4.el6ost.noarch.rpm | SHA-256: fe3caef8fda8a508ea39e5a55e8e551d6d475146c9a65a738a904a3d34306cdc |
| openstack-neutron-linuxbridge-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 83998a2ab6f6d801265db613ab3e986d3b5bc63be678d3be962707c5040922c7 |
| openstack-neutron-mellanox-2014.1.5-4.el6ost.noarch.rpm | SHA-256: d5abd0cf3263d226c16c3970093a666f308dc7cd6cb32903311c2d0e0b7b9b75 |
| openstack-neutron-metaplugin-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 875a84b55cf9d7c6bd168ea7f1c0ad942831c861a2898f42b12ed22b0c99be8a |
| openstack-neutron-metering-agent-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 27245783b576bb3e566ec45f26164488495492f2eb7c223830e9fb648b9d056b |
| openstack-neutron-midonet-2014.1.5-4.el6ost.noarch.rpm | SHA-256: acf61ac4c34d966a29550cc6e8953a84f0a4ea365dcaae24f0a29824250526fc |
| openstack-neutron-ml2-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 3aa2e22c55d8bfc3b96bdcfab1870b4d127d7a26b821a3a0f8f149dca41264ae |
| openstack-neutron-nec-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 7a40169f04d8f2e0e211e854caabb6377f7b2b7f2480a2525ce369cc6e4fbd4c |
| openstack-neutron-nuage-2014.1.5-4.el6ost.noarch.rpm | SHA-256: abde9b8fda0e819365c46ad0b708f58b86f5fbfe8e842247d68866e98933e967 |
| openstack-neutron-ofagent-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 224e4dc03c6dbf2ef4695e4afcb872247300a8536fac0a06655efde758509f41 |
| openstack-neutron-oneconvergence-nvsd-2014.1.5-4.el6ost.noarch.rpm | SHA-256: c468d21b5839b70469cec888c053c48bd7a2524cd62513f4ff2ab1ab3706ea2a |
| openstack-neutron-openvswitch-2014.1.5-4.el6ost.noarch.rpm | SHA-256: f0e99d34a3c490e91e5e9227396d150b1ca8932be00da1c9f251e9a7b8dff1bf |
| openstack-neutron-plumgrid-2014.1.5-4.el6ost.noarch.rpm | SHA-256: be9e7f050b0e8f2a48ecb45850f502abe908a1eb985abb8e07031ede5a2d1e9d |
| openstack-neutron-ryu-2014.1.5-4.el6ost.noarch.rpm | SHA-256: fb25ecfc5af17d98275d9119a266c442c281a4649f05d46a1910e28d6f813748 |
| openstack-neutron-vmware-2014.1.5-4.el6ost.noarch.rpm | SHA-256: aa5ee94c6d03ddab7fd6b8e57b41ff65d93ae8133a40b1d50719207fdc32f70d |
| openstack-neutron-vpn-agent-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 1ea105c5e79248badfe5a197cc8be947a30ac614e3c34407d4bb1ea1109d94c1 |
| python-neutron-2014.1.5-4.el6ost.noarch.rpm | SHA-256: 9a6860b3c2310b13e8732f8b0f814cfda16b8238ea1557c04e8eabd21c776680 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from translations.launchpad.net_438d433b_20250126_030144.html ===

[Log in / Register](https://translations.launchpad.net/neutron/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* Translations
* [Answers](https://answers.launchpad.net/neutron)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

**neutron does not use Launchpad
to translate its messages.**

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_0b1397e9_20250126_030148.html ===




=== Content from access.redhat.com_7e3bb026_20250126_030157.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


