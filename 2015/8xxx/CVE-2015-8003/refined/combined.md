=== Content from phab.wmfusercontent.org_fa4c934c_20250126_102335.html ===
From 385d2ac6b8d26b814da683e5b63ddce879569e32 Mon Sep 17 00:00:00 2001
From: Chad Horohoe
Date: Thu, 15 Oct 2015 12:48:47 -0700
Subject: [PATCH] SECURITY: Throttle uploads
Add throttle check in ApiUpload and SpecialUpload.
Bug: T91850
Change-Id: If33cc99f304aab2486507c7500b4abb06b6b5d70
---
includes/DefaultSettings.php | 6 ++++++
includes/api/ApiUpload.php | 6 ++++++
includes/specials/SpecialUpload.php | 8 ++++++++
includes/upload/UploadBase.php | 10 ++++++++++
4 files changed, 30 insertions(+)
diff --git a/includes/DefaultSettings.php b/includes/DefaultSettings.php
index e0ab60a..cededac 100644
--- a/includes/DefaultSettings.php
+++ b/includes/DefaultSettings.php
@@ -4768,6 +4768,12 @@ $wgRateLimits = array(
'ip' => null, // for each anon and recent account
'subnet' => null, // ... within a /24 subnet in IPv4 or /64 in IPv6
),
+ 'upload' => array(
+ 'user' => null,
+ 'newbie' => null,
+ 'ip' => null,
+ 'subnet' => null,
+ ),
'move' => array(
'user' => null,
'newbie' => null,
diff --git a/includes/api/ApiUpload.php b/includes/api/ApiUpload.php
index 30f8adb..354bd0d 100644
--- a/includes/api/ApiUpload.php
+++ b/includes/api/ApiUpload.php
@@ -139,6 +139,12 @@ class ApiUpload extends ApiBase {
return $this->getStashResult( $warnings );
}
+ // Check throttle after we've handled warnings
+ if ( UploadBase::isThrottled( $this->getUser() )
+ ) {
+ $this->dieUsageMsg( 'actionthrottledtext' );
+ }
+
// This is the most common case -- a normal upload with no warnings
// performUpload will return a formatted properly for the API with status
return $this->performUpload( $warnings );
diff --git a/includes/specials/SpecialUpload.php b/includes/specials/SpecialUpload.php
index b46f942..30b621e 100644
--- a/includes/specials/SpecialUpload.php
+++ b/includes/specials/SpecialUpload.php
@@ -450,6 +450,14 @@ class SpecialUpload extends SpecialPage {
}
}
+ // This is as late as we can throttle, after expected issues have been handled
+ if ( UploadBase::isThrottled( $this->getUser() ) ) {
+ $this->showRecoverableUploadError(
+ $this->msg( 'actionthrottledtext' )->escaped()
+ );
+ return;
+ }
+
// Get the page text if this is not a reupload
if ( !$this->mForReUpload ) {
$pageText = self::getInitialPageText( $this->mComment, $this->mLicense,
diff --git a/includes/upload/UploadBase.php b/includes/upload/UploadBase.php
index eb33220..73d9143 100644
--- a/includes/upload/UploadBase.php
+++ b/includes/upload/UploadBase.php
@@ -123,6 +123,16 @@ abstract class UploadBase {
return true;
}
+ /\*\*
+ \* Returns true if the user has surpassed the upload rate limit, false otherwise.
+ \*
+ \* @param User $user
+ \* @return bool
+ \*/
+ public static function isThrottled( $user ) {
+ return $user->pingLimiter( 'upload' );
+ }
+
// Upload handlers. Should probably just be a global.
static $uploadHandlers = array( 'Stash', 'File', 'Url' );
--
2.6.1


=== Content from lists.wikimedia.org_e3784ff7_20250125_165230.html ===


[lists.wikimedia.org](/hyperkitty/)

[Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ/)
[Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ/)

* [Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ/)
* [Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ/)

* [Manage this list](/postorius/lists/mediawiki-announce.lists.wikimedia.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2025/1/)

### 2024

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/1/)

### 2023

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/1/)

### 2022

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/1/)

### 2021

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/1/)

### 2020

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/1/)

### 2019

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/1/)

### 2018

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/1/)

### 2017

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/1/)

### 2016

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/1/)

### 2015

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/1/)

### 2014

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/1/)

### 2013

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/1/)

### 2012

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/1/)

### 2011

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/1/)

### 2010

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/1/)

### 2009

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/1/)

### 2008

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/1/)

### 2007

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/1/)

### 2006

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/1/)

### 2005

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/1/)

### 2004

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2004/12/)

[List overview](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

[Download](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/export/mediawiki-announce%40lists.wikimedia.org-ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ.mbox.gz?message=ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ "This message in gzipped mbox format")

[thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ/#ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ)

# [MediaWiki-announce] Security Release: 1.25.3, 1.24.4 and 1.23.11

[Chad](/hyperkitty/users/106c86c03e624f118ae876f1a13c1316/ "See the profile for Chad")

16 Oct
2015

16 Oct
'15

8:08 p.m.

I would like to announce the release of MediaWiki 1.25.3, 1.24.4, and
1.23.11.
These releases fix five security issues in core, in addition to other bug
fixes. Download links are given at the end of this email

== Security fixes ==

\* Wikipedia user RobinHood70 reported two issues in the chunked upload API.
The
API failed to correctly stop adding new chunks to the upload when the
reported
size was exceeded (T91203), allowing a malicious users to upload add an
infinite number of chunks for a single file upload. Additionally, a
malicious
user could upload chunks of 1 byte for very large files, potentially
creating
a very large number of files on the server's filesystem (T91205).
<https://phabricator.wikimedia.org/T91203>
<https://phabricator.wikimedia.org/T91205>

\* Internal review discovered that it is not possible to throttle file
uploads.
<https://phabricator.wikimedia.org/T91850>

\* Internal review discovered a missing authorization check when removing
suppression from a revision. This allowed users with the 'viewsuppressed'
user
right but not the appropriate 'suppressrevision' user right to unsuppress
revisions.
<https://phabricator.wikimedia.org/T95589>

\* Richard Stanway from teamliquid.net reported that thumbnails of PNG files
generated with ImageMagick contained the local file path in the image
metadata.
<https://phabricator.wikimedia.org/T108616>

== Bug Fixes in 1.25.3 ==

\* Fix having multiple callbacks for a single hook.
<https://phabricator.wikimedia.org/T98975>
\* maintenance/refreshLinks.php did not always remove all links pointing to
nonexistent pages.
<https://phabricator.wikimedia.org/T107632>
\* $wgEmergencyContact and $wgPasswordSender now use their default value if
set
to an empty string.
<https://phabricator.wikimedia.org/T104142>
\* Provide fallbacks for use of mb\_convert\_encoding() in HtmlFormatter. It
was
causing an error when accessing the api help page if the mbstring PHP
extension was not installed.
<https://phabricator.wikimedia.org/T62174>
\* Confirmation emails would sometimes contain invalid codes.
<https://phabricator.wikimedia.org/T105896>
\* Fixed edit stash inclusion queries.
<https://phabricator.wikimedia.org/T105597>

== Bug Fixes in 1.24.4 ==

\* Minimal PSR-3 debug logger to support backports from 1.25+.
<https://phabricator.wikimedia.org/T91653>
\* Fix indexing of moved pages with PostgreSQL. Requires running
update.php to fix.
<https://phabricator.wikimedia.org/T68650>

== Release notes ==

Full release notes for 1.25.3:
<https://www.mediawiki.org/wiki/Release_notes/1.25>

Full release notes for 1.24.4:
<https://www.mediawiki.org/wiki/Release_notes/1.24>

Full release notes for 1.23.11:
<https://www.mediawiki.org/wiki/Release_notes/1.23>

For information about how to upgrade, see
[https://www.mediawiki.org/wiki/Manual:Upgrading](https://www.mediawiki.org/wiki/Manual%3AUpgrading)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.25.3
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<https://releases.wikimedia.org/mediawiki/1.25/mediawiki-1.25.3.tar.gz>
<https://releases.wikimedia.org/mediawiki/1.25/mediawiki-core-1.25.3.tar.gz>

Patch to previous version:
<https://releases.wikimedia.org/mediawiki/1.25/mediawiki-1.25.3.patch.gz>
<https://releases.wikimedia.org/mediawiki/1.25/mediawiki-i18n-1.25.3.patch.gz>

GPG signatures:
<https://releases.wikimedia.org/mediawiki/1.25/mediawiki-1.25.3.tar.gz.sig>
<https://releases.wikimedia.org/mediawiki/1.25/mediawiki-1.25.3.patch.gz.sig>
[https://releases.wikimedia.org/mediawiki/1.25/mediawiki-core-1.25.3.tar.gz.s...](https://releases.wikimedia.org/mediawiki/1.25/mediawiki-core-1.25.3.tar.gz.sig)
[https://releases.wikimedia.org/mediawiki/1.25/mediawiki-i18n-1.25.3.patch.gz...](https://releases.wikimedia.org/mediawiki/1.25/mediawiki-i18n-1.25.3.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.24.4
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<https://releases.wikimedia.org/mediawiki/1.24/mediawiki-1.24.4.tar.gz>
<https://releases.wikimedia.org/mediawiki/1.24/mediawiki-core-1.24.4.tar.gz>

Patch to previous version:
<https://releases.wikimedia.org/mediawiki/1.24/mediawiki-1.24.4.patch.gz>
<https://releases.wikimedia.org/mediawiki/1.24/mediawiki-i18n-1.24.4.patch.gz>

GPG signatures:
<https://releases.wikimedia.org/mediawiki/1.24/mediawiki-1.24.4.tar.gz.sig>
<https://releases.wikimedia.org/mediawiki/1.24/mediawiki-1.24.4.patch.gz.sig>
[https://releases.wikimedia.org/mediawiki/1.24/mediawiki-core-1.24.4.tar.gz.s...](https://releases.wikimedia.org/mediawiki/1.24/mediawiki-core-1.24.4.tar.gz.sig)
[https://releases.wikimedia.org/mediawiki/1.24/mediawiki-i18n-1.24.4.patch.gz...](https://releases.wikimedia.org/mediawiki/1.24/mediawiki-i18n-1.24.4.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.23.11
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<https://releases.wikimedia.org/mediawiki/1.23/mediawiki-1.23.11.tar.gz>
<https://releases.wikimedia.org/mediawiki/1.23/mediawiki-core-1.23.11.tar.gz>

Patch to previous version:
<https://releases.wikimedia.org/mediawiki/1.23/mediawiki-1.23.11.patch.gz>
[https://releases.wikimedia.org/mediawiki/1.23/mediawiki-i18n-1.23.11.patch.g...](https://releases.wikimedia.org/mediawiki/1.23/mediawiki-i18n-1.23.11.patch.gz)

GPG signatures:
<https://releases.wikimedia.org/mediawiki/1.23/mediawiki-1.23.11.tar.gz.sig>
<https://releases.wikimedia.org/mediawiki/1.23/mediawiki-1.23.11.patch.gz.sig>
[https://releases.wikimedia.org/mediawiki/1.23/mediawiki-core-1.23.11.tar.gz....](https://releases.wikimedia.org/mediawiki/1.23/mediawiki-core-1.23.11.tar.gz.sig)
[https://releases.wikimedia.org/mediawiki/1.23/mediawiki-i18n-1.23.11.patch.g...](https://releases.wikimedia.org/mediawiki/1.23/mediawiki-i18n-1.23.11.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

-Chad

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ/#ZUN2UJ2BYC2QUII7AFXBRWFH66CZ53XZ)

[Back to the list](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from gerrit.wikimedia.org_7cfad743_20250126_102336.html ===




=== Content from phabricator.wikimedia.org_381b71ea_20250125_165232.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT91850)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T91850
# No rate limits on uploading filesClosed, Resolved[Public](/policy/explain/PHID-TASK-sqibyafubhvgq2whufc6/view/)Actions

* [Edit Task](/maniphest/task/edit/91850/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/91850/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-sqibyafubhvgq2whufc6/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-sqibyafubhvgq2whufc6/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-sqibyafubhvgq2whufc6/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-sqibyafubhvgq2whufc6/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-sqibyafubhvgq2whufc6/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-sqibyafubhvgq2whufc6/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-sqibyafubhvgq2whufc6/)
* [Protect as security issue](/wmf/escalate-task/91850/)
* [Award Token](/token/give/PHID-TASK-sqibyafubhvgq2whufc6/)
* [Flag For Later](/flag/edit/PHID-TASK-sqibyafubhvgq2whufc6/)

Assigned To

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

Authored By

|  | [• csteipp](/p/csteipp/) |
| --- | --- |
| Mar 7 2015, 1:06 AM2015-03-07 01:06:28 (UTC+0) |

Tags

* [Multimedia](/tag/multimedia/) [(Next up)](/project/board/48/)
* [MediaWiki-Uploading](/tag/mediawiki-uploading/)
* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Security-Core](/tag/security-core/) [(Backlog)](/project/board/427/)
* [Vuln-DoS](/tag/vuln-dos/) [(Tracked)](/project/board/1446/)
* [Patch-For-Review](/tag/patch-for-review/)
* [MW-1.25-release](/tag/mw-1.25-release/) [(Backlog)](/project/board/327/)
* [MW-1.24-release](/tag/mw-1.24-release/) [(Backlog)](/project/board/219/)
* [MW-1.23-release](/tag/mw-1.23-release/) [(Backlog)](/project/board/603/)
* [MW-1.27-release-notes](/tag/mw-1.27-release-notes/)
* [MW-1.27-release (WMF-deploy-2015-10-27\_(1.27.0-wmf.4))](/tag/wmf-deploy-2015-10-27_%281.27.0-wmf.4%29/)
* [MW-1.26-release](/tag/mw-1.26-release/) [(Backlog)](/project/board/1177/)
* [Security](/tag/security/)
Referenced Files

|  | [F2724581: T91850c-REL1\_23.patch](/F2724581) |
| --- | --- |
| Oct 15 2015, 8:24 PM2015-10-15 20:24:29 (UTC+0) |

|  | [F2724543: T91850c-REL1\_23.patch](/F2724543) |
| --- | --- |
| Oct 15 2015, 7:53 PM2015-10-15 19:53:07 (UTC+0) |

|  | [F361708: T91850c.patch](/F361708) |
| --- | --- |
| Aug 4 2015, 1:27 AM2015-08-04 01:27:01 (UTC+0) |

|  | [F191194: T91850b.patch](/F191194) |
| --- | --- |
| Jul 10 2015, 11:05 PM2015-07-10 23:05:18 (UTC+0) |

|  | [F188249: T91850-exploit.php](/F188249) |
| --- | --- |
| Jul 2 2015, 4:27 PM2015-07-02 16:27:49 (UTC+0) |

|  | [F188047: T91850.patch](/F188047) |
| --- | --- |
| Jul 1 2015, 6:00 PM2015-07-01 18:00:33 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [• demon](/p/demon/) |
| --- | --- |

|  | [Ejegg](/p/Ejegg/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [Jdforrester-WMF](/p/Jdforrester-WMF/) |
| --- | --- |

[View All 11 Subscribers](/subscriptions/list/PHID-TASK-sqibyafubhvgq2whufc6/)Tokens"Pterodactyl" token, awarded by demon.
# Description

We don't rate limit uploading files. We should.

---

**patch: T91850c.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/sdtwstjyhoqhjdiea35v/PHID-FILE-mu4o7pl32kgcj7z26yzk/T91850c.patch)**

* 1.25 - same as master (T91850c.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/sdtwstjyhoqhjdiea35v/PHID-FILE-mu4o7pl32kgcj7z26yzk/T91850c.patch))
* 1.24 - same as master (T91850c.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/sdtwstjyhoqhjdiea35v/PHID-FILE-mu4o7pl32kgcj7z26yzk/T91850c.patch))
* 1.23 - T91850c-REL1\_23.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/pgt2hsxx3ws5etftfcih/PHID-FILE-wbcndob4diboauv5hmcu/T91850c-REL1_23.patch)

**affected versions:**

**type:** dos

**CVE:** CVE-2015-8003

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Throttle uploads](https://gerrit.wikimedia.org/r/c/246973) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_26](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_26) | +30 -0 |
|  | [SECURITY: Throttle uploads](https://gerrit.wikimedia.org/r/c/246884) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +30 -0 |
|  | [SECURITY: Throttle uploads](https://gerrit.wikimedia.org/r/c/246873) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_24](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_24) | +30 -0 |
|  | [SECURITY: Throttle uploads](https://gerrit.wikimedia.org/r/c/246879) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_23](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_23) | +30 -0 |
|  | [SECURITY: Throttle uploads](https://gerrit.wikimedia.org/r/c/246868) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_25](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_25) | +30 -0 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T91850)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | *None* | T108064 [MediaWiki Security release 1.25.3](/T108064) |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T91850 [No rate limits on uploading files](/T91850) |
|  |  | Resolved |  | [Anomie](/p/Anomie/) | T91205 [ApiUpload needs sanity check on chunk size](/T91205) |

Mentioned In [T91205: ApiUpload needs sanity check on chunk size](/T91205)
[T108616: Local path disclosure when using ImageMagick as a scaler](/T108616) Mentioned Here [T91205: ApiUpload needs sanity check on chunk size](/T91205)
[T108616: Local path disclosure when using ImageMagick as a scaler](/T108616)
### Event Timeline

[• csteipp](/p/csteipp/) created this task.[Mar 7 2015, 1:06 AM2015-03-07 01:06:28 (UTC+0)](#1097452)[• csteipp](/p/csteipp/) raised the priority of this task from  to Medium.[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ag3jmq7c34bgj3u/)[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[• csteipp](/p/csteipp/) changed the visibility from "Public (No Login Required)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-mozqjexstxvl7vh/)".[• csteipp](/p/csteipp/) changed the edit policy from "All Users" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-3ggfxzbccrmseb6/)".[• csteipp](/p/csteipp/) changed Security from None to Software security bug.[• csteipp](/p/csteipp/) subscribed.Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/608343/)[Mar 7 2015, 1:06 AM2015-03-07 01:06:28 (UTC+0)](#1097461)[Aklapper](/p/Aklapper/) added a project: [MediaWiki-Uploading](/tag/mediawiki-uploading/).[Mar 7 2015, 8:13 AM2015-03-07 08:13:17 (UTC+0)](#1097783)Restricted Application added a project: [Multimedia](/tag/multimedia/).  · [View Herald Transcript](/herald/transcript/608489/)[Mar 7 2015, 8:13 AM2015-03-07 08:13:17 (UTC+0)](#1097784)[• csteipp](/p/csteipp/) added a subtask: [T91205: ApiUpload needs sanity check on chunk size](/T91205).[Mar 9 2015, 11:25 PM2015-03-09 23:25:28 (UTC+0)](#1102224)[• csteipp](/p/csteipp/) added a parent task: Restricted Task.[Mar 19 2015, 9:28 PM2015-03-19 21:28:38 (UTC+0)](#1133408)[• dpatrick](/p/dpatrick/) claimed this task.[Jun 9 2015, 9:26 PM2015-06-09 21:26:09 (UTC+0)](#1350763)[• dpatrick](/p/dpatrick/) added a project: [Security-Team](/tag/security-team/).[Jun 9 2015, 9:30 PM2015-06-09 21:30:07 (UTC+0)](#1350781)[• csteipp](/p/csteipp/) added a comment.[Jul 1 2015, 6:00 PM2015-07-01 18:00:33 (UTC+0)](#1418190)Comment Actions

Ran into my first stab at this while working on something else, so figured I should just finish it.

T91850.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/3mkwfmyfpegwjmjqafkt/PHID-FILE-aktk2zbqlphlwafhoe2e/T91850.patch)

I don't like checking all the entrypoints, but that's where we do the rights and block checks, so seemed like a logical place. Not sure if there are other ways to upload files? Maybe extensions?

[• csteipp](/p/csteipp/) moved this task from [Incoming](/project/board/1179/) to [In Progress](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Jul 1 2015, 8:55 PM2015-07-01 20:55:21 (UTC+0)](#1418693)[• csteipp](/p/csteipp/) added a subscriber: [Anomie](/p/Anomie/).[Jul 2 2015, 4:27 PM2015-07-02 16:27:49 (UTC+0)](#1421396)Comment Actions

[@dpatrick](/p/dpatrick/) / [@Anomie](/p/Anomie/), could you take a look at the patch and see if it seems sane to you?

To test, I'm using T91850-exploit.php3 KB[Download](https://phab.wmfusercontent.org/file/download/cj3yrklcnrzmjyfsc35d/PHID-FILE-5sl3z2fvaozwqauwnkcd/T91850-exploit.php) and

```
$wgRateLimits = array(
	'upload' => array(
		'user' => array( 1, 60 ),
		'newbie' => array( 1, 60 ),
		'ip' => array( 1, 60 ),
	)
);
```
[• dpatrick](/p/dpatrick/) added a comment.[Jul 6 2015, 4:40 PM2015-07-06 16:40:39 (UTC+0)](#1430562)Comment Actions

[@csteipp](/p/csteipp/), I observed that the upload was appropriately throttled, from both the API and the web form. However, I also noticed that simply viewing the web form is also throttled. If I navigate to [http://localhost:8080/wiki/Special:Upload](http://localhost:8080/wiki/Special%3AUpload), then hit refresh without selecting a file or submitting the form, I receive the action-throttled message in the browser.

[Anomie](/p/Anomie/) added a comment.[Jul 6 2015, 4:54 PM2015-07-06 16:54:06 (UTC+0)](#1430637)Comment Actions

In the API bit, a chunked upload would be applying the throttle to each chunk of the file.

It also throttles the polling for status if the client is waiting for an async upload or an upload-from-url. Even if the former is intended, this probably isn't.

[• dpatrick](/p/dpatrick/) reassigned this task from [• dpatrick](/p/dpatrick/) to [• csteipp](/p/csteipp/).[Jul 7 2015, 7:00 PM2015-07-07 19:00:10 (UTC+0)](#1435521)[• csteipp](/p/csteipp/) added a subscriber: [MarkTraceur](/p/MarkTraceur/).[Jul 10 2015, 11:05 PM2015-07-10 23:05:18 (UTC+0)](#1446746)Comment Actions

Moved the throttling later in both the special page and api, so chunks and warnings are correctly handled. This allows a user to upload to the stash unthrottled. Otherwise in UploadWizard, the upload to the stash was one count against the throttle, then finalizing the upload was a second. I'm not sure if that's the right behavior or not. As a side effect, you can add more files to the initial step of UploadWizard than the throttle allows, and UploadWizard just fails to move the file from the stash. Except for missing an api-error-ratelimited message, the failure is fairly graceful.

[@MarkTraceur](/p/MarkTraceur/), is there someone on the multimedia team who can comment on this?

T91850b.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/vcs62faeht5rzsbxol32/PHID-FILE-ukbp3awbck3lgwptmjht/T91850b.patch)

[MarkTraceur](/p/MarkTraceur/) added a comment.[Jul 29 2015, 5:23 PM2015-07-29 17:23:23 (UTC+0)](#1492227)Comment Actions

My two cents: This sounds fine, James\_F might want to comment, but UploadWizard already throttles to 3 uploads to stash or 3 stash upload finalizations at once (per window, I guess), so this doesn't look like a huge issue from that end.

[Jdforrester-WMF](/p/Jdforrester-WMF/) subscribed.[Jul 29 2015, 5:24 PM2015-07-29 17:24:18 (UTC+0)](#1492229)Comment Actions

Seems fine to me.

[• csteipp](/p/csteipp/) added a subscriber: [• dpatrick](/p/dpatrick/).[Jul 29 2015, 8:49 PM2015-07-29 20:49:04 (UTC+0)](#1492745)Comment Actions

[@dpatrick](/p/dpatrick/) / [@Anomie](/p/Anomie/), could you take a look at the new patch?

T91850b.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/vcs62faeht5rzsbxol32/PHID-FILE-ukbp3awbck3lgwptmjht/T91850b.patch)

[Anomie](/p/Anomie/) added a comment.[Jul 30 2015, 1:33 PM2015-07-30 13:33:23 (UTC+0)](#1494619)Comment Actions

API bit looks ok. Haven't tested.

[• dpatrick](/p/dpatrick/) added a comment.[Aug 3 2015, 5:37 PM2015-08-03 17:37:02 (UTC+0)](#1503628)Comment Actions

When uploading at [http://localhost:8080/wiki/Special:Upload](http://localhost:8080/wiki/Special%3AUpload), I now get throttled message after the final form submission, after the file has been uploaded and compared to existing files, and I've entered a description. This might be frustrating for users. Other than this, the patch looks good.

[• csteipp](/p/csteipp/) added a comment.[Aug 4 2015, 1:27 AM2015-08-04 01:27:01 (UTC+0)](#1505256)Comment Actions

T91850c.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/sdtwstjyhoqhjdiea35v/PHID-FILE-mu4o7pl32kgcj7z26yzk/T91850c.patch)

Made Special:Upload use a RecoverableUploadError instead of throwing an exception. So error message is a little nicer.

[• csteipp](/p/csteipp/) added a parent task: [T108064: MediaWiki Security release 1.25.3](/T108064).[Aug 5 2015, 5:17 PM2015-08-05 17:17:13 (UTC+0)](#1511417)[• csteipp](/p/csteipp/) removed a parent task: Restricted Task.[• csteipp](/p/csteipp/) added projects: [Security-Core](/tag/security-core/), [Vuln-DoS](/tag/vuln-dos/).[Aug 20 2015, 9:35 PM2015-08-20 21:35:15 (UTC+0)](#1558845)[Jdforrester-WMF](/p/Jdforrester-WMF/) moved this task from [Untriaged](/project/board/48/) to [Next up](/project/board/48/) on the [Multimedia](/tag/multimedia/) board.[Sep 4 2015, 6:25 PM2015-09-04 18:25:24 (UTC+0)](#1608642)[• csteipp](/p/csteipp/) closed this task as Resolved.[Sep 9 2015, 10:13 PM2015-09-09 22:13:41 (UTC+0)](#1622728)Comment Actions

Deployed yesterday

(2015-09-08) 21:02 csteipp: deployed patches for [T108616](/T108616) [T91850](/T91850) [T91205](/T91205) to wmf21 & 22

[• csteipp](/p/csteipp/) mentioned this in [T108616: Local path disclosure when using ImageMagick as a scaler](/T108616).[Sep 9 2015, 10:14 PM2015-09-09 22:14:01 (UTC+0)](#1622737)[• csteipp](/p/csteipp/) mentioned this in [T91205: ApiUpload needs sanity check on chunk size](/T91205).[• csteipp](/p/csteipp/) closed subtask [T91205: ApiUpload needs sanity check on chunk size](/T91205) as Resolved.[matmarex](/p/matmarex/) reopened subtask [T91205: ApiUpload needs sanity check on chunk size](/T91205) as Open.[Sep 12 2015, 9:21 PM2015-09-12 21:21:53 (UTC+0)](#1634387)[Anomie](/p/Anomie/) closed subtask [T91205: ApiUpload needs sanity check on chunk size](/T91205) as Resolved.[Sep 14 2015, 5:09 PM2015-09-14 17:09:36 (UTC+0)](#1638092)[• csteipp](/p/csteipp/) moved this task from [In Progress](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Oct 13 2015, 11:56 PM2015-10-13 23:56:35 (UTC+0)](#1724037)[• demon](/p/demon/) subscribed.[Oct 15 2015, 7:36 PM2015-10-15 19:36:54 (UTC+0)](#1729065)Comment Actions

Patch applies to all branches cleanly except REL1\_23. Will work on alternate patch.

[• demon](/p/demon/) added a comment.[Oct 15 2015, 7:53 PM2015-10-15 19:53:07 (UTC+0)](#1729108)This comment was removed by [• demon](/p/demon/).[• demon](/p/demon/) added a comment.[Oct 15 2015, 8:24 PM2015-10-15 20:24:29 (UTC+0)](#1729219)Comment Actions

T91850c-REL1\_23.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/pgt2hsxx3ws5etftfcih/PHID-FILE-wbcndob4diboauv5hmcu/T91850c-REL1_23.patch)

[• demon](/p/demon/) awarded a token.[Oct 15 2015, 8:43 PM2015-10-15 20:43:11 (UTC+0)](#1729275)[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-vattubppbqy2vpz/)[Oct 16 2015, 12:57 AM2015-10-16 00:57:50 (UTC+0)](#1729939)[• csteipp](/p/csteipp/) added a subscriber: [Grunny](/p/Grunny/).[Oct 16 2015, 3:03 PM2015-10-16 15:03:03 (UTC+0)](#1730772)[• csteipp](/p/csteipp/) added a subscriber: [ProgramCeltic](/p/ProgramCeltic/).[Oct 16 2015, 4:10 PM2015-10-16 16:10:12 (UTC+0)](#1731012)[• csteipp](/p/csteipp/) added a subscriber: [Ejegg](/p/Ejegg/).[Oct 16 2015, 4:39 PM2015-10-16 16:39:07 (UTC+0)](#1731063)[• demon](/p/demon/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-btfbuxx5azhexwo/)" to "Public (No Login Required)".[Oct 16 2015, 6:13 PM2015-10-16 18:13:18 (UTC+0)](#1731487)[• demon](/p/demon/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-puca3mb5fr7fcgz/)" to "All Users".[• demon](/p/demon/) changed Security from Software security bug to None.Restricted Application added subscribers: [Steinsplitter](/p/Steinsplitter/), [Matanya](/p/Matanya/).  · [View Herald Transcript](/herald/transcript/1011745/)[Oct 16 2015, 6:13 PM2015-10-16 18:13:19 (UTC+0)](#1731490)[gerritbot](/p/gerritbot/) subscribed.[Oct 16 2015, 6:19 PM2015-10-16 18:19:23 (UTC+0)](#1731536)Comment Actions

Change 246868 had a related patch set uploaded (by Chad):

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246868>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Oct 16 2015, 6:19 PM2015-10-16 18:19:24 (UTC+0)](#1731537)Comment Actions

Change 246873 had a related patch set uploaded (by Chad):

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246873>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 6:20 PM2015-10-16 18:20:04 (UTC+0)](#1731552)Comment Actions

Change 246879 had a related patch set uploaded (by Chad):

Add throttle check in ApiUpload and SpecialUpload.

<https://gerrit.wikimedia.org/r/246879>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 6:24 PM2015-10-16 18:24:48 (UTC+0)](#1731565)Comment Actions

Change 246884 had a related patch set uploaded (by Chad):

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246884>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 7:03 PM2015-10-16 19:03:20 (UTC+0)](#1731732)Comment Actions

Change 246868 merged by jenkins-bot:

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246868>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 7:13 PM2015-10-16 19:13:41 (UTC+0)](#1731758)Comment Actions

Change 246879 merged by jenkins-bot:

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246879>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 7:15 PM2015-10-16 19:15:24 (UTC+0)](#1731779)Comment Actions

Change 246873 merged by Chad:

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246873>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added projects: [MW-1.25-release](/tag/mw-1.25-release/), [MW-1.24-release](/tag/mw-1.24-release/), [MW-1.23-release](/tag/mw-1.23-release/).[Oct 16 2015, 8:00 PM2015-10-16 20:00:37 (UTC+0)](#1731879)[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 8:56 PM2015-10-16 20:56:15 (UTC+0)](#1732006)Comment Actions

Change 246973 had a related patch set uploaded (by Chad):

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246973>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 9:09 PM2015-10-16 21:09:34 (UTC+0)](#1732024)Comment Actions

Change 246884 merged by jenkins-bot:

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246884>

[gerritbot](/p/gerritbot/) added a comment.[Oct 16 2015, 9:17 PM2015-10-16 21:17:40 (UTC+0)](#1732034)Comment Actions

Change 246973 merged by jenkins-bot:

SECURITY: Throttle uploads

<https://gerrit.wikimedia.org/r/246973>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added projects: [MW-1.27-release-notes](/tag/mw-1.27-release-notes/), [MW-1.27-release (WMF-deploy-2015-10-27\_(1.27.0-wmf.4))](/tag/wmf-deploy-2015-10-27_%281.27.0-wmf.4%29/), [MW-1.26-release](/tag/mw-1.26-release/).[Oct 16 2015, 10:00 PM2015-10-16 22:00:37 (UTC+0)](#1732121)[• csteipp](/p/csteipp/) added a comment.[Nov 3 2015, 9:11 PM2015-11-03 21:11:50 (UTC+0)](#1779154)Comment Actions

This was assigned CVE-2015-8003, with the caveat:

> Use CVE-2015-8003. An important note here is that the MITRE CVE team
>
> accepted this CVE request only because it came from the organization
>
> that wrote the code. In the general case, adding completely new
>
> functionality such as an upload rate limit is a security enhancement
>
> and not eligible for a CVE ID.

Since MediaWiki generally considers uploads as an edit, and edits are throttled, I think the CVE here was appropriate.

[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-lyyfpoxwxb4pacs/)[Nov 3 2015, 9:12 PM2015-11-03 21:12:03 (UTC+0)](#1779155)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:59 PM2020-02-10 22:59:40 (UTC+0)](#5869810) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:17 PM2020-02-20 20:17:59 (UTC+0)](#5904831) · [Aklapper](/p/Aklapper/) removed subscribers: [• dpatrick](/p/dpatrick/), [Anomie](/p/Anomie/).[Oct 16 2020, 5:42 PM2020-10-16 17:42:31 (UTC+0)](#6555168) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
