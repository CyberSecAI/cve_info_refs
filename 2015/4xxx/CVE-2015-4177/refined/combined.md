=== Content from www.openwall.com_b445c538_20250124_201523.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[<thread-prev]](4) [[thread-next>]](6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <874mmo54ll.fsf@x220.int.ebiederm.org>
Date: Thu, 04 Jun 2015 02:12:54 -0500
From: ebiederm@...ssion.com (Eric W. Biederman)
To: P J P <ppandit@...hat.com>
Cc: oss security list <oss-security@...ts.openwall.com>,  cve-assign@...re.org
Subject: Re: Re: CVE request Linux kernel: ns: user namespaces panic

P J P <ppandit@...hat.com> writes:

> +-- On Wed, 3 Jun 2015, cve-assign@...re.org wrote --+
> | We feel that this is best covered by two CVE IDs. The
> | cd4a40174b71acd021877341684d8bb1dc8ea4ae issue seems to be about lack of
> | state identification (i.e., the state is whether the path is mounted or
> | unmounted),
>
>   Not sure if it'd have security implications which an end user could use or
> trigger. CC'ing upstream author Eric for any clarificaitons.

The core issue is that a unprivileged user could call umount(MNT_DETACH)
and in the right circumstances gain access to every file on essentially
any filesystem in the mount namespace.

So in a kernel with user namespaces enabled and you are running a
sandbox like docker that has a real root user inside.  That root user
could with a little work remove every ro bind mount on top of proc.
Such as /proc/sys/.

Allowing a user that simply has uid 0 and no caps access to do all kinds
of interesting things.

The bug fix modifies umount(MNT_DETACH) to keeps mounts covered
even after the actual umount.  That changes makes it unsafe for
copy_tree to run on an unmounted mount tree because one of it's
assumptions is violated.  Which assumption I do not remember at this
late hour.  But I think it was something bad enough to cause a crash.
I can not recall all of the details when reading through the code
at this late hour.

Previously copy_tree on an unmounted tree would just return a single
struct mount as all of the connections would have been cleanly removed.

So I believe cd4a40174b71acd021877341684d8bb1dc8ea4ae prevents a
difficult to trigger crash if you have
e0c9c0afd2fc958ffa34b697972721d81df8a56f applied.

e0c9c0afd2fc958ffa34b697972721d81df8a56f mnt: Update detach_mounts to leave mounts connected
is the real bug fix that fixes a fairly scary issue.

I hope that helps.

Eric

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.kernel.org_d91d2a5c_20250124_201523.html ===
commit be4cb235441a691ee63ba5e00843a9c210be5b8a
Author: Greg Kroah-Hartman
Date: Sat Jun 6 08:21:22 2015 -0700
Linux 4.0.5
commit 073aba98f6a2235e2ac4a8402b1a131ab032876e
Author: Andrew Morton
Date: Thu May 28 15:44:24 2015 -0700
fs/binfmt\_elf.c:load\_elf\_binary(): return -EINVAL on zero-length mappings
commit 2b1d3ae940acd11be44c6eced5873d47c2e00ffa upstream.
load\_elf\_binary() returns `retval', not `error'.
Fixes: a87938b2e246b81b4fb ("fs/binfmt\_elf.c: fix bug in loading of PIE binaries")
Reported-by: James Hogan
Cc: Michael Davidson
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c368845702b75c0febc8d54a0489d1e9505cc81d
Author: NeilBrown
Date: Thu May 28 17:53:29 2015 +1000
md: fix race when unfreezing sync\_action
commit 56ccc1125bc141cf63927eda7febff4216dea2d3 upstream.
A recent change removed the need for locking around writing
to "sync\_action" (and various other places), but introduced a
subtle race.
When e.g. setting 'reshape' on a 'frozen' array, the 'frozen'
flag is cleared before 'reshape' is set, so the md thread can
get in and start trying recovery - which isn't wanted.
So instead of clearing MD\_RECOVERY\_FROZEN for any command
except 'frozen', only clear it when each specific command
is parsed. This allows the handling of 'reshape' to clear
the bit while a lock is held.
Also remove some places where we set MD\_RECOVERY\_NEEDED,
as it is always set on non-error exit of the function.
Signed-off-by: NeilBrown
Fixes: 6791875e2e53 ("md: make reconfig\_mutex optional for writes to md sysfs files.")
Signed-off-by: Greg Kroah-Hartman
commit 9ac144beb909307828a779745d8189bfa52a45f9
Author: Naidu Tellapati
Date: Fri May 8 18:47:31 2015 -0300
pwm: img: Impose upper and lower timebase steps value
commit 1e70897d0e20f988abedcf73b33684ecd2be9511 upstream.
The PWM hardware on Pistachio platform has a maximum timebase steps
value to 255. To fix it, let's introduce a compatible-specific
data structure to contain the SoC-specific details and use it to
specify a maximum timebase.
Also, let's limit the minimum timebase to 16 steps, to allow a sane
range of duty cycle steps.
Fixes: 277bb6a29e00 ("pwm: Imagination Technologies PWM DAC driver")
Signed-off-by: Naidu Tellapati
Signed-off-by: Ezequiel Garcia
Signed-off-by: Thierry Reding
Signed-off-by: Greg Kroah-Hartman
commit eb20e69ac83a1e4d764a49bf671e1e2e5dc4c15c
Author: Kevin Cernekee
Date: Wed Apr 22 09:30:53 2015 -0300
UBI: block: Add missing cache flushes
commit 98fb1ffd8154890d7051750e61ff5548c3ee2ab2 upstream.
Block drivers are responsible for calling flush\_dcache\_page() on each
BIO request. This operation keeps the I$ coherent with the D$ on
architectures that don't have hardware coherency support. Without this
flush, random crashes are seen when executing user programs from an ext4
filesystem backed by a ubiblock device.
This patch is based on the change implemented in commit 2d4dc890b5c8
("block: add helpers to run flush\_dcache\_page() against a bio and a
request's pages").
Fixes: 9d54c8a33eec ("UBI: R/O block driver on top of UBI volumes")
Signed-off-by: Kevin Cernekee
Signed-off-by: Ezequiel Garcia
Signed-off-by: Richard Weinberger
Signed-off-by: Greg Kroah-Hartman
commit cb0751cdf54abec60b58004484b84993564cb9be
Author: Vineet Gupta
Date: Sun May 10 12:04:01 2015 +0530
ARC: unbork !LLSC build
commit daaf40e53b5dbdf75255d58a45ce8ac65ca511a8 upstream.
Fixes: f7d11e93ee97a locking,arch,arc: Fold atomic\_ops
Signed-off-by: Vineet Gupta
Signed-off-by: Greg Kroah-Hartman
commit 889c495bb4ba20dd667cfd2dd10497e3120af824
Author: Wei Yongjun
Date: Thu Apr 16 20:19:43 2015 +0800
power/reset: at91: fix return value check in at91\_reset\_platform\_probe()
commit 932df43005389300a3336421e4aedb25390ae144 upstream.
In case of error, the function devm\_ioremap() returns NULL
not ERR\_PTR(). The IS\_ERR() test in the return value check
should be replaced with NULL test.
Fixes: ecfe64d8c55f ("power: reset: Add AT91 reset driver")
Signed-off-by: Wei Yongjun
Signed-off-by: Sebastian Reichel
Signed-off-by: Greg Kroah-Hartman
commit d38e166a121b62819e13b32560ef8673c8467535
Author: Sasha Levin
Date: Wed Jan 28 15:30:43 2015 -0500
vfs: read file\_handle only once in handle\_to\_path
commit 161f873b89136eb1e69477c847d5a5033239d9ba upstream.
We used to read file\_handle twice. Once to get the amount of extra
bytes, and once to fetch the entire structure.
This may be problematic since we do size verifications only after the
first read, so if the number of extra bytes changes in userspace between
the first and second calls, we'll have an incoherent view of
file\_handle.
Instead, read the constant size once, and copy that over to the final
structure without having to re-read it again.
Signed-off-by: Sasha Levin
Cc: Al Viro
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit e8f61366d2ad418d3ff69aff398badbce5f03028
Author: Oded Gabbay
Date: Tue May 5 11:15:07 2015 +0300
drm/amdkfd: Don't report local memory size
commit 42e08c78360e58516b6ac8af18a75a494f2967a2 upstream.
This patch sets the local memory size that is reported to userspace to 0.
This is done to make sure that userspace won't try to allocate local memory
for HSA.
As long as amdkfd doesn't support allocating local memory for HSA,
we need this patch.
Signed-off-by: Oded Gabbay
Cc: stable@vger.kernel.org
Reviewed-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit c6b069f42344ec1cb8d9c8ef0d764896da000d85
Author: Junichi Nomura
Date: Fri May 29 08:51:03 2015 +0000
dm: fix reload failure of 0 path multipath mapping on blk-mq devices
commit 15b94a690470038aa08247eedbebbe7e2218d5ee upstream.
dm-multipath accepts 0 path mapping.
# echo '0 2097152 multipath 0 0 0 0' | dmsetup create newdev
Such a mapping can be used to release underlying devices while still
holding requests in its queue until working paths come back.
However, once the multipath device is created over blk-mq devices,
it rejects reloading of 0 path mapping:
# echo '0 2097152 multipath 0 0 1 1 queue-length 0 1 1 /dev/sda 1' \
| dmsetup create mpath1
# echo '0 2097152 multipath 0 0 0 0' | dmsetup load mpath1
device-mapper: reload ioctl on mpath1 failed: Invalid argument
Command failed
With following kernel message:
device-mapper: ioctl: can't change device type after initial table load.
DM tries to inherit the current table type using dm\_table\_set\_type()
but it doesn't work as expected because of unnecessary check about
whether the target type is hybrid or not.
Hybrid type is for targets that work as either request-based or bio-based
and not required for blk-mq or non blk-mq checking.
Fixes: 65803c205983 ("dm table: train hybrid target type detection to select blk-mq if appropriate")
Signed-off-by: Jun'ichi Nomura
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit ee609242fe218d874b8d0779e82fcde7af4aa09b
Author: Joe Thornber
Date: Fri May 29 14:52:51 2015 +0100
dm: fix casting bug in dm\_merge\_bvec()
commit 1c220c69ce0dcc0f234a9f263ad9c0864f971852 upstream.
dm\_merge\_bvec() was originally added in f6fccb ("dm: introduce
merge\_bvec\_fn"). In that commit a value in sectors is converted to
bytes using << 9, and then assigned to an int. This code made
assumptions about the value of BIO\_MAX\_SECTORS.
A later commit 148e51 ("dm: improve documentation and code clarity in
dm\_merge\_bvec") was meant to have no functional change but it removed
the use of BIO\_MAX\_SECTORS in favor of using queue\_max\_sectors(). At
this point the cast from sector\_t to int resulted in a zero value. The
fallout being dm\_merge\_bvec() would only allow a single page to be added
to a bio.
This interim fix is minimal for the benefit of stable@ because the more
comprehensive cleanup of passing a sector\_t to all DM targets' merge
function will impact quite a few DM targets.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit efbf9472653b6e4546ac7f38fee6cf3387c56926
Author: Christian König
Date: Thu May 28 15:51:59 2015 +0200
drm/radeon: partially revert "fix VM\_CONTEXT\*\_PAGE\_TABLE\_END\_ADDR handling"
commit 7c0411d2fabc2e2702c9871ffb603e251158b317 upstream.
We have that bug for years and some users report side effects when fixing it on older hardware.
So revert it for VM\_CONTEXT0\_PAGE\_TABLE\_END\_ADDR, but keep it for VM 1-15.
Signed-off-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit fab277ad2e933891f4fe475bc63fe5e103dc4512
Author: Alex Deucher
Date: Wed May 27 11:43:53 2015 -0400
Revert "drm/radeon: only mark audio as connected if the monitor supports it (v3)"
commit 2d1c18bba15daf89d75ce475ecd2068f483aa12f upstream.
This breaks too many things.
bugs:
https://bugzilla.kernel.org/show\_bug.cgi?id=99041
https://bugs.freedesktop.org/show\_bug.cgi?id=90681
This reverts commit 0f55db36d49d45b80eff0c0a2a498766016f458b.
Signed-off-by: Greg Kroah-Hartman
commit 6f12bb6e50e5674eaab76693b44c4407e7bf8e65
Author: Alex Deucher
Date: Wed May 27 11:33:26 2015 -0400
drm/radeon/audio: make sure connector is valid in hotplug case
commit fbfd3bc7dfd7efcad2d2e52bf634f84c80a77a35 upstream.
Avoids a crash when a monitor is hotplugged and the encoder
and connector are not linked yet.
bug:
https://bugs.freedesktop.org/show\_bug.cgi?id=90681
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 025c0732d81e9eabb54b6010803100013bd1c08a
Author: Alex Deucher
Date: Tue May 26 18:01:05 2015 -0400
drm/radeon: don't share plls if monitors differ in audio support
commit a10f0df0615abb194968fc08147f3cdd70fd5aa5 upstream.
Enabling audio may enable different pll dividers. Don't share
plls if the monitors differ in audio support.
bug:
https://bugzilla.kernel.org/show\_bug.cgi?id=98751
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit ca0e02ebc01c44ec45e02cc01c39fa835e25a215
Author: Daniel Vetter
Date: Wed May 20 10:36:32 2015 +0200
drm/plane-helper: Adapt cursor hack to transitional helpers
commit 2e7f43c41c042d6fed4d67aceeaae32d8f102e98 upstream.
In
commit f02ad907cd9e7fe3a6405d2d005840912f1ed258
Author: Daniel Vetter
Date: Thu Jan 22 16:36:23 2015 +0100
drm/atomic-helpers: Recover full cursor plane behaviour
we've added a hack to atomic helpers to never to vblank waits for
cursor updates through the legacy apis since that's what X expects.
Unfortunately we've (again) forgotten to adjust the transitional
helpers. Do this now.
This fixes regressions for drivers only partially converted over to
atomic (like i915).
Reported-by: Pekka Paalanen
Cc: Pekka Paalanen
Signed-off-by: Daniel Vetter
Reviewed-and-tested-by: Mario Kleiner
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 5aff4de2715b693356060b54b17e63976dedbad4
Author: Alex Deucher
Date: Mon May 18 10:38:25 2015 -0400
drm/radeon: retry dcpd fetch
commit 0f28d1281b6c54cc98746ae61e44e7f540758ed4 upstream.
Retry the dpcd fetch several times. Some eDP panels
fail several times before the fetch is successful.
bug:
https://bugs.freedesktop.org/show\_bug.cgi?id=73530
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 86bdd43466c62a76e1c1d722c61fb3689555e7eb
Author: Christian König
Date: Tue May 12 14:56:17 2015 +0200
drm/radeon: fix VM\_CONTEXT\*\_PAGE\_TABLE\_END\_ADDR handling
commit 607d48063512707a414e346972e2210dc71ab491 upstream.
The mapping range is inclusive between starting and ending addresses.
Signed-off-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 0999701cdc2590cf197f00fcc07c8ad65f1e1ff9
Author: Alex Deucher
Date: Tue May 12 12:51:38 2015 -0400
drm/radeon: add new bonaire pci id
commit fcf3b54282e4c5a95a1f45f67558bc105acdbc6a upstream.
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 96e37b69e181bc65d36a80e687cdc8c84c749083
Author: Liad Kaufman
Date: Thu Apr 16 17:21:12 2015 +0300
iwlwifi: pcie: prevent using unmapped memory in fw monitor
commit 553452e5ffc0ed13214a287549627d02d9d7fbdc upstream.
In the case of a DMA mapping error on the last iteration of
the loop of the allocation of memory of the FW monitor we
indeed free the pages, but don't NULL out the page variable
thus allowing for the possibility of setting the FW monitor
variables with invalid data to use.
Fixes: c2d202017da1 ("iwlwifi: pcie: add firmware monitor capabilities")
Signed-off-by: Liad Kaufman
Signed-off-by: Emmanuel Grumbach
Signed-off-by: Greg Kroah-Hartman
commit d31b01fafb8e1fa260a96113bafe9c531c152e98
Author: Haim Dreyfuss
Date: Wed May 20 08:10:43 2015 +0300
iwlwifi: mvm: Free fw\_status after use to avoid memory leak
commit 2fc863a5143d64b8f06576cc3d7fd5622c5cf3b5 upstream.
fw\_status is the only pointer pointing to a block of memory
allocated above and should be freed after use.
Note: this come from Klockwork static analyzer.
Fixes: 2021a89d7b8a ("iwlwifi: mvm: treat netdetect wake up separately")
Signed-off-by: Haim Dreyfuss
Signed-off-by: Emmanuel Grumbach
Signed-off-by: Greg Kroah-Hartman
commit 73fd965093417091ace8fb526da9f81261171589
Author: Luciano Coelho
Date: Mon May 4 17:03:17 2015 +0300
iwlwifi: mvm: clean net-detect info if device was reset during suspend
commit a500e469ead055f35c7b2d0a1104e1bd58e34e70 upstream.
If the device is reset during suspend with net-detect enabled, we
leave the net-detect information dangling and this causes the next
suspend to fail with a warning:
[21795.351010] WARNING: at /root/iwlwifi/iwlwifi-stack-dev/drivers/net/wireless/iwlwifi/mvm/d3.c:989 \_\_iwl\_mvm\_suspend.isra.6+0x2be/0x460 [iwlmvm]()
[21795.353253] Modules linked in: iwlmvm(O) iwlwifi(O) mac80211(O) cfg80211(O) compat(O) [...]
[21795.366168] CPU: 1 PID: 3645 Comm: bash Tainted: G O 3.10.29-dev #1
[21795.368785] Hardware name: Dell Inc. Latitude E6430/0CPWYR, BIOS A09 12/13/2012
[21795.371441] f8ec6748 f8ec6748 e51f3ce8 c168aa62 e51f3d10 c103a824 c1871238 f8ec6748
[21795.374228] 000003dd f8eb982e f8eb982e 00000000 c3408ed4 c41edbbc e51f3d20 c103a862
[21795.377006] 00000009 00000000 e51f3da8 f8eb982e c41ee3dc 00000004 e7970000 e51f3d74
[21795.379792] Call Trace:
[21795.382461] [] dump\_stack+0x16/0x18
[21795.385133] [] warn\_slowpath\_common+0x64/0x80
[21795.387803] [] ? \_\_iwl\_mvm\_suspend.isra.6+0x2be/0x460 [iwlmvm]
[21795.390485] [] ? \_\_iwl\_mvm\_suspend.isra.6+0x2be/0x460 [iwlmvm]
[21795.393124] [] warn\_slowpath\_null+0x22/0x30
[21795.395787] [] \_\_iwl\_mvm\_suspend.isra.6+0x2be/0x460 [iwlmvm]
[21795.398464] [] iwl\_mvm\_suspend+0xec/0x140 [iwlmvm]
[21795.401127] [] ? del\_timer\_sync+0xa1/0xc0
[21795.403800] [] \_\_ieee80211\_suspend+0x1de/0xff0 [mac80211]
[21795.406459] [] ? mutex\_lock\_nested+0x25d/0x350
[21795.409084] [] ? rtnl\_lock+0x14/0x20
[21795.411685] [] ieee80211\_suspend+0x16/0x20 [mac80211]
[21795.414318] [] wiphy\_suspend+0x74/0x710 [cfg80211]
[21795.416916] [] \_\_device\_suspend+0x1e2/0x220
[21795.419521] [] ? addresses\_show+0xa0/0xa0 [cfg80211]
[21795.422097] [] dpm\_suspend+0x67/0x210
[21795.424661] [] dpm\_suspend\_start+0x4f/0x60
[21795.427219] [] suspend\_devices\_and\_enter+0x60/0x480
[21795.429768] [] ? printk+0x4d/0x4f
[21795.432295] [] pm\_suspend+0x176/0x210
[21795.434830] [] state\_store+0x5d/0xb0
[21795.437410] [] ? wakeup\_count\_show+0x50/0x50
[21795.439961] [] kobj\_attr\_store+0x1b/0x30
[21795.442514] [] sysfs\_write\_file+0xab/0x100
[21795.445088] [] ? sysfs\_poll+0xa0/0xa0
[21795.447659] [] vfs\_write+0xa5/0x1c0
[21795.450212] [] SyS\_write+0x57/0xa0
[21795.452699] [] sysenter\_do\_call+0x12/0x32
[21795.455146] ---[ end trace faf5321baba2bfdb ]---
To fix this, call the iwl\_mvm\_free\_nd() function in case of any error
during resume. Additionally, rename the "out\_unlock" label to err to
make it clearer that it's only called in error conditions.
Signed-off-by: Luciano Coelho
Signed-off-by: Emmanuel Grumbach
Signed-off-by: Greg Kroah-Hartman
commit 379cedd6595888eedad8ccb3cd50048af0992456
Author: Rafael J. Wysocki
Date: Thu May 7 21:19:39 2015 +0200
ACPI / init: Fix the ordering of acpi\_reserve\_resources()
commit b9a5e5e18fbf223502c0b2264c15024e393da928 upstream.
Since acpi\_reserve\_resources() is defined as a device\_initcall(),
there's no guarantee that it will be executed in the right order
with respect to the rest of the ACPI initialization code. On some
systems this leads to breakage if, for example, the address range
that should be reserved for the ACPI fixed registers is given to
the PCI host bridge instead if the race is won by the wrong code
path.
Fix this by turning acpi\_reserve\_resources() into a void function
and calling it directly from within the ACPI initialization sequence.
Reported-and-tested-by: George McCollister
Link: http://marc.info/?t=143092384600002&r=1&w=2
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 31522566a4ef965c057b4d909d178d7f5eea4275
Author: Mark Hounschell
Date: Wed May 13 10:49:09 2015 +0200
sd: Disable support for 256 byte/sector disks
commit 74856fbf441929918c49ff262ace9835048e4e6a upstream.
256 bytes per sector support has been broken since 2.6.X,
and no-one stepped up to fix this.
So disable support for it.
Signed-off-by: Mark Hounschell
Signed-off-by: Hannes Reinecke
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 9ee31238f1eebdd27406bd9b6f59c46875ac3081
Author: K. Y. Srinivasan
Date: Fri May 1 11:03:02 2015 -0700
storvsc: Set the SRB flags correctly when no data transfer is needed
commit dc45708ca9988656d706940df5fd102672c5de92 upstream.
Set the SRB flags correctly when there is no data transfer. Without this
change some IHV drivers will fail valid commands such as TEST\_UNIT\_READY.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Long Li
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 71d4c0486c4dc77f6fe81ddc244426ca7b631950
Author: Benjamin Tissoires
Date: Thu Apr 23 09:08:43 2015 -0700
Input: elantech - fix semi-mt protocol for v3 HW
commit 3c0213d17a09601e0c6c0ae0e27caf70d988290f upstream.
When the v3 hardware sees more than one finger, it uses the semi-mt
protocol to report the touches. However, it currently works when
num\_fingers is 0, 1 or 2, but when it is 3 and above, it sends only 1
finger as if num\_fingers was 1.
This confuses userspace which knows how to deal with extra fingers
when all the slots are used, but not when some are missing.
Fixes: https://bugs.freedesktop.org/show\_bug.cgi?id=90101
Signed-off-by: Benjamin Tissoires
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 41e6fa28dea0ef4efd06e96e785cb88cfe2c17ed
Author: Larry Finger
Date: Fri Apr 24 11:03:37 2015 -0500
rtlwifi: rtl8192cu: Fix kernel deadlock
commit 414b7e3b9ce8b0577f613e656fdbc36b34b444dd upstream.
The USB mini-driver in rtlwifi, which is used by rtl8192cu, issues a call to
usb\_control\_msg() with a timeout value of 0. In some instances where the
interface is shutting down, this infinite wait results in a CPU deadlock. A
one second timeout fixes this problem without affecting any normal operations.
This bug is reported at https://bugzilla.novell.com/show\_bug.cgi?id=927786.
Reported-by: Bernhard Wiedemann
Tested-by: Bernhard Wiedemann
Signed-off-by: Larry Finger
Cc: Bernhard Wiedemann
Cc: Takashi Iwai
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit 4ca8642f51bdacc1e4fc5f04fa3de92ff6de4706
Author: Paul Burton
Date: Wed May 6 11:52:32 2015 +0100
MIPS: fix FP mode selection in lieu of .MIPS.abiflags data
commit 620b155034570f577470cf5309f741bac6a6e32b upstream.
Commit 46490b572544 ("MIPS: kernel: elf: Improve the overall ABI and FPU
mode checks") reworked the ELF FP ABI mode selection logic, but when
CONFIG\_MIPS\_O32\_FP64\_SUPPORT is enabled it breaks the use of binaries
which have no PT\_MIPS\_ABIFLAGS program header & associated
.MIPS.abiflags section.
A default mode is selected based upon whether the ELF contains MIPS32 or
MIPS64 code, but that selection is made in arch\_elf\_pt\_proc.
arch\_elf\_pt\_proc only executes when a PT\_MIPS\_ABIFLAGS program header is
found. If one is not found then arch\_elf\_pt\_proc is never called, and no
default overall\_fp\_mode value is selected. When arch\_check\_elf is
called, both abi0 & abi1 are MIPS\_ABI\_FP\_UNKNOWN which leads to both
prog\_req & interp\_req being set to none\_req. none\_req matches none of
the conditions for mode selection at the end of arch\_check\_elf, so
overall\_fp\_mode is left untouched. Finally once mips\_set\_personality\_fp
is called the BUG() in the default case is then hit & the kernel likely
panics.
Fix this by moving the selection of a default overall mode to the start
of arch\_check\_elf, which runs once per ELF executed regardless of
whether it has a PT\_MIPS\_ABIFLAGS program header.
Signed-off-by: Paul Burton
Cc: Markos Chandras
Cc: Matthew Fortune
Cc: Ralf Baechle
Cc: linux-mips@linux-mips.org
Patchwork: http://patchwork.linux-mips.org/patch/9978/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 99611a7c582093ba5d4ff0d9558087772a949ef2
Author: Benjamin Tissoires
Date: Wed May 6 15:01:31 2015 -0400
Revert "HID: logitech-hidpp: support combo keyboard touchpad TK820"
commit 5006c1052aafa01dab5b0e643b7dac755b41f3bb upstream.
This reverts commit 3a61e97563d78a2ca10752902449570d8433ce76.
The Logitech TK820 seems to be affected by a firmware bug which
delays the sending of the keys (pressed, or released, which triggers
a key-repeat) while holding fingers on the touch sensor.
This behavior can be observed while using the mouse emulation mode
if the user moves the finger while typing (highly improbable though).
Holding the finger still while in the mouse emulation mode does
not trigger the key repeat problem.
So better keep things in their previous state to not have to
explain users that the new key-repeat bug they see is a "feature".
Furthermore, I noticed that I disabled the media keys whith
this patch. Sorry, my bad.
I think it is best to revert the patch, in all the current
versions it has been shipped.
Signed-off-by: Benjamin Tissoires
Signed-off-by: Jiri Kosina
Signed-off-by: Greg Kroah-Hartman
commit 2cde278bd5d222048e3476ac5be6f92e5be5ab13
Author: Eric Work
Date: Mon May 18 23:26:23 2015 -0700
md/raid0: fix restore to sector variable in raid0\_make\_request
commit a81157768a00e8cf8a7b43b5ea5cac931262374f upstream.
The variable "sector" in "raid0\_make\_request()" was improperly updated
by a call to "sector\_div()" which modifies its first argument in place.
Commit 47d68979cc968535cb87f3e5f2e6a3533ea48fbd restored this variable
after the call for later re-use. Unfortunetly the restore was done after
the referenced variable "bio" was advanced. This lead to the original
value and the restored value being different. Here we move this line to
the proper place.
One observed side effect of this bug was discarding a file though
unlinking would cause an unrelated file's contents to be discarded.
Signed-off-by: NeilBrown
Fixes: 47d68979cc96 ("md/raid0: fix bug with chunksize not a power of 2.")
URL: https://bugzilla.kernel.org/show\_bug.cgi?id=98501
Signed-off-by: Greg Kroah-Hartman
commit 37528b574e9f849ba5fc4c1dc38037691094a6be
Author: NeilBrown
Date: Fri May 8 18:19:34 2015 +1000
md/raid5: don't record new size if resize\_stripes fails.
commit 6e9eac2dcee5e19f125967dd2be3e36558c42fff upstream.
If any memory allocation in resize\_stripes fails we will return
-ENOMEM, but in some cases we update conf->pool\_size anyway.
This means that if we try again, the allocations will be assumed
to be larger than they are, and badness results.
So only update pool\_size if there is no error.
This bug was introduced in 2.6.17 and the patch is suitable for
-stable.
Fixes: ad01c9e3752f ("[PATCH] md: Allow stripes to be expanded in preparation for expanding an array")
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit a80e880dc4cb44350bfdd27d5dc3b4bce9d8e784
Author: Nadav Haklai
Date: Wed Apr 15 19:08:08 2015 +0200
thermal: armada: Update Armada 380 thermal sensor coefficients
commit efa86858e1d8970411a140fa1e0c4dd18a8f2a89 upstream.
Improve the Armada 380 thermal sensor accuracy by using updated formula.
The updated formula is:
Temperature[C degrees] = 0.4761 \* tsen\_vsen\_out - 279.1
Signed-off-by: Nadav Haklai
Signed-off-by: Gregory CLEMENT
Signed-off-by: Eduardo Valentin
Signed-off-by: Greg Kroah-Hartman
commit 5368f933ea6ea8ba4edca8a557f67ca6deb0d67c
Author: Jean Delvare
Date: Thu May 14 14:40:50 2015 +0200
firmware: dmi\_scan: Fix ordering of product\_uuid
commit 5c1ac56b51b9d222ab202dec1ac2f4215346129d upstream.
In function dmi\_present(), dmi\_walk\_early() calls dmi\_table(), which
calls dmi\_decode(), which ultimately calls dmi\_save\_uuid(). This last
function makes a decision based on the value of global variable
dmi\_ver. The problem is that this variable is set right \_after\_
dmi\_walk\_early() returns. So dmi\_save\_uuid() always sees dmi\_ver == 0
regardless of the actual version implemented.
This causes /sys/class/dmi/id/product\_uuid to always use the old
ordering even on systems implementing DMI/SMBIOS 2.6 or later, which
should use the new ordering.
This is broken since kernel v3.8 for legacy DMI implementations and
since kernel v3.10 for SMBIOS 2 implementations. SMBIOS 3
implementations with the 64-bit entry point are not affected.
The first breakage does not matter much as in practice legacy DMI
implementations are always for versions older than 2.6, which is when
the UUID ordering changed. The second breakage is more problematic as
it affects the vast majority of x86 systems manufactured since 2009.
Signed-off-by: Jean Delvare
Fixes: 9f9c9cbb6057 ("drivers/firmware/dmi\_scan.c: fetch dmi version from SMBIOS if it exists")
Fixes: 79bae42d51a5 ("dmi\_scan: refactor dmi\_scan\_machine(), {smbios,dmi}\_present()")
Acked-by: Zhenzhong Duan
Cc: Ben Hutchings
Cc: Artem Savkov
Cc: Ivan Khoronzhuk
Cc: Matt Fleming
Signed-off-by: Greg Kroah-Hartman
commit ca7b05188e41ddb83c43cba3f268aba0f0806133
Author: Scott Mayhew
Date: Tue Apr 28 16:29:53 2015 -0400
svcrpc: fix potential GSSX\_ACCEPT\_SEC\_CONTEXT decoding failures
commit 9507271d960a1911a51683888837d75c171cd91f upstream.
In an environment where the KDC is running Active Directory, the
exported composite name field returned in the context could be large
enough to span a page boundary. Attaching a scratch buffer to the
decoding xdr\_stream helps deal with those cases.
The case where we saw this was actually due to behavior that's been
fixed in newer gss-proxy versions, but we're fixing it here too.
Signed-off-by: Scott Mayhew
Reviewed-by: Simo Sorce
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 4ddaddda66914cab4c387375cb9ff37f7305a1f0
Author: Christoph Hellwig
Date: Tue Apr 28 15:41:15 2015 +0200
nfsd: fix the check for confirmed openowner in nfs4\_preprocess\_stateid\_op
commit ebe9cb3bb13e7b9b281969cd279ce70834f7500f upstream.
If we find a non-confirmed openowner we jump to exit the function, but do
not set an error value. Fix this by factoring out a helper to do the
check and properly set the error from nfsd4\_validate\_stateid.
Signed-off-by: Christoph Hellwig
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 070f74196539989b242f3f039720949b85265e16
Author: Christoph Hellwig
Date: Mon Apr 27 14:50:13 2015 +0200
nfsd/blocklayout: pretend we can send deviceid notifications
commit 40cdc7a530c7a075557651a071354bb42b99df08 upstream.
Commit df52699e4fcef ("NFSv4.1: Don't cache deviceids that have no
notifications") causes the Linux NFS client to stop caching deviceid's
unless a server pretends to support deviceid notifications. While this
behavior is stupid and the language around this area in rfc5661 is a
mess carified by an errata that I submittted, Trond insists on this
behavior. Not caching deviceids degrades block layout performance
massively as a GETDEVICEINFO is fairly expensive.
So add this hack to make the Linux client happy again.
Signed-off-by: Christoph Hellwig
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit f138997c09631f1cf6e58a85fa2dda088e3c0c49
Author: Mel Gorman
Date: Thu May 14 15:17:09 2015 -0700
mm, numa: really disable NUMA balancing by default on single node machines
commit b0dc2b9bb4ab782115b964310518ee0b17784277 upstream.
NUMA balancing is meant to be disabled by default on UMA machines but
the check is using nr\_node\_ids (highest node) instead of
num\_online\_nodes (online nodes).
The consequences are that a UMA machine with a node ID of 1 or higher
will enable NUMA balancing. This will incur useless overhead due to
minor faults with the impact depending on the workload. These are the
impact on the stats when running a kernel build on a single node machine
whose node ID happened to be 1:
vanilla patched
NUMA base PTE updates 5113158 0
NUMA huge PMD updates 643 0
NUMA page range updates 5442374 0
NUMA hint faults 2109622 0
NUMA hint local faults 2109622 0
NUMA hint local percent 100 100
NUMA pages migrated 0 0
Signed-off-by: Mel Gorman
Reviewed-by: Rik van Riel
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 54651d44ef59cd8c66845a15d59dac8d7cc10c39
Author: Andi Kleen
Date: Thu May 14 15:16:53 2015 -0700
tools/vm: fix page-flags build
commit 4933f55fe72c86e57efc454dd6e673c7f17af5a3 upstream.
libabikfs.a doesn't exist anymore, so we now need to link with libapi.a.
Signed-off-by: Andi Kleen
Cc: Naoya Horiguchi
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit e54fa19a36291ea803f9b0b1caba1f2b7a726391
Author: Vladimir Davydov
Date: Thu May 14 15:16:58 2015 -0700
kernfs: do not account ino\_ida allocations to memcg
commit 499611ed451508a42d1d7d1faff10177827755d5 upstream.
root->ino\_ida is used for kernfs inode number allocations. Since IDA has
a layered structure, different IDs can reside on the same layer, which
is currently accounted to some memory cgroup. The problem is that each
kmem cache of a memory cgroup has its own directory on sysfs (under
/sys/fs/kernel//cgroup). If the inode number of such a
directory or any file in it gets allocated from a layer accounted to the
cgroup which the cache is created for, the cgroup will get pinned for
good, because one has to free all kmem allocations accounted to a cgroup
in order to release it and destroy all its kmem caches. That said we
must not account layers of ino\_ida to any memory cgroup.
Since per net init operations may create new sysfs entries directly
(e.g. lo device) or indirectly (nf\_conntrack creates a new kmem cache
per each namespace, which, in turn, creates new sysfs entries), an easy
way to reproduce this issue is by creating network namespace(s) from
inside a kmem-active memory cgroup.
Signed-off-by: Vladimir Davydov
Acked-by: Tejun Heo
Cc: Johannes Weiner
Cc: Michal Hocko
Cc: Christoph Lameter
Cc: Pekka Enberg
Cc: David Rientjes
Cc: Joonsoo Kim
Cc: Greg Thelen
Cc: Greg Kroah-Hartman
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 4d039741b4155da5b25bc484b32439794672645f
Author: Vladimir Davydov
Date: Thu May 14 15:16:55 2015 -0700
gfp: add \_\_GFP\_NOACCOUNT
commit 8f4fc071b1926d0b20336e2b3f8ab85c94c734c5 upstream.
Not all kmem allocations should be accounted to memcg. The following
patch gives an example when accounting of a certain type of allocations to
memcg can effectively result in a memory leak. This patch adds the
\_\_GFP\_NOACCOUNT flag which if passed to kmalloc and friends will force the
allocation to go through the root cgroup. It will be used by the next
patch.
Note, since in case of kmemleak enabled each kmalloc implies yet another
allocation from the kmemleak\_object cache, we add \_\_GFP\_NOACCOUNT to
gfp\_kmemleak\_mask.
Alternatively, we could introduce a per kmem cache flag disabling
accounting for all allocations of a particular kind, but (a) we would not
be able to bypass accounting for kmalloc then and (b) a kmem cache with
this flag set could not be merged with a kmem cache without this flag,
which would increase the number of global caches and therefore
fragmentation even if the memory cgroup controller is not used.
Despite its generic name, currently \_\_GFP\_NOACCOUNT disables accounting
only for kmem allocations while user page allocations are always charged.
To catch abusing of this flag, a warning is issued on an attempt of
passing it to mem\_cgroup\_try\_charge.
Signed-off-by: Vladimir Davydov
Cc: Tejun Heo
Cc: Johannes Weiner
Cc: Michal Hocko
Cc: Christoph Lameter
Cc: Pekka Enberg
Cc: David Rientjes
Cc: Joonsoo Kim
Cc: Greg Thelen
Cc: Greg Kroah-Hartman
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit a9996d15757ea207baf4e74b640fcc164863f4d7
Author: Helge Deller
Date: Mon May 11 22:01:27 2015 +0200
parisc,metag: Fix crashes due to stack randomization on stack-grows-upwards architectures
commit d045c77c1a69703143a36169c224429c48b9eecd upstream.
On architectures where the stack grows upwards (CONFIG\_STACK\_GROWSUP=y,
currently parisc and metag only) stack randomization sometimes leads to crashes
when the stack ulimit is set to lower values than STACK\_RND\_MASK (which is 8 MB
by default if not defined in arch-specific headers).
The problem is, that when the stack vm\_area\_struct is set up in fs/exec.c, the
additional space needed for the stack randomization (as defined by the value of
STACK\_RND\_MASK) was not taken into account yet and as such, when the stack
randomization code added a random offset to the stack start, the stack
effectively got smaller than what the user defined via rlimit\_max(RLIMIT\_STACK)
which then sometimes leads to out-of-stack situations and crashes.
This patch fixes it by adding the maximum possible amount of memory (based on
STACK\_RND\_MASK) which theoretically could be added by the stack randomization
code to the initial stack size. That way, the user-defined stack size is always
guaranteed to be at minimum what is defined via rlimit\_max(RLIMIT\_STACK).
This bug is currently not visible on the metag architecture, because on metag
STACK\_RND\_MASK is defined to 0 which effectively disables stack randomization.
The changes to fs/exec.c are inside an "#ifdef CONFIG\_STACK\_GROWSUP"
section, so it does not affect other platformws beside those where the
stack grows upwards (parisc and metag).
Signed-off-by: Helge Deller
Cc: linux-parisc@vger.kernel.org
Cc: James Hogan
Cc: linux-metag@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit eeb50f814afe998469668eb7393b10f1a25b5e94
Author: Russell King
Date: Fri May 15 11:02:23 2015 +0100
ARM: fix missing syscall trace exit
commit 1b97937246d8b97c0760d16d8992c7937bdf5e6a upstream.
Josh Stone reports:
I've discovered a case where both arm and arm64 will miss a ptrace
syscall-exit that they should report. If the syscall is entered
without TIF\_SYSCALL\_TRACE set, then it goes on the fast path. It's
then possible to have TIF\_SYSCALL\_TRACE added in the middle of the
syscall, but ret\_fast\_syscall doesn't check this flag again.
Fix this by always checking for a syscall trace in the fast exit path.
Reported-by: Josh Stone
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit d341d828e6a75ae1ed6492e4b22c64ad7bd80adf
Author: Inki Dae
Date: Sat May 23 11:46:55 2015 +0900
ARM: dts: set display clock correctly for exynos4412-trats2
commit 242ddf04297f2c4768bd8eb7593ab911910c5f76 upstream.
This patch sets display clock correctly. If Display clock isn't set
correctly then you would find below messages and Display controller
doesn't work correctly.
exynos-drm: No connectors reported connected with modes
[drm] Cannot find any crtc or sizes - going 1024x768
Fixes: abc0b1447d49 ("drm: Perform basic sanity checks on probed modes")
Signed-off-by: Inki Dae
Reviewed-by: Krzysztof Kozlowski
Tested-by: Krzysztof Kozlowski
Signed-off-by: Kukjin Kim
Signed-off-by: Greg Kroah-Hartman
commit 4fd61a1c599c1ea49980896e8ce303d4db9aa424
Author: Shawn Guo
Date: Tue May 19 22:06:41 2015 +0800
ARM: dts: fix imx27 dtb build rule
commit e46b5a6470a5e2c8e1096f8f60887ac19949055b upstream.
The i.MX27 dtb build should be controlled by CONFIG\_SOC\_IMX27 rather
than CONFIG\_SOC\_IMX31.
Signed-off-by: Shawn Guo
Fixes: cb612390e546 ("ARM: dts: Only build dtb if associated Arch and/or SoC is enabled")
Signed-off-by: Greg Kroah-Hartman
commit 824cc6b4575cdc9908ba2e043d4ccc66f5a1b807
Author: Philippe Reynes
Date: Wed May 13 00:18:26 2015 +0200
ARM: dts: imx27: only map 4 Kbyte for fec registers
commit a29ef819f3f34f89a1b9b6a939b4c1cdfe1e85ce upstream.
According to the imx27 documentation, fec has a 4 Kbyte
memory space map. Moreover, the actual 16 Kbyte mapping
overlaps the SCC (Security Controller) memory register
space. So, we reduce the memory register space to 4 Kbyte.
Signed-off-by: Philippe Reynes
Acked-by: Uwe Kleine-König
Fixes: 9f0749e3eb88 ("ARM i.MX27: Add devicetree support")
Signed-off-by: Shawn Guo
Signed-off-by: Greg Kroah-Hartman
commit 653a1273c800cf291f3aba73338c47a1792f3015
Author: Krzysztof Kozlowski
Date: Wed May 13 17:45:52 2015 +0900
ARM: EXYNOS: Fix dereference of ERR\_PTR returned by of\_genpd\_get\_from\_provider
commit 0b7dc0ff95237a53287e52f1aab7408ebf1c4085 upstream.
ERR\_PTR was dereferenced during sub domain parsing, if parent domain
could not be obtained (because of invalid phandle or deferred
registration of parent domain).
The Exynos power domain code checked whether
of\_genpd\_get\_from\_provider() returned NULL and in that case it skipped
that power domain node. However this function returns ERR\_PTR or valid
pointer, not NULL.
Fixes: 0f7807518fe1 ("ARM: EXYNOS: add support for sub-power domains")
Signed-off-by: Krzysztof Kozlowski
Signed-off-by: Kukjin Kim
Signed-off-by: Greg Kroah-Hartman
commit 4d7b5527f76c21b42f55e420b51620036170f378
Author: Mark Rutland
Date: Wed May 13 15:07:54 2015 +0100
ARM: 8356/1: mm: handle non-pmd-aligned end of RAM
commit 965278dcb8ab0b1f666cc47937933c4be4aea48d upstream.
At boot time we round the memblock limit down to section size in an
attempt to ensure that we will have mapped this RAM with section
mappings prior to allocating from it. When mapping RAM we iterate over
PMD-sized chunks, creating these section mappings.
Section mappings are only created when the end of a chunk is aligned to
section size. Unfortunately, with classic page tables (where PMD\_SIZE is
2 \* SECTION\_SIZE) this means that if a chunk is between 1M and 2M in
size the first 1M will not be mapped despite having been accounted for
in the memblock limit. This has been observed to result in page tables
being allocated from unmapped memory, causing boot-time hangs.
This patch modifies the memblock limit rounding to always round down to
PMD\_SIZE instead of SECTION\_SIZE. For classic MMU this means that we
will round the memblock limit down to a 2M boundary, matching the limits
on section mappings, and preventing allocations from unmapped memory.
For LPAE there should be no change as PMD\_SIZE == SECTION\_SIZE.
Signed-off-by: Mark Rutland
Reported-by: Stefan Agner
Tested-by: Stefan Agner
Acked-by: Laura Abbott
Tested-by: Hans de Goede
Cc: Catalin Marinas
Cc: Steve Capper
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 22f546a33bac11aea8af5e570f296234ecdd60d4
Author: Shaohua Li
Date: Fri May 8 10:51:29 2015 -0700
sched: always use blk\_schedule\_flush\_plug in io\_schedule\_out
commit 10d784eae2b41e25d8fc6a88096cd27286093c84 upstream.
block plug callback could sleep, so we introduce a parameter
'from\_schedule' and corresponding drivers can use it to destinguish a
schedule plug flush or a plug finish. Unfortunately io\_schedule\_out
still uses blk\_flush\_plug(). This causes below output (Note, I added a
might\_sleep() in raid1\_unplug to make it trigger faster, but the whole
thing doesn't matter if I add might\_sleep). In raid1/10, this can cause
deadlock.
This patch makes io\_schedule\_out always uses blk\_schedule\_flush\_plug.
This should only impact drivers (as far as I know, raid 1/10) which are
sensitive to the 'from\_schedule' parameter.
[ 370.817949] ------------[ cut here ]------------
[ 370.817960] WARNING: CPU: 7 PID: 145 at ../kernel/sched/core.c:7306 \_\_might\_sleep+0x7f/0x90()
[ 370.817969] do not call blocking ops when !TASK\_RUNNING; state=2 set at [] prepare\_to\_wait+0x2f/0x90
[ 370.817971] Modules linked in: raid1
[ 370.817976] CPU: 7 PID: 145 Comm: kworker/u16:9 Tainted: G W 4.0.0+ #361
[ 370.817977] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.7.5-20140709\_153802- 04/01/2014
[ 370.817983] Workqueue: writeback bdi\_writeback\_workfn (flush-9:1)
[ 370.817985] ffffffff81cd83be ffff8800ba8cb298 ffffffff819dd7af 0000000000000001
[ 370.817988] ffff8800ba8cb2e8 ffff8800ba8cb2d8 ffffffff81051afc ffff8800ba8cb2c8
[ 370.817990] ffffffffa00061a8 000000000000041e 0000000000000000 ffff8800ba8cba28
[ 370.817993] Call Trace:
[ 370.817999] [] dump\_stack+0x4f/0x7b
[ 370.818002] [] warn\_slowpath\_common+0x8c/0xd0
[ 370.818004] [] warn\_slowpath\_fmt+0x46/0x50
[ 370.818006] [] ? prepare\_to\_wait+0x2f/0x90
[ 370.818008] [] ? prepare\_to\_wait+0x2f/0x90
[ 370.818010] [] \_\_might\_sleep+0x7f/0x90
[ 370.818014] [] raid1\_unplug+0xd3/0x170 [raid1]
[ 370.818024] [] blk\_flush\_plug\_list+0x8a/0x1e0
[ 370.818028] [] ? bit\_wait+0x50/0x50
[ 370.818031] [] io\_schedule\_timeout+0x130/0x140
[ 370.818033] [] bit\_wait\_io+0x36/0x50
[ 370.818034] [] \_\_wait\_on\_bit+0x65/0x90
[ 370.818041] [] ? ext4\_read\_block\_bitmap\_nowait+0xbc/0x630
[ 370.818043] [] ? bit\_wait+0x50/0x50
[ 370.818045] [] out\_of\_line\_wait\_on\_bit+0x72/0x80
[ 370.818047] [] ? autoremove\_wake\_function+0x40/0x40
[ 370.818050] [] \_\_wait\_on\_buffer+0x44/0x50
[ 370.818053] [] ext4\_wait\_block\_bitmap+0xe0/0xf0
[ 370.818058] [] ext4\_mb\_init\_cache+0x206/0x790
[ 370.818062] [] ? lru\_cache\_add+0x1c/0x50
[ 370.818064] [] ext4\_mb\_init\_group+0x11e/0x200
[ 370.818066] [] ext4\_mb\_load\_buddy+0x341/0x360
[ 370.818068] [] ext4\_mb\_find\_by\_goal+0x93/0x2f0
[ 370.818070] [] ? ext4\_mb\_normalize\_request+0x1e4/0x5b0
[ 370.818072] [] ext4\_mb\_regular\_allocator+0x67/0x460
[ 370.818074] [] ? ext4\_mb\_normalize\_request+0x1e4/0x5b0
[ 370.818076] [] ext4\_mb\_new\_blocks+0x4cb/0x620
[ 370.818079] [] ext4\_ext\_map\_blocks+0x4c6/0x14d0
[ 370.818081] [] ? ext4\_es\_lookup\_extent+0x4e/0x290
[ 370.818085] [] ext4\_map\_blocks+0x14d/0x4f0
[ 370.818088] [] ext4\_writepages+0x76d/0xe50
[ 370.818094] [] do\_writepages+0x21/0x50
[ 370.818097] [] \_\_writeback\_single\_inode+0x60/0x490
[ 370.818099] [] writeback\_sb\_inodes+0x2da/0x590
[ 370.818103] [] ? trylock\_super+0x1b/0x50
[ 370.818105] [] ? trylock\_super+0x1b/0x50
[ 370.818107] [] \_\_writeback\_inodes\_wb+0x9f/0xd0
[ 370.818109] [] wb\_writeback+0x34b/0x3c0
[ 370.818111] [] bdi\_writeback\_workfn+0x23f/0x550
[ 370.818116] [] process\_one\_work+0x1c8/0x570
[ 370.818117] [] ? process\_one\_work+0x14b/0x570
[ 370.818119] [] worker\_thread+0x11b/0x470
[ 370.818121] [] ? process\_one\_work+0x570/0x570
[ 370.818124] [] kthread+0xf8/0x110
[ 370.818126] [] ? kthread\_create\_on\_node+0x210/0x210
[ 370.818129] [] ret\_from\_fork+0x42/0x70
[ 370.818131] [] ? kthread\_create\_on\_node+0x210/0x210
[ 370.818132] ---[ end trace 7b4deb71e68b6605 ]---
V2: don't change ->in\_iowait
Cc: NeilBrown
Signed-off-by: Shaohua Li
Reviewed-by: Jeff Moyer
Signed-off-by: Jens Axboe
Cc: poma
Signed-off-by: Greg Kroah-Hartman
commit 31f17ffdaa4265f352810c4ed5d1dc38226191e7
Author: Thomas Gleixner
Date: Tue May 5 19:49:49 2015 +0200
sched: Handle priority boosted tasks proper in setscheduler()
commit 0782e63bc6fe7e2d3408d250df11d388b7799c6b upstream.
Ronny reported that the following scenario is not handled correctly:
T1 (prio = 10)
lock(rtmutex);
T2 (prio = 20)
lock(rtmutex)
boost T1
T1 (prio = 20)
sys\_set\_scheduler(prio = 30)
T1 prio = 30
....
sys\_set\_scheduler(prio = 10)
T1 prio = 30
The last step is wrong as T1 should now be back at prio 20.
Commit c365c292d059 ("sched: Consider pi boosting in setscheduler()")
only handles the case where a boosted tasks tries to lower its
priority.
Fix it by taking the new effective priority into account for the
decision whether a change of the priority is required.
Reported-by: Ronny Meeus
Tested-by: Steven Rostedt
Signed-off-by: Thomas Gleixner
Signed-off-by: Peter Zijlstra (Intel)
Reviewed-by: Steven Rostedt
Cc: Borislav Petkov
Cc: H. Peter Anvin
Cc: Mike Galbraith
Fixes: c365c292d059 ("sched: Consider pi boosting in setscheduler()")
Link: http://lkml.kernel.org/r/alpine.DEB.2.11.1505051806060.4225@nanos
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 4c266d189f647773dc9cbc4d1d8ade5b5fda05be
Author: Martin Schwidefsky
Date: Wed May 13 14:33:22 2015 +0200
s390/mm: correct return value of pmd\_pfn
commit 7cded342c09f633666e71ee1ce048f218a9c5836 upstream.
Git commit 152125b7a882df36a55a8eadbea6d0edf1461ee7
"s390/mm: implement dirty bits for large segment table entries"
broke the pmd\_pfn function, it changed the return value from
'unsigned long' to 'int'. This breaks all machine configurations
with memory above the 8TB line.
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit 9e1182c1cf53b0b56ce19e06f0171f607c58f2d3
Author: Johannes Berg
Date: Tue May 19 15:40:21 2015 +0200
mac80211: don't use napi\_gro\_receive() outside NAPI context
commit 22d3a3c829fa9ecdb493d1f1f2838d543f8d86a3 upstream.
No matter how the driver manages its NAPI context, there's no way
sending frames to it from a timer can be correct, since it would
corrupt the internal GRO lists.
To avoid that, always use the non-NAPI path when releasing frames
from the timer.
Reported-by: Jean Trivelly
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 510cfd9829c09b00beb6bcf4b4127e85b3008a5a
Author: Janusz Dziedzic
Date: Mon May 11 11:31:15 2015 +0200
mac80211: move WEP tailroom size check
commit 47b4e1fc4972cc43a19121bc2608a60aef3bf216 upstream.
Remove checking tailroom when adding IV as it uses only
headroom, and move the check to the ICV generation that
actually needs the tailroom.
In other case I hit such warning and datapath don't work,
when testing:
- IBSS + WEP
- ath9k with hw crypt enabled
- IPv6 data (ping6)
WARNING: CPU: 3 PID: 13301 at net/mac80211/wep.c:102 ieee80211\_wep\_add\_iv+0x129/0x190 [mac80211]()
[...]
Call Trace:
[] dump\_stack+0x45/0x57
[] warn\_slowpath\_common+0x8a/0xc0
[] warn\_slowpath\_null+0x1a/0x20
[] ieee80211\_wep\_add\_iv+0x129/0x190 [mac80211]
[] ieee80211\_crypto\_wep\_encrypt+0x6b/0xd0 [mac80211]
[] invoke\_tx\_handlers+0xc51/0xf30 [mac80211]
[...]
Signed-off-by: Janusz Dziedzic
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 3da3b2511ff643f0283e6ec0572f764c0990eeda
Author: Harald Freudenberger
Date: Thu May 21 10:01:11 2015 +0200
crypto: s390/ghash - Fix incorrect ghash icv buffer handling.
commit a1cae34e23b1293eccbcc8ee9b39298039c3952a upstream.
Multitheaded tests showed that the icv buffer in the current ghash
implementation is not handled correctly. A move of this working ghash
buffer value to the descriptor context fixed this. Code is tested and
verified with an multithreaded application via af\_alg interface.
Signed-off-by: Harald Freudenberger
Signed-off-by: Gerald Schaefer
Reported-by: Herbert Xu
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 130eaf0aba95afb6534dc3b7ffcecdcd91c751f8
Author: Michael Brunner
Date: Mon May 11 12:46:49 2015 +0200
gpio: gpio-kempld: Fix get\_direction return value
commit f230e8ffc03f17bd9d6b90ea890b8252a8cc1821 upstream.
This patch fixes an inverted return value of the gpio get\_direction
function.
The wrong value causes the direction sysfs entry and GPIO debugfs file
to indicate incorrect GPIO direction settings. In some cases it also
prevents setting GPIO output values.
The problem is also present in all other stable kernel versions since
linux-3.12.
Reported-by: Jochen Henneberg
Signed-off-by: Michael Brunner
Reviewed-by: Guenter Roeck
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 00c1814acf7d9e4e3e7e2928447a449535e267e8
Author: Ard Biesheuvel
Date: Wed Mar 25 07:41:43 2015 +0100
ARM: 8325/1: exynos: move resume code to .text section
commit 12833bacf5d904c2dac0c3f52b2ebde5f2c5a2bc upstream.
This code calls cpu\_resume() using a straight branch (b), so
now that we have moved cpu\_resume() back to .text, this should
be moved there as well. Any direct references to symbols that will
remain in the .data section are replaced with explicit PC-relative
references.
Acked-by: Nicolas Pitre
Signed-off-by: Ard Biesheuvel
Signed-off-by: Russell King
Signed-off-by: Kevin Hilman
Signed-off-by: Greg Kroah-Hartman
commit f651c412da1eb17f0f52bdd69f813db430934f2f
Author: Scott Branden
Date: Mon Mar 16 10:59:52 2015 -0700
rt2x00: add new rt2800usb device DWA 130
commit ea345c145ff23197eab34d0c4d0c8a93d7bea8c6 upstream.
Add the USB Id to link the D-Link DWA 130 USB Wifi adapter
to the rt2830 driver.
Signed-off-by: Scott Branden
Signed-off-by: Pieter Truter
Signed-off-by: Kalle Valo
Cc: Larry Finger
Signed-off-by: Greg Kroah-Hartman
commit ed1525f378fc5df72d39bb65b8233f92fda39158
Author: Xi Wang
Date: Fri May 8 06:39:51 2015 +0100
arm64: bpf: fix signedness bug in loading 64-bit immediate
commit 1e4df6b7208140f3c49f316d33a409d3a161f350 upstream.
Consider "(u64)insn1.imm << 32 | imm" in the arm64 JIT. Since imm is
signed 32-bit, it is sign-extended to 64-bit, losing the high 32 bits.
The fix is to convert imm to u32 first, which will be zero-extended to
u64 implicitly.
Cc: Zi Shen Lim
Cc: Alexei Starovoitov
Cc: Catalin Marinas
Fixes: 30d3d94cc3d5 ("arm64: bpf: add 'load 64-bit immediate' instruction")
Signed-off-by: Xi Wang
[will: removed non-arm64 bits and redundant casting]
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit 484cdf4c0b748bf6f071b5873add1b2ebd0cf5c3
Author: Martin K. Petersen
Date: Mon May 4 12:20:29 2015 -0400
libata: Blacklist queued TRIM on all Samsung 800-series
commit 9a9324d3969678d44b330e1230ad2c8ae67acf81 upstream.
The queued TRIM problems appear to be generic to Samsung's firmware and
not tied to a particular model. A recent update to the 840 EVO firmware
introduced the same issue as we saw on 850 Pro.
Blacklist queued TRIM on all 800-series drives while we work this issue
with Samsung.
Reported-by: Günter Waller
Reported-by: Sven Köhler
Signed-off-by: Martin K. Petersen
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit 8a2c2f84c328b10c8461d0f832c642b1d88bec88
Author: Gabriele Mazzotta
Date: Sat Apr 25 19:52:37 2015 +0200
libata: Ignore spurious PHY event on LPM policy change
commit 09c5b4803a80a5451d950d6a539d2eb311dc0fb1 upstream.
When the LPM policy is set to ATA\_LPM\_MAX\_POWER, the device might
generate a spurious PHY event that cuases errors on the link.
Ignore this event if it occured within 10s after the policy change.
The timeout was chosen observing that on a Dell XPS13 9333 these
spurious events can occur up to roughly 6s after the policy change.
Link: http://lkml.kernel.org/g/3352987.ugV1Ipy7Z5@xps13
Signed-off-by: Gabriele Mazzotta
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit 38f91fb497fd20402061a2d9eece5053f8586cea
Author: Gabriele Mazzotta
Date: Sat Apr 25 19:52:36 2015 +0200
libata: Add helper to determine when PHY events should be ignored
commit 8393b811f38acdf7fd8da2028708edad3e68ce1f upstream.
This is a preparation commit that will allow to add other criteria
according to which PHY events should be dropped.
Signed-off-by: Gabriele Mazzotta
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit 2d00e908eff475205284376b38541fdccf9bd92e
Author: Dan Williams
Date: Fri May 8 15:23:55 2015 -0400
ahci: avoton port-disable reset-quirk
commit dbfe8ef5599a5370abc441fcdbb382b656563eb4 upstream.
Avoton AHCI occasionally sees drive probe timeouts at driver load time.
When this happens SCR\_STATUS indicates device detected, but no D2H FIS
reception. Reset the internal link state machines by bouncing
port-enable in the PCS register when this occurs.
Signed-off-by: Dan Williams
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit 447ceaa34ef46fa4f8ff94823e8b4e056c9f1135
Author: Darrick J. Wong
Date: Thu May 14 19:11:50 2015 -0400
jbd2: fix r\_count overflows leading to buffer overflow in journal recovery
commit e531d0bceb402e643a4499de40dd3fa39d8d2e43 upstream.
The journal revoke block recovery code does not check r\_count for
sanity, which means that an evil value of r\_count could result in
the kernel reading off the end of the revoke table and into whatever
garbage lies beyond. This could crash the kernel, so fix that.
However, in testing this fix, I discovered that the code to write
out the revoke tables also was not correctly checking to see if the
block was full -- the current offset check is fine so long as the
revoke table space size is a multiple of the record size, but this
is not true when either journal\_csum\_v[23] are set.
Signed-off-by: Darrick J. Wong
Signed-off-by: Theodore Ts'o
Reviewed-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit fcfd96db3edc3ab1d2664cd4c5bf76adcb4dc198
Author: Eryu Guan
Date: Thu May 14 19:00:45 2015 -0400
ext4: check for zero length extent explicitly
commit 2f974865ffdfe7b9f46a9940836c8b167342563d upstream.
The following commit introduced a bug when checking for zero length extent
5946d08 ext4: check for overlapping extents in ext4\_valid\_extent\_entries()
Zero length extent could pass the check if lblock is zero.
Adding the explicit check for zero length back.
Signed-off-by: Eryu Guan
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit 69814155cdb829295a2433c0bf4605640a382a9d
Author: Lukas Czerner
Date: Thu May 14 18:55:18 2015 -0400
ext4: fix NULL pointer dereference when journal restart fails
commit 9d506594069355d1fb2de3f9104667312ff08ed3 upstream.
Currently when journal restart fails, we'll have the h\_transaction of
the handle set to NULL to indicate that the handle has been effectively
aborted. We handle this situation quietly in the jbd2\_journal\_stop() and just
free the handle and exit because everything else has been done before we
attempted (and failed) to restart the journal.
Unfortunately there are a number of problems with that approach
introduced with commit
41a5b913197c "jbd2: invalidate handle if jbd2\_journal\_restart()
fails"
First of all in ext4 jbd2\_journal\_stop() will be called through
\_\_ext4\_journal\_stop() where we would try to get a hold of the superblock
by dereferencing h\_transaction which in this case would lead to NULL
pointer dereference and crash.
In addition we're going to free the handle regardless of the refcount
which is bad as well, because others up the call chain will still
reference the handle so we might potentially reference already freed
memory.
Moreover it's expected that we'll get aborted handle as well as detached
handle in some of the journalling function as the error propagates up
the stack, so it's unnecessary to call WARN\_ON every time we get
detached handle.
And finally we might leak some memory by forgetting to free reserved
handle in jbd2\_journal\_stop() in the case where handle was detached from
the transaction (h\_transaction is NULL).
Fix the NULL pointer dereference in \_\_ext4\_journal\_stop() by just
calling jbd2\_journal\_stop() quietly as suggested by Jan Kara. Also fix
the potential memory leak in jbd2\_journal\_stop() and use proper
handle refcounting before we attempt to free it to avoid use-after-free
issues.
And finally remove all WARN\_ON(!transaction) from the code so that we do
not get random traces when something goes wrong because when journal
restart fails we will get to some of those functions.
Signed-off-by: Lukas Czerner
Signed-off-by: Theodore Ts'o
Reviewed-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 11395c8b1918476a402ff74d8d5c6eb1cefc7e30
Author: Theodore Ts'o
Date: Thu May 14 18:19:01 2015 -0400
ext4: fix lazytime optimization
commit 8f4d855839179f410fa910a26eb81d646d628f26 upstream.
We had a fencepost error in the lazytime optimization which means that
timestamp would get written to the wrong inode.
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit 250fcae7fa76332e9835612ef204b224d96b030e
Author: Peter Hurley
Date: Mon Apr 13 13:24:34 2015 -0400
pty: Fix input race when closing
commit 1a48632ffed61352a7810ce089dc5a8bcd505a60 upstream.
A read() from a pty master may mistakenly indicate EOF (errno == -EIO)
after the pty slave has closed, even though input data remains to be read.
For example,
pty slave | input worker | pty master
| |
| | n\_tty\_read()
pty\_write() | | input avail? no
add data | | sleep
schedule worker --->| | .
|---> flush\_to\_ldisc() | .
pty\_close() | fill read buffer | .
wait for worker | wakeup reader --->| .
| read buffer full? |---> input avail ? yes
|<--- yes - exit worker | copy 4096 bytes to user
TTY\_OTHER\_CLOSED <---| |<--- kick worker
| |
\*\*\*\* New read() before worker starts \*\*\*\*
| | n\_tty\_read()
| | input avail? no
| | TTY\_OTHER\_CLOSED? yes
| | return -EIO
Several conditions are required to trigger this race:
1. the ldisc read buffer must become full so the input worker exits
2. the read() count parameter must be >= 4096 so the ldisc read buffer
is empty
3. the subsequent read() occurs before the kicked worker has processed
more input
However, the underlying cause of the race is that data is pipelined, while
tty state is not; ie., data already written by the pty slave end is not
yet visible to the pty master end, but state changes by the pty slave end
are visible to the pty master end immediately.
Pipeline the TTY\_OTHER\_CLOSED state through input worker to the reader.
1. Introduce TTY\_OTHER\_DONE which is set by the input worker when
TTY\_OTHER\_CLOSED is set and either the input buffers are flushed or
input processing has completed. Readers/polls are woken when
TTY\_OTHER\_DONE is set.
2. Reader/poll checks TTY\_OTHER\_DONE instead of TTY\_OTHER\_CLOSED.
3. A new input worker is started from pty\_close() after setting
TTY\_OTHER\_CLOSED, which ensures the TTY\_OTHER\_DONE state will be
set if the last input worker is already finished (or just about to
exit).
Remove tty\_flush\_to\_ldisc(); no in-tree callers.
Fixes: 52bce7f8d4fc ("pty, n\_tty: Simplify input processing on final close")
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=96311
BugLink: http://bugs.launchpad.net/bugs/1429756
Reported-by: Andy Whitcroft
Reported-by: H.J. Lu
Signed-off-by: Peter Hurley
Signed-off-by: Greg Kroah-Hartman
commit a2cdf4d4154459984e0f4db7d8fa7d27d3c7cef8
Author: Pan Xinhui
Date: Sat Mar 28 10:42:56 2015 +0800
tty/n\_gsm.c: fix a memory leak when gsmtty is removed
commit 8f9cfeed3eae86c70d3b04445a6f2036b27b6304 upstream.
when gsmtty\_remove put dlci, it will cause memory leak if dlci->port's refcount is zero.
So we do the cleanup work in .cleanup callback instead.
dlci will be last put in two call chains.
1) gsmld\_close -> gsm\_cleanup\_mux -> gsm\_dlci\_release -> dlci\_put
2) gsmld\_remove -> dlci\_put
so there is a race. the memory leak depends on the race.
In call chain 2. we hit the memory leak. below comment tells.
release\_tty -> tty\_driver\_remove\_tty -> gsmtty\_remove -> dlci\_put -> tty\_port\_destructor (WARN\_ON(port->itty) and return directly)
|
tty->port->itty = NULL;
|
tty\_kref\_put ---> release\_one\_tty -> gsmtty\_cleanup (added by our patch)
So our patch fix the memory leak by doing the cleanup work after tty core did.
Signed-off-by: Pan Xinhui
Fixes: dfabf7ffa30585
Acked-by: Jiri Slaby
Signed-off-by: Greg Kroah-Hartman
commit f7f9c2b1a0a72afc657f6eed6e7c356557a62973
Author: Ludovic Desroches
Date: Wed May 6 15:16:46 2015 +0200
mmc: atmel-mci: fix bad variable type for clkdiv
commit 60c8f783a18feb95ad967c87e9660caf09fb4700 upstream.
clkdiv is declared as an u32 but it can be set to a negative value
causing a huge divisor value. Change its type to int to avoid this case.
Signed-off-by: Ludovic Desroches
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 22c2549f78a0365a5529e115d5e68632c37e1feb
Author: Anton Blanchard
Date: Thu May 14 14:45:40 2015 +1000
powerpc: Align TOC to 256 bytes
commit 5e95235ccd5442d4a4fe11ec4eb99ba1b7959368 upstream.
Recent toolchains force the TOC to be 256 byte aligned. We need
to enforce this alignment in our linker script, otherwise pointers
to our TOC variables (\_\_toc\_start, \_\_prom\_init\_toc\_start) could
be incorrect.
If they are bad, we die a few hundred instructions into boot.
Signed-off-by: Anton Blanchard
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit d9169e25281945d36e57cdcdd55b895f2996c049
Author: Daniel Axtens
Date: Tue May 12 13:23:59 2015 +1000
powerpc/mce: fix off by one errors in mce event handling
commit ffb2d78eca08a1451137583d4e435aecfd6af809 upstream.
Before 69111bac42f5 ("powerpc: Replace \_\_get\_cpu\_var uses"), in
save\_mce\_event, index got the value of mce\_nest\_count, and
mce\_nest\_count was incremented \*after\* index was set.
However, that patch changed the behaviour so that mce\_nest count was
incremented \*before\* setting index.
This causes an off-by-one error, as get\_mce\_event sets index as
mce\_nest\_count - 1 before reading mce\_event. Thus get\_mce\_event reads
bogus data, causing warnings like
"Machine Check Exception, Unknown event version 0 !"
and breaking MCEs handling.
Restore the old behaviour and unbreak MCE handling by subtracting one
from the newly incremented value.
The same broken change occured in machine\_check\_queue\_event (which set
a queue read by machine\_check\_process\_queued\_event). Fix that too,
unbreaking printing of MCE information.
Fixes: 69111bac42f5 ("powerpc: Replace \_\_get\_cpu\_var uses")
CC: Mahesh Salgaonkar
CC: Christoph Lameter
Signed-off-by: Daniel Axtens
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 9db6a88484e409459d053b88ba594d1d26ef5f1c
Author: Krzysztof Opasiak
Date: Fri Mar 20 15:48:56 2015 +0100
usb: gadget: configfs: Fix interfaces array NULL-termination
commit 903124fe1aa284f61745a9dd4fbfa0184e569fff upstream.
memset() to 0 interfaces array before reusing
usb\_configuration structure.
This commit fix bug:
ln -s functions/acm.1 configs/c.1
ln -s functions/acm.2 configs/c.1
ln -s functions/acm.3 configs/c.1
echo "UDC name" > UDC
echo "" > UDC
rm configs/c.1/acm.\*
rmdir functions/\*
mkdir functions/ecm.usb0
ln -s functions/ecm.usb0 configs/c.1
echo "UDC name" > UDC
[ 82.220969] Unable to handle kernel NULL pointer dereference at virtual address 00000000
[ 82.229009] pgd = c0004000
[ 82.231698] [00000000] \*pgd=00000000
[ 82.235260] Internal error: Oops: 17 [#1] PREEMPT SMP ARM
[ 82.240638] Modules linked in:
[ 82.243681] CPU: 0 PID: 0 Comm: swapper/0 Not tainted 4.0.0-rc2 #39
[ 82.249926] Hardware name: SAMSUNG EXYNOS (Flattened Device Tree)
[ 82.256003] task: c07cd2f0 ti: c07c8000 task.ti: c07c8000
[ 82.261393] PC is at composite\_setup+0xe3c/0x1674
[ 82.266073] LR is at composite\_setup+0xf20/0x1674
[ 82.270760] pc : [] lr : [] psr: 600001d3
[ 82.270760] sp : c07c9df0 ip : c0806448 fp : ed8c9c9c
[ 82.282216] r10: 00000001 r9 : 00000000 r8 : edaae918
[ 82.287425] r7 : ed551cc0 r6 : 00007fff r5 : 00000000 r4 : ed799634
[ 82.293934] r3 : 00000003 r2 : 00010002 r1 : edaae918 r0 : 0000002e
[ 82.300446] Flags: nZCv IRQs off FIQs off Mode SVC\_32 ISA ARM Segment kernel
[ 82.307910] Control: 10c5387d Table: 6bc1804a DAC: 00000015
[ 82.313638] Process swapper/0 (pid: 0, stack limit = 0xc07c8210)
[ 82.319627] Stack: (0xc07c9df0 to 0xc07ca000)
[ 82.323969] 9de0: 00000000 c06e65f4 00000000 c07c9f68
[ 82.332130] 9e00: 00000067 c07c59ac 000003f7 edaae918 ed8c9c98 ed799690 eca2f140 200001d3
[ 82.340289] 9e20: ee79a2d8 c07c9e88 c07c5304 ffff55db 00010002 edaae810 edaae860 eda96d50
[ 82.348448] 9e40: 00000009 ee264510 00000007 c07ca444 edaae860 c0340890 c0827a40 ffff55e0
[ 82.356607] 9e60: c0827a40 eda96e40 ee264510 edaae810 00000000 edaae860 00000007 c07ca444
[ 82.364766] 9e80: edaae860 c0354170 c03407dc c033db4c edaae810 00000000 00000000 00000010
[ 82.372925] 9ea0: 00000032 c0341670 00000000 00000000 00000001 eda96e00 00000000 00000000
[ 82.381084] 9ec0: 00000000 00000032 c0803a23 ee1aa840 00000001 c005d54c 249e2450 00000000
[ 82.389244] 9ee0: 200001d3 ee1aa840 ee1aa8a0 ed84f4c0 00000000 c07c9f68 00000067 c07c59ac
[ 82.397403] 9f00: 00000000 c005d688 ee1aa840 ee1aa8a0 c07db4b4 c006009c 00000032 00000000
[ 82.405562] 9f20: 00000001 c005ce20 c07c59ac c005cf34 f002000c c07ca780 c07c9f68 00000057
[ 82.413722] 9f40: f0020000 413fc090 00000001 c00086b4 c000f804 60000053 ffffffff c07c9f9c
[ 82.421880] 9f60: c0803a20 c0011fc0 00000000 00000000 c07c9fb8 c001bee0 c07ca4f0 c057004c
[ 82.430040] 9f80: c07ca4fc c0803a20 c0803a20 413fc090 00000001 00000000 01000000 c07c9fb0
[ 82.438199] 9fa0: c000f800 c000f804 60000053 ffffffff 00000000 c0050e70 c0803bc0 c0783bd8
[ 82.446358] 9fc0: ffffffff ffffffff c0783664 00000000 00000000 c07b13e8 00000000 c0803e54
[ 82.454517] 9fe0: c07ca480 c07b13e4 c07ce40c 4000406a 00000000 40008074 00000000 00000000
[ 82.462689] [] (composite\_setup) from [] (s3c\_hsotg\_complete\_setup+0xb4/0x418)
[ 82.471626] [] (s3c\_hsotg\_complete\_setup) from [] (usb\_gadget\_giveback\_request+0xc/0x10)
[ 82.481429] [] (usb\_gadget\_giveback\_request) from [] (s3c\_hsotg\_complete\_request+0xcc/0x12c)
[ 82.491583] [] (s3c\_hsotg\_complete\_request) from [] (s3c\_hsotg\_irq+0x4fc/0x558)
[ 82.500614] [] (s3c\_hsotg\_irq) from [] (handle\_irq\_event\_percpu+0x50/0x150)
[ 82.509291] [] (handle\_irq\_event\_percpu) from [] (handle\_irq\_event+0x3c/0x5c)
[ 82.518145] [] (handle\_irq\_event) from [] (handle\_fasteoi\_irq+0xd4/0x18c)
[ 82.526650] [] (handle\_fasteoi\_irq) from [] (generic\_handle\_irq+0x20/0x30)
[ 82.535242] [] (generic\_handle\_irq) from [] (\_\_handle\_domain\_irq+0x6c/0xdc)
[ 82.543923] [] (\_\_handle\_domain\_irq) from [] (gic\_handle\_irq+0x2c/0x6c)
[ 82.552256] [] (gic\_handle\_irq) from [] (\_\_irq\_svc+0x40/0x74)
[ 82.559716] Exception stack(0xc07c9f68 to 0xc07c9fb0)
[ 82.564753] 9f60: 00000000 00000000 c07c9fb8 c001bee0 c07ca4f0 c057004c
[ 82.572913] 9f80: c07ca4fc c0803a20 c0803a20 413fc090 00000001 00000000 01000000 c07c9fb0
[ 82.581069] 9fa0: c000f800 c000f804 60000053 ffffffff
[ 82.586113] [] (\_\_irq\_svc) from [] (arch\_cpu\_idle+0x30/0x3c)
[ 82.593491] [] (arch\_cpu\_idle) from [] (cpu\_startup\_entry+0x128/0x1a4)
[ 82.601740] [] (cpu\_startup\_entry) from [] (start\_kernel+0x350/0x3bc)
[ 82.609890] Code: 0a000002 e3530005 05975010 15975008 (e5953000)
[ 82.615965] ---[ end trace f57d5f599a5f1bfa ]---
Most of kernel code assume that interface array in
struct usb\_configuration is NULL terminated.
When gadget is composed with configfs configuration
structure may be reused for different functions set.
This bug happens because purge\_configs\_funcs() sets
only next\_interface\_id to 0. Interface array still
contains pointers to already freed interfaces. If in
second try we add less interfaces than earlier we
may access unallocated memory when trying to get
interface descriptors.
Signed-off-by: Krzysztof Opasiak
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit be3baab6f5e55045c6c76c404a7e707dcd647937
Author: Hans de Goede
Date: Thu Apr 30 11:09:44 2015 +0200
usb-storage: Add NO\_WP\_DETECT quirk for Lacie 059f:0651 devices
commit 172115090f5e739660b97694618a2ba86457063a upstream.
Without this flag some versions of these enclosures do not work.
Reported-and-tested-by: Christian Schaller
Signed-off-by: Hans de Goede
Signed-off-by: Greg Kroah-Hartman
commit b6b5f5e30acf5cee53aeab92b65ef3164844f2b3
Author: Mark Edwards
Date: Tue Apr 14 08:52:34 2015 -0400
USB: cp210x: add ID for KCF Technologies PRN device
commit c735ed74d83f8ecb45c4c4c95a16853c9c3c8157 upstream.
Added the USB serial console device ID for KCF Technologies PRN device
which has a USB port for its serial console.
Signed-off-by: Mark Edwards
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit b60af7134e9272846d94e92545a3a49d6315a786
Author: Jason A. Donenfeld
Date: Wed Apr 22 14:35:08 2015 +0200
USB: pl2303: Remove support for Samsung I330
commit 48ef23a4f686b1e4519d4193c20d26834ff810ff upstream.
This phone is already supported by the visor driver.
Signed-off-by: Jason A. Donenfeld
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit f622eea4d9da666a6d0a69f6618bb803cc793e3f
Author: Jason A. Donenfeld
Date: Wed Apr 22 14:35:09 2015 +0200
USB: visor: Match I330 phone more precisely
commit 82ee3aeb9295c5fc37fd2ddf20f13ac2b40ec97d upstream.
Samsung has just released a portable USB3 SSD, coming in a very small
and nice form factor. It's USB ID is 04e8:8001, which unfortunately is
already used by the Palm Visor driver for the Samsung I330 phone cradle.
Having pl2303 or visor pick up this device ID results in conflicts with
the usb-storage driver, which handles the newly released portable USB3
SSD.
To work around this conflict, I've dug up a mailing list post [1] from a
long time ago, in which a user posts the full USB descriptor
information. The most specific value in this appears to be the interface
class, which has value 255 (0xff). Since usb-storage requires an
interface class of 0x8, I believe it's correct to disambiguate the two
devices by matching on 0xff inside visor.
[1] http://permalink.gmane.org/gmane.linux.usb.user/4264
Signed-off-by: Jason A. Donenfeld
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 48d9d05711e560d7bbfc7e69e58b5d4603f3dd59
Author: Joe Lawrence
Date: Thu Apr 30 17:16:04 2015 +0300
xhci: gracefully handle xhci\_irq dead device
commit 948fa13504f80b9765d2b753691ab94c83a10341 upstream.
If the xHCI host controller has died (ie, device removed) or suffered
other serious fatal error (STS\_FATAL), then xhci\_irq should handle this
condition with IRQ\_HANDLED instead of -ESHUTDOWN.
Signed-off-by: Joe Lawrence
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 14544a262486d53b7be6b4160bdc5a4c7fb99ffc
Author: Mathias Nyman
Date: Thu Apr 30 17:16:03 2015 +0300
xhci: Solve full event ring by increasing TRBS\_PER\_SEGMENT to 256
commit 18cc2f4cbbaf825a4fedcf2d60fd388d291e0a38 upstream.
Our event ring consists of only one segment, and we risk filling
the event ring in case we get isoc transfers with short intervals
such as webcams that fill a TD every microframe (125us)
With 64 TRB segment size one usb camera could fill the event ring in 8ms.
A setup with several cameras and other devices can fill up the
event ring as it is shared between all devices.
This has occurred when uvcvideo queues 5 \* 32TD URBs which then
get cancelled when the video mode changes. The cancelled URBs are returned
in the xhci interrupt context and blocks the interrupt handler from
handling the new events.
A full event ring will block xhci from scheduling traffic and affect all
devices conneted to the xhci, will see errors such as Missed Service
Intervals for isoc devices, and and Split transaction errors for LS/FS
interrupt devices.
Increasing the TRB\_PER\_SEGMENT will also increase the default endpoint ring
size, which is welcome as for most isoc transfer we had to dynamically
expand the endpoint ring anyway to be able to queue the 5 \* 32TDs uvcvideo
queues.
The default size used to be 64 TRBs per segment
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit aa54f3aff5e399b1a3962974a1bee704cdb01792
Author: Mathias Nyman
Date: Thu Apr 30 17:16:02 2015 +0300
xhci: fix isoc endpoint dequeue from advancing too far on transaction error
commit d104d0152a97fade389f47635b73a9ccc7295d0b upstream.
Isoc TDs usually consist of one TRB, sometimes two. When all goes well we
receive only one success event for a TD, and move the dequeue pointer to
the next TD.
This fails if the TD consists of two TRBs and we get a transfer error
on the first TRB, we will then see two events for that TD.
Fix this by making sure the event we get is for the last TRB in that TD
before moving the dequeue pointer to the next TD. This will resolve some
of the uvc and dvb issues with the
"ERROR Transfer event TRB DMA ptr not part of current TD" error message
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
commit 74e3331db5b7500163fb9325700c57ac7d5965c2
Author: Andy Grover
Date: Fri May 22 14:07:44 2015 -0700
target/pscsi: Don't leak scsi\_host if hba is VIRTUAL\_HOST
commit 5a7125c64def3b21f8147eca8b54949a60963942 upstream.
See https://bugzilla.redhat.com/show\_bug.cgi?id=1025672
We need to put() the reference to the scsi host that we got in
pscsi\_configure\_device(). In VIRTUAL\_HOST mode it is associated with
the dev\_virt, not the hba\_virt.
Signed-off-by: Andy Grover
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit b7b8280eb2b937c959ef8df528ae3f2656a140f0
Author: Stephane Eranian
Date: Thu Apr 23 09:07:09 2015 +0200
perf/x86/rapl: Enable Broadwell-U RAPL support
commit 44b11fee51711ca85aa2b121a49bf029d18a3722 upstream.
This patch enables RAPL counters (energy consumption counters)
support for Intel Broadwell-U processors (Model 61):
To use:
$ perf stat -a -I 1000 -e power/energy-cores/,power/energy-pkg/,power/energy-ram/ sleep 10
Signed-off-by: Stephane Eranian
Cc: Andy Lutomirski
Cc: Borislav Petkov
Cc: Brian Gerst
Cc: Denys Vlasenko
Cc: H. Peter Anvin
Cc: Linus Torvalds
Cc: Thomas Gleixner
Cc: jacob.jun.pan@linux.intel.com
Cc: kan.liang@intel.com
Cc: peterz@infradead.org
Cc: sonnyrao@chromium.org
Link: http://lkml.kernel.org/r/20150423070709.GA4970@thinkpad
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit cb6a75dab579ca0b9ee457047d46aa78cb22975c
Author: Malcolm Priestley
Date: Tue Apr 21 22:33:02 2015 +0100
staging: vt6655: lock MACvWriteBSSIDAddress.
commit 664a5c1d1e33cd89cb7883e8c74638cc482b5da7 upstream.
This function selects page 1 and cause intermittent problems on
interrupt handler.
lock call with spin\_lock\_irqsave.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 644bea7497c0f7072ec71a90f051ab311f04ca17
Author: Malcolm Priestley
Date: Tue Apr 21 22:33:00 2015 +0100
staging: vt6655: vnt\_tx\_packet Correct TX order of OWNED\_BY\_NIC
commit d65d2b25d2761153390df8026cca1a528d9b6c5a upstream.
The state of m\_td0TD0.f1Owner should change after the buff\_addr
has been filled otherwise the device grabs the buffer too early.
m\_td0TD0.f1Owner is protected by memory barriers on both sides
of change.
iTDUsed is best incremented after MACvTransmit.
It appears that f1Owner actually polls to do the memory transfer.
A back port patch will be needed for v3.19
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 99681c40cf1568eb0b8e708ade687a305641293d
Author: Malcolm Priestley
Date: Sat Apr 11 20:29:41 2015 +0100
staging: vt6655: Fix 80211 control and management status reporting.
commit ad3fee9b17b90b8f1ac94b615111b2f14dd90adb upstream.
Currently only TD\_FLAGS\_NETIF\_SKB are reported back to mac80211.
Move vnt\_int\_report\_rate to report all frame types.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 3772bc16304999557d6075aa5c5d55f14cbc7594
Author: Malcolm Priestley
Date: Thu Apr 9 20:53:44 2015 +0100
staging: vt6655: implement IEEE80211\_TX\_STAT\_NOACK\_TRANSMITTED
commit 6e44dc4be009eef60a1744e4a4b830131f6b9a8e upstream.
Make use of this macro for non ack frames.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 87a9e45bf8970dbc5732f0e931ad814397277524
Author: Malcolm Priestley
Date: Thu Apr 9 20:53:43 2015 +0100
staging: vt6655: device\_free\_tx\_buf use only ieee80211\_tx\_status\_irqsafe
commit 3fa0917beb29d886550fcf61a6378563d1ce9684 upstream.
TD\_FLAGS\_NETIF\_SKB is only for data.
Fixes issue of ack frames not being reported.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 2f439dc39a924b4972c2638532c36e63b86f048a
Author: Malcolm Priestley
Date: Sat Apr 4 20:49:10 2015 +0100
staging: vt6656: use ieee80211\_tx\_info to select packet type.
commit b23f14302e86628625ac3982a6d23e35888755f2 upstream.
Information for packet type is in ieee80211\_tx\_info
band IEEE80211\_BAND\_5GHZ for PK\_TYPE\_11A.
IEEE80211\_TX\_RC\_USE\_CTS\_PROTECT via tx\_rate flags selects PK\_TYPE\_11GB
This ensures that the packet is always the right type.
Signed-off-by: Malcolm Priestley
Signed-off-by: Greg Kroah-Hartman
commit 14bbf790690615b56f14535269c49ea76ae6c837
Author: Sławomir Demeszko
Date: Tue May 5 17:49:54 2015 +0200
staging: gdm724x: Correction of variable usage after applying ALIGN()
commit 892c89d5d7ffd1bb794fe54d86c0eef18d215fab upstream.
Fix regression introduced by commit <29ef8a53542a>. After it writing
AT commands to /dev/GCT-ATM0 is unsuccessful (no echo, no response)
and dmesg show "gdmtty: invalid payload : 1 16 f011".
Before that commit value of dummy\_cnt was only a padding size. After using
ALIGN() this value is increased by its first argument. So the following
usage of this variable needs correction.
Signed-off-by: Sławomir Demeszko
Signed-off-by: Greg Kroah-Hartman
commit 61d25be9407da5fa1fb7b5cf30fac1c1a9a37ed8
Author: Tatyana Nikolova
Date: Fri May 8 16:36:33 2015 -0500
RDMA/core: Fix for parsing netlink string attribute
commit ec04847c0c5b471bab2dacceadfdb803a9d1a2ea upstream.
The string iwpm\_ulib\_name is recorded in a nlmsg as a netlink attribute.
Without this fix parsing of the nlmsg by the userspace port mapper service fails
because of unknown attribute length, causing the port mapper service not to
register the client, which has sent the nlmsg.
Signed-off-by: Tatyana Nikolova
Reviewed-By: Jason Gunthorpe
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit f0a8d2629042f2e0ab93802db22f5fe560135274
Author: Zidan Wang
Date: Tue May 12 14:58:50 2015 +0800
ASoC: wm8994: correct BCLK DIV 348 to 384
commit 17fc2e0a3db11889e942c5ab15a1fcb876638f25 upstream.
According to the RM of wm8958, BCLK DIV 348 doesn't exist, correct it
to 384.
Signed-off-by: Zidan Wang
Acked-by: Charles Keepax
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 2b1dc3d8577bba230e2b989ec8d894073ce33c5e
Author: Zidan Wang
Date: Tue May 12 14:58:36 2015 +0800
ASoC: wm8960: fix "RINPUT3" audio route error
commit 85e36a1f4a735d991ba5106781ea48e89a0b8901 upstream.
It should be "RINPUT3" instead of "LINPUT3" route to "Right Input
Mixer".
Signed-off-by: Zidan Wang
Acked-by: Charles Keepax
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit d63c2c197e8bea4e524fd0f226f7770f33ac3c11
Author: Koro Chen
Date: Mon May 11 10:36:53 2015 +0800
ASoC: dapm: Modify widget stream name according to prefix
commit fdb6eb0a12871d5bfaf266c5a0d5259a5437a72f upstream.
When there is prefix specified, currently we will add this prefix in
widget->name, but not in widget->sname.
it causes failure at snd\_soc\_dapm\_link\_dai\_widgets:
if (!w->sname || !strstr(w->sname, dai\_w->name))
because dai\_w->name has prefix added, but w->sname does not.
We should also add prefix for stream name
Signed-off-by: Koro Chen
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 45d62f683e11c2492ab5866f4142bacbaaa4e648
Author: Vasily Khoruzhick
Date: Sun May 3 21:11:47 2015 +0300
ASoC: uda1380: Avoid accessing i2c bus when codec is disabled
commit 810e4425c224af6be67dff68c8832af1b5a11f89 upstream.
set\_dai\_fmt\_both() callback is called from snd\_soc\_runtime\_set\_dai\_fmt()
which is called from snd\_soc\_register\_card(), but at this time codec
is not powered on yet. Replace direct i2c write with regcache write.
Fixes: 5f0acedddf533c (ASoC: rx1950\_uda1380: Use static DAI format setup)
Fixes: 5cc10b9b77c234 (ASoC: h1940\_uda1380: Use static DAI format setup)
Signed-off-by: Vasily Khoruzhick
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 08fc934110a757e518c0c9904f776fca998cc8ba
Author: Axel Lin
Date: Mon Apr 27 14:51:35 2015 +0800
ASoC: mc13783: Fix wrong mask value used in mc13xxx\_reg\_rmw() calls
commit 545774bd6e1427d98dde77244329d2311c5eca6f upstream.
mc13xxx\_reg\_rmw() won't change any bit if passing 0 to the mask field.
Pass AUDIO\_SSI\_SEL instead of 0 for the mask field to set AUDIO\_SSI\_SEL
bit.
Signed-off-by: Axel Lin
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 19a24c7f97d02d3d9e310cd97bd4a8827bd88793
Author: Takashi Iwai
Date: Wed May 27 16:17:19 2015 +0200
ALSA: hda - Fix noise on AMD radeon 290x controller
commit 0fa372b6c95013af1334b3d5c9b5f03a70ecedab upstream.
A new AMD controller [1002:aac8] seems to need the quirk for other AMD
NS HDMI stuff, otherwise it gives noisy sounds.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=99021
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 57fdbbf7ad9c414b9066c6bbcc467d4f62f17607
Author: Takashi Iwai
Date: Sun May 24 08:27:52 2015 +0200
Revert "ALSA: hda - Add mute-LED mode control to Thinkpad"
commit 3530febb5c7636f6b26d15637f68296804d26491 upstream.
This reverts commit 7290006d8c0900c56d8c58428134f02c35109d17.
Through the regression report, it was revealed that the
tpacpi\_led\_set() call to thinkpad\_acpi helper doesn't only toggle the
mute LED but actually mutes the sound. This is contradiction to the
expectation, and rather confuses user.
According to Henrique, it's not trivial to judge which TP model
behaves "LED-only" and which model does whatever more intrusive, as
Lenovo's implementations vary model by model. So, from the safety
reason, we should revert the patch for now.
Reported-by: Martin Steigerwald
Cc: Pali Rohár
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e4215bc36466408d8686e2aa6fd695b3873af66a
Author: Vittorio G (VittGam)
Date: Fri May 22 21:15:19 2015 +0200
ALSA: usb-audio: Add quirk for MS LifeCam HD-3000
commit ae425bb2a05bebe786a25cc8ae64e9d16c4d9b83 upstream.
Microsoft LifeCam HD-3000 (045e:0779) needs a similar quirk for
suppressing the unsupported sample rate inquiry.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=98481
Signed-off-by: Vittorio Gambaletta
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 1fdee11aba0c6265c9f80d7e0f55a1e3dda6c00e
Author: Ansgar Hegerfeld
Date: Thu May 14 12:31:32 2015 +0200
ALSA: hda/realtek - ALC292 dock fix for Thinkpad L450
commit 09ea997677cd44ebe7f42573119aaf46b775c683 upstream.
The Lenovo ThinkPad L450 requires the ALC292\_FIXUP\_TPT440\_DOCK fix in
order to get sound output on the docking stations audio port.
This patch was tested using a ThinkPad L450 (20DSS00B00) using kernel
4.0.3 and a ThinkPad Pro Dock.
Signed-off-by: Ansgar Hegerfeld
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 2329bc0706787e9db08ac3b74be977639afd7459
Author: David Henningsson
Date: Mon May 11 14:04:14 2015 +0200
ALSA: hda - Add headset mic quirk for Dell Inspiron 5548
commit 9b5a4e395c2f39fae89f75e4a749be5dba342d22 upstream.
This enables the headset microphone on Dell Inspiron 5548,
or at least some variants of it.
BugLink: https://bugs.launchpad.net/bugs/1452175
Signed-off-by: David Henningsson
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit ab37fb4a688267c1ba0456f3b005d6efbd0b2d8a
Author: Takashi Iwai
Date: Fri May 1 09:20:34 2015 +0200
ALSA: hda - Add headphone quirk for Lifebook E752
commit 88776f366ede7d9cdce60bd2c9753dd6d6fa8b77 upstream.
Fujitsu Lifebook E752 laptop needs a similar quirk done for Lifebook
T731. Otherwise the headphone is always muted.
Reported-and-tested-by: Christian Weber
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit ed78078d69e180b3b5bc2cfc4d2a8d0d15ec2f88
Author: David Henningsson
Date: Wed May 13 13:28:54 2015 +0200
ALSA: hda - Add Conexant codecs CX20721, CX20722, CX20723 and CX20724
commit 6ffc0898b29a2811a6c0569c5dd9b581980110df upstream.
This patch adds support for Conexant HD Audio codecs
CX20721, CX20722, CX20723 and CX20724.
BugLink: https://bugs.launchpad.net/bugs/1454656
Signed-off-by: David Henningsson
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit f01082833d538267af1afbb9f1e662dc9a9a266d
Author: Takashi Iwai
Date: Tue May 19 10:46:49 2015 +0200
ALSA: usb-audio: Add quirk for MS LifeCam Studio
commit fa94b0d72511add5822dc4124f2a3eae66b8863f upstream.
Microsoft LifeCam Studio (045e:0772) needs a similar quirk for
suppressing the wrong sample rate inquiry.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=98481
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit acc27112293c72a1bc249e2913f52a2c0e078fd0
Author: Steven Rostedt
Date: Sat May 9 03:06:23 2015 +0930
module: Call module notifier on failure after complete\_formation()
commit 37815bf866ab6722a47550f8d25ad3f1a16a680c upstream.
The module notifier call chain for MODULE\_STATE\_COMING was moved up before
the parsing of args, into the complete\_formation() call. But if the module failed
to load after that, the notifier call chain for MODULE\_STATE\_GOING was
never called and that prevented the users of those call chains from
cleaning up anything that was allocated.
Link: http://lkml.kernel.org/r/554C52B9.9060700@gmail.com
Reported-by: Pontus Fuchs
Fixes: 4982223e51e8 "module: set nx before marking module MODULE\_STATE\_COMING"
Signed-off-by: Steven Rostedt
Signed-off-by: Rusty Russell
Signed-off-by: Greg Kroah-Hartman
commit 06b31fdcf73f8dd0e7e30ce59800948b94e088a9
Author: Al Viro
Date: Thu May 28 23:09:19 2015 -0400
d\_walk() might skip too much
commit 2159184ea01e4ae7d15f2017e296d4bc82d5aeb0 upstream.
when we find that a child has died while we'd been trying to ascend,
we should go into the first live sibling itself, rather than its sibling.
Off-by-one in question had been introduced in "deal with deadlock in
d\_walk()" and the fix needs to be backported to all branches this one
has been backported to.
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit a70f55580df0ac14cc54e20da811526bd8989adb
Author: Jan Kara
Date: Tue Jun 2 17:10:28 2015 +0200
lib: Fix strnlen\_user() to not touch memory after specified maximum
commit f18c34e483ff6b1d9866472221e4015b3a4698e4 upstream.
If the specified maximum length of the string is a multiple of unsigned
long, we would load one long behind the specified maximum. If that
happens to be in a next page, we can hit a page fault although we were
not expected to.
Fix the off-by-one bug in the test whether we are at the end of the
specified range.
Signed-off-by: Jan Kara
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 12ba3913eadfa5baa90390f07605a0a543c450e4
Author: Arend van Spriel
Date: Tue May 26 13:19:46 2015 +0200
brcmfmac: avoid null pointer access when brcmf\_msgbuf\_get\_pktid() fails
commit 7d072b404c5d8f1e0b62b6bc488dfeaa61bd2d8d upstream.
The function brcmf\_msgbuf\_get\_pktid() may return a NULL pointer so
the callers should check the return pointer before accessing it to
avoid the crash below (see [1]):
brcmfmac: brcmf\_msgbuf\_get\_pktid: Invalid packet id 273 (not in use)
BUG: unable to handle kernel NULL pointer dereference at 0000000000000080
IP: [] skb\_pull+0x5/0x50
PGD 0
Oops: 0000 [#1] PREEMPT SMP
Modules linked in: pci\_stub vboxpci(O) vboxnetflt(O) vboxnetadp(O) vboxdrv(O)
snd\_hda\_codec\_hdmi bnep mousedev hid\_generic ushwmon msr ext4 crc16 mbcache
jbd2 sd\_mod uas usb\_storage ahci libahci libata scsi\_mod xhci\_pci xhci\_hcd
usbcore usb\_common
CPU: 0 PID: 1661 Comm: irq/61-brcmf\_pc Tainted: G O 4.0.1-MacbookPro-ARCH #1
Hardware name: Apple Inc. MacBookPro12,1/Mac-E43C1C25D4880AD6,
BIOS MBP121.88Z.0167.B02.1503241251 03/24/2015
task: ffff880264203cc0 ti: ffff88025ffe4000 task.ti: ffff88025ffe4000
RIP: 0010:[] [] skb\_pull+0x5/0x50
RSP: 0018:ffff88025ffe7d40 EFLAGS: 00010202
RAX: 0000000000000000 RBX: ffff88008a33c000 RCX: 0000000000000044
RDX: 0000000000000000 RSI: 000000000000004a RDI: 0000000000000000
RBP: ffff88025ffe7da8 R08: 0000000000000096 R09: 000000000000004a
R10: 0000000000000000 R11: 000000000000048e R12: ffff88025ff14f00
R13: 0000000000000000 R14: ffff880263b48200 R15: ffff88008a33c000
FS: 0000000000000000(0000) GS:ffff88026ec00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000000080 CR3: 000000000180b000 CR4: 00000000003407f0
Stack:
ffffffffa06aed74 ffff88025ffe7dc8 ffff880263b48270 ffff880263b48278
05ea88020000004a 0002ffff81014635 000000001720b2f6 ffff88026ec116c0
ffff880263b48200 0000000000010000 ffff880263b4ae00 ffff880264203cc0
Call Trace:
[] ? brcmf\_msgbuf\_process\_rx+0x404/0x480 [brcmfmac]
[] ? irq\_finalize\_oneshot.part.30+0xf0/0xf0
[] brcmf\_proto\_msgbuf\_rx\_trigger+0x35/0xf0 [brcmfmac]
[] brcmf\_pcie\_isr\_thread\_v2+0x8a/0x130 [brcmfmac]
[] irq\_thread\_fn+0x20/0x50
[] irq\_thread+0x13f/0x170
[] ? wake\_threads\_waitq+0x30/0x30
[] ? irq\_thread\_dtor+0xb0/0xb0
[] kthread+0xd8/0xf0
[] ? kthread\_create\_on\_node+0x1c0/0x1c0
[] ret\_from\_fork+0x58/0x90
[] ? kthread\_create\_on\_node+0x1c0/0x1c0
Code: 01 83 e2 f7 88 50 01 48 83 c4 08 5b 5d f3 c3 0f 1f 80 00 00 00 00 83 e2
f7 88 50 01 c3 66 0f 1f 84 00 00 00 00 00 0f 1f
RIP [] skb\_pull+0x5/0x50
RSP
CR2: 0000000000000080
---[ end trace b074c0f90e7c997d ]---
[1] http://mid.gmane.org/20150430193259.GA5630@googlemail.com
Reported-by: Michael Hornung
Reviewed-by: Hante Meuleman
Reviewed-by: Pieter-Paul Giesberts
Signed-off-by: Arend van Spriel
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit a9f0c5a2a6681d7ce0e37c874429ea4c6daa8d00
Author: Dong Aisheng
Date: Wed Apr 15 22:26:36 2015 +0800
clk: add missing lock when call clk\_core\_enable in clk\_set\_parent
commit d2a5d46b167a9a8231264daf80165b739aecf1d7 upstream.
Before commit 035a61c314eb ("clk: Make clk API return per-user
struct clk instances") we acquired the enable\_lock in
\_\_clk\_set\_parent\_{before,after}() by means of calling
clk\_enable(). After commit 035a61c314eb we use clk\_core\_enable()
in place of the clk\_enable(), and clk\_core\_enable() doesn't
acquire the enable\_lock. This opens up a race condition between
clk\_set\_parent() and clk\_enable(). Fix it.
Fixes: 035a61c314eb ("clk: Make clk API return per-user struct clk instances")
Cc: Mike Turquette
Cc: Stephen Boyd
Signed-off-by: Dong Aisheng
Signed-off-by: Stephen Boyd
Signed-off-by: Greg Kroah-Hartman
commit bc03b0cbd57c8afffd10e0211861c044a009858a
Author: Javier Martinez Canillas
Date: Wed Apr 8 07:34:12 2015 +0200
clk: exynos5420: Restore GATE\_BUS\_TOP on suspend
commit 97372e5a99449b4fffa824a382ad6358066a9918 upstream.
Commit ae43b3289186 ("ARM: 8202/1: dmaengine: pl330: Add runtime Power
Management support v12") added pm support for the pl330 dma driver but
it makes the clock for the Exynos5420 MDMA0 DMA controller to be gated
during suspend and this in turn makes its parent clock aclk266\_g2d to
be gated. But the clock needs to be ungated prior suspend to allow the
system to be suspend and resumed correctly.
Add GATE\_BUS\_TOP register to the list of registers to be restored when
the system enters into a suspend state so aclk266\_g2d will be ungated.
Thanks to Abhilash Kesavan for figuring out that this was the issue.
Fixes: ae43b32 ("ARM: 8202/1: dmaengine: pl330: Add runtime Power Management support v12")
Signed-off-by: Javier Martinez Canillas
Tested-by: Kevin Hilman
Tested-by: Abhilash Kesavan
Acked-by: Tomasz Figa
Signed-off-by: Sylwester Nawrocki
Signed-off-by: Greg Kroah-Hartman
commit cf5bee3415189cf7dc35cd3f82234a97a36fb214
Author: Guenter Roeck
Date: Thu May 28 09:12:23 2015 -0700
hwmon: (nct6683) Add missing sysfs attribute initialization
commit c7bd6dc320b85445b6b36a0aff41f929210027c7 upstream.
The following error message is seen when loading the nct6683 driver
with DEBUG\_LOCK\_ALLOC enabled.
BUG: key ffff88040b2f0030 not in .data!
------------[ cut here ]------------
WARNING: CPU: 0 PID: 186 at kernel/locking/lockdep.c:2988
lockdep\_init\_map+0x469/0x630()
DEBUG\_LOCKS\_WARN\_ON(1)
Caused by a missing call to sysfs\_attr\_init() when initializing
sysfs attributes.
Reported-by: Alexey Orishko
Reviewed-by: Jean Delvare
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 63f1b5cb70dc305d457e0a47e7d3c24aeb70bfff
Author: Guenter Roeck
Date: Thu May 28 09:08:09 2015 -0700
hwmon: (nct6775) Add missing sysfs attribute initialization
commit 1b63bf617206ff35b93c57c67bbe067ac735a85a upstream.
The following error message is seen when loading the nct6775 driver
with DEBUG\_LOCK\_ALLOC enabled.
BUG: key ffff88040b2f0030 not in .data!
------------[ cut here ]------------
WARNING: CPU: 0 PID: 186 at kernel/locking/lockdep.c:2988
lockdep\_init\_map+0x469/0x630()
DEBUG\_LOCKS\_WARN\_ON(1)
Caused by a missing call to sysfs\_attr\_init() when initializing
sysfs attributes.
Reported-by: Alexey Orishko
Reviewed-by: Jean Delvare
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 85fad7f5cdc3c027a87c47ce0384b30f515bf3b0
Author: Guenter Roeck
Date: Wed May 27 16:11:48 2015 -0700
hwmon: (tmp401) Do not auto-detect chip on I2C address 0x37
commit 9aecac04d8d89e730ae362a748113b19c06a9d39 upstream.
I2C address 0x37 may be used by EEPROMs, which can result in false
positives. Do not attempt to detect a chip at this address.
Reviewed-by: Jean Delvare
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit e8deb37e331584ba923eef712183b0ed75a6683f
Author: Thomas Betker
Date: Wed Apr 15 21:11:50 2015 +0200
iio: adc: xilinx: Fix VREFN sign
commit 97ffae1d30c3f6ceee67d5b0d3e540c08c13c744 upstream.
The VREFN channel is bipolar, not unipolar. Small negative values do
occur (e.g., -1mV), and unsigned conversion maps them incorrectly to
large positive values (about +1V), so fix this.
Signed-off-by: Thomas Betker
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 0f8fc8090cce910c25c521b7cfa307c97f644e86
Author: Thomas Betker
Date: Wed Apr 15 21:11:49 2015 +0200
iio: adc: xilinx: Fix VREFP scale
commit 00db4e52f4541965f7fda225eb458a75f892017b upstream.
The scaling factor for VREFP is 3.0/4096, not 1.0/4096; fix this to get
correct readings.
Signed-off-by: Thomas Betker
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit ef2f186d49c661d1b721c22518b492ecabfc3ac1
Author: Thomas Betker
Date: Wed Apr 15 21:11:48 2015 +0200
iio: adc: xilinx: Fix "vccaux" channel .address
commit d6c96c42283601e311a7a1a3d7e51cde9d7fdb6e upstream.
For the "vccaux" channel, read the VCCAUX register, not VCCINT.
Signed-off-by: Thomas Betker
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit c00ce2f6e473e5f9efce0493b37f45ba3afb3b7e
Author: Thomas Betker
Date: Wed Apr 15 21:11:47 2015 +0200
iio: adc: xilinx: Fix register addresses
commit 3960d2c0c4aafe98da47a4a2eb64dfa8e88d8df5 upstream.
Define the register addresses for MIN\_VCCPINT, MIN\_VCCPAUX, MIN\_VCCO\_DDR
correctly.
Signed-off-by: Thomas Betker
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit bfd7a0923d8a51373911328743699fe4623eeac0
Author: Naidu Tellapati
Date: Thu May 7 18:22:19 2015 -0300
iio: adc: cc10001: Fix regulator\_get\_voltage() return value check
commit 65a761bf8d55fdcf8ecc4642382a4e76c086e44c upstream.
regulator\_get\_voltage() returns a non-negative value in case of success,
and a negative error in case of error. Let's fix this.
Fixes: 1664f6a5b0c8 ("iio: adc: Cosmic Circuits 10001 ADC driver")
Signed-off-by: Naidu Tellapati
Signed-off-by: Ezequiel Garcia
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit f82128dac1fa79c4f38d32f08adc80e237e7e5c6
Author: Naidu Tellapati
Date: Thu May 7 18:22:20 2015 -0300
iio: adc: cc10001: Add delay before setting START bit
commit f29b212edb9e253cafcb4a2ab7842a890989f1a5 upstream.
According to hardware team there should be some delay after
setting channel number, start mode and before setting START.
Add a one microsecond delay for this purpose.
Fixes: 1664f6a5b0c8 ("iio: adc: Cosmic Circuits 10001 ADC driver")
Signed-off-by: Naidu Tellapati
Signed-off-by: Ezequiel Garcia
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit a604c614da331f4b9f5c4d76e8adceec1d600a01
Author: Naidu Tellapati
Date: Thu May 7 18:22:18 2015 -0300
iio: adc: cc10001: Fix incorrect use of power-up/power-down register
commit 713276ea88a295a79aa6633ba639ed47692a8de4 upstream.
At present we are incorrectly setting the register to 0x1 to power up
the ADC. Since it is an active high power down register, we need to set
the register to 0x0 to actually power up. Conversely, writing 0x1 to the
register powers it down.
This commit adds a couple of helpers to make the code clearer and then
use them to do the power-up/power-down properly.
Fixes: 1664f6a5b0c8 ("iio: adc: Cosmic Circuits 10001 ADC driver")
Signed-off-by: Naidu Tellapati
Signed-off-by: Ezequiel Garcia
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 5ac7256bb03296da0655394f4721bc313b715467
Author: Naidu Tellapati
Date: Thu May 7 18:22:17 2015 -0300
iio: adc: cc10001: Fix the channel number mapping
commit 13415a998adb1802b5bd6bd5a336331589e866a1 upstream.
When some of the ADC channels are reserved for remote CPUs,
the scan index and the corresponding channel number doesn't
match. This leads to convesion on the incorrect channel during
triggered capture.
Fix this by using a scan index to channel mapping encoded
in the iio\_chan\_spec for this purpose while starting conversion
on a particular ADC channel in trigger handler.
Also, the channel\_map is not really used anywhere but in probe(), so
no need to keep track of it. Remove it from device structure.
While here, add 1 to number of channels to register timestamp channel
with the IIO core.
Fixes: 1664f6a5b0c8 ("iio: adc: Cosmic Circuits 10001 ADC driver")
Signed-off-by: Naidu Tellapati
Signed-off-by: Ezequiel Garcia
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit e2e88802cbfddfd4bbca095782fba56d07b437d0
Author: Ivan T. Ivanov
Date: Fri Apr 17 17:51:08 2015 +0300
iio: adc: spmi-vadc: Fix overflow in output value normalization
commit 937125aca00e0478c4024afe58bc620a7bbe2a93 upstream.
With 'dx' equal to 0.625V and 15 bit ADC, calculations overflow
when difference against GND is ~20% of the ADC range. Fix this.
Signed-off-by: Ivan T. Ivanov
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit e8dcff4f3a730f497b6c62dc98f752966fd5523f
Author: Srinivas Pandruvada
Date: Tue Apr 14 14:54:18 2015 -0700
iio: pressure: hid-sensor-press: Fix modifier
commit 964e2255f1d73fc0136bc206a78a1f86bdad72a7 upstream.
Fix "null" in the raw attribute and scan elements.
Signed-off-by: Srinivas Pandruvada
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit f7382df0c8a9a0f9dbeaa03a33decfdb79b8ee57
Author: Srinivas Pandruvada
Date: Tue Apr 14 14:53:22 2015 -0700
iio: light: hid-sensor-prox: Fix modifier
commit c2aab3d58b96002555a3e70004f593b043830248 upstream.
Currently in\_proximity\_(null)\_raw is getting presented as raw sysfs
attribute. Same with the scan\_elements.
The modifier doesn't apply to this channel.
Signed-off-by: Srinivas Pandruvada
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit d513454bc1fb344f8817c4bd4da06b7e893237da
Author: Alban Bedel
Date: Mon Apr 20 13:57:18 2015 +0200
iio:st\_sensors: Fix oops when probing SPI devices
commit 8e71c04f863a1754f21b27fb8ecb773d680a0a80 upstream.
In SPI mode the transfer buffer is locked with a mutex. However this
mutex is only initilized after the probe, but some transfer needs to
be done in the probe.
To fix this bug we move the mutex initialization at the beginning of
the device probe.
Signed-off-by: Alban Bedel
Acked-by: Denis Ciocca
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 3e630b9b8fef3ad7a0267cdd1dd48505ce09f730
Author: Jacob Pan
Date: Mon Apr 6 11:38:20 2015 -0700
iio/axp288\_adc: add missing channel info mask
commit d0716b0ea4ce11a13477163c14b26e180922ba51 upstream.
Commit 65de7654d39c70c2b ("iio: iio: Fix iio\_channel\_read return if
channel havn't info") added a check for valid info masks.
This patch adds missing channel info masks for all ADC channels.
Otherwise, iio\_read\_channel\_raw() would return -EINVAL when called
by consumer drivers.
Note that the change of \_processed to \_raw actually fixes an ABI abuse
in the original driver where it was used to avoid some special handling
rather than because it was correct.
Signed-off-by: Jacob Pan
Signed-off-by: Jonathan Cameron
Signed-off-by: Greg Kroah-Hartman
commit 3c40260cb054ec2ccf67058e7e768fa62964d926
Author: Chris Lesiak
Date: Tue May 26 15:40:44 2015 -0500
hwmon: (ntc\_thermistor) Ensure iio channel is of type IIO\_VOLTAGE
commit adba657533bdd255f7b78bc8a324091f46b294cd upstream.
When configured via device tree, the associated iio device needs to be
measuring voltage for the conversion to resistance to be correct.
Return -EINVAL if that is not the case.
Signed-off-by: Chris Lesiak
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit a4b513b2a434a02381f2c981a3aba6ecb000118e
Author: David Vrabel
Date: Tue May 19 18:40:49 2015 +0100
xen/events: don't bind non-percpu VIRQs with percpu chip
commit 77bb3dfdc0d554befad58fdefbc41be5bc3ed38a upstream.
A non-percpu VIRQ (e.g., VIRQ\_CONSOLE) may be freed on a different
VCPU than it is bound to. This can result in a race between
handle\_percpu\_irq() and removing the action in \_\_free\_irq() because
handle\_percpu\_irq() does not take desc->lock. The interrupt handler
sees a NULL action and oopses.
Only use the percpu chip/handler for per-CPU VIRQs (like VIRQ\_TIMER).
# cat /proc/interrupts | grep virq
40: 87246 0 xen-percpu-virq timer0
44: 0 0 xen-percpu-virq debug0
47: 0 20995 xen-percpu-virq timer1
51: 0 0 xen-percpu-virq debug1
69: 0 0 xen-dyn-virq xen-pcpu
74: 0 0 xen-dyn-virq mce
75: 29 0 xen-dyn-virq hvc\_console
Signed-off-by: David Vrabel
Signed-off-by: Greg Kroah-Hartman
commit 68482f12d90fb757eef19493fb7bf7fdc1029a7a
Author: Filipe Manana
Date: Mon May 18 19:11:40 2015 +0100
Btrfs: fix racy system chunk allocation when setting block group ro
commit a96295965b600f2dc6ad661c4803c86e87db3d7b upstream.
If while setting a block group read-only we end up allocating a system
chunk, through check\_system\_chunk(), we were not doing it while holding
the chunk mutex which is a problem if a concurrent chunk allocation is
happening, through do\_chunk\_alloc(), as it means both block groups can
end up using the same logical addresses and physical regions in the
device(s). So make sure we hold the chunk mutex.
Fixes: 2f0810880f08 ("btrfs: delete chunk allocation attemp when
setting block group ro")
Signed-off-by: Filipe Manana
Signed-off-by: Chris Mason
Signed-off-by: Greg Kroah-Hartman
commit f0034a3a16b3c04b88a87ca2a49839f74f668215
Author: Ilya Dryomov
Date: Mon May 11 17:53:34 2015 +0300
Revert "libceph: clear r\_req\_lru\_item in \_\_unregister\_linger\_request()"
commit 521a04d06a729e5971cdee7f84080387ed320527 upstream.
This reverts commit ba9d114ec5578e6e99a4dfa37ff8ae688040fd64.
.. which introduced a regression that prevented all lingering requests
requeued in kick\_requests() from ever being sent to the OSDs, resulting
in a lot of missed notifies. In retrospect it's pretty obvious that
r\_req\_lru\_item item in the case of lingering requests can be used not
only for notarget, but also for unsent linkage due to how tightly
actual map and enqueue operations are coupled in \_\_map\_request().
The assertion that was being silenced is taken care of in the previous
("libceph: request a new osdmap if lingering request maps to no osd")
commit: by always kicking homeless lingering requests we ensure that
none of them ends up on the notarget list outside of the critical
section guarded by request\_mutex.
Signed-off-by: Ilya Dryomov
Reviewed-by: Sage Weil
Signed-off-by: Greg Kroah-Hartman
commit 5b4715d14861470804d44ee916ed2ce2e3e6fd62
Author: Ilya Dryomov
Date: Mon May 11 17:53:10 2015 +0300
libceph: request a new osdmap if lingering request maps to no osd
commit b0494532214bdfbf241e94fabab5dd46f7b82631 upstream.
This commit does two things. First, if there are any homeless
lingering requests, we now request a new osdmap even if the osdmap that
is being processed brought no changes, i.e. if a given lingering
request turned homeless in one of the previous epochs and remained
homeless in the current epoch. Not doing so leaves us with a stale
osdmap and as a result we may miss our window for reestablishing the
watch and lose notifies.
MON=1 OSD=1:
# cat linger-needmap.sh
#!/bin/bash
rbd create --size 1 test
DEV=$(rbd map test)
ceph osd out 0
rbd map dne/dne # obtain a new osdmap as a side effect (!)
sleep 1
ceph osd in 0
rbd resize --size 2 test
# rbd info test | grep size -> 2M
# blockdev --getsize $DEV -> 1M
N.B.: Not obtaining a new osdmap in between "osd out" and "osd in"
above is enough to make it miss that resize notify, but that is a
bug^Wlimitation of ceph watch/notify v1.
Second, homeless lingering requests are now kicked just like those
lingering requests whose mapping has changed. This is mainly to
recognize that a homeless lingering request makes no sense and to
preserve the invariant that a registered lingering request is not
sitting on any of r\_req\_lru\_item lists. This spares us a WARN\_ON,
which commit ba9d114ec557 ("libceph: clear r\_req\_lru\_item in
\_\_unregister\_linger\_request()") tried to fix the \_wrong\_ way.
Signed-off-by: Ilya Dryomov
Reviewed-by: Sage Weil
Signed-off-by: Greg Kroah-Hartman
commit 5b465771a6682caaec46565b1a4183bc6e90096a
Author: Johan Hovold
Date: Fri May 15 16:27:40 2015 +0200
mfd: da9052: Fix broken regulator probe
commit e0c21530fa91f119bfca19640a67380c6b14f12a upstream.
Fix broken probe of da9052 regulators, which since commit b3f6c73db732
("mfd: da9052-core: Fix platform-device id collision") use a
non-deterministic platform-device id to retrieve static regulator
information. Fortunately, adequate error handling was in place so probe
would simply fail with an error message.
Update the mfd-cell ids to be zero-based and use those to identify the
cells when probing the regulator devices.
Fixes: b3f6c73db732 ("mfd: da9052-core: Fix platform-device id collision")
Signed-off-by: Johan Hovold
Acked-by: Bartlomiej Zolnierkiewicz
Reviewed-by: Mark Brown
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit 5a0408dbe26652da4dc9e166178226d3dfd5fe2c
Author: Miklos Szeredi
Date: Tue May 19 14:30:12 2015 +0200
ovl: mount read-only if workdir can't be created
commit cc6f67bcafcb6bbbb2d1be1603dcd95125a52800 upstream.
OpenWRT folks reported that overlayfs fails to mount if upper fs is full,
because workdir can't be created. Wordir creation can fail for various
other reasons too.
There's no reason that the mount itself should fail, overlayfs can work
fine without a workdir, as long as the overlay isn't modified.
So mount it read-only and don't allow remounting read-write.
Add a couple of WARN\_ON()s for the impossible case of workdir being used
despite being read-only.
Reported-by: Bastian Bittorf
Signed-off-by: Miklos Szeredi
Signed-off-by: Greg Kroah-Hartman
commit 5738c250f437599583ad9130e6fd6c10eb1d1ffa
Author: Miklos Szeredi
Date: Thu May 14 10:04:44 2015 +0200
ovl: don't remove non-empty opaque directory
commit d377c5eb54dd05aeb3094b7740252d19ba7791f7 upstream.
When removing an opaque directory we can't just call rmdir() to check for
emptiness, because the directory will need to be replaced with a whiteout.
The replacement is done with RENAME\_EXCHANGE, which doesn't check
emptiness.
Solution is just to check emptiness by reading the directory. In the
future we could add a new rename flag to check for emptiness even for
RENAME\_EXCHANGE to optimize this case.
Reported-by: Vincent Batts
Signed-off-by: Miklos Szeredi
Tested-by: Jordi Pujol Palomer
Fixes: 263b4a0fee43 ("ovl: dont replace opaque dir")
Signed-off-by: Greg Kroah-Hartman
commit b8eadc722286edff2612768b5bc3555aa8494000
Author: Rusty Russell
Date: Wed May 27 10:59:26 2015 +0930
lguest: fix out-by-one error in address checking.
commit 83a35114d0e4583e6b0ca39502e68b6a92e2910c upstream.
This bug has been there since day 1; addresses in the top guest physical
page weren't considered valid. You could map that page (the check in
check\_gpte() is correct), but if a guest tried to put a pagetable there
we'd check that address manually when walking it, and kill the guest.
Signed-off-by: Rusty Russell
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit d5d4c3be68c85ec9f27be97f65fc80eec097bee5
Author: Dave Chinner
Date: Fri May 29 07:40:32 2015 +1000
xfs: xfs\_iozero can return positive errno
commit cddc116228cb9d51d3224d23ba3e61fbbc3ec3d2 upstream.
It was missed when we converted everything in XFs to use negative error
numbers, so fix it now. Bug introduced in 3.17 by commit 2451337 ("xfs: global
error sign conversion"), and should go back to stable kernels.
Thanks to Brian Foster for noticing it.
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit d6ae189528c873a7cc8cf567aaeaa935bc2e2a95
Author: Dave Chinner
Date: Fri May 29 07:40:08 2015 +1000
xfs: xfs\_attr\_inactive leaves inconsistent attr fork state behind
commit 6dfe5a049f2d48582050339d2a6b6fda36dfd14c upstream.
xfs\_attr\_inactive() is supposed to clean up the attribute fork when
the inode is being freed. While it removes attribute fork extents,
it completely ignores attributes in local format, which means that
there can still be active attributes on the inode after
xfs\_attr\_inactive() has run.
This leads to problems with concurrent inode writeback - the in-core
inode attribute fork is removed without locking on the assumption
that nothing will be attempting to access the attribute fork after a
call to xfs\_attr\_inactive() because it isn't supposed to exist on
disk any more.
To fix this, make xfs\_attr\_inactive() completely remove all traces
of the attribute fork from the inode, regardless of it's state.
Further, also remove the in-core attribute fork structure safely so
that there is nothing further that needs to be done by callers to
clean up the attribute fork. This means we can remove the in-core
and on-disk attribute forks atomically.
Also, on error simply remove the in-memory attribute fork. There's
nothing that can be done with it once we have failed to remove the
on-disk attribute fork, so we may as well just blow it away here
anyway.
Reported-by: Waiman Long
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit a3593474f50b8752c03feebcd4ef0e2f7ea94a49
Author: Bob Copeland
Date: Thu May 28 15:44:35 2015 -0700
omfs: fix sign confusion for bitmap loop counter
commit c0345ee57d461343586b5e1e2f9c3c3766d07fe6 upstream.
The count variable is used to iterate down to (below) zero from the size
of the bitmap and handle the one-filling the remainder of the last
partial bitmap block. The loop conditional expects count to be signed
in order to detect when the final block is processed, after which count
goes negative.
Unfortunately, a recent change made this unsigned along with some other
related fields. The result of is this is that during mount,
omfs\_get\_imap will overrun the bitmap array and corrupt memory unless
number of blocks happens to be a multiple of 8 \* blocksize.
Fix by changing count back to signed: it is guaranteed to fit in an s32
without overflow due to an enforced limit on the number of blocks in the
filesystem.
Signed-off-by: Bob Copeland
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 4215727c437c76503dc668677ffdd77f233182f0
Author: Sasha Levin
Date: Thu May 28 15:44:29 2015 -0700
fs, omfs: add NULL terminator in the end up the token list
commit dcbff39da3d815f08750552fdd04f96b51751129 upstream.
match\_token() expects a NULL terminator at the end of the token list so
that it would know where to stop. Not having one causes it to overrun
to invalid memory.
In practice, passing a mount option that omfs didn't recognize would
sometimes panic the system.
Signed-off-by: Sasha Levin
Signed-off-by: Bob Copeland
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 1d280829188e2a0f10fbc530dfb7c2fcb2d97acc
Author: John Stultz
Date: Fri May 8 13:47:23 2015 -0700
ktime: Fix ktime\_divns to do signed division
commit f7bcb70ebae0dcdb5a2d859b09e4465784d99029 upstream.
It was noted that the 32bit implementation of ktime\_divns()
was doing unsigned division and didn't properly handle
negative values.
And when a ktime helper was changed to utilize
ktime\_divns, it caused a regression on some IR blasters.
See the following bugzilla for details:
https://bugzilla.redhat.com/show\_bug.cgi?id=1200353
This patch fixes the problem in ktime\_divns by checking
and preserving the sign bit, and then reapplying it if
appropriate after the division, it also changes the return
type to a s64 to make it more obvious this is expected.
Nicolas also pointed out that negative dividers would
cause infinite loops on 32bit systems, negative dividers
is unlikely for users of this function, but out of caution
this patch adds checks for negative dividers for both
32-bit (BUG\_ON) and 64-bit(WARN\_ON) versions to make sure
no such use cases creep in.
[ tglx: Hand an u64 to do\_div() to avoid the compiler warning ]
Fixes: 166afb64511e 'ktime: Sanitize ktime\_to\_us/ms conversion'
Reported-and-tested-by: Trevor Cordes
Signed-off-by: John Stultz
Acked-by: Nicolas Pitre
Cc: Ingo Molnar
Cc: Josh Boyer
Cc: One Thousand Gnomes
Link: http://lkml.kernel.org/r/1431118043-23452-1-git-send-email-john.stultz@linaro.org
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit aeeaad9ec0e6b76c4b3f66d11e1d0e14294dd3d3
Author: Liang Li
Date: Thu May 21 04:41:25 2015 +0800
kvm/fpu: Enable eager restore kvm FPU for MPX
commit c447e76b4cabb49ddae8e49c5758f031f35d55fb upstream.
The MPX feature requires eager KVM FPU restore support. We have verified
that MPX cannot work correctly with the current lazy KVM FPU restore
mechanism. Eager KVM FPU restore should be enabled if the MPX feature is
exposed to VM.
Signed-off-by: Yang Zhang
Signed-off-by: Liang Li
[Also activate the FPU on AMD processors. - Paolo]
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit dbedd5a5e824edbff0d95d2a0b321235a0d4e900
Author: Xiao Guangrong
Date: Mon May 11 22:55:21 2015 +0800
KVM: MMU: fix SMAP virtualization
commit 0be0226f07d14b153a5eedf2bb86e1eb7dcefab5 upstream.
KVM may turn a user page to a kernel page when kernel writes a readonly
user page if CR0.WP = 1. This shadow page entry will be reused after
SMAP is enabled so that kernel is allowed to access this user page
Fix it by setting SMAP && !CR0.WP into shadow page's role and reset mmu
once CR4.SMAP is updated
Signed-off-by: Xiao Guangrong
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 211b28d737d8c11258a270fa6e400590a3a3524e
Author: Andrea Arcangeli
Date: Fri May 8 14:32:56 2015 +0200
kvm: fix crash in kvm\_vcpu\_reload\_apic\_access\_page
commit e8fd5e9e9984675f45b9a5485909c143fbde248f upstream.
memslot->userfault\_addr is set by the kernel with a mmap executed
from the kernel but the userland can still munmap it and lead to the
below oops after memslot->userfault\_addr points to a host virtual
address that has no vma or mapping.
[ 327.538306] BUG: unable to handle kernel paging request at fffffffffffffffe
[ 327.538407] IP: [] put\_page+0x5/0x50
[ 327.538474] PGD 1a01067 PUD 1a03067 PMD 0
[ 327.538529] Oops: 0000 [#1] SMP
[ 327.538574] Modules linked in: macvtap macvlan xt\_CHECKSUM iptable\_mangle ipt\_MASQUERADE nf\_nat\_masquerade\_ipv4 iptable\_nat nf\_nat\_ipv4 nf\_nat nf\_conntrack\_ipv4 nf\_defrag\_ipv4 xt\_conntrack nf\_conntrack ipt\_REJECT iptable\_filter ip\_tables tun bridge stp llc rpcsec\_gss\_krb5 nfsv4 dns\_resolver nfs fscache xprtrdma ib\_isert iscsi\_target\_mod ib\_iser libiscsi scsi\_transport\_iscsi ib\_srpt target\_core\_mod ib\_srp scsi\_transport\_srp scsi\_tgt ib\_ipoib rdma\_ucm ib\_ucm ib\_uverbs ib\_umad rdma\_cm ib\_cm iw\_cm ipmi\_devintf iTCO\_wdt iTCO\_vendor\_support intel\_powerclamp coretemp dcdbas intel\_rapl kvm\_intel kvm crct10dif\_pclmul crc32\_pclmul ghash\_clmulni\_intel aesni\_intel lrw gf128mul glue\_helper ablk\_helper cryptd pcspkr sb\_edac edac\_core ipmi\_si ipmi\_msghandler acpi\_pad wmi acpi\_power\_meter lpc\_ich mfd\_core mei\_me
[ 327.539488] mei shpchp nfsd auth\_rpcgss nfs\_acl lockd grace sunrpc mlx4\_ib ib\_sa ib\_mad ib\_core mlx4\_en vxlan ib\_addr ip\_tunnel xfs libcrc32c sd\_mod crc\_t10dif crct10dif\_common crc32c\_intel mgag200 syscopyarea sysfillrect sysimgblt i2c\_algo\_bit drm\_kms\_helper ttm drm ahci i2c\_core libahci mlx4\_core libata tg3 ptp pps\_core megaraid\_sas ntb dm\_mirror dm\_region\_hash dm\_log dm\_mod
[ 327.539956] CPU: 3 PID: 3161 Comm: qemu-kvm Not tainted 3.10.0-240.el7.userfault19.4ca4011.x86\_64.debug #1
[ 327.540045] Hardware name: Dell Inc. PowerEdge R420/0CN7CM, BIOS 2.1.2 01/20/2014
[ 327.540115] task: ffff8803280ccf00 ti: ffff880317c58000 task.ti: ffff880317c58000
[ 327.540184] RIP: 0010:[] [] put\_page+0x5/0x50
[ 327.540261] RSP: 0018:ffff880317c5bcf8 EFLAGS: 00010246
[ 327.540313] RAX: 00057ffffffff000 RBX: ffff880616a20000 RCX: 0000000000000000
[ 327.540379] RDX: 0000000000002014 RSI: 00057ffffffff000 RDI: fffffffffffffffe
[ 327.540445] RBP: ffff880317c5bd10 R08: 0000000000000103 R09: 0000000000000000
[ 327.540511] R10: 0000000000000000 R11: 0000000000000000 R12: fffffffffffffffe
[ 327.540576] R13: 0000000000000000 R14: ffff880317c5bd70 R15: ffff880317c5bd50
[ 327.540643] FS: 00007fd230b7f700(0000) GS:ffff880630800000(0000) knlGS:0000000000000000
[ 327.540717] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 327.540771] CR2: fffffffffffffffe CR3: 000000062a2c3000 CR4: 00000000000427e0
[ 327.540837] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 327.540904] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
[ 327.540974] Stack:
[ 327.541008] ffffffffa05d6d0c ffff880616a20000 0000000000000000 ffff880317c5bdc0
[ 327.541093] ffffffffa05ddaa2 0000000000000000 00000000002191bf 00000042f3feab2d
[ 327.541177] 00000042f3feab2d 0000000000000002 0000000000000001 0321000000000000
[ 327.541261] Call Trace:
[ 327.541321] [] ? kvm\_vcpu\_reload\_apic\_access\_page+0x6c/0x80 [kvm]
[ 327.543615] [] vcpu\_enter\_guest+0x3f2/0x10f0 [kvm]
[ 327.545918] [] kvm\_arch\_vcpu\_ioctl\_run+0x2b0/0x5a0 [kvm]
[ 327.548211] [] ? kvm\_arch\_vcpu\_ioctl\_run+0xa2/0x5a0 [kvm]
[ 327.550500] [] kvm\_vcpu\_ioctl+0x2b5/0x680 [kvm]
[ 327.552768] [] ? creds\_are\_invalid.part.1+0x12/0x50
[ 327.555069] [] ? creds\_are\_invalid+0x21/0x30
[ 327.557373] [] ? inode\_has\_perm.isra.49.constprop.65+0x26/0x80
[ 327.559663] [] do\_vfs\_ioctl+0x305/0x530
[ 327.561917] [] SyS\_ioctl+0xa1/0xc0
[ 327.564185] [] system\_call\_fastpath+0x16/0x1b
[ 327.566480] Code: 0b 31 f6 4c 89 e7 e8 4b 7f ff ff 0f 0b e8 24 fd ff ff e9 a9 fd ff ff 66 66 66 66 66 66 2e 0f 1f 84 00 00 00 00 00 66 66 66 66 90 <48> f7 07 00 c0 00 00 55 48 89 e5 75 2a 8b 47 1c 85 c0 74 1e f0
Signed-off-by: Andrea Arcangeli
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 496862ce1ec797b80c7761f6770a3e225bb79035
Author: Xiao Guangrong
Date: Thu May 7 16:20:15 2015 +0800
KVM: MMU: fix smap permission check
commit 7cbeed9bce7580479bb97457dad220cb3594b875 upstream.
Current permission check assumes that RSVD bit in PFEC is always zero,
however, it is not true since MMIO #PF will use it to quickly identify
MMIO access
Fix it by clearing the bit if walking guest page table is needed
Signed-off-by: Xiao Guangrong
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit b3aa70cdd11149c696c03ab8fc0fef13c4c07973
Author: Paolo Bonzini
Date: Thu Apr 2 11:04:05 2015 +0200
KVM: MMU: fix CR4.SMEP=1, CR0.WP=0 with shadow pages
commit 898761158be7682082955e3efa4ad24725305fc7 upstream.
smep\_andnot\_wp is initialized in kvm\_init\_shadow\_mmu and shadow pages
should not be reused for different values of it. Thus, it has to be
added to the mask in kvm\_mmu\_pte\_write.
Reviewed-by: Xiao Guangrong
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 8e592180585c84821dad9d764b23ebc86d48aef7
Author: Ingo Molnar
Date: Wed May 20 11:45:30 2015 +0200
x86/fpu: Disable XSAVES\* support for now
commit e88221c50cadade0eb4f7f149f4967d760212695 upstream.
The kernel's handling of 'compacted' xsave state layout is buggy:
http://marc.info/?l=linux-kernel&m=142967852317199
I don't have such a system, and the description there is vague, but
from extrapolation I guess that there were two kinds of bugs
observed:
- boot crashes, due to size calculations being wrong and the dynamic
allocation allocating a too small xstate area. (This is now fixed
in the new FPU code - but still present in stable kernels.)
- FPU state corruption and ABI breakage: if signal handlers try to
change the FPU state in standard format, which then the kernel
tries to restore in the compacted format.
These breakages are scary, but they only occur on a small number of
systems that have XSAVES\* CPU support. Yet we have had XSAVES support
in the upstream kernel for a large number of stable kernel releases,
and the fixes are involved and unproven.
So do the safe resolution first: disable XSAVES\* support and only
use the standard xstate format. This makes the code work and is
easy to backport.
On top of this we can work on enabling (and testing!) proper
compacted format support, without backporting pressure, on top of the
new, cleaned up FPU code.
Cc: Andy Lutomirski
Cc: Borislav Petkov
Cc: Dave Hansen
Cc: Fenghua Yu
Cc: H. Peter Anvin
Cc: Linus Torvalds
Cc: Oleg Nesterov
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 270314c65fed6237006d75dc92a5356d666a9fb3
Author: Borislav Petkov
Date: Mon May 18 10:07:17 2015 +0200
x86/mce: Fix MCE severity messages
commit 17fea54bf0ab34fa09a06bbde2f58ed7bbdf9299 upstream.
Derek noticed that a critical MCE gets reported with the wrong
error type description:
[Hardware Error]: CPU 34: Machine Check Exception: 5 Bank 9: f200003f000100b0
[Hardware Error]: RIP !INEXACT! 10: {intel\_idle+0xb1/0x170}
[Hardware Error]: TSC 49587b8e321cb
[Hardware Error]: PROCESSOR 0:306e4 TIME 1431561296 SOCKET 1 APIC 29
[Hardware Error]: Some CPUs didn't answer in synchronization
[Hardware Error]: Machine check: Invalid
^^^^^^^
The last line with 'Invalid' should have printed the high level
MCE error type description we get from mce\_severity, i.e.
something like:
[Hardware Error]: Machine check: Action required: data load error in a user process
this happens due to the fact that mce\_no\_way\_out() iterates over
all MCA banks and possibly overwrites the @msg argument which is
used in the panic printing later.
Change behavior to take the message of only and the (last)
critical MCE it detects.
Reported-by: Derek
Signed-off-by: Borislav Petkov
Cc: H. Peter Anvin
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Tony Luck
Link: http://lkml.kernel.org/r/1431936437-25286-3-git-send-email-bp@alien8.de
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 42a6063030e3b3995e7e1c62969abfe6536fda63
Author: Paolo Bonzini
Date: Wed May 20 11:33:43 2015 +0200
Revert "KVM: x86: drop fpu\_activate hook"
commit 0fdd74f7784b5cdff7075736992bbb149b1ae49c upstream.
This reverts commit 4473b570a7ebb502f63f292ccfba7df622e5fdd3. We'll
use the hook again.
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 4c951487320faeb8a1fd7e750e2f758a37b56865
Author: Will Deacon
Date: Fri May 8 17:44:22 2015 +0100
iommu/arm-smmu: Fix sign-extension of upstream bus addresses at stage 1
commit 5dc5616ee850eaba055bb469a6c4a471d489140e upstream.
Stage 1 translation is controlled by two sets of page tables (TTBR0 and
TTBR1) which grow up and down from zero respectively in the ARMv8
translation regime. For the SMMU, we only care about TTBR0 and, in the
case of a 48-bit virtual space, we expect to map virtual addresses 0x0
through to 0xffff\_ffff\_ffff.
Given that some masters may be incapable of emitting virtual addresses
targetting TTBR1 (e.g. because they sit on a 48-bit bus), the SMMU
architecture allows bit 47 to be sign-extended, halving the virtual
range of TTBR0 but allowing TTBR1 to be used. This is controlled by the
SEP field in TTBCR2.
The SMMU driver incorrectly enables this sign-extension feature, which
causes problems when userspace addresses are programmed into a master
device with the SMMU expecting to map the incoming transactions via
TTBR0; if the top bit of address is set, we will instead get a
translation fault since TTBR1 walks are disabled in the TTBCR.
This patch fixes the issue by disabling sign-extension of a fixed
virtual address bit and instead basing the behaviour on the upstream bus
size: the incoming address is zero extended unless the upstream bus is
only 49 bits wide, in which case bit 48 is used as the sign bit and is
replicated to the upper bits.
Reported-by: Varun Sethi
Signed-off-by: Will Deacon
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 9f453d6e25ac30a74af17975313604c71c5c599c
Author: Oded Gabbay
Date: Thu Apr 16 17:08:44 2015 +0300
iommu/amd: Fix bug in put\_pasid\_state\_wait
commit 1bf1b431d98d7e5b5419876d4c219469e60693e1 upstream.
This patch fixes a bug in put\_pasid\_state\_wait that appeared in kernel 4.0
The bug is that pasid\_state->count wasn't decremented before entering the
wait\_event. Thus, the condition in wait\_event will never be true.
The fix is to decrement (atomically) the pasid\_state->count before the
wait\_event.
Signed-off-by: Oded Gabbay
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit ef20854f7600f5019f1869fb331f73281f834257
Author: Eric W. Biederman
Date: Thu Apr 2 16:35:48 2015 -0500
fs\_pin: Allow for the possibility that m\_list or s\_list go unused.
commit 820f9f147dcce2602eefd9b575bbbd9ea14f0953 upstream.
This is needed to support lazily umounting locked mounts. Because the
entire unmounted subtree needs to stay together until there are no
users with references to any part of the subtree.
To support this guarantee that the fs\_pin m\_list and s\_list nodes
are initialized by initializing them in init\_fs\_pin allowing
for the possibility that pin\_insert\_group does not touch them.
Further use hlist\_del\_init in pin\_remove so that there is
a hlist\_unhashed test before the list we attempt to update
the previous list item.
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 9993cbfde223f91ad29c5d002f6711fceff75219
Author: Eric W. Biederman
Date: Wed Jan 7 14:28:26 2015 -0600
mnt: Fail collect\_mounts when applied to unmounted mounts
commit cd4a40174b71acd021877341684d8bb1dc8ea4ae upstream.
The only users of collect\_mounts are in audit\_tree.c
In audit\_trim\_trees and audit\_add\_tree\_rule the path passed into
collect\_mounts is generated from kern\_path passed an audit\_tree
pathname which is guaranteed to be an absolute path. In those cases
collect\_mounts is obviously intended to work on mounted paths and
if a race results in paths that are unmounted when collect\_mounts
it is reasonable to fail early.
The paths passed into audit\_tag\_tree don't have the absolute path
check. But are used to play with fsnotify and otherwise interact with
the audit\_trees, so again operating only on mounted paths appears
reasonable.
Avoid having to worry about what happens when we try and audit
unmounted filesystems by restricting collect\_mounts to mounts
that appear in the mount tree.
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman


=== Content from bugzilla.redhat.com_e50d17e1_20250124_201529.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1248486)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1248486)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1248486)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1248486

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1248486**](show_bug.cgi?id=1248486)
(CVE-2015-4177)
- [CVE-2015-4177](https://access.redhat.com/security/cve/CVE-2015-4177) kernel: Race conditions in collect\_mounts

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2015-4177 kernel: Race conditions in collect\_mounts

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED WONTFIX | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2015-4177 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1224245](show_bug.cgi?id=1224245) | | TreeView+ | [depends on](buglist.cgi?bug_id=1248486&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1248486&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-07-30 11:46 UTC by Wade Mealing | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 05:04 UTC ([History](show_activity.cgi?id=1248486)) | | [CC List:](page.cgi?id=fields.html#cclist) | 31 users (show)  agordeev aquini arm-mgr bhu dhoward fhrbata gansalmon itamar jkacur joelsmith jonathan jrusnack kernel-maint kernel-mgr lgoncalv lwang madhu.chinakonda mchehab mguzik nmurray plougher pmatouse rt-maint rvrbovsk slawomir slong vgoyal vkaigoro vkrizan williams wmealing | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A flaw was discovered in the kernel's collect\_mounts function. If the kernel's audit subsystem called collect\_mounts to audit an unmounted path, it could panic the system. With this flaw, an unprivileged user could call umount(MNT\_DETACH) to launch a denial-of-service attack. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2017-08-25 12:28:16 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1248486#c0)  Wade Mealing    2015-07-30 11:46:36 UTC  ``` The audit subsystem can call collect_mounts, which if attempting to audit a mountpoint which is no longer mounted can panic the system.  Upstream patch: <http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae>  CVE Request: <http://seclists.org/oss-sec/2015/q2/640>   ```  [Comment 4](show_bug.cgi?id=1248486#c4)  Wade Mealing    2015-08-20 03:51:34 UTC  ``` Statement:  This issue does not affect the Linux kernels as shipped with Red Hat Enterprise Linux 5, 6, MRG-2, realtime and arm-kernels.  The issue is not currently planned to be addressed in Red Hat Enterprise Linux 7.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1248486&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from git.kernel.org_732874b4_20250124_201520.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric W. Biederman <ebiederm@xmission.com> | 2015-01-07 14:28:26 -0600 |
| --- | --- | --- |
| committer | Eric W. Biederman <ebiederm@xmission.com> | 2015-04-09 11:38:31 -0500 |
| commit | [cd4a40174b71acd021877341684d8bb1dc8ea4ae](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)) | |
| tree | [58a7f55022d02103e77f5a8005134c863bd24b4e](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae) | |
| parent | [0c56fe31420ca599c90240315f7959bf1b4eb6ce](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0c56fe31420ca599c90240315f7959bf1b4eb6ce) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae&id2=0c56fe31420ca599c90240315f7959bf1b4eb6ce)) | |
| download | [linux-cd4a40174b71acd021877341684d8bb1dc8ea4ae.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-cd4a40174b71acd021877341684d8bb1dc8ea4ae.tar.gz) | |

mnt: Fail collect\_mounts when applied to unmounted mountsThe only users of collect\_mounts are in audit\_tree.c
In audit\_trim\_trees and audit\_add\_tree\_rule the path passed into
collect\_mounts is generated from kern\_path passed an audit\_tree
pathname which is guaranteed to be an absolute path. In those cases
collect\_mounts is obviously intended to work on mounted paths and
if a race results in paths that are unmounted when collect\_mounts
it is reasonable to fail early.
The paths passed into audit\_tag\_tree don't have the absolute path
check. But are used to play with fsnotify and otherwise interact with
the audit\_trees, so again operating only on mounted paths appears
reasonable.
Avoid having to worry about what happens when we try and audit
unmounted filesystems by restricting collect\_mounts to mounts
that appear in the mount tree.
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)

| -rw-r--r-- | [fs/namespace.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/namespace.c?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/fs/namespace.c b/fs/namespace.cindex 2b12b7a9455d0b..acc5583764dc09 100644--- a/[fs/namespace.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/namespace.c?id=0c56fe31420ca599c90240315f7959bf1b4eb6ce)+++ b/[fs/namespace.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/namespace.c?id=cd4a40174b71acd021877341684d8bb1dc8ea4ae)@@ -1669,8 +1669,11 @@ struct vfsmount \*collect\_mounts(struct path \*path) { struct mount \*tree; namespace\_lock();- tree = copy\_tree(real\_mount(path->mnt), path->dentry,- CL\_COPY\_ALL | CL\_PRIVATE);+ if (!check\_mnt(real\_mount(path->mnt)))+ tree = ERR\_PTR(-EINVAL);+ else+ tree = copy\_tree(real\_mount(path->mnt), path->dentry,+ CL\_COPY\_ALL | CL\_PRIVATE); namespace\_unlock(); if (IS\_ERR(tree)) return ERR\_CAST(tree); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 20:13:57 +0000



=== Content from github.com_5478323a_20250124_201530.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcd4a40174b71acd021877341684d8bb1dc8ea4ae)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcd4a40174b71acd021877341684d8bb1dc8ea4ae)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/cd4a40174b71acd021877341684d8bb1dc8ea4ae)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

mnt: Fail collect\_mounts when applied to unmounted mounts

[Browse files](/torvalds/linux/tree/cd4a40174b71acd021877341684d8bb1dc8ea4ae)
Browse the repository at this point in the history

```
The only users of collect_mounts are in audit_tree.c

In audit_trim_trees and audit_add_tree_rule the path passed into
collect_mounts is generated from kern_path passed an audit_tree
pathname which is guaranteed to be an absolute path.   In those cases
collect_mounts is obviously intended to work on mounted paths and
if a race results in paths that are unmounted when collect_mounts
it is reasonable to fail early.

The paths passed into audit_tag_tree don't have the absolute path
check.  But are used to play with fsnotify and otherwise interact with
the audit_trees, so again operating only on mounted paths appears
reasonable.

Avoid having to worry about what happens when we try and audit
unmounted filesystems by restricting collect_mounts to mounts
that appear in the mount tree.

Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
```

* Loading branch information

[![@ebiederm](https://avatars.githubusercontent.com/u/7477136?s=40&v=4)](/ebiederm)

[ebiederm](/torvalds/linux/commits?author=ebiederm "View all commits by ebiederm")
committed
Apr 9, 2015

1 parent
[0c56fe3](/torvalds/linux/commit/0c56fe31420ca599c90240315f7959bf1b4eb6ce)

commit cd4a401

Showing
**1 changed file**
with
**5 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

7 changes: 5 additions & 2 deletions

7
[fs/namespace.c](#diff-26b064824bfafef546f17235dc1f34dbea87ce6c27f9320b5d4427bfa4d2b0e9 "fs/namespace.c")

Show comments

[View file](/torvalds/linux/blob/cd4a40174b71acd021877341684d8bb1dc8ea4ae/fs/namespace.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1669,8 +1669,11 @@ struct vfsmount \*collect\_mounts(struct path \*path) |
|  |  | { |
|  |  | struct mount \*tree; |
|  |  | namespace\_lock(); |
|  |  | tree = copy\_tree(real\_mount(path->mnt), path->dentry, |
|  |  | CL\_COPY\_ALL | CL\_PRIVATE); |
|  |  | if (!check\_mnt(real\_mount(path->mnt))) |
|  |  | tree = ERR\_PTR(-EINVAL); |
|  |  | else |
|  |  | tree = copy\_tree(real\_mount(path->mnt), path->dentry, |
|  |  | CL\_COPY\_ALL | CL\_PRIVATE); |
|  |  | namespace\_unlock(); |
|  |  | if (IS\_ERR(tree)) |
|  |  | return ERR\_CAST(tree); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `cd4a401`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcd4a40174b71acd021877341684d8bb1dc8ea4ae) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from openwall.com_7c59326e_20250124_201520.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](9) [[next>]](../../../2015/05/31/1) [[<thread-prev]](5) [[thread-next>]](../../../2015/06/03/12) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <5568F402.2050904@kernel.org>
Date: Fri, 29 May 2015 16:19:30 -0700
From: Andy Lutomirski <luto@...nel.org>
To: oss-security@...ts.openwall.com
CC: drew@...dstorm.io
Subject: Re: CVE request Linux kernel: ns: user namespaces panic

On 05/29/2015 09:35 AM, P J P wrote:
>     Hello,
>
> Linux kernel built with the user namespaces support(CONFIG_USER_NS) is
> vulnerable to a NULL pointer dereference flaw. It could occur when users
> in user namespaces do unmount mounts.
>
> An unprivileged user could use this flaw to crash the system resulting
> in DoS.
>
> Upstream fixes:
> ---------------
>    -> <https://git.kernel.org/linus/820f9f147dcce2602eefd9b575bbbd9ea14f0953>
>    -> <https://git.kernel.org/linus/cd4a40174b71acd021877341684d8bb1dc8ea4ae>
>
> It was introduced by:
> ---------------------
>    -> <https://git.kernel.org/linus/ce07d891a0891d3c0d0c2d73d577490486b809e1>
>
> Thank you Drew Fisher for reporting this issue to Fedora Security Team.

To clarify further: this is a regression in Linux 4.0.2 and will be
fixed in Linux 4.0.5.  It has been independently reported by at least
Kenton Varda and Alexander Larsson.  I think that Eric Biederman also
reported it to linux-stable at some point.

--Andy

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from access.redhat.com_d4b10054_20250126_031728.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from openwall.com_fca6c4a6_20250124_201520.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[thread-next>]](10) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <alpine.LFD.2.11.1505292156260.17180@wniryva>
Date: Fri, 29 May 2015 22:05:26 +0530 (IST)
From: P J P <ppandit@...hat.com>
To: oss security list <oss-security@...ts.openwall.com>
cc: drew@...dstorm.io
Subject: CVE request Linux kernel: ns: user namespaces panic

    Hello,

Linux kernel built with the user namespaces support(CONFIG_USER_NS) is
vulnerable to a NULL pointer dereference flaw. It could occur when users in
user namespaces do unmount mounts.

An unprivileged user could use this flaw to crash the system resulting in DoS.

Upstream fixes:
---------------
   -> <https://git.kernel.org/linus/820f9f147dcce2602eefd9b575bbbd9ea14f0953>
   -> <https://git.kernel.org/linus/cd4a40174b71acd021877341684d8bb1dc8ea4ae>

It was introduced by:
---------------------
   -> <https://git.kernel.org/linus/ce07d891a0891d3c0d0c2d73d577490486b809e1>

Thank you Drew Fisher for reporting this issue to Fedora Security Team.

Thank you.
--
Prasad J Pandit / Red Hat Product Security Team
47AF CE69 3A90 54AA 9045 1053 DD13 3D32 FE5B 041F

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


