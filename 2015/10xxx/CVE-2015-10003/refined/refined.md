- **Root cause of vulnerability:** A bug in Filezilla FTP server, introduced in version 0.8.0, causes the server to check the *local* IP address of the data channel against the control channel's IP address instead of the *remote* IP address. This bypasses the intended IP address restrictions designed to prevent PORT bounce attacks and PASV connection theft.
- **Weaknesses/vulnerabilities present:**
    - **FTP PORT bounce attack:** Due to the IP address check bug, the server does not effectively restrict the source of the data connection. This allows an attacker to redirect the data connection to a third party.
    - **PASV connection theft:** The server uses a weak form of PASV SYN protection by closing the listening socket after the first connection is accepted. However, this is insufficient, as an attacker can exploit a race condition to establish a data connection before the legitimate client, allowing the attacker to intercept the data transfer or inject data. The port number used for passive connections is also predictable on Windows 8, incrementing by one on each new connection.
- **Impact of exploitation:**
    - **PORT bounce attack:** An attacker can redirect the data channel to a third party, potentially using the vulnerable server as a proxy for malicious activities.
    - **PASV connection theft:** The attacker can steal data transferred between the server and the legitimate client (RETR, LIST) or inject their own data (STOR), effectively performing a man-in-the-middle attack.
- **Attack vectors:**
    - **PORT bounce attack:** The attacker sends a PORT command to the server with a third-party IP and port. When the server tries to connect, the connection is redirected.
    - **PASV connection theft:** The attacker predicts the port used by the server for a passive data connection. Then, through precise timing, they establish a TCP connection to the data port before the legitimate client, allowing their connection to be used for the data transfer. The attacker needs to have access to the FTP service.
- **Required attacker capabilities/position:**
    - The attacker must have access to the FTP service, such as a valid user account or access to a public account.
    - For PASV connection theft, the attacker needs network proximity to exploit timing vulnerabilities and perform a 3-way handshake to the data port before the legitimate client does. They also need to predict the data port number (which is predictable on Windows 8).