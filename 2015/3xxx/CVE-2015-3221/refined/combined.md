=== Content from launchpad.net_9e50c715_20250126_074925.html ===

[Log in / Register](https://launchpad.net/~tristan-cacqueray/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~tristan-cacqueray)

## [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray)

* Overview
* [Code](https://code.launchpad.net/~tristan-cacqueray)
* [Bugs](https://bugs.launchpad.net/~tristan-cacqueray)
* [Blueprints](https://blueprints.launchpad.net/~tristan-cacqueray)
* [Translations](https://translations.launchpad.net/~tristan-cacqueray)
* [Answers](https://answers.launchpad.net/~tristan-cacqueray)

* [Related packages](https://launchpad.net/~tristan-cacqueray/%2Brelated-packages)
* [Related projects](https://launchpad.net/~tristan-cacqueray/%2Brelated-projects)

## User information

Launchpad Id:
tristan-cacqueray

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-10-25

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English

OpenPGP keys:

EB103DE8B5E69E631C6FF17922B9A05C925CC5D8

SSH keys:

[localadmin@controller](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~tristan-cacqueray/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**tristanC**
 on
**irc.freenode.net**

## [All memberships](https://launchpad.net/~tristan-cacqueray/%2Bparticipation) Latest memberships

| [Swiftsync dev](/~swiftsync-devteam)  Joined on 2014-02-13 | |
| --- | --- |
| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2013-12-12 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from lists.openstack.org_5b4a1783_20250125_093818.html ===

# [Open Stack](/)

* [Home](http://openstack.org/ "Go to the Home page")
* [Projects](http://openstack.org/projects/ "Go to the OpenStack Projects page")
* [User Stories](http://openstack.org/user-stories/ "Go to the User Stories page")
* [Community](http://openstack.org/community/ "Go to the Community page")
* [Blog](http://openstack.org/blog/ "Go to the OpenStack Blog")
* [Wiki](http://wiki.openstack.org/ "Go to the OpenStack Wiki")
* [Documentation](http://docs.openstack.org/ "Go to OpenStack Documentation")

# [openstack-announce] [OSSA 2015-012] Neutron L2 agent DoS through incorrect allowed address pairs (CVE-2015-3221)

**Tristan Cacqueray**
tdecacqu at redhat.com

*Tue Jun 23 17:08:41 UTC 2015*

* Previous message: [[openstack-announce] [release][ceilometer] ceilometermiddleware release 0.2.0 (liberty)](000376.html)
* Next message: [[openstack-announce] [release][oslo] oslo.concurrency release 2.1.0 (liberty)](000378.html)
* **Messages sorted by:**
  [[ date ]](date.html#377)
  [[ thread ]](thread.html#377)
  [[ subject ]](subject.html#377)
  [[ author ]](author.html#377)

---

```
===========================================================================
OSSA-2015-012: Neutron L2 agent DoS through incorrect allowed address pairs
===========================================================================

:Date: June 23, 2015
:CVE: CVE-2015-3221

Affects
~~~~~~~
- Neutron: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description
~~~~~~~~~~~
Darragh O'Reilly from HP reported a vulnerability in Neutron. By
adding an address pair which is rejected as invalid by the ipset tool,
an authenticated user may crash the Neutron L2 agent resulting in a
denial of service attack. Neutron setups using the IPTables firewall
driver are affected.

Patches
~~~~~~~
- <https://review.openstack.org/194696> (Juno)
- <https://review.openstack.org/194697> (Kilo)
- <https://review.openstack.org/194695> (Liberty)

Credits
~~~~~~~
- Darragh O'Reilly from HP (CVE-2015-3221)

References
~~~~~~~~~~
- <https://launchpad.net/bugs/1461054>
- <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3221>

Notes
~~~~~
- This fix will be included in future 2014.2.4 (juno) and 2015.1.1 (kilo)
  releases.
- Zero prefixed address pairs are no longer accepted by the Juno API, users
  need to use 0.0.0.0/1 and 128.0.0.1/1 or ::/1 and 8000::/1 instead. The
  fix_zero_length_ip_prefix.py tool is provided to clean ports previously
  configured with a zero prefixed address pair

--
Tristan Cacqueray
OpenStack Vulnerability Management Team

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <<http://lists.openstack.org/pipermail/openstack-announce/attachments/20150623/dca2648a/attachment.pgp>>

```

---

* Previous message: [[openstack-announce] [release][ceilometer] ceilometermiddleware release 0.2.0 (liberty)](000376.html)
* Next message: [[openstack-announce] [release][oslo] oslo.concurrency release 2.1.0 (liberty)](000378.html)
* **Messages sorted by:**
  [[ date ]](date.html#377)
  [[ thread ]](thread.html#377)
  [[ subject ]](subject.html#377)
  [[ author ]](author.html#377)

---

[More information about the OpenStack-announce
mailing list](http://lists.openstack.org/cgi-bin/mailman/listinfo/openstack-announce)

---

### OpenStack

* [Projects](http://openstack.org/projects/)
* [OpenStack Security](http://openstack.org/openstack-security/)
* [Common Questions](http://openstack.org/projects/openstack-faq/)
* [Blog](http://openstack.org/blog/)

### Community

* [User Groups](http://openstack.org/community/)
* [Events](http://openstack.org/events/)
* [Jobs](http://openstack.org/jobs/)
* [Companies](http://openstack.org/companies/)
* [Contribute](http://wiki.openstack.org/HowToContribute)

### Documentation

* [OpenStack Manuals](http://docs.openstack.org/)
* [Getting Started](http://docs.openstack.org/diablo/openstack-compute/starter/content/)
* [Wiki](http://wiki.openstack.org/)

### Branding & Legal

* [Logos & Guidelines](http://openstack.org/brand/)
* [Trademark Policy](http://openstack.org/brand/openstack-trademark-policy/)
* [Privacy Policy](http://openstack.org/privacy/)
* [OpenStack CLA](http://wiki.openstack.org/CLA)

---



=== Content from review.openstack.org_6ac6f107_20250126_074918.html ===




=== Content from bugs.launchpad.net_92b33a9d_20250125_093823.html ===

[Log in / Register](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* [Answers](https://answers.launchpad.net/neutron)

# [OSSA 2015-012] Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent (CVE-2015-3221)

Bug #1461054 reported by
[Darragh O'Reilly](https://launchpad.net/~darragh-oreilly)
on 2015-06-02

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Critical | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |
|  | [neutron](https://bugs.launchpad.net/neutron) | Fix Released | Critical | [Aaron Rosen](https://launchpad.net/~arosen) | [neutron 7.0.0 "liberty"](https://launchpad.net/neutron/%2Bmilestone/7.0.0) |
|  | [Juno](https://bugs.launchpad.net/neutron/juno) | Fix Released | Critical | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | [neutron 2014.2.4](https://launchpad.net/neutron/%2Bmilestone/2014.2.4) |
|  | [Kilo](https://bugs.launchpad.net/neutron/kilo) | Fix Committed | Critical | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |

### Bug Description

vagrant@node1:~$ neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/0

Updated port: 28dc7eb1-6f95-429f-8e30-adaefffcec70

This does not work - the ipset man page says that zero prefix size is not allowed for type hash:net.

But it also breaks the l2 agent and so affects other ports/vms/tenants ... - so opening as security vulnerability.

2015-06-02 11:02:31.897 ERROR neutron.agent.linux.utils [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None]

Command: ['ipset', 'add', '-exist', u'NETIPv48a445928-2f41-43de-a', u'0.0.0.0/0']

Exit code: 1

Stdin:

Stdout:

Stderr: ipset v6.20.1: The value of the CIDR parameter of the IP address is invalid

2015-06-02 11:02:31.898 DEBUG oslo\_concurrency.lockutils [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None] Releasing file lock "/opt/stack/data/neutron/lock/neutron-ipset" after holding it for 0.006s release /usr/local/lib/python2.7/dist-packages/oslo\_concurrency/lockutils.py:227

2015-06-02 11:02:31.898 DEBUG oslo\_concurrency.lockutils [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None] Lock "ipset" released by "set\_members" :: held 0.006s inner /usr/local/lib/python2.7/dist-packages/oslo\_concurrency/lockutils.py:456

2015-06-02 11:02:31.898 ERROR neutron.plugins.openvswitch.agent.ovs\_neutron\_agent [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None] Error while processing VIF ports

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent Traceback (most recent call last):

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs\_neutron\_agent.py", line 1640, in rpc\_loop

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent ovs\_restarted)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs\_neutron\_agent.py", line 1434, in process\_network\_ports

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent port\_info.get('updated', set()))

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/securitygroups\_rpc.py", line 302, in setup\_port\_filters

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.prepare\_devices\_filter(new\_devices)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/securitygroups\_rpc.py", line 159, in decorated\_function

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent \*args, \*\*kwargs)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/securitygroups\_rpc.py", line 185, in prepare\_devices\_filter

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent security\_groups, security\_group\_member\_ips)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/usr/lib/python2.7/contextlib.py", line 24, in \_\_exit\_\_

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.gen.next()

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/firewall.py", line 106, in defer\_apply

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.filter\_defer\_apply\_off()

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 671, in filter\_defer\_apply\_off

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.unfiltered\_ports)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 155, in \_setup\_chains\_apply

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_setup\_chain(port, INGRESS\_DIRECTION)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 182, in \_setup\_chain

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_add\_rules\_by\_security\_group(port, DIRECTION)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 423, in \_add\_rules\_by\_security\_group

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_update\_ipset\_members(remote\_sg\_ids)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 460, in \_update\_ipset\_m^C

vagrant@node1:~$

vagrant@node1:~$ tail /opt/stack/logs/q-agt.log

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent return f(\*args, \*\*kwargs)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 72, in set\_members

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_add\_members\_to\_set(set\_name, add\_ips)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 132, in \_add\_members\_to\_set

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_add\_member\_to\_set(set\_name, ip)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 84, in \_add\_member\_to\_set

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_apply(cmd)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 117, in \_apply

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.execute(cmd\_ns, run\_as\_root=True, process\_input=input)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/utils.py"

Workaround:

neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/1 ip\_address=128.0.0.0/1

See [original description](comments/0)

Tags:

[6.1-mu-1](/neutron/%2Bbugs?field.tag=6.1-mu-1)
[in-feature-pecan](/neutron/%2Bbugs?field.tag=in-feature-pecan)
[in-feature-qos](/neutron/%2Bbugs?field.tag=in-feature-qos)
[in-stable-kilo](/neutron/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2015-3221](/bugs/cve/2015-3221 "OpenStack Neutron before 2014.2.4 (ju...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-06-02: |  |  | [#1](/neutron/%2Bbug/1461054/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| **description**: | updated |
| --- | --- |
| Changed in ossa: | |
| **status**: | New → Incomplete |

[Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly)
on 2015-06-02

| **description**: | updated |
| --- | --- |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2015-06-02

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-06-02: |  |  | [#2](/neutron/%2Bbug/1461054/comments/2) |
| --- | --- | --- | --- |

I can confirm this gives users the power to break chunks of an openstack cloud. Basically, if the network where the port where the bogus address is called "x", every host with a port on network "x" will pretty much stop working, as they will be unable to boot VMs, apply security group updates, etc.

I can confirm this gives users the power to break chunks of an openstack cloud. Basically, if the network where the port where the bogus address is called "x", every host with a port on network "x" will pretty much stop working, as they will be unable to boot VMs, apply security group updates, etc.

| Changed in neutron: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-02: |  |  | [#3](/neutron/%2Bbug/1461054/comments/3) |
| --- | --- | --- | --- |

I'm going to see if I can work a quick patch to do some validation checking here, so assigning to myself at the moment.

I'm going to see if I can work a quick patch to do some validation checking here, so assigning to myself at the moment.

| Changed in neutron: | |
| --- | --- |
| **assignee**: | nobody → Kyle Mestery (mestery) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Armando Migliaccio (armando-migliaccio)](https://launchpad.net/~armando-migliaccio) wrote on 2015-06-02: |  |  | [#4](/neutron/%2Bbug/1461054/comments/4) |
| --- | --- | --- | --- |

What was the original intention by the author of this bug? Is adding 0.0.0.0/0 as allowed address fullfilling a genuine use case? Or was a 'malicious' input?

If the former case, validation aimed at preventing the input might not be desirable, and we need to delve into this further to come up with a suitable solution.

What was the original intention by the author of this bug? Is adding 0.0.0.0/0 as allowed address fullfilling a genuine use case? Or was a 'malicious' input?
If the former case, validation aimed at preventing the input might not be desirable, and we need to delve into this further to come up with a suitable solution.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-02: |  |  | [#5](/neutron/%2Bbug/1461054/comments/5) |
| --- | --- | --- | --- |

Armando, look at the description, it looks like it's invalid input per the ipset manpage:

This does not work - the ipset man page says that zero prefix size is not allowed for type hash:net.

Also here: <http://ipset.netfilter.org/ipset.man.html> (search for "Hash:Net").

Armando, look at the description, it looks like it's invalid input per the ipset manpage:
This does not work - the ipset man page says that zero prefix size is not allowed for type hash:net.
Also here: http://ipset.netfilter.org/ipset.man.html (search for "Hash:Net").

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-02: |  |  | [#6](/neutron/%2Bbug/1461054/comments/6) |
| --- | --- | --- | --- |

The use case is running a router in a VM. But the anti-spoofing will stop the router forwarding packets with source IP addresses not on the router ports or allowed address pairs. I'm using an openstack version that does not have the portsecurity extension.

A router is expected to forward IP packets from anywhere, so I tried to add all IPv4 address with a subnet with prefix length zero. The API allows subnets, so why not?

If you accept that 0.0.0.0/0 is valid for the API, then one solution would be to apply it behind the scenes as a special case using 2 ipset rules with prefix length one - 0.0.0.0/1 and 128.0.0.0/1. Otherwise we can just reject it at the API level, and users will still be able to allow all with

neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/1 ip\_address=128.0.0.0/1

The use case is running a router in a VM. But the anti-spoofing will stop the router forwarding packets with source IP addresses not on the router ports or allowed address pairs. I'm using an openstack version that does not have the portsecurity extension.
A router is expected to forward IP packets from anywhere, so I tried to add all IPv4 address with a subnet with prefix length zero. The API allows subnets, so why not?
If you accept that 0.0.0.0/0 is valid for the API, then one solution would be to apply it behind the scenes as a special case using 2 ipset rules with prefix length one - 0.0.0.0/1 and 128.0.0.0/1. Otherwise we can just reject it at the API level, and users will still be able to allow all with
neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/1 ip\_address=128.0.0.0/1

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Armando Migliaccio (armando-migliaccio)](https://launchpad.net/~armando-migliaccio) wrote on 2015-06-02: |  |  | [#7](/neutron/%2Bbug/1461054/comments/7) |
| --- | --- | --- | --- |

Cool, that's what I wanted to hear. Thanks Darragh!

Cool, that's what I wanted to hear. Thanks Darragh!

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-02

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#8](/neutron/%2Bbug/1461054/comments/8) |
| --- | --- | --- | --- |

I like that solution Darragh. I think we should allow 0.0.0.0/0 . I'm happy to implement this in the morning if you wanna pass it to me Kyle.

I like that solution Darragh. I think we should allow 0.0.0.0/0 . I'm happy to implement this in the morning if you wanna pass it to me Kyle.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-03: |  |  | [#9](/neutron/%2Bbug/1461054/comments/9) |
| --- | --- | --- | --- |

Thanks for volunteering Aaron! I was hoping to get some time to do this, but I failed miserably yesterday afternoon. I've assigned it to you now, I'll circle back tomorrow with you as well.

Thanks for volunteering Aaron! I was hoping to get some time to do this, but I failed miserably yesterday afternoon. I've assigned it to you now, I'll circle back tomorrow with you as well.

| Changed in neutron: | |
| --- | --- |
| **assignee**: | Kyle Mestery (mestery) → Aaron Rosen (arosen) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-03: |  |  | [#10](/neutron/%2Bbug/1461054/comments/10) |
| --- | --- | --- | --- |

It seems to affect Juno and Icehouse too

It seems to affect Juno and Icehouse too

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#11](/neutron/%2Bbug/1461054/comments/11) |
| --- | --- | --- | --- |

@Darragh O'Reilly, do you know off hand what the address work around would need to be for ipv6? It looks like ::/0 triggers the same issue.

@Darragh O'Reilly, do you know off hand what the address work around would need to be for ipv6? It looks like ::/0 triggers the same issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#12](/neutron/%2Bbug/1461054/comments/12) |
| --- | --- | --- | --- |

::/1' and '8000::/1' ?

::/1' and '8000::/1' ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#13](/neutron/%2Bbug/1461054/comments/13) |
| --- | --- | --- | --- |

* [fix\_ipset\_validation\_bug.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4409471/%2Bfiles/fix_ipset_validation_bug.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4409471)
  (4.9 KiB,
  text/plain)

Let me know what you guys think of this. I tested it and seems to do the trick.

Let me know what you guys think of this. I tested it and seems to do the trick.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#14](/neutron/%2Bbug/1461054/comments/14) |
| --- | --- | --- | --- |

I'll provide a backport Juno/icehouse after this gets a review.

I'll provide a backport Juno/icehouse after this gets a review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-04: |  |  | [#15](/neutron/%2Bbug/1461054/comments/15) |
| --- | --- | --- | --- |

Thanks for the quick turnaround Aaron! The workaround looks ok to me.

Thanks for the quick turnaround Aaron! The workaround looks ok to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-04: |  |  | [#16](/neutron/%2Bbug/1461054/comments/16) |
| --- | --- | --- | --- |

thanks Aaron. I'll give it a test run now.

thanks Aaron. I'll give it a test run now.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-04: |  |  | [#17](/neutron/%2Bbug/1461054/comments/17) |
| --- | --- | --- | --- |

\* All neutron setups are affected right ?

\* Darragh, your community profile says you're still working at HP, is this correct ?

Assuming yes at those two question, here is the impact description draft #1:

Title: Neutron L2 agent DoS through incorrect allowed address pairs

Reporter: Darragh O'Reilly (HP)

Products: Neutron

Affects: 2014.1 versions through 2014.1.4, and 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. All Neutron setups are affected.

\* All neutron setups are affected right ?
\* Darragh, your community profile says you're still working at HP, is this correct ?
Assuming yes at those two question, here is the impact description draft #1:
Title: Neutron L2 agent DoS through incorrect allowed address pairs
Reporter: Darragh O'Reilly (HP)
Products: Neutron
Affects: 2014.1 versions through 2014.1.4, and 2014.2 versions through 2014.2.3 and 2015.1.0 version
Description:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. All Neutron setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-04: |  |  | [#18](/neutron/%2Bbug/1461054/comments/18) |
| --- | --- | --- | --- |

Icehouse should not be affected by this, we introduced the ipset code in Juno. Thus, only 2014.2-2014.2.3 and 2015.1.0 are affected.

Icehouse should not be affected by this, we introduced the ipset code in Juno. Thus, only 2014.2-2014.2.3 and 2015.1.0 are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-04: |  |  | [#19](/neutron/%2Bbug/1461054/comments/19) |
| --- | --- | --- | --- |

Ok great, moreover Icehouse might be EOLed by the time we disclose this... So the Affect line should read:

Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Ok great, moreover Icehouse might be EOLed by the time we disclose this... So the Affect line should read:
Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-04: |  |  | [#20](/neutron/%2Bbug/1461054/comments/20) |
| --- | --- | --- | --- |

Tristan - yes I'm with HP.

I'm not usre if all Neutron setups are affected. Setups that use the IPTables firewall driver are. These include openvswitch, linuxbridge and ofagent agents - but there are probably others.

The patch works for me.

Tristan - yes I'm with HP.
I'm not usre if all Neutron setups are affected. Setups that use the IPTables firewall driver are. These include openvswitch, linuxbridge and ofagent agents - but there are probably others.
The patch works for me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-04: |  |  | [#21](/neutron/%2Bbug/1461054/comments/21) |
| --- | --- | --- | --- |

there is still a problem if you have prevent\_arp\_spoofing=True

2015-06-04 15:48:39.256 ERROR neutron.agent.common.ovs\_lib [req-ed50624a-0797-42d0-9494-35608d0e1ca9 None None] Unable to execute ['ovs-ofctl', 'add-flows', 'br-int', '-']. Exception:

Command: ['ovs-ofctl', 'add-flows', 'br-int', '-']

Exit code: 1

Stdin: hard\_timeout=0,idle\_timeout=0,priority=2,arp,arp\_spa=0.0.0.0/0,table=24,in\_port=9,actions=normal

Stdout:

Stderr: ovs-ofctl: -:1: 0.0.0.0/0: network prefix bits not between 1 and 32

there is still a problem if you have prevent\_arp\_spoofing=True
2015-06-04 15:48:39.256 ERROR neutron.agent.common.ovs\_lib [req-ed50624a-0797-42d0-9494-35608d0e1ca9 None None] Unable to execute ['ovs-ofctl', 'add-flows', 'br-int', '-']. Exception:
Command: ['ovs-ofctl', 'add-flows', 'br-int', '-']
Exit code: 1
Stdin: hard\_timeout=0,idle\_timeout=0,priority=2,arp,arp\_spa=0.0.0.0/0,table=24,in\_port=9,actions=normal
Stdout:
Stderr: ovs-ofctl: -:1: 0.0.0.0/0: network prefix bits not between 1 and 32

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Armando Migliaccio (armando-migliaccio)](https://launchpad.net/~armando-migliaccio) wrote on 2015-06-04: |  |  | [#22](/neutron/%2Bbug/1461054/comments/22) |
| --- | --- | --- | --- |

Might be a silly question, but is it sensible to have a device with 0.0.0.0/0 and at the same time have arp spoofing on?

Might be a silly question, but is it sensible to have a device with 0.0.0.0/0 and at the same time have arp spoofing on?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-04: |  |  | [#23](/neutron/%2Bbug/1461054/comments/23) |
| --- | --- | --- | --- |

Yup, I noticed that same issue. I actually pinged Kevin (he wrote the arp flow above) on it and he said it's not a problem. He has a patch to fix the error from installing the flow with 0.0.0.0.0/0 though was going to wait to push it to prevent from exposing this bug to other people who may notice it. Currently the code ignores errors raised there so it's just showing an error in the log but it doesn't matter

Yup, I noticed that same issue. I actually pinged Kevin (he wrote the arp flow above) on it and he said it's not a problem. He has a patch to fix the error from installing the flow with 0.0.0.0.0/0 though was going to wait to push it to prevent from exposing this bug to other people who may notice it. Currently the code ignores errors raised there so it's just showing an error in the log but it doesn't matter

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-04: |  |  | [#24](/neutron/%2Bbug/1461054/comments/24) |
| --- | --- | --- | --- |

Can someone subscribe Kevin to this bug and ask him to attach his patch here ?

Can someone subscribe Kevin to this bug and ask him to attach his patch here ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-04: |  |  | [#25](/neutron/%2Bbug/1461054/comments/25) |
| --- | --- | --- | --- |

Subscribed Kevin. Kevin, can you attach the patch Aaron is referencing in comment #23?

Subscribed Kevin. Kevin, can you attach the patch Aaron is referencing in comment #23?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-06-04: |  |  | [#26](/neutron/%2Bbug/1461054/comments/26) |
| --- | --- | --- | --- |

Yeah, the patch I have isn't necessary for the security fix. It just fails to setup arp spoofing protection for the tenant but that's exactly what 0.0.0.0/0 in an allowed address pair does. It just prevents log noise.

Yeah, the patch I have isn't necessary for the security fix. It just fails to setup arp spoofing protection for the tenant but that's exactly what 0.0.0.0/0 in an allowed address pair does. It just prevents log noise.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-06-04: |  |  | [#27](/neutron/%2Bbug/1461054/comments/27) |
| --- | --- | --- | --- |

* [arp00000patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410106/%2Bfiles/arp00000patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410106)
  (2.2 KiB,
  text/plain)

Here is the patch, but I was planning on just uploading it after the fix for this vulnerability goes in.

Here is the patch, but I was planning on just uploading it after the fix for this vulnerability goes in.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-05: |  |  | [#28](/neutron/%2Bbug/1461054/comments/28) |
| --- | --- | --- | --- |

okay, I guess it's best to keep the patch for vulnerability small, and the arp patch can be done separately.

okay, I guess it's best to keep the patch for vulnerability small, and the arp patch can be done separately.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-05: |  |  | [#29](/neutron/%2Bbug/1461054/comments/29) |
| --- | --- | --- | --- |

Thanks Kevin, so considering the arp00000.patch fix something that is already broken, this can surely be proposed separately after the vulnerability patch is merged.

Arosen, do you think the backport is going to be difficult ?

Here is an updated impact description:

Title: Neutron L2 agent DoS through incorrect allowed address pairs

Reporter: Darragh O'Reilly (HP)

Products: Neutron

Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

Thanks Kevin, so considering the arp00000.patch fix something that is already broken, this can surely be proposed separately after the vulnerability patch is merged.
Arosen, do you think the backport is going to be difficult ?
Here is an updated impact description:
Title: Neutron L2 agent DoS through incorrect allowed address pairs
Reporter: Darragh O'Reilly (HP)
Products: Neutron
Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version
Description:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-06: |  |  | [#30](/neutron/%2Bbug/1461054/comments/30) |
| --- | --- | --- | --- |

@Tristan, Here's the backport for kilo. There was a small conflict but it's good.

@Tristan, Here's the backport for kilo. There was a small conflict but it's good.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-06: |  |  | [#31](/neutron/%2Bbug/1461054/comments/31) |
| --- | --- | --- | --- |

* [fix\_ipset\_validation\_bug\_kilo.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410605/%2Bfiles/fix_ipset_validation_bug_kilo.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410605)
  (5.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-06-08: |  |  | [#32](/neutron/%2Bbug/1461054/comments/32) |
| --- | --- | --- | --- |

Should be "By adding an invalid allowed address pair" (not "pairs"). Also the term "invalid" seems vague here without identifying what's qualifying that validity. Clearly the Neutron API thinks a 0-length mask is valid (until this bug is fixed), but ipset does not. How about something like "By adding an address pair which is rejected as invalid by the ipset tool, ..."?

Should be "By adding an invalid allowed address pair" (not "pairs"). Also the term "invalid" seems vague here without identifying what's qualifying that validity. Clearly the Neutron API thinks a 0-length mask is valid (until this bug is fixed), but ipset does not. How about something like "By adding an address pair which is rejected as invalid by the ipset tool, ..."?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-08: |  |  | [#33](/neutron/%2Bbug/1461054/comments/33) |
| --- | --- | --- | --- |

Jeremy good point. How about:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding a valid allowed address pairs of 0.0.0.0/0, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. This is cause by the ipset tool rejecting the input of 0.0.0.0/0.

Jeremy good point. How about:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding a valid allowed address pairs of 0.0.0.0/0, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. This is cause by the ipset tool rejecting the input of 0.0.0.0/0.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-08: |  |  | [#34](/neutron/%2Bbug/1461054/comments/34) |
| --- | --- | --- | --- |

Thanks for the review, we'll use Jeremy proposal in order to keep the technical details low in the description.

Can someone add series tasks for Neutron Kilo and Juno please ?

Title: Neutron L2 agent DoS through incorrect allowed address pairs

Reporter: Darragh O'Reilly (HP)

Products: Neutron

Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an address pair which is rejected as invalid by the ipset tool, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

Thanks for the review, we'll use Jeremy proposal in order to keep the technical details low in the description.
Can someone add series tasks for Neutron Kilo and Juno please ?
Title: Neutron L2 agent DoS through incorrect allowed address pairs
Reporter: Darragh O'Reilly (HP)
Products: Neutron
Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version
Description:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an address pair which is rejected as invalid by the ipset tool, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-06-08: |  |  | [#35](/neutron/%2Bbug/1461054/comments/35) |
| --- | --- | --- | --- |

The updated impact description in comment #34 looks good to me. Thanks!

The updated impact description in comment #34 looks good to me. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-08: |  |  | [#36](/neutron/%2Bbug/1461054/comments/36) |
| --- | --- | --- | --- |

Doh, I didn't did do it for juno. In juno the ipset manager was part of the iptables\_firewall diver :( . Looking now to see how hard this is going to be.

Doh, I didn't did do it for juno. In juno the ipset manager was part of the iptables\_firewall diver :( . Looking now to see how hard this is going to be.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-09: |  |  | [#37](/neutron/%2Bbug/1461054/comments/37) |
| --- | --- | --- | --- |

Added Juno and Kilo series.

Added Juno and Kilo series.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-09: |  |  | [#38](/neutron/%2Bbug/1461054/comments/38) |
| --- | --- | --- | --- |

I spend a few hours on the juno backport of this patch. Unfortunately in juno the ipset manager is combined in with the iptables manager and I'll need to put the check in several places (and refactor the tests back in). It will probably take me 4 more hours or so to fix this and test the code with juno. I don't have the time to do that today though.

Do you guys think it would be okay to change the default option in juno to disable ipsets and to log a warning message if someone has them enabled?

I spend a few hours on the juno backport of this patch. Unfortunately in juno the ipset manager is combined in with the iptables manager and I'll need to put the check in several places (and refactor the tests back in). It will probably take me 4 more hours or so to fix this and test the code with juno. I don't have the time to do that today though.
Do you guys think it would be okay to change the default option in juno to disable ipsets and to log a warning message if someone has them enabled?

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-09

| Changed in ossa: | |
| --- | --- |
| **status**: | Triaged → In Progress |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-09: |  |  | [#39](/neutron/%2Bbug/1461054/comments/39) |
| --- | --- | --- | --- |

* [juno-reject-prefix-zero.diff](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4412213/%2Bfiles/juno-reject-prefix-zero.diff)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4412213)
  (1.1 KiB,
  text/plain)

Aaron - how about rejecting /0 in Juno?

Aaron - how about rejecting /0 in Juno?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-09: |  |  | [#40](/neutron/%2Bbug/1461054/comments/40) |
| --- | --- | --- | --- |

That works for me. Though we'll also have to tell people that they need to delete any 0.0.0.0/0 rules they already have installed.

That works for me. Though we'll also have to tell people that they need to delete any 0.0.0.0/0 rules they already have installed.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-10

| **summary**: | Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent+ (CVE-2015-3221) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-10:  [**Re: Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent (CVE-2015-3221)**](/neutron/%2Bbug/1461054/comments/41) |  |  | [#41](/neutron/%2Bbug/1461054/comments/41) |
| --- | --- | --- | --- |

Aaron, do you mean that Juno user could have such 0/0 addr pair without breaking their L2 agent ?

About the patch, would 0.0.0.0/00 bypass the check and still break ipset ?

Also, please include a commit message and use git format-patch for attached fix here.

Aaron, do you mean that Juno user could have such 0/0 addr pair without breaking their L2 agent ?
About the patch, would 0.0.0.0/00 bypass the check and still break ipset ?
Also, please include a commit message and use git format-patch for attached fix here.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-10: |  |  | [#42](/neutron/%2Bbug/1461054/comments/42) |
| --- | --- | --- | --- |

Will do,

I just want to make sure that is an acceptable fix for anyone running juno. The proposed solution is to prevent the address pair 0.0.0.0/0 from being installed in juno and reject it at the api layer. If we do this one still has to delete any 0.0.0.0/0 rules that have been installed. Alternatively, we could also say do not use the ipset driver in juno and use the iptables one. What do you guys think?

Will do,
I just want to make sure that is an acceptable fix for anyone running juno. The proposed solution is to prevent the address pair 0.0.0.0/0 from being installed in juno and reject it at the api layer. If we do this one still has to delete any 0.0.0.0/0 rules that have been installed. Alternatively, we could also say do not use the ipset driver in juno and use the iptables one. What do you guys think?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-06-11: |  |  | [#43](/neutron/%2Bbug/1461054/comments/43) |
| --- | --- | --- | --- |

I think saying not to use ipset is risky if someone misses the notice. I'm for the simple block at the API layer. Maybe we can publish a small SQL query with the release to run to clear out any 0.0.0.0/0 entries?

I think saying not to use ipset is risky if someone misses the notice. I'm for the simple block at the API layer. Maybe we can publish a small SQL query with the release to run to clear out any 0.0.0.0/0 entries?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#44](/neutron/%2Bbug/1461054/comments/44) |
| --- | --- | --- | --- |

K,

Okay I'll push a patch based on Darragh's tomorrow to do this for just juno. I think it's better to delete the address pairs that are /0 via the neutron api directly rather than targeting the db directly.

K,
Okay I'll push a patch based on Darragh's tomorrow to do this for just juno. I think it's better to delete the address pairs that are /0 via the neutron api directly rather than targeting the db directly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-11: |  |  | [#45](/neutron/%2Bbug/1461054/comments/45) |
| --- | --- | --- | --- |

Tristan, yes, a user can have a port with an allowed address pair with ip\_address ending in /0 without breaking the L2 agent, if none of the port's security groups have their remote\_group\_id set. If a user has a port like this, and a patch to block new /0 address pairs is applied, the user could still break the agent by changing the port's security groups.

I'm not sure about deleting them - this could affect users. Maybe we could supply a python script for operators that would search for ports with /0 and update them with 2x /1 ?

Tristan, yes, a user can have a port with an allowed address pair with ip\_address ending in /0 without breaking the L2 agent, if none of the port's security groups have their remote\_group\_id set. If a user has a port like this, and a patch to block new /0 address pairs is applied, the user could still break the agent by changing the port's security groups.
I'm not sure about deleting them - this could affect users. Maybe we could supply a python script for operators that would search for ports with /0 and update them with 2x /1 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-11: |  |  | [#46](/neutron/%2Bbug/1461054/comments/46) |
| --- | --- | --- | --- |

I like the idea of having a clean-up script, could it be part of the patch, and put it in neutron/tools ?

For Juno, the risk is to break a previously valid workflow. I can't tell if using /0 address pair on a port without its security\_group's remote\_group\_id set is a realistic use-case. Maybe a good documentation note for Juno user is acceptable, thought ?

I like the idea of having a clean-up script, could it be part of the patch, and put it in neutron/tools ?
For Juno, the risk is to break a previously valid workflow. I can't tell if using /0 address pair on a port without its security\_group's remote\_group\_id set is a realistic use-case. Maybe a good documentation note for Juno user is acceptable, thought ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-11: |  |  | [#47](/neutron/%2Bbug/1461054/comments/47) |
| --- | --- | --- | --- |

Can someone confirm Juno is really affected ?

Trying to investigate if a fix in \_validate\_allowed\_address\_pairs would work, I realize the bug does not reproduce in my devstack setup.

In q-agt log, there is the TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent Stderr: 'ipset v6.20.1: The value of the CIDR parameter of the IP address is invalid\n'

but instance connectivity is not impacted.

Can someone confirm Juno is really affected ?
Trying to investigate if a fix in \_validate\_allowed\_address\_pairs would work, I realize the bug does not reproduce in my devstack setup.
In q-agt log, there is the TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent Stderr: 'ipset v6.20.1: The value of the CIDR parameter of the IP address is invalid\n'
but instance connectivity is not impacted.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#48](/neutron/%2Bbug/1461054/comments/48) |
| --- | --- | --- | --- |

Right but I think new instances you spin up won't get networking on that host ?

Right but I think new instances you spin up won't get networking on that host ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#49](/neutron/%2Bbug/1461054/comments/49) |
| --- | --- | --- | --- |

I'm setting up juno now to test and nail this down aas well.

I'm setting up juno now to test and nail this down aas well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#50](/neutron/%2Bbug/1461054/comments/50) |
| --- | --- | --- | --- |

Darragh O'Reilly (darragh-oreilly) so you're saying that your patch for juno isn't enough to prevent this?

Darragh O'Reilly (darragh-oreilly) so you're saying that your patch for juno isn't enough to prevent this?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#51](/neutron/%2Bbug/1461054/comments/51) |
| --- | --- | --- | --- |

* [zero\_length\_addressses\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413508/%2Bfiles/zero_length_addressses_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413508)
  (6.0 KiB,
  text/plain)

Okay, here's the patch for juno. What do you guys think? I provided a tool to update addresses that are 0.0.0.0/0 to the two address pairs.

Okay, here's the patch for juno. What do you guys think? I provided a tool to update addresses that are 0.0.0.0/0 to the two address pairs.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-11: |  |  | [#52](/neutron/%2Bbug/1461054/comments/52) |
| --- | --- | --- | --- |

Thanks Aaron, other than a typo in the name of the script, I'd say it looks good!

Thanks Aaron, other than a typo in the name of the script, I'd say it looks good!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#53](/neutron/%2Bbug/1461054/comments/53) |
| --- | --- | --- | --- |

* [fix\_for\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413521/%2Bfiles/fix_for_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413521)
  (6.0 KiB,
  text/plain)

Doh,

fixed.

Doh,
fixed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-12: |  |  | [#54](/neutron/%2Bbug/1461054/comments/54) |
| --- | --- | --- | --- |

The proposed patch for Juno doesn't catch 0.0.0.0/00...

Also, we are concerned about this behavior change for Juno, can the same patch logic be used within the validate function (e.g. deflate /0 address into two /1), wouldn't that work and be transparent for Juno users ?

The proposed patch for Juno doesn't catch 0.0.0.0/00...
Also, we are concerned about this behavior change for Juno, can the same patch logic be used within the validate function (e.g. deflate /0 address into two /1), wouldn't that work and be transparent for Juno users ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-15: |  |  | [#55](/neutron/%2Bbug/1461054/comments/55) |
| --- | --- | --- | --- |

Aaron - were you able to confirm that is a security issue with Juno? Tristan was not able to rcreate it. I don't have much time, but I can try Juno later.

Aaron - were you able to confirm that is a security issue with Juno? Tristan was not able to rcreate it. I don't have much time, but I can try Juno later.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#56](/neutron/%2Bbug/1461054/comments/56) |
| --- | --- | --- | --- |

@Tristan, the problem is that there are several places that need this deflate method in Juno. I think disabling /0 allowed address pairs is an okay hack to solve this security issue for juno. We can always a better fix later (though gerrit which will be easier to test). It does break an API workflow people could have previously been using, that said the dataplane slide of it would not have worked in juno because of this bug.

@Darragh - yes this issue exists in juno with the ip set driver.

@Tristan, the problem is that there are several places that need this deflate method in Juno. I think disabling /0 allowed address pairs is an okay hack to solve this security issue for juno. We can always a better fix later (though gerrit which will be easier to test). It does break an API workflow people could have previously been using, that said the dataplane slide of it would not have worked in juno because of this bug.
@Darragh - yes this issue exists in juno with the ip set driver.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#57](/neutron/%2Bbug/1461054/comments/57) |
| --- | --- | --- | --- |

* [fix\_for\_juno\_2.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4415238/%2Bfiles/fix_for_juno_2.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4415238)
  (6.3 KiB,
  text/plain)

Updated patchset to account for /00, I also added in the note about renabling /0 for juno once this lands upstream.

Updated patchset to account for /00, I also added in the note about renabling /0 for juno once this lands upstream.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-15: |  |  | [#58](/neutron/%2Bbug/1461054/comments/58) |
| --- | --- | --- | --- |

@neutron-coresec, please review proposed fix (comments #13 for Liberty, #31 Kilo and #57 for Juno).

For Juno, since this bug prevented to use the zero\_prefixed address pairs workflow correctly, I would say we can go with the proposed patch,

The note for affected Juno users would be: "Zero prefixed address pair are not accepted by the Juno API, users need to use 0.0.0.0/1 and 128.0.0.1/1 or ::/1' and '8000::/1. The fix\_zero\_length\_ip\_prefix.py tool can be used to clean ports that were mis-configured with a zero prefixed address"

@neutron-coresec, please review proposed fix (comments #13 for Liberty, #31 Kilo and #57 for Juno).
For Juno, since this bug prevented to use the zero\_prefixed address pairs workflow correctly, I would say we can go with the proposed patch,
The note for affected Juno users would be: "Zero prefixed address pair are not accepted by the Juno API, users need to use 0.0.0.0/1 and 128.0.0.1/1 or ::/1' and '8000::/1. The fix\_zero\_length\_ip\_prefix.py tool can be used to clean ports that were mis-configured with a zero prefixed address"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-15: |  |  | [#59](/neutron/%2Bbug/1461054/comments/59) |
| --- | --- | --- | --- |

Aaron - I can't seem to recreate the security issue with Juno. The l2-agent gives an error, but seems to work okay otherwise. I tried your juno patch and script and they worked for me.

Aaron - I can't seem to recreate the security issue with Juno. The l2-agent gives an error, but seems to work okay otherwise. I tried your juno patch and script and they worked for me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-15: |  |  | [#60](/neutron/%2Bbug/1461054/comments/60) |
| --- | --- | --- | --- |

FWIW, I couldn't reproduced it on Juno devstack with:

disable\_service n-net

enable\_service q-svc

enable\_service q-agt

enable\_service q-dhcp

enable\_service q-l3

enable\_service q-meta

enable\_service q-fwaas

Q\_SERVICE\_PLUGIN\_CLASSES=neutron.services.firewall.fwaas\_plugin.FirewallPlugin

Q\_USE\_SECGROUP=True

The ipset command do fails but it does not prevent new instances to boot nor impact previous instance connectivity.

FWIW, I couldn't reproduced it on Juno devstack with:
disable\_service n-net
enable\_service q-svc
enable\_service q-agt
enable\_service q-dhcp
enable\_service q-l3
enable\_service q-meta
enable\_service q-fwaas
Q\_SERVICE\_PLUGIN\_CLASSES=neutron.services.firewall.fwaas\_plugin.FirewallPlugin
Q\_USE\_SECGROUP=True
The ipset command do fails but it does not prevent new instances to boot nor impact previous instance connectivity.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#61](/neutron/%2Bbug/1461054/comments/61) |
| --- | --- | --- | --- |

@Tristan, what if you restart the l2-agent after you have the 0.0.0.0/0 rule installed?

@Tristan, what if you restart the l2-agent after you have the 0.0.0.0/0 rule installed?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#62](/neutron/%2Bbug/1461054/comments/62) |
| --- | --- | --- | --- |

It looks to me that, that is going to prevent the correct rules from getting initially pushed down again.

It looks to me that, that is going to prevent the correct rules from getting initially pushed down again.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#63](/neutron/%2Bbug/1461054/comments/63) |
| --- | --- | --- | --- |

trying to get my juno instance back up to verify as well.

trying to get my juno instance back up to verify as well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-15: |  |  | [#64](/neutron/%2Bbug/1461054/comments/64) |
| --- | --- | --- | --- |

When neutron-openvswitch-agent is restarted (q-agt devstack tab), it reprint the ipset trace, but it does not break like in Kilo. Though it may have other unnoticed effects...

When neutron-openvswitch-agent is restarted (q-agt devstack tab), it reprint the ipset trace, but it does not break like in Kilo. Though it may have other unnoticed effects...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#65](/neutron/%2Bbug/1461054/comments/65) |
| --- | --- | --- | --- |

@Tristan, unfortunately the bulk add of the rules won't get added correctly so the security rules won't correctly be applied anymore :(. New rules though are correctly applied but the ones needed before reset aren't. We'll need the juno patch as well to prevent this from occurring.

@Tristan, unfortunately the bulk add of the rules won't get added correctly so the security rules won't correctly be applied anymore :(. New rules though are correctly applied but the ones needed before reset aren't. We'll need the juno patch as well to prevent this from occurring.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-17: |  |  | [#66](/neutron/%2Bbug/1461054/comments/66) |
| --- | --- | --- | --- |

@Aaron, fair enough.

Since patch have been approved, here is the proposed public disclosure date/time:

2015-06-23, 1500UTC

@Aaron, fair enough.
Since patch have been approved, here is the proposed public disclosure date/time:
2015-06-23, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-17: |  |  | [#67](/neutron/%2Bbug/1461054/comments/67) |
| --- | --- | --- | --- |

Sounds good. Sorry for all the back and forth here!

Sounds good. Sorry for all the back and forth here!

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-18

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-23

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Fix proposed to neutron (stable/juno)**](/neutron/%2Bbug/1461054/comments/68) |  |  | [#68](/neutron/%2Bbug/1461054/comments/68) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/juno

Review: <https://review.openstack.org/194696>

Fix proposed to branch: stable/juno
Review: https://review.openstack.org/194696

| Changed in neutron: | |
| --- | --- |
| **assignee**: | Aaron Rosen (arosen) → Tristan Cacqueray (tristan-cacqueray) |
| **status**: | Confirmed → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Fix proposed to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/69) |  |  | [#69](/neutron/%2Bbug/1461054/comments/69) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/194697>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/194697

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-23

| **summary**: | - Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent- (CVE-2015-3221)+ [OSSA 2015-012] Adding 0.0.0.0/0 to allowed address pairs breaks l2+ agent (CVE-2015-3221) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Related fix proposed to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/70) |  |  | [#70](/neutron/%2Bbug/1461054/comments/70) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/194742>

Related fix proposed to branch: stable/kilo
Review: https://review.openstack.org/194742

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Fix merged to neutron (stable/juno)**](/neutron/%2Bbug/1461054/comments/71) |  |  | [#71](/neutron/%2Bbug/1461054/comments/71) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/194696>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=d9c78880d2b7e5b0544e821c45e6ad3700a06b9a>

Submitter: Jenkins

Branch: stable/juno

commit d9c78880d2b7e5b0544e821c45e6ad3700a06b9a

Author: Aaron Rosen <email address hidden>

Date: Thu Jun 11 13:58:16 2015 -0700

Disable allowed\_address\_pair ip 0.0.0.0/0 ::/0 for ipset

Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if

    these addresses were inputted as allowed address pairs. This causes

    ipset to raise an error as it does not work with zero prefix sizes.

    To solve this problem we use two ipset rules to represent this.

This was correctly fixed in a backport to kilo though we did not have the

    cycles to backport this exact fix to juno as in juno additional work needs to

    be done because the iptable and ipset code are interleaved together. This

    patch fixes this issue by disabling one from creating an address pair of

    zero lenght. This patch also provides a small tool which one should run:

    tools/fix\_zero\_length\_ip\_prefix.py which changes all zero length address\_pair

    rules into two address pair rules of:

Ipv4: 0.0.0.0/1 and 128.0.0.1/1

    IPv6: ::/1' and '8000::/1

to avoid the problem.

    After this patch is merged into juno it will be easier for us to apply

    a better change to allow /0 addresses again in juno.

Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75

    Closes-bug: 1461054

    Co-Authored-by: Darragh O'Reilly <email address hidden>

Reviewed: https://review.openstack.org/194696
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=d9c78880d2b7e5b0544e821c45e6ad3700a06b9a
Submitter: Jenkins
Branch: stable/juno
commit d9c78880d2b7e5b0544e821c45e6ad3700a06b9a
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Thu Jun 11 13:58:16 2015 -0700
Disable allowed\_address\_pair ip 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this.
This was correctly fixed in a backport to kilo though we did not have the
cycles to backport this exact fix to juno as in juno additional work needs to
be done because the iptable and ipset code are interleaved together. This
patch fixes this issue by disabling one from creating an address pair of
zero lenght. This patch also provides a small tool which one should run:
tools/fix\_zero\_length\_ip\_prefix.py which changes all zero length address\_pair
rules into two address pair rules of:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
to avoid the problem.
After this patch is merged into juno it will be easier for us to apply
a better change to allow /0 addresses again in juno.
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054
Co-Authored-by: Darragh O'Reilly <darragh.oreilly@hp.com>

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-24

| Changed in neutron: | |
| --- | --- |
| **assignee**: | Tristan Cacqueray (tristan-cacqueray) → Aaron Rosen (arosen) |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-25

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-25:  [**Change abandoned on neutron (master)**](/neutron/%2Bbug/1461054/comments/72) |  |  | [#72](/neutron/%2Bbug/1461054/comments/72) |
| --- | --- | --- | --- |

Change abandoned by Cedric Brandily (<email address hidden>) on branch: master

Review: <https://review.openstack.org/195228>

Change abandoned by Cedric Brandily (zzelle@gmail.com) on branch: master
Review: https://review.openstack.org/195228

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-26:  [**Related fix proposed to neutron (feature/qos)**](/neutron/%2Bbug/1461054/comments/73) |  |  | [#73](/neutron/%2Bbug/1461054/comments/73) |
| --- | --- | --- | --- |

Related fix proposed to branch: feature/qos

Review: <https://review.openstack.org/196097>

Related fix proposed to branch: feature/qos
Review: https://review.openstack.org/196097

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-26:  [**Related fix merged to neutron (feature/qos)**](/neutron/%2Bbug/1461054/comments/74) |  |  | [#74](/neutron/%2Bbug/1461054/comments/74) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1461054/comments/74/%2Bdownload) (93.9 KiB)

Reviewed: <https://review.openstack.org/196097>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=1cfed745d54a6ce9cb3dd4e6f454666d9e6676c2>

Submitter: Jenkins

Branch: feature/qos

commit ba7d673d1ddd5bfa5aa1be5b26a59e9a8cd78a9f

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:31:38 2015 -0700

Remove duplicated call to setup\_coreplugin

The test case for vlan\_transparent was calling setup\_coreplugin

    before calling the super setUp method which already calls

    setup\_coreplugin. This was causing duplicate core plugin fixtures

    which resulted in patching the dhcp periodic check twice.

Change-Id: Ide4efad42748e799d8e9c815480c8ffa94b27b38

    Partial-Bug: #1468998

commit e64062efa3b793f7c4ce4ab9e62918af4f1bfcc9

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:29:37 2015 -0700

Remove double mock of dhcp agent periodic check

The test case for the periodic check was patching a target

    that the core plugin fixture already patched out. This removes

    that and exposes the mock from the fixture so the test case

    can reference it.

Change-Id: I3adee6a875c497e070db4198567b52aa16b81ce8

    Partial-Bug: #1468998

commit 25ae0429a713143d42f626dd59ed4514ba25820c

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:24:10 2015 -0700

Remove double fanout mock

The test\_mech\_driver was duplicating a fanout mock already setup

    in the setUp routine.

Change-Id: I5b88dff13113d55c72241d3d5025791a76672ac2

    Partial-Bug: #1468998

commit 993771556332d9b6bbf7eb3f0300cf9d8a2cb464

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 17:55:16 2015 -0700

Remove double callback manager mocks

setup\_test\_registry\_instance() in the base test case class gives

    each test its own registry by mocking out the get\_callback\_manager.

    The L3 agent test cases were duplicating this.

Partial-Bug: #1468998

    Change-Id: I7356daa846524611e9f92365939e8ad15d1e1cd8

commit 0be1efad93734f11cd63fb3b7bd2983442ce1268

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 16:57:30 2015 -0700

Remove ensure\_dirs double-patch

test\_spawn\_radvd called mock.patch on ensure\_dirs after the

    setup method already patched it out. This causes issues when

    mock.patch.stopall() is called because the mocks are stored

    as a set and are unwound in a non-deterministic fashion.[1]

    So some of the time they will be undone correctly, but others

    will leave a monkey-patched in mock, causing the ensure\_dir

    test to fail.

1. <http://bugs.python.org/issue21239>

Closes-Bug: #1467908

    Change-Id: I321b5fed71dc73bd19b5099311c6f43640726cd4

commit 0a2238e34e72c17ca8a75e36b1f56e41a3ece74e

Author: Sukhdev Kapur <email address hidden>

Date: Thu Jun 25 15:11:28 2015 -0700

Fix tenant-id in Arista ML2 driver to support HA router

When HA router is created, the framework creates a network and does

    not specify the tenant-id. This casuse Arista ML2 driver to fail.

    This patch sets the tenant-id when it is not passed explicitly by

    by the network\_create() call from the HA r...

Reviewed: https://review.openstack.org/196097
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=1cfed745d54a6ce9cb3dd4e6f454666d9e6676c2
Submitter: Jenkins
Branch: feature/qos
commit ba7d673d1ddd5bfa5aa1be5b26a59e9a8cd78a9f
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:31:38 2015 -0700
Remove duplicated call to setup\_coreplugin
The test case for vlan\_transparent was calling setup\_coreplugin
before calling the super setUp method which already calls
setup\_coreplugin. This was causing duplicate core plugin fixtures
which resulted in patching the dhcp periodic check twice.
Change-Id: Ide4efad42748e799d8e9c815480c8ffa94b27b38
Partial-Bug: #1468998
commit e64062efa3b793f7c4ce4ab9e62918af4f1bfcc9
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:29:37 2015 -0700
Remove double mock of dhcp agent periodic check
The test case for the periodic check was patching a target
that the core plugin fixture already patched out. This removes
that and exposes the mock from the fixture so the test case
can reference it.
Change-Id: I3adee6a875c497e070db4198567b52aa16b81ce8
Partial-Bug: #1468998
commit 25ae0429a713143d42f626dd59ed4514ba25820c
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:24:10 2015 -0700
Remove double fanout mock
The test\_mech\_driver was duplicating a fanout mock already setup
in the setUp routine.
Change-Id: I5b88dff13113d55c72241d3d5025791a76672ac2
Partial-Bug: #1468998
commit 993771556332d9b6bbf7eb3f0300cf9d8a2cb464
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 17:55:16 2015 -0700
Remove double callback manager mocks
setup\_test\_registry\_instance() in the base test case class gives
each test its own registry by mocking out the get\_callback\_manager.
The L3 agent test cases were duplicating this.
Partial-Bug: #1468998
Change-Id: I7356daa846524611e9f92365939e8ad15d1e1cd8
commit 0be1efad93734f11cd63fb3b7bd2983442ce1268
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 16:57:30 2015 -0700
Remove ensure\_dirs double-patch
test\_spawn\_radvd called mock.patch on ensure\_dirs after the
setup method already patched it out. This causes issues when
mock.patch.stopall() is called because the mocks are stored
as a set and are unwound in a non-deterministic fashion.[1]
So some of the time they will be undone correctly, but others
will leave a monkey-patched in mock, causing the ensure\_dir
test to fail.
1. http://bugs.python.org/issue21239
Closes-Bug: #1467908
Change-Id: I321b5fed71dc73bd19b5099311c6f43640726cd4
commit 0a2238e34e72c17ca8a75e36b1f56e41a3ece74e
Author: Sukhdev Kapur <sukhdev@aristanetworks.com>
Date: Thu Jun 25 15:11:28 2015 -0700
Fix tenant-id in Arista ML2 driver to support HA router
When HA router is created, the framework creates a network and does
not specify the tenant-id. This casuse Arista ML2 driver to fail.
This patch sets the tenant-id when it is not passed explicitly by
by the network\_create() call from the HA router framework.
Even though original issue was discovered for network\_create()
it turns out the same issue applies for port\_create() as well
so all the methods are fixed in this patch
Change-Id: Id03e26dac003fa589477ed78a4ed3c44cc2f708d
Closes-Bug: 1468828
commit 334d9a33404f4c8438d105f91bff1a9fd9236513
Author: Assaf Muller <amuller@redhat.com>
Date: Thu Jun 25 16:34:09 2015 -0400
Log OVS agent configuration mismatch
Change-Id: I55aef3bdc32dcee3436cb8b987fb796a4898b20e
Closes-Bug: #1468893
commit c48e12b781c9ffd885ebc96283ecda2849fd1e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 21:31:33 2015 +0200
Avoid env variable duplication in tox.ini
Some environment variables are defined multiple times in tox.ini. This
change defines "fake" tox jobs and refactors existing jobs to reduce
duplicated environment variables.
Change-Id: I0ccebea4fbfff8dda34d1ed348b96b3b8ebd59e2
commit 747738d36572079307f228a861a067ca0cd815c2
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 15:20:27 2015 -0700
Skip ARP protection if 0.0.0.0/0 in addr pairs
Don't setup ARP protection on ports with allowed address pairs
that allow them to use any IP address. This is necessary because
OVS doesn't support the /0 prefix in rules that match on ARP headers.
Related-Bug: #1461054
Closes-Bug: #1468009
Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec
commit 61909ac515c337c94f55805641b1b7c725a95191
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:54:34 2015 +0200
linuxbridge: clean up README file
It's weird that we suggest users to copy python files around instead of
relying on generated console\_scripts.
Other configuration information located here is trivial and is
documented elsewhere, f.e. [1].
[1]: http://docs.openstack.org/networking-guide/deploy\_scenario1b.html
Change-Id: Ie8dd37087599ff4b5e23f0ad01105f94f5b886ab
commit 0af5abdb1f608a5e84a64627adf42dd8d5526560
Author: John Davidge <jodavidg@cisco.com>
Date: Thu Jun 25 15:12:59 2015 +0100
Fix tox errors in thirdparty-ci docs
Fixes errors causing tox failures.
Change-Id: I361ef791c0de1aac1304bb8ad979066400930434
Closes-Bug: #1468765
commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:41:02 2015 +0200
Removed test\_lib module
It's not really needed. It was once used to allow some out-of-tox plugin
specific testing scripts to inject configuration files into
BaseTestCase.
Now, our testing story does not have any notion of out-of-gate plugin
specific testing, so let's just clean it up.
Change-Id: If287a38e80016b1dba049a2b745bad7af40583a8
commit 2557c47668ad822810aad523643014c6a5d4a064
Author: Russell Bryant <rbryant@redhat.com>
Date: Wed Jun 24 14:59:26 2015 -0400
Updated from global requirements
This patch takes the latest global requirements update from change
Ibcb49412a012f79be2f7fd697349ddbf43bd7b9b except takes out the update
to setup.py which reverts the windows specific requirements. We are
still working on getting the custom changes out of setup.py in change
I3c07c279d33f6aed46c3a97dd9ba81251e51429a.
Change-Id: Iee7612d39b520cf04e3b2ec503ec79d23f15f949
commit 2ecac909ba419f258e47b456196a1af7a87661ed
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu Jun 25 11:59:37 2015 +0000
Remove quantum untracked files from .gitignore
This change removes obsolete quantum untracked files from .gitignore.
Change-Id: I1ddf0b03d29066363f155dd5af8294efde5b0ef0
commit df06a326de39a6792e2e82eafa5cf50eb325b34e
Author: Matthew Booth <mbooth@redhat.com>
Date: Thu Jun 25 10:20:08 2015 +0100
Context class should initialise its own data
This is a trivial cleanup. A superclass was initialising data which
was only used in a subclass.
Change-Id: I6930fdaef3dcb960f6baaedbd191e22b565f319e
commit 2e1b0ea4032f05afef16efd451e2eea5df901d97
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 17:33:38 2015 +0200
ovsdb: attempt to enable connection\_uri for native impl on startup
The port is in most cases disabled, so to use it, we should first enable
it, and it means that we should still rely on ovs-vsctl for that initial
call.
Closes-Bug: #1468259
Change-Id: I097b1c441df1f7f1785b8744f27809617bb21c14
commit 668b12c2c8a60ce20ecdad2193ede9371d5cc391
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:58:41 2015 -0600
Move third-party CI policy under docs/policies
Change-Id: Ib2ed587670f206283d735191b3a2580bf3d1a04f
commit 3bf62772d39d8b3b8b518ae88a6fcea7414d6884
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:31:01 2015 -0600
Remove lbaas API tests, which are now in the lbaas repo
Change-Id: I2009ca3f102d0ca0db3f12af3012989f2a036c48
commit 1a480203b2531925d7520b62c94954064a26139d
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 24 10:28:18 2015 -0700
Only create one netaddr.IPNetwork object
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c663b8ac73
commit d9a23f882f0d78aaca34c3607d9ca9ad54ac063b
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 3 16:19:39 2015 -0700
Provide work around for 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager
which is called to convert the input.
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054
commit 93d564223e8b76d10aa7b55f1b1d49f592d1c800
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 09:19:18 2015 -0700
Fix >80 char lines that pep8 failed to detect
Change-Id: I602e0d484c5e00eb48b86c4c8c4eff0be195c3a5
commit 830e9114817765efc93c772dcbc735a6bb28a7ff
Author: Anthony Chow <vCloudernBeer@gmail.com>
Date: Tue Jun 23 22:05:23 2015 -0700
Deprecate "router\_delete\_namespaces" and "dhcp\_delete\_namespaces"
These 2 configuration options are no longer be necessary.
They are marked as deprecated in this release and will be removed in the
next release.
Change-Id: I4e02a291738b16c7c9b7600f0bc9a47fb1318569
Partial-Bug: #1418079
commit a84ef9ae54a7dfe6d9dee54a01b189dd40bce423
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 03:27:16 2015 -0700
Make DHCPv6 out of bounds API test deterministic
The test\_dhcp\_stateful\_fixedips\_outrange API test was randomly
picking an IP from last + 1 up to last + 10 in the allocation
range. This made it fail randomly when there was an issue related
to the subnet allocation having an off-by-one issue.
This adjusts the test to just always test last +1 and +2.
Related-Bug: #1468163
Change-Id: I641ab092e0ea0aae67ec717b492118a2f8a6f4fd
commit f527f8cf426ee63b592225d5e691ac107085784d
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 02:15:29 2015 -0700
Don't process network\_delete events on OVS agent
There is no reason to reclaim the local VLAN on a network\_delete
event since it will be reclaimed when the last port is deleted anyway.
This method was racey with recent port creation events and lead to
occasional traces when it would yank the local VLAN out from underneath
an ongoing port wiring process.
Change-Id: I5eee6175c053006b35b6efe274d27931a9d5d89f
Closes-Bug: #1468251
commit 1d61c5f736b9df7253a1939fe55f1875f988d1f4
Author: Henry Gessau <gessau@cisco.com>
Date: Wed Jun 24 03:16:52 2015 +0000
Revert "Fix subnet creation failure on IPv6 valid gateway"
Because it breaks tests.api.test\_dhcp\_ipv6.NetworksTestDHCPv6.test\_dhcp\_stateful\_fixedips\_outrange
This reverts commit ee51ef72d37a02005a7733b7f2faf7236db850a1.
Change-Id: Id02d9034ca809f194ff7551167bfda3559fb1200
commit 7eb9d9d316d35840706a767576ff083c9a04d781
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 00:08:22 2015 +0200
Support oslo\_db 1.12
oslo\_db 1.12[1] decorates oslo\_context.context.RequestContext with
session management[2][3] and add a read-only attribute 'session'. Such
feature breaks Brocade plugin and its unittests because they define
on RequestContext the 'session' attribute which now is a read-only
property. This change uses neutron.context instead of
oslo\_context.context in order to delegate session management to the
neutron.context and remove read-only attribute set.
A follow-up change will refactor neutron.context in order to use oslo\_db
1.12 session management instead of homemade one.
[1] https://github.com/openstack/oslo.db/releases/tag/1.12.0
[2] https://github.com/openstack/oslo.db/commit/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6
[3] https://github.com/openstack/oslo.db/blob/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6/oslo\_db/sqlalchemy/\
enginefacade.py#L782
Closes-Bug: #1468128
Change-Id: I0e3331f9a383fa2562706eeadb229f55593b888c
commit ad86291408fc74827c2bd31f89a2dce34f887823
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 23 15:28:34 2015 +0000
Python 3: do not use itertools.izip
This no longer exists in Python 3. Use the zip function instead.
Blueprint: neutron-python3
Change-Id: Id7d33ec3d27a27f17040d28bead10f2eb3b831bb
commit d23a59f1c808c50575f49f9291bd70c6b3a5797a
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Thu Jun 18 19:09:05 2015 +0000
Override opportunistic database tests to PyMySQL
Set the OS\_TEST\_DBAPI\_ADMIN\_CONNECTION override variable so that
oslo.db opportunistic detection will know to use PyMySQL until
I12b32dc097a121bd43991bc38dd4d289b65e86c1 makes it the default
behavior.
This change removes previous code[1] enabling PyMySQL use.
[1] Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
Change-Id: Ic39feee0248f2ffabdba26f3779ab40a8f3838e6
Co-Authored-By: Victor Sergeyev <vsergeyev@mirantis.com>
Co-Authored-By: Cedric Brandily <zzelle@gmail.com>
commit 04d44cee63f3fbba45956abd28f325d5ac3ca2d9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 23 20:00:30 2015 +0200
Extend default setenv instead of replacing it in tox.ini
Some tox jobs[1] define their own setenv without extending/referencing
default setenv, it disallows to define environment variables shared by
all jobs. This change updates previous jobs[1] in order to extend
instead of replacing default setenv and enable global environement
variables (used in daughter change).
One remark, this change sets VIRTUAL\_ENV environment variable in updated
jobs[1] but it has no effect on them.
[1] (dsvm-)functional, (dsvm-)fullstack and api jobs
Closes-Bug: #1468059
Change-Id: I99184f7375571fb8569a24ba04ae267108f5da08
commit b7dc34ef15061577158eeafc179915e5bde73c64
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 14:28:59 2015 +0200
Cleanup get\_plugin\_name() from the tree
It does not seem to be used since Icehouse: the patch that removed its
last usage is: 1b36e2077141749495bb32b423f3df8cbbd0eb40
I don't think we should have it as part of abstract interface for
service plugins.
Change-Id: If03f67a617efd3a7cadb96d1a86283ac14088a83
commit 277d89b67a6a8ea4f6a7bc216014d55ace5c1d2d
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Tue Jun 23 12:07:43 2015 +0300
Bulk move methods to ipam\_backend\_mixin.py
ipam\_backend\_mixin contains methods common for both backends:
pluggable and non-pluggable, so moving methods to make them accessible
by backends.
Next methods were moved from db\_base\_plugin\_v2.py to
ipam\_backend\_mixin.py:
- \_validate\_subnet\_cidr
- \_validate\_network\_subnetpools
- \_allocate\_pools\_for\_subnet
- \_save\_subnet
This commit moves methods without any internal changes.
All future changes and decomposition of these methods will be handled in
next commits.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1ec786754467fc9039d2276f084f1bceaab15635
commit c384b13ae6b83a8bad944972c60bdcbe6f4fa050
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Apr 16 16:20:01 2015 -0400
Add IPset cleanup script
This will aid in removing stale IPsets when we change the prefix
used in creating IPset names.
Change-Id: Ia9ff79c34bd4c9124ec8663a8f616ded4f389f62
Partial-Bug: #1444201
commit 7e117c13fd3fb125c857dadfa2945799b39e1634
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Thu Jun 18 11:22:13 2015 -0600
Optimize ipset usage in IptablesFirewallDriver
Currently, IptablesFirewallDriver.\_update\_ipset\_members() iterates
through a list of security group IDs and makes a call to
IpsetManager.set\_members() for each security group ID in the list. The
problem is that set\_members() is repeatedly called with the same
arguments over and over again because the list of security group IDs
contains duplicates. These duplicated calls are unnecessary because they
are idempotent.
For instance, with a security group of 50 rules created in this manner:
neutron security-group-rule-create $SECGRP --remote\_group\_id $SECGRP
--protocol tcp --port\_range\_min $i --port\_range\_max $i
Adding a server to that security group will cause 50 calls to
IpsetManager.set\_members() because the list of security group IDs is 50 of
the same ID. Only one call to IpsetManager.set\_members() is necessary
per security group ID.
This patch converts that list of security group IDs into a set, which
eliminates the duplicate idempotent calls to
IpsetManager.set\_members() with the same arguments. This will affect
performance by reducing the amount of file locking around ipset when
adding servers to security groups.
Change-Id: Id2c8c8c1093c8abcf1fd897b23b0358aeb55b526
Closes-Bug: 1466921
commit f44800f1eb649d83a338d320020d3479fc3b6790
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 22 14:59:59 2015 +0000
Python3: do not set Request.body to a text string
In Python 3, Request.body must be set to a bytes object.
Change-Id: I17785d1e9eb253a1c6cae300b207fb0a08873b0e
Blueprint: neutron-python3
commit 408af3f7dab477517b1761aeda2b76384f5fffbe
Author: Assaf Muller <amuller@redhat.com>
Date: Sun Jun 21 15:34:21 2015 -0400
Prepare for full stack CI job
Related-Bug: #1467275
Change-Id: I90f4794f48ae151a888f37df26c087a7fdcd9d31
commit 76b4803530c0d5f47659aa519585178cc33cba46
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Tue Jun 2 16:14:40 2015 +0300
Fix callback registry notification for security group rule
Some housekeeping was done in
- SecurityGroupDbMixin:
- create\_rule\_bulk() calls to create\_rule();
- registry notification is in create\_rule();
- separate validation for a single rule and for a group of rules
- SecurityGroupServerRpcMixin:
- overriden methods call to corresponding super class methods;
Hopefully code is now self-documented enough
Closes-Bug: #1461024
Change-Id: Ia75d7e206716bbe74aae89e4cebd0c2c40af68a8
commit 6da2d24ff44cbc8dd0ea8d2e6f72419a46026989
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 22 15:43:20 2015 +0200
Ease debugging alembic by passing proper scripts path in alembic.ini
Otherwise, anyone who attempts to issue an alembic command with the file
gets:
FAILED: Path doesn't exist:
'<...>/neutron/neutron/db/migration/alembic'. Please use the 'init'
command to create a new scripts folder.
Change-Id: I5b5f2802b478c8d8c327d24faa838f7a6859b979
commit fe6654b25044de7d7d15573c689a0f003c018e99
Author: Martin Roy <mroy@iweb.com>
Date: Thu Jun 18 13:45:02 2015 -0400
Use string exception casting everywhere
Instead of the deprecated "message" member access,
casting to a string invokes the \_\_str\_\_ method of the exception
that is wired to return the message
Added a test of the failure cases of IpRouteCommand::delete\_gateway
because they were missing
Running unit and functional tests locally no longer shows the warning
reported in the bug.
Change-Id: Ia79f526aa973ece1145615d65349f860aa3fd465
Closes-Bug: #1466542
commit c3d65a0ed920110223e1b73d6982968552ca7716
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Tue Mar 3 17:08:48 2015 +0800
Switch to oslo\_utils.uuidutils
Get rid of oslo-incubator uuidutils
Closes-Bug: #1467020
Depends-On: I2df519965883b05d5d58cdc4785c850b0685dc2c
Depends-On: I9f8e98ad9517864a9ffdacf01c0a9a5aab554edb
Depends-On: Ied0faac809a5b72b1cd466c8babc9ca5418692c3
Change-Id: Iebe491b981b4b7c02785412fadd27678bb5e47de
commit ee51ef72d37a02005a7733b7f2faf7236db850a1
Author: David Edery <david.edery@alcatel-lucent.com>
Date: Sun Jun 21 15:59:49 2015 +0300
Fix subnet creation failure on IPv6 valid gateway
Currently a valid IPv6 address gateway of the "\*::ffff:ffff:ffff:ffff"
pattern is failing due to netaddr.broadcast returning value for both IPv6
and IPv4 addresses. IPv6 has no broadcast address so the fix checks if
the gateway is the subnet broadcast address only in the case of IPv4
subnet
Change-Id: I849f95b30343d0b1c90cf91203df220bf731d8d5
Closes-Bug: 1466322
commit b9e551936410eca647b48c48f49f2b2be5d2d4a4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Fri Jun 19 17:58:57 2015 +0300
Decompose \_create\_subnet\_from\_pool
Moved validations into separate methods:
- \_validate\_pools\_with\_subnetpool
Verifies that allocation pools are set only for specific subnet request.
For any subnet request allocation pools can not be set manually
- \_validate\_ip\_version\_with\_subnetpool
Verifies that subnet has the same ip version as subnet pool
Partially-Implements: blueprint neutron-ipam
Change-Id: I63f6aa2a0c94c3437fa624ac800943976f4fc50f
commit 29bb401973af81f4a4b8a667f8b7445e19e017da
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 15:24:44 2015 +0300
Move \_delete\_port
Pluggable ipam implementation will do additional actions on port
deletion (deallocate ip using ipam driver).
Existing \_delete\_port code will be resused.
Moving \_delete\_port to ipam\_backend\_mixin to make this code
accessible and extendable by both backends (pluggable and non
pluggable).
This commit is a preparation step before pluggable ipam implementation
can be used.
Partially-Implements: blueprint neutron-ipam
Change-Id: If6cd623aad9e5501a26e5fb8cdecd5f55e85cd05
commit c0ef7a8f4546cd3c081a61c742dd9ed70ec2c147
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:52:24 2015 +0300
Decompose create\_port and save\_subnet
This commit is a preparation step for enabling pluggable ipam.
Some actions in create\_port and save\_subnet are specific for
non pluggable ipam implementation.
- create\_port
Moved allocation ips for port and storing results into separate method
\_allocate\_ips\_for\_port\_and\_store.
Moved to ipam\_non\_pluggable\_backend, since pluggable implementation will
be different due to rollback on failure logic included.
- save\_subnet
Moved saving allocation pools into new method \_save\_allocation\_pools.
Moved to ipam\_non\_pluggable\_backend, since pluggable ipam implementation
does not need to save IPAvailabilityRange (availability ranges are
maintained by ipam driver for pluggable case)
Partially-Implements: blueprint neutron-ipam
Change-Id: I4a3e5d7f3aa54630279d9589225a509c96ed2186
commit ee14186fbb2486f9088103e9621bc366cc64c552
Author: Henry Gessau <gessau@cisco.com>
Date: Sun Jun 21 01:30:05 2015 -0400
Allow setting Agents description to None
Fix the validator for the 'description' attribute of Agents, allowing
it to be set to None.
Fix an API test that had two problems:
1. It was not restoring the description to the agent it had updated
2. It was retoring the description to '' instead of None.
Closes-Bug: #1466642
Change-Id: I50723e1346be0953d26216ba24907bac008ccfb6
commit d0d62927e661c84003845a61d2b991a54e723ed4
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Sat Jun 20 11:55:27 2015 +0000
Fix RPC version to be a string
The RPC version was being passed as a float which caused an
exception.
Change-Id: I2a2888fcafcc426009fc841b81049a22e072ce75
Closes-Bug: #1467087
commit 35654ec23ef9db6bda313ea300ab76c287a98ceb
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon May 25 15:20:05 2015 +0300
Decompose DVR CSNAT L3 Agent from Compute Node L3 Agent
Currently the same dvr router class is used both by the L3 Agent
in the compute nodes that is responsible for the virtual routers
namespace and the fip namespace and also used by the centralized
SNAT L3 Agent in the network node.
This is the first step to decompose the two into different
classes.
The above means that we have one class of DVR router which is used
for two jobs (the virtual router namespace wiring and the fips wiring
in the compute node in one hand and the centralized snat wiring in the other)
The end goal of this patch is to separate the two into different classes
which will also help maintaining it and also help projects that want
to use one but not the other (for example only use the centralized
SNAT behaviour with there own DVR implementation)
Change-Id: I581a097b9e7c49f20d0eb0e4ca66a25e90d9511b
Partial-Bug: #1458541
Partially-Implements: blueprint dvr-router-code-decompose
commit 0e48d9d203619f50adae94ddb6bbccd28f381737
Author: Davanum Srinivas <davanum@gmail.com>
Date: Sun Jun 7 10:10:18 2015 -0400
cleanup openstack-common.conf and sync updated files
Periodic update of latest files from oslo-incubator
Change-Id: Ie7eb02e4e9277c18abfb438b6cf710e0aa426b15
commit 74b0c53da5d7e4305606c100becf34966d8af350
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Jun 11 13:38:55 2015 +0300
Fix l3 agent to not create already deleted router
In case router is deleted during l3 agent resync,
the "deleted" event is processed with higher priority, then
resync event for the router may be processed which will recreate
already deleted router.
This happens due to timestamp not being properly updated for deleted
router in router processor.
The fix adds timestamp update for deleted router.
Functional test will be updated in a follow-up patch
Logging was improved to make debugging a bit easier.
Closes-Bug: #1455439
Change-Id: I2d060064acccc10591a3d90be9011f116548cfce
commit 4f5171d2cedb32fdc5a59d241e7ae91c7284b75c
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:24:34 2015 +0000
Python3: do not use '+' on dict\_items objects
In Python 3, dict.items() returns an iterator. Iterators cannot be added.
Blueprint: neutron-python3
Change-Id: I487178ebceae9946cb53dea1e847d7715f4577f3
commit b336b7c438f3f5d4ee8d23d6bb2d2cf8fe1657f4
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Fri Jun 19 15:52:35 2015 +0200
Disable keepalived process in keepalived func test
Previously, keepalived process itself was disabled that lead to
respawning of keepalived by KeepalivedManager. This patch disables
KeepalivedManager in cleanup thus no respawn happens.
Closes-Bug: #1466873
Change-Id: If5524116e5d4fc41600920d31481282c5b797f7b
commit a4b17cbb80b48c8e4bcd7cc005139f8e66066d68
Author: Cyril Roelandt <cyril@redhat.com>
Date: Thu Jun 18 11:52:28 2015 +0000
Python3: do not use im\_self/im\_func/func\_closure
One should use \_\_self\_\_, \_\_func\_\_ and \_\_closure\_\_ instead, as they work
with both Python 2 and 3.
Change-Id: I2b2847cfd5b4fa70e45387ff369240227ce9e526
Blueprint: neutron-python3
commit 432567f9477eadd840e407c5c057fc664e46d731
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 15:48:09 2015 +0300
Add request factory for pluggable IPAM
Pluggable IPAM implementation requires separation between requesting
address/subnet and it's actual allocation, which can happen on
third-party IPAM servers. Request factory stands for simplifying
building right request from input.
Added AddressRequestFactory and SubnetRequestFactory.
AddressRequestFactory creates instance of AnyAddressRequest or
SpecificAddressRequest depending on presence of ip address in input.
SubnetRequestFactory creates instance of AnySubnetRequest or
SpecificSubnetRequest depending on input.
get\_subnet\_request\_factory and get\_address\_request\_factory can be
redefined on driver level to use custom request factories.
Partially-Implements: blueprint neutron-ipam
Change-Id: Iedc0cfa326d60810099148f0ef8a1edac9e8aa12
commit 870fb38b1c7ddd5ddb399e6ff13a4f7992f8f9a6
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:59:46 2015 +0200
Python3: use dict.keys() instead of dict.iterkeys()
The "keys" method works on both Python 2 and 3, and the performance
impact should be negligible.
Change-Id: I4771797859666000921e4e38cc5de72a8c084ca0
Blueprint: neutron-python3
commit 538a7bf3c73d968185590d81a9b3a6523190aeb4
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Jun 9 03:41:07 2015 -0700
NSX QoS ext: RXTX factor can be decimal
In Nova flavors it is ok to specify a decimal RXTX factor.
For this reason when applying QoS to a port Neutron should not
convert this factor to an integer value, but simply ensure
it's a valid float number and positive.
Partial-Bug: #1463363
Change-Id: I983123ef7fd8f1b52b358aff3b579459fce63033
commit 5aaae68e5148f01e78a5e6013dce797dd42c1917
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:17:58 2015 +0300
Move \_add\_auto\_addrs\_on\_network\_ports
Moved to ipam\_non\_pluggable\_backend.py since implementation
is specific for non pluggable ipam backend.
Pluggable implementation will additionally include rollback on failure actions.
This commit is a preparation step for using pluggable ipam.
More changes in this methods are expected to be done by following
patches.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1876846526e370a7fcfa05b9a23fd9065973f111
commit 6669ee9af6bd635ae7efbc2f02e10914549ef708
Author: Lucas Alvares Gomes <lucasagomes@gmail.com>
Date: Thu Apr 9 14:02:36 2015 +0100
DHCP agent: Set an "ipxe" tag to work with Ironic
Ironic expects neutron to have an "ipxe" tag for the option 175 which is
sent by iPXE/gPXE when booting a node. The problem is that up to now this
tag was not created by Neutron, causing the nodes deployed with Ironic
+ iPXE to fail to boot. This patch is creating this tag when launching
the dnsmasq process.
DocImpact
Change-Id: I45a0f51365b37e7d85848fcdcbcf7aa6a1dddfed
Closes-Bug: #1442123
commit 735f193668d61dd7c09f710e555ab91d1d91abe6
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 18:47:11 2015 +0300
Remove \_check\_ip\_in\_allocation\_pool
\_check\_ip\_in\_allocation\_pool is not used anywhere in neutron.
Cleaning up unused code from db\_base\_plugin\_v2.py.
Caller was removed over a year ago in change
Ib31550fa9000fc75768a327cb6cc1c419e06568f
Partially-Implements: blueprint neutron-ipam
Change-Id: I41b7254835c308dda679ee2a5ebbccba528fd108
commit e3710f59481b4f9c3430228e8f074c845e93fbe7
Author: shihanzhang <shihanzhang@huawei.com>
Date: Mon Jun 15 14:51:16 2015 +0800
Don't delete DVR namespace if there are still ports on this node
Skip deleting DVR namespaces if they contain ports in the BUILD or
DOWN status.
Change-Id: I026f2014ede800c0f4532ca15f1fccdaa59d5b61
Closes-bug: #1464527
commit 345ffb99ef92f567562c178c57b9c110740a3767
Author: Doug Wiegley <dougw@a10networks.com>
Date: Thu Jun 18 18:13:43 2015 -0600
Updated from global requirements
Since we can't merge proposal bot at the moment, due to a conflict with
setup.py, at least get our reqs files up to snuff.
Change-Id: Ie313c81502dfe17a4afdcfdba4e207b9866e1399
commit 42826a0e64b3499cda065fd9ffdf0b5af5754c85
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:06:21 2015 +0200
Fixed the only sphinx warning in docs
We made previous attempt to get rid of all warnings, but it turned out
that gate does not execute tox's docs job but runs build\_sphinx
directly.
The latter behaviour should be fixed, but while at it, we
should prepare neutron job to be executed in gate by cleaning up all
warnings.
Closes-Bug: #1466554
Change-Id: I8c265eae2175425568479116d1faef7d87fdcc02
commit 63e318f5f8159f108cf1e7a82c952fa5f882870f
Author: Moshe Levi <moshele@mellanox.com>
Date: Thu Jun 11 12:24:03 2015 +0300
Fix SR-IOV mech driver to set port status to down when agent is required
SR-IOV mech driver has 2 modes agent and agent-less. Currently in both
modes port status are active. This patch update the port status to down
when using agent mode. This will allow the SR-IOV agent to get port
update notification and apply its additional functionality
when launching vm.
Co-Authored-By: Berezovsky Irena <irenab.dev@gmail.com>
Closes-Bug: #1464186
Change-Id: Ibd9b31b4f2393b8732253d5cbfd36e8b5614860d
commit cdde9a3aeb929e80aa3c251a44060b8174ab7b6c
Author: venkata anil <anil.venkata@enovance.com>
Date: Thu Jun 18 10:03:12 2015 +0000
read\_hosts\_file\_leases shouldn't parse stateless IPv6
Error when \_read\_hosts\_file\_leases tries to parse stateless IPv6 entry
in hosts file
TRACE neutron.agent.dhcp.agent ip = host[2].strip('[]')
TRACE neutron.agent.dhcp.agent IndexError: list index out of range
Neutron creates entries in dhcp host file for each subnet of a port.
Each of these entries will have same mac address as first field,
and may have client\_id, fqdn, ipv4/ipv6 address for dhcp/dhcpv6 stateful,
or tag as other fields.
For dhcpv6 stateless subnet with extra\_dhcp\_opts,
host file will have only mac address and tag. So \_read\_hosts\_file\_leases
shouldn't check for ip address for this entry in host file.
Closes-bug: #1465330
Change-Id: Iad6605ac5c7bcd6ec9204352037ed021f5007738
commit 31f846c1b9fa17d1812f78dffe1dcf883da52bab
Author: shihanzhang <shihanzhang@huawei.com>
Date: Fri Jan 30 09:50:52 2015 +0800
Fix 'router\_gateway' port status can't be updated
when it creates a ovs bridge without parameter 'bridge-id',
it's default 'bridge-id' is None, so ovs agent should also
deal with these ovs bridges, for example if ancillary bridge
br-ex does not be handled, the 'router\_gateway' port status
can't be updated.
Change-Id: If428eadadfd36a9b19ea75920120e48ac49659f2
Closes-Bug: #1416181
commit 2db459f284002e45497d768a8a53c9b43d045d45
Author: Doug Hellmann <doug@doughellmann.com>
Date: Tue Jun 16 19:49:15 2015 +0000
Update version for Liberty
Update the version for Liberty, switching from date-based versioning
to pre-versioning using SemVer. See
http://lists.openstack.org/pipermail/openstack-dev/2015-May/065211.html
and
http://lists.openstack.org/pipermail/openstack-dev/2015-June/067082.html
for details.
Change-Id: I6a35fa0dda798fad93b804d00a46af80f08d475c
commit 98d0be2f82523a40e630cf08dd8479b4cbb48add
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:33:56 2015 -0700
Add networking-sfc to the list of affiliated Neutron projects
The project is being bootstrapped in [1,2], this change reflects
that in the sub\_projects doc.
[1] I3825a1e02713f45e2c769eaa8fd0f1ab48d14372
[2] Iec53129d7c19620d690e71032c83907f03c66d9f
Change-Id: I7c235bfe444bbb9afc7d4d8c92704c9bfc09ab49
commit 315b10dc9fa7b8d889a24e0c6cdf72f5341d92d5
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:31:01 2015 -0700
Minor improvements to sub\_projects document
Let's remove the empty table, to cut down the risk of inconsistency,
and further explain what the list of affiliated project is for.
Change-Id: I3c8970db8de4fc211233903e8220cda72d47e193
commit 53209ca19ac2116d293b6fbc7b31254cb27a3ecb
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 17 14:25:56 2015 +0000
Python 3: do not use cmp(), nor sorted(..., cmp=...)
\* The "cmp" function has been removed, so we must not use it any more;
\* The "cmp" keyword argument of the "sorted" function has been removed, so
replace it with "key=functool.cmp\_to\_key".
Change-Id: Ic39d29dc1002a68f36f04c32e53a36bc826dce78
Blueprint: neutron-python3
commit 4a73ab99c9fcc63adbbb41d4a9b9ba8669afdc61
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Tue Jun 16 13:48:26 2015 +0200
Move get\_inteface\_by\_ip from LinuxBridge class to ip\_lib
get\_interface\_by\_ip is moved fro LinuxBridgeManager to ip\_lib
as a more generic get\_device\_by\_ip.
System-faking unit tests have been switched for functional
testing that also performs a negative test.
This can be reused in the openvswitch-agent code to validate
local\_ip reusing the LinuxBridge logic.
Change-Id: I9237871a6e24dd99556c71844624be510e20d289
Related-Bug: #1464178
Related-Bug: #1408603
commit 76dd333167920f447bdbedbbee10fdab593abe5b
Author: Vladislav Belogrudov <vladislav.belogrudov@oracle.com>
Date: Wed Jun 17 14:02:22 2015 +0300
Fix cisco\_csr\_identifier\_map.ipsec\_site\_conn\_id
Some database engines require exact match of sizes of foreign keys
and referenced fields. Foreign key ipsec\_site\_conn\_id of table
cisco\_csr\_identifier\_map is varchar(64) but it references field
id varchar(36) of table ipsec\_site\_connections. This gives error
while running migration scripts in such databases.
This fix only applies to new installations. Existing databases will
be corrected by migration scripts introduced in
https://review.openstack.org/190569 - they will take care of resizing
the field and adjusting the model.
Change-Id: I6cc9625a2d96d1330b06eb727cc7fa5363c697b8
Depends-On: I384a9bbaba05ef94174b666bdcfb276eedc74134
Closes-Bug: #1463806
commit 7a7377681133785e12a296ff7077b039708da97d
Author: Thomas Morin <thomas.morin@orange.com>
Date: Wed Jun 17 12:13:35 2015 +0200
fix rootwrap debug filter for ping all
NeutronDebugAgent.ping\_all calls ping with "-c 1 -w <number>' so
the filter should accept this order, and not only "-w .. -c ..".
Not changing the existing filter to not break other tools
that might use -w -c in that order.
Change-Id: I5b3d67dfcdc15c53ac3bf2fb39de29fd97e98a19
commit 7d704db18ec7635328bfce7dc6e936151f264f1f
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 23:16:24 2015 -0700
Refactor rpc\_loop() in ovs neutron agent
This patch segregates the port\_info recieved by
scan\_ports and scan\_ancillary\_ports.
This refactoring is basically required for this patch set:
https://review.openstack.org/#/c/165023/
Co-Authored-By: Romil Gupta <romilg@hp.com>
Change-Id: I9b43c230cda9d2659ad0e806bebe8a3dc12826ec
Partial-Bug: #1329223
commit 4e77442d529d9803ff90de905b846af940eaf382
Author: Kevin Benton <blak111@gmail.com>
Date: Sat Jun 13 18:45:19 2015 -0700
Add deadlock retry to API and ML2 RPC port update
With the switch to the pymsql SQL driver, eventlet will now yield
during database transactions. This greatly increased our probability
of multiple coroutines running transactions on the same table that
result in deadlocks.
These deadlocks could result from many things including the following:
\* a coroutine holding a pessimistic "SELECT for UPDATE" lock when
another tries to update the locked records
\* two coroutines both issue update statements using a WHERE clause
invalidated by the other update (e.g. from a compare and swap approach)
\* two coroutines insert records that, when combined, violate a unique
constraint on the table in a master-master Galera deployment
\* any two workers using "SELECT for UPDATE" in a master-master Galera
deployment (write-set certification failure translates to deadlock)
This problem is exacerbated by the switch to multiple API and RPC
workers, each of which can lead to most of the errors above even
without the switch to pymysql.
This patch adds a deadlock retry decorator to the delete, create,
and update methods at the HTTP API layer. Additionally, it adds a
decorator to the update\_port\_status AMQP API in ML2 since it updates
the port table, which is a heavily locked table by ML2 making it a
prime candidate for deadlocks.
Nova has had relied on the deadlock retry mechanism for quite some
time now. We were limping along by not using additional workers and
by relying on the unyielding nature of the MySQL C driver to
serialize everything.
Closes-Bug: #1464612
Change-Id: I635cc49ca69f589f99ab145d4d51e511b24194d2
commit 95b6a74af10e2150b017647028de8454ef1cda2f
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Tue Jun 16 17:23:09 2015 -0700
ovsdb: session.rpc never initialized
Previously, if idl.Transaction.commit\_block() returned a status of
TRY\_AGAIN we would check self.api.idl.\_session.rpc.status which would
result in an attribute error as rpc is None.
This patch fixes this attribute error by removing this unneeded check. In
addtion, the force\_reconnect() is also removed as ovs.jsonrpc handles
reconnecting automatically for us.
Change-Id: Ibf3ce5cd3432845f8938a1d83637ecf59b14b5ca
Closes-bug: 1465889
commit fc0c3a83659a86453acd5745a5632729b99cb3de
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Mon Jun 15 10:57:02 2015 -0600
Remove duplicated debug logging around locking
Currently, iptables\_manager.py does extra unnecessary logging about lock
acquisition and release. It uses lockutils.lock() which passes
do\_log=True by default, which causes lockutils.lock() to do debug
logging about lock acquisition/release. IptablesManager itself also writes
debug log info about lock acquisition and release.
This change will eliminate unnecessary duplicate logging in order to
reduce log noise about locking. This change is also related to
https://github.com/harlowja/fasteners/commit/f88f2fea7fe250b7d26cdcbc84633ccbbc68eeee
which reduces the logging level in the underlying lock implementation
used by oslo.concurrency. That change along with this one will remove
the duplicate debug logging about locking in iptables\_manager.py and also in
ipset\_manager.py.
Change-Id: If6f4a7101f3783ad83645e28bbb5c577dd403d3b
Closes-Bug: 1464727
commit 8f2014ea556404fb99c78add1e46b80c718cf491
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 05:32:44 2015 -0700
Refactor scan\_ports() and update\_ancillary\_ports() in OVS Neutron Agent
Used a helper method which contains the common code from scan\_ports()
and update\_ancillary\_ports(). And also renamed the name of
update\_ancillary\_ports() method to scan\_ancillary\_ports() to have parity
between normal ports and ancillary ports.
Added unit tests for scan\_ancillary\_ports.
Co-Authored-By: Romil Gupta <romilg@hp.com>
Partial-Bug: #1329223
Change-Id: I8b3e00a9371d5a03cc8b4be24bf20eec10bef5df
commit 4f46d2ae3a089f36512fae3bf49f155927095922
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 16 13:38:13 2015 +0000
Python3: do not change the size of a dict while iterating over it
This does not work in Python3, so we have to store the items first.
Change-Id: I7d8641f980fe62d2900559433d5060a6281a97f8
Blueprint: neutron-python3
commit 0488ac707493575e084f02273df2c4ec598541ba
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 12:34:41 2015 +0300
Refactor TestRpcWorker and TestWorkerService
TestRpcWorker and TestWorkerService have a duplicate test\_reset.
This patch introduces a base class from which tests for service
workers can inherit.
Change-Id: Ic4690c3b066b03c2fbb463f1329208ad1307d83d
commit fca84f69659e4e81790de405213f31e80fd8c239
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 2 18:45:51 2015 +0300
Juno\_initial migration
Havana was deprecated with the kilo release, and icehouse will be
deprecated with the liberty release, so havana\_inital migration should be
removed and replaced with juno\_initial.
Closes-bug: #1461103
Change-Id: I2e6802c9ab64d164bd888278d555dfeeaf47257b
commit 037f3111cd3968ff00593387daf2b832761e5ef4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 16 09:21:42 2015 +0200
docs: added job to well known tox envlist
This is to make 'tox -l' return the job name in its output (needed to
allow run-docs.sh script in project-config to determine whether the job
is present, to rely on it when generating docs in gate).
Change-Id: I80eb169b7b4e5a3490586722c64394dbb724928d
commit 9fc422a93a00f4126e91fa79ffcd43903ea9c8ac
Author: Sean M. Collins <sean@coreitpro.com>
Date: Mon Jun 15 13:51:05 2015 -0400
API Extensions: inherit from the ExtensionDescriptor
For consistency in the codebase, API extensions should inherit from the
abstract base class ExtensionDescriptor.
Change-Id: Id4829c265866e80c042c433bebcc01383e1e7417
commit 34aa030847ed24ad6ca7759459cbe9a6d0f43db3
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Jun 15 14:47:21 2015 -0400
Remove fossilized remains
Clean up ancient stuff that hasn't been touched in over 3 years.
Change-Id: I67fcd85027fb6614cafe8d92ddbf8c24aed58a4f
commit f88f3dc8d6f7240d6c0d9d5006345b3a797ae067
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 16:18:40 2015 +0300
Refactor update\_port in db\_base\_plugin\_v2
This commit is a preparation step for using pluggable IPAM.
- moved validations into \_validate\_port\_for\_update;
- updating ip addresses for port is backend specific, so
moved into \_update\_port\_with\_ips in ipam\_non\_pluggable\_backend;
- writing port changes to db is common for both backends, so
moved into \_update\_db\_port in ipam\_backend\_mixin;
- updated to use namedtuple to track add/original/remove ips;
- added \_make\_fixed\_ip\_dict to exclude keys other than
ip\_address and subnet\_id;
Partially-Implements: blueprint neutron-ipam
Change-Id: I1110e88f372b1d0cc7ec72049ba69a6d548da867
commit a89f99c6b700b1c6f918fe359c7271ac25ed4bc4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 14:56:58 2015 +0300
Refactor \_update\_ips\_for\_port
This commit is a preparation step for using pluggable IPAM.
\_update\_ips\_for\_port was refactored and split into two methods:
- \_get\_changed\_ips\_for\_port
This method contains calculations common for pluggable and
non-pluggable IPAM implementation, was moved to ipam\_backend\_mixin.
- \_update\_ips\_for\_port
This method is specific for non-pluggable IPAM implementation, so it
was moved to ipam\_non\_pluggable\_backend\_common.
Other changes:
- \_update\_ips\_for\_port now returns namedtuple with added, removed, original
ips (previously added and original ips were returned).
List of removed ips is required by pluggable IPAM implementaion
to apply rollback-on-failure logic;
- removed unused port\_id argument from \_update\_ips\_for\_port argument list;
Partially-Implements: blueprint neutron-ipam
Change-Id: Id50b6227c8c2d94c35473aece080a6f106a5dfd8
commit a8619e9bd1247e8ec494c456aee9ee7163231f62
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 15 15:07:28 2015 +0000
Python 3: use dict.values instead of dict.itervalues
This works with both Python 2 and 3, and should not have any performance
impact.
Change-Id: I2a14945c60de513b91c6f022ff5dcc503ce2a8ad
Blueprint: neutron-python3
commit 62faedddf2b0315484a04bd9092e96a3a828e46a
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:15:11 2015 +0200
Put output of docs job into doc/build/html
This is the path where jenkins/scripts/run-docs.sh that is used by gate
to generate project documentation expects to see the output.
Change-Id: Id276fa59edb33f7789ab06055300b4dc2385472a
commit ad1c7a35dec614a26de0a426950fa005df5f489d
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:23:44 2015 -0400
Remove get\_namespace from API extensions
Based on the conversation on the ML.
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066219.html
APIImpact
DocImpact
Closes-Bug: #1464023
Depends-On: 6f900fc429bf24cb31e0d2f149aa732055fd5956
Change-Id: I3c406910991c33cf959c5345d76153eabe3ace2d
commit b370c69b75fe38cd285512f9516ce428e8a806dd
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 9 16:00:58 2015 +0000
Ensure no "db" related functional/fullstack tests are skipped in the gate
Currently neutron uses MySQLTestCase[1] and
PostgreSQLOpportunisticTestCase[2] for functional and fullstack tests
using a real MySQL/PostgreSQL database. These classes skip tests when
the db is unavailable (db not installed/configured, missing packages,
etc.) which is fine when tests are runned by developers but not when
runned by the gate jobs.
This change updates MySQLTestCase[1] and defines PostgreSQLTestCase[1]
as PostgreSQL oslo.db test class wrapper: when the db is unavailable,
these classes ensure tests will:
\* fail in the gate (dsvm-functional, dsvm-fullstack jobs),
\* be skipped by default otherwise (functional, fullstack jobs).
[1] neutron.tests.common.base
[2] oslo\_db.sqlalchemy.test\_base
Closes-Bug: #1404093
Change-Id: I77b12e728ce9a7b0222c3df081842635f6375a3e
commit 278a5fce29504c43d669feed210f7b3627616e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:35:11 2015 +0200
Use PyMySQL in MySQL related functional/fullstack tests
mysql-python driver has been replaced by PyMySQL driver[1] in neutron
code but MySQL related functional/fullstack tests try to use
mysql-python driver because of MySQLOpportunisticTestCase[2] and tests
are skipped because mysql-python driver is no more available.
This change provides a backend implementation for mysql+pymysql, a base
base testcase MySQLTestCase[2] using mysql+pymysql implementation
(currently oslo.db provides none of them but will in the future) and
replaces MySQLOpportunisticTestCase with MySQLTestCase.
[1] I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
[2] neutron.tests.common.base
Closes-Bug: #1463980
Change-Id: Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
commit 1318437a0caf38e695a819848832a955fef7d909
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Fri Jun 5 01:46:22 2015 +0400
Skip rescheduling networks if no DHCP agents available
This eliminates the problem of unscheduled networks in case
of communication failure between agents and servers which
can occur if messaging queue service fails.
Change-Id: Ied4fa301fc3d475bee25c47f3a01c2381ae9a01e
Closes-Bug: #1461714
commit bb846c89ee120662eabdd4b0136fac82de076777
Author: Russell Bryant <rbryant@redhat.com>
Date: Fri Jun 12 21:26:37 2015 -0400
Reflect project moves from stackforge to openstack.
Several git repos were just moved from stackforge to openstack.
Reflect the move in various places where the URL was in docs and
comments. In passing, also change URLs to git.openstack.org instead
of github, as that is the official home of all of these repos.
Change-Id: I6c79a192d6604cef01e88d5b305fcc2b0f9c6b30
Co-Authored-By: Kyle Mestery <mestery@mestery.com>
Signed-off-by: Russell Bryant <rbryant@redhat.com>
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 1710f7c72f2c509d1009ee36ba4f66b298967fe9
Author: Kobi Samoray <ksamoray@vmware.com>
Date: Thu Jun 4 15:49:13 2015 +0300
VMWare NSXv: Add distributed URL locking to ini
NSXv plugin supports distributed locking using tooz library.
This patch adds the required parameter to the ini file.
DocImpact
Depends-On: Icbcec938c1c5ae7a528350f2f283388b81fa66b7
Change-Id: I8a7c36d044c4be29b0dfa3fbb8e9379723cebd61
commit 9952abaab182f3ec701aad2397d6f3fcc0bacc7f
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Mon Jun 8 14:15:30 2015 +0300
Decompose db\_base\_plugin\_v2.py with changes
This commit is a preparation step for using pluggable IPAM.
1. Moved get\_subnets functionality to db\_base\_plugin\_common to make it
accessible by ipam backends.
2. Reworked update\_subnet routine:
- moved db part into update\_db\_subnet;
Partially-Implements: blueprint neutron-ipam
Change-Id: Idb8f54d9fccaad1137222d156590c37d86aa576b
commit a5bf502fab57453a1aedd3a53ce89eaf464e1cd9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Fri Jun 12 21:11:02 2015 +0200
Remove duplicate tunnel id check in sync\_allocations
Currently, gre/vxlan sync\_allocations and \_parse\_tunnel\_ranges both
check tunnel id values. This change removes the check in gre/vxlan
sync\_allocations as they duplicate \_parse\_tunnel\_ranges check and is
less fine.
Change-Id: I5827468aeaec5d6c79d469132b129aeb7da171e2
commit 901e6ae6fb05d65ccfc4a6602de4160c3a34031e
Author: Akihiro Motoki <motoki@da.jp.nec.com>
Date: Sat Jun 13 02:14:17 2015 +0900
Remove meaningless no\_delete from L3 test
no\_delete parameter was removed in Kilo and it no longer
has any effect.
Change-Id: Idf0f3ac24b3978392222efbf465cc9e6cfd5d346
commit ba2c44ef000221f8a18274a9569838d8c26014c0
Author: armando-migliaccio <armamig@gmail.com>
Date: Fri Jun 12 08:58:05 2015 -0700
Revert "Revert "Set default of api\_workers to number of CPUs""
This reverts commit 12a564cf03e612dda36df26df8d28dfc75f1af6e.
We should re-enable this feature on a controlled basis so that we can
flush out any outstanding issue we may have.
Related-bug: #1432189
Change-Id: I2cfd93fdb032b461022b729347390ff8636ccdeb
commit 89a83bf199e7ea75c04f3205ff77987feed13184
Author: rossella <rsblendido@suse.com>
Date: Thu Jun 11 10:43:36 2015 +0200
OVSNeutronAgent pass the config as parameter
Instead of using the global cfg.CONF, pass the config as parameter.
This is very useful to test the agent without having to override
the global config.
Change-Id: I45534d79e044da9f2be4d596a58310fb28b7bf22
commit 7e0222409dab6223579efea34ba0d3ccf93e11d3
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 11 17:23:41 2015 +0300
Refactor \_update\_subnet\_allocation\_pools
Moved \_update\_subnet\_allocation\_pools to ipam\_backend\_mixin.py.
Call \_rebuild\_availability\_ranges with self to make it overridable
on upper level (from non-pluggable backend).
Partially-Implements: blueprint neutron-ipam
Change-Id: If7b1e720f88a2f0177b6772a015ae216f19ee22d
commit 5ff082bcfe12647036e5b033bfc2bac514acdb42
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Tue Feb 24 15:47:01 2015 -0500
Stop sending gratuitous arp when ip version is 6
This fix prevents calls to the arping utility for IPv6
addresses, thereby eliminating errors reported by arping
for IPv6 addresses.
The assumption is that NDP, DAD, and RAs are sufficient
for address resolution and duplicate address detection
for IPv6, and that unsolicited Neighbor Advertisements (NAs)
are not required for OpenStack services. If this turns out
not to be the case for some service/feature, then a separate
bug should be filed to add support for unsolicited NAs for
that service.
Change-Id: I14f869b7d488d7e691f7316eafcab3064e12cda6
Closes-Bug: 1357068
commit 1552f311532fdbd03a79ecfc1fae488b072c5a14
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 9 11:30:06 2015 +0300
Fix Enum usage in 589f9237ca0e\_cisco\_n1kv\_ml2\_driver\_tables
PostgreSQL is more sensitive with types than MySQL, it creates a
separate type when a Enum is created. In migration 589f9237ca0e
type profile\_type is trying to be created, but the type with such
name was already created in havana\_initial migration.
The solution for this is not to create type in 589f9237ca0e
migration when dialect is PostgreSQL and use already created.
Closes-bug: #1463301
Change-Id: I66e74d50cc70673de8635616076779cc20cde113
commit cd56a657a19a5a756d191c614becfd3e386b3c80
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jun 11 06:03:07 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If91f3ac94562cc5130dd5ea5ac5d71aec64b74e3
commit 7b51521e31f896d0095510b52644b728aaadca5a
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 10 21:45:41 2015 -0700
power grab
The current core reviewers hierarchy didn't have a place for the
parts of ML2 that weren't related to agent communication. For now
we can put all of ML2 under the built-in control-plane until we
decide it needs to be put somewhere else.
Change-Id: Ic4924e0041c4cbb955d8fac0f96ec56406d6466e
commit 1c29fab7cb3e586be72dd7910e2022b45c809c5f
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Jun 4 23:54:31 2015 -0400
Change ensure\_dir to not check directory exists first
I224be69168ede8a496a5f7d59b04b722f4de7192 added an EEXIST
check, so no need to check if the directory is already
there, just try and create it.
Change-Id: Iba51fc8263bf59326489319d0dd3f69af00a8eeb
commit 7c331be77fb6a835f1fb79c674d8d6c39c7eb357
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 10 16:53:25 2015 -0700
Document existence of br-tun and br-int in the OVS agent
Question about the use of the two bridges has come up in the past
multiple times, so let's fill the gap in the developer documentation.
A user-facing documentation patch will have to follow up, if we want
to be very thorough.
Change-Id: I6dac0f9bdaf7b3b7bff8745d4103ccc71df61a0a
commit 9c8a19ba4032f98ecbffe53c4e731587550ded96
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:08:45 2015 +0200
Correct indentation in neutron.api.v2.attributes
This change corrects subnetpool resource definition indentation in
neutron.api.v2.attributes.
Change-Id: I6738ff6b73bd0b943cec32f14ccb8946ba28d2e3
commit fd85b3ead32cd988e93f1d33d219ffd52cd77a51
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 10 10:20:58 2015 +0000
Python3: replace 'unicode' with 'six.text\_type'
In Python 3, 'unicode' does not exist; 'six.text\_type' should be used instead.
Change-Id: I71011b4beee9817a61278eb473804cfb798de74a
Blueprint: neutron-python3
commit c34ce7c9845cc56f981e0ee8714d1f9345df5852
Author: Saksham Varma <sakvarma@cisco.com>
Date: Tue Apr 7 18:12:02 2015 -0700
Moving out the cisco n1kv section to stackforge
Since most of the n1kv plugin code resides in stackforge/networking-cisco
repo, it's best to move the n1kv section there
Change-Id: Ic1388980dea0d27dfa5e84869f1f20cc9bff78e5
Closes-Bug: #1441400
commit 27df3e9fb98407e94bdeb9df493a9a3a0be639ca
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon Jun 1 22:29:39 2015 +0200
Ensure no "agent" functional tests are skipped in the gate
Some "agent" functional tests[1] can be skipped if some requirements are
not satisfied in order to allow developers to run functional tests on
various environments. These tests should not be skipped in the gate.
This change defines the decorator no\_skip\_on\_missing\_deps[2] to ensure
no "agent" functional tests are skipped in the gate. More precisely
no\_skip\_on\_missing\_deps transforms a skipTest into an error in:
\* dsvm-functional and dsvm-fullstack jobs,
\* functional and fullstack jobs when OS\_FAIL\_ON\_MISSING\_DEPS is
evaluated as True.
The change enlarges OS\_FAIL\_ON\_MISSING\_DEPS environment variable scope
(ie: missing dependencies + system requirements).
[1] in neutron.tests.functional
[2] in neutron.tests.common.base
Change-Id: Iacd4a5ef249fc1d7c75135ead9d0cf99d8a98a06
Closes-Bug: #1459844
commit ca63dfd0f39c7d691247c146b7529937c5804c9e
Author: Romil Gupta <romilg@hp.com>
Date: Wed Jun 10 09:43:56 2015 -0700
Remove useless pass from methods in type\_tunnel.py
The pass is useless because there is a docstring in the methods.
Generally considered as uncovered by coverage tool.
Change-Id: Id1275c51e9adb865a3da9f0db007f3092b55b140
commit 87fecfcc50f371d8dd593b3cd372da9db56f39c6
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:29:33 2015 -0400
Make Vlantransparent extension inherit from ExtensionDescriptor
Change-Id: Ic615578a1fe1d401b53d0b44ff5275d9518b97fd
commit eeacb95e65a749ce3a032246c36d10cad9df22b1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Wed Jun 10 13:10:54 2015 +0200
Actually allow to pass TRACE\_FAILONLY to ostestr
The comment below suggests to use TRACE\_FAILONLY to fail quickly when
running unit tests, while tox 2.0 does not allow to pass envvars from
the cli caller unless they are explicitly mentioned in passenv=
directive.
Change-Id: I6861498e7609b0c21fad844009420ea9734e2352
commit 1c124a309bc941c078b8bb622ea248a3ed3829e1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 11:28:10 2015 +0200
Switch to os-testr to control testr
It's a nice wrapper spinned out recently from tempest-lib that should
cover all our needs that we currently fulfill with pretty\_tox.sh.
Change-Id: I2268ed45ab628fe5dcab657d6287594847ab587c
commit da42745c466c14e6dbe58cdbc830ae5d1c8bb114
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Tue Jun 9 16:08:50 2015 +0000
Introduce functions using arping executable
The arpinger is gonna be used in the next changeset introducing
connection testers.
Change-Id: I90ae32c2f52f1debfb11ae2a08b2828ee2be04cc
commit 328b72cf8c5f514434de0b73c9137bde52b5eeea
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Wed Jun 10 07:04:25 2015 +0000
Revert "Defer segment lookup in NetworkContext object"
This reverts commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0.
This patch likely violated the idea of a NetworkContext
being a snapshot of the network at the time it was created.
This needs a different approach.
Change-Id: I20b132a0181d35b0517330fb7fbf293c3e979d0e
commit e33d92c894df4664d01d040ba4305c7cb4ef6e27
Author: Fawad Khaliq <fawad@plumgrid.com>
Date: Tue Jun 9 22:18:18 2015 -0700
Added networking-plumgrid in plugin requirements
Closes-Bug: 1463665
Change-Id: I7152dedd83659ee51274be31ef305af9e82d695a
commit f08e9f1f53efa97e07f21ca72a940fcbeb4570e5
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Wed May 20 01:03:59 2015 +0000
Switch from MySQL-python to PyMySQL
As discussed in the Liberty Design Summit "Moving apps to Python 3"
cross-project workshop, the way forward in the near future is to
switch to the pure-python PyMySQL library as a default.
https://etherpad.openstack.org/p/liberty-cross-project-python3
Change-Id: I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
commit 6886655b491aede40aa9f4a0bd4c6d402d5a7a78
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Apr 28 04:59:35 2015 -0700
Context: Remove logic for read\_deleted and deprecate it
The read\_deleted parameter in the Context object is simply unused.
This patch removes associated logic, and for what is worth, adds
deprecation warnings against explicit usage of read\_deleted when
creating a context instance, generate an admin context, and
elevating a context instance.
Change-Id: Ic69d22dc229ebe8fac1f6be0c4860d19732505b1
Closes-Bug: #1449462
commit 303f37f4e0c84f90e40b95731a828fc6ce8a0bbf
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 16:09:49 2015 +0000
Python 3: use next() instead of iterator.next()
The latter only works in Python 2.
Also define a \_\_next\_\_ method in the classes that define a next method.
Change-Id: Iaa1a1e500facab50d8bcdffda39ccad3f2e4e9bb
Blueprint: neutron-python3
commit 9143ce10e422bd17c4817dfe08163879e0e5a4ca
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 12:12:52 2015 +0200
Consume oslo.policy
Some non intrusive changes to tests are needed, so that we don't rely on
library symbols that are now private (f.e. parse\_rule).
Closes-Bug: #1458945
Change-Id: I90326479e908042fec9ecb25fa19a8dd5b15e7d8
commit 66fece4f84e62f14fb59a721b37986784976d0c4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 14:03:52 2015 +0200
policy: cleanup deprecation code to handle old extension:xxx rules
It served and warned users for enough time (since Icehouse) to be sure
everyone was notified about the need to update their policy file.
Change-Id: I240b935741e49fbf65c0b95715af04af4b2a73e7
commit 53ec63c430d123cd1ed4acd3b94537e9cb380bcd
Author: Romil Gupta <romilg@hp.com>
Date: Thu Jun 4 04:21:14 2015 -0700
Fix a regression in "Separate ovs-ofctl using code as a driver" change
The tunnels are not getting established between Network Node and
Compute Nodes in non DVR mode with l2pop enabled and throws
the AttributeError: add\_tunnel\_port.
This fixes a regression in change Ie1224f8a1c17268cd7d1c474ed82fdfb8852eaa8.
Co-Authored-By: YAMAMOTO Takashi <yamamoto@midokura.com>
Closes-Bug: #1461486
Change-Id: I1106fd3dd32f6f827eb25dec4815ff1120af96f0
commit 753196480d9cca10c5b91dfa8221e89f658fa110
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed May 27 13:54:06 2015 +0000
Break Pinger class to functions
As the class served only for storing parameters that can be passed as
actual function parameters, there is no reason for class.
Change-Id: I553b4d6daeb78d495cda09894582a3d885b5d1b5
commit 6d0d72973152bb45587437c80d4ffe0fe7bba761
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Tue Apr 7 14:58:13 2015 +0300
Handle SIGHUP: neutron-server (multiprocess) and metadata agent
All launchers implemented in common.service require each service to
implement reset method because it is called in case a process
receives a SIGHUP.
This change adds the reset method to neutron.service.RpcWorker and
neutron.wsgi.WorkerService which are used to wrap rpc and api
workers correspondingly.
Now neutron-server running in multiprocess mode (api\_workers > 0 and
rpc\_workers > 0) and metadata agent don't die on receiving SIGHUP and support
reloading policy\_path and logging options in config.
Note that reset is called only in case a service is running in daemon mode.
Other changes made in the scope of this patch that need to be mentioned:
\* Don't empty self.\_servers list in RpcWorker's stop method
When a service is restarted all services are gracefully shutdowned,
resetted and started again (see openstack.common.service code).
As graceful shutdown implies calling service.stop() and then
service.wait() we don't want to clean self.\_servers list because
it would be impossible to wait for them to stop processing
requests and cleaning up their resources.
Otherwise, this would lead to problems with rpc after starting
the rpc server again.
\* Create a duplicate socket each time WorkerService starts
When api worker is stopped it kills the eventlet wsgi server
which internally closes the wsgi server socket object. This server
socket object becomes not usable which leads to "Bad file
descriptor" errors on service restart.
Added functional and unit tests.
DocImpact
Partial-Bug: #1276694
Change-Id: I75b00946b7cae891c6eb192e853118e7d49e4a24
commit ea35b299f06050608f3e7bb6fbc880006ed31024
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 18:25:14 2015 -0700
Allow update\_port\_status to take network param
Allow the update\_port\_status function to take a network as
an optional parameter to skip calling get\_network again if
the caller has already done so.
Closes-Bug: #1463656
Change-Id: I994f3abdb1b0ad3b2766f409b206ad4a8b2309b6
commit d0be7bc57f573d5696108b571c731decfbde9f0b
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 12:46:54 2015 +0200
Make pep8 job succeed when /etc/neutron/neutron.conf is not installed
Currently, if /etc/neutron/neutron.conf is not installed in the system,
neutron-db-manage fails in oslo.config code when trying to determine the
default configuration file to use.
Test job should not rely on any contents inside /etc/.
Instead, pass --config-file with test-only configuration explicitly into
the utility.
neutron.conf.test was renamed into neutron.conf since for some reason
oslo.config does not support a name that does not have .conf at its
filename end.
Change-Id: I719829fc83a7b20a49c338aaf1dbef916dcc768c
commit 826428dc8aeef124c2251624ae34fdc003e69ca4
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Tue Jun 9 19:00:40 2015 +0900
Add a comment on \_check\_update\_has\_security\_groups
Despite of its name, \_check\_update\_has\_security\_groups can
handle create requests as well. There are plugins actually
using it for create. eg. ml2, vmware
Change-Id: I3c26ad0ac00b12ce24096bfc27606797af2d9098
commit 6b13cc5275df53c765c450d570521c425c3345d9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 10:57:29 2015 +0200
Enable all deprecation warnings for test runs
We would like to catch all deprecation warnings during test runs to be
notified in advance about potential problems with next library releases
we depend on.
Change-Id: I876d8c4de88618b01898ab537a44920789d8178e
commit 734e77365b0f241a3cea0f3c9dfb1d5fcf6eac8c
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Apr 17 15:00:20 2015 -0700
Remove get\_admin\_roles and associated logic
get\_admin\_roles was introduced so that contextes generated from
within plugins could be used for policy checks. This was the case
up to the Havana release as several plugins invoked the policy
engine directly to authorize requests.
This was an incorrect behaviour and has now been fixed, meaning
that get\_admin\_roles is no longer need and can be safely removed.
This will result in a leaner and more reliable codebase. Indeed the
function being removed here was the cause of several bugs where the
policy engine was initialized too early in the server bootstrap
process.
While this patch removes the feature it does not remove the
load\_admin\_roles parameter from context.get\_admin\_context. Doing so
will break other projects such as neutron-lbaas. The parameter is
deprecated by this patch and an appropriate warning emitted.
As a consequence neutron's will now no longer perform policy checks
when context.is\_admin=True. This flag is instead set either when
a context is explicitly created for granting admin privileges, or
when Neutron is operating in noauth mode. In the latter case every
request is treated by neutron as an admin request, and get\_admin\_roles
is simply ensuring the appropriate roles get pushed into the context
so that the policy engine will grant admin rights to the request.
This behaviour is probably just a waste of resource; also it is not
adding anything from a security perspective.
On the other hand not performing checks when context.is\_admin is
True should not pose a security threat either in noauth mode or
with the keystone middleware. In the former case the software keeps
operating assuming admin rights for every requests, whereas in the
latter case the keystone middleware will always supply a context
with the appropriate roles, and there is no way for an attacker
to trick keystonemiddleware into generating a context for which
is\_admin=True.
Finally, this patch also does some non-trivial changes in test\_l3.py
as some tests were mocking context.to\_dict ignoring the is\_admin flag.
Closes-Bug: #1446021
Change-Id: I8a5c02712a0b43f3e36a4f14620ebbd73fbfb03f
commit 89c0875178f22651109a85d3c522d80324368caf
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon Jun 8 14:27:47 2015 +0300
Add documentations for VXLAN Tunnels
The VXLAN type driver is currently supported, this patch add
description and links for more information to the user.
Change-Id: Idb221ca4cce1a3a27bebe5ae6fc1e6ab5d030836
commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 19:03:29 2015 -0700
Defer segment lookup in NetworkContext object
Avoid call to get network segments for network context objects until
a caller actually tries to lookup the segments. This optimizes cases
where the user of a port context never looks at the segments of the
associated network context (e.g. update\_port\_status).
Closes-Bug: #1463254
Change-Id: I7e95f81d9a3ef26ccdb18c6bfdf9adc29523aa79
commit d0bbfc090bb25f1e05b98f0ad70c18209b87ed6b
Author: Zhenguo Niu <niuzhenguo@huawei.com>
Date: Tue Jun 9 08:28:45 2015 +0800
Fix typos in docs
Change-Id: I71aeb8f1e5fc5f3e330e593a463858dd65e6093b
commit b322ebae09cc59ed0a860ea6e39ed9b6fa6c5c12
Author: yuyangbj <yangyu@vmware.com>
Date: Wed May 13 14:07:36 2015 +0800
Fixes bulk insertion of data to ml2\_port\_binding
We should use schema definition to insert bulk of data to table.
Closes-Bug: #1454566
Change-Id: I66b3ee8c2f9fa6f04b9e89dc49d1a3d277d63191
commit 3a5a8a62c372f3a516caa59fd655dcf923a82519
Author: Kyle Mestery <mestery@mestery.com>
Date: Mon Jun 8 15:27:23 2015 +0000
Add Neutron PTL Office Hours
To ensure a weekly oppurtunity to sync between the PTL and the
Lieutenants, officially setup Neutron PTL Office Hours.
Depends-On: Ia5c8090e90939097104cb95c0aa3b883f7b4dd9b
Change-Id: Iab3c21764937ebb3a1d0553b3a3d42b5c44bf3cc
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 00899b56213753d523842f29d50353a067df6064
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 14:42:18 2015 +0000
Python3: Enable all working tests in tox.ini
Thanks to the recent Python3-related changes, these tests can now be run on
Python 3.
Change-Id: I7f689e221e59128012d46da2c90e61d5206fe828
Blueprint: neutron-python3
commit 725543684cbe0df0edc4b6924f85e63e1628fa92
Author: rossella <rsblendido@suse.com>
Date: Thu Mar 5 09:24:10 2015 +0000
Add get\_events to OVSDB monitor
OVSDB monitor can generate the events that the OVS agent
needs to process (device added or updated). Instead of
notifying only that a change occurred and that polling
is needed, pass the events to the agent
Change-Id: I3d17bf995ad4508c4c6d089de550148da1465fa1
Partially-Implements: blueprint restructure-l2-agent
commit b239f75644bfdfec86f8a8efdabd6b11b766e822
Author: shihanzhang <shihanzhang@huawei.com>
Date: Tue May 26 16:42:44 2015 +0800
Update ipset members when corresponding sg member is empty
if a security group has a rule with 'remote-group-id', the ports
in this security group should update its relevant ipset member
when the remote-group members is empty.
Change-Id: I980ebfd8f6537f803d9d5cbf21ca33f727fea3b3
Closes-bug: #1458786
commit 127de06c7e09e1468f2855a3033fb6193a6b9365
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 6 22:40:39 2015 +0200
Clean only floating-ip related connection states
Currently init\_l3 deletes connection states related to ALL ips deleted
in init\_l3 but it's required only when floating-ips are deleted[1].
This change deletes only connection states related to floating-ips
deleted in init\_l3 ... it avoids to delete connection states in dhcp
agents and on router internal ports!
[1] look at change Ia9bd7ae243a0859dcb97e2fa939f7d16f9c2456c
Closes-Bug: #1452434
Related-Bug: #1334926
Change-Id: Icfcfc585df6fd41de1e1345fd731e4631a6950ce
commit 713ba0e8d7ce59eaff41518360530b2e7831c322
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Thu Jun 4 22:25:44 2015 +0000
Refactor awkward logic in setup\_dhcp\_port
I noticed this logic as I was reviewing another patch set [1]. I
didn't like removing subnet ids from dhcp\_enabled\_subnet\_ids and I
wasn't too keen on the ips\_need\_removal semantics that were kind of
forced by the existing structure of the code. I hope you find this
alternative much clearer. I like straight-forward code with less
indentation that doesn't use awkward booleans like ips\_needs\_removal.
[1] https://review.openstack.org/#/c/157697/6
Change-Id: I8bd3d6924a855ea08f8096e66bd3bfbb165a4da3
commit 45b28ddfe8ac23871e65feb4132d5f048c783222
Author: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
Date: Fri Jun 5 13:05:48 2015 +0200
Fix typo in test class name
Make "Redering" -> "Rendering"
Change-Id: Ieedb446fa1e06705eb70293d83350d4dfd57d2db
Signed-off-by: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
commit 359b7c971a88f6dff64e8e4d558210a880f3ee0f
Author: Ian Wienand <iwienand@redhat.com>
Date: Thu May 7 14:59:38 2015 +1000
Ensure netfilter is enabled for bridges
Since security-groups use iptables rules on Linux bridges, we need to
ensure that netfilter is enabled for bridges. Unfortunately, there
seems to be a long history of distributions having differing defaults
for this, best described in [1].
It seems at the moment everyone has to discover this for themselves;
packstack found it in Ia8c86dcb31810a8d6b133a161388604fde9bead4, then
fuel found the same thing in I8582c24706c3a7253e00569eef275f116d765bca
and then finally someone else hit it and put it into documentation
with I4ed3cec03a1b3a7d56dfe18394154ec1b2db6791. I just spent a long
time figuring it out too when deploying with devstack.
Rather than having yet another fix in devstack, I don't see why
neutron shouldn't be ensuring the setting is correct when it starts up
-- without these settings enabled, security-groups are silently
broken. This does that, and modifies test-cases to check we make the
calls.
[1] http://wiki.libvirt.org/page/Net.bridge-nf-call\_and\_sysctl.conf
Change-Id: If2d316eb8c422dc1e4f34b17a50b93dd72993a99
commit 3682e3391f188845d0c7f382f0ccd4b38db3904e
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon May 4 23:36:19 2015 +0200
Ensure non-overlapping cidrs in subnetpools without galera
\_get\_allocated\_cidrs[1] locks only allocated subnets in a subnetpool
(with mysql/postgresql at least). It ensures we don't allocate a cidr
overlapping with existent cidrs but nothing disallows a concurrent
subnet allocation to create a subnet in the same subnetpool.
This change replaces the lock on subnetpool subnets by a lock on the
subnetpool itself. It disallows to allocate concurrently 2 subnets in
the same subnetpool and ensure non-overlapping cidrs in the same
subnetpool.
Moreover this change solves a trouble with postgresql which disallows
to lock an empty select with an outer join: it happens on first subnet
allocation in a subnetpool when no specific cidr is provided. Moving
the lock ensures the lock is done on a non-empty select.
But this change does not ensure non-overlapping cidrs in subnetpools
with galera because galera doesn't support SELECT FOR UPDATE locks. A
follow-up change will (try to?) remove locks from subnet allocation[1]
in order to ensure non-overlapping cidrs in subnetpools also with galera.
[1] in neutron.ipam.subnet\_alloc.SubnetAllocator
Closes-Bug: #1451558
Partial-Bug: #1451576
Change-Id: I73854f9863f44621ae0d89c5dc4893ccc16d07e4
commit 3d2543d710c7071ffeb5c9857ac30a4d95695a7b
Author: dql <duquanglong@gmail.com>
Date: Mon Mar 9 12:52:11 2015 +0800
fix DHCP port changed when dhcp-agent restart
When DHCP server is started, the periodic task is running
before loading cache state.The method port\_update\_end
need to use the cache information, but the cache information
has not been loaded.
Change-Id: I0d1da11bb559b7f0f9d4428b82573fb26916a933
Closes-Bug: #1420042
commit 6d15bf48ee27ceab64e88f81ba6433058313759a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 9 00:52:29 2015 +0200
Remove from BridgeDevice homemade execute in namespace
Currently BridgeDevice[1] defines homemade execute with namespace
support but could use IPWrapper. This change replaces homemade
implementation with IPWrapper use to respect DRY principle.
[1] neutron.agent.linux.bridge\_lib
Change-Id: I12d4d40432e57ce8b6960276c41321c1efd98705
commit 7260e0e3fc2ea479e80e0962624aca7fd38a1f60
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Apr 27 09:59:21 2015 -0400
Run radvd as root
During the refactoring of external process management radvd lost
its root privileges.
Closes-bug: 1448813
Change-Id: I84883fe81684afafac9b024282a03f447c8f825a
(cherry picked from commit a5e54338770fc074e01fa88dbf909ee1af1b66b2)
commit 4e71c48bbfd5e8b8c59f0c45ade52ba8eddc8b63
Author: rossella <rsblendido@suse.com>
Date: Thu Jan 15 16:15:23 2015 +0100
Add devices to update in RPC call security\_groups\_provider\_updated
When a security\_groups\_provider\_updated is received then a global
refresh of the firewall is performed. This can be avoided if the
plugins pass as parameter of the call the devices that belongs to
the network updated.
Partially-Implements: blueprint restructure-l2-agent
Change-Id: I1e78f3a5ec7e5c5bcba338a0097566422411ef7e
commit d37e566dcadf8a540eb5f84b668847fa192393a1
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Apr 24 00:35:31 2015 -0700
Don't resync on DHCP agent setup failure
There are various cases where the DHCP agent will try to
create a DHCP port for a network and there will be a failure.
This has primarily been caused by a lack of available IP addresses
in the allocation pool. Trying to fix all availability corner cases
on the server side will be very difficult due to race conditions between
multiple ports being created, the dhcp\_agents\_per\_network parameter, etc.
This patch just stops the resync attempt on the agent side if a failure
is caused by an IP address generation problem. Future updates to the subnet
will cause another attempt so if the tenant does fix the issue they will
get DHCP service.
Change-Id: I0896730126d6dca13fe9284b4d812cfb081b6218
Closes-Bug: #1447883
(cherry picked from commit db9ac7e0110a0c2ef1b65213317ee8b7f1053ddc)
commit 38211ae67cb76ade85b08c028b6e88bfc867afc9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Apr 20 17:06:38 2015 +0200
tests: confirm that \_output\_hosts\_file does not log too often
I3ad7864eeb2f959549ed356a1e34fa18804395cc didn't include any regression unit
tests to validate that the method won't ever log too often again,
reintroducing performance drop in later patches. It didn't play well
with stable backports of the fix, where context was lost when doing the
backport, that left the bug unfixed in stable/juno even though the patch
was merged there [1].
The patch adds an explicit note in the code that suggests not to add new
log messages inside the loop to avoid regression, and a unit test was
added to capture it.
Once the test is merged in master, it will be proposed for stable/juno
inclusion, with additional changes that would fix the regression again.
Related-Bug: #1414218
Change-Id: I5d43021932d6a994638c348eda277dd8337cf041
(cherry picked from commit 3b74095a935f6d2027e6bf04cc4aa21f8a1b46f2)
commit 53b3e751f3c7b32bed48c14742d3dd3a1178d00d
Author: Maru Newby <marun@redhat.com>
Date: Thu Apr 9 17:00:57 2015 +0000
Double functional testing timeout to 180s
The increase in ovs testing is resulting in job failure due to
timeouts in test\_killed\_monitor\_respawns. Giving the test more
time to complete should reduce the failure rate.
Change-Id: I2ba9b1eb388bfbbebbd6b0f3edb6d5a5ae0bfead
Closes-Bug: #1442272
(cherry picked from commit 81098620c298394e1a98127ceeba7f297db2d906)
commit 0536ec113bc438265ba547bb8a8006aa96e646e3
Author: watanabe.isao <zou.yun@jp.fujitsu.com>
Date: Wed Apr 15 15:48:08 2015 +0900
Restrict subnet create/update to avoid DHCP resync
As we know, IPs in subnet CIDR are used for
1) Broadcast port
2) Gateway port
3) DHCP port if enable\_dhcp is True, or update to True
4) Others go into allocation\_pools
Above 1) to 3) are created by default, which means if CIDR doesn't
have that much of IPs, subnet create/update will cause a DHCP resync.
This fix is to add some restricts to the issue:
A) When subnet create, if enable\_dhcp is True, /31 and /32
cidrs are forbidden for IPv4 subnets while /127 and /128 cidrs are
forbidden for IPv6 subnets.
B) When subnet update, if enable\_dhcp is changing to True and there are no
more IPs in allocation\_pools, the request should be denied.
Change-Id: I2e4a4d5841b9ad908f02b7d0795cba07596c023d
Co-authored-by: Andrew Boik <dboik@cisco.com>
Closes-Bug: #1443798
(cherry picked from commit 0c1f96ad5a6606c1205bd50ea944c3a383892cde)
commit cbfb3e487d97998ec49d7faa751bc26202da7d0e
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Apr 20 22:26:22 2015 -0700
Only update MTU in update code for MTU
The ML2 create\_network\_db was re-passing in the entire network
with extensions like vlan\_transparency present that was causing
issues in the base update function it was calling.
This corrects the behavior by having it only update the MTU, which
is the only thing it was intending to update in the first place.
Change-Id: I723c5c138e0830de98f6024c7635ec65065e9346
Closes-Bug: #1446784
(cherry picked from commit f85de393c469d1e649a1c1e5ee1b683246442351)
commit 9bc812e92fb27b297ccfe960267dcab173aea6c9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Apr 23 02:15:06 2015 +0000
Updated from global requirements
Change-Id: I514c65fac38ef0e534e7401a5f3643b1906adea7
commit 407be289360ec6dabbbe14d9b18dae7c9fa2db79
Author: Kawaguchi <ken-kawaguchi@vt.jp.nec.com>
Date: Tue Apr 21 13:27:52 2015 +0900
Fix typo acomplished => accomplished
Change-Id: I73722e9984917a5a8c4e74207cf14d4040a7cf2f
Related-Bug: #1390035
commit b339391bcb223c0f03d30f36dea47d13adb12c71
Author: mathieu-rohon <mathieu.rohon@gmail.com>
Date: Sat Mar 7 13:30:49 2015 +0100
ML2: Change port status only when it's bound to the host
Currently, nothing prevents the port status to be changed to BUILD
state when get\_device\_details() is sent by a host that doesn't own
the port.
In some cases the port might stay in BUILD state.
This could happen during a live-migration, or for multi-hosted ports
such as HA ports.
This commit allows the port status modification only if the port
is bound to the host that is asking for it.
Closes-Bug: #1439857
Closes-Bug: #1438040
Closes-Bug: #1416933
Change-Id: I9b3673f453abbafaaa4f78542fcfebe8dc93f2bb
(cherry picked from commit 9b53b82ce7dad551ebc0f02ff667d5345fb7e139)
commit f7ae3a04b541767c638fc4c8ff1e0db78ab94996
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:07:37 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Change-Id: I1b7bd1773bcd12ab282e77ee0dc41c27846fb66b
commit e2f6902315de76a1020aa87ea161c8fdc6697ed7
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Tue Apr 14 21:34:33 2015 -0700
Fixes race condition and boosts the scheduling performance
This patch fixes a race-condition that occurs when the
scheduler tries to check for dvr serviceable ports before
it schedules a router when a subnet is associated with
a router.
Sometimes the dhcp port creation is delayed and so the
router is not scheduled to the l3-agent.
Also it boosts the scheduling performance on dvr-snat
node for scheduling a router.
This patch will provide a work around to fix this race
condition and to boost the scheduling performance
by scheduling a router on a dvr-snat when
dhcp is enabled on the provided subnet, instead of checking
all the available ports on the subnet.
Closes-Bug: #1442494
Change-Id: I089fefdd8535bdc9ed90b3230438ab0bfb6aab4f
(cherry picked from commit c65d3ab6ad4589e6e4a6b488d2eb5d1e4cfee138)
commit a6b2c22dcea73754dbfd0ef39c60ad28ab2dbb73
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Mar 30 23:52:56 2015 -0700
Set IPset hash type to 'net' instead of 'ip'
The previous hash type was 'ip' and this caused a major
issue with the allowed address pairs extension since it
results in CIDRs being passed to ipset. When the hash type
is 'ip', a CIDR is completely enumerated into all of its
addresses so 10.100.0.0/16 results in ~65k entries. This
meant a single allowed\_address\_pairs entry could easily
exhaust an entire set.
This patch changes the hash type to 'net', which is designed
to handle a CIDRs as a single entry.
This patch also changes the names of the ipsets because
creating an ipset with different parameters will cause an
error and our ipset manager code isn't robust enough to handle
that at this time. There is another ongoing patch to fix
that but it won't be ready in time.[1]
The related bug was closed by increasing the set limit, which
did alleviate the problem. However, this change would also
address the issue because the gate tests run an allowed address
pairs extension test with the CIDR mentioned above.
1. I59e2e1c090cb95ee1bd14dbb53b6ff2c5e2713fd
Related-Bug: #1439817
Closes-Bug: #1444397
Change-Id: I8177699b157cd3eac46e2f481f47b5d966c49b07
(cherry picked from commit a38b5df5cd3c47672705aad4c30e789ae11ec958)
commit 8b8095e43a143426c501669167490d7867a55749
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Mar 31 08:53:56 2015 -0700
Revert "Add ipset element and hashsize tunables"
This reverts commit b5b919a7a3569ccb93c3d7d523c1edfaeddb7cb9.
The current ipset manager code isn't robust enough to handle
ipsets that already exist with different parameters. This reverts
the ability to change the parameters so we don't break upgrades
to Kilo.
Conflicts:
neutron/agent/linux/ipset\_manager.py
neutron/tests/unit/agent/linux/test\_ipset\_manager.py
Change-Id: I538714df52424f0502cb75daea310517d1142c42
Closes-Bug: #1444201
(cherry picked from commit 03be14a569d240865dabff8b4c30385abf1dbe62)
commit 2add4e5ad4d12c817737d04ddb973b3aeeb25af3
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Apr 16 16:27:38 2015 -0700
Update .gitreview to point to stable/kilo
This is the stable/kilo branch. When people make changes
here it's highly likely that they want to propose them
to stable/kilo on gerrit.
Change-Id: Ie61a9f0c0b0b4896da33a201e42b1c4bc4bae49b
commit ffc48f286e1756302d9259dc514dd562d3c251ba
Author: Henry Gessau <gessau@cisco.com>
Date: Thu Apr 16 13:38:46 2015 -0400
Add Kilo release milestone
Change-Id: Id7d969c92b7c757b766760681357ac13c8079ca3
commit 1dc98e414f200a78a6b1dc78f222c588646e6935
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Thu Apr 9 10:32:33 2015 -0400
IPv6 SLAAC subnet create should update ports on net
If ports are first created on a network, and then an IPv6 SLAAC
or DHCPv6-stateless subnet is created on that network, then the
ports created prior to the subnet create are not getting
automatically updated (associated) with addresses for the
SLAAC/DHCPv6-stateless subnet, as required.
Change-Id: I88d04a13ce5b8ed4c88eac734e589e8a90e986a0
Closes-Bug: 1427474
Closes-Bug: 1441382
Closes-Bug: 1440183
(cherry picked from commit bd1044ba0e9d7d0f4752c891ac340b115f0019c4)
commit 55536a4ecb6c71e5451b8a9664d87e32146f071d
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Apr 10 15:07:33 2015 +0200
Removed ml2\_conf\_odl.ini config file
The file is already packaged into decomposed networking-odl repo [1].
[1]: https://git.openstack.org/cgit/stackforge/networking-odl/tree/etc/neutron/plugins/ml2/ml2\_conf\_odl.ini
Closes-Bug: #1442615
Change-Id: Ic280454190aab4e3b881cde15a882808b652861e
(cherry picked from commit b3334eca0ae9f9c64ccd646035e69081f669e3e4)
commit 40783cee5e520173a4cc37c23dd97be2d37b65fd
Author: Angus Lees <gus@inodes.org>
Date: Mon Mar 2 17:06:54 2015 +1100
Ensure tests run under python2.7
tox uses whatever python version that tox ran with as the default python
version for environments (py27,py3x, etc are given a more specific
default).
Debian's python-tox (for example) uses python3, but we require python2.7
- and a naive `apt-get install python-tox; tox -epep8` fails with
py3-related errors on Debian.
This change explicitly sets `basepython = python2.7` in several testing
environments that would otherwise have used the default basepython.
Change-Id: I377ac6d72dec5b85c105d8a1a74f6974efb84dcf

| **tags**: | added: in-feature-qos |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-29:  [**Related fix proposed to neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/75) |  |  | [#75](/neutron/%2Bbug/1461054/comments/75) |
| --- | --- | --- | --- |

Related fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/196701>

Related fix proposed to branch: feature/pecan
Review: https://review.openstack.org/196701

[Vladimir Kuklin (vkuklin)](https://launchpad.net/~vkuklin)
on 2015-06-29

| **tags**: | added: 6.1-mu-1 |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-30:  [**Change abandoned on neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/76) |  |  | [#76](/neutron/%2Bbug/1461054/comments/76) |
| --- | --- | --- | --- |

Change abandoned by Kyle Mestery (<email address hidden>) on branch: feature/pecan

Review: <https://review.openstack.org/196701>

Reason: This is lacking the functional fix [1], so I'll propose a new merge commit which includes that one.

[1] <https://review.openstack.org/#/c/196711/>

Change abandoned by Kyle Mestery (mestery@mestery.com) on branch: feature/pecan
Review: https://review.openstack.org/196701
Reason: This is lacking the functional fix [1], so I'll propose a new merge commit which includes that one.
[1] https://review.openstack.org/#/c/196711/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-30:  [**Related fix proposed to neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/77) |  |  | [#77](/neutron/%2Bbug/1461054/comments/77) |
| --- | --- | --- | --- |

Related fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/196920>

Related fix proposed to branch: feature/pecan
Review: https://review.openstack.org/196920

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-30:  [**Related fix merged to neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/78) |  |  | [#78](/neutron/%2Bbug/1461054/comments/78) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1461054/comments/78/%2Bdownload) (171.5 KiB)

Reviewed: <https://review.openstack.org/196920>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=7f759c077f8f860c13db92d2ea6b353ef6b70900>

Submitter: Jenkins

Branch: feature/pecan

commit 8123144fadd7c5d5e6e56a76ea860512619a2cf6

Author: Moshe Levi <email address hidden>

Date: Sun Jun 28 14:37:14 2015 +0300

Fix Consolidate sriov agent and driver code

This patch add mising \_\_init to mech\_sriov/mech\_driver/

    and update the setup.cfg to the new agent entrypoint

Trivial Fix

Change-Id: I53a527081feb78472f496675bbb3c5121d38a14a

commit 8942fccf02e6e179d47582fdb2792a1ca972da21

Author: Assaf Muller <email address hidden>

Date: Mon Jun 29 11:38:51 2015 -0400

Remove failing SafeFixture tests

The fixtures 1.3 release attempted to fix the fixtures resource

    leak issue, but failed to do so completely. Our own SafeFixture

    is still needed: The 1.3 release broke our SafeFixture tests,

    but not the usage of SafeFixture itself. This patch removes

    those failing tests for now to unbreak the gate. Jakub reported

    a bug on fixtures 1.3:

    [https://bugs.launchpad.net/python-fixtures/+bug/1469759](https://bugs.launchpad.net/python-fixtures/%2Bbug/1469759)

We will continue to use SafeFixture until that bug is fixed

    in fixtures, at which point we will be able to require

    fixtures > 1.3.

Change-Id: I59457c3bb198ff86d5ad55a1e623d008f0034b8f

    Closes-Bug: #1469734

commit 71dffb0a2c1720cd8233a329d32958a0160dd6f5

Author: Kevin Benton <email address hidden>

Date: Mon Jun 29 08:27:41 2015 +0000

Revert "Removed test\_lib module"

This reverts commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f.

We pulled all of the plugins out of the tree, many of which still inherit

    from neutron test classes. This change then stated that we no longer

    support testing other plugins. I think this is a bit premature and should

    have been discussed under the subject

    "Neutron plugins can't use neutron plugin unit tests" or something

    similar.

Change-Id: I68318589f010b731574ea3bfa8df98492bab31fc

commit b20fd81dbd497e058384a0af065dd0f1fdc4c728

Author: Jakub Libosvar <email address hidden>

Date: Fri Jun 5 14:32:51 2015 +0000

Refactor NetcatTester class

Following capabilities were added:

       - used transport protocol is passed as a constant instead of bool

       - src port for testing was added

       - connection can be established explicitly

       - change constructor parameters of NetcatTester

As a part of removing bool for protocol definition

    get\_free\_namespace\_port() was also modified to match the behavior.

Change-Id: Id2ec322e7f731c05a3754a65411c9a5d8b258126

commit 83e37980dcd0b2bad6d64dd2cb23bcd2891cafca

Author: jingliuqing <email address hidden>

Date: Sat Jun 27 13:41:54 2015 +0800

Use REST rather than ReST

Change-Id: I06c9deaab58c5ec13bfeec39fb8fd4b1fe21f42d

commit 1b60df85ba3ad442c2e4e7e52538e1b9a1bf9378

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:34:38 2015 -0700

Add a double-mock guard to the base test case

Use mock to patch mock with a check to prevent multiple active

    patches to the...

Reviewed: https://review.openstack.org/196920
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=7f759c077f8f860c13db92d2ea6b353ef6b70900
Submitter: Jenkins
Branch: feature/pecan
commit 8123144fadd7c5d5e6e56a76ea860512619a2cf6
Author: Moshe Levi <moshele@mellanox.com>
Date: Sun Jun 28 14:37:14 2015 +0300
Fix Consolidate sriov agent and driver code
This patch add mising \_\_init to mech\_sriov/mech\_driver/
and update the setup.cfg to the new agent entrypoint
Trivial Fix
Change-Id: I53a527081feb78472f496675bbb3c5121d38a14a
commit 8942fccf02e6e179d47582fdb2792a1ca972da21
Author: Assaf Muller <amuller@redhat.com>
Date: Mon Jun 29 11:38:51 2015 -0400
Remove failing SafeFixture tests
The fixtures 1.3 release attempted to fix the fixtures resource
leak issue, but failed to do so completely. Our own SafeFixture
is still needed: The 1.3 release broke our SafeFixture tests,
but not the usage of SafeFixture itself. This patch removes
those failing tests for now to unbreak the gate. Jakub reported
a bug on fixtures 1.3:
https://bugs.launchpad.net/python-fixtures/+bug/1469759
We will continue to use SafeFixture until that bug is fixed
in fixtures, at which point we will be able to require
fixtures > 1.3.
Change-Id: I59457c3bb198ff86d5ad55a1e623d008f0034b8f
Closes-Bug: #1469734
commit 71dffb0a2c1720cd8233a329d32958a0160dd6f5
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Mon Jun 29 08:27:41 2015 +0000
Revert "Removed test\_lib module"
This reverts commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f.
We pulled all of the plugins out of the tree, many of which still inherit
from neutron test classes. This change then stated that we no longer
support testing other plugins. I think this is a bit premature and should
have been discussed under the subject
"Neutron plugins can't use neutron plugin unit tests" or something
similar.
Change-Id: I68318589f010b731574ea3bfa8df98492bab31fc
commit b20fd81dbd497e058384a0af065dd0f1fdc4c728
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Fri Jun 5 14:32:51 2015 +0000
Refactor NetcatTester class
Following capabilities were added:
- used transport protocol is passed as a constant instead of bool
- src port for testing was added
- connection can be established explicitly
- change constructor parameters of NetcatTester
As a part of removing bool for protocol definition
get\_free\_namespace\_port() was also modified to match the behavior.
Change-Id: Id2ec322e7f731c05a3754a65411c9a5d8b258126
commit 83e37980dcd0b2bad6d64dd2cb23bcd2891cafca
Author: jingliuqing <lawrancejing@gmail.com>
Date: Sat Jun 27 13:41:54 2015 +0800
Use REST rather than ReST
Change-Id: I06c9deaab58c5ec13bfeec39fb8fd4b1fe21f42d
commit 1b60df85ba3ad442c2e4e7e52538e1b9a1bf9378
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:34:38 2015 -0700
Add a double-mock guard to the base test case
Use mock to patch mock with a check to prevent multiple active
patches to the same target. Multiple patches to the same target
result in non-deterministic behavior when stopall() tries to
undo the patches.[1]
1. http://bugs.python.org/issue21239
Change-Id: I3dd3d561a0267d80f464c15d69a4258b0a5e8aba
Closes-Bug: #1468998
commit 78700ba70620f7b53b5ae71332cca853f5afa467
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 22:08:41 2015 -0700
Remove duplicated mock patch of ip\_lib
The functional tests for agents were patching ip\_lib in the
function to configure an agent, so any tests that relied on
multiple agents would patch ip\_lib multiple times.
Partial-Bug: #1468998
Change-Id: Ibccf586dea870ec222369c0876f17f8eaf9a1aca
commit f242b171e910da460b8d98182dc10c5840c2c7d0
Author: Kyle Mestery <mestery@mestery.com>
Date: Thu Jun 25 20:36:47 2015 +0000
Consolidate sriov agent and driver code
In preparation for decomposing the built-in reference implementation,
this commits consolidates the sriov agent and driver code into a
coherent place for it's life in the new repository. I've also given
the unit tests a new home.
DocImpact
UpgradeImpact
Partially-Implements: blueprint reference-implementation-split
Partial-Bug: #1468433
Closes-Bug: #1427317
Change-Id: Ic8b5215de76e191030228bc28773cd6535e889d8
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 724c78071da28bae838a4145a9d4cea42f853048
Author: Kyle Mestery <mestery@mestery.com>
Date: Wed Jun 24 19:12:06 2015 +0000
Restructure agent code in preparation for decomp
This commit moves the L2 agents (Linuxbridge and OVS) into the
ML2 directory, while at the same time also moving the ML2 server
bits into toplevel directories. It also moves the configuration
files and unit tests. We also move the l2pop RPC mixin while
here as well.
DocImpact
UpgradeImpact
Partially-Implements: blueprint reference-implementation-split
Partial-Bug: #1468433
Closes-Bug: #1427317
Change-Id: If6feca7b7a6bdd6c3c6feb929fa26fb4b1f72770
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 82fddfbb651911c7cb6818428ff7604c9745499c
Author: sridhargaddam <sridhar.gaddam@enovance.com>
Date: Mon Jun 22 14:13:56 2015 +0000
Fix ip\_lib get\_gateway for default gateway on an iface
Currently get\_gateway() of IpRouteCommand class always assumes
the presence of gateway\_ip when default\_route is seen.
Since we can also have interface routes without the gw\_ip,
this patch fixes the issue by parsing the output accordingly.
Closes-Bug: #1467531
Change-Id: Icf988994b61cbdeb1261c5a0887f29ced41ada07
commit 3c45132f256082252ae8726b560f807686620216
Author: Waldemar Znoinski <waldemar.znoinski@intel.com>
Date: Fri Jun 26 09:28:51 2015 +0000
fixing typo in gerrit query link in third party policies doc
Change-Id: Iaef37a58f85439a1a6c5c1ae071a223865479a8e
commit bd3604277f6a550d8757aa96a3164a189ab3af6d
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 06:50:48 2015 -0700
Use last address in v6 allocation pool generation
This reverts commit 1d61c5f736b9df7253a1939fe55f1875f988d1f4,
which reverted ee51ef72d37a02005a7733b7f2faf7236db850a1 due
to an issue with the allocation pools being mis-aligned with
the last address of a v6 subnet.
IPv6 does not have a subnet broadcast address so the last IP
address can be used as a regular address. This patch tweaks the
automatic allocation pool generation to include that last address
on v6 networks.
This was found because
NetworksTestDHCPv6.test\_dhcp\_stateful\_fixedips\_outrange makes the
assumption that the default generated pools cover the entire usable
address space.
Related-Bug: #1466322
Closes-Bug: #1468163
Change-Id: I5a2518c819757cd1fb43244901fe3e2f6c576b34
commit e120bad02841ed54ed071d82bffc47671f612137
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 25 16:52:08 2015 +0300
Extend SubnetRequestFactory to access subnet dict
SubnetRequestFactory incorporates logic for preparing arguments and
building right request.
Subnet dict, context and subnetpool are used to make decision on
what kind of reqest should be created.
SubnetRequestFactory can be overriden on ipam driver level,
it allows to easily extend existent Request model.
Partially-Implements: blueprint neutron-ipam
Change-Id: I9de120381172657a527bb35990d25525c41939ab
commit ba7d673d1ddd5bfa5aa1be5b26a59e9a8cd78a9f
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:31:38 2015 -0700
Remove duplicated call to setup\_coreplugin
The test case for vlan\_transparent was calling setup\_coreplugin
before calling the super setUp method which already calls
setup\_coreplugin. This was causing duplicate core plugin fixtures
which resulted in patching the dhcp periodic check twice.
Change-Id: Ide4efad42748e799d8e9c815480c8ffa94b27b38
Partial-Bug: #1468998
commit e64062efa3b793f7c4ce4ab9e62918af4f1bfcc9
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:29:37 2015 -0700
Remove double mock of dhcp agent periodic check
The test case for the periodic check was patching a target
that the core plugin fixture already patched out. This removes
that and exposes the mock from the fixture so the test case
can reference it.
Change-Id: I3adee6a875c497e070db4198567b52aa16b81ce8
Partial-Bug: #1468998
commit 25ae0429a713143d42f626dd59ed4514ba25820c
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:24:10 2015 -0700
Remove double fanout mock
The test\_mech\_driver was duplicating a fanout mock already setup
in the setUp routine.
Change-Id: I5b88dff13113d55c72241d3d5025791a76672ac2
Partial-Bug: #1468998
commit 993771556332d9b6bbf7eb3f0300cf9d8a2cb464
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 17:55:16 2015 -0700
Remove double callback manager mocks
setup\_test\_registry\_instance() in the base test case class gives
each test its own registry by mocking out the get\_callback\_manager.
The L3 agent test cases were duplicating this.
Partial-Bug: #1468998
Change-Id: I7356daa846524611e9f92365939e8ad15d1e1cd8
commit 0be1efad93734f11cd63fb3b7bd2983442ce1268
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 16:57:30 2015 -0700
Remove ensure\_dirs double-patch
test\_spawn\_radvd called mock.patch on ensure\_dirs after the
setup method already patched it out. This causes issues when
mock.patch.stopall() is called because the mocks are stored
as a set and are unwound in a non-deterministic fashion.[1]
So some of the time they will be undone correctly, but others
will leave a monkey-patched in mock, causing the ensure\_dir
test to fail.
1. http://bugs.python.org/issue21239
Closes-Bug: #1467908
Change-Id: I321b5fed71dc73bd19b5099311c6f43640726cd4
commit 6a1f8388d3f0ebd791aa1c466f5310efec5e83cc
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Tue Jun 23 14:01:29 2015 +0300
Decompose \_save\_subnet
Moved allocation pool generation and validation into separate method.
Partially-Implements: blueprint neutron-ipam
Change-Id: Ibe241c7b6389e444145b0600f8fcee28e478bc62
commit 0a2238e34e72c17ca8a75e36b1f56e41a3ece74e
Author: Sukhdev Kapur <sukhdev@aristanetworks.com>
Date: Thu Jun 25 15:11:28 2015 -0700
Fix tenant-id in Arista ML2 driver to support HA router
When HA router is created, the framework creates a network and does
not specify the tenant-id. This casuse Arista ML2 driver to fail.
This patch sets the tenant-id when it is not passed explicitly by
by the network\_create() call from the HA router framework.
Even though original issue was discovered for network\_create()
it turns out the same issue applies for port\_create() as well
so all the methods are fixed in this patch
Change-Id: Id03e26dac003fa589477ed78a4ed3c44cc2f708d
Closes-Bug: 1468828
commit 334d9a33404f4c8438d105f91bff1a9fd9236513
Author: Assaf Muller <amuller@redhat.com>
Date: Thu Jun 25 16:34:09 2015 -0400
Log OVS agent configuration mismatch
Change-Id: I55aef3bdc32dcee3436cb8b987fb796a4898b20e
Closes-Bug: #1468893
commit c48e12b781c9ffd885ebc96283ecda2849fd1e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 21:31:33 2015 +0200
Avoid env variable duplication in tox.ini
Some environment variables are defined multiple times in tox.ini. This
change defines "fake" tox jobs and refactors existing jobs to reduce
duplicated environment variables.
Change-Id: I0ccebea4fbfff8dda34d1ed348b96b3b8ebd59e2
commit 747738d36572079307f228a861a067ca0cd815c2
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 15:20:27 2015 -0700
Skip ARP protection if 0.0.0.0/0 in addr pairs
Don't setup ARP protection on ports with allowed address pairs
that allow them to use any IP address. This is necessary because
OVS doesn't support the /0 prefix in rules that match on ARP headers.
Related-Bug: #1461054
Closes-Bug: #1468009
Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec
commit 61909ac515c337c94f55805641b1b7c725a95191
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:54:34 2015 +0200
linuxbridge: clean up README file
It's weird that we suggest users to copy python files around instead of
relying on generated console\_scripts.
Other configuration information located here is trivial and is
documented elsewhere, f.e. [1].
[1]: http://docs.openstack.org/networking-guide/deploy\_scenario1b.html
Change-Id: Ie8dd37087599ff4b5e23f0ad01105f94f5b886ab
commit 0af5abdb1f608a5e84a64627adf42dd8d5526560
Author: John Davidge <jodavidg@cisco.com>
Date: Thu Jun 25 15:12:59 2015 +0100
Fix tox errors in thirdparty-ci docs
Fixes errors causing tox failures.
Change-Id: I361ef791c0de1aac1304bb8ad979066400930434
Closes-Bug: #1468765
commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:41:02 2015 +0200
Removed test\_lib module
It's not really needed. It was once used to allow some out-of-tox plugin
specific testing scripts to inject configuration files into
BaseTestCase.
Now, our testing story does not have any notion of out-of-gate plugin
specific testing, so let's just clean it up.
Change-Id: If287a38e80016b1dba049a2b745bad7af40583a8
commit 2557c47668ad822810aad523643014c6a5d4a064
Author: Russell Bryant <rbryant@redhat.com>
Date: Wed Jun 24 14:59:26 2015 -0400
Updated from global requirements
This patch takes the latest global requirements update from change
Ibcb49412a012f79be2f7fd697349ddbf43bd7b9b except takes out the update
to setup.py which reverts the windows specific requirements. We are
still working on getting the custom changes out of setup.py in change
I3c07c279d33f6aed46c3a97dd9ba81251e51429a.
Change-Id: Iee7612d39b520cf04e3b2ec503ec79d23f15f949
commit 4b4cedaf853664535c05d47c99c920e74d1deb3a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu Jun 11 22:12:01 2015 +0200
Define SafeFixture base fixture
Currenty useFixture(myfixture)[1] ensures to call myfixture.cleanUp only
if myfixture.setUp succeed.
This change defines a workaround to ensure cleanUp call even if setUp
fails until testtools/fixtures support it: SafeFixture[2] which ensures
cleanUp call if setUp fails and replaces fixtures.Fixture use by
SafeFixture. This workaround will be removed when the bug will fixed in
testtools and fixtures[3].
[1] testtools.TestCase.useFixture, fixtures.Fixture.useFixture
[2] neutron.tests.tools
[3] see related bugs
Change-Id: I875934e8dde321a450c83fb95d175affd1f3bb83
Closes-Bug: #1464410
Partial-Bug: #1453888
Related-Bug: #1456353
Related-Bug: #1456370
commit 2ecac909ba419f258e47b456196a1af7a87661ed
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu Jun 25 11:59:37 2015 +0000
Remove quantum untracked files from .gitignore
This change removes obsolete quantum untracked files from .gitignore.
Change-Id: I1ddf0b03d29066363f155dd5af8294efde5b0ef0
commit df06a326de39a6792e2e82eafa5cf50eb325b34e
Author: Matthew Booth <mbooth@redhat.com>
Date: Thu Jun 25 10:20:08 2015 +0100
Context class should initialise its own data
This is a trivial cleanup. A superclass was initialising data which
was only used in a subclass.
Change-Id: I6930fdaef3dcb960f6baaedbd191e22b565f319e
commit 2e1b0ea4032f05afef16efd451e2eea5df901d97
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 17:33:38 2015 +0200
ovsdb: attempt to enable connection\_uri for native impl on startup
The port is in most cases disabled, so to use it, we should first enable
it, and it means that we should still rely on ovs-vsctl for that initial
call.
Closes-Bug: #1468259
Change-Id: I097b1c441df1f7f1785b8744f27809617bb21c14
commit 668b12c2c8a60ce20ecdad2193ede9371d5cc391
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:58:41 2015 -0600
Move third-party CI policy under docs/policies
Change-Id: Ib2ed587670f206283d735191b3a2580bf3d1a04f
commit 3bf62772d39d8b3b8b518ae88a6fcea7414d6884
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:31:01 2015 -0600
Remove lbaas API tests, which are now in the lbaas repo
Change-Id: I2009ca3f102d0ca0db3f12af3012989f2a036c48
commit 1a480203b2531925d7520b62c94954064a26139d
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 24 10:28:18 2015 -0700
Only create one netaddr.IPNetwork object
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c663b8ac73
commit d9a23f882f0d78aaca34c3607d9ca9ad54ac063b
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 3 16:19:39 2015 -0700
Provide work around for 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager
which is called to convert the input.
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054
commit 93d564223e8b76d10aa7b55f1b1d49f592d1c800
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 09:19:18 2015 -0700
Fix >80 char lines that pep8 failed to detect
Change-Id: I602e0d484c5e00eb48b86c4c8c4eff0be195c3a5
commit 830e9114817765efc93c772dcbc735a6bb28a7ff
Author: Anthony Chow <vCloudernBeer@gmail.com>
Date: Tue Jun 23 22:05:23 2015 -0700
Deprecate "router\_delete\_namespaces" and "dhcp\_delete\_namespaces"
These 2 configuration options are no longer be necessary.
They are marked as deprecated in this release and will be removed in the
next release.
Change-Id: I4e02a291738b16c7c9b7600f0bc9a47fb1318569
Partial-Bug: #1418079
commit a84ef9ae54a7dfe6d9dee54a01b189dd40bce423
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 03:27:16 2015 -0700
Make DHCPv6 out of bounds API test deterministic
The test\_dhcp\_stateful\_fixedips\_outrange API test was randomly
picking an IP from last + 1 up to last + 10 in the allocation
range. This made it fail randomly when there was an issue related
to the subnet allocation having an off-by-one issue.
This adjusts the test to just always test last +1 and +2.
Related-Bug: #1468163
Change-Id: I641ab092e0ea0aae67ec717b492118a2f8a6f4fd
commit f527f8cf426ee63b592225d5e691ac107085784d
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 02:15:29 2015 -0700
Don't process network\_delete events on OVS agent
There is no reason to reclaim the local VLAN on a network\_delete
event since it will be reclaimed when the last port is deleted anyway.
This method was racey with recent port creation events and lead to
occasional traces when it would yank the local VLAN out from underneath
an ongoing port wiring process.
Change-Id: I5eee6175c053006b35b6efe274d27931a9d5d89f
Closes-Bug: #1468251
commit 1d61c5f736b9df7253a1939fe55f1875f988d1f4
Author: Henry Gessau <gessau@cisco.com>
Date: Wed Jun 24 03:16:52 2015 +0000
Revert "Fix subnet creation failure on IPv6 valid gateway"
Because it breaks tests.api.test\_dhcp\_ipv6.NetworksTestDHCPv6.test\_dhcp\_stateful\_fixedips\_outrange
This reverts commit ee51ef72d37a02005a7733b7f2faf7236db850a1.
Change-Id: Id02d9034ca809f194ff7551167bfda3559fb1200
commit 7eb9d9d316d35840706a767576ff083c9a04d781
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 00:08:22 2015 +0200
Support oslo\_db 1.12
oslo\_db 1.12[1] decorates oslo\_context.context.RequestContext with
session management[2][3] and add a read-only attribute 'session'. Such
feature breaks Brocade plugin and its unittests because they define
on RequestContext the 'session' attribute which now is a read-only
property. This change uses neutron.context instead of
oslo\_context.context in order to delegate session management to the
neutron.context and remove read-only attribute set.
A follow-up change will refactor neutron.context in order to use oslo\_db
1.12 session management instead of homemade one.
[1] https://github.com/openstack/oslo.db/releases/tag/1.12.0
[2] https://github.com/openstack/oslo.db/commit/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6
[3] https://github.com/openstack/oslo.db/blob/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6/oslo\_db/sqlalchemy/\
enginefacade.py#L782
Closes-Bug: #1468128
Change-Id: I0e3331f9a383fa2562706eeadb229f55593b888c
commit ad86291408fc74827c2bd31f89a2dce34f887823
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 23 15:28:34 2015 +0000
Python 3: do not use itertools.izip
This no longer exists in Python 3. Use the zip function instead.
Blueprint: neutron-python3
Change-Id: Id7d33ec3d27a27f17040d28bead10f2eb3b831bb
commit d23a59f1c808c50575f49f9291bd70c6b3a5797a
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Thu Jun 18 19:09:05 2015 +0000
Override opportunistic database tests to PyMySQL
Set the OS\_TEST\_DBAPI\_ADMIN\_CONNECTION override variable so that
oslo.db opportunistic detection will know to use PyMySQL until
I12b32dc097a121bd43991bc38dd4d289b65e86c1 makes it the default
behavior.
This change removes previous code[1] enabling PyMySQL use.
[1] Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
Change-Id: Ic39feee0248f2ffabdba26f3779ab40a8f3838e6
Co-Authored-By: Victor Sergeyev <vsergeyev@mirantis.com>
Co-Authored-By: Cedric Brandily <zzelle@gmail.com>
commit 04d44cee63f3fbba45956abd28f325d5ac3ca2d9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 23 20:00:30 2015 +0200
Extend default setenv instead of replacing it in tox.ini
Some tox jobs[1] define their own setenv without extending/referencing
default setenv, it disallows to define environment variables shared by
all jobs. This change updates previous jobs[1] in order to extend
instead of replacing default setenv and enable global environement
variables (used in daughter change).
One remark, this change sets VIRTUAL\_ENV environment variable in updated
jobs[1] but it has no effect on them.
[1] (dsvm-)functional, (dsvm-)fullstack and api jobs
Closes-Bug: #1468059
Change-Id: I99184f7375571fb8569a24ba04ae267108f5da08
commit 0a82b8ae1951073ff5f9b096485b3acf1a541428
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Fri Apr 24 16:58:48 2015 -0700
Fix FloatingIP Namespace creation in DVR for Late Binding
DVR has dependency on the portbinding host to determine
where to start the FloatingIP Namespace when floatingip
is configured. But when we assign a floatingip to a port
that is not bound, even though the API will succeed, the
FloatingIP Namespace will not be created by the Agent and
so the FloatingIP will not be functional.
This patch addresses the issue by creating the Namespace
and configuring the rules when the late binding happens.
The agent will be requesting the FIP agent gateway port,
if required and then proceed to configure the FloatingIP
Namespace.
Change-Id: I9b9158bddb626c2bb535acd709452560546fd184
Closes-Bug: #1447034
Closes-Bug: #1460408
commit b7dc34ef15061577158eeafc179915e5bde73c64
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 14:28:59 2015 +0200
Cleanup get\_plugin\_name() from the tree
It does not seem to be used since Icehouse: the patch that removed its
last usage is: 1b36e2077141749495bb32b423f3df8cbbd0eb40
I don't think we should have it as part of abstract interface for
service plugins.
Change-Id: If03f67a617efd3a7cadb96d1a86283ac14088a83
commit 277d89b67a6a8ea4f6a7bc216014d55ace5c1d2d
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Tue Jun 23 12:07:43 2015 +0300
Bulk move methods to ipam\_backend\_mixin.py
ipam\_backend\_mixin contains methods common for both backends:
pluggable and non-pluggable, so moving methods to make them accessible
by backends.
Next methods were moved from db\_base\_plugin\_v2.py to
ipam\_backend\_mixin.py:
- \_validate\_subnet\_cidr
- \_validate\_network\_subnetpools
- \_allocate\_pools\_for\_subnet
- \_save\_subnet
This commit moves methods without any internal changes.
All future changes and decomposition of these methods will be handled in
next commits.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1ec786754467fc9039d2276f084f1bceaab15635
commit c384b13ae6b83a8bad944972c60bdcbe6f4fa050
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Apr 16 16:20:01 2015 -0400
Add IPset cleanup script
This will aid in removing stale IPsets when we change the prefix
used in creating IPset names.
Change-Id: Ia9ff79c34bd4c9124ec8663a8f616ded4f389f62
Partial-Bug: #1444201
commit 7e117c13fd3fb125c857dadfa2945799b39e1634
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Thu Jun 18 11:22:13 2015 -0600
Optimize ipset usage in IptablesFirewallDriver
Currently, IptablesFirewallDriver.\_update\_ipset\_members() iterates
through a list of security group IDs and makes a call to
IpsetManager.set\_members() for each security group ID in the list. The
problem is that set\_members() is repeatedly called with the same
arguments over and over again because the list of security group IDs
contains duplicates. These duplicated calls are unnecessary because they
are idempotent.
For instance, with a security group of 50 rules created in this manner:
neutron security-group-rule-create $SECGRP --remote\_group\_id $SECGRP
--protocol tcp --port\_range\_min $i --port\_range\_max $i
Adding a server to that security group will cause 50 calls to
IpsetManager.set\_members() because the list of security group IDs is 50 of
the same ID. Only one call to IpsetManager.set\_members() is necessary
per security group ID.
This patch converts that list of security group IDs into a set, which
eliminates the duplicate idempotent calls to
IpsetManager.set\_members() with the same arguments. This will affect
performance by reducing the amount of file locking around ipset when
adding servers to security groups.
Change-Id: Id2c8c8c1093c8abcf1fd897b23b0358aeb55b526
Closes-Bug: 1466921
commit f44800f1eb649d83a338d320020d3479fc3b6790
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 22 14:59:59 2015 +0000
Python3: do not set Request.body to a text string
In Python 3, Request.body must be set to a bytes object.
Change-Id: I17785d1e9eb253a1c6cae300b207fb0a08873b0e
Blueprint: neutron-python3
commit 408af3f7dab477517b1761aeda2b76384f5fffbe
Author: Assaf Muller <amuller@redhat.com>
Date: Sun Jun 21 15:34:21 2015 -0400
Prepare for full stack CI job
Related-Bug: #1467275
Change-Id: I90f4794f48ae151a888f37df26c087a7fdcd9d31
commit 76b4803530c0d5f47659aa519585178cc33cba46
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Tue Jun 2 16:14:40 2015 +0300
Fix callback registry notification for security group rule
Some housekeeping was done in
- SecurityGroupDbMixin:
- create\_rule\_bulk() calls to create\_rule();
- registry notification is in create\_rule();
- separate validation for a single rule and for a group of rules
- SecurityGroupServerRpcMixin:
- overriden methods call to corresponding super class methods;
Hopefully code is now self-documented enough
Closes-Bug: #1461024
Change-Id: Ia75d7e206716bbe74aae89e4cebd0c2c40af68a8
commit 0faf4a264525ade97cd6c0ba6b3f34fceb88c210
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 22 13:02:17 2015 +0000
Python3: do not use \_\_builtin\_\_
It has been replaced with builtins in Python 3. Use six.moves.builtins, since
it works with Python 2 and 3.
Change-Id: I9e1b0060a5b18116d991cafb1de085d4d084db38
Blueprint: neutron-python3
commit 6da2d24ff44cbc8dd0ea8d2e6f72419a46026989
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 22 15:43:20 2015 +0200
Ease debugging alembic by passing proper scripts path in alembic.ini
Otherwise, anyone who attempts to issue an alembic command with the file
gets:
FAILED: Path doesn't exist:
'<...>/neutron/neutron/db/migration/alembic'. Please use the 'init'
command to create a new scripts folder.
Change-Id: I5b5f2802b478c8d8c327d24faa838f7a6859b979
commit fe6654b25044de7d7d15573c689a0f003c018e99
Author: Martin Roy <mroy@iweb.com>
Date: Thu Jun 18 13:45:02 2015 -0400
Use string exception casting everywhere
Instead of the deprecated "message" member access,
casting to a string invokes the \_\_str\_\_ method of the exception
that is wired to return the message
Added a test of the failure cases of IpRouteCommand::delete\_gateway
because they were missing
Running unit and functional tests locally no longer shows the warning
reported in the bug.
Change-Id: Ia79f526aa973ece1145615d65349f860aa3fd465
Closes-Bug: #1466542
commit c3d65a0ed920110223e1b73d6982968552ca7716
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Tue Mar 3 17:08:48 2015 +0800
Switch to oslo\_utils.uuidutils
Get rid of oslo-incubator uuidutils
Closes-Bug: #1467020
Depends-On: I2df519965883b05d5d58cdc4785c850b0685dc2c
Depends-On: I9f8e98ad9517864a9ffdacf01c0a9a5aab554edb
Depends-On: Ied0faac809a5b72b1cd466c8babc9ca5418692c3
Change-Id: Iebe491b981b4b7c02785412fadd27678bb5e47de
commit ee51ef72d37a02005a7733b7f2faf7236db850a1
Author: David Edery <david.edery@alcatel-lucent.com>
Date: Sun Jun 21 15:59:49 2015 +0300
Fix subnet creation failure on IPv6 valid gateway
Currently a valid IPv6 address gateway of the "\*::ffff:ffff:ffff:ffff"
pattern is failing due to netaddr.broadcast returning value for both IPv6
and IPv4 addresses. IPv6 has no broadcast address so the fix checks if
the gateway is the subnet broadcast address only in the case of IPv4
subnet
Change-Id: I849f95b30343d0b1c90cf91203df220bf731d8d5
Closes-Bug: 1466322
commit b9e551936410eca647b48c48f49f2b2be5d2d4a4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Fri Jun 19 17:58:57 2015 +0300
Decompose \_create\_subnet\_from\_pool
Moved validations into separate methods:
- \_validate\_pools\_with\_subnetpool
Verifies that allocation pools are set only for specific subnet request.
For any subnet request allocation pools can not be set manually
- \_validate\_ip\_version\_with\_subnetpool
Verifies that subnet has the same ip version as subnet pool
Partially-Implements: blueprint neutron-ipam
Change-Id: I63f6aa2a0c94c3437fa624ac800943976f4fc50f
commit 29bb401973af81f4a4b8a667f8b7445e19e017da
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 15:24:44 2015 +0300
Move \_delete\_port
Pluggable ipam implementation will do additional actions on port
deletion (deallocate ip using ipam driver).
Existing \_delete\_port code will be resused.
Moving \_delete\_port to ipam\_backend\_mixin to make this code
accessible and extendable by both backends (pluggable and non
pluggable).
This commit is a preparation step before pluggable ipam implementation
can be used.
Partially-Implements: blueprint neutron-ipam
Change-Id: If6cd623aad9e5501a26e5fb8cdecd5f55e85cd05
commit c0ef7a8f4546cd3c081a61c742dd9ed70ec2c147
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:52:24 2015 +0300
Decompose create\_port and save\_subnet
This commit is a preparation step for enabling pluggable ipam.
Some actions in create\_port and save\_subnet are specific for
non pluggable ipam implementation.
- create\_port
Moved allocation ips for port and storing results into separate method
\_allocate\_ips\_for\_port\_and\_store.
Moved to ipam\_non\_pluggable\_backend, since pluggable implementation will
be different due to rollback on failure logic included.
- save\_subnet
Moved saving allocation pools into new method \_save\_allocation\_pools.
Moved to ipam\_non\_pluggable\_backend, since pluggable ipam implementation
does not need to save IPAvailabilityRange (availability ranges are
maintained by ipam driver for pluggable case)
Partially-Implements: blueprint neutron-ipam
Change-Id: I4a3e5d7f3aa54630279d9589225a509c96ed2186
commit 3c72832c8b84af673722a34bba25eefc82154b47
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Jun 15 23:10:09 2015 -0700
Retry port status update on StaleDataError
During update\_port\_status, a port may be concurrently updated/deleted
by another process, which will result in a StaleDataError being
thrown. In the event it was an update, we want to retry to make sure
the port status is set to the desired state so third parties like Nova
get notified.
This patch uses the oslo\_db wrap\_db\_retry decorator after converting
the StaleDataError into a RetryRequest that the decorator can catch.
Closes-Bug: #1465407
Change-Id: I0a9230d30f435ec3d48f033136e85c40ad489ef9
commit ee14186fbb2486f9088103e9621bc366cc64c552
Author: Henry Gessau <gessau@cisco.com>
Date: Sun Jun 21 01:30:05 2015 -0400
Allow setting Agents description to None
Fix the validator for the 'description' attribute of Agents, allowing
it to be set to None.
Fix an API test that had two problems:
1. It was not restoring the description to the agent it had updated
2. It was retoring the description to '' instead of None.
Closes-Bug: #1466642
Change-Id: I50723e1346be0953d26216ba24907bac008ccfb6
commit d0d62927e661c84003845a61d2b991a54e723ed4
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Sat Jun 20 11:55:27 2015 +0000
Fix RPC version to be a string
The RPC version was being passed as a float which caused an
exception.
Change-Id: I2a2888fcafcc426009fc841b81049a22e072ce75
Closes-Bug: #1467087
commit 35654ec23ef9db6bda313ea300ab76c287a98ceb
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon May 25 15:20:05 2015 +0300
Decompose DVR CSNAT L3 Agent from Compute Node L3 Agent
Currently the same dvr router class is used both by the L3 Agent
in the compute nodes that is responsible for the virtual routers
namespace and the fip namespace and also used by the centralized
SNAT L3 Agent in the network node.
This is the first step to decompose the two into different
classes.
The above means that we have one class of DVR router which is used
for two jobs (the virtual router namespace wiring and the fips wiring
in the compute node in one hand and the centralized snat wiring in the other)
The end goal of this patch is to separate the two into different classes
which will also help maintaining it and also help projects that want
to use one but not the other (for example only use the centralized
SNAT behaviour with there own DVR implementation)
Change-Id: I581a097b9e7c49f20d0eb0e4ca66a25e90d9511b
Partial-Bug: #1458541
Partially-Implements: blueprint dvr-router-code-decompose
commit 0e48d9d203619f50adae94ddb6bbccd28f381737
Author: Davanum Srinivas <davanum@gmail.com>
Date: Sun Jun 7 10:10:18 2015 -0400
cleanup openstack-common.conf and sync updated files
Periodic update of latest files from oslo-incubator
Change-Id: Ie7eb02e4e9277c18abfb438b6cf710e0aa426b15
commit 74b0c53da5d7e4305606c100becf34966d8af350
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Jun 11 13:38:55 2015 +0300
Fix l3 agent to not create already deleted router
In case router is deleted during l3 agent resync,
the "deleted" event is processed with higher priority, then
resync event for the router may be processed which will recreate
already deleted router.
This happens due to timestamp not being properly updated for deleted
router in router processor.
The fix adds timestamp update for deleted router.
Functional test will be updated in a follow-up patch
Logging was improved to make debugging a bit easier.
Closes-Bug: #1455439
Change-Id: I2d060064acccc10591a3d90be9011f116548cfce
commit 4f5171d2cedb32fdc5a59d241e7ae91c7284b75c
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:24:34 2015 +0000
Python3: do not use '+' on dict\_items objects
In Python 3, dict.items() returns an iterator. Iterators cannot be added.
Blueprint: neutron-python3
Change-Id: I487178ebceae9946cb53dea1e847d7715f4577f3
commit b336b7c438f3f5d4ee8d23d6bb2d2cf8fe1657f4
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Fri Jun 19 15:52:35 2015 +0200
Disable keepalived process in keepalived func test
Previously, keepalived process itself was disabled that lead to
respawning of keepalived by KeepalivedManager. This patch disables
KeepalivedManager in cleanup thus no respawn happens.
Closes-Bug: #1466873
Change-Id: If5524116e5d4fc41600920d31481282c5b797f7b
commit a4b17cbb80b48c8e4bcd7cc005139f8e66066d68
Author: Cyril Roelandt <cyril@redhat.com>
Date: Thu Jun 18 11:52:28 2015 +0000
Python3: do not use im\_self/im\_func/func\_closure
One should use \_\_self\_\_, \_\_func\_\_ and \_\_closure\_\_ instead, as they work
with both Python 2 and 3.
Change-Id: I2b2847cfd5b4fa70e45387ff369240227ce9e526
Blueprint: neutron-python3
commit 432567f9477eadd840e407c5c057fc664e46d731
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 15:48:09 2015 +0300
Add request factory for pluggable IPAM
Pluggable IPAM implementation requires separation between requesting
address/subnet and it's actual allocation, which can happen on
third-party IPAM servers. Request factory stands for simplifying
building right request from input.
Added AddressRequestFactory and SubnetRequestFactory.
AddressRequestFactory creates instance of AnyAddressRequest or
SpecificAddressRequest depending on presence of ip address in input.
SubnetRequestFactory creates instance of AnySubnetRequest or
SpecificSubnetRequest depending on input.
get\_subnet\_request\_factory and get\_address\_request\_factory can be
redefined on driver level to use custom request factories.
Partially-Implements: blueprint neutron-ipam
Change-Id: Iedc0cfa326d60810099148f0ef8a1edac9e8aa12
commit 870fb38b1c7ddd5ddb399e6ff13a4f7992f8f9a6
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:59:46 2015 +0200
Python3: use dict.keys() instead of dict.iterkeys()
The "keys" method works on both Python 2 and 3, and the performance
impact should be negligible.
Change-Id: I4771797859666000921e4e38cc5de72a8c084ca0
Blueprint: neutron-python3
commit 538a7bf3c73d968185590d81a9b3a6523190aeb4
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Jun 9 03:41:07 2015 -0700
NSX QoS ext: RXTX factor can be decimal
In Nova flavors it is ok to specify a decimal RXTX factor.
For this reason when applying QoS to a port Neutron should not
convert this factor to an integer value, but simply ensure
it's a valid float number and positive.
Partial-Bug: #1463363
Change-Id: I983123ef7fd8f1b52b358aff3b579459fce63033
commit 5aaae68e5148f01e78a5e6013dce797dd42c1917
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:17:58 2015 +0300
Move \_add\_auto\_addrs\_on\_network\_ports
Moved to ipam\_non\_pluggable\_backend.py since implementation
is specific for non pluggable ipam backend.
Pluggable implementation will additionally include rollback on failure actions.
This commit is a preparation step for using pluggable ipam.
More changes in this methods are expected to be done by following
patches.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1876846526e370a7fcfa05b9a23fd9065973f111
commit 6669ee9af6bd635ae7efbc2f02e10914549ef708
Author: Lucas Alvares Gomes <lucasagomes@gmail.com>
Date: Thu Apr 9 14:02:36 2015 +0100
DHCP agent: Set an "ipxe" tag to work with Ironic
Ironic expects neutron to have an "ipxe" tag for the option 175 which is
sent by iPXE/gPXE when booting a node. The problem is that up to now this
tag was not created by Neutron, causing the nodes deployed with Ironic
+ iPXE to fail to boot. This patch is creating this tag when launching
the dnsmasq process.
DocImpact
Change-Id: I45a0f51365b37e7d85848fcdcbcf7aa6a1dddfed
Closes-Bug: #1442123
commit 735f193668d61dd7c09f710e555ab91d1d91abe6
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 18:47:11 2015 +0300
Remove \_check\_ip\_in\_allocation\_pool
\_check\_ip\_in\_allocation\_pool is not used anywhere in neutron.
Cleaning up unused code from db\_base\_plugin\_v2.py.
Caller was removed over a year ago in change
Ib31550fa9000fc75768a327cb6cc1c419e06568f
Partially-Implements: blueprint neutron-ipam
Change-Id: I41b7254835c308dda679ee2a5ebbccba528fd108
commit e3710f59481b4f9c3430228e8f074c845e93fbe7
Author: shihanzhang <shihanzhang@huawei.com>
Date: Mon Jun 15 14:51:16 2015 +0800
Don't delete DVR namespace if there are still ports on this node
Skip deleting DVR namespaces if they contain ports in the BUILD or
DOWN status.
Change-Id: I026f2014ede800c0f4532ca15f1fccdaa59d5b61
Closes-bug: #1464527
commit 345ffb99ef92f567562c178c57b9c110740a3767
Author: Doug Wiegley <dougw@a10networks.com>
Date: Thu Jun 18 18:13:43 2015 -0600
Updated from global requirements
Since we can't merge proposal bot at the moment, due to a conflict with
setup.py, at least get our reqs files up to snuff.
Change-Id: Ie313c81502dfe17a4afdcfdba4e207b9866e1399
commit 42826a0e64b3499cda065fd9ffdf0b5af5754c85
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:06:21 2015 +0200
Fixed the only sphinx warning in docs
We made previous attempt to get rid of all warnings, but it turned out
that gate does not execute tox's docs job but runs build\_sphinx
directly.
The latter behaviour should be fixed, but while at it, we
should prepare neutron job to be executed in gate by cleaning up all
warnings.
Closes-Bug: #1466554
Change-Id: I8c265eae2175425568479116d1faef7d87fdcc02
commit 63e318f5f8159f108cf1e7a82c952fa5f882870f
Author: Moshe Levi <moshele@mellanox.com>
Date: Thu Jun 11 12:24:03 2015 +0300
Fix SR-IOV mech driver to set port status to down when agent is required
SR-IOV mech driver has 2 modes agent and agent-less. Currently in both
modes port status are active. This patch update the port status to down
when using agent mode. This will allow the SR-IOV agent to get port
update notification and apply its additional functionality
when launching vm.
Co-Authored-By: Berezovsky Irena <irenab.dev@gmail.com>
Closes-Bug: #1464186
Change-Id: Ibd9b31b4f2393b8732253d5cbfd36e8b5614860d
commit cdde9a3aeb929e80aa3c251a44060b8174ab7b6c
Author: venkata anil <anil.venkata@enovance.com>
Date: Thu Jun 18 10:03:12 2015 +0000
read\_hosts\_file\_leases shouldn't parse stateless IPv6
Error when \_read\_hosts\_file\_leases tries to parse stateless IPv6 entry
in hosts file
TRACE neutron.agent.dhcp.agent ip = host[2].strip('[]')
TRACE neutron.agent.dhcp.agent IndexError: list index out of range
Neutron creates entries in dhcp host file for each subnet of a port.
Each of these entries will have same mac address as first field,
and may have client\_id, fqdn, ipv4/ipv6 address for dhcp/dhcpv6 stateful,
or tag as other fields.
For dhcpv6 stateless subnet with extra\_dhcp\_opts,
host file will have only mac address and tag. So \_read\_hosts\_file\_leases
shouldn't check for ip address for this entry in host file.
Closes-bug: #1465330
Change-Id: Iad6605ac5c7bcd6ec9204352037ed021f5007738
commit 31f846c1b9fa17d1812f78dffe1dcf883da52bab
Author: shihanzhang <shihanzhang@huawei.com>
Date: Fri Jan 30 09:50:52 2015 +0800
Fix 'router\_gateway' port status can't be updated
when it creates a ovs bridge without parameter 'bridge-id',
it's default 'bridge-id' is None, so ovs agent should also
deal with these ovs bridges, for example if ancillary bridge
br-ex does not be handled, the 'router\_gateway' port status
can't be updated.
Change-Id: If428eadadfd36a9b19ea75920120e48ac49659f2
Closes-Bug: #1416181
commit 2db459f284002e45497d768a8a53c9b43d045d45
Author: Doug Hellmann <doug@doughellmann.com>
Date: Tue Jun 16 19:49:15 2015 +0000
Update version for Liberty
Update the version for Liberty, switching from date-based versioning
to pre-versioning using SemVer. See
http://lists.openstack.org/pipermail/openstack-dev/2015-May/065211.html
and
http://lists.openstack.org/pipermail/openstack-dev/2015-June/067082.html
for details.
Change-Id: I6a35fa0dda798fad93b804d00a46af80f08d475c
commit 98d0be2f82523a40e630cf08dd8479b4cbb48add
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:33:56 2015 -0700
Add networking-sfc to the list of affiliated Neutron projects
The project is being bootstrapped in [1,2], this change reflects
that in the sub\_projects doc.
[1] I3825a1e02713f45e2c769eaa8fd0f1ab48d14372
[2] Iec53129d7c19620d690e71032c83907f03c66d9f
Change-Id: I7c235bfe444bbb9afc7d4d8c92704c9bfc09ab49
commit 315b10dc9fa7b8d889a24e0c6cdf72f5341d92d5
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:31:01 2015 -0700
Minor improvements to sub\_projects document
Let's remove the empty table, to cut down the risk of inconsistency,
and further explain what the list of affiliated project is for.
Change-Id: I3c8970db8de4fc211233903e8220cda72d47e193
commit 53209ca19ac2116d293b6fbc7b31254cb27a3ecb
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 17 14:25:56 2015 +0000
Python 3: do not use cmp(), nor sorted(..., cmp=...)
\* The "cmp" function has been removed, so we must not use it any more;
\* The "cmp" keyword argument of the "sorted" function has been removed, so
replace it with "key=functool.cmp\_to\_key".
Change-Id: Ic39d29dc1002a68f36f04c32e53a36bc826dce78
Blueprint: neutron-python3
commit 4a73ab99c9fcc63adbbb41d4a9b9ba8669afdc61
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Tue Jun 16 13:48:26 2015 +0200
Move get\_inteface\_by\_ip from LinuxBridge class to ip\_lib
get\_interface\_by\_ip is moved fro LinuxBridgeManager to ip\_lib
as a more generic get\_device\_by\_ip.
System-faking unit tests have been switched for functional
testing that also performs a negative test.
This can be reused in the openvswitch-agent code to validate
local\_ip reusing the LinuxBridge logic.
Change-Id: I9237871a6e24dd99556c71844624be510e20d289
Related-Bug: #1464178
Related-Bug: #1408603
commit 76dd333167920f447bdbedbbee10fdab593abe5b
Author: Vladislav Belogrudov <vladislav.belogrudov@oracle.com>
Date: Wed Jun 17 14:02:22 2015 +0300
Fix cisco\_csr\_identifier\_map.ipsec\_site\_conn\_id
Some database engines require exact match of sizes of foreign keys
and referenced fields. Foreign key ipsec\_site\_conn\_id of table
cisco\_csr\_identifier\_map is varchar(64) but it references field
id varchar(36) of table ipsec\_site\_connections. This gives error
while running migration scripts in such databases.
This fix only applies to new installations. Existing databases will
be corrected by migration scripts introduced in
https://review.openstack.org/190569 - they will take care of resizing
the field and adjusting the model.
Change-Id: I6cc9625a2d96d1330b06eb727cc7fa5363c697b8
Depends-On: I384a9bbaba05ef94174b666bdcfb276eedc74134
Closes-Bug: #1463806
commit 7a7377681133785e12a296ff7077b039708da97d
Author: Thomas Morin <thomas.morin@orange.com>
Date: Wed Jun 17 12:13:35 2015 +0200
fix rootwrap debug filter for ping all
NeutronDebugAgent.ping\_all calls ping with "-c 1 -w <number>' so
the filter should accept this order, and not only "-w .. -c ..".
Not changing the existing filter to not break other tools
that might use -w -c in that order.
Change-Id: I5b3d67dfcdc15c53ac3bf2fb39de29fd97e98a19
commit 7d704db18ec7635328bfce7dc6e936151f264f1f
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 23:16:24 2015 -0700
Refactor rpc\_loop() in ovs neutron agent
This patch segregates the port\_info recieved by
scan\_ports and scan\_ancillary\_ports.
This refactoring is basically required for this patch set:
https://review.openstack.org/#/c/165023/
Co-Authored-By: Romil Gupta <romilg@hp.com>
Change-Id: I9b43c230cda9d2659ad0e806bebe8a3dc12826ec
Partial-Bug: #1329223
commit 4e77442d529d9803ff90de905b846af940eaf382
Author: Kevin Benton <blak111@gmail.com>
Date: Sat Jun 13 18:45:19 2015 -0700
Add deadlock retry to API and ML2 RPC port update
With the switch to the pymsql SQL driver, eventlet will now yield
during database transactions. This greatly increased our probability
of multiple coroutines running transactions on the same table that
result in deadlocks.
These deadlocks could result from many things including the following:
\* a coroutine holding a pessimistic "SELECT for UPDATE" lock when
another tries to update the locked records
\* two coroutines both issue update statements using a WHERE clause
invalidated by the other update (e.g. from a compare and swap approach)
\* two coroutines insert records that, when combined, violate a unique
constraint on the table in a master-master Galera deployment
\* any two workers using "SELECT for UPDATE" in a master-master Galera
deployment (write-set certification failure translates to deadlock)
This problem is exacerbated by the switch to multiple API and RPC
workers, each of which can lead to most of the errors above even
without the switch to pymysql.
This patch adds a deadlock retry decorator to the delete, create,
and update methods at the HTTP API layer. Additionally, it adds a
decorator to the update\_port\_status AMQP API in ML2 since it updates
the port table, which is a heavily locked table by ML2 making it a
prime candidate for deadlocks.
Nova has had relied on the deadlock retry mechanism for quite some
time now. We were limping along by not using additional workers and
by relying on the unyielding nature of the MySQL C driver to
serialize everything.
Closes-Bug: #1464612
Change-Id: I635cc49ca69f589f99ab145d4d51e511b24194d2
commit 95b6a74af10e2150b017647028de8454ef1cda2f
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Tue Jun 16 17:23:09 2015 -0700
ovsdb: session.rpc never initialized
Previously, if idl.Transaction.commit\_block() returned a status of
TRY\_AGAIN we would check self.api.idl.\_session.rpc.status which would
result in an attribute error as rpc is None.
This patch fixes this attribute error by removing this unneeded check. In
addtion, the force\_reconnect() is also removed as ovs.jsonrpc handles
reconnecting automatically for us.
Change-Id: Ibf3ce5cd3432845f8938a1d83637ecf59b14b5ca
Closes-bug: 1465889
commit fc0c3a83659a86453acd5745a5632729b99cb3de
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Mon Jun 15 10:57:02 2015 -0600
Remove duplicated debug logging around locking
Currently, iptables\_manager.py does extra unnecessary logging about lock
acquisition and release. It uses lockutils.lock() which passes
do\_log=True by default, which causes lockutils.lock() to do debug
logging about lock acquisition/release. IptablesManager itself also writes
debug log info about lock acquisition and release.
This change will eliminate unnecessary duplicate logging in order to
reduce log noise about locking. This change is also related to
https://github.com/harlowja/fasteners/commit/f88f2fea7fe250b7d26cdcbc84633ccbbc68eeee
which reduces the logging level in the underlying lock implementation
used by oslo.concurrency. That change along with this one will remove
the duplicate debug logging about locking in iptables\_manager.py and also in
ipset\_manager.py.
Change-Id: If6f4a7101f3783ad83645e28bbb5c577dd403d3b
Closes-Bug: 1464727
commit 8f2014ea556404fb99c78add1e46b80c718cf491
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 05:32:44 2015 -0700
Refactor scan\_ports() and update\_ancillary\_ports() in OVS Neutron Agent
Used a helper method which contains the common code from scan\_ports()
and update\_ancillary\_ports(). And also renamed the name of
update\_ancillary\_ports() method to scan\_ancillary\_ports() to have parity
between normal ports and ancillary ports.
Added unit tests for scan\_ancillary\_ports.
Co-Authored-By: Romil Gupta <romilg@hp.com>
Partial-Bug: #1329223
Change-Id: I8b3e00a9371d5a03cc8b4be24bf20eec10bef5df
commit 4f46d2ae3a089f36512fae3bf49f155927095922
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 16 13:38:13 2015 +0000
Python3: do not change the size of a dict while iterating over it
This does not work in Python3, so we have to store the items first.
Change-Id: I7d8641f980fe62d2900559433d5060a6281a97f8
Blueprint: neutron-python3
commit 0488ac707493575e084f02273df2c4ec598541ba
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 12:34:41 2015 +0300
Refactor TestRpcWorker and TestWorkerService
TestRpcWorker and TestWorkerService have a duplicate test\_reset.
This patch introduces a base class from which tests for service
workers can inherit.
Change-Id: Ic4690c3b066b03c2fbb463f1329208ad1307d83d
commit fca84f69659e4e81790de405213f31e80fd8c239
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 2 18:45:51 2015 +0300
Juno\_initial migration
Havana was deprecated with the kilo release, and icehouse will be
deprecated with the liberty release, so havana\_inital migration should be
removed and replaced with juno\_initial.
Closes-bug: #1461103
Change-Id: I2e6802c9ab64d164bd888278d555dfeeaf47257b
commit 037f3111cd3968ff00593387daf2b832761e5ef4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 16 09:21:42 2015 +0200
docs: added job to well known tox envlist
This is to make 'tox -l' return the job name in its output (needed to
allow run-docs.sh script in project-config to determine whether the job
is present, to rely on it when generating docs in gate).
Change-Id: I80eb169b7b4e5a3490586722c64394dbb724928d
commit 9fc422a93a00f4126e91fa79ffcd43903ea9c8ac
Author: Sean M. Collins <sean@coreitpro.com>
Date: Mon Jun 15 13:51:05 2015 -0400
API Extensions: inherit from the ExtensionDescriptor
For consistency in the codebase, API extensions should inherit from the
abstract base class ExtensionDescriptor.
Change-Id: Id4829c265866e80c042c433bebcc01383e1e7417
commit 34aa030847ed24ad6ca7759459cbe9a6d0f43db3
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Jun 15 14:47:21 2015 -0400
Remove fossilized remains
Clean up ancient stuff that hasn't been touched in over 3 years.
Change-Id: I67fcd85027fb6614cafe8d92ddbf8c24aed58a4f
commit f88f3dc8d6f7240d6c0d9d5006345b3a797ae067
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 16:18:40 2015 +0300
Refactor update\_port in db\_base\_plugin\_v2
This commit is a preparation step for using pluggable IPAM.
- moved validations into \_validate\_port\_for\_update;
- updating ip addresses for port is backend specific, so
moved into \_update\_port\_with\_ips in ipam\_non\_pluggable\_backend;
- writing port changes to db is common for both backends, so
moved into \_update\_db\_port in ipam\_backend\_mixin;
- updated to use namedtuple to track add/original/remove ips;
- added \_make\_fixed\_ip\_dict to exclude keys other than
ip\_address and subnet\_id;
Partially-Implements: blueprint neutron-ipam
Change-Id: I1110e88f372b1d0cc7ec72049ba69a6d548da867
commit a89f99c6b700b1c6f918fe359c7271ac25ed4bc4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 14:56:58 2015 +0300
Refactor \_update\_ips\_for\_port
This commit is a preparation step for using pluggable IPAM.
\_update\_ips\_for\_port was refactored and split into two methods:
- \_get\_changed\_ips\_for\_port
This method contains calculations common for pluggable and
non-pluggable IPAM implementation, was moved to ipam\_backend\_mixin.
- \_update\_ips\_for\_port
This method is specific for non-pluggable IPAM implementation, so it
was moved to ipam\_non\_pluggable\_backend\_common.
Other changes:
- \_update\_ips\_for\_port now returns namedtuple with added, removed, original
ips (previously added and original ips were returned).
List of removed ips is required by pluggable IPAM implementaion
to apply rollback-on-failure logic;
- removed unused port\_id argument from \_update\_ips\_for\_port argument list;
Partially-Implements: blueprint neutron-ipam
Change-Id: Id50b6227c8c2d94c35473aece080a6f106a5dfd8
commit a8619e9bd1247e8ec494c456aee9ee7163231f62
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 15 15:07:28 2015 +0000
Python 3: use dict.values instead of dict.itervalues
This works with both Python 2 and 3, and should not have any performance
impact.
Change-Id: I2a14945c60de513b91c6f022ff5dcc503ce2a8ad
Blueprint: neutron-python3
commit 62faedddf2b0315484a04bd9092e96a3a828e46a
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:15:11 2015 +0200
Put output of docs job into doc/build/html
This is the path where jenkins/scripts/run-docs.sh that is used by gate
to generate project documentation expects to see the output.
Change-Id: Id276fa59edb33f7789ab06055300b4dc2385472a
commit ad1c7a35dec614a26de0a426950fa005df5f489d
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:23:44 2015 -0400
Remove get\_namespace from API extensions
Based on the conversation on the ML.
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066219.html
APIImpact
DocImpact
Closes-Bug: #1464023
Depends-On: 6f900fc429bf24cb31e0d2f149aa732055fd5956
Change-Id: I3c406910991c33cf959c5345d76153eabe3ace2d
commit b370c69b75fe38cd285512f9516ce428e8a806dd
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 9 16:00:58 2015 +0000
Ensure no "db" related functional/fullstack tests are skipped in the gate
Currently neutron uses MySQLTestCase[1] and
PostgreSQLOpportunisticTestCase[2] for functional and fullstack tests
using a real MySQL/PostgreSQL database. These classes skip tests when
the db is unavailable (db not installed/configured, missing packages,
etc.) which is fine when tests are runned by developers but not when
runned by the gate jobs.
This change updates MySQLTestCase[1] and defines PostgreSQLTestCase[1]
as PostgreSQL oslo.db test class wrapper: when the db is unavailable,
these classes ensure tests will:
\* fail in the gate (dsvm-functional, dsvm-fullstack jobs),
\* be skipped by default otherwise (functional, fullstack jobs).
[1] neutron.tests.common.base
[2] oslo\_db.sqlalchemy.test\_base
Closes-Bug: #1404093
Change-Id: I77b12e728ce9a7b0222c3df081842635f6375a3e
commit 278a5fce29504c43d669feed210f7b3627616e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:35:11 2015 +0200
Use PyMySQL in MySQL related functional/fullstack tests
mysql-python driver has been replaced by PyMySQL driver[1] in neutron
code but MySQL related functional/fullstack tests try to use
mysql-python driver because of MySQLOpportunisticTestCase[2] and tests
are skipped because mysql-python driver is no more available.
This change provides a backend implementation for mysql+pymysql, a base
base testcase MySQLTestCase[2] using mysql+pymysql implementation
(currently oslo.db provides none of them but will in the future) and
replaces MySQLOpportunisticTestCase with MySQLTestCase.
[1] I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
[2] neutron.tests.common.base
Closes-Bug: #1463980
Change-Id: Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
commit 1318437a0caf38e695a819848832a955fef7d909
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Fri Jun 5 01:46:22 2015 +0400
Skip rescheduling networks if no DHCP agents available
This eliminates the problem of unscheduled networks in case
of communication failure between agents and servers which
can occur if messaging queue service fails.
Change-Id: Ied4fa301fc3d475bee25c47f3a01c2381ae9a01e
Closes-Bug: #1461714
commit bb846c89ee120662eabdd4b0136fac82de076777
Author: Russell Bryant <rbryant@redhat.com>
Date: Fri Jun 12 21:26:37 2015 -0400
Reflect project moves from stackforge to openstack.
Several git repos were just moved from stackforge to openstack.
Reflect the move in various places where the URL was in docs and
comments. In passing, also change URLs to git.openstack.org instead
of github, as that is the official home of all of these repos.
Change-Id: I6c79a192d6604cef01e88d5b305fcc2b0f9c6b30
Co-Authored-By: Kyle Mestery <mestery@mestery.com>
Signed-off-by: Russell Bryant <rbryant@redhat.com>
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 1710f7c72f2c509d1009ee36ba4f66b298967fe9
Author: Kobi Samoray <ksamoray@vmware.com>
Date: Thu Jun 4 15:49:13 2015 +0300
VMWare NSXv: Add distributed URL locking to ini
NSXv plugin supports distributed locking using tooz library.
This patch adds the required parameter to the ini file.
DocImpact
Depends-On: Icbcec938c1c5ae7a528350f2f283388b81fa66b7
Change-Id: I8a7c36d044c4be29b0dfa3fbb8e9379723cebd61
commit 9952abaab182f3ec701aad2397d6f3fcc0bacc7f
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Mon Jun 8 14:15:30 2015 +0300
Decompose db\_base\_plugin\_v2.py with changes
This commit is a preparation step for using pluggable IPAM.
1. Moved get\_subnets functionality to db\_base\_plugin\_common to make it
accessible by ipam backends.
2. Reworked update\_subnet routine:
- moved db part into update\_db\_subnet;
Partially-Implements: blueprint neutron-ipam
Change-Id: Idb8f54d9fccaad1137222d156590c37d86aa576b
commit a5bf502fab57453a1aedd3a53ce89eaf464e1cd9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Fri Jun 12 21:11:02 2015 +0200
Remove duplicate tunnel id check in sync\_allocations
Currently, gre/vxlan sync\_allocations and \_parse\_tunnel\_ranges both
check tunnel id values. This change removes the check in gre/vxlan
sync\_allocations as they duplicate \_parse\_tunnel\_ranges check and is
less fine.
Change-Id: I5827468aeaec5d6c79d469132b129aeb7da171e2
commit 901e6ae6fb05d65ccfc4a6602de4160c3a34031e
Author: Akihiro Motoki <motoki@da.jp.nec.com>
Date: Sat Jun 13 02:14:17 2015 +0900
Remove meaningless no\_delete from L3 test
no\_delete parameter was removed in Kilo and it no longer
has any effect.
Change-Id: Idf0f3ac24b3978392222efbf465cc9e6cfd5d346
commit ba2c44ef000221f8a18274a9569838d8c26014c0
Author: armando-migliaccio <armamig@gmail.com>
Date: Fri Jun 12 08:58:05 2015 -0700
Revert "Revert "Set default of api\_workers to number of CPUs""
This reverts commit 12a564cf03e612dda36df26df8d28dfc75f1af6e.
We should re-enable this feature on a controlled basis so that we can
flush out any outstanding issue we may have.
Related-bug: #1432189
Change-Id: I2cfd93fdb032b461022b729347390ff8636ccdeb
commit 89a83bf199e7ea75c04f3205ff77987feed13184
Author: rossella <rsblendido@suse.com>
Date: Thu Jun 11 10:43:36 2015 +0200
OVSNeutronAgent pass the config as parameter
Instead of using the global cfg.CONF, pass the config as parameter.
This is very useful to test the agent without having to override
the global config.
Change-Id: I45534d79e044da9f2be4d596a58310fb28b7bf22
commit 7e0222409dab6223579efea34ba0d3ccf93e11d3
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 11 17:23:41 2015 +0300
Refactor \_update\_subnet\_allocation\_pools
Moved \_update\_subnet\_allocation\_pools to ipam\_backend\_mixin.py.
Call \_rebuild\_availability\_ranges with self to make it overridable
on upper level (from non-pluggable backend).
Partially-Implements: blueprint neutron-ipam
Change-Id: If7b1e720f88a2f0177b6772a015ae216f19ee22d
commit 5ff082bcfe12647036e5b033bfc2bac514acdb42
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Tue Feb 24 15:47:01 2015 -0500
Stop sending gratuitous arp when ip version is 6
This fix prevents calls to the arping utility for IPv6
addresses, thereby eliminating errors reported by arping
for IPv6 addresses.
The assumption is that NDP, DAD, and RAs are sufficient
for address resolution and duplicate address detection
for IPv6, and that unsolicited Neighbor Advertisements (NAs)
are not required for OpenStack services. If this turns out
not to be the case for some service/feature, then a separate
bug should be filed to add support for unsolicited NAs for
that service.
Change-Id: I14f869b7d488d7e691f7316eafcab3064e12cda6
Closes-Bug: 1357068
commit 1552f311532fdbd03a79ecfc1fae488b072c5a14
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 9 11:30:06 2015 +0300
Fix Enum usage in 589f9237ca0e\_cisco\_n1kv\_ml2\_driver\_tables
PostgreSQL is more sensitive with types than MySQL, it creates a
separate type when a Enum is created. In migration 589f9237ca0e
type profile\_type is trying to be created, but the type with such
name was already created in havana\_initial migration.
The solution for this is not to create type in 589f9237ca0e
migration when dialect is PostgreSQL and use already created.
Closes-bug: #1463301
Change-Id: I66e74d50cc70673de8635616076779cc20cde113
commit cd56a657a19a5a756d191c614becfd3e386b3c80
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jun 11 06:03:07 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If91f3ac94562cc5130dd5ea5ac5d71aec64b74e3
commit 7b51521e31f896d0095510b52644b728aaadca5a
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 10 21:45:41 2015 -0700
power grab
The current core reviewers hierarchy didn't have a place for the
parts of ML2 that weren't related to agent communication. For now
we can put all of ML2 under the built-in control-plane until we
decide it needs to be put somewhere else.
Change-Id: Ic4924e0041c4cbb955d8fac0f96ec56406d6466e
commit 1c29fab7cb3e586be72dd7910e2022b45c809c5f
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Jun 4 23:54:31 2015 -0400
Change ensure\_dir to not check directory exists first
I224be69168ede8a496a5f7d59b04b722f4de7192 added an EEXIST
check, so no need to check if the directory is already
there, just try and create it.
Change-Id: Iba51fc8263bf59326489319d0dd3f69af00a8eeb
commit 7c331be77fb6a835f1fb79c674d8d6c39c7eb357
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 10 16:53:25 2015 -0700
Document existence of br-tun and br-int in the OVS agent
Question about the use of the two bridges has come up in the past
multiple times, so let's fill the gap in the developer documentation.
A user-facing documentation patch will have to follow up, if we want
to be very thorough.
Change-Id: I6dac0f9bdaf7b3b7bff8745d4103ccc71df61a0a
commit 9c8a19ba4032f98ecbffe53c4e731587550ded96
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:08:45 2015 +0200
Correct indentation in neutron.api.v2.attributes
This change corrects subnetpool resource definition indentation in
neutron.api.v2.attributes.
Change-Id: I6738ff6b73bd0b943cec32f14ccb8946ba28d2e3
commit fd85b3ead32cd988e93f1d33d219ffd52cd77a51
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 10 10:20:58 2015 +0000
Python3: replace 'unicode' with 'six.text\_type'
In Python 3, 'unicode' does not exist; 'six.text\_type' should be used instead.
Change-Id: I71011b4beee9817a61278eb473804cfb798de74a
Blueprint: neutron-python3
commit c34ce7c9845cc56f981e0ee8714d1f9345df5852
Author: Saksham Varma <sakvarma@cisco.com>
Date: Tue Apr 7 18:12:02 2015 -0700
Moving out the cisco n1kv section to stackforge
Since most of the n1kv plugin code resides in stackforge/networking-cisco
repo, it's best to move the n1kv section there
Change-Id: Ic1388980dea0d27dfa5e84869f1f20cc9bff78e5
Closes-Bug: #1441400
commit 27df3e9fb98407e94bdeb9df493a9a3a0be639ca
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon Jun 1 22:29:39 2015 +0200
Ensure no "agent" functional tests are skipped in the gate
Some "agent" functional tests[1] can be skipped if some requirements are
not satisfied in order to allow developers to run functional tests on
various environments. These tests should not be skipped in the gate.
This change defines the decorator no\_skip\_on\_missing\_deps[2] to ensure
no "agent" functional tests are skipped in the gate. More precisely
no\_skip\_on\_missing\_deps transforms a skipTest into an error in:
\* dsvm-functional and dsvm-fullstack jobs,
\* functional and fullstack jobs when OS\_FAIL\_ON\_MISSING\_DEPS is
evaluated as True.
The change enlarges OS\_FAIL\_ON\_MISSING\_DEPS environment variable scope
(ie: missing dependencies + system requirements).
[1] in neutron.tests.functional
[2] in neutron.tests.common.base
Change-Id: Iacd4a5ef249fc1d7c75135ead9d0cf99d8a98a06
Closes-Bug: #1459844
commit ca63dfd0f39c7d691247c146b7529937c5804c9e
Author: Romil Gupta <romilg@hp.com>
Date: Wed Jun 10 09:43:56 2015 -0700
Remove useless pass from methods in type\_tunnel.py
The pass is useless because there is a docstring in the methods.
Generally considered as uncovered by coverage tool.
Change-Id: Id1275c51e9adb865a3da9f0db007f3092b55b140
commit 87fecfcc50f371d8dd593b3cd372da9db56f39c6
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:29:33 2015 -0400
Make Vlantransparent extension inherit from ExtensionDescriptor
Change-Id: Ic615578a1fe1d401b53d0b44ff5275d9518b97fd
commit eeacb95e65a749ce3a032246c36d10cad9df22b1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Wed Jun 10 13:10:54 2015 +0200
Actually allow to pass TRACE\_FAILONLY to ostestr
The comment below suggests to use TRACE\_FAILONLY to fail quickly when
running unit tests, while tox 2.0 does not allow to pass envvars from
the cli caller unless they are explicitly mentioned in passenv=
directive.
Change-Id: I6861498e7609b0c21fad844009420ea9734e2352
commit 1c124a309bc941c078b8bb622ea248a3ed3829e1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 11:28:10 2015 +0200
Switch to os-testr to control testr
It's a nice wrapper spinned out recently from tempest-lib that should
cover all our needs that we currently fulfill with pretty\_tox.sh.
Change-Id: I2268ed45ab628fe5dcab657d6287594847ab587c
commit da42745c466c14e6dbe58cdbc830ae5d1c8bb114
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Tue Jun 9 16:08:50 2015 +0000
Introduce functions using arping executable
The arpinger is gonna be used in the next changeset introducing
connection testers.
Change-Id: I90ae32c2f52f1debfb11ae2a08b2828ee2be04cc
commit 328b72cf8c5f514434de0b73c9137bde52b5eeea
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Wed Jun 10 07:04:25 2015 +0000
Revert "Defer segment lookup in NetworkContext object"
This reverts commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0.
This patch likely violated the idea of a NetworkContext
being a snapshot of the network at the time it was created.
This needs a different approach.
Change-Id: I20b132a0181d35b0517330fb7fbf293c3e979d0e
commit e33d92c894df4664d01d040ba4305c7cb4ef6e27
Author: Fawad Khaliq <fawad@plumgrid.com>
Date: Tue Jun 9 22:18:18 2015 -0700
Added networking-plumgrid in plugin requirements
Closes-Bug: 1463665
Change-Id: I7152dedd83659ee51274be31ef305af9e82d695a
commit f08e9f1f53efa97e07f21ca72a940fcbeb4570e5
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Wed May 20 01:03:59 2015 +0000
Switch from MySQL-python to PyMySQL
As discussed in the Liberty Design Summit "Moving apps to Python 3"
cross-project workshop, the way forward in the near future is to
switch to the pure-python PyMySQL library as a default.
https://etherpad.openstack.org/p/liberty-cross-project-python3
Change-Id: I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
commit 6886655b491aede40aa9f4a0bd4c6d402d5a7a78
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Apr 28 04:59:35 2015 -0700
Context: Remove logic for read\_deleted and deprecate it
The read\_deleted parameter in the Context object is simply unused.
This patch removes associated logic, and for what is worth, adds
deprecation warnings against explicit usage of read\_deleted when
creating a context instance, generate an admin context, and
elevating a context instance.
Change-Id: Ic69d22dc229ebe8fac1f6be0c4860d19732505b1
Closes-Bug: #1449462
commit 303f37f4e0c84f90e40b95731a828fc6ce8a0bbf
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 16:09:49 2015 +0000
Python 3: use next() instead of iterator.next()
The latter only works in Python 2.
Also define a \_\_next\_\_ method in the classes that define a next method.
Change-Id: Iaa1a1e500facab50d8bcdffda39ccad3f2e4e9bb
Blueprint: neutron-python3
commit 9143ce10e422bd17c4817dfe08163879e0e5a4ca
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 12:12:52 2015 +0200
Consume oslo.policy
Some non intrusive changes to tests are needed, so that we don't rely on
library symbols that are now private (f.e. parse\_rule).
Closes-Bug: #1458945
Change-Id: I90326479e908042fec9ecb25fa19a8dd5b15e7d8
commit 66fece4f84e62f14fb59a721b37986784976d0c4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 14:03:52 2015 +0200
policy: cleanup deprecation code to handle old extension:xxx rules
It served and warned users for enough time (since Icehouse) to be sure
everyone was notified about the need to update their policy file.
Change-Id: I240b935741e49fbf65c0b95715af04af4b2a73e7
commit 53ec63c430d123cd1ed4acd3b94537e9cb380bcd
Author: Romil Gupta <romilg@hp.com>
Date: Thu Jun 4 04:21:14 2015 -0700
Fix a regression in "Separate ovs-ofctl using code as a driver" change
The tunnels are not getting established between Network Node and
Compute Nodes in non DVR mode with l2pop enabled and throws
the AttributeError: add\_tunnel\_port.
This fixes a regression in change Ie1224f8a1c17268cd7d1c474ed82fdfb8852eaa8.
Co-Authored-By: YAMAMOTO Takashi <yamamoto@midokura.com>
Closes-Bug: #1461486
Change-Id: I1106fd3dd32f6f827eb25dec4815ff1120af96f0
commit 753196480d9cca10c5b91dfa8221e89f658fa110
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed May 27 13:54:06 2015 +0000
Break Pinger class to functions
As the class served only for storing parameters that can be passed as
actual function parameters, there is no reason for class.
Change-Id: I553b4d6daeb78d495cda09894582a3d885b5d1b5
commit 6d0d72973152bb45587437c80d4ffe0fe7bba761
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Tue Apr 7 14:58:13 2015 +0300
Handle SIGHUP: neutron-server (multiprocess) and metadata agent
All launchers implemented in common.service require each service to
implement reset method because it is called in case a process
receives a SIGHUP.
This change adds the reset method to neutron.service.RpcWorker and
neutron.wsgi.WorkerService which are used to wrap rpc and api
workers correspondingly.
Now neutron-server running in multiprocess mode (api\_workers > 0 and
rpc\_workers > 0) and metadata agent don't die on receiving SIGHUP and support
reloading policy\_path and logging options in config.
Note that reset is called only in case a service is running in daemon mode.
Other changes made in the scope of this patch that need to be mentioned:
\* Don't empty self.\_servers list in RpcWorker's stop method
When a service is restarted all services are gracefully shutdowned,
resetted and started again (see openstack.common.service code).
As graceful shutdown implies calling service.stop() and then
service.wait() we don't want to clean self.\_servers list because
it would be impossible to wait for them to stop processing
requests and cleaning up their resources.
Otherwise, this would lead to problems with rpc after starting
the rpc server again.
\* Create a duplicate socket each time WorkerService starts
When api worker is stopped it kills the eventlet wsgi server
which internally closes the wsgi server socket object. This server
socket object becomes not usable which leads to "Bad file
descriptor" errors on service restart.
Added functional and unit tests.
DocImpact
Partial-Bug: #1276694
Change-Id: I75b00946b7cae891c6eb192e853118e7d49e4a24
commit ea35b299f06050608f3e7bb6fbc880006ed31024
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 18:25:14 2015 -0700
Allow update\_port\_status to take network param
Allow the update\_port\_status function to take a network as
an optional parameter to skip calling get\_network again if
the caller has already done so.
Closes-Bug: #1463656
Change-Id: I994f3abdb1b0ad3b2766f409b206ad4a8b2309b6
commit d0be7bc57f573d5696108b571c731decfbde9f0b
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 12:46:54 2015 +0200
Make pep8 job succeed when /etc/neutron/neutron.conf is not installed
Currently, if /etc/neutron/neutron.conf is not installed in the system,
neutron-db-manage fails in oslo.config code when trying to determine the
default configuration file to use.
Test job should not rely on any contents inside /etc/.
Instead, pass --config-file with test-only configuration explicitly into
the utility.
neutron.conf.test was renamed into neutron.conf since for some reason
oslo.config does not support a name that does not have .conf at its
filename end.
Change-Id: I719829fc83a7b20a49c338aaf1dbef916dcc768c
commit 826428dc8aeef124c2251624ae34fdc003e69ca4
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Tue Jun 9 19:00:40 2015 +0900
Add a comment on \_check\_update\_has\_security\_groups
Despite of its name, \_check\_update\_has\_security\_groups can
handle create requests as well. There are plugins actually
using it for create. eg. ml2, vmware
Change-Id: I3c26ad0ac00b12ce24096bfc27606797af2d9098
commit 6b13cc5275df53c765c450d570521c425c3345d9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 10:57:29 2015 +0200
Enable all deprecation warnings for test runs
We would like to catch all deprecation warnings during test runs to be
notified in advance about potential problems with next library releases
we depend on.
Change-Id: I876d8c4de88618b01898ab537a44920789d8178e
commit 734e77365b0f241a3cea0f3c9dfb1d5fcf6eac8c
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Apr 17 15:00:20 2015 -0700
Remove get\_admin\_roles and associated logic
get\_admin\_roles was introduced so that contextes generated from
within plugins could be used for policy checks. This was the case
up to the Havana release as several plugins invoked the policy
engine directly to authorize requests.
This was an incorrect behaviour and has now been fixed, meaning
that get\_admin\_roles is no longer need and can be safely removed.
This will result in a leaner and more reliable codebase. Indeed the
function being removed here was the cause of several bugs where the
policy engine was initialized too early in the server bootstrap
process.
While this patch removes the feature it does not remove the
load\_admin\_roles parameter from context.get\_admin\_context. Doing so
will break other projects such as neutron-lbaas. The parameter is
deprecated by this patch and an appropriate warning emitted.
As a consequence neutron's will now no longer perform policy checks
when context.is\_admin=True. This flag is instead set either when
a context is explicitly created for granting admin privileges, or
when Neutron is operating in noauth mode. In the latter case every
request is treated by neutron as an admin request, and get\_admin\_roles
is simply ensuring the appropriate roles get pushed into the context
so that the policy engine will grant admin rights to the request.
This behaviour is probably just a waste of resource; also it is not
adding anything from a security perspective.
On the other hand not performing checks when context.is\_admin is
True should not pose a security threat either in noauth mode or
with the keystone middleware. In the former case the software keeps
operating assuming admin rights for every requests, whereas in the
latter case the keystone middleware will always supply a context
with the appropriate roles, and there is no way for an attacker
to trick keystonemiddleware into generating a context for which
is\_admin=True.
Finally, this patch also does some non-trivial changes in test\_l3.py
as some tests were mocking context.to\_dict ignoring the is\_admin flag.
Closes-Bug: #1446021
Change-Id: I8a5c02712a0b43f3e36a4f14620ebbd73fbfb03f
commit 89c0875178f22651109a85d3c522d80324368caf
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon Jun 8 14:27:47 2015 +0300
Add documentations for VXLAN Tunnels
The VXLAN type driver is currently supported, this patch add
description and links for more information to the user.
Change-Id: Idb221ca4cce1a3a27bebe5ae6fc1e6ab5d030836
commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 19:03:29 2015 -0700
Defer segment lookup in NetworkContext object
Avoid call to get network segments for network context objects until
a caller actually tries to lookup the segments. This optimizes cases
where the user of a port context never looks at the segments of the
associated network context (e.g. update\_port\_status).
Closes-Bug: #1463254
Change-Id: I7e95f81d9a3ef26ccdb18c6bfdf9adc29523aa79
commit d0bbfc090bb25f1e05b98f0ad70c18209b87ed6b
Author: Zhenguo Niu <niuzhenguo@huawei.com>
Date: Tue Jun 9 08:28:45 2015 +0800
Fix typos in docs
Change-Id: I71aeb8f1e5fc5f3e330e593a463858dd65e6093b
commit b322ebae09cc59ed0a860ea6e39ed9b6fa6c5c12
Author: yuyangbj <yangyu@vmware.com>
Date: Wed May 13 14:07:36 2015 +0800
Fixes bulk insertion of data to ml2\_port\_binding
We should use schema definition to insert bulk of data to table.
Closes-Bug: #1454566
Change-Id: I66b3ee8c2f9fa6f04b9e89dc49d1a3d277d63191
commit 3a5a8a62c372f3a516caa59fd655dcf923a82519
Author: Kyle Mestery <mestery@mestery.com>
Date: Mon Jun 8 15:27:23 2015 +0000
Add Neutron PTL Office Hours
To ensure a weekly oppurtunity to sync between the PTL and the
Lieutenants, officially setup Neutron PTL Office Hours.
Depends-On: Ia5c8090e90939097104cb95c0aa3b883f7b4dd9b
Change-Id: Iab3c21764937ebb3a1d0553b3a3d42b5c44bf3cc
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 00899b56213753d523842f29d50353a067df6064
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 14:42:18 2015 +0000
Python3: Enable all working tests in tox.ini
Thanks to the recent Python3-related changes, these tests can now be run on
Python 3.
Change-Id: I7f689e221e59128012d46da2c90e61d5206fe828
Blueprint: neutron-python3
commit 725543684cbe0df0edc4b6924f85e63e1628fa92
Author: rossella <rsblendido@suse.com>
Date: Thu Mar 5 09:24:10 2015 +0000
Add get\_events to OVSDB monitor
OVSDB monitor can generate the events that the OVS agent
needs to process (device added or updated). Instead of
notifying only that a change occurred and that polling
is needed, pass the events to the agent
Change-Id: I3d17bf995ad4508c4c6d089de550148da1465fa1
Partially-Implements: blueprint restructure-l2-agent
commit b239f75644bfdfec86f8a8efdabd6b11b766e822
Author: shihanzhang <shihanzhang@huawei.com>
Date: Tue May 26 16:42:44 2015 +0800
Update ipset members when corresponding sg member is empty
if a security group has a rule with 'remote-group-id', the ports
in this security group should update its relevant ipset member
when the remote-group members is empty.
Change-Id: I980ebfd8f6537f803d9d5cbf21ca33f727fea3b3
Closes-bug: #1458786
commit b17ff81ef1b18395c0b0671a487f68201d739f43
Author: shihanzhang <shihanzhang@huawei.com>
Date: Fri Apr 24 18:28:17 2015 +0800
Send 'security\_groups\_member\_updated' when port changes
With ml2 plugin, when a port's IP or security group changes, it
should send 'security\_groups\_member\_updated' message to other l2
agents which have same security group with this changed port.
Change-Id: I2e7622d2db4c173ac879a95a6e0adf92b858fe82
Closes-bug: #1448022
commit e2cfd87ab4abab95d713fa39a576ca7e41bce5c2
Author: Assaf Muller <amuller@redhat.com>
Date: Sat Jun 6 18:41:39 2015 -0400
Remove full stack log noise
"neutron-server isn't up yet" logs are useless because if
you time out when waiting for the server to start that information
will be in the trace. When you don't time out, the log is just spam.
Same reasoning for the "There are %d agents running!" log.
Also made the agents\_count parameter mandatory for the
wait\_until\_env\_is\_up method because having a default of 0, or any
other default makes no sense. There's no reason to ever call that
method without specifying the agents\_count. This method used
to be used with agents\_count == 0 by the server to make sure
its up (And responding to REST calls), but the Neutron server
fixture now uses server\_is\_live method (Which calls list\_networks)
instead.
Change-Id: Ifd6abd04ddaacc9976cb2a75269443f870b47c5b
commit e383378507d0d144de468e579f2e2defd41540b0
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Sun Jun 7 02:50:35 2015 +0900
ML2: Remove TYPE\_MULTI\_SEGMENT
It's a leftover from the pre-multiprovider world.
Change-Id: Iaf93292d698032984dfc392fae3701c49e18adc8
commit b649b9c871d0734745da5a201eca83a6b407a1c5
Author: Stephen Ma <stephen.ma@hp.com>
Date: Thu Jun 4 20:09:23 2015 +0000
L3 agent should do report state before full sync at start
Sometimes the AgentNotFoundByTypeHost exception is reported during
L3-agent startup. The exception is generated when the first
get\_routers RPC call is made. When the neutron server gets this
RPC call, it might not have handled the report state RPC call yet.
So the L3-agent hasn't been registered in the API server.
The result is a RPC Error exception. By the time the next
get\_routers RPC call is made, the report state RPC call has already
been done and agent registered.
This patch modifies the L3 agent startup behavior to have the report
state done before the agent do the sync routers RPC call.
Closes-bug: 1456822
Change-Id: Id40cfd8466f45e20fea0e9df6fd57bf9c9e59da7
commit 127de06c7e09e1468f2855a3033fb6193a6b9365
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 6 22:40:39 2015 +0200
Clean only floating-ip related connection states
Currently init\_l3 deletes connection states related to ALL ips deleted
in init\_l3 but it's required only when floating-ips are deleted[1].
This change deletes only connection states related to floating-ips
deleted in init\_l3 ... it avoids to delete connection states in dhcp
agents and on router internal ports!
[1] look at change Ia9bd7ae243a0859dcb97e2fa939f7d16f9c2456c
Closes-Bug: #1452434
Related-Bug: #1334926
Change-Id: Icfcfc585df6fd41de1e1345fd731e4631a6950ce
commit 713ba0e8d7ce59eaff41518360530b2e7831c322
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Thu Jun 4 22:25:44 2015 +0000
Refactor awkward logic in setup\_dhcp\_port
I noticed this logic as I was reviewing another patch set [1]. I
didn't like removing subnet ids from dhcp\_enabled\_subnet\_ids and I
wasn't too keen on the ips\_need\_removal semantics that were kind of
forced by the existing structure of the code. I hope you find this
alternative much clearer. I like straight-forward code with less
indentation that doesn't use awkward booleans like ips\_needs\_removal.
[1] https://review.openstack.org/#/c/157697/6
Change-Id: I8bd3d6924a855ea08f8096e66bd3bfbb165a4da3
commit 101ff1a81f15314cb9a07a6b65787c4324913c8a
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue May 19 09:42:51 2015 -0700
Add a "light" base test class for DB tests
This newly added class simply extends DietTestCase
with support for SQL operations.
Related-Blueprint: better-quotas
Change-Id: I2debc6a144ee93155c8e36f06aecb9735dbf55d4
commit 62d37f91872aaaefdee50e5cd1ed87456b8a6532
Author: rossella <rsblendido@suse.com>
Date: Fri Jun 5 13:09:35 2015 +0200
Make \_val\_to\_py and \_py\_to\_val not private
Move \_val\_to\_py and \_py\_to\_val to neutron.agent.ovsdb.api
and remove the underscore since they will be used by other
classes.
Change-Id: I3a469ab3b1c1d83ad20dc6c77f1072fc6d546419
commit 546cab2d62a0daf88ef192dd2fb2e185b39a7fcb
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Fri Jun 5 14:01:10 2015 +0300
Decompose db\_base\_plugin\_v2.py part 2
This patch contains method moving with minor modifications like updating
class names. IPAM specific methods were moved into ipam\_backend\_mixin and
ipam\_non\_pluggable\_backend.
ipam\_backend\_mixin - contains code common for both backends (pluggable and
non-pluggable).
ipam\_non\_pluggable\_backend - contains code specific for non-pluggable
IPAM implementation.
Partially-Implements: blueprint neutron-ipam
Change-Id: I6d68e4066ca472107def197c5a5afccbb6886a0e
commit 45b28ddfe8ac23871e65feb4132d5f048c783222
Author: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
Date: Fri Jun 5 13:05:48 2015 +0200
Fix typo in test class name
Make "Redering" -> "Rendering"
Change-Id: Ieedb446fa1e06705eb70293d83350d4dfd57d2db
Signed-off-by: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
commit 8c5ef2cd6e1819c4f51b01cb3504da34ef377546
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Thu Jun 4 17:00:13 2015 +0300
Start linuxbridge neutron agent using a launcher
This change ports linuxbridge neutron agent on common/service code
that will allow to handle termination signals (SIGHUP, SIGTERM, SIGINT).
Note that this patch allows changing only logging options.
All other config options are not handled explicitly and changing
them using SIGHUP can lead to unpredictable circumstances.
So, until changing other options is handled it is highly recommended
to use SIGHUP for changing ONLY logging options.
DocImpact
Change-Id: I1d834e0683b04111ef04c148cbd8d4acf2964065
Closes-Bug: #1461539
commit ea5ad714cfcd336c0062ddeb13238c452117782a
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 14:55:13 2015 +0300
Handle SIGHUP in ovs neutron agent
This change allows ovs neutron agent not to die on receiving SIGHUP
and reload its logging options.
Note that this patch allows changing only logging options.
All other config options are not handled explicitly and changing
them using SIGHUP can lead to unpredictable circumstances.
So, until changing other options is handled it is highly recommended
to use SIGHUP for changing ONLY logging options.
Change-Id: Ic0cf8a9ca7f3a16b556a6825e2979471ae136c33
Partial-Bug: #1276694
commit 615cac19913830e3dd15d1668d4fb2046202270f
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Mon Feb 23 16:25:53 2015 +0900
test\_ovs\_neutron\_agent: Remove useless ofport=10 arguments
The kwarg ofport has been removed from method signatures
where it was never used.
Change-Id: Iee671e8d870ba4ef5175a639bbaf365a5eaf5ef7
commit 839706df7c742ec4b132dc6f18857679cfd870f5
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Wed Jun 3 22:35:58 2015 +0900
test\_l3: Don't assume the order of subnets
Fixes test\_router\_add\_gateway\_multiple\_subnets\_ipv6 failures
on my environment.
Change-Id: I44b4dd0cee393ea796f35b999cc111b60ef63db1
commit 38eae7acb30de6f1f8dbb36855a5c913d9370fc5
Author: Cyril Roelandt <cyril.roelandt@enovance.com>
Date: Tue May 19 16:16:38 2015 +0000
Python 3: do not index a dict\_values object
In Python 3, dict.values() return a dict\_values object instead of a list, as in
Python 2. This object cannot be indexed.
Change-Id: Ia4fdb4cafb1811c55dc8f14e303ab2db1b1110b3
Blueprint: neutron-python3
commit 74dcc91aa85ab2e250fa32d6b895b2d5f7f2d5ba
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 4 17:58:06 2015 +0200
versionutils: switch from incubator version to oslo.log
Note that we require oslo.log >= 1.2.0 since it's the first release that
included the module.
Change-Id: I2b7d587d8c4b0c885873c9c8083abb8fc35780c9
commit c0afeba0b55318e4508d59a68bc7c15e23a9a996
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed May 27 13:50:22 2015 +0000
Run RootHelperProcess always as root
The purpose of RootHelperProcess is to spawn processes running with root
id. Instantiating RootHelperProcess as non-root doesn't make sense. This
also implies NetcatTester always spawns 'netcat' process as root. The
reason why parameter existed here was due to refactor from passing
root\_helper all over the place.
Change-Id: If042efcd75e46b66abf4a9e303e633749a1611b1
commit 28c95da3f500ce80258784514bfff1dc5d22bf1c
Author: Alexander Maretskiy <amaretskiy@mirantis.com>
Date: Thu Jun 4 16:32:12 2015 +0300
Changes in rally-jobs/README.rst
Changes:
\* fix broken links
\* add link to release notes
Change-Id: Ie42b246aac2fd4f6de8cd8bcf28e5ff2906ffd32
commit 770859d25b9d95b28794832d673ff6127a9f936f
Author: Dmitry Ratushnyy <d.ratushnyy@gmail.com>
Date: Mon Apr 20 16:22:27 2015 +0300
Add more API tests for port-security extension:
Test create port with specific value of port\_security\_enabled
Test create secure port with security\_group attached
Test update port with port\_security\_enabled True\False
and with or without security groups
Test deleting port with port\_security\_enabled
Change-Id: Id71f5451dc17f374feff1a3bdb35fb9ec42f0fa1
Depends-On: Ia27881a34ff99cad34c84764d2bf8a6cdf77af9c
Depends-On: Ie0ec090e8fdce7dbdbce14ef47f38e8e57f262d4
commit 9cac5c3a9f5238fde7fd4e1c01644cdfe48785d2
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Jun 1 14:36:17 2015 -0400
Decompose the NCS ML2 Mechanism Driver
The last of the Cisco drivers to decompose.
Closes-bug: #1416713
Co-Authored-By: Nikolay Fedotov <nfedotov@cisco.com>
Change-Id: Icd2b358fb0db3d859ee287225ab8eeb10d7da871
commit 52ac1c30086738ad798bdafeede2172ee23897e6
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Wed Jun 3 22:21:52 2015 +0900
test\_db\_base\_plugin\_v2: Don't assume the order of fixed\_ips
Fixes test\_ip\_allocation\_for\_ipv6\_2\_subnet\_slaac\_mode
failures on my environment.
Change-Id: I18a9a177a60c364d79943a8d68b46fde3b9f5d74
commit d00bd978f849df6d8f6f40dbc75b5b3fbdd610ea
Author: Angus Lees <gus@inodes.org>
Date: Thu Jun 4 12:55:02 2015 +1000
pylint: enable `duplicate-key` check
This check attempts to detect dictionary literals with duplicate keys.
The rest of the Neutron tree has already had the few instances of this
cleaned[1] or moved into external vendor repos. Enabling the pylint
check will stop future occurrences.
[1] I29cd2b843a7905986de13a1ecfba0cb5797ccaf8
(Original patch I1aa221d2019853f905f2b8421dd45b0a3102baf0 by zhiyuan\_cai)
Change-Id: If4fed9714cd7fa586845f21f8f56dde2645cc5e0
Co-Authored-By: zhiyuan\_cai <luckyvega.g@gmail.com>
commit b0b9e8bcaf3b2b9f33f8d3cd0bcdc21e8b7a1a87
Author: Assaf Muller <amuller@redhat.com>
Date: Wed Jun 3 13:50:57 2015 -0400
Remove reference to non-existent fullstack fixture
EnvironmentFixture doesn't actually exist, and environment
should be a mandatory parameter.
Change-Id: I5598e176f297bcfa3b2cab188b4b446ce18d54ab
commit 75c3a8dee4a7f643d7654e2ea4641fd1bd18af62
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Wed Jun 3 16:56:23 2015 +0000
Enhance utils.ensure\_dir to be resilient to concurrent workers
In rare cases, concurrent workers may attempt to ensure a directory
exists. One may successfully create the directory while the other
gets an oserror that it already exists. This patch detects the
problem and returns successfully in both cases.
Change-Id: I224be69168ede8a496a5f7d59b04b722f4de7192
commit 92b946e90b6cdd90deba2097196970afaaaf8dab
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Wed May 27 20:12:27 2015 +0000
Use a single method to remove an address with its conntrack state
I just noticed a pattern and I thought I'd throw this up for
discussion. It has occurred to me that this addition sort of breaks
the ip\_lib paradigm of wrapping ip commands without any additional
useful abstraction. Any better ideas?
Change-Id: Ibd34bf4a721c153aca916e294e58adb4a28379e4
commit ece8cc2e9aae1610a325d0c206e38da3da9a0a1a
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 3 14:22:29 2015 +0300
Decompose db\_base\_plugin\_v2.py
Moved private getters and simple helpers into db\_base\_plugin\_common.
This change is part of bigger refactoring for supporting Pluggable IPAM.
Main purpose is to make getters accessible by IPAM code.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1eac61c258541bca80e14be4b7c75519a014ffae
commit ea643d9163427b75aff7053d00c97dc84680e63b
Author: Russell Bryant <rbryant@redhat.com>
Date: Tue Jun 2 15:20:44 2015 -0400
Add sub-project lieutenants
A recent patch added the concept of Lieutenants for Neutron. This
same concept makes a lot of sense for identifying clear points of
contact for the various sub-projects under the Neutron tent. This
patch adds a table of the projects currently approved as part of
Neutron in the governance repo. I also made a guess on who the
lieutenant would be based on reviews in stackalytics (except for ones
that weren't in stackalytics).
Change-Id: Ibce5d6ba5e19dec59a10c88749557509136c4e41
Signed-off-by: Russell Bryant <rbryant@redhat.com>
commit 913298da04a52f31182c8849efe77b2310b4c2e1
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Wed Jun 3 15:38:50 2015 +0300
Fix confusing parameters names
Change-Id: Ib00135e1d0b8f334d660de9a80629e084efb13ba
commit 052054133abb76ef944d17e97df3afc8bc3f1738
Author: Aman Kumar <amank@hp.com>
Date: Wed Jun 3 05:15:25 2015 -0700
Extra indent in test\_ovs\_neutron\_agent
This patch removes extra indent errors from test\_ovs\_neutron\_agent
Change-Id: I1270cca3699b7874047f7812710f2611cc465493
commit 608c282285380704e70228ef549646a61492d2bd
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 2 23:49:40 2015 -0700
Make MockFixedIntervalLoopingCall class as a helper class
MockFixedIntervalLoopingCall class is used in both the classes
TestOvsNeutronAgent and TestOvsDvrNeutronAgent.
This patch removes the MockFixedIntervalLoopingCall from both the
places and make it as a helper class in test\_ovs\_neutron\_agent.py.
So that it will be used everywhere in test\_ovs\_neutron\_agent.py.
Change-Id: I5e0803436e91b4f20ec03209e9e799a68df4eaf4
commit 6575db592c92791a51540134192bc86465940283
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Wed Jun 3 05:52:51 2015 +0000
Revert "Add VIF\_DELETED notification event to Nova"
We need to wait until the nova support is added in
I998b6bb80cc0a81d665b61b8c4a424d7219c666f. Otherwise
this generates a ton of error messages in the nova api
log as well as on the neutron side.
This reverts commit 0ace88fd4a75ff213dc36fd16c1f8e7080ab7d6d.
Change-Id: I129c4e4c05cf07d45032fec6f57e0cc17a5a82af
Closes-Bug: #1461391
commit 45ea2cf10033e12c63b8ce2cd78b04755d0aba64
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Wed May 6 12:50:11 2015 +0300
Wrap ML2 delete\_port with db retry decorator
ML2 delete\_port operation currently involves locking ports
and bindings tables which may lead to DBDeadlock errors in certain
cases when several ports are deleted concurrently.
That may happen due to specifics of Galera working in active-active
mode: it may throw deadlock errors when it fails to validate
a change with other members of the cluster.
The fix adds retries to delete port operation to overcome such
deadlocks
Closes-Bug: #1422504
Change-Id: I684691d59c5ac370d74314c3c91857dc709b2d9b
commit f4d72a8fdfb2c897aa0a0581ca9cb9d9da4a4167
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Tue Jun 2 17:34:48 2015 -0700
Remove extra indent in testcases
Change-Id: I42cb044d75d53eab7ba180954589c718374857ee
commit 75f3aaa4cc42c2c1280f6c578e27e64cff8f860c
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Jun 2 16:52:14 2015 -0700
Check for 'removed' in port\_info before reference
scan\_ports can return early on no changes, in which case
'removed' won't be present in the dict. The deleted\_ports
logic wasn't setup to handle that.
This patch checks for the key before trying to reference it.
Change-Id: I0e2c6d76515ad8e2a2addc8d40451ac003a150f7
Closes-Bug: #1461325
commit ae8c1c5f80fd4fb7b4ab116677f4cff988c67cf1
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Tue May 26 20:17:20 2015 +0400
Catch broad exception in methods used in FixedIntervalLoopingCall
Unlike other places where it might make sense to catch specific
exceptions, methods that are used to check L3 and DHCP agents
liveness via FixedIntervalLoopingCall should never allow exceptions
to leak to calling method and interrupt the loop.
Further improvement of FixedIntervalLoopingCall might be needed,
but for the sake of easy backporting it makes sense to fix the issue
in neutron before pushing refactoring to 3rd-party library.
Change-Id: I6a61e99a6f4e445e26ea4a9923b47e35559e5703
Closes-Bug: #1458119
commit 805d4b148ae4b32657ed6a83e9a530b8b2c806ac
Author: Assaf Muller <amuller@redhat.com>
Date: Tue Jun 2 12:21:11 2015 -0400
Add devref that explains fullstack testing and its direction
The goal of this doc is to communicate what are full stack tests,
how they benefit you and when would you write such a test.
Additionally I'd like to communicate the way forward, and gather
feedback about any areas in the code that can benefit from full
stack tests, and any additional thoughts!
Change-Id: Ifd4ff9be0ed0184a49df6566d238c31a328cd23f
commit b48bccc60e4fd552d7b127376f41810b61e0ba9d
Author: Assaf Muller <amuller@redhat.com>
Date: Mon Jun 1 17:05:56 2015 -0400
Remove get\_dhcp\_port RPC method
This method was last used in Icehouse. I think we can safely
remove all of its code and tests. Icehouse to Liberty rolling
upgrades are in no way expected to work so I just bumped
the RPC version and removed all traces of the code.
Change-Id: Ia545c5be7da80c919ad5bae6074bc1cc3aa89fa0
Closes-Bug: #1314534
commit 46223363bd4d41639102ae1923dd1dfb306ec808
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 30 20:41:29 2015 +0200
Refactor type\_tunnel/gre/vxlan to reduce duplicate code
gre and vxlan type drivers have similar implementations for multiple
methods:
\* get\_endpoint\_by\_host
\* get\_endpoint\_by\_ip
\* delete\_endpoint
\* get\_endpoints
\* add\_endpoint
This change abstracts these methods and moves the abstractions to the
new class EndpointTunnelTypeDriver.
Change-Id: Iab97f8283b6bf5586334958de950664f6e74202a
commit 637b2f42560508c8b131718d9a6920d86d9a6c55
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Jun 2 06:15:35 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Iadf5c59306dd4f8ce574a2d7259bd6a03d60a72a
commit 490bdabd4c5835bac2314722c498e6dc6e85979d
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Tue Jun 2 08:49:10 2015 +0300
Update rootwrap.conf to add /usr/local/bin
When working with OVN i found on Fedora 21 that
my ovs-vsctl is installed in /usr/local/bin, since this wasnt in
rootwrap DHCP didnt work properly.
This change adds it to rootwrap
Change-Id: Ib3646933744ca6b20ecd5ad0cedcedb4f1fa5f12
commit cda0b14112484d4776c7ccb6be78b7e23fdd5424
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Tue Jun 2 06:15:39 2015 +0400
Add route to metadata IP by default
Windows VMs try to resolve metadata ip 169.254.169.254 as
local address by default, which results in very slow access
to metadata url during boot.
Injecting direct route to metadata ip through a subnet's default
gateway helps Windows to avoid wasting time on mac resolution.
So this patch injects host route for metadata ip for networks plugged
into a router.
Closes-Bug: #1460793
Change-Id: Ic991f9d7f9a8cf942e3e29f2da03d73c0f26470a
commit 3751f9ab349ea5b4c3d9836592e7928c37211091
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 1 20:53:46 2015 +0000
Python3: use six.iteritems() instead of dict.iteritems()
This also adds a check to neutron/hacking/checks.py that should catch this
error in the future.
Blueprint: neutron-python3
Change-Id: Ie7b833ffa173772d39b85ee3ecaddace18e1274f
commit 96e2314c8c0f06967b53828b0a771973f0031243
Author: Assaf Muller <amuller@redhat.com>
Date: Fri May 29 19:17:34 2015 -0400
Modify ipset functional tests to pass on older machines
Production code uses ipset exclusively in the root namespace,
however functional testing uses ipset in namespace for isolation.
This poses an issue as ipset is not supported in namespaces on
all kernels and distributions (I'm looking at you CentOS/RHEL 7.1).
This patch changes the ipset functional tests to work in the root
namespace while taking care of cleanups.
Change-Id: I08b2f59197ed76e59b2e58b5a10820653e857cda
Closes-Bug: #1460220
commit 70e07629bf263370102350d922d62970c60d5aa4
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue May 19 09:27:14 2015 -0700
Add a non-mixin function for model queries
This patch simply adds a version of model\_query in
neutron.db.common\_db\_mixin which can be invoked without
having to declare a class which inherits the mixin.
To this aim, model\_query\_scope has been refactored as well.
As the model query function being introduced in this patch
cannot use model query hooks (and does not need to), the
method was re-implemented rather than bringing out of the
mixin as it has been done for model\_query\_scope.
This change will allow for developing DB APIs without
having to use the baseDB/mixin classes models used so far.
Related-Blueprint: better-quotas
Change-Id: I7a79980f626e9eaf2775711c8a25f508067e5716
commit bacd69386d9df2abb41f62d1fa90f9cfaa215c62
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jan 15 15:00:02 2015 +0300
Implement IPAM Driver loader
IPAM Driver is loaded based on value of 'ipam\_driver'.
Added new variable 'ipam\_driver' in config.
DocImpact
Partially-Implements: blueprint neutron-ipam
Change-Id: Ia52ad70ef4f0b02cf82cfefcf50b9f1e30b05b79
commit 4a234ab1a35708bf85fe57d9290056ac74227eab
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 12:58:32 2015 +0300
Remove comment about hash seed in tox.ini
Enable random hash seeds change [1] has merged so the comment
can be safely removed.
[1] https://review.openstack.org/#/c/185572/
Change-Id: I93f64841792f9c38f5121ca47c130ad769c11dc4
commit 9b29f62491ec0e1cb27601e6ad53cf152de5eb66
Author: Moshe Levi <moshele@mellanox.com>
Date: Sun May 31 13:27:56 2015 +0300
Refactor mlnx mechanism driver to support infiniband only
The old mlnx mechanism driver was used for SR-IOV with Ethernet
and infiniband support but the PCI allocation wasn't done by nova.
Juno introduced sriovnicswitch mechanism driver for SR-IOV with
Ethernet support. Mellanox recommends on using it.
The updated mlnx mechanism driver supports SR-IOV infiniband.
\* support only port vnic\_type 'direct'
\* update vif\_type name to ib\_hostdev (the ib\_hostdev is generic vif\_type
for SR-IOV infiniband see https://review.openstack.org/#/c/187052/)
Closes-Bug: #1460430
DocImpact
Change-Id: Ia822b492afdfeb1aecf373d5a8cdb72174512884
commit c60c3e4f88aa28b9d2e6b6dcc7bc2a858433952d
Author: Henry Gessau <gessau@cisco.com>
Date: Sun May 31 14:51:50 2015 -0400
Remove unused \_uuid function alias from test\_iptables.py
Change-Id: If80de5ee6588ffd2338387e6592cf2812b106e1f
commit 193e745ac63d3a404b577ab61dd331779beb6a4b
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Fri May 29 15:00:45 2015 +0900
test\_ovs\_neutron\_agent: Remove unnecessary mocking
Leftover from change I90b4d2485e3e491f496dfb7bdee03d57f393be35.
Change-Id: Ia2596718678d3102ad99acbdf30be7ef0f52ad27
commit b7ffbf96ff414ce615c10c83fea85d7f1fdcce70
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 30 22:04:59 2015 +0200
Refactor type\_gre.vxlan tests to reduce duplicate code
gre and vxlan type drivers unittests have similar tests. This change
abstracts these tests and moves them to TunnelTypeTestMixin[1].
[1] neutron.tests.unit.plugins.ml2.drivers.base\_type\_tunnel
Change-Id: I13b0507991e840ff34de7ed7ffd31d359691b0ca
commit 9a73722992cc302127472a5a98ca05348db52a5f
Author: Alexander Ignatov <aignatov@mirantis.com>
Date: Sat May 30 00:49:31 2015 +0300
Removed duplicate keys in dicts in test
Test test\_create\_security\_group\_rule\_invalid\_ethertype\_for\_prefix
contained dict with duplicate keys, remote ip prefixes.
Test was successful because incorrect items for tests were overwitten:
'192.168.1.1/24': 'ipv4' by '192.168.1.1/24': 'IPv6'
'2001:db8:1234::/48': 'ipv6' by '2001:db8:1234::/48': 'IPv4'
This patch removes incorrect and useless items for tests.
Also added additional item with invalid ethertype.
Change-Id: I29cd2b843a7905986de13a1ecfba0cb5797ccaf8
commit c44506bfd60b2dd6036e113464f1ea682cfaeb6c
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Apr 17 04:03:38 2015 -0700
Don't update floating IP status if no change
The floating IP status was going through all of the
status update code every time the L3 agent sent in
an update, even if the status didn't change.
This patch skips sending updates to the server if the
agent doesn't change the status.
Change-Id: Ic3736bed3dc3e4ccb91f4acfabbf033949e09ce0
Partial-Bug: #1445412
commit e007167a700aa5b80ecb48adff0ac36bb330591d
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Apr 30 17:14:44 2015 -0700
Don't delete port from bridge on delete\_port event
Commit d6a55c17360d1aa8ca91849199987ae71e8600ee added
logic to the OVS agent to delete a port from the integration
bridge when a port was deleted on the Neutron side. However,
this led to several races where whoever created the initial
port (e.g. Nova, L3 agent, DHCP agent) would be trying to
remove the port from the bridge at the same time. These
would result in ugly exceptions on one side or the other.
The original commit was trying to address the problem where
the port would maintain connectivity even though it was removed
from the integration bridge.
This patch addresses both cases by removing the iptables rules
for the deleted port and putting it in the dead VLAN so it loses
connectivity. However, it still leaves the port attached to the
integration bridge so the original creator can delete it.
Related-Bug: #1333365
Closes-Bug: #1448148
Change-Id: I7ae7750b7ac7d15325ed9f2d517ca171543b53be
commit ef5b4f52749b246d8165058ff320399c9c13f5ac
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 14:29:15 2015 +0200
Enable random hash seeds
Neutron tests have been updated in order to support random hash seed. It
allows to remove PYTHONHASHSEED=0 in tox.ini and remove hashtest tox
environment.
Closes-Bug: #1348818
Change-Id: I1063304dda887eb82c0de8516d5a483fa8943fc1
Depends-On: I8408365825ec1e97a83c2181f38ec1f9468df91e
Depends-On: I1b2bd4100c19004f12822c414aefc86aae9849db
Depends-On: I5077764045a34d1be0e85bb4b80f3655e87692cc
commit 5c7e7c0ca7229ac7bb32964378a8bbef142bcdbf
Author: Joe Gordon <joe.gordon0@gmail.com>
Date: Fri May 29 14:28:34 2015 -0700
Fix formatting of core-reviewers doc
Fix some RST formatting issues with the core-reviewers policy document.
When reading the RST rendered version of that document at
http://docs.openstack.org/developer/neutron/policies/core-reviewers.html
I noticed a few rendering issues where were bothering me, so I fixed
them.
Change-Id: Ic6eedc2bb18f6bbb6424542dbf4a88ed52ebea1d
commit 422588e13338dab4a5ba1973c96256690ba4adf5
Author: Adrien Vergé <adrienverge@gmail.com>
Date: Fri May 29 22:54:33 2015 +0200
Get completely rid of contextlib.nested
`contextlib.nested` is deprecated since Python 2.7 and incompatible with
Python 3. This patch removes all its occurences by using the helper
script at [1].
This is a necessary step to allow us running all unit tests with
Python 3 (not just a small subset as it is done now).
[1]: https://github.com/adrienverge/context\_unnester
Change-Id: I8d1de09ff38ed0af9fb56f423a2c43476408e0fb
Blueprint: neutron-python3
Closes-Bug: #1428424
commit 880252868b8509125f6463e2709c2d0c4f3957ea
Author: Adrien Vergé <adrienverge@gmail.com>
Date: Mon May 25 18:46:03 2015 +0200
Fix indentation errors in tests
They are some missing/extra indentations in tests source code. This
results in variables used out their scope (which remains unnoticed as
long as `with` contexts do not fail), and prevent refactoring scripts
(such as the one for getting rid of `contextlib.nested` [1]) from
performing well.
This simple patch fixes these indentation errors.
[1]: See change I8d1de09ff38ed0af9fb56f423a2c43476408e0fb
Change-Id: Icef34c7755e0d96c4c5ee85982de86d0ccc196c7
Related-Blueprint: neutron-python3
commit 9ff8cd524621daf6cd20da939238eee14b5a231f
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 08:53:00 2015 +0200
Improve test\_set\_members\_deleting\_less\_than\_5
In test\_set\_members\_deleting\_less\_than\_5[1], 3 ips are deleted from
ipset but test\_set\_members\_deleting\_less\_than\_5 checked that the
first one was deleted because the call ordering was non-trivial.
The test was successful because
assert\_has\_calls(expected\_calls, any\_order=False) allows extra calls
before and after expected\_calls.
A parent change[2] forces the call ordering, this allows to check that
the 3 ips are deleted.
[1] neutron.tests.unit.agent.linux.test\_ipset\_manager
[2] I8408365825ec1e97a83c2181f38ec1f9468df91e
Related-Bug: #1348818
Change-Id: I773e2cd19fdec634b728d0c3a78c1d66392c743f
commit e43c037e14f0055206f16cc9549e03a3f6e43755
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 13:24:58 2015 +0000
Rename test\_periodoc\_resync\_helper to test\_periodic\_resync\_helper
Change-Id: Iaaf57b5cdbe634af8ceda0fef4c920cdb053eed4
commit 77303fbeaa060bcee2befad65dccb457fbb6ab65
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 14:38:26 2015 +0000
Sort \_get\_new/deleted\_set\_ips responses in unittests
This fixes the test\_set\_members\_adding/deleting\_less\_than\_5 unit test
that breaks with a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the \_get\_new/deleted\_set\_ips from
neutron.agent.linux.ipset\_manager return elements in a particular order.
Found with PYTHONHASHSEED=1.
The fix refactors the test case to force sorted responses from
\_get\_new/deleted\_set\_ips during unittests.
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I8408365825ec1e97a83c2181f38ec1f9468df91e
commit 359b7c971a88f6dff64e8e4d558210a880f3ee0f
Author: Ian Wienand <iwienand@redhat.com>
Date: Thu May 7 14:59:38 2015 +1000
Ensure netfilter is enabled for bridges
Since security-groups use iptables rules on Linux bridges, we need to
ensure that netfilter is enabled for bridges. Unfortunately, there
seems to be a long history of distributions having differing defaults
for this, best described in [1].
It seems at the moment everyone has to discover this for themselves;
packstack found it in Ia8c86dcb31810a8d6b133a161388604fde9bead4, then
fuel found the same thing in I8582c24706c3a7253e00569eef275f116d765bca
and then finally someone else hit it and put it into documentation
with I4ed3cec03a1b3a7d56dfe18394154ec1b2db6791. I just spent a long
time figuring it out too when deploying with devstack.
Rather than having yet another fix in devstack, I don't see why
neutron shouldn't be ensuring the setting is correct when it starts up
-- without these settings enabled, security-groups are silently
broken. This does that, and modifies test-cases to check we make the
calls.
[1] http://wiki.libvirt.org/page/Net.bridge-nf-call\_and\_sysctl.conf
Change-Id: If2d316eb8c422dc1e4f34b17a50b93dd72993a99
commit b058658780f0ccb2787c26e3e95cabcc8e2e6349
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu May 14 15:09:24 2015 +0300
Cleanup stale metadata processes on l3 agent sync
Currently l3 agent only cleans up stale namespaces.
The fix adds checking and deleting stale metadata processes
to NamespaceManager class responsible for clearing stale
namespaces
Change-Id: I2b081803e312589d3d8a7808d286a6c9827ef53f
Closes-Bug: #1455042
commit c23619417f51f2bbd161cc5bfe314847eb20cd19
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Fri May 29 06:16:46 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I79fd889e390b436fd92fd07951517c50a617b961
commit c9fcbc2e7758acf08867db9a7bc89685cd916bbb
Author: shihanzhang <shihanzhang@huawei.com>
Date: Tue May 26 09:29:58 2015 +0800
Fix ovs agent restore local\_vlan\_map failed
when ovs agent restart, it will restore the local\_vlan\_map, but in
some condition, if a device does not be set tag in ovsdb, the function
'db\_get\_val("Port", port.port\_name, "tag")' will return a empty list,
it does not need 'provision\_local\_vlan' for this device.
Change-Id: I70ed30e6ea5d13e6f14bb41c957320cc21dbca1b
Closes-bug: #1458709
commit a0c9745e90596d4a3207e844332e078ca7ecc5fa
Author: Kevin Benton <blak111@gmail.com>
Date: Thu May 28 16:48:04 2015 -0700
Use correct time delta function
The .seconds attribute of a timedetla object cannot be taken in
isolation because it can overflow into days. For example, a -1 second
difference will become -1 day and 86399 seconds.
This became a problem when the agent clock was slightly ahead of
the server clock. When calling (server\_time - agent\_time).seconds
in this scenario, it would go below 0 in the daily seconds and
wraparound to 86399 seconds and -1 day.
This patch corrects the issue by using a method in timeutils that
ends up calling total\_seconds(), which was designed for this usecase.
It also restores the formatting that was removed in patch:
Ibfc30444b7a167fb18ae9051a775266236d4ecce
Closes-Bug: #1456760
Change-Id: Ie90249ab68bb5f8d117872d52180c7087d8fac9b
commit 36a1d14b58028d0294e67786129a2a09ce393cde
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 20:30:28 2015 +0200
Do not assume order of security group rules
This fixes the unit tests[1] that breaks with a randomized
PYTHONHASHSEED (see the bug report).
The test assumed that the security\_group\_rules\_for\_devices method from
neutron.agent.securitygroups\_rpc returned security group rules in a
particular order. Found with PYTHONHASHSEED=2.
The fix refactors the test case to handle unsorted security group rules.
[1] neutron.tests.unit.plugins.ml2.test\_security\_group.\
TestMl2SGServerRpcCallBack.\
test\_security\_group\_rules\_for\_devices\_ipv4\_ingress\_addr\_pair
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I1b2bd4100c19004f12822c414aefc86aae9849db
commit 818a797693d828d72083ac3b98e54df59574dbe7
Author: Rich Curran <rcurran@cisco.com>
Date: Thu May 28 11:32:21 2015 -0400
ML2: Incorrect commented cisco mechanism driver name
The ml2\_conf.ini example for the cisco mechanism driver is incorrect.
Update to remove confusion.
Change-Id: I0d3aff31a3bc78ef5ee042ff1f37dbb6e1459635
Closes-Bug: 1459723
commit 24ec6e214bb32a1bd79e1c98cecf737ed1fc5d10
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu May 28 14:40:25 2015 +0200
py34: don't run any tests except unit tests
py34 job was intended for unit tests only. It's important to distinguish
between different types of tests, because they all have different
requirements to execution environment. E.g. functional tests are not
expected to run in a restricted env designed for unit tests, and that's
even more valid for fullstack tests.
Otherwise, the job may fail or apply irrecoverable changes to test
runner system, breaking the system.
If we ever want to support py3 for other types of tests, we should add
separate jobs just for that.
Note that the neutron-python3 blueprint was not intended to introduce
changes to support anything but unit test execution with the new Python
version, so strictly speaking, any effort to make other test types work
is out of scope.
Change-Id: Ia96f03f05269c1938b51ee26f4b4075b69967bb8
commit 2fcbbf3031fe1d326ddb2b9bb1b06e0e39422022
Author: John Schwarz <jschwarz@redhat.com>
Date: Thu May 7 09:02:59 2015 +0300
Move full-stack logs post-tests
Currently, it's up to the developer who wants to run full-stack on his
machine to make the directory in question (/opt/stack/logs). However,
this also means that the files don't get compressed at the end of a gate
run. Now, each full-stack test will have each own log directory in /tmp.
Once the logs are there, post\_test\_hook.sh can run 'gzip' on all the log
files before moving them to /opt/stack/logs on its own.
Change-Id: I5c04d0af0b9858722ae0c4baf0ee478ffb078e02
commit b4363a48214f1bb21bd7934f05a6440bb5d66bb7
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu May 28 09:07:23 2015 +0200
Fix PYTHONHASHSEED bugs in test\_security\_groups\_rpc
This fixes the test\_security\_group\_member/rule\_updated unit tests[1]
that breaks with a randomized PYTHONHASHSEED (see the bug report).
The test assumed that several dictionaries had elements in a
particular order. Found with PYTHONHASHSEED=2.
The fix refactors the test case by injecting values using the same
ordering[2].
[1] neutron.tests.unit.agent.test\_securitygroups\_rpc.\
TestSecurityGroupAgentWithOVSIptables
[2] https://github.com/openstack/neutron/blob/\
e8364a72e62d83e5a76bec1d7aa76ecfe2ed53ac/\
neutron/tests/unit/agent/test\_securitygroups\_rpc.py#L1630-L1635
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I5077764045a34d1be0e85bb4b80f3655e87692cc
commit 714c311871333c19c4d6203f79a948b184bf11cf
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Thu May 28 09:17:15 2015 +0300
Addressing follow up comments for OVS\_LIB fail\_mode setting API
Review https://review.openstack.org/#/c/185659/ got merged before i could
see and address the last comment.
This is a follow up patch to address that change
Change-Id: I19135a75cf25e03d6c1f89d7c18e8da3af2ec643
commit 88e499d1c10eaae59546d9f16c9c9c262766de84
Author: Gong Zhang <zhanggbj@cn.ibm.com>
Date: Wed May 27 17:10:17 2015 +0800
Move pool dispose() before os.fork
Currently pool dispose() is done after os.fork, but this will
produce shared DB connections in child processes which may lead
to DB errors.
Move pool dispose() before os.fork. This will remove all existing
connections in the parent process and child processes will create
their own new ones.
Change-Id: Ie36417a64f0eb39b53dad61517f834aec37bacfb
Closes-Bug: 1458718
commit 046f4a0881aa7aea5d231de83e79af12460d9910
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed May 27 15:40:06 2015 -0700
Add RFE submission guidelines
Change-Id: I864c8638a92f5f94e6f059a477ffb56de274ef1c
commit 7a3934d982ef29d8851450b5586319201baa0122
Author: Kevin Benton <blak111@gmail.com>
Date: Fri May 15 17:10:15 2015 -0700
Switch to dictionary for iptables find
The code to find the matching entry was scanning through a
list of all rules for every rule. This became extremely slow
as the number of rules became large, leading to long delays
waiting for firewall rules to be applied.
This patch switches to the use of a dictionary so the cost
becomes a hash lookup instead of a list scan.
Closes-Bug: #1453264
Closes-Bug: #1455675
Change-Id: I1e6fe5e50b9c13066c966c252cadc8ed1d08f686
commit 817b45b6406d9730859535ac54d73ec5c85451d0
Author: Kevin Benton <blak111@gmail.com>
Date: Wed May 27 17:38:32 2015 -0700
Process port IP requests before subnet requests
When a port requests multiple fixed IPs, process the requests
for specific IP addresses before the ones asking for a subnet.
This prevents an error where the IP that was requested happens
to be the next up for allocation so the subnet request takes it
and causes a DBDuplicateEntry.
Closes-Bug: #1459467
Change-Id: I645565c7fe0c47c58d686b25020bb49a0b9089f5
commit 2b7e6552e82f899a91ce3d6973d90778440fac8c
Author: Kevin Benton <blak111@gmail.com>
Date: Wed May 27 14:52:06 2015 -0700
Remove time formatting in agent clock error
This removes time formatting that may be hiding timezone
issues that are leading to a delta being calculated between
the agent and the server even when it shows none. It also
adds logging of the difference so we can see how far off it
thinks they are.
Example message:
during the registration of Open vSwitch agent has a timestamp:
2015-05-19T18:15:27Z. This differs from the current server
timestamp: 2015-05-19T18:15:27Z by more than the threshold agent
downtime: 75.
Note that the timestamps are exactly the same after formatting.
Change-Id: Ibfc30444b7a167fb18ae9051a775266236d4ecce
Related-Bug: #1456760
commit 98d8ad911d07a20af18edb0cac4bcf141a83d969
Author: Kevin Benton <blak111@gmail.com>
Date: Mon May 25 18:55:44 2015 -0700
Persist DHCP leases to a local database
Due to issues caused by dnsmasq restarts sending DHCPNAKs,
change Ieff0236670c1403b5d79ad8e50d7574c1b694e34 passed the
'dhcp-authoritative' option to dnsmasq. While this solved the
restart issue, it broke the multi-DHCP server scenario because
the dnsmasq instances will NAK requests to a server ID that
isn't their own.
Problem DHCP Request Lifecycle:
Client: DHCPDISCOVER(broadcast)
Server1: DHCPOFFER
Server2: DHCPOFFER
Client: DHCPREQUEST(broadcast with Server-ID=Server1)
Server1: DHCPACK
Server2: DHCPNAK(in response to observed DHCPREQUEST with other Server-ID)
^---Causes issues
This change removes the authoritative option so NAKs are not
send in response to DHCPREQUEST's to other servers. To handle
the original issue that Ieff0236670c1403b5d79ad8e50d7574c1b694e34
was inteded to address, this patch also allows changes to be persisted
to a local lease file.
In order to handle the issue where a DHCP server may be scheduled
to another agent, a fake lease file is generated for dnsmasq to start
with. The contents are populated based on all of the known ports for
a network. This should prevent dnsmasq from NAKing clients renewing
leases issued before it was restarted/rescheduled.
Closes-Bug: #1457900
Change-Id: Idc91602bf8c474467e596cbd5cbaa8898952c841
commit 3b8113306a28eab53f0e2e30b0b58c9d8d9db452
Author: Kyle Mestery <mestery@mestery.com>
Date: Wed May 27 17:26:00 2015 +0000
Flesh out the new RFE process and set deadlines for it's use
The new RFE process is great in concept, but as was discovered in the
first neutron-drivers meeting where we discussed these, there exist
some rough edges. Specifically around deadlines and the conversion to
using RFEs, the gray area was very obvious. This patch attempts to put
a stake in the ground for when we transition fully to this new model,
including distinct timelines.
Given that we will need to work with people during the transition,
what is proposed is a way to let us do that while not blocking existing
specs and work.
Change-Id: Ife50f65caf4b13405ad60dd4be3d347aa31ef3a7
commit e135bcea472e08347fc3dc3df01aa1fa909504fb
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 19:57:04 2015 +0200
Do not assume order of dictionary elements in init\_l3
This fixes the test\_interface unit tests[1] that breaks with a
randomized PYTHONHASHSEED (see the bug report).
The test assumed that the init\_l3 method from
neutron.agent.linux.interface had dictionary elements in a particular
order. Found with PYTHONHASHSEED=2.
The fix refactors the test case to handle unsorted dictionaries in
init\_l3.
[1] neutron.tests.unit.agent.linux.test\_interface.TestABCDriver
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I1948593b4d7a0069ef060512942b548c74a6b369
commit 4beb7426587556e0592c055552e0fd70eeb7ac19
Author: Kyle Mestery <mestery@mestery.com>
Date: Fri Apr 24 16:24:39 2015 +0000
Introduce the Lieutenant system into Neutron
As Neutron has grown, the need to continually evolve the way we land
code has changed. As the project has grown, it's become obvious we
need to subdivide responsibilites and merge rights across the
repository. The advanced services split [1] was one way in which we did
this, and it's proven effective. Plugin decomposition was another [2].
As a next step to evolve things, this changes the core reviewer
paradigm into a system of Lieutenants, all reporting to the PTL in the
project. The Lieutenants will be able to maintain their own core
review team. The idea of "super cores" will fade away. And we begin to
see the benefits of a layered, structured approach to managing
Neutron.
This proposal makes an attempt to comment on existing core reviewers.
While the idea of existing core reviewers being labeled as "supercores"
has been floated, the reality is a bit more nuanced than that, and I've
taken steps to address that with this patch. It should be noted that like
all things in Neutron governance, the system is based on a mutual trust.
[1] http://specs.openstack.org/openstack/neutron-specs/specs/kilo/services-split.html
[2] http://specs.openstack.org/openstack/neutron-specs/specs/kilo/core-vendor-decomposition.html
Change-Id: Ia4060066a300e851172c0fd7a2910ce53a6c649e
commit 1e0d201f1d71ce48a096f69700e4097e460ee53a
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Tue May 26 20:33:56 2015 +0000
Isolate use of fixed\_ips[0] to avoid confusion
I was looking at the assumption around using fixed\_ips[0] in a recent
patch [1]. I thought at the least, the usage of fixed\_ips[0] should
be isolated with the comment explaining why it is okay.
I thought that we could also use this patch as an opportunity to vet
the validity of the claim made in the comment.
[1] If4a310da06f9b0076a9f62926a16b574a8c109ce
Change-Id: Iba5713dd7d852429997ff43d98266a9f022d5d86
commit 21f0fac3efd6aaa83494341aead1b6eaddb4d8fb
Author: Christian Berendt <berendt@b1-systems.de>
Date: Wed May 27 15:08:30 2015 +0200
Use the correct name for the "Repository Creator's Guide"
Change-Id: Iaa32ab4bfa658a079da08792a7355ad64471f0eb
commit ce957ac83a85a421f2e60cc39a3103291ba95e4a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 14:54:35 2015 +0200
Do not assume order of convert\_kvp\_list\_to\_dict method responses
This fixes the test\_attributes unit tests[1] that breaks with a
randomized PYTHONHASHSEED (see the bug report).
The test assumed that the convert\_kvp\_list\_to\_dict method from
neutron.api.v2.attributes returned elements in a particular
order. Found with PYTHONHASHSEED=1.
The fix refactors the test case to handle unsorted responses from
convert\_kvp\_list\_to\_dict.
[1] neutron.tests.unit.api.v2.test\_attributes.TestConvertKvp
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I864904db1428b88c482ad17a69b33e876a8d042c
commit e9d17b8bfff31072a3d017ce64e36ac99007a052
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 19:54:22 2015 +0200
Do not assume order of iptables\_firewall method responses
This fixes the iptables\_firewall group unit tests[1] that breaks with
a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the \_get\_remote\_sg\_ids and
\_determine\_remote\_sgs\_to\_remove methods from
neutron.agent.linux.iptables\_firewall returned elements in a particular
order. Found with PYTHONHASHSEED=1.
The fix refactors the test case to handle unsorted responses from
\_get\_remote\_sg\_ids and \_determine\_remote\_sgs\_to\_remove.
[1] neutron.tests.unit.agent.linux.test\_iptables\_firewall:
test\_prepare\_port\_filter\_with\_new\_members
test\_prepare\_port\_filter\_with\_sg\_no\_member
test\_remove\_port\_filter\_with\_destroy\_ipset\_chain
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I19e51452a2bde0721559df746047239f68614336
commit 539738a8eeebcc9f22987fcb0a241c6b8c3d561a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 00:23:09 2015 +0200
Do not assume order of get\_sync\_data\_metering response elements
This fixes the test\_add\_metering\_label\_rpc\_call[1] unit tests that breaks
with a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the get\_sync\_data\_metering[2] had response
elements in a particular order. Found with PYTHONHASHSEED=1.
The fix refactors the test\_add\_metering\_label\_rpc\_call test case to handle
an unsorted get\_sync\_data\_metering response. The fix defines the class
UnorderedList[3] which is equal to any permutation of itself.
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
[1] neutron.tests.unit.services.metering.test\_metering\_plugin:
TestMeteringPluginL3AgentScheduler
TestMeteringPluginL3AgentSchedulerServicePlugin
[2] neutron.services.metering.metering\_plugin.MeteringPlugin
[3] neutron.tests.tools
Change-Id: I5d42b827bc72dcacd38eaa2377ce16c47a9e7dbb
commit 874fa6e02c2f91d711e8186d4e7e7e26c6dc74b9
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Wed May 27 05:10:33 2015 +0900
OVS-agent: Remove optional flags from br\_tun.deferred() method
Currently they have no users.
They are not appropriate for this higher-level interface anyway.
Change-Id: I76b8d718e714728df88685ec41262958d2e78cb9
commit 7ea278087c32235efa793c8c815aff3861410f13
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Tue May 26 19:16:34 2015 +0300
OVS\_LIB support API for setting fail mode 'standalone'
The current API only support setting a bridge fail mode
to secure, this patch allow the user to set it to 'standalone'
as well
Change-Id: If7e6532dc7f8527c35834a37144ea4386fe1b861
Closes-Bug: #1458924
commit eac9fb143cf3e6f4dd2b3413f81dab92d42354ca
Author: Jack McCann <jack.mccann@hp.com>
Date: Wed Apr 15 22:32:51 2015 +0000
Remove hack for sending gratuitous arp from fip ns
I just saw this note toward bottom of the lartc [1] page: "On Linux
2.4, you may need to execute 'echo 1 >
/proc/sys/net/ipv4/ip\_nonlocal\_bind' before being able to send out
unsolicited ARP messages!" I wonder if we set that in fip ns, if it
will let us send grat arp without adding/removing the IP. It couldn't
be that easy, could it?
[1] http://lartc.org/howto/lartc.bridging.proxy-arp.html
Change-Id: Ie55b402a6c46af00c8d4875264489fc4318544b3
commit a1d679678daa560c86bb84303aee6163296ec653
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 13:14:11 2015 +0000
Force order of dhcp.needs\_resync\_reasons dictionary elements
This fixes the test\_periodoc\_resync\_helper unit test that breaks with
a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the dhcp.needs\_resync\_reasons dictionary from
neutron.agent.dhcp.agent had elements in a particular order. Found with
PYTHONHASHSEED=2.
The fix refactors the test case to force a sorted dhcp.needs\_resync\_reasons
dictionary.
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: Ia7fc2c3e605d92d8497d44e28054bdda613cebf2
commit 8ee3020c47cd7eb716216852a90c3db595e2c3c6
Author: ankitagrawal <ankit11.agrawal@nttdata.com>
Date: Thu May 14 05:19:44 2015 -0700
Remove use of contextlib.nested (api-tests)
Removed use of contextlib.nested call from codebase, as it has been
deprecated since Python 2.7.
There are also known issues with contextlib.nested that were addressed
by the native support for multiple "with" variables. For instance, if
the first object is created but the second one throws an exception,
the first object's \_\_exit\_\_ is never called. For more information see
https://docs.python.org/2/library/contextlib.html#contextlib.nested
contextlib.nested is also not compatible with Python 3.
Multi-patch set for easier chunks. This one addresses the tests from
neutron/tests/unit/api directory.
Line continuation markers (e.g. '\') had to be used or syntax
errors were thrown. While using parentheses is the preferred way
for multiple line statements, but in case of long with statements
backslashes are acceptable.
Partial-Bug: 1428424
Change-Id: I09673f9d4c7f07d3043804676fef018905dd1239
commit f0decf6a4061be18999c87eab6ae152d9f75f99f
Author: Angus Lees <gus@inodes.org>
Date: Fri May 15 17:54:18 2015 +1000
Use os.\_exit after forking
As the docs point out(\*), \_exit should be used after a fork() to avoid
both processes flushing filehandles, calling destructors with side
effects, etc. This change does just that.
(\*) https://docs.python.org/2/library/os.html#os.\_exit
Change-Id: I68da6283c44ab8857baf217ac1443bd17988257d
commit 54e91b01cf7b311f48a40c14c7f9c1d8c0926ab4
Author: Angus Lees <gus@inodes.org>
Date: Fri May 15 17:50:33 2015 +1000
test\_fork\_error: Fix incorrect test mock
The previous os.fork mock returned a \*function\* that returned an OSError
object. Oops.
Change-Id: I6e5dff930cf5614f7061efdfd8429963703cc214
commit 9fc7f56565925a53f2212706431af479752bb8d9
Author: Henry Gessau <gessau@cisco.com>
Date: Mon May 25 18:00:58 2015 -0400
Skip external tables for neutron-db-manage --autogenerate
DB tables that do not have models in the neutron tree cause
neutron-db-manage --autogenerate to create commands to drop the
tables. This fix hooks into alembic's environment with a include\_object
callback that ignores external tables.
We already had a list of external tables for use by the migration tests,
so re-use them for --autogenerate.
Partial-bug: #1458682
Change-Id: I2c0bc73f72840c401c578e87d8178a79f05aad82
commit c79d68a7ed347539026acf4c2347740adc617580
Author: Sergey Kolekonov <skolekonov@mirantis.com>
Date: Mon May 25 18:11:35 2015 +0300
Fix a typo in \_schedule\_network method
Fix the small typo which prevented from writing correct DHCP agent id to logs
Change-Id: Id8a872815f7cb2ba68ff1c674f17777da7858562
commit 3682e3391f188845d0c7f382f0ccd4b38db3904e
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon May 4 23:36:19 2015 +0200
Ensure non-overlapping cidrs in subnetpools without galera
\_get\_allocated\_cidrs[1] locks only allocated subnets in a subnetpool
(with mysql/postgresql at least). It ensures we don't allocate a cidr
overlapping with existent cidrs but nothing disallows a concurrent
subnet allocation to create a subnet in the same subnetpool.
This change replaces the lock on subnetpool subnets by a lock on the
subnetpool itself. It disallows to allocate concurrently 2 subnets in
the same subnetpool and ensure non-overlapping cidrs in the same
subnetpool.
Moreover this change solves a trouble with postgresql which disallows
to lock an empty select with an outer join: it happens on first subnet
allocation in a subnetpool when no specific cidr is provided. Moving
the lock ensures the lock is done on a non-empty select.
But this change does not ensure non-overlapping cidrs in subnetpools
with galera because galera doesn't support SELECT FOR UPDATE locks. A
follow-up change will (try to?) remove locks from subnet allocation[1]
in order to ensure non-overlapping cidrs in subnetpools also with galera.
[1] in neutron.ipam.subnet\_alloc.SubnetAllocator
Closes-Bug: #1451558
Partial-Bug: #1451576
Change-Id: I73854f9863f44621ae0d89c5dc4893ccc16d07e4
commit 5f28762ae2a96b8062628d0cac81f5da94c6ed34
Author: John Schwarz <jschwarz@redhat.com>
Date: Thu Apr 16 12:01:26 2015 +0300
Add callback prior to deleting a subnet
When using LBaaS and trying to delete a subnet, neutron has no way of
knowing if the subnet is associated to some pool. As a result, the
subnet is deleted but the pool remains associated to the (now
nonexistent) subnet\_id. This patch lays the ground-work for adding a
check in LBaaS' side to prevent such cases.
Related-Bug: #1413817
Change-Id: I3d5e231b67c72ffd919c92d65b57da56c63e053c
commit eab71473c3a1d40ec3f1d8a84b839b06b140e4fe
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Mon Mar 2 13:14:48 2015 +0900
OVS-agent: Separate ovs-ofctl using code as a driver
This is a preparation to introduce another Ryu-based implementation.
The aim is to replace this with the new Ryu-based implementation
eventually.
Add a config option for OVS-agent which selects the implementation.
Currently, the only available choice is 'ovs-ofctl'.
Also, this commit simplifies DVR logics by reducing duplications
and makes some of DVR UTs actually check the flows rather than just
"add\_flow is called".
Partially-Implements: blueprint ovs-ofctl-to-python
Change-Id: Ie1224f8a1c17268cd7d1c474ed82fdfb8852eaa8
commit 3425be06bf069a256dbb0fdb9528459544e9947f
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon May 25 06:15:25 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If91cdcd85d6fad9b9d37aea367aa11c83ff4b343
commit 514245d63fe902e4548829b9bb66fa60c86509f1
Author: Gary Kotton <gkotton@vmware.com>
Date: Sun May 24 21:19:51 2015 -0700
Remove unnecessary brackets
TrivialFix
Change-Id: I9bd552110785c09b3eaa8762a8141446e51ea02a
commit 9b893767a5214177e30f596b6eed8324278d5050
Author: Anand Shanmugam <anand1712@gmail.com>
Date: Sat May 23 01:22:23 2015 -0700
Ensure mac address added to iptables is always in unix format
When a allowed address pair entry is added with a mac format
other than unix format the ovs-vs agent keeps on restarting as
it is not able to save the proper iptables due to the error
"Error while processing VIF ports". This fix makes sure
that the mac address sent to the iptables firewall is always
in the unix format
Change-Id: I86bbf3cb2adf9b998190e472691c01d068ebab9c
Closes-Bug: #1457971
commit 032847b3030106a9e605b3088826b599789d7991
Author: ankitagrawal <ankit11.agrawal@nttdata.com>
Date: Thu May 14 04:08:36 2015 -0700
Remove use of contextlib.nested
Removed use of contextlib.nested call from codebase, as it has been
deprecated since Python 2.7.
There are also known issues with contextlib.nested that were addressed
by the native support for multiple "with" variables. For instance, if
the first object is created but the second one throws an exception,
the first object's \_\_exit\_\_ is never called. For more information see
https://docs.python.org/2/library/contextlib.html#contextlib.nested
contextlib.nested is also not compatible with Python 3.
Multi-patch set for easier chunks. This one addresses the
neutron/plugins/ml2 directory.
Line continuation markers (e.g. '\') had to be used or syntax
errors were thrown. While using parentheses is the preferred way
for multiple line statements, but in case of long with statements
backslashes are acceptable.
Partial-Bug: 1428424
Change-Id: I7bbe4cec511125b4b2c954aa93e2d9ff6871b9e0
commit 3d2543d710c7071ffeb5c9857ac30a4d95695a7b
Author: dql <duquanglong@gmail.com>
Date: Mon Mar 9 12:52:11 2015 +0800
fix DHCP port changed when dhcp-agent restart
When DHCP server is started, the periodic task is running
before loading cache state.The method port\_update\_end
need to use the cache information, but the cache information
has not been loaded.
Change-Id: I0d1da11bb559b7f0f9d4428b82573fb26916a933
Closes-Bug: #1420042
commit b892df11264de5737e1247862b093ede5d2f5954
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Jan 16 10:00:42 2015 -0800
IPAM reference driver
An alternate pluggable IPAM implementation from the built-in one
in db\_base\_plugin\_v2.
Modifies IPAM interface to allow passing context to driver and
introduces new interface method 'associate\_neutron\_subnet'.
Implements blueprint reference-ipam-driver
Change-Id: I2e1e9fc7994bf1157bcd34b7ea500eb30c61d9ab
commit 676db821ebaf3cce5ce89f4d5d55fcbd772c079b
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Mon May 18 20:49:05 2015 +0000
ovs-agent: prevent ARP requests with faked IP addresses
This patch extends the existing ARP protection to ensure
that ARP requests also have valid IP addresses.
Closes-Bug: 1456333
Change-Id: I0b2ba21611c9fd9e304bce8cfb00259db1dceaa2
commit b91c4e3f874407de07feef338aa2f9a0faafdadd
Author: Cedric Brandily <zzelle@gmail.com>
Date: Fri May 15 18:10:09 2015 +0200
Use namespace names in NetcatTester
Currently NetcatTester requests namespace IPWrapper instances as
client/server\_namespace arguments but functional tests commonly use
namespace names as arguments not IPWrapper instances (because IPWrapper
is cheap to instantiate) and NetcatTester needs only namespace names.
This change requests names as NetcatTester client/server\_namespace
arguments in order to simplify NetcatTester and its use.
Change-Id: Ic4a297efdeaef00e70892d1c871ce1c9174055b8
commit cc1efd085524cd30d6a238a584df193133d27015
Author: John Schwarz <jschwarz@redhat.com>
Date: Thu May 7 15:22:41 2015 +0300
Support for concurrent full-stack tests
This patch introduces the last step of complete test separation for
full-stack tests - separate rabbitmq queues - in the form of rabbitmq
virtual hosts.
\* This patch also renames EnvironmentFixture to FullstackFixture, for
clarity.
Change-Id: I24776e3970a73fdd3271023da7967f2c7261621b
Closes-bug: #1452737
commit 8dbacebf6752e7654afbf9451388b42d4d6355a9
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Fri May 15 11:33:51 2015 +0900
OVS-DVR: Suppress a confusing error log about csnat port
Complain only when the port was seen on a different subnet.
Change-Id: If4a310da06f9b0076a9f62926a16b574a8c109ce
commit dca3cdfae936ae20fcbac392cfde45c7f4d87e45
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Fri Apr 24 13:49:02 2015 +0900
OVS-DVR: Improve an error log about csnat port
Use a single LOG.error per message rather than per lines.
Also, print both of old and new subnets.
Change-Id: I162d3d178fec8b84b66fdfd5a037c2d858c47e30
commit 2acdbf3bac7f4a967e2ef8f98b2ac14fa0f7f861
Author: watanabe.isao <zou.yun@jp.fujitsu.com>
Date: Fri Feb 20 17:38:16 2015 +0900
When disabling dhcp, delete fixed ip properly
When setting enable\_dhcp parameter of subnet to False, the fixed ip of
dhcp port of this subnet is not been removed.
Also a resync will be triggered.
Change-Id: Iebd2c7922978bec0ef154866f24319e899e3b88e
Closes-Bug: 1417379
commit 0ace88fd4a75ff213dc36fd16c1f8e7080ab7d6d
Author: Robert Li <baoli@cisco.com>
Date: Fri May 8 11:08:45 2015 -0400
Add VIF\_DELETED notification event to Nova
It's possible to delete a neutron port that is currently associated
with an instance. When it happens, neutron should notify nova of the
port deletion event so that Nova can take proper actions.
Refer to I998b6bb80cc0a81d665b61b8c4a424d7219c666f for the nova patch
that handles the event.
Change-Id: Iff88cd12ae18017ef3e776821bcf3ecf3b4f052f
Related-Bug: #1333365
Related-Bug: #1448148
commit 6d15bf48ee27ceab64e88f81ba6433058313759a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 9 00:52:29 2015 +0200
Remove from BridgeDevice homemade execute in namespace
Currently BridgeDevice[1] defines homemade execute with namespace
support but could use IPWrapper. This change replaces homemade
implementation with IPWrapper use to respect DRY principle.
[1] neutron.agent.linux.bridge\_lib
Change-Id: I12d4d40432e57ce8b6960276c41321c1efd98705
commit 5099c884c6b09ad0979a560648e8806eaa4642f7
Author: Gary Kotton <gkotton@vmware.com>
Date: Wed May 6 22:49:17 2015 -0700
VMware: update supported plugins
Add all of the supported plugins to the VMware plugin.py file.
The supported plugins are:
- NSX MH
- NSXv
- Simple DVS (this does not support security groups and any layer
functionality). Useful for testing of Neutron with VC.
Change-Id: I9e5c779127ff44674cb60f3c19d4b5c8bdae6101
commit 8e24c7ef566fac7a41b40a12d3480fbdd0ab252b
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Thu Apr 16 06:28:38 2015 +0000
Reduce prefix and suffix length in ipsets
The new NET prefix introduced by I8177699b157cd3eac46e2f481f47b5d966c49b07
increases collision chances by trimming the sg\_id by 3 more chars.
This patch reduces the prefix to 1 single char and also reduces the
swap suffix to reduce the chances of collision.
Change-Id: I8a1559e173a05b2297c5cd2efa9fee7627b88a4f
Related-Bug: #1439817
Related-Bug: #1444397
commit 5509839e0af89467eb14ee178807e2898202101b
Author: Yalei Wang <yalei.wang@intel.com>
Date: Thu Mar 26 15:49:13 2015 +0800
Add port-security extension API test cases
Netron ml2 plugin introduces a new extension port-security from Kilo cycle,
this patch add the API test cases for it. It verifies the default value of the
attribute, for network and port. And It also verifies the confict between
setting port-security and sec-group/address-pairs.
Change-Id: Ie0ec090e8fdce7dbdbce14ef47f38e8e57f262d4
Partially Implements: blueprint ml2-ovs-portsecurity
Depends-On: I3035317c83d22804855517434bd8578719ce0436
commit b85cfa96118d73ad87b150e488f295cbf9a2c140
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Fri Feb 27 08:23:24 2015 +0000
Fix dhcp \_test\_sync\_state\_helper asserting calls wrong
It was using a non-existing method that did nothing and
that masked other problems with the tests that used it.
Changed to use assert\_has\_calls() and fixed the problems
that fell out.
Change-Id: I4a64c3365f9958b14c2384932a31da2ce191e2e2
Closes-Bug: 1426265
commit a377b4fc95f58749178b881d0104ecfaa0b26714
Author: Yalei Wang <yalei.wang@intel.com>
Date: Tue Apr 21 15:17:13 2015 +0800
Fix port creation verification of the port-security extension
When port is created, we should check the content of the security-group and
address-pairs like we do when port updated.
This patch also updates address-pairs testing unskipping some
port-security-related tests.
Change-Id: Ia27881a34ff99cad34c84764d2bf8a6cdf77af9c
Closes-Bug: #1446087
commit 7260e0e3fc2ea479e80e0962624aca7fd38a1f60
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Apr 27 09:59:21 2015 -0400
Run radvd as root
During the refactoring of external process management radvd lost
its root privileges.
Closes-bug: 1448813
Change-Id: I84883fe81684afafac9b024282a03f447c8f825a
(cherry picked from commit a5e54338770fc074e01fa88dbf909ee1af1b66b2)
commit 4e71c48bbfd5e8b8c59f0c45ade52ba8eddc8b63
Author: rossella <rsblendido@suse.com>
Date: Thu Jan 15 16:15:23 2015 +0100
Add devices to update in RPC call security\_groups\_provider\_updated
When a security\_groups\_provider\_updated is received then a global
refresh of the firewall is performed. This can be avoided if the
plugins pass as parameter of the call the devices that belongs to
the network updated.
Partially-Implements: blueprint restructure-l2-agent
Change-Id: I1e78f3a5ec7e5c5bcba338a0097566422411ef7e
commit d37e566dcadf8a540eb5f84b668847fa192393a1
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Apr 24 00:35:31 2015 -0700
Don't resync on DHCP agent setup failure
There are various cases where the DHCP agent will try to
create a DHCP port for a network and there will be a failure.
This has primarily been caused by a lack of available IP addresses
in the allocation pool. Trying to fix all availability corner cases
on the server side will be very difficult due to race conditions between
multiple ports being created, the dhcp\_agents\_per\_network parameter, etc.
This patch just stops the resync attempt on the agent side if a failure
is caused by an IP address generation problem. Future updates to the subnet
will cause another attempt so if the tenant does fix the issue they will
get DHCP service.
Change-Id: I0896730126d6dca13fe9284b4d812cfb081b6218
Closes-Bug: #1447883
(cherry picked from commit db9ac7e0110a0c2ef1b65213317ee8b7f1053ddc)
commit 38211ae67cb76ade85b08c028b6e88bfc867afc9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Apr 20 17:06:38 2015 +0200
tests: confirm that \_output\_hosts\_file does not log too often
I3ad7864eeb2f959549ed356a1e34fa18804395cc didn't include any regression unit
tests to validate that the method won't ever log too often again,
reintroducing performance drop in later patches. It didn't play well
with stable backports of the fix, where context was lost when doing the
backport, that left the bug unfixed in stable/juno even though the patch
was merged there [1].
The patch adds an explicit note in the code that suggests not to add new
log messages inside the loop to avoid regression, and a unit test was
added to capture it.
Once the test is merged in master, it will be proposed for stable/juno
inclusion, with additional changes that would fix the regression again.
Related-Bug: #1414218
Change-Id: I5d43021932d6a994638c348eda277dd8337cf041
(cherry picked from commit 3b74095a935f6d2027e6bf04cc4aa21f8a1b46f2)
commit 53b3e751f3c7b32bed48c14742d3dd3a1178d00d
Author: Maru Newby <marun@redhat.com>
Date: Thu Apr 9 17:00:57 2015 +0000
Double functional testing timeout to 180s
The increase in ovs testing is resulting in job failure due to
timeouts in test\_killed\_monitor\_respawns. Giving the test more
time to complete should reduce the failure rate.
Change-Id: I2ba9b1eb388bfbbebbd6b0f3edb6d5a5ae0bfead
Closes-Bug: #1442272
(cherry picked from commit 81098620c298394e1a98127ceeba7f297db2d906)
commit 0536ec113bc438265ba547bb8a8006aa96e646e3
Author: watanabe.isao <zou.yun@jp.fujitsu.com>
Date: Wed Apr 15 15:48:08 2015 +0900
Restrict subnet create/update to avoid DHCP resync
As we know, IPs in subnet CIDR are used for
1) Broadcast port
2) Gateway port
3) DHCP port if enable\_dhcp is True, or update to True
4) Others go into allocation\_pools
Above 1) to 3) are created by default, which means if CIDR doesn't
have that much of IPs, subnet create/update will cause a DHCP resync.
This fix is to add some restricts to the issue:
A) When subnet create, if enable\_dhcp is True, /31 and /32
cidrs are forbidden for IPv4 subnets while /127 and /128 cidrs are
forbidden for IPv6 subnets.
B) When subnet update, if enable\_dhcp is changing to True and there are no
more IPs in allocation\_pools, the request should be denied.
Change-Id: I2e4a4d5841b9ad908f02b7d0795cba07596c023d
Co-authored-by: Andrew Boik <dboik@cisco.com>
Closes-Bug: #1443798
(cherry picked from commit 0c1f96ad5a6606c1205bd50ea944c3a383892cde)
commit cbfb3e487d97998ec49d7faa751bc26202da7d0e
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Apr 20 22:26:22 2015 -0700
Only update MTU in update code for MTU
The ML2 create\_network\_db was re-passing in the entire network
with extensions like vlan\_transparency present that was causing
issues in the base update function it was calling.
This corrects the behavior by having it only update the MTU, which
is the only thing it was intending to update in the first place.
Change-Id: I723c5c138e0830de98f6024c7635ec65065e9346
Closes-Bug: #1446784
(cherry picked from commit f85de393c469d1e649a1c1e5ee1b683246442351)
commit 9bc812e92fb27b297ccfe960267dcab173aea6c9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Apr 23 02:15:06 2015 +0000
Updated from global requirements
Change-Id: I514c65fac38ef0e534e7401a5f3643b1906adea7
commit aa57c364defec8519bbed06fbce5aae4b23f147f
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed Apr 22 16:47:33 2015 +0200
Create bridges in ovsdb monitor functional tests
The test waits inside for output from 'ovsdb-client monitor Bridge'
command but the command makes output only if there is a bridge present
in ovsdb. This patch adds an OVSBridgeFixture to setup so every test
case has a bridge for sure.
Change-Id: I40e1c99ec956c92fa1c7763eb98f7f2ce6fcd226
Closes-Bug: 1447191
commit d506b50badda7af30d1154561acd45caef44ca11
Author: Andy Hill <hillad@gmail.com>
Date: Mon Apr 20 13:00:28 2015 -0400
Add use\_slave DB api support
The example configuration refers to slave\_connection[1] but slaves aren't used
in the codebase. This change will enable plugin authors to use
slave\_connection by passing use\_slave=True to the SQLAlchemy session[2][3].
[1] http://docs.openstack.org/juno/config-reference/content/section\_neutron.conf.html
[2] http://docs.openstack.org/developer/oslo.db/api/sqlalchemy/session.html#oslo\_db.sqlalchemy.session.EngineFacade.get\_session
[3] https://wiki.openstack.org/wiki/Slave\_usage
Change-Id: I6f46c11fad5c58577654a4011cf82d19f6d3e1e3
commit 407be289360ec6dabbbe14d9b18dae7c9fa2db79
Author: Kawaguchi <ken-kawaguchi@vt.jp.nec.com>
Date: Tue Apr 21 13:27:52 2015 +0900
Fix typo acomplished => accomplished
Change-Id: I73722e9984917a5a8c4e74207cf14d4040a7cf2f
Related-Bug: #1390035
commit b339391bcb223c0f03d30f36dea47d13adb12c71
Author: mathieu-rohon <mathieu.rohon@gmail.com>
Date: Sat Mar 7 13:30:49 2015 +0100
ML2: Change port status only when it's bound to the host
Currently, nothing prevents the port status to be changed to BUILD
state when get\_device\_details() is sent by a host that doesn't own
the port.
In some cases the port might stay in BUILD state.
This could happen during a live-migration, or for multi-hosted ports
such as HA ports.
This commit allows the port status modification only if the port
is bound to the host that is asking for it.
Closes-Bug: #1439857
Closes-Bug: #1438040
Closes-Bug: #1416933
Change-Id: I9b3673f453abbafaaa4f78542fcfebe8dc93f2bb
(cherry picked from commit 9b53b82ce7dad551ebc0f02ff667d5345fb7e139)
commit f7ae3a04b541767c638fc4c8ff1e0db78ab94996
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:07:37 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Change-Id: I1b7bd1773bcd12ab282e77ee0dc41c27846fb66b
commit 952e556e4e6b0e25ca584481ef6745fc08ace970
Author: Matt Riedemann <mriedem@us.ibm.com>
Date: Fri Apr 17 08:47:35 2015 -0700
Register ibm-db-alembic import for DB2 migrations
This patch adds the optional runtime dependency to support db2
for alembic migration, will not break the default mysql path.
This is needed for the IBM DB2 third party CI to work on this
project.
Closes-Bug: 1442524
Change-Id: I9db112dbdc2d02df88ad676a6b21018f1d6f1724
commit e2f6902315de76a1020aa87ea161c8fdc6697ed7
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Tue Apr 14 21:34:33 2015 -0700
Fixes race condition and boosts the scheduling performance
This patch fixes a race-condition that occurs when the
scheduler tries to check for dvr serviceable ports before
it schedules a router when a subnet is associated with
a router.
Sometimes the dhcp port creation is delayed and so the
router is not scheduled to the l3-agent.
Also it boosts the scheduling performance on dvr-snat
node for scheduling a router.
This patch will provide a work around to fix this race
condition and to boost the scheduling performance
by scheduling a router on a dvr-snat when
dhcp is enabled on the provided subnet, instead of checking
all the available ports on the subnet.
Closes-Bug: #1442494
Change-Id: I089fefdd8535bdc9ed90b3230438ab0bfb6aab4f
(cherry picked from commit c65d3ab6ad4589e6e4a6b488d2eb5d1e4cfee138)
commit a6b2c22dcea73754dbfd0ef39c60ad28ab2dbb73
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Mar 30 23:52:56 2015 -0700
Set IPset hash type to 'net' instead of 'ip'
The previous hash type was 'ip' and this caused a major
issue with the allowed address pairs extension since it
results in CIDRs being passed to ipset. When the hash type
is 'ip', a CIDR is completely enumerated into all of its
addresses so 10.100.0.0/16 results in ~65k entries. This
meant a single allowed\_address\_pairs entry could easily
exhaust an entire set.
This patch changes the hash type to 'net', which is designed
to handle a CIDRs as a single entry.
This patch also changes the names of the ipsets because
creating an ipset with different parameters will cause an
error and our ipset manager code isn't robust enough to handle
that at this time. There is another ongoing patch to fix
that but it won't be ready in time.[1]
The related bug was closed by increasing the set limit, which
did alleviate the problem. However, this change would also
address the issue because the gate tests run an allowed address
pairs extension test with the CIDR mentioned above.
1. I59e2e1c090cb95ee1bd14dbb53b6ff2c5e2713fd
Related-Bug: #1439817
Closes-Bug: #1444397
Change-Id: I8177699b157cd3eac46e2f481f47b5d966c49b07
(cherry picked from commit a38b5df5cd3c47672705aad4c30e789ae11ec958)
commit 8b8095e43a143426c501669167490d7867a55749
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Mar 31 08:53:56 2015 -0700
Revert "Add ipset element and hashsize tunables"
This reverts commit b5b919a7a3569ccb93c3d7d523c1edfaeddb7cb9.
The current ipset manager code isn't robust enough to handle
ipsets that already exist with different parameters. This reverts
the ability to change the parameters so we don't break upgrades
to Kilo.
Conflicts:
neutron/agent/linux/ipset\_manager.py
neutron/tests/unit/agent/linux/test\_ipset\_manager.py
Change-Id: I538714df52424f0502cb75daea310517d1142c42
Closes-Bug: #1444201
(cherry picked from commit 03be14a569d240865dabff8b4c30385abf1dbe62)
commit 2add4e5ad4d12c817737d04ddb973b3aeeb25af3
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Apr 16 16:27:38 2015 -0700
Update .gitreview to point to stable/kilo
This is the stable/kilo branch. When people make changes
here it's highly likely that they want to propose them
to stable/kilo on gerrit.
Change-Id: Ie61a9f0c0b0b4896da33a201e42b1c4bc4bae49b
commit ffc48f286e1756302d9259dc514dd562d3c251ba
Author: Henry Gessau <gessau@cisco.com>
Date: Thu Apr 16 13:38:46 2015 -0400
Add Kilo release milestone
Change-Id: Id7d969c92b7c757b766760681357ac13c8079ca3
commit 1dc98e414f200a78a6b1dc78f222c588646e6935
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Thu Apr 9 10:32:33 2015 -0400
IPv6 SLAAC subnet create should update ports on net
If ports are first created on a network, and then an IPv6 SLAAC
or DHCPv6-stateless subnet is created on that network, then the
ports created prior to the subnet create are not getting
automatically updated (associated) with addresses for the
SLAAC/DHCPv6-stateless subnet, as required.
Change-Id: I88d04a13ce5b8ed4c88eac734e589e8a90e986a0
Closes-Bug: 1427474
Closes-Bug: 1441382
Closes-Bug: 1440183
(cherry picked from commit bd1044ba0e9d7d0f4752c891ac340b115f0019c4)
commit 55536a4ecb6c71e5451b8a9664d87e32146f071d
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Apr 10 15:07:33 2015 +0200
Removed ml2\_conf\_odl.ini config file
The file is already packaged into decomposed networking-odl repo [1].
[1]: https://git.openstack.org/cgit/stackforge/networking-odl/tree/etc/neutron/plugins/ml2/ml2\_conf\_odl.ini
Closes-Bug: #1442615
Change-Id: Ic280454190aab4e3b881cde15a882808b652861e
(cherry picked from commit b3334eca0ae9f9c64ccd646035e69081f669e3e4)
commit 857322c30ecfed11e770f0aea7b234f8ffdc0db1
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Wed Mar 4 15:50:07 2015 +0300
Use accessors instead of private attributes for Ml2 plugin
Start using accessors instead of private attributes of PortContext
and NetworkContext where it is possible.
Closes-bug: #1424587
Change-Id: Ie3d963ae6cee9782d65ba683936072602c78ebaa
commit 40783cee5e520173a4cc37c23dd97be2d37b65fd
Author: Angus Lees <gus@inodes.org>
Date: Mon Mar 2 17:06:54 2015 +1100
Ensure tests run under python2.7
tox uses whatever python version that tox ran with as the default python
version for environments (py27,py3x, etc are given a more specific
default).
Debian's python-tox (for example) uses python3, but we require python2.7
- and a naive `apt-get install python-tox; tox -epep8` fails with
py3-related errors on Debian.
This change explicitly sets `basepython = python2.7` in several testing
environments that would otherwise have used the default basepython.
Change-Id: I377ac6d72dec5b85c105d8a1a74f6974efb84dcf

| **tags**: | added: in-feature-pecan |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-02:  [**Fix merged to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/79) |  |  | [#79](/neutron/%2Bbug/1461054/comments/79) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/194697>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=9ff6138c47c95034ba845e9448ddffd147b51f38>

Submitter: Jenkins

Branch: stable/kilo

commit 9ff6138c47c95034ba845e9448ddffd147b51f38

Author: Aaron Rosen <email address hidden>

Date: Wed Jun 3 16:19:39 2015 -0700

Provide work around for 0.0.0.0/0 ::/0 for ipset

Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if

    these addresses were inputted as allowed address pairs. This causes

    ipset to raise an error as it does not work with zero prefix sizes.

    To solve this problem we use two ipset rules to represent this:

Ipv4: 0.0.0.0/1 and 128.0.0.1/1

    IPv6: ::/1' and '8000::/1

All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager

    which is called to convert the input.

Conflicts:

     neutron/agent/linux/ipset\_manager.py

     neutron/tests/unit/agent/linux/test\_ipset\_manager.py

Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75

    Closes-bug: 1461054

Reviewed: https://review.openstack.org/194697
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=9ff6138c47c95034ba845e9448ddffd147b51f38
Submitter: Jenkins
Branch: stable/kilo
commit 9ff6138c47c95034ba845e9448ddffd147b51f38
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 3 16:19:39 2015 -0700
Provide work around for 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager
which is called to convert the input.
Conflicts:
neutron/agent/linux/ipset\_manager.py
neutron/tests/unit/agent/linux/test\_ipset\_manager.py
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-07-02

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-09:  [**Related fix merged to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/80) |  |  | [#80](/neutron/%2Bbug/1461054/comments/80) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/194742>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=88d76bc37f242ab89865cbe4e25cc5e928495d91>

Submitter: Jenkins

Branch: stable/kilo

commit 88d76bc37f242ab89865cbe4e25cc5e928495d91

Author: Kevin Benton <email address hidden>

Date: Wed Jun 3 15:20:27 2015 -0700

Skip ARP protection if 0.0.0.0/0 in addr pairs

Don't setup ARP protection on ports with allowed address pairs

    that allow them to use any IP address. This is necessary because

    OVS doesn't support the /0 prefix in rules that match on ARP headers.

Related-Bug: #1461054

    Closes-Bug: #1468009

    Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec

    (cherry picked from commit 747738d36572079307f228a861a067ca0cd815c2)

Reviewed: https://review.openstack.org/194742
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=88d76bc37f242ab89865cbe4e25cc5e928495d91
Submitter: Jenkins
Branch: stable/kilo
commit 88d76bc37f242ab89865cbe4e25cc5e928495d91
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 15:20:27 2015 -0700
Skip ARP protection if 0.0.0.0/0 in addr pairs
Don't setup ARP protection on ports with allowed address pairs
that allow them to use any IP address. This is necessary because
OVS doesn't support the /0 prefix in rules that match on ARP headers.
Related-Bug: #1461054
Closes-Bug: #1468009
Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec
(cherry picked from commit 747738d36572079307f228a861a067ca0cd815c2)

| **tags**: | added: in-stable-kilo |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-07-10

| **description**: | updated |
| --- | --- |

[Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann)
on 2015-07-29

| Changed in neutron: | |
| --- | --- |
| **milestone**: | none → liberty-2 |
| **status**: | Fix Committed → Fix Released |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-10-15

| Changed in neutron: | |
| --- | --- |
| **milestone**: | liberty-2 → 7.0.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andrey Kirilochkin (andreika-mail)](https://launchpad.net/~andreika-mail) wrote on 2017-07-14: |  |  | [#81](/neutron/%2Bbug/1461054/comments/81) |
| --- | --- | --- | --- |

only this works for me

1.0.0.0.0/1

128.0.0.0/1

This solution did not worked for me.

0.0.0.0.0/1

128.0.0.0/1

only this works for me
1.0.0.0.0/1
128.0.0.0/1
This solution did not worked for me.
0.0.0.0.0/1
128.0.0.0/1

[See full activity log](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/neutron/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/neutron/%2Bbug/1461054/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [fix\_ipset\_validation\_bug.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4409471/%2Bfiles/fix_ipset_validation_bug.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4409471 "Change patch details")
* [fix\_ipset\_validation\_bug\_kilo.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410605/%2Bfiles/fix_ipset_validation_bug_kilo.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410605 "Change patch details")
* [juno-reject-prefix-zero.diff](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4412213/%2Bfiles/juno-reject-prefix-zero.diff)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4412213 "Change patch details")
* [zero\_length\_addressses\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413508/%2Bfiles/zero_length_addressses_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413508 "Change patch details")
* [fix\_for\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413521/%2Bfiles/fix_for_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413521 "Change patch details")
* [fix\_for\_juno\_2.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4415238/%2Bfiles/fix_for_juno_2.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4415238 "Change patch details")

* [Add patch](/neutron/%2Bbug/1461054/%2Baddcomment?field.patch=on)

## Bug attachments

* [arp00000patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410106/%2Bfiles/arp00000patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410106 "Change attachment details")

* [Add attachment](/neutron/%2Bbug/1461054/%2Baddcomment)

## Remote bug watches

* [python-roundup #21239](http://bugs.python.org/issue21239)

  [2:3]
  [Edit](/bugs/1461054/%2Bwatch/116478 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_d5a516ce_20250126_074916.html ===




=== Content from translations.launchpad.net_438d433b_20250126_074923.html ===

[Log in / Register](https://translations.launchpad.net/neutron/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* Translations
* [Answers](https://answers.launchpad.net/neutron)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

**neutron does not use Launchpad
to translate its messages.**

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_4a3aacfb_20250126_074918.html ===




=== Content from bugzilla.redhat.com_7142edf6_20250126_074930.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1232284)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1232284)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1232284)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1232284

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1232284**](show_bug.cgi?id=1232284)
(CVE-2015-3221)
- [CVE-2015-3221](https://access.redhat.com/security/cve/CVE-2015-3221) openstack-neutron: L2 agent DoS through incorrect allowed address pairs

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2015-3221 openstack-neutron: L2 agent DoS through incorrect allowed addre...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2015-3221 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1233450](show_bug.cgi?id=1233450) [1234263](show_bug.cgi?id=1234263) [1240145](show_bug.cgi?id=1240145 "CLOSED EOL - CVE-2015-3221 openstack-neutron: L2 agent DoS through incorrect allowed address pairs [fedora-all]") [1240146](show_bug.cgi?id=1240146) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1232286](show_bug.cgi?id=1232286) | | TreeView+ | [depends on](buglist.cgi?bug_id=1232284&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1232284&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-06-16 12:27 UTC by Vasyl Kaigorodov | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-05-12 09:39 UTC ([History](show_activity.cgi?id=1232284)) | | [CC List:](page.cgi?id=fields.html#cclist) | 18 users (show)  abaron aortega apevec ayoung chrisw dallan gkotton gmollett lhh lpeer markmc nyechiel rbryant sclewis security-response-team slong tdecacqu yeylon | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A Denial-of-Service flaw was found in the OpenStack Networking (neutron) L2 agent when using the iptables firewall driver. By submitting an address pair that is rejected as invalid by the ipset tool (with zero prefix size), an authenticated attacker can cause the L2 agent to crash. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2015-08-26 04:43:14 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**cve-2015-3221-master-liberty.patch**](attachment.cgi?id=1040537 "View the content of the attachment") (4.86 KB, text/plain)  [2015-06-18 15:41 UTC](#attach_1040537 "Go to the comment associated with the attachment"), Vasyl Kaigorodov | *no flags* | [Details](attachment.cgi?id=1040537&action=edit) | | [**cve-2015-3221-stable-juno.patch**](attachment.cgi?id=1040538 "View the content of the attachment") (6.31 KB, text/plain)  [2015-06-18 15:42 UTC](#attach_1040538 "Go to the comment associated with the attachment"), Vasyl Kaigorodov | *no flags* | [Details](attachment.cgi?id=1040538&action=edit) | | [**cve-2015-3221-stable-kilo.patch**](attachment.cgi?id=1040539 "View the content of the attachment") (5.12 KB, text/plain)  [2015-06-18 15:42 UTC](#attach_1040539 "Go to the comment associated with the attachment"), Vasyl Kaigorodov | *no flags* | [Details](attachment.cgi?id=1040539&action=edit) | | [View All](attachment.cgi?bugid=1232284&action=viewall) | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Launchpad | [1461054](https://bugs.launchpad.net/bugs/1461054) | 0 | None | None | None | Never | | Red Hat Product Errata | [RHSA-2015:1680](https://access.redhat.com/errata/RHSA-2015%3A1680) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-neutron security and bug fix update | 2015-08-25 00:12:31 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1232284#c0)  Vasyl Kaigorodov    2015-06-16 12:27:30 UTC  ``` Title: Neutron L2 agent DoS through incorrect allowed address pairs Reporter: Darragh O'Reilly (HP) Products: Neutron Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version  Description: Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an address pair which is rejected as invalid by the ipset tool, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.  Acknowledgements:  Red Hat would like to thank the OpenStack upstream for reporting this issue. Upstream acknowledges Darragh O'Reilly (HP) as the original reporter.   ```  [Comment 1](show_bug.cgi?id=1232284#c1)  Vasyl Kaigorodov    2015-06-18 15:41:59 UTC  ``` Created [attachment 1040537](attachment.cgi?id=1040537 "cve-2015-3221-master-liberty.patch") [[details]](attachment.cgi?id=1040537&action=edit "cve-2015-3221-master-liberty.patch") cve-2015-3221-master-liberty.patch   ```  [Comment 2](show_bug.cgi?id=1232284#c2)  Vasyl Kaigorodov    2015-06-18 15:42:03 UTC  ``` Created [attachment 1040538](attachment.cgi?id=1040538 "cve-2015-3221-stable-juno.patch") [[details]](attachment.cgi?id=1040538&action=edit "cve-2015-3221-stable-juno.patch") cve-2015-3221-stable-juno.patch   ```  [Comment 3](show_bug.cgi?id=1232284#c3)  Vasyl Kaigorodov    2015-06-18 15:42:06 UTC  ``` Created [attachment 1040539](attachment.cgi?id=1040539 "cve-2015-3221-stable-kilo.patch") [[details]](attachment.cgi?id=1040539&action=edit "cve-2015-3221-stable-kilo.patch") cve-2015-3221-stable-kilo.patch   ```  [Comment 6](show_bug.cgi?id=1232284#c6)  Tristan Cacqueray    2015-06-19 20:10:57 UTC  ``` Some more notes, the kilo and liberty patch are self healing, if a zero prefixed address pair have already been assigned, then it will be fixed when the service restarts.  Juno patch on the other hand will block attempt to use zero prefixed address pair and if a zero prefixed address pair have already been assigned, then the script included in the patch needs to be run in order to fix it.   ```  [Comment 8](show_bug.cgi?id=1232284#c8)  Garth Mollett    2015-07-06 05:19:27 UTC  ```  Created openstack-neutron tracking bugs for this issue:  Affects: fedora-all [[bug 1240145](show_bug.cgi?id=1240145 "CLOSED EOL - CVE-2015-3221 openstack-neutron: L2 agent DoS through incorrect allowed address pairs [fedora-all]")] Affects: openstack-rdo [[bug 1240146](show_bug.cgi?id=1240146)]   ```  [Comment 10](show_bug.cgi?id=1232284#c10)  errata-xmlrpc    2015-08-24 20:15:43 UTC  ``` This issue has been addressed in the following products:    OpenStack 6 for RHEL 7  Via RHSA-2015:1680 <https://rhn.redhat.com/errata/RHSA-2015-1680.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1232284&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugzilla.redhat.com_47f7cd2b_20250126_074928.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1250056)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1250056)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1250056)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1250056

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1250056**](show_bug.cgi?id=1250056)
- neutron unnecessarily blocks python-oslo-db >= 1.1.0

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
neutron unnecessarily blocks python-oslo-db >= 1.1.0

| | [Keywords](describekeywords.cgi): | ZStream | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-neutron | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 6.0 (Juno) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | unspecified | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | z4 | | [Target Release](page.cgi?id=fields.html#target_release): | 6.0 (Juno) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Ihar Hrachyshka | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Eran Kuris | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [track-osp6-osp7](show_bug.cgi?id=1249564 "CLOSED CURRENTRELEASE - Tracker bug for upgrade from RHOS6--->RHOS7") | | TreeView+ | [depends on](buglist.cgi?bug_id=1250056&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1250056&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-08-04 12:21 UTC by Ihar Hrachyshka | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-02-22 23:02 UTC ([History](show_activity.cgi?id=1250056)) | | [CC List:](page.cgi?id=fields.html#cclist) | 6 users (show)  chrisw lpeer nyechiel sclewis tfreger yeylon | | Fixed In Version: | openstack-neutron-2014.2.3-8.el7ost | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2015-08-24 20:15:50 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Issue Tracker | [OSP-16637](https://issues.redhat.com/browse/OSP-16637) | 0 | None | None | None | 2022-07-09 07:42:07 UTC | | Red Hat Product Errata | [RHSA-2015:1680](https://access.redhat.com/errata/RHSA-2015%3A1680) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-neutron security and bug fix update | 2015-08-25 00:12:31 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1250056#c0)  Ihar Hrachyshka    2015-08-04 12:21:11 UTC  ``` - Installing python-oslo-db results in:      --> Processing Conflict: python-neutron-2014.2.3-2.el7ost.noarch     conflicts python-oslo-db >= 1.1.0  This is because of Conflicts: tags used in the spec. They do not belong there and were removed in OSP7.   ```  [Comment 4](show_bug.cgi?id=1250056#c4)  Eran Kuris    2015-08-16 13:37:51 UTC  ``` fixed in :  [root@puma48 ~]# rpm  -qa |grep  python-oslo python-oslo-vmware-0.6.0-1.el7ost.noarch python-oslo-utils-1.0.0-1.el7ost.noarch python-oslo-i18n-1.0.0-1.el7ost.noarch python-oslo-config-1.4.0-1.el7ost.noarch python-oslo-serialization-0.3.0-1.el7ost.noarch python-oslo-db-1.0.2-2.el7ost.noarch python-oslo-rootwrap-1.3.0.0-2.el7ost.noarch python-oslo-messaging-1.4.1-5.el7ost.noarch [root@puma48 ~]# rpm  -qa |grep  python-neutron python-neutronclient-2.3.9-1.el7ost.noarch python-neutron-2014.2.3-9.el7ost.noarch [root@puma48 ~]# rpm  -qa |grep  openstack-neutron openstack-neutron-ml2-2014.2.3-9.el7ost.noarch openstack-neutron-common-2014.2.3-9.el7ost.noarch openstack-neutron-2014.2.3-9.el7ost.noarch openstack-neutron-openvswitch-2014.2.3-9.el7ost.noarch   ```  [Comment 6](show_bug.cgi?id=1250056#c6)  errata-xmlrpc    2015-08-24 20:15:50 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory, and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  <https://rhn.redhat.com/errata/RHSA-2015-1680.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1250056&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from launchpad.net_358978c3_20250126_074922.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6535](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |  |  |
| --- | --- | --- | --- |
| [kolla-ansible](/kolla-ansible) |  |  |  |
| [kolla](/kolla) |  |  |  |
| [kayobe](/kayobe) |  |  |  |
| [OpenStack Compute (nova)](/nova) |  |  |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from answers.launchpad.net_bbf3e90b_20250126_074924.html ===

[Log in / Register](https://answers.launchpad.net/neutron/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* Answers

# Questions for neutron

**Launchpad does not know where
neutron
tracks support requests.**

neutron questions are
tracked in:
[neutron in Ubuntu](/ubuntu/%2Bsource/neutron),
[neutron-fwaas in Ubuntu](/ubuntu/%2Bsource/neutron-fwaas),
[neutron-lbaas in Ubuntu](/ubuntu/%2Bsource/neutron-lbaas),
[neutron-vpnaas in Ubuntu](/ubuntu/%2Bsource/neutron-vpnaas),
[quantum in Ubuntu](/ubuntu/%2Bsource/quantum).

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_18b1b032_20250126_074927.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1227635)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1227635)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1227635)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1227635

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1227635**](show_bug.cgi?id=1227635)
- DHCPNAK after neutron-dhcp-agent restart

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
DHCPNAK after neutron-dhcp-agent restart

| | [Keywords](describekeywords.cgi): | ZStream | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-neutron | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 6.0 (Juno) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | z4 | | [Target Release](page.cgi?id=fields.html#target_release): | 6.0 (Juno) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Nir Magnezi | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Toni Freger | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1227635&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1227635&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2015-06-03 08:16 UTC by Nir Magnezi | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-07-09 07:41 UTC ([History](show_activity.cgi?id=1227635)) | | [CC List:](page.cgi?id=fields.html#cclist) | 11 users (show)  amedeo.salvati chrisw ihrachys lhh lpeer nyechiel oblaut pablo.iranzo sauchter tfreger yeylon | | Fixed In Version: | openstack-neutron-2014.2.3-6.el7ost | | | Doc Type: | Bug Fix | | | Doc Text: | Previously, dnsmasq did not save lease information in persistent storage, and when it was restarted, the lease information was lost. This behavior was a result of the removal of the dnsmasq '--dhcp-script' option under BZ#1202392. As a result, instances were stuck in the network boot process for a long period of time. In addition, NACK messages were noted in the dnsmasq log. This update addresses this issue by removing the authoritative option, so that NAKs are not sent in response to DHCPREQUESTs to other servers. This change is expected tp prevent dnsmasq from NAKing clients renewing leases issued before it was restarted/rescheduled, with the result that no DHCPNAK messages can be found in the log files. | | | Clone Of: | [1227633](show_bug.cgi?id=1227633 "CLOSED ERRATA - DHCPNAK after neutron-dhcp-agent restart") | | | Environment: |  | | | Last Closed: | 2015-08-24 20:15:40 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Launchpad | [1345947](https://bugs.launchpad.net/bugs/1345947) | 0 | None | None | None | Never | | Launchpad | [1457900](https://bugs.launchpad.net/bugs/1457900) | 0 | None | None | None | Never | | Red Hat Issue Tracker | [OSP-16634](https://issues.redhat.com/browse/OSP-16634) | 0 | None | None | None | 2022-07-09 07:41:38 UTC | | Red Hat Knowledge Base (Solution) | [1584893](https://access.redhat.com/solutions/1584893) | 0 | None | None | None | Never | | Red Hat Product Errata | [RHSA-2015:1680](https://access.redhat.com/errata/RHSA-2015%3A1680) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-neutron security and bug fix update | 2015-08-25 00:12:31 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1227635#c0)  Nir Magnezi    2015-06-03 08:16:38 UTC  ``` +++ This bug was initially created as a clone of [Bug #1227633](show_bug.cgi?id=1227633 "CLOSED ERRATA - DHCPNAK after neutron-dhcp-agent restart") +++  Description of problem: =======================  After rolling out a configuration change, we restarted neutron-dhcp-agent service, and then dnsmasq logs start flooding: DHCPNAK ... lease not found. DHCPNAK is replied by dnsmasq for all DHCPREQUEST renews from all VMs. However the MAC and IP pairs exist in host files. The log flooding increases when more and more VMs start renewing and they keep retrying until IP expire and send DHCPDISCOVER and reinit the IP. The log flooding gradually disappears when the VMs IP expire and send DHCPDISCOVER, to which dnsmasq respond DHCPOFFER properly.  Analysis: ========= I noticed that option --leasefile-ro is used in dnsmasq command when started by neutron dhcp-agent. According to dnsmasq manual, this option should be used together with --dhcp-script to customize the lease database. However, the option --dhcp-script was removed when fixing [bug 1202392](show_bug.cgi?id=1202392). Because of this, dnsmasq will not save lease information in persistent storage, and when it is restarted, lease information is lost.  Solution: ========= Simply replace --leasefile-ro by --dhcp-leasefile=<path to dhcp runtime files>/lease would solve the problem. (patch attached)   ```  [Comment 8](show_bug.cgi?id=1227635#c8)  Toni Freger    2015-08-17 10:36:03 UTC  ``` Tested on Rhel7.1 puddle from 2015-08-13.1   dhcp-common-4.2.5-36.el7.x86_64 dhcp-libs-4.2.5-36.el7.x86_64  openstack-neutron-2014.2.3-9.el7ost.noarch openstack-neutron-common-2014.2.3-9.el7ost.noarch python-neutronclient-2.3.9-1.el7ost.noarch python-neutron-2014.2.3-9.el7ost.noarch openstack-neutron-openvswitch-2014.2.3-9.el7ost.noarch  The DHCP messages from /var/log/messages file of the agents.  Agent#1:  Aug 17 06:23:48 networker2 dnsmasq-dhcp[21035]: DHCPDISCOVER(tap29cff8bc-cc) fa:16:3e:a8:b9:1a Aug 17 06:23:48 networker2 dnsmasq-dhcp[21035]: DHCPOFFER(tap29cff8bc-cc) 80.80.80.5 fa:16:3e:a8:b9:1a Aug 17 06:23:48 networker2 dnsmasq-dhcp[21035]: DHCPREQUEST(tap29cff8bc-cc) 80.80.80.5 fa:16:3e:a8:b9:1a Aug 17 06:23:48 networker2 dnsmasq-dhcp[21035]: DHCPACK(tap29cff8bc-cc) 80.80.80.5 fa:16:3e:a8:b9:1a host-80-80-80-5  Agent#2  Aug 17 06:23:49 networker1 dnsmasq-dhcp[28502]: DHCPDISCOVER(tap6b8cb71c-b4) fa:16:3e:a8:b9:1a Aug 17 06:23:49 networker1 dnsmasq-dhcp[28502]: DHCPOFFER(tap6b8cb71c-b4) 80.80.80.5 fa:16:3e:a8:b9:1a   ```  [Comment 10](show_bug.cgi?id=1227635#c10)  errata-xmlrpc    2015-08-24 20:15:40 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory, and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  <https://rhn.redhat.com/errata/RHSA-2015-1680.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1227635&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from launchpad.net_c3955f20_20250126_074921.html ===

[Log in / Register](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* [Answers](https://answers.launchpad.net/neutron)

# [OSSA 2015-012] Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent (CVE-2015-3221)

Bug #1461054 reported by
[Darragh O'Reilly](https://launchpad.net/~darragh-oreilly)
on 2015-06-02

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Critical | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |
|  | [neutron](https://bugs.launchpad.net/neutron) | Fix Released | Critical | [Aaron Rosen](https://launchpad.net/~arosen) | [neutron 7.0.0 "liberty"](https://launchpad.net/neutron/%2Bmilestone/7.0.0) |
|  | [Juno](https://bugs.launchpad.net/neutron/juno) | Fix Released | Critical | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | [neutron 2014.2.4](https://launchpad.net/neutron/%2Bmilestone/2014.2.4) |
|  | [Kilo](https://bugs.launchpad.net/neutron/kilo) | Fix Committed | Critical | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |

### Bug Description

vagrant@node1:~$ neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/0

Updated port: 28dc7eb1-6f95-429f-8e30-adaefffcec70

This does not work - the ipset man page says that zero prefix size is not allowed for type hash:net.

But it also breaks the l2 agent and so affects other ports/vms/tenants ... - so opening as security vulnerability.

2015-06-02 11:02:31.897 ERROR neutron.agent.linux.utils [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None]

Command: ['ipset', 'add', '-exist', u'NETIPv48a445928-2f41-43de-a', u'0.0.0.0/0']

Exit code: 1

Stdin:

Stdout:

Stderr: ipset v6.20.1: The value of the CIDR parameter of the IP address is invalid

2015-06-02 11:02:31.898 DEBUG oslo\_concurrency.lockutils [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None] Releasing file lock "/opt/stack/data/neutron/lock/neutron-ipset" after holding it for 0.006s release /usr/local/lib/python2.7/dist-packages/oslo\_concurrency/lockutils.py:227

2015-06-02 11:02:31.898 DEBUG oslo\_concurrency.lockutils [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None] Lock "ipset" released by "set\_members" :: held 0.006s inner /usr/local/lib/python2.7/dist-packages/oslo\_concurrency/lockutils.py:456

2015-06-02 11:02:31.898 ERROR neutron.plugins.openvswitch.agent.ovs\_neutron\_agent [req-6dfc4e3b-7162-4528-b821-295de80aa7ed None None] Error while processing VIF ports

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent Traceback (most recent call last):

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs\_neutron\_agent.py", line 1640, in rpc\_loop

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent ovs\_restarted)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs\_neutron\_agent.py", line 1434, in process\_network\_ports

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent port\_info.get('updated', set()))

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/securitygroups\_rpc.py", line 302, in setup\_port\_filters

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.prepare\_devices\_filter(new\_devices)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/securitygroups\_rpc.py", line 159, in decorated\_function

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent \*args, \*\*kwargs)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/securitygroups\_rpc.py", line 185, in prepare\_devices\_filter

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent security\_groups, security\_group\_member\_ips)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/usr/lib/python2.7/contextlib.py", line 24, in \_\_exit\_\_

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.gen.next()

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/firewall.py", line 106, in defer\_apply

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.filter\_defer\_apply\_off()

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 671, in filter\_defer\_apply\_off

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.unfiltered\_ports)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 155, in \_setup\_chains\_apply

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_setup\_chain(port, INGRESS\_DIRECTION)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 182, in \_setup\_chain

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_add\_rules\_by\_security\_group(port, DIRECTION)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 423, in \_add\_rules\_by\_security\_group

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_update\_ipset\_members(remote\_sg\_ids)

2015-06-02 11:02:31.898 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/iptables\_firewall.py", line 460, in \_update\_ipset\_m^C

vagrant@node1:~$

vagrant@node1:~$ tail /opt/stack/logs/q-agt.log

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent return f(\*args, \*\*kwargs)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 72, in set\_members

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_add\_members\_to\_set(set\_name, add\_ips)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 132, in \_add\_members\_to\_set

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_add\_member\_to\_set(set\_name, ip)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 84, in \_add\_member\_to\_set

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.\_apply(cmd)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/ipset\_manager.py", line 117, in \_apply

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent self.execute(cmd\_ns, run\_as\_root=True, process\_input=input)

2015-06-02 11:19:50.208 3679 TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent File "/opt/stack/neutron/neutron/agent/linux/utils.py"

Workaround:

neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/1 ip\_address=128.0.0.0/1

See [original description](comments/0)

Tags:

[6.1-mu-1](/neutron/%2Bbugs?field.tag=6.1-mu-1)
[in-feature-pecan](/neutron/%2Bbugs?field.tag=in-feature-pecan)
[in-feature-qos](/neutron/%2Bbugs?field.tag=in-feature-qos)
[in-stable-kilo](/neutron/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2015-3221](/bugs/cve/2015-3221 "OpenStack Neutron before 2014.2.4 (ju...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-06-02: |  |  | [#1](/neutron/%2Bbug/1461054/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| **description**: | updated |
| --- | --- |
| Changed in ossa: | |
| **status**: | New → Incomplete |

[Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly)
on 2015-06-02

| **description**: | updated |
| --- | --- |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2015-06-02

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Salvatore Orlando (salvatore-orlando)](https://launchpad.net/~salvatore-orlando) wrote on 2015-06-02: |  |  | [#2](/neutron/%2Bbug/1461054/comments/2) |
| --- | --- | --- | --- |

I can confirm this gives users the power to break chunks of an openstack cloud. Basically, if the network where the port where the bogus address is called "x", every host with a port on network "x" will pretty much stop working, as they will be unable to boot VMs, apply security group updates, etc.

I can confirm this gives users the power to break chunks of an openstack cloud. Basically, if the network where the port where the bogus address is called "x", every host with a port on network "x" will pretty much stop working, as they will be unable to boot VMs, apply security group updates, etc.

| Changed in neutron: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-02: |  |  | [#3](/neutron/%2Bbug/1461054/comments/3) |
| --- | --- | --- | --- |

I'm going to see if I can work a quick patch to do some validation checking here, so assigning to myself at the moment.

I'm going to see if I can work a quick patch to do some validation checking here, so assigning to myself at the moment.

| Changed in neutron: | |
| --- | --- |
| **assignee**: | nobody → Kyle Mestery (mestery) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Armando Migliaccio (armando-migliaccio)](https://launchpad.net/~armando-migliaccio) wrote on 2015-06-02: |  |  | [#4](/neutron/%2Bbug/1461054/comments/4) |
| --- | --- | --- | --- |

What was the original intention by the author of this bug? Is adding 0.0.0.0/0 as allowed address fullfilling a genuine use case? Or was a 'malicious' input?

If the former case, validation aimed at preventing the input might not be desirable, and we need to delve into this further to come up with a suitable solution.

What was the original intention by the author of this bug? Is adding 0.0.0.0/0 as allowed address fullfilling a genuine use case? Or was a 'malicious' input?
If the former case, validation aimed at preventing the input might not be desirable, and we need to delve into this further to come up with a suitable solution.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-02: |  |  | [#5](/neutron/%2Bbug/1461054/comments/5) |
| --- | --- | --- | --- |

Armando, look at the description, it looks like it's invalid input per the ipset manpage:

This does not work - the ipset man page says that zero prefix size is not allowed for type hash:net.

Also here: <http://ipset.netfilter.org/ipset.man.html> (search for "Hash:Net").

Armando, look at the description, it looks like it's invalid input per the ipset manpage:
This does not work - the ipset man page says that zero prefix size is not allowed for type hash:net.
Also here: http://ipset.netfilter.org/ipset.man.html (search for "Hash:Net").

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-02: |  |  | [#6](/neutron/%2Bbug/1461054/comments/6) |
| --- | --- | --- | --- |

The use case is running a router in a VM. But the anti-spoofing will stop the router forwarding packets with source IP addresses not on the router ports or allowed address pairs. I'm using an openstack version that does not have the portsecurity extension.

A router is expected to forward IP packets from anywhere, so I tried to add all IPv4 address with a subnet with prefix length zero. The API allows subnets, so why not?

If you accept that 0.0.0.0/0 is valid for the API, then one solution would be to apply it behind the scenes as a special case using 2 ipset rules with prefix length one - 0.0.0.0/1 and 128.0.0.0/1. Otherwise we can just reject it at the API level, and users will still be able to allow all with

neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/1 ip\_address=128.0.0.0/1

The use case is running a router in a VM. But the anti-spoofing will stop the router forwarding packets with source IP addresses not on the router ports or allowed address pairs. I'm using an openstack version that does not have the portsecurity extension.
A router is expected to forward IP packets from anywhere, so I tried to add all IPv4 address with a subnet with prefix length zero. The API allows subnets, so why not?
If you accept that 0.0.0.0/0 is valid for the API, then one solution would be to apply it behind the scenes as a special case using 2 ipset rules with prefix length one - 0.0.0.0/1 and 128.0.0.0/1. Otherwise we can just reject it at the API level, and users will still be able to allow all with
neutron port-update $PORT\_ID --allowed\_address\_pairs list=true type=dict ip\_address=0.0.0.0/1 ip\_address=128.0.0.0/1

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Armando Migliaccio (armando-migliaccio)](https://launchpad.net/~armando-migliaccio) wrote on 2015-06-02: |  |  | [#7](/neutron/%2Bbug/1461054/comments/7) |
| --- | --- | --- | --- |

Cool, that's what I wanted to hear. Thanks Darragh!

Cool, that's what I wanted to hear. Thanks Darragh!

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-02

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#8](/neutron/%2Bbug/1461054/comments/8) |
| --- | --- | --- | --- |

I like that solution Darragh. I think we should allow 0.0.0.0/0 . I'm happy to implement this in the morning if you wanna pass it to me Kyle.

I like that solution Darragh. I think we should allow 0.0.0.0/0 . I'm happy to implement this in the morning if you wanna pass it to me Kyle.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-03: |  |  | [#9](/neutron/%2Bbug/1461054/comments/9) |
| --- | --- | --- | --- |

Thanks for volunteering Aaron! I was hoping to get some time to do this, but I failed miserably yesterday afternoon. I've assigned it to you now, I'll circle back tomorrow with you as well.

Thanks for volunteering Aaron! I was hoping to get some time to do this, but I failed miserably yesterday afternoon. I've assigned it to you now, I'll circle back tomorrow with you as well.

| Changed in neutron: | |
| --- | --- |
| **assignee**: | Kyle Mestery (mestery) → Aaron Rosen (arosen) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-03: |  |  | [#10](/neutron/%2Bbug/1461054/comments/10) |
| --- | --- | --- | --- |

It seems to affect Juno and Icehouse too

It seems to affect Juno and Icehouse too

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#11](/neutron/%2Bbug/1461054/comments/11) |
| --- | --- | --- | --- |

@Darragh O'Reilly, do you know off hand what the address work around would need to be for ipv6? It looks like ::/0 triggers the same issue.

@Darragh O'Reilly, do you know off hand what the address work around would need to be for ipv6? It looks like ::/0 triggers the same issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#12](/neutron/%2Bbug/1461054/comments/12) |
| --- | --- | --- | --- |

::/1' and '8000::/1' ?

::/1' and '8000::/1' ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#13](/neutron/%2Bbug/1461054/comments/13) |
| --- | --- | --- | --- |

* [fix\_ipset\_validation\_bug.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4409471/%2Bfiles/fix_ipset_validation_bug.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4409471)
  (4.9 KiB,
  text/plain)

Let me know what you guys think of this. I tested it and seems to do the trick.

Let me know what you guys think of this. I tested it and seems to do the trick.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-03: |  |  | [#14](/neutron/%2Bbug/1461054/comments/14) |
| --- | --- | --- | --- |

I'll provide a backport Juno/icehouse after this gets a review.

I'll provide a backport Juno/icehouse after this gets a review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-04: |  |  | [#15](/neutron/%2Bbug/1461054/comments/15) |
| --- | --- | --- | --- |

Thanks for the quick turnaround Aaron! The workaround looks ok to me.

Thanks for the quick turnaround Aaron! The workaround looks ok to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-04: |  |  | [#16](/neutron/%2Bbug/1461054/comments/16) |
| --- | --- | --- | --- |

thanks Aaron. I'll give it a test run now.

thanks Aaron. I'll give it a test run now.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-04: |  |  | [#17](/neutron/%2Bbug/1461054/comments/17) |
| --- | --- | --- | --- |

\* All neutron setups are affected right ?

\* Darragh, your community profile says you're still working at HP, is this correct ?

Assuming yes at those two question, here is the impact description draft #1:

Title: Neutron L2 agent DoS through incorrect allowed address pairs

Reporter: Darragh O'Reilly (HP)

Products: Neutron

Affects: 2014.1 versions through 2014.1.4, and 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. All Neutron setups are affected.

\* All neutron setups are affected right ?
\* Darragh, your community profile says you're still working at HP, is this correct ?
Assuming yes at those two question, here is the impact description draft #1:
Title: Neutron L2 agent DoS through incorrect allowed address pairs
Reporter: Darragh O'Reilly (HP)
Products: Neutron
Affects: 2014.1 versions through 2014.1.4, and 2014.2 versions through 2014.2.3 and 2015.1.0 version
Description:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. All Neutron setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-04: |  |  | [#18](/neutron/%2Bbug/1461054/comments/18) |
| --- | --- | --- | --- |

Icehouse should not be affected by this, we introduced the ipset code in Juno. Thus, only 2014.2-2014.2.3 and 2015.1.0 are affected.

Icehouse should not be affected by this, we introduced the ipset code in Juno. Thus, only 2014.2-2014.2.3 and 2015.1.0 are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-04: |  |  | [#19](/neutron/%2Bbug/1461054/comments/19) |
| --- | --- | --- | --- |

Ok great, moreover Icehouse might be EOLed by the time we disclose this... So the Affect line should read:

Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Ok great, moreover Icehouse might be EOLed by the time we disclose this... So the Affect line should read:
Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-04: |  |  | [#20](/neutron/%2Bbug/1461054/comments/20) |
| --- | --- | --- | --- |

Tristan - yes I'm with HP.

I'm not usre if all Neutron setups are affected. Setups that use the IPTables firewall driver are. These include openvswitch, linuxbridge and ofagent agents - but there are probably others.

The patch works for me.

Tristan - yes I'm with HP.
I'm not usre if all Neutron setups are affected. Setups that use the IPTables firewall driver are. These include openvswitch, linuxbridge and ofagent agents - but there are probably others.
The patch works for me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-04: |  |  | [#21](/neutron/%2Bbug/1461054/comments/21) |
| --- | --- | --- | --- |

there is still a problem if you have prevent\_arp\_spoofing=True

2015-06-04 15:48:39.256 ERROR neutron.agent.common.ovs\_lib [req-ed50624a-0797-42d0-9494-35608d0e1ca9 None None] Unable to execute ['ovs-ofctl', 'add-flows', 'br-int', '-']. Exception:

Command: ['ovs-ofctl', 'add-flows', 'br-int', '-']

Exit code: 1

Stdin: hard\_timeout=0,idle\_timeout=0,priority=2,arp,arp\_spa=0.0.0.0/0,table=24,in\_port=9,actions=normal

Stdout:

Stderr: ovs-ofctl: -:1: 0.0.0.0/0: network prefix bits not between 1 and 32

there is still a problem if you have prevent\_arp\_spoofing=True
2015-06-04 15:48:39.256 ERROR neutron.agent.common.ovs\_lib [req-ed50624a-0797-42d0-9494-35608d0e1ca9 None None] Unable to execute ['ovs-ofctl', 'add-flows', 'br-int', '-']. Exception:
Command: ['ovs-ofctl', 'add-flows', 'br-int', '-']
Exit code: 1
Stdin: hard\_timeout=0,idle\_timeout=0,priority=2,arp,arp\_spa=0.0.0.0/0,table=24,in\_port=9,actions=normal
Stdout:
Stderr: ovs-ofctl: -:1: 0.0.0.0/0: network prefix bits not between 1 and 32

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Armando Migliaccio (armando-migliaccio)](https://launchpad.net/~armando-migliaccio) wrote on 2015-06-04: |  |  | [#22](/neutron/%2Bbug/1461054/comments/22) |
| --- | --- | --- | --- |

Might be a silly question, but is it sensible to have a device with 0.0.0.0/0 and at the same time have arp spoofing on?

Might be a silly question, but is it sensible to have a device with 0.0.0.0/0 and at the same time have arp spoofing on?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-04: |  |  | [#23](/neutron/%2Bbug/1461054/comments/23) |
| --- | --- | --- | --- |

Yup, I noticed that same issue. I actually pinged Kevin (he wrote the arp flow above) on it and he said it's not a problem. He has a patch to fix the error from installing the flow with 0.0.0.0.0/0 though was going to wait to push it to prevent from exposing this bug to other people who may notice it. Currently the code ignores errors raised there so it's just showing an error in the log but it doesn't matter

Yup, I noticed that same issue. I actually pinged Kevin (he wrote the arp flow above) on it and he said it's not a problem. He has a patch to fix the error from installing the flow with 0.0.0.0.0/0 though was going to wait to push it to prevent from exposing this bug to other people who may notice it. Currently the code ignores errors raised there so it's just showing an error in the log but it doesn't matter

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-04: |  |  | [#24](/neutron/%2Bbug/1461054/comments/24) |
| --- | --- | --- | --- |

Can someone subscribe Kevin to this bug and ask him to attach his patch here ?

Can someone subscribe Kevin to this bug and ask him to attach his patch here ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-04: |  |  | [#25](/neutron/%2Bbug/1461054/comments/25) |
| --- | --- | --- | --- |

Subscribed Kevin. Kevin, can you attach the patch Aaron is referencing in comment #23?

Subscribed Kevin. Kevin, can you attach the patch Aaron is referencing in comment #23?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-06-04: |  |  | [#26](/neutron/%2Bbug/1461054/comments/26) |
| --- | --- | --- | --- |

Yeah, the patch I have isn't necessary for the security fix. It just fails to setup arp spoofing protection for the tenant but that's exactly what 0.0.0.0/0 in an allowed address pair does. It just prevents log noise.

Yeah, the patch I have isn't necessary for the security fix. It just fails to setup arp spoofing protection for the tenant but that's exactly what 0.0.0.0/0 in an allowed address pair does. It just prevents log noise.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-06-04: |  |  | [#27](/neutron/%2Bbug/1461054/comments/27) |
| --- | --- | --- | --- |

* [arp00000patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410106/%2Bfiles/arp00000patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410106)
  (2.2 KiB,
  text/plain)

Here is the patch, but I was planning on just uploading it after the fix for this vulnerability goes in.

Here is the patch, but I was planning on just uploading it after the fix for this vulnerability goes in.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-05: |  |  | [#28](/neutron/%2Bbug/1461054/comments/28) |
| --- | --- | --- | --- |

okay, I guess it's best to keep the patch for vulnerability small, and the arp patch can be done separately.

okay, I guess it's best to keep the patch for vulnerability small, and the arp patch can be done separately.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-05: |  |  | [#29](/neutron/%2Bbug/1461054/comments/29) |
| --- | --- | --- | --- |

Thanks Kevin, so considering the arp00000.patch fix something that is already broken, this can surely be proposed separately after the vulnerability patch is merged.

Arosen, do you think the backport is going to be difficult ?

Here is an updated impact description:

Title: Neutron L2 agent DoS through incorrect allowed address pairs

Reporter: Darragh O'Reilly (HP)

Products: Neutron

Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

Thanks Kevin, so considering the arp00000.patch fix something that is already broken, this can surely be proposed separately after the vulnerability patch is merged.
Arosen, do you think the backport is going to be difficult ?
Here is an updated impact description:
Title: Neutron L2 agent DoS through incorrect allowed address pairs
Reporter: Darragh O'Reilly (HP)
Products: Neutron
Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version
Description:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an invalid allowed address pairs, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-06: |  |  | [#30](/neutron/%2Bbug/1461054/comments/30) |
| --- | --- | --- | --- |

@Tristan, Here's the backport for kilo. There was a small conflict but it's good.

@Tristan, Here's the backport for kilo. There was a small conflict but it's good.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-06: |  |  | [#31](/neutron/%2Bbug/1461054/comments/31) |
| --- | --- | --- | --- |

* [fix\_ipset\_validation\_bug\_kilo.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410605/%2Bfiles/fix_ipset_validation_bug_kilo.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410605)
  (5.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-06-08: |  |  | [#32](/neutron/%2Bbug/1461054/comments/32) |
| --- | --- | --- | --- |

Should be "By adding an invalid allowed address pair" (not "pairs"). Also the term "invalid" seems vague here without identifying what's qualifying that validity. Clearly the Neutron API thinks a 0-length mask is valid (until this bug is fixed), but ipset does not. How about something like "By adding an address pair which is rejected as invalid by the ipset tool, ..."?

Should be "By adding an invalid allowed address pair" (not "pairs"). Also the term "invalid" seems vague here without identifying what's qualifying that validity. Clearly the Neutron API thinks a 0-length mask is valid (until this bug is fixed), but ipset does not. How about something like "By adding an address pair which is rejected as invalid by the ipset tool, ..."?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-08: |  |  | [#33](/neutron/%2Bbug/1461054/comments/33) |
| --- | --- | --- | --- |

Jeremy good point. How about:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding a valid allowed address pairs of 0.0.0.0/0, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. This is cause by the ipset tool rejecting the input of 0.0.0.0/0.

Jeremy good point. How about:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding a valid allowed address pairs of 0.0.0.0/0, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. This is cause by the ipset tool rejecting the input of 0.0.0.0/0.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-08: |  |  | [#34](/neutron/%2Bbug/1461054/comments/34) |
| --- | --- | --- | --- |

Thanks for the review, we'll use Jeremy proposal in order to keep the technical details low in the description.

Can someone add series tasks for Neutron Kilo and Juno please ?

Title: Neutron L2 agent DoS through incorrect allowed address pairs

Reporter: Darragh O'Reilly (HP)

Products: Neutron

Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version

Description:

Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an address pair which is rejected as invalid by the ipset tool, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

Thanks for the review, we'll use Jeremy proposal in order to keep the technical details low in the description.
Can someone add series tasks for Neutron Kilo and Juno please ?
Title: Neutron L2 agent DoS through incorrect allowed address pairs
Reporter: Darragh O'Reilly (HP)
Products: Neutron
Affects: 2014.2 versions through 2014.2.3 and 2015.1.0 version
Description:
Darragh O'Reilly from HP reported a vulnerability in Neutron. By adding an address pair which is rejected as invalid by the ipset tool, an authenticated user may crash the Neutron L2 agent resulting in a denial of service attack. Neutron setups using the IPTables firewall driver are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-06-08: |  |  | [#35](/neutron/%2Bbug/1461054/comments/35) |
| --- | --- | --- | --- |

The updated impact description in comment #34 looks good to me. Thanks!

The updated impact description in comment #34 looks good to me. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-08: |  |  | [#36](/neutron/%2Bbug/1461054/comments/36) |
| --- | --- | --- | --- |

Doh, I didn't did do it for juno. In juno the ipset manager was part of the iptables\_firewall diver :( . Looking now to see how hard this is going to be.

Doh, I didn't did do it for juno. In juno the ipset manager was part of the iptables\_firewall diver :( . Looking now to see how hard this is going to be.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-09: |  |  | [#37](/neutron/%2Bbug/1461054/comments/37) |
| --- | --- | --- | --- |

Added Juno and Kilo series.

Added Juno and Kilo series.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-09: |  |  | [#38](/neutron/%2Bbug/1461054/comments/38) |
| --- | --- | --- | --- |

I spend a few hours on the juno backport of this patch. Unfortunately in juno the ipset manager is combined in with the iptables manager and I'll need to put the check in several places (and refactor the tests back in). It will probably take me 4 more hours or so to fix this and test the code with juno. I don't have the time to do that today though.

Do you guys think it would be okay to change the default option in juno to disable ipsets and to log a warning message if someone has them enabled?

I spend a few hours on the juno backport of this patch. Unfortunately in juno the ipset manager is combined in with the iptables manager and I'll need to put the check in several places (and refactor the tests back in). It will probably take me 4 more hours or so to fix this and test the code with juno. I don't have the time to do that today though.
Do you guys think it would be okay to change the default option in juno to disable ipsets and to log a warning message if someone has them enabled?

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-09

| Changed in ossa: | |
| --- | --- |
| **status**: | Triaged → In Progress |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-09: |  |  | [#39](/neutron/%2Bbug/1461054/comments/39) |
| --- | --- | --- | --- |

* [juno-reject-prefix-zero.diff](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4412213/%2Bfiles/juno-reject-prefix-zero.diff)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4412213)
  (1.1 KiB,
  text/plain)

Aaron - how about rejecting /0 in Juno?

Aaron - how about rejecting /0 in Juno?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-09: |  |  | [#40](/neutron/%2Bbug/1461054/comments/40) |
| --- | --- | --- | --- |

That works for me. Though we'll also have to tell people that they need to delete any 0.0.0.0/0 rules they already have installed.

That works for me. Though we'll also have to tell people that they need to delete any 0.0.0.0/0 rules they already have installed.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-10

| **summary**: | Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent+ (CVE-2015-3221) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-10:  [**Re: Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent (CVE-2015-3221)**](/neutron/%2Bbug/1461054/comments/41) |  |  | [#41](/neutron/%2Bbug/1461054/comments/41) |
| --- | --- | --- | --- |

Aaron, do you mean that Juno user could have such 0/0 addr pair without breaking their L2 agent ?

About the patch, would 0.0.0.0/00 bypass the check and still break ipset ?

Also, please include a commit message and use git format-patch for attached fix here.

Aaron, do you mean that Juno user could have such 0/0 addr pair without breaking their L2 agent ?
About the patch, would 0.0.0.0/00 bypass the check and still break ipset ?
Also, please include a commit message and use git format-patch for attached fix here.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-10: |  |  | [#42](/neutron/%2Bbug/1461054/comments/42) |
| --- | --- | --- | --- |

Will do,

I just want to make sure that is an acceptable fix for anyone running juno. The proposed solution is to prevent the address pair 0.0.0.0/0 from being installed in juno and reject it at the api layer. If we do this one still has to delete any 0.0.0.0/0 rules that have been installed. Alternatively, we could also say do not use the ipset driver in juno and use the iptables one. What do you guys think?

Will do,
I just want to make sure that is an acceptable fix for anyone running juno. The proposed solution is to prevent the address pair 0.0.0.0/0 from being installed in juno and reject it at the api layer. If we do this one still has to delete any 0.0.0.0/0 rules that have been installed. Alternatively, we could also say do not use the ipset driver in juno and use the iptables one. What do you guys think?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kevin Benton (kevinbenton)](https://launchpad.net/~kevinbenton) wrote on 2015-06-11: |  |  | [#43](/neutron/%2Bbug/1461054/comments/43) |
| --- | --- | --- | --- |

I think saying not to use ipset is risky if someone misses the notice. I'm for the simple block at the API layer. Maybe we can publish a small SQL query with the release to run to clear out any 0.0.0.0/0 entries?

I think saying not to use ipset is risky if someone misses the notice. I'm for the simple block at the API layer. Maybe we can publish a small SQL query with the release to run to clear out any 0.0.0.0/0 entries?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#44](/neutron/%2Bbug/1461054/comments/44) |
| --- | --- | --- | --- |

K,

Okay I'll push a patch based on Darragh's tomorrow to do this for just juno. I think it's better to delete the address pairs that are /0 via the neutron api directly rather than targeting the db directly.

K,
Okay I'll push a patch based on Darragh's tomorrow to do this for just juno. I think it's better to delete the address pairs that are /0 via the neutron api directly rather than targeting the db directly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-11: |  |  | [#45](/neutron/%2Bbug/1461054/comments/45) |
| --- | --- | --- | --- |

Tristan, yes, a user can have a port with an allowed address pair with ip\_address ending in /0 without breaking the L2 agent, if none of the port's security groups have their remote\_group\_id set. If a user has a port like this, and a patch to block new /0 address pairs is applied, the user could still break the agent by changing the port's security groups.

I'm not sure about deleting them - this could affect users. Maybe we could supply a python script for operators that would search for ports with /0 and update them with 2x /1 ?

Tristan, yes, a user can have a port with an allowed address pair with ip\_address ending in /0 without breaking the L2 agent, if none of the port's security groups have their remote\_group\_id set. If a user has a port like this, and a patch to block new /0 address pairs is applied, the user could still break the agent by changing the port's security groups.
I'm not sure about deleting them - this could affect users. Maybe we could supply a python script for operators that would search for ports with /0 and update them with 2x /1 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-11: |  |  | [#46](/neutron/%2Bbug/1461054/comments/46) |
| --- | --- | --- | --- |

I like the idea of having a clean-up script, could it be part of the patch, and put it in neutron/tools ?

For Juno, the risk is to break a previously valid workflow. I can't tell if using /0 address pair on a port without its security\_group's remote\_group\_id set is a realistic use-case. Maybe a good documentation note for Juno user is acceptable, thought ?

I like the idea of having a clean-up script, could it be part of the patch, and put it in neutron/tools ?
For Juno, the risk is to break a previously valid workflow. I can't tell if using /0 address pair on a port without its security\_group's remote\_group\_id set is a realistic use-case. Maybe a good documentation note for Juno user is acceptable, thought ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-11: |  |  | [#47](/neutron/%2Bbug/1461054/comments/47) |
| --- | --- | --- | --- |

Can someone confirm Juno is really affected ?

Trying to investigate if a fix in \_validate\_allowed\_address\_pairs would work, I realize the bug does not reproduce in my devstack setup.

In q-agt log, there is the TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent Stderr: 'ipset v6.20.1: The value of the CIDR parameter of the IP address is invalid\n'

but instance connectivity is not impacted.

Can someone confirm Juno is really affected ?
Trying to investigate if a fix in \_validate\_allowed\_address\_pairs would work, I realize the bug does not reproduce in my devstack setup.
In q-agt log, there is the TRACE neutron.plugins.openvswitch.agent.ovs\_neutron\_agent Stderr: 'ipset v6.20.1: The value of the CIDR parameter of the IP address is invalid\n'
but instance connectivity is not impacted.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#48](/neutron/%2Bbug/1461054/comments/48) |
| --- | --- | --- | --- |

Right but I think new instances you spin up won't get networking on that host ?

Right but I think new instances you spin up won't get networking on that host ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#49](/neutron/%2Bbug/1461054/comments/49) |
| --- | --- | --- | --- |

I'm setting up juno now to test and nail this down aas well.

I'm setting up juno now to test and nail this down aas well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#50](/neutron/%2Bbug/1461054/comments/50) |
| --- | --- | --- | --- |

Darragh O'Reilly (darragh-oreilly) so you're saying that your patch for juno isn't enough to prevent this?

Darragh O'Reilly (darragh-oreilly) so you're saying that your patch for juno isn't enough to prevent this?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#51](/neutron/%2Bbug/1461054/comments/51) |
| --- | --- | --- | --- |

* [zero\_length\_addressses\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413508/%2Bfiles/zero_length_addressses_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413508)
  (6.0 KiB,
  text/plain)

Okay, here's the patch for juno. What do you guys think? I provided a tool to update addresses that are 0.0.0.0/0 to the two address pairs.

Okay, here's the patch for juno. What do you guys think? I provided a tool to update addresses that are 0.0.0.0/0 to the two address pairs.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kyle Mestery (mestery)](https://launchpad.net/~mestery) wrote on 2015-06-11: |  |  | [#52](/neutron/%2Bbug/1461054/comments/52) |
| --- | --- | --- | --- |

Thanks Aaron, other than a typo in the name of the script, I'd say it looks good!

Thanks Aaron, other than a typo in the name of the script, I'd say it looks good!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-11: |  |  | [#53](/neutron/%2Bbug/1461054/comments/53) |
| --- | --- | --- | --- |

* [fix\_for\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413521/%2Bfiles/fix_for_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413521)
  (6.0 KiB,
  text/plain)

Doh,

fixed.

Doh,
fixed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-12: |  |  | [#54](/neutron/%2Bbug/1461054/comments/54) |
| --- | --- | --- | --- |

The proposed patch for Juno doesn't catch 0.0.0.0/00...

Also, we are concerned about this behavior change for Juno, can the same patch logic be used within the validate function (e.g. deflate /0 address into two /1), wouldn't that work and be transparent for Juno users ?

The proposed patch for Juno doesn't catch 0.0.0.0/00...
Also, we are concerned about this behavior change for Juno, can the same patch logic be used within the validate function (e.g. deflate /0 address into two /1), wouldn't that work and be transparent for Juno users ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-15: |  |  | [#55](/neutron/%2Bbug/1461054/comments/55) |
| --- | --- | --- | --- |

Aaron - were you able to confirm that is a security issue with Juno? Tristan was not able to rcreate it. I don't have much time, but I can try Juno later.

Aaron - were you able to confirm that is a security issue with Juno? Tristan was not able to rcreate it. I don't have much time, but I can try Juno later.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#56](/neutron/%2Bbug/1461054/comments/56) |
| --- | --- | --- | --- |

@Tristan, the problem is that there are several places that need this deflate method in Juno. I think disabling /0 allowed address pairs is an okay hack to solve this security issue for juno. We can always a better fix later (though gerrit which will be easier to test). It does break an API workflow people could have previously been using, that said the dataplane slide of it would not have worked in juno because of this bug.

@Darragh - yes this issue exists in juno with the ip set driver.

@Tristan, the problem is that there are several places that need this deflate method in Juno. I think disabling /0 allowed address pairs is an okay hack to solve this security issue for juno. We can always a better fix later (though gerrit which will be easier to test). It does break an API workflow people could have previously been using, that said the dataplane slide of it would not have worked in juno because of this bug.
@Darragh - yes this issue exists in juno with the ip set driver.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#57](/neutron/%2Bbug/1461054/comments/57) |
| --- | --- | --- | --- |

* [fix\_for\_juno\_2.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4415238/%2Bfiles/fix_for_juno_2.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4415238)
  (6.3 KiB,
  text/plain)

Updated patchset to account for /00, I also added in the note about renabling /0 for juno once this lands upstream.

Updated patchset to account for /00, I also added in the note about renabling /0 for juno once this lands upstream.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-15: |  |  | [#58](/neutron/%2Bbug/1461054/comments/58) |
| --- | --- | --- | --- |

@neutron-coresec, please review proposed fix (comments #13 for Liberty, #31 Kilo and #57 for Juno).

For Juno, since this bug prevented to use the zero\_prefixed address pairs workflow correctly, I would say we can go with the proposed patch,

The note for affected Juno users would be: "Zero prefixed address pair are not accepted by the Juno API, users need to use 0.0.0.0/1 and 128.0.0.1/1 or ::/1' and '8000::/1. The fix\_zero\_length\_ip\_prefix.py tool can be used to clean ports that were mis-configured with a zero prefixed address"

@neutron-coresec, please review proposed fix (comments #13 for Liberty, #31 Kilo and #57 for Juno).
For Juno, since this bug prevented to use the zero\_prefixed address pairs workflow correctly, I would say we can go with the proposed patch,
The note for affected Juno users would be: "Zero prefixed address pair are not accepted by the Juno API, users need to use 0.0.0.0/1 and 128.0.0.1/1 or ::/1' and '8000::/1. The fix\_zero\_length\_ip\_prefix.py tool can be used to clean ports that were mis-configured with a zero prefixed address"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Darragh O'Reilly (darragh-oreilly)](https://launchpad.net/~darragh-oreilly) wrote on 2015-06-15: |  |  | [#59](/neutron/%2Bbug/1461054/comments/59) |
| --- | --- | --- | --- |

Aaron - I can't seem to recreate the security issue with Juno. The l2-agent gives an error, but seems to work okay otherwise. I tried your juno patch and script and they worked for me.

Aaron - I can't seem to recreate the security issue with Juno. The l2-agent gives an error, but seems to work okay otherwise. I tried your juno patch and script and they worked for me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-15: |  |  | [#60](/neutron/%2Bbug/1461054/comments/60) |
| --- | --- | --- | --- |

FWIW, I couldn't reproduced it on Juno devstack with:

disable\_service n-net

enable\_service q-svc

enable\_service q-agt

enable\_service q-dhcp

enable\_service q-l3

enable\_service q-meta

enable\_service q-fwaas

Q\_SERVICE\_PLUGIN\_CLASSES=neutron.services.firewall.fwaas\_plugin.FirewallPlugin

Q\_USE\_SECGROUP=True

The ipset command do fails but it does not prevent new instances to boot nor impact previous instance connectivity.

FWIW, I couldn't reproduced it on Juno devstack with:
disable\_service n-net
enable\_service q-svc
enable\_service q-agt
enable\_service q-dhcp
enable\_service q-l3
enable\_service q-meta
enable\_service q-fwaas
Q\_SERVICE\_PLUGIN\_CLASSES=neutron.services.firewall.fwaas\_plugin.FirewallPlugin
Q\_USE\_SECGROUP=True
The ipset command do fails but it does not prevent new instances to boot nor impact previous instance connectivity.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#61](/neutron/%2Bbug/1461054/comments/61) |
| --- | --- | --- | --- |

@Tristan, what if you restart the l2-agent after you have the 0.0.0.0/0 rule installed?

@Tristan, what if you restart the l2-agent after you have the 0.0.0.0/0 rule installed?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#62](/neutron/%2Bbug/1461054/comments/62) |
| --- | --- | --- | --- |

It looks to me that, that is going to prevent the correct rules from getting initially pushed down again.

It looks to me that, that is going to prevent the correct rules from getting initially pushed down again.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#63](/neutron/%2Bbug/1461054/comments/63) |
| --- | --- | --- | --- |

trying to get my juno instance back up to verify as well.

trying to get my juno instance back up to verify as well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-15: |  |  | [#64](/neutron/%2Bbug/1461054/comments/64) |
| --- | --- | --- | --- |

When neutron-openvswitch-agent is restarted (q-agt devstack tab), it reprint the ipset trace, but it does not break like in Kilo. Though it may have other unnoticed effects...

When neutron-openvswitch-agent is restarted (q-agt devstack tab), it reprint the ipset trace, but it does not break like in Kilo. Though it may have other unnoticed effects...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-15: |  |  | [#65](/neutron/%2Bbug/1461054/comments/65) |
| --- | --- | --- | --- |

@Tristan, unfortunately the bulk add of the rules won't get added correctly so the security rules won't correctly be applied anymore :(. New rules though are correctly applied but the ones needed before reset aren't. We'll need the juno patch as well to prevent this from occurring.

@Tristan, unfortunately the bulk add of the rules won't get added correctly so the security rules won't correctly be applied anymore :(. New rules though are correctly applied but the ones needed before reset aren't. We'll need the juno patch as well to prevent this from occurring.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-17: |  |  | [#66](/neutron/%2Bbug/1461054/comments/66) |
| --- | --- | --- | --- |

@Aaron, fair enough.

Since patch have been approved, here is the proposed public disclosure date/time:

2015-06-23, 1500UTC

@Aaron, fair enough.
Since patch have been approved, here is the proposed public disclosure date/time:
2015-06-23, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Aaron Rosen (arosen)](https://launchpad.net/~arosen) wrote on 2015-06-17: |  |  | [#67](/neutron/%2Bbug/1461054/comments/67) |
| --- | --- | --- | --- |

Sounds good. Sorry for all the back and forth here!

Sounds good. Sorry for all the back and forth here!

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-18

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-23

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Fix proposed to neutron (stable/juno)**](/neutron/%2Bbug/1461054/comments/68) |  |  | [#68](/neutron/%2Bbug/1461054/comments/68) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/juno

Review: <https://review.openstack.org/194696>

Fix proposed to branch: stable/juno
Review: https://review.openstack.org/194696

| Changed in neutron: | |
| --- | --- |
| **assignee**: | Aaron Rosen (arosen) → Tristan Cacqueray (tristan-cacqueray) |
| **status**: | Confirmed → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Fix proposed to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/69) |  |  | [#69](/neutron/%2Bbug/1461054/comments/69) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/194697>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/194697

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-06-23

| **summary**: | - Adding 0.0.0.0/0 to allowed address pairs breaks l2 agent- (CVE-2015-3221)+ [OSSA 2015-012] Adding 0.0.0.0/0 to allowed address pairs breaks l2+ agent (CVE-2015-3221) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Related fix proposed to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/70) |  |  | [#70](/neutron/%2Bbug/1461054/comments/70) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/194742>

Related fix proposed to branch: stable/kilo
Review: https://review.openstack.org/194742

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-23:  [**Fix merged to neutron (stable/juno)**](/neutron/%2Bbug/1461054/comments/71) |  |  | [#71](/neutron/%2Bbug/1461054/comments/71) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/194696>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=d9c78880d2b7e5b0544e821c45e6ad3700a06b9a>

Submitter: Jenkins

Branch: stable/juno

commit d9c78880d2b7e5b0544e821c45e6ad3700a06b9a

Author: Aaron Rosen <email address hidden>

Date: Thu Jun 11 13:58:16 2015 -0700

Disable allowed\_address\_pair ip 0.0.0.0/0 ::/0 for ipset

Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if

    these addresses were inputted as allowed address pairs. This causes

    ipset to raise an error as it does not work with zero prefix sizes.

    To solve this problem we use two ipset rules to represent this.

This was correctly fixed in a backport to kilo though we did not have the

    cycles to backport this exact fix to juno as in juno additional work needs to

    be done because the iptable and ipset code are interleaved together. This

    patch fixes this issue by disabling one from creating an address pair of

    zero lenght. This patch also provides a small tool which one should run:

    tools/fix\_zero\_length\_ip\_prefix.py which changes all zero length address\_pair

    rules into two address pair rules of:

Ipv4: 0.0.0.0/1 and 128.0.0.1/1

    IPv6: ::/1' and '8000::/1

to avoid the problem.

    After this patch is merged into juno it will be easier for us to apply

    a better change to allow /0 addresses again in juno.

Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75

    Closes-bug: 1461054

    Co-Authored-by: Darragh O'Reilly <email address hidden>

Reviewed: https://review.openstack.org/194696
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=d9c78880d2b7e5b0544e821c45e6ad3700a06b9a
Submitter: Jenkins
Branch: stable/juno
commit d9c78880d2b7e5b0544e821c45e6ad3700a06b9a
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Thu Jun 11 13:58:16 2015 -0700
Disable allowed\_address\_pair ip 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this.
This was correctly fixed in a backport to kilo though we did not have the
cycles to backport this exact fix to juno as in juno additional work needs to
be done because the iptable and ipset code are interleaved together. This
patch fixes this issue by disabling one from creating an address pair of
zero lenght. This patch also provides a small tool which one should run:
tools/fix\_zero\_length\_ip\_prefix.py which changes all zero length address\_pair
rules into two address pair rules of:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
to avoid the problem.
After this patch is merged into juno it will be easier for us to apply
a better change to allow /0 addresses again in juno.
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054
Co-Authored-by: Darragh O'Reilly <darragh.oreilly@hp.com>

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-24

| Changed in neutron: | |
| --- | --- |
| **assignee**: | Tristan Cacqueray (tristan-cacqueray) → Aaron Rosen (arosen) |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-25

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-25:  [**Change abandoned on neutron (master)**](/neutron/%2Bbug/1461054/comments/72) |  |  | [#72](/neutron/%2Bbug/1461054/comments/72) |
| --- | --- | --- | --- |

Change abandoned by Cedric Brandily (<email address hidden>) on branch: master

Review: <https://review.openstack.org/195228>

Change abandoned by Cedric Brandily (zzelle@gmail.com) on branch: master
Review: https://review.openstack.org/195228

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-26:  [**Related fix proposed to neutron (feature/qos)**](/neutron/%2Bbug/1461054/comments/73) |  |  | [#73](/neutron/%2Bbug/1461054/comments/73) |
| --- | --- | --- | --- |

Related fix proposed to branch: feature/qos

Review: <https://review.openstack.org/196097>

Related fix proposed to branch: feature/qos
Review: https://review.openstack.org/196097

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-26:  [**Related fix merged to neutron (feature/qos)**](/neutron/%2Bbug/1461054/comments/74) |  |  | [#74](/neutron/%2Bbug/1461054/comments/74) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1461054/comments/74/%2Bdownload) (93.9 KiB)

Reviewed: <https://review.openstack.org/196097>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=1cfed745d54a6ce9cb3dd4e6f454666d9e6676c2>

Submitter: Jenkins

Branch: feature/qos

commit ba7d673d1ddd5bfa5aa1be5b26a59e9a8cd78a9f

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:31:38 2015 -0700

Remove duplicated call to setup\_coreplugin

The test case for vlan\_transparent was calling setup\_coreplugin

    before calling the super setUp method which already calls

    setup\_coreplugin. This was causing duplicate core plugin fixtures

    which resulted in patching the dhcp periodic check twice.

Change-Id: Ide4efad42748e799d8e9c815480c8ffa94b27b38

    Partial-Bug: #1468998

commit e64062efa3b793f7c4ce4ab9e62918af4f1bfcc9

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:29:37 2015 -0700

Remove double mock of dhcp agent periodic check

The test case for the periodic check was patching a target

    that the core plugin fixture already patched out. This removes

    that and exposes the mock from the fixture so the test case

    can reference it.

Change-Id: I3adee6a875c497e070db4198567b52aa16b81ce8

    Partial-Bug: #1468998

commit 25ae0429a713143d42f626dd59ed4514ba25820c

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:24:10 2015 -0700

Remove double fanout mock

The test\_mech\_driver was duplicating a fanout mock already setup

    in the setUp routine.

Change-Id: I5b88dff13113d55c72241d3d5025791a76672ac2

    Partial-Bug: #1468998

commit 993771556332d9b6bbf7eb3f0300cf9d8a2cb464

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 17:55:16 2015 -0700

Remove double callback manager mocks

setup\_test\_registry\_instance() in the base test case class gives

    each test its own registry by mocking out the get\_callback\_manager.

    The L3 agent test cases were duplicating this.

Partial-Bug: #1468998

    Change-Id: I7356daa846524611e9f92365939e8ad15d1e1cd8

commit 0be1efad93734f11cd63fb3b7bd2983442ce1268

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 16:57:30 2015 -0700

Remove ensure\_dirs double-patch

test\_spawn\_radvd called mock.patch on ensure\_dirs after the

    setup method already patched it out. This causes issues when

    mock.patch.stopall() is called because the mocks are stored

    as a set and are unwound in a non-deterministic fashion.[1]

    So some of the time they will be undone correctly, but others

    will leave a monkey-patched in mock, causing the ensure\_dir

    test to fail.

1. <http://bugs.python.org/issue21239>

Closes-Bug: #1467908

    Change-Id: I321b5fed71dc73bd19b5099311c6f43640726cd4

commit 0a2238e34e72c17ca8a75e36b1f56e41a3ece74e

Author: Sukhdev Kapur <email address hidden>

Date: Thu Jun 25 15:11:28 2015 -0700

Fix tenant-id in Arista ML2 driver to support HA router

When HA router is created, the framework creates a network and does

    not specify the tenant-id. This casuse Arista ML2 driver to fail.

    This patch sets the tenant-id when it is not passed explicitly by

    by the network\_create() call from the HA r...

Reviewed: https://review.openstack.org/196097
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=1cfed745d54a6ce9cb3dd4e6f454666d9e6676c2
Submitter: Jenkins
Branch: feature/qos
commit ba7d673d1ddd5bfa5aa1be5b26a59e9a8cd78a9f
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:31:38 2015 -0700
Remove duplicated call to setup\_coreplugin
The test case for vlan\_transparent was calling setup\_coreplugin
before calling the super setUp method which already calls
setup\_coreplugin. This was causing duplicate core plugin fixtures
which resulted in patching the dhcp periodic check twice.
Change-Id: Ide4efad42748e799d8e9c815480c8ffa94b27b38
Partial-Bug: #1468998
commit e64062efa3b793f7c4ce4ab9e62918af4f1bfcc9
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:29:37 2015 -0700
Remove double mock of dhcp agent periodic check
The test case for the periodic check was patching a target
that the core plugin fixture already patched out. This removes
that and exposes the mock from the fixture so the test case
can reference it.
Change-Id: I3adee6a875c497e070db4198567b52aa16b81ce8
Partial-Bug: #1468998
commit 25ae0429a713143d42f626dd59ed4514ba25820c
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:24:10 2015 -0700
Remove double fanout mock
The test\_mech\_driver was duplicating a fanout mock already setup
in the setUp routine.
Change-Id: I5b88dff13113d55c72241d3d5025791a76672ac2
Partial-Bug: #1468998
commit 993771556332d9b6bbf7eb3f0300cf9d8a2cb464
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 17:55:16 2015 -0700
Remove double callback manager mocks
setup\_test\_registry\_instance() in the base test case class gives
each test its own registry by mocking out the get\_callback\_manager.
The L3 agent test cases were duplicating this.
Partial-Bug: #1468998
Change-Id: I7356daa846524611e9f92365939e8ad15d1e1cd8
commit 0be1efad93734f11cd63fb3b7bd2983442ce1268
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 16:57:30 2015 -0700
Remove ensure\_dirs double-patch
test\_spawn\_radvd called mock.patch on ensure\_dirs after the
setup method already patched it out. This causes issues when
mock.patch.stopall() is called because the mocks are stored
as a set and are unwound in a non-deterministic fashion.[1]
So some of the time they will be undone correctly, but others
will leave a monkey-patched in mock, causing the ensure\_dir
test to fail.
1. http://bugs.python.org/issue21239
Closes-Bug: #1467908
Change-Id: I321b5fed71dc73bd19b5099311c6f43640726cd4
commit 0a2238e34e72c17ca8a75e36b1f56e41a3ece74e
Author: Sukhdev Kapur <sukhdev@aristanetworks.com>
Date: Thu Jun 25 15:11:28 2015 -0700
Fix tenant-id in Arista ML2 driver to support HA router
When HA router is created, the framework creates a network and does
not specify the tenant-id. This casuse Arista ML2 driver to fail.
This patch sets the tenant-id when it is not passed explicitly by
by the network\_create() call from the HA router framework.
Even though original issue was discovered for network\_create()
it turns out the same issue applies for port\_create() as well
so all the methods are fixed in this patch
Change-Id: Id03e26dac003fa589477ed78a4ed3c44cc2f708d
Closes-Bug: 1468828
commit 334d9a33404f4c8438d105f91bff1a9fd9236513
Author: Assaf Muller <amuller@redhat.com>
Date: Thu Jun 25 16:34:09 2015 -0400
Log OVS agent configuration mismatch
Change-Id: I55aef3bdc32dcee3436cb8b987fb796a4898b20e
Closes-Bug: #1468893
commit c48e12b781c9ffd885ebc96283ecda2849fd1e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 21:31:33 2015 +0200
Avoid env variable duplication in tox.ini
Some environment variables are defined multiple times in tox.ini. This
change defines "fake" tox jobs and refactors existing jobs to reduce
duplicated environment variables.
Change-Id: I0ccebea4fbfff8dda34d1ed348b96b3b8ebd59e2
commit 747738d36572079307f228a861a067ca0cd815c2
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 15:20:27 2015 -0700
Skip ARP protection if 0.0.0.0/0 in addr pairs
Don't setup ARP protection on ports with allowed address pairs
that allow them to use any IP address. This is necessary because
OVS doesn't support the /0 prefix in rules that match on ARP headers.
Related-Bug: #1461054
Closes-Bug: #1468009
Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec
commit 61909ac515c337c94f55805641b1b7c725a95191
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:54:34 2015 +0200
linuxbridge: clean up README file
It's weird that we suggest users to copy python files around instead of
relying on generated console\_scripts.
Other configuration information located here is trivial and is
documented elsewhere, f.e. [1].
[1]: http://docs.openstack.org/networking-guide/deploy\_scenario1b.html
Change-Id: Ie8dd37087599ff4b5e23f0ad01105f94f5b886ab
commit 0af5abdb1f608a5e84a64627adf42dd8d5526560
Author: John Davidge <jodavidg@cisco.com>
Date: Thu Jun 25 15:12:59 2015 +0100
Fix tox errors in thirdparty-ci docs
Fixes errors causing tox failures.
Change-Id: I361ef791c0de1aac1304bb8ad979066400930434
Closes-Bug: #1468765
commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:41:02 2015 +0200
Removed test\_lib module
It's not really needed. It was once used to allow some out-of-tox plugin
specific testing scripts to inject configuration files into
BaseTestCase.
Now, our testing story does not have any notion of out-of-gate plugin
specific testing, so let's just clean it up.
Change-Id: If287a38e80016b1dba049a2b745bad7af40583a8
commit 2557c47668ad822810aad523643014c6a5d4a064
Author: Russell Bryant <rbryant@redhat.com>
Date: Wed Jun 24 14:59:26 2015 -0400
Updated from global requirements
This patch takes the latest global requirements update from change
Ibcb49412a012f79be2f7fd697349ddbf43bd7b9b except takes out the update
to setup.py which reverts the windows specific requirements. We are
still working on getting the custom changes out of setup.py in change
I3c07c279d33f6aed46c3a97dd9ba81251e51429a.
Change-Id: Iee7612d39b520cf04e3b2ec503ec79d23f15f949
commit 2ecac909ba419f258e47b456196a1af7a87661ed
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu Jun 25 11:59:37 2015 +0000
Remove quantum untracked files from .gitignore
This change removes obsolete quantum untracked files from .gitignore.
Change-Id: I1ddf0b03d29066363f155dd5af8294efde5b0ef0
commit df06a326de39a6792e2e82eafa5cf50eb325b34e
Author: Matthew Booth <mbooth@redhat.com>
Date: Thu Jun 25 10:20:08 2015 +0100
Context class should initialise its own data
This is a trivial cleanup. A superclass was initialising data which
was only used in a subclass.
Change-Id: I6930fdaef3dcb960f6baaedbd191e22b565f319e
commit 2e1b0ea4032f05afef16efd451e2eea5df901d97
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 17:33:38 2015 +0200
ovsdb: attempt to enable connection\_uri for native impl on startup
The port is in most cases disabled, so to use it, we should first enable
it, and it means that we should still rely on ovs-vsctl for that initial
call.
Closes-Bug: #1468259
Change-Id: I097b1c441df1f7f1785b8744f27809617bb21c14
commit 668b12c2c8a60ce20ecdad2193ede9371d5cc391
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:58:41 2015 -0600
Move third-party CI policy under docs/policies
Change-Id: Ib2ed587670f206283d735191b3a2580bf3d1a04f
commit 3bf62772d39d8b3b8b518ae88a6fcea7414d6884
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:31:01 2015 -0600
Remove lbaas API tests, which are now in the lbaas repo
Change-Id: I2009ca3f102d0ca0db3f12af3012989f2a036c48
commit 1a480203b2531925d7520b62c94954064a26139d
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 24 10:28:18 2015 -0700
Only create one netaddr.IPNetwork object
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c663b8ac73
commit d9a23f882f0d78aaca34c3607d9ca9ad54ac063b
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 3 16:19:39 2015 -0700
Provide work around for 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager
which is called to convert the input.
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054
commit 93d564223e8b76d10aa7b55f1b1d49f592d1c800
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 09:19:18 2015 -0700
Fix >80 char lines that pep8 failed to detect
Change-Id: I602e0d484c5e00eb48b86c4c8c4eff0be195c3a5
commit 830e9114817765efc93c772dcbc735a6bb28a7ff
Author: Anthony Chow <vCloudernBeer@gmail.com>
Date: Tue Jun 23 22:05:23 2015 -0700
Deprecate "router\_delete\_namespaces" and "dhcp\_delete\_namespaces"
These 2 configuration options are no longer be necessary.
They are marked as deprecated in this release and will be removed in the
next release.
Change-Id: I4e02a291738b16c7c9b7600f0bc9a47fb1318569
Partial-Bug: #1418079
commit a84ef9ae54a7dfe6d9dee54a01b189dd40bce423
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 03:27:16 2015 -0700
Make DHCPv6 out of bounds API test deterministic
The test\_dhcp\_stateful\_fixedips\_outrange API test was randomly
picking an IP from last + 1 up to last + 10 in the allocation
range. This made it fail randomly when there was an issue related
to the subnet allocation having an off-by-one issue.
This adjusts the test to just always test last +1 and +2.
Related-Bug: #1468163
Change-Id: I641ab092e0ea0aae67ec717b492118a2f8a6f4fd
commit f527f8cf426ee63b592225d5e691ac107085784d
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 02:15:29 2015 -0700
Don't process network\_delete events on OVS agent
There is no reason to reclaim the local VLAN on a network\_delete
event since it will be reclaimed when the last port is deleted anyway.
This method was racey with recent port creation events and lead to
occasional traces when it would yank the local VLAN out from underneath
an ongoing port wiring process.
Change-Id: I5eee6175c053006b35b6efe274d27931a9d5d89f
Closes-Bug: #1468251
commit 1d61c5f736b9df7253a1939fe55f1875f988d1f4
Author: Henry Gessau <gessau@cisco.com>
Date: Wed Jun 24 03:16:52 2015 +0000
Revert "Fix subnet creation failure on IPv6 valid gateway"
Because it breaks tests.api.test\_dhcp\_ipv6.NetworksTestDHCPv6.test\_dhcp\_stateful\_fixedips\_outrange
This reverts commit ee51ef72d37a02005a7733b7f2faf7236db850a1.
Change-Id: Id02d9034ca809f194ff7551167bfda3559fb1200
commit 7eb9d9d316d35840706a767576ff083c9a04d781
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 00:08:22 2015 +0200
Support oslo\_db 1.12
oslo\_db 1.12[1] decorates oslo\_context.context.RequestContext with
session management[2][3] and add a read-only attribute 'session'. Such
feature breaks Brocade plugin and its unittests because they define
on RequestContext the 'session' attribute which now is a read-only
property. This change uses neutron.context instead of
oslo\_context.context in order to delegate session management to the
neutron.context and remove read-only attribute set.
A follow-up change will refactor neutron.context in order to use oslo\_db
1.12 session management instead of homemade one.
[1] https://github.com/openstack/oslo.db/releases/tag/1.12.0
[2] https://github.com/openstack/oslo.db/commit/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6
[3] https://github.com/openstack/oslo.db/blob/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6/oslo\_db/sqlalchemy/\
enginefacade.py#L782
Closes-Bug: #1468128
Change-Id: I0e3331f9a383fa2562706eeadb229f55593b888c
commit ad86291408fc74827c2bd31f89a2dce34f887823
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 23 15:28:34 2015 +0000
Python 3: do not use itertools.izip
This no longer exists in Python 3. Use the zip function instead.
Blueprint: neutron-python3
Change-Id: Id7d33ec3d27a27f17040d28bead10f2eb3b831bb
commit d23a59f1c808c50575f49f9291bd70c6b3a5797a
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Thu Jun 18 19:09:05 2015 +0000
Override opportunistic database tests to PyMySQL
Set the OS\_TEST\_DBAPI\_ADMIN\_CONNECTION override variable so that
oslo.db opportunistic detection will know to use PyMySQL until
I12b32dc097a121bd43991bc38dd4d289b65e86c1 makes it the default
behavior.
This change removes previous code[1] enabling PyMySQL use.
[1] Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
Change-Id: Ic39feee0248f2ffabdba26f3779ab40a8f3838e6
Co-Authored-By: Victor Sergeyev <vsergeyev@mirantis.com>
Co-Authored-By: Cedric Brandily <zzelle@gmail.com>
commit 04d44cee63f3fbba45956abd28f325d5ac3ca2d9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 23 20:00:30 2015 +0200
Extend default setenv instead of replacing it in tox.ini
Some tox jobs[1] define their own setenv without extending/referencing
default setenv, it disallows to define environment variables shared by
all jobs. This change updates previous jobs[1] in order to extend
instead of replacing default setenv and enable global environement
variables (used in daughter change).
One remark, this change sets VIRTUAL\_ENV environment variable in updated
jobs[1] but it has no effect on them.
[1] (dsvm-)functional, (dsvm-)fullstack and api jobs
Closes-Bug: #1468059
Change-Id: I99184f7375571fb8569a24ba04ae267108f5da08
commit b7dc34ef15061577158eeafc179915e5bde73c64
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 14:28:59 2015 +0200
Cleanup get\_plugin\_name() from the tree
It does not seem to be used since Icehouse: the patch that removed its
last usage is: 1b36e2077141749495bb32b423f3df8cbbd0eb40
I don't think we should have it as part of abstract interface for
service plugins.
Change-Id: If03f67a617efd3a7cadb96d1a86283ac14088a83
commit 277d89b67a6a8ea4f6a7bc216014d55ace5c1d2d
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Tue Jun 23 12:07:43 2015 +0300
Bulk move methods to ipam\_backend\_mixin.py
ipam\_backend\_mixin contains methods common for both backends:
pluggable and non-pluggable, so moving methods to make them accessible
by backends.
Next methods were moved from db\_base\_plugin\_v2.py to
ipam\_backend\_mixin.py:
- \_validate\_subnet\_cidr
- \_validate\_network\_subnetpools
- \_allocate\_pools\_for\_subnet
- \_save\_subnet
This commit moves methods without any internal changes.
All future changes and decomposition of these methods will be handled in
next commits.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1ec786754467fc9039d2276f084f1bceaab15635
commit c384b13ae6b83a8bad944972c60bdcbe6f4fa050
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Apr 16 16:20:01 2015 -0400
Add IPset cleanup script
This will aid in removing stale IPsets when we change the prefix
used in creating IPset names.
Change-Id: Ia9ff79c34bd4c9124ec8663a8f616ded4f389f62
Partial-Bug: #1444201
commit 7e117c13fd3fb125c857dadfa2945799b39e1634
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Thu Jun 18 11:22:13 2015 -0600
Optimize ipset usage in IptablesFirewallDriver
Currently, IptablesFirewallDriver.\_update\_ipset\_members() iterates
through a list of security group IDs and makes a call to
IpsetManager.set\_members() for each security group ID in the list. The
problem is that set\_members() is repeatedly called with the same
arguments over and over again because the list of security group IDs
contains duplicates. These duplicated calls are unnecessary because they
are idempotent.
For instance, with a security group of 50 rules created in this manner:
neutron security-group-rule-create $SECGRP --remote\_group\_id $SECGRP
--protocol tcp --port\_range\_min $i --port\_range\_max $i
Adding a server to that security group will cause 50 calls to
IpsetManager.set\_members() because the list of security group IDs is 50 of
the same ID. Only one call to IpsetManager.set\_members() is necessary
per security group ID.
This patch converts that list of security group IDs into a set, which
eliminates the duplicate idempotent calls to
IpsetManager.set\_members() with the same arguments. This will affect
performance by reducing the amount of file locking around ipset when
adding servers to security groups.
Change-Id: Id2c8c8c1093c8abcf1fd897b23b0358aeb55b526
Closes-Bug: 1466921
commit f44800f1eb649d83a338d320020d3479fc3b6790
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 22 14:59:59 2015 +0000
Python3: do not set Request.body to a text string
In Python 3, Request.body must be set to a bytes object.
Change-Id: I17785d1e9eb253a1c6cae300b207fb0a08873b0e
Blueprint: neutron-python3
commit 408af3f7dab477517b1761aeda2b76384f5fffbe
Author: Assaf Muller <amuller@redhat.com>
Date: Sun Jun 21 15:34:21 2015 -0400
Prepare for full stack CI job
Related-Bug: #1467275
Change-Id: I90f4794f48ae151a888f37df26c087a7fdcd9d31
commit 76b4803530c0d5f47659aa519585178cc33cba46
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Tue Jun 2 16:14:40 2015 +0300
Fix callback registry notification for security group rule
Some housekeeping was done in
- SecurityGroupDbMixin:
- create\_rule\_bulk() calls to create\_rule();
- registry notification is in create\_rule();
- separate validation for a single rule and for a group of rules
- SecurityGroupServerRpcMixin:
- overriden methods call to corresponding super class methods;
Hopefully code is now self-documented enough
Closes-Bug: #1461024
Change-Id: Ia75d7e206716bbe74aae89e4cebd0c2c40af68a8
commit 6da2d24ff44cbc8dd0ea8d2e6f72419a46026989
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 22 15:43:20 2015 +0200
Ease debugging alembic by passing proper scripts path in alembic.ini
Otherwise, anyone who attempts to issue an alembic command with the file
gets:
FAILED: Path doesn't exist:
'<...>/neutron/neutron/db/migration/alembic'. Please use the 'init'
command to create a new scripts folder.
Change-Id: I5b5f2802b478c8d8c327d24faa838f7a6859b979
commit fe6654b25044de7d7d15573c689a0f003c018e99
Author: Martin Roy <mroy@iweb.com>
Date: Thu Jun 18 13:45:02 2015 -0400
Use string exception casting everywhere
Instead of the deprecated "message" member access,
casting to a string invokes the \_\_str\_\_ method of the exception
that is wired to return the message
Added a test of the failure cases of IpRouteCommand::delete\_gateway
because they were missing
Running unit and functional tests locally no longer shows the warning
reported in the bug.
Change-Id: Ia79f526aa973ece1145615d65349f860aa3fd465
Closes-Bug: #1466542
commit c3d65a0ed920110223e1b73d6982968552ca7716
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Tue Mar 3 17:08:48 2015 +0800
Switch to oslo\_utils.uuidutils
Get rid of oslo-incubator uuidutils
Closes-Bug: #1467020
Depends-On: I2df519965883b05d5d58cdc4785c850b0685dc2c
Depends-On: I9f8e98ad9517864a9ffdacf01c0a9a5aab554edb
Depends-On: Ied0faac809a5b72b1cd466c8babc9ca5418692c3
Change-Id: Iebe491b981b4b7c02785412fadd27678bb5e47de
commit ee51ef72d37a02005a7733b7f2faf7236db850a1
Author: David Edery <david.edery@alcatel-lucent.com>
Date: Sun Jun 21 15:59:49 2015 +0300
Fix subnet creation failure on IPv6 valid gateway
Currently a valid IPv6 address gateway of the "\*::ffff:ffff:ffff:ffff"
pattern is failing due to netaddr.broadcast returning value for both IPv6
and IPv4 addresses. IPv6 has no broadcast address so the fix checks if
the gateway is the subnet broadcast address only in the case of IPv4
subnet
Change-Id: I849f95b30343d0b1c90cf91203df220bf731d8d5
Closes-Bug: 1466322
commit b9e551936410eca647b48c48f49f2b2be5d2d4a4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Fri Jun 19 17:58:57 2015 +0300
Decompose \_create\_subnet\_from\_pool
Moved validations into separate methods:
- \_validate\_pools\_with\_subnetpool
Verifies that allocation pools are set only for specific subnet request.
For any subnet request allocation pools can not be set manually
- \_validate\_ip\_version\_with\_subnetpool
Verifies that subnet has the same ip version as subnet pool
Partially-Implements: blueprint neutron-ipam
Change-Id: I63f6aa2a0c94c3437fa624ac800943976f4fc50f
commit 29bb401973af81f4a4b8a667f8b7445e19e017da
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 15:24:44 2015 +0300
Move \_delete\_port
Pluggable ipam implementation will do additional actions on port
deletion (deallocate ip using ipam driver).
Existing \_delete\_port code will be resused.
Moving \_delete\_port to ipam\_backend\_mixin to make this code
accessible and extendable by both backends (pluggable and non
pluggable).
This commit is a preparation step before pluggable ipam implementation
can be used.
Partially-Implements: blueprint neutron-ipam
Change-Id: If6cd623aad9e5501a26e5fb8cdecd5f55e85cd05
commit c0ef7a8f4546cd3c081a61c742dd9ed70ec2c147
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:52:24 2015 +0300
Decompose create\_port and save\_subnet
This commit is a preparation step for enabling pluggable ipam.
Some actions in create\_port and save\_subnet are specific for
non pluggable ipam implementation.
- create\_port
Moved allocation ips for port and storing results into separate method
\_allocate\_ips\_for\_port\_and\_store.
Moved to ipam\_non\_pluggable\_backend, since pluggable implementation will
be different due to rollback on failure logic included.
- save\_subnet
Moved saving allocation pools into new method \_save\_allocation\_pools.
Moved to ipam\_non\_pluggable\_backend, since pluggable ipam implementation
does not need to save IPAvailabilityRange (availability ranges are
maintained by ipam driver for pluggable case)
Partially-Implements: blueprint neutron-ipam
Change-Id: I4a3e5d7f3aa54630279d9589225a509c96ed2186
commit ee14186fbb2486f9088103e9621bc366cc64c552
Author: Henry Gessau <gessau@cisco.com>
Date: Sun Jun 21 01:30:05 2015 -0400
Allow setting Agents description to None
Fix the validator for the 'description' attribute of Agents, allowing
it to be set to None.
Fix an API test that had two problems:
1. It was not restoring the description to the agent it had updated
2. It was retoring the description to '' instead of None.
Closes-Bug: #1466642
Change-Id: I50723e1346be0953d26216ba24907bac008ccfb6
commit d0d62927e661c84003845a61d2b991a54e723ed4
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Sat Jun 20 11:55:27 2015 +0000
Fix RPC version to be a string
The RPC version was being passed as a float which caused an
exception.
Change-Id: I2a2888fcafcc426009fc841b81049a22e072ce75
Closes-Bug: #1467087
commit 35654ec23ef9db6bda313ea300ab76c287a98ceb
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon May 25 15:20:05 2015 +0300
Decompose DVR CSNAT L3 Agent from Compute Node L3 Agent
Currently the same dvr router class is used both by the L3 Agent
in the compute nodes that is responsible for the virtual routers
namespace and the fip namespace and also used by the centralized
SNAT L3 Agent in the network node.
This is the first step to decompose the two into different
classes.
The above means that we have one class of DVR router which is used
for two jobs (the virtual router namespace wiring and the fips wiring
in the compute node in one hand and the centralized snat wiring in the other)
The end goal of this patch is to separate the two into different classes
which will also help maintaining it and also help projects that want
to use one but not the other (for example only use the centralized
SNAT behaviour with there own DVR implementation)
Change-Id: I581a097b9e7c49f20d0eb0e4ca66a25e90d9511b
Partial-Bug: #1458541
Partially-Implements: blueprint dvr-router-code-decompose
commit 0e48d9d203619f50adae94ddb6bbccd28f381737
Author: Davanum Srinivas <davanum@gmail.com>
Date: Sun Jun 7 10:10:18 2015 -0400
cleanup openstack-common.conf and sync updated files
Periodic update of latest files from oslo-incubator
Change-Id: Ie7eb02e4e9277c18abfb438b6cf710e0aa426b15
commit 74b0c53da5d7e4305606c100becf34966d8af350
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Jun 11 13:38:55 2015 +0300
Fix l3 agent to not create already deleted router
In case router is deleted during l3 agent resync,
the "deleted" event is processed with higher priority, then
resync event for the router may be processed which will recreate
already deleted router.
This happens due to timestamp not being properly updated for deleted
router in router processor.
The fix adds timestamp update for deleted router.
Functional test will be updated in a follow-up patch
Logging was improved to make debugging a bit easier.
Closes-Bug: #1455439
Change-Id: I2d060064acccc10591a3d90be9011f116548cfce
commit 4f5171d2cedb32fdc5a59d241e7ae91c7284b75c
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:24:34 2015 +0000
Python3: do not use '+' on dict\_items objects
In Python 3, dict.items() returns an iterator. Iterators cannot be added.
Blueprint: neutron-python3
Change-Id: I487178ebceae9946cb53dea1e847d7715f4577f3
commit b336b7c438f3f5d4ee8d23d6bb2d2cf8fe1657f4
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Fri Jun 19 15:52:35 2015 +0200
Disable keepalived process in keepalived func test
Previously, keepalived process itself was disabled that lead to
respawning of keepalived by KeepalivedManager. This patch disables
KeepalivedManager in cleanup thus no respawn happens.
Closes-Bug: #1466873
Change-Id: If5524116e5d4fc41600920d31481282c5b797f7b
commit a4b17cbb80b48c8e4bcd7cc005139f8e66066d68
Author: Cyril Roelandt <cyril@redhat.com>
Date: Thu Jun 18 11:52:28 2015 +0000
Python3: do not use im\_self/im\_func/func\_closure
One should use \_\_self\_\_, \_\_func\_\_ and \_\_closure\_\_ instead, as they work
with both Python 2 and 3.
Change-Id: I2b2847cfd5b4fa70e45387ff369240227ce9e526
Blueprint: neutron-python3
commit 432567f9477eadd840e407c5c057fc664e46d731
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 15:48:09 2015 +0300
Add request factory for pluggable IPAM
Pluggable IPAM implementation requires separation between requesting
address/subnet and it's actual allocation, which can happen on
third-party IPAM servers. Request factory stands for simplifying
building right request from input.
Added AddressRequestFactory and SubnetRequestFactory.
AddressRequestFactory creates instance of AnyAddressRequest or
SpecificAddressRequest depending on presence of ip address in input.
SubnetRequestFactory creates instance of AnySubnetRequest or
SpecificSubnetRequest depending on input.
get\_subnet\_request\_factory and get\_address\_request\_factory can be
redefined on driver level to use custom request factories.
Partially-Implements: blueprint neutron-ipam
Change-Id: Iedc0cfa326d60810099148f0ef8a1edac9e8aa12
commit 870fb38b1c7ddd5ddb399e6ff13a4f7992f8f9a6
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:59:46 2015 +0200
Python3: use dict.keys() instead of dict.iterkeys()
The "keys" method works on both Python 2 and 3, and the performance
impact should be negligible.
Change-Id: I4771797859666000921e4e38cc5de72a8c084ca0
Blueprint: neutron-python3
commit 538a7bf3c73d968185590d81a9b3a6523190aeb4
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Jun 9 03:41:07 2015 -0700
NSX QoS ext: RXTX factor can be decimal
In Nova flavors it is ok to specify a decimal RXTX factor.
For this reason when applying QoS to a port Neutron should not
convert this factor to an integer value, but simply ensure
it's a valid float number and positive.
Partial-Bug: #1463363
Change-Id: I983123ef7fd8f1b52b358aff3b579459fce63033
commit 5aaae68e5148f01e78a5e6013dce797dd42c1917
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:17:58 2015 +0300
Move \_add\_auto\_addrs\_on\_network\_ports
Moved to ipam\_non\_pluggable\_backend.py since implementation
is specific for non pluggable ipam backend.
Pluggable implementation will additionally include rollback on failure actions.
This commit is a preparation step for using pluggable ipam.
More changes in this methods are expected to be done by following
patches.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1876846526e370a7fcfa05b9a23fd9065973f111
commit 6669ee9af6bd635ae7efbc2f02e10914549ef708
Author: Lucas Alvares Gomes <lucasagomes@gmail.com>
Date: Thu Apr 9 14:02:36 2015 +0100
DHCP agent: Set an "ipxe" tag to work with Ironic
Ironic expects neutron to have an "ipxe" tag for the option 175 which is
sent by iPXE/gPXE when booting a node. The problem is that up to now this
tag was not created by Neutron, causing the nodes deployed with Ironic
+ iPXE to fail to boot. This patch is creating this tag when launching
the dnsmasq process.
DocImpact
Change-Id: I45a0f51365b37e7d85848fcdcbcf7aa6a1dddfed
Closes-Bug: #1442123
commit 735f193668d61dd7c09f710e555ab91d1d91abe6
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 18:47:11 2015 +0300
Remove \_check\_ip\_in\_allocation\_pool
\_check\_ip\_in\_allocation\_pool is not used anywhere in neutron.
Cleaning up unused code from db\_base\_plugin\_v2.py.
Caller was removed over a year ago in change
Ib31550fa9000fc75768a327cb6cc1c419e06568f
Partially-Implements: blueprint neutron-ipam
Change-Id: I41b7254835c308dda679ee2a5ebbccba528fd108
commit e3710f59481b4f9c3430228e8f074c845e93fbe7
Author: shihanzhang <shihanzhang@huawei.com>
Date: Mon Jun 15 14:51:16 2015 +0800
Don't delete DVR namespace if there are still ports on this node
Skip deleting DVR namespaces if they contain ports in the BUILD or
DOWN status.
Change-Id: I026f2014ede800c0f4532ca15f1fccdaa59d5b61
Closes-bug: #1464527
commit 345ffb99ef92f567562c178c57b9c110740a3767
Author: Doug Wiegley <dougw@a10networks.com>
Date: Thu Jun 18 18:13:43 2015 -0600
Updated from global requirements
Since we can't merge proposal bot at the moment, due to a conflict with
setup.py, at least get our reqs files up to snuff.
Change-Id: Ie313c81502dfe17a4afdcfdba4e207b9866e1399
commit 42826a0e64b3499cda065fd9ffdf0b5af5754c85
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:06:21 2015 +0200
Fixed the only sphinx warning in docs
We made previous attempt to get rid of all warnings, but it turned out
that gate does not execute tox's docs job but runs build\_sphinx
directly.
The latter behaviour should be fixed, but while at it, we
should prepare neutron job to be executed in gate by cleaning up all
warnings.
Closes-Bug: #1466554
Change-Id: I8c265eae2175425568479116d1faef7d87fdcc02
commit 63e318f5f8159f108cf1e7a82c952fa5f882870f
Author: Moshe Levi <moshele@mellanox.com>
Date: Thu Jun 11 12:24:03 2015 +0300
Fix SR-IOV mech driver to set port status to down when agent is required
SR-IOV mech driver has 2 modes agent and agent-less. Currently in both
modes port status are active. This patch update the port status to down
when using agent mode. This will allow the SR-IOV agent to get port
update notification and apply its additional functionality
when launching vm.
Co-Authored-By: Berezovsky Irena <irenab.dev@gmail.com>
Closes-Bug: #1464186
Change-Id: Ibd9b31b4f2393b8732253d5cbfd36e8b5614860d
commit cdde9a3aeb929e80aa3c251a44060b8174ab7b6c
Author: venkata anil <anil.venkata@enovance.com>
Date: Thu Jun 18 10:03:12 2015 +0000
read\_hosts\_file\_leases shouldn't parse stateless IPv6
Error when \_read\_hosts\_file\_leases tries to parse stateless IPv6 entry
in hosts file
TRACE neutron.agent.dhcp.agent ip = host[2].strip('[]')
TRACE neutron.agent.dhcp.agent IndexError: list index out of range
Neutron creates entries in dhcp host file for each subnet of a port.
Each of these entries will have same mac address as first field,
and may have client\_id, fqdn, ipv4/ipv6 address for dhcp/dhcpv6 stateful,
or tag as other fields.
For dhcpv6 stateless subnet with extra\_dhcp\_opts,
host file will have only mac address and tag. So \_read\_hosts\_file\_leases
shouldn't check for ip address for this entry in host file.
Closes-bug: #1465330
Change-Id: Iad6605ac5c7bcd6ec9204352037ed021f5007738
commit 31f846c1b9fa17d1812f78dffe1dcf883da52bab
Author: shihanzhang <shihanzhang@huawei.com>
Date: Fri Jan 30 09:50:52 2015 +0800
Fix 'router\_gateway' port status can't be updated
when it creates a ovs bridge without parameter 'bridge-id',
it's default 'bridge-id' is None, so ovs agent should also
deal with these ovs bridges, for example if ancillary bridge
br-ex does not be handled, the 'router\_gateway' port status
can't be updated.
Change-Id: If428eadadfd36a9b19ea75920120e48ac49659f2
Closes-Bug: #1416181
commit 2db459f284002e45497d768a8a53c9b43d045d45
Author: Doug Hellmann <doug@doughellmann.com>
Date: Tue Jun 16 19:49:15 2015 +0000
Update version for Liberty
Update the version for Liberty, switching from date-based versioning
to pre-versioning using SemVer. See
http://lists.openstack.org/pipermail/openstack-dev/2015-May/065211.html
and
http://lists.openstack.org/pipermail/openstack-dev/2015-June/067082.html
for details.
Change-Id: I6a35fa0dda798fad93b804d00a46af80f08d475c
commit 98d0be2f82523a40e630cf08dd8479b4cbb48add
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:33:56 2015 -0700
Add networking-sfc to the list of affiliated Neutron projects
The project is being bootstrapped in [1,2], this change reflects
that in the sub\_projects doc.
[1] I3825a1e02713f45e2c769eaa8fd0f1ab48d14372
[2] Iec53129d7c19620d690e71032c83907f03c66d9f
Change-Id: I7c235bfe444bbb9afc7d4d8c92704c9bfc09ab49
commit 315b10dc9fa7b8d889a24e0c6cdf72f5341d92d5
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:31:01 2015 -0700
Minor improvements to sub\_projects document
Let's remove the empty table, to cut down the risk of inconsistency,
and further explain what the list of affiliated project is for.
Change-Id: I3c8970db8de4fc211233903e8220cda72d47e193
commit 53209ca19ac2116d293b6fbc7b31254cb27a3ecb
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 17 14:25:56 2015 +0000
Python 3: do not use cmp(), nor sorted(..., cmp=...)
\* The "cmp" function has been removed, so we must not use it any more;
\* The "cmp" keyword argument of the "sorted" function has been removed, so
replace it with "key=functool.cmp\_to\_key".
Change-Id: Ic39d29dc1002a68f36f04c32e53a36bc826dce78
Blueprint: neutron-python3
commit 4a73ab99c9fcc63adbbb41d4a9b9ba8669afdc61
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Tue Jun 16 13:48:26 2015 +0200
Move get\_inteface\_by\_ip from LinuxBridge class to ip\_lib
get\_interface\_by\_ip is moved fro LinuxBridgeManager to ip\_lib
as a more generic get\_device\_by\_ip.
System-faking unit tests have been switched for functional
testing that also performs a negative test.
This can be reused in the openvswitch-agent code to validate
local\_ip reusing the LinuxBridge logic.
Change-Id: I9237871a6e24dd99556c71844624be510e20d289
Related-Bug: #1464178
Related-Bug: #1408603
commit 76dd333167920f447bdbedbbee10fdab593abe5b
Author: Vladislav Belogrudov <vladislav.belogrudov@oracle.com>
Date: Wed Jun 17 14:02:22 2015 +0300
Fix cisco\_csr\_identifier\_map.ipsec\_site\_conn\_id
Some database engines require exact match of sizes of foreign keys
and referenced fields. Foreign key ipsec\_site\_conn\_id of table
cisco\_csr\_identifier\_map is varchar(64) but it references field
id varchar(36) of table ipsec\_site\_connections. This gives error
while running migration scripts in such databases.
This fix only applies to new installations. Existing databases will
be corrected by migration scripts introduced in
https://review.openstack.org/190569 - they will take care of resizing
the field and adjusting the model.
Change-Id: I6cc9625a2d96d1330b06eb727cc7fa5363c697b8
Depends-On: I384a9bbaba05ef94174b666bdcfb276eedc74134
Closes-Bug: #1463806
commit 7a7377681133785e12a296ff7077b039708da97d
Author: Thomas Morin <thomas.morin@orange.com>
Date: Wed Jun 17 12:13:35 2015 +0200
fix rootwrap debug filter for ping all
NeutronDebugAgent.ping\_all calls ping with "-c 1 -w <number>' so
the filter should accept this order, and not only "-w .. -c ..".
Not changing the existing filter to not break other tools
that might use -w -c in that order.
Change-Id: I5b3d67dfcdc15c53ac3bf2fb39de29fd97e98a19
commit 7d704db18ec7635328bfce7dc6e936151f264f1f
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 23:16:24 2015 -0700
Refactor rpc\_loop() in ovs neutron agent
This patch segregates the port\_info recieved by
scan\_ports and scan\_ancillary\_ports.
This refactoring is basically required for this patch set:
https://review.openstack.org/#/c/165023/
Co-Authored-By: Romil Gupta <romilg@hp.com>
Change-Id: I9b43c230cda9d2659ad0e806bebe8a3dc12826ec
Partial-Bug: #1329223
commit 4e77442d529d9803ff90de905b846af940eaf382
Author: Kevin Benton <blak111@gmail.com>
Date: Sat Jun 13 18:45:19 2015 -0700
Add deadlock retry to API and ML2 RPC port update
With the switch to the pymsql SQL driver, eventlet will now yield
during database transactions. This greatly increased our probability
of multiple coroutines running transactions on the same table that
result in deadlocks.
These deadlocks could result from many things including the following:
\* a coroutine holding a pessimistic "SELECT for UPDATE" lock when
another tries to update the locked records
\* two coroutines both issue update statements using a WHERE clause
invalidated by the other update (e.g. from a compare and swap approach)
\* two coroutines insert records that, when combined, violate a unique
constraint on the table in a master-master Galera deployment
\* any two workers using "SELECT for UPDATE" in a master-master Galera
deployment (write-set certification failure translates to deadlock)
This problem is exacerbated by the switch to multiple API and RPC
workers, each of which can lead to most of the errors above even
without the switch to pymysql.
This patch adds a deadlock retry decorator to the delete, create,
and update methods at the HTTP API layer. Additionally, it adds a
decorator to the update\_port\_status AMQP API in ML2 since it updates
the port table, which is a heavily locked table by ML2 making it a
prime candidate for deadlocks.
Nova has had relied on the deadlock retry mechanism for quite some
time now. We were limping along by not using additional workers and
by relying on the unyielding nature of the MySQL C driver to
serialize everything.
Closes-Bug: #1464612
Change-Id: I635cc49ca69f589f99ab145d4d51e511b24194d2
commit 95b6a74af10e2150b017647028de8454ef1cda2f
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Tue Jun 16 17:23:09 2015 -0700
ovsdb: session.rpc never initialized
Previously, if idl.Transaction.commit\_block() returned a status of
TRY\_AGAIN we would check self.api.idl.\_session.rpc.status which would
result in an attribute error as rpc is None.
This patch fixes this attribute error by removing this unneeded check. In
addtion, the force\_reconnect() is also removed as ovs.jsonrpc handles
reconnecting automatically for us.
Change-Id: Ibf3ce5cd3432845f8938a1d83637ecf59b14b5ca
Closes-bug: 1465889
commit fc0c3a83659a86453acd5745a5632729b99cb3de
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Mon Jun 15 10:57:02 2015 -0600
Remove duplicated debug logging around locking
Currently, iptables\_manager.py does extra unnecessary logging about lock
acquisition and release. It uses lockutils.lock() which passes
do\_log=True by default, which causes lockutils.lock() to do debug
logging about lock acquisition/release. IptablesManager itself also writes
debug log info about lock acquisition and release.
This change will eliminate unnecessary duplicate logging in order to
reduce log noise about locking. This change is also related to
https://github.com/harlowja/fasteners/commit/f88f2fea7fe250b7d26cdcbc84633ccbbc68eeee
which reduces the logging level in the underlying lock implementation
used by oslo.concurrency. That change along with this one will remove
the duplicate debug logging about locking in iptables\_manager.py and also in
ipset\_manager.py.
Change-Id: If6f4a7101f3783ad83645e28bbb5c577dd403d3b
Closes-Bug: 1464727
commit 8f2014ea556404fb99c78add1e46b80c718cf491
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 05:32:44 2015 -0700
Refactor scan\_ports() and update\_ancillary\_ports() in OVS Neutron Agent
Used a helper method which contains the common code from scan\_ports()
and update\_ancillary\_ports(). And also renamed the name of
update\_ancillary\_ports() method to scan\_ancillary\_ports() to have parity
between normal ports and ancillary ports.
Added unit tests for scan\_ancillary\_ports.
Co-Authored-By: Romil Gupta <romilg@hp.com>
Partial-Bug: #1329223
Change-Id: I8b3e00a9371d5a03cc8b4be24bf20eec10bef5df
commit 4f46d2ae3a089f36512fae3bf49f155927095922
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 16 13:38:13 2015 +0000
Python3: do not change the size of a dict while iterating over it
This does not work in Python3, so we have to store the items first.
Change-Id: I7d8641f980fe62d2900559433d5060a6281a97f8
Blueprint: neutron-python3
commit 0488ac707493575e084f02273df2c4ec598541ba
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 12:34:41 2015 +0300
Refactor TestRpcWorker and TestWorkerService
TestRpcWorker and TestWorkerService have a duplicate test\_reset.
This patch introduces a base class from which tests for service
workers can inherit.
Change-Id: Ic4690c3b066b03c2fbb463f1329208ad1307d83d
commit fca84f69659e4e81790de405213f31e80fd8c239
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 2 18:45:51 2015 +0300
Juno\_initial migration
Havana was deprecated with the kilo release, and icehouse will be
deprecated with the liberty release, so havana\_inital migration should be
removed and replaced with juno\_initial.
Closes-bug: #1461103
Change-Id: I2e6802c9ab64d164bd888278d555dfeeaf47257b
commit 037f3111cd3968ff00593387daf2b832761e5ef4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 16 09:21:42 2015 +0200
docs: added job to well known tox envlist
This is to make 'tox -l' return the job name in its output (needed to
allow run-docs.sh script in project-config to determine whether the job
is present, to rely on it when generating docs in gate).
Change-Id: I80eb169b7b4e5a3490586722c64394dbb724928d
commit 9fc422a93a00f4126e91fa79ffcd43903ea9c8ac
Author: Sean M. Collins <sean@coreitpro.com>
Date: Mon Jun 15 13:51:05 2015 -0400
API Extensions: inherit from the ExtensionDescriptor
For consistency in the codebase, API extensions should inherit from the
abstract base class ExtensionDescriptor.
Change-Id: Id4829c265866e80c042c433bebcc01383e1e7417
commit 34aa030847ed24ad6ca7759459cbe9a6d0f43db3
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Jun 15 14:47:21 2015 -0400
Remove fossilized remains
Clean up ancient stuff that hasn't been touched in over 3 years.
Change-Id: I67fcd85027fb6614cafe8d92ddbf8c24aed58a4f
commit f88f3dc8d6f7240d6c0d9d5006345b3a797ae067
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 16:18:40 2015 +0300
Refactor update\_port in db\_base\_plugin\_v2
This commit is a preparation step for using pluggable IPAM.
- moved validations into \_validate\_port\_for\_update;
- updating ip addresses for port is backend specific, so
moved into \_update\_port\_with\_ips in ipam\_non\_pluggable\_backend;
- writing port changes to db is common for both backends, so
moved into \_update\_db\_port in ipam\_backend\_mixin;
- updated to use namedtuple to track add/original/remove ips;
- added \_make\_fixed\_ip\_dict to exclude keys other than
ip\_address and subnet\_id;
Partially-Implements: blueprint neutron-ipam
Change-Id: I1110e88f372b1d0cc7ec72049ba69a6d548da867
commit a89f99c6b700b1c6f918fe359c7271ac25ed4bc4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 14:56:58 2015 +0300
Refactor \_update\_ips\_for\_port
This commit is a preparation step for using pluggable IPAM.
\_update\_ips\_for\_port was refactored and split into two methods:
- \_get\_changed\_ips\_for\_port
This method contains calculations common for pluggable and
non-pluggable IPAM implementation, was moved to ipam\_backend\_mixin.
- \_update\_ips\_for\_port
This method is specific for non-pluggable IPAM implementation, so it
was moved to ipam\_non\_pluggable\_backend\_common.
Other changes:
- \_update\_ips\_for\_port now returns namedtuple with added, removed, original
ips (previously added and original ips were returned).
List of removed ips is required by pluggable IPAM implementaion
to apply rollback-on-failure logic;
- removed unused port\_id argument from \_update\_ips\_for\_port argument list;
Partially-Implements: blueprint neutron-ipam
Change-Id: Id50b6227c8c2d94c35473aece080a6f106a5dfd8
commit a8619e9bd1247e8ec494c456aee9ee7163231f62
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 15 15:07:28 2015 +0000
Python 3: use dict.values instead of dict.itervalues
This works with both Python 2 and 3, and should not have any performance
impact.
Change-Id: I2a14945c60de513b91c6f022ff5dcc503ce2a8ad
Blueprint: neutron-python3
commit 62faedddf2b0315484a04bd9092e96a3a828e46a
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:15:11 2015 +0200
Put output of docs job into doc/build/html
This is the path where jenkins/scripts/run-docs.sh that is used by gate
to generate project documentation expects to see the output.
Change-Id: Id276fa59edb33f7789ab06055300b4dc2385472a
commit ad1c7a35dec614a26de0a426950fa005df5f489d
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:23:44 2015 -0400
Remove get\_namespace from API extensions
Based on the conversation on the ML.
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066219.html
APIImpact
DocImpact
Closes-Bug: #1464023
Depends-On: 6f900fc429bf24cb31e0d2f149aa732055fd5956
Change-Id: I3c406910991c33cf959c5345d76153eabe3ace2d
commit b370c69b75fe38cd285512f9516ce428e8a806dd
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 9 16:00:58 2015 +0000
Ensure no "db" related functional/fullstack tests are skipped in the gate
Currently neutron uses MySQLTestCase[1] and
PostgreSQLOpportunisticTestCase[2] for functional and fullstack tests
using a real MySQL/PostgreSQL database. These classes skip tests when
the db is unavailable (db not installed/configured, missing packages,
etc.) which is fine when tests are runned by developers but not when
runned by the gate jobs.
This change updates MySQLTestCase[1] and defines PostgreSQLTestCase[1]
as PostgreSQL oslo.db test class wrapper: when the db is unavailable,
these classes ensure tests will:
\* fail in the gate (dsvm-functional, dsvm-fullstack jobs),
\* be skipped by default otherwise (functional, fullstack jobs).
[1] neutron.tests.common.base
[2] oslo\_db.sqlalchemy.test\_base
Closes-Bug: #1404093
Change-Id: I77b12e728ce9a7b0222c3df081842635f6375a3e
commit 278a5fce29504c43d669feed210f7b3627616e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:35:11 2015 +0200
Use PyMySQL in MySQL related functional/fullstack tests
mysql-python driver has been replaced by PyMySQL driver[1] in neutron
code but MySQL related functional/fullstack tests try to use
mysql-python driver because of MySQLOpportunisticTestCase[2] and tests
are skipped because mysql-python driver is no more available.
This change provides a backend implementation for mysql+pymysql, a base
base testcase MySQLTestCase[2] using mysql+pymysql implementation
(currently oslo.db provides none of them but will in the future) and
replaces MySQLOpportunisticTestCase with MySQLTestCase.
[1] I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
[2] neutron.tests.common.base
Closes-Bug: #1463980
Change-Id: Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
commit 1318437a0caf38e695a819848832a955fef7d909
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Fri Jun 5 01:46:22 2015 +0400
Skip rescheduling networks if no DHCP agents available
This eliminates the problem of unscheduled networks in case
of communication failure between agents and servers which
can occur if messaging queue service fails.
Change-Id: Ied4fa301fc3d475bee25c47f3a01c2381ae9a01e
Closes-Bug: #1461714
commit bb846c89ee120662eabdd4b0136fac82de076777
Author: Russell Bryant <rbryant@redhat.com>
Date: Fri Jun 12 21:26:37 2015 -0400
Reflect project moves from stackforge to openstack.
Several git repos were just moved from stackforge to openstack.
Reflect the move in various places where the URL was in docs and
comments. In passing, also change URLs to git.openstack.org instead
of github, as that is the official home of all of these repos.
Change-Id: I6c79a192d6604cef01e88d5b305fcc2b0f9c6b30
Co-Authored-By: Kyle Mestery <mestery@mestery.com>
Signed-off-by: Russell Bryant <rbryant@redhat.com>
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 1710f7c72f2c509d1009ee36ba4f66b298967fe9
Author: Kobi Samoray <ksamoray@vmware.com>
Date: Thu Jun 4 15:49:13 2015 +0300
VMWare NSXv: Add distributed URL locking to ini
NSXv plugin supports distributed locking using tooz library.
This patch adds the required parameter to the ini file.
DocImpact
Depends-On: Icbcec938c1c5ae7a528350f2f283388b81fa66b7
Change-Id: I8a7c36d044c4be29b0dfa3fbb8e9379723cebd61
commit 9952abaab182f3ec701aad2397d6f3fcc0bacc7f
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Mon Jun 8 14:15:30 2015 +0300
Decompose db\_base\_plugin\_v2.py with changes
This commit is a preparation step for using pluggable IPAM.
1. Moved get\_subnets functionality to db\_base\_plugin\_common to make it
accessible by ipam backends.
2. Reworked update\_subnet routine:
- moved db part into update\_db\_subnet;
Partially-Implements: blueprint neutron-ipam
Change-Id: Idb8f54d9fccaad1137222d156590c37d86aa576b
commit a5bf502fab57453a1aedd3a53ce89eaf464e1cd9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Fri Jun 12 21:11:02 2015 +0200
Remove duplicate tunnel id check in sync\_allocations
Currently, gre/vxlan sync\_allocations and \_parse\_tunnel\_ranges both
check tunnel id values. This change removes the check in gre/vxlan
sync\_allocations as they duplicate \_parse\_tunnel\_ranges check and is
less fine.
Change-Id: I5827468aeaec5d6c79d469132b129aeb7da171e2
commit 901e6ae6fb05d65ccfc4a6602de4160c3a34031e
Author: Akihiro Motoki <motoki@da.jp.nec.com>
Date: Sat Jun 13 02:14:17 2015 +0900
Remove meaningless no\_delete from L3 test
no\_delete parameter was removed in Kilo and it no longer
has any effect.
Change-Id: Idf0f3ac24b3978392222efbf465cc9e6cfd5d346
commit ba2c44ef000221f8a18274a9569838d8c26014c0
Author: armando-migliaccio <armamig@gmail.com>
Date: Fri Jun 12 08:58:05 2015 -0700
Revert "Revert "Set default of api\_workers to number of CPUs""
This reverts commit 12a564cf03e612dda36df26df8d28dfc75f1af6e.
We should re-enable this feature on a controlled basis so that we can
flush out any outstanding issue we may have.
Related-bug: #1432189
Change-Id: I2cfd93fdb032b461022b729347390ff8636ccdeb
commit 89a83bf199e7ea75c04f3205ff77987feed13184
Author: rossella <rsblendido@suse.com>
Date: Thu Jun 11 10:43:36 2015 +0200
OVSNeutronAgent pass the config as parameter
Instead of using the global cfg.CONF, pass the config as parameter.
This is very useful to test the agent without having to override
the global config.
Change-Id: I45534d79e044da9f2be4d596a58310fb28b7bf22
commit 7e0222409dab6223579efea34ba0d3ccf93e11d3
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 11 17:23:41 2015 +0300
Refactor \_update\_subnet\_allocation\_pools
Moved \_update\_subnet\_allocation\_pools to ipam\_backend\_mixin.py.
Call \_rebuild\_availability\_ranges with self to make it overridable
on upper level (from non-pluggable backend).
Partially-Implements: blueprint neutron-ipam
Change-Id: If7b1e720f88a2f0177b6772a015ae216f19ee22d
commit 5ff082bcfe12647036e5b033bfc2bac514acdb42
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Tue Feb 24 15:47:01 2015 -0500
Stop sending gratuitous arp when ip version is 6
This fix prevents calls to the arping utility for IPv6
addresses, thereby eliminating errors reported by arping
for IPv6 addresses.
The assumption is that NDP, DAD, and RAs are sufficient
for address resolution and duplicate address detection
for IPv6, and that unsolicited Neighbor Advertisements (NAs)
are not required for OpenStack services. If this turns out
not to be the case for some service/feature, then a separate
bug should be filed to add support for unsolicited NAs for
that service.
Change-Id: I14f869b7d488d7e691f7316eafcab3064e12cda6
Closes-Bug: 1357068
commit 1552f311532fdbd03a79ecfc1fae488b072c5a14
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 9 11:30:06 2015 +0300
Fix Enum usage in 589f9237ca0e\_cisco\_n1kv\_ml2\_driver\_tables
PostgreSQL is more sensitive with types than MySQL, it creates a
separate type when a Enum is created. In migration 589f9237ca0e
type profile\_type is trying to be created, but the type with such
name was already created in havana\_initial migration.
The solution for this is not to create type in 589f9237ca0e
migration when dialect is PostgreSQL and use already created.
Closes-bug: #1463301
Change-Id: I66e74d50cc70673de8635616076779cc20cde113
commit cd56a657a19a5a756d191c614becfd3e386b3c80
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jun 11 06:03:07 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If91f3ac94562cc5130dd5ea5ac5d71aec64b74e3
commit 7b51521e31f896d0095510b52644b728aaadca5a
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 10 21:45:41 2015 -0700
power grab
The current core reviewers hierarchy didn't have a place for the
parts of ML2 that weren't related to agent communication. For now
we can put all of ML2 under the built-in control-plane until we
decide it needs to be put somewhere else.
Change-Id: Ic4924e0041c4cbb955d8fac0f96ec56406d6466e
commit 1c29fab7cb3e586be72dd7910e2022b45c809c5f
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Jun 4 23:54:31 2015 -0400
Change ensure\_dir to not check directory exists first
I224be69168ede8a496a5f7d59b04b722f4de7192 added an EEXIST
check, so no need to check if the directory is already
there, just try and create it.
Change-Id: Iba51fc8263bf59326489319d0dd3f69af00a8eeb
commit 7c331be77fb6a835f1fb79c674d8d6c39c7eb357
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 10 16:53:25 2015 -0700
Document existence of br-tun and br-int in the OVS agent
Question about the use of the two bridges has come up in the past
multiple times, so let's fill the gap in the developer documentation.
A user-facing documentation patch will have to follow up, if we want
to be very thorough.
Change-Id: I6dac0f9bdaf7b3b7bff8745d4103ccc71df61a0a
commit 9c8a19ba4032f98ecbffe53c4e731587550ded96
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:08:45 2015 +0200
Correct indentation in neutron.api.v2.attributes
This change corrects subnetpool resource definition indentation in
neutron.api.v2.attributes.
Change-Id: I6738ff6b73bd0b943cec32f14ccb8946ba28d2e3
commit fd85b3ead32cd988e93f1d33d219ffd52cd77a51
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 10 10:20:58 2015 +0000
Python3: replace 'unicode' with 'six.text\_type'
In Python 3, 'unicode' does not exist; 'six.text\_type' should be used instead.
Change-Id: I71011b4beee9817a61278eb473804cfb798de74a
Blueprint: neutron-python3
commit c34ce7c9845cc56f981e0ee8714d1f9345df5852
Author: Saksham Varma <sakvarma@cisco.com>
Date: Tue Apr 7 18:12:02 2015 -0700
Moving out the cisco n1kv section to stackforge
Since most of the n1kv plugin code resides in stackforge/networking-cisco
repo, it's best to move the n1kv section there
Change-Id: Ic1388980dea0d27dfa5e84869f1f20cc9bff78e5
Closes-Bug: #1441400
commit 27df3e9fb98407e94bdeb9df493a9a3a0be639ca
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon Jun 1 22:29:39 2015 +0200
Ensure no "agent" functional tests are skipped in the gate
Some "agent" functional tests[1] can be skipped if some requirements are
not satisfied in order to allow developers to run functional tests on
various environments. These tests should not be skipped in the gate.
This change defines the decorator no\_skip\_on\_missing\_deps[2] to ensure
no "agent" functional tests are skipped in the gate. More precisely
no\_skip\_on\_missing\_deps transforms a skipTest into an error in:
\* dsvm-functional and dsvm-fullstack jobs,
\* functional and fullstack jobs when OS\_FAIL\_ON\_MISSING\_DEPS is
evaluated as True.
The change enlarges OS\_FAIL\_ON\_MISSING\_DEPS environment variable scope
(ie: missing dependencies + system requirements).
[1] in neutron.tests.functional
[2] in neutron.tests.common.base
Change-Id: Iacd4a5ef249fc1d7c75135ead9d0cf99d8a98a06
Closes-Bug: #1459844
commit ca63dfd0f39c7d691247c146b7529937c5804c9e
Author: Romil Gupta <romilg@hp.com>
Date: Wed Jun 10 09:43:56 2015 -0700
Remove useless pass from methods in type\_tunnel.py
The pass is useless because there is a docstring in the methods.
Generally considered as uncovered by coverage tool.
Change-Id: Id1275c51e9adb865a3da9f0db007f3092b55b140
commit 87fecfcc50f371d8dd593b3cd372da9db56f39c6
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:29:33 2015 -0400
Make Vlantransparent extension inherit from ExtensionDescriptor
Change-Id: Ic615578a1fe1d401b53d0b44ff5275d9518b97fd
commit eeacb95e65a749ce3a032246c36d10cad9df22b1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Wed Jun 10 13:10:54 2015 +0200
Actually allow to pass TRACE\_FAILONLY to ostestr
The comment below suggests to use TRACE\_FAILONLY to fail quickly when
running unit tests, while tox 2.0 does not allow to pass envvars from
the cli caller unless they are explicitly mentioned in passenv=
directive.
Change-Id: I6861498e7609b0c21fad844009420ea9734e2352
commit 1c124a309bc941c078b8bb622ea248a3ed3829e1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 11:28:10 2015 +0200
Switch to os-testr to control testr
It's a nice wrapper spinned out recently from tempest-lib that should
cover all our needs that we currently fulfill with pretty\_tox.sh.
Change-Id: I2268ed45ab628fe5dcab657d6287594847ab587c
commit da42745c466c14e6dbe58cdbc830ae5d1c8bb114
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Tue Jun 9 16:08:50 2015 +0000
Introduce functions using arping executable
The arpinger is gonna be used in the next changeset introducing
connection testers.
Change-Id: I90ae32c2f52f1debfb11ae2a08b2828ee2be04cc
commit 328b72cf8c5f514434de0b73c9137bde52b5eeea
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Wed Jun 10 07:04:25 2015 +0000
Revert "Defer segment lookup in NetworkContext object"
This reverts commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0.
This patch likely violated the idea of a NetworkContext
being a snapshot of the network at the time it was created.
This needs a different approach.
Change-Id: I20b132a0181d35b0517330fb7fbf293c3e979d0e
commit e33d92c894df4664d01d040ba4305c7cb4ef6e27
Author: Fawad Khaliq <fawad@plumgrid.com>
Date: Tue Jun 9 22:18:18 2015 -0700
Added networking-plumgrid in plugin requirements
Closes-Bug: 1463665
Change-Id: I7152dedd83659ee51274be31ef305af9e82d695a
commit f08e9f1f53efa97e07f21ca72a940fcbeb4570e5
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Wed May 20 01:03:59 2015 +0000
Switch from MySQL-python to PyMySQL
As discussed in the Liberty Design Summit "Moving apps to Python 3"
cross-project workshop, the way forward in the near future is to
switch to the pure-python PyMySQL library as a default.
https://etherpad.openstack.org/p/liberty-cross-project-python3
Change-Id: I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
commit 6886655b491aede40aa9f4a0bd4c6d402d5a7a78
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Apr 28 04:59:35 2015 -0700
Context: Remove logic for read\_deleted and deprecate it
The read\_deleted parameter in the Context object is simply unused.
This patch removes associated logic, and for what is worth, adds
deprecation warnings against explicit usage of read\_deleted when
creating a context instance, generate an admin context, and
elevating a context instance.
Change-Id: Ic69d22dc229ebe8fac1f6be0c4860d19732505b1
Closes-Bug: #1449462
commit 303f37f4e0c84f90e40b95731a828fc6ce8a0bbf
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 16:09:49 2015 +0000
Python 3: use next() instead of iterator.next()
The latter only works in Python 2.
Also define a \_\_next\_\_ method in the classes that define a next method.
Change-Id: Iaa1a1e500facab50d8bcdffda39ccad3f2e4e9bb
Blueprint: neutron-python3
commit 9143ce10e422bd17c4817dfe08163879e0e5a4ca
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 12:12:52 2015 +0200
Consume oslo.policy
Some non intrusive changes to tests are needed, so that we don't rely on
library symbols that are now private (f.e. parse\_rule).
Closes-Bug: #1458945
Change-Id: I90326479e908042fec9ecb25fa19a8dd5b15e7d8
commit 66fece4f84e62f14fb59a721b37986784976d0c4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 14:03:52 2015 +0200
policy: cleanup deprecation code to handle old extension:xxx rules
It served and warned users for enough time (since Icehouse) to be sure
everyone was notified about the need to update their policy file.
Change-Id: I240b935741e49fbf65c0b95715af04af4b2a73e7
commit 53ec63c430d123cd1ed4acd3b94537e9cb380bcd
Author: Romil Gupta <romilg@hp.com>
Date: Thu Jun 4 04:21:14 2015 -0700
Fix a regression in "Separate ovs-ofctl using code as a driver" change
The tunnels are not getting established between Network Node and
Compute Nodes in non DVR mode with l2pop enabled and throws
the AttributeError: add\_tunnel\_port.
This fixes a regression in change Ie1224f8a1c17268cd7d1c474ed82fdfb8852eaa8.
Co-Authored-By: YAMAMOTO Takashi <yamamoto@midokura.com>
Closes-Bug: #1461486
Change-Id: I1106fd3dd32f6f827eb25dec4815ff1120af96f0
commit 753196480d9cca10c5b91dfa8221e89f658fa110
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed May 27 13:54:06 2015 +0000
Break Pinger class to functions
As the class served only for storing parameters that can be passed as
actual function parameters, there is no reason for class.
Change-Id: I553b4d6daeb78d495cda09894582a3d885b5d1b5
commit 6d0d72973152bb45587437c80d4ffe0fe7bba761
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Tue Apr 7 14:58:13 2015 +0300
Handle SIGHUP: neutron-server (multiprocess) and metadata agent
All launchers implemented in common.service require each service to
implement reset method because it is called in case a process
receives a SIGHUP.
This change adds the reset method to neutron.service.RpcWorker and
neutron.wsgi.WorkerService which are used to wrap rpc and api
workers correspondingly.
Now neutron-server running in multiprocess mode (api\_workers > 0 and
rpc\_workers > 0) and metadata agent don't die on receiving SIGHUP and support
reloading policy\_path and logging options in config.
Note that reset is called only in case a service is running in daemon mode.
Other changes made in the scope of this patch that need to be mentioned:
\* Don't empty self.\_servers list in RpcWorker's stop method
When a service is restarted all services are gracefully shutdowned,
resetted and started again (see openstack.common.service code).
As graceful shutdown implies calling service.stop() and then
service.wait() we don't want to clean self.\_servers list because
it would be impossible to wait for them to stop processing
requests and cleaning up their resources.
Otherwise, this would lead to problems with rpc after starting
the rpc server again.
\* Create a duplicate socket each time WorkerService starts
When api worker is stopped it kills the eventlet wsgi server
which internally closes the wsgi server socket object. This server
socket object becomes not usable which leads to "Bad file
descriptor" errors on service restart.
Added functional and unit tests.
DocImpact
Partial-Bug: #1276694
Change-Id: I75b00946b7cae891c6eb192e853118e7d49e4a24
commit ea35b299f06050608f3e7bb6fbc880006ed31024
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 18:25:14 2015 -0700
Allow update\_port\_status to take network param
Allow the update\_port\_status function to take a network as
an optional parameter to skip calling get\_network again if
the caller has already done so.
Closes-Bug: #1463656
Change-Id: I994f3abdb1b0ad3b2766f409b206ad4a8b2309b6
commit d0be7bc57f573d5696108b571c731decfbde9f0b
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 12:46:54 2015 +0200
Make pep8 job succeed when /etc/neutron/neutron.conf is not installed
Currently, if /etc/neutron/neutron.conf is not installed in the system,
neutron-db-manage fails in oslo.config code when trying to determine the
default configuration file to use.
Test job should not rely on any contents inside /etc/.
Instead, pass --config-file with test-only configuration explicitly into
the utility.
neutron.conf.test was renamed into neutron.conf since for some reason
oslo.config does not support a name that does not have .conf at its
filename end.
Change-Id: I719829fc83a7b20a49c338aaf1dbef916dcc768c
commit 826428dc8aeef124c2251624ae34fdc003e69ca4
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Tue Jun 9 19:00:40 2015 +0900
Add a comment on \_check\_update\_has\_security\_groups
Despite of its name, \_check\_update\_has\_security\_groups can
handle create requests as well. There are plugins actually
using it for create. eg. ml2, vmware
Change-Id: I3c26ad0ac00b12ce24096bfc27606797af2d9098
commit 6b13cc5275df53c765c450d570521c425c3345d9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 10:57:29 2015 +0200
Enable all deprecation warnings for test runs
We would like to catch all deprecation warnings during test runs to be
notified in advance about potential problems with next library releases
we depend on.
Change-Id: I876d8c4de88618b01898ab537a44920789d8178e
commit 734e77365b0f241a3cea0f3c9dfb1d5fcf6eac8c
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Apr 17 15:00:20 2015 -0700
Remove get\_admin\_roles and associated logic
get\_admin\_roles was introduced so that contextes generated from
within plugins could be used for policy checks. This was the case
up to the Havana release as several plugins invoked the policy
engine directly to authorize requests.
This was an incorrect behaviour and has now been fixed, meaning
that get\_admin\_roles is no longer need and can be safely removed.
This will result in a leaner and more reliable codebase. Indeed the
function being removed here was the cause of several bugs where the
policy engine was initialized too early in the server bootstrap
process.
While this patch removes the feature it does not remove the
load\_admin\_roles parameter from context.get\_admin\_context. Doing so
will break other projects such as neutron-lbaas. The parameter is
deprecated by this patch and an appropriate warning emitted.
As a consequence neutron's will now no longer perform policy checks
when context.is\_admin=True. This flag is instead set either when
a context is explicitly created for granting admin privileges, or
when Neutron is operating in noauth mode. In the latter case every
request is treated by neutron as an admin request, and get\_admin\_roles
is simply ensuring the appropriate roles get pushed into the context
so that the policy engine will grant admin rights to the request.
This behaviour is probably just a waste of resource; also it is not
adding anything from a security perspective.
On the other hand not performing checks when context.is\_admin is
True should not pose a security threat either in noauth mode or
with the keystone middleware. In the former case the software keeps
operating assuming admin rights for every requests, whereas in the
latter case the keystone middleware will always supply a context
with the appropriate roles, and there is no way for an attacker
to trick keystonemiddleware into generating a context for which
is\_admin=True.
Finally, this patch also does some non-trivial changes in test\_l3.py
as some tests were mocking context.to\_dict ignoring the is\_admin flag.
Closes-Bug: #1446021
Change-Id: I8a5c02712a0b43f3e36a4f14620ebbd73fbfb03f
commit 89c0875178f22651109a85d3c522d80324368caf
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon Jun 8 14:27:47 2015 +0300
Add documentations for VXLAN Tunnels
The VXLAN type driver is currently supported, this patch add
description and links for more information to the user.
Change-Id: Idb221ca4cce1a3a27bebe5ae6fc1e6ab5d030836
commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 19:03:29 2015 -0700
Defer segment lookup in NetworkContext object
Avoid call to get network segments for network context objects until
a caller actually tries to lookup the segments. This optimizes cases
where the user of a port context never looks at the segments of the
associated network context (e.g. update\_port\_status).
Closes-Bug: #1463254
Change-Id: I7e95f81d9a3ef26ccdb18c6bfdf9adc29523aa79
commit d0bbfc090bb25f1e05b98f0ad70c18209b87ed6b
Author: Zhenguo Niu <niuzhenguo@huawei.com>
Date: Tue Jun 9 08:28:45 2015 +0800
Fix typos in docs
Change-Id: I71aeb8f1e5fc5f3e330e593a463858dd65e6093b
commit b322ebae09cc59ed0a860ea6e39ed9b6fa6c5c12
Author: yuyangbj <yangyu@vmware.com>
Date: Wed May 13 14:07:36 2015 +0800
Fixes bulk insertion of data to ml2\_port\_binding
We should use schema definition to insert bulk of data to table.
Closes-Bug: #1454566
Change-Id: I66b3ee8c2f9fa6f04b9e89dc49d1a3d277d63191
commit 3a5a8a62c372f3a516caa59fd655dcf923a82519
Author: Kyle Mestery <mestery@mestery.com>
Date: Mon Jun 8 15:27:23 2015 +0000
Add Neutron PTL Office Hours
To ensure a weekly oppurtunity to sync between the PTL and the
Lieutenants, officially setup Neutron PTL Office Hours.
Depends-On: Ia5c8090e90939097104cb95c0aa3b883f7b4dd9b
Change-Id: Iab3c21764937ebb3a1d0553b3a3d42b5c44bf3cc
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 00899b56213753d523842f29d50353a067df6064
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 14:42:18 2015 +0000
Python3: Enable all working tests in tox.ini
Thanks to the recent Python3-related changes, these tests can now be run on
Python 3.
Change-Id: I7f689e221e59128012d46da2c90e61d5206fe828
Blueprint: neutron-python3
commit 725543684cbe0df0edc4b6924f85e63e1628fa92
Author: rossella <rsblendido@suse.com>
Date: Thu Mar 5 09:24:10 2015 +0000
Add get\_events to OVSDB monitor
OVSDB monitor can generate the events that the OVS agent
needs to process (device added or updated). Instead of
notifying only that a change occurred and that polling
is needed, pass the events to the agent
Change-Id: I3d17bf995ad4508c4c6d089de550148da1465fa1
Partially-Implements: blueprint restructure-l2-agent
commit b239f75644bfdfec86f8a8efdabd6b11b766e822
Author: shihanzhang <shihanzhang@huawei.com>
Date: Tue May 26 16:42:44 2015 +0800
Update ipset members when corresponding sg member is empty
if a security group has a rule with 'remote-group-id', the ports
in this security group should update its relevant ipset member
when the remote-group members is empty.
Change-Id: I980ebfd8f6537f803d9d5cbf21ca33f727fea3b3
Closes-bug: #1458786
commit 127de06c7e09e1468f2855a3033fb6193a6b9365
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 6 22:40:39 2015 +0200
Clean only floating-ip related connection states
Currently init\_l3 deletes connection states related to ALL ips deleted
in init\_l3 but it's required only when floating-ips are deleted[1].
This change deletes only connection states related to floating-ips
deleted in init\_l3 ... it avoids to delete connection states in dhcp
agents and on router internal ports!
[1] look at change Ia9bd7ae243a0859dcb97e2fa939f7d16f9c2456c
Closes-Bug: #1452434
Related-Bug: #1334926
Change-Id: Icfcfc585df6fd41de1e1345fd731e4631a6950ce
commit 713ba0e8d7ce59eaff41518360530b2e7831c322
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Thu Jun 4 22:25:44 2015 +0000
Refactor awkward logic in setup\_dhcp\_port
I noticed this logic as I was reviewing another patch set [1]. I
didn't like removing subnet ids from dhcp\_enabled\_subnet\_ids and I
wasn't too keen on the ips\_need\_removal semantics that were kind of
forced by the existing structure of the code. I hope you find this
alternative much clearer. I like straight-forward code with less
indentation that doesn't use awkward booleans like ips\_needs\_removal.
[1] https://review.openstack.org/#/c/157697/6
Change-Id: I8bd3d6924a855ea08f8096e66bd3bfbb165a4da3
commit 45b28ddfe8ac23871e65feb4132d5f048c783222
Author: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
Date: Fri Jun 5 13:05:48 2015 +0200
Fix typo in test class name
Make "Redering" -> "Rendering"
Change-Id: Ieedb446fa1e06705eb70293d83350d4dfd57d2db
Signed-off-by: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
commit 359b7c971a88f6dff64e8e4d558210a880f3ee0f
Author: Ian Wienand <iwienand@redhat.com>
Date: Thu May 7 14:59:38 2015 +1000
Ensure netfilter is enabled for bridges
Since security-groups use iptables rules on Linux bridges, we need to
ensure that netfilter is enabled for bridges. Unfortunately, there
seems to be a long history of distributions having differing defaults
for this, best described in [1].
It seems at the moment everyone has to discover this for themselves;
packstack found it in Ia8c86dcb31810a8d6b133a161388604fde9bead4, then
fuel found the same thing in I8582c24706c3a7253e00569eef275f116d765bca
and then finally someone else hit it and put it into documentation
with I4ed3cec03a1b3a7d56dfe18394154ec1b2db6791. I just spent a long
time figuring it out too when deploying with devstack.
Rather than having yet another fix in devstack, I don't see why
neutron shouldn't be ensuring the setting is correct when it starts up
-- without these settings enabled, security-groups are silently
broken. This does that, and modifies test-cases to check we make the
calls.
[1] http://wiki.libvirt.org/page/Net.bridge-nf-call\_and\_sysctl.conf
Change-Id: If2d316eb8c422dc1e4f34b17a50b93dd72993a99
commit 3682e3391f188845d0c7f382f0ccd4b38db3904e
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon May 4 23:36:19 2015 +0200
Ensure non-overlapping cidrs in subnetpools without galera
\_get\_allocated\_cidrs[1] locks only allocated subnets in a subnetpool
(with mysql/postgresql at least). It ensures we don't allocate a cidr
overlapping with existent cidrs but nothing disallows a concurrent
subnet allocation to create a subnet in the same subnetpool.
This change replaces the lock on subnetpool subnets by a lock on the
subnetpool itself. It disallows to allocate concurrently 2 subnets in
the same subnetpool and ensure non-overlapping cidrs in the same
subnetpool.
Moreover this change solves a trouble with postgresql which disallows
to lock an empty select with an outer join: it happens on first subnet
allocation in a subnetpool when no specific cidr is provided. Moving
the lock ensures the lock is done on a non-empty select.
But this change does not ensure non-overlapping cidrs in subnetpools
with galera because galera doesn't support SELECT FOR UPDATE locks. A
follow-up change will (try to?) remove locks from subnet allocation[1]
in order to ensure non-overlapping cidrs in subnetpools also with galera.
[1] in neutron.ipam.subnet\_alloc.SubnetAllocator
Closes-Bug: #1451558
Partial-Bug: #1451576
Change-Id: I73854f9863f44621ae0d89c5dc4893ccc16d07e4
commit 3d2543d710c7071ffeb5c9857ac30a4d95695a7b
Author: dql <duquanglong@gmail.com>
Date: Mon Mar 9 12:52:11 2015 +0800
fix DHCP port changed when dhcp-agent restart
When DHCP server is started, the periodic task is running
before loading cache state.The method port\_update\_end
need to use the cache information, but the cache information
has not been loaded.
Change-Id: I0d1da11bb559b7f0f9d4428b82573fb26916a933
Closes-Bug: #1420042
commit 6d15bf48ee27ceab64e88f81ba6433058313759a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 9 00:52:29 2015 +0200
Remove from BridgeDevice homemade execute in namespace
Currently BridgeDevice[1] defines homemade execute with namespace
support but could use IPWrapper. This change replaces homemade
implementation with IPWrapper use to respect DRY principle.
[1] neutron.agent.linux.bridge\_lib
Change-Id: I12d4d40432e57ce8b6960276c41321c1efd98705
commit 7260e0e3fc2ea479e80e0962624aca7fd38a1f60
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Apr 27 09:59:21 2015 -0400
Run radvd as root
During the refactoring of external process management radvd lost
its root privileges.
Closes-bug: 1448813
Change-Id: I84883fe81684afafac9b024282a03f447c8f825a
(cherry picked from commit a5e54338770fc074e01fa88dbf909ee1af1b66b2)
commit 4e71c48bbfd5e8b8c59f0c45ade52ba8eddc8b63
Author: rossella <rsblendido@suse.com>
Date: Thu Jan 15 16:15:23 2015 +0100
Add devices to update in RPC call security\_groups\_provider\_updated
When a security\_groups\_provider\_updated is received then a global
refresh of the firewall is performed. This can be avoided if the
plugins pass as parameter of the call the devices that belongs to
the network updated.
Partially-Implements: blueprint restructure-l2-agent
Change-Id: I1e78f3a5ec7e5c5bcba338a0097566422411ef7e
commit d37e566dcadf8a540eb5f84b668847fa192393a1
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Apr 24 00:35:31 2015 -0700
Don't resync on DHCP agent setup failure
There are various cases where the DHCP agent will try to
create a DHCP port for a network and there will be a failure.
This has primarily been caused by a lack of available IP addresses
in the allocation pool. Trying to fix all availability corner cases
on the server side will be very difficult due to race conditions between
multiple ports being created, the dhcp\_agents\_per\_network parameter, etc.
This patch just stops the resync attempt on the agent side if a failure
is caused by an IP address generation problem. Future updates to the subnet
will cause another attempt so if the tenant does fix the issue they will
get DHCP service.
Change-Id: I0896730126d6dca13fe9284b4d812cfb081b6218
Closes-Bug: #1447883
(cherry picked from commit db9ac7e0110a0c2ef1b65213317ee8b7f1053ddc)
commit 38211ae67cb76ade85b08c028b6e88bfc867afc9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Apr 20 17:06:38 2015 +0200
tests: confirm that \_output\_hosts\_file does not log too often
I3ad7864eeb2f959549ed356a1e34fa18804395cc didn't include any regression unit
tests to validate that the method won't ever log too often again,
reintroducing performance drop in later patches. It didn't play well
with stable backports of the fix, where context was lost when doing the
backport, that left the bug unfixed in stable/juno even though the patch
was merged there [1].
The patch adds an explicit note in the code that suggests not to add new
log messages inside the loop to avoid regression, and a unit test was
added to capture it.
Once the test is merged in master, it will be proposed for stable/juno
inclusion, with additional changes that would fix the regression again.
Related-Bug: #1414218
Change-Id: I5d43021932d6a994638c348eda277dd8337cf041
(cherry picked from commit 3b74095a935f6d2027e6bf04cc4aa21f8a1b46f2)
commit 53b3e751f3c7b32bed48c14742d3dd3a1178d00d
Author: Maru Newby <marun@redhat.com>
Date: Thu Apr 9 17:00:57 2015 +0000
Double functional testing timeout to 180s
The increase in ovs testing is resulting in job failure due to
timeouts in test\_killed\_monitor\_respawns. Giving the test more
time to complete should reduce the failure rate.
Change-Id: I2ba9b1eb388bfbbebbd6b0f3edb6d5a5ae0bfead
Closes-Bug: #1442272
(cherry picked from commit 81098620c298394e1a98127ceeba7f297db2d906)
commit 0536ec113bc438265ba547bb8a8006aa96e646e3
Author: watanabe.isao <zou.yun@jp.fujitsu.com>
Date: Wed Apr 15 15:48:08 2015 +0900
Restrict subnet create/update to avoid DHCP resync
As we know, IPs in subnet CIDR are used for
1) Broadcast port
2) Gateway port
3) DHCP port if enable\_dhcp is True, or update to True
4) Others go into allocation\_pools
Above 1) to 3) are created by default, which means if CIDR doesn't
have that much of IPs, subnet create/update will cause a DHCP resync.
This fix is to add some restricts to the issue:
A) When subnet create, if enable\_dhcp is True, /31 and /32
cidrs are forbidden for IPv4 subnets while /127 and /128 cidrs are
forbidden for IPv6 subnets.
B) When subnet update, if enable\_dhcp is changing to True and there are no
more IPs in allocation\_pools, the request should be denied.
Change-Id: I2e4a4d5841b9ad908f02b7d0795cba07596c023d
Co-authored-by: Andrew Boik <dboik@cisco.com>
Closes-Bug: #1443798
(cherry picked from commit 0c1f96ad5a6606c1205bd50ea944c3a383892cde)
commit cbfb3e487d97998ec49d7faa751bc26202da7d0e
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Apr 20 22:26:22 2015 -0700
Only update MTU in update code for MTU
The ML2 create\_network\_db was re-passing in the entire network
with extensions like vlan\_transparency present that was causing
issues in the base update function it was calling.
This corrects the behavior by having it only update the MTU, which
is the only thing it was intending to update in the first place.
Change-Id: I723c5c138e0830de98f6024c7635ec65065e9346
Closes-Bug: #1446784
(cherry picked from commit f85de393c469d1e649a1c1e5ee1b683246442351)
commit 9bc812e92fb27b297ccfe960267dcab173aea6c9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Apr 23 02:15:06 2015 +0000
Updated from global requirements
Change-Id: I514c65fac38ef0e534e7401a5f3643b1906adea7
commit 407be289360ec6dabbbe14d9b18dae7c9fa2db79
Author: Kawaguchi <ken-kawaguchi@vt.jp.nec.com>
Date: Tue Apr 21 13:27:52 2015 +0900
Fix typo acomplished => accomplished
Change-Id: I73722e9984917a5a8c4e74207cf14d4040a7cf2f
Related-Bug: #1390035
commit b339391bcb223c0f03d30f36dea47d13adb12c71
Author: mathieu-rohon <mathieu.rohon@gmail.com>
Date: Sat Mar 7 13:30:49 2015 +0100
ML2: Change port status only when it's bound to the host
Currently, nothing prevents the port status to be changed to BUILD
state when get\_device\_details() is sent by a host that doesn't own
the port.
In some cases the port might stay in BUILD state.
This could happen during a live-migration, or for multi-hosted ports
such as HA ports.
This commit allows the port status modification only if the port
is bound to the host that is asking for it.
Closes-Bug: #1439857
Closes-Bug: #1438040
Closes-Bug: #1416933
Change-Id: I9b3673f453abbafaaa4f78542fcfebe8dc93f2bb
(cherry picked from commit 9b53b82ce7dad551ebc0f02ff667d5345fb7e139)
commit f7ae3a04b541767c638fc4c8ff1e0db78ab94996
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:07:37 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Change-Id: I1b7bd1773bcd12ab282e77ee0dc41c27846fb66b
commit e2f6902315de76a1020aa87ea161c8fdc6697ed7
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Tue Apr 14 21:34:33 2015 -0700
Fixes race condition and boosts the scheduling performance
This patch fixes a race-condition that occurs when the
scheduler tries to check for dvr serviceable ports before
it schedules a router when a subnet is associated with
a router.
Sometimes the dhcp port creation is delayed and so the
router is not scheduled to the l3-agent.
Also it boosts the scheduling performance on dvr-snat
node for scheduling a router.
This patch will provide a work around to fix this race
condition and to boost the scheduling performance
by scheduling a router on a dvr-snat when
dhcp is enabled on the provided subnet, instead of checking
all the available ports on the subnet.
Closes-Bug: #1442494
Change-Id: I089fefdd8535bdc9ed90b3230438ab0bfb6aab4f
(cherry picked from commit c65d3ab6ad4589e6e4a6b488d2eb5d1e4cfee138)
commit a6b2c22dcea73754dbfd0ef39c60ad28ab2dbb73
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Mar 30 23:52:56 2015 -0700
Set IPset hash type to 'net' instead of 'ip'
The previous hash type was 'ip' and this caused a major
issue with the allowed address pairs extension since it
results in CIDRs being passed to ipset. When the hash type
is 'ip', a CIDR is completely enumerated into all of its
addresses so 10.100.0.0/16 results in ~65k entries. This
meant a single allowed\_address\_pairs entry could easily
exhaust an entire set.
This patch changes the hash type to 'net', which is designed
to handle a CIDRs as a single entry.
This patch also changes the names of the ipsets because
creating an ipset with different parameters will cause an
error and our ipset manager code isn't robust enough to handle
that at this time. There is another ongoing patch to fix
that but it won't be ready in time.[1]
The related bug was closed by increasing the set limit, which
did alleviate the problem. However, this change would also
address the issue because the gate tests run an allowed address
pairs extension test with the CIDR mentioned above.
1. I59e2e1c090cb95ee1bd14dbb53b6ff2c5e2713fd
Related-Bug: #1439817
Closes-Bug: #1444397
Change-Id: I8177699b157cd3eac46e2f481f47b5d966c49b07
(cherry picked from commit a38b5df5cd3c47672705aad4c30e789ae11ec958)
commit 8b8095e43a143426c501669167490d7867a55749
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Mar 31 08:53:56 2015 -0700
Revert "Add ipset element and hashsize tunables"
This reverts commit b5b919a7a3569ccb93c3d7d523c1edfaeddb7cb9.
The current ipset manager code isn't robust enough to handle
ipsets that already exist with different parameters. This reverts
the ability to change the parameters so we don't break upgrades
to Kilo.
Conflicts:
neutron/agent/linux/ipset\_manager.py
neutron/tests/unit/agent/linux/test\_ipset\_manager.py
Change-Id: I538714df52424f0502cb75daea310517d1142c42
Closes-Bug: #1444201
(cherry picked from commit 03be14a569d240865dabff8b4c30385abf1dbe62)
commit 2add4e5ad4d12c817737d04ddb973b3aeeb25af3
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Apr 16 16:27:38 2015 -0700
Update .gitreview to point to stable/kilo
This is the stable/kilo branch. When people make changes
here it's highly likely that they want to propose them
to stable/kilo on gerrit.
Change-Id: Ie61a9f0c0b0b4896da33a201e42b1c4bc4bae49b
commit ffc48f286e1756302d9259dc514dd562d3c251ba
Author: Henry Gessau <gessau@cisco.com>
Date: Thu Apr 16 13:38:46 2015 -0400
Add Kilo release milestone
Change-Id: Id7d969c92b7c757b766760681357ac13c8079ca3
commit 1dc98e414f200a78a6b1dc78f222c588646e6935
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Thu Apr 9 10:32:33 2015 -0400
IPv6 SLAAC subnet create should update ports on net
If ports are first created on a network, and then an IPv6 SLAAC
or DHCPv6-stateless subnet is created on that network, then the
ports created prior to the subnet create are not getting
automatically updated (associated) with addresses for the
SLAAC/DHCPv6-stateless subnet, as required.
Change-Id: I88d04a13ce5b8ed4c88eac734e589e8a90e986a0
Closes-Bug: 1427474
Closes-Bug: 1441382
Closes-Bug: 1440183
(cherry picked from commit bd1044ba0e9d7d0f4752c891ac340b115f0019c4)
commit 55536a4ecb6c71e5451b8a9664d87e32146f071d
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Apr 10 15:07:33 2015 +0200
Removed ml2\_conf\_odl.ini config file
The file is already packaged into decomposed networking-odl repo [1].
[1]: https://git.openstack.org/cgit/stackforge/networking-odl/tree/etc/neutron/plugins/ml2/ml2\_conf\_odl.ini
Closes-Bug: #1442615
Change-Id: Ic280454190aab4e3b881cde15a882808b652861e
(cherry picked from commit b3334eca0ae9f9c64ccd646035e69081f669e3e4)
commit 40783cee5e520173a4cc37c23dd97be2d37b65fd
Author: Angus Lees <gus@inodes.org>
Date: Mon Mar 2 17:06:54 2015 +1100
Ensure tests run under python2.7
tox uses whatever python version that tox ran with as the default python
version for environments (py27,py3x, etc are given a more specific
default).
Debian's python-tox (for example) uses python3, but we require python2.7
- and a naive `apt-get install python-tox; tox -epep8` fails with
py3-related errors on Debian.
This change explicitly sets `basepython = python2.7` in several testing
environments that would otherwise have used the default basepython.
Change-Id: I377ac6d72dec5b85c105d8a1a74f6974efb84dcf

| **tags**: | added: in-feature-qos |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-29:  [**Related fix proposed to neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/75) |  |  | [#75](/neutron/%2Bbug/1461054/comments/75) |
| --- | --- | --- | --- |

Related fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/196701>

Related fix proposed to branch: feature/pecan
Review: https://review.openstack.org/196701

[Vladimir Kuklin (vkuklin)](https://launchpad.net/~vkuklin)
on 2015-06-29

| **tags**: | added: 6.1-mu-1 |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-30:  [**Change abandoned on neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/76) |  |  | [#76](/neutron/%2Bbug/1461054/comments/76) |
| --- | --- | --- | --- |

Change abandoned by Kyle Mestery (<email address hidden>) on branch: feature/pecan

Review: <https://review.openstack.org/196701>

Reason: This is lacking the functional fix [1], so I'll propose a new merge commit which includes that one.

[1] <https://review.openstack.org/#/c/196711/>

Change abandoned by Kyle Mestery (mestery@mestery.com) on branch: feature/pecan
Review: https://review.openstack.org/196701
Reason: This is lacking the functional fix [1], so I'll propose a new merge commit which includes that one.
[1] https://review.openstack.org/#/c/196711/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-30:  [**Related fix proposed to neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/77) |  |  | [#77](/neutron/%2Bbug/1461054/comments/77) |
| --- | --- | --- | --- |

Related fix proposed to branch: feature/pecan

Review: <https://review.openstack.org/196920>

Related fix proposed to branch: feature/pecan
Review: https://review.openstack.org/196920

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-06-30:  [**Related fix merged to neutron (feature/pecan)**](/neutron/%2Bbug/1461054/comments/78) |  |  | [#78](/neutron/%2Bbug/1461054/comments/78) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/neutron/%2Bbug/1461054/comments/78/%2Bdownload) (171.5 KiB)

Reviewed: <https://review.openstack.org/196920>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=7f759c077f8f860c13db92d2ea6b353ef6b70900>

Submitter: Jenkins

Branch: feature/pecan

commit 8123144fadd7c5d5e6e56a76ea860512619a2cf6

Author: Moshe Levi <email address hidden>

Date: Sun Jun 28 14:37:14 2015 +0300

Fix Consolidate sriov agent and driver code

This patch add mising \_\_init to mech\_sriov/mech\_driver/

    and update the setup.cfg to the new agent entrypoint

Trivial Fix

Change-Id: I53a527081feb78472f496675bbb3c5121d38a14a

commit 8942fccf02e6e179d47582fdb2792a1ca972da21

Author: Assaf Muller <email address hidden>

Date: Mon Jun 29 11:38:51 2015 -0400

Remove failing SafeFixture tests

The fixtures 1.3 release attempted to fix the fixtures resource

    leak issue, but failed to do so completely. Our own SafeFixture

    is still needed: The 1.3 release broke our SafeFixture tests,

    but not the usage of SafeFixture itself. This patch removes

    those failing tests for now to unbreak the gate. Jakub reported

    a bug on fixtures 1.3:

    [https://bugs.launchpad.net/python-fixtures/+bug/1469759](https://bugs.launchpad.net/python-fixtures/%2Bbug/1469759)

We will continue to use SafeFixture until that bug is fixed

    in fixtures, at which point we will be able to require

    fixtures > 1.3.

Change-Id: I59457c3bb198ff86d5ad55a1e623d008f0034b8f

    Closes-Bug: #1469734

commit 71dffb0a2c1720cd8233a329d32958a0160dd6f5

Author: Kevin Benton <email address hidden>

Date: Mon Jun 29 08:27:41 2015 +0000

Revert "Removed test\_lib module"

This reverts commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f.

We pulled all of the plugins out of the tree, many of which still inherit

    from neutron test classes. This change then stated that we no longer

    support testing other plugins. I think this is a bit premature and should

    have been discussed under the subject

    "Neutron plugins can't use neutron plugin unit tests" or something

    similar.

Change-Id: I68318589f010b731574ea3bfa8df98492bab31fc

commit b20fd81dbd497e058384a0af065dd0f1fdc4c728

Author: Jakub Libosvar <email address hidden>

Date: Fri Jun 5 14:32:51 2015 +0000

Refactor NetcatTester class

Following capabilities were added:

       - used transport protocol is passed as a constant instead of bool

       - src port for testing was added

       - connection can be established explicitly

       - change constructor parameters of NetcatTester

As a part of removing bool for protocol definition

    get\_free\_namespace\_port() was also modified to match the behavior.

Change-Id: Id2ec322e7f731c05a3754a65411c9a5d8b258126

commit 83e37980dcd0b2bad6d64dd2cb23bcd2891cafca

Author: jingliuqing <email address hidden>

Date: Sat Jun 27 13:41:54 2015 +0800

Use REST rather than ReST

Change-Id: I06c9deaab58c5ec13bfeec39fb8fd4b1fe21f42d

commit 1b60df85ba3ad442c2e4e7e52538e1b9a1bf9378

Author: Kevin Benton <email address hidden>

Date: Thu Jun 25 18:34:38 2015 -0700

Add a double-mock guard to the base test case

Use mock to patch mock with a check to prevent multiple active

    patches to the...

Reviewed: https://review.openstack.org/196920
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=7f759c077f8f860c13db92d2ea6b353ef6b70900
Submitter: Jenkins
Branch: feature/pecan
commit 8123144fadd7c5d5e6e56a76ea860512619a2cf6
Author: Moshe Levi <moshele@mellanox.com>
Date: Sun Jun 28 14:37:14 2015 +0300
Fix Consolidate sriov agent and driver code
This patch add mising \_\_init to mech\_sriov/mech\_driver/
and update the setup.cfg to the new agent entrypoint
Trivial Fix
Change-Id: I53a527081feb78472f496675bbb3c5121d38a14a
commit 8942fccf02e6e179d47582fdb2792a1ca972da21
Author: Assaf Muller <amuller@redhat.com>
Date: Mon Jun 29 11:38:51 2015 -0400
Remove failing SafeFixture tests
The fixtures 1.3 release attempted to fix the fixtures resource
leak issue, but failed to do so completely. Our own SafeFixture
is still needed: The 1.3 release broke our SafeFixture tests,
but not the usage of SafeFixture itself. This patch removes
those failing tests for now to unbreak the gate. Jakub reported
a bug on fixtures 1.3:
https://bugs.launchpad.net/python-fixtures/+bug/1469759
We will continue to use SafeFixture until that bug is fixed
in fixtures, at which point we will be able to require
fixtures > 1.3.
Change-Id: I59457c3bb198ff86d5ad55a1e623d008f0034b8f
Closes-Bug: #1469734
commit 71dffb0a2c1720cd8233a329d32958a0160dd6f5
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Mon Jun 29 08:27:41 2015 +0000
Revert "Removed test\_lib module"
This reverts commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f.
We pulled all of the plugins out of the tree, many of which still inherit
from neutron test classes. This change then stated that we no longer
support testing other plugins. I think this is a bit premature and should
have been discussed under the subject
"Neutron plugins can't use neutron plugin unit tests" or something
similar.
Change-Id: I68318589f010b731574ea3bfa8df98492bab31fc
commit b20fd81dbd497e058384a0af065dd0f1fdc4c728
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Fri Jun 5 14:32:51 2015 +0000
Refactor NetcatTester class
Following capabilities were added:
- used transport protocol is passed as a constant instead of bool
- src port for testing was added
- connection can be established explicitly
- change constructor parameters of NetcatTester
As a part of removing bool for protocol definition
get\_free\_namespace\_port() was also modified to match the behavior.
Change-Id: Id2ec322e7f731c05a3754a65411c9a5d8b258126
commit 83e37980dcd0b2bad6d64dd2cb23bcd2891cafca
Author: jingliuqing <lawrancejing@gmail.com>
Date: Sat Jun 27 13:41:54 2015 +0800
Use REST rather than ReST
Change-Id: I06c9deaab58c5ec13bfeec39fb8fd4b1fe21f42d
commit 1b60df85ba3ad442c2e4e7e52538e1b9a1bf9378
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:34:38 2015 -0700
Add a double-mock guard to the base test case
Use mock to patch mock with a check to prevent multiple active
patches to the same target. Multiple patches to the same target
result in non-deterministic behavior when stopall() tries to
undo the patches.[1]
1. http://bugs.python.org/issue21239
Change-Id: I3dd3d561a0267d80f464c15d69a4258b0a5e8aba
Closes-Bug: #1468998
commit 78700ba70620f7b53b5ae71332cca853f5afa467
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 22:08:41 2015 -0700
Remove duplicated mock patch of ip\_lib
The functional tests for agents were patching ip\_lib in the
function to configure an agent, so any tests that relied on
multiple agents would patch ip\_lib multiple times.
Partial-Bug: #1468998
Change-Id: Ibccf586dea870ec222369c0876f17f8eaf9a1aca
commit f242b171e910da460b8d98182dc10c5840c2c7d0
Author: Kyle Mestery <mestery@mestery.com>
Date: Thu Jun 25 20:36:47 2015 +0000
Consolidate sriov agent and driver code
In preparation for decomposing the built-in reference implementation,
this commits consolidates the sriov agent and driver code into a
coherent place for it's life in the new repository. I've also given
the unit tests a new home.
DocImpact
UpgradeImpact
Partially-Implements: blueprint reference-implementation-split
Partial-Bug: #1468433
Closes-Bug: #1427317
Change-Id: Ic8b5215de76e191030228bc28773cd6535e889d8
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 724c78071da28bae838a4145a9d4cea42f853048
Author: Kyle Mestery <mestery@mestery.com>
Date: Wed Jun 24 19:12:06 2015 +0000
Restructure agent code in preparation for decomp
This commit moves the L2 agents (Linuxbridge and OVS) into the
ML2 directory, while at the same time also moving the ML2 server
bits into toplevel directories. It also moves the configuration
files and unit tests. We also move the l2pop RPC mixin while
here as well.
DocImpact
UpgradeImpact
Partially-Implements: blueprint reference-implementation-split
Partial-Bug: #1468433
Closes-Bug: #1427317
Change-Id: If6feca7b7a6bdd6c3c6feb929fa26fb4b1f72770
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 82fddfbb651911c7cb6818428ff7604c9745499c
Author: sridhargaddam <sridhar.gaddam@enovance.com>
Date: Mon Jun 22 14:13:56 2015 +0000
Fix ip\_lib get\_gateway for default gateway on an iface
Currently get\_gateway() of IpRouteCommand class always assumes
the presence of gateway\_ip when default\_route is seen.
Since we can also have interface routes without the gw\_ip,
this patch fixes the issue by parsing the output accordingly.
Closes-Bug: #1467531
Change-Id: Icf988994b61cbdeb1261c5a0887f29ced41ada07
commit 3c45132f256082252ae8726b560f807686620216
Author: Waldemar Znoinski <waldemar.znoinski@intel.com>
Date: Fri Jun 26 09:28:51 2015 +0000
fixing typo in gerrit query link in third party policies doc
Change-Id: Iaef37a58f85439a1a6c5c1ae071a223865479a8e
commit bd3604277f6a550d8757aa96a3164a189ab3af6d
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 06:50:48 2015 -0700
Use last address in v6 allocation pool generation
This reverts commit 1d61c5f736b9df7253a1939fe55f1875f988d1f4,
which reverted ee51ef72d37a02005a7733b7f2faf7236db850a1 due
to an issue with the allocation pools being mis-aligned with
the last address of a v6 subnet.
IPv6 does not have a subnet broadcast address so the last IP
address can be used as a regular address. This patch tweaks the
automatic allocation pool generation to include that last address
on v6 networks.
This was found because
NetworksTestDHCPv6.test\_dhcp\_stateful\_fixedips\_outrange makes the
assumption that the default generated pools cover the entire usable
address space.
Related-Bug: #1466322
Closes-Bug: #1468163
Change-Id: I5a2518c819757cd1fb43244901fe3e2f6c576b34
commit e120bad02841ed54ed071d82bffc47671f612137
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 25 16:52:08 2015 +0300
Extend SubnetRequestFactory to access subnet dict
SubnetRequestFactory incorporates logic for preparing arguments and
building right request.
Subnet dict, context and subnetpool are used to make decision on
what kind of reqest should be created.
SubnetRequestFactory can be overriden on ipam driver level,
it allows to easily extend existent Request model.
Partially-Implements: blueprint neutron-ipam
Change-Id: I9de120381172657a527bb35990d25525c41939ab
commit ba7d673d1ddd5bfa5aa1be5b26a59e9a8cd78a9f
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:31:38 2015 -0700
Remove duplicated call to setup\_coreplugin
The test case for vlan\_transparent was calling setup\_coreplugin
before calling the super setUp method which already calls
setup\_coreplugin. This was causing duplicate core plugin fixtures
which resulted in patching the dhcp periodic check twice.
Change-Id: Ide4efad42748e799d8e9c815480c8ffa94b27b38
Partial-Bug: #1468998
commit e64062efa3b793f7c4ce4ab9e62918af4f1bfcc9
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:29:37 2015 -0700
Remove double mock of dhcp agent periodic check
The test case for the periodic check was patching a target
that the core plugin fixture already patched out. This removes
that and exposes the mock from the fixture so the test case
can reference it.
Change-Id: I3adee6a875c497e070db4198567b52aa16b81ce8
Partial-Bug: #1468998
commit 25ae0429a713143d42f626dd59ed4514ba25820c
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 18:24:10 2015 -0700
Remove double fanout mock
The test\_mech\_driver was duplicating a fanout mock already setup
in the setUp routine.
Change-Id: I5b88dff13113d55c72241d3d5025791a76672ac2
Partial-Bug: #1468998
commit 993771556332d9b6bbf7eb3f0300cf9d8a2cb464
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 17:55:16 2015 -0700
Remove double callback manager mocks
setup\_test\_registry\_instance() in the base test case class gives
each test its own registry by mocking out the get\_callback\_manager.
The L3 agent test cases were duplicating this.
Partial-Bug: #1468998
Change-Id: I7356daa846524611e9f92365939e8ad15d1e1cd8
commit 0be1efad93734f11cd63fb3b7bd2983442ce1268
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Jun 25 16:57:30 2015 -0700
Remove ensure\_dirs double-patch
test\_spawn\_radvd called mock.patch on ensure\_dirs after the
setup method already patched it out. This causes issues when
mock.patch.stopall() is called because the mocks are stored
as a set and are unwound in a non-deterministic fashion.[1]
So some of the time they will be undone correctly, but others
will leave a monkey-patched in mock, causing the ensure\_dir
test to fail.
1. http://bugs.python.org/issue21239
Closes-Bug: #1467908
Change-Id: I321b5fed71dc73bd19b5099311c6f43640726cd4
commit 6a1f8388d3f0ebd791aa1c466f5310efec5e83cc
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Tue Jun 23 14:01:29 2015 +0300
Decompose \_save\_subnet
Moved allocation pool generation and validation into separate method.
Partially-Implements: blueprint neutron-ipam
Change-Id: Ibe241c7b6389e444145b0600f8fcee28e478bc62
commit 0a2238e34e72c17ca8a75e36b1f56e41a3ece74e
Author: Sukhdev Kapur <sukhdev@aristanetworks.com>
Date: Thu Jun 25 15:11:28 2015 -0700
Fix tenant-id in Arista ML2 driver to support HA router
When HA router is created, the framework creates a network and does
not specify the tenant-id. This casuse Arista ML2 driver to fail.
This patch sets the tenant-id when it is not passed explicitly by
by the network\_create() call from the HA router framework.
Even though original issue was discovered for network\_create()
it turns out the same issue applies for port\_create() as well
so all the methods are fixed in this patch
Change-Id: Id03e26dac003fa589477ed78a4ed3c44cc2f708d
Closes-Bug: 1468828
commit 334d9a33404f4c8438d105f91bff1a9fd9236513
Author: Assaf Muller <amuller@redhat.com>
Date: Thu Jun 25 16:34:09 2015 -0400
Log OVS agent configuration mismatch
Change-Id: I55aef3bdc32dcee3436cb8b987fb796a4898b20e
Closes-Bug: #1468893
commit c48e12b781c9ffd885ebc96283ecda2849fd1e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 21:31:33 2015 +0200
Avoid env variable duplication in tox.ini
Some environment variables are defined multiple times in tox.ini. This
change defines "fake" tox jobs and refactors existing jobs to reduce
duplicated environment variables.
Change-Id: I0ccebea4fbfff8dda34d1ed348b96b3b8ebd59e2
commit 747738d36572079307f228a861a067ca0cd815c2
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 15:20:27 2015 -0700
Skip ARP protection if 0.0.0.0/0 in addr pairs
Don't setup ARP protection on ports with allowed address pairs
that allow them to use any IP address. This is necessary because
OVS doesn't support the /0 prefix in rules that match on ARP headers.
Related-Bug: #1461054
Closes-Bug: #1468009
Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec
commit 61909ac515c337c94f55805641b1b7c725a95191
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:54:34 2015 +0200
linuxbridge: clean up README file
It's weird that we suggest users to copy python files around instead of
relying on generated console\_scripts.
Other configuration information located here is trivial and is
documented elsewhere, f.e. [1].
[1]: http://docs.openstack.org/networking-guide/deploy\_scenario1b.html
Change-Id: Ie8dd37087599ff4b5e23f0ad01105f94f5b886ab
commit 0af5abdb1f608a5e84a64627adf42dd8d5526560
Author: John Davidge <jodavidg@cisco.com>
Date: Thu Jun 25 15:12:59 2015 +0100
Fix tox errors in thirdparty-ci docs
Fixes errors causing tox failures.
Change-Id: I361ef791c0de1aac1304bb8ad979066400930434
Closes-Bug: #1468765
commit 9a6536de6e1a7fe9b2552adc142e254426b82b6f
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 25 15:41:02 2015 +0200
Removed test\_lib module
It's not really needed. It was once used to allow some out-of-tox plugin
specific testing scripts to inject configuration files into
BaseTestCase.
Now, our testing story does not have any notion of out-of-gate plugin
specific testing, so let's just clean it up.
Change-Id: If287a38e80016b1dba049a2b745bad7af40583a8
commit 2557c47668ad822810aad523643014c6a5d4a064
Author: Russell Bryant <rbryant@redhat.com>
Date: Wed Jun 24 14:59:26 2015 -0400
Updated from global requirements
This patch takes the latest global requirements update from change
Ibcb49412a012f79be2f7fd697349ddbf43bd7b9b except takes out the update
to setup.py which reverts the windows specific requirements. We are
still working on getting the custom changes out of setup.py in change
I3c07c279d33f6aed46c3a97dd9ba81251e51429a.
Change-Id: Iee7612d39b520cf04e3b2ec503ec79d23f15f949
commit 4b4cedaf853664535c05d47c99c920e74d1deb3a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu Jun 11 22:12:01 2015 +0200
Define SafeFixture base fixture
Currenty useFixture(myfixture)[1] ensures to call myfixture.cleanUp only
if myfixture.setUp succeed.
This change defines a workaround to ensure cleanUp call even if setUp
fails until testtools/fixtures support it: SafeFixture[2] which ensures
cleanUp call if setUp fails and replaces fixtures.Fixture use by
SafeFixture. This workaround will be removed when the bug will fixed in
testtools and fixtures[3].
[1] testtools.TestCase.useFixture, fixtures.Fixture.useFixture
[2] neutron.tests.tools
[3] see related bugs
Change-Id: I875934e8dde321a450c83fb95d175affd1f3bb83
Closes-Bug: #1464410
Partial-Bug: #1453888
Related-Bug: #1456353
Related-Bug: #1456370
commit 2ecac909ba419f258e47b456196a1af7a87661ed
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu Jun 25 11:59:37 2015 +0000
Remove quantum untracked files from .gitignore
This change removes obsolete quantum untracked files from .gitignore.
Change-Id: I1ddf0b03d29066363f155dd5af8294efde5b0ef0
commit df06a326de39a6792e2e82eafa5cf50eb325b34e
Author: Matthew Booth <mbooth@redhat.com>
Date: Thu Jun 25 10:20:08 2015 +0100
Context class should initialise its own data
This is a trivial cleanup. A superclass was initialising data which
was only used in a subclass.
Change-Id: I6930fdaef3dcb960f6baaedbd191e22b565f319e
commit 2e1b0ea4032f05afef16efd451e2eea5df901d97
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 17:33:38 2015 +0200
ovsdb: attempt to enable connection\_uri for native impl on startup
The port is in most cases disabled, so to use it, we should first enable
it, and it means that we should still rely on ovs-vsctl for that initial
call.
Closes-Bug: #1468259
Change-Id: I097b1c441df1f7f1785b8744f27809617bb21c14
commit 668b12c2c8a60ce20ecdad2193ede9371d5cc391
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:58:41 2015 -0600
Move third-party CI policy under docs/policies
Change-Id: Ib2ed587670f206283d735191b3a2580bf3d1a04f
commit 3bf62772d39d8b3b8b518ae88a6fcea7414d6884
Author: Doug Wiegley <dougw@a10networks.com>
Date: Mon Jun 1 20:31:01 2015 -0600
Remove lbaas API tests, which are now in the lbaas repo
Change-Id: I2009ca3f102d0ca0db3f12af3012989f2a036c48
commit 1a480203b2531925d7520b62c94954064a26139d
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 24 10:28:18 2015 -0700
Only create one netaddr.IPNetwork object
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c663b8ac73
commit d9a23f882f0d78aaca34c3607d9ca9ad54ac063b
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 3 16:19:39 2015 -0700
Provide work around for 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager
which is called to convert the input.
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054
commit 93d564223e8b76d10aa7b55f1b1d49f592d1c800
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 09:19:18 2015 -0700
Fix >80 char lines that pep8 failed to detect
Change-Id: I602e0d484c5e00eb48b86c4c8c4eff0be195c3a5
commit 830e9114817765efc93c772dcbc735a6bb28a7ff
Author: Anthony Chow <vCloudernBeer@gmail.com>
Date: Tue Jun 23 22:05:23 2015 -0700
Deprecate "router\_delete\_namespaces" and "dhcp\_delete\_namespaces"
These 2 configuration options are no longer be necessary.
They are marked as deprecated in this release and will be removed in the
next release.
Change-Id: I4e02a291738b16c7c9b7600f0bc9a47fb1318569
Partial-Bug: #1418079
commit a84ef9ae54a7dfe6d9dee54a01b189dd40bce423
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 03:27:16 2015 -0700
Make DHCPv6 out of bounds API test deterministic
The test\_dhcp\_stateful\_fixedips\_outrange API test was randomly
picking an IP from last + 1 up to last + 10 in the allocation
range. This made it fail randomly when there was an issue related
to the subnet allocation having an off-by-one issue.
This adjusts the test to just always test last +1 and +2.
Related-Bug: #1468163
Change-Id: I641ab092e0ea0aae67ec717b492118a2f8a6f4fd
commit f527f8cf426ee63b592225d5e691ac107085784d
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 24 02:15:29 2015 -0700
Don't process network\_delete events on OVS agent
There is no reason to reclaim the local VLAN on a network\_delete
event since it will be reclaimed when the last port is deleted anyway.
This method was racey with recent port creation events and lead to
occasional traces when it would yank the local VLAN out from underneath
an ongoing port wiring process.
Change-Id: I5eee6175c053006b35b6efe274d27931a9d5d89f
Closes-Bug: #1468251
commit 1d61c5f736b9df7253a1939fe55f1875f988d1f4
Author: Henry Gessau <gessau@cisco.com>
Date: Wed Jun 24 03:16:52 2015 +0000
Revert "Fix subnet creation failure on IPv6 valid gateway"
Because it breaks tests.api.test\_dhcp\_ipv6.NetworksTestDHCPv6.test\_dhcp\_stateful\_fixedips\_outrange
This reverts commit ee51ef72d37a02005a7733b7f2faf7236db850a1.
Change-Id: Id02d9034ca809f194ff7551167bfda3559fb1200
commit 7eb9d9d316d35840706a767576ff083c9a04d781
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 24 00:08:22 2015 +0200
Support oslo\_db 1.12
oslo\_db 1.12[1] decorates oslo\_context.context.RequestContext with
session management[2][3] and add a read-only attribute 'session'. Such
feature breaks Brocade plugin and its unittests because they define
on RequestContext the 'session' attribute which now is a read-only
property. This change uses neutron.context instead of
oslo\_context.context in order to delegate session management to the
neutron.context and remove read-only attribute set.
A follow-up change will refactor neutron.context in order to use oslo\_db
1.12 session management instead of homemade one.
[1] https://github.com/openstack/oslo.db/releases/tag/1.12.0
[2] https://github.com/openstack/oslo.db/commit/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6
[3] https://github.com/openstack/oslo.db/blob/\
fdbd928b1fdf0334e1740e565ab8206fff54eaa6/oslo\_db/sqlalchemy/\
enginefacade.py#L782
Closes-Bug: #1468128
Change-Id: I0e3331f9a383fa2562706eeadb229f55593b888c
commit ad86291408fc74827c2bd31f89a2dce34f887823
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 23 15:28:34 2015 +0000
Python 3: do not use itertools.izip
This no longer exists in Python 3. Use the zip function instead.
Blueprint: neutron-python3
Change-Id: Id7d33ec3d27a27f17040d28bead10f2eb3b831bb
commit d23a59f1c808c50575f49f9291bd70c6b3a5797a
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Thu Jun 18 19:09:05 2015 +0000
Override opportunistic database tests to PyMySQL
Set the OS\_TEST\_DBAPI\_ADMIN\_CONNECTION override variable so that
oslo.db opportunistic detection will know to use PyMySQL until
I12b32dc097a121bd43991bc38dd4d289b65e86c1 makes it the default
behavior.
This change removes previous code[1] enabling PyMySQL use.
[1] Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
Change-Id: Ic39feee0248f2ffabdba26f3779ab40a8f3838e6
Co-Authored-By: Victor Sergeyev <vsergeyev@mirantis.com>
Co-Authored-By: Cedric Brandily <zzelle@gmail.com>
commit 04d44cee63f3fbba45956abd28f325d5ac3ca2d9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 23 20:00:30 2015 +0200
Extend default setenv instead of replacing it in tox.ini
Some tox jobs[1] define their own setenv without extending/referencing
default setenv, it disallows to define environment variables shared by
all jobs. This change updates previous jobs[1] in order to extend
instead of replacing default setenv and enable global environement
variables (used in daughter change).
One remark, this change sets VIRTUAL\_ENV environment variable in updated
jobs[1] but it has no effect on them.
[1] (dsvm-)functional, (dsvm-)fullstack and api jobs
Closes-Bug: #1468059
Change-Id: I99184f7375571fb8569a24ba04ae267108f5da08
commit 0a82b8ae1951073ff5f9b096485b3acf1a541428
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Fri Apr 24 16:58:48 2015 -0700
Fix FloatingIP Namespace creation in DVR for Late Binding
DVR has dependency on the portbinding host to determine
where to start the FloatingIP Namespace when floatingip
is configured. But when we assign a floatingip to a port
that is not bound, even though the API will succeed, the
FloatingIP Namespace will not be created by the Agent and
so the FloatingIP will not be functional.
This patch addresses the issue by creating the Namespace
and configuring the rules when the late binding happens.
The agent will be requesting the FIP agent gateway port,
if required and then proceed to configure the FloatingIP
Namespace.
Change-Id: I9b9158bddb626c2bb535acd709452560546fd184
Closes-Bug: #1447034
Closes-Bug: #1460408
commit b7dc34ef15061577158eeafc179915e5bde73c64
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 23 14:28:59 2015 +0200
Cleanup get\_plugin\_name() from the tree
It does not seem to be used since Icehouse: the patch that removed its
last usage is: 1b36e2077141749495bb32b423f3df8cbbd0eb40
I don't think we should have it as part of abstract interface for
service plugins.
Change-Id: If03f67a617efd3a7cadb96d1a86283ac14088a83
commit 277d89b67a6a8ea4f6a7bc216014d55ace5c1d2d
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Tue Jun 23 12:07:43 2015 +0300
Bulk move methods to ipam\_backend\_mixin.py
ipam\_backend\_mixin contains methods common for both backends:
pluggable and non-pluggable, so moving methods to make them accessible
by backends.
Next methods were moved from db\_base\_plugin\_v2.py to
ipam\_backend\_mixin.py:
- \_validate\_subnet\_cidr
- \_validate\_network\_subnetpools
- \_allocate\_pools\_for\_subnet
- \_save\_subnet
This commit moves methods without any internal changes.
All future changes and decomposition of these methods will be handled in
next commits.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1ec786754467fc9039d2276f084f1bceaab15635
commit c384b13ae6b83a8bad944972c60bdcbe6f4fa050
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Apr 16 16:20:01 2015 -0400
Add IPset cleanup script
This will aid in removing stale IPsets when we change the prefix
used in creating IPset names.
Change-Id: Ia9ff79c34bd4c9124ec8663a8f616ded4f389f62
Partial-Bug: #1444201
commit 7e117c13fd3fb125c857dadfa2945799b39e1634
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Thu Jun 18 11:22:13 2015 -0600
Optimize ipset usage in IptablesFirewallDriver
Currently, IptablesFirewallDriver.\_update\_ipset\_members() iterates
through a list of security group IDs and makes a call to
IpsetManager.set\_members() for each security group ID in the list. The
problem is that set\_members() is repeatedly called with the same
arguments over and over again because the list of security group IDs
contains duplicates. These duplicated calls are unnecessary because they
are idempotent.
For instance, with a security group of 50 rules created in this manner:
neutron security-group-rule-create $SECGRP --remote\_group\_id $SECGRP
--protocol tcp --port\_range\_min $i --port\_range\_max $i
Adding a server to that security group will cause 50 calls to
IpsetManager.set\_members() because the list of security group IDs is 50 of
the same ID. Only one call to IpsetManager.set\_members() is necessary
per security group ID.
This patch converts that list of security group IDs into a set, which
eliminates the duplicate idempotent calls to
IpsetManager.set\_members() with the same arguments. This will affect
performance by reducing the amount of file locking around ipset when
adding servers to security groups.
Change-Id: Id2c8c8c1093c8abcf1fd897b23b0358aeb55b526
Closes-Bug: 1466921
commit f44800f1eb649d83a338d320020d3479fc3b6790
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 22 14:59:59 2015 +0000
Python3: do not set Request.body to a text string
In Python 3, Request.body must be set to a bytes object.
Change-Id: I17785d1e9eb253a1c6cae300b207fb0a08873b0e
Blueprint: neutron-python3
commit 408af3f7dab477517b1761aeda2b76384f5fffbe
Author: Assaf Muller <amuller@redhat.com>
Date: Sun Jun 21 15:34:21 2015 -0400
Prepare for full stack CI job
Related-Bug: #1467275
Change-Id: I90f4794f48ae151a888f37df26c087a7fdcd9d31
commit 76b4803530c0d5f47659aa519585178cc33cba46
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Tue Jun 2 16:14:40 2015 +0300
Fix callback registry notification for security group rule
Some housekeeping was done in
- SecurityGroupDbMixin:
- create\_rule\_bulk() calls to create\_rule();
- registry notification is in create\_rule();
- separate validation for a single rule and for a group of rules
- SecurityGroupServerRpcMixin:
- overriden methods call to corresponding super class methods;
Hopefully code is now self-documented enough
Closes-Bug: #1461024
Change-Id: Ia75d7e206716bbe74aae89e4cebd0c2c40af68a8
commit 0faf4a264525ade97cd6c0ba6b3f34fceb88c210
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 22 13:02:17 2015 +0000
Python3: do not use \_\_builtin\_\_
It has been replaced with builtins in Python 3. Use six.moves.builtins, since
it works with Python 2 and 3.
Change-Id: I9e1b0060a5b18116d991cafb1de085d4d084db38
Blueprint: neutron-python3
commit 6da2d24ff44cbc8dd0ea8d2e6f72419a46026989
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 22 15:43:20 2015 +0200
Ease debugging alembic by passing proper scripts path in alembic.ini
Otherwise, anyone who attempts to issue an alembic command with the file
gets:
FAILED: Path doesn't exist:
'<...>/neutron/neutron/db/migration/alembic'. Please use the 'init'
command to create a new scripts folder.
Change-Id: I5b5f2802b478c8d8c327d24faa838f7a6859b979
commit fe6654b25044de7d7d15573c689a0f003c018e99
Author: Martin Roy <mroy@iweb.com>
Date: Thu Jun 18 13:45:02 2015 -0400
Use string exception casting everywhere
Instead of the deprecated "message" member access,
casting to a string invokes the \_\_str\_\_ method of the exception
that is wired to return the message
Added a test of the failure cases of IpRouteCommand::delete\_gateway
because they were missing
Running unit and functional tests locally no longer shows the warning
reported in the bug.
Change-Id: Ia79f526aa973ece1145615d65349f860aa3fd465
Closes-Bug: #1466542
commit c3d65a0ed920110223e1b73d6982968552ca7716
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Tue Mar 3 17:08:48 2015 +0800
Switch to oslo\_utils.uuidutils
Get rid of oslo-incubator uuidutils
Closes-Bug: #1467020
Depends-On: I2df519965883b05d5d58cdc4785c850b0685dc2c
Depends-On: I9f8e98ad9517864a9ffdacf01c0a9a5aab554edb
Depends-On: Ied0faac809a5b72b1cd466c8babc9ca5418692c3
Change-Id: Iebe491b981b4b7c02785412fadd27678bb5e47de
commit ee51ef72d37a02005a7733b7f2faf7236db850a1
Author: David Edery <david.edery@alcatel-lucent.com>
Date: Sun Jun 21 15:59:49 2015 +0300
Fix subnet creation failure on IPv6 valid gateway
Currently a valid IPv6 address gateway of the "\*::ffff:ffff:ffff:ffff"
pattern is failing due to netaddr.broadcast returning value for both IPv6
and IPv4 addresses. IPv6 has no broadcast address so the fix checks if
the gateway is the subnet broadcast address only in the case of IPv4
subnet
Change-Id: I849f95b30343d0b1c90cf91203df220bf731d8d5
Closes-Bug: 1466322
commit b9e551936410eca647b48c48f49f2b2be5d2d4a4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Fri Jun 19 17:58:57 2015 +0300
Decompose \_create\_subnet\_from\_pool
Moved validations into separate methods:
- \_validate\_pools\_with\_subnetpool
Verifies that allocation pools are set only for specific subnet request.
For any subnet request allocation pools can not be set manually
- \_validate\_ip\_version\_with\_subnetpool
Verifies that subnet has the same ip version as subnet pool
Partially-Implements: blueprint neutron-ipam
Change-Id: I63f6aa2a0c94c3437fa624ac800943976f4fc50f
commit 29bb401973af81f4a4b8a667f8b7445e19e017da
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 15:24:44 2015 +0300
Move \_delete\_port
Pluggable ipam implementation will do additional actions on port
deletion (deallocate ip using ipam driver).
Existing \_delete\_port code will be resused.
Moving \_delete\_port to ipam\_backend\_mixin to make this code
accessible and extendable by both backends (pluggable and non
pluggable).
This commit is a preparation step before pluggable ipam implementation
can be used.
Partially-Implements: blueprint neutron-ipam
Change-Id: If6cd623aad9e5501a26e5fb8cdecd5f55e85cd05
commit c0ef7a8f4546cd3c081a61c742dd9ed70ec2c147
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:52:24 2015 +0300
Decompose create\_port and save\_subnet
This commit is a preparation step for enabling pluggable ipam.
Some actions in create\_port and save\_subnet are specific for
non pluggable ipam implementation.
- create\_port
Moved allocation ips for port and storing results into separate method
\_allocate\_ips\_for\_port\_and\_store.
Moved to ipam\_non\_pluggable\_backend, since pluggable implementation will
be different due to rollback on failure logic included.
- save\_subnet
Moved saving allocation pools into new method \_save\_allocation\_pools.
Moved to ipam\_non\_pluggable\_backend, since pluggable ipam implementation
does not need to save IPAvailabilityRange (availability ranges are
maintained by ipam driver for pluggable case)
Partially-Implements: blueprint neutron-ipam
Change-Id: I4a3e5d7f3aa54630279d9589225a509c96ed2186
commit 3c72832c8b84af673722a34bba25eefc82154b47
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Jun 15 23:10:09 2015 -0700
Retry port status update on StaleDataError
During update\_port\_status, a port may be concurrently updated/deleted
by another process, which will result in a StaleDataError being
thrown. In the event it was an update, we want to retry to make sure
the port status is set to the desired state so third parties like Nova
get notified.
This patch uses the oslo\_db wrap\_db\_retry decorator after converting
the StaleDataError into a RetryRequest that the decorator can catch.
Closes-Bug: #1465407
Change-Id: I0a9230d30f435ec3d48f033136e85c40ad489ef9
commit ee14186fbb2486f9088103e9621bc366cc64c552
Author: Henry Gessau <gessau@cisco.com>
Date: Sun Jun 21 01:30:05 2015 -0400
Allow setting Agents description to None
Fix the validator for the 'description' attribute of Agents, allowing
it to be set to None.
Fix an API test that had two problems:
1. It was not restoring the description to the agent it had updated
2. It was retoring the description to '' instead of None.
Closes-Bug: #1466642
Change-Id: I50723e1346be0953d26216ba24907bac008ccfb6
commit d0d62927e661c84003845a61d2b991a54e723ed4
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Sat Jun 20 11:55:27 2015 +0000
Fix RPC version to be a string
The RPC version was being passed as a float which caused an
exception.
Change-Id: I2a2888fcafcc426009fc841b81049a22e072ce75
Closes-Bug: #1467087
commit 35654ec23ef9db6bda313ea300ab76c287a98ceb
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon May 25 15:20:05 2015 +0300
Decompose DVR CSNAT L3 Agent from Compute Node L3 Agent
Currently the same dvr router class is used both by the L3 Agent
in the compute nodes that is responsible for the virtual routers
namespace and the fip namespace and also used by the centralized
SNAT L3 Agent in the network node.
This is the first step to decompose the two into different
classes.
The above means that we have one class of DVR router which is used
for two jobs (the virtual router namespace wiring and the fips wiring
in the compute node in one hand and the centralized snat wiring in the other)
The end goal of this patch is to separate the two into different classes
which will also help maintaining it and also help projects that want
to use one but not the other (for example only use the centralized
SNAT behaviour with there own DVR implementation)
Change-Id: I581a097b9e7c49f20d0eb0e4ca66a25e90d9511b
Partial-Bug: #1458541
Partially-Implements: blueprint dvr-router-code-decompose
commit 0e48d9d203619f50adae94ddb6bbccd28f381737
Author: Davanum Srinivas <davanum@gmail.com>
Date: Sun Jun 7 10:10:18 2015 -0400
cleanup openstack-common.conf and sync updated files
Periodic update of latest files from oslo-incubator
Change-Id: Ie7eb02e4e9277c18abfb438b6cf710e0aa426b15
commit 74b0c53da5d7e4305606c100becf34966d8af350
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu Jun 11 13:38:55 2015 +0300
Fix l3 agent to not create already deleted router
In case router is deleted during l3 agent resync,
the "deleted" event is processed with higher priority, then
resync event for the router may be processed which will recreate
already deleted router.
This happens due to timestamp not being properly updated for deleted
router in router processor.
The fix adds timestamp update for deleted router.
Functional test will be updated in a follow-up patch
Logging was improved to make debugging a bit easier.
Closes-Bug: #1455439
Change-Id: I2d060064acccc10591a3d90be9011f116548cfce
commit 4f5171d2cedb32fdc5a59d241e7ae91c7284b75c
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:24:34 2015 +0000
Python3: do not use '+' on dict\_items objects
In Python 3, dict.items() returns an iterator. Iterators cannot be added.
Blueprint: neutron-python3
Change-Id: I487178ebceae9946cb53dea1e847d7715f4577f3
commit b336b7c438f3f5d4ee8d23d6bb2d2cf8fe1657f4
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Fri Jun 19 15:52:35 2015 +0200
Disable keepalived process in keepalived func test
Previously, keepalived process itself was disabled that lead to
respawning of keepalived by KeepalivedManager. This patch disables
KeepalivedManager in cleanup thus no respawn happens.
Closes-Bug: #1466873
Change-Id: If5524116e5d4fc41600920d31481282c5b797f7b
commit a4b17cbb80b48c8e4bcd7cc005139f8e66066d68
Author: Cyril Roelandt <cyril@redhat.com>
Date: Thu Jun 18 11:52:28 2015 +0000
Python3: do not use im\_self/im\_func/func\_closure
One should use \_\_self\_\_, \_\_func\_\_ and \_\_closure\_\_ instead, as they work
with both Python 2 and 3.
Change-Id: I2b2847cfd5b4fa70e45387ff369240227ce9e526
Blueprint: neutron-python3
commit 432567f9477eadd840e407c5c057fc664e46d731
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 15:48:09 2015 +0300
Add request factory for pluggable IPAM
Pluggable IPAM implementation requires separation between requesting
address/subnet and it's actual allocation, which can happen on
third-party IPAM servers. Request factory stands for simplifying
building right request from input.
Added AddressRequestFactory and SubnetRequestFactory.
AddressRequestFactory creates instance of AnyAddressRequest or
SpecificAddressRequest depending on presence of ip address in input.
SubnetRequestFactory creates instance of AnySubnetRequest or
SpecificSubnetRequest depending on input.
get\_subnet\_request\_factory and get\_address\_request\_factory can be
redefined on driver level to use custom request factories.
Partially-Implements: blueprint neutron-ipam
Change-Id: Iedc0cfa326d60810099148f0ef8a1edac9e8aa12
commit 870fb38b1c7ddd5ddb399e6ff13a4f7992f8f9a6
Author: Cyril Roelandt <cyril@redhat.com>
Date: Fri Jun 19 13:59:46 2015 +0200
Python3: use dict.keys() instead of dict.iterkeys()
The "keys" method works on both Python 2 and 3, and the performance
impact should be negligible.
Change-Id: I4771797859666000921e4e38cc5de72a8c084ca0
Blueprint: neutron-python3
commit 538a7bf3c73d968185590d81a9b3a6523190aeb4
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Jun 9 03:41:07 2015 -0700
NSX QoS ext: RXTX factor can be decimal
In Nova flavors it is ok to specify a decimal RXTX factor.
For this reason when applying QoS to a port Neutron should not
convert this factor to an integer value, but simply ensure
it's a valid float number and positive.
Partial-Bug: #1463363
Change-Id: I983123ef7fd8f1b52b358aff3b579459fce63033
commit 5aaae68e5148f01e78a5e6013dce797dd42c1917
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 18 14:17:58 2015 +0300
Move \_add\_auto\_addrs\_on\_network\_ports
Moved to ipam\_non\_pluggable\_backend.py since implementation
is specific for non pluggable ipam backend.
Pluggable implementation will additionally include rollback on failure actions.
This commit is a preparation step for using pluggable ipam.
More changes in this methods are expected to be done by following
patches.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1876846526e370a7fcfa05b9a23fd9065973f111
commit 6669ee9af6bd635ae7efbc2f02e10914549ef708
Author: Lucas Alvares Gomes <lucasagomes@gmail.com>
Date: Thu Apr 9 14:02:36 2015 +0100
DHCP agent: Set an "ipxe" tag to work with Ironic
Ironic expects neutron to have an "ipxe" tag for the option 175 which is
sent by iPXE/gPXE when booting a node. The problem is that up to now this
tag was not created by Neutron, causing the nodes deployed with Ironic
+ iPXE to fail to boot. This patch is creating this tag when launching
the dnsmasq process.
DocImpact
Change-Id: I45a0f51365b37e7d85848fcdcbcf7aa6a1dddfed
Closes-Bug: #1442123
commit 735f193668d61dd7c09f710e555ab91d1d91abe6
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 17 18:47:11 2015 +0300
Remove \_check\_ip\_in\_allocation\_pool
\_check\_ip\_in\_allocation\_pool is not used anywhere in neutron.
Cleaning up unused code from db\_base\_plugin\_v2.py.
Caller was removed over a year ago in change
Ib31550fa9000fc75768a327cb6cc1c419e06568f
Partially-Implements: blueprint neutron-ipam
Change-Id: I41b7254835c308dda679ee2a5ebbccba528fd108
commit e3710f59481b4f9c3430228e8f074c845e93fbe7
Author: shihanzhang <shihanzhang@huawei.com>
Date: Mon Jun 15 14:51:16 2015 +0800
Don't delete DVR namespace if there are still ports on this node
Skip deleting DVR namespaces if they contain ports in the BUILD or
DOWN status.
Change-Id: I026f2014ede800c0f4532ca15f1fccdaa59d5b61
Closes-bug: #1464527
commit 345ffb99ef92f567562c178c57b9c110740a3767
Author: Doug Wiegley <dougw@a10networks.com>
Date: Thu Jun 18 18:13:43 2015 -0600
Updated from global requirements
Since we can't merge proposal bot at the moment, due to a conflict with
setup.py, at least get our reqs files up to snuff.
Change-Id: Ie313c81502dfe17a4afdcfdba4e207b9866e1399
commit 42826a0e64b3499cda065fd9ffdf0b5af5754c85
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:06:21 2015 +0200
Fixed the only sphinx warning in docs
We made previous attempt to get rid of all warnings, but it turned out
that gate does not execute tox's docs job but runs build\_sphinx
directly.
The latter behaviour should be fixed, but while at it, we
should prepare neutron job to be executed in gate by cleaning up all
warnings.
Closes-Bug: #1466554
Change-Id: I8c265eae2175425568479116d1faef7d87fdcc02
commit 63e318f5f8159f108cf1e7a82c952fa5f882870f
Author: Moshe Levi <moshele@mellanox.com>
Date: Thu Jun 11 12:24:03 2015 +0300
Fix SR-IOV mech driver to set port status to down when agent is required
SR-IOV mech driver has 2 modes agent and agent-less. Currently in both
modes port status are active. This patch update the port status to down
when using agent mode. This will allow the SR-IOV agent to get port
update notification and apply its additional functionality
when launching vm.
Co-Authored-By: Berezovsky Irena <irenab.dev@gmail.com>
Closes-Bug: #1464186
Change-Id: Ibd9b31b4f2393b8732253d5cbfd36e8b5614860d
commit cdde9a3aeb929e80aa3c251a44060b8174ab7b6c
Author: venkata anil <anil.venkata@enovance.com>
Date: Thu Jun 18 10:03:12 2015 +0000
read\_hosts\_file\_leases shouldn't parse stateless IPv6
Error when \_read\_hosts\_file\_leases tries to parse stateless IPv6 entry
in hosts file
TRACE neutron.agent.dhcp.agent ip = host[2].strip('[]')
TRACE neutron.agent.dhcp.agent IndexError: list index out of range
Neutron creates entries in dhcp host file for each subnet of a port.
Each of these entries will have same mac address as first field,
and may have client\_id, fqdn, ipv4/ipv6 address for dhcp/dhcpv6 stateful,
or tag as other fields.
For dhcpv6 stateless subnet with extra\_dhcp\_opts,
host file will have only mac address and tag. So \_read\_hosts\_file\_leases
shouldn't check for ip address for this entry in host file.
Closes-bug: #1465330
Change-Id: Iad6605ac5c7bcd6ec9204352037ed021f5007738
commit 31f846c1b9fa17d1812f78dffe1dcf883da52bab
Author: shihanzhang <shihanzhang@huawei.com>
Date: Fri Jan 30 09:50:52 2015 +0800
Fix 'router\_gateway' port status can't be updated
when it creates a ovs bridge without parameter 'bridge-id',
it's default 'bridge-id' is None, so ovs agent should also
deal with these ovs bridges, for example if ancillary bridge
br-ex does not be handled, the 'router\_gateway' port status
can't be updated.
Change-Id: If428eadadfd36a9b19ea75920120e48ac49659f2
Closes-Bug: #1416181
commit 2db459f284002e45497d768a8a53c9b43d045d45
Author: Doug Hellmann <doug@doughellmann.com>
Date: Tue Jun 16 19:49:15 2015 +0000
Update version for Liberty
Update the version for Liberty, switching from date-based versioning
to pre-versioning using SemVer. See
http://lists.openstack.org/pipermail/openstack-dev/2015-May/065211.html
and
http://lists.openstack.org/pipermail/openstack-dev/2015-June/067082.html
for details.
Change-Id: I6a35fa0dda798fad93b804d00a46af80f08d475c
commit 98d0be2f82523a40e630cf08dd8479b4cbb48add
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:33:56 2015 -0700
Add networking-sfc to the list of affiliated Neutron projects
The project is being bootstrapped in [1,2], this change reflects
that in the sub\_projects doc.
[1] I3825a1e02713f45e2c769eaa8fd0f1ab48d14372
[2] Iec53129d7c19620d690e71032c83907f03c66d9f
Change-Id: I7c235bfe444bbb9afc7d4d8c92704c9bfc09ab49
commit 315b10dc9fa7b8d889a24e0c6cdf72f5341d92d5
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 17 11:31:01 2015 -0700
Minor improvements to sub\_projects document
Let's remove the empty table, to cut down the risk of inconsistency,
and further explain what the list of affiliated project is for.
Change-Id: I3c8970db8de4fc211233903e8220cda72d47e193
commit 53209ca19ac2116d293b6fbc7b31254cb27a3ecb
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 17 14:25:56 2015 +0000
Python 3: do not use cmp(), nor sorted(..., cmp=...)
\* The "cmp" function has been removed, so we must not use it any more;
\* The "cmp" keyword argument of the "sorted" function has been removed, so
replace it with "key=functool.cmp\_to\_key".
Change-Id: Ic39d29dc1002a68f36f04c32e53a36bc826dce78
Blueprint: neutron-python3
commit 4a73ab99c9fcc63adbbb41d4a9b9ba8669afdc61
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Tue Jun 16 13:48:26 2015 +0200
Move get\_inteface\_by\_ip from LinuxBridge class to ip\_lib
get\_interface\_by\_ip is moved fro LinuxBridgeManager to ip\_lib
as a more generic get\_device\_by\_ip.
System-faking unit tests have been switched for functional
testing that also performs a negative test.
This can be reused in the openvswitch-agent code to validate
local\_ip reusing the LinuxBridge logic.
Change-Id: I9237871a6e24dd99556c71844624be510e20d289
Related-Bug: #1464178
Related-Bug: #1408603
commit 76dd333167920f447bdbedbbee10fdab593abe5b
Author: Vladislav Belogrudov <vladislav.belogrudov@oracle.com>
Date: Wed Jun 17 14:02:22 2015 +0300
Fix cisco\_csr\_identifier\_map.ipsec\_site\_conn\_id
Some database engines require exact match of sizes of foreign keys
and referenced fields. Foreign key ipsec\_site\_conn\_id of table
cisco\_csr\_identifier\_map is varchar(64) but it references field
id varchar(36) of table ipsec\_site\_connections. This gives error
while running migration scripts in such databases.
This fix only applies to new installations. Existing databases will
be corrected by migration scripts introduced in
https://review.openstack.org/190569 - they will take care of resizing
the field and adjusting the model.
Change-Id: I6cc9625a2d96d1330b06eb727cc7fa5363c697b8
Depends-On: I384a9bbaba05ef94174b666bdcfb276eedc74134
Closes-Bug: #1463806
commit 7a7377681133785e12a296ff7077b039708da97d
Author: Thomas Morin <thomas.morin@orange.com>
Date: Wed Jun 17 12:13:35 2015 +0200
fix rootwrap debug filter for ping all
NeutronDebugAgent.ping\_all calls ping with "-c 1 -w <number>' so
the filter should accept this order, and not only "-w .. -c ..".
Not changing the existing filter to not break other tools
that might use -w -c in that order.
Change-Id: I5b3d67dfcdc15c53ac3bf2fb39de29fd97e98a19
commit 7d704db18ec7635328bfce7dc6e936151f264f1f
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 23:16:24 2015 -0700
Refactor rpc\_loop() in ovs neutron agent
This patch segregates the port\_info recieved by
scan\_ports and scan\_ancillary\_ports.
This refactoring is basically required for this patch set:
https://review.openstack.org/#/c/165023/
Co-Authored-By: Romil Gupta <romilg@hp.com>
Change-Id: I9b43c230cda9d2659ad0e806bebe8a3dc12826ec
Partial-Bug: #1329223
commit 4e77442d529d9803ff90de905b846af940eaf382
Author: Kevin Benton <blak111@gmail.com>
Date: Sat Jun 13 18:45:19 2015 -0700
Add deadlock retry to API and ML2 RPC port update
With the switch to the pymsql SQL driver, eventlet will now yield
during database transactions. This greatly increased our probability
of multiple coroutines running transactions on the same table that
result in deadlocks.
These deadlocks could result from many things including the following:
\* a coroutine holding a pessimistic "SELECT for UPDATE" lock when
another tries to update the locked records
\* two coroutines both issue update statements using a WHERE clause
invalidated by the other update (e.g. from a compare and swap approach)
\* two coroutines insert records that, when combined, violate a unique
constraint on the table in a master-master Galera deployment
\* any two workers using "SELECT for UPDATE" in a master-master Galera
deployment (write-set certification failure translates to deadlock)
This problem is exacerbated by the switch to multiple API and RPC
workers, each of which can lead to most of the errors above even
without the switch to pymysql.
This patch adds a deadlock retry decorator to the delete, create,
and update methods at the HTTP API layer. Additionally, it adds a
decorator to the update\_port\_status AMQP API in ML2 since it updates
the port table, which is a heavily locked table by ML2 making it a
prime candidate for deadlocks.
Nova has had relied on the deadlock retry mechanism for quite some
time now. We were limping along by not using additional workers and
by relying on the unyielding nature of the MySQL C driver to
serialize everything.
Closes-Bug: #1464612
Change-Id: I635cc49ca69f589f99ab145d4d51e511b24194d2
commit 95b6a74af10e2150b017647028de8454ef1cda2f
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Tue Jun 16 17:23:09 2015 -0700
ovsdb: session.rpc never initialized
Previously, if idl.Transaction.commit\_block() returned a status of
TRY\_AGAIN we would check self.api.idl.\_session.rpc.status which would
result in an attribute error as rpc is None.
This patch fixes this attribute error by removing this unneeded check. In
addtion, the force\_reconnect() is also removed as ovs.jsonrpc handles
reconnecting automatically for us.
Change-Id: Ibf3ce5cd3432845f8938a1d83637ecf59b14b5ca
Closes-bug: 1465889
commit fc0c3a83659a86453acd5745a5632729b99cb3de
Author: Rawlin Peters <rawlin.peters@hp.com>
Date: Mon Jun 15 10:57:02 2015 -0600
Remove duplicated debug logging around locking
Currently, iptables\_manager.py does extra unnecessary logging about lock
acquisition and release. It uses lockutils.lock() which passes
do\_log=True by default, which causes lockutils.lock() to do debug
logging about lock acquisition/release. IptablesManager itself also writes
debug log info about lock acquisition and release.
This change will eliminate unnecessary duplicate logging in order to
reduce log noise about locking. This change is also related to
https://github.com/harlowja/fasteners/commit/f88f2fea7fe250b7d26cdcbc84633ccbbc68eeee
which reduces the logging level in the underlying lock implementation
used by oslo.concurrency. That change along with this one will remove
the duplicate debug logging about locking in iptables\_manager.py and also in
ipset\_manager.py.
Change-Id: If6f4a7101f3783ad83645e28bbb5c577dd403d3b
Closes-Bug: 1464727
commit 8f2014ea556404fb99c78add1e46b80c718cf491
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 16 05:32:44 2015 -0700
Refactor scan\_ports() and update\_ancillary\_ports() in OVS Neutron Agent
Used a helper method which contains the common code from scan\_ports()
and update\_ancillary\_ports(). And also renamed the name of
update\_ancillary\_ports() method to scan\_ancillary\_ports() to have parity
between normal ports and ancillary ports.
Added unit tests for scan\_ancillary\_ports.
Co-Authored-By: Romil Gupta <romilg@hp.com>
Partial-Bug: #1329223
Change-Id: I8b3e00a9371d5a03cc8b4be24bf20eec10bef5df
commit 4f46d2ae3a089f36512fae3bf49f155927095922
Author: Cyril Roelandt <cyril@redhat.com>
Date: Tue Jun 16 13:38:13 2015 +0000
Python3: do not change the size of a dict while iterating over it
This does not work in Python3, so we have to store the items first.
Change-Id: I7d8641f980fe62d2900559433d5060a6281a97f8
Blueprint: neutron-python3
commit 0488ac707493575e084f02273df2c4ec598541ba
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 12:34:41 2015 +0300
Refactor TestRpcWorker and TestWorkerService
TestRpcWorker and TestWorkerService have a duplicate test\_reset.
This patch introduces a base class from which tests for service
workers can inherit.
Change-Id: Ic4690c3b066b03c2fbb463f1329208ad1307d83d
commit fca84f69659e4e81790de405213f31e80fd8c239
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 2 18:45:51 2015 +0300
Juno\_initial migration
Havana was deprecated with the kilo release, and icehouse will be
deprecated with the liberty release, so havana\_inital migration should be
removed and replaced with juno\_initial.
Closes-bug: #1461103
Change-Id: I2e6802c9ab64d164bd888278d555dfeeaf47257b
commit 037f3111cd3968ff00593387daf2b832761e5ef4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 16 09:21:42 2015 +0200
docs: added job to well known tox envlist
This is to make 'tox -l' return the job name in its output (needed to
allow run-docs.sh script in project-config to determine whether the job
is present, to rely on it when generating docs in gate).
Change-Id: I80eb169b7b4e5a3490586722c64394dbb724928d
commit 9fc422a93a00f4126e91fa79ffcd43903ea9c8ac
Author: Sean M. Collins <sean@coreitpro.com>
Date: Mon Jun 15 13:51:05 2015 -0400
API Extensions: inherit from the ExtensionDescriptor
For consistency in the codebase, API extensions should inherit from the
abstract base class ExtensionDescriptor.
Change-Id: Id4829c265866e80c042c433bebcc01383e1e7417
commit 34aa030847ed24ad6ca7759459cbe9a6d0f43db3
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Jun 15 14:47:21 2015 -0400
Remove fossilized remains
Clean up ancient stuff that hasn't been touched in over 3 years.
Change-Id: I67fcd85027fb6614cafe8d92ddbf8c24aed58a4f
commit f88f3dc8d6f7240d6c0d9d5006345b3a797ae067
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 16:18:40 2015 +0300
Refactor update\_port in db\_base\_plugin\_v2
This commit is a preparation step for using pluggable IPAM.
- moved validations into \_validate\_port\_for\_update;
- updating ip addresses for port is backend specific, so
moved into \_update\_port\_with\_ips in ipam\_non\_pluggable\_backend;
- writing port changes to db is common for both backends, so
moved into \_update\_db\_port in ipam\_backend\_mixin;
- updated to use namedtuple to track add/original/remove ips;
- added \_make\_fixed\_ip\_dict to exclude keys other than
ip\_address and subnet\_id;
Partially-Implements: blueprint neutron-ipam
Change-Id: I1110e88f372b1d0cc7ec72049ba69a6d548da867
commit a89f99c6b700b1c6f918fe359c7271ac25ed4bc4
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 10 14:56:58 2015 +0300
Refactor \_update\_ips\_for\_port
This commit is a preparation step for using pluggable IPAM.
\_update\_ips\_for\_port was refactored and split into two methods:
- \_get\_changed\_ips\_for\_port
This method contains calculations common for pluggable and
non-pluggable IPAM implementation, was moved to ipam\_backend\_mixin.
- \_update\_ips\_for\_port
This method is specific for non-pluggable IPAM implementation, so it
was moved to ipam\_non\_pluggable\_backend\_common.
Other changes:
- \_update\_ips\_for\_port now returns namedtuple with added, removed, original
ips (previously added and original ips were returned).
List of removed ips is required by pluggable IPAM implementaion
to apply rollback-on-failure logic;
- removed unused port\_id argument from \_update\_ips\_for\_port argument list;
Partially-Implements: blueprint neutron-ipam
Change-Id: Id50b6227c8c2d94c35473aece080a6f106a5dfd8
commit a8619e9bd1247e8ec494c456aee9ee7163231f62
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 15 15:07:28 2015 +0000
Python 3: use dict.values instead of dict.itervalues
This works with both Python 2 and 3, and should not have any performance
impact.
Change-Id: I2a14945c60de513b91c6f022ff5dcc503ce2a8ad
Blueprint: neutron-python3
commit 62faedddf2b0315484a04bd9092e96a3a828e46a
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Jun 15 16:15:11 2015 +0200
Put output of docs job into doc/build/html
This is the path where jenkins/scripts/run-docs.sh that is used by gate
to generate project documentation expects to see the output.
Change-Id: Id276fa59edb33f7789ab06055300b4dc2385472a
commit ad1c7a35dec614a26de0a426950fa005df5f489d
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:23:44 2015 -0400
Remove get\_namespace from API extensions
Based on the conversation on the ML.
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066219.html
APIImpact
DocImpact
Closes-Bug: #1464023
Depends-On: 6f900fc429bf24cb31e0d2f149aa732055fd5956
Change-Id: I3c406910991c33cf959c5345d76153eabe3ace2d
commit b370c69b75fe38cd285512f9516ce428e8a806dd
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue Jun 9 16:00:58 2015 +0000
Ensure no "db" related functional/fullstack tests are skipped in the gate
Currently neutron uses MySQLTestCase[1] and
PostgreSQLOpportunisticTestCase[2] for functional and fullstack tests
using a real MySQL/PostgreSQL database. These classes skip tests when
the db is unavailable (db not installed/configured, missing packages,
etc.) which is fine when tests are runned by developers but not when
runned by the gate jobs.
This change updates MySQLTestCase[1] and defines PostgreSQLTestCase[1]
as PostgreSQL oslo.db test class wrapper: when the db is unavailable,
these classes ensure tests will:
\* fail in the gate (dsvm-functional, dsvm-fullstack jobs),
\* be skipped by default otherwise (functional, fullstack jobs).
[1] neutron.tests.common.base
[2] oslo\_db.sqlalchemy.test\_base
Closes-Bug: #1404093
Change-Id: I77b12e728ce9a7b0222c3df081842635f6375a3e
commit 278a5fce29504c43d669feed210f7b3627616e22
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:35:11 2015 +0200
Use PyMySQL in MySQL related functional/fullstack tests
mysql-python driver has been replaced by PyMySQL driver[1] in neutron
code but MySQL related functional/fullstack tests try to use
mysql-python driver because of MySQLOpportunisticTestCase[2] and tests
are skipped because mysql-python driver is no more available.
This change provides a backend implementation for mysql+pymysql, a base
base testcase MySQLTestCase[2] using mysql+pymysql implementation
(currently oslo.db provides none of them but will in the future) and
replaces MySQLOpportunisticTestCase with MySQLTestCase.
[1] I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
[2] neutron.tests.common.base
Closes-Bug: #1463980
Change-Id: Ic5c1d12ab75443e1cc290a7447eeb4b452b4a9dd
commit 1318437a0caf38e695a819848832a955fef7d909
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Fri Jun 5 01:46:22 2015 +0400
Skip rescheduling networks if no DHCP agents available
This eliminates the problem of unscheduled networks in case
of communication failure between agents and servers which
can occur if messaging queue service fails.
Change-Id: Ied4fa301fc3d475bee25c47f3a01c2381ae9a01e
Closes-Bug: #1461714
commit bb846c89ee120662eabdd4b0136fac82de076777
Author: Russell Bryant <rbryant@redhat.com>
Date: Fri Jun 12 21:26:37 2015 -0400
Reflect project moves from stackforge to openstack.
Several git repos were just moved from stackforge to openstack.
Reflect the move in various places where the URL was in docs and
comments. In passing, also change URLs to git.openstack.org instead
of github, as that is the official home of all of these repos.
Change-Id: I6c79a192d6604cef01e88d5b305fcc2b0f9c6b30
Co-Authored-By: Kyle Mestery <mestery@mestery.com>
Signed-off-by: Russell Bryant <rbryant@redhat.com>
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 1710f7c72f2c509d1009ee36ba4f66b298967fe9
Author: Kobi Samoray <ksamoray@vmware.com>
Date: Thu Jun 4 15:49:13 2015 +0300
VMWare NSXv: Add distributed URL locking to ini
NSXv plugin supports distributed locking using tooz library.
This patch adds the required parameter to the ini file.
DocImpact
Depends-On: Icbcec938c1c5ae7a528350f2f283388b81fa66b7
Change-Id: I8a7c36d044c4be29b0dfa3fbb8e9379723cebd61
commit 9952abaab182f3ec701aad2397d6f3fcc0bacc7f
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Mon Jun 8 14:15:30 2015 +0300
Decompose db\_base\_plugin\_v2.py with changes
This commit is a preparation step for using pluggable IPAM.
1. Moved get\_subnets functionality to db\_base\_plugin\_common to make it
accessible by ipam backends.
2. Reworked update\_subnet routine:
- moved db part into update\_db\_subnet;
Partially-Implements: blueprint neutron-ipam
Change-Id: Idb8f54d9fccaad1137222d156590c37d86aa576b
commit a5bf502fab57453a1aedd3a53ce89eaf464e1cd9
Author: Cedric Brandily <zzelle@gmail.com>
Date: Fri Jun 12 21:11:02 2015 +0200
Remove duplicate tunnel id check in sync\_allocations
Currently, gre/vxlan sync\_allocations and \_parse\_tunnel\_ranges both
check tunnel id values. This change removes the check in gre/vxlan
sync\_allocations as they duplicate \_parse\_tunnel\_ranges check and is
less fine.
Change-Id: I5827468aeaec5d6c79d469132b129aeb7da171e2
commit 901e6ae6fb05d65ccfc4a6602de4160c3a34031e
Author: Akihiro Motoki <motoki@da.jp.nec.com>
Date: Sat Jun 13 02:14:17 2015 +0900
Remove meaningless no\_delete from L3 test
no\_delete parameter was removed in Kilo and it no longer
has any effect.
Change-Id: Idf0f3ac24b3978392222efbf465cc9e6cfd5d346
commit ba2c44ef000221f8a18274a9569838d8c26014c0
Author: armando-migliaccio <armamig@gmail.com>
Date: Fri Jun 12 08:58:05 2015 -0700
Revert "Revert "Set default of api\_workers to number of CPUs""
This reverts commit 12a564cf03e612dda36df26df8d28dfc75f1af6e.
We should re-enable this feature on a controlled basis so that we can
flush out any outstanding issue we may have.
Related-bug: #1432189
Change-Id: I2cfd93fdb032b461022b729347390ff8636ccdeb
commit 89a83bf199e7ea75c04f3205ff77987feed13184
Author: rossella <rsblendido@suse.com>
Date: Thu Jun 11 10:43:36 2015 +0200
OVSNeutronAgent pass the config as parameter
Instead of using the global cfg.CONF, pass the config as parameter.
This is very useful to test the agent without having to override
the global config.
Change-Id: I45534d79e044da9f2be4d596a58310fb28b7bf22
commit 7e0222409dab6223579efea34ba0d3ccf93e11d3
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jun 11 17:23:41 2015 +0300
Refactor \_update\_subnet\_allocation\_pools
Moved \_update\_subnet\_allocation\_pools to ipam\_backend\_mixin.py.
Call \_rebuild\_availability\_ranges with self to make it overridable
on upper level (from non-pluggable backend).
Partially-Implements: blueprint neutron-ipam
Change-Id: If7b1e720f88a2f0177b6772a015ae216f19ee22d
commit 5ff082bcfe12647036e5b033bfc2bac514acdb42
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Tue Feb 24 15:47:01 2015 -0500
Stop sending gratuitous arp when ip version is 6
This fix prevents calls to the arping utility for IPv6
addresses, thereby eliminating errors reported by arping
for IPv6 addresses.
The assumption is that NDP, DAD, and RAs are sufficient
for address resolution and duplicate address detection
for IPv6, and that unsolicited Neighbor Advertisements (NAs)
are not required for OpenStack services. If this turns out
not to be the case for some service/feature, then a separate
bug should be filed to add support for unsolicited NAs for
that service.
Change-Id: I14f869b7d488d7e691f7316eafcab3064e12cda6
Closes-Bug: 1357068
commit 1552f311532fdbd03a79ecfc1fae488b072c5a14
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Tue Jun 9 11:30:06 2015 +0300
Fix Enum usage in 589f9237ca0e\_cisco\_n1kv\_ml2\_driver\_tables
PostgreSQL is more sensitive with types than MySQL, it creates a
separate type when a Enum is created. In migration 589f9237ca0e
type profile\_type is trying to be created, but the type with such
name was already created in havana\_initial migration.
The solution for this is not to create type in 589f9237ca0e
migration when dialect is PostgreSQL and use already created.
Closes-bug: #1463301
Change-Id: I66e74d50cc70673de8635616076779cc20cde113
commit cd56a657a19a5a756d191c614becfd3e386b3c80
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jun 11 06:03:07 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If91f3ac94562cc5130dd5ea5ac5d71aec64b74e3
commit 7b51521e31f896d0095510b52644b728aaadca5a
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 10 21:45:41 2015 -0700
power grab
The current core reviewers hierarchy didn't have a place for the
parts of ML2 that weren't related to agent communication. For now
we can put all of ML2 under the built-in control-plane until we
decide it needs to be put somewhere else.
Change-Id: Ic4924e0041c4cbb955d8fac0f96ec56406d6466e
commit 1c29fab7cb3e586be72dd7910e2022b45c809c5f
Author: Brian Haley <brian.haley@hp.com>
Date: Thu Jun 4 23:54:31 2015 -0400
Change ensure\_dir to not check directory exists first
I224be69168ede8a496a5f7d59b04b722f4de7192 added an EEXIST
check, so no need to check if the directory is already
there, just try and create it.
Change-Id: Iba51fc8263bf59326489319d0dd3f69af00a8eeb
commit 7c331be77fb6a835f1fb79c674d8d6c39c7eb357
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed Jun 10 16:53:25 2015 -0700
Document existence of br-tun and br-int in the OVS agent
Question about the use of the two bridges has come up in the past
multiple times, so let's fill the gap in the developer documentation.
A user-facing documentation patch will have to follow up, if we want
to be very thorough.
Change-Id: I6dac0f9bdaf7b3b7bff8745d4103ccc71df61a0a
commit 9c8a19ba4032f98ecbffe53c4e731587550ded96
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed Jun 10 22:08:45 2015 +0200
Correct indentation in neutron.api.v2.attributes
This change corrects subnetpool resource definition indentation in
neutron.api.v2.attributes.
Change-Id: I6738ff6b73bd0b943cec32f14ccb8946ba28d2e3
commit fd85b3ead32cd988e93f1d33d219ffd52cd77a51
Author: Cyril Roelandt <cyril@redhat.com>
Date: Wed Jun 10 10:20:58 2015 +0000
Python3: replace 'unicode' with 'six.text\_type'
In Python 3, 'unicode' does not exist; 'six.text\_type' should be used instead.
Change-Id: I71011b4beee9817a61278eb473804cfb798de74a
Blueprint: neutron-python3
commit c34ce7c9845cc56f981e0ee8714d1f9345df5852
Author: Saksham Varma <sakvarma@cisco.com>
Date: Tue Apr 7 18:12:02 2015 -0700
Moving out the cisco n1kv section to stackforge
Since most of the n1kv plugin code resides in stackforge/networking-cisco
repo, it's best to move the n1kv section there
Change-Id: Ic1388980dea0d27dfa5e84869f1f20cc9bff78e5
Closes-Bug: #1441400
commit 27df3e9fb98407e94bdeb9df493a9a3a0be639ca
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon Jun 1 22:29:39 2015 +0200
Ensure no "agent" functional tests are skipped in the gate
Some "agent" functional tests[1] can be skipped if some requirements are
not satisfied in order to allow developers to run functional tests on
various environments. These tests should not be skipped in the gate.
This change defines the decorator no\_skip\_on\_missing\_deps[2] to ensure
no "agent" functional tests are skipped in the gate. More precisely
no\_skip\_on\_missing\_deps transforms a skipTest into an error in:
\* dsvm-functional and dsvm-fullstack jobs,
\* functional and fullstack jobs when OS\_FAIL\_ON\_MISSING\_DEPS is
evaluated as True.
The change enlarges OS\_FAIL\_ON\_MISSING\_DEPS environment variable scope
(ie: missing dependencies + system requirements).
[1] in neutron.tests.functional
[2] in neutron.tests.common.base
Change-Id: Iacd4a5ef249fc1d7c75135ead9d0cf99d8a98a06
Closes-Bug: #1459844
commit ca63dfd0f39c7d691247c146b7529937c5804c9e
Author: Romil Gupta <romilg@hp.com>
Date: Wed Jun 10 09:43:56 2015 -0700
Remove useless pass from methods in type\_tunnel.py
The pass is useless because there is a docstring in the methods.
Generally considered as uncovered by coverage tool.
Change-Id: Id1275c51e9adb865a3da9f0db007f3092b55b140
commit 87fecfcc50f371d8dd593b3cd372da9db56f39c6
Author: Sean M. Collins <sean@coreitpro.com>
Date: Wed Jun 10 10:29:33 2015 -0400
Make Vlantransparent extension inherit from ExtensionDescriptor
Change-Id: Ic615578a1fe1d401b53d0b44ff5275d9518b97fd
commit eeacb95e65a749ce3a032246c36d10cad9df22b1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Wed Jun 10 13:10:54 2015 +0200
Actually allow to pass TRACE\_FAILONLY to ostestr
The comment below suggests to use TRACE\_FAILONLY to fail quickly when
running unit tests, while tox 2.0 does not allow to pass envvars from
the cli caller unless they are explicitly mentioned in passenv=
directive.
Change-Id: I6861498e7609b0c21fad844009420ea9734e2352
commit 1c124a309bc941c078b8bb622ea248a3ed3829e1
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 11:28:10 2015 +0200
Switch to os-testr to control testr
It's a nice wrapper spinned out recently from tempest-lib that should
cover all our needs that we currently fulfill with pretty\_tox.sh.
Change-Id: I2268ed45ab628fe5dcab657d6287594847ab587c
commit da42745c466c14e6dbe58cdbc830ae5d1c8bb114
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Tue Jun 9 16:08:50 2015 +0000
Introduce functions using arping executable
The arpinger is gonna be used in the next changeset introducing
connection testers.
Change-Id: I90ae32c2f52f1debfb11ae2a08b2828ee2be04cc
commit 328b72cf8c5f514434de0b73c9137bde52b5eeea
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Wed Jun 10 07:04:25 2015 +0000
Revert "Defer segment lookup in NetworkContext object"
This reverts commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0.
This patch likely violated the idea of a NetworkContext
being a snapshot of the network at the time it was created.
This needs a different approach.
Change-Id: I20b132a0181d35b0517330fb7fbf293c3e979d0e
commit e33d92c894df4664d01d040ba4305c7cb4ef6e27
Author: Fawad Khaliq <fawad@plumgrid.com>
Date: Tue Jun 9 22:18:18 2015 -0700
Added networking-plumgrid in plugin requirements
Closes-Bug: 1463665
Change-Id: I7152dedd83659ee51274be31ef305af9e82d695a
commit f08e9f1f53efa97e07f21ca72a940fcbeb4570e5
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Wed May 20 01:03:59 2015 +0000
Switch from MySQL-python to PyMySQL
As discussed in the Liberty Design Summit "Moving apps to Python 3"
cross-project workshop, the way forward in the near future is to
switch to the pure-python PyMySQL library as a default.
https://etherpad.openstack.org/p/liberty-cross-project-python3
Change-Id: I73e0fdb6eca70e7d029a40a2f6f17a7c0797a21d
commit 6886655b491aede40aa9f4a0bd4c6d402d5a7a78
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue Apr 28 04:59:35 2015 -0700
Context: Remove logic for read\_deleted and deprecate it
The read\_deleted parameter in the Context object is simply unused.
This patch removes associated logic, and for what is worth, adds
deprecation warnings against explicit usage of read\_deleted when
creating a context instance, generate an admin context, and
elevating a context instance.
Change-Id: Ic69d22dc229ebe8fac1f6be0c4860d19732505b1
Closes-Bug: #1449462
commit 303f37f4e0c84f90e40b95731a828fc6ce8a0bbf
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 16:09:49 2015 +0000
Python 3: use next() instead of iterator.next()
The latter only works in Python 2.
Also define a \_\_next\_\_ method in the classes that define a next method.
Change-Id: Iaa1a1e500facab50d8bcdffda39ccad3f2e4e9bb
Blueprint: neutron-python3
commit 9143ce10e422bd17c4817dfe08163879e0e5a4ca
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 12:12:52 2015 +0200
Consume oslo.policy
Some non intrusive changes to tests are needed, so that we don't rely on
library symbols that are now private (f.e. parse\_rule).
Closes-Bug: #1458945
Change-Id: I90326479e908042fec9ecb25fa19a8dd5b15e7d8
commit 66fece4f84e62f14fb59a721b37986784976d0c4
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Apr 23 14:03:52 2015 +0200
policy: cleanup deprecation code to handle old extension:xxx rules
It served and warned users for enough time (since Icehouse) to be sure
everyone was notified about the need to update their policy file.
Change-Id: I240b935741e49fbf65c0b95715af04af4b2a73e7
commit 53ec63c430d123cd1ed4acd3b94537e9cb380bcd
Author: Romil Gupta <romilg@hp.com>
Date: Thu Jun 4 04:21:14 2015 -0700
Fix a regression in "Separate ovs-ofctl using code as a driver" change
The tunnels are not getting established between Network Node and
Compute Nodes in non DVR mode with l2pop enabled and throws
the AttributeError: add\_tunnel\_port.
This fixes a regression in change Ie1224f8a1c17268cd7d1c474ed82fdfb8852eaa8.
Co-Authored-By: YAMAMOTO Takashi <yamamoto@midokura.com>
Closes-Bug: #1461486
Change-Id: I1106fd3dd32f6f827eb25dec4815ff1120af96f0
commit 753196480d9cca10c5b91dfa8221e89f658fa110
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed May 27 13:54:06 2015 +0000
Break Pinger class to functions
As the class served only for storing parameters that can be passed as
actual function parameters, there is no reason for class.
Change-Id: I553b4d6daeb78d495cda09894582a3d885b5d1b5
commit 6d0d72973152bb45587437c80d4ffe0fe7bba761
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Tue Apr 7 14:58:13 2015 +0300
Handle SIGHUP: neutron-server (multiprocess) and metadata agent
All launchers implemented in common.service require each service to
implement reset method because it is called in case a process
receives a SIGHUP.
This change adds the reset method to neutron.service.RpcWorker and
neutron.wsgi.WorkerService which are used to wrap rpc and api
workers correspondingly.
Now neutron-server running in multiprocess mode (api\_workers > 0 and
rpc\_workers > 0) and metadata agent don't die on receiving SIGHUP and support
reloading policy\_path and logging options in config.
Note that reset is called only in case a service is running in daemon mode.
Other changes made in the scope of this patch that need to be mentioned:
\* Don't empty self.\_servers list in RpcWorker's stop method
When a service is restarted all services are gracefully shutdowned,
resetted and started again (see openstack.common.service code).
As graceful shutdown implies calling service.stop() and then
service.wait() we don't want to clean self.\_servers list because
it would be impossible to wait for them to stop processing
requests and cleaning up their resources.
Otherwise, this would lead to problems with rpc after starting
the rpc server again.
\* Create a duplicate socket each time WorkerService starts
When api worker is stopped it kills the eventlet wsgi server
which internally closes the wsgi server socket object. This server
socket object becomes not usable which leads to "Bad file
descriptor" errors on service restart.
Added functional and unit tests.
DocImpact
Partial-Bug: #1276694
Change-Id: I75b00946b7cae891c6eb192e853118e7d49e4a24
commit ea35b299f06050608f3e7bb6fbc880006ed31024
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 18:25:14 2015 -0700
Allow update\_port\_status to take network param
Allow the update\_port\_status function to take a network as
an optional parameter to skip calling get\_network again if
the caller has already done so.
Closes-Bug: #1463656
Change-Id: I994f3abdb1b0ad3b2766f409b206ad4a8b2309b6
commit d0be7bc57f573d5696108b571c731decfbde9f0b
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 12:46:54 2015 +0200
Make pep8 job succeed when /etc/neutron/neutron.conf is not installed
Currently, if /etc/neutron/neutron.conf is not installed in the system,
neutron-db-manage fails in oslo.config code when trying to determine the
default configuration file to use.
Test job should not rely on any contents inside /etc/.
Instead, pass --config-file with test-only configuration explicitly into
the utility.
neutron.conf.test was renamed into neutron.conf since for some reason
oslo.config does not support a name that does not have .conf at its
filename end.
Change-Id: I719829fc83a7b20a49c338aaf1dbef916dcc768c
commit 826428dc8aeef124c2251624ae34fdc003e69ca4
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Tue Jun 9 19:00:40 2015 +0900
Add a comment on \_check\_update\_has\_security\_groups
Despite of its name, \_check\_update\_has\_security\_groups can
handle create requests as well. There are plugins actually
using it for create. eg. ml2, vmware
Change-Id: I3c26ad0ac00b12ce24096bfc27606797af2d9098
commit 6b13cc5275df53c765c450d570521c425c3345d9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Tue Jun 9 10:57:29 2015 +0200
Enable all deprecation warnings for test runs
We would like to catch all deprecation warnings during test runs to be
notified in advance about potential problems with next library releases
we depend on.
Change-Id: I876d8c4de88618b01898ab537a44920789d8178e
commit 734e77365b0f241a3cea0f3c9dfb1d5fcf6eac8c
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Apr 17 15:00:20 2015 -0700
Remove get\_admin\_roles and associated logic
get\_admin\_roles was introduced so that contextes generated from
within plugins could be used for policy checks. This was the case
up to the Havana release as several plugins invoked the policy
engine directly to authorize requests.
This was an incorrect behaviour and has now been fixed, meaning
that get\_admin\_roles is no longer need and can be safely removed.
This will result in a leaner and more reliable codebase. Indeed the
function being removed here was the cause of several bugs where the
policy engine was initialized too early in the server bootstrap
process.
While this patch removes the feature it does not remove the
load\_admin\_roles parameter from context.get\_admin\_context. Doing so
will break other projects such as neutron-lbaas. The parameter is
deprecated by this patch and an appropriate warning emitted.
As a consequence neutron's will now no longer perform policy checks
when context.is\_admin=True. This flag is instead set either when
a context is explicitly created for granting admin privileges, or
when Neutron is operating in noauth mode. In the latter case every
request is treated by neutron as an admin request, and get\_admin\_roles
is simply ensuring the appropriate roles get pushed into the context
so that the policy engine will grant admin rights to the request.
This behaviour is probably just a waste of resource; also it is not
adding anything from a security perspective.
On the other hand not performing checks when context.is\_admin is
True should not pose a security threat either in noauth mode or
with the keystone middleware. In the former case the software keeps
operating assuming admin rights for every requests, whereas in the
latter case the keystone middleware will always supply a context
with the appropriate roles, and there is no way for an attacker
to trick keystonemiddleware into generating a context for which
is\_admin=True.
Finally, this patch also does some non-trivial changes in test\_l3.py
as some tests were mocking context.to\_dict ignoring the is\_admin flag.
Closes-Bug: #1446021
Change-Id: I8a5c02712a0b43f3e36a4f14620ebbd73fbfb03f
commit 89c0875178f22651109a85d3c522d80324368caf
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Mon Jun 8 14:27:47 2015 +0300
Add documentations for VXLAN Tunnels
The VXLAN type driver is currently supported, this patch add
description and links for more information to the user.
Change-Id: Idb221ca4cce1a3a27bebe5ae6fc1e6ab5d030836
commit e61865807c4c8ff959a7746fe3e17f1ae574c9d0
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 19:03:29 2015 -0700
Defer segment lookup in NetworkContext object
Avoid call to get network segments for network context objects until
a caller actually tries to lookup the segments. This optimizes cases
where the user of a port context never looks at the segments of the
associated network context (e.g. update\_port\_status).
Closes-Bug: #1463254
Change-Id: I7e95f81d9a3ef26ccdb18c6bfdf9adc29523aa79
commit d0bbfc090bb25f1e05b98f0ad70c18209b87ed6b
Author: Zhenguo Niu <niuzhenguo@huawei.com>
Date: Tue Jun 9 08:28:45 2015 +0800
Fix typos in docs
Change-Id: I71aeb8f1e5fc5f3e330e593a463858dd65e6093b
commit b322ebae09cc59ed0a860ea6e39ed9b6fa6c5c12
Author: yuyangbj <yangyu@vmware.com>
Date: Wed May 13 14:07:36 2015 +0800
Fixes bulk insertion of data to ml2\_port\_binding
We should use schema definition to insert bulk of data to table.
Closes-Bug: #1454566
Change-Id: I66b3ee8c2f9fa6f04b9e89dc49d1a3d277d63191
commit 3a5a8a62c372f3a516caa59fd655dcf923a82519
Author: Kyle Mestery <mestery@mestery.com>
Date: Mon Jun 8 15:27:23 2015 +0000
Add Neutron PTL Office Hours
To ensure a weekly oppurtunity to sync between the PTL and the
Lieutenants, officially setup Neutron PTL Office Hours.
Depends-On: Ia5c8090e90939097104cb95c0aa3b883f7b4dd9b
Change-Id: Iab3c21764937ebb3a1d0553b3a3d42b5c44bf3cc
Signed-off-by: Kyle Mestery <mestery@mestery.com>
commit 00899b56213753d523842f29d50353a067df6064
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 8 14:42:18 2015 +0000
Python3: Enable all working tests in tox.ini
Thanks to the recent Python3-related changes, these tests can now be run on
Python 3.
Change-Id: I7f689e221e59128012d46da2c90e61d5206fe828
Blueprint: neutron-python3
commit 725543684cbe0df0edc4b6924f85e63e1628fa92
Author: rossella <rsblendido@suse.com>
Date: Thu Mar 5 09:24:10 2015 +0000
Add get\_events to OVSDB monitor
OVSDB monitor can generate the events that the OVS agent
needs to process (device added or updated). Instead of
notifying only that a change occurred and that polling
is needed, pass the events to the agent
Change-Id: I3d17bf995ad4508c4c6d089de550148da1465fa1
Partially-Implements: blueprint restructure-l2-agent
commit b239f75644bfdfec86f8a8efdabd6b11b766e822
Author: shihanzhang <shihanzhang@huawei.com>
Date: Tue May 26 16:42:44 2015 +0800
Update ipset members when corresponding sg member is empty
if a security group has a rule with 'remote-group-id', the ports
in this security group should update its relevant ipset member
when the remote-group members is empty.
Change-Id: I980ebfd8f6537f803d9d5cbf21ca33f727fea3b3
Closes-bug: #1458786
commit b17ff81ef1b18395c0b0671a487f68201d739f43
Author: shihanzhang <shihanzhang@huawei.com>
Date: Fri Apr 24 18:28:17 2015 +0800
Send 'security\_groups\_member\_updated' when port changes
With ml2 plugin, when a port's IP or security group changes, it
should send 'security\_groups\_member\_updated' message to other l2
agents which have same security group with this changed port.
Change-Id: I2e7622d2db4c173ac879a95a6e0adf92b858fe82
Closes-bug: #1448022
commit e2cfd87ab4abab95d713fa39a576ca7e41bce5c2
Author: Assaf Muller <amuller@redhat.com>
Date: Sat Jun 6 18:41:39 2015 -0400
Remove full stack log noise
"neutron-server isn't up yet" logs are useless because if
you time out when waiting for the server to start that information
will be in the trace. When you don't time out, the log is just spam.
Same reasoning for the "There are %d agents running!" log.
Also made the agents\_count parameter mandatory for the
wait\_until\_env\_is\_up method because having a default of 0, or any
other default makes no sense. There's no reason to ever call that
method without specifying the agents\_count. This method used
to be used with agents\_count == 0 by the server to make sure
its up (And responding to REST calls), but the Neutron server
fixture now uses server\_is\_live method (Which calls list\_networks)
instead.
Change-Id: Ifd6abd04ddaacc9976cb2a75269443f870b47c5b
commit e383378507d0d144de468e579f2e2defd41540b0
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Sun Jun 7 02:50:35 2015 +0900
ML2: Remove TYPE\_MULTI\_SEGMENT
It's a leftover from the pre-multiprovider world.
Change-Id: Iaf93292d698032984dfc392fae3701c49e18adc8
commit b649b9c871d0734745da5a201eca83a6b407a1c5
Author: Stephen Ma <stephen.ma@hp.com>
Date: Thu Jun 4 20:09:23 2015 +0000
L3 agent should do report state before full sync at start
Sometimes the AgentNotFoundByTypeHost exception is reported during
L3-agent startup. The exception is generated when the first
get\_routers RPC call is made. When the neutron server gets this
RPC call, it might not have handled the report state RPC call yet.
So the L3-agent hasn't been registered in the API server.
The result is a RPC Error exception. By the time the next
get\_routers RPC call is made, the report state RPC call has already
been done and agent registered.
This patch modifies the L3 agent startup behavior to have the report
state done before the agent do the sync routers RPC call.
Closes-bug: 1456822
Change-Id: Id40cfd8466f45e20fea0e9df6fd57bf9c9e59da7
commit 127de06c7e09e1468f2855a3033fb6193a6b9365
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 6 22:40:39 2015 +0200
Clean only floating-ip related connection states
Currently init\_l3 deletes connection states related to ALL ips deleted
in init\_l3 but it's required only when floating-ips are deleted[1].
This change deletes only connection states related to floating-ips
deleted in init\_l3 ... it avoids to delete connection states in dhcp
agents and on router internal ports!
[1] look at change Ia9bd7ae243a0859dcb97e2fa939f7d16f9c2456c
Closes-Bug: #1452434
Related-Bug: #1334926
Change-Id: Icfcfc585df6fd41de1e1345fd731e4631a6950ce
commit 713ba0e8d7ce59eaff41518360530b2e7831c322
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Thu Jun 4 22:25:44 2015 +0000
Refactor awkward logic in setup\_dhcp\_port
I noticed this logic as I was reviewing another patch set [1]. I
didn't like removing subnet ids from dhcp\_enabled\_subnet\_ids and I
wasn't too keen on the ips\_need\_removal semantics that were kind of
forced by the existing structure of the code. I hope you find this
alternative much clearer. I like straight-forward code with less
indentation that doesn't use awkward booleans like ips\_needs\_removal.
[1] https://review.openstack.org/#/c/157697/6
Change-Id: I8bd3d6924a855ea08f8096e66bd3bfbb165a4da3
commit 101ff1a81f15314cb9a07a6b65787c4324913c8a
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue May 19 09:42:51 2015 -0700
Add a "light" base test class for DB tests
This newly added class simply extends DietTestCase
with support for SQL operations.
Related-Blueprint: better-quotas
Change-Id: I2debc6a144ee93155c8e36f06aecb9735dbf55d4
commit 62d37f91872aaaefdee50e5cd1ed87456b8a6532
Author: rossella <rsblendido@suse.com>
Date: Fri Jun 5 13:09:35 2015 +0200
Make \_val\_to\_py and \_py\_to\_val not private
Move \_val\_to\_py and \_py\_to\_val to neutron.agent.ovsdb.api
and remove the underscore since they will be used by other
classes.
Change-Id: I3a469ab3b1c1d83ad20dc6c77f1072fc6d546419
commit 546cab2d62a0daf88ef192dd2fb2e185b39a7fcb
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Fri Jun 5 14:01:10 2015 +0300
Decompose db\_base\_plugin\_v2.py part 2
This patch contains method moving with minor modifications like updating
class names. IPAM specific methods were moved into ipam\_backend\_mixin and
ipam\_non\_pluggable\_backend.
ipam\_backend\_mixin - contains code common for both backends (pluggable and
non-pluggable).
ipam\_non\_pluggable\_backend - contains code specific for non-pluggable
IPAM implementation.
Partially-Implements: blueprint neutron-ipam
Change-Id: I6d68e4066ca472107def197c5a5afccbb6886a0e
commit 45b28ddfe8ac23871e65feb4132d5f048c783222
Author: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
Date: Fri Jun 5 13:05:48 2015 +0200
Fix typo in test class name
Make "Redering" -> "Rendering"
Change-Id: Ieedb446fa1e06705eb70293d83350d4dfd57d2db
Signed-off-by: Vincent Legoll <vincent.legoll@iphc.cnrs.fr>
commit 8c5ef2cd6e1819c4f51b01cb3504da34ef377546
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Thu Jun 4 17:00:13 2015 +0300
Start linuxbridge neutron agent using a launcher
This change ports linuxbridge neutron agent on common/service code
that will allow to handle termination signals (SIGHUP, SIGTERM, SIGINT).
Note that this patch allows changing only logging options.
All other config options are not handled explicitly and changing
them using SIGHUP can lead to unpredictable circumstances.
So, until changing other options is handled it is highly recommended
to use SIGHUP for changing ONLY logging options.
DocImpact
Change-Id: I1d834e0683b04111ef04c148cbd8d4acf2964065
Closes-Bug: #1461539
commit ea5ad714cfcd336c0062ddeb13238c452117782a
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 14:55:13 2015 +0300
Handle SIGHUP in ovs neutron agent
This change allows ovs neutron agent not to die on receiving SIGHUP
and reload its logging options.
Note that this patch allows changing only logging options.
All other config options are not handled explicitly and changing
them using SIGHUP can lead to unpredictable circumstances.
So, until changing other options is handled it is highly recommended
to use SIGHUP for changing ONLY logging options.
Change-Id: Ic0cf8a9ca7f3a16b556a6825e2979471ae136c33
Partial-Bug: #1276694
commit 615cac19913830e3dd15d1668d4fb2046202270f
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Mon Feb 23 16:25:53 2015 +0900
test\_ovs\_neutron\_agent: Remove useless ofport=10 arguments
The kwarg ofport has been removed from method signatures
where it was never used.
Change-Id: Iee671e8d870ba4ef5175a639bbaf365a5eaf5ef7
commit 839706df7c742ec4b132dc6f18857679cfd870f5
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Wed Jun 3 22:35:58 2015 +0900
test\_l3: Don't assume the order of subnets
Fixes test\_router\_add\_gateway\_multiple\_subnets\_ipv6 failures
on my environment.
Change-Id: I44b4dd0cee393ea796f35b999cc111b60ef63db1
commit 38eae7acb30de6f1f8dbb36855a5c913d9370fc5
Author: Cyril Roelandt <cyril.roelandt@enovance.com>
Date: Tue May 19 16:16:38 2015 +0000
Python 3: do not index a dict\_values object
In Python 3, dict.values() return a dict\_values object instead of a list, as in
Python 2. This object cannot be indexed.
Change-Id: Ia4fdb4cafb1811c55dc8f14e303ab2db1b1110b3
Blueprint: neutron-python3
commit 74dcc91aa85ab2e250fa32d6b895b2d5f7f2d5ba
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu Jun 4 17:58:06 2015 +0200
versionutils: switch from incubator version to oslo.log
Note that we require oslo.log >= 1.2.0 since it's the first release that
included the module.
Change-Id: I2b7d587d8c4b0c885873c9c8083abb8fc35780c9
commit c0afeba0b55318e4508d59a68bc7c15e23a9a996
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed May 27 13:50:22 2015 +0000
Run RootHelperProcess always as root
The purpose of RootHelperProcess is to spawn processes running with root
id. Instantiating RootHelperProcess as non-root doesn't make sense. This
also implies NetcatTester always spawns 'netcat' process as root. The
reason why parameter existed here was due to refactor from passing
root\_helper all over the place.
Change-Id: If042efcd75e46b66abf4a9e303e633749a1611b1
commit 28c95da3f500ce80258784514bfff1dc5d22bf1c
Author: Alexander Maretskiy <amaretskiy@mirantis.com>
Date: Thu Jun 4 16:32:12 2015 +0300
Changes in rally-jobs/README.rst
Changes:
\* fix broken links
\* add link to release notes
Change-Id: Ie42b246aac2fd4f6de8cd8bcf28e5ff2906ffd32
commit 770859d25b9d95b28794832d673ff6127a9f936f
Author: Dmitry Ratushnyy <d.ratushnyy@gmail.com>
Date: Mon Apr 20 16:22:27 2015 +0300
Add more API tests for port-security extension:
Test create port with specific value of port\_security\_enabled
Test create secure port with security\_group attached
Test update port with port\_security\_enabled True\False
and with or without security groups
Test deleting port with port\_security\_enabled
Change-Id: Id71f5451dc17f374feff1a3bdb35fb9ec42f0fa1
Depends-On: Ia27881a34ff99cad34c84764d2bf8a6cdf77af9c
Depends-On: Ie0ec090e8fdce7dbdbce14ef47f38e8e57f262d4
commit 9cac5c3a9f5238fde7fd4e1c01644cdfe48785d2
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Jun 1 14:36:17 2015 -0400
Decompose the NCS ML2 Mechanism Driver
The last of the Cisco drivers to decompose.
Closes-bug: #1416713
Co-Authored-By: Nikolay Fedotov <nfedotov@cisco.com>
Change-Id: Icd2b358fb0db3d859ee287225ab8eeb10d7da871
commit 52ac1c30086738ad798bdafeede2172ee23897e6
Author: YAMAMOTO Takashi <yamamoto@midokura.com>
Date: Wed Jun 3 22:21:52 2015 +0900
test\_db\_base\_plugin\_v2: Don't assume the order of fixed\_ips
Fixes test\_ip\_allocation\_for\_ipv6\_2\_subnet\_slaac\_mode
failures on my environment.
Change-Id: I18a9a177a60c364d79943a8d68b46fde3b9f5d74
commit d00bd978f849df6d8f6f40dbc75b5b3fbdd610ea
Author: Angus Lees <gus@inodes.org>
Date: Thu Jun 4 12:55:02 2015 +1000
pylint: enable `duplicate-key` check
This check attempts to detect dictionary literals with duplicate keys.
The rest of the Neutron tree has already had the few instances of this
cleaned[1] or moved into external vendor repos. Enabling the pylint
check will stop future occurrences.
[1] I29cd2b843a7905986de13a1ecfba0cb5797ccaf8
(Original patch I1aa221d2019853f905f2b8421dd45b0a3102baf0 by zhiyuan\_cai)
Change-Id: If4fed9714cd7fa586845f21f8f56dde2645cc5e0
Co-Authored-By: zhiyuan\_cai <luckyvega.g@gmail.com>
commit b0b9e8bcaf3b2b9f33f8d3cd0bcdc21e8b7a1a87
Author: Assaf Muller <amuller@redhat.com>
Date: Wed Jun 3 13:50:57 2015 -0400
Remove reference to non-existent fullstack fixture
EnvironmentFixture doesn't actually exist, and environment
should be a mandatory parameter.
Change-Id: I5598e176f297bcfa3b2cab188b4b446ce18d54ab
commit 75c3a8dee4a7f643d7654e2ea4641fd1bd18af62
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Wed Jun 3 16:56:23 2015 +0000
Enhance utils.ensure\_dir to be resilient to concurrent workers
In rare cases, concurrent workers may attempt to ensure a directory
exists. One may successfully create the directory while the other
gets an oserror that it already exists. This patch detects the
problem and returns successfully in both cases.
Change-Id: I224be69168ede8a496a5f7d59b04b722f4de7192
commit 92b946e90b6cdd90deba2097196970afaaaf8dab
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Wed May 27 20:12:27 2015 +0000
Use a single method to remove an address with its conntrack state
I just noticed a pattern and I thought I'd throw this up for
discussion. It has occurred to me that this addition sort of breaks
the ip\_lib paradigm of wrapping ip commands without any additional
useful abstraction. Any better ideas?
Change-Id: Ibd34bf4a721c153aca916e294e58adb4a28379e4
commit ece8cc2e9aae1610a325d0c206e38da3da9a0a1a
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Wed Jun 3 14:22:29 2015 +0300
Decompose db\_base\_plugin\_v2.py
Moved private getters and simple helpers into db\_base\_plugin\_common.
This change is part of bigger refactoring for supporting Pluggable IPAM.
Main purpose is to make getters accessible by IPAM code.
Partially-Implements: blueprint neutron-ipam
Change-Id: I1eac61c258541bca80e14be4b7c75519a014ffae
commit ea643d9163427b75aff7053d00c97dc84680e63b
Author: Russell Bryant <rbryant@redhat.com>
Date: Tue Jun 2 15:20:44 2015 -0400
Add sub-project lieutenants
A recent patch added the concept of Lieutenants for Neutron. This
same concept makes a lot of sense for identifying clear points of
contact for the various sub-projects under the Neutron tent. This
patch adds a table of the projects currently approved as part of
Neutron in the governance repo. I also made a guess on who the
lieutenant would be based on reviews in stackalytics (except for ones
that weren't in stackalytics).
Change-Id: Ibce5d6ba5e19dec59a10c88749557509136c4e41
Signed-off-by: Russell Bryant <rbryant@redhat.com>
commit 913298da04a52f31182c8849efe77b2310b4c2e1
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Wed Jun 3 15:38:50 2015 +0300
Fix confusing parameters names
Change-Id: Ib00135e1d0b8f334d660de9a80629e084efb13ba
commit 052054133abb76ef944d17e97df3afc8bc3f1738
Author: Aman Kumar <amank@hp.com>
Date: Wed Jun 3 05:15:25 2015 -0700
Extra indent in test\_ovs\_neutron\_agent
This patch removes extra indent errors from test\_ovs\_neutron\_agent
Change-Id: I1270cca3699b7874047f7812710f2611cc465493
commit 608c282285380704e70228ef549646a61492d2bd
Author: Aman Kumar <amank@hp.com>
Date: Tue Jun 2 23:49:40 2015 -0700
Make MockFixedIntervalLoopingCall class as a helper class
MockFixedIntervalLoopingCall class is used in both the classes
TestOvsNeutronAgent and TestOvsDvrNeutronAgent.
This patch removes the MockFixedIntervalLoopingCall from both the
places and make it as a helper class in test\_ovs\_neutron\_agent.py.
So that it will be used everywhere in test\_ovs\_neutron\_agent.py.
Change-Id: I5e0803436e91b4f20ec03209e9e799a68df4eaf4
commit 6575db592c92791a51540134192bc86465940283
Author: Kevin Benton <kevinbenton@buttewifi.com>
Date: Wed Jun 3 05:52:51 2015 +0000
Revert "Add VIF\_DELETED notification event to Nova"
We need to wait until the nova support is added in
I998b6bb80cc0a81d665b61b8c4a424d7219c666f. Otherwise
this generates a ton of error messages in the nova api
log as well as on the neutron side.
This reverts commit 0ace88fd4a75ff213dc36fd16c1f8e7080ab7d6d.
Change-Id: I129c4e4c05cf07d45032fec6f57e0cc17a5a82af
Closes-Bug: #1461391
commit 45ea2cf10033e12c63b8ce2cd78b04755d0aba64
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Wed May 6 12:50:11 2015 +0300
Wrap ML2 delete\_port with db retry decorator
ML2 delete\_port operation currently involves locking ports
and bindings tables which may lead to DBDeadlock errors in certain
cases when several ports are deleted concurrently.
That may happen due to specifics of Galera working in active-active
mode: it may throw deadlock errors when it fails to validate
a change with other members of the cluster.
The fix adds retries to delete port operation to overcome such
deadlocks
Closes-Bug: #1422504
Change-Id: I684691d59c5ac370d74314c3c91857dc709b2d9b
commit f4d72a8fdfb2c897aa0a0581ca9cb9d9da4a4167
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Tue Jun 2 17:34:48 2015 -0700
Remove extra indent in testcases
Change-Id: I42cb044d75d53eab7ba180954589c718374857ee
commit 75f3aaa4cc42c2c1280f6c578e27e64cff8f860c
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Jun 2 16:52:14 2015 -0700
Check for 'removed' in port\_info before reference
scan\_ports can return early on no changes, in which case
'removed' won't be present in the dict. The deleted\_ports
logic wasn't setup to handle that.
This patch checks for the key before trying to reference it.
Change-Id: I0e2c6d76515ad8e2a2addc8d40451ac003a150f7
Closes-Bug: #1461325
commit ae8c1c5f80fd4fb7b4ab116677f4cff988c67cf1
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Tue May 26 20:17:20 2015 +0400
Catch broad exception in methods used in FixedIntervalLoopingCall
Unlike other places where it might make sense to catch specific
exceptions, methods that are used to check L3 and DHCP agents
liveness via FixedIntervalLoopingCall should never allow exceptions
to leak to calling method and interrupt the loop.
Further improvement of FixedIntervalLoopingCall might be needed,
but for the sake of easy backporting it makes sense to fix the issue
in neutron before pushing refactoring to 3rd-party library.
Change-Id: I6a61e99a6f4e445e26ea4a9923b47e35559e5703
Closes-Bug: #1458119
commit 805d4b148ae4b32657ed6a83e9a530b8b2c806ac
Author: Assaf Muller <amuller@redhat.com>
Date: Tue Jun 2 12:21:11 2015 -0400
Add devref that explains fullstack testing and its direction
The goal of this doc is to communicate what are full stack tests,
how they benefit you and when would you write such a test.
Additionally I'd like to communicate the way forward, and gather
feedback about any areas in the code that can benefit from full
stack tests, and any additional thoughts!
Change-Id: Ifd4ff9be0ed0184a49df6566d238c31a328cd23f
commit b48bccc60e4fd552d7b127376f41810b61e0ba9d
Author: Assaf Muller <amuller@redhat.com>
Date: Mon Jun 1 17:05:56 2015 -0400
Remove get\_dhcp\_port RPC method
This method was last used in Icehouse. I think we can safely
remove all of its code and tests. Icehouse to Liberty rolling
upgrades are in no way expected to work so I just bumped
the RPC version and removed all traces of the code.
Change-Id: Ia545c5be7da80c919ad5bae6074bc1cc3aa89fa0
Closes-Bug: #1314534
commit 46223363bd4d41639102ae1923dd1dfb306ec808
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 30 20:41:29 2015 +0200
Refactor type\_tunnel/gre/vxlan to reduce duplicate code
gre and vxlan type drivers have similar implementations for multiple
methods:
\* get\_endpoint\_by\_host
\* get\_endpoint\_by\_ip
\* delete\_endpoint
\* get\_endpoints
\* add\_endpoint
This change abstracts these methods and moves the abstractions to the
new class EndpointTunnelTypeDriver.
Change-Id: Iab97f8283b6bf5586334958de950664f6e74202a
commit 637b2f42560508c8b131718d9a6920d86d9a6c55
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Jun 2 06:15:35 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Iadf5c59306dd4f8ce574a2d7259bd6a03d60a72a
commit 490bdabd4c5835bac2314722c498e6dc6e85979d
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Tue Jun 2 08:49:10 2015 +0300
Update rootwrap.conf to add /usr/local/bin
When working with OVN i found on Fedora 21 that
my ovs-vsctl is installed in /usr/local/bin, since this wasnt in
rootwrap DHCP didnt work properly.
This change adds it to rootwrap
Change-Id: Ib3646933744ca6b20ecd5ad0cedcedb4f1fa5f12
commit cda0b14112484d4776c7ccb6be78b7e23fdd5424
Author: Eugene Nikanorov <enikanorov@mirantis.com>
Date: Tue Jun 2 06:15:39 2015 +0400
Add route to metadata IP by default
Windows VMs try to resolve metadata ip 169.254.169.254 as
local address by default, which results in very slow access
to metadata url during boot.
Injecting direct route to metadata ip through a subnet's default
gateway helps Windows to avoid wasting time on mac resolution.
So this patch injects host route for metadata ip for networks plugged
into a router.
Closes-Bug: #1460793
Change-Id: Ic991f9d7f9a8cf942e3e29f2da03d73c0f26470a
commit 3751f9ab349ea5b4c3d9836592e7928c37211091
Author: Cyril Roelandt <cyril@redhat.com>
Date: Mon Jun 1 20:53:46 2015 +0000
Python3: use six.iteritems() instead of dict.iteritems()
This also adds a check to neutron/hacking/checks.py that should catch this
error in the future.
Blueprint: neutron-python3
Change-Id: Ie7b833ffa173772d39b85ee3ecaddace18e1274f
commit 96e2314c8c0f06967b53828b0a771973f0031243
Author: Assaf Muller <amuller@redhat.com>
Date: Fri May 29 19:17:34 2015 -0400
Modify ipset functional tests to pass on older machines
Production code uses ipset exclusively in the root namespace,
however functional testing uses ipset in namespace for isolation.
This poses an issue as ipset is not supported in namespaces on
all kernels and distributions (I'm looking at you CentOS/RHEL 7.1).
This patch changes the ipset functional tests to work in the root
namespace while taking care of cleanups.
Change-Id: I08b2f59197ed76e59b2e58b5a10820653e857cda
Closes-Bug: #1460220
commit 70e07629bf263370102350d922d62970c60d5aa4
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Tue May 19 09:27:14 2015 -0700
Add a non-mixin function for model queries
This patch simply adds a version of model\_query in
neutron.db.common\_db\_mixin which can be invoked without
having to declare a class which inherits the mixin.
To this aim, model\_query\_scope has been refactored as well.
As the model query function being introduced in this patch
cannot use model query hooks (and does not need to), the
method was re-implemented rather than bringing out of the
mixin as it has been done for model\_query\_scope.
This change will allow for developing DB APIs without
having to use the baseDB/mixin classes models used so far.
Related-Blueprint: better-quotas
Change-Id: I7a79980f626e9eaf2775711c8a25f508067e5716
commit bacd69386d9df2abb41f62d1fa90f9cfaa215c62
Author: Pavel Bondar <pbondar@infoblox.com>
Date: Thu Jan 15 15:00:02 2015 +0300
Implement IPAM Driver loader
IPAM Driver is loaded based on value of 'ipam\_driver'.
Added new variable 'ipam\_driver' in config.
DocImpact
Partially-Implements: blueprint neutron-ipam
Change-Id: Ia52ad70ef4f0b02cf82cfefcf50b9f1e30b05b79
commit 4a234ab1a35708bf85fe57d9290056ac74227eab
Author: Elena Ezhova <eezhova@mirantis.com>
Date: Mon Jun 1 12:58:32 2015 +0300
Remove comment about hash seed in tox.ini
Enable random hash seeds change [1] has merged so the comment
can be safely removed.
[1] https://review.openstack.org/#/c/185572/
Change-Id: I93f64841792f9c38f5121ca47c130ad769c11dc4
commit 9b29f62491ec0e1cb27601e6ad53cf152de5eb66
Author: Moshe Levi <moshele@mellanox.com>
Date: Sun May 31 13:27:56 2015 +0300
Refactor mlnx mechanism driver to support infiniband only
The old mlnx mechanism driver was used for SR-IOV with Ethernet
and infiniband support but the PCI allocation wasn't done by nova.
Juno introduced sriovnicswitch mechanism driver for SR-IOV with
Ethernet support. Mellanox recommends on using it.
The updated mlnx mechanism driver supports SR-IOV infiniband.
\* support only port vnic\_type 'direct'
\* update vif\_type name to ib\_hostdev (the ib\_hostdev is generic vif\_type
for SR-IOV infiniband see https://review.openstack.org/#/c/187052/)
Closes-Bug: #1460430
DocImpact
Change-Id: Ia822b492afdfeb1aecf373d5a8cdb72174512884
commit c60c3e4f88aa28b9d2e6b6dcc7bc2a858433952d
Author: Henry Gessau <gessau@cisco.com>
Date: Sun May 31 14:51:50 2015 -0400
Remove unused \_uuid function alias from test\_iptables.py
Change-Id: If80de5ee6588ffd2338387e6592cf2812b106e1f
commit 193e745ac63d3a404b577ab61dd331779beb6a4b
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Fri May 29 15:00:45 2015 +0900
test\_ovs\_neutron\_agent: Remove unnecessary mocking
Leftover from change I90b4d2485e3e491f496dfb7bdee03d57f393be35.
Change-Id: Ia2596718678d3102ad99acbdf30be7ef0f52ad27
commit b7ffbf96ff414ce615c10c83fea85d7f1fdcce70
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 30 22:04:59 2015 +0200
Refactor type\_gre.vxlan tests to reduce duplicate code
gre and vxlan type drivers unittests have similar tests. This change
abstracts these tests and moves them to TunnelTypeTestMixin[1].
[1] neutron.tests.unit.plugins.ml2.drivers.base\_type\_tunnel
Change-Id: I13b0507991e840ff34de7ed7ffd31d359691b0ca
commit 9a73722992cc302127472a5a98ca05348db52a5f
Author: Alexander Ignatov <aignatov@mirantis.com>
Date: Sat May 30 00:49:31 2015 +0300
Removed duplicate keys in dicts in test
Test test\_create\_security\_group\_rule\_invalid\_ethertype\_for\_prefix
contained dict with duplicate keys, remote ip prefixes.
Test was successful because incorrect items for tests were overwitten:
'192.168.1.1/24': 'ipv4' by '192.168.1.1/24': 'IPv6'
'2001:db8:1234::/48': 'ipv6' by '2001:db8:1234::/48': 'IPv4'
This patch removes incorrect and useless items for tests.
Also added additional item with invalid ethertype.
Change-Id: I29cd2b843a7905986de13a1ecfba0cb5797ccaf8
commit c44506bfd60b2dd6036e113464f1ea682cfaeb6c
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Apr 17 04:03:38 2015 -0700
Don't update floating IP status if no change
The floating IP status was going through all of the
status update code every time the L3 agent sent in
an update, even if the status didn't change.
This patch skips sending updates to the server if the
agent doesn't change the status.
Change-Id: Ic3736bed3dc3e4ccb91f4acfabbf033949e09ce0
Partial-Bug: #1445412
commit e007167a700aa5b80ecb48adff0ac36bb330591d
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Apr 30 17:14:44 2015 -0700
Don't delete port from bridge on delete\_port event
Commit d6a55c17360d1aa8ca91849199987ae71e8600ee added
logic to the OVS agent to delete a port from the integration
bridge when a port was deleted on the Neutron side. However,
this led to several races where whoever created the initial
port (e.g. Nova, L3 agent, DHCP agent) would be trying to
remove the port from the bridge at the same time. These
would result in ugly exceptions on one side or the other.
The original commit was trying to address the problem where
the port would maintain connectivity even though it was removed
from the integration bridge.
This patch addresses both cases by removing the iptables rules
for the deleted port and putting it in the dead VLAN so it loses
connectivity. However, it still leaves the port attached to the
integration bridge so the original creator can delete it.
Related-Bug: #1333365
Closes-Bug: #1448148
Change-Id: I7ae7750b7ac7d15325ed9f2d517ca171543b53be
commit ef5b4f52749b246d8165058ff320399c9c13f5ac
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 14:29:15 2015 +0200
Enable random hash seeds
Neutron tests have been updated in order to support random hash seed. It
allows to remove PYTHONHASHSEED=0 in tox.ini and remove hashtest tox
environment.
Closes-Bug: #1348818
Change-Id: I1063304dda887eb82c0de8516d5a483fa8943fc1
Depends-On: I8408365825ec1e97a83c2181f38ec1f9468df91e
Depends-On: I1b2bd4100c19004f12822c414aefc86aae9849db
Depends-On: I5077764045a34d1be0e85bb4b80f3655e87692cc
commit 5c7e7c0ca7229ac7bb32964378a8bbef142bcdbf
Author: Joe Gordon <joe.gordon0@gmail.com>
Date: Fri May 29 14:28:34 2015 -0700
Fix formatting of core-reviewers doc
Fix some RST formatting issues with the core-reviewers policy document.
When reading the RST rendered version of that document at
http://docs.openstack.org/developer/neutron/policies/core-reviewers.html
I noticed a few rendering issues where were bothering me, so I fixed
them.
Change-Id: Ic6eedc2bb18f6bbb6424542dbf4a88ed52ebea1d
commit 422588e13338dab4a5ba1973c96256690ba4adf5
Author: Adrien Vergé <adrienverge@gmail.com>
Date: Fri May 29 22:54:33 2015 +0200
Get completely rid of contextlib.nested
`contextlib.nested` is deprecated since Python 2.7 and incompatible with
Python 3. This patch removes all its occurences by using the helper
script at [1].
This is a necessary step to allow us running all unit tests with
Python 3 (not just a small subset as it is done now).
[1]: https://github.com/adrienverge/context\_unnester
Change-Id: I8d1de09ff38ed0af9fb56f423a2c43476408e0fb
Blueprint: neutron-python3
Closes-Bug: #1428424
commit 880252868b8509125f6463e2709c2d0c4f3957ea
Author: Adrien Vergé <adrienverge@gmail.com>
Date: Mon May 25 18:46:03 2015 +0200
Fix indentation errors in tests
They are some missing/extra indentations in tests source code. This
results in variables used out their scope (which remains unnoticed as
long as `with` contexts do not fail), and prevent refactoring scripts
(such as the one for getting rid of `contextlib.nested` [1]) from
performing well.
This simple patch fixes these indentation errors.
[1]: See change I8d1de09ff38ed0af9fb56f423a2c43476408e0fb
Change-Id: Icef34c7755e0d96c4c5ee85982de86d0ccc196c7
Related-Blueprint: neutron-python3
commit 9ff8cd524621daf6cd20da939238eee14b5a231f
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 08:53:00 2015 +0200
Improve test\_set\_members\_deleting\_less\_than\_5
In test\_set\_members\_deleting\_less\_than\_5[1], 3 ips are deleted from
ipset but test\_set\_members\_deleting\_less\_than\_5 checked that the
first one was deleted because the call ordering was non-trivial.
The test was successful because
assert\_has\_calls(expected\_calls, any\_order=False) allows extra calls
before and after expected\_calls.
A parent change[2] forces the call ordering, this allows to check that
the 3 ips are deleted.
[1] neutron.tests.unit.agent.linux.test\_ipset\_manager
[2] I8408365825ec1e97a83c2181f38ec1f9468df91e
Related-Bug: #1348818
Change-Id: I773e2cd19fdec634b728d0c3a78c1d66392c743f
commit e43c037e14f0055206f16cc9549e03a3f6e43755
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 13:24:58 2015 +0000
Rename test\_periodoc\_resync\_helper to test\_periodic\_resync\_helper
Change-Id: Iaaf57b5cdbe634af8ceda0fef4c920cdb053eed4
commit 77303fbeaa060bcee2befad65dccb457fbb6ab65
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 14:38:26 2015 +0000
Sort \_get\_new/deleted\_set\_ips responses in unittests
This fixes the test\_set\_members\_adding/deleting\_less\_than\_5 unit test
that breaks with a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the \_get\_new/deleted\_set\_ips from
neutron.agent.linux.ipset\_manager return elements in a particular order.
Found with PYTHONHASHSEED=1.
The fix refactors the test case to force sorted responses from
\_get\_new/deleted\_set\_ips during unittests.
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I8408365825ec1e97a83c2181f38ec1f9468df91e
commit 359b7c971a88f6dff64e8e4d558210a880f3ee0f
Author: Ian Wienand <iwienand@redhat.com>
Date: Thu May 7 14:59:38 2015 +1000
Ensure netfilter is enabled for bridges
Since security-groups use iptables rules on Linux bridges, we need to
ensure that netfilter is enabled for bridges. Unfortunately, there
seems to be a long history of distributions having differing defaults
for this, best described in [1].
It seems at the moment everyone has to discover this for themselves;
packstack found it in Ia8c86dcb31810a8d6b133a161388604fde9bead4, then
fuel found the same thing in I8582c24706c3a7253e00569eef275f116d765bca
and then finally someone else hit it and put it into documentation
with I4ed3cec03a1b3a7d56dfe18394154ec1b2db6791. I just spent a long
time figuring it out too when deploying with devstack.
Rather than having yet another fix in devstack, I don't see why
neutron shouldn't be ensuring the setting is correct when it starts up
-- without these settings enabled, security-groups are silently
broken. This does that, and modifies test-cases to check we make the
calls.
[1] http://wiki.libvirt.org/page/Net.bridge-nf-call\_and\_sysctl.conf
Change-Id: If2d316eb8c422dc1e4f34b17a50b93dd72993a99
commit b058658780f0ccb2787c26e3e95cabcc8e2e6349
Author: Oleg Bondarev <obondarev@mirantis.com>
Date: Thu May 14 15:09:24 2015 +0300
Cleanup stale metadata processes on l3 agent sync
Currently l3 agent only cleans up stale namespaces.
The fix adds checking and deleting stale metadata processes
to NamespaceManager class responsible for clearing stale
namespaces
Change-Id: I2b081803e312589d3d8a7808d286a6c9827ef53f
Closes-Bug: #1455042
commit c23619417f51f2bbd161cc5bfe314847eb20cd19
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Fri May 29 06:16:46 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I79fd889e390b436fd92fd07951517c50a617b961
commit c9fcbc2e7758acf08867db9a7bc89685cd916bbb
Author: shihanzhang <shihanzhang@huawei.com>
Date: Tue May 26 09:29:58 2015 +0800
Fix ovs agent restore local\_vlan\_map failed
when ovs agent restart, it will restore the local\_vlan\_map, but in
some condition, if a device does not be set tag in ovsdb, the function
'db\_get\_val("Port", port.port\_name, "tag")' will return a empty list,
it does not need 'provision\_local\_vlan' for this device.
Change-Id: I70ed30e6ea5d13e6f14bb41c957320cc21dbca1b
Closes-bug: #1458709
commit a0c9745e90596d4a3207e844332e078ca7ecc5fa
Author: Kevin Benton <blak111@gmail.com>
Date: Thu May 28 16:48:04 2015 -0700
Use correct time delta function
The .seconds attribute of a timedetla object cannot be taken in
isolation because it can overflow into days. For example, a -1 second
difference will become -1 day and 86399 seconds.
This became a problem when the agent clock was slightly ahead of
the server clock. When calling (server\_time - agent\_time).seconds
in this scenario, it would go below 0 in the daily seconds and
wraparound to 86399 seconds and -1 day.
This patch corrects the issue by using a method in timeutils that
ends up calling total\_seconds(), which was designed for this usecase.
It also restores the formatting that was removed in patch:
Ibfc30444b7a167fb18ae9051a775266236d4ecce
Closes-Bug: #1456760
Change-Id: Ie90249ab68bb5f8d117872d52180c7087d8fac9b
commit 36a1d14b58028d0294e67786129a2a09ce393cde
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 20:30:28 2015 +0200
Do not assume order of security group rules
This fixes the unit tests[1] that breaks with a randomized
PYTHONHASHSEED (see the bug report).
The test assumed that the security\_group\_rules\_for\_devices method from
neutron.agent.securitygroups\_rpc returned security group rules in a
particular order. Found with PYTHONHASHSEED=2.
The fix refactors the test case to handle unsorted security group rules.
[1] neutron.tests.unit.plugins.ml2.test\_security\_group.\
TestMl2SGServerRpcCallBack.\
test\_security\_group\_rules\_for\_devices\_ipv4\_ingress\_addr\_pair
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I1b2bd4100c19004f12822c414aefc86aae9849db
commit 818a797693d828d72083ac3b98e54df59574dbe7
Author: Rich Curran <rcurran@cisco.com>
Date: Thu May 28 11:32:21 2015 -0400
ML2: Incorrect commented cisco mechanism driver name
The ml2\_conf.ini example for the cisco mechanism driver is incorrect.
Update to remove confusion.
Change-Id: I0d3aff31a3bc78ef5ee042ff1f37dbb6e1459635
Closes-Bug: 1459723
commit 24ec6e214bb32a1bd79e1c98cecf737ed1fc5d10
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Thu May 28 14:40:25 2015 +0200
py34: don't run any tests except unit tests
py34 job was intended for unit tests only. It's important to distinguish
between different types of tests, because they all have different
requirements to execution environment. E.g. functional tests are not
expected to run in a restricted env designed for unit tests, and that's
even more valid for fullstack tests.
Otherwise, the job may fail or apply irrecoverable changes to test
runner system, breaking the system.
If we ever want to support py3 for other types of tests, we should add
separate jobs just for that.
Note that the neutron-python3 blueprint was not intended to introduce
changes to support anything but unit test execution with the new Python
version, so strictly speaking, any effort to make other test types work
is out of scope.
Change-Id: Ia96f03f05269c1938b51ee26f4b4075b69967bb8
commit 2fcbbf3031fe1d326ddb2b9bb1b06e0e39422022
Author: John Schwarz <jschwarz@redhat.com>
Date: Thu May 7 09:02:59 2015 +0300
Move full-stack logs post-tests
Currently, it's up to the developer who wants to run full-stack on his
machine to make the directory in question (/opt/stack/logs). However,
this also means that the files don't get compressed at the end of a gate
run. Now, each full-stack test will have each own log directory in /tmp.
Once the logs are there, post\_test\_hook.sh can run 'gzip' on all the log
files before moving them to /opt/stack/logs on its own.
Change-Id: I5c04d0af0b9858722ae0c4baf0ee478ffb078e02
commit b4363a48214f1bb21bd7934f05a6440bb5d66bb7
Author: Cedric Brandily <zzelle@gmail.com>
Date: Thu May 28 09:07:23 2015 +0200
Fix PYTHONHASHSEED bugs in test\_security\_groups\_rpc
This fixes the test\_security\_group\_member/rule\_updated unit tests[1]
that breaks with a randomized PYTHONHASHSEED (see the bug report).
The test assumed that several dictionaries had elements in a
particular order. Found with PYTHONHASHSEED=2.
The fix refactors the test case by injecting values using the same
ordering[2].
[1] neutron.tests.unit.agent.test\_securitygroups\_rpc.\
TestSecurityGroupAgentWithOVSIptables
[2] https://github.com/openstack/neutron/blob/\
e8364a72e62d83e5a76bec1d7aa76ecfe2ed53ac/\
neutron/tests/unit/agent/test\_securitygroups\_rpc.py#L1630-L1635
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I5077764045a34d1be0e85bb4b80f3655e87692cc
commit 714c311871333c19c4d6203f79a948b184bf11cf
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Thu May 28 09:17:15 2015 +0300
Addressing follow up comments for OVS\_LIB fail\_mode setting API
Review https://review.openstack.org/#/c/185659/ got merged before i could
see and address the last comment.
This is a follow up patch to address that change
Change-Id: I19135a75cf25e03d6c1f89d7c18e8da3af2ec643
commit 88e499d1c10eaae59546d9f16c9c9c262766de84
Author: Gong Zhang <zhanggbj@cn.ibm.com>
Date: Wed May 27 17:10:17 2015 +0800
Move pool dispose() before os.fork
Currently pool dispose() is done after os.fork, but this will
produce shared DB connections in child processes which may lead
to DB errors.
Move pool dispose() before os.fork. This will remove all existing
connections in the parent process and child processes will create
their own new ones.
Change-Id: Ie36417a64f0eb39b53dad61517f834aec37bacfb
Closes-Bug: 1458718
commit 046f4a0881aa7aea5d231de83e79af12460d9910
Author: armando-migliaccio <armamig@gmail.com>
Date: Wed May 27 15:40:06 2015 -0700
Add RFE submission guidelines
Change-Id: I864c8638a92f5f94e6f059a477ffb56de274ef1c
commit 7a3934d982ef29d8851450b5586319201baa0122
Author: Kevin Benton <blak111@gmail.com>
Date: Fri May 15 17:10:15 2015 -0700
Switch to dictionary for iptables find
The code to find the matching entry was scanning through a
list of all rules for every rule. This became extremely slow
as the number of rules became large, leading to long delays
waiting for firewall rules to be applied.
This patch switches to the use of a dictionary so the cost
becomes a hash lookup instead of a list scan.
Closes-Bug: #1453264
Closes-Bug: #1455675
Change-Id: I1e6fe5e50b9c13066c966c252cadc8ed1d08f686
commit 817b45b6406d9730859535ac54d73ec5c85451d0
Author: Kevin Benton <blak111@gmail.com>
Date: Wed May 27 17:38:32 2015 -0700
Process port IP requests before subnet requests
When a port requests multiple fixed IPs, process the requests
for specific IP addresses before the ones asking for a subnet.
This prevents an error where the IP that was requested happens
to be the next up for allocation so the subnet request takes it
and causes a DBDuplicateEntry.
Closes-Bug: #1459467
Change-Id: I645565c7fe0c47c58d686b25020bb49a0b9089f5
commit 2b7e6552e82f899a91ce3d6973d90778440fac8c
Author: Kevin Benton <blak111@gmail.com>
Date: Wed May 27 14:52:06 2015 -0700
Remove time formatting in agent clock error
This removes time formatting that may be hiding timezone
issues that are leading to a delta being calculated between
the agent and the server even when it shows none. It also
adds logging of the difference so we can see how far off it
thinks they are.
Example message:
during the registration of Open vSwitch agent has a timestamp:
2015-05-19T18:15:27Z. This differs from the current server
timestamp: 2015-05-19T18:15:27Z by more than the threshold agent
downtime: 75.
Note that the timestamps are exactly the same after formatting.
Change-Id: Ibfc30444b7a167fb18ae9051a775266236d4ecce
Related-Bug: #1456760
commit 98d8ad911d07a20af18edb0cac4bcf141a83d969
Author: Kevin Benton <blak111@gmail.com>
Date: Mon May 25 18:55:44 2015 -0700
Persist DHCP leases to a local database
Due to issues caused by dnsmasq restarts sending DHCPNAKs,
change Ieff0236670c1403b5d79ad8e50d7574c1b694e34 passed the
'dhcp-authoritative' option to dnsmasq. While this solved the
restart issue, it broke the multi-DHCP server scenario because
the dnsmasq instances will NAK requests to a server ID that
isn't their own.
Problem DHCP Request Lifecycle:
Client: DHCPDISCOVER(broadcast)
Server1: DHCPOFFER
Server2: DHCPOFFER
Client: DHCPREQUEST(broadcast with Server-ID=Server1)
Server1: DHCPACK
Server2: DHCPNAK(in response to observed DHCPREQUEST with other Server-ID)
^---Causes issues
This change removes the authoritative option so NAKs are not
send in response to DHCPREQUEST's to other servers. To handle
the original issue that Ieff0236670c1403b5d79ad8e50d7574c1b694e34
was inteded to address, this patch also allows changes to be persisted
to a local lease file.
In order to handle the issue where a DHCP server may be scheduled
to another agent, a fake lease file is generated for dnsmasq to start
with. The contents are populated based on all of the known ports for
a network. This should prevent dnsmasq from NAKing clients renewing
leases issued before it was restarted/rescheduled.
Closes-Bug: #1457900
Change-Id: Idc91602bf8c474467e596cbd5cbaa8898952c841
commit 3b8113306a28eab53f0e2e30b0b58c9d8d9db452
Author: Kyle Mestery <mestery@mestery.com>
Date: Wed May 27 17:26:00 2015 +0000
Flesh out the new RFE process and set deadlines for it's use
The new RFE process is great in concept, but as was discovered in the
first neutron-drivers meeting where we discussed these, there exist
some rough edges. Specifically around deadlines and the conversion to
using RFEs, the gray area was very obvious. This patch attempts to put
a stake in the ground for when we transition fully to this new model,
including distinct timelines.
Given that we will need to work with people during the transition,
what is proposed is a way to let us do that while not blocking existing
specs and work.
Change-Id: Ife50f65caf4b13405ad60dd4be3d347aa31ef3a7
commit e135bcea472e08347fc3dc3df01aa1fa909504fb
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 19:57:04 2015 +0200
Do not assume order of dictionary elements in init\_l3
This fixes the test\_interface unit tests[1] that breaks with a
randomized PYTHONHASHSEED (see the bug report).
The test assumed that the init\_l3 method from
neutron.agent.linux.interface had dictionary elements in a particular
order. Found with PYTHONHASHSEED=2.
The fix refactors the test case to handle unsorted dictionaries in
init\_l3.
[1] neutron.tests.unit.agent.linux.test\_interface.TestABCDriver
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I1948593b4d7a0069ef060512942b548c74a6b369
commit 4beb7426587556e0592c055552e0fd70eeb7ac19
Author: Kyle Mestery <mestery@mestery.com>
Date: Fri Apr 24 16:24:39 2015 +0000
Introduce the Lieutenant system into Neutron
As Neutron has grown, the need to continually evolve the way we land
code has changed. As the project has grown, it's become obvious we
need to subdivide responsibilites and merge rights across the
repository. The advanced services split [1] was one way in which we did
this, and it's proven effective. Plugin decomposition was another [2].
As a next step to evolve things, this changes the core reviewer
paradigm into a system of Lieutenants, all reporting to the PTL in the
project. The Lieutenants will be able to maintain their own core
review team. The idea of "super cores" will fade away. And we begin to
see the benefits of a layered, structured approach to managing
Neutron.
This proposal makes an attempt to comment on existing core reviewers.
While the idea of existing core reviewers being labeled as "supercores"
has been floated, the reality is a bit more nuanced than that, and I've
taken steps to address that with this patch. It should be noted that like
all things in Neutron governance, the system is based on a mutual trust.
[1] http://specs.openstack.org/openstack/neutron-specs/specs/kilo/services-split.html
[2] http://specs.openstack.org/openstack/neutron-specs/specs/kilo/core-vendor-decomposition.html
Change-Id: Ia4060066a300e851172c0fd7a2910ce53a6c649e
commit 1e0d201f1d71ce48a096f69700e4097e460ee53a
Author: Carl Baldwin <carl.baldwin@hp.com>
Date: Tue May 26 20:33:56 2015 +0000
Isolate use of fixed\_ips[0] to avoid confusion
I was looking at the assumption around using fixed\_ips[0] in a recent
patch [1]. I thought at the least, the usage of fixed\_ips[0] should
be isolated with the comment explaining why it is okay.
I thought that we could also use this patch as an opportunity to vet
the validity of the claim made in the comment.
[1] If4a310da06f9b0076a9f62926a16b574a8c109ce
Change-Id: Iba5713dd7d852429997ff43d98266a9f022d5d86
commit 21f0fac3efd6aaa83494341aead1b6eaddb4d8fb
Author: Christian Berendt <berendt@b1-systems.de>
Date: Wed May 27 15:08:30 2015 +0200
Use the correct name for the "Repository Creator's Guide"
Change-Id: Iaa32ab4bfa658a079da08792a7355ad64471f0eb
commit ce957ac83a85a421f2e60cc39a3103291ba95e4a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 14:54:35 2015 +0200
Do not assume order of convert\_kvp\_list\_to\_dict method responses
This fixes the test\_attributes unit tests[1] that breaks with a
randomized PYTHONHASHSEED (see the bug report).
The test assumed that the convert\_kvp\_list\_to\_dict method from
neutron.api.v2.attributes returned elements in a particular
order. Found with PYTHONHASHSEED=1.
The fix refactors the test case to handle unsorted responses from
convert\_kvp\_list\_to\_dict.
[1] neutron.tests.unit.api.v2.test\_attributes.TestConvertKvp
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I864904db1428b88c482ad17a69b33e876a8d042c
commit e9d17b8bfff31072a3d017ce64e36ac99007a052
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 19:54:22 2015 +0200
Do not assume order of iptables\_firewall method responses
This fixes the iptables\_firewall group unit tests[1] that breaks with
a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the \_get\_remote\_sg\_ids and
\_determine\_remote\_sgs\_to\_remove methods from
neutron.agent.linux.iptables\_firewall returned elements in a particular
order. Found with PYTHONHASHSEED=1.
The fix refactors the test case to handle unsorted responses from
\_get\_remote\_sg\_ids and \_determine\_remote\_sgs\_to\_remove.
[1] neutron.tests.unit.agent.linux.test\_iptables\_firewall:
test\_prepare\_port\_filter\_with\_new\_members
test\_prepare\_port\_filter\_with\_sg\_no\_member
test\_remove\_port\_filter\_with\_destroy\_ipset\_chain
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: I19e51452a2bde0721559df746047239f68614336
commit 539738a8eeebcc9f22987fcb0a241c6b8c3d561a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Wed May 27 00:23:09 2015 +0200
Do not assume order of get\_sync\_data\_metering response elements
This fixes the test\_add\_metering\_label\_rpc\_call[1] unit tests that breaks
with a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the get\_sync\_data\_metering[2] had response
elements in a particular order. Found with PYTHONHASHSEED=1.
The fix refactors the test\_add\_metering\_label\_rpc\_call test case to handle
an unsorted get\_sync\_data\_metering response. The fix defines the class
UnorderedList[3] which is equal to any permutation of itself.
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
[1] neutron.tests.unit.services.metering.test\_metering\_plugin:
TestMeteringPluginL3AgentScheduler
TestMeteringPluginL3AgentSchedulerServicePlugin
[2] neutron.services.metering.metering\_plugin.MeteringPlugin
[3] neutron.tests.tools
Change-Id: I5d42b827bc72dcacd38eaa2377ce16c47a9e7dbb
commit 874fa6e02c2f91d711e8186d4e7e7e26c6dc74b9
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Wed May 27 05:10:33 2015 +0900
OVS-agent: Remove optional flags from br\_tun.deferred() method
Currently they have no users.
They are not appropriate for this higher-level interface anyway.
Change-Id: I76b8d718e714728df88685ec41262958d2e78cb9
commit 7ea278087c32235efa793c8c815aff3861410f13
Author: Gal Sagie <gal.sagie@huawei.com>
Date: Tue May 26 19:16:34 2015 +0300
OVS\_LIB support API for setting fail mode 'standalone'
The current API only support setting a bridge fail mode
to secure, this patch allow the user to set it to 'standalone'
as well
Change-Id: If7e6532dc7f8527c35834a37144ea4386fe1b861
Closes-Bug: #1458924
commit eac9fb143cf3e6f4dd2b3413f81dab92d42354ca
Author: Jack McCann <jack.mccann@hp.com>
Date: Wed Apr 15 22:32:51 2015 +0000
Remove hack for sending gratuitous arp from fip ns
I just saw this note toward bottom of the lartc [1] page: "On Linux
2.4, you may need to execute 'echo 1 >
/proc/sys/net/ipv4/ip\_nonlocal\_bind' before being able to send out
unsolicited ARP messages!" I wonder if we set that in fip ns, if it
will let us send grat arp without adding/removing the IP. It couldn't
be that easy, could it?
[1] http://lartc.org/howto/lartc.bridging.proxy-arp.html
Change-Id: Ie55b402a6c46af00c8d4875264489fc4318544b3
commit a1d679678daa560c86bb84303aee6163296ec653
Author: Cedric Brandily <zzelle@gmail.com>
Date: Tue May 26 13:14:11 2015 +0000
Force order of dhcp.needs\_resync\_reasons dictionary elements
This fixes the test\_periodoc\_resync\_helper unit test that breaks with
a randomized PYTHONHASHSEED (see the bug report).
The test assumed that the dhcp.needs\_resync\_reasons dictionary from
neutron.agent.dhcp.agent had elements in a particular order. Found with
PYTHONHASHSEED=2.
The fix refactors the test case to force a sorted dhcp.needs\_resync\_reasons
dictionary.
Partial-bug: #1348818
Note: There are several other unrelated unit tests that also break with
a randomized PYTHONHASHSEED, but they are not addressed here. They will
be addressed in separate patches.
Change-Id: Ia7fc2c3e605d92d8497d44e28054bdda613cebf2
commit 8ee3020c47cd7eb716216852a90c3db595e2c3c6
Author: ankitagrawal <ankit11.agrawal@nttdata.com>
Date: Thu May 14 05:19:44 2015 -0700
Remove use of contextlib.nested (api-tests)
Removed use of contextlib.nested call from codebase, as it has been
deprecated since Python 2.7.
There are also known issues with contextlib.nested that were addressed
by the native support for multiple "with" variables. For instance, if
the first object is created but the second one throws an exception,
the first object's \_\_exit\_\_ is never called. For more information see
https://docs.python.org/2/library/contextlib.html#contextlib.nested
contextlib.nested is also not compatible with Python 3.
Multi-patch set for easier chunks. This one addresses the tests from
neutron/tests/unit/api directory.
Line continuation markers (e.g. '\') had to be used or syntax
errors were thrown. While using parentheses is the preferred way
for multiple line statements, but in case of long with statements
backslashes are acceptable.
Partial-Bug: 1428424
Change-Id: I09673f9d4c7f07d3043804676fef018905dd1239
commit f0decf6a4061be18999c87eab6ae152d9f75f99f
Author: Angus Lees <gus@inodes.org>
Date: Fri May 15 17:54:18 2015 +1000
Use os.\_exit after forking
As the docs point out(\*), \_exit should be used after a fork() to avoid
both processes flushing filehandles, calling destructors with side
effects, etc. This change does just that.
(\*) https://docs.python.org/2/library/os.html#os.\_exit
Change-Id: I68da6283c44ab8857baf217ac1443bd17988257d
commit 54e91b01cf7b311f48a40c14c7f9c1d8c0926ab4
Author: Angus Lees <gus@inodes.org>
Date: Fri May 15 17:50:33 2015 +1000
test\_fork\_error: Fix incorrect test mock
The previous os.fork mock returned a \*function\* that returned an OSError
object. Oops.
Change-Id: I6e5dff930cf5614f7061efdfd8429963703cc214
commit 9fc7f56565925a53f2212706431af479752bb8d9
Author: Henry Gessau <gessau@cisco.com>
Date: Mon May 25 18:00:58 2015 -0400
Skip external tables for neutron-db-manage --autogenerate
DB tables that do not have models in the neutron tree cause
neutron-db-manage --autogenerate to create commands to drop the
tables. This fix hooks into alembic's environment with a include\_object
callback that ignores external tables.
We already had a list of external tables for use by the migration tests,
so re-use them for --autogenerate.
Partial-bug: #1458682
Change-Id: I2c0bc73f72840c401c578e87d8178a79f05aad82
commit c79d68a7ed347539026acf4c2347740adc617580
Author: Sergey Kolekonov <skolekonov@mirantis.com>
Date: Mon May 25 18:11:35 2015 +0300
Fix a typo in \_schedule\_network method
Fix the small typo which prevented from writing correct DHCP agent id to logs
Change-Id: Id8a872815f7cb2ba68ff1c674f17777da7858562
commit 3682e3391f188845d0c7f382f0ccd4b38db3904e
Author: Cedric Brandily <zzelle@gmail.com>
Date: Mon May 4 23:36:19 2015 +0200
Ensure non-overlapping cidrs in subnetpools without galera
\_get\_allocated\_cidrs[1] locks only allocated subnets in a subnetpool
(with mysql/postgresql at least). It ensures we don't allocate a cidr
overlapping with existent cidrs but nothing disallows a concurrent
subnet allocation to create a subnet in the same subnetpool.
This change replaces the lock on subnetpool subnets by a lock on the
subnetpool itself. It disallows to allocate concurrently 2 subnets in
the same subnetpool and ensure non-overlapping cidrs in the same
subnetpool.
Moreover this change solves a trouble with postgresql which disallows
to lock an empty select with an outer join: it happens on first subnet
allocation in a subnetpool when no specific cidr is provided. Moving
the lock ensures the lock is done on a non-empty select.
But this change does not ensure non-overlapping cidrs in subnetpools
with galera because galera doesn't support SELECT FOR UPDATE locks. A
follow-up change will (try to?) remove locks from subnet allocation[1]
in order to ensure non-overlapping cidrs in subnetpools also with galera.
[1] in neutron.ipam.subnet\_alloc.SubnetAllocator
Closes-Bug: #1451558
Partial-Bug: #1451576
Change-Id: I73854f9863f44621ae0d89c5dc4893ccc16d07e4
commit 5f28762ae2a96b8062628d0cac81f5da94c6ed34
Author: John Schwarz <jschwarz@redhat.com>
Date: Thu Apr 16 12:01:26 2015 +0300
Add callback prior to deleting a subnet
When using LBaaS and trying to delete a subnet, neutron has no way of
knowing if the subnet is associated to some pool. As a result, the
subnet is deleted but the pool remains associated to the (now
nonexistent) subnet\_id. This patch lays the ground-work for adding a
check in LBaaS' side to prevent such cases.
Related-Bug: #1413817
Change-Id: I3d5e231b67c72ffd919c92d65b57da56c63e053c
commit eab71473c3a1d40ec3f1d8a84b839b06b140e4fe
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Mon Mar 2 13:14:48 2015 +0900
OVS-agent: Separate ovs-ofctl using code as a driver
This is a preparation to introduce another Ryu-based implementation.
The aim is to replace this with the new Ryu-based implementation
eventually.
Add a config option for OVS-agent which selects the implementation.
Currently, the only available choice is 'ovs-ofctl'.
Also, this commit simplifies DVR logics by reducing duplications
and makes some of DVR UTs actually check the flows rather than just
"add\_flow is called".
Partially-Implements: blueprint ovs-ofctl-to-python
Change-Id: Ie1224f8a1c17268cd7d1c474ed82fdfb8852eaa8
commit 3425be06bf069a256dbb0fdb9528459544e9947f
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon May 25 06:15:25 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If91cdcd85d6fad9b9d37aea367aa11c83ff4b343
commit 514245d63fe902e4548829b9bb66fa60c86509f1
Author: Gary Kotton <gkotton@vmware.com>
Date: Sun May 24 21:19:51 2015 -0700
Remove unnecessary brackets
TrivialFix
Change-Id: I9bd552110785c09b3eaa8762a8141446e51ea02a
commit 9b893767a5214177e30f596b6eed8324278d5050
Author: Anand Shanmugam <anand1712@gmail.com>
Date: Sat May 23 01:22:23 2015 -0700
Ensure mac address added to iptables is always in unix format
When a allowed address pair entry is added with a mac format
other than unix format the ovs-vs agent keeps on restarting as
it is not able to save the proper iptables due to the error
"Error while processing VIF ports". This fix makes sure
that the mac address sent to the iptables firewall is always
in the unix format
Change-Id: I86bbf3cb2adf9b998190e472691c01d068ebab9c
Closes-Bug: #1457971
commit 032847b3030106a9e605b3088826b599789d7991
Author: ankitagrawal <ankit11.agrawal@nttdata.com>
Date: Thu May 14 04:08:36 2015 -0700
Remove use of contextlib.nested
Removed use of contextlib.nested call from codebase, as it has been
deprecated since Python 2.7.
There are also known issues with contextlib.nested that were addressed
by the native support for multiple "with" variables. For instance, if
the first object is created but the second one throws an exception,
the first object's \_\_exit\_\_ is never called. For more information see
https://docs.python.org/2/library/contextlib.html#contextlib.nested
contextlib.nested is also not compatible with Python 3.
Multi-patch set for easier chunks. This one addresses the
neutron/plugins/ml2 directory.
Line continuation markers (e.g. '\') had to be used or syntax
errors were thrown. While using parentheses is the preferred way
for multiple line statements, but in case of long with statements
backslashes are acceptable.
Partial-Bug: 1428424
Change-Id: I7bbe4cec511125b4b2c954aa93e2d9ff6871b9e0
commit 3d2543d710c7071ffeb5c9857ac30a4d95695a7b
Author: dql <duquanglong@gmail.com>
Date: Mon Mar 9 12:52:11 2015 +0800
fix DHCP port changed when dhcp-agent restart
When DHCP server is started, the periodic task is running
before loading cache state.The method port\_update\_end
need to use the cache information, but the cache information
has not been loaded.
Change-Id: I0d1da11bb559b7f0f9d4428b82573fb26916a933
Closes-Bug: #1420042
commit b892df11264de5737e1247862b093ede5d2f5954
Author: Salvatore Orlando <salv.orlando@gmail.com>
Date: Fri Jan 16 10:00:42 2015 -0800
IPAM reference driver
An alternate pluggable IPAM implementation from the built-in one
in db\_base\_plugin\_v2.
Modifies IPAM interface to allow passing context to driver and
introduces new interface method 'associate\_neutron\_subnet'.
Implements blueprint reference-ipam-driver
Change-Id: I2e1e9fc7994bf1157bcd34b7ea500eb30c61d9ab
commit 676db821ebaf3cce5ce89f4d5d55fcbd772c079b
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Mon May 18 20:49:05 2015 +0000
ovs-agent: prevent ARP requests with faked IP addresses
This patch extends the existing ARP protection to ensure
that ARP requests also have valid IP addresses.
Closes-Bug: 1456333
Change-Id: I0b2ba21611c9fd9e304bce8cfb00259db1dceaa2
commit b91c4e3f874407de07feef338aa2f9a0faafdadd
Author: Cedric Brandily <zzelle@gmail.com>
Date: Fri May 15 18:10:09 2015 +0200
Use namespace names in NetcatTester
Currently NetcatTester requests namespace IPWrapper instances as
client/server\_namespace arguments but functional tests commonly use
namespace names as arguments not IPWrapper instances (because IPWrapper
is cheap to instantiate) and NetcatTester needs only namespace names.
This change requests names as NetcatTester client/server\_namespace
arguments in order to simplify NetcatTester and its use.
Change-Id: Ic4a297efdeaef00e70892d1c871ce1c9174055b8
commit cc1efd085524cd30d6a238a584df193133d27015
Author: John Schwarz <jschwarz@redhat.com>
Date: Thu May 7 15:22:41 2015 +0300
Support for concurrent full-stack tests
This patch introduces the last step of complete test separation for
full-stack tests - separate rabbitmq queues - in the form of rabbitmq
virtual hosts.
\* This patch also renames EnvironmentFixture to FullstackFixture, for
clarity.
Change-Id: I24776e3970a73fdd3271023da7967f2c7261621b
Closes-bug: #1452737
commit 8dbacebf6752e7654afbf9451388b42d4d6355a9
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Fri May 15 11:33:51 2015 +0900
OVS-DVR: Suppress a confusing error log about csnat port
Complain only when the port was seen on a different subnet.
Change-Id: If4a310da06f9b0076a9f62926a16b574a8c109ce
commit dca3cdfae936ae20fcbac392cfde45c7f4d87e45
Author: YAMAMOTO Takashi <yamamoto@valinux.co.jp>
Date: Fri Apr 24 13:49:02 2015 +0900
OVS-DVR: Improve an error log about csnat port
Use a single LOG.error per message rather than per lines.
Also, print both of old and new subnets.
Change-Id: I162d3d178fec8b84b66fdfd5a037c2d858c47e30
commit 2acdbf3bac7f4a967e2ef8f98b2ac14fa0f7f861
Author: watanabe.isao <zou.yun@jp.fujitsu.com>
Date: Fri Feb 20 17:38:16 2015 +0900
When disabling dhcp, delete fixed ip properly
When setting enable\_dhcp parameter of subnet to False, the fixed ip of
dhcp port of this subnet is not been removed.
Also a resync will be triggered.
Change-Id: Iebd2c7922978bec0ef154866f24319e899e3b88e
Closes-Bug: 1417379
commit 0ace88fd4a75ff213dc36fd16c1f8e7080ab7d6d
Author: Robert Li <baoli@cisco.com>
Date: Fri May 8 11:08:45 2015 -0400
Add VIF\_DELETED notification event to Nova
It's possible to delete a neutron port that is currently associated
with an instance. When it happens, neutron should notify nova of the
port deletion event so that Nova can take proper actions.
Refer to I998b6bb80cc0a81d665b61b8c4a424d7219c666f for the nova patch
that handles the event.
Change-Id: Iff88cd12ae18017ef3e776821bcf3ecf3b4f052f
Related-Bug: #1333365
Related-Bug: #1448148
commit 6d15bf48ee27ceab64e88f81ba6433058313759a
Author: Cedric Brandily <zzelle@gmail.com>
Date: Sat May 9 00:52:29 2015 +0200
Remove from BridgeDevice homemade execute in namespace
Currently BridgeDevice[1] defines homemade execute with namespace
support but could use IPWrapper. This change replaces homemade
implementation with IPWrapper use to respect DRY principle.
[1] neutron.agent.linux.bridge\_lib
Change-Id: I12d4d40432e57ce8b6960276c41321c1efd98705
commit 5099c884c6b09ad0979a560648e8806eaa4642f7
Author: Gary Kotton <gkotton@vmware.com>
Date: Wed May 6 22:49:17 2015 -0700
VMware: update supported plugins
Add all of the supported plugins to the VMware plugin.py file.
The supported plugins are:
- NSX MH
- NSXv
- Simple DVS (this does not support security groups and any layer
functionality). Useful for testing of Neutron with VC.
Change-Id: I9e5c779127ff44674cb60f3c19d4b5c8bdae6101
commit 8e24c7ef566fac7a41b40a12d3480fbdd0ab252b
Author: Miguel Angel Ajo <mangelajo@redhat.com>
Date: Thu Apr 16 06:28:38 2015 +0000
Reduce prefix and suffix length in ipsets
The new NET prefix introduced by I8177699b157cd3eac46e2f481f47b5d966c49b07
increases collision chances by trimming the sg\_id by 3 more chars.
This patch reduces the prefix to 1 single char and also reduces the
swap suffix to reduce the chances of collision.
Change-Id: I8a1559e173a05b2297c5cd2efa9fee7627b88a4f
Related-Bug: #1439817
Related-Bug: #1444397
commit 5509839e0af89467eb14ee178807e2898202101b
Author: Yalei Wang <yalei.wang@intel.com>
Date: Thu Mar 26 15:49:13 2015 +0800
Add port-security extension API test cases
Netron ml2 plugin introduces a new extension port-security from Kilo cycle,
this patch add the API test cases for it. It verifies the default value of the
attribute, for network and port. And It also verifies the confict between
setting port-security and sec-group/address-pairs.
Change-Id: Ie0ec090e8fdce7dbdbce14ef47f38e8e57f262d4
Partially Implements: blueprint ml2-ovs-portsecurity
Depends-On: I3035317c83d22804855517434bd8578719ce0436
commit b85cfa96118d73ad87b150e488f295cbf9a2c140
Author: Darragh O'Reilly <darragh.oreilly@hp.com>
Date: Fri Feb 27 08:23:24 2015 +0000
Fix dhcp \_test\_sync\_state\_helper asserting calls wrong
It was using a non-existing method that did nothing and
that masked other problems with the tests that used it.
Changed to use assert\_has\_calls() and fixed the problems
that fell out.
Change-Id: I4a64c3365f9958b14c2384932a31da2ce191e2e2
Closes-Bug: 1426265
commit a377b4fc95f58749178b881d0104ecfaa0b26714
Author: Yalei Wang <yalei.wang@intel.com>
Date: Tue Apr 21 15:17:13 2015 +0800
Fix port creation verification of the port-security extension
When port is created, we should check the content of the security-group and
address-pairs like we do when port updated.
This patch also updates address-pairs testing unskipping some
port-security-related tests.
Change-Id: Ia27881a34ff99cad34c84764d2bf8a6cdf77af9c
Closes-Bug: #1446087
commit 7260e0e3fc2ea479e80e0962624aca7fd38a1f60
Author: Henry Gessau <gessau@cisco.com>
Date: Mon Apr 27 09:59:21 2015 -0400
Run radvd as root
During the refactoring of external process management radvd lost
its root privileges.
Closes-bug: 1448813
Change-Id: I84883fe81684afafac9b024282a03f447c8f825a
(cherry picked from commit a5e54338770fc074e01fa88dbf909ee1af1b66b2)
commit 4e71c48bbfd5e8b8c59f0c45ade52ba8eddc8b63
Author: rossella <rsblendido@suse.com>
Date: Thu Jan 15 16:15:23 2015 +0100
Add devices to update in RPC call security\_groups\_provider\_updated
When a security\_groups\_provider\_updated is received then a global
refresh of the firewall is performed. This can be avoided if the
plugins pass as parameter of the call the devices that belongs to
the network updated.
Partially-Implements: blueprint restructure-l2-agent
Change-Id: I1e78f3a5ec7e5c5bcba338a0097566422411ef7e
commit d37e566dcadf8a540eb5f84b668847fa192393a1
Author: Kevin Benton <blak111@gmail.com>
Date: Fri Apr 24 00:35:31 2015 -0700
Don't resync on DHCP agent setup failure
There are various cases where the DHCP agent will try to
create a DHCP port for a network and there will be a failure.
This has primarily been caused by a lack of available IP addresses
in the allocation pool. Trying to fix all availability corner cases
on the server side will be very difficult due to race conditions between
multiple ports being created, the dhcp\_agents\_per\_network parameter, etc.
This patch just stops the resync attempt on the agent side if a failure
is caused by an IP address generation problem. Future updates to the subnet
will cause another attempt so if the tenant does fix the issue they will
get DHCP service.
Change-Id: I0896730126d6dca13fe9284b4d812cfb081b6218
Closes-Bug: #1447883
(cherry picked from commit db9ac7e0110a0c2ef1b65213317ee8b7f1053ddc)
commit 38211ae67cb76ade85b08c028b6e88bfc867afc9
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Mon Apr 20 17:06:38 2015 +0200
tests: confirm that \_output\_hosts\_file does not log too often
I3ad7864eeb2f959549ed356a1e34fa18804395cc didn't include any regression unit
tests to validate that the method won't ever log too often again,
reintroducing performance drop in later patches. It didn't play well
with stable backports of the fix, where context was lost when doing the
backport, that left the bug unfixed in stable/juno even though the patch
was merged there [1].
The patch adds an explicit note in the code that suggests not to add new
log messages inside the loop to avoid regression, and a unit test was
added to capture it.
Once the test is merged in master, it will be proposed for stable/juno
inclusion, with additional changes that would fix the regression again.
Related-Bug: #1414218
Change-Id: I5d43021932d6a994638c348eda277dd8337cf041
(cherry picked from commit 3b74095a935f6d2027e6bf04cc4aa21f8a1b46f2)
commit 53b3e751f3c7b32bed48c14742d3dd3a1178d00d
Author: Maru Newby <marun@redhat.com>
Date: Thu Apr 9 17:00:57 2015 +0000
Double functional testing timeout to 180s
The increase in ovs testing is resulting in job failure due to
timeouts in test\_killed\_monitor\_respawns. Giving the test more
time to complete should reduce the failure rate.
Change-Id: I2ba9b1eb388bfbbebbd6b0f3edb6d5a5ae0bfead
Closes-Bug: #1442272
(cherry picked from commit 81098620c298394e1a98127ceeba7f297db2d906)
commit 0536ec113bc438265ba547bb8a8006aa96e646e3
Author: watanabe.isao <zou.yun@jp.fujitsu.com>
Date: Wed Apr 15 15:48:08 2015 +0900
Restrict subnet create/update to avoid DHCP resync
As we know, IPs in subnet CIDR are used for
1) Broadcast port
2) Gateway port
3) DHCP port if enable\_dhcp is True, or update to True
4) Others go into allocation\_pools
Above 1) to 3) are created by default, which means if CIDR doesn't
have that much of IPs, subnet create/update will cause a DHCP resync.
This fix is to add some restricts to the issue:
A) When subnet create, if enable\_dhcp is True, /31 and /32
cidrs are forbidden for IPv4 subnets while /127 and /128 cidrs are
forbidden for IPv6 subnets.
B) When subnet update, if enable\_dhcp is changing to True and there are no
more IPs in allocation\_pools, the request should be denied.
Change-Id: I2e4a4d5841b9ad908f02b7d0795cba07596c023d
Co-authored-by: Andrew Boik <dboik@cisco.com>
Closes-Bug: #1443798
(cherry picked from commit 0c1f96ad5a6606c1205bd50ea944c3a383892cde)
commit cbfb3e487d97998ec49d7faa751bc26202da7d0e
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Apr 20 22:26:22 2015 -0700
Only update MTU in update code for MTU
The ML2 create\_network\_db was re-passing in the entire network
with extensions like vlan\_transparency present that was causing
issues in the base update function it was calling.
This corrects the behavior by having it only update the MTU, which
is the only thing it was intending to update in the first place.
Change-Id: I723c5c138e0830de98f6024c7635ec65065e9346
Closes-Bug: #1446784
(cherry picked from commit f85de393c469d1e649a1c1e5ee1b683246442351)
commit 9bc812e92fb27b297ccfe960267dcab173aea6c9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Apr 23 02:15:06 2015 +0000
Updated from global requirements
Change-Id: I514c65fac38ef0e534e7401a5f3643b1906adea7
commit aa57c364defec8519bbed06fbce5aae4b23f147f
Author: Jakub Libosvar <libosvar@redhat.com>
Date: Wed Apr 22 16:47:33 2015 +0200
Create bridges in ovsdb monitor functional tests
The test waits inside for output from 'ovsdb-client monitor Bridge'
command but the command makes output only if there is a bridge present
in ovsdb. This patch adds an OVSBridgeFixture to setup so every test
case has a bridge for sure.
Change-Id: I40e1c99ec956c92fa1c7763eb98f7f2ce6fcd226
Closes-Bug: 1447191
commit d506b50badda7af30d1154561acd45caef44ca11
Author: Andy Hill <hillad@gmail.com>
Date: Mon Apr 20 13:00:28 2015 -0400
Add use\_slave DB api support
The example configuration refers to slave\_connection[1] but slaves aren't used
in the codebase. This change will enable plugin authors to use
slave\_connection by passing use\_slave=True to the SQLAlchemy session[2][3].
[1] http://docs.openstack.org/juno/config-reference/content/section\_neutron.conf.html
[2] http://docs.openstack.org/developer/oslo.db/api/sqlalchemy/session.html#oslo\_db.sqlalchemy.session.EngineFacade.get\_session
[3] https://wiki.openstack.org/wiki/Slave\_usage
Change-Id: I6f46c11fad5c58577654a4011cf82d19f6d3e1e3
commit 407be289360ec6dabbbe14d9b18dae7c9fa2db79
Author: Kawaguchi <ken-kawaguchi@vt.jp.nec.com>
Date: Tue Apr 21 13:27:52 2015 +0900
Fix typo acomplished => accomplished
Change-Id: I73722e9984917a5a8c4e74207cf14d4040a7cf2f
Related-Bug: #1390035
commit b339391bcb223c0f03d30f36dea47d13adb12c71
Author: mathieu-rohon <mathieu.rohon@gmail.com>
Date: Sat Mar 7 13:30:49 2015 +0100
ML2: Change port status only when it's bound to the host
Currently, nothing prevents the port status to be changed to BUILD
state when get\_device\_details() is sent by a host that doesn't own
the port.
In some cases the port might stay in BUILD state.
This could happen during a live-migration, or for multi-hosted ports
such as HA ports.
This commit allows the port status modification only if the port
is bound to the host that is asking for it.
Closes-Bug: #1439857
Closes-Bug: #1438040
Closes-Bug: #1416933
Change-Id: I9b3673f453abbafaaa4f78542fcfebe8dc93f2bb
(cherry picked from commit 9b53b82ce7dad551ebc0f02ff667d5345fb7e139)
commit f7ae3a04b541767c638fc4c8ff1e0db78ab94996
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:07:37 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Change-Id: I1b7bd1773bcd12ab282e77ee0dc41c27846fb66b
commit 952e556e4e6b0e25ca584481ef6745fc08ace970
Author: Matt Riedemann <mriedem@us.ibm.com>
Date: Fri Apr 17 08:47:35 2015 -0700
Register ibm-db-alembic import for DB2 migrations
This patch adds the optional runtime dependency to support db2
for alembic migration, will not break the default mysql path.
This is needed for the IBM DB2 third party CI to work on this
project.
Closes-Bug: 1442524
Change-Id: I9db112dbdc2d02df88ad676a6b21018f1d6f1724
commit e2f6902315de76a1020aa87ea161c8fdc6697ed7
Author: Swaminathan Vasudevan <swaminathan.vasudevan@hp.com>
Date: Tue Apr 14 21:34:33 2015 -0700
Fixes race condition and boosts the scheduling performance
This patch fixes a race-condition that occurs when the
scheduler tries to check for dvr serviceable ports before
it schedules a router when a subnet is associated with
a router.
Sometimes the dhcp port creation is delayed and so the
router is not scheduled to the l3-agent.
Also it boosts the scheduling performance on dvr-snat
node for scheduling a router.
This patch will provide a work around to fix this race
condition and to boost the scheduling performance
by scheduling a router on a dvr-snat when
dhcp is enabled on the provided subnet, instead of checking
all the available ports on the subnet.
Closes-Bug: #1442494
Change-Id: I089fefdd8535bdc9ed90b3230438ab0bfb6aab4f
(cherry picked from commit c65d3ab6ad4589e6e4a6b488d2eb5d1e4cfee138)
commit a6b2c22dcea73754dbfd0ef39c60ad28ab2dbb73
Author: Kevin Benton <blak111@gmail.com>
Date: Mon Mar 30 23:52:56 2015 -0700
Set IPset hash type to 'net' instead of 'ip'
The previous hash type was 'ip' and this caused a major
issue with the allowed address pairs extension since it
results in CIDRs being passed to ipset. When the hash type
is 'ip', a CIDR is completely enumerated into all of its
addresses so 10.100.0.0/16 results in ~65k entries. This
meant a single allowed\_address\_pairs entry could easily
exhaust an entire set.
This patch changes the hash type to 'net', which is designed
to handle a CIDRs as a single entry.
This patch also changes the names of the ipsets because
creating an ipset with different parameters will cause an
error and our ipset manager code isn't robust enough to handle
that at this time. There is another ongoing patch to fix
that but it won't be ready in time.[1]
The related bug was closed by increasing the set limit, which
did alleviate the problem. However, this change would also
address the issue because the gate tests run an allowed address
pairs extension test with the CIDR mentioned above.
1. I59e2e1c090cb95ee1bd14dbb53b6ff2c5e2713fd
Related-Bug: #1439817
Closes-Bug: #1444397
Change-Id: I8177699b157cd3eac46e2f481f47b5d966c49b07
(cherry picked from commit a38b5df5cd3c47672705aad4c30e789ae11ec958)
commit 8b8095e43a143426c501669167490d7867a55749
Author: Kevin Benton <blak111@gmail.com>
Date: Tue Mar 31 08:53:56 2015 -0700
Revert "Add ipset element and hashsize tunables"
This reverts commit b5b919a7a3569ccb93c3d7d523c1edfaeddb7cb9.
The current ipset manager code isn't robust enough to handle
ipsets that already exist with different parameters. This reverts
the ability to change the parameters so we don't break upgrades
to Kilo.
Conflicts:
neutron/agent/linux/ipset\_manager.py
neutron/tests/unit/agent/linux/test\_ipset\_manager.py
Change-Id: I538714df52424f0502cb75daea310517d1142c42
Closes-Bug: #1444201
(cherry picked from commit 03be14a569d240865dabff8b4c30385abf1dbe62)
commit 2add4e5ad4d12c817737d04ddb973b3aeeb25af3
Author: Kevin Benton <blak111@gmail.com>
Date: Thu Apr 16 16:27:38 2015 -0700
Update .gitreview to point to stable/kilo
This is the stable/kilo branch. When people make changes
here it's highly likely that they want to propose them
to stable/kilo on gerrit.
Change-Id: Ie61a9f0c0b0b4896da33a201e42b1c4bc4bae49b
commit ffc48f286e1756302d9259dc514dd562d3c251ba
Author: Henry Gessau <gessau@cisco.com>
Date: Thu Apr 16 13:38:46 2015 -0400
Add Kilo release milestone
Change-Id: Id7d969c92b7c757b766760681357ac13c8079ca3
commit 1dc98e414f200a78a6b1dc78f222c588646e6935
Author: Dane LeBlanc <leblancd@cisco.com>
Date: Thu Apr 9 10:32:33 2015 -0400
IPv6 SLAAC subnet create should update ports on net
If ports are first created on a network, and then an IPv6 SLAAC
or DHCPv6-stateless subnet is created on that network, then the
ports created prior to the subnet create are not getting
automatically updated (associated) with addresses for the
SLAAC/DHCPv6-stateless subnet, as required.
Change-Id: I88d04a13ce5b8ed4c88eac734e589e8a90e986a0
Closes-Bug: 1427474
Closes-Bug: 1441382
Closes-Bug: 1440183
(cherry picked from commit bd1044ba0e9d7d0f4752c891ac340b115f0019c4)
commit 55536a4ecb6c71e5451b8a9664d87e32146f071d
Author: Ihar Hrachyshka <ihrachys@redhat.com>
Date: Fri Apr 10 15:07:33 2015 +0200
Removed ml2\_conf\_odl.ini config file
The file is already packaged into decomposed networking-odl repo [1].
[1]: https://git.openstack.org/cgit/stackforge/networking-odl/tree/etc/neutron/plugins/ml2/ml2\_conf\_odl.ini
Closes-Bug: #1442615
Change-Id: Ic280454190aab4e3b881cde15a882808b652861e
(cherry picked from commit b3334eca0ae9f9c64ccd646035e69081f669e3e4)
commit 857322c30ecfed11e770f0aea7b234f8ffdc0db1
Author: Ann Kamyshnikova <akamyshnikova@mirantis.com>
Date: Wed Mar 4 15:50:07 2015 +0300
Use accessors instead of private attributes for Ml2 plugin
Start using accessors instead of private attributes of PortContext
and NetworkContext where it is possible.
Closes-bug: #1424587
Change-Id: Ie3d963ae6cee9782d65ba683936072602c78ebaa
commit 40783cee5e520173a4cc37c23dd97be2d37b65fd
Author: Angus Lees <gus@inodes.org>
Date: Mon Mar 2 17:06:54 2015 +1100
Ensure tests run under python2.7
tox uses whatever python version that tox ran with as the default python
version for environments (py27,py3x, etc are given a more specific
default).
Debian's python-tox (for example) uses python3, but we require python2.7
- and a naive `apt-get install python-tox; tox -epep8` fails with
py3-related errors on Debian.
This change explicitly sets `basepython = python2.7` in several testing
environments that would otherwise have used the default basepython.
Change-Id: I377ac6d72dec5b85c105d8a1a74f6974efb84dcf

| **tags**: | added: in-feature-pecan |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-02:  [**Fix merged to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/79) |  |  | [#79](/neutron/%2Bbug/1461054/comments/79) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/194697>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=9ff6138c47c95034ba845e9448ddffd147b51f38>

Submitter: Jenkins

Branch: stable/kilo

commit 9ff6138c47c95034ba845e9448ddffd147b51f38

Author: Aaron Rosen <email address hidden>

Date: Wed Jun 3 16:19:39 2015 -0700

Provide work around for 0.0.0.0/0 ::/0 for ipset

Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if

    these addresses were inputted as allowed address pairs. This causes

    ipset to raise an error as it does not work with zero prefix sizes.

    To solve this problem we use two ipset rules to represent this:

Ipv4: 0.0.0.0/1 and 128.0.0.1/1

    IPv6: ::/1' and '8000::/1

All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager

    which is called to convert the input.

Conflicts:

     neutron/agent/linux/ipset\_manager.py

     neutron/tests/unit/agent/linux/test\_ipset\_manager.py

Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75

    Closes-bug: 1461054

Reviewed: https://review.openstack.org/194697
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=9ff6138c47c95034ba845e9448ddffd147b51f38
Submitter: Jenkins
Branch: stable/kilo
commit 9ff6138c47c95034ba845e9448ddffd147b51f38
Author: Aaron Rosen <aaronorosen@gmail.com>
Date: Wed Jun 3 16:19:39 2015 -0700
Provide work around for 0.0.0.0/0 ::/0 for ipset
Previously, the ipset\_manager would pass in 0.0.0.0/0 or ::/0 if
these addresses were inputted as allowed address pairs. This causes
ipset to raise an error as it does not work with zero prefix sizes.
To solve this problem we use two ipset rules to represent this:
Ipv4: 0.0.0.0/1 and 128.0.0.1/1
IPv6: ::/1' and '8000::/1
All of this logic is handled via \_sanitize\_addresses() in the ipset\_manager
which is called to convert the input.
Conflicts:
neutron/agent/linux/ipset\_manager.py
neutron/tests/unit/agent/linux/test\_ipset\_manager.py
Change-Id: I8c6a08e0cf3b5b5386fe03af9f2174c666b8ac75
Closes-bug: 1461054

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-07-02

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-09:  [**Related fix merged to neutron (stable/kilo)**](/neutron/%2Bbug/1461054/comments/80) |  |  | [#80](/neutron/%2Bbug/1461054/comments/80) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/194742>

Committed: <https://git.openstack.org/cgit/openstack/neutron/commit/?id=88d76bc37f242ab89865cbe4e25cc5e928495d91>

Submitter: Jenkins

Branch: stable/kilo

commit 88d76bc37f242ab89865cbe4e25cc5e928495d91

Author: Kevin Benton <email address hidden>

Date: Wed Jun 3 15:20:27 2015 -0700

Skip ARP protection if 0.0.0.0/0 in addr pairs

Don't setup ARP protection on ports with allowed address pairs

    that allow them to use any IP address. This is necessary because

    OVS doesn't support the /0 prefix in rules that match on ARP headers.

Related-Bug: #1461054

    Closes-Bug: #1468009

    Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec

    (cherry picked from commit 747738d36572079307f228a861a067ca0cd815c2)

Reviewed: https://review.openstack.org/194742
Committed: https://git.openstack.org/cgit/openstack/neutron/commit/?id=88d76bc37f242ab89865cbe4e25cc5e928495d91
Submitter: Jenkins
Branch: stable/kilo
commit 88d76bc37f242ab89865cbe4e25cc5e928495d91
Author: Kevin Benton <blak111@gmail.com>
Date: Wed Jun 3 15:20:27 2015 -0700
Skip ARP protection if 0.0.0.0/0 in addr pairs
Don't setup ARP protection on ports with allowed address pairs
that allow them to use any IP address. This is necessary because
OVS doesn't support the /0 prefix in rules that match on ARP headers.
Related-Bug: #1461054
Closes-Bug: #1468009
Change-Id: I913a86f22b228aa11fa3dabd9493c3995198f7ec
(cherry picked from commit 747738d36572079307f228a861a067ca0cd815c2)

| **tags**: | added: in-stable-kilo |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-07-10

| **description**: | updated |
| --- | --- |

[Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann)
on 2015-07-29

| Changed in neutron: | |
| --- | --- |
| **milestone**: | none → liberty-2 |
| **status**: | Fix Committed → Fix Released |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-10-15

| Changed in neutron: | |
| --- | --- |
| **milestone**: | liberty-2 → 7.0.0 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andrey Kirilochkin (andreika-mail)](https://launchpad.net/~andreika-mail) wrote on 2017-07-14: |  |  | [#81](/neutron/%2Bbug/1461054/comments/81) |
| --- | --- | --- | --- |

only this works for me

1.0.0.0.0/1

128.0.0.0/1

This solution did not worked for me.

0.0.0.0.0/1

128.0.0.0/1

only this works for me
1.0.0.0.0/1
128.0.0.0/1
This solution did not worked for me.
0.0.0.0.0/1
128.0.0.0/1

[See full activity log](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/neutron/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/neutron/%2Bbug/1461054/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [fix\_ipset\_validation\_bug.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4409471/%2Bfiles/fix_ipset_validation_bug.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4409471 "Change patch details")
* [fix\_ipset\_validation\_bug\_kilo.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410605/%2Bfiles/fix_ipset_validation_bug_kilo.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410605 "Change patch details")
* [juno-reject-prefix-zero.diff](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4412213/%2Bfiles/juno-reject-prefix-zero.diff)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4412213 "Change patch details")
* [zero\_length\_addressses\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413508/%2Bfiles/zero_length_addressses_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413508 "Change patch details")
* [fix\_for\_juno.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4413521/%2Bfiles/fix_for_juno.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4413521 "Change patch details")
* [fix\_for\_juno\_2.patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4415238/%2Bfiles/fix_for_juno_2.patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4415238 "Change patch details")

* [Add patch](/neutron/%2Bbug/1461054/%2Baddcomment?field.patch=on)

## Bug attachments

* [arp00000patch](https://bugs.launchpad.net/neutron/%2Bbug/1461054/%2Battachment/4410106/%2Bfiles/arp00000patch)
  [Edit](/neutron/%2Bbug/1461054/%2Battachment/4410106 "Change attachment details")

* [Add attachment](/neutron/%2Bbug/1461054/%2Baddcomment)

## Remote bug watches

* [python-roundup #21239](http://bugs.python.org/issue21239)

  [2:3]
  [Edit](/bugs/1461054/%2Bwatch/116478 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.redhat.com_38a05a56_20250126_074929.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from rhn.redhat.com_515a7175_20250125_093820.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2015:1680 - Security Advisory

Issued:
2015-08-24
Updated:
2015-08-24
# RHSA-2015:1680 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-neutron security and bug fix update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2015%3A1680)

## Topic

Updated openstack-neutron packages that fix one security issue are now
available for Red Hat Enterprise Linux OpenStack Platform 6.0

Red Hat Product Security has rated this update as having a Moderate security
impact. A Common Vulnerability Scoring System (CVSS) base score, which
gives a detailed severity rating, is available from the CVE link in the
References section.

## Description

OpenStack Networking (Neutron) is a pluggable, scalable, and API-driven
system that provisions networking services to virtual machines. Its main
function is to manage connectivity to and from virtual machines.

A Denial of Service flaw was found in the L2 agent when using the IPTables
firewall driver. By submitting an address pair that will be rejected as
invalid by the ipset tool, an attacker may cause the agent to crash.
(CVE-2015-3221)

Red Hat would like to thank the OpenStack upstream for reporting this
issue. Upstream acknowledges Darragh O'Reilly (HP) as the original reporter.

Additionally, the packages address the following issues:

* Neutron failed to load multiple configuration files. The Puppet recipe

hard-coded the --config-file parameter to a set list of configuration files
and additional files were not loaded, even if specified. This fix creates a
new Neutron configuration directory, /etc/neutron/conf.d, and any .conf
files in that directory are loaded by Puppet and applied to all services.
(BZ#1188480)

* When configuring load balancer as a service, the Neutron configuration

used no group as the default system user group. This group does not exist
in the default Red Hat Enterprise Linux 7 configuration, which caused the
virtual IP address creation to fail with the error "cannot find group id
for 'nogroup'." (BZ#1208002)

* Log rotation was set to one week for Neutron, but that could allow the

log file to grow to be very large before rotating. The default log rotation
policy has been updated to include a size limit of 10MB as well as a time
limit to rotate daily. (BZ#1212442)

* Previously, dnsmasq did not save lease information in persistent storage.

When it was restarted, the lease information was lost. This behavior
resulted from removing the '--dhcp-script' option as part of fixing
BZ#1202392. As a result, instances were stuck in the network boot process
for a long period of time. In addition, NACK messages were noted in the
dnsmasq log. This update removes the authoritative option, so that NAKs are
not sent in response to DHCPREQUESTs to other servers. This change is
expected to prevent dnsmasq from NAKing clients renewing leases issued
before it was restarted/rescheduled. DHCPNAK messages should no longer be
found in the log files. (BZ#1227635)

* Conflict tags were included in the python-neutron package spec that

resulted in Neutron unnecessarily blocking the python-oslo-db package.
These conflicts have been removed from the spec, so the python-oslo-db
package can be successfully installed. (BZ#1250056)

All openstack-neutron users are advised to upgrade to these updated
packages, which contain backported patches to correct these issues.

## Solution

Before applying this update, make sure all previously released errata
relevant to your system have been applied.

This update is available via the Red Hat Network. Details on how to use the
Red Hat Network to apply this update are available at
<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack 6.0 x86\_64

## Fixes

* [BZ - 1208002](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=1208002)
  - LBASS VIP creation fails because system group "nogroup" doesn't exist
* [BZ - 1227635](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=1227635)
  - DHCPNAK after neutron-dhcp-agent restart
* [BZ - 1232284](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=1232284)
  - CVE-2015-3221 openstack-neutron: L2 agent DoS through incorrect allowed address pairs
* [BZ - 1250056](https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=1250056)
  - neutron unnecessarily blocks python-oslo-db >= 1.1.0

## CVEs

* [CVE-2015-3221](https://www.redhat.com/security/data/cve/CVE-2015-3221.html)

## References

* <https://access.redhat.com/security/updates/classification/#moderate>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack 6.0

| SRPM | |
| --- | --- |
| x86\_64 | |
| openstack-neutron-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 7341dd21908690131811951a4f261c38b7ad4708f62fb75826b7b15283a9080c |
| openstack-neutron-bigswitch-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 818b42e17de8b2a687d6d3fa74dc095c891c08d76ba15aa64de244f56c09627f |
| openstack-neutron-brocade-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 21d2cf97599f18616cfa05c58eff1ea052189e328c7a1dc0fd33d8e3f7788cec |
| openstack-neutron-cisco-2014.2.3-9.el7ost.noarch.rpm | SHA-256: d352b475d8e61f15ef2431c556a8fd44838d03c40490a7100deba8e41b49d859 |
| openstack-neutron-common-2014.2.3-9.el7ost.noarch.rpm | SHA-256: c510bf9ad7d9b3a6ba55e4fcf171d6969ad3d24fe6a859c9f283896177085f96 |
| openstack-neutron-embrane-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 9e78477e03cfb20f67339a65f32d37ae3ed75eb803dcd83c8d6b58fdc69783ea |
| openstack-neutron-hyperv-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 4bd77c5743c264a4f17593cc923569d6de9eed73c997982ad468f02bab6db991 |
| openstack-neutron-ibm-2014.2.3-9.el7ost.noarch.rpm | SHA-256: c8122b9dced2c46659bdb3e8b43c0e74fb40a1bde7d7552007c11589374cb152 |
| openstack-neutron-linuxbridge-2014.2.3-9.el7ost.noarch.rpm | SHA-256: ea6e1997968c0c82b5bb2fdea8be82b43fe1cee937afb31c5c8cc7f2668be878 |
| openstack-neutron-mellanox-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 1961b5324df4ee1ea12d97b02c783c268cf1627b5f83598e0f8ee44d2111322e |
| openstack-neutron-metaplugin-2014.2.3-9.el7ost.noarch.rpm | SHA-256: d640c5dfcb7dd3e88a5ac05ad1661f8b05eb1525a39efde4866a46229ba42380 |
| openstack-neutron-metering-agent-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 9ba0db494938c32be768d6c55a652761b48f2d3b02eaaa58e90742f572e7556e |
| openstack-neutron-midonet-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 88aac0a7bf10f31a7341726c00e079f4e2e07b7f7b065adf641ae8acf68c3345 |
| openstack-neutron-ml2-2014.2.3-9.el7ost.noarch.rpm | SHA-256: cb9bad32c633b5c864896e08d75670631d5149520407e8806b46446ee714a629 |
| openstack-neutron-nec-2014.2.3-9.el7ost.noarch.rpm | SHA-256: e06fbe49512d4777a279487e31c6593306db800a91abfb4e1c1be562961d3587 |
| openstack-neutron-nuage-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 93cc543ec5c04b5681763fb4088f2ddf81f33d1f2f950cfcfd00982c440c30a8 |
| openstack-neutron-ofagent-2014.2.3-9.el7ost.noarch.rpm | SHA-256: e56845775eb5ee9d7490f742a559ee3fdf2bfee4c4eed6bd6fda327d5291ce87 |
| openstack-neutron-oneconvergence-nvsd-2014.2.3-9.el7ost.noarch.rpm | SHA-256: ac78b2ea8a3e8e55f33c0e1c02c58dcb15a2c906dbe94e2e28d4206032ef851b |
| openstack-neutron-opencontrail-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 78a5a4f0f67da799cef36117ca87ee169beef04808a0a2adafefbe6c287508bf |
| openstack-neutron-openvswitch-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 38857125d22f8d89347ce3df5b325ee5676c713e514c816dda1a21af21c1092e |
| openstack-neutron-plumgrid-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 6ecb81b3b9e1c4f7ef151acf065af093a10ec1d979e14f7889896c616e7b35a1 |
| openstack-neutron-ryu-2014.2.3-9.el7ost.noarch.rpm | SHA-256: ec35f2f71166f7cfda2bc717b5bffe973e8364b946eed1d2aca865c62cb07567 |
| openstack-neutron-sriov-nic-agent-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 765474cfc684e7783b514deea897d927c0533105ac47b511c4039d8d6ce51643 |
| openstack-neutron-vmware-2014.2.3-9.el7ost.noarch.rpm | SHA-256: fcb602cc9d9d939ef12f1855c5e419331982b13475af9d0b8e8a20a519101168 |
| openstack-neutron-vpn-agent-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 8f20d5ddc1bdfc41c928c819cf13c5597b2c74b325f50f9f7856463aea4b6e96 |
| python-neutron-2014.2.3-9.el7ost.noarch.rpm | SHA-256: 52db1d9fc78ab45c13552db8041d8834a9706c2f46337bc76b0df5121b574982 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from launchpad.net_499eb790_20250126_074922.html ===

[Log in / Register](https://launchpad.net/~darragh-oreilly/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~darragh-oreilly)

## [Darragh O'Reilly](https://launchpad.net/~darragh-oreilly)

* Overview
* [Code](https://code.launchpad.net/~darragh-oreilly)
* [Bugs](https://bugs.launchpad.net/~darragh-oreilly)
* [Blueprints](https://blueprints.launchpad.net/~darragh-oreilly)
* [Translations](https://translations.launchpad.net/~darragh-oreilly)
* [Answers](https://answers.launchpad.net/~darragh-oreilly)

* [Related packages](https://launchpad.net/~darragh-oreilly/%2Brelated-packages)
* [Related projects](https://launchpad.net/~darragh-oreilly/%2Brelated-projects)

## User information

Launchpad Id:
darragh-oreilly

Email:
[Log in](%2Blogin) for email information.

Member since:
2011-10-20

[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

SSH keys:

[user1@hplaptop](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~darragh-oreilly/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**oreillyd**
 on
**freenode**

## [All memberships](https://launchpad.net/~darragh-oreilly/%2Bparticipation) Latest memberships

| [OpenStack Team](/~openstack)  Joined on 2013-04-01 | |
| --- | --- |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from access.redhat.com_17465dfb_20250126_074925.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# Severity ratings

## Understanding Red Hat security ratings

Red Hat Product Security rates the severity of security issues found
in Red Hat products using a four-point scale (Low, Moderate,
Important, and Critical), as well as including a separate Common
Vulnerability Scoring System (CVSS) base score. These scoring systems
provide a prioritized risk assessment to help you understand and
schedule upgrades to your systems, enabling informed decisions on the
risk each issue places on your unique environment.

The four-point scale tells you how serious Red Hat considers an issue
to be, helping you judge the severity and determine the most important
updates. The scale takes into account the potential risk based on a technical analysis of the exact flaw and its type. The risk level of a flaw does not change if an exploit or worm is later released for a flaw, or if one is available before the release of a fix. A flaw will only be re-evaluated if new technical details emerge.

The following table provides severity ratings for Red Hat products and systems. For flaws specific to AI models, see [Red Hat security ratings for AI models](https://access.redhat.com/security/ai).

| **Severity ratings** | **Security flaw description** |
| --- | --- |
| **Critical impact** | This rating is given to flaws that could be easily exploited by a remote unauthenticated attacker and lead to system compromise (arbitrary code execution) without requiring user interaction, or easily cause system compromise via inference end points on AI systems. Flaws that require authentication, local or physical access to a system, or an unlikely configuration are not classified as Critical impact. These are the types of vulnerabilities that can be exploited by worms. |
| **Important impact** | This rating is given to flaws that can easily compromise the confidentiality, integrity or availability of resources. These are the types of vulnerabilities that allow local or authenticated users to gain additional privileges, allow unauthenticated remote users to view resources that should otherwise be protected by authentication or other controls, allow authenticated remote users to execute arbitrary code, allow remote users to cause a denial of service, or can cause system compromise via inference end points on AI systems. |
| **Moderate impact** | This rating is given to flaws that may be more difficult to exploit but could still lead to some compromise of the confidentiality, integrity or availability of resources under certain circumstances. It is also given to flaws that could be exploited to cause denial of service-like conditions on AI systems via an inference end point, or allow attackers to steal other users’ data from the AI system without authorization. These are the types of vulnerabilities that could have had a Critical or Important impact but are less easily exploited based on a technical evaluation of the flaw and/or affect unlikely configurations. || **Low impact** | This rating is given to all other issues that may have a security impact. These are the types of vulnerabilities that are believed to require unlikely circumstances to be able to be exploited, or where a successful exploit would give minimal consequences. This includes flaws that are present in a program’s source code but to which no current or theoretically possible, but unproven, exploitation vectors exist or were found during the technical analysis of the flaw. |

A Red Hat security advisory can contain fixes for more than one
vulnerability and for packages for more than one product (such as both
Red Hat Enterprise Linux 7 and 8). Each issue in an advisory has a
severity rating for each product. The overall severity of an advisory
is the highest severity out of all the individual issues, across all
the products the advisory targets. For simplicity, advisories only
show the overall severity. The advisories contain links to the
relevant entries in Red Hat's bug-tracking system, where you can
examine individual severity ratings and additional commentary, as well
as links to the relevant pages in Red Hat’s CVE database.

When a technology—enabled and most likely used by default—completely
blocks the exploitation of a particular vulnerability across all
architectures, we will adjust the severity level. When a technology
reduces the risk of a vulnerability, we may adjust the severity level
and give an explanation of the decision in the bug-tracking  and CVE
database entries.

## Common Vulnerability Scoring System (CVSS)

Common Vulnerability Scoring System (CVSS) base scores provide
additional guidance about a vulnerability, giving a detailed severity
rating by scoring the constant aspects of a vulnerability: Attack
Vector, Attack Complexity, User Interaction, Privileges Required,
Scope, Confidentiality, Integrity, and Availability.

CVSS version 2 base metrics are available for all vulnerabilities from
2009-2016, as well as selected earlier vulnerabilities. In 2016, Red
Hat adopted the CVSS v3 standard, and all vulnerabilities going
forward will use version 3.1 for scoring. These scores are found on
the
[CVE pages](https://access.redhat.com/security/security-updates/#/cve)
(linked from the References section of each Red Hat Security Advisory).

Red Hat does not solely use the CVSS rating to determine the priority
with which flaws are fixed, or to determine the severity rating of the
vulnerability. It is used as a guideline to identify and describe key
metrics of a flaw, however the priority for which flaws are fixed is
determined by the overall severity of the flaw using the
aforementioned four-point scale.  CVSS is meant to help customers
prioritize the order in which they remediate flaws.

### CVSS v3 Base Metrics

The CVSS v3 base metrics group covers the constant aspects of a
vulnerability:

* Attack Vector (AV) - Expresses the "remoteness" of the attack and
  how the vulnerability is exploited.
* Attack Complexity (AC) - Speaks to the difficulty of executing an
  attack and what factors are needed for it to be successful. (Along
  with User Interaction, Attack Complexity was formerly part of the
  Access Complexity metric.).
* User Interaction (UI) - Determines whether the attack requires an
  active human to participate or if the attack can be automated.
* Privileges Required (PR) - Documents the level of user
  authentication required for the attack to be successful. (This
  replaces the former Authentication metric.).
* Scope (S) - Determines whether an attacker can impact a component
  beyond its security scope/authority.
* Confidentiality (C) - Determines whether unauthorized parties can
  access data and to what extent.
* Integrity (I) - Measures the impact to the trustworthiness and
  veracity of data.
* Availability (A) - Refers to the impact to accessibility of data or
  services for authorized users.

A formula translates these measurements into a single, numerical base
score, ranging from 0.0 (no risk) to 10.0 (highest risk). Refer to
[Common Vulnerability Scoring System v3.1: User Guide](https://www.first.org/cvss/user-guide)
for detailed descriptions of the base metrics. It is important to note
that the CVSS base metrics were designed to be used with the other
CVSS metric groups, notably the Temporal and Environmental metrics, to
provide an accurate representation of risk in customer environments.
Alone, the Base metrics offer a shallow view of the vulnerability
itself without accounting for deployment or the environment.

### How Red Hat Uses CVSS v3 Base Metrics

We aim to comply with the CVSS v3 standard when assigning base scores,
and Red Hat uses base metrics that reflect how a vulnerability affects
our products specifically.  In addition, we do not use the Qualitative
Severity Rating Scale in the CVSS v3.1 User Guide to rate severity,
and our severity ratings are always based on the aforementioned
four-point scale.  In some circumstances, it may not be obvious why a
flaw received a particular score. The following are some common
vulnerability types with our interpretation and typical scoring:

#### Libraries

It is not always possible to know how third-party applications use
libraries, making it difficult to give accurate CVSS v3 base metrics
for flaws in system libraries. When rating these flaws, we take into
account the way the library is used by applications that we ship, and
also look at other popular software that may use the library in a way
that would cause an issue to be of higher severity, and adjust the
score appropriately.

#### Other Common Scores

Flaws where a local, unprivileged user can cause a kernel to crash
(denial of service) typically score 5.5 (for example,
[CVE-2019-9213](https://access.redhat.com/security/cve/CVE-2019-9213)).

Flaws that allow a local, unprivileged user to escalate their
privileges to root typically score 7.8 (for example,
[CVE-2019-18634](https://access.redhat.com/security/cve/CVE-2019-18634)).

Cross-site scripting flaws are generally scored as having Low impact
to Integrity and/or Confidentiality, with no impact to Availability,
in line with scoring from other vendors and NVD. A typical score for
these flaws is 6.1 (for example,
[CVE-2020-11023](https://access.redhat.com/security/cve/CVE-2020-11023)).

### Base Score Variations Across Products

It is common for a given CVE-named vulnerability to have several
different CVSS base metrics, depending on the product, version, and
architecture. Examples of this include:

* A vulnerability that only affected some architectures. For example,
  [CVE-2019-15031](https://access.redhat.com/security/cve/CVE-2019-15031)
  only affected PowerPC.
* A vulnerability that is mitigated by source code protection
  mechanisms on some platforms. For example,
  [CVE-2018-1125](https://access.redhat.com/security/cve/CVE-2018-1125)
  could have led to arbitrary code execution on Red Hat Enterprise
  Linux, but it is only a denial of service because it was compiled
  with FORTIFY protections.
* A vulnerability that affected more than one product.  For example,
  [CVE-2020-14060](https://access.redhat.com/security/cve/CVE-2020-14060)
  affected a component in both OpenShift and OpenStack.  The severity
  to OpenStack was lower (Low) as compared to OpenShift (Moderate)
  based on its usage; the overall vulnerability itself was rated
  Important.

If CVSS v3 base scores are significantly different across products, we
note that separately wherever possible. If we do not split the score,
we report the metric that gives the highest CVSS v3 base score (the
worst-case outcome).

### Differences Between NVD and Red Hat Scores

For open source software shipped by multiple vendors, the CVSS base
scores may vary for each vendor's version, depending on the version
they ship, how they ship it, the platform, and even how the software
is compiled. This makes scoring vulnerabilities difficult for
third-party vulnerability databases, such as NVD, who can give only a
single CVSS base score to each vulnerability, or when comparing to
other vendors who score based on the characteristics of use in their
own products. See the
[National Vulnerability Database](https://nvd.nist.gov/vuln-metrics/cvss)
for more information regarding NVD security ratings.

These differences can cause the scores to vary widely. Other reasons
may include how the source code was compiled with certain compiler
flags or hardening technologies that reduce or eliminate the security
severity of a flaw, or how the software is used within the product.
Software running standalone may suffer from a flaw, but its use within
a product may preclude the vulnerable code from ever being used in a
way that could be exploited.

For example, NVD may rate a flaw in a particular service as having
High Impact on the CVSS CIA Triad (Confidentiality, Integrity,
Availability) where the service in question is typically run as the
root user with full privileges on a system. However, in a Red Hat
product, the service may be specifically configured to run as a
dedicated non-privileged user running entirely in a SELinux sandbox,
greatly reducing the immediate impact from compromise, resulting in
Low impact.

For these reasons, we recommend that, whenever possible, you use a
CVSS base score provided by Red Hat in preference to a score from a
third party. Please
[let us know](https://access.redhat.com/site/security/team/contact/)
if you believe we have given an incorrect CVSS v3 base score for a
particular vulnerability. We are happy to discuss and update if
needed.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close


